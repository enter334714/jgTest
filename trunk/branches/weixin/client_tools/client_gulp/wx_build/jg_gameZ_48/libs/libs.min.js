var Laya=window.Laya=function(j,B){var A={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(B,g){return 1==arguments.length?A.__presubstr.call(this,B):A.__presubstr.call(this,B,0<g?g:this.length+g)},__init:function(B){B.forEach(function(B){B.__init$&&B.__init$()})},__isClass:function(B){return B&&(B.__isclass||B==Object||B==String||B==Array)},__newvec:function(B,g){var l=[];l.length=B;for(var o=0;o<B;o++)l[o]=g;return l},__extend:function(B,g){for(var l in g)if(g.hasOwnProperty(l)){var o=Object.getOwnPropertyDescriptor(g,l),V=o.get,U=o.set;V||U?V&&U?Object.defineProperty(B,l,o):(V&&Object.defineProperty(B,l,V),U&&Object.defineProperty(B,l,U)):B[l]=g[l]}function y(){A.un(this,"constructor",B)}y.prototype=g.prototype,B.prototype=new y,A.un(B.prototype,"__imps",A.__copy({},g.prototype.__imps))},__copy:function(B,g){if(!g)return null;for(var l in B=B||{},g)B[l]=g[l];return B},__package:function(B,g){if(!A.__packages[B]){A.__packages[B]=!0;var l=j,o=B.split(".");if(1<o.length)for(var V=0,U=o.length-1;V<U;V++){var y=l[o[V]];l=y||(l[o[V]]={})}l[o[o.length-1]]||(l[o[o.length-1]]=g||{})}},__hasOwnProperty:function(B,g){return g=g||this,Object.hasOwnProperty.call(g,B)||function B(g,l){if(Object.hasOwnProperty.call(l.prototype,g))return!0;var o=l.prototype.__super;return null==o?null:B(g,o)}(B,g.__class)},__typeof:function(B,g){if(!B||!g)return!1;if(g===String)return"string"==typeof B;if(g===Number)return"number"==typeof B;if(g.__interface__)g=g.__interface__;else if("string"!=typeof g)return B instanceof g;return B.__imps&&B.__imps[g]||B.__class==g},__as:function(B,g){return this.__typeof(B,g)?B:null},__int:function(B){return B?parseInt(B):0},interface:function(B,g){A.__package(B,{});var l=A.__internals,o=l[B]=l[B]||{self:B};if(g){var V=g.split(",");o.extend=[];for(var U=0;U<V.length;U++){var y=V[U];l[y]=l[y]||{self:y},o.extend.push(l[y])}}var G=j,d=B.split(".");for(U=0;U<d.length-1;U++)G=G[d[U]];G[d[d.length-1]]={__interface__:B}},class:function(B,g,l,o){if(l&&A.__extend(B,l),g)if(A.__package(g,B),A.__classmap[g]=B,0<g.indexOf(".")){if(0==g.indexOf("laya.")){var V=g.split(".");o=o||V[V.length-1],A[o]&&console.log("Warning!,this class["+o+"] already exist:",A[o]),A[o]=B}}else"Main"==g?j.Main=B:"MainWX"==g?j.MainWX=B:(A[g]&&console.log("Error!,this class["+g+"] already exist:",A[g]),A[g]=B);var U=A.un,y=B.prototype;U(y,"hasOwnProperty",A.__hasOwnProperty),U(y,"__class",B),U(y,"__super",l),U(y,"__className",g),U(B,"__super",l),U(B,"__className",g),U(B,"__isclass",!0),U(B,"super",function(B){this.__super.call(B)})},imps:function(B,g){if(!g)return null;var V=B.__imps||A.un(B,"__imps",{});function U(B){var g,l;if((g=A.__internals[B])&&(V[B]=!0,l=g.extend))for(var o=0;o<l.length;o++)U(l[o].self)}for(var l in g)U(l)},superSet:function(B,g,l,o){var V=B.prototype["_$set_"+l];V&&V.call(g,o)},superGet:function(B,g,l){var o=B.prototype["_$get_"+l];return o?o.call(g):null},getset:function(B,g,l,o,V){B?(o&&(g["_$GET_"+l]=o),V&&(g["_$SET_"+l]=V)):(o&&A.un(g,"_$get_"+l,o),V&&A.un(g,"_$set_"+l,V)),o&&V?Object.defineProperty(g,l,{get:o,set:V,enumerable:!1,configurable:!0}):(o&&Object.defineProperty(g,l,{get:o,enumerable:!1,configurable:!0}),V&&Object.defineProperty(g,l,{set:V,enumerable:!1,configurable:!0}))},static:function(l,o){for(var V=0,B=o.length;V<B;V+=2)if("length"==o[V])l.length=o[V+1].call(l);else{function g(){var g=o[V],B=o[V+1];Object.defineProperty(l,g,{get:function(){return delete this[g],this[g]=B.call(this)},set:function(B){delete this[g],this[g]=B},enumerable:!0,configurable:!0})}g()}},un:function(B,g,l){return l||(l=B[g]),A.__propun.value=l,Object.defineProperty(B,g,A.__propun),l},uns:function(g,B){B.forEach(function(B){A.un(g,B)})}};return j.console=j.console||{log:function(){}},j.trace=j.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),A}(window,document);!function(B,g,l){l.un,l.uns,l.static,l.class,l.getset,l.__newvec}(window,document,Laya),function(y,g,s){s.un,s.uns;var d=s.static,N=s.class,A=s.getset;s.__newvec;s.interface("laya.runtime.IMarket"),s.interface("laya.filters.IFilter"),s.interface("laya.display.ILayout"),s.interface("laya.resource.IDispose"),s.interface("laya.runtime.IPlatform"),s.interface("laya.resource.IDestroy"),s.interface("laya.runtime.IConchNode"),s.interface("laya.filters.IFilterAction"),s.interface("laya.runtime.ICPlatformClass"),s.interface("laya.resource.ICreateResource"),s.interface("laya.runtime.IConchRenderObject"),s.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var t=function(){function U(){}return N(U,"laya.utils.RunDriver"),U.FILTER_ACTIONS=[],U.pixelRatio=-1,U._charSizeTestDiv=null,U.now=function(){return Date.now()},U.getWindow=function(){return y},U.getPixelRatio=function(){if(U.pixelRatio<0){var B=Y.context,g=B.backingStorePixelRatio||B.webkitBackingStorePixelRatio||B.mozBackingStorePixelRatio||B.msBackingStorePixelRatio||B.oBackingStorePixelRatio||B.backingStorePixelRatio||1;(U.pixelRatio=(Y.window.devicePixelRatio||1)/g)<1&&(U.pixelRatio=1)}return U.pixelRatio},U.getIncludeStr=function(B){return null},U.createShaderCondition=function(B){var g="(function() {return "+B+";})";return s._runScript(g)},U.fontMap=[],U.measureText=function(B,g){var l=U.hanzi.test(B);if(l&&U.fontMap[g])return U.fontMap[g];var o=Y.context;o.font=g;var V=o.measureText(B);return V||(V={width:16,height:16}),l&&(U.fontMap[g]=V),V},U.getWebGLContext=function(B){},U.beginFlush=function(){},U.endFinish=function(){},U.addToAtlas=null,U.flashFlushImage=function(B){},U.drawToCanvas=function(B,g,l,o,V,U){var y=MB.create("2D"),G=new e(l,o,y);return Q.renders[g]._fun(B,G,V,U),y},U.createParticleTemplate2D=null,U.createGLTextur=null,U.createWebGLContext2D=null,U.changeWebGLSize=function(B,g){},U.createRenderSprite=function(B,g){return new Q(B,g)},U.createFilterAction=function(B){return new M},U.createGraphics=function(){return new K},U.clear=function(B){E._context.ctx.clear()},U.cancelLoadByUrl=function(B){},U.clearAtlas=function(B){},U.isAtlas=function(B){return!1},U.addTextureToAtlas=function(B){},U.getTexturePixels=function(B,g,l,o,V){return null},U.skinAniSprite=function(){return null},U.update3DLoop=function(){},d(U,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),U}(),o=(A(1,s,"alertGlobalError",null,function(B){var U=0;Y.window.onerror=B?function(B,g,l,o,V){U++<5&&V&&alert(V.stack||V)}:null}),s.init=function(B,g,l){for(var o=[],V=2,U=arguments.length;V<U;V++)o.push(arguments[V]);if(!s._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=s._arrayBufferSlice),s._isinit=!0,Y.__init__(),_.__init__(),K.__init__(),s.timer=new k,s.scaleTimer=new k,s.loader=new dB,q.__init__(),V=0;for(var y=o.length;V<y;V++)o[V].enable&&o[V].enable();return p.__init__(),G.__init__(),P.__init__(),r.beginCheck(),s._currentStage=s.stage=new CB,s.stage.conchModel&&s.stage.conchModel.setRootNode(),s._getUrlPath(),s.render=new E(0,0),s.stage.size(B,g),Q.__init__(),H.__init__(),x.instance.__init__(s.stage,E.canvas),DB.__init__(),z.autoStopMusic=!0,i.__init__(),E.canvas}},s._getUrlPath=function(){var B=Y.window.location,g=B.pathname;g=g&&":"==g.charAt(2)?g.substring(1):g,S.rootPath=S.basePath=S.getPath("file:"==B.protocol?g:B.protocol+"//"+B.host+B.pathname)},s._arrayBufferSlice=function(B,g){var l=new Uint8Array(this,B,g-B),o=new Uint8Array(l.length);return o.set(l),o.buffer},s._runScript=function(B){return Y.window[s._evcode](B)},s.stage=null,s.timer=null,s.scaleTimer=null,s.loader=null,s.version="1.8.6",s.render=null,s._currentStage=null,s._isinit=!1,s.isDebug=!1,s.MiniAdpter={init:function(){y.navigator&&y.navigator.userAgent&&-1<y.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},d(s,["conchMarket",function(){return this.conchMarket=y.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=y.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function B(){}return N(B,"Config"),B.WebGLTextCacheCount=500,B.atlasEnable=!1,B.showCanvasMark=!1,B.animationInterval=50,B.isAntialias=!1,B.isAlpha=!1,B.premultipliedAlpha=!0,B.isStencil=!0,B.preserveDrawingBuffer=!1,B}()),j=function(){function j(){this._events=null}N(j,"laya.events.EventDispatcher");var B=j.prototype;return B.hasListener=function(B){return!!(this._events&&this._events[B])},B.getListener=function(B){return this._events?this._events[B]:null},B.event=function(B,g){if(!this._events||!this._events[B])return!1;var l=this._events[B];if(l.lock)l.queue||(l.queue=[]),l.queue.push(g);else{var o;for(l.lock=!0,l.cursor=l.head;l.cursor;)(o=l.cursor).recover?(l.head=l.tail=l.cursor=null,console.error("node is recover："+o.id)):(l.cursor=o.next,o.once&&j.delNode(l,o),o.method&&(null!=g?o.args?o.method.apply(o.caller,o.args.concat(g)):g instanceof Array?o.method.apply(o.caller,g):o.caller?o.method.call(o.caller,g):s.recordError("事件派发错误","node.caller:"+o.caller+"node.method:"+o.method+"data:"+g+"node.prev"+o.prev):o.method.apply(o.caller,o.args)),o.once&&j.recoverHandler(o));l.lock=!1,!l.head&&this._events&&this._events[B]==l&&delete this._events[B],l.queue&&l.queue.length&&this.event(B,l.queue.shift())}return!0},B.on=function(B,g,l,o){return this._createListener(B,g,l,o,!1)},B.once=function(B,g,l,o){return this._createListener(B,g,l,o,!0)},B._createListener=function(B,g,l,o,V,U){void 0===U&&(U=!0),U&&this.off(B,g,l,V);var y=j.createHandler(g||this,l,o,V);this._events||(this._events={});var G=this._events,d=G[B];return d?d.tail?(y.prev=d.tail,d.tail.next=y,d.tail=y):d.head=d.tail=y:G[B]={head:y,tail:y,cursor:null,lock:!1},this},B.off=function(B,g,l,o){if(void 0===o&&(o=!1),!this._events||!this._events[B])return this;for(var V=this._events[B],U=V.head;U;){if((!g||U.caller===g)&&U.method===l&&(!o||U.once)){j.delNode(V,U),V.cursor==U&&(V.cursor=U.next),j.recoverHandler(U);break}U=U.next}return this},B.offAll=function(B){var g=this._events;if(!g)return this;if(B)this._recoverHandlers(g[B]),delete g[B];else{for(var l in g)this._recoverHandlers(g[l]);this._events=null}return this},B._recoverHandlers=function(B){if(B){for(var g=B.head;g;){j.delNode(B,g);var l=g.next;j.recoverHandler(g),g=l}B.cursor=null}},B.isMouseEvent=function(B){return j.MOUSE_EVENTS[B]},j.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},j.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},j.delNode=function(B,g){g.prev?g.prev.next=g.next:B.head=g.next,g.next?g.next.prev=g.prev:B.tail=g.prev},j.createHandler=function(B,g,l,o){var V=500<j._freeHandler.length?j._freeHandler.shift():null;if(V)if(V.recover)V.recover=!1,V.caller=B,V.method=g,V.args=l,V.once=o;else{var U="";try{arguments.propertyIsEnumerable.caller}catch(B){U=B.stack}var y=V.caller?(V.caller.__proto__&&V.caller.__proto__.constructor&&V.caller.__proto__.constructor.name)+"|"+V.caller.__className+"|"+V.caller.name:"",G=V.method?V.method.name:"";s.recordError("EventDispatcher重复创建","caller="+y+"  method="+G+"  stack="+U),V={id:++j._nodeCount,caller:B,method:g,args:l,once:o,recover:!1}}else V={id:++j._nodeCount,caller:B,method:g,args:l,once:o,recover:!1};return V.prev=V.next=null,V},j.recoverHandler=function(B){if(B.recover){if(j._errorCount<5){j._errorCount++;var g="";try{arguments.propertyIsEnumerable.caller}catch(B){g=B.stack}var l=B.caller?(B.caller.__proto__&&B.caller.__proto__.constructor&&B.caller.__proto__.constructor.name)+"|"+B.caller.__className+"|"+B.caller.name:"",o=B.method?B.method.name:"";s.recordError("EventDispatcher重复回收","id="+B.id+"  caller="+l+"  method="+o+"  stack="+g)}B.caller=B.method=B.args=B.prev=null}else B.recover=!0,B.caller=B.method=B.args=B.prev=B.next=null,j._freeHandler&&j._freeHandler.length<3e3&&j._freeHandler.push(B)},j._freeHandler=[],j._nodeCount=0,j._errorCount=0,j}(),m=function(){function V(B,g,l,o){this.once=!1,void(this._id=0)===o&&(o=!1),this.setTo(B,g,l,o)}N(V,"laya.utils.Handler");var B=V.prototype;return B.setTo=function(B,g,l,o){return this._id=V._gid++,this.caller=B,this.method=g,this.args=l,this.once=o,this},B.run=function(){if(null==this.method)return null;var B=this._id,g=this.method.apply(this.caller,this.args);return this._id===B&&this.once&&this.recover(),g},B.runWith=function(B){if(null==this.method)return null;var g=this._id;if(null==B)var l=this.method.apply(this.caller,this.args);else l=this.args||B.unshift?this.args?this.method.apply(this.caller,this.args.concat(B)):this.method.apply(this.caller,B):this.method.call(this.caller,B);return this._id===g&&this.once&&this.recover(),l},B.clear=function(){return this.caller=null,this.method=null,this.args=null,this},B.recover=function(){0<this._id&&(this._id=0,this.clear())},V.create=function(B,g,l,o){return void 0===o&&(o=!0),new V(B,g,l,o)},V._gid=1,V}(),a=function(){function B(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}N(B,"laya.display.BitmapFont");var g=B.prototype;return g.loadFont=function(B,g){this._path=B,this._complete=g,s.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],m.create(this,this.onLoaded))},g.onLoaded=function(){this.parseFont(GB.getRes(this._path),GB.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},g.parseFont=function(B,g){if(null!=B&&null!=g){this._texture=g;var l=B.getElementsByTagName("info");if(!l[0].getAttributeNode)return this.parseFont2(B,g);this.fontSize=parseInt(l[0].getAttributeNode("size").nodeValue);var o,V=l[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(V[0]),parseInt(V[1]),parseInt(V[2]),parseInt(V[3])],o=B.getElementsByTagName("char");var U=0;for(U=0;U<o.length;U++){var y=o[U],G=parseInt(y.getAttributeNode("id").nodeValue),d=parseInt(y.getAttributeNode("xoffset").nodeValue)/1,j=parseInt(y.getAttributeNode("yoffset").nodeValue)/1,A=parseInt(y.getAttributeNode("xadvance").nodeValue)/1,H=new w;H.x=parseInt(y.getAttributeNode("x").nodeValue),H.y=parseInt(y.getAttributeNode("y").nodeValue),H.width=parseInt(y.getAttributeNode("width").nodeValue),H.height=parseInt(y.getAttributeNode("height").nodeValue);var K=AB.create(g,H.x,H.y,H.width,H.height,d,j);this._maxWidth=Math.max(this._maxWidth,A+this.letterSpacing),this._fontCharDic[G]=K,this._fontWidthMap[G]=A}}},g.parseFont2=function(B,g){if(null!=B&&null!=g){this._texture=g;var l=B.getElementsByTagName("info");this.fontSize=parseInt(l[0].attributes.size.nodeValue);var o=l[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3])];var V=B.getElementsByTagName("char"),U=0;for(U=0;U<V.length;U++){var y=V[U].attributes,G=parseInt(y.id.nodeValue),d=parseInt(y.xoffset.nodeValue)/1,j=parseInt(y.yoffset.nodeValue)/1,A=parseInt(y.xadvance.nodeValue)/1,H=new w;H.x=parseInt(y.x.nodeValue),H.y=parseInt(y.y.nodeValue),H.width=parseInt(y.width.nodeValue),H.height=parseInt(y.height.nodeValue);var K=AB.create(g,H.x,H.y,H.width,H.height,d,j);this._maxWidth=Math.max(this._maxWidth,A+this.letterSpacing),this._fontCharDic[G]=K,this._fontWidthMap[G]=A}}},g.getCharTexture=function(B){return this._fontCharDic[B.charCodeAt(0)]},g.destroy=function(){if(this._texture){for(var B in this._fontCharDic){var g=this._fontCharDic[B];g&&g.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},g.setSpaceWidth=function(B){this._spaceWidth=B},g.getCharWidth=function(B){var g=B.charCodeAt(0);return this._fontWidthMap[g]?this._fontWidthMap[g]+this.letterSpacing:" "==B?this._spaceWidth+this.letterSpacing:0},g.getTextWidth=function(B){for(var g=0,l=0,o=B.length;l<o;l++)g+=this.getCharWidth(B.charAt(l));return g},g.getMaxWidth=function(){return this._maxWidth},g.getMaxHeight=function(){return this.fontSize},g.drawText=function(B,g,l,o,V,U){var y,G=this.getTextWidth(B),d=0;"center"===V&&(d=(U-G)/2),"right"===V&&(d=U-G);for(var j=0,A=0,H=B.length;A<H;A++)(y=this.getCharTexture(B.charAt(A)))&&(g.graphics.drawTexture(y,l+j+d,o),j+=this.getCharWidth(B.charAt(A)))},B}(),G=function(){function l(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=l._TF_EMPTY}N(l,"laya.display.css.Style");var B=l.prototype;return B.getTransform=function(){return this._tf},B.setTransform=function(B){this._tf="none"!==B&&B?B:l._TF_EMPTY},B.setTranslateX=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.translateX=B},B.setTranslateY=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.translateY=B},B.setScaleX=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.scaleX=B},B.setScale=function(B,g){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.scaleX=B,this._tf.scaleY=g},B.setScaleY=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.scaleY=B},B.setRotate=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.rotate=B},B.setSkewX=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.skewX=B},B.setSkewY=function(B){this._tf===l._TF_EMPTY&&(this._tf=new V),this._tf.skewY=B},B.destroy=function(){this.scrollRect=null},B.render=function(B,g,l,o){},B.getCSSStyle=function(){return gB.EMPTY},B._enableLayout=function(){return!1},A(0,B,"scaleX",function(){return this._tf.scaleX},function(B){this.setScaleX(B)}),A(0,B,"transform",function(){return this.getTransform()},function(B){this.setTransform(B)}),A(0,B,"translateX",function(){return this._tf.translateX},function(B){this.setTranslateX(B)}),A(0,B,"translateY",function(){return this._tf.translateY},function(B){this.setTranslateY(B)}),A(0,B,"scaleY",function(){return this._tf.scaleY},function(B){this.setScaleY(B)}),A(0,B,"block",function(){return 0!=(1&this._type)}),A(0,B,"skewY",function(){return this._tf.skewY},function(B){this.setSkewY(B)}),A(0,B,"rotate",function(){return this._tf.rotate},function(B){this.setRotate(B)}),A(0,B,"skewX",function(){return this._tf.skewX},function(B){this.setSkewX(B)}),A(0,B,"paddingLeft",function(){return 0}),A(0,B,"paddingTop",function(){return 0}),A(0,B,"absolute",function(){return!0}),l.__init__=function(){l._TF_EMPTY=new V,l.EMPTY=new l},l.EMPTY=null,l._TF_EMPTY=null,l}(),p=function(){function g(B){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=T.create(g.defaultColor),this.family=g.defaultFamily,this.stroke=g._STROKE,this.size=g.defaultSize,B&&B!==g.EMPTY&&B.copyTo(this)}N(g,"laya.display.css.Font");var B=g.prototype;return B.set=function(B){this._text=null;for(var g=B.split(" "),l=0,o=g.length;l<o;l++){var V=g[l];switch(V){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<V.indexOf("px")&&(this.size=parseInt(V),this.family=g[l+1],l++)}},B.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},B.copyTo=function(B){B._type=this._type,B._text=this._text,B._weight=this._weight,B._color=this._color,B.family=this.family,B.stroke=this.stroke!=g._STROKE?this.stroke.slice():g._STROKE,B.indent=this.indent,B.size=this.size},A(0,B,"password",function(){return 0!=(1024&this._type)},function(B){B?this._type|=1024:this._type&=-1025}),A(0,B,"color",function(){return this._color.strColor},function(B){this._color=T.create(B)}),A(0,B,"italic",function(){return 0!=(512&this._type)},function(B){B?this._type|=512:this._type&=-513}),A(0,B,"bold",function(){return 0!=(2048&this._type)},function(B){B?this._type|=2048:this._type&=-2049}),A(0,B,"weight",function(){return""+this._weight},function(B){var g=0;switch(B){case"normal":break;case"bold":this.bold=!0,g=700;break;case"bolder":g=800;break;case"lighter":g=100;break;default:g=parseInt(B)}this._weight=g,this._text=null}),A(0,B,"decoration",function(){return this._decoration?this._decoration.value:null},function(B){var g=B.split(" ");switch(this._decoration||(this._decoration={}),g[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=g[0]}g[1]&&(this._decoration.color=T.create(g)),this._decoration.value=B}),g.__init__=function(){g.EMPTY=new g(null)},g.EMPTY=null,g.defaultColor="#000000",g.defaultSize=12,g.defaultFamily="Arial",g.defaultFont="12px Arial",g._STROKE=[0,"#000000"],g._ITALIC=512,g._PASSWORD=1024,g._BOLD=2048,g}(),V=function(){function B(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return N(B,"laya.display.css.TransformInfo"),B}(),K=function(){function H(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,E.isConchNode){this._nativeObj=new y._conchGraphics,this.id=this._nativeObj.conchID}}N(H,"laya.display.Graphics");var B=H.prototype;return B.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},B.clear=function(B){void 0===B&&(B=!1);var g=0,l=0;if(B){var o=this._one;if(this._cmds){for(l=this._cmds.length,g=0;g<l;g++)!(o=this._cmds[g])||o.callee!==E._context._drawTexture&&o.callee!==E._context._drawTextureWithTransform||(o[0]=null,H._cache.push(o));this._cmds.length=0}else o&&(!o||o.callee!==E._context._drawTexture&&o.callee!==E._context._drawTextureWithTransform||(o[0]=null,H._cache.push(o)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(g=0,l=this._vectorgraphArray.length;g<l;g++)u.getInstance().deleteShape(this._vectorgraphArray[g]);this._vectorgraphArray.length=0}},B._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},B._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new l,this._graphicBounds._graphics=this)},B._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},B._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},B.getBounds=function(B){return void 0===B&&(B=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(B)},B.getBoundPoints=function(B){return void 0===B&&(B=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(B)},B._addCmd=function(B){this._cmds=this._cmds||[],B.callee=B.shift(),this._cmds.push(B)},B.setFilters=function(B){this._saveToCmd(E._context._setFilters,B)},B.drawTexture=function(B,g,l,o,V,U,y){if(void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0),void 0===V&&(V=0),void 0===y&&(y=1),!B||y<.01)return null;o||(o=B.sourceWidth),V||(V=B.sourceHeight),y=y<0?0:1<y?1:y;var G,d=!E.isWebGL&&(Y.onFirefox||Y.onEdge||Y.onIE||Y.onSafari)?.5:0,j=o/B.sourceWidth,A=V/B.sourceHeight;return o=B.width*j,V=B.height*A,B.loaded&&(o<=0||V<=0)?null:(g+=B.offsetX*j,l+=B.offsetY*A,this._sp&&(this._sp._renderType|=512),g-=d,l-=d,o+=2*d,V+=2*d,H._cache.length?((G=H._cache.pop())[0]=B,G[1]=g,G[2]=l,G[3]=o,G[4]=V,G[5]=U,G[6]=y):G=[B,g,l,o,V,U,y],G.callee=U||1!=y?E._context._drawTextureWithTransform:E._context._drawTexture,null!=this._one||U||1!=y?this._saveToCmd(G.callee,G):(this._one=G,this._render=this._renderOneImg),B.loaded||B.once("loaded",this,this._textureLoaded,[B,G]),this._repaint(),G)},B.cleanByTexture=function(B,g,l,o,V){if(void 0===o&&(o=0),void 0===V&&(V=0),!B)return this.clear();if(this._one&&this._render===this._renderOneImg){o||(o=B.sourceWidth),V||(V=B.sourceHeight);var U=o/B.sourceWidth,y=V/B.sourceHeight;o=B.width*U,V=B.height*y,g+=B.offsetX*U,l+=B.offsetY*y,this._one[0]=B,this._one[1]=g,this._one[2]=l,this._one[3]=o,this._one[4]=V,this._repaint()}else this.clear(),B&&this.drawTexture(B,g,l,o,V)},B.drawTextures=function(B,g){B&&this._saveToCmd(E._context._drawTextures,[B,g])},B.fillTexture=function(B,g,l,o,V,U,y){if(void 0===o&&(o=0),void 0===V&&(V=0),void 0===U&&(U="repeat"),B){var G=[B,g,l,o,V,U,y||X.EMPTY,{}];B.loaded||B.once("loaded",this,this._textureLoaded,[B,G]),this._saveToCmd(E._context._fillTexture,G)}},B._textureLoaded=function(B,g){g[3]=g[3]||B.width,g[4]=g[4]||B.height,this._repaint()},B.fillCircle=function(B,g,l,o,V,U,y){l.bitmap.enableMerageInAtlas=!1;var G=new Float32Array(2*(y+1)),d=new Float32Array(2*(y+1)),j=new Uint16Array(3*y),A=2*Math.PI/y,H=0;G[0]=o,G[1]=V,d[0]=o/l.width,d[1]=V/l.height;for(var K=2,p=0;p<y;p++){var x=U*Math.cos(H)+o,N=U*Math.sin(H)+V;G[K]=x,G[K+1]=N,d[K]=x/l.width,d[K+1]=N/l.height,H+=A,K+=2}for(p=K=0;p<y;p++)j[K++]=0,j[K++]=p+1,j[K++]=y+1<=p+2?1:p+2;this.drawTriangles(l,B,g,G,d,j)},B.drawTriangles=function(B,g,l,o,V,U,y,G,d,j){void 0===G&&(G=1),this._saveToCmd(E._context.drawTriangles,[B,g,l,o,V,U,y,G,d,j])},B._saveToCmd=function(B,g){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=g,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(g)),g.callee=B,this._repaint(),g},B.clipRect=function(B,g,l,o){this._saveToCmd(E._context._clipRect,[B,g,l,o])},B.fillText=function(B,g,l,o,V,U,y){void 0===y&&(y=0),this._saveToCmd(E._context._fillText,[B,g,l,o||p.defaultFont,V,U])},B.fillBorderText=function(B,g,l,o,V,U,y,G){this._saveToCmd(E._context._fillBorderText,[B,g,l,o||p.defaultFont,V,U,y,G])},B.strokeText=function(B,g,l,o,V,U,y){this._saveToCmd(E._context._strokeText,[B,g,l,o||p.defaultFont,V,U,y])},B.alpha=function(B){B=B<0?0:1<B?1:B,this._saveToCmd(E._context._alpha,[B])},B.setAlpha=function(B){B=B<0?0:1<B?1:B,this._saveToCmd(E._context._setAlpha,[B])},B.transform=function(B,g,l){void 0===g&&(g=0),void 0===l&&(l=0),this._saveToCmd(E._context._transform,[B,g,l])},B.rotate=function(B,g,l){void 0===g&&(g=0),void 0===l&&(l=0),this._saveToCmd(E._context._rotate,[B,g,l])},B.scale=function(B,g,l,o){void 0===l&&(l=0),void 0===o&&(o=0),this._saveToCmd(E._context._scale,[B,g,l,o])},B.translate=function(B,g){this._saveToCmd(E._context._translate,[B,g])},B.save=function(){this._saveToCmd(E._context._save,[])},B.restore=function(){this._saveToCmd(E._context._restore,[])},B.replaceText=function(B){this._repaint();var g=this._cmds;if(g){for(var l=g.length-1;-1<l;l--)if(this._isTextCmd(g[l].callee))return g[l][0].toUpperCase?g[l][0]=B:g[l][0].setText(B),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=B:this._one[0].setText(B),!0;return!1},B._isTextCmd=function(B){return B===E._context._fillText||B===E._context._fillBorderText||B===E._context._strokeText},B.replaceTextColor=function(B){this._repaint();var g=this._cmds;if(g)for(var l=g.length-1;-1<l;l--)this._isTextCmd(g[l].callee)&&(g[l][4]=B,g[l][0].toUpperCase||(g[l][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=B,this._one[0].toUpperCase||(this._one[0].changed=!0))},B.loadImage=function(B,g,l,o,V,U){var y=this;void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0),void 0===V&&(V=0);var G=GB.getRes(B);function d(B){B&&(y.drawTexture(B,g,l,o,V),null!=U&&U.call(y._sp,B))}G?d(G):s.loader.load(B,m.create(null,d),null,"image")},B._renderEmpty=function(B,g,l,o){},B._renderAll=function(B,g,l,o){for(var V,U=this._cmds,y=0,G=U.length;y<G;y++)(V=U[y]).callee.call(g,l,o,V)},B._renderOne=function(B,g,l,o){this._one.callee.call(g,l,o,this._one)},B._renderOneImg=function(B,g,l,o){this._one.callee.call(g,l,o,this._one),2305!==B._renderType&&(B._renderType|=1)},B.drawLine=function(B,g,l,o,V,U){void 0===U&&(U=1);var y=0;E.isWebGL&&(y=u.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(y));var G=U%2==0?0:.5,d=[B+G,g+G,l+G,o+G,V,U,y];this._saveToCmd(E._context._drawLine,d)},B.drawLines=function(B,g,l,o,V){void 0===V&&(V=1);var U=0;if(l&&!(l.length<4)){E.isWebGL&&(U=u.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(U));var y=V%2==0?0:.5,G=[B+y,g+y,l,o,V,U];this._saveToCmd(E._context._drawLines,G)}},B.drawCurves=function(B,g,l,o,V){void 0===V&&(V=1);var U=[B,g,l,o,V];this._saveToCmd(E._context._drawCurves,U)},B.drawRect=function(B,g,l,o,V,U,y){void 0===y&&(y=1);var G=U?y/2:0,d=U?y:0,j=[B+G,g+G,l-d,o-d,V,U,y];this._saveToCmd(E._context._drawRect,j)},B.drawCircle=function(B,g,l,o,V,U){void 0===U&&(U=1);var y=V?U/2:0,G=0;E.isWebGL&&(G=u.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(G));var d=[B,g,l-y,o,V,U,G];this._saveToCmd(E._context._drawCircle,d)},B.drawPie=function(B,g,l,o,V,U,y,G){void 0===G&&(G=1);var d=y?G/2:0,j=y?G:0,A=0;E.isWebGL&&(A=u.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(A));var H=[B+d,g+d,l-j,o,V,U,y,G,A];H[3]=$.toRadian(o),H[4]=$.toRadian(V),this._saveToCmd(E._context._drawPie,H)},B.drawPoly=function(B,g,l,o,V,U){void 0===U&&(U=1);var y=0,G=!1;E.isWebGL&&(y=u.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(y),G=!(6<l.length));var d=V?U%2==0?0:.5:0,j=[B+d,g+d,l,o,V,U,y,G];this._saveToCmd(E._context._drawPoly,j)},B.drawPath=function(B,g,l,o,V){var U=[B,g,l,o,V];this._saveToCmd(E._context._drawPath,U)},A(0,B,"cmds",function(){return this._cmds},function(B){this._sp&&(this._sp._renderType|=512),this._cmds=B,this._render=this._renderAll,this._repaint()}),H.__init__=function(){if(E.isConchNode){for(var B=laya.display.Graphics.prototype,g=Y.window.ConchGraphics.prototype,l=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],o=0,V=l.length;o<=V;o++){var U=l[o];B[U]=g[U]}B._saveToCmd=null,g.drawImageS&&(B.drawTextures=function(B,g){if(B&&B.loaded&&B.bitmap&&B.source){var l=B.uv,o=B.bitmap.width,V=B.bitmap.height;this.drawImageS(B.bitmap.source,l[0]*o,l[1]*V,(l[2]-l[0])*o,(l[5]-l[3])*V,B.offsetX,B.offsetY,B.width,B.height,g)}}),B.drawTexture=function(B,g,l,o,V,U,y){if(void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0),void 0===V&&(V=0),void 0===y&&(y=1),B)if(B.loaded){if(B.loaded&&B.bitmap&&B.source&&(o||(o=B.sourceWidth),V||(V=B.sourceHeight),y=y<0?0:1<y?1:y,o=o-B.sourceWidth+B.width,V=V-B.sourceHeight+B.height,!(o<=0||V<=0))){g+=B.offsetX,l+=B.offsetY;var G=B.uv,d=B.bitmap.width,j=B.bitmap.height;G[4]<G[0]&&G[5]<G[1]?this.drawImageM(B.bitmap.source,G[4]*d,G[5]*j,(G[0]-G[4])*d,(G[1]-G[5])*j,g,l,o,V,U,y):this.drawImageM(B.bitmap.source,G[0]*d,G[1]*j,(G[2]-G[0])*d,(G[5]-G[3])*j,g,l,o,V,U,y),this._repaint()}}else B.once("loaded",this,function(){this.drawTexture(B,g,l,o,V,U)})},B.fillTexture=function(B,g,l,o,V,U,y){if(void 0===o&&(o=0),void 0===V&&(V=0),void 0===U&&(U="repeat"),B&&B.loaded){var G,d=E._context.ctx,j=B.bitmap.width,A=B.bitmap.height,H=B.uv;G=B.uv!=AB.DEF_UV?d.createPattern(B.bitmap.source,U,H[0]*j,H[1]*A,(H[2]-H[0])*j,(H[5]-H[3])*A):d.createPattern(B.bitmap.source,U);var K=0,p=0;y&&(g+=y.x%B.width,l+=y.y%B.height,K-=y.x%B.width,p-=y.y%B.height),this._fillImage(G,g,l,K,p,o,V)}}}},H._cache=[],H}(),l=function(){function M(){this._cacheBoundsType=!1}N(M,"laya.display.GraphicsBounds");var B=M.prototype;return B.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},B.reset=function(){this._temp&&(this._temp.length=0)},B.getBounds=function(B){return void 0===B&&(B=!1),(!this._bounds||!this._temp||this._temp.length<1||B!=this._cacheBoundsType)&&(this._bounds=w._getWrapRec(this.getBoundPoints(B),this._bounds)),this._cacheBoundsType=B,this._bounds},B.getBoundPoints=function(B){return void 0===B&&(B=!1),(!this._temp||this._temp.length<1||B!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(B)),this._cacheBoundsType=B,this._rstBoundPoints=$.copyArray(this._rstBoundPoints,this._temp)},B._getCmdPoints=function(B){void 0===B&&(B=!1);var g,l,o=E._context,V=this._graphics.cmds;if((g=this._temp||(this._temp=[])).length=0,V||null==this._graphics._one||(M._tempCmds.length=0,M._tempCmds.push(this._graphics._one),V=M._tempCmds),!V)return g;(l=M._tempMatrixArrays).length=0;var U=M._initMatrix;U.identity();for(var y,G,d=M._tempMatrix,j=NaN,A=NaN,H=NaN,K=NaN,p=NaN,x=NaN,N=0,F=V.length;N<F;N++)if((y=V[N]).callee)switch(y.callee){case o._save:case 7:l.push(U),U=U.clone();break;case o._restore:case 8:U=l.pop();break;case o._scale:case 5:d.identity(),d.translate(-y[2],-y[3]),d.scale(y[0],y[1]),d.translate(y[2],y[3]),this._switchMatrix(U,d);break;case o._rotate:case 3:d.identity(),d.translate(-y[1],-y[2]),d.rotate(y[0]),d.translate(y[1],y[2]),this._switchMatrix(U,d);break;case o._translate:case 6:d.identity(),d.translate(y[0],y[1]),this._switchMatrix(U,d);break;case o._transform:case 4:d.identity(),d.translate(-y[1],-y[2]),d.concat(y[0]),d.translate(y[1],y[2]),this._switchMatrix(U,d);break;case 16:case 24:M._addPointArrToRst(g,w._getBoundPointS(y[0],y[1],y[2],y[3]),U);break;case 17:U.copyTo(d),d.concat(y[4]),M._addPointArrToRst(g,w._getBoundPointS(y[0],y[1],y[2],y[3]),d);break;case o._drawTexture:G=y[0],B?y[3]&&y[4]?M._addPointArrToRst(g,w._getBoundPointS(y[1],y[2],y[3],y[4]),U):(G=y[0],M._addPointArrToRst(g,w._getBoundPointS(y[1],y[2],G.width,G.height),U)):(j=(y[3]||G.sourceWidth)/G.width,A=(y[4]||G.sourceHeight)/G.height,H=j*G.sourceWidth,K=A*G.sourceHeight,p=0<G.offsetX?G.offsetX:0,x=0<G.offsetY?G.offsetY:0,p*=j,x*=A,M._addPointArrToRst(g,w._getBoundPointS(y[1]-p,y[2]-x,H,K),U));break;case o._fillTexture:y[3]&&y[4]?M._addPointArrToRst(g,w._getBoundPointS(y[1],y[2],y[3],y[4]),U):(G=y[0],M._addPointArrToRst(g,w._getBoundPointS(y[1],y[2],G.width,G.height),U));break;case o._drawTextureWithTransform:var C;C=y[5]?(U.copyTo(d),d.concat(y[5]),d):U,B?y[3]&&y[4]?M._addPointArrToRst(g,w._getBoundPointS(y[1],y[2],y[3],y[4]),C):(G=y[0],M._addPointArrToRst(g,w._getBoundPointS(y[1],y[2],G.width,G.height),C)):(G=y[0],j=(y[3]||G.sourceWidth)/G.width,A=(y[4]||G.sourceHeight)/G.height,H=j*G.sourceWidth,K=A*G.sourceHeight,p=0<G.offsetX?G.offsetX:0,x=0<G.offsetY?G.offsetY:0,p*=j,x*=A,M._addPointArrToRst(g,w._getBoundPointS(y[1]-p,y[2]-x,H,K),C));break;case o._drawRect:case 13:M._addPointArrToRst(g,w._getBoundPointS(y[0],y[1],y[2],y[3]),U);break;case o._drawCircle:case o._fillCircle:case 14:M._addPointArrToRst(g,w._getBoundPointS(y[0]-y[2],y[1]-y[2],y[2]+y[2],y[2]+y[2]),U);break;case o._drawLine:case 20:M._tempPoints.length=0;var m;m=.5*y[5],y[0]==y[2]?M._tempPoints.push(y[0]+m,y[1],y[2]+m,y[3],y[0]-m,y[1],y[2]-m,y[3]):y[1]==y[3]?M._tempPoints.push(y[0],y[1]+m,y[2],y[3]+m,y[0],y[1]-m,y[2],y[3]-m):M._tempPoints.push(y[0],y[1],y[2],y[3]),M._addPointArrToRst(g,M._tempPoints,U);break;case o._drawCurves:case 22:M._addPointArrToRst(g,b.I.getBezierPoints(y[2]),U,y[0],y[1]);break;case o._drawPoly:case o._drawLines:case 18:M._addPointArrToRst(g,y[2],U,y[0],y[1]);break;case o._drawPath:case 19:M._addPointArrToRst(g,this._getPathPoints(y[2]),U,y[0],y[1]);break;case o._drawPie:case 15:M._addPointArrToRst(g,this._getPiePoints(y[0],y[1],y[2],y[3],y[4]),U)}return 200<g.length?g=$.copyArray(g,w._getWrapRec(g)._getBoundPoints()):8<g.length&&(g=D.scanPList(g)),g},B._switchMatrix=function(B,g){g.concat(B),g.copyTo(B)},B._getPiePoints=function(B,g,l,o,V){var U=M._tempPoints;M._tempPoints.length=0,U.push(B,g);var y=(V-o)%(2*Math.PI)/10,G=NaN,d=o;for(G=0;G<=10;G++)U.push(B+l*Math.cos(d),g+l*Math.sin(d)),d+=y;return U},B._getPathPoints=function(B){var g,l,o=0,V=M._tempPoints;for(V.length=0,g=B.length,o=0;o<g;o++)1<(l=B[o]).length&&(V.push(l[1],l[2]),3<l.length&&V.push(l[3],l[4]));return V},M._addPointArrToRst=function(B,g,l,o,V){void 0===o&&(o=0),void 0===V&&(V=0);var U,y=0;for(U=g.length,y=0;y<U;y+=2)M._addPointToRst(B,g[y]+o,g[y+1]+V,l)},M._addPointToRst=function(B,g,l,o){var V=X.TEMP;V.setTo(g||0,l||0),o.transformPoint(V),B.push(V.x,V.y)},M._tempPoints=[],M._tempMatrixArrays=[],M._tempCmds=[],d(M,["_tempMatrix",function(){return this._tempMatrix=new h},"_initMatrix",function(){return this._initMatrix=new h}]),M}(),U=function(){function B(){}N(B,"laya.events.Event");var g=B.prototype;return g.setTo=function(B,g,l){return this.type=B,this.currentTarget=g,this.target=l,this},g.stopPropagation=function(){this._stoped=!0},A(0,g,"stageY",function(){return s.stage.mouseY}),A(0,g,"charCode",function(){return this.nativeEvent.charCode}),A(0,g,"touches",function(){var B=this.nativeEvent.touches;if(B)for(var g=s.stage,l=0,o=B.length;l<o;l++){var V=B[l],U=X.TEMP;U.setTo(V.clientX,V.clientY),g._canvasTransform.invertTransformPoint(U),g.transform.invertTransformPoint(U),V.stageX=U.x,V.stageY=U.y}return B}),A(0,g,"keyLocation",function(){return this.nativeEvent.keyLocation}),A(0,g,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),A(0,g,"altKey",function(){return this.nativeEvent.altKey}),A(0,g,"shiftKey",function(){return this.nativeEvent.shiftKey}),A(0,g,"stageX",function(){return s.stage.mouseX}),B.EMPTY=new B,B.MOUSE_DOWN="mousedown",B.MOUSE_UP="mouseup",B.CLICK="click",B.RIGHT_MOUSE_DOWN="rightmousedown",B.RIGHT_MOUSE_UP="rightmouseup",B.RIGHT_CLICK="rightclick",B.MOUSE_MOVE="mousemove",B.MOUSE_OVER="mouseover",B.MOUSE_OUT="mouseout",B.MOUSE_WHEEL="mousewheel",B.ROLL_OVER="mouseover",B.ROLL_OUT="mouseout",B.DOUBLE_CLICK="doubleclick",B.CHANGE="change",B.CHANGED="changed",B.RESIZE="resize",B.ADDED="added",B.REMOVED="removed",B.DISPLAY="display",B.UNDISPLAY="undisplay",B.ERROR="error",B.COMPLETE="complete",B.LOADED="loaded",B.INITED="inited",B.PROGRESS="progress",B.INPUT="input",B.RENDER="render",B.OPEN="open",B.MESSAGE="message",B.CLOSE="close",B.KEY_DOWN="keydown",B.KEY_PRESS="keypress",B.KEY_UP="keyup",B.FRAME="enterframe",B.DRAG_START="dragstart",B.DRAG_MOVE="dragmove",B.DRAG_END="dragend",B.ENTER="enter",B.SELECT="select",B.BLUR="blur",B.FOCUS="focus",B.VISIBILITY_CHANGE="visibilitychange",B.FOCUS_CHANGE="focuschange",B.PLAYED="played",B.PAUSED="paused",B.STOPPED="stopped",B.START="start",B.END="end",B.ENABLE_CHANGED="enablechanged",B.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",B.COMPONENT_ADDED="componentadded",B.COMPONENT_REMOVED="componentremoved",B.LAYER_CHANGED="layerchanged",B.HIERARCHY_LOADED="hierarchyloaded",B.RECOVERED="recovered",B.RELEASED="released",B.LINK="link",B.LABEL="label",B.FULL_SCREEN_CHANGE="fullscreenchange",B.DEVICE_LOST="devicelost",B.MESH_CHANGED="meshchanged",B.MATERIAL_CHANGED="materialchanged",B.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",B.ANIMATION_CHANGED="animationchanged",B.TRIGGER_ENTER="triggerenter",B.TRIGGER_STAY="triggerstay",B.TRIGGER_EXIT="triggerexit",B.TRAIL_FILTER_CHANGE="trailfilterchange",B.DOMINO_FILTER_CHANGE="dominofilterchange",B}(),H=(function(){function B(){}N(B,"laya.events.Keyboard"),B.NUMBER_0=48,B.NUMBER_1=49,B.NUMBER_2=50,B.NUMBER_3=51,B.NUMBER_4=52,B.NUMBER_5=53,B.NUMBER_6=54,B.NUMBER_7=55,B.NUMBER_8=56,B.NUMBER_9=57,B.A=65,B.B=66,B.C=67,B.D=68,B.E=69,B.F=70,B.G=71,B.H=72,B.I=73,B.J=74,B.K=75,B.L=76,B.M=77,B.N=78,B.O=79,B.P=80,B.Q=81,B.R=82,B.S=83,B.T=84,B.U=85,B.V=86,B.W=87,B.X=88,B.Y=89,B.Z=90,B.F1=112,B.F2=113,B.F3=114,B.F4=115,B.F5=116,B.F6=117,B.F7=118,B.F8=119,B.F9=120,B.F10=121,B.F11=122,B.F12=123,B.F13=124,B.F14=125,B.F15=126,B.NUMPAD=21,B.NUMPAD_0=96,B.NUMPAD_1=97,B.NUMPAD_2=98,B.NUMPAD_3=99,B.NUMPAD_4=100,B.NUMPAD_5=101,B.NUMPAD_6=102,B.NUMPAD_7=103,B.NUMPAD_8=104,B.NUMPAD_9=105,B.NUMPAD_ADD=107,B.NUMPAD_DECIMAL=110,B.NUMPAD_DIVIDE=111,B.NUMPAD_ENTER=108,B.NUMPAD_MULTIPLY=106,B.NUMPAD_SUBTRACT=109,B.SEMICOLON=186,B.EQUAL=187,B.COMMA=188,B.MINUS=189,B.PERIOD=190,B.SLASH=191,B.BACKQUOTE=192,B.LEFTBRACKET=219,B.BACKSLASH=220,B.RIGHTBRACKET=221,B.QUOTE=222,B.ALTERNATE=18,B.BACKSPACE=8,B.CAPS_LOCK=20,B.COMMAND=15,B.CONTROL=17,B.DELETE=46,B.ENTER=13,B.ESCAPE=27,B.PAGE_UP=33,B.PAGE_DOWN=34,B.END=35,B.HOME=36,B.LEFT=37,B.UP=38,B.RIGHT=39,B.DOWN=40,B.SHIFT=16,B.SPACE=32,B.TAB=9,B.INSERT=45}(),function(){function V(){}return N(V,"laya.events.KeyBoardManager"),V.__init__=function(){V._addEvent("keydown"),V._addEvent("keypress"),V._addEvent("keyup")},V._addEvent=function(g){Y.document.addEventListener(g,function(B){laya.events.KeyBoardManager._dispatch(B,g)},!0)},V._dispatch=function(B,g){if(V.enabled){V._event._stoped=!1,V._event.nativeEvent=B,V._event.keyCode=B.keyCode||B.which||B.charCode,"keydown"===g?V._pressKeys[V._event.keyCode]=!0:"keyup"===g&&(V._pressKeys[V._event.keyCode]=null);for(var l=s.stage.focus&&null!=s.stage.focus.event&&s.stage.focus.displayedInStage?s.stage.focus:s.stage,o=l;o;)o.event(g,V._event.setTo(g,o,l)),o=o.parent}},V.hasKeyDown=function(B){return V._pressKeys[B]},V._pressKeys={},V.enabled=!0,d(V,["_event",function(){return this._event=new U}]),V}()),x=(function(){function B(){}N(B,"laya.events.KeyLocation"),B.STANDARD=0,B.LEFT=1,B.RIGHT=2,B.NUM_PAD=3}(),function(){function A(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=Y.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new U,this._matrix=new h,this._point=new X,this._rect=new w,this._prePoint=new X,this._curTouchID=NaN}N(A,"laya.events.MouseManager");var B=A.prototype;return B.__init__=function(B,g){var l=this;this._stage=B;var o=this,V=this._eventList;g.oncontextmenu=function(B){if(A.enabled)return!1},g.addEventListener("mousedown",function(B){A.enabled&&(Y.onIE||B.preventDefault(),V.push(B),o.mouseDownTime=Y.now())}),g.addEventListener("mouseup",function(B){A.enabled&&(B.preventDefault(),V.push(B),o.mouseDownTime=-Y.now())},!0),g.addEventListener("mousemove",function(B){if(A.enabled){B.preventDefault();var g=Y.now();if(g-o._lastMoveTimer<10)return;o._lastMoveTimer=g,V.push(B)}},!0),g.addEventListener("mouseout",function(B){A.enabled&&V.push(B)}),g.addEventListener("mouseover",function(B){A.enabled&&V.push(B)}),g.addEventListener("touchstart",function(B){A.enabled&&(V.push(B),A._isFirstTouch||DB.isInputting||B.preventDefault(),o.mouseDownTime=Y.now())}),g.addEventListener("touchend",function(B){A.enabled?(A._isFirstTouch||DB.isInputting||B.preventDefault(),A._isFirstTouch=!1,V.push(B),o.mouseDownTime=-Y.now()):l._curTouchID=NaN},!0),g.addEventListener("touchmove",function(B){A.enabled&&(B.preventDefault(),V.push(B))},!0),g.addEventListener("touchcancel",function(B){A.enabled?(B.preventDefault(),V.push(B)):l._curTouchID=NaN},!0),g.addEventListener("mousewheel",function(B){A.enabled&&V.push(B)}),g.addEventListener("DOMMouseScroll",function(B){A.enabled&&V.push(B)})},B.initEvent=function(B,g){var l,o=this;o._event._stoped=!1,o._event.nativeEvent=g||B,o._target=null,this._point.setTo(B.pageX||B.clientX,B.pageY||B.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),o.mouseX=this._point.x,o.mouseY=this._point.y,o._event.touchId=B.identifier||0,this._tTouchID=o._event.touchId,(l=F.I._event)._stoped=!1,l.nativeEvent=o._event.nativeEvent,l.touchId=o._event.touchId},B.checkMouseWheel=function(B){this._event.delta=B.wheelDelta?.025*B.wheelDelta:-B.detail;for(var g=F.I.getLastOvers(),l=0,o=g.length;l<o;l++){var V=g[l];V.event("mousewheel",this._event.setTo("mousewheel",V,this._target))}},B.onMouseMove=function(B){F.I.onMouseMove(B,this._tTouchID)},B.onMouseDown=function(B){if(DB.isInputting&&s.stage.focus&&s.stage.focus.focus&&!s.stage.focus.contains(this._target)){var g=s.stage.focus._tf||s.stage.focus,l=B._tf||B;l instanceof laya.display.Input&&l.multiline==g.multiline?g._focusOut():g.focus=!1}F.I.onMouseDown(B,this._tTouchID,this._isLeftMouse)},B.onMouseUp=function(B){F.I.onMouseUp(B,this._tTouchID,this._isLeftMouse)},B.check=function(B,g,l,o){this._point.setTo(g,l),B.fromParentPoint(this._point),g=this._point.x,l=this._point.y;var V=B.scrollRect;if(V&&(this._rect.setTo(V.x,V.y,V.width,V.height),!this._rect.contains(g,l)))return!1;if(!this.disableMouseEvent){if(B.hitTestPrior&&!B.mouseThrough&&!this.hitTest(B,g,l))return!1;for(var U=B._childs.length-1;-1<U;U--){var y=B._childs[U];if(!y.destroyed&&y.mouseEnabled&&y.visible&&this.check(y,g,l,o))return!0}}var G=!(!B.hitTestPrior||B.mouseThrough||this.disableMouseEvent)||this.hitTest(B,g,l);return G?(this._target=B,o.call(this,B)):o===this.onMouseUp&&B===this._stage&&(this._target=this._stage,o.call(this,this._target)),G},B.hitTest=function(B,g,l){var o=!1;if(B.scrollRect&&(g-=B.scrollRect.x,l-=B.scrollRect.y),B.hitArea instanceof laya.utils.HitArea)return B.hitArea.isHit(g,l);if(0<B.width&&0<B.height||B.mouseThrough||B.hitArea)if(B.mouseThrough)o=B.getGraphicBounds().contains(g,l);else{var V=this._rect;B.hitArea?V=B.hitArea:V.setTo(0,0,B.width,B.height),o=V.contains(g,l)}return o},B.runEvent=function(){var B=this._eventList.length;if(B){var g=this;g.mouseEventTime=Y.now();var l,o=0,V=0,U=0;try{for(;o<B;){var y=this._eventList[o];switch("mousemove"!==y.type&&(this._prePoint.x=this._prePoint.y=-1e6),y.type){case"mousedown":this._touchIDs[0]=this._id++,A._isTouchRespond?A._isTouchRespond=!1:(g._isLeftMouse=0===y.button,g.initEvent(y),g.check(g._stage,g.mouseX,g.mouseY,g.onMouseDown));break;case"mouseup":g._isLeftMouse=0===y.button,g.initEvent(y),g.check(g._stage,g.mouseX,g.mouseY,g.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-y.clientX)+Math.abs(this._prePoint.y-y.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=y.clientX,this._prePoint.y=y.clientY,g.initEvent(y),g.check(g._stage,g.mouseX,g.mouseY,g.onMouseMove));break;case"touchstart":A._isTouchRespond=!0,g._isLeftMouse=!0;var G=y.changedTouches;for(V=0,U=G.length;V<U;V++)l=G[V],(A.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=l.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[l.identifier]=this._id++,g.initEvent(l,y),g.check(g._stage,g.mouseX,g.mouseY,g.onMouseDown));break;case"touchend":case"touchcancel":A._isTouchRespond=!0,g._isLeftMouse=!0;var d=y.changedTouches;for(V=0,U=d.length;V<U;V++)if(l=d[V],A.multiTouchEnabled||l.identifier==this._curTouchID){this._curTouchID=NaN,g.initEvent(l,y);g.check(g._stage,g.mouseX,g.mouseY,g.onMouseUp)||g.onMouseUp(null)}break;case"touchmove":var j=y.changedTouches;for(V=0,U=j.length;V<U;V++)l=j[V],(A.multiTouchEnabled||l.identifier==this._curTouchID)&&(g.initEvent(l,y),g.check(g._stage,g.mouseX,g.mouseY,g.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":g.checkMouseWheel(y);break;case"mouseout":F.I.stageMouseOut();break;case"mouseover":g._stage.event("mouseover",g._event.setTo("mouseover",g._stage,g._stage))}o++}}catch(B){throw this._eventList.length=0,B}this._eventList.length=0}},A.enabled=!0,A.multiTouchEnabled=!0,A._isTouchRespond=!1,A._isFirstTouch=!0,d(A,["instance",function(){return this.instance=new A}]),A}()),F=function(){function x(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new U}N(x,"laya.events.TouchManager");var B=x.prototype;return B._clearTempArrs=function(){x._oldArr.length=0,x._newArr.length=0,x._tEleArr.length=0},B.getTouchFromArr=function(B,g){var l,o,V=0;for(l=g.length,V=0;V<l;V++)if((o=g[V]).id==B)return o;return null},B.removeTouchFromArr=function(B,g){var l=0;for(l=g.length-1;0<=l;l--)g[l].id==B&&g.splice(l,1)},B.createTouchO=function(B,g){var l;return(l=L.getItem("TouchData")||{}).id=g,l.tar=B,l},B.onMouseDown=function(B,g,l){var o,V,U,y;(void 0===l&&(l=!1),this.enable)&&(o=this.getTouchFromArr(g,this.preOvers),U=this.getEles(B,null,x._tEleArr),o?o.tar=B:(V=this.createTouchO(B,g),this.preOvers.push(V)),Y.onMobile&&this.sendEvents(U,"mouseover",g),y=l?this.preDowns:this.preRightDowns,(o=this.getTouchFromArr(g,y))?o.tar=B:(V=this.createTouchO(B,g),y.push(V)),this.sendEvents(U,l?"mousedown":"rightmousedown",g),this._clearTempArrs())},B.sendEvents=function(B,g,l){void 0===l&&(l=0);var o,V,U,y=0;for(o=B.length,this._event._stoped=!1,V=B[0],y=0;y<o;y++){if((U=B[y]).destroyed)return;if(U.event(g,this._event.setTo(g,U,V)),this._event._stoped)break}},B.getEles=function(B,g,l){for(l?l.length=0:l=[];B&&B!=g;)l.push(B),B=B.parent;return l},B.checkMouseOutAndOverOfMove=function(B,g,l){if(void 0===l&&(l=0),g!=B){var o,V,U=0,y=0;if(g.contains(B))V=this.getEles(B,g,x._tEleArr),this.sendEvents(V,"mouseover",l);else if(B.contains(g))V=this.getEles(g,B,x._tEleArr),this.sendEvents(V,"mouseout",l);else{var G,d;(V=x._tEleArr).length=0,G=this.getEles(g,null,x._oldArr),d=this.getEles(B,null,x._newArr),y=G.length;var j=0;for(U=0;U<y;U++){if(o=G[U],0<=(j=d.indexOf(o))){d.splice(j,d.length-j);break}V.push(o)}0<V.length&&this.sendEvents(V,"mouseout",l),0<d.length&&this.sendEvents(d,"mouseover",l)}}},B.onMouseMove=function(B,g){var l,o;this.enable&&((l=this.getTouchFromArr(g,this.preOvers))?(this.checkMouseOutAndOverOfMove(B,l.tar),l.tar=B,o=this.getEles(B,null,x._tEleArr)):(o=this.getEles(B,null,x._tEleArr),this.sendEvents(o,"mouseover",g),this.preOvers.push(this.createTouchO(B,g))),this.sendEvents(o,"mousemove",g),this._clearTempArrs())},B.getLastOvers=function(){return(x._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,x._tEleArr):(x._tEleArr.push(s.stage),x._tEleArr)},B.stageMouseOut=function(){var B;B=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(B,"mouseout",0)},B.onMouseUp=function(B,g,l){if(void 0===l&&(l=!1),this.enable){var o,V,U,y,G,d,j=0,A=0,H=Y.onMobile;if(V=this.getEles(B,null,x._tEleArr),this.sendEvents(V,l?"mouseup":"rightmouseup",g),d=l?this.preDowns:this.preRightDowns,o=this.getTouchFromArr(g,d)){var K,p=Y.now();if(K=p-this._lastClickTime<300,this._lastClickTime=p,B==o.tar)G=V;else for(U=this.getEles(o.tar,null,x._oldArr),(G=x._newArr).length=0,A=U.length,j=0;j<A;j++)y=U[j],0<=V.indexOf(y)&&G.push(y);0<G.length&&this.sendEvents(G,l?"click":"rightclick",g),l&&K&&this.sendEvents(G,"doubleclick",g),this.removeTouchFromArr(g,d),o.tar=null,L.recover("TouchData",o)}else;(o=this.getTouchFromArr(g,this.preOvers))&&H&&((G=this.getEles(o.tar,null,G))&&0<G.length&&this.sendEvents(G,"mouseout",g),this.removeTouchFromArr(g,this.preOvers),o.tar=null,L.recover("TouchData",o)),this._clearTempArrs()}},x._oldArr=[],x._newArr=[],x._tEleArr=[],d(x,["I",function(){return this.I=new x}]),x}(),C=function(){function B(){this._action=null}N(B,"laya.filters.Filter");var g=B.prototype;return s.imps(g,{"laya.filters.IFilter":!0}),g.callNative=function(B){},A(0,g,"type",function(){return-1}),A(0,g,"action",function(){return this._action}),B.BLUR=16,B.COLOR=32,B.GLOW=8,B._filterStart=null,B._filterEnd=null,B._EndTarget=null,B._recycleScope=null,B._filter=null,B._useSrc=null,B._endSrc=null,B._useOut=null,B._endOut=null,B}(),M=function(){function B(){this.data=null}N(B,"laya.filters.ColorFilterAction");var g=B.prototype;return s.imps(g,{"laya.filters.IFilterAction":!0}),g.apply=function(B){var g=B.ctx.ctx,l=B.ctx.ctx.canvas;if(0==l.width||0==l.height)return l;for(var o,V=g.getImageData(0,0,l.width,l.height),U=V.data,y=0,G=U.length;y<G;y+=4)o=this.getColor(U[y],U[y+1],U[y+2],U[y+3]),0!=U[y+3]&&(U[y]=o[0],U[y+1]=o[1],U[y+2]=o[2],U[y+3]=o[3]);return g.putImageData(V,0,0),B},g.getColor=function(B,g,l,o){var V=[];if(this.data._mat&&this.data._alpha){var U=this.data._mat,y=this.data._alpha;V[0]=U[0]*B+U[1]*g+U[2]*l+U[3]*o+y[0],V[1]=U[4]*B+U[5]*g+U[6]*l+U[7]*o+y[1],V[2]=U[8]*B+U[9]*g+U[10]*l+U[11]*o+y[2],V[3]=U[12]*B+U[13]*g+U[14]*l+U[15]*o+y[3]}return V},B}(),b=(function(){function B(){}N(B,"laya.maths.Arith"),B.formatR=function(B){return B>Math.PI&&(B-=2*Math.PI),B<-Math.PI&&(B+=2*Math.PI),B},B.isPOT=function(B,g){return 0<B&&0==(B&B-1)&&0<g&&0==(g&g-1)},B.setMatToArray=function(B,g){B.a,B.b,B.c,B.d,B.tx,B.ty,g[0]=B.a,g[1]=B.b,g[4]=B.c,g[5]=B.d,g[12]=B.tx,g[13]=B.ty}}(),function(){function B(){this._controlPoints=[new X,new X,new X],this._calFun=this.getPoint2}N(B,"laya.maths.Bezier");var g=B.prototype;return g._switchPoint=function(B,g){var l=this._controlPoints.shift();l.setTo(B,g),this._controlPoints.push(l)},g.getPoint2=function(B,g){var l=this._controlPoints[0],o=this._controlPoints[1],V=this._controlPoints[2],U=Math.pow(1-B,2)*l.x+2*B*(1-B)*o.x+Math.pow(B,2)*V.x,y=Math.pow(1-B,2)*l.y+2*B*(1-B)*o.y+Math.pow(B,2)*V.y;g.push(U,y)},g.getPoint3=function(B,g){var l=this._controlPoints[0],o=this._controlPoints[1],V=this._controlPoints[2],U=this._controlPoints[3],y=Math.pow(1-B,3)*l.x+3*o.x*B*(1-B)*(1-B)+3*V.x*B*B*(1-B)+U.x*Math.pow(B,3),G=Math.pow(1-B,3)*l.y+3*o.y*B*(1-B)*(1-B)+3*V.y*B*B*(1-B)+U.y*Math.pow(B,3);g.push(y,G)},g.insertPoints=function(B,g){var l,o=NaN;for(l=1/(B=0<B?B:5),o=0;o<=1;o+=l)this._calFun(o,g)},g.getBezierPoints=function(B,g,l){void 0===g&&(g=5),void 0===l&&(l=2);var o,V,U=0;if((o=B.length)<2*(l+1))return[];switch(V=[],l){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=l;)this._controlPoints.push(new X);for(U=0;U<2*l;U+=2)this._switchPoint(B[U],B[U+1]);for(U=2*l;U<o;U+=2)this._switchPoint(B[U],B[U+1]),U/2%l==0&&this.insertPoints(g,V);return V},d(B,["I",function(){return this.I=new B}]),B}()),D=function(){function j(){}return N(j,"laya.maths.GrahamScan"),j.multiply=function(B,g,l){return(B.x-l.x)*(g.y-l.y)-(g.x-l.x)*(B.y-l.y)},j.dis=function(B,g){return(B.x-g.x)*(B.x-g.x)+(B.y-g.y)*(B.y-g.y)},j._getPoints=function(B,g,l){for(void 0===g&&(g=!1),j._mPointList||(j._mPointList=[]);j._mPointList.length<B;)j._mPointList.push(new X);return l||(l=[]),l.length=0,g?j.getFrom(l,j._mPointList,B):j.getFromR(l,j._mPointList,B),l},j.getFrom=function(B,g,l){var o=0;for(o=0;o<l;o++)B.push(g[o]);return B},j.getFromR=function(B,g,l){var o=0;for(o=0;o<l;o++)B.push(g.pop());return B},j.pListToPointList=function(B,g){void 0===g&&(g=!1);var l=0,o=B.length/2,V=j._getPoints(o,g,j._tempPointList);for(l=0;l<o;l++)V[l].setTo(B[l+l],B[l+l+1]);return V},j.pointListToPlist=function(B){var g,l=0,o=B.length,V=j._temPList;for(l=V.length=0;l<o;l++)g=B[l],V.push(g.x,g.y);return V},j.scanPList=function(B){return $.copyArray(B,j.pointListToPlist(j.scan(j.pListToPointList(B,!0))))},j.scan=function(B){var g,l,o,V=0,U=0,y=0,G=B.length,d={};for((l=j._temArr).length=0,V=(G=B.length)-1;0<=V;V--)o=(g=B[V]).x+"_"+g.y,d.hasOwnProperty(o)||(d[o]=!0,l.push(g));for(G=l.length,$.copyArray(B,l),V=1;V<G;V++)(B[V].y<B[y].y||B[V].y==B[y].y&&B[V].x<B[y].x)&&(y=V);for(g=B[0],B[0]=B[y],B[y]=g,V=1;V<G-1;V++){for(U=(y=V)+1;U<G;U++)(0<j.multiply(B[U],B[y],B[0])||0==j.multiply(B[U],B[y],B[0])&&j.dis(B[0],B[U])<j.dis(B[0],B[y]))&&(y=U);g=B[V],B[V]=B[y],B[y]=g}if((l=j._temArr).length=0,B.length<3)return $.copyArray(l,B);for(l.push(B[0],B[1],B[2]),V=3;V<G;V++){for(;2<=l.length&&0<=j.multiply(B[V],l[l.length-1],l[l.length-2]);)l.pop();B[V]&&l.push(B[V])}return l},j._mPointList=null,j._tempPointList=[],j._temPList=[],j._temArr=[],j}(),v=function(){function V(){}return N(V,"laya.maths.MathUtil"),V.subtractVector3=function(B,g,l){l[0]=B[0]-g[0],l[1]=B[1]-g[1],l[2]=B[2]-g[2]},V.lerp=function(B,g,l){return B*(1-l)+g*l},V.scaleVector3=function(B,g,l){l[0]=B[0]*g,l[1]=B[1]*g,l[2]=B[2]*g},V.lerpVector3=function(B,g,l,o){var V=B[0],U=B[1],y=B[2];o[0]=V+l*(g[0]-V),o[1]=U+l*(g[1]-U),o[2]=y+l*(g[2]-y)},V.lerpVector4=function(B,g,l,o){var V=B[0],U=B[1],y=B[2],G=B[3];o[0]=V+l*(g[0]-V),o[1]=U+l*(g[1]-U),o[2]=y+l*(g[2]-y),o[3]=G+l*(g[3]-G)},V.slerpQuaternionArray=function(B,g,l,o,V,U,y){var G,d,j,A,H,K=B[g+0],p=B[g+1],x=B[g+2],N=B[g+3],F=l[o+0],C=l[o+1],m=l[o+2],M=l[o+3];return(d=K*F+p*C+x*m+N*M)<0&&(d=-d,F=-F,C=-C,m=-m,M=-M),H=1e-6<1-d?(G=Math.acos(d),j=Math.sin(G),A=Math.sin((1-V)*G)/j,Math.sin(V*G)/j):(A=1-V,V),U[y+0]=A*K+H*F,U[y+1]=A*p+H*C,U[y+2]=A*x+H*m,U[y+3]=A*N+H*M,U},V.getRotation=function(B,g,l,o){return Math.atan2(o-g,l-B)/Math.PI*180},V.sortBigFirst=function(B,g){return B==g?0:B<g?1:-1},V.sortSmallFirst=function(B,g){return B==g?0:B<g?-1:1},V.sortNumBigFirst=function(B,g){return parseFloat(g)-parseFloat(B)},V.sortNumSmallFirst=function(B,g){return parseFloat(B)-parseFloat(g)},V.sortByKey=function(l,B,g){var o;return void 0===B&&(B=!1),void 0===g&&(g=!0),o=B?g?V.sortNumBigFirst:V.sortBigFirst:g?V.sortNumSmallFirst:V.sortSmallFirst,function(B,g){return o(B[l],g[l])}},V}(),h=function(){function l(B,g,l,o,V,U){this.inPool=!1,this.bTransform=!1,void 0===B&&(B=1),void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=1),void 0===V&&(V=0),void 0===U&&(U=0),this.a=B,this.b=g,this.c=l,this.d=o,this.tx=V,this.ty=U,this._checkTransform()}N(l,"laya.maths.Matrix");var B=l.prototype;return B.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},B._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},B.setTranslate=function(B,g){return this.tx=B,this.ty=g,this},B.translate=function(B,g){return this.tx+=B,this.ty+=g,this},B.scale=function(B,g){this.a*=B,this.d*=g,this.c*=B,this.b*=g,this.tx*=B,this.ty*=g,this.bTransform=!0},B.rotate=function(B){var g=Math.cos(B),l=Math.sin(B),o=this.a,V=this.c,U=this.tx;this.a=o*g-this.b*l,this.b=o*l+this.b*g,this.c=V*g-this.d*l,this.d=V*l+this.d*g,this.tx=U*g-this.ty*l,this.ty=U*l+this.ty*g,this.bTransform=!0},B.skew=function(B,g){var l=Math.tan(B),o=Math.tan(g),V=this.a,U=this.b;return this.a+=o*this.c,this.b+=o*this.d,this.c+=l*V,this.d+=l*U,this},B.invertTransformPoint=function(B){var g=this.a,l=this.b,o=this.c,V=this.d,U=this.tx,y=g*V-l*o,G=V/y,d=-l/y,j=-o/y,A=g/y,H=(o*this.ty-V*U)/y,K=-(g*this.ty-l*U)/y;return B.setTo(G*B.x+j*B.y+H,d*B.x+A*B.y+K)},B.transformPoint=function(B){return B.setTo(this.a*B.x+this.c*B.y+this.tx,this.b*B.x+this.d*B.y+this.ty)},B.transformPointN=function(B){return B.setTo(this.a*B.x+this.c*B.y,this.b*B.x+this.d*B.y)},B.transformPointArray=function(B,g){for(var l=B.length,o=0;o<l;o+=2){var V=B[o],U=B[o+1];g[o]=this.a*V+this.c*U+this.tx,g[o+1]=this.b*V+this.d*U+this.ty}return g},B.transformPointArrayScale=function(B,g){for(var l=B.length,o=0;o<l;o+=2){var V=B[o],U=B[o+1];g[o]=this.a*V+this.c*U,g[o+1]=this.b*V+this.d*U}return g},B.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},B.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},B.invert=function(){var B=this.a,g=this.b,l=this.c,o=this.d,V=this.tx,U=B*o-g*l;return this.a=o/U,this.b=-g/U,this.c=-l/U,this.d=B/U,this.tx=(l*this.ty-o*V)/U,this.ty=-(B*this.ty-g*V)/U,this},B.setTo=function(B,g,l,o,V,U){return this.a=B,this.b=g,this.c=l,this.d=o,this.tx=V,this.ty=U,this},B.concat=function(B){var g=this.a,l=this.c,o=this.tx;return this.a=g*B.a+this.b*B.c,this.b=g*B.b+this.b*B.d,this.c=l*B.a+this.d*B.c,this.d=l*B.b+this.d*B.d,this.tx=o*B.a+this.ty*B.c+B.tx,this.ty=o*B.b+this.ty*B.d+B.ty,this},B.scaleEx=function(B,g){var l=this.a,o=this.b,V=this.c,U=this.d;0!==o||0!==V?(this.a=B*l,this.b=B*o,this.c=g*V):(this.a=B*l,this.b=0*U,this.c=0*l),this.d=g*U,this.bTransform=!0},B.rotateEx=function(B){var g=Math.cos(B),l=Math.sin(B),o=this.a,V=this.b,U=this.c,y=this.d;0!==V||0!==U?(this.a=g*o+l*U,this.b=g*V+l*y,this.c=-l*o+g*U,this.d=-l*V+g*y):(this.a=g*o,this.b=l*y,this.c=-l*o,this.d=g*y),this.bTransform=!0},B.clone=function(){var B=l.create();return B.a=this.a,B.b=this.b,B.c=this.c,B.d=this.d,B.tx=this.tx,B.ty=this.ty,B.bTransform=this.bTransform,B},B.copyTo=function(B){return B.a=this.a,B.b=this.b,B.c=this.c,B.d=this.d,B.tx=this.tx,B.ty=this.ty,B.bTransform=this.bTransform,B},B.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},B.destroy=function(){if(!this.inPool){var B=l._cache;this.inPool=!0,B._length||(B._length=0),(B[B._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},l.mul=function(B,g,l){var o=B.a,V=B.b,U=B.c,y=B.d,G=B.tx,d=B.ty,j=g.a,A=g.b,H=g.c,K=g.d,p=g.tx,x=g.ty;return 0!==A||0!==H?(l.a=o*j+V*H,l.b=o*A+V*K,l.c=U*j+y*H,l.d=U*A+y*K,l.tx=j*G+H*d+p,l.ty=A*G+K*d+x):(l.a=o*j,l.b=V*K,l.c=U*j,l.d=y*K,l.tx=j*G+p,l.ty=K*d+x),l},l.mul16=function(B,g,l){var o=B.a,V=B.b,U=B.c,y=B.d,G=B.tx,d=B.ty,j=g.a,A=g.b,H=g.c,K=g.d,p=g.tx,x=g.ty;return 0!==A||0!==H?(l[0]=o*j+V*H,l[1]=o*A+V*K,l[4]=U*j+y*H,l[5]=U*A+y*K,l[12]=j*G+H*d+p,l[13]=A*G+K*d+x):(l[0]=o*j,l[1]=V*K,l[4]=U*j,l[5]=y*K,l[12]=j*G+p,l[13]=K*d+x),l},l.mulPre=function(B,g,l,o,V,U,y,G){var d=B.a,j=B.b,A=B.c,H=B.d,K=B.tx,p=B.ty;return 0!==l||0!==o?(G.a=d*g+j*o,G.b=d*l+j*V,G.c=A*g+H*o,G.d=A*l+H*V,G.tx=g*K+o*p+U,G.ty=l*K+V*p+y):(G.a=d*g,G.b=j*V,G.c=A*g,G.d=H*V,G.tx=g*K+U,G.ty=V*p+y),G},l.mulPos=function(B,g,l,o,V,U,y,G){var d=B.a,j=B.b,A=B.c,H=B.d,K=B.tx,p=B.ty;return 0!==j||0!==A?(G.a=g*d+l*A,G.b=g*j+l*H,G.c=o*d+V*A,G.d=o*j+V*H,G.tx=d*U+A*y+K,G.ty=j*U+H*y+p):(G.a=g*d,G.b=l*H,G.c=o*d,G.d=V*H,G.tx=d*U+K,G.ty=H*y+p),G},l.preMul=function(B,g,l){var o=B.a,V=B.b,U=B.c,y=B.d,G=g.a,d=g.b,j=g.c,A=g.d,H=g.tx,K=g.ty;return l.a=G*o,l.b=l.c=0,l.d=A*y,l.tx=H*o+B.tx,l.ty=K*y+B.ty,0===d&&0===j&&0===V&&0===U||(l.a+=d*U,l.d+=j*V,l.b+=G*V+d*y,l.c+=j*o+A*U,l.tx+=K*U,l.ty+=H*V),l},l.preMulXY=function(B,g,l,o){var V=B.a,U=B.b,y=B.c,G=B.d;return o.a=V,o.b=U,o.c=y,o.d=G,o.tx=g*V+B.tx+l*y,o.ty=l*G+B.ty+g*U,o},l.create=function(){var B=l._cache,g=B._length?B[--B._length]:new l;return g.inPool=!1,g},l.EMPTY=new l,l.TEMP=new l,l._cache=[],l}(),X=function(){function B(B,g){void 0===B&&(B=0),void 0===g&&(g=0),this.x=B,this.y=g}N(B,"laya.maths.Point");var g=B.prototype;return g.setTo=function(B,g){return this.x=B,this.y=g,this},g.distance=function(B,g){return Math.sqrt((this.x-B)*(this.x-B)+(this.y-g)*(this.y-g))},g.toString=function(){return this.x+","+this.y},g.normalize=function(){var B=Math.sqrt(this.x*this.x+this.y*this.y);if(0<B){var g=1/B;this.x*=g,this.y*=g}},B.TEMP=new B,B.EMPTY=new B,B}(),w=function(){function j(B,g,l,o){void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0),this.x=B,this.y=g,this.width=l,this.height=o}N(j,"laya.maths.Rectangle");var B=j.prototype;return B.setTo=function(B,g,l,o){return this.x=B,this.y=g,this.width=l,this.height=o,this},B.copyFrom=function(B){return this.x=B.x,this.y=B.y,this.width=B.width,this.height=B.height,this},B.contains=function(B,g){return!(this.width<=0||this.height<=0)&&(B>=this.x&&B<this.right&&g>=this.y&&g<this.bottom)},B.intersects=function(B){return!(B.x>this.x+this.width||B.x+B.width<this.x||B.y>this.y+this.height||B.y+B.height<this.y)},B.intersection=function(B,g){return this.intersects(B)?(g||(g=new j),g.x=Math.max(this.x,B.x),g.y=Math.max(this.y,B.y),g.width=Math.min(this.right,B.right)-g.x,g.height=Math.min(this.bottom,B.bottom)-g.y,g):null},B.union=function(B,g){return g||(g=new j),this.clone(g),B.width<=0||B.height<=0?g:(g.addPoint(B.x,B.y),g.addPoint(B.right,B.bottom),this)},B.clone=function(B){return B||(B=new j),B.x=this.x,B.y=this.y,B.width=this.width,B.height=this.height,B},B.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},B.equals=function(B){return!(!B||B.x!==this.x||B.y!==this.y||B.width!==this.width||B.height!==this.height)},B.addPoint=function(B,g){return this.x>B&&(this.width+=this.x-B,this.x=B),this.y>g&&(this.height+=this.y-g,this.y=g),this.width<B-this.x&&(this.width=B-this.x),this.height<g-this.y&&(this.height=g-this.y),this},B._getBoundPoints=function(){var B=j._temB;return(B.length=0)==this.width||0==this.height||B.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),B},B.isEmpty=function(){return this.width<=0||this.height<=0},A(0,B,"right",function(){return this.x+this.width}),A(0,B,"bottom",function(){return this.y+this.height}),j._getBoundPointS=function(B,g,l,o){var V=j._temA;return(V.length=0)==l||0==o||V.push(B,g,B+l,g,B,g+o,B+l,g+o),V},j._getWrapRec=function(B,g){if(!B||B.length<1)return g?g.setTo(0,0,0,0):j.TEMP.setTo(0,0,0,0);g=g||new j;var l,o,V,U,y,G=B.length,d=X.TEMP;for(V=y=-(o=U=99999),l=0;l<G;l+=2)d.x=B[l],d.y=B[l+1],o=o<d.x?o:d.x,U=U<d.y?U:d.y,V=V>d.x?V:d.x,y=y>d.y?y:d.y;return g.setTo(o,U,V-o,y-U)},j.EMPTY=new j,j.TEMP=new j,j._temB=[],j._temA=[],j}(),z=function(){function d(){}return N(d,"laya.media.SoundManager"),A(1,d,"useAudioMusic",function(){return d._useAudioMusic},function(B){d._useAudioMusic=B,d._musicClass=B?lB:null}),A(1,d,"autoStopMusic",function(){return d._autoStopMusic},function(B){s.stage.off("blur",null,d._stageOnBlur),s.stage.off("focus",null,d._stageOnFocus),s.stage.off("visibilitychange",null,d._visibilityChange),(d._autoStopMusic=B)&&(s.stage.on("blur",null,d._stageOnBlur),s.stage.on("focus",null,d._stageOnFocus),s.stage.on("visibilitychange",null,d._visibilityChange))}),A(1,d,"muted",function(){return d._muted},function(B){B!=d._muted&&(B&&d.stopAllSound(),d.musicMuted=B,d._muted=B)}),A(1,d,"musicMuted",function(){return d._musicMuted},function(B){B!=d._musicMuted&&(B?(d._tMusic&&d._musicChannel&&!d._musicChannel.isStopped?d._musicChannel.pause():d._musicChannel=null,d._musicMuted=B):(d._musicMuted=B,d._tMusic&&d._musicChannel&&d._musicChannel.resume()))}),A(1,d,"soundMuted",function(){return d._soundMuted},function(B){d._soundMuted=B}),d.addChannel=function(B){0<=d._channels.indexOf(B)||(d._channels.push(B),d.autoReleaseSound&&0!=d._notUsedCount&&d._notUsedUrls[B.url]&&(delete d._notUsedUrls[B.url],0==--d._notUsedCount&&s.timer.clear(d,d.disposeSoundIfNotUsed)))},d.removeChannel=function(B){var g=d._channels,l=g.indexOf(B);if(-1!=l&&(g.splice(l,1),d.autoReleaseSound)){var o=B.url,V=d.defaultIntervals[o]||2e4;if(0<V){var U=!0;for(l=g.length-1;0<=l;l--)if(g[l].url==o){U=!1;break}U&&(d._notUsedUrls[o]=Date.now()+V,0==d._notUsedCount++&&s.timer.loop(1e4,d,d.disposeSoundIfNotUsed))}}},d.disposeSoundIfNotUsed=function(){var B=d._notUsedUrls;if(0!=d._notUsedCount){var g=Date.now();for(var l in B)g>=B[l]&&(delete B[l],--d._notUsedCount,d.destroySound(l));if(0!=d._notUsedCount)return}s.timer.clear(d,d.disposeSoundIfNotUsed)},d._visibilityChange=function(){s.stage.isVisibility?d._stageOnFocus():d._stageOnBlur()},d._stageOnBlur=function(){d._isActive=!1,d._musicChannel&&(d._musicChannel.isStopped||(d._blurPaused=!0,d._musicChannel.pause())),d.stopAllSound(),s.stage.once("mousedown",null,d._stageOnFocus)},d._recoverWebAudio=function(){UB.ctx&&"running"!=UB.ctx.state&&UB.ctx.resume&&UB.ctx.resume()},d._stageOnFocus=function(){if(d._isActive=!0,d._recoverWebAudio(),s.stage.off("mousedown",null,d._stageOnFocus),d._blurPaused){var B=d._musicChannel;B&&d._music&&B.isStopped&&(d._blurPaused=!1,d._music._disposed?d.playMusic(B.url,B.loops,B.startHandler,B.completeHandler,B.startTime):B.audioBuffer?B.resume():d._music.play(B.startTime,B.loops,B.startHandler,B))}},d.playSound=function(B,g,l,o,V,U){if(void 0===g&&(g=1),void 0===U&&(U=0),!B)return null;if(d._muted)return null;if(d._recoverWebAudio(),B==d._tMusic){if(d._musicMuted)return null}else{if(!d._isActive)return null;if(d._soundMuted)return null}var y,G=d._pool[B];return V||(V=d._soundClass),G||((G=new V).load(B),d._pool[B]=G),(y=G.play(U,g,l))?(B==d._tMusic&&(d._music=G,d._isActive||(d._blurPaused=!0,y.pause())),y.url=B,y.volume=B==d._tMusic?d.musicVolume:d.soundVolume,y.completeHandler=o,y):null},d.destroySound=function(B){var g=d._pool[B];g&&(delete d._pool[B],g.dispose())},d.playMusic=function(B,g,l,o,V){return void 0===g&&(g=0),void 0===V&&(V=0),d._tMusic=B,d._musicChannel&&d._musicChannel.stop(),d._musicChannel=d.playSound(B,g,l,o,null,V)},d.stopSound=function(B){for(var g,l=d._channels.length-1;0<=l;l--)(g=d._channels[l]).url==B&&g.stop()},d.stopAll=function(){d._tMusic=null;var B=0;for(B=d._channels.length-1;0<=B;B--)d._channels[B].stop()},d.stopAllSound=function(){var B,g=0;for(g=d._channels.length-1;0<=g;g--)(B=d._channels[g]).url!=d._tMusic&&B.stop()},d.stopMusic=function(){d._musicChannel&&d._musicChannel.stop(),d._tMusic=null},d.setSoundVolume=function(B,g){if(g)d._setVolume(g,B);else{d.soundVolume=B;var l,o=0;for(o=d._channels.length-1;0<=o;o--)(l=d._channels[o]).url!=d._tMusic&&(l.volume=B)}},d.setMusicVolume=function(B){d.musicVolume=B,d._setVolume(d._tMusic,B)},d._setVolume=function(B,g){for(var l,o=d._channels.length-1;0<=o;o--)(l=d._channels[o]).url==B&&(l.volume=g)},d.musicVolume=1,d.soundVolume=1,d.playbackRate=1,d._useAudioMusic=!0,d._muted=!1,d._soundMuted=!1,d._musicMuted=!1,d._tMusic=null,d._musicChannel=null,d._music=null,d._channels=[],d._autoStopMusic=!1,d._blurPaused=!1,d._isActive=!0,d._soundClass=null,d._musicClass=null,d.autoReleaseSound=!0,d._pool={},d.defaultIntervals={},d._notUsedUrls={},d._notUsedCount=0,d}(),i=function(){var B;function l(){}return N(l,"laya.net.LocalStorage"),l.__init__=function(){l._baseClass||(l._baseClass=B).init(),l.items=l._baseClass.items,l.support=l._baseClass.support},l.setItem=function(B,g){l._baseClass.setItem(B,g)},l.getItem=function(B){return l._baseClass.getItem(B)},l.setJSON=function(B,g){l._baseClass.setJSON(B,g)},l.getJSON=function(B){return l._baseClass.getJSON(B)},l.removeItem=function(B){l._baseClass.removeItem(B)},l.clear=function(){l._baseClass.clear()},l._baseClass=null,l.items=null,l.support=!1,l.__init$=function(){B=function(){function l(){}return N(l,""),l.init=function(){try{l.support=!0,l.items=y.localStorage,l.setItem("laya","1"),l.removeItem("laya")}catch(B){l.support=!1}l.support||console.log("LocalStorage is not supprot or browser is private mode.")},l.setItem=function(B,g){try{l.support&&l.items.setItem(B,g)}catch(B){console.warn("set localStorage failed",B)}},l.getItem=function(B){return l.support?l.items.getItem(B):null},l.setJSON=function(B,g){try{l.support&&l.items.setItem(B,JSON.stringify(g))}catch(B){console.warn("set localStorage failed",B)}},l.getJSON=function(B){return JSON.parse(l.support?l.items.getItem(B):null)},l.removeItem=function(B){l.support&&l.items.removeItem(B)},l.clear=function(){l.support&&l.items.clear()},l.items=null,l.support=!1,l}()},l}(),f=(function(){function o(){}N(o,"laya.net.ResourceVersion"),o.enable=function(B,g,l){void 0===l&&(l=2),laya.net.ResourceVersion.type=l,s.loader.load(B,m.create(null,o.onManifestLoaded,[g]),null,"json"),S.customFormat=o.addVersionPrefix},o.onManifestLoaded=function(B,g){o.manifest=g,B.run(),g||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},o.addVersionPrefix=function(B){return o.manifest&&o.manifest[B]?2==o.type?o.manifest[B]:o.manifest[B]+"/"+B:B},o.FOLDER_VERSION=1,o.FILENAME_VERSION=2,o.manifest=null,o.type=1}(),function(){function B(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}N(B,"laya.net.TTFLoader");var g=B.prototype;return g.load=function(B){var g=(this._url=B).split(".ttf")[0].split("/");this.fontName=g[g.length-1],Y.window.conch?this._loadConch():Y.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},g._loadConch=function(){this._http=new yB,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},g._onHttpLoaded=function(B){Y.window.conch.setFontFaceFromBuffer(this.fontName,B),this._clearHttp(),this._complete()},g._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},g._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},g._complete=function(){s.timer.clear(this,this._complete),s.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},g._checkComplete=function(){t.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},g._loadWithFontFace=function(){var B=new Y.window.FontFace(this.fontName,"url('"+this._url+"')");Y.window.document.fonts.add(B);var g=this;B.loaded.then(function(){g._complete()}),B.load()},g._createDiv=function(){this._div=Y.createElement("div"),this._div.innerHTML="laya";var B=this._div.style;B.fontFamily=this.fontName,B.position="absolute",B.left="-100px",B.top="-100px",Y.document.body.appendChild(this._div)},g._loadWithCSS=function(){var B=this,g=Y.createElement("style");g.type="text/css",Y.document.body.appendChild(g),g.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=t.measureText("LayaTTFFont",this._fontTxt).width;var l=this;g.onload=function(){s.timer.once(1e4,l,B._complete)},s.timer.loop(20,this,this._checkComplete),this._createDiv()},B._testString="LayaTTFFont",B}()),S=function(){function o(B){this._url=null,this._path=null,this._url=o.formatURL(B),this._path=o.getPath(B)}N(o,"laya.net.URL");var B=o.prototype;return A(0,B,"path",function(){return this._path}),A(0,B,"url",function(){return this._url}),o.formatURL=function(B,g){if(!B)return"null path";if(0<B.indexOf(":"))return B;null!=o.customFormat&&(B=o.customFormat(B,g));var l=B.charAt(0);if("."===l)return o.formatRelativePath((g||o.basePath)+B);if("~"===l)return o.rootPath+B.substring(1);if("d"===l){if(0===B.indexOf("data:image"))return B}else if("/"===l)return B;return(g||o.basePath)+B},o.formatRelativePath=function(B){for(var g=B.split("/"),l=0,o=g.length;l<o;l++)".."==g[l]&&(g.splice(l-1,2),l-=2);return g.join("/")},o.isAbsolute=function(B){return 0<B.indexOf(":")||"/"==B.charAt(0)},o.getPath=function(B){var g=B.lastIndexOf("/");return 0<g?B.substr(0,g+1):""},o.getFileName=function(B){var g=B.lastIndexOf("/");return 0<g?B.substr(g+1):B},o.version={},o.basePath="",o.rootPath="",o.customFormat=function(B){var g=o.version[B];return!E.isConchApp&&g&&(B+="?v="+g),B},o}(),E=function(){function V(B,g){this._timeId=0;var l=V._mainCanvas.source.style;l.position="absolute",l.top=l.left="0px",l.background="#000000",V._mainCanvas.source.id="layaCanvas";var o=laya.renders.Render.isWebGL;V._mainCanvas.source.width=B,V._mainCanvas.source.height=g,o&&V.WebGL.init(V._mainCanvas,B,g),Y.container.appendChild(V._mainCanvas.source),(V._context=new e(B,g,o?null:V._mainCanvas)).ctx.setIsMainContext(),Y.window.requestAnimationFrame(function B(g){Y.window.requestAnimationFrame(B);s.stage._loop()}),s.stage.on("visibilitychange",this,this._onVisibilitychange)}N(V,"laya.renders.Render");var B=V.prototype;return B._onVisibilitychange=function(){s.stage.isVisibility?0!=this._timeId&&Y.window.clearInterval(this._timeId):this._timeId=Y.window.setInterval(this._enterFrame,1e3)},B._enterFrame=function(B){s.stage._loop()},A(1,V,"context",function(){return V._context}),A(1,V,"canvas",function(){return V._mainCanvas.source}),V._context=null,V._mainCanvas=null,V.WebGL=null,V.isConchNode=!1,V.isConchApp=!1,V.isConchWebGL=!1,V.isWebGL=!1,V.is3DMode=!1,V.optimizeTextureMemory=function(B,g){return!0},V.__init$=function(){y.ConchRenderType=y.ConchRenderType||1,y.ConchRenderType|=y.conch?4:0,V.isConchNode=5==(5&y.ConchRenderType),V.isConchApp=4==(4&y.ConchRenderType),V.isConchWebGL=6==y.ConchRenderType},V}(),e=function(){function y(B,g,l){this.x=0,this.y=0,this._drawTexture=function(B,g,l){l[0].loaded&&this.ctx.drawTexture(l[0],l[1],l[2],l[3],l[4],B,g)},this._fillTexture=function(B,g,l){l[0].loaded&&this.ctx.fillTexture(l[0],l[1]+B,l[2]+g,l[3],l[4],l[5],l[6],l[7])},this._drawTextureWithTransform=function(B,g,l){l[0].loaded&&this.ctx.drawTextureWithTransform(l[0],l[1],l[2],l[3],l[4],l[5],B,g,l[6])},this._fillQuadrangle=function(B,g,l){this.ctx.fillQuadrangle(l[0],l[1],l[2],l[3],l[4])},this._drawRect=function(B,g,l){var o=this.ctx;null!=l[4]&&(o.fillStyle=l[4],o.fillRect(B+l[0],g+l[1],l[2],l[3],null)),null!=l[5]&&(o.strokeStyle=l[5],o.lineWidth=l[6],o.strokeRect(B+l[0],g+l[1],l[2],l[3],l[6]))},this._drawPie=function(B,g,l){var o=this.ctx;E.isWebGL&&o.setPathId(l[8]),o.beginPath(),E.isWebGL?(o.movePath(l[0]+B,l[1]+g),o.moveTo(0,0)):o.moveTo(B+l[0],g+l[1]),o.arc(B+l[0],g+l[1],l[2],l[3],l[4]),o.closePath(),this._fillAndStroke(l[5],l[6],l[7],!0)},this._clipRect=function(B,g,l){this.ctx.clipRect(B+l[0],g+l[1],l[2],l[3])},this._fillRect=function(B,g,l){this.ctx.fillRect(B+l[0],g+l[1],l[2],l[3],l[4])},this._drawCircle=function(B,g,l){var o=this.ctx;E.isWebGL&&o.setPathId(l[6]),I.drawCall++,o.beginPath(),E.isWebGL&&o.movePath(l[0]+B,l[1]+g),o.arc(l[0]+B,l[1]+g,l[2],0,y.PI2),o.closePath(),this._fillAndStroke(l[3],l[4],l[5],!0)},this._fillCircle=function(B,g,l){I.drawCall++;var o=this.ctx;o.beginPath(),o.fillStyle=l[3],o.arc(l[0]+B,l[1]+g,l[2],0,y.PI2),o.fill()},this._setShader=function(B,g,l){this.ctx.setShader(l[0])},this._drawLine=function(B,g,l){var o=this.ctx;E.isWebGL&&o.setPathId(l[6]),o.beginPath(),o.strokeStyle=l[4],o.lineWidth=l[5],E.isWebGL?(o.movePath(B,g),o.moveTo(l[0],l[1]),o.lineTo(l[2],l[3])):(o.moveTo(B+l[0],g+l[1]),o.lineTo(B+l[2],g+l[3])),o.stroke()},this._drawLines=function(B,g,l){var o=this.ctx;E.isWebGL&&o.setPathId(l[5]),o.beginPath(),B+=l[0],g+=l[1],E.isWebGL&&o.movePath(B,g),o.strokeStyle=l[3],o.lineWidth=l[4];var V=l[2],U=2,y=V.length;if(E.isWebGL)for(o.moveTo(V[0],V[1]);U<y;)o.lineTo(V[U++],V[U++]);else for(o.moveTo(B+V[0],g+V[1]);U<y;)o.lineTo(B+V[U++],g+V[U++]);o.stroke()},this._drawLinesWebGL=function(B,g,l){this.ctx.drawLines(B+this.x+l[0],g+this.y+l[1],l[2],l[3],l[4])},this._drawCurves=function(B,g,l){this.ctx.drawCurves(B,g,l)},this._draw=function(B,g,l){l[0].call(null,this,B,g)},this._transformByMatrix=function(B,g,l){this.ctx.transformByMatrix(l[0])},this._setTransform=function(B,g,l){this.ctx.setTransform(l[0],l[1],l[2],l[3],l[4],l[5])},this._setTransformByMatrix=function(B,g,l){this.ctx.setTransformByMatrix(l[0])},this._save=function(B,g,l){this.ctx.save()},this._restore=function(B,g,l){this.ctx.restore()},this._translate=function(B,g,l){this.ctx.translate(l[0],l[1])},this._transform=function(B,g,l){this.ctx.translate(l[1]+B,l[2]+g);var o=l[0];this.ctx.transform(o.a,o.b,o.c,o.d,o.tx,o.ty),this.ctx.translate(-B-l[1],-g-l[2])},this._rotate=function(B,g,l){this.ctx.translate(l[1]+B,l[2]+g),this.ctx.rotate(l[0]),this.ctx.translate(-B-l[1],-g-l[2])},this._scale=function(B,g,l){this.ctx.translate(l[2]+B,l[3]+g),this.ctx.scale(l[0],l[1]),this.ctx.translate(-B-l[2],-g-l[3])},this._alpha=function(B,g,l){this.ctx.globalAlpha*=l[0]},this._setAlpha=function(B,g,l){this.ctx.globalAlpha=l[0]},this._fillText=function(B,g,l){this.ctx.fillText(l[0],l[1]+B,l[2]+g,l[3],l[4],l[5])},this._strokeText=function(B,g,l){this.ctx.strokeText(l[0],l[1]+B,l[2]+g,l[3],l[4],l[5],l[6])},this._fillBorderText=function(B,g,l){this.ctx.fillBorderText(l[0],l[1]+B,l[2]+g,l[3],l[4],l[5],l[6],l[7])},this._blendMode=function(B,g,l){this.ctx.globalCompositeOperation=l[0]},this._beginClip=function(B,g,l){this.ctx.beginClip&&this.ctx.beginClip(B+l[0],g+l[1],l[2],l[3])},this._setIBVB=function(B,g,l){this.ctx.setIBVB(l[0]+B,l[1]+g,l[2],l[3],l[4],l[5],l[6],l[7])},this._fillTrangles=function(B,g,l){this.ctx.fillTrangles(l[0],l[1]+B,l[2]+g,l[3],l[4])},this._drawPath=function(B,g,l){var o=this.ctx;E.isWebGL&&o.setPathId(-1),o.beginPath(),B+=l[0],g+=l[1],E.isWebGL&&o.movePath(B,g);for(var V=l[2],U=0,y=V.length;U<y;U++){var G=V[U];switch(G[0]){case"moveTo":E.isWebGL?o.moveTo(G[1],G[2]):o.moveTo(B+G[1],g+G[2]);break;case"lineTo":E.isWebGL?o.lineTo(G[1],G[2]):o.lineTo(B+G[1],g+G[2]);break;case"arcTo":E.isWebGL?o.arcTo(G[1],G[2],G[3],G[4],G[5]):o.arcTo(B+G[1],g+G[2],B+G[3],g+G[4],G[5]);break;case"closePath":o.closePath()}}var d=l[3];null!=d&&(o.fillStyle=d.fillStyle,o.fill());var j=l[4];null!=j&&(o.strokeStyle=j.strokeStyle,o.lineWidth=j.lineWidth||1,o.lineJoin=j.lineJoin,o.lineCap=j.lineCap,o.miterLimit=j.miterLimit,o.stroke())},this.drawPoly=function(B,g,l){this.ctx.drawPoly(B+this.x+l[0],g+this.y+l[1],l[2],l[3],l[4],l[5],l[6])},this._drawPoly=function(B,g,l){var o=this.ctx,V=l[2],U=2,y=V.length;if(E.isWebGL)for(o.setPathId(l[6]),o.beginPath(),B+=l[0],g+=l[1],o.movePath(B,g),o.moveTo(V[0],V[1]);U<y;)o.lineTo(V[U++],V[U++]);else for(o.beginPath(),B+=l[0],g+=l[1],o.moveTo(B+V[0],g+V[1]);U<y;)o.lineTo(B+V[U++],g+V[U++]);o.closePath(),this._fillAndStroke(l[3],l[4],l[5],l[7])},this._drawSkin=function(B,g,l){var o=l[0];if(o){var V=this.ctx;o.render(V,B,g)}},this._drawParticle=function(B,g,l){this.ctx.drawParticle(B+this.x,g+this.y,l[0])},this._setFilters=function(B,g,l){this.ctx.setFilters(l)},l?this.ctx=l.getContext("2d"):(l=MB.create("3D"),this.ctx=t.createWebGLContext2D(l),l._setContext(this.ctx)),l.size(B,g),this.canvas=l}N(y,"laya.renders.RenderContext");var B=y.prototype;return B.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},B.drawTexture=function(B,g,l,o,V){B.loaded&&this.ctx.drawTexture(B,g,l,o,V,this.x,this.y)},B._drawTextures=function(B,g,l){l[0].loaded&&this.ctx.drawTextures(l[0],l[1],B+this.x,g+this.y)},B.drawTextureWithTransform=function(B,g,l,o,V,U,y){B.loaded&&this.ctx.drawTextureWithTransform(B,g,l,o,V,U,this.x,this.y,y)},B.fillQuadrangle=function(B,g,l,o,V){this.ctx.fillQuadrangle(B,g,l,o,V)},B.drawCanvas=function(B,g,l,o,V){this.ctx.drawCanvas(B,g+this.x,l+this.y,o,V)},B.drawRect=function(B,g,l,o,V,U){void 0===U&&(U=1);var y=this.ctx;y.strokeStyle=V,y.lineWidth=U,y.strokeRect(B+this.x,g+this.y,l,o,U)},B._fillAndStroke=function(B,g,l,o){void 0===o&&(o=!1);var V=this.ctx;null!=B&&(V.fillStyle=B,E.isWebGL?V.fill(o):V.fill()),null!=g&&0<l&&(V.strokeStyle=g,V.lineWidth=l,V.stroke())},B.clipRect=function(B,g,l,o){this.ctx.clipRect(B+this.x,g+this.y,l,o)},B.fillRect=function(B,g,l,o,V){this.ctx.fillRect(B+this.x,g+this.y,l,o,V)},B.drawCircle=function(B,g,l,o,V){void 0===V&&(V=1),I.drawCall++;var U=this.ctx;U.beginPath(),U.strokeStyle=o,U.lineWidth=V,U.arc(B+this.x,g+this.y,l,0,y.PI2),U.stroke()},B.drawTriangles=function(B,g,l){if(E.isWebGL)this.ctx.drawTriangles(l[0],B+l[1],g+l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9]);else{var o=l[5],V=0,U=o.length,y=this.ctx;for(V=0;V<U;V+=3){var G=2*o[V],d=2*o[V+1],j=2*o[V+2];y.drawTriangle(l[0],l[3],l[4],G,d,j,l[6],!0)}}},B.fillCircle=function(B,g,l,o){I.drawCall++;var V=this.ctx;V.beginPath(),V.fillStyle=o,V.arc(B+this.x,g+this.y,l,0,y.PI2),V.fill()},B.setShader=function(B){this.ctx.setShader(B)},B.drawLine=function(B,g,l,o,V,U){void 0===U&&(U=1);var y=this.ctx;y.beginPath(),y.strokeStyle=V,y.lineWidth=U,y.moveTo(this.x+B,this.y+g),y.lineTo(this.x+l,this.y+o),y.stroke()},B.clear=function(){this.ctx.clear()},B.transformByMatrix=function(B){this.ctx.transformByMatrix(B)},B.setTransform=function(B,g,l,o,V,U){this.ctx.setTransform(B,g,l,o,V,U)},B.setTransformByMatrix=function(B){this.ctx.setTransformByMatrix(B)},B.save=function(){this.ctx.save()},B.restore=function(){this.ctx.restore()},B.translate=function(B,g){this.ctx.translate(B,g)},B.transform=function(B,g,l,o,V,U){this.ctx.transform(B,g,l,o,V,U)},B.rotate=function(B){this.ctx.rotate(B)},B.scale=function(B,g){this.ctx.scale(B,g)},B.alpha=function(B){this.ctx.globalAlpha*=B},B.setAlpha=function(B){this.ctx.globalAlpha=B},B.fillWords=function(B,g,l,o,V,U){void 0===U&&(U=0),this.ctx.fillWords(B,g,l,o,V,U)},B.fillBorderWords=function(B,g,l,o,V,U,y){this.ctx.fillBorderWords(B,g,l,o,V,U,y)},B.fillText=function(B,g,l,o,V,U){this.ctx.fillText(B,g+this.x,l+this.y,o,V,U)},B.strokeText=function(B,g,l,o,V,U,y){this.ctx.strokeText(B,g+this.x,l+this.y,o,V,U,y)},B.blendMode=function(B){this.ctx.globalCompositeOperation=B},B.flush=function(){this.ctx.flush&&this.ctx.flush()},B.addRenderObject=function(B){this.ctx.addRenderObject(B)},B.beginClip=function(B,g,l,o){this.ctx.beginClip&&this.ctx.beginClip(B,g,l,o)},B.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},B.fillTrangles=function(B,g,l){this.ctx.fillTrangles(l[0],l[1],l[2],l[3],4<l.length?l[4]:null)},y.PI2=2*Math.PI,y}(),Q=function(){function y(B,g){switch(this._next=g||y.NORENDER,B){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=C._filter);case 69905:return void(this._fun=y._initRenderFun)}this.onCreate(B)}N(y,"laya.renders.RenderSprite");var B=y.prototype;return B.onCreate=function(B){},B._style=function(B,g,l,o){B._style.render(B,g,l,o);var V=this._next;V._fun.call(V,B,g,l,o)},B._no=function(B,g,l,o){},B._custom=function(B,g,l,o){B.customRender(g,l,o);var V=B._style._tf;this._next._fun.call(this._next,B,g,l-V.translateX,o-V.translateY)},B._clip=function(B,g,l,o){var V=this._next;if(V!=y.NORENDER){var U=B._style.scrollRect;g.ctx.save(),g.ctx.clipRect(l,o,U.width,U.height),V._fun.call(V,B,g,l-U.x,o-U.y),g.ctx.restore()}},B._blend=function(B,g,l,o){var V=B._style;V.blendMode&&(g.ctx.globalCompositeOperation=V.blendMode);var U=this._next;U._fun.call(U,B,g,l,o),g.ctx.globalCompositeOperation="source-over"},B._mask=function(B,g,l,o){var V=this._next;V._fun.call(V,B,g,l,o);var U=B.mask;U&&(g.ctx.globalCompositeOperation="destination-in",(0<U.numChildren||!U.graphics._isOnlyOne())&&(U.cacheAsBitmap=!0),U.render(g,l-B.pivotX,o-B.pivotY)),g.ctx.globalCompositeOperation="source-over"},B._graphics=function(B,g,l,o){var V=B._style._tf;B._graphics&&B._graphics._render(B,g,l-V.translateX,o-V.translateY);var U=this._next;U._fun.call(U,B,g,l,o)},B._image=function(B,g,l,o){var V=B._style;g.ctx.drawTexture2(l,o,V._tf.translateX,V._tf.translateY,B.transform,V.alpha,V.blendMode,B._graphics._one)},B._image2=function(B,g,l,o){var V=B._style._tf;g.ctx.drawTexture2(l,o,V.translateX,V.translateY,B.transform,1,null,B._graphics._one)},B._alpha=function(B,g,l,o){var V;if(.01<(V=B._style.alpha)||B._needRepaint()){var U=g.ctx.globalAlpha;g.ctx.globalAlpha*=V;var y=this._next;y._fun.call(y,B,g,l,o),g.ctx.globalAlpha=U}},B._transform=function(B,g,l,o){var V=B.transform,U=this._next;V&&U!=y.NORENDER?(g.save(),g.transform(V.a,V.b,V.c,V.d,V.tx+l,V.ty+o),U._fun.call(U,B,g,0,0),g.restore()):U._fun.call(U,B,g,l,o)},B._childs=function(B,g,l,o){var V=B._style,U=V._tf;if(l=l-U.translateX+V.paddingLeft,o=o-U.translateY+V.paddingTop,V._calculation){var y=B._getWords();if(y){var G=V;G&&(G.stroke?g.fillBorderWords(y,l,o,G.font,G.color,G.strokeColor,G.stroke):g.fillWords(y,l,o,G.font,G.color,"none"!=G.textDecoration&&G.underLine?1:0))}}var d,j=B._childs,A=j.length;if(B.viewport||B.optimizeScrollRect&&B._style.scrollRect){var H=B.viewport||B._style.scrollRect,K=H.x,p=H.y,x=H.right,N=H.bottom,F=NaN,C=NaN;for(m=0;m<A;++m)(d=j[m]).visible&&(F=d._x)<x&&F+d.width>K&&(C=d._y)<N&&C+d.height>p&&d.render(g,l,o)}else for(var m=0;m<A;++m)(d=j[m])._style.visible&&d.render(g,l,o)},B._canvas=function(B,g,l,o){var V=B._$P.cacheCanvas;if(V){"bitmap"===V.type?I.canvasBitmap++:I.canvasNormal++;var U=V.ctx;if(B._needRepaint()||!U)this._canvas_repaint(B,g,l,o);else{var y=V._cacheRec;g.drawCanvas(U.canvas,l+y.x,o+y.y,y.width,y.height)}}else this._next._fun.call(this._next,B,g,l,o)},B._canvas_repaint=function(B,g,l,o){var V=B._$P.cacheCanvas,U=this._next;if(V){var y,G,d,j,A=V.ctx,H=B._needRepaint()||!A,K=V.type;if("bitmap"===K?I.canvasBitmap++:I.canvasNormal++,H){var p,x;V._cacheRec||(V._cacheRec=new w),E.isWebGL&&"bitmap"!==K?V._cacheRec.setTo(-B.pivotX,-B.pivotY,1,1):((j=B.getSelfBounds()).x=j.x-B.pivotX,j.y=j.y-B.pivotY,j.x=j.x-16,j.y=j.y-16,j.width=j.width+32,j.height=j.height+32,j.x=Math.floor(j.x+l)-l,j.y=Math.floor(j.y+o)-o,j.width=Math.floor(j.width),j.height=Math.floor(j.height),V._cacheRec.copyFrom(j)),j=V._cacheRec;var N,F=E.isWebGL?1:Y.pixelRatio*s.stage.clientScaleX,C=E.isWebGL?1:Y.pixelRatio*s.stage.clientScaleY;if(!E.isWebGL){var m,M=1,b=1;for(m=B;m&&m!=s.stage;)M*=m.scaleX,b*=m.scaleY,m=m.parent;E.isWebGL?(M<1&&(F*=M),b<1&&(C*=b)):(1<M&&(F*=M),1<b&&(C*=b))}if(B.scrollRect){var D=B.scrollRect;j.x-=D.x,j.y-=D.y}if(p=j.width*F,x=j.height*C,G=j.x,d=j.y,E.isWebGL&&"bitmap"===K&&(2048<p||2048<x))return console.warn("cache bitmap size larger than 2048,cache ignored"),V.ctx&&(L.recover("RenderContext",V.ctx),V.ctx.canvas.size(0,0),V.ctx=null),void U._fun.call(U,B,g,l,o);if(A||(A=V.ctx=L.getItem("RenderContext")||new e(p,x,MB.create("AUTO"))),A.ctx.sprite=B,(y=A.canvas).clear(),(y.width!=p||y.height!=x)&&y.size(p,x),"bitmap"===K?y.context.asBitmap=!0:"normal"===K&&(y.context.asBitmap=!1),1!=F||1!=C){var v=A.ctx;v.save(),v.scale(F,C),!E.isConchWebGL&&E.isConchApp&&(N=B._$P.cf)&&v.setFilterMatrix&&v.setFilterMatrix(N._mat,N._alpha),U._fun.call(U,B,A,-G,-d),v.restore(),E.isConchApp&&!E.isConchWebGL||B._applyFilters()}else v=A.ctx,!E.isConchWebGL&&E.isConchApp&&(N=B._$P.cf)&&v.setFilterMatrix&&v.setFilterMatrix(N._mat,N._alpha),U._fun.call(U,B,A,-G,-d),E.isConchApp&&!E.isConchWebGL||B._applyFilters();B._$P.staticCache&&(V.reCache=!1),I.canvasReCache++}else G=(j=V._cacheRec).x,d=j.y,y=A.canvas;g.drawCanvas(y,l+G,o+d,j.width,j.height)}else U._fun.call(U,B,A,l,o)},y.__init__=function(){var B,g,l=0;for(g=t.createRenderSprite(69905,null),B=y.renders.length=4096,l=0;l<B;l++)y.renders[l]=g;y.renders[0]=t.createRenderSprite(0,null),function(B,g){for(var l=0,o=0;o<B.length;o++)l|=B[o],y.renders[l]=g}([1,512,4,2],new y(1,null)),y.renders[513]=t.createRenderSprite(513,null),y.renders[517]=new y(517,null)},y._initRenderFun=function(B,g,l,o){var V=B._renderType;(y.renders[V]=y._getTypeRender(V))._fun(B,g,l,o)},y._getTypeRender=function(B){for(var g=null,l=2048;1<l;)l&B&&(g=t.createRenderSprite(l,g)),l>>=1;return g},y.IMAGE=1,y.ALPHA=2,y.TRANSFORM=4,y.BLEND=8,y.CANVAS=16,y.FILTERS=32,y.MASK=64,y.CLIP=128,y.STYLE=256,y.GRAPHICS=512,y.CUSTOM=1024,y.CHILDS=2048,y.INIT=69905,y.renders=[],y.NORENDER=new y(0,null),y}(),_=function(){function G(){this._repaint=!1}N(G,"laya.resource.Context");var B=G.prototype;return B.replaceReset=function(){var B,g,l=0;for(B=G.replaceKeys.length,l=0;l<B;l++)g=G.replaceKeys[l],this[G.newKeys[l]]=this[g]},B.replaceResotre=function(){this.__restore(),this.__reset()},B.setIsMainContext=function(){},B.drawTextures=function(B,g,l,o){I.drawCall+=g.length/2;for(var V=B.width,U=B.height,y=0,G=g.length;y<G;y+=2)this.drawTexture(B,g[y],g[y+1],V,U,l,o)},B.drawCanvas=function(B,g,l,o,V){I.drawCall++,this.drawImage(B.source,g,l,o,V)},B.fillRect=function(B,g,l,o,V){I.drawCall++,V&&(this.fillStyle=V),this.__fillRect(B,g,l,o)},B.fillText=function(B,g,l,o,V,U){I.drawCall++,3<arguments.length&&null!=o&&(this.font=o,this.fillStyle=V,this.textAlign=U,this.textBaseline="top"),this.__fillText(B,g,l)},B.fillBorderText=function(B,g,l,o,V,U,y,G){I.drawCall++,this.font=o,this.fillStyle=V,this.textBaseline="top",this.strokeStyle=U,this.lineWidth=y,this.textAlign=G,this.__strokeText(B,g,l),this.__fillText(B,g,l)},B.strokeText=function(B,g,l,o,V,U,y){I.drawCall++,3<arguments.length&&null!=o&&(this.font=o,this.strokeStyle=V,this.lineWidth=U,this.textAlign=y,this.textBaseline="top"),this.__strokeText(B,g,l)},B.transformByMatrix=function(B){this.transform(B.a,B.b,B.c,B.d,B.tx,B.ty)},B.setTransformByMatrix=function(B){this.setTransform(B.a,B.b,B.c,B.d,B.tx,B.ty)},B.clipRect=function(B,g,l,o){I.drawCall++,this.beginPath(),this.rect(B,g,l,o),this.clip()},B.drawTexture=function(B,g,l,o,V,U,y){I.drawCall++;var G=B.uv,d=B.bitmap.width,j=B.bitmap.height;this.drawImage(B.source,G[0]*d,G[1]*j,(G[2]-G[0])*d,(G[5]-G[3])*j,g+U,l+y,o,V)},B.drawTextureWithTransform=function(B,g,l,o,V,U,y,G,d){I.drawCall++;var j=B.uv,A=B.bitmap.width,H=B.bitmap.height;this.save(),1!=d&&(this.globalAlpha*=d),U?(this.transform(U.a,U.b,U.c,U.d,U.tx+y,U.ty+G),this.drawImage(B.source,j[0]*A,j[1]*H,(j[2]-j[0])*A,(j[5]-j[3])*H,g,l,o,V)):this.drawImage(B.source,j[0]*A,j[1]*H,(j[2]-j[0])*A,(j[5]-j[3])*H,g+y,l+G,o,V),this.restore()},B.drawTexture2=function(B,g,l,o,V,U,y,G){var d=G[0];if(d.loaded&&d.bitmap&&d.source){I.drawCall++;var j=1!==U;if(j){var A=this.globalAlpha;this.globalAlpha*=U}var H=d.uv,K=d.bitmap.width,p=d.bitmap.height;V?(this.save(),this.transform(V.a,V.b,V.c,V.d,V.tx+B,V.ty+g),this.drawImage(d.source,H[0]*K,H[1]*p,(H[2]-H[0])*K,(H[5]-H[3])*p,G[1]-l,G[2]-o,G[3],G[4]),this.restore()):this.drawImage(d.source,H[0]*K,H[1]*p,(H[2]-H[0])*K,(H[5]-H[3])*p,G[1]-l+B,G[2]-o+g,G[3],G[4]),j&&(this.globalAlpha=A)}},B.fillTexture=function(B,g,l,o,V,U,y,G){if(!G.pat){if(B.uv!=AB.DEF_UV){var d=new MB("2D");d.getContext("2d"),d.size(B.width,B.height),d.context.drawTexture(B,0,0,B.width,B.height,0,0),B=new AB(d)}G.pat=this.createPattern(B.bitmap.source,U)}var j=g,A=l,H=0,K=0;y&&(j+=y.x%B.width,A+=y.y%B.height,H-=y.x%B.width,K-=y.y%B.height),this.translate(j,A),this.fillRect(H,K,o,V,G.pat),this.translate(-j,-A)},B.drawTriangle=function(B,g,l,o,V,U,y,G){var d=B.bitmap,j=d.source,A=B.width,H=B.height,K=d.width,p=d.height,x=l[o]*K,N=l[V]*K,F=l[U]*K,C=l[o+1]*p,m=l[V+1]*p,M=l[U+1]*p,b=g[o],D=g[V],v=g[U],s=g[o+1],X=g[V+1],w=g[U+1];if(G){var i=(b+D+v)/3,a=(s+X+w)/3,z=b-i,t=s-a,h=Math.sqrt(z*z+t*t);b=i+z/h*(h+1),s=a+t/h*(h+1),t=X-a,D=i+(z=D-i)/(h=Math.sqrt(z*z+t*t))*(h+1),X=a+t/h*(h+1),t=w-a,v=i+(z=v-i)/(h=Math.sqrt(z*z+t*t))*(h+1),w=a+t/h*(h+1)}this.save(),y&&this.transform(y.a,y.b,y.c,y.d,y.tx,y.ty),this.beginPath(),this.moveTo(b,s),this.lineTo(D,X),this.lineTo(v,w),this.closePath(),this.clip();var f=1/(x*m+C*F+N*M-m*F-C*N-x*M),S=b*m+C*v+D*M-m*v-C*D-b*M,E=x*D+b*F+N*v-D*F-b*N-x*v,e=x*m*v+C*D*F+b*N*M-b*m*F-C*N*v-x*D*M,Q=s*m+C*w+X*M-m*w-C*X-s*M,_=x*X+s*F+N*w-X*F-s*N-x*w,P=x*m*w+C*X*F+s*N*M-s*m*F-C*N*w-x*X*M;this.transform(S*f,Q*f,E*f,_*f,e*f,P*f),this.drawImage(j,B.uv[0]*K,B.uv[1]*p,A,H,B.uv[0]*K,B.uv[1]*p,A,H),this.restore()},B.flush=function(){return 0},B.fillWords=function(B,g,l,o,V,U){o&&(this.font=o),V&&(this.fillStyle=V);this.textBaseline="top",this.textAlign="left";for(var y=0,G=B.length;y<G;y++){var d=B[y];if(this.__fillText(d.char,d.x+g,d.y+l),1===U){var j=d.height,A=.5*d.style.letterSpacing;A||(A=0),this.beginPath(),this.strokeStyle=V,this.lineWidth=1,this.moveTo(g+d.x-A+.5,l+d.y+j+.5),this.lineTo(g+d.x+d.width+A+.5,l+d.y+j+.5),this.stroke()}}},B.fillBorderWords=function(B,g,l,o,V,U,y){o&&(this.font=o),V&&(this.fillStyle=V),this.textBaseline="top",this.lineWidth=y,this.textAlign="left",this.strokeStyle=U;for(var G=0,d=B.length;G<d;G++){var j=B[G];this.__strokeText(j.char,j.x+g,j.y+l),this.__fillText(j.char,j.x+g,j.y+l)}},B.destroy=function(){this.canvas.width=this.canvas.height=0},B.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},B.drawCurves=function(B,g,l){this.beginPath(),this.strokeStyle=l[3],this.lineWidth=l[4];var o=l[2];B+=l[0],g+=l[1],this.moveTo(B+o[0],g+o[1]);for(var V=2,U=o.length;V<U;)this.quadraticCurveTo(B+o[V++],g+o[V++],B+o[V++],g+o[V++]);this.stroke()},G.__init__=function(g){var l=laya.resource.Context.prototype;if(!(g=g||CanvasRenderingContext2D.prototype).inited){g.inited=!0,g.__fillText=g.fillText,g.__fillRect=g.fillRect,g.__strokeText=g.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(B){g[B]=l[B]})}},G.replaceCanvasGetSet=function(B,g){var l=Object.getOwnPropertyDescriptor(B,g);if(!l||!l.configurable)return!1;var o,V={};for(o in l)"set"!=o&&(V[o]=l[o]);var U=l.set;return V.set=function(B){U.call(this,B);var g=this.getContext("2d");g&&"__reset"in g&&g.__reset()},Object.defineProperty(B,g,V),!0},G.replaceGetSet=function(B,g){var l=Object.getOwnPropertyDescriptor(B,g);if(!l||!l.configurable)return!1;var o,V={};for(o in l)"set"!=o&&(V[o]=l[o]);var U=l.set,y="___"+g+"__";return G.newKeys.push(y),V.set=function(B){B!=this[y]&&(this[y]=B,U.call(this,B))},Object.defineProperty(B,g,V),!0},G._default=new G,G.newKeys=[],d(G,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),G}(),P=function(){function U(B){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++U._uniqueIDCounter,this._name=B||"Content Manager",U._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,U._resourceManagers.push(this),this._resources=[],this._records={}}N(U,"laya.resource.ResourceManager");var B=U.prototype;return s.imps(B,{"laya.resource.IDispose":!0}),B.getResourceByIndex=function(B){return this._resources[B]},B.getResourcesLength=function(){return this._resources.length},B.addResource=function(B){return B.resourceManager&&B.resourceManager.removeResource(B),-1===this._resources.indexOf(B)&&((B._resourceManager=this)._resources.push(B),this.addRecord(B.uri,B.__className,B.memorySize),this.addSize(B.memorySize),!0)},B.removeResource=function(B){var g=this._resources.indexOf(B);return-1!==g&&(this._resources.splice(g,1),B._resourceManager=null,this._memorySize-=B.memorySize,this.addRecord(B.uri,B.__className,-B.memorySize),!0)},B.unload=function(){for(var B=this._resources.slice(0,this._resources.length),g=0;g<B.length;g++){B[g].destroy()}B.length=0},B.dispose=function(){if(this===U._systemResourceManager)throw new Error("systemResourceManager不能被释放！");U._resourceManagers.splice(U._resourceManagers.indexOf(this),1),U._isResourceManagersSorted=!1;for(var B=this._resources.slice(0,this._resources.length),g=0;g<B.length;g++){var l=B[g];l.resourceManager.removeResource(l),l.destroy()}B.length=0},B.addSize=function(B){B&&(this.autoRelease&&0<B&&this._memorySize+B>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=B)},B.addRecord=function(B,g,l){DEBUG&&l&&!B&&console.error(B,g,l)},B.garbageCollection=function(B){var g=this._resources;(g=g.slice()).sort(function(B,g){if(!B||!g)throw new Error("a或b不能为空！");return B.released&&g.released?0:B.released?1:g.released?-1:B._lastUseFrameCount-g._lastUseFrameCount});for(var l=I.loopCount,o=0,V=g.length;o<V;o++){var U=g[o];if(!(1<l-U._lastUseFrameCount))return void(this._memorySize>=B&&(this._isOverflow=!0));if(U.releaseResource(),this._memorySize<B)return void(this._isOverflow=!1)}},A(0,B,"id",function(){return this._id}),A(0,B,"name",function(){return this._name},function(B){!B&&""===B||this._name===B||(this._name=B,U._isResourceManagersSorted=!1)}),A(0,B,"memorySize",function(){return this._memorySize}),A(0,B,"records",function(){return this._records}),A(1,U,"systemResourceManager",function(){return U._systemResourceManager}),U.__init__=function(){U.currentResourceManager=U.systemResourceManager},U.getLoadedResourceManagerByIndex=function(B){return U._resourceManagers[B]},U.getLoadedResourceManagersCount=function(){return U._resourceManagers.length},U.recreateContentManagers=function(B){void 0===B&&(B=!1);for(var g=U.currentResourceManager,l=0;l<U._resourceManagers.length;l++){U.currentResourceManager=U._resourceManagers[l];for(var o=0;o<U.currentResourceManager._resources.length;o++)U.currentResourceManager._resources[o].releaseResource(B),U.currentResourceManager._resources[o].activeResource(B)}U.currentResourceManager=g},U.releaseContentManagers=function(B){void 0===B&&(B=!1);for(var g=U.currentResourceManager,l=0;l<U._resourceManagers.length;l++){U.currentResourceManager=U._resourceManagers[l];for(var o=0;o<U.currentResourceManager._resources.length;o++){var V=U.currentResourceManager._resources[o];!V.released&&V.releaseResource(B)}}U.currentResourceManager=g},U._uniqueIDCounter=0,U._isResourceManagersSorted=!1,U._resourceManagers=[],d(U,["_systemResourceManager",function(){return this._systemResourceManager=new U("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=U._systemResourceManager}]),U}(),Y=(function(){function B(){}N(B,"laya.system.System"),B.changeDefinition=function(B,g){s[B]=g;var l=B+"=classObj";s._runScript(l)},B.__init__=function(){E.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function l(){}return N(l,"laya.utils.Browser"),A(1,l,"pixelRatio",function(){return l.__init__(),-1<l.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:t.getPixelRatio()}),A(1,l,"height",function(){return l.__init__(),(s.stage&&s.stage.canvasRotation?l.clientWidth:l.clientHeight)*l.pixelRatio}),A(1,l,"clientWidth",function(){return l.__init__(),l.window.innerWidth||l.document.body.clientWidth}),A(1,l,"window",function(){return l.__init__(),l._window}),A(1,l,"clientHeight",function(){return l.__init__(),l.window.innerHeight||l.document.body.clientHeight||l.document.documentElement.clientHeight}),A(1,l,"width",function(){return l.__init__(),(s.stage&&s.stage.canvasRotation?l.clientHeight:l.clientWidth)*l.pixelRatio}),A(1,l,"container",function(){return l.__init__(),l._container||((l._container=l.createElement("div")).id="layaContainer",l.document.body.appendChild(l._container)),l._container},function(B){l._container=B}),A(1,l,"document",function(){return l.__init__(),l._document}),l.__init__=function(){if(!l._window){l._window=t.getWindow(),l._document=l.window.document,l._window.addEventListener("message",function(B){laya.utils.Browser._onMessage(B)},!1),l.document.__createElement=l.document.createElement,y.requestAnimationFrame=y.requestAnimationFrame||y.webkitRequestAnimationFrame||y.mozRequestAnimationFrame||y.oRequestAnimationFrame||y.msRequestAnimationFrame||function(B){return y.setTimeout(B,1e3/60)};var B=y.document.body.style;B["-webkit-user-select"]="none",B["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",l.userAgent=l.window.navigator.userAgent,l.onIOS=!!(l.u=l.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),l.onMobile=-1<l.u.indexOf("Mobile"),l.onIPhone=-1<l.u.indexOf("iPhone"),l.onMac=-1<l.u.indexOf("Mac OS X"),l.onIPad=-1<l.u.indexOf("iPad"),l.onAndroid=-1<l.u.indexOf("Android")||-1<l.u.indexOf("Adr"),l.onWP=-1<l.u.indexOf("Windows Phone"),l.onQQBrowser=-1<l.u.indexOf("QQBrowser"),l.onMQQBrowser=-1<l.u.indexOf("MQQBrowser")||-1<l.u.indexOf("Mobile")&&-1<l.u.indexOf("QQ"),l.onIE=!!l.window.ActiveXObject||"ActiveXObject"in l.window,l.onWeiXin=-1<l.u.indexOf("MicroMessenger"),l.onPC=!l.onMobile,l.onSafari=-1<l.u.indexOf("Safari"),l.onFirefox=-1<l.u.indexOf("Firefox"),l.onEdge=-1<l.u.indexOf("Edge"),l.onMiniGame=-1<l.u.indexOf("MiniGame"),l.onLimixiu=-1<l.u.indexOf("limixiu"),l.httpProtocol="http:"==l.window.location.protocol,l.onMiniGame&&null==l.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),l.webAudioEnabled=!!(l.window.AudioContext||l.window.webkitAudioContext||l.window.mozAudioContext),l.soundType=l.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",VB=l.webAudioEnabled?UB:lB,l.webAudioEnabled&&UB.initWebAudio(),lB._initMusicAudio(),l.enableTouch="ontouchstart"in y||y.DocumentTouch&&g instanceof DocumentTouch,y.focus(),z._soundClass=VB,z._musicClass=lB,E._mainCanvas=E._mainCanvas||MB.create("2D"),l.canvas||(l.canvas=MB.create("2D"),l.context=l.canvas.getContext("2d"))}},l._onMessage=function(B){if(B.data&&"size"==B.data.name){if(l.window.innerWidth=B.data.width,l.window.innerHeight=B.data.height,l.window.__innerHeight=B.data.clientHeight,!l.document.createEvent)return void console.warn("no document.createEvent");var g=l.document.createEvent("HTMLEvents");return g.initEvent("resize",!1,!1),void l.window.dispatchEvent(g)}},l.createElement=function(B){return l.__init__(),l.document.__createElement(B)},l.getElementById=function(B){return l.__init__(),l.document.getElementById(B)},l.removeElement=function(B){B&&B.parentNode&&B.parentNode.removeChild(B)},l.now=function(){return t.now()},l._window=null,l._document=null,l._container=null,l.userAgent=null,l.u=null,l.onIOS=!1,l.onMac=!1,l.onMobile=!1,l.onIPhone=!1,l.onIPad=!1,l.onAndroid=!1,l.onWP=!1,l.onQQBrowser=!1,l.onMQQBrowser=!1,l.onSafari=!1,l.onFirefox=!1,l.onEdge=!1,l.onIE=!1,l.onWeiXin=!1,l.onMiniGame=!1,l.onLimixiu=!1,l.onPC=!1,l.httpProtocol=!1,l.webAudioEnabled=!1,l.soundType=null,l.enableTouch=!1,l.canvas=null,l.context=null,l.__init$=function(){},l}()),c=function(){function g(B){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,B?(this._u8d_=new Uint8Array(B),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}N(g,"laya.utils.Byte");var B=g.prototype;return B.___resizeBuffer=function(g){try{var B=new Uint8Array(g);null!=this._u8d_&&(this._u8d_.length<=g?B.set(this._u8d_):B.set(this._u8d_.subarray(0,g))),this._u8d_=B,this._d_=new DataView(B.buffer)}catch(B){throw"___resizeBuffer err:"+g}},B.getString=function(){return this.rUTF(this.getUint16())},B.getFloat32Array=function(B,g){var l=B+g;l=l>this._length?this._length:l;var o=new Float32Array(this._d_.buffer.slice(B,l));return this._pos_=l,o},B.getUint8Array=function(B,g){var l=B+g;l=l>this._length?this._length:l;var o=new Uint8Array(this._d_.buffer.slice(B,l));return this._pos_=l,o},B.getInt16Array=function(B,g){var l=B+g;l=l>this._length?this._length:l;var o=new Int16Array(this._d_.buffer.slice(B,l));return this._pos_=l,o},B.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var B=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,B},B.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var B=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,B},B.writeFloat32=function(B){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,B,this._xd_),this._pos_+=4},B.writeFloat64=function(B){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,B,this._xd_),this._pos_+=8},B.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var B=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,B},B.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var B=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,B},B.writeInt32=function(B){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,B,this._xd_),this._pos_+=4},B.writeUint32=function(B){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,B,this._xd_),this._pos_+=4},B.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var B=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,B},B.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var B=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,B},B.writeUint16=function(B){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,B,this._xd_),this._pos_+=2},B.writeInt16=function(B){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,B,this._xd_),this._pos_+=2},B.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},B.writeUint8=function(B){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,B),this._pos_++},B._getUInt8=function(B){return this._d_.getUint8(B)},B._getUint16=function(B){return this._d_.getUint16(B,this._xd_)},B._getMatrix=function(){return new h(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},B.rUTF=function(B){for(var g=[],l=this._pos_+B,o=0,V=0,U=0,y=String.fromCharCode,G=this._u8d_;this._pos_<l;)(o=G[this._pos_++])<128?0!=o&&g.push(y(o)):o<224?g.push(y((63&o)<<6|127&G[this._pos_++])):o<240?(V=G[this._pos_++],g.push(y((31&o)<<12|(127&V)<<6|127&G[this._pos_++]))):(V=G[this._pos_++],U=G[this._pos_++],g.push(y((15&o)<<18|(127&V)<<12|U<<6&127|127&G[this._pos_++]))),0;return g.join("")},B.getCustomString=function(B){for(var g=[],l=0,o=0,V=0,U=String.fromCharCode,y=this._u8d_;0<B;)if((o=y[this._pos_])<128)g.push(U(o)),this._pos_++,B--;else for(l=o-128,this._pos_++,B-=l;0<l;)o=y[this._pos_++],V=y[this._pos_++],g.push(U(V<<8|o)),l--;return g.join("")},B.clear=function(){this._pos_=0,this.length=0},B.__getBuffer=function(){return this._d_.buffer},B.writeUTFBytes=function(B){for(var g=0,l=(B+="").length;g<l;g++){var o=B.charCodeAt(g);o<=127?this.writeByte(o):o<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|o>>6,128|63&o],this._pos_),this._pos_+=2):o<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|o>>12,128|o>>6&63,128|63&o],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|o>>18,128|o>>12&63,128|o>>6&63,128|63&o],this._pos_),this._pos_+=4)}},B.writeUTFString=function(B){var g=this.pos;this.writeUint16(1),this.writeUTFBytes(B);var l=this.pos-g-2;if(65536<=l)throw"writeUTFString byte len more than 65536";this._d_.setUint16(g,l,this._xd_)},B.readUTFString=function(){return this.readUTFBytes(this.getUint16())},B.getUTFString=function(){return this.readUTFString()},B.readUTFBytes=function(B){if(void 0===B&&(B=-1),0==B)return"";var g=this.bytesAvailable;if(g<B)throw"readUTFBytes error - Out of bounds";return B=0<B?B:g,this.rUTF(B)},B.getUTFBytes=function(B){return void 0===B&&(B=-1),this.readUTFBytes(B)},B.writeByte=function(B){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,B),this._pos_+=1},B.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},B.getByte=function(){return this.readByte()},B.ensureWrite=function(B){this._length<B&&(this._length=B),this._allocated_<B&&(this.length=B)},B.writeArrayBuffer=function(B,g,l){if(void 0===g&&(g=0),void 0===l&&(l=0),g<0||l<0)throw"writeArrayBuffer error - Out of bounds";0==l&&(l=B.byteLength-g),this.ensureWrite(this._pos_+l);var o=new Uint8Array(B);this._u8d_.set(o.subarray(g,g+l),this._pos_),this._pos_+=l},A(0,B,"buffer",function(){var B=this._d_.buffer;return B.byteLength==this.length?B:B.slice(0,this.length)}),A(0,B,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(B){this._xd_="littleEndian"==B}),A(0,B,"length",function(){return this._length},function(B){this._allocated_<B?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(B,2*this._allocated_))):this._allocated_>B&&this.___resizeBuffer(this._allocated_=B),this._length=B}),A(0,B,"pos",function(){return this._pos_},function(B){this._pos_=B}),A(0,B,"bytesAvailable",function(){return this._length-this._pos_}),g.getSystemEndian=function(){if(!g._sysEndian){var B=new ArrayBuffer(2);new DataView(B).setInt16(0,256,!0),g._sysEndian=256===new Int16Array(B)[0]?"littleEndian":"bigEndian"}return g._sysEndian},g.BIG_ENDIAN="bigEndian",g.LITTLE_ENDIAN="littleEndian",g._sysEndian=null,g}(),r=function(){function V(){}return N(V,"laya.utils.CacheManager"),V.regCacheByFunction=function(B,g){var l;V.unRegCacheByFunction(B,g),l={tryDispose:B,getCacheList:g},V._cacheList.push(l)},V.unRegCacheByFunction=function(B,g){var l,o=0;for(l=V._cacheList.length,o=0;o<l;o++)if(V._cacheList[o].tryDispose==B&&V._cacheList[o].getCacheList==g)return void V._cacheList.splice(o,1)},V.forceDispose=function(){var B=0,g=V._cacheList.length;for(B=0;B<g;B++)V._cacheList[B].tryDispose(!0)},V.beginCheck=function(B){void 0===B&&(B=15e3),s.timer.loop(B,null,V._checkLoop)},V.stopCheck=function(){s.timer.clear(null,V._checkLoop)},V._checkLoop=function(){var B=V._cacheList;if(!(B.length<1)){var g,l=Y.now(),o=0;for(g=o=B.length;0<o&&(B[V._index=++V._index%g].tryDispose(!1),!(Y.now()-l>V.loopTimeLimit));)o--}},V.loopTimeLimit=2,V._cacheList=[],V._index=0,V}(),Z=function(){function p(){}return N(p,"laya.utils.ClassUtils"),p.regClass=function(B,g){p._classMap[B]=g},p.getRegClass=function(B){return p._classMap[B]},p.getInstance=function(B){var g=p.getClass(B);return g?new g:(console.warn("[error] Undefined class:",B),null)},p.createByJson=function(B,g,l,o,V){"string"==typeof B&&(B=JSON.parse(B));var U=B.props;if(!g&&!(g=V?V.runWith(B):p.getInstance(U.runtime||B.type)))return null;var y=B.child;if(y)for(var G=0,d=y.length;G<d;G++){var j=y[G];if("render"!==j.props.name&&"render"!==j.props.renderType||!g._$set_itemRender)if("Graphic"==j.type)p.addGraphicsToSprite(j,g);else if(p.isDrawType(j.type))p.addGraphicToSprite(j,g,!0);else{var A=p.createByJson(j,null,l,o,V);"Script"==j.type?A.hasOwnProperty("owner")?A.owner=g:A.hasOwnProperty("target")&&(A.target=g):"mask"==j.props.renderType?g.mask=A:g.addChild(A)}else g.itemRender=j}if(U)for(var H in U){var K=U[H];"var"===H&&l?l[K]=g:K instanceof Array&&"function"==typeof g[H]?g[H].apply(g,K):g[H]=K}return o&&B.customProps&&o.runWith([g,B]),g.created&&g.created(),g},p.addGraphicsToSprite=function(B,g){var l;if((l=B.child)&&!(l.length<1)){var o;o=p._getGraphicsFromSprite(B,g);var V=0,U=0;B.props&&(V=p._getObjVar(B.props,"x",0),U=p._getObjVar(B.props,"y",0)),0!=V&&0!=U&&o.translate(V,U);var y,G=0;for(y=l.length,G=0;G<y;G++)p._addGraphicToGraphics(l[G],o);0!=V&&0!=U&&o.translate(-V,-U)}},p.addGraphicToSprite=function(B,g,l){var o;void 0===l&&(l=!1),o=l?p._getGraphicsFromSprite(B,g):g.graphics,p._addGraphicToGraphics(B,o)},p._getGraphicsFromSprite=function(B,g){var l,o;if(!B||!B.props)return g.graphics;switch(o=B.props.renderType){case"hit":case"unHit":var V;g.hitArea||(g.hitArea=new n),(V=g.hitArea)[o]||(V[o]=new K),l=V[o]}return l||(l=g.graphics),l},p._getTransformData=function(B){var g;(B.hasOwnProperty("pivotX")||B.hasOwnProperty("pivotY"))&&(g=g||new h).translate(-p._getObjVar(B,"pivotX",0),-p._getObjVar(B,"pivotY",0));var l=p._getObjVar(B,"scaleX",1),o=p._getObjVar(B,"scaleY",1),V=p._getObjVar(B,"rotation",0);p._getObjVar(B,"skewX",0),p._getObjVar(B,"skewY",0);return 1==l&&1==o&&0==V||((g=g||new h).scale(l,o),g.rotate(.0174532922222222*V)),g},p._addGraphicToGraphics=function(B,g){var l,o;if((l=B.props)&&(o=p.DrawTypeDic[B.type])){var V,U;V=g;var y=p._getParams(l,o[1],o[2],o[3]);((U=p._tM)||1!=p._alpha)&&(V.save(),U&&V.transform(U),1!=p._alpha&&V.alpha(p._alpha)),V[o[0]].apply(V,y),(U||1!=p._alpha)&&V.restore()}},p._adptLineData=function(B){return B[2]=parseFloat(B[0])+parseFloat(B[2]),B[3]=parseFloat(B[1])+parseFloat(B[3]),B},p._adptTextureData=function(B){return B[0]=GB.getRes(B[0]),B},p._adptLinesData=function(B){return B[2]=p._getPointListByStr(B[2]),B},p.isDrawType=function(B){return"Image"!=B&&p.DrawTypeDic.hasOwnProperty(B)},p._getParams=function(B,g,l,o){var V;void 0===l&&(l=0),(V=p._temParam).length=g.length;var U,y,G=0;for(U=g.length,G=0;G<U;G++)V[G]=p._getObjVar(B,g[G][0],g[G][1]);return p._alpha=p._getObjVar(B,"alpha",1),y=p._getTransformData(B),p._tM=y?(l||(l=0),y.translate(V[l],V[l+1]),V[l]=V[l+1]=0,y):null,o&&p[o]&&(V=p[o](V)),V},p._getPointListByStr=function(B){var g,l,o=0;for(l=(g=B.split(",")).length,o=0;o<l;o++)g[o]=parseFloat(g[o]);return g},p._getObjVar=function(B,g,l){return B.hasOwnProperty(g)?B[g]:l},p._temParam=[],p._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},p.getClass=function(B){var g=p._classMap[B]||B;return"string"==typeof g?s.__classmap[g]:g},p._tM=null,p._alpha=NaN,d(p,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),p}(),T=function(){function U(B){if(this._color=[],"string"==typeof B){null===(this.strColor=B)&&(B="#000000"),"#"==B.charAt(0)&&(B=B.substr(1));var g=B.length;if(3==g||4==g){for(var l="",o=0;o<g;o++)l+=B[o]+B[o];B=l}var V=this.numColor=parseInt(B,16);if(8==B.length)return void(this._color=[parseInt(B.substr(0,2),16)/255,((16711680&V)>>16)/255,((65280&V)>>8)/255,(255&V)/255])}else V=this.numColor=B,this.strColor=$.toHexColor(V);this._color=[((16711680&V)>>16)/255,((65280&V)>>8)/255,(255&V)/255,1],this._color.__id=++U._COLODID}return N(U,"laya.utils.Color"),U._initDefault=function(){for(var B in U._DEFAULT={},U._COLOR_MAP)U._SAVE[B]=U._DEFAULT[B]=new U(U._COLOR_MAP[B]);return U._DEFAULT},U._initSaveMap=function(){for(var B in U._SAVE_SIZE=0,U._SAVE={},U._DEFAULT)U._SAVE[B]=U._DEFAULT[B]},U.create=function(B){var g=U._SAVE[B+""];return null!=g?g:(U._SAVE_SIZE<1e3||U._initSaveMap(),U._SAVE[B+""]=new U(B))},U._SAVE={},U._SAVE_SIZE=0,U._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},U._DEFAULT=U._initDefault(),U._COLODID=1,U}(),R=(function(){function B(){this._values=[],this._keys=[]}N(B,"laya.utils.Dictionary");var g=B.prototype;g.set=function(B,g){var l=this.indexOf(B);0<=l?this._values[l]=g:(this._keys.push(B),this._values.push(g))},g.indexOf=function(B){var g=this._keys.indexOf(B);return 0<=g?g:(B="string"==typeof B?Number(B):"number"==typeof B?B.toString():B,this._keys.indexOf(B))},g.get=function(B){var g=this.indexOf(B);return g<0?null:this._values[g]},g.remove=function(B){var g=this.indexOf(B);return 0<=g&&(this._keys.splice(g,1),this._values.splice(g,1),!0)},g.clear=function(){this._values.length=0,this._keys.length=0},A(0,g,"values",function(){return this._values}),A(0,g,"keys",function(){return this._keys})}(),function(){function B(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}N(B,"laya.utils.Dragging");var g=B.prototype;return g.start=function(B,g,l,o,V,U,y,G){void 0===G&&(G=.92),this.clearTimer(),this.target=B,this.area=g,this.hasInertia=l,this.elasticDistance=g?o:0,this.elasticBackTime=V,this.data=U,this._disableMouseEvent=y,this.ratio=G,1!=B.globalScaleX||1!=B.globalScaleY?this._parent=B.parent:this._parent=s.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,s.stage.on("mouseup",this,this.onStageMouseUp),s.stage.on("mouseout",this,this.onStageMouseUp),s.timer.frameLoop(1,this,this.loop)},g.clearTimer=function(){s.timer.clear(this,this.loop),s.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},g.stop=function(){this._dragging&&(x.instance.disableMouseEvent=!1,s.stage.off("mouseup",this,this.onStageMouseUp),s.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},g.loop=function(){var B=this._parent.getMousePoint(),g=B.x,l=B.y,o=g-this._lastX,V=l-this._lastY;if(this._clickOnly){if(!(1<Math.abs(o*s.stage._canvasTransform.getScaleX())||1<Math.abs(V*s.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),x.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(o,V);0==o&&0==V||(this._lastX=g,this._lastY=l,this.target.x+=o*this._elasticRateX,this.target.y+=V*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},g.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var B=this.area.x-this.target.x;else B=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-B/this.elasticDistance),this.target.y<this.area.y)var g=this.area.y-this.target.y;else g=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-g/this.elasticDistance)}},g.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},g.onStageMouseUp=function(B){if(x.instance.disableMouseEvent=!1,s.stage.off("mouseup",this,this.onStageMouseUp),s.stage.off("mouseout",this,this.onStageMouseUp),s.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var g=this._offsets.length,l=Math.min(g,6),o=this._offsets.length-l,V=g-1;o<V;V--)this._offsetY+=this._offsets[V--],this._offsetX+=this._offsets[V];this._offsetX=this._offsetX/l*2,this._offsetY=this._offsetY/l*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),s.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},g.checkElastic=function(){var B=NaN,g=NaN;if(this.target.x<this.area.x?B=this.area.x:this.target.x>this.area.x+this.area.width&&(B=this.area.x+this.area.width),this.target.y<this.area.y?g=this.area.y:this.target.y>this.area.y+this.area.height&&(g=this.area.y+this.area.height),isNaN(B)&&isNaN(g))this.clear();else{var l={};isNaN(B)||(l.x=B),isNaN(g)||(l.y=g),this._tween=J.to(this.target,l,this.elasticBackTime,W.sineOut,m.create(this,this.clear),0,!1,!1)}},g.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(s.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},g.clear=function(){if(this.target){this.clearTimer();var B=this.target;this.target=null,this._parent=null,B.event("dragend",this.data)}},B}()),W=function(){function G(){}return N(G,"laya.utils.Ease"),G.linearNone=function(B,g,l,o){return l*B/o+g},G.linearIn=function(B,g,l,o){return l*B/o+g},G.linearInOut=function(B,g,l,o){return l*B/o+g},G.linearOut=function(B,g,l,o){return l*B/o+g},G.bounceIn=function(B,g,l,o){return l-G.bounceOut(o-B,0,l,o)+g},G.bounceInOut=function(B,g,l,o){return B<.5*o?.5*G.bounceIn(2*B,0,l,o)+g:.5*G.bounceOut(2*B-o,0,l,o)+.5*l+g},G.bounceOut=function(B,g,l,o){return(B/=o)<1/2.75?l*(7.5625*B*B)+g:B<2/2.75?l*(7.5625*(B-=1.5/2.75)*B+.75)+g:B<2.5/2.75?l*(7.5625*(B-=2.25/2.75)*B+.9375)+g:l*(7.5625*(B-=2.625/2.75)*B+.984375)+g},G.backIn=function(B,g,l,o,V){return void 0===V&&(V=1.70158),l*(B/=o)*B*((V+1)*B-V)+g},G.backInOut=function(B,g,l,o,V){return void 0===V&&(V=1.70158),(B/=.5*o)<1?.5*l*(B*B*((1+(V*=1.525))*B-V))+g:l/2*((B-=2)*B*((1+(V*=1.525))*B+V)+2)+g},G.backOut=function(B,g,l,o,V){return void 0===V&&(V=1.70158),l*((B=B/o-1)*B*((V+1)*B+V)+1)+g},G.elasticIn=function(B,g,l,o,V,U){var y;return void 0===V&&(V=0),void 0===U&&(U=0),0==B?g:1==(B/=o)?g+l:(U||(U=.3*o),y=!V||0<l&&V<l||l<0&&V<-l?(V=l,U/4):U/G.PI2*Math.asin(l/V),-V*Math.pow(2,10*(B-=1))*Math.sin((B*o-y)*G.PI2/U)+g)},G.elasticInOut=function(B,g,l,o,V,U){var y;return void 0===V&&(V=0),void 0===U&&(U=0),0==B?g:2==(B/=.5*o)?g+l:(U||(U=o*(.3*1.5)),y=!V||0<l&&V<l||l<0&&V<-l?(V=l,U/4):U/G.PI2*Math.asin(l/V),B<1?V*Math.pow(2,10*(B-=1))*Math.sin((B*o-y)*G.PI2/U)*-.5+g:V*Math.pow(2,-10*(B-=1))*Math.sin((B*o-y)*G.PI2/U)*.5+l+g)},G.elasticOut=function(B,g,l,o,V,U){var y;return void 0===V&&(V=0),void 0===U&&(U=0),0==B?g:1==(B/=o)?g+l:(U||(U=.3*o),y=!V||0<l&&V<l||l<0&&V<-l?(V=l,U/4):U/G.PI2*Math.asin(l/V),V*Math.pow(2,-10*B)*Math.sin((B*o-y)*G.PI2/U)+l+g)},G.strongIn=function(B,g,l,o){return l*(B/=o)*B*B*B*B+g},G.strongInOut=function(B,g,l,o){return(B/=.5*o)<1?.5*l*B*B*B*B*B+g:.5*l*((B-=2)*B*B*B*B+2)+g},G.strongOut=function(B,g,l,o){return l*((B=B/o-1)*B*B*B*B+1)+g},G.sineInOut=function(B,g,l,o){return.5*-l*(Math.cos(Math.PI*B/o)-1)+g},G.sineIn=function(B,g,l,o){return-l*Math.cos(B/o*G.HALF_PI)+l+g},G.sineOut=function(B,g,l,o){return l*Math.sin(B/o*G.HALF_PI)+g},G.quintIn=function(B,g,l,o){return l*(B/=o)*B*B*B*B+g},G.quintInOut=function(B,g,l,o){return(B/=.5*o)<1?.5*l*B*B*B*B*B+g:.5*l*((B-=2)*B*B*B*B+2)+g},G.quintOut=function(B,g,l,o){return l*((B=B/o-1)*B*B*B*B+1)+g},G.quartIn=function(B,g,l,o){return l*(B/=o)*B*B*B+g},G.quartInOut=function(B,g,l,o){return(B/=.5*o)<1?.5*l*B*B*B*B+g:.5*-l*((B-=2)*B*B*B-2)+g},G.quartOut=function(B,g,l,o){return-l*((B=B/o-1)*B*B*B-1)+g},G.cubicIn=function(B,g,l,o){return l*(B/=o)*B*B+g},G.cubicInOut=function(B,g,l,o){return(B/=.5*o)<1?.5*l*B*B*B+g:.5*l*((B-=2)*B*B+2)+g},G.cubicOut=function(B,g,l,o){return l*((B=B/o-1)*B*B+1)+g},G.quadIn=function(B,g,l,o){return l*(B/=o)*B+g},G.quadInOut=function(B,g,l,o){return(B/=.5*o)<1?.5*l*B*B+g:.5*-l*(--B*(B-2)-1)+g},G.quadOut=function(B,g,l,o){return-l*(B/=o)*(B-2)+g},G.expoIn=function(B,g,l,o){return 0==B?g:l*Math.pow(2,10*(B/o-1))+g-.001*l},G.expoInOut=function(B,g,l,o){return 0==B?g:B==o?g+l:(B/=.5*o)<1?.5*l*Math.pow(2,10*(B-1))+g:.5*l*(2-Math.pow(2,-10*--B))+g},G.expoOut=function(B,g,l,o){return B==o?g+l:l*(1-Math.pow(2,-10*B/o))+g},G.circIn=function(B,g,l,o){return-l*(Math.sqrt(1-(B/=o)*B)-1)+g},G.circInOut=function(B,g,l,o){return(B/=.5*o)<1?.5*-l*(Math.sqrt(1-B*B)-1)+g:.5*l*(Math.sqrt(1-(B-=2)*B)+1)+g},G.circOut=function(B,g,l,o){return l*Math.sqrt(1-(B=B/o-1)*B)+g},G.HALF_PI=.5*Math.PI,G.PI2=2*Math.PI,G}(),n=function(){function H(){this._hit=null,this._unHit=null}N(H,"laya.utils.HitArea");var B=H.prototype;return B.isHit=function(B,g){return!!H.isHitGraphic(B,g,this.hit)&&!H.isHitGraphic(B,g,this.unHit)},B.contains=function(B,g){return this.isHit(B,g)},A(0,B,"hit",function(){return this._hit||(this._hit=new K),this._hit},function(B){this._hit=B}),A(0,B,"unHit",function(){return this._unHit||(this._unHit=new K),this._unHit},function(B){this._unHit=B}),H.isHitGraphic=function(B,g,l){if(!l)return!1;var o;if(!(o=l.cmds)&&l._one&&((o=H._cmds).length=1,o[0]=l._one),!o)return!1;var V,U,y=0;for(V=o.length,y=0;y<V;y++)if(U=o[y]){var G=E._context;switch(U.callee){case G._translate:case 6:B-=U[0],g-=U[1]}if(H.isHitCmd(B,g,U))return!0}return!1},H.isHitCmd=function(B,g,l){if(!l)return!1;var o=E._context,V=!1;switch(l.callee){case o._drawRect:case 13:H._rec.setTo(l[0],l[1],l[2],l[3]),V=H._rec.contains(B,g);break;case o._drawCircle:case o._fillCircle:case 14:V=(B-=l[0])*B+(g-=l[1])*g<l[2]*l[2];break;case o._drawPoly:case 18:B-=l[0],g-=l[1],V=H.ptInPolygon(B,g,l[2])}return V},H.ptInPolygon=function(B,g,l){var o;(o=H._ptPoint).setTo(B,g);var V,U=0,y=NaN,G=NaN,d=NaN,j=NaN;V=l.length;for(var A=0;A<V;A+=2){if(y=l[A],G=l[A+1],d=l[(A+2)%V],G!=(j=l[(A+3)%V]))if(!(o.y<Math.min(G,j)))if(!(o.y>=Math.max(G,j)))(o.y-G)*(d-y)/(j-G)+y>o.x&&U++}return U%2==1},H._cmds=[],d(H,["_rec",function(){return this._rec=new w},"_ptPoint",function(){return this._ptPoint=new X}]),H}(),L=(function(){function V(B,g,l,o){this.char=B,this.charNum=B.charCodeAt(0),this._x=this._y=0,this.width=g,this.height=l,this.style=o,this.isWord=!V._isWordRegExp.test(B)}N(V,"laya.utils.HTMLChar");var B=V.prototype;s.imps(B,{"laya.display.ILayout":!0}),B.setSprite=function(B){this._sprite=B},B.getSprite=function(){return this._sprite},B._isChar=function(){return!0},B._getCSSStyle=function(){return this.style},A(0,B,"width",function(){return this._w},function(B){this._w=B}),A(0,B,"x",function(){return this._x},function(B){this._sprite&&(this._sprite.x=B),this._x=B}),A(0,B,"y",function(){return this._y},function(B){this._sprite&&(this._sprite.y=B),this._y=B}),A(0,B,"height",function(){return this._h},function(B){this._h=B}),V._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function g(){}N(g,"laya.utils.Log"),g.enable=function(){g._logdiv||(g._logdiv=Y.window.document.createElement("div"),Y.window.document.body.appendChild(g._logdiv),g._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},g.toggle=function(){var B=g._logdiv.style;"1px"==B.width?B.width=B.height="50%":B.width=B.height="1px"},g.print=function(B){g._logdiv&&(g.maxCount<=g._count&&g.clear(),g._count++,g._logdiv.innerText+=B+"\n",g._logdiv.scrollTop=g._logdiv.scrollHeight)},g.clear=function(){g._logdiv.innerText="",g._count=0},g._logdiv=null,g._count=0,g.maxCount=20}(),function(){function g(){}N(g,"laya.utils.Mouse"),A(1,g,"cursor",function(){return g._style.cursor},function(B){g._style.cursor=B}),g.hide=function(){"none"!=g.cursor&&(g._preCursor=g.cursor,g.cursor="none")},g.show=function(){"none"==g.cursor&&(g.cursor=g._preCursor?g._preCursor:"auto")},g._preCursor=null,d(g,["_style",function(){return this._style=Y.document.body.style}])}(),function(){function U(){}return N(U,"laya.utils.Pool"),U.getPoolBySign=function(B){return U._poolDic[B]||(U._poolDic[B]=[])},U.clearBySign=function(B){U._poolDic[B]&&(U._poolDic[B].length=0)},U.recover=function(B,g){g.__InPool||(g.__InPool=!0,U.getPoolBySign(B).push(g))},U.getItemByClass=function(B,g){var l=U.getPoolBySign(B),o=l.length?l.pop():new g;return o.__InPool=!1,o},U.getItemByCreateFun=function(B,g,l){var o=U.getPoolBySign(B),V=o.length?o.pop():g.call(l);return V.__InPool=!1,V},U.getItem=function(B){var g=U.getPoolBySign(B),l=g.length?g.pop():null;return l&&(l.__InPool=!1),l},U._poolDic={},U.InPoolSign="__InPool",U}()),I=function(){function d(){}return N(d,"laya.utils.Stat"),A(1,d,"onclick",null,function(B){d._sp&&d._sp.on("click",d._sp,B),d._canvas&&(d._canvas.source.onclick=B,d._canvas.source.style.pointerEvents="")}),d.show=function(B,g,l){if(void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),!E.isConchApp||E.isConchWebGL){if(E.isConchWebGL||Y.onMiniGame||Y.onLimixiu||(d._useCanvas=!0),d._show=!0,d._fpsData.length=60,d._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},d._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},d._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},d._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},E.isWebGL)if(d._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},E.is3DMode){if(d._view[0].title="FPS(3D)",d._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},d._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},d._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==l){var o=8;d._view[o++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},d._view[o++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},d._view[o++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},d._view[o++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},d._view[o++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},d._view[o++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},d._view[o++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},d._view[o++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},d._view[o++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==l){o=8;d._view[o++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},d._view[o++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},d._view[o++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},d._view[o++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},d._view[o++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},d._view[o++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},d._view[o++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else d._view[0].title="FPS(WebGL)",d._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else d._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};d._useCanvas?d.createUIPre(B,g):d.createUI(B,g),d.enable()}else Y.window.conch.showFPS&&Y.window.conch.showFPS(B,g)},d.createUIPre=function(B,g){var l=Y.pixelRatio;d._width=170*l,d._vx=75*l,d._height=l*(12*d._view.length+3*l)+4,d._fontSize=12*l;for(var o=0;o<d._view.length;o++)d._view[o].x=4,d._view[o].y=o*d._fontSize+2*l;d._canvas||((d._canvas=new MB("2D")).size(d._width,d._height),(d._ctx=d._canvas.getContext("2d")).textBaseline="top",d._ctx.font=d._fontSize+"px Sans-serif",d._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+B+"px;top:"+g+"px;width:"+d._width/l+"px;height:"+d._height/l+"px;"),d._first=!0,d.loop(),d._first=!1,Y.container.appendChild(d._canvas.source)},d.createUI=function(B,g){var l=d._sp,o=Y.pixelRatio;l||(l=new HB,(d._leftText=new FB).pos(5,5),d._leftText.color="#ffffff",l.addChild(d._leftText),(d._txt=new FB).pos(80*o,5),d._txt.color="#ffffff",l.addChild(d._txt),d._sp=l),l.pos(B,g);for(var V="",U=0;U<d._view.length;U++){V+=d._view[U].title+"\n"}d._leftText.text=V;var y=170*o,G=o*(12*d._view.length+3*o)+4;d._txt.fontSize=d._fontSize*o,d._leftText.fontSize=d._fontSize*o,l.size(y,G),l.graphics.clear(),l.graphics.setAlpha(.5),l.graphics.drawRect(0,0,y,G,"#999999"),l.graphics.setAlpha(1),d.loop()},d.enable=function(){s.timer.frameLoop(1,d,d.loop)},d.hide=function(){d._show=!1,s.timer.clear(d,d.loop),d._canvas&&Y.removeElement(d._canvas.source)},d.clear=function(){d.trianglesFaces=d.drawCall=d.shaderCall=d.spriteCount=d.spriteRenderUseCacheCount=d.treeNodeCollision=d.treeSpriteCollision=d.canvasNormal=d.canvasBitmap=d.canvasReCache=0},d.loop=function(){d._count++;var B=Y.now();if(!(B-d._timer<1e3)){var g=d._count;if(d.FPS=Math.round(1e3*g/(B-d._timer)),d._show){d.trianglesFaces=Math.round(d.trianglesFaces/g),d.spriteCount=d._useCanvas?(d.drawCall=Math.round(d.drawCall/g)-2,d.shaderCall=Math.round(d.shaderCall/g),Math.round(d.spriteCount/g)-1):(d.drawCall=Math.round(d.drawCall/g)-2,d.shaderCall=Math.round(d.shaderCall/g)-4,Math.round(d.spriteCount/g)-4),d.spriteRenderUseCacheCount=Math.round(d.spriteRenderUseCacheCount/g),d.canvasNormal=Math.round(d.canvasNormal/g),d.canvasBitmap=Math.round(d.canvasBitmap/g),d.canvasReCache=Math.ceil(d.canvasReCache/g),d.treeNodeCollision=Math.round(d.treeNodeCollision/g),d.treeSpriteCollision=Math.round(d.treeSpriteCollision/g);var l=0<d.FPS?Math.floor(1e3/d.FPS).toString():" ";d._fpsStr=d.FPS+(d.renderSlow?" slow":"")+" "+l,d._spriteStr=d.spriteCount+(d.spriteRenderUseCacheCount?"/"+d.spriteRenderUseCacheCount:""),d._canvasStr=d.canvasReCache+"/"+d.canvasNormal+"/"+d.canvasBitmap,d.currentMemorySize=P.systemResourceManager.memorySize,d._useCanvas?d.renderInfoPre():d.renderInfo(),d.clear()}d._count=0,d._timer=B}},d.renderInfoPre=function(){if(d._canvas){var B=d._ctx;B.clearRect(d._first?0:d._vx,0,d._width,d._height);for(var g=E.WebGL.mainContext,l=0;l<d._view.length;l++){var o=d._view[l];d._first&&(B.fillStyle="white",B.fillText(o.title,o.x,o.y,null,null,null)),B.fillStyle=o.color;var V=-1;if((o=d._view[l]).varying){if(g)switch(o.varying){case 1:V=g.getParameter(g[o.value]);break;case 2:V=g.getExtension(o.value)}}else V=d[o.value];"M"==o.units&&(V=Math.floor(V/1048576*100)/100+" M"),"K"==o.units&&(V=Math.floor(V/1024*100)/100+" K"),"string"==o.units&&(V=V.match(/\d+\.?\d/i)),B.fillText(V+"",o.x+d._vx,o.y,null,null,null)}}},d.renderInfo=function(){for(var B="",g=E.WebGL.mainContext,l=0;l<d._view.length;l++){var o=d._view[l],V=-1;if(o.varying){if(g)switch(o.varying){case 1:V=g.getParameter(g[o.value]);break;case 2:V=g.getExtension(o.value)}}else V=d[o.value];"M"==o.units&&(V=Math.floor(V/1048576*100)/100+" M"),"K"==o.units&&(V=Math.floor(V/1024*100)/100+" K"),"string"==o.units&&(V=V.match(/\d+\.?\d/i)),B+=V+"\n"}d._txt.text=B},d.FPS=0,d.loopCount=0,d.shaderCall=0,d.drawCall=0,d.trianglesFaces=0,d.spriteCount=0,d.spriteRenderUseCacheCount=0,d.treeNodeCollision=0,d.treeSpriteCollision=0,d.canvasNormal=0,d.canvasBitmap=0,d.canvasReCache=0,d.renderSlow=!1,d.currentMemorySize=0,d._fpsStr=null,d._canvasStr=null,d._spriteStr=null,d._fpsData=[],d._timer=0,d._count=0,d._view=[],d._fontSize=12,d._txt=null,d._leftText=null,d._sp=null,d._show=!1,d._useCanvas=!1,d._canvas=null,d._ctx=null,d._first=!1,d._vx=NaN,d._width=0,d._height=100,d}(),k=(function(){function B(){this._strsToID={},this._idToStrs=[],this._length=0}N(B,"laya.utils.StringKey");var g=B.prototype;g.add=function(B){var g=this._strsToID[B];return null!=g?g:(this._idToStrs[this._length]=B,this._strsToID[B]=this._length++)},g.getID=function(B){var g=this._strsToID[B];return null==g?-1:g},g.getName=function(B){var g=this._idToStrs[B];return null==g?void 0:g}}(),function(){var j;function B(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}N(B,"laya.utils.Timer");var g=B.prototype;return g._init=function(){s.timer&&s.timer.frameLoop(1,this,this._update)},g._now=function(){return Date.now()},g._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var B=this.currFrame=this.currFrame+this.scale,g=this._now();this._delta=(g-this._lastTimer)*this.scale;var l=this.currTimer=this.currTimer+this._delta;s.isDebug&&6e4<Math.abs(g-this._lastTimer)&&console.error("系统时间错误！"+(g-this._lastTimer)),this._lastTimer=g;var o=this._handlers;for(y=this._count=0,G=o.length;y<G;y++)if(null!==(d=o[y]).method){var V=d.userFrame?B:l;if(V>=d.exeTime)if(d.repeat)if(d.jumpFrame)for(;V>=d.exeTime;)d.exeTime+=d.delay,d.run(!1);else d.exeTime+=d.delay,d.run(!1),V>d.exeTime&&(d.exeTime+=Math.ceil((V-d.exeTime)/d.delay)*d.delay);else d.run(!0)}else this._count++;(30<this._count||B%200==0)&&this._clearHandlers();for(var U=this._laters,y=0,G=U.length-1;y<=G;y++){var d=U[y];this._isIgnoreRecover(d)||(null!==d.method&&(delete this._map[d.key],d.run(!1)),this._recoverHandler(d)),y===G&&(G=U.length-1)}U.length=0}},g._clearHandlers=function(){for(var B=this._handlers,g=0,l=B.length;g<l;g++){var o=B[g];null!==o.method?this._temp.push(o):this._isIgnoreRecover(o)?this._temp.push(o):this._recoverHandler(o)}this._handlers=this._temp,this._temp=B,this._temp.length=0},g._recoverHandler=function(B){this._map[B.key]==B&&delete this._map[B.key],B.recover()},g._create=function(B,g,l,o,V,U,y,G){if(!l)return V.apply(o,U),null;if(y){var d=this._getHandler(o,V);if(d)return d.repeat=g,d.userFrame=B,d.delay=l,d.ignoreRecover=G,d.caller=o,d.method=V,d.args=U,d.exeTime=l+(B?this.currFrame:this.currTimer+this._now()-this._lastTimer),d}return(d=j.create()).repeat=g,d.userFrame=B,d.delay=l,d.ignoreRecover=G,d.caller=o,d.method=V,d.args=U,d.exeTime=l+(B?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(d),this._handlers.push(d),d},g._indexHandler=function(B){var g=B.caller,l=B.method,o=g?g.$_GID||(g.$_GID=$.getGID()):0,V=l.$_TID||(l.$_TID=this._mid++);B.key=o+"_"+V,this._map[B.key]=B},g.once=function(B,g,l,o,V){void 0===V&&(V=!0),this._create(!1,!1,B,g,l,o,V,!1)},g.loop=function(B,g,l,o,V,U,y){void 0===V&&(V=!0),void 0===U&&(U=!1),void 0===y&&(y=!1);var G=this._create(!1,!0,B,g,l,o,V,y);G&&(G.jumpFrame=U)},g.frameOnce=function(B,g,l,o,V){void 0===V&&(V=!0),this._create(!0,!1,B,g,l,o,V,!1)},g.frameLoop=function(B,g,l,o,V,U){void 0===V&&(V=!0),void 0===U&&(U=!1),this._create(!0,!0,B,g,l,o,V,U)},g.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+j._freeCount},g.clear=function(B,g){var l=this._getHandler(B,g);return!(!l||this._isIgnoreRecover(l))&&(delete this._map[l.key],l.key=null,l.clear(),!0)},g.clearAll=function(B){if(B)for(var g=0,l=this._handlers.length;g<l;g++){var o=this._handlers[g];o.caller===B&&(this._isIgnoreRecover(o)||(delete this._map[o.key],o.key=null,o.clear()))}},g._getHandler=function(B,g){var l=B?B.$_GID||(B.$_GID=$.getGID()):0,o=g.$_TID||(g.$_TID=this._mid++);return this._map[l+"_"+o]},g._isIgnoreRecover=function(B){if(B.ignoreRecover||B.caller&&"IgnoreRecover"==B.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var g="";try{arguments.propertyIsEnumerable.caller}catch(B){g=B.stack}s.recordError("报错：核心定时器销毁忽略  "+g)}return!0}return!1},g.hasHandler=function(B,g){return this._map[B.$_GID+"_"+g.$_TID]},g.callLater=function(B,g,l){if(null==this._getHandler(B,g)){var o=j.create();o.caller=B,o.method=g,o.args=l,this._indexHandler(o),this._laters.push(o)}},g.runCallLater=function(B,g){var l=this._getHandler(B,g);l&&null!=l.method&&(this._isIgnoreRecover(l)||(delete this._map[l.key],l.run(!0)))},g.runTimer=function(B,g){this.runCallLater(B,g)},A(0,g,"delta",function(){return this._delta}),B.__init$=function(){j=function(){function g(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}N(g,"");var B=g.prototype;return B.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},B.recover=function(){this.clear(),this.args=g._freeHandler,g._freeHandler=this,g._freeCount++},B.run=function(B){var g=this.caller;if(g&&g.destroyed)return this.clear();var l=this.method,o=this.args;B&&this.clear(),null!=l&&(o?l.apply(g,o):l.call(g))},g._freeHandler=null,g._freeCount=0,g.create=function(){var B=g._freeHandler;return B?(g._freeHandler=B.args,--g._freeCount,B.args=null,B):new g},g}()},B}()),J=function(){function H(){this.gid=0}N(H,"laya.utils.Tween");var B=H.prototype;return B.to=function(B,g,l,o,V,U,y){return void 0===U&&(U=0),void 0===y&&(y=!1),this._create(B,g,l,o,V,U,y,!0,!1,!0)},B.from=function(B,g,l,o,V,U,y){return void 0===U&&(U=0),void 0===y&&(y=!1),this._create(B,g,l,o,V,U,y,!1,!1,!0)},B._create=function(B,g,l,o,V,U,y,G,d,j){if(!B)throw new Error("Tween:target is null");this._target=B,this._duration=l,this._ease=o||g.ease||H.easeNone,this._complete=V||g.complete,this._delay=U,this._props=[],this._usedTimer=0,this._startTimer=Y.now(),this._usedPool=d,this._delayParam=null,this.update=g.update;var A=B.$_GID||(B.$_GID=$.getGID());return H.tweenMap[A]?(y&&H.clearTween(B),H.tweenMap[A].push(this)):H.tweenMap[A]=[this],j?U<=0?this.firstStart(B,g,G):(this._delayParam=[B,g,G],s.scaleTimer.once(U,this,this.firstStart,this._delayParam)):this._initProps(B,g,G),this},B.firstStart=function(B,g,l){this._delayParam=null,B.destroyed?this.clear():(this._initProps(B,g,l),this._beginLoop())},B._initProps=function(B,g,l){for(var o in g)if("number"==typeof B[o]){var V=l?B[o]:g[o],U=l?g[o]:B[o];this._props.push([o,V,U-V]),l||(B[o]=V)}},B._beginLoop=function(){s.scaleTimer.frameLoop(1,this,this._doEase)},B._doEase=function(){this._updateEase(Y.now())},B._updateEase=function(B){var g=this._target;if(g){if(g.destroyed)return H.clearTween(g);var l=this._usedTimer=B-this._startTimer-this._delay;if(!(l<0)){if(l>=this._duration)return this.complete();for(var o=0<l?this._ease(l,0,1,this._duration):0,V=this._props,U=0,y=V.length;U<y;U++){var G=V[U];g[G[0]]=G[1]+o*G[2]}this.update&&this.update.run()}}},B.complete=function(){if(this._target){s.scaleTimer.runTimer(this,this.firstStart);for(var B=this._target,g=this._props,l=this._complete,o=0,V=g.length;o<V;o++){var U=g[o];B[U[0]]=U[1]+U[2]}this.update&&this.update.run(),this.clear(),l&&l.run()}},B.pause=function(){s.scaleTimer.clear(this,this._beginLoop),s.scaleTimer.clear(this,this._doEase),s.scaleTimer.clear(this,this.firstStart);var B;(B=Y.now()-this._startTimer-this._delay)<0&&(this._usedTimer=B)},B.setStartTime=function(B){this._startTimer=B},B.clear=function(){this._target&&(this._remove(),this._clear())},B._clear=function(){this.pause(),s.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,L.recover("tween",this))},B.recover=function(){this._usedPool=!0,this._clear()},B._remove=function(){var B=H.tweenMap[this._target.$_GID];if(B)for(var g=0,l=B.length;g<l;g++)if(B[g]===this){B.splice(g,1);break}},B.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=Y.now(),this._delayParam)s.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var B=this._props,g=0,l=B.length;g<l;g++){var o=B[g];this._target[o[0]]=o[1]}s.scaleTimer.once(this._delay,this,this._beginLoop)}},B.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Y.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?s.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},A(0,B,"progress",null,function(B){var g=B*this._duration;this._startTimer=Y.now()-this._delay-g}),H.to=function(B,g,l,o,V,U,y,G){return void 0===U&&(U=0),void 0===y&&(y=!1),void 0===G&&(G=!0),L.getItemByClass("tween",H)._create(B,g,l,o,V,U,y,!0,G,!0)},H.from=function(B,g,l,o,V,U,y,G){return void 0===U&&(U=0),void 0===y&&(y=!1),void 0===G&&(G=!0),L.getItemByClass("tween",H)._create(B,g,l,o,V,U,y,!1,G,!0)},H.clearAll=function(B){if(B&&B.$_GID){var g=H.tweenMap[B.$_GID];if(g){for(var l=0,o=g.length;l<o;l++)g[l]._clear();g.length=0}}},H.clear=function(B){B.clear()},H.clearTween=function(B){H.clearAll(B)},H.easeNone=function(B,g,l,o){return l*B/o+g},H.tweenMap={},H}(),$=function(){function G(){}return N(G,"laya.utils.Utils"),G.toRadian=function(B){return B*G._pi2},G.toAngle=function(B){return B*G._pi},G.toHexColor=function(B){if(B<0||isNaN(B))return null;for(var g=B.toString(16);g.length<6;)g="0"+g;return"#"+g},G.getGID=function(){return G._gid++},G.concatArray=function(B,g){if(!g)return B;if(!B)return g;var l=0,o=g.length;for(l=0;l<o;l++)B.push(g[l]);return B},G.clearArray=function(B){return B&&(B.length=0),B},G.copyArray=function(B,g){if(B||(B=[]),!g)return B;B.length=g.length;var l=0,o=g.length;for(l=0;l<o;l++)B[l]=g[l];return B},G.getGlobalRecByPoints=function(B,g,l,o,V){var U,y;return U=new X(g,l),U=B.localToGlobal(U),y=new X(o,V),y=B.localToGlobal(y),w._getWrapRec([U.x,U.y,y.x,y.y])},G.getGlobalPosAndScale=function(B){return G.getGlobalRecByPoints(B,0,0,1,1)},G.bind=function(B,g){return B.bind(g)},G.measureText=function(B,g){return t.measureText(B,g)},G.contextMeasureText=function(B){var g=Y.context.measureText(B);return g||(g={width:16,height:16}),g},G.updateOrder=function(B){if(!B||B.length<2)return!1;for(var g,l=1,o=0,V=B.length,U=NaN;l<V;){for(g=B[o=l],U=B[o]._zOrder;-1<--o&&B[o]._zOrder>U;)B[o+1]=B[o];B[o+1]=g,l++}var y=g.parent.conchModel;if(y)if(null!=y.updateZOrder)y.updateZOrder();else{for(l=0;l<V;l++)y.removeChild(B[l].conchModel);for(l=0;l<V;l++)y.addChildAt(B[l].conchModel,l)}return!0},G.transPointList=function(B,g,l){var o=0,V=B.length;for(o=0;o<V;o+=2)B[o]+=g,B[o+1]+=l},G.parseInt=function(B,g){void 0===g&&(g=0);var l=Y.window.parseInt(B,g);return isNaN(l)?0:l},G.getFileExtension=function(B){G._extReg.lastIndex=B.lastIndexOf(".");var g=G._extReg.exec(B);return g&&1<g.length?g[1].toLowerCase():null},G.getTransformRelativeToWindow=function(B,g,l){var o=s.stage,V=laya.utils.Utils.getGlobalPosAndScale(B),U=o._canvasTransform.clone(),y=U.tx,G=U.ty;U.rotate(-Math.PI/180*s.stage.canvasDegree),U.scale(s.stage.clientScaleX,s.stage.clientScaleY);var d=s.stage.canvasDegree%180!=0,j=NaN,A=NaN;d?(j=l+V.y,A=g+V.x,j*=U.d,A*=U.a,90==s.stage.canvasDegree?(j=y-j,A+=G):(j+=y,A=G-A)):(j=g+V.x,A=l+V.y,j*=U.a,A*=U.d,j+=y,A+=G);var H=NaN,K=NaN;return K=d?(H=U.d*V.height,U.a*V.width):(H=U.a*V.width,U.d*V.height),{x:j,y:A,scaleX:H,scaleY:K}},G.fitDOMElementInArea=function(B,g,l,o,V,U){B._fitLayaAirInitialized||(B._fitLayaAirInitialized=!0,B.style.transformOrigin=B.style.webKittransformOrigin="left top",B.style.position="absolute");var y=G.getTransformRelativeToWindow(g,l,o);B.style.transform=B.style.webkitTransform="scale("+y.scaleX+","+y.scaleY+") rotate("+s.stage.canvasDegree+"deg)",B.style.width=V+"px",B.style.height=U+"px",B.style.left=y.x+"px",B.style.top=y.y+"px"},G.isOkTextureList=function(B){if(!B)return!1;var g,l=0,o=B.length;for(l=0;l<o;l++)if(!(g=B[l])||!g.source)return!1;return!0},G.isOKCmdList=function(B){if(!B)return!1;var g,l,o=0,V=B.length,U=E._context;for(o=0;o<V;o++)switch((g=B[o]).callee){case U._drawTexture:case U._fillTexture:case U._drawTextureWithTransform:if(!(l=g[0])||!l.source)return!1}return!0},G._gid=1,G._pi=180/Math.PI,G._pi2=Math.PI/180,G._extReg=/\.(\w+)\??/g,G.parseXMLFromString=function(B){var g;if(B=B.replace(/>\s+</g,"><"),-1<(g=(new DOMParser).parseFromString(B,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(g.firstChild.firstChild.textContent);return g},G}(),u=function(){function B(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],E.isWebGL&&r.regCacheByFunction($.bind(this.startDispose,this),$.bind(this.getCacheList,this))}N(B,"laya.utils.VectorGraphManager");var g=B.prototype;return g.getId=function(){return this._id++},g.addShape=function(B,g){this.shapeDic[B]=g,this.useDic[B]||(this.useDic[B]=!0)},g.addLine=function(B,g){this.shapeLineDic[B]=g,this.shapeLineDic[B]||(this.shapeLineDic[B]=!0)},g.getShape=function(B){this._checkKey&&null!=this.useDic[B]&&(this.useDic[B]=!0)},g.deleteShape=function(B){this.shapeDic[B]&&(this.shapeDic[B]=null,delete this.shapeDic[B]),this.shapeLineDic[B]&&(this.shapeLineDic[B]=null,delete this.shapeLineDic[B]),null!=this.useDic[B]&&delete this.useDic[B]},g.getCacheList=function(){var B,g=[];for(B in this.shapeDic)g.push(this.shapeDic[B]);for(B in this.shapeLineDic)g.push(this.shapeLineDic[B]);return g},g.startDispose=function(B){var g;for(g in this.useDic)this.useDic[g]=!1;this._checkKey=!0},g.endDispose=function(){if(this._checkKey){var B;for(B in this.useDic)this.useDic[B]||this.deleteShape(B);this._checkKey=!1}},B.getInstance=function(){return B.instance=B.instance||new B},B.instance=null,B}(),q=function(){function o(){this._obj=null,this._obj=o.supportWeakMap?new Y.window.WeakMap:{},o.supportWeakMap||o._maps.push(this)}N(o,"laya.utils.WeakObject");var B=o.prototype;return B.set=function(B,g){if(null!=B)if(o.supportWeakMap){var l=B;"string"!=typeof B&&"number"!=typeof B||(l=o._keys[B])||(l=o._keys[B]={k:B}),this._obj.set(l,g)}else"string"==typeof B||"number"==typeof B?this._obj[B]=g:(B.$_GID||(B.$_GID=$.getGID()),this._obj[B.$_GID]=g)},B.get=function(B){if(null==B)return null;if(o.supportWeakMap){var g="string"==typeof B||"number"==typeof B?o._keys[B]:B;return g?this._obj.get(g):null}return"string"==typeof B||"number"==typeof B?this._obj[B]:this._obj[B.$_GID]},B.del=function(B){if(null!=B)if(o.supportWeakMap){var g="string"==typeof B||"number"==typeof B?o._keys[B]:B;if(!g)return;this._obj.delete(g)}else"string"==typeof B||"number"==typeof B?delete this._obj[B]:delete this._obj[this._obj.$_GID]},B.has=function(B){if(null==B)return!1;if(o.supportWeakMap){var g="string"==typeof B||"number"==typeof B?o._keys[B]:B;return this._obj.has(g)}return"string"==typeof B||"number"==typeof B?null!=this._obj[B]:null!=this._obj[this._obj.$_GID]},o.__init__=function(){(o.supportWeakMap=null!=Y.window.WeakMap)||s.timer.loop(o.delInterval,null,o.clearCache)},o.clearCache=function(){for(var B=0,g=o._maps.length;B<g;B++){o._maps[B]._obj={}}},o.supportWeakMap=!1,o.delInterval=3e5,o._keys={},o._maps=[],d(o,["I",function(){return this.I=new o}]),o}(),O=function(){function B(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}N(B,"laya.utils.WordText");var g=B.prototype;return g.setText=function(B){this.changed=!0,this._text=B},g.toString=function(){return this._text},g.charCodeAt=function(B){return this._text?this._text.charCodeAt(B):NaN},g.charAt=function(B){return this._text?this._text.charAt(B):null},A(0,g,"length",function(){return this._text?this._text.length:0}),B}(),BB=function(B){function y(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,y.__super.call(this),this._childs=y.ARRAY_EMPTY,this._$P=y.PROP_EMPTY,this.timer=s.scaleTimer,this.conchModel=E.isConchNode?this.createConchModel():null}N(y,"laya.display.Node",j);var g=y.prototype;return g._setBit=function(B,g){1==B&&(this._getBit(B)!=g&&this._updateDisplayedInstage());g?this._bits|=B:this._bits&=~B},g._getBit=function(B){return 0!=(this._bits&B)},g._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},g._setUpNoticeType=function(B){var g=this;for(g._setBit(B,!0),g=g.parent;g;){if(g._getBit(B))return;g._setBit(B,!0),g=g.parent}},g.on=function(B,g,l,o){return"display"!==B&&"undisplay"!==B||this._getBit(1)||this._setUpNoticeType(1),this._createListener(B,g,l,o,!1)},g.once=function(B,g,l,o){return"display"!==B&&"undisplay"!==B||this._getBit(1)||this._setUpNoticeType(1),this._createListener(B,g,l,o,!0)},g.createConchModel=function(){return null},g.destroy=function(B){void 0===B&&(B=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(B?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},g.destroyChildren=function(){if(this._childs)for(var B=this._childs.length-1;-1<B;B--)this._childs[B].destroy(!0)},g.addChild=function(B){if(!B||this.destroyed||B===this)return B;if(B.zOrder&&this._set$P("hasZorder",!0),B._parent===this){var g=this.getChildIndex(B);g!==this._childs.length-1&&(this._childs.splice(g,1),this._childs.push(B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,this._childs.length-1)),this._childChanged())}else B.parent&&B.parent.removeChild(B),this._childs===y.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(B),this.conchModel&&this.conchModel.addChildAt(B.conchModel,this._childs.length-1),(B.parent=this)._childChanged();return B},g.addChildren=function(B){for(var g=arguments,l=0,o=g.length;l<o;)this.addChild(g[l++])},g.addChildAt=function(B,g){if(!B||this.destroyed||B===this)return B;if(B.zOrder&&this._set$P("hasZorder",!0),0<=g&&g<=this._childs.length){if(B._parent===this){var l=this.getChildIndex(B);this._childs.splice(l,1),this._childs.splice(g,0,B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,g)),this._childChanged()}else B.parent&&B.parent.removeChild(B),this._childs===y.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(g,0,B),this.conchModel&&this.conchModel.addChildAt(B.conchModel,g),B.parent=this;return B}throw new Error("appendChildAt:The index is out of bounds")},g.getChildIndex=function(B){return this._childs.indexOf(B)},g.getChildByName=function(B){var g=this._childs;if(g)for(var l=0,o=g.length;l<o;l++){var V=g[l];if(V.name===B)return V}return null},g._get$P=function(B){return this._$P[B]},g._set$P=function(B,g){return this.destroyed||(this._$P===y.PROP_EMPTY&&(this._$P={}),this._$P[B]=g),g},g.getChildAt=function(B){return this._childs[B]},g.setChildIndex=function(B,g){var l=this._childs;if(g<0||g>=l.length)throw new Error("setChildIndex:The index is out of bounds.");var o=this.getChildIndex(B);if(o<0)throw new Error("setChildIndex:node is must child of this object.");return l.splice(o,1),l.splice(g,0,B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,g)),this._childChanged(),B},g._childChanged=function(B){},g.removeChild=function(B){if(!this._childs)return B;var g=this._childs.indexOf(B);return this.removeChildAt(g)},g.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},g.removeChildByName=function(B){var g=this.getChildByName(B);return g&&this.removeChild(g),g},g.removeChildAt=function(B){var g=this.getChildAt(B);if(g){for(var l=this._childs.length-1,o=B;o<l;++o)this._childs[o]=this._childs[o+1];this._childs.length=l,this.conchModel&&this.conchModel.removeChild(g.conchModel),g.parent=null}return g},g.removeChildren=function(B,g){if(void 0===B&&(B=0),void 0===g&&(g=2147483647),this._childs&&0<this._childs.length){var l=this._childs;if(0===B&&U<=g){var o=l;this._childs=y.ARRAY_EMPTY}else o=l.splice(B,g-B);for(var V=0,U=o.length;V<U;V++)o[V].parent=null,this.conchModel&&this.conchModel.removeChild(o[V].conchModel)}return this},g.replaceChild=function(B,g){var l=this._childs.indexOf(g);return-1<l?(this._childs.splice(l,1,B),this.conchModel&&(this.conchModel.removeChild(g.conchModel),this.conchModel.addChildAt(B.conchModel,l)),g.parent=null,B.parent=this,B):null},g._updateDisplayedInstage=function(){var B;B=this;var g=s.stage;for(this._displayedInStage=!1;B;){if(B._getBit(1)){this._displayedInStage=B._displayedInStage;break}if(B==g||B._displayedInStage){this._displayedInStage=!0;break}B=B.parent}},g._setDisplay=function(B){this._displayedInStage!==B&&((this._displayedInStage=B)?this.event("display"):this.event("undisplay"))},g._displayChild=function(B,g){var l=B._childs;if(l)for(var o=0;o<l.length;o++){var V=l[o];V&&V._getBit(1)&&(0<V._childs.length?this._displayChild(V,g):V._setDisplay(g))}B._setDisplay(g)},g.contains=function(B){if(B===this)return!0;for(;B;){if(B.parent===this)return!0;B=B.parent}return!1},g.timerLoop=function(B,g,l,o,V,U){void 0===V&&(V=!0),void 0===U&&(U=!1),this.timer.loop(B,g,l,o,V,U)},g.timerOnce=function(B,g,l,o,V){void 0===V&&(V=!0),this.timer._create(!1,!1,B,g,l,o,V)},g.frameLoop=function(B,g,l,o,V){void 0===V&&(V=!0),this.timer._create(!0,!0,B,g,l,o,V)},g.frameOnce=function(B,g,l,o,V){void 0===V&&(V=!0),this.timer._create(!0,!1,B,g,l,o,V)},g.clearTimer=function(B,g){this.timer.clear(B,g)},A(0,g,"numChildren",function(){return this._childs.length}),A(0,g,"destroyed",function(){return this._destroyed}),A(0,g,"parent",function(){return this._parent},function(B){this._parent!==B&&(B?(this._parent=B,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),B.displayedInStage&&this._displayChild(this,!0)),B._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=B))}),A(0,g,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),y.ARRAY_EMPTY=[],y.PROP_EMPTY={},y.NOTICE_DISPLAY=1,y.MOUSEENABLE=2,y}(),gB=function(B){function K(B){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,K.__super.call(this),this._padding=K._PADDING,this._spacing=K._SPACING,this._aligns=K._ALIGNS,this._font=p.EMPTY,this._ower=B}N(K,"laya.display.css.CSSStyle",B);var g=K.prototype;return g.destroy=function(){this._ower=null,this._font=null,this._rect=null},g.inherit=function(B){this._font=B._font,this._spacing=B._spacing===K._SPACING?K._SPACING:B._spacing.slice(),this.lineHeight=B.lineHeight},g._widthAuto=function(){return 0!=(262144&this._type)},g.widthed=function(B){return 0!=(8&this._type)},g._calculation=function(B,g){if(g.indexOf("%")<0)return!1;var o=this._ower,V=o.parent,U=this._rect;function y(B,g,l){return B*l[0]+g*l[1]+l[2]}function l(B){var g=V.width,l=o.width;U.width&&(o.width=y(g,l,U.width)),U.height&&(o.height=y(g,l,U.height)),U.left&&(o.x=y(g,l,U.left)),U.top&&(o.y=y(g,l,U.top))}null===U&&(V._getCSSStyle()._type|=524288,V.on("resize",this,l),this._rect=U={input:{}});var G=g.split(" ");return G[0]=parseFloat(G[0])/100,1==G.length?G[1]=G[2]=0:(G[1]=parseFloat(G[1])/100,G[2]=parseFloat(G[2])),U[B]=G,U.input[B]=g,l(),!0},g.heighted=function(B){return 0!=(8192&this._type)},g.size=function(B,g){var l=this._ower,o=!1;-1!==B&&B!=this._ower.width&&(this._type|=8,this._ower.width=B,o=!0),-1!==g&&g!=this._ower.height&&(this._type|=8192,this._ower.height=g,o=!0),o&&(l._layoutLater(),524288&this._type&&l.event("resize",this))},g._getAlign=function(){return this._aligns[0]},g._getValign=function(){return this._aligns[1]},g._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},g._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new p(this._font))},g.render=function(B,g,l,o){var V=B.width,U=B.height;l-=B.pivotX,o-=B.pivotY,this._bgground&&null!=this._bgground.color&&g.ctx.fillRect(l,o,V,U,this._bgground.color),this._border&&this._border.color&&g.drawRect(l,o,V,U,this._border.color.strColor,this._border.size)},g.getCSSStyle=function(){return this},g.cssText=function(B){this.attrs(K.parseOneCSS(B,";"))},g.attrs=function(B){if(B)for(var g=0,l=B.length;g<l;g++){var o=B[g];this[o[0]]=o[1]}},g.setTransform=function(B){"none"===B?this._tf=G._TF_EMPTY:this.attrs(K.parseOneCSS(B,","))},g.translate=function(B,g){this._tf===G._TF_EMPTY&&(this._tf=new V),this._tf.translateX=B,this._tf.translateY=g},g.scale=function(B,g){this._tf===G._TF_EMPTY&&(this._tf=new V),this._tf.scaleX=B,this._tf.scaleY=g},g._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},A(0,g,"block",B.prototype._$get_block,function(B){B?this._type|=1:this._type&=-2}),A(0,g,"valign",function(){return K._valigndef[this._aligns[1]]},function(B){this._aligns===K._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=K._valigndef[B]}),A(0,g,"height",null,function(B){if(this._type|=8192,"string"==typeof B){if(this._calculation("height",B))return;B=parseInt(B)}this.size(-1,B)}),A(0,g,"width",null,function(B){if(this._type|=8,"string"==typeof B){var g=B.indexOf("auto");if(0<=g&&(this._type|=262144,B=B.substr(0,g)),this._calculation("width",B))return;B=parseInt(B)}this.size(B,-1)}),A(0,g,"fontWeight",function(){return this._font.weight},function(B){this._createFont().weight=B}),A(0,g,"left",null,function(B){var g=this._ower;if("string"==typeof B){if("center"===B?B="50% -50% 0":"right"===B&&(B="100% -100% 0"),this._calculation("left",B))return;B=parseInt(B)}g.x=B}),A(0,g,"_translate",null,function(B){this.translate(B[0],B[1])}),A(0,g,"absolute",function(){return 0!=(4&this._type)}),A(0,g,"top",null,function(B){var g=this._ower;if("string"==typeof B){if("middle"===B?B="50% -50% 0":"bottom"===B&&(B="100% -100% 0"),this._calculation("top",B))return;B=parseInt(B)}g.y=B}),A(0,g,"align",function(){return K._aligndef[this._aligns[0]]},function(B){this._aligns===K._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=K._aligndef[B]}),A(0,g,"bold",function(){return this._font.bold},function(B){this._createFont().bold=B}),A(0,g,"padding",function(){return this._padding},function(B){this._padding=B}),A(0,g,"leading",function(){return this._spacing[1]},function(B){"string"==typeof B&&(B=parseInt(B+"")),this._spacing===K._SPACING&&(this._spacing=[0,0]),this._spacing[1]=B}),A(0,g,"lineElement",function(){return 0!=(65536&this._type)},function(B){B?this._type|=65536:this._type&=-65537}),A(0,g,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(B){this.lineElement=!1,"right"===B?this._type|=32768:this._type&=-32769}),A(0,g,"textDecoration",function(){return this._font.decoration},function(B){this._createFont().decoration=B}),A(0,g,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(B){"nowrap"===B&&(this._type|=131072),"none"===B&&(this._type&=-131073)}),A(0,g,"background",null,function(B){B?(this._bgground||(this._bgground={}),this._bgground.color=B,this._ower.conchModel&&this._ower.conchModel.bgColor(B),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),A(0,g,"wordWrap",function(){return 0==(131072&this._type)},function(B){B?this._type&=-131073:this._type|=131072}),A(0,g,"color",function(){return this._font.color},function(B){this._createFont().color=B}),A(0,g,"password",function(){return this._font.password},function(B){this._createFont().password=B}),A(0,g,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(B){"none"===B?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=B),this._ower.conchModel&&this._ower.conchModel.bgColor(B),this._ower._renderType|=256}),A(0,g,"font",function(){return this._font.toString()},function(B){this._createFont().set(B)}),A(0,g,"weight",null,function(B){this._createFont().weight=B}),A(0,g,"letterSpacing",function(){return this._spacing[0]},function(B){"string"==typeof B&&(B=parseInt(B+"")),this._spacing===K._SPACING&&(this._spacing=[0,0]),this._spacing[0]=B}),A(0,g,"fontSize",function(){return this._font.size},function(B){this._createFont().size=B}),A(0,g,"italic",function(){return this._font.italic},function(B){this._createFont().italic=B}),A(0,g,"fontFamily",function(){return this._font.family},function(B){this._createFont().family=B}),A(0,g,"stroke",function(){return this._font.stroke[0]},function(B){this._createFont().stroke===p._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=B}),A(0,g,"strokeColor",function(){return this._font.stroke[1]},function(B){this._createFont().stroke===p._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=B}),A(0,g,"border",function(){return this._border?this._border.value:""},function(B){if("none"!=B){this._border||(this._border={});var g=(this._border.value=B).split(" ");if(this._border.color=T.create(g[g.length-1]),1==g.length)return this._border.size=1,void(this._border.type="solid");var l=0;0<g[0].indexOf("px")?(this._border.size=parseInt(g[0]),l++):this._border.size=1,this._border.type=g[l],this._ower._renderType|=256}else this._border=null}),A(0,g,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(B){B?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==B?null:T.create(B),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),A(0,g,"position",function(){return 4&this._type?"absolute":""},function(B){"absolute"==B?this._type|=4:this._type&=-5}),A(0,g,"display",null,function(B){switch(B){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),A(0,g,"paddingLeft",function(){return this.padding[3]}),A(0,g,"paddingTop",function(){return this.padding[0]}),A(0,g,"_scale",null,function(B){this._ower.scale(B[0],B[1])}),A(0,g,"_rotate",null,function(B){this._ower.rotation=B}),K.parseOneCSS=function(B,g){for(var l,o=[],V=B.split(g),U=0,y=V.length;U<y;U++){var G=V[U],d=G.indexOf(":"),j=G.substr(0,d).replace(/^\s+|\s+$/g,"");if(0!=j.length){var A=G.substr(d+1).replace(/^\s+|\s+$/g,""),H=[j,A];switch(j){case"italic":case"bold":H[1]="true"==A;break;case"line-height":H[0]="lineHeight",H[1]=parseInt(A);break;case"font-size":H[0]="fontSize",H[1]=parseInt(A);break;case"padding":1<(l=A.split(" ")).length||(l[1]=l[2]=l[3]=l[0]),H[1]=[parseInt(l[0]),parseInt(l[1]),parseInt(l[2]),parseInt(l[3])];break;case"rotate":H[0]="_rotate",H[1]=parseFloat(A);break;case"scale":l=A.split(" "),H[0]="_scale",H[1]=[parseFloat(l[0]),parseFloat(l[1])];break;case"translate":l=A.split(" "),H[0]="_translate",H[1]=[parseInt(l[0]),parseInt(l[1])];break;default:(H[0]=K._CSSTOVALUE[j])||(H[0]=j)}o.push(H)}}return o},K.parseCSS=function(B,g){for(var l;null!=(l=K._parseCSSRegExp.exec(B));)K.styleSheets[l[1]]=K.parseOneCSS(l[2],";")},K.EMPTY=new K(null),K._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},K._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),K._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},K._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},K.styleSheets={},K.ALIGN_CENTER=1,K.ALIGN_RIGHT=2,K.VALIGN_MIDDLE=1,K.VALIGN_BOTTOM=2,K._CSS_BLOCK=1,K._DISPLAY_NONE=2,K._ABSOLUTE=4,K._WIDTH_SET=8,K._PADDING=[0,0,0,0],K._RECT=[-1,-1,-1,-1],K._SPACING=[0,0],K._ALIGNS=[0,0,0],K.ADDLAYOUTED=512,K._NEWFONT=4096,K._HEIGHT_SET=8192,K._BACKGROUND_SET=16384,K._FLOAT_RIGHT=32768,K._LINE_ELEMENT=65536,K._NOWARP=131072,K._WIDTHAUTO=262144,K._LISTERRESZIE=524288,K}(G),lB=function(B){function y(){this.url=null,this.audio=null,this.loaded=!1,y.__super.call(this)}N(y,"laya.media.h5audio.AudioSound",j);var g=y.prototype;return g.dispose=function(){var B=y._audioCache[this.url];B&&(B.src="",delete y._audioCache[this.url])},g.load=function(B){var g;if(B=S.formatURL(B),(this.url=B)==z._tMusic?(y._initMusicAudio(),(g=y._musicAudio).src!=B&&(y._audioCache[g.src]=null,g=null)):g=y._audioCache[B],g&&2<=g.readyState)this.event("complete");else{g||(g=B==z._tMusic?(y._initMusicAudio(),y._musicAudio):Y.createElement("audio"),(y._audioCache[B]=g).src=B),g.addEventListener("canplaythrough",o),g.addEventListener("error",V);var l=this;(this.audio=g).load?g.load():V()}function o(){U(),l.loaded=!0,l.event("complete")}function V(){g.load=null,U(),l.event("error")}function U(){g.removeEventListener("canplaythrough",o),g.removeEventListener("error",V)}},g.play=function(B,g,l){if(void 0===B&&(B=0),void 0===g&&(g=0),!this.url)return null;var o,V;if(!(o=this.url==z._tMusic?y._musicAudio:y._audioCache[this.url]))return null;V=L.getItem("audio:"+this.url),E.isConchApp?V||((V=Y.createElement("audio")).src=this.url):this.url==z._tMusic?(y._initMusicAudio(),(V=y._musicAudio).src=this.url):V=V||o.cloneNode(!0);var U=new KB(V);return U.url=this.url,U.loops=g,U.startTime=B,U.startHandler=l,U.play(!1),z.addChannel(U),U},A(0,g,"duration",function(){var B;return(B=y._audioCache[this.url])?B.duration:0}),y._initMusicAudio=function(){y._musicAudio||(y._musicAudio||(y._musicAudio=Y.createElement("audio")),E.isConchApp||Y.document.addEventListener("mousedown",y._makeMusicOK))},y._makeMusicOK=function(){Y.document.removeEventListener("mousedown",y._makeMusicOK),y._musicAudio.src?y._musicAudio.play():(y._musicAudio.src="",y._musicAudio.load())},y._audioCache={},y._musicAudio=null,y}(),oB=function(B){function g(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,g.__super.call(this)}N(g,"laya.media.SoundChannel",j);var l=g.prototype;return l.play=function(){},l.stop=function(){},l.pause=function(){},l.resume=function(){},l.__runComplete=function(B){B&&B.run()},A(0,l,"volume",function(){return 1},function(B){}),A(0,l,"position",function(){return 0}),A(0,l,"duration",function(){return 0}),g}(),VB=function(B){function g(){g.__super.call(this)}N(g,"laya.media.Sound",j);var l=g.prototype;return l.load=function(B){},l.play=function(B,g,l){return void 0===B&&(B=0),void 0===g&&(g=0),null},l.dispose=function(){},A(0,l,"duration",function(){return 0}),g}(),UB=function(B){function V(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,V.__super.call(this)}N(V,"laya.media.webaudio.WebAudioSound",j);var g=V.prototype;return g.load=function(B){this.url=B,this.audioBuffer=V._dataCache[B],this.audioBuffer?this._loaded(this.audioBuffer):(V.e.on("loaded:"+B,this,this._loaded),V.e.on("err:"+B,this,this._err),V.__loadingSound[B]||(V.__loadingSound[B]=!0,s.loader.load(B,m.create(this,this.onloaded),null,GB.BUFFER,4,!1,null,!0)))},g.onloaded=function(B){B||this._err(),this._disposed?this._removeLoadEvents():(this.data=B,V.buffs.push({buffer:this.data,url:this.url}),V.decode())},g._err=function(){if(this._removeLoadEvents(),V.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var B,g,l,o=0;for(B=(g=this.__toPlays).length,o=0;o<B;o++)(l=g[o])[3]&&!l[3].isStopped&&l[3].event("error");this.__toPlays.length=0}},g._loaded=function(B){this._removeLoadEvents(),this._disposed||(this.audioBuffer=B,this.loaded=!0,this.event("complete"))},g._removeLoadEvents=function(){V.e.off("loaded:"+this.url,this,this._loaded),V.e.off("err:"+this.url,this,this._err)},g.__playAfterLoaded=function(){if(this.__toPlays){var B,g,l,o=0;for(B=(g=this.__toPlays).length,o=0;o<B;o++)(l=g[o])[3]&&!l[3].isStopped&&this.play(l[0],l[1],l[2],l[3]);this.__toPlays.length=0}},g.play=function(B,g,l,o){return void 0===B&&(B=0),void 0===g&&(g=0),o=o||new pB,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([B,g,l,o]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),o.url=this.url,o.loops=g,o.audioBuffer=this.audioBuffer,o.startTime=B,o.startHandler=l,o.play(!1),z.addChannel(o),o},g.dispose=function(){this._disposed=!0,delete V._dataCache[this.url],delete V.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},A(0,g,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),V.decode=function(){if(!(V.buffs.length<=0||V.isDecoding))if(V.isDecoding=!0,(V.tInfo=V.buffs.shift())&&V.tInfo.buffer&&V.tInfo.buffer.byteLength)try{V.ctx.decodeAudioData(V.tInfo.buffer,V._done,V._fail)}catch(B){console.error("decodeAudioData error  byteLength:"+V.tInfo.buffer.byteLength+"  url:"+V.tInfo.url)}else V._fail()},V._done=function(B){V.e.event("loaded:"+V.tInfo.url,B),V._dataCache[V.tInfo.url]=B,V.isDecoding=!1,V.decode()},V._fail=function(){V.e.event("err:"+V.tInfo.url,null),V.isDecoding=!1,V.decode()},V._playEmptySound=function(){if(null!=V.ctx){if(V._emptySource&&(V._emptySource.stop(),V._emptySource.disconnect(0),!pB._tryCleanFailed))try{V._emptySource.buffer=null}catch(B){pB._tryCleanFailed=!0}var B=V.ctx.createBufferSource();B.buffer=V._miniBuffer,B.connect(V.ctx.destination),B.start(0,0,0),V._emptySource=B}},V._unlock=function(){V._unlocked||(V._playEmptySound(),"running"==V.ctx.state?(Y.document.removeEventListener("mousedown",V._unlock,!0),Y.document.removeEventListener("touchend",V._unlock,!0),Y.document.removeEventListener("touchstart",V._unlock,!0),V._unlocked=!0):"suspended"==V.ctx.state&&z._recoverWebAudio())},V.initWebAudio=function(){"running"!=V.ctx.state&&(V._unlock(),Y.document.addEventListener("mousedown",V._unlock,!0),Y.document.addEventListener("touchend",V._unlock,!0),Y.document.addEventListener("touchstart",V._unlock,!0))},V._emptySource=null,V._dataCache={},V.buffs=[],V.isDecoding=!1,V._unlocked=!1,V.tInfo=null,V.__loadingSound={},d(V,["window",function(){return this.window=Y.window},"webAudioEnabled",function(){return this.webAudioEnabled=V.window.AudioContext||V.window.webkitAudioContext||V.window.mozAudioContext},"ctx",function(){return this.ctx=V.webAudioEnabled?new(V.window.AudioContext||V.window.webkitAudioContext||V.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=V.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new j}]),V}(),yB=function(B){function g(){this._responseType=null,this._data=null,g.__super.call(this),this._http=new Y.window.XMLHttpRequest}N(g,"laya.net.HttpRequest",j);var l=g.prototype;return l.send=function(B,g,l,o,V){void 0===l&&(l="get"),void 0===o&&(o="text"),this._responseType=o,this._data=null;var U=this,y=this._http;if(y.open(l,B,!0),V)for(var G=0;G<V.length;G++)y.setRequestHeader(V[G++],V[G]);else E.isConchApp||(g&&"string"!=typeof g?y.setRequestHeader("Content-Type","application/json"):y.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));y.responseType="arraybuffer"!==o?"text":"arraybuffer",y.onerror=function(B){U._onError(B)},y.onabort=function(B){U._onAbort(B)},y.onprogress=function(B){U._onProgress(B)},y.onload=function(B){U._onLoad(B)},y.send(g)},l._onProgress=function(B){B&&B.lengthComputable&&this.event("progress",B.loaded/B.total)},l._onAbort=function(B){this.error("Request was aborted by user")},l._onError=function(B){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},l._onLoad=function(B){var g=this._http,l=void 0!==g.status?g.status:200;200===l||204===l||0===l?this.complete():this.error("["+g.status+"]"+g.statusText+":"+g.responseURL)},l.error=function(B){this.clear(),this.event("error",B)},l.complete=function(){this.clear();var g=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(B){g=!1,this.error(B.message)}g&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},l.clear=function(){var B=this._http;B.onerror=B.onabort=B.onprogress=B.onload=null},A(0,l,"url",function(){return this._http.responseURL}),A(0,l,"http",function(){return this._http}),A(0,l,"data",function(){return this._data}),g}(),GB=function(B){function i(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,i.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}N(i,"laya.net.Loader",j);var g=i.prototype;return g.load=function(B,g,l,o,V){if(B&&""!=B||console.error("Loader 加载的url不合法 "+B),void 0===l&&(l=!0),void 0===V&&(V=!1),this._url=B,this._base64=!1,0===B.indexOf("data:image")?(this._base64=!0,this._type=g="image"):this._type=g||(g=this.getTypeFromUrl(B)),this._cache=l,this._data=null,!V&&i.loadedMap[B])return this._data=i.loadedMap[B],this.event("progress",1),void this.event("complete",this._data);if(o&&i.setGroup(B,o),null!=i.parserMap[g])return this._customParse=!0,void(i.parserMap[g]instanceof laya.utils.Handler?i.parserMap[g].runWith(this):i.parserMap[g].call(null,this));if("image"===g||"htmlimage"===g||"nativeimage"===g)return this._loadImage(B);if("ttf"===g)return this._loadTTF(B);switch(g){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:g}i.preLoadedMap[B]?this.onLoaded(i.preLoadedMap[B]):y.resMgrLoad(B,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},g.getTypeFromUrl=function(B){var g=$.getFileExtension(B);return g?i.typeMap[g]:(console.warn("Not recognize the resources suffix",B),"text")},g._loadTTF=function(B){B=S.formatURL(B);var g=new f;g.complete=m.create(this,this.onLoaded),g.load(B)},g._loadBase64Image=function(g){g=S.formatURL(g);var l,B=this;function o(){l.onload=null,l.onerror=null,delete i.imgCache[g]}function V(){o(),B.onLoaded(l)}function U(){o(),B.event("error","Load image failed")}"nativeimage"===this._type?((l=new Y.window.Image).crossOrigin="",l.onload=V,l.onerror=U,l.src=g,i.imgCache[g]=l):new vB.create(g,{onload:V,onerror:U,onCreate:function(B){l=B,i.imgCache[g]=B}})},g._loadImage=function(B){this._base64?this._loadBase64Image(B):y.imgMgrLoad(B,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},g._loadImageComplete=function(B,g,l){if(null!=l)if(l instanceof ArrayBuffer){var o=new DataView(l),V=new laya.webgl.resource.WebGLImage(new Uint8Array(l,8),B,0,!1,o.getUint32(0),o.getUint32(4));this.onLoaded(V)}else if(l instanceof AB)i.imgMgrSet[B]=g,y.imgMgrLock(B,i.imgMgrSet[B]),this._url=B,this.complete(l);else{var U=-1!=B.indexOf(".png",B.length-4)?6408:6407;V=new laya.webgl.resource.WebGLImage(l,B,U,!1,l.width,l.height);this.onLoaded(V)}else this.event("error","Load image failed")},g.imageCancel=function(B,g,l){y.imgMgrCancel&&y.imgMgrCancel(B,this._onImageCallback)},g._loadSound=function(B){var g=new z._soundClass,l=this;function o(){g.offAll()}g.on("complete",this,function(){o(),l.onLoaded(g)}),g.on("error",this,function(){o(),g.dispose(),l.event("error","Load sound failed")}),g.load(B)},g.onProgress=function(B){"atlas"===this._type?this.event("progress",.3*B):this.event("progress",B)},g.onError=function(B){this.event("error",B)},g._loadedComplete=function(B,g,l){if(null!=l)switch(this._type){case"atlas":case"plf":case"json":var o=new c(l);this.onLoaded(JSON.parse(o.readUTFBytes()));break;case"font":o=new c(l);this.onLoaded($.parseXMLFromString(o.readUTFBytes()));break;default:this.onLoaded(l)}else this.event("error",B)},g.onLoaded=function(B){var g=this._type;if("plf"==g)this.parsePLFData(B),this.complete(B);else if("image"===g){var l=new AB(B);l.url=this._url,this.complete(l)}else if("sound"===g||"htmlimage"===g||"nativeimage"===g)this.complete(B);else if("atlas"===g){if(!B.src&&!B._setContext){if(!this._data){if((this._data=B).meta&&B.meta.image)for(var o=B.meta.image.split(","),V=0<=this._url.indexOf("/")?"/":"\\",U=this._url.lastIndexOf(V),y=0<=U?this._url.substr(0,U+1):"",G=0,d=o.length;G<d;G++)o[G]=y+o[G];else o=[this._url.replace(".json",".png")];o.reverse(),B.toLoads=o,B.pics=[]}return this.event("progress",.3+1/o.length*.6),this._loadImage(o.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(B),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var j=this._data.frames,A=this._url.split("?")[0],H=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:A.substring(0,A.lastIndexOf("."))+"/",K=this._data.pics,p=S.formatURL(this._url),x=i.atlasMap[p]||(i.atlasMap[p]=[]);x.dir=H;var N=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var F in N=parseFloat(this._data.meta.scale),j){var C,m=j[F],M=K[m.frame.idx?m.frame.idx:0],b=S.formatURL(H+F);M.scaleRate=N,C=AB.create(M,m.frame.x,m.frame.y,m.frame.w,m.frame.h,m.spriteSourceSize.x,m.spriteSourceSize.y,m.sourceSize.w,m.sourceSize.h),i.cacheRes(b,C),i.keepCache(this._url,H+F),C.url=b,x.push(b)}else for(F in j)M=K[(m=j[F]).frame.idx?m.frame.idx:0],b=S.formatURL(H+F),i.cacheRes(b,AB.create(M,m.frame.x,m.frame.y,m.frame.w,m.frame.h,m.spriteSourceSize.x,m.spriteSourceSize.y,m.sourceSize.w,m.sourceSize.h)),i.loadedMap[b].url=b,i.keepCache(this._url,H+F),x.push(b);delete this._data.pics,this.complete(this._data)}else if("font"==g){if(!B.src)return this._data=B,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var D=new a;D.parseFont(this._data,B);var v=this._url.split(".fnt")[0].split("/"),s=v[v.length-1];FB.registerBitmapFont(s,D),this._data=D,this.complete(this._data)}else if("pkm"==g){var X=vB.create(B,this._url),w=new AB(X);w.url=this._url,this.complete(w)}else this.complete(B)},g.parsePLFData=function(B){var g,l,o;for(g in B)switch(o=B[g],g){case"json":case"text":for(l in o)i.preLoadedMap[S.formatURL(l)]=o[l];break;default:for(l in o)i.preLoadedMap[S.formatURL(l)]=o[l]}},g.complete=function(B){this._data=B,this._customParse?this.event("loaded",B instanceof Array?[B]:B):(i._loaders.push(this),i._isWorking||i.checkNext())},g.endLoad=function(B){B&&(this._data=B),this._cache&&i.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},A(0,g,"url",function(){return this._url}),A(0,g,"data",function(){return this._data}),A(0,g,"cache",function(){return this._cache}),A(0,g,"type",function(){return this._type}),i.checkNext=function(){i._isWorking=!0;for(var B=Y.now();i._startIndex<i._loaders.length;)if(Y.now(),i._loaders[i._startIndex].endLoad(),i._startIndex++,Y.now()-B>i.maxTimeOut)return console.warn("loader callback cost a long time:"+(Y.now()-B)+" url="+i._loaders[i._startIndex-1].url),void s.timer.frameOnce(1,null,i.checkNext);i._loaders.length=0,i._startIndex=0,i._isWorking=!1},i.clearRes=function(B,g){if(null!=B){void 0===g&&(g=!1),B=S.formatURL(B);var l=i.getAtlas(B);if(l){for(var o=0,V=l.length;o<V;o++){var U=l[o],y=i.getRes(U);delete i.loadedMap[U],i.clearCache(B.substring(S.basePath.length),U.substring(S.basePath.length)),y&&y.destroy(g)}l.length=0,delete i.atlasMap[B],delete i.loadedMap[B]}else{var G=i.loadedMap[B];G&&(delete i.loadedMap[B],G instanceof laya.resource.Texture&&G.bitmap&&G.destroy(g))}}},i.clearTextureRes=function(B){B=S.formatURL(B);var g=laya.net.Loader.getAtlas(B),l=g&&0<g.length?laya.net.Loader.getRes(g[0]):laya.net.Loader.getRes(B);l&&l.bitmap&&(E.isConchApp&&!E.isConchWebGL?l.bitmap.source.releaseTexture&&l.bitmap.source.releaseTexture():null==l.bitmap._atlaser&&l.bitmap.releaseResource(!0))},i.getRes=function(B){return i.loadedMap[S.formatURL(B)]},i.getAtlas=function(B){return i.atlasMap[S.formatURL(B)]},i.cacheRes=function(B,g){B=S.formatURL(B),null!=i.loadedMap[B]?console.warn("Resources already exist,is repeated loading:",B):i.loadedMap[B]=g},i.setGroup=function(B,g){i.groupMap[g]||(i.groupMap[g]=[]),i.groupMap[g].push(B)},i.clearResByGroup=function(B){if(i.groupMap[B]){var g=i.groupMap[B],l=0,o=g.length;for(l=0;l<o;l++)i.clearRes(g[l]);g.length=0}},i.keepCache=function(B,g){if(B&&g){var l=i.cacheSet[g];l?-1==l.indexOf(B)&&l.push(B):i.cacheSet[g]=[B]}},i.clearCache=function(B,g){if(B&&g){var l=i.cacheSet[g];if(l){var o=l.indexOf(B);if(-1!==o){var V=l.length-1;0==V?(delete i.cacheSet[g],0<i.imgMgrSet[g]?y.imgMgrFree(g,i.imgMgrSet[g]):i.clearRes(g,!0)):(l[o]=l[V],l.length=V)}}}},i.saveObject=function(B,g,l){if(g&&B){var o=i.objectSet[B];o?(console.warn("Loader.saveObject: "+B),o[0]=g,o[1]=l):i.objectSet[B]=[g,l,[]]}},i.findObject=function(B){if(B){var g=i.objectSet[B];if(g)return g[0]}return null},i.keepObject=function(B,g){if(B&&g){var l=i.objectSet[g];l&&-1===l[2].indexOf(B)&&l[2].push(B)}},i.clearObject=function(B,g){if(B&&g){var l=i.objectSet[g];if(l){var o=l[2],V=o.indexOf(B);if(-1!==V){var U=o.length-1;0==U?(delete i.objectSet[g],l[1]&&l[1].call(null,l[0])):(o[V]=o[U],o.length=U)}}}},i.TEXT="text",i.JSON="json",i.XML="xml",i.BUFFER="arraybuffer",i.IMAGE="image",i.SOUND="sound",i.ATLAS="atlas",i.FONT="font",i.TTF="ttf",i.PLF="plf",i.PKM="pkm",i.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},i.parserMap={},i.groupMap={},i.maxTimeOut=100,i.loadedMap={},i.preLoadedMap={},i.atlasMap={},i._loaders=[],i._isWorking=!1,i._startIndex=0,i.imgCache={},i.cacheSet={},i.objectSet={},i.imgMgrSet={},i}(),dB=function(B){var K;function p(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},p.__super.call(this);for(var B=0;B<this._maxPriority;B++)this._resInfos[B]=[]}N(p,"laya.net.LoaderManager",j);var g=p.prototype;return g.create=function(B,l,g,o,V,U,y,G){if(null==U&&(U=2),null==y&&(y=!0),B instanceof Array){var d=B,j=d.length,A=0;if(g)var H=m.create(g.caller,g.method,g.args,!1);for(var K=0;K<j;K++){var p=d[K];"string"==typeof p&&(p=d[K]={url:p}),p.progress=0}for(K=0;K<j;K++){p=d[K];var x=g?m.create(null,C,[p],!1):null,N=g||l?m.create(null,F,[p]):null;this._create(p.url,N,x,p.clas||o,p.params||V,null!=p.priority&&0<=p.priority?p.priority:U,y,p.group||G)}function F(B,g){A++,B.progress=1,A===j&&l&&l.run()}function C(B,g){B.progress=g;for(var l=0,o=0;o<j;o++){l+=d[o].progress}var V=l/j;H.runWith(V)}return!0}return this._create(B,l,g,o,V,U,y,G)},g._create=function(g,l,B,o,V,U,y,G){g&&""!=g||console.error("加载的url不合法 "+g),null==U&&(U=2),null==y&&(y=!0);var d=S.formatURL(g),j=this.getRes(d);if(j)!j.hasOwnProperty("loaded")||j.loaded?(B&&B.runWith(1),l&&l.run()):l&&s.loader._createListener(g,l.caller,l.method,l.args,!0,!1);else{var A=$.getFileExtension(g),H=p.createMap[A];if(!H)throw new Error("LoaderManager:unknown file("+g+") extension with: "+A+".");o||(o=H[0]);var K=H[1];if("atlas"==A)this.load(g,l,B,K,U,y);else{o===AB&&(K="htmlimage"),(j=o?new o:null).hasOwnProperty("_loaded")&&(j._loaded=!1),j._setUrl(g),G&&j._setGroup(G),this._createLoad(j,g,m.create(null,function(B){j&&!j.destroyed&&B&&j.onAsynLoaded.call(j,g,B,V),l&&l.run();s.loader.event(g)}),B,K,U,!1,G,!0),y&&this.cacheRes(d,j)}}return j},g.load=function(B,g,l,o,V,U,y,G){B&&""!=B||console.error("加载的url不合法 "+B);var d=this;if(null==V&&(V=2),null==U&&(U=!0),void 0===G&&(G=!1),B instanceof Array)return this._loadAssets(B,g,l,o,V,U,y);var j=GB.getRes(B);if(null!=j)s.timer.frameOnce(1,null,function(){l&&l.runWith(1),g&&g.runWith(j),d._loaderCount||d.event("complete")});else{var A=p._resMap[B];A?(g&&A._createListener("complete",g.caller,g.method,g.args,!1,!1),l&&A._createListener("progress",l.caller,l.method,l.args,!1,!1)):((A=this._infoPool.length?this._infoPool.pop():new K).url=B,A.clas=null,A.type=o,A.cache=U,A.group=y,A.ignoreCache=G,A.priority=V,g&&A.on("complete",g.caller,g.method,g.args),l&&A.on("progress",l.caller,l.method,l.args),p._resMap[B]=A,V=V<this._maxPriority?0<=V?V:0:this._maxPriority-1,this._resInfos[V].push(A),this._next())}return this},g.cancel=function(B,g,l){if(j=p._resMap[B]){g&&j.off("complete",g.caller,g.method,!1),l&&j.off("progress",l.caller,l.method,!1);var o=j.getListener("complete"),V=j.getListener("progress");if(!(o&&o.head||V&&V.head)){if(j.loader){var U=j.loader;U.imageCancel(B),U.offAll(),U._data=null,U._customParse=!1,U._url=null,U._class=null,U._type=null,this._loaders.push(U),this._loaderCount--,delete this._loaderMap[j.url]}for(var y=0;y<this._maxPriority;y++)for(var G=this._resInfos[y],d=G.length-1;-1<d;d--){var j;(j=G[d])&&j.url===B&&(G[d]=null,j.destroy(),j.offAll(),this._infoPool.push(j))}delete p._resMap[B],this._next()}}},g._createLoad=function(B,g,l,o,V,U,y,G,d){var j=this;if(null==U&&(U=2),null==y&&(y=!0),void 0===d&&(d=!1),g instanceof Array)return this._loadAssets(g,l,o,V,U,y,G);var A=GB.getRes(g);if(null!=A)s.timer.frameOnce(1,null,function(){o&&o.runWith(1),l&&l.runWith(A),j._loaderCount||j.event("complete")});else{var H=p._resMap[g];H?(l&&H._createListener("complete",l.caller,l.method,l.args,!1,!1),o&&H._createListener("progress",o.caller,o.method,o.args,!1,!1)):((H=this._infoPool.length?this._infoPool.pop():new K).url=g,H.clas=B,H.type=V,H.cache=y,H.group=G,H.ignoreCache=d,H.priority=U,l&&H.on("complete",l.caller,l.method,l.args),o&&H.on("progress",o.caller,o.method,o.args),p._resMap[g]=H,U=U<this._maxPriority?0<=U?U:0:this._maxPriority-1,this._resInfos[U].push(H),this._next())}return this},g._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var B=0;B<this._maxPriority;B++)for(var g=this._resInfos[B];0<g.length;){var l=g.shift();if(l)return this._doLoad(l)}this._loaderCount||this.event("complete")}},g._doLoad=function(g){var l=this._loaders.length?this._loaders.pop():new GB;this._loaderCount++,(this._loaderMap[g.url]=l).on("complete",null,V),l.on("progress",null,function(B){g.event("progress",B)}),l.on("error",null,function(B){V(null)}),g.loader=l;var o=this;function V(B){l.offAll(),l._data=null,l._customParse=!1,l._url=null,l._class=null,l._type=null,o._loaders.push(l),o._loaderCount--,delete o._loaderMap[g.url],o._endLoad(g,B instanceof Array?[B]:B),o._next()}l._class=g.clas,1<=g.priority?(l.priority=g.priority,l.realTime=!1):(l.priority=0,l.realTime=!0),l.load(g.url,g.type,g.cache,g.group,g.ignoreCache)},g._endLoad=function(B,g){var l=B.url;if(null==g){var o=this._failRes[l]||0;if(o<this.retryNum)return console.warn("[warn]Retry to load:",l),this._failRes[l]=o+1,void s.timer.once(this.retryDelay,this,this._addReTry,[B],!1);console.warn("[error]Failed to load:",l),this.event("error",l)}this._failRes[l]&&(this._failRes[l]=0),delete p._resMap[l],B.event("complete",g),B.destroy(),B.offAll(),this._infoPool.push(B)},g._addReTry=function(B){this._resInfos[this._maxPriority-1].push(B),this._next()},g.clearRes=function(B,g){void 0===g&&(g=!1),GB.clearRes(B,g)},g.getRes=function(B){return GB.getRes(B)},g.cacheRes=function(B,g){GB.cacheRes(B,g)},g.clearTextureRes=function(B){GB.clearTextureRes(B)},g.setGroup=function(B,g){GB.setGroup(B,g)},g.clearResByGroup=function(B){GB.clearResByGroup(B)},g.clearUnLoaded=function(){for(var B=0;B<this._maxPriority;B++){for(var g=this._resInfos[B],l=g.length-1;-1<l;l--){var o=g[l];o&&(o.destroy(),o.offAll(),this._infoPool.push(o))}g.length=0}this._loaderCount=0,p._resMap={}},g.cancelLoadByUrls=function(B){if(B)for(var g=0,l=B.length;g<l;g++)this.cancelLoadByUrl(B[g])},g.cancelLoadByUrl=function(B){for(var g=0;g<this._maxPriority;g++)for(var l=this._resInfos[g],o=l.length-1;-1<o;o--){var V=l[o];V&&V.url===B&&(l[o]=null,V.destroy(),V.offAll(),this._infoPool.push(V))}p._resMap[B]&&delete p._resMap[B]},g._loadAssets=function(B,l,y,g,o,V,U){null==o&&(o=2),null==V&&(V=!0);for(var G=B.length,d=0,j=0,A=[],H=!0,K=0;K<G;K++){var p=B[K];if(!p)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+B);"string"==typeof p&&(p={url:p,type:g,size:1,priority:o}),p.size||(p.size=1),p.progress=0,j+=p.size,A.push(p);var x=y?m.create(null,C,[p],!1):null,N=l||y?m.create(null,F,[p]):null;this.load(p.url,N,x,p.type,null!=p.priority&&0<=p.priority?p.priority:2,V,p.group||U)}function F(B,g){d++,B.progress=1,g||(H=!1),d===G&&l&&l.runWith(H)}function C(B,g){if(null!=y){B.progress=g;for(var l=0,o=0;o<A.length;o++){var V=A[o];l+=V.size*V.progress}var U=l/j;y.runWith(U)}}return this},p.cacheRes=function(B,g){GB.cacheRes(B,g)},p._resMap={},d(p,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),p.__init$=function(){K=function(B){function g(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,g.__super.call(this)}return N(g,"",j),g.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},g}()},p}(),jB=(function(B){function V(B){V.__super.call(this),B||(B=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var g=0,l=0,o=0;o<20;o++)o%5!=4?this._mat[g++]=B[o]:this._alpha[l++]=B[o];this._action=t.createFilterAction(32),this._action.data=this}N(V,"laya.filters.ColorFilter",C);var g=V.prototype;s.imps(g,{"laya.filters.IFilter":!0}),g.callNative=function(B){B._$P.cf=this;B.conchModel&&B.conchModel.setFilterMatrix&&B.conchModel.setFilterMatrix(this._mat,this._alpha)},A(0,g,"type",function(){return 32}),A(0,g,"action",function(){return this._action})}(),function(B){function o(B,g,l){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===g&&(g=0),o.__super.call(this),this._byteClass=l||c,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,B&&0<g&&g<65535&&this.connect(B,g)}N(o,"laya.net.Socket",j);var g=o.prototype;g.connect=function(B,g){var l="ws://"+B+":"+g;l="https:"==Y.window.location.protocol?"wss://"+B+":"+g:"ws://"+B+":"+g,this.connectByUrl(l)},g.connectByUrl=function(B){var g=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new Y.window.WebSocket(B,this.protocols):this._socket=new Y.window.WebSocket(B),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(B){g._onOpen(B)},this._socket.onmessage=function(B){g._onMessage(B)},this._socket.onclose=function(B){g._onClose(B)},this._socket.onerror=function(B){g._onError(B)}},g.cleanSocket=function(){try{this._socket.close()}catch(B){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},g.close=function(){if(null!=this._socket)try{this._socket.close()}catch(B){}},g._onOpen=function(B){this._connected=!0,this.event("open",B)},g._onMessage=function(B){if(B&&B.data){var g=B.data;if(this.disableInput&&g)this.event("message",g);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var l=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,g&&("string"==typeof g?this._input.writeUTFBytes(g):this._input.writeArrayBuffer(g),this._addInputPosition=this._input.pos,this._input.pos=l),this.event("message",g)}}},g._onClose=function(B){this._connected=!1,this.event("close",B)},g._onError=function(B){this.event("error",B)},g.send=function(B){this._socket.send(B)},g.flush=function(){if(this._output&&0<this._output.length){var g;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(B){g=B}this._output.endian=this.endian,this._output.clear(),g&&this.event("error",g)}},A(0,g,"input",function(){return this._input}),A(0,g,"output",function(){return this._output}),A(0,g,"connected",function(){return this._connected}),A(0,g,"endian",function(){return this._endian},function(B){this._endian=B,null!=this._input&&(this._input.endian=B),null!=this._output&&(this._output.endian=B)}),o.LITTLE_ENDIAN="littleEndian",o.BIG_ENDIAN="bigEndian"}(),function(B){function G(){G.__super.call(this),this._$1__id=++G._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(G._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,P.currentResourceManager&&P.currentResourceManager.addResource(this)}N(G,"laya.resource.Resource",j);var g=G.prototype;return s.imps(g,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),g._setUrl=function(B){var g;this._url!==B&&(this._url&&((g=G._urlResourcesMap[this._url]).splice(g.indexOf(this),1),0===g.length&&delete G._urlResourcesMap[this._url]),B&&((g=G._urlResourcesMap[B])||(G._urlResourcesMap[B]=g=[]),g.push(this)),this._url=B)},g._getGroup=function(){return this._group},g._setGroup=function(B){var g;this._group!==B&&(this._group&&((g=G._groupResourcesMap[this._group]).splice(g.indexOf(this),1),0===g.length&&delete G._groupResourcesMap[this._group]),B&&((g=G._groupResourcesMap[B])||(G._groupResourcesMap[B]=g=[]),g.push(this)),this._group=B)},g._addReference=function(){this._referenceCount++},g._removeReference=function(){this._referenceCount--},g._clearReference=function(){this._referenceCount=0},g._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},g.recreateResource=function(){this.completeCreate()},g.disposeResource=function(){},g.activeResource=function(B){void 0===B&&(B=!1),this._lastUseFrameCount=I.loopCount,!this._destroyed&&this.__loaded&&(this._released||B)&&this.recreateResource()},g.releaseResource=function(B){return void 0===B&&(B=!0),!(!B&&this.lock)&&(!(this._released&&!B)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},g.onAsynLoaded=function(B,g,l){throw new Error("Resource: must override this function!")},g.destroy=function(){var B;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete G._idResourcesMap[this.id],this._url&&((B=G._urlResourcesMap[this._url])&&(B.splice(B.indexOf(this),1),0===B.length&&delete G._urlResourcesMap[this.url]),GB.clearRes(this._url),this.__loaded||t.cancelLoadByUrl(this._url)),this._group&&((B=G._groupResourcesMap[this._group]).splice(B.indexOf(this),1),0===B.length&&delete G._groupResourcesMap[this.url]))},g.completeCreate=function(){this._released=!1,this.event("recovered",this)},g.dispose=function(){this.destroy()},A(0,g,"memorySize",function(){return this._memorySize},function(B){var g=B-this._memorySize;this._memorySize=B,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,g),this.resourceManager&&this.resourceManager.addSize(g)}),A(0,g,"_loaded",null,function(B){this.__loaded=B}),A(0,g,"loaded",function(){return this.__loaded}),A(0,g,"id",function(){return this._$1__id}),A(0,g,"destroyed",function(){return this._destroyed}),A(0,g,"group",function(){return this._getGroup()},function(B){this._setGroup(B)}),A(0,g,"resourceManager",function(){return this._resourceManager}),A(0,g,"url",function(){return this._url}),A(0,g,"released",function(){return this._released}),A(0,g,"referenceCount",function(){return this._referenceCount}),G.getResourceByID=function(B){return G._idResourcesMap[B]},G.getResourceByURL=function(B,g){return void 0===g&&(g=0),null==G._urlResourcesMap[B]?null:G._urlResourcesMap[B][g]},G.getResourceCountByURL=function(B){return G._urlResourcesMap[B].length},G.destroyUnusedResources=function(B){var g;if(B){var l=G._groupResourcesMap[B];if(l)for(var o=l.slice(),V=0,U=o.length;V<U;V++)(g=o[V]).lock||0!==g._referenceCount||g.destroy()}else for(var y in G._idResourcesMap)(g=G._idResourcesMap[y]).lock||0!==g._referenceCount||g.destroy()},G._uniqueIDCounter=0,G._idResourcesMap={},G._urlResourcesMap={},G._groupResourcesMap={},G}()),AB=function(B){function i(B,g){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,i.__super.call(this),B&&null!=B._addReference&&B._addReference(),this.setTo(B,g)}N(i,"laya.resource.Texture",j);var g=i.prototype;return g._setUrl=function(B){this.url=B},g.setTo=function(B,g){if(B instanceof y.HTMLElement){var l=MB.create("2D",B);this.bitmap=l}else this.bitmap=B;if(this.uv=g||i.DEF_UV,B){this._w=B.width,this._h=B.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var o=this;if(this._loaded)t.addToAtlas&&t.addToAtlas(o);else{var V=B;V instanceof laya.resource.HTMLImage&&V.image&&V.image.addEventListener("load",function(B){t.addToAtlas&&t.addToAtlas(o)},!1)}}},g.active=function(){this.bitmap&&this.bitmap.activeResource()},g.destroy=function(B){if(void 0===B&&(B=!1),this.alphaTexture&&(this.alphaTexture.destroy(B),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var g=this.bitmap;B?(E.isConchApp&&g.source&&g.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,g.dispose(),g._clearReference()):(g._removeReference(),0==g.referenceCount&&(E.isConchApp&&g.source&&g.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,g.dispose())),this.url&&this===s.loader.getRes(this.url)&&s.loader.clearRes(this.url,B),this._loaded=!1}},g.load=function(B){var g=this;this._loaded=!1,B=S.customFormat(B);var l=this.bitmap||(this.bitmap=vB.create(B));l.uri=B,l&&l._addReference();var o=this;l.onload=function(){l.onload=null,o._loaded=!0,g.sourceWidth=g._w=l.width,g.sourceHeight=g._h=l.height,o.event("loaded",this),t.addToAtlas&&t.addToAtlas(o)}},g.addTextureToAtlas=function(B){t.addTextureToAtlas(this)},g.getPixels=function(B,g,l,o){if(E.isConchApp){var V=this.bitmap;if(V.source&&V.source.getImageData){var U=V.source.getImageData(B,g,l,o),y=new Uint8Array(U);return Array.from(y)}return null}return E.isWebGL?t.getTexturePixels(this,B,g,l,o):(Y.canvas.size(l,o),Y.canvas.clear(),Y.context.drawTexture(this,-B,-g,this.width,this.height,0,0),Y.context.getImageData(0,0,l,o).data)},g.onAsynLoaded=function(B,g){if(g){if("function"!=typeof g._addReference)throw new Error("bitmap._addReference is not a function. "+g.className+" "+typeof g._addReference+" "+g.constructor);g._addReference()}this.setTo(g,this.uv),this._loaded&&this.event("loaded",this)},A(0,g,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),A(0,g,"loaded",function(){return this._loaded}),A(0,g,"released",function(){return!this.bitmap||this.bitmap.released}),A(0,g,"width",function(){return this._w?this._w:this.uv&&this.uv!==i.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(B){this._w=B,this.sourceWidth||(this.sourceWidth=B)}),A(0,g,"repeat",function(){return!E.isWebGL||!this.bitmap||this.bitmap.repeat},function(B){B&&E.isWebGL&&this.bitmap&&(this.bitmap.repeat=B)&&(this.bitmap.enableMerageInAtlas=!1)}),A(0,g,"height",function(){return this._h?this._h:this.uv&&this.uv!==i.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(B){this._h=B,this.sourceHeight||(this.sourceHeight=B)}),A(0,g,"isLinearSampling",function(){return!E.isWebGL||9728!=this.bitmap.minFifter},function(B){!B&&E.isWebGL&&(B||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),i.moveUV=function(B,g,l){for(var o=0;o<8;o+=2)l[o]+=B,l[o+1]+=g;return l},i.create=function(B,g,l,o,V,U,y,G,d){void 0===U&&(U=0),void 0===y&&(y=0),void 0===G&&(G=0),void 0===d&&(d=0);var j=B instanceof laya.resource.Texture,A=j?B.uv:i.DEF_UV,H=j?B.bitmap:B,K=t.isAtlas(H);if(K){var p=H._atlaser,x=B._atlasID;if(-1==x)throw new Error("create texture error");H=p._inAtlasTextureBitmapValue[x],A=p._inAtlasTextureOriUVValue[x]}var N=new i(H,null);H.width&&g+o>H.width&&(o=H.width-g),H.height&&l+V>H.height&&(V=H.height-l),N.width=o,N.height=V,N.offsetX=U,N.offsetY=y,N.sourceWidth=G||o,N.sourceHeight=d||V;var F=1/H.width,C=1/H.height;g*=F,l*=C,o*=F,V*=C;var m=N.uv[0],M=N.uv[1],b=N.uv[4],D=N.uv[5],v=b-m,s=D-M,X=i.moveUV(A[0],A[1],[g,l,g+o,l,g+o,l+V,g,l+V]);N.uv=[m+X[0]*v,M+X[1]*s,b-(1-X[2])*v,M+X[3]*s,b-(1-X[4])*v,D-(1-X[5])*s,m+X[6]*v,D-(1-X[7])*s],K&&N.addTextureToAtlas();var w=H.scaleRate;return w&&1!=w?(N.sourceWidth/=w,N.sourceHeight/=w,N.width/=w,N.height/=w,N.scaleRate=w,N.offsetX/=w,N.offsetY/=w):N.scaleRate=1,N},i.createFromTexture=function(B,g,l,o,V){var U=B.scaleRate;1!=U&&(g*=U,l*=U,o*=U,V*=U);var y=w.TEMP.setTo(g-B.offsetX,l-B.offsetY,o,V),G=y.intersection(i._rect1.setTo(0,0,B.width,B.height),i._rect2);if(!G)return null;var d=i.create(B,G.x,G.y,G.width,G.height,G.x-y.x,G.y-y.y,o,V);if(d.bitmap&&d.bitmap._removeReference)return d.bitmap._removeReference(),d;var j="bitmap:"+(d.bitmap?d.bitmap.constructor?d.bitmap.constructor.name:d.bitmap.__className:"")+", url:"+(B.url+" | "+(d.bitmap?d.bitmap.url:B.url))+", x="+g+",y="+l+",width="+o+",height="+V+", result="+(G?G.x+","+G.y+","+G.width+","+G.height:"null")+", rect="+y.x+","+y.y+","+y.width+","+y.height;throw new Error("报错：bitmap._removeReference is not a function  "+j)},i.DEF_UV=[0,0,1,0,1,1,0,1],i.INV_UV=[0,1,1,1,1,0,0,0],i._rect1=new w,i._rect2=new w,i}(),B=function(B){var G;function U(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,U.__super.call(this)}N(U,"laya.utils.TimeLine",j);var g=U.prototype;return g.to=function(B,g,l,o,V){return void 0===V&&(V=0),this._create(B,g,l,o,V,!0)},g.from=function(B,g,l,o,V){return void 0===V&&(V=0),this._create(B,g,l,o,V,!1)},g._create=function(B,g,l,o,V,U){var y=L.getItemByClass("tweenData",G);return y.isTo=U,y.type=0,y.target=B,y.duration=l,y.data=g,y.startTime=this._startTime+V,y.endTime=y.startTime+y.duration,y.ease=o,this._startTime=Math.max(y.endTime,this._startTime),this._tweenDataList.push(y),this._startTimeSort=!0,this._endTimeSort=!0,this},g.addLabel=function(B,g){var l=L.getItemByClass("tweenData",G);return l.type=1,l.data=B,l.endTime=l.startTime=this._startTime+g,this._labelDic||(this._labelDic={}),this._labelDic[B]=l,this._tweenDataList.push(l),this},g.removeLabel=function(B){if(this._labelDic&&this._labelDic[B]){var g=this._labelDic[B];if(g){var l=this._tweenDataList.indexOf(g);-1<l&&this._tweenDataList.splice(l,1)}delete this._labelDic[B]}},g.gotoTime=function(B){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var g,l,o,V;for(var U in this._firstTweenDic)if(l=this._firstTweenDic[U])for(var y in l)l.diyTarget.hasOwnProperty(y)&&(l.diyTarget[y]=l[y]);for(U in this._tweenDic)(g=this._tweenDic[U]).clear(),delete this._tweenDic[U];if(this._index=0,this._gidIndex=0,this._currTime=B,this._lastTime=Y.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=o=this._tweenDataList.concat(),o.sort(function(B,g){return B.endTime>g.endTime?1:B.endTime<g.endTime?-1:0})}else o=this._endTweenDataList;for(var G=0,d=o.length;G<d;G++)if(0==(V=o[G]).type){if(!(B>=V.endTime))break;this._index=Math.max(this._index,G+1);var j=V.data;if(V.isTo)for(var A in j)V.target[A]=j[A]}for(G=0,d=this._tweenDataList.length;G<d;G++)0==(V=this._tweenDataList[G]).type&&B>=V.startTime&&B<V.endTime&&(this._index=Math.max(this._index,G+1),this._gidIndex++,(g=L.getItemByClass("tween",J))._create(V.target,V.data,V.duration,V.ease,m.create(this,this._animComplete,[this._gidIndex]),0,!1,V.isTo,!0,!1),g.setStartTime(this._currTime-(B-V.startTime)),g._updateEase(this._currTime),g.gid=this._gidIndex,this._tweenDic[this._gidIndex]=g)}},g.gotoLabel=function(B){if(null!=this._labelDic){var g=this._labelDic[B];g&&this.gotoTime(g.startTime)}},g.pause=function(){s.timer.clear(this,this._update)},g.resume=function(){this.play(this._currTime,this._loopKey)},g.play=function(B,g){if(void 0===B&&(B=0),void 0===g&&(g=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(B,g){return B.startTime>g.startTime?1:B.startTime<g.startTime?-1:0});for(var l=0,o=this._tweenDataList.length;l<o;l++){var V=this._tweenDataList[l];if(null!=V&&0==V.type){var U=V.target,y=U.$_GID||(U.$_GID=$.getGID()),G=null;for(var d in null==this._firstTweenDic[y]?((G={}).diyTarget=U,this._firstTweenDic[y]=G):G=this._firstTweenDic[y],V.data)null==G[d]&&(G[d]=U[d])}}}"string"==typeof B?this.gotoLabel(B):this.gotoTime(B),this._loopKey=g,this._lastTime=Y.now(),s.timer.frameLoop(1,this,this._update)}},g._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var B in this._tweenDic)(g=this._tweenDic[B]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var g,l=Y.now(),o=l-this._lastTime,V=this._currTime+=o*this.scale;for(B in this._lastTime=l,this._tweenDic)(g=this._tweenDic[B])._updateEase(V);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var U=this._tweenDataList[this._index];V>=U.startTime&&(this._index++,0==U.type?(this._gidIndex++,(g=L.getItemByClass("tween",J))._create(U.target,U.data,U.duration,U.ease,m.create(this,this._animComplete,[this._gidIndex]),0,!1,U.isTo,!0,!1),g.setStartTime(V),g.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=g)._updateEase(V)):this.event("label",U.data))}},g._animComplete=function(B){this._tweenDic[B]&&delete this._tweenDic[B]},g._complete=function(){this.event("complete")},g.reset=function(){var B;if(this._labelDic)for(B in this._labelDic)delete this._labelDic[B];for(B in this._tweenDic)this._tweenDic[B].clear(),delete this._tweenDic[B];for(B in this._firstTweenDic)delete this._firstTweenDic[B];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var g,l=0;for(g=this._tweenDataList.length,l=0;l<g;l++)this._tweenDataList[l]&&this._tweenDataList[l].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,s.timer.clear(this,this._update)},g.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},A(0,g,"index",function(){return this._frameIndex},function(B){this._frameIndex=B,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),A(0,g,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),U.to=function(B,g,l,o,V){return void 0===V&&(V=0),(new U).to(B,g,l,o,V)},U.from=function(B,g,l,o,V){return void 0===V&&(V=0),(new U).from(B,g,l,o,V)},U.__init$=function(){G=function(){function B(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return N(B,""),B.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,L.recover("tweenData",this)},B}()},U}(),HB=function(V){function l(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,l.__super.call(this),this._style=G.EMPTY}N(l,"laya.display.Sprite",V);var B=l.prototype;return s.imps(B,{"laya.display.ILayout":!0}),B.createConchModel=function(){return new ConchNode},B.destroy=function(B){if(void 0===B&&(B=!0),this._releaseMem(),!this._destroyed){this.filters=null;var g=this.mask;g&&(this.mask=null,g.destroy(B))}V.prototype.destroy.call(this,B),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},B.updateZOrder=function(){$.updateOrder(this._childs)&&this.repaint()},B.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},B.setBounds=function(B){this._set$P("uBounds",B)},B.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new w),w._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},B.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new w),w._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},B._boundPointsToParent=function(B){void 0===B&&(B=!1);var g=0,l=0;this._style&&(g=this._style._tf.translateX,l=this._style._tf.translateY,B=B||0!==this._style._tf.rotate,this._style.scrollRect&&(g+=this._style.scrollRect.x,l+=this._style.scrollRect.y));var o=this._getBoundPointsM(B);if(!o||o.length<1)return o;if(8!=o.length&&(o=B?D.scanPList(o):w._getWrapRec(o,w.TEMP)._getBoundPoints()),!this.transform)return $.transPointList(o,this._x-g,this._y-l),o;var V=X.TEMP,U=0,y=o.length;for(U=0;U<y;U+=2)V.x=o[U],V.y=o[U+1],this.toParentPoint(V),o[U]=V.x,o[U+1]=V.y;return o},B.getGraphicBounds=function(B){return void 0===B&&(B=!1),this._graphics?this._graphics.getBounds(B):w.TEMP.setTo(0,0,0,0)},B._getBoundPointsM=function(B){if(void 0===B&&(B=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var g=$.clearArray(this._$P.temBM),l=w.TEMP;return l.copyFrom(this.scrollRect),$.concatArray(g,l._getBoundPoints()),g}for(var o,V,U,y=this._graphics?this._graphics.getBoundPoints():$.clearArray(this._$P.temBM),G=0,d=(U=this._childs).length;G<d;G++)(o=U[G])instanceof laya.display.Sprite&&1==o.visible&&(V=o._boundPointsToParent(B))&&(y=y?$.concatArray(y,V):V);return y},B.getStyle=function(){return this._style===G.EMPTY&&(this._style=new G),this._style},B.setStyle=function(B){this._style=B},B._adjustTransform=function(){this._tfChanged=!1;var B,g=this._style._tf,l=g.scaleX,o=g.scaleY;if(g.rotate||1!==l||1!==o||g.skewX||g.skewY){(B=this._transform||(this._transform=h.create())).bTransform=!0;var V=.0174532922222222*(g.rotate-g.skewX),U=.0174532922222222*(g.rotate+g.skewY),y=Math.cos(U),G=Math.sin(U),d=Math.sin(V),j=Math.cos(V);return B.a=l*y,B.b=l*G,B.c=-o*d,B.d=o*j,B.tx=B.ty=0,B}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,B},B.pos=function(B,g,l){if(void 0===l&&(l=!1),this._x!==B||this._y!==g){if(this.destroyed)return this;if(l){this._x=B,this._y=g,this.conchModel&&this.conchModel.pos(this._x,this._y);var o=this._parent;o&&0===o._repaint&&(o._repaint=1,o.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=B,this.y=g}return this},B.pivot=function(B,g){return this.pivotX=B,this.pivotY=g,this},B.size=function(B,g){return this.width=B,this.height=g,this},B.scale=function(B,g,l){void 0===l&&(l=!1);var o=this.getStyle(),V=o._tf;if(V.scaleX!=B||V.scaleY!=g){if(this.destroyed)return this;if(l){o.setScale(B,g),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(B,g),this._renderType|=4;var U=this._parent;U&&0===U._repaint&&(U._repaint=1,U.parentRepaint())}else this.scaleX=B,this.scaleY=g}return this},B.skew=function(B,g){return this.skewX=B,this.skewY=g,this},B.render=function(B,g,l){I.spriteCount++,Q.renders[this._renderType]._fun(this,B,g+this._x,l+this._y),this._repaint=0},B.drawToCanvas=function(B,g,l,o){if(E.isConchNode){var V=MB.create("2D");return new e(B,g,V).ctx.setCanvasType(1),this.conchModel.drawToCanvas(V.source,l,o),V}return t.drawToCanvas(this,this._renderType,B,g,l,o)},B.customRender=function(B,g,l){this._renderType|=1024},B._applyFilters=function(){var B;if(!E.isWebGL&&((B=this._$P.filters)&&!(B.length<1)))for(var g=0,l=B.length;g<l;g++)B[g].action.apply(this._$P.cacheCanvas)},B._isHaveGlowFilter=function(){var B,g=0;if(this.filters)for(g=0;g<this.filters.length;g++)if(8==this.filters[g].type)return!0;for(g=0,B=this._childs.length;g<B;g++)if(this._childs[g]._isHaveGlowFilter())return!0;return!1},B.localToGlobal=function(B,g){void 0===g&&(g=!1),!0===g&&(B=new X(B.x,B.y));for(var l=this;l&&l!=s.stage;)B=l.toParentPoint(B),l=l.parent;return B},B.globalToLocal=function(B,g){void 0===g&&(g=!1),g&&(B=new X(B.x,B.y));for(var l=this,o=[];l&&l!=s.stage;)o.push(l),l=l.parent;for(var V=o.length-1;0<=V;)B=(l=o[V]).fromParentPoint(B),V--;return B},B.toParentPoint=function(B){if(!B)return B;B.x-=this.pivotX,B.y-=this.pivotY,this.transform&&this._transform.transformPoint(B),B.x+=this._x,B.y+=this._y;var g=this._style.scrollRect;return g&&(B.x-=g.x,B.y-=g.y),B},B.fromParentPoint=function(B){if(!B)return B;B.x-=this._x,B.y-=this._y;var g=this._style.scrollRect;return g&&(B.x+=g.x,B.y+=g.y),this.transform&&this._transform.invertTransformPoint(B),B.x+=this.pivotX,B.y+=this.pivotY,B},B.on=function(B,g,l,o){return 1!==this._mouseEnableState&&this.isMouseEvent(B)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(B,g,l,o,!1)):V.prototype.on.call(this,B,g,l,o)},B.once=function(B,g,l,o){return 1!==this._mouseEnableState&&this.isMouseEvent(B)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(B,g,l,o,!0)):V.prototype.once.call(this,B,g,l,o)},B._$2__onDisplay=function(){if(1!==this._mouseEnableState){var B=this;for(B=B.parent;B&&1!==B._mouseEnableState&&!B._getBit(2);)B.mouseEnabled=!0,B._setBit(2,!0),B=B.parent}},B.loadImage=function(B,g,l,o,V,U){var y=this;return void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0),void 0===V&&(V=0),this.graphics.loadImage(B,g,l,o,V,function(B){y.destroyed||(y.size(g+(o||B.width),l+(V||B.height)),y.repaint(),U&&U.runWith(B))}),this},B.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},B._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},B._childChanged=function(B){this._childs.length?this._renderType|=2048:this._renderType&=-2049,B&&this._get$P("hasZorder")&&s.timer.callLater(this,this.updateZOrder),this.repaint()},B.parentRepaint=function(){var B=this._parent;B&&0===B._repaint&&(B._repaint=1,B.parentRepaint())},B.startDrag=function(B,g,l,o,V,U,y){void 0===g&&(g=!1),void 0===l&&(l=0),void 0===o&&(o=300),void 0===U&&(U=!1),void 0===y&&(y=.92),this._$P.dragging||this._set$P("dragging",new R),this._$P.dragging.start(this,B,g,l,o,V,U,y)},B.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},B._releaseMem=function(){if(this._$P){var B=this._$P.cacheCanvas;B&&B.ctx&&(L.recover("RenderContext",B.ctx),B.ctx.canvas.size(0,0),B.ctx=null);var g=this._$P._filterCache;g&&(g.destroy(),g.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},B._setDisplay=function(B){B||this._releaseMem(),V.prototype._setDisplay.call(this,B)},B.hitTestPoint=function(B,g){var l=this.globalToLocal(X.TEMP.setTo(B,g));return B=l.x,g=l.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?w.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(B,g)},B.getMousePoint=function(){return this.globalToLocal(X.TEMP.setTo(s.stage.mouseX,s.stage.mouseY))},B._getWords=function(){return null},B._addChildsToLayout=function(B){var g=this._getWords();if(null==g&&0==this._childs.length)return!1;if(g)for(var l=0,o=g.length;l<o;l++)B.push(g[l]);l=0;for(var V=this._childs.length;l<V;++l){var U=this._childs[l];U._style._enableLayout()&&U._addToLayout(B)}return!0},B._addToLayout=function(B){this._style.absolute||(this._style.block?B.push(this):this._addChildsToLayout(B)&&(this.x=this.y=0))},B._isChar=function(){return!1},B._getCSSStyle=function(){return this._style.getCSSStyle()},B._setAttributes=function(B,g){switch(B){case"x":this.x=parseFloat(g);break;case"y":this.y=parseFloat(g);break;case"width":this.width=parseFloat(g);break;case"height":this.height=parseFloat(g);break;default:this[B]=g}},B._layoutLater=function(){this.parent&&this.parent._layoutLater()},A(0,B,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(B){this._optimizeScrollRect!=B&&(this._optimizeScrollRect=B,this.conchModel&&this.conchModel.optimizeScrollRect(B))}),A(0,B,"customRenderEnable",null,function(B){if(B&&(this._renderType|=1024,E.isConchNode)){l.CustomList.push(this);var g=new MB("2d");g._setContext(new CanvasRenderingContext2D),this.customContext=new e(0,0,g),g.context.setCanvasType&&g.context.setCanvasType(2),this.conchModel.custom(g.context)}}),A(0,B,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(B){this.cacheAs=B?this._$P.hasFilter?"none":"normal":"none"}),A(0,B,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(B){var g=this._$P.cacheCanvas;if(B!==(g?g.type:"none")){if("none"!==B)this._getBit(1)||this._setUpNoticeType(1),g||(g=this._set$P("cacheCanvas",L.getItemByClass("cacheCanvas",Object))),g.type=B,g.reCache=!0,this._renderType|=16,"bitmap"==B&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(g){var l=g;l&&l.ctx&&(L.recover("RenderContext",l.ctx),l.ctx.canvas.size(0,0),l.ctx=null),L.recover("cacheCanvas",g)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),A(0,B,"zOrder",function(){return this._zOrder},function(B){this._zOrder!=B&&(this._zOrder=B,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(B),this._parent&&(B&&this._parent._set$P("hasZorder",!0),s.timer.callLater(this._parent,this.updateZOrder)))}),A(0,B,"rotation",function(){return this._style._tf.rotate},function(B){var g=this.getStyle();if(g._tf.rotate!==B){g.setRotate(B),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(B),this._renderType|=4;var l=this._parent;l&&0===l._repaint&&(l._repaint=1,l.parentRepaint())}}),A(0,B,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(B){this._width!==B&&(this._width=B,this.conchModel&&this.conchModel.size(B,this._height),this.repaint())}),A(0,B,"x",function(){return this._x},function(B){if(this._x!==B){if(this.destroyed)return;this._x=B,this.conchModel&&this.conchModel.pos(B,this._y);var g=this._parent;g&&0===g._repaint&&(g._repaint=1,g.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),A(0,B,"globalScaleY",function(){for(var B=1,g=this;g&&g!==s.stage;)B*=g.scaleY,g=g.parent;return B}),A(0,B,"hitArea",function(){return this._$P.hitArea},function(B){this._set$P("hitArea",B)}),A(0,B,"staticCache",function(){return this._$P.staticCache},function(B){this._set$P("staticCache",B),B||this.reCache()}),A(0,B,"texture",function(){return this._texture},function(B){this._texture!=B&&(this._texture=B,this.graphics.cleanByTexture(B,0,0))}),A(0,B,"y",function(){return this._y},function(B){if(this._y!==B){if(this.destroyed)return;this._y=B,this.conchModel&&this.conchModel.pos(this._x,B);var g=this._parent;g&&0===g._repaint&&(g._repaint=1,g.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),A(0,B,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(B){this._height!==B&&(this._height=B,this.conchModel&&this.conchModel.size(this._width,B),this.repaint())}),A(0,B,"blendMode",function(){return this._style.blendMode},function(B){this.getStyle().blendMode=B,this.conchModel&&this.conchModel.blendMode(B),B&&"source-over"!=B?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),A(0,B,"scaleX",function(){return this._style._tf.scaleX},function(B){var g=this.getStyle();if(g._tf.scaleX!==B){g.setScaleX(B),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(B,g._tf.scaleY),this._renderType|=4;var l=this._parent;l&&0===l._repaint&&(l._repaint=1,l.parentRepaint())}}),A(0,B,"scaleY",function(){return this._style._tf.scaleY},function(B){var g=this.getStyle();if(g._tf.scaleY!==B){g.setScaleY(B),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(g._tf.scaleX,B),this._renderType|=4;var l=this._parent;l&&0===l._repaint&&(l._repaint=1,l.parentRepaint())}}),A(0,B,"stage",function(){return s.stage}),A(0,B,"skewX",function(){return this._style._tf.skewX},function(B){var g=this.getStyle();if(g._tf.skewX!==B){g.setSkewX(B),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(B,g._tf.skewY),this._renderType|=4;var l=this._parent;l&&0===l._repaint&&(l._repaint=1,l.parentRepaint())}}),A(0,B,"scrollRect",function(){return this._style.scrollRect},function(B){this.getStyle().scrollRect=B,this.repaint(),B?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(B.x,B.y,B.width,B.height)):(this._renderType&=-129,this.conchModel&&(l.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),A(0,B,"skewY",function(){return this._style._tf.skewY},function(B){var g=this.getStyle();if(g._tf.skewY!==B){g.setSkewY(B),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(g._tf.skewX,B),this._renderType|=4;var l=this._parent;l&&0===l._repaint&&(l._repaint=1,l.parentRepaint())}}),A(0,B,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(B){this._tfChanged=!1,(this._transform=B)&&(this._x=B.tx,this._y=B.ty,B.tx=B.ty=0,this.conchModel&&this.conchModel.transform(B.a,B.b,B.c,B.d,this._x,this._y)),B?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),A(0,B,"pivotX",function(){return this._style._tf.translateX},function(B){this.getStyle().setTranslateX(B),this.conchModel&&this.conchModel.pivot(B,this._style._tf.translateY),this.repaint()}),A(0,B,"pivotY",function(){return this._style._tf.translateY},function(B){this.getStyle().setTranslateY(B),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,B),this.repaint()}),A(0,B,"alpha",function(){return this._style.alpha},function(B){this._style&&this._style.alpha!==B&&(B=B<0?0:1<B?1:B,this.getStyle().alpha=B,this.conchModel&&this.conchModel.alpha(B),1!==B?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),A(0,B,"visible",function(){return this._style.visible},function(B){this._style&&this._style.visible!==B&&(this.getStyle().visible=B,this.conchModel&&this.conchModel.visible(B),this.parentRepaint())}),A(0,B,"graphics",function(){return this._graphics||(this.graphics=t.createGraphics())},function(B){this._graphics&&(this._graphics._sp=null),(this._graphics=B)?(this._renderType&=-2,this._renderType|=512,(B._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(l.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),A(0,B,"filters",function(){return this._$P.filters},function(B){B&&0===B.length&&(B=null),this._$P.filters!=B&&(this._set$P("filters",B?B.slice():null),E.isConchApp&&(this.conchModel&&(l.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),E.isWebGL&&(B&&B.length?this._renderType|=32:this._renderType&=-33),B&&0<B.length?(this._getBit(1)||this._setUpNoticeType(1),E.isWebGL&&1==B.length&&B[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(E.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),A(0,B,"parent",V.prototype._$get_parent,function(B){s.superSet(BB,this,"parent",B),B&&this._getBit(2)&&this._$2__onDisplay()}),A(0,B,"mask",function(){return this._$P._mask},function(B){B&&this.mask&&this.mask._$P.maskParent||(B?(this.cacheAs="bitmap",this._set$P("_mask",B),B._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",B),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(B?B.conchModel:null),this._renderType|=64,this.parentRepaint())}),A(0,B,"mouseEnabled",function(){return 1<this._mouseEnableState},function(B){this._mouseEnableState=B?2:1}),A(0,B,"globalScaleX",function(){for(var B=1,g=this;g&&g!==s.stage;)B*=g.scaleX,g=g.parent;return B}),A(0,B,"mouseX",function(){return this.getMousePoint().x}),A(0,B,"mouseY",function(){return this.getMousePoint().y}),l.fromImage=function(B){return(new l).loadImage(B)},l._cachePool=[],l.CustomList=[],d(l,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=y.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),l}(BB),KB=function(B){function g(B){this._audio=null,this._onEnd=null,this._resumePlay=null,g.__super.call(this),this._onEnd=$.bind(this.__onEnd,this),this._resumePlay=$.bind(this.__resumePlay,this),B.addEventListener("ended",this._onEnd),this._audio=B}N(g,"laya.media.h5audio.AudioSoundChannel",oB);var l=g.prototype;return l.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(s.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},l.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,Y.container.appendChild(this._audio),this._audio.play()}catch(B){this.event("error")}},l.play=function(B){this.isStopped=!1;try{this._audio.playbackRate=z.playbackRate,this._audio.currentTime=this.startTime}catch(B){return void this._audio.addEventListener("canplay",this._resumePlay)}z.addChannel(this),Y.container.appendChild(this._audio),!B&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},l.stop=function(){this.isStopped=!0,z.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&E.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Y.onIE||this._audio!=lB._musicAudio&&L.recover("audio:"+this.url,this._audio),Y.removeElement(this._audio),this._audio=null)},l.pause=function(){this.isStopped=!0,z.removeChannel(this),"pause"in this._audio&&this._audio.pause()},l.resume=function(){this._audio&&(this.isStopped=!1,z.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},A(0,l,"position",function(){return this._audio?this._audio.currentTime:0}),A(0,l,"duration",function(){return this._audio?this._audio.duration:0}),A(0,l,"volume",function(){return this._audio?this._audio.volume:1},function(B){this._audio&&(this._audio.volume=B)}),g}(),pB=function(B){function g(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=UB.ctx,g.__super.call(this),this._onPlayEnd=$.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}N(g,"laya.media.webaudio.WebAudioSoundChannel",oB);var l=g.prototype;return l.play=function(B){if(z.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var g=this.context,l=this.gain,o=g.createBufferSource();(this.bufferSource=o).buffer=this.audioBuffer,o.connect(l),l&&l.disconnect(),l.connect(g.destination),o.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Y.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(o.loop=!0),o.playbackRate.setTargetAtTime?o.playbackRate.setTargetAtTime(z.playbackRate,this.context.currentTime,.1):o.playbackRate.value=z.playbackRate,o.start(0,this.startTime),!B&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},l.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(s.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},l._clearBufferSource=function(){if(this.bufferSource){var B=this.bufferSource;B.stop?B.stop(0):B.noteOff(0),B.disconnect(0),B.onended=null,g._tryCleanFailed||this._tryClearBuffer(B),this.bufferSource=null}},l._tryClearBuffer=function(B){try{B.buffer=null}catch(B){g._tryCleanFailed=!0}},l.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,z.removeChannel(this),this.startHandler=null,this.completeHandler=null},l.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,z.removeChannel(this)},l.resume=function(){this.startTime=this._pauseTime,this.play(!1)},A(0,l,"position",function(){return this.bufferSource?(Y.now()-this._startTime)/1e3+this.startTime:0}),A(0,l,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),A(0,l,"volume",function(){return this._volume},function(B){this.isStopped||(this._volume=B,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(B,this.context.currentTime,.1):this.gain.gain.value=B)}),g._tryCleanFailed=!1,g}(),xB=function(B){function g(){g.__super.call(this),this._w=0,this._h=0}N(g,"laya.resource.Bitmap",jB);var l=g.prototype;return A(0,l,"width",function(){return this._w}),A(0,l,"height",function(){return this._h}),A(0,l,"source",function(){return this._source}),g}(),NB=function(g){function B(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,B.__super.call(this),this._interval=o.animationInterval,this._setUpNoticeType(1)}N(B,"laya.display.AnimationPlayerBase",g);var l=B.prototype;return l.play=function(B,g,l,o){void 0===B&&(B=0),void 0===g&&(g=!0),void 0===l&&(l=""),void 0===o&&(o=!0),this._isPlaying=!0,this.index="string"==typeof B?this._getFrameByLabel(B):B,this.loop=g,this._actionName=l,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},l._getFrameByLabel=function(B){var g=0;for(g=0;g<this._count;g++)if(this._labels[g]&&0<=this._labels[g].indexOf(B))return g;return 0},l._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},l._setControlNode=function(B){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=B)&&B!=this&&(B.on("display",this,this._checkResumePlaying),B.on("undisplay",this,this._checkResumePlaying))},l._setDisplay=function(B){g.prototype._setDisplay.call(this,B),this._checkResumePlaying()},l._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},l.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},l.addLabel=function(B,g){this._labels||(this._labels={}),this._labels[g]||(this._labels[g]=[]),this._labels[g].push(B)},l.removeLabel=function(B){if(B){if(this._labels)for(var g in this._labels)this._removeLabelFromLabelList(this._labels[g],B)}else this._labels=null},l._removeLabelFromLabelList=function(B,g){if(B)for(var l=B.length-1;0<=l;l--)B[l]==g&&B.splice(l,1)},l.gotoAndStop=function(B){this.index="string"==typeof B?this._getFrameByLabel(B):B,this.stop()},l._displayToIndex=function(B){},l.clear=function(){this.stop(),this._labels=null},A(0,l,"interval",function(){return this._interval},function(B){this._interval!=B&&(this._frameRateChanged=!0,this._interval=B,this._isPlaying&&0<B&&this.timerLoop(B,this,this._frameLoop,null,!0,!0))}),A(0,l,"isPlaying",function(){return this._isPlaying}),A(0,l,"index",function(){return this._index},function(B){if(this._index=B,this._displayToIndex(B),this._labels&&this._labels[B])for(var g=this._labels[B],l=0,o=g.length;l<o;l++)this.event("label",g[l])}),A(0,l,"count",function(){return this._count}),B.WRAP_POSITIVE=0,B.WRAP_REVERSE=1,B.WRAP_PINGPONG=2,B}(HB),FB=function(g){function p(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,p.__super.call(this),this.overflow=p.VISIBLE,this._style=new gB(this),this._style.wordWrap=!1}N(p,"laya.display.Text",g);var B=p.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._lines=null,this._words&&(this._words.length=0,this._words=null)},B._getBoundPointsM=function(B){void 0===B&&(B=!1);var g=w.TEMP;return g.setTo(0,0,this.width,this.height),g._getBoundPoints()},B.getGraphicBounds=function(B){void 0===B&&(B=!1);var g=w.TEMP;return g.setTo(0,0,this.width,this.height),g},B._getCSSStyle=function(){return this._style},B.lang=function(B,g,l,o,V,U,y,G,d,j,A){if(B=p.langPacks&&p.langPacks[B]?p.langPacks[B]:B,arguments.length<2)this._text=B;else{for(var H=0,K=arguments.length;H<K;H++)B=B.replace("{"+H+"}",arguments[H+1]);this._text=B}},B._isPassWordMode=function(){var B=this._style.password;return"prompt"in this&&this.prompt==this._text&&(B=!1),B},B._getPassWordTxt=function(B){var g;g="";for(var l=B.length;0<l;l--)g+="●";return g},B.renderText=function(B,g){var l=this.graphics;l.clear(!0);var o=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Y.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);Y.context.font=o;var V=this.padding,U=V[3],y="left",G=this._lines,d=this.leading+this._charSize.height,j=this._currBitmapFont;j&&(d=this.leading+j.getMaxHeight());var A=V[0];if(!j&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(y="right",U=this._width-V[1]):"center"==this.align&&(y="center",U=.5*this._width+V[3]-V[1])),0<this._height){var H=this._textHeight>this._height?"top":this.valign;"middle"===H?A=.5*(this._height-g*d)+V[0]-V[2]:"bottom"===H&&(A=this._height-g*d-V[2])}var K=this._style;if(j&&j.autoScaleSize)var p=j.fontSize/this.fontSize;if(this._clipPoint)if(l.save(),j&&j.autoScaleSize){var x=0,N=0;x=this._width?this._width-V[3]-V[1]:this._textWidth,N=this._height?this._height-V[0]-V[2]:this._textHeight,x*=p,N*=p,l.clipRect(V[3],V[0],x,N)}else l.clipRect(V[3],V[0],this._width?this._width-V[3]-V[1]:this._textWidth,this._height?this._height-V[0]-V[2]:this._textHeight);var F=K.password;"prompt"in this&&this.prompt==this._text&&(F=!1);for(var C=0,m=0,M=Math.min(this._lines.length,g+B)||1,b=B;b<M;b++){var D,v=G[b];if(F){var s=v.length;v="";for(var X=s;0<X;X--)v+="●"}if(C=U-(this._clipPoint?this._clipPoint.x:0),m=A+d*b-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(y,C,m,b),j){var w=this.width;j.autoScaleSize&&(w=this.width*p),j.drawText(v,this,C,m,this.align,w)}else E.isWebGL?(this._words||(this._words=[]),(D=this._words.length>b-B?this._words[b-B]:new O).setText(v)):D=v,K.stroke?l.fillBorderText(D,C,m,o,this.color,K.strokeColor,K.stroke,y):l.fillText(D,C,m,o,this.color,y)}if(j&&j.autoScaleSize){var i=1/p;this.scale(i,i)}this._clipPoint&&l.restore(),this._startX=U,this._startY=A},B.drawUnderline=function(B,g,l,o){var V=this._lineWidths[o];switch(B){case"center":g-=V/2;break;case"right":g-=V}l+=this._charSize.height,this._graphics.drawLine(g,l,g+V,l,this.underlineColor||this.color,1)},B.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);Y.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new X(0,0)):this._clipPoint=null;var B=this._lines.length;if(this.overflow!=p.VISIBLE){var g=this.overflow==p.HIDDEN?Math.floor:Math.ceil;B=Math.min(B,g((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var l=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(l,B),this.repaint()},B.evalTextSize=function(){var B,g=NaN;B=Math.max.apply(this,this._lineWidths),g=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],B==this._textWidth&&g==this._textHeight||(this._textWidth=B,this._textHeight=g,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},B.checkEnabledViewportOrNot=function(){return this.overflow==p.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},B.changeText=function(B){this._text!==B&&(this.lang(B+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},B.parseLines=function(B){var g=this.wordWrap||this.overflow==p.HIDDEN;if(g)var l=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var o=$.contextMeasureText(p._testWord);E.isConchApp&&0===o.width&&0===o.height&&(o=$.contextMeasureText("W")),this._charSize.width=o.width,this._charSize.height=o.height||this.fontSize}for(var V=B.replace(/\r\n/g,"\n").split("\n"),U=0,y=V.length;U<y;U++){var G=V[U];g?this.parseLine(G,l):(this._lineWidths.push(this.getTextWidth(G)),this._lines.push(G))}},B.parseLine=function(B,g){Y.context;var l,o=this._lines,V=0,U=NaN,y=NaN,G=0;if((U=this.getTextWidth(B))<=g)return o.push(B),void this._lineWidths.push(U);U=this._charSize.width,0==(V=Math.floor(g/U))&&(V=1),y=U=this.getTextWidth(B.substring(0,V));for(var d=V,j=B.length;d<j;d++)if(g<(y+=U=this.getTextWidth(B.charAt(d))))if(this.wordWrap){var A=B.substring(G,d);if(A.charCodeAt(A.length-1)<255?(l=/(?:\w|-)+$/.exec(A))&&(d=l.index+G,0==l.index?d+=A.length:A=B.substring(G,d)):p.RightToLeft&&(l=/([\u0600-\u06FF])+$/.exec(A))&&(d=l.index+G,0==l.index?d+=A.length:A=B.substring(G,d)),o.push(A),this._lineWidths.push(y-U),!((G=d)+V<j)){o.push(B.substring(G,j)),this._lineWidths.push(this.getTextWidth(o[o.length-1])),G=-1;break}d+=V,y=U=this.getTextWidth(B.substring(G,d)),d--}else if(this.overflow==p.HIDDEN)return o.push(B.substring(0,d)),void this._lineWidths.push(this.getTextWidth(o[o.length-1]));this.wordWrap&&-1!=G&&(o.push(B.substring(G,j)),this._lineWidths.push(this.getTextWidth(o[o.length-1])))},B.getTextWidth=function(B){return this._currBitmapFont?this._currBitmapFont.getTextWidth(B):$.contextMeasureText(B).width},B.getWordWrapWidth=function(){var B=this.padding,g=NaN;return(g=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(g=this.wordWrap?100:Y.width),g<=0&&(g=100),g-B[3]-B[1]},B.getCharPoint=function(B,g){this._isChanged&&s.timer.runCallLater(this,this.typeset);for(var l=0,o=this._lines,V=0,U=0,y=o.length;U<y;U++){if(B<(l+=o[U].length)){var G=U;break}V=l}var d=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Y.context.font=d;var j=this.getTextWidth(this._text.substring(V,B));return(g||new X).setTo(this._startX+j-(this._clipPoint?this._clipPoint.x:0),this._startY+G*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},A(0,B,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(B){B!=this._width&&(s.superSet(HB,this,"width",B),this.isChanged=!0)}),A(0,B,"textWidth",function(){return this._isChanged&&s.timer.runCallLater(this,this.typeset),this._textWidth}),A(0,B,"height",function(){return this._height?this._height:this.textHeight},function(B){B!=this._height&&(s.superSet(HB,this,"height",B),this.isChanged=!0)}),A(0,B,"textHeight",function(){return this._isChanged&&s.timer.runCallLater(this,this.typeset),this._textHeight}),A(0,B,"padding",function(){return this._getCSSStyle().padding},function(B){this._getCSSStyle().padding=B,this.isChanged=!0}),A(0,B,"bold",function(){return this._getCSSStyle().bold},function(B){this._getCSSStyle().bold=B,this.isChanged=!0}),A(0,B,"text",function(){return this._text||""},function(B){this._text!==B&&(this.lang(B+""),this.isChanged=!0,this.event("change"))}),A(0,B,"color",function(){return this._getCSSStyle().color},function(B){this._getCSSStyle().color!=B&&(this._getCSSStyle().color=B,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),A(0,B,"font",function(){return this._getCSSStyle().fontFamily},function(B){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),p._bitmapFonts&&p._bitmapFonts[B]&&(this._currBitmapFont=p._bitmapFonts[B]),this._getCSSStyle().fontFamily=B,this.isChanged=!0}),A(0,B,"fontSize",function(){return this._getCSSStyle().fontSize},function(B){this._getCSSStyle().fontSize=B,this.isChanged=!0}),A(0,B,"italic",function(){return this._getCSSStyle().italic},function(B){this._getCSSStyle().italic=B,this.isChanged=!0}),A(0,B,"align",function(){return this._getCSSStyle().align},function(B){this._getCSSStyle().align=B,this.isChanged=!0}),A(0,B,"valign",function(){return this._getCSSStyle().valign},function(B){this._getCSSStyle().valign=B,this.isChanged=!0}),A(0,B,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(B){this._getCSSStyle().wordWrap=B,this.isChanged=!0}),A(0,B,"leading",function(){return this._getCSSStyle().leading},function(B){this._getCSSStyle().leading=B,this.isChanged=!0}),A(0,B,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(B){this._getCSSStyle().backgroundColor=B,this.isChanged=!0}),A(0,B,"borderColor",function(){return this._getCSSStyle().borderColor},function(B){this._getCSSStyle().borderColor=B,this.isChanged=!0}),A(0,B,"stroke",function(){return this._getCSSStyle().stroke},function(B){this._getCSSStyle().stroke=B,this.isChanged=!0}),A(0,B,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(B){this._getCSSStyle().strokeColor=B,this.isChanged=!0}),A(0,B,"isChanged",null,function(B){this._isChanged!==B&&(this._isChanged=B)&&s.timer.callLater(this,this.typeset)}),A(0,B,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(B){if(!(this.overflow!=p.SCROLL||this.textWidth<this._width)&&this._clipPoint){B=B<this.padding[3]?this.padding[3]:B;var g=this._textWidth-this._width;B=g<B?g:B;var l=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=B,this.renderText(this._lastVisibleLineIndex,l)}}),A(0,B,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(B){if(!(this.overflow!=p.SCROLL||this.textHeight<this._height)&&this._clipPoint){B=B<this.padding[0]?this.padding[0]:B;var g=this._textHeight-this._height,l=(B=g<B?g:B)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=l;var o=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=B,this.renderText(l,o)}}),A(0,B,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),A(0,B,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),A(0,B,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),A(0,B,"underlineColor",function(){return this._underlineColor},function(B){this._underlineColor=B,this._isChanged=!0,this.typeset()}),p.registerBitmapFont=function(B,g){p._bitmapFonts||(p._bitmapFonts={}),p._bitmapFonts[B]=g},p.unregisterBitmapFont=function(B,g){if(void 0===g&&(g=!0),p._bitmapFonts&&p._bitmapFonts[B]){var l=p._bitmapFonts[B];g&&l.destroy(),delete p._bitmapFonts[B]}},p.setTextRightToLeft=function(){var B;(B=Y.canvas.source.style).display="none",B.position="absolute",B.direction="rtl",E._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,Y.document.body.appendChild(Y.canvas.source)},p.supportFont=function(B){Y.context.font="10px sans-serif";var g=$.contextMeasureText("abcji").width;Y.context.font="10px "+B;var l=$.contextMeasureText("abcji").width;return console.log(g,l),g!==l},p._testWord="游",p.langPacks=null,p.VISIBLE="visible",p.SCROLL="scroll",p.HIDDEN="hidden",p.CharacterCache=!0,p.RightToLeft=!1,p._bitmapFonts=null,d(p,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),p}(HB),CB=function(H){function y(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",y.__super.call(this),this.offset=new X,this._canvasTransform=new h,this._previousOrientation=Y.window.orientation;var g=this;this.transform=h.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var B=Y.window,l=this;B.addEventListener("focus",function(){g._isFocused=!0,l.event("focus"),l.event("focuschange")}),B.addEventListener("blur",function(){g._isFocused=!1,l.event("blur"),l.event("focuschange"),l._isInputting()&&(DB.inputElement.target.focus=!1)});var o="visibilityState",V="visibilitychange",U=B.document;void 0!==U.hidden?(V="visibilitychange",o="visibilityState"):void 0!==U.mozHidden?(V="mozvisibilitychange",o="mozVisibilityState"):void 0!==U.msHidden?(V="msvisibilitychange",o="msVisibilityState"):void 0!==U.webkitHidden&&(V="webkitvisibilitychange",o="webkitVisibilityState"),B.document.addEventListener(V,function(){"hidden"==Y.document[o]?l._setStageVisible(!1):l._setStageVisible(!0)}),B.document.addEventListener("qbrowserVisibilityChange",function(B){l._setStageVisible(!B.hidden)}),B.addEventListener("resize",function(){var B=Y.window.orientation;null!=B&&B!=g._previousOrientation&&l._isInputting()&&(DB.inputElement.target.focus=!1),g._previousOrientation=B,l._isInputting()||l._resetCanvas()}),B.addEventListener("orientationchange",function(B){l._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Y.onMobile&&this.on("mousedown",this,this._onmouseMove)}N(y,"laya.display.Stage",H);var B=y.prototype;return B._setStageVisible=function(B){this._isVisibility!=B&&(this._isVisibility=B,this._isVisibility||this._isInputting()&&(DB.inputElement.target.focus=!1),this.event("visibilitychange"))},B._isInputting=function(){return Y.onMobile&&DB.isInputting},B._changeCanvasSize=function(){this.setScreenSize(Y.clientWidth*Y.pixelRatio,Y.clientHeight*Y.pixelRatio)},B._resetCanvas=function(){if(this.screenAdaptationEnabled){var B=E._mainCanvas;B.source.style;B.size(1,1),s.timer.once(100,this,this._changeCanvasSize)}},B.setScreenSize=function(B,g){var l=!1;if("none"!==this._screenMode&&(l=(B/g<1?"vertical":"horizontal")!==this._screenMode)){var o=g;g=B,B=o}this.canvasRotation=l;var V=E._mainCanvas,U=V.source.style,y=this._canvasTransform.identity(),G=this._scaleMode,d=B/this.designWidth,j=g/this.designHeight,A=this.designWidth,H=this.designHeight,K=B,p=g,x=Y.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,G){case"noscale":d=j=1,K=this.designWidth,p=this.designHeight;break;case"showall":d=j=Math.min(d,j),A=K=Math.round(this.designWidth*d),H=p=Math.round(this.designHeight*j);break;case"noborder":d=j=Math.max(d,j),K=Math.round(this.designWidth*d),p=Math.round(this.designHeight*j);break;case"full":d=j=1,this._width=A=B,this._height=H=g;break;case"fixedwidth":j=d,this._height=H=Math.round(g/d);break;case"fixedheight":d=j,this._width=A=Math.round(B/j);break;case"fixedauto":B/g<this.designWidth/this.designHeight?(j=d,this._height=H=Math.round(g/d)):(d=j,this._width=A=Math.round(B/j))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,A=A+1&2147483646,H=H+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),d*=this.scaleX,j*=this.scaleY,1===d&&1===j?this.transform.identity():(this.transform.a=this._formatData(d/(K/A)),this.transform.d=this._formatData(j/(p/H)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),V.size(A,H),t.changeWebGLSize(A,H),y.scale(K/A/x,p/H/x),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(B-K)/x:this.offset.x=.5*(B-K)/x,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(g-p)/x:this.offset.y=.5*(g-p)/x,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),y.translate(this.offset.x,this.offset.y),this.canvasDegree=0,l&&("horizontal"===this._screenMode?(y.rotate(Math.PI/2),y.translate(g/x,0),this.canvasDegree=90):(y.rotate(-Math.PI/2),y.translate(0,B/x),this.canvasDegree=-90)),y.a=this._formatData(y.a),y.d=this._formatData(y.d),y.tx=this._formatData(y.tx),y.ty=this._formatData(y.ty),U.transformOrigin=U.webkitTransformOrigin=U.msTransformOrigin=U.mozTransformOrigin=U.oTransformOrigin="0px 0px 0px",U.transform=U.webkitTransform=U.msTransform=U.mozTransform=U.oTransform="matrix("+y.toString()+")",y.translate(parseInt(U.left)||0,parseInt(U.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},B._formatData=function(B){return Math.abs(B)<1e-6?0:Math.abs(1-B)<.001?0<B?1:-1:B},B.getMousePoint=function(){return X.TEMP.setTo(this.mouseX,this.mouseY)},B.repaint=function(){this._repaint=1},B.parentRepaint=function(){},B._loop=function(){return this.render(E.context,0,0),!0},B._onmouseMove=function(B){this._mouseMoveTime=Y.now()},B.getTimeFromFrameStart=function(){return Y.now()-this._frameStartTime},B.render=function(B,g,l){if("sleep"===this._frameRate&&!E.isConchApp){var o=Y.now();if(!(1e3<=o-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(I.loopCount++,x.instance.runEvent(),s.timer._update()));this._frameStartTime=o}if(this._renderCount++,E.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=Y.now();var V="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),U=this._renderCount%2==0;if(I.renderSlow=!V,V||U||E.isConchApp){var y;I.loopCount++,x.instance.runEvent(),s.timer._update(),t.update3DLoop();var G=0,d=0;if(E.isConchNode)for(G=0,d=this._scenes.length;G<d;G++)(y=this._scenes[G])&&y._updateSceneConch();else for(G=0,d=this._scenes.length;G<d;G++)(y=this._scenes[G])&&y._updateScene();if(E.isConchNode){var j=HB.CustomList;for(G=0,d=j.length;G<d;G++){var A=j[G];A.customRender(A.customContext,0,0)}return}}E.isConchNode||this.renderingEnabled&&(V||!U||E.isConchWebGL)&&(E.isWebGL?E.WebGL.mainContext&&!E.WebGL.mainContext.isContextLost()&&(B.clear(),H.prototype.render.call(this,B,g,l),I._show&&I._sp&&I._sp.render(B,g,l),t.clear(this._bgColor),t.beginFlush(),B.flush(),t.endFinish(),u.instance&&u.getInstance().endDispose()):(t.clear(this._bgColor),H.prototype.render.call(this,B,g,l),I._show&&I._sp&&I._sp.render(B,g,l)))}else this._renderCount%5==0&&(I.loopCount++,x.instance.runEvent(),s.timer._update())},B._requestFullscreen=function(){var B=Y.document.documentElement;B.requestFullscreen?B.requestFullscreen():B.mozRequestFullScreen?B.mozRequestFullScreen():B.webkitRequestFullscreen?B.webkitRequestFullscreen():B.msRequestFullscreen&&B.msRequestFullscreen()},B._fullScreenChanged=function(){s.stage.event("fullscreenchange")},B.exitFullscreen=function(){var B=Y.document;B.exitFullscreen?B.exitFullscreen():B.mozCancelFullScreen?B.mozCancelFullScreen():B.webkitExitFullscreen&&B.webkitExitFullscreen()},A(0,B,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),A(0,B,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),A(0,B,"frameRate",function(){return this._frameRate},function(B){if(this._frameRate=B,E.isConchApp)switch(this._frameRate){case"slow":Y.window.conch&&Y.window.conchConfig.setSlowFrame&&Y.window.conchConfig.setSlowFrame(!0);break;case"fast":Y.window.conch&&Y.window.conchConfig.setSlowFrame&&Y.window.conchConfig.setSlowFrame(!1);break;case"mouse":Y.window.conch&&Y.window.conchConfig.setMouseFrame&&Y.window.conchConfig.setMouseFrame(2e3);break;case"sleep":Y.window.conch&&Y.window.conchConfig.setLimitFPS&&Y.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),A(0,B,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),A(0,B,"width",H.prototype._$get_width,function(B){this.designWidth=B,s.superSet(HB,this,"width",B),s.timer.callLater(this,this._changeCanvasSize)}),A(0,B,"alignH",function(){return this._alignH},function(B){this._alignH=B,s.timer.callLater(this,this._changeCanvasSize)}),A(0,B,"isFocused",function(){return this._isFocused}),A(0,B,"height",H.prototype._$get_height,function(B){this.designHeight=B,s.superSet(HB,this,"height",B),s.timer.callLater(this,this._changeCanvasSize)}),A(0,B,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||h.create()},H.prototype._$set_transform),A(0,B,"isVisibility",function(){return this._isVisibility}),A(0,B,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),A(0,B,"scaleMode",function(){return this._scaleMode},function(B){this._scaleMode=B,s.timer.callLater(this,this._changeCanvasSize)}),A(0,B,"alignV",function(){return this._alignV},function(B){this._alignV=B,s.timer.callLater(this,this._changeCanvasSize)}),A(0,B,"bgColor",function(){return this._bgColor},function(B){this._bgColor=B,this.conchModel&&this.conchModel.bgColor(B),E.isWebGL&&(B?y._wgColor=T.create(B)._color:Y.onMiniGame||(y._wgColor=null)),Y.onLimixiu?y._wgColor=T.create(B)._color:E.canvas.style.background=B||"none"}),A(0,B,"mouseX",function(){return Math.round(x.instance.mouseX/this.clientScaleX)}),A(0,B,"mouseY",function(){return Math.round(x.instance.mouseY/this.clientScaleY)}),A(0,B,"screenMode",function(){return this._screenMode},function(B){this._screenMode=B}),A(0,B,"visible",H.prototype._$get_visible,function(B){this.visible!==B&&(s.superSet(HB,this,"visible",B),E._mainCanvas.source.style.visibility=B?"visible":"hidden")}),A(0,B,"fullScreenEnabled",null,function(B){var g=Y.document,l=E.canvas;B?(l.addEventListener("mousedown",this._requestFullscreen),l.addEventListener("touchstart",this._requestFullscreen),g.addEventListener("fullscreenchange",this._fullScreenChanged),g.addEventListener("mozfullscreenchange",this._fullScreenChanged),g.addEventListener("webkitfullscreenchange",this._fullScreenChanged),g.addEventListener("msfullscreenchange",this._fullScreenChanged)):(l.removeEventListener("mousedown",this._requestFullscreen),l.removeEventListener("touchstart",this._requestFullscreen),g.removeEventListener("fullscreenchange",this._fullScreenChanged),g.removeEventListener("mozfullscreenchange",this._fullScreenChanged),g.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),g.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),y.SCALE_NOSCALE="noscale",y.SCALE_EXACTFIT="exactfit",y.SCALE_SHOWALL="showall",y.SCALE_NOBORDER="noborder",y.SCALE_FULL="full",y.SCALE_FIXED_WIDTH="fixedwidth",y.SCALE_FIXED_HEIGHT="fixedheight",y.SCALE_FIXED_AUTO="fixedauto",y.ALIGN_LEFT="left",y.ALIGN_RIGHT="right",y.ALIGN_CENTER="center",y.ALIGN_TOP="top",y.ALIGN_MIDDLE="middle",y.ALIGN_BOTTOM="bottom",y.SCREEN_NONE="none",y.SCREEN_HORIZONTAL="horizontal",y.SCREEN_VERTICAL="vertical",y.FRAME_FAST="fast",y.FRAME_SLOW="slow",y.FRAME_MOUSE="mouse",y.FRAME_SLEEP="sleep",y.FRAME_MOUSE_THREDHOLD=2e3,d(y,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),y}(HB),mB=(function(B){function g(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,g.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}N(g,"laya.media.SoundNode",HB);var l=g.prototype;l._onParentChange=function(){this.target=this.parent},l.play=function(B,g){void 0===B&&(B=1),isNaN(B)&&(B=1),this.url&&(this.stop(),this._channel=z.playSound(this.url,B,null,g))},l.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},l._setPlayAction=function(B,g,l,o){void 0===o&&(o=!0),this[l]&&B&&(o?B.on(g,this,this[l]):B.off(g,this,this[l]))},l._setPlayActions=function(B,g,l,o){if(void 0===o&&(o=!0),B&&g){var V,U=g.split(","),y=0;for(V=U.length,y=0;y<V;y++)this._setPlayAction(B,U[y],l,o)}},A(0,l,"playEvent",null,function(B){(this._playEvents=B)&&this._tar&&this._setPlayActions(this._tar,B,"play")}),A(0,l,"target",null,function(B){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=B,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),A(0,l,"stopEvent",null,function(B){(this._stopEvents=B)&&this._tar&&this._setPlayActions(this._tar,B,"stop")})}(),function(B){function g(){this._src=null,this._onload=null,this._onerror=null,g.__super.call(this)}N(g,"laya.resource.FileBitmap",xB);var l=g.prototype;return A(0,l,"src",function(){return this._src},function(B){this._src=B}),A(0,l,"onload",null,function(B){}),A(0,l,"onerror",null,function(B){}),g}()),MB=function(B){function l(B,g){this._is2D=!1,l.__super.call(this);var o=this;if(this._source=this,"2D"===B||"AUTO"===B&&!E.isWebGL){this._is2D=!0,this._source=g||Y.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var V=this;V.getContext=function(B,g){if(o._ctx)return o._ctx;var l=o._ctx=o._source.getContext(B,g);return l&&(l._canvas=V,E.isFlash||Y.onLimixiu||(l.size=function(B,g){})),l}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}N(l,"laya.resource.HTMLCanvas",xB);var g=l.prototype;return g.clear=function(){this._ctx&&this._ctx.clear()},g.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},g.release=function(){},g._setContext=function(B){this._ctx=B},g.getContext=function(B,g){return this._ctx?this._ctx:this._ctx=l._createContext(this)},g.getMemSize=function(){return 0},g.size=function(B,g){(this._w!=B||this._h!=g||this._source&&(this._source.width!=B||this._source.height!=g))&&(this._w=B,this._h=g,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(B,g),this._source&&(this._source.height=g,this._source.width=B))},g.getCanvas=function(){return this._source},g.toBase64=function(B,g,l){if(this._source)if(E.isConchApp&&this._source.toBase64)this._source.toBase64(B,g,l);else{var o=this._source.toDataURL(B,g);l.call(this,o)}},A(0,g,"context",function(){return this._ctx}),A(0,g,"asBitmap",null,function(B){}),l.create=function(B,g){return new l(B,g)},l.TYPE2D="2D",l.TYPE3D="3D",l.TYPEAUTO="AUTO",l._createContext=null,l}(),bB=(function(B){function d(B,g,l,o,V,U,y,G){throw d.__super.call(this),new Error("不允许new！")}N(d,"laya.resource.HTMLSubImage",xB),d.create=function(B,g,l,o,V,U,y,G){return void 0===G&&(G=!1),new d(B,g,l,o,V,U,y,G)}}(),function(B){function H(){this._frames=null,this._url=null,H.__super.call(this),this._setControlNode(this)}N(H,"laya.display.Animation",B);var g=H.prototype;g.destroy=function(B){void 0===B&&(B=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,B),this._frames=null,this._labels=null},g.play=function(B,g,l,o){void 0===B&&(B=0),void 0===g&&(g=!0),void 0===l&&(l=""),void 0===o&&(o=!0),l&&this._setFramesFromCache(l,o),this._isPlaying=!0,this.index="string"==typeof B?this._getFrameByLabel(B):B,this.loop=g,this._actionName=l,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},g._setFramesFromCache=function(B,g){var l;return void 0===g&&(g=!1),this._url&&(B=this._url+"#"+B),B&&H.framesMap[B]?((l=H.framesMap[B])instanceof Array?(this._frames=H.framesMap[B],this._count=this._frames.length):(l.nodeRoot&&(H.framesMap[B]=this._parseGraphicAnimationByData(l),l=H.framesMap[B]),this._frames=l.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=l.interval),this._labels=this._copyLabels(l.labels)),!0):(g&&console.log("ani not found:",B),!1)},g._copyLabels=function(B){if(!B)return null;var g,l;for(l in g={},B)g[l]=$.copyArray([],B[l]);return g},g._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&B.prototype._frameLoop.call(this)},g._displayToIndex=function(B){this._frames&&(this.graphics=this._frames[B])},g.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},g.loadImages=function(B,g){return void 0===g&&(g=""),this._url="",this._setFramesFromCache(g)||(this.frames=H.framesMap[g]?H.framesMap[g]:H.createFrames(B,g)),this},g.loadAtlas=function(g,l,o){void 0===o&&(o=""),this._url="";var V=this;function B(B){g===B&&(V.frames=H.framesMap[o]?H.framesMap[o]:H.createFrames(g,o),l&&l.run())}return V._setFramesFromCache(o)||(GB.getAtlas(g)?B(g):s.loader.load(g,m.create(null,B,[g]),null,"atlas")),this},g.loadAnimation=function(B,g,l){this._url=B;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,g&&g.run()):!l||GB.getAtlas(l)?this._loadAnimationData(B,g,l):s.loader.load(l,m.create(this,this._loadAnimationData,[B,g,l]),null,"atlas"),this},g._loadAnimationData=function(G,d,B){var j=this;if(!B||GB.getAtlas(B)){var A=this;GB.getRes(G)?g(G):s.loader.load(G,m.create(null,g,[G]),null,"json"),GB.clearRes(G)}else console.warn("atlas load fail:"+B);function g(B){if(GB.getRes(B)&&G===B){var g;if(H.framesMap[G+"#"])A._setFramesFromCache(j._actionName,!0),j.index=0,j._checkResumePlaying();else{var l=A._parseGraphicAnimation(GB.getRes(G));if(!l)return;var o,V=l.animationList,U=0,y=V.length;for(U=0;U<y;U++)g=V[U],H.framesMap[G+"#"+g.name]=g,o||(o=g);o&&(H.framesMap[G+"#"]=o,A._setFramesFromCache(j._actionName,!0),j.index=0),j._checkResumePlaying()}d&&d.run()}}},g._parseGraphicAnimation=function(B){return sB.parseAnimationData(B)},g._parseGraphicAnimationByData=function(B){return sB.parseAnimationByData(B)},A(0,g,"frames",function(){return this._frames},function(B){(this._frames=B)&&(this._count=B.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),A(0,g,"autoPlay",null,function(B){B?this.play():this.stop()}),A(0,g,"source",null,function(B){-1<B.indexOf(".ani")?this.loadAnimation(B):-1<B.indexOf(".json")||-1<B.indexOf("als")||-1<B.indexOf("atlas")?this.loadAtlas(B):this.loadImages(B.split(","))}),A(0,g,"autoAnimation",null,function(B){this.play(0,!0,B,!1)}),H.createFrames=function(B,g){var l,o,V=0,U=0;if("string"==typeof B){var y=GB.getAtlas(B);if(y&&y.length)for(l=[],V=0,U=y.length;V<U;V++)(o=new t.createGraphics).drawTexture(GB.getRes(y[V]),0,0),l.push(o)}else if(B instanceof Array)for(l=[],V=0,U=B.length;V<U;V++)(o=new t.createGraphics).loadImage(B[V],0,0),l.push(o);return g&&(H.framesMap[g]=l),l},H.clearCache=function(B){var g,l=H.framesMap,o=B+"#";for(g in l)g!==B&&0!=g.indexOf(o)||delete H.framesMap[g]},H.framesMap={}}(NB),function(B){function U(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,U.__super.call(this),null==U._sortIndexFun&&(U._sortIndexFun=v.sortByKey("index",!1,!0))}N(U,"laya.display.FrameAnimation",B);var g=U.prototype;return g._setUp=function(B,g){this._labels=null,this._animationNewFrames=null,this._targetDic=B,this._animationData=g,this.interval=1e3/g.frameRate,g.parsed?(this._count=g.count,this._labels=g.labels,this._animationNewFrames=g.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),g.parsed=!0,g.labels=this._labels,g.count=this._count,g.animationNewFrames=this._animationNewFrames},g.clear=function(){B.prototype.clear.call(this),this._targetDic=null,this._animationData=null},g._displayToIndex=function(B){if(this._animationData){B<0&&(B=0),B>this._count&&(B=this._count);var g=this._animationData.nodes,l=0,o=g.length;for(l=0;l<o;l++)this._displayNodeToFrame(g[l],B)}},g._displayNodeToFrame=function(B,g,l){l||(l=this._targetDic);var o=l[B.target];if(o){var V,U,y,G=B.frames,d=B.keys,j=0,A=d.length;for(j=0;j<A;j++)y=(U=G[V=d[j]]).length>g?U[g]:U[U.length-1],o[V]=y}},g._calculateDatas=function(){if(this._animationData){var B,g=this._animationData.nodes,l=0,o=g.length;for(l=this._count=0;l<o;l++)B=g[l],this._calculateNodeKeyFrames(B);this._count+=1}},g._calculateNodeKeyFrames=function(B){var g,l,o=B.keyframes,V=B.target;for(g in B.frames||(B.frames={}),B.keys?B.keys.length=0:B.keys=[],B.initValues||(B.initValues={}),o)l=o[g],B.frames[g]||(B.frames[g]=[]),this._targetDic&&this._targetDic[V]&&(B.initValues[g]=this._targetDic[V][g]),l.sort(U._sortIndexFun),B.keys.push(g),this._calculateNodePropFrames(l,B.frames[g],g,V)},g.resetToInitState=function(){if(this._targetDic&&this._animationData){var B,g,l=this._animationData.nodes,o=0,V=l.length;for(o=0;o<V;o++)if(g=(B=l[o]).initValues){var U,y=this._targetDic[B.target];if(y)for(U in g)y[U]=g[U]}}},g._calculateNodePropFrames=function(B,g,l,o){var V=0,U=B.length-1;if(0<U){for(g.length=B[U].index+1,V=0;V<U;V++)this._dealKeyFrame(B[V]),this._calculateFrameValues(B[V],B[V+1],g);this._dealKeyFrame(B[V])}0==U&&(g[B[0].index]=B[0].value,this._animationNewFrames&&(this._animationNewFrames[B[0].index]=!0))},g._dealKeyFrame=function(B){B.label&&""!=B.label&&this.addLabel(B.label,B.index)},g._calculateFrameValues=function(B,g,l){var o,V=0,U=B.index,y=g.index,G=B.value,d=g.value-B.value,j=y-U;if(y>this._count&&(this._count=y),B.tween)for(null==(o=W[B.tweenMethod])&&(o=W.linearNone),V=U;V<y;V++)l[V]=o(V-U,G,d,j),this._animationNewFrames&&(this._animationNewFrames[V]=!0);else for(V=U;V<y;V++)l[V]=G;this._animationNewFrames&&(this._animationNewFrames[B.index]=!0,this._animationNewFrames[g.index]=!0),l[g.index]=g.value},U._sortIndexFun=null,U}(NB)),DB=function(g){function V(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",V.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=FB.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}N(V,"laya.display.Input",g);var B=V.prototype;return B.setSelection=function(B,g){this.focus=!0,laya.display.Input.inputElement.selectionStart=B,laya.display.Input.inputElement.selectionEnd=g},B._onUnDisplay=function(B){this.focus=!1},B._onMouseDown=function(B){this.focus=!0},B._syncInputTransform=function(){var B=this.nativeInput,g=$.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),l=this._width-this.padding[1]-this.padding[3],o=this._height-this.padding[0]-this.padding[2];E.isConchApp?(B.setScale(g.scaleX,g.scaleY),B.setSize(l,o),B.setPos(g.x,g.y)):(V.inputContainer.style.transform=V.inputContainer.style.webkitTransform="scale("+g.scaleX+","+g.scaleY+") rotate("+s.stage.canvasDegree+"deg)",B.style.width=l+"px",B.style.height=o+"px",V.inputContainer.style.left=g.x+"px",V.inputContainer.style.top=g.y+"px")},B.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},B._setInputMethod=function(){V.input.parentElement&&V.inputContainer.removeChild(V.input),V.area.parentElement&&V.inputContainer.removeChild(V.area),V.inputElement=this._multiline?V.area:V.input,V.inputContainer.appendChild(V.inputElement),FB.RightToLeft&&(V.inputElement.style.direction="rtl")},B._focusIn=function(){laya.display.Input.isInputting=!0;var B=this.nativeInput;this._focus=!0;var g=B.style;g.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),B.readOnly=!this._editable,E.isConchApp&&(B.setType(this._type),B.setForbidEdit(!this._editable)),B.maxLength=this._maxChars;this.padding;if(B.type=this._type,B.value=this._content,B.placeholder=this._prompt,s.stage.off("keydown",this,this._onKeyDown),s.stage.on("keydown",this,this._onKeyDown),(s.stage.focus=this).event("focus"),Y.onPC&&B.focus(),!Y.onMiniGame){this._text;this._text=null}this.typeset(),B.setColor(this._originColor),B.setFontSize(this.fontSize),B.setFontFace(Y.onIPhone&&FB._fontFamilyMap[this.font]||this.font),E.isConchApp&&B.setMultiAble&&B.setMultiAble(this._multiline),g.lineHeight=this.leading+this.fontSize+"px",g.fontStyle=this.italic?"italic":"normal",g.fontWeight=this.bold?"bold":"normal",g.textAlign=this.align,g.padding="0 0",this._syncInputTransform(),!E.isConchApp&&Y.onPC&&s.timer.frameLoop(1,this,this._syncInputTransform)},B._setPromptColor=function(){(V.promptStyleDOM=Y.getElementById("promptStyle"))||((V.promptStyleDOM=Y.createElement("style")).setAttribute("id","promptStyle"),Y.document.head.appendChild(V.promptStyleDOM)),V.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},B._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(s.superSet(FB,this,"text",this._content),s.superSet(FB,this,"color",this._originColor)):(s.superSet(FB,this,"text",this._prompt),s.superSet(FB,this,"color",this._promptColor)),s.stage.off("keydown",this,this._onKeyDown),s.stage.focus=null,this.event("blur"),E.isConchApp&&this.nativeInput.blur(),Y.onPC&&s.timer.clear(this,this._syncInputTransform)},B._onKeyDown=function(B){13===B.keyCode&&(Y.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},B.changeText=function(B){this._content=B,this._focus?(this.nativeInput.value=B||"",this.event("change")):g.prototype.changeText.call(this,B)},A(0,B,"color",g.prototype._$get_color,function(B){this._focus&&this.nativeInput.setColor(B),s.superSet(FB,this,"color",this._content?B:this._promptColor),this._originColor=B}),A(0,B,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(B){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),A(0,B,"multiline",function(){return this._multiline},function(B){this._multiline=B,this.valign=B?"top":"middle"}),A(0,B,"maxChars",function(){return this._maxChars},function(B){B<=0&&(B=1e5),this._maxChars=B}),A(0,B,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(B){s.superSet(FB,this,"color",this._originColor),B+="",this._focus?(this.nativeInput.value=B||"",this.event("change")):(this._multiline||(B=B.replace(/\r?\n/g,"")),(this._content=B)?s.superSet(FB,this,"text",B):(s.superSet(FB,this,"text",this._prompt),s.superSet(FB,this,"color",this.promptColor)))}),A(0,B,"nativeInput",function(){return this._multiline?V.area:V.input}),A(0,B,"prompt",function(){return this._prompt},function(B){!this._text&&B&&s.superSet(FB,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?s.superSet(FB,this,"text",this._text==this._prompt?B:this._text):s.superSet(FB,this,"text",B),this._prompt=FB.langPacks&&FB.langPacks[B]?FB.langPacks[B]:B}),A(0,B,"focus",function(){return this._focus},function(B){var g=this.nativeInput;this._focus!==B&&(B?(g.target?g.target._focusOut():this._setInputMethod(),(g.target=this)._focusIn()):(g.target=null,this._focusOut(),Y.document.body.scrollTop=0,g.blur(),E.isConchApp?g.setPos(-1e4,-1e4):V.inputContainer.contains(g)&&V.inputContainer.removeChild(g)))}),A(0,B,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(B){B?(-1<(B="[^"+B+"]").indexOf("^^")&&(B=B.replace("^^","")),this._restrictPattern=new RegExp(B,"g")):this._restrictPattern=null}),A(0,B,"editable",function(){return this._editable},function(B){this._editable=B,E.isConchApp&&V.input.setForbidEdit(!B)}),A(0,B,"promptColor",function(){return this._promptColor},function(B){this._promptColor=B,this._content||s.superSet(FB,this,"color",B)}),A(0,B,"type",function(){return this._type},function(B){this._getCSSStyle().password="password"==B,this._type=B,E.isConchApp&&this.nativeInput.setType(B)}),A(0,B,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(B){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),A(0,B,"asPassword",function(){return this._getCSSStyle().password},function(B){this._getCSSStyle().password=B,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),V.__init__=function(){V._createInputElement(),Y.onMobile&&E.canvas.addEventListener(V.IOS_IFRAME?Y.onMiniGame?"touchend":"click":"touchend",V._popupInputMethod)},V._popupInputMethod=function(B){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},V._createInputElement=function(){V._initInput(V.area=Y.createElement("textarea")),V._initInput(V.input=Y.createElement("input")),(V.inputContainer=Y.createElement("div")).style.position="absolute",V.inputContainer.style.zIndex=1e5,Y.container.appendChild(V.inputContainer),V.inputContainer.setPos=function(B,g){V.inputContainer.style.left=B+"px",V.inputContainer.style.top=g+"px"}},V._initInput=function(g){var B=g.style;B.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",B.resize="none",B.backgroundColor="transparent",B.border="none",B.outline="none",B.zIndex=1,g.addEventListener("input",V._processInputting),g.addEventListener("mousemove",V._stopEvent),g.addEventListener("mousedown",V._stopEvent),g.addEventListener("touchmove",V._stopEvent),g.setFontFace=function(B){g.style.fontFamily=B},E.isConchApp||(g.setColor=function(B){g.style.color=B},g.setFontSize=function(B){g.style.fontSize=B+"px"})},V._processInputting=function(B){var g=laya.display.Input.inputElement.target;if(g){var l=laya.display.Input.inputElement.value;g._restrictPattern&&(l=l.replace(/\u2006|\x27/g,""),g._restrictPattern.test(l)&&(l=l.replace(g._restrictPattern,""),laya.display.Input.inputElement.value=l)),g._text=l,g.event("input")}},V._stopEvent=function(B){"touchmove"==B.type&&B.preventDefault(),B.stopPropagation&&B.stopPropagation()},V.TYPE_TEXT="text",V.TYPE_PASSWORD="password",V.TYPE_EMAIL="email",V.TYPE_URL="url",V.TYPE_NUMBER="number",V.TYPE_RANGE="range",V.TYPE_DATE="date",V.TYPE_MONTH="month",V.TYPE_WEEK="week",V.TYPE_TIME="time",V.TYPE_DATE_TIME="datetime",V.TYPE_DATE_TIME_LOCAL="datetime-local",V.TYPE_SEARCH="search",V.input=null,V.area=null,V.inputElement=null,V.inputContainer=null,V.confirmButton=null,V.promptStyleDOM=null,V.inputHeight=45,V.isInputting=!1,V.stageMatrix=null,d(V,["IOS_IFRAME",function(){return this.IOS_IFRAME=Y.onIOS&&Y.window.top!=Y.window.self}]),V}(FB),vB=function(B){function l(B,g){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,l.__super.call(this),B&&this._init_(B,g)}N(l,"laya.resource.HTMLImage",mB);var g=l.prototype;return g._init_=function(B,g){this._src=B,this._source=new Y.window.Image,g&&(g.onload&&(this.onload=g.onload),g.onerror&&(this.onerror=g.onerror),g.onCreate&&g.onCreate(this)),0!=B.indexOf("data:image")&&(this._source.crossOrigin=""),B&&(this._source.src=B)},g.recreateResource=function(){var B=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var g=this;this._source=new Y.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(g._needReleaseAgain)return g._needReleaseAgain=!1,g._source.onload=null,void(g._source=null);g._source.onload=null,g.memorySize=B._w*B._h*4,g._recreateLock=!1,g.completeCreate()},this._source.src=this._src}},g.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},g.onresize=function(){this._w=this._source.width,this._h=this._source.height},A(0,g,"onload",null,function(B){var g=this;this._onload=B,this._source&&(this._source.onload=null!=this._onload?function(){g.onresize(),g._onload()}:null)}),A(0,g,"onerror",null,function(B){var g=this;this._onerror=B,this._source&&(this._source.onerror=null!=this._onerror?function(){g._onerror()}:null)}),A(0,g,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(B){this._enableMerageInAtlas=B,E.isConchApp&&this._source&&(this._source.enableMerageInAtlas=B)}),l.create=function(B,g){return new l(B,g)},l}(),sB=(function(U){function B(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,B.__super.call(this)}N(B,"laya.display.EffectAnimation",U);var g=B.prototype;g._onOtherBegin=function(B){B!=this&&this.stop()},g.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},g._onPlayAction=function(){this.play(0,!1)},g.play=function(B,g,l,o){void 0===B&&(B=0),void 0===g&&(g=!0),void 0===l&&(l=""),void 0===o&&(o=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,B,g,l,o))},g._recordInitData=function(){if(this._aniKeys){var B,g,l=0;for(B=this._aniKeys.length,l=0;l<B;l++)g=this._aniKeys[l],this._initData[g]=this._target[g]}},g._displayToIndex=function(B){if(this._animationData){B<0&&(B=0),B>this._count&&(B=this._count);var g=this._animationData.nodes,l=0,o=g.length;for(o=1<o?1:o,l=0;l<o;l++)this._displayNodeToFrame(g[l],B)}},g._displayNodeToFrame=function(B,g,l){if(this._target){var o;o=this._target;var V,U,y,G,d=B.frames,j=B.keys,A=0,H=j.length;G=B.secondFrames;var K,p,x,N,F=0;for(A=0;A<H;A++)U=d[V=j[A]],y=-1==(F=G[V])?this._initData[V]:g<F?(x=(p=B.keyframes[V])[0]).tween?(null==(K=W[x.tweenMethod])&&(K=W.linearNone),N=p[1],K(g,this._initData[V],N.value-this._initData[V],N.index)):this._initData[V]:U.length>g?U[g]:U[U.length-1],o[V]=y}},g._calculateNodeKeyFrames=function(B){U.prototype._calculateNodeKeyFrames.call(this,B);var g,l,o,V=B.keyframes;B.target;for(g in o={},B.secondFrames=o,V)(l=V[g]).length<=1?o[g]=-1:o[g]=l[1].index},A(0,g,"target",function(){return this._target},function(B){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=B,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),A(0,g,"playEvent",null,function(B){(this._playEvents=B)&&this.addEvent()}),A(0,g,"effectData",null,function(B){var g;B&&((g=B.animations)&&g[0]&&(this._setUp({},g[0]),g[0].nodes&&g[0].nodes[0]&&(this._aniKeys=g[0].nodes[0].keys)))}),A(0,g,"effectClass",null,function(B){var g,l;(this._effectClass=Z.getClass(B),this._effectClass)&&((g=this._effectClass.uiView)&&(l=g.animations)&&l[0]&&(this._setUp({},l[0]),l[0].nodes&&l[0].nodes[0]&&(this._aniKeys=l[0].nodes[0].keys)))}),B.EffectAnimationBegin="effectanimationbegin"}(bB),function(g){var a;function z(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,z.__super.call(this)}N(z,"laya.utils.GraphicAnimation",g);var B=z.prototype;return B._parseNodeList=function(B){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[B.compId]=B.props,B.compId&&this._nodeList.push(B.compId);var g=B.child;if(g){var l=0,o=g.length;for(l=0;l<o;l++)this._parseNodeList(g[l])}},B._calGraphicData=function(B){var g;if(this._setUp(null,B),this._createGraphicData(),this._nodeIDAniDic)for(g in this._nodeIDAniDic)this._nodeIDAniDic[g]=null},B._createGraphicData=function(){var B,g=[],l=0,o=this.count,V=this._animationNewFrames;for(V||(V=[]),l=0;l<o;l++)!V[l]&&B||(B=this._createFrameGraphic(l)),g.push(B);this._gList=g},B._createFrameGraphic=function(B){var g=t.createGraphics();return z._rootMatrix||(z._rootMatrix=new h),this._updateNodeGraphic(this._rootNode,B,z._rootMatrix,g),g},B._updateNodeGraphic=function(B,g,l,o,V){var U;void 0===V&&(V=1);var y,G,d,j=(U=this._nodeGDic[B.compId]=this._getNodeGraphicData(B.compId,g,this._nodeGDic[B.compId])).alpha*V;if(!(j<.01)&&(U.resultTransform||(U.resultTransform=h.create()),y=U.resultTransform,h.mul(U.transform,l,y),U.skin&&(G=this._getTextureByUrl(U.skin))&&(y._checkTransform()?(o.drawTexture(G,0,0,U.width,U.height,y,j),U.resultTransform=null):o.drawTexture(G,y.tx,y.ty,U.width,U.height,null,j)),d=B.child)){var A,H=0;for(A=d.length,H=0;H<A;H++)this._updateNodeGraphic(d[H],g,y,o,j)}},B._updateNoChilds=function(B,g){if(B.skin){var l=this._getTextureByUrl(B.skin);if(l){var o=B.transform;o._checkTransform();!o.bTransform?g.drawTexture(l,o.tx,o.ty,B.width,B.height,null,B.alpha):g.drawTexture(l,0,0,B.width,B.height,o.clone(),B.alpha)}}},B._updateNodeGraphic2=function(B,g,l){var o;if(o=this._nodeGDic[B.compId]=this._getNodeGraphicData(B.compId,g,this._nodeGDic[B.compId]),B.child){var V=o.transform;V._checkTransform();var U,y;y=(U=!V.bTransform)&&(0!=V.tx||0!=V.ty);var G,d,j;if((G=V.bTransform||1!=o.alpha)&&l.save(),1!=o.alpha&&l.alpha(o.alpha),U?y&&l.translate(V.tx,V.ty):l.transform(V.clone()),d=B.child,o.skin&&(j=this._getTextureByUrl(o.skin))&&l.drawTexture(j,0,0,o.width,o.height),d){var A,H=0;for(A=d.length,H=0;H<A;H++)this._updateNodeGraphic2(d[H],g,l)}G?l.restore():U?y&&l.translate(-V.tx,-V.ty):l.transform(V.clone().invert())}else this._updateNoChilds(o,l)},B._calculateNodeKeyFrames=function(B){g.prototype._calculateNodeKeyFrames.call(this,B),this._nodeIDAniDic[B.target]=B},B.getNodeDataByID=function(B){return this._nodeIDAniDic[B]},B._getParams=function(B,g,l,o){var V=z._temParam;V.length=g.length;var U=0,y=g.length;for(U=0;U<y;U++)V[U]=this._getObjVar(B,g[U][0],l,g[U][1],o);return V},B._getObjVar=function(B,g,l,o,V){if(B.hasOwnProperty(g)){var U=B[g];if(l>=U.length&&(l=U.length-1),null!=B[g][l])return B[g][l]}return V.hasOwnProperty(g)?V[g]:o},B._getNodeGraphicData=function(B,g,l){l||(l=a.create()),l.transform?l.transform.identity():l.transform=h.create();var o=this.getNodeDataByID(B);if(!o)return l;var V,U,y=o.frames,G=this._getParams(y,z._drawTextureCmd,g,this._nodeDefaultProps[B]),d=G[0],j=NaN,A=NaN,H=G[5],K=G[6],p=G[13],x=G[14],N=G[7],F=G[8],C=G[9],m=G[11],M=G[12];j=G[3],A=G[4],0!=j&&0!=A||(d=null),-1==j&&(j=0),-1==A&&(A=0),l.skin=d,l.width=j,l.height=A,d&&((V=this._getTextureByUrl(d))?(j||(j=V.sourceWidth),A||(A=V.sourceHeight)):console.warn("lost skin:",d,",you may load pics first")),l.alpha=G[10],U=l.transform,0!=p&&(H=p*j),0!=x&&(K=x*A),0==H&&0==K||U.translate(-H,-K);var b=null;if(C||1!==N||1!==F||m||M){(b=z._tempMt).identity(),b.bTransform=!0;var D=.0174532922222222*(C-m),v=.0174532922222222*(C+M),s=Math.cos(v),X=Math.sin(v),w=Math.sin(D),i=Math.cos(D);b.a=N*s,b.b=N*X,b.c=-F*w,b.d=F*i,b.tx=b.ty=0}return b&&(U=h.mul(U,b,U)),U.translate(G[1],G[2]),l},B._getTextureByUrl=function(B){return GB.getRes(B)},B.setAniData=function(B,g){if(B.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=B,this._parseNodeList(B);var l,o={},V=[],U=B.animations,y=0,G=U.length;for(y=0;y<G;y++)if(l=U[y],this._labels=null,(!g||g==l.name)&&l){try{this._calGraphicData(l)}catch(B){console.warn("parse animation fail:"+l.name+",empty animation created"),this._gList=[]}var d={};d.interval=1e3/l.frameRate,d.frames=this._gList,d.labels=this._labels,d.name=l.name,V.push(d),o[l.name]=d}this.animationList=V,this.animationDic=o}z._temParam.length=0},B.parseByData=function(B){var g,l;g=B.nodeRoot,l=B.aniO,delete B.nodeRoot,delete B.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=g,this._parseNodeList(g),this._labels=null;try{this._calGraphicData(l)}catch(B){console.warn("parse animation fail:"+l.name+",empty animation created"),this._gList=[]}var o=B;return o.interval=1e3/l.frameRate,o.frames=this._gList,o.labels=this._labels,o.name=l.name,o},B.setUpAniData=function(B){if(B.animations){var g,l={},o=[],V=B.animations,U=0,y=V.length;for(U=0;U<y;U++)if(g=V[U]){var G={};G.name=g.name,G.aniO=g,G.nodeRoot=B,o.push(G),l[g.name]=G}this.animationList=o,this.animationDic=l}},B._clear=function(){var B,g;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(B in this._nodeGDic)(g=this._nodeGDic[B])&&g.recover();this._nodeGDic=null},z.parseAnimationByData=function(B){var g;return z._I||(z._I=new z),g=z._I.parseByData(B),z._I._clear(),g},z.parseAnimationData=function(B){var g;return z._I||(z._I=new z),z._I.setUpAniData(B),(g={}).animationList=z._I.animationList,g.animationDic=z._I.animationDic,z._I._clear(),g},z._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],z._temParam=[],z._I=null,z._rootMatrix=null,d(z,["_tempMt",function(){return this._tempMt=new h}]),z.__init$=function(){a=function(){function B(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return N(B,""),B.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),L.recover("GraphicNode",this)},B.create=function(){return L.getItemByClass("GraphicNode",B)},B}()},z}(bB));s.__init([j,dB,E,Y,k,i,B,sB])}(window,document,Laya),function(B,g,l){l.un,l.uns,l.static;var o=l.class;l.getset,l.__newvec;new(function(){function B(){}return o(B,"LayaMain"),B}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(B,g){"use strict";for(var l in Object.defineProperty(g,"__esModule",{value:!0}),Laya){var o=Laya[l];o&&o.__isclass&&(g[l]=o)}}),function(B,g,v){v.un,v.uns;var y=v.static,K=v.class,o=v.getset,U=v.__newvec,A=laya.maths.Arith,H=laya.maths.Bezier,l=laya.resource.Bitmap,p=laya.utils.Browser,d=laya.utils.Byte,x=laya.utils.Color,s=(laya.filters.ColorFilter,v.Config),V=laya.resource.Context,X=(laya.events.Event,laya.filters.Filter),G=laya.display.Graphics,j=laya.resource.HTMLCanvas,N=(laya.utils.HTMLChar,laya.resource.HTMLImage),F=laya.resource.HTMLSubImage,w=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),i=laya.maths.Point,a=laya.maths.Rectangle,C=laya.renders.Render,m=(laya.renders.RenderContext,laya.renders.RenderSprite),M=laya.resource.Resource,b=laya.resource.ResourceManager,D=laya.utils.RunDriver,z=laya.display.Sprite,t=laya.display.Stage,h=laya.utils.Stat,f=laya.utils.StringKey,S=(laya.display.css.Style,laya.system.System),E=laya.display.Text,e=laya.resource.Texture,Q=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),_=laya.utils.VectorGraphManager;laya.utils.WordText;v.interface("laya.webgl.shapes.IShape"),v.interface("laya.webgl.submit.ISubmit"),v.interface("laya.webgl.text.ICharSegment"),v.interface("laya.webgl.canvas.save.ISaveData"),v.interface("laya.webgl.resource.IMergeAtlasBitmap"),v.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var P=function(){function B(){}K(B,"laya.filters.webgl.FilterActionGL");var g=B.prototype;return v.imps(g,{"laya.filters.IFilterActionGL":!0}),g.setValue=function(B){},g.setValueMix=function(B){},g.apply3d=function(B,g,l,o,V){return null},g.apply=function(B){return null},o(0,g,"typeMix",function(){return 0}),B}(),Y=function(){function B(){}return K(B,"laya.webgl.shader.ShaderValue"),B}(),c=function(){var o,V;function B(B,g,l){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new V,void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),this._cells=null,this._rowInfo=null,this._init(B,g),this._atlasID=l}K(B,"laya.webgl.atlas.AtlasGrid");var g=B.prototype;return g.getAltasID=function(){return this._atlasID},g.setAltasID=function(B){0<=B&&(this._atlasID=B)},g.addTex=function(B,g,l){var o=this._get(g,l);return 0==o.ret||(this._fill(o.x,o.y,g,l,B),this._texCount++),o},g._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},g._init=function(B,g){if(this._width=B,this._height=g,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=U(this._height);for(var l=0;l<this._height;l++)this._rowInfo[l]=new o;return this._clear(),!0},g._get=function(B,g){var l=new Z;if(B>=this._failSize.width&&g>=this._failSize.height)return l;for(var o=-1,V=-1,U=this._width,y=this._height,G=this._cells,d=0;d<y;d++)if(!(this._rowInfo[d].spaceCount<B))for(var j=0;j<U;){var A=3*(d*U+j);if(0!=G[A]||G[1+A]<B||G[2+A]<g)j+=G[1+A];else{o=j,V=d;for(var H=0;H<B;H++)if(G[3*H+A+2]<g){o=-1;break}if(!(o<0))return l.ret=!0,l.x=o,l.y=V,l;j+=G[1+A]}}return l},g._fill=function(B,g,l,o,V){var U=this._width,y=this._height;this._check(B+l<=U&&g+o<=y);for(var G=g;G<o+g;++G){this._check(this._rowInfo[G].spaceCount>=l),this._rowInfo[G].spaceCount-=l;for(var d=0;d<l;d++){var j=3*(B+G*U+d);this._check(0==this._cells[j]),this._cells[j]=V,this._cells[1+j]=l,this._cells[2+j]=o}}if(0<B)for(G=0;G<o;++G){var A=0;for(d=B-1;0<=d&&0==this._cells[3*((g+G)*U+d)];--d,++A);for(d=A;0<d;--d)this._cells[3*((g+G)*U+B-d)+1]=d,this._check(0<d)}if(0<g)for(d=B;d<B+l;++d){for(A=0,G=g-1;0<=G&&0==this._cells[3*(d+G*U)];--G,A++);for(G=A;0<G;--G)this._cells[3*(d+(g-G)*U)+2]=G,this._check(0<G)}},g._check=function(B){0==B&&console.log("xtexMerger 错误啦")},g._clear=function(){for(var B=this._texCount=0;B<this._height;B++)this._rowInfo[B].spaceCount=this._width;for(var g=0;g<this._height;g++)for(var l=0;l<this._width;l++){var o=3*(g*this._width+l);this._cells[o]=0,this._cells[1+o]=this._width-l,this._cells[2+o]=this._width-g}this._failSize.width=this._width+1,this._failSize.height=this._height+1},B.__init$=function(){o=function(){function B(){this.spaceCount=0}return K(B,""),B}(),V=function(){function B(){this.width=0,this.height=0}return K(B,""),B}()},B}(),r=function(){function C(B,g,l,o){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=B,this._height=g,this._gridSize=l,this._maxAtlaserCount=o,this._gridNumX=B/l,this._gridNumY=g/l,this._curAtlasIndex=0,this._atlaserArray=[]}K(C,"laya.webgl.atlas.AtlasResourceManager");var B=C.prototype;return B.setAtlasParam=function(B,g,l,o){if(1==this._setAtlasParam)return C._sid_=0,this._width=B,this._height=g,this._gridSize=l,this._maxAtlaserCount=o,this._gridNumX=B/l,this._gridNumY=g/l,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},B.pushData=function(B){var g,l=B.bitmap,o=-1,V=null,U=0,y=0;for(U=0,g=this._atlaserArray.length;U<g&&(y=(this._curAtlasIndex+U)%g,-1==(o=(V=this._atlaserArray[y]).findBitmapIsExist(l)));U++);if(-1!=o){var G=V.InAtlasWebGLImagesOffsetValue[o];return x=G[0],N=G[1],V.addToAtlas(B,x,N),!0}this._setAtlasParam=!1;for(var d=Math.ceil((B.bitmap.width+2)/this._gridSize),j=Math.ceil((B.bitmap.height+2)/this._gridSize),A=!1,H=0;H<2;H++){var K=this._maxAtlaserCount;for(U=0;U<K;U++){y=(this._curAtlasIndex+U)%K,this._atlaserArray.length-1>=y||this._atlaserArray.push(new aB(this._gridNumX,this._gridNumY,this._width,this._height,C._sid_++));var p=this._atlaserArray[y],x=0,N=0,F=p.addTex(1,d,j);if(F.ret){x=F.x*this._gridSize+1,N=F.y*this._gridSize+1,l.lock=!0,p.addToAtlasTexture(l,x,N),p.addToAtlas(B,x,N),A=!0,this._curAtlasIndex=y;break}}if(A)break;this._atlaserArray.push(new aB(this._gridNumX,this._gridNumY,this._width,this._height,C._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return A||console.log(">>>AtlasManager pushData error"),A},B.addToAtlas=function(B){laya.webgl.atlas.AtlasResourceManager.instance.pushData(B)},B.garbageCollection=function(){if(!0===this._needGC){for(var B=this._atlaserArray.length-this._maxAtlaserCount,g=0;g<B;g++)this._atlaserArray[g].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+B),this._atlaserArray.splice(0,B),this._needGC=!1}return!0},B.freeAll=function(){for(var B=0,g=this._atlaserArray.length;B<g;B++)this._atlaserArray[B].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},B.getAtlaserCount=function(){return this._atlaserArray.length},B.getAtlaserByIndex=function(B){return this._atlaserArray[B]},o(1,C,"instance",function(){return C._Instance||(C._Instance=new C(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),C._Instance}),o(1,C,"enabled",function(){return s.atlasEnable}),o(1,C,"atlasLimitWidth",function(){return C._atlasLimitWidth},function(B){C._atlasLimitWidth=B}),o(1,C,"atlasLimitHeight",function(){return C._atlasLimitHeight},function(B){C._atlasLimitHeight=B}),C._enable=function(){s.atlasEnable=!0},C._disable=function(){s.atlasEnable=!1},C.__init__=function(){C.atlasTextureWidth=2048,C.atlasTextureHeight=2048,C.maxTextureCount=6,C.atlasLimitWidth=512,C.atlasLimitHeight=512},C._atlasLimitWidth=0,C._atlasLimitHeight=0,C.gridSize=16,C.atlasTextureWidth=0,C.atlasTextureHeight=0,C.maxTextureCount=0,C._atlasRestore=0,C.BOARDER_TYPE_NO=0,C.BOARDER_TYPE_RIGHT=1,C.BOARDER_TYPE_LEFT=2,C.BOARDER_TYPE_BOTTOM=4,C.BOARDER_TYPE_TOP=8,C.BOARDER_TYPE_ALL=15,C._sid_=0,C._Instance=null,C}(),Z=function(){function B(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return K(B,"laya.webgl.atlas.MergeFillInfo"),B}(),T=function(){function g(){}return K(g,"laya.webgl.canvas.BlendMode"),g._init_=function(B){g.fns=[g.BlendNormal,g.BlendAdd,g.BlendMultiply,g.BlendScreen,g.BlendOverlay,g.BlendLight,g.BlendMask,g.BlendDestinationOut],g.targetFns=[g.BlendNormalTarget,g.BlendAddTarget,g.BlendMultiplyTarget,g.BlendScreenTarget,g.BlendOverlayTarget,g.BlendLightTarget,g.BlendMask,g.BlendDestinationOut]},g.BlendNormal=function(B){B.blendFunc(1,771)},g.BlendAdd=function(B){B.blendFunc(1,772)},g.BlendMultiply=function(B){B.blendFunc(774,771)},g.BlendScreen=function(B){B.blendFunc(1,1)},g.BlendOverlay=function(B){B.blendFunc(1,769)},g.BlendLight=function(B){B.blendFunc(1,1)},g.BlendNormalTarget=function(B){B.blendFunc(1,771)},g.BlendAddTarget=function(B){B.blendFunc(1,772)},g.BlendMultiplyTarget=function(B){B.blendFunc(774,771)},g.BlendScreenTarget=function(B){B.blendFunc(1,1)},g.BlendOverlayTarget=function(B){B.blendFunc(1,769)},g.BlendLightTarget=function(B){B.blendFunc(1,1)},g.BlendMask=function(B){B.blendFunc(0,770)},g.BlendDestinationOut=function(B){B.blendFunc(0,0)},g.activeBlendFunction=null,g.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],g.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},g.NORMAL="normal",g.ADD="add",g.MULTIPLY="multiply",g.SCREEN="screen",g.LIGHT="light",g.OVERLAY="overlay",g.DESTINATIONOUT="destination-out",g.fns=[],g.targetFns=[],g}(),R=function(){function l(B){this._color=x.create("black"),this.setValue(B)}K(l,"laya.webgl.canvas.DrawStyle");var B=l.prototype;return B.setValue=function(B){if(B){if("string"==typeof B)return void(this._color=x.create(B));if(B instanceof laya.utils.Color)return void(this._color=B)}},B.reset=function(){this._color=x.create("black")},B.equal=function(B){return"string"==typeof B?this._color.strColor===B:B instanceof laya.utils.Color&&this._color.numColor===B.numColor},B.toColorStr=function(){return this._color.strColor},l.create=function(B){var g;if(B&&("string"==typeof B?g=x.create(B):B instanceof laya.utils.Color&&(g=B),g))return g._drawStyle||(g._drawStyle=new l(B));return laya.webgl.canvas.DrawStyle.DEFAULT},y(l,["DEFAULT",function(){return this.DEFAULT=new l("#000000")}]),l}(),W=function(){function B(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];bB.mainContext;this.ib=qB.create(35048),this.vb=OB.create(5)}K(B,"laya.webgl.canvas.Path");var g=B.prototype;return g.addPoint=function(B,g){this.tempArray.push(B,g)},g.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},g.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},g.polygon=function(B,g,l,o,V,U){var y;return this.geomatrys.push(this._curGeomatry=y=new fB(B,g,l,o,V,U)),o||(y.fill=!1),null==U&&(y.borderWidth=0),y},g.setGeomtry=function(B){this.geomatrys.push(this._curGeomatry=B)},g.drawLine=function(B,g,l,o,V){var U;return this.closePath?this.geomatrys.push(this._curGeomatry=U=new hB(B,g,l,o,V)):this.geomatrys.push(this._curGeomatry=U=new tB(B,g,l,o,V)),U.fill=!1,U},g.update=function(){var B=this.ib._byteLength,g=this.geomatrys.length;this.offset=B;for(var l=this.geoStart;l<g;l++)this.geomatrys[l].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=g,this.count=(this.ib._byteLength-B)/NB.BYTES_PIDX},g.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},g.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},B}(),n=function(){function G(){}K(G,"laya.webgl.canvas.save.SaveBase");var B=G.prototype;return v.imps(B,{"laya.webgl.canvas.save.ISaveData":!0}),B.isSaveMark=function(){return!1},B.restore=function(B){this._dataObj[this._valueName]=this._value,(G._cache[G._cache._length++]=this)._newSubmit&&(B._curSubmit=UB.RENDERBASE,B._renderKey=0)},G._createArray=function(){var B=[];return B._length=0,B},G._init=function(){var B=G._namemap={};return B[1]="ALPHA",B[2]="fillStyle",B[8]="font",B[256]="lineWidth",B[512]="strokeStyle",B[8192]="_mergeID",B[1024]=B[2048]=B[4096]=[],B[16384]="textBaseline",B[32768]="textAlign",B[65536]="_nBlendType",B[1048576]="shader",B[2097152]="filters",B},G.save=function(B,g,l,o){if((B._saveMark._saveuse&g)!==g){B._saveMark._saveuse|=g;var V=G._cache,U=0<V._length?V[--V._length]:new G;U._value=l[U._valueName=G._namemap[g]],U._dataObj=l,U._newSubmit=o;var y=B._save;y[y._length++]=U}},G._cache=laya.webgl.canvas.save.SaveBase._createArray(),G._namemap=G._init(),G}(),L=function(){function U(){this._clipRect=new a}K(U,"laya.webgl.canvas.save.SaveClipRect");var B=U.prototype;return v.imps(B,{"laya.webgl.canvas.save.ISaveData":!0}),B.isSaveMark=function(){return!1},B.restore=function(B){B._clipRect=this._clipSaveRect,(U._cache[U._cache._length++]=this)._submitScissor.submitLength=B._submits._length-this._submitScissor.submitIndex,B._curSubmit=UB.RENDERBASE,B._renderKey=0},U.save=function(B,g){if(131072!=(131072&B._saveMark._saveuse)){B._saveMark._saveuse|=131072;var l=U._cache,o=0<l._length?l[--l._length]:new U;o._clipSaveRect=B._clipRect,B._clipRect=o._clipRect.copyFrom(B._clipRect),o._submitScissor=g;var V=B._save;V[V._length++]=o}},y(U,["_cache",function(){return this._cache=n._createArray()}]),U}(),I=function(){function p(){this._contextX=0,this._contextY=0,this._clipRect=new a,this._rect=new a,this._matrix=new w}K(p,"laya.webgl.canvas.save.SaveClipRectStencil");var B=p.prototype;return v.imps(B,{"laya.webgl.canvas.save.ISaveData":!0}),B.isSaveMark=function(){return!1},B.restore=function(B){AB.restore(B,this._rect,this._saveMatrix,this._contextX,this._contextY),B._clipRect=this._clipSaveRect,B._curMat=this._saveMatrix,B._x=this._contextX,B._y=this._contextY,p._cache[p._cache._length++]=this,B._curSubmit=UB.RENDERBASE},p.save=function(B,g,l,o,V,U,y,G,d,j){if(262144!=(262144&B._saveMark._saveuse)){B._saveMark._saveuse|=262144;var A=p._cache,H=0<A._length?A[--A._length]:new p;H._clipSaveRect=B._clipRect,H._clipRect.setTo(y,G,d,j),B._clipRect=H._clipRect,H._rect.x=l,H._rect.y=o,H._rect.width=V,H._rect.height=U,H._contextX=B._x,H._contextY=B._y,H._saveMatrix=B._curMat,B._curMat.copyTo(H._matrix),B._curMat=H._matrix,H._submitStencil=g;var K=B._save;K[K._length++]=H}},y(p,["_cache",function(){return this._cache=n._createArray()}]),p}(),k=function(){function o(){this._saveuse=0}K(o,"laya.webgl.canvas.save.SaveMark");var B=o.prototype;return v.imps(B,{"laya.webgl.canvas.save.ISaveData":!0}),B.isSaveMark=function(){return!0},B.restore=function(B){B._saveMark=this._preSaveMark,o._no[o._no._length++]=this},o.Create=function(B){var g=o._no,l=0<g._length?g[--g._length]:new o;return l._saveuse=0,l._preSaveMark=B._saveMark,B._saveMark=l},y(o,["_no",function(){return this._no=n._createArray()}]),o}(),J=function(){function U(){this._matrix=new w}K(U,"laya.webgl.canvas.save.SaveTransform");var B=U.prototype;return v.imps(B,{"laya.webgl.canvas.save.ISaveData":!0}),B.isSaveMark=function(){return!1},B.restore=function(B){B._curMat=this._savematrix,U._no[U._no._length++]=this},U.save=function(B){var g=B._saveMark;if(2048!=(2048&g._saveuse)){g._saveuse|=2048;var l=U._no,o=0<l._length?l[--l._length]:new U;o._savematrix=B._curMat,B._curMat=B._curMat.copyTo(o._matrix);var V=B._save;V[V._length++]=o}},y(U,["_no",function(){return this._no=n._createArray()}]),U}(),$=function(){function V(){}K(V,"laya.webgl.canvas.save.SaveTranslate");var B=V.prototype;return v.imps(B,{"laya.webgl.canvas.save.ISaveData":!0}),B.isSaveMark=function(){return!1},B.restore=function(B){B._curMat;B._x=this._x,B._y=this._y,V._no[V._no._length++]=this},V.save=function(B){var g=V._no,l=0<g._length?g[--g._length]:new V;l._x=B._x,l._y=B._y;var o=B._save;o[o._length++]=l},y(V,["_no",function(){return this._no=n._createArray()}]),V}(),u=function(){function B(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new a}K(B,"laya.webgl.resource.RenderTargetMAX");var g=B.prototype;return g.setSP=function(B){this._sp=B},g.size=function(B,g){var l=this;this._width!==B||this._height!==g?(this.repaint=!0,this._width=B,this._height=g,this.target?this.target.size(B,g):this.target=_B.create(B,g),this.target.hasListener("recovered")||this.target.on("recovered",this,function(B){v.timer.callLater(l._sp,l._sp.repaint)})):this.target.size(B,g)},g._flushToTarget=function(B,g){if(!g._destroy){var l=mB.worldScissorTest,o=mB.worldClipRect;mB.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,mB.worldScissorTest=!1,bB.mainContext.disable(3089);var V=mB.worldAlpha,U=mB.worldMatrix4,y=mB.worldMatrix,G=mB.worldFilters,d=mB.worldShaderDefines;if(mB.worldMatrix=w.EMPTY,mB.restoreTempArray(),mB.worldMatrix4=mB.TEMPMAT4_ARRAY,mB.worldAlpha=1,mB.worldFilters=null,mB.worldShaderDefines=null,QB.activeShader=null,g.start(),s.showCanvasMark?g.clear(0,1,0,.3):g.clear(0,0,0,0),B.flush(),g.end(),QB.activeShader=null,mB.worldAlpha=V,mB.worldMatrix4=U,mB.worldMatrix=y,mB.worldFilters=G,mB.worldShaderDefines=d,mB.worldScissorTest=l){var j=mB.height-o.y-o.height;bB.mainContext.scissor(o.x,j,o.width,o.height),bB.mainContext.enable(3089)}mB.worldClipRect=o}},g.flush=function(B){this.repaint&&(this._flushToTarget(B,this.target),this.repaint=!1)},g.drawTo=function(B,g,l,o,V){B.drawTexture(this.target.getTexture(),g,l,o,V,0,0)},g.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},B}(),q=function(){function B(){this.ALPHA=1,this.shaderType=0,this.defines=new zB}return K(B,"laya.webgl.shader.d2.Shader2D"),B.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},B.__init__=function(){var B,g;kB.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),kB.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),kB.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),kB.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),kB.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),kB.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),kB.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),kB.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),B="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",g='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',kB.preCompile2D(0,1,B,g,null),B="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",g='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',kB.preCompile2D(0,2,B,g,null),B="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",g="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",kB.preCompile2D(0,4,B,g,null),B="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",g='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',kB.preCompile2D(0,256,B,g,null),B="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",g="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",kB.preCompile2D(0,512,B,g,null)},B}(),O=function(){function g(B,g,l){this._value=0,this._name2int=B,this._int2name=g,this._int2nameMap=l}K(g,"laya.webgl.shader.ShaderDefines");var B=g.prototype;return B.add=function(B){return"string"==typeof B&&(B=this._name2int[B]),this._value|=B,this._value},B.addInt=function(B){return this._value|=B,this._value},B.remove=function(B){return"string"==typeof B&&(B=this._name2int[B]),this._value&=~B,this._value},B.isDefine=function(B){return(this._value&B)===B},B.getValue=function(){return this._value},B.setValue=function(B){this._value=B},B.toNameDic=function(){var B=this._int2nameMap[this._value];return B||g._toText(this._value,this._int2name,this._int2nameMap)},g._reg=function(B,g,l,o){o[l[B]=g]=B},g._toText=function(B,g,l){var o=l[B];if(o)return o;for(var V={},U=1,y=0;y<32&&!(B<(U=1<<y));y++)if(B&U){var G=g[U];G&&(V[G]="")}return l[B]=V},g._toInt=function(B,g){for(var l=B.split("."),o=0,V=0,U=l.length;V<U;V++){var y=g[l[V]];if(!y)throw new Error("Defines to int err:"+B+"/"+l[V]);o|=y}return o},g}(),BB=function(){function y(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new w}K(y,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var B=y.prototype;return B.init=function(B,g,l){if(g)this._vs=g;else{this._vs=[];var o=B.width,V=B.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(o,0,1,0,1,1,1,1),this._vs.push(o,V,1,1,1,1,1,1),this._vs.push(0,V,0,1,1,1,1,1)}l?this._ps=l:(y._defaultPS||(y._defaultPS=[]).push(0,1,3,3,1,2),this._ps=y._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=B},B.init2=function(B,g,l,o,V){this.transform&&(this.transform=null),l?this._ps=l:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=o,this._uvs=V,this.mEleNum=this._ps.length,this.mTexture=B,(C.isConchNode||C.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},B._initMyData=function(){var B=0,g=0,l=4*this._verticles.length;this._vs=y._tempVS;var o=!1;if(C.isConchNode||C.isConchApp?(this._vs.length=l,o=!0):this._vs.length<l&&(this._vs.length=l,o=!0),y._tVSLen=l,o)for(;B<l;)this._vs[B]=this._verticles[g],this._vs[B+1]=this._verticles[g+1],this._vs[B+2]=this._uvs[g],this._vs[B+3]=this._uvs[g+1],this._vs[B+4]=1,this._vs[B+5]=1,this._vs[B+6]=1,this._vs[B+7]=1,B+=8,g+=2;else for(;B<l;)this._vs[B]=this._verticles[g],this._vs[B+1]=this._verticles[g+1],this._vs[B+2]=this._uvs[g],this._vs[B+3]=this._uvs[g+1],B+=8,g+=2},B.getData2=function(B,g,l){var o;this.mVBBuffer=B,this.mIBBuffer=g,this._initMyData(),B.appendEx2(this._vs,Float32Array,y._tVSLen,4),this._indexStart=g._byteLength,(o=y._tempIB).length<this._ps.length&&(o.length=this._ps.length);for(var V=0,U=this._ps.length;V<U;V++)o[V]=this._ps[V]+l;g.appendEx2(o,Uint16Array,this._ps.length,2)},B.getData=function(B,g,l){if(this.mVBBuffer=B,this.mIBBuffer=g,B.append(this.mVBData),this._indexStart=g._byteLength,this.mIBData.start!=l){for(var o=0,V=this._ps.length;o<V;o++)this.mIBData[o]=this._ps[o]+l;this.mIBData.start=l}g.append(this.mIBData)},B.render=function(B,g,l){if(C.isWebGL&&this.mTexture){B._renderKey=0,B._shader2D.glTexture=null,gB.getInstance().addSkinMesh(this);var o=UB.createShape(B,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,XB.create(512,0));this.transform||(this.transform=w.EMPTY),this.transform.translate(g,l),w.mul(this.transform,B._curMat,this._tempMatrix),this.transform.translate(-g,-l);var V=o.shaderValue,U=V.u_mmat2||mB.getMatrArray();mB.mat2MatArray(this._tempMatrix,U),V.textureHost=this.mTexture,V.offsetX=0,V.offsetY=0,V.u_mmat2=U,V.ALPHA=B._shader2D.ALPHA,B._submits[B._submits._length++]=o}else C.isConchApp&&this.mTexture&&(this.transform||(this.transform=w.EMPTY),B.setSkinMesh&&B.setSkinMesh(g,l,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},y._tempVS=[],y._tempIB=[],y._defaultPS=null,y._tVSLen=0,y}(),gB=function(){function B(){this.ib=null,this.vb=null;bB.mainContext;this.ib=qB.create(35048),this.vb=OB.create(8)}K(B,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var g=B.prototype;return g.addSkinMesh=function(B){B.getData2(this.vb,this.ib,this.vb._byteLength/32)},g.reset=function(){this.vb.clear(),this.ib.clear()},B.getInstance=function(){return B.instance=B.instance||new B},B.instance=null,B}(),lB=function(){function B(B,g,l,o,V,U,y,G,d){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===d&&(d=0),this.x=B,this.y=g,this.width=l,this.height=o,this.edges=V,this.color=U,this.borderWidth=y,this.borderColor=G}K(B,"laya.webgl.shapes.BasePoly");var g=B.prototype;return v.imps(g,{"laya.webgl.shapes.IShape":!0}),g.getData=function(B,g,l){},g.rebuild=function(B){},g.setMatrix=function(B){},g.needUpdate=function(B){return!0},g.sector=function(B,g,l){var o=this.x,V=this.y,U=this.edges,y=(this.r1-this.r0)/U,G=this.width,d=this.height,j=this.color,A=(j>>16&255)/255,H=(j>>8&255)/255,K=(255&j)/255;B.push(o,V,A,H,K);for(var p=0;p<U+1;p++)B.push(o+Math.sin(y*p+this.r0)*G,V+Math.cos(y*p+this.r0)*d),B.push(A,H,K);for(p=0;p<U;p++)g.push(l,l+p+1,l+p+2)},g.createLine2=function(B,g,l,o,V,U){var y,G,d,j,A,H,K,p,x,N,F,C,m,M,b,D,v,s,X,w,i=B.concat(),a=V,z=this.borderColor,t=(z>>16&255)/255,h=(z>>8&255)/255,f=(255&z)/255,S=i.length/2,E=o,e=l/2;d=i[0],j=i[1],N=d-(A=i[2]),x=(x=-(j-(H=i[3])))/(w=Math.sqrt(x*x+N*N))*e,N=N/w*e,a.push(d-x+this.x,j-N+this.y,t,h,f,d+x+this.x,j+N+this.y,t,h,f);for(var Q=1;Q<S-1;Q++)d=i[2*(Q-1)],j=i[2*(Q-1)+1],A=i[2*Q],H=i[2*Q+1],K=i[2*(Q+1)],p=i[2*(Q+1)+1],N=d-A,C=A-K,b=(-(x=(x=-(j-H))/(w=Math.sqrt(x*x+N*N))*e)+d)*(-(N=N/w*e)+H)-(-x+A)*(-N+j),s=(-(F=(F=-(H-p))/(w=Math.sqrt(F*F+C*C))*e)+K)*(-(C=C/w*e)+H)-(-F+A)*(-C+p),X=(m=-N+j-(-N+H))*(v=-F+A-(-F+K))-(D=-C+p-(-C+H))*(M=-x+A-(-x+d)),Math.abs(X)<.1?(X+=10.1,a.push(A-x+this.x,H-N+this.y,t,h,f,A+x+this.x,H+N+this.y,t,h,f)):(((y=(M*s-v*b)/X)-A)*(y-A)+((G=(D*b-m*s)/X)-H)+(G-H),a.push(y+this.x,G+this.y,t,h,f,A-(y-A)+this.x,H-(G-H)+this.y,t,h,f));d=i[i.length-4],j=i[i.length-3],N=d-(A=i[i.length-2]),x=(x=-(j-(H=i[i.length-1])))/(w=Math.sqrt(x*x+N*N))*e,N=N/w*e,a.push(A-x+this.x,H-N+this.y,t,h,f,A+x+this.x,H+N+this.y,t,h,f);var _=U;for(Q=1;Q<_;Q++)g.push(E+2*(Q-1),E+2*(Q-1)+1,E+2*Q+1,E+2*Q+1,E+2*Q,E+2*(Q-1));return a},g.createLine=function(B,g,l,o){var V=B.concat(),U=B,y=this.borderColor,G=(y>>16&255)/255,d=(y>>8&255)/255,j=(255&y)/255;V.splice(0,5);var A,H,K,p,x,N,F,C,m,M,b,D,v,s,X,w,i,a,z,t,h=V.length/5,f=o,S=l/2;K=V[0],p=V[1],M=K-(x=V[5]),m=(m=-(p-(N=V[6])))/(t=Math.sqrt(m*m+M*M))*S,M=M/t*S,U.push(K-m,p-M,G,d,j,K+m,p+M,G,d,j);for(var E=1;E<h-1;E++)K=V[5*(E-1)],p=V[5*(E-1)+1],x=V[5*E],N=V[5*E+1],F=V[5*(E+1)],C=V[5*(E+1)+1],M=K-x,D=x-F,X=(-(m=(m=-(p-N))/(t=Math.sqrt(m*m+M*M))*S)+K)*(-(M=M/t*S)+N)-(-m+x)*(-M+p),a=(-(b=(b=-(N-C))/(t=Math.sqrt(b*b+D*D))*S)+F)*(-(D=D/t*S)+N)-(-b+x)*(-D+C),z=(v=-M+p-(-M+N))*(i=-b+x-(-b+F))-(w=-D+C-(-D+N))*(s=-m+x-(-m+K)),Math.abs(z)<.1?(z+=10.1,U.push(x-m,N-M,G,d,j,x+m,N+M,G,d,j)):(((A=(s*a-i*X)/z)-x)*(A-x)+((H=(w*X-v*a)/z)-N)+(H-N),U.push(A,H,G,d,j,x-(A-x),N-(H-N),G,d,j));K=V[V.length-10],p=V[V.length-9],M=K-(x=V[V.length-5]),m=(m=-(p-(N=V[V.length-4])))/(t=Math.sqrt(m*m+M*M))*S,M=M/t*S,U.push(x-m,N-M,G,d,j,x+m,N+M,G,d,j);var e=this.edges+1;for(E=1;E<e;E++)g.push(f+2*(E-1),f+2*(E-1)+1,f+2*E+1,f+2*E+1,f+2*E,f+2*(E-1));return U},g.createLoopLine=function(B,g,l,o,V,U){var y=B.concat(),G=V||B,d=this.borderColor,j=(d>>16&255)/255,A=(d>>8&255)/255,H=(255&d)/255;y.splice(0,5);var K=[y[0],y[1]],p=[y[y.length-5],y[y.length-4]],x=p[0]+.5*(K[0]-p[0]),N=p[1]+.5*(K[1]-p[1]);y.unshift(x,N,0,0,0),y.push(x,N,0,0,0);var F,C,m,M,b,D,v,s,X,w,i,a,z,t,h,f,S,E,e,Q,_=y.length/5,P=o,Y=l/2;m=y[0],M=y[1],w=m-(b=y[5]),X=(X=-(M-(D=y[6])))/(Q=Math.sqrt(X*X+w*w))*Y,w=w/Q*Y,G.push(m-X,M-w,j,A,H,m+X,M+w,j,A,H);for(var c=1;c<_-1;c++)m=y[5*(c-1)],M=y[5*(c-1)+1],b=y[5*c],D=y[5*c+1],v=y[5*(c+1)],s=y[5*(c+1)+1],w=m-b,a=b-v,h=(-(X=(X=-(M-D))/(Q=Math.sqrt(X*X+w*w))*Y)+m)*(-(w=w/Q*Y)+D)-(-X+b)*(-w+M),E=(-(i=(i=-(D-s))/(Q=Math.sqrt(i*i+a*a))*Y)+v)*(-(a=a/Q*Y)+D)-(-i+b)*(-a+s),e=(z=-w+M-(-w+D))*(S=-i+b-(-i+v))-(f=-a+s-(-a+D))*(t=-X+b-(-X+m)),Math.abs(e)<.1?(e+=10.1,G.push(b-X,D-w,j,A,H,b+X,D+w,j,A,H)):(((F=(t*E-S*h)/e)-b)*(F-b)+((C=(f*h-z*E)/e)-D)+(C-D),G.push(F,C,j,A,H,b-(F-b),D-(C-D),j,A,H));U&&(g=U);var r=this.edges+1;for(c=1;c<r;c++)g.push(P+2*(c-1),P+2*(c-1)+1,P+2*c+1,P+2*c+1,P+2*c,P+2*(c-1));return g.push(P+2*(c-1),P+2*(c-1)+1,P+1,P+1,P,P+2*(c-1)),G},B}(),oB=function(){function N(){}return K(N,"laya.webgl.shapes.Earcut"),N.earcut=function(B,g,l){l=l||2;var o,V,U,y,G,d,j,A=g&&g.length,H=A?g[0]*l:B.length,K=N.linkedList(B,0,H,l,!0),p=[];if(!K)return p;if(A&&(K=N.eliminateHoles(B,g,K,l)),B.length>80*l){o=U=B[0],V=y=B[1];for(var x=l;x<H;x+=l)(G=B[x])<o&&(o=G),(d=B[x+1])<V&&(V=d),U<G&&(U=G),y<d&&(y=d);j=0!==(j=Math.max(U-o,y-V))?1/j:0}return N.earcutLinked(K,p,l,o,V,j),p},N.linkedList=function(B,g,l,o,V){var U,y;if(V===0<N.signedArea(B,g,l,o))for(U=g;U<l;U+=o)y=N.insertNode(U,B[U],B[U+1],y);else for(U=l-o;g<=U;U-=o)y=N.insertNode(U,B[U],B[U+1],y);return y&&N.equals(y,y.next)&&(N.removeNode(y),y=y.next),y},N.filterPoints=function(B,g){if(!B)return B;g||(g=B);var l,o=B;do{if(l=!1,o.steiner||!N.equals(o,o.next)&&0!==N.area(o.prev,o,o.next))o=o.next;else{if(N.removeNode(o),(o=g=o.prev)===o.next)break;l=!0}}while(l||o!==g);return g},N.earcutLinked=function(B,g,l,o,V,U,y){if(B){!y&&U&&N.indexCurve(B,o,V,U);for(var G,d,j=B;B.prev!==B.next;)if(G=B.prev,d=B.next,U?N.isEarHashed(B,o,V,U):N.isEar(B))g.push(G.i/l),g.push(B.i/l),g.push(d.i/l),N.removeNode(B),B=d.next,j=d.next;else if((B=d)===j){y?1===y?(B=N.cureLocalIntersections(B,g,l),N.earcutLinked(B,g,l,o,V,U,2)):2===y&&N.splitEarcut(B,g,l,o,V,U):N.earcutLinked(N.filterPoints(B,null),g,l,o,V,U,1);break}}},N.isEar=function(B){var g=B.prev,l=B,o=B.next;if(0<=N.area(g,l,o))return!1;for(var V=B.next.next;V!==B.prev;){if(N.pointInTriangle(g.x,g.y,l.x,l.y,o.x,o.y,V.x,V.y)&&0<=N.area(V.prev,V,V.next))return!1;V=V.next}return!0},N.isEarHashed=function(B,g,l,o){var V=B.prev,U=B,y=B.next;if(0<=N.area(V,U,y))return!1;for(var G=V.x<U.x?V.x<y.x?V.x:y.x:U.x<y.x?U.x:y.x,d=V.y<U.y?V.y<y.y?V.y:y.y:U.y<y.y?U.y:y.y,j=V.x>U.x?V.x>y.x?V.x:y.x:U.x>y.x?U.x:y.x,A=V.y>U.y?V.y>y.y?V.y:y.y:U.y>y.y?U.y:y.y,H=N.zOrder(G,d,g,l,o),K=N.zOrder(j,A,g,l,o),p=B.nextZ;p&&p.z<=K;){if(p!==B.prev&&p!==B.next&&N.pointInTriangle(V.x,V.y,U.x,U.y,y.x,y.y,p.x,p.y)&&0<=N.area(p.prev,p,p.next))return!1;p=p.nextZ}for(p=B.prevZ;p&&p.z>=H;){if(p!==B.prev&&p!==B.next&&N.pointInTriangle(V.x,V.y,U.x,U.y,y.x,y.y,p.x,p.y)&&0<=N.area(p.prev,p,p.next))return!1;p=p.prevZ}return!0},N.cureLocalIntersections=function(B,g,l){var o=B;do{var V=o.prev,U=o.next.next;!N.equals(V,U)&&N.intersects(V,o,o.next,U)&&N.locallyInside(V,U)&&N.locallyInside(U,V)&&(g.push(V.i/l),g.push(o.i/l),g.push(U.i/l),N.removeNode(o),N.removeNode(o.next),o=B=U),o=o.next}while(o!==B);return o},N.splitEarcut=function(B,g,l,o,V,U){var y=B;do{for(var G=y.next.next;G!==y.prev;){if(y.i!==G.i&&N.isValidDiagonal(y,G)){var d=N.splitPolygon(y,G);return y=N.filterPoints(y,y.next),d=N.filterPoints(d,d.next),N.earcutLinked(y,g,l,o,V,U),void N.earcutLinked(d,g,l,o,V,U)}G=G.next}y=y.next}while(y!==B)},N.eliminateHoles=function(B,g,l,o){var V,U,y,G,d,j=[];for(V=0,U=g.length;V<U;V++)y=g[V]*o,G=V<U-1?g[V+1]*o:B.length,(d=N.linkedList(B,y,G,o,!1))===d.next&&(d.steiner=!0),j.push(N.getLeftmost(d));for(j.sort(N.compareX),V=0;V<j.length;V++)N.eliminateHole(j[V],l),l=N.filterPoints(l,l.next);return l},N.compareX=function(B,g){return B.x-g.x},N.eliminateHole=function(B,g){if(g=N.findHoleBridge(B,g)){var l=N.splitPolygon(g,B);N.filterPoints(l,l.next)}},N.findHoleBridge=function(B,g){var l,o=g,V=B.x,U=B.y,y=-1/0;do{if(U<=o.y&&U>=o.next.y&&o.next.y!==o.y){var G=o.x+(U-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(G<=V&&y<G){if((y=G)===V){if(U===o.y)return o;if(U===o.next.y)return o.next}l=o.x<o.next.x?o:o.next}}o=o.next}while(o!==g);if(!l)return null;if(V===y)return l.prev;var d,j=l,A=l.x,H=l.y,K=1/0;for(o=l.next;o!==j;)V>=o.x&&o.x>=A&&V!==o.x&&N.pointInTriangle(U<H?V:y,U,A,H,U<H?y:V,U,o.x,o.y)&&((d=Math.abs(U-o.y)/(V-o.x))<K||d===K&&o.x>l.x)&&N.locallyInside(o,B)&&(l=o,K=d),o=o.next;return l},N.indexCurve=function(B,g,l,o){for(var V=B;null===V.z&&(V.z=N.zOrder(V.x,V.y,g,l,o)),V.prevZ=V.prev,V.nextZ=V.next,(V=V.next)!==B;);V.prevZ.nextZ=null,V.prevZ=null,N.sortLinked(V)},N.sortLinked=function(B){var g,l,o,V,U,y,G,d,j=1;do{for(l=B,U=B=null,y=0;l;){for(y++,o=l,g=G=0;g<j&&(G++,o=o.nextZ);g++);for(d=j;0<G||0<d&&o;)0!==G&&(0===d||!o||l.z<=o.z)?(l=(V=l).nextZ,G--):(o=(V=o).nextZ,d--),U?U.nextZ=V:B=V,V.prevZ=U,U=V;l=o}U.nextZ=null,j*=2}while(1<y);return B},N.zOrder=function(B,g,l,o,V){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B=32767*(B-l)*V)|B<<8))|B<<4))|B<<2))|B<<1))|(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=32767*(g-o)*V)|g<<8))|g<<4))|g<<2))|g<<1))<<1},N.getLeftmost=function(B){for(var g=B,l=B;g.x<l.x&&(l=g),(g=g.next)!==B;);return l},N.pointInTriangle=function(B,g,l,o,V,U,y,G){return 0<=(V-y)*(g-G)-(B-y)*(U-G)&&0<=(B-y)*(o-G)-(l-y)*(g-G)&&0<=(l-y)*(U-G)-(V-y)*(o-G)},N.isValidDiagonal=function(B,g){return B.next.i!==g.i&&B.prev.i!==g.i&&!N.intersectsPolygon(B,g)&&N.locallyInside(B,g)&&N.locallyInside(g,B)&&N.middleInside(B,g)},N.area=function(B,g,l){return(g.y-B.y)*(l.x-g.x)-(g.x-B.x)*(l.y-g.y)},N.equals=function(B,g){return B.x===g.x&&B.y===g.y},N.intersects=function(B,g,l,o){return!!(N.equals(B,g)&&N.equals(l,o)||N.equals(B,o)&&N.equals(l,g))||0<N.area(B,g,l)!=0<N.area(B,g,o)&&0<N.area(l,o,B)!=0<N.area(l,o,g)},N.intersectsPolygon=function(B,g){var l=B;do{if(l.i!==B.i&&l.next.i!==B.i&&l.i!==g.i&&l.next.i!==g.i&&N.intersects(l,l.next,B,g))return!0;l=l.next}while(l!==B);return!1},N.locallyInside=function(B,g){return N.area(B.prev,B,B.next)<0?0<=N.area(B,g,B.next)&&0<=N.area(B,B.prev,g):N.area(B,g,B.prev)<0||N.area(B,B.next,g)<0},N.middleInside=function(B,g){for(var l=B,o=!1,V=(B.x+g.x)/2,U=(B.y+g.y)/2;l.y>U!=l.next.y>U&&l.next.y!==l.y&&V<(l.next.x-l.x)*(U-l.y)/(l.next.y-l.y)+l.x&&(o=!o),(l=l.next)!==B;);return o},N.splitPolygon=function(B,g){var l=new VB(B.i,B.x,B.y),o=new VB(g.i,g.x,g.y),V=B.next,U=g.prev;return(B.next=g).prev=B,(l.next=V).prev=l,(o.next=l).prev=o,(U.next=o).prev=U,o},N.insertNode=function(B,g,l,o){var V=new VB(B,g,l);return o?(V.next=o.next,(V.prev=o).next.prev=V,o.next=V):(V.prev=V).next=V,V},N.removeNode=function(B){B.next.prev=B.prev,B.prev.next=B.next,B.prevZ&&(B.prevZ.nextZ=B.nextZ),B.nextZ&&(B.nextZ.prevZ=B.prevZ)},N.signedArea=function(B,g,l,o){for(var V=0,U=g,y=l-o;U<l;U+=o)V+=(B[y]-B[U])*(B[U+1]+B[y+1]),y=U;return V},N}(),VB=function(){function B(B,g,l){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=B,this.x=g,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return K(B,"laya.webgl.shapes.EarcutNode"),B}(),UB=(function(){function B(B,g,l,o,V,U,y){this.lineWidth=B,this.lineColor=g,this.lineAlpha=l,this.fillColor=o,this.fillAlpha=V,this.shape=y,this.fill=U}K(B,"laya.webgl.shapes.GeometryData");var g=B.prototype;g.clone=function(){return new B(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},g.getIndexData=function(){return null},g.getVertexData=function(){return null},g.destroy=function(){this.shape=null}}(),function(){function B(B){if(B instanceof Float32Array)this.points=B;else if(B instanceof Array){B.length;this.points=new Float32Array(B)}}K(B,"laya.webgl.shapes.Vertex");var g=B.prototype;v.imps(g,{"laya.webgl.shapes.IShape":!0}),g.getData=function(B,g,l){},g.needUpdate=function(B){return!1},g.rebuild=function(B){},g.setMatrix=function(B){}}(),function(){function d(B){void 0===B&&(B=1e4),this._renderType=B}K(d,"laya.webgl.submit.Submit");var B=d.prototype;return v.imps(B,{"laya.webgl.submit.ISubmit":!0}),B.releaseRender=function(){var B=d._cache;(B[B._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},B.getRenderType=function(){return this._renderType},B.renderSubmit=function(){if(0===this._numEle)return 1;var B=this.shaderValue.textureHost;if(B){var g=B.source;if(!B.bitmap||!g)return 1;this.shaderValue.texture=g,B.alphaTexture&&B.alphaTexture.source&&(this.shaderValue.texture1=B.alphaTexture.source)}this._vb.bind_upload(this._ib);var l=bB.mainContext;return this.shaderValue.upload(),T.activeBlendFunction!==this._blendFn&&(l.enable(3042),this._blendFn(l),T.activeBlendFunction=this._blendFn),h.drawCall++,h.trianglesFaces+=this._numEle/3,l.drawElements(4,this._numEle,5123,this._startIdx),1},d.__init__=function(){var B=d.RENDERBASE=new d(-1);B.shaderValue=new XB(0,0),B.shaderValue.ALPHA=-1234},d.createSubmit=function(B,g,l,o,V){var U=d._cache._length?d._cache[--d._cache._length]:new d;null==l&&((l=U._selfVb||(U._selfVb=OB.create(-1))).clear(),o=0),U._ib=g,U._vb=l,U._startIdx=o*NB.BYTES_PIDX,U._numEle=0;var y=B._nBlendType;U._blendFn=B._targets?T.targetFns[y]:T.fns[y],U.shaderValue=V,U.shaderValue.setValue(B._shader2D);var G=B._shader2D.filters;return G&&U.shaderValue.setFilters(G),U},d.createShape=function(B,g,l,o,V,U){var y=d._cache._length?d._cache[--d._cache._length]:new d;y._ib=g,y._vb=l,y._numEle=o,y._startIdx=V,y.shaderValue=U,y.shaderValue.setValue(B._shader2D);var G=B._nBlendType;return y._blendFn=B._targets?T.targetFns[G]:T.fns[G],y},d.TYPE_2D=1e4,d.TYPE_CANVAS=10003,d.TYPE_CMDSETRT=10004,d.TYPE_CUSTOM=10005,d.TYPE_BLURRT=10006,d.TYPE_CMDDESTORYPRERT=10007,d.TYPE_DISABLESTENCIL=10008,d.TYPE_OTHERIBVB=10009,d.TYPE_PRIMITIVE=10010,d.TYPE_RT=10011,d.TYPE_BLUR_RT=10012,d.TYPE_TARGET=10013,d.TYPE_CHANGE_VALUE=10014,d.TYPE_SHAPE=10015,d.TYPE_TEXTURE=10016,d.TYPE_FILLTEXTURE=10017,d.RENDERBASE=null,d._cache=((d._cache=[])._length=0,d._cache),d}()),yB=function(){function o(){this.fun=null,this.args=null}K(o,"laya.webgl.submit.SubmitCMD");var B=o.prototype;return v.imps(B,{"laya.webgl.submit.ISubmit":!0}),B.renderSubmit=function(){return this.fun.apply(null,this.args),1},B.getRenderType=function(){return 0},B.releaseRender=function(){var B=o._cache;B[B._length++]=this},o.create=function(B,g){var l=o._cache._length?o._cache[--o._cache._length]:new o;return l.fun=g,l.args=B,l},o._cache=((o._cache=[])._length=0,o._cache),o}(),GB=function(){function g(){this.variables={}}K(g,"laya.webgl.submit.SubmitCMDScope");var B=g.prototype;return B.getValue=function(B){return this.variables[B]},B.addValue=function(B,g){return this.variables[B]=g},B.setValue=function(B,g){return this.variables.hasOwnProperty(B)?this.variables[B]=g:null},B.clear=function(){for(var B in this.variables)delete this.variables[B]},B.recycle=function(){this.clear(),g.POOL.push(this)},g.create=function(){var B=g.POOL.pop();return B||(B=new g),B},g.POOL=[],g}(),dB=function(){function H(){this.offset=0,this.startIndex=0,this._mat=w.create()}K(H,"laya.webgl.submit.SubmitOtherIBVB");var B=H.prototype;return v.imps(B,{"laya.webgl.submit.ISubmit":!0}),B.releaseRender=function(){var B=H._cache;(B[B._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},B.getRenderType=function(){return 10009},B.renderSubmit=function(){var B=this._shaderValue.textureHost;if(B){var g=B.source;if(!B.bitmap||!g)return 1;this._shaderValue.texture=g}this._vb.bind_upload(this._ib);var l=mB.worldMatrix4,o=w.TEMP;w.mulPre(this._mat,l[0],l[1],l[4],l[5],l[12],l[13],o);var V=mB.worldMatrix4=H.tempMatrix4;V[0]=o.a,V[1]=o.b,V[4]=o.c,V[5]=o.d,V[12]=o.tx,V[13]=o.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var U=bB.mainContext;return T.activeBlendFunction!==this._blendFn&&(U.enable(3042),this._blendFn(U),T.activeBlendFunction=this._blendFn),h.drawCall++,h.trianglesFaces+=this._numEle/3,U.drawElements(4,this._numEle,5123,this.startIndex),mB.worldMatrix4=l,QB.activeShader=null,1},H.create=function(B,g,l,o,V,U,y,G,d){void 0===d&&(d=0);var j=H._cache._length?H._cache[--H._cache._length]:new H;j._ib=l,j._vb=g,j._numEle=o,j._shader=V,j._shaderValue=U;var A=B._nBlendType;switch(j._blendFn=B._targets?T.targetFns[A]:T.fns[A],d){case 0:j.offset=0,j.startIndex=G/(NB.BYTES_PE*g.vertexStride)*1.5,j.startIndex*=NB.BYTES_PIDX;break;case 1:j.startIndex=y,j.offset=G}return j},H._cache=((H._cache=[])._length=0,H._cache),H.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],H}(),jB=function(){function l(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new a,this.screenRect=new a}K(l,"laya.webgl.submit.SubmitScissor");var B=l.prototype;return v.imps(B,{"laya.webgl.submit.ISubmit":!0}),B._scissor=function(B,g,l,o){var V=mB.worldMatrix4,U=V[0],y=V[5],G=V[12],d=V[13];if(o*=y,(l*=U)<1||o<1)return!1;var j=(B=B*U+G)+l,A=(g=g*y+d)+o;B<0&&(l=j-(B=0)),g<0&&(o=A-(g=0));var H=mB.worldClipRect;if(B=Math.max(B,H.x),g=Math.max(g,H.y),l=Math.min(j,H.right)-B,o=Math.min(A,H.bottom)-g,l<1||o<1)return!1;var K=mB.worldScissorTest;return this.screenRect.copyFrom(H),H.x=B,H.y=g,H.width=l,H.height=o,mB.worldScissorTest=!0,g=mB.height-g-o,bB.mainContext.scissor(B,g,l,o),bB.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),K?(g=mB.height-this.screenRect.y-this.screenRect.height,bB.mainContext.scissor(this.screenRect.x,g,this.screenRect.width,this.screenRect.height),bB.mainContext.enable(3089)):(bB.mainContext.disable(3089),mB.worldScissorTest=!1),H.copyFrom(this.screenRect),!0},B._scissorWithTagart=function(B,g,l,o){if(l<1||o<1)return!1;var V=B+l,U=g+o;B<0&&(l=V-(B=0)),g<0&&(o=U-(g=0));var y=mB.worldClipRect;if(B=Math.max(B,y.x),g=Math.max(g,y.y),l=Math.min(V,y.right)-B,o=Math.min(U,y.bottom)-g,l<1||o<1)return!1;var G=mB.worldScissorTest;return this.screenRect.copyFrom(y),mB.worldScissorTest=!0,y.x=B,y.y=g,y.width=l,y.height=o,g=mB.height-g-o,bB.mainContext.scissor(B,g,l,o),bB.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),G?(g=mB.height-this.screenRect.y-this.screenRect.height,bB.mainContext.scissor(this.screenRect.x,g,this.screenRect.width,this.screenRect.height),bB.mainContext.enable(3089)):(bB.mainContext.disable(3089),mB.worldScissorTest=!1),y.copyFrom(this.screenRect),!0},B.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},B.getRenderType=function(){return 0},B.releaseRender=function(){var B=l._cache;(B[B._length++]=this).context=null},l.create=function(B){var g=l._cache._length?l._cache[--l._cache._length]:new l;return g.context=B,g},l._cache=((l._cache=[])._length=0,l._cache),l}(),AB=function(){function d(){this.step=0,this.blendMode=null,this.level=0}K(d,"laya.webgl.submit.SubmitStencil");var B=d.prototype;return v.imps(B,{"laya.webgl.submit.ISubmit":!0}),B.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},B.getRenderType=function(){return 0},B.releaseRender=function(){var B=d._cache;B[B._length++]=this},B.do1=function(){var B=bB.mainContext;B.enable(2960),B.clear(1024),B.colorMask(!1,!1,!1,!1),B.stencilFunc(514,this.level,255),B.stencilOp(7680,7680,7682)},B.do2=function(){var B=bB.mainContext;B.stencilFunc(514,this.level+1,255),B.colorMask(!0,!0,!0,!0),B.stencilOp(7680,7680,7680)},B.do3=function(){var B=bB.mainContext;B.colorMask(!0,!0,!0,!0),B.stencilOp(7680,7680,7680),B.clear(1024),B.disable(2960)},B.do4=function(){var B=bB.mainContext;0==this.level&&(B.enable(2960),B.clear(1024)),B.colorMask(!1,!1,!1,!1),B.stencilFunc(519,0,255),B.stencilOp(7680,7680,7682)},B.do5=function(){var B=bB.mainContext;B.stencilFunc(514,this.level,255),B.colorMask(!0,!0,!0,!0),B.stencilOp(7680,7680,7680)},B.do6=function(){var B=bB.mainContext;T.targetFns[T.TOINT[this.blendMode]](B)},B.do7=function(){var B=bB.mainContext;B.colorMask(!1,!1,!1,!1),B.stencilOp(7680,7680,7683)},B.do8=function(){var B=bB.mainContext;B.colorMask(!0,!0,!0,!0),B.stencilFunc(514,this.level,255),B.stencilOp(7680,7680,7680)},d.restore=function(B,g,l,o,V){var U;if((B._renderKey=0)<d._mask&&d._mask--,0==d._mask)U=laya.webgl.submit.SubmitStencil.create(3),B.addRenderObject(U),B._curSubmit=UB.RENDERBASE;else{U=laya.webgl.submit.SubmitStencil.create(7),B.addRenderObject(U);var y=B._vb;y._byteLength;if(FB.fillRectImgVb(y,null,g.x,g.y,g.width,g.height,e.DEF_UV,l,o,V,0,0)){B._shader2D.glTexture=null;var G=B._curSubmit=UB.createSubmit(B,B._ib,y,(y._byteLength-64)/32*3,XB.create(2,0));G.shaderValue.ALPHA=1,B._submits[B._submits._length++]=G,B._curSubmit._numEle+=6,B._curSubmit=UB.RENDERBASE}else alert("clipRect calc stencil rect error");U=laya.webgl.submit.SubmitStencil.create(8),B.addRenderObject(U)}},d.restore2=function(B,g){var l;(B._renderKey=0)<d._mask&&d._mask--,0==d._mask?(l=laya.webgl.submit.SubmitStencil.create(3),B.addRenderObject(l),B._curSubmit=UB.RENDERBASE):(l=laya.webgl.submit.SubmitStencil.create(7),B.addRenderObject(l),B._submits[B._submits._length++]=g,l=laya.webgl.submit.SubmitStencil.create(8),B.addRenderObject(l))},d.create=function(B){var g=d._cache._length?d._cache[--d._cache._length]:new d;return 5==(g.step=B)&&++d._mask,g.level=d._mask,g},d._cache=((d._cache=[])._length=0,d._cache),d._mask=0,d}(),HB=function(){function G(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}K(G,"laya.webgl.submit.SubmitTarget");var B=G.prototype;return v.imps(B,{"laya.webgl.submit.ISubmit":!0}),B.renderSubmit=function(){this._vb.bind_upload(this._ib);var B=this.scope.getValue(this.proName);return B&&(this.shaderValue.texture=B.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[B.width,B.height]),this.shaderValue.upload(),this.blend(),h.drawCall++,h.trianglesFaces+=this._numEle/3,bB.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},B.blend=function(){if(T.activeBlendFunction!==T.fns[this.blendType]){var B=bB.mainContext;B.enable(3042),T.fns[this.blendType](B),T.activeBlendFunction=T.fns[this.blendType]}},B.getRenderType=function(){return 0},B.releaseRender=function(){var B=G._cache;(B[B._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},G.create=function(B,g,l,o,V,U){var y=G._cache._length?G._cache[--G._cache._length]:new G;return y._ib=g,y._vb=l,y.proName=U,y._startIdx=o*NB.BYTES_PIDX,y._numEle=0,y.blendType=B._nBlendType,y.shaderValue=V,y.shaderValue.setValue(B._shader2D),y},G._cache=((G._cache=[])._length=0,G._cache),G}(),KB=function(){function B(){this._sourceStr=null}K(B,"laya.webgl.text.CharSegment");var g=B.prototype;return v.imps(g,{"laya.webgl.text.ICharSegment":!0}),g.textToSpit=function(B){this._sourceStr=B},g.getChar=function(B){return this._sourceStr.charAt(B)},g.getCharCode=function(B){return this._sourceStr.charCodeAt(B)},g.length=function(){return this._sourceStr.length},B}(),pB=function(){var B;function h(){}return K(h,"laya.webgl.text.DrawText"),h.__init__=function(){h._charsTemp=new Array,h._drawValue=new B,h._charSeg=new KB},h.customCharSeg=function(B){h._charSeg=B},h.getChar=function(B,g,l){var o=nB.createOneChar(B,l);return-1!=g&&(h._charsCache[g]=o),o},h._drawSlow=function(B,g,l,o,V,U,y,G,d,j,A,H,K,p,x){var N,F,C=h._drawValue.value(U,G,d,j,K,p,x),m=0,M=0,b=h._charsTemp,D=0,v=NaN;if(o)for(b.length=o.length,m=0,M=o.length;m<M;m++)(F=o[m])&&(v=F.charNum+C.txtID,b[m]=N=h._charsCache[v]||h.getChar(F.char,v,C),N.active());else{var s=l instanceof laya.utils.WordText?l.toString():l;if(E.CharacterCache){h._charSeg.textToSpit(s);var X=h._charSeg.length();for(m=0,M=b.length=X;m<M;m++)v=h._charSeg.getCharCode(m)+C.txtID,b[m]=N=h._charsCache[v]||h.getChar(h._charSeg.getChar(m),v,C),N.active(),D+=N.cw}else b.length=0,(N=h.getChar(s,-1,C)).active(),D+=N.cw,b[0]=N}var w=0;null!==y&&"left"!==y&&(w=-("center"==y?D/2:D));var i,a,z=NaN,t=0;if(o)for(m=0,M=b.length;m<M;m++)N=b[m],F=o[m],N&&F&&!N.isSpace&&(z=N.borderSize,i=N.texture,g._drawText(i,A+w+F.x*K-z,H+F.y*p-z,i.width,i.height,V,0,0,0,0));else{for(m=0,M=b.length;m<M;m++)(N=b[m])&&!N.isSpace&&(z=N.borderSize,i=N.texture,g._drawText(i,A+w-z,H-z,i.width,i.height,V,0,0,0,0),B&&((a=B[t++])||(a=B[t-1]=[]),a[0]=i,a[1]=w-z,a[2]=-z)),w+=N.cw;B&&(B.length=t)}},h._drawFast=function(B,g,l,o,V){for(var U,y,G=0,d=B.length;G<d;G++)(U=(y=B[G])[0]).active(),g._drawText(U,o+y[1],V+y[2],U.width,U.height,l,0,0,0,0)},h.drawText=function(B,g,l,o,V,U,y,G,d,j,A,H){if(void 0===H&&(H=0),!(g&&0===g.length||l&&0===l.length)){var K=o.a,p=o.d;(0!==o.b||0!==o.c)&&(K=p=1);var x=1!==K||1!==p;if(x&&v.stage.transform){var N=v.stage.transform;x=N.a===K&&N.d===p}else x=!1;if(x){var F=(o=o.copyTo(sB._tmpMatrix)).tx,C=o.ty;o.scale(1/K,1/p),o._checkTransform(),j*=K,A*=p,j+=F-o.tx,A+=C-o.ty}else K=p=1;if(l)h._drawSlow(null,B,g,l,o,V,U,y,G,d,j,A,K,p,H);else{if(null===g.toUpperCase){var m=K+1e5*p,M=g;return void(M.changed||M.id!==m?(M.id=m,M.changed=!1,h._drawSlow(M.save,B,g,l,o,V,U,y,G,d,j,A,K,p,H)):h._drawFast(M.save,B,o,j,A))}var b=g+V.toString()+y+G+d+K+p+U,D=h._textsCache[b];E.CharacterCache?D?h._drawFast(D,B,o,j,A):(h._textsCache.__length||(h._textsCache.__length=0),h._textsCache.__length>s.WebGLTextCacheCount&&((h._textsCache={}).__length=0,h._curPoolIndex=0),h._textCachesPool[h._curPoolIndex]?(D=h._textsCache[b]=h._textCachesPool[h._curPoolIndex]).length=0:h._textCachesPool[h._curPoolIndex]=D=h._textsCache[b]=[],h._textsCache.__length++,h._curPoolIndex++,h._drawSlow(D,B,g,l,o,V,U,y,G,d,j,A,K,p,H)):h._drawSlow(D,B,g,l,o,V,U,y,G,d,j,A,K,p,H)}}},h._charsTemp=null,h._textCachesPool=[],h._curPoolIndex=0,h._charsCache={},h._textsCache={},h._drawValue=null,h.d=[],h._charSeg=null,h.__init$=function(){B=function(){function d(){}return K(d,""),d.prototype.value=function(B,g,l,o,V,U,y){this.font=B,this.fillColor=g,this.borderColor=l,this.lineWidth=o,this.scaleX=V,this.scaleY=U,this.underLine=y;var G=B.toString()+V+U+o+(g?g.toLowerCase():" ")+(l?l.toLowerCase():" ")+y;return this.txtID=d._keymap[G],this.txtID||(this.txtID=1e-7*++d._keymapCount,d._keymap[G]=this.txtID),this},d.clear=function(){d._keymap={},d._keymapCount=1},d._keymap={},d._keymapCount=1,d}()},h}(),xB=function(){function V(B){this._index=0,this._size=14,this._italic=-2,V._cache2=V._cache2||[],this.setFont(B||"14px Arial")}K(V,"laya.webgl.text.FontInContext");var B=V.prototype;return B.setFont=function(B){var g=V._cache2[B];if(g)this._words=g[0],this._size=g[1];else{this._words=B.split(" ");for(var l=0,o=this._words.length;l<o;l++)if(0<this._words[l].indexOf("px")){this._index=l;break}this._size=parseInt(this._words[this._index]),V._cache2[B]=[this._words,this._size]}this._text=null,this._italic=-2},B.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},B.hasType=function(B){for(var g=0,l=this._words.length;g<l;g++)if(this._words[g]===B)return g;return-1},B.removeType=function(B){for(var g=0,l=this._words.length;g<l;g++)if(this._words[g]===B){this._words.splice(g,1),this._index>g&&this._index--;break}this._text=null,this._italic=-2},B.copyTo=function(B){return B._text=this._text,B._size=this._size,B._index=this._index,B._words=this._words.slice(),B._italic=-2,B},B.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},o(0,B,"size",function(){return this._size},function(B){this._size=B,this._words[this._index]=B+"px",this._text=null}),V.create=function(B){var g=V._cache[B];return g||(g=V._cache[B]=new V(B))},V.EMPTY=new V,V._cache={},V._cache2=null,V}(),NB=function(){function B(){}return K(B,"laya.webgl.utils.CONST3D2D"),B.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],B.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],B.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],B._TMPARRAY=[],B._OFFSETX=0,B._OFFSETY=0,y(B,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),B}(),FB=function(){function x(){}return K(x,"laya.webgl.utils.GlUtils"),x.make2DProjection=function(B,g,l){return[2/B,0,0,0,0,-2/g,0,0,0,0,2/l,0,-1,1,0,1]},x.fillIBQuadrangle=function(B,g){if(65535/4<g)throw Error("IBQuadrangle count:"+g+" must<:"+Math.floor(65535/4));g=Math.floor(g),B._resizeBuffer(6*(g+1)*2,!1),B.byteLength=B.bufferLength;for(var l=B.getUint16Array(),o=0,V=0;V<g;V++)l[o++]=4*V,l[o++]=4*V+2,l[o++]=4*V+1,l[o++]=4*V,l[o++]=4*V+3,l[o++]=4*V+2;return B.setNeedUpload(),!0},x.expandIBQuadrangle=function(B,g){B.bufferLength>=6*g*2||x.fillIBQuadrangle(B,g)},x.mathCeilPowerOfTwo=function(B){return B--,B|=B>>1,B|=B>>2,B|=B>>4,B|=B>>8,B|=B>>16,++B},x.fillQuadrangleImgVb=function(B,g,l,o,V,U,y,G){var d=16+(B._byteLength>>2);B.byteLength=d<<2;var j=B.getFloat32Array();j[(d-=16)+2]=V[0],j[d+3]=V[1],j[d+6]=V[2],j[d+7]=V[3],j[d+10]=V[4],j[d+11]=V[5],j[d+14]=V[6],j[d+15]=V[7];var A=U.a,H=U.b,K=U.c,p=U.d;if(1!==A||0!==H||0!==K||1!==p){U.bTransform=!0;var x=U.tx+y,N=U.ty+G;j[d]=(o[0]+g)*A+(o[1]+l)*K+x,j[d+1]=(o[0]+g)*H+(o[1]+l)*p+N,j[d+4]=(o[2]+g)*A+(o[3]+l)*K+x,j[d+5]=(o[2]+g)*H+(o[3]+l)*p+N,j[d+8]=(o[4]+g)*A+(o[5]+l)*K+x,j[d+9]=(o[4]+g)*H+(o[5]+l)*p+N,j[d+12]=(o[6]+g)*A+(o[7]+l)*K+x,j[d+13]=(o[6]+g)*H+(o[7]+l)*p+N}else U.bTransform=!1,g+=U.tx+y,l+=U.ty+G,j[d]=g+o[0],j[d+1]=l+o[1],j[d+4]=g+o[2],j[d+5]=l+o[3],j[d+8]=g+o[4],j[d+9]=l+o[5],j[d+12]=g+o[6],j[d+13]=l+o[7];return B._upload=!0},x.fillTranglesVB=function(B,g,l,o,V,U,y){var G=(B._byteLength>>2)+o.length;B.byteLength=G<<2;var d=B.getFloat32Array();G-=o.length;for(var j=o.length,A=V.a,H=V.b,K=V.c,p=V.d,x=0;x<j;x+=4)if(d[G+x+2]=o[x+2],d[G+x+3]=o[x+3],1!==A||0!==H||0!==K||1!==p){V.bTransform=!0;var N=V.tx+U,F=V.ty+y;d[G+x]=(o[x]+g)*A+(o[x+1]+l)*K+N,d[G+x+1]=(o[x]+g)*H+(o[x+1]+l)*p+F}else V.bTransform=!1,g+=V.tx+U,l+=V.ty+y,d[G+x]=g+o[x],d[G+x+1]=l+o[x+1];return B._upload=!0},x.copyPreImgVb=function(B,g,l){var o=B._byteLength>>2;B.byteLength=o+16<<2;for(var V=B.getFloat32Array(),U=0,y=o-16;U<4;U++)V[o]=V[y]+g,++y,V[++o]=V[y]+l,++y,V[++o]=V[y],++y,V[++o]=V[y],++o,++y;B._upload=!0},x.fillRectImgVb=function(B,g,l,o,V,U,y,G,d,j,A,H,K){void 0===K&&(K=!1);var p,x,N,F,C,m,M,b,D,v,s,X,w,i,a,z,t=1,h=G.a,f=G.b,S=G.c,E=G.d,e=g&&g.width<99999999;if(1!==h||0!==f||0!==S||1!==E?(G.bTransform=!0,0===f&&0===S&&(t=23,D=V+l,v=U+o,p=h*l+(s=G.tx+d),N=h*D+s,x=E*o+(X=G.ty+j),F=E*v+X)):(t=23,G.bTransform=!1,N=(p=l+G.tx+d)+V,F=(x=o+G.ty+j)+U),e&&(C=g.x,m=g.y,M=g.width+C,b=g.height+m),1!==t){if(Math.min(p,N)>=M)return!1;if(Math.min(x,F)>=b)return!1;if(Math.max(N,p)<=C)return!1;if(Math.max(F,x)<=m)return!1}var Q=B._byteLength>>2;B.byteLength=16+Q<<2;var _=B.getFloat32Array();switch(_[2+Q]=y[0],_[3+Q]=y[1],_[6+Q]=y[2],_[7+Q]=y[3],_[10+Q]=y[4],_[11+Q]=y[5],_[14+Q]=y[6],_[15+Q]=y[7],t){case 1:s=G.tx+d,X=G.ty+j;var P=h*l,Y=S*o,c=E*o,r=f*l,Z=h*(D=V+l),T=S*(v=U+o),R=E*v,W=f*D;K?(w=P+Y+s,a=Math.round(w)-w,i=c+r+X,z=Math.round(i)-i,_[Q]=w+a,_[1+Q]=i+z,_[4+Q]=Z+Y+s+a,_[5+Q]=c+W+X+z,_[8+Q]=Z+T+s+a,_[9+Q]=R+W+X+z,_[12+Q]=P+T+s+a,_[13+Q]=R+r+X+z):(_[Q]=P+Y+s,_[1+Q]=c+r+X,_[4+Q]=Z+Y+s,_[5+Q]=c+W+X,_[8+Q]=Z+T+s,_[9+Q]=R+W+X,_[12+Q]=P+T+s,_[13+Q]=R+r+X);break;case 23:K?(w=p+A,a=Math.round(w)-w,i=x,z=Math.round(i)-i,_[Q]=w+a,_[1+Q]=i+z,_[4+Q]=N+A+a,_[5+Q]=x+z,_[8+Q]=N+a,_[9+Q]=F+z,_[12+Q]=p+a,_[13+Q]=F+z):(_[Q]=p+A,_[1+Q]=x,_[4+Q]=N+A,_[5+Q]=x,_[8+Q]=N,_[9+Q]=F,_[12+Q]=p,_[13+Q]=F)}return B._upload=!0},x.fillLineVb=function(B,g,l,o,V,U,y,G){var d=.5*y,j=x._fillLineArray,A=-(o-U),H=l-V,K=Math.sqrt(A*A+H*H);A/=K,H/=K,A*=d,H*=d,j[0]=l-A,j[1]=o-H,j[4]=l+A,j[5]=o+H,j[8]=V+A,j[9]=U+H,j[12]=V-A,j[13]=U-H,G&&G.transformPointArray(j,j);var p=16+(B._byteLength>>2);return B.byteLength=p<<2,B.insertData(j,p-16),!0},x._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x}(),CB=(function(){function d(){}K(d,"laya.webgl.utils.MatirxArray"),d.ArrayMul=function(B,g,l){if(B)if(g)for(var o=NaN,V=NaN,U=NaN,y=NaN,G=0;G<4;G++)o=B[G],V=B[G+4],U=B[G+8],y=B[G+12],l[G]=o*g[0]+V*g[1]+U*g[2]+y*g[3],l[G+4]=o*g[4]+V*g[5]+U*g[6]+y*g[7],l[G+8]=o*g[8]+V*g[9]+U*g[10]+y*g[11],l[G+12]=o*g[12]+V*g[13]+U*g[14]+y*g[15];else d.copyArray(B,l);else d.copyArray(g,l)},d.copyArray=function(B,g){if(B&&g)for(var l=0;l<B.length;l++)g[l]=B[l]}}(),function(){function g(B,g,l){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=B,this._vb=new OB(B,35048),g&&this._vb._resizeBuffer(g,!1),this._ib=new qB,l&&this._ib._resizeBuffer(l,!1)}K(g,"laya.webgl.utils.Mesh2D");var B=g.prototype;return B.cloneWithNewVB=function(){var B=new g(this._stride,0,0);return B._ib=this._ib,B._quadNum=this._quadNum,B._attribInfo=this._attribInfo,B},B.cloneWithNewVBIB=function(){var B=new g(this._stride,0,0);return B._attribInfo=this._attribInfo,B},B.getVBW=function(){return this._vb.setNeedUpload(),this._vb},B.getVBR=function(){return this._vb},B.getIBR=function(){return this._ib},B.getIBW=function(){return this._ib.setNeedUpload(),this._ib},B.createQuadIB=function(B){this._quadNum=B,this._ib._resizeBuffer(6*B*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var g=this._ib.getUint16Array(),l=0,o=0,V=0;V<B;V++)g[l++]=o,g[l++]=o+2,g[l++]=o+1,g[l++]=o,g[l++]=o+3,g[l++]=o+2,o+=4;this._ib.setNeedUpload()},B.setAttributes=function(B){if(this._attribInfo=B,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},B.getEleNum=function(){return this._ib.getBuffer().byteLength/2},B.releaseMesh=function(){},B.destroy=function(){},B.clearVB=function(){this._vb.clear()},g._gvaoid=0,g}()),mB=function(){function V(){}return K(V,"laya.webgl.utils.RenderState2D"),V.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},V.mat2MatArray=function(B,g){var l=B,o=g;return o[0]=l.a,o[1]=l.b,o[2]=V.EMPTYMAT4_ARRAY[2],o[3]=V.EMPTYMAT4_ARRAY[3],o[4]=l.c,o[5]=l.d,o[6]=V.EMPTYMAT4_ARRAY[6],o[7]=V.EMPTYMAT4_ARRAY[7],o[8]=V.EMPTYMAT4_ARRAY[8],o[9]=V.EMPTYMAT4_ARRAY[9],o[10]=V.EMPTYMAT4_ARRAY[10],o[11]=V.EMPTYMAT4_ARRAY[11],o[12]=l.tx,o[13]=l.ty,o[14]=V.EMPTYMAT4_ARRAY[14],o[15]=V.EMPTYMAT4_ARRAY[15],g},V.restoreTempArray=function(){V.TEMPMAT4_ARRAY[0]=1,V.TEMPMAT4_ARRAY[1]=0,V.TEMPMAT4_ARRAY[4]=0,V.TEMPMAT4_ARRAY[5]=1,V.TEMPMAT4_ARRAY[12]=0,V.TEMPMAT4_ARRAY[13]=0},V.clear=function(){V.worldScissorTest=!1,V.worldShaderDefines=null,V.worldFilters=null,V.worldAlpha=1,V.worldClipRect.x=V.worldClipRect.y=0,V.worldClipRect.width=V.width,V.worldClipRect.height=V.height,V.curRenderTarget=null},V._MAXSIZE=99999999,V.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],V.worldMatrix4=V.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],V.worldAlpha=1,V.worldScissorTest=!1,V.worldFilters=null,V.worldShaderDefines=null,V.curRenderTarget=null,V.width=0,V.height=0,y(V,["worldMatrix",function(){return this.worldMatrix=new w},"worldClipRect",function(){return this.worldClipRect=new a(0,0,99999999,99999999)}]),V}(),MB=function(){var m,l;function M(B,g,l,o,V){var U=this;function y(B){var g=[],l=new m(g);return U._compileToTree(l,B.split("\n"),0,g,V),l}var G=p.now();this._VS=y(g),this._PS=y(l),this._nameMap=o,2<p.now()-G&&console.log("ShaderCompile use time:"+(p.now()-G)+"  size:"+g.length+"/"+l.length)}K(M,"laya.webgl.utils.ShaderCompile");var B=M.prototype;return B._compileToTree=function(B,g,l,o,V){var U,y,G,d,j,A,H,K=0,p=0,x=0,N=0;for(p=l;p<g.length;p++)if(!((G=g[p]).length<1)&&0!==(K=G.indexOf("//"))){if(0<=K&&(G=G.substr(0,K)),U=H||new m(o),H=null,U.text=G,U.noCompile=!0,0<=(K=G.indexOf("#"))){for(d="#",N=K+1,x=G.length;N<x;N++){var F=G.charAt(N);if(" "===F||"\t"===F||"\r"===F||"\n"===F||"?"===F)break;d+=F}switch(U.name=d){case"#ifdef":case"#ifndef":if(U.src=G,U.noCompile=null!=G.match(/[!&|()=<>]/),U.noCompile?console.log("function():Boolean{return "+G.substr(K+U.name.length)+"}"):(A=G.replace(/^\s*/,"").split(/\s+/),U.setCondition(A[1],"#ifdef"===d?1:2),U.text="//"+U.text),U.setParent(B),B=U,V)for(A=G.substr(N).split(M._splitToWordExps3),N=0;N<A.length;N++)(G=A[N]).length&&(V[G]=!0);continue;case"#if":if(U.src=G,U.noCompile=!0,U.setParent(B),B=U,V)for(A=G.substr(N).split(M._splitToWordExps3),N=0;N<A.length;N++)(G=A[N]).length&&"defined"!=G&&(V[G]=!0);continue;case"#else":U.src=G,y=(B=B.parent).childs[B.childs.length-1],U.noCompile=y.noCompile,U.noCompile||(U.condition=y.condition,U.conditionType=1==y.conditionType?2:1,U.text="//"+U.text+" "+y.text+" "+U.conditionType),U.setParent(B),B=U;continue;case"#endif":y=(B=B.parent).childs[B.childs.length-1],U.noCompile=y.noCompile,U.noCompile||(U.text="//"+U.text),U.setParent(B);continue;case"#include":A=M.splitToWords(G,null);var C=M.includes[A[1]];if(!C)throw"ShaderCompile error no this include file:"+A[1];if((K=A[0].indexOf("?"))<0){U.setParent(B),G=C.getWith("with"==A[2]?A[3]:null),this._compileToTree(U,G.split("\n"),0,o,V),U.text="";continue}U.setCondition(A[0].substr(K+1),1),U.text=C.getWith("with"==A[2]?A[3]:null);break;case"#import":j=(A=M.splitToWords(G,null))[1],o.push({node:U,file:M.includes[j],ofs:U.text.length});continue}}else{if((y=B.childs[B.childs.length-1])&&!y.name){0<o.length&&M.splitToWords(G,y),H=U,y.text+="\n"+G;continue}0<o.length&&M.splitToWords(G,U)}U.setParent(B)}},B.createShader=function(B,g,l){var o={},V="";if(B)for(var U in B)V+="#define "+U+"\n",o[U]=!0;var y=this._VS.toscript(o,[]),G=this._PS.toscript(o,[]);return(l||kB.create)(V+y.join("\n"),V+G.join("\n"),g,this._nameMap)},M._parseOne=function(B,g,l,o,V,U){var y={type:M.shaderParamsMap[l[o+1]],name:l[o+2],size:isNaN(parseInt(l[o+3]))?1:parseInt(l[o+3])};return U&&("attribute"==V?B.push(y):g.push(y)),":"==l[o+3]&&(y.type=l[o+4],o+=2),o+=2},M.addInclude=function(B,g){if(!g||0===g.length)throw new Error("add shader include file err:"+B);if(M.includes[B])throw new Error("add shader include file err, has add:"+B);M.includes[B]=new l(g)},M.preGetParams=function(B,g){var l=[B,g],o={},V=[],U=[],y={},G=[];o.attributes=V,o.uniforms=U,o.defines=y;for(var d=0,j=0,A=0;A<2;A++){l[A]=l[A].replace(M._removeAnnotation,"");var H,K=l[A].match(M._reg);for(d=0,j=K.length;d<j;d++){var p=K[d];if("attribute"==p||"uniform"==p)d=M._parseOne(V,U,K,d,p,!0);else{if("#define"==p){G[p=K[++d]]=1;continue}if("#ifdef"==p){y[H=K[++d]]=y[H]||[];for(d++;d<j;d++)if("attribute"==(p=K[d])||"uniform"==p)d=M._parseOne(V,U,K,d,p,G[H]);else if("#else"==p)for(d++;d<j;d++)if("attribute"==(p=K[d])||"uniform"==p)d=M._parseOne(V,U,K,d,p,!G[H]);else if("#endif"==p)break}}}}return o},M.splitToWords=function(B,g){for(var l,o,V=[],U=-1,y=0,G=B.length;y<G;y++)if(l=B.charAt(y),0<=" \t=+-*/&%!<>()'\",;".indexOf(l)){if(0<=U&&1<y-U&&(o=B.substr(U,y-U),V.push(o)),'"'==l||"'"==l){var d=B.indexOf(l,y+1);if(d<0)throw"Sharder err:"+B;V.push(B.substr(y+1,d-y-1)),y=d,U=-1;continue}"("==l&&g&&0<V.length&&(o=V[V.length-1]+";","vec4;main;".indexOf(o)<0&&(g.useFuns+=o)),U=-1}else U<0&&(U=y);return U<G&&1<G-U&&(o=B.substr(U,G-U),V.push(o)),V},M.IFDEF_NO=0,M.IFDEF_YES=1,M.IFDEF_ELSE=2,M.IFDEF_PARENT=3,M._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),M._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),M._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),M.includes={},y(M,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),M.__init$=function(){m=function(){function l(B){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=B}K(l,"");var B=l.prototype;return B.setParent=function(B){B.childs.push(this),this.z=B.z+1,this.parent=B},B.setCondition=function(B,g){B&&(this.conditionType=g,B=B.replace(/(\s*$)/g,""),this.condition=function(){return this[B]},this.condition.__condition=B)},B.toscript=function(B,g){return this._toscript(B,g,++l.__id)},B._toscript=function(o,V,U){if(this.childs.length<1&&!this.text)return V;V.length;if(this.condition){var B=!!this.condition.call(o);if(2===this.conditionType&&(B=!B),!B)return V}if(this.text&&V.push(this.text),0<this.childs.length&&this.childs.forEach(function(B,g,l){B._toscript(o,V,U)}),0<this.includefiles.length&&0<this.useFuns.length)for(var g,l=0,y=this.includefiles.length;l<y;l++)this.includefiles[l].curUseID!=U&&0<(g=this.includefiles[l].file.getFunsScript(this.useFuns)).length&&(this.includefiles[l].curUseID=U,V[0]=g+V[0]);return V},l.__id=1,l}(),l=function(){function B(B){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=B;for(var g=0,l=0,o=0;!((g=B.indexOf("#begin",g))<0);){for(o=g+5;!((o=B.indexOf("#end",o))<0)&&"i"===B.charAt(o+4);)o+=5;if(o<0)throw"add include err,no #end:"+B;l=B.indexOf("\n",g);var V=M.splitToWords(B.substr(g,l-g),null);"code"==V[1]?this.codes[V[2]]=B.substr(l+1,o-l-1):"function"==V[1]&&(l=B.indexOf("function",g),l+="function".length,this.funs[V[3]]=B.substr(l+1,o-l-1),this.funnames+=V[3]+";"),g=o+1}}K(B,"");var g=B.prototype;return g.getWith=function(B){var g=B?this.codes[B]:this.script;if(!g)throw"get with error:"+B;return g},g.getFunsScript=function(B){var g="";for(var l in this.funs)0<=B.indexOf(l+";")&&(g+=this.funs[l]);return g},B}()},M}(),bB=function(){function y(){}return K(y,"laya.webgl.WebGL"),y._uint8ArraySlice=function(){for(var B=this.length,g=new Uint8Array(this.length),l=0;l<B;l++)g[l]=this[l];return g},y._float32ArraySlice=function(){for(var B=this.length,g=new Float32Array(this.length),l=0;l<B;l++)g[l]=this[l];return g},y._uint16ArraySlice=function(B){var g,l=arguments,o=0,V=0;if(0===l.length)for(o=this.length,g=new Uint16Array(o),V=0;V<o;V++)g[V]=this[V];else if(2===l.length){var U=l[0],y=l[1];if(U<y)for(o=y-U,g=new Uint16Array(o),V=U;V<y;V++)g[V-U]=this[V];else g=new Uint16Array(0)}return g},y.expandContext=function(){var B=V.prototype,g=CanvasRenderingContext2D.prototype;g.fillTrangles=B.fillTrangles,JB.__int__(null),g.setIBVB=function(B,g,l,o,V,U,y,G,d,j){void 0===d&&(d=0),void 0===j&&(j=0),null===l&&(this._ib=this._ib||qB.QuadrangleIB,l=this._ib,FB.expandIBQuadrangle(l,o._byteLength/64+8)),this._setIBVB(B,g,l,o,V,U,y,G,d,j)},g.fillTrangles=function(B,g,l,o,V){this._curMat=this._curMat||w.create(),this._vb=this._vb||OB.create(),this._ib||(this._ib=qB.create(),FB.fillIBQuadrangle(this._ib,y/4));var U=this._vb,y=o.length>>4;FB.fillTranglesVB(U,g,l,o,V||this._curMat,0,0),FB.expandIBQuadrangle(this._ib,U._byteLength/64+8);var G=new XB(1,0);G.textureHost=B;var d=new uB("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");U._vertType=3,this._setIBVB(g,l,this._ib,U,6*y,V,d,G,0,0)}},y.enable=function(){if(p.__init__(),C.isConchApp&&!C.isConchWebGL)return D.skinAniSprite=function(){return new BB},y.expandContext(),!1;if(D.getWebGLContext=function(B){for(var g,l=["webgl","experimental-webgl","webkit-3d","moz-webgl"],o=0;o<l.length;o++){try{g=B.getContext(l[o],{stencil:s.isStencil,alpha:s.isAlpha,antialias:s.isAntialias,premultipliedAlpha:s.premultipliedAlpha,preserveDrawingBuffer:s.preserveDrawingBuffer})}catch(B){}if(g)return g}return null},null==(y.mainContext=y.mainContext||D.getWebGLContext(C._mainCanvas)))return!1;if(C.isWebGL)return!0;N.create=function(B,g){return new Bg(B,g)},F.create=function(B,g,l,o,V,U,y){return new IB(B,g,l,o,V,U,y)},C.WebGL=y,C.isWebGL=!0,pB.__init__(),D.createRenderSprite=function(B,g){return new wB(B,g)},D.createWebGLContext2D=function(B){return new sB(B)},D.changeWebGLSize=function(B,g){laya.webgl.WebGL.onStageResize(B,g)},D.createGraphics=function(){return new vB};var B=D.createFilterAction;return D.createFilterAction=B||function(B){return new iB},D.clear=function(B){mB.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var g=C.context.ctx,l=0==g._submits._length||s.preserveDrawingBuffer?x.create(B)._color:t._wgColor;l&&g.clearBG(l[0],l[1],l[2],l[3]),mB.clear()},D.addToAtlas=function(B,g){void 0===g&&(g=!1);var l=B.bitmap;C.optimizeTextureMemory(B.url,B)?v.__typeof(l,"laya.webgl.resource.IMergeAtlasBitmap")&&l.allowMerageInAtlas&&l.on("recovered",B,B.addTextureToAtlas):l.enableMerageInAtlas=!1},D.isAtlas=function(B){return B instanceof laya.webgl.atlas.AtlasWebGLCanvas},r._enable(),D.beginFlush=function(){for(var B=r.instance,g=B.getAtlaserCount(),l=0;l<g;l++){var o=B.getAtlaserByIndex(l).texture;o._flashCacheImageNeedFlush&&D.flashFlushImage(o)}},D.drawToCanvas=function(B,g,l,o,V,U){(l<=0||o<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),l|=0,o|=0,V|=0,U|=0;var y=_B.create(l,o,6408,5121,0,!1);y.start(),y.clear(0,0,0,0),C.context.clear(),m.renders[g]._fun(B,C.context,V,mB.height-o+U),C.context.flush(),y.end();var G=y.getData(0,0,l,o);if(y.recycle(),G.byteLength==l*o*4){var d=new WB;d._canvas=p.createElement("canvas"),d.size(l,o);var j=d._canvas.getContext("2d");p.canvas.size(l,o);var A=p.context,H=A.createImageData(l,o);return H.data.set(new Uint8ClampedArray(G.buffer)),d._imgData=H,A.putImageData(H,0,0),j.save(),j.translate(0,o),j.scale(1,-1),j.drawImage(p.canvas.source,0,0),j.restore(),d}console.log("drawToCanvas error: w:"+l+",h:"+o+",datalen:"+G.byteLength)},D.createFilterAction=function(B){var g;switch(B){case 32:g=new iB}return g},D.addTextureToAtlas=function(B){B._uvID++,r._atlasRestore++,B.bitmap.enableMerageInAtlas&&r.instance.addToAtlas(B)},D.getTexturePixels=function(B,g,l,o,V){C.context.ctx.clear();var U=new z;U.graphics.drawTexture(B,-g,-l);var y=_B.create(o,V);y.start(),y.clear(0,0,0,0),U.render(C.context,0,0),C.context.ctx.flush(),y.end();for(var G=y.getData(0,0,o,V),d=[],j=0,A=V-1;0<=A;A--)for(var H=0;H<o;H++)j=4*(A*o+H),d.push(G[j]),d.push(G[j+1]),d.push(G[j+2]),d.push(G[j+3]);return d},D.skinAniSprite=function(){return new BB},j.create=function(B,g){var l=new WB;return l._imgData=g,l.flipY=!1,l},X._filterStart=function(B,g,l,o,V){var U=B.getValue("bounds"),y=_B.create(U.width,U.height);if(y.start(),y.clear(0,0,0,0),B.addValue("src",y),B.addValue("ScissorTest",mB.worldScissorTest),mB.worldScissorTest){var G=new a;G.copyFrom(l.ctx._clipRect),B.addValue("clipRect",G),mB.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},X._filterEnd=function(B,g,l,o,V){var U=B.getValue("bounds");B.getValue("src").end();var y=_B.create(U.width,U.height);y.start(),y.clear(0,0,0,0),B.addValue("out",y),g._set$P("_filterCache",y),g._set$P("_isHaveGlowFilter",B.getValue("_isHaveGlowFilter"))},X._EndTarget=function(B,g){if(B.getValue("src").recycle(),B.getValue("out").end(),B.getValue("ScissorTest")){mB.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),g.ctx.save();var l=B.getValue("clipRect");g.ctx.clipRect(l.x,l.y,l.width,l.height)}},X._useSrc=function(B){var g=B.getValue("out");g.end(),(g=B.getValue("src")).start(),g.clear(0,0,0,0)},X._endSrc=function(B){B.getValue("src").end()},X._useOut=function(B){var g=B.getValue("src");g.end(),(g=B.getValue("out")).start(),g.clear(0,0,0,0)},X._endOut=function(B){B.getValue("out").end()},X._recycleScope=function(B){B.recycle()},X._filter=function(B,g,l,o){var V=this._next;if(V){var U,y,G=B.filters,d=G.length;if(1==d&&32==G[0].type)return g.ctx.save(),g.ctx.setFilters([G[0]]),V._fun.call(V,B,g,l,o),void g.ctx.restore();var j=GB.create(),A=i.TEMP,H=g.ctx._getTransformMatrix(),K=w.create();H.copyTo(K);var p=0,x=0,N=!1,F=B._$P._filterCache?B._$P._filterCache:null;if(!F||B._repaint){N=B._isHaveGlowFilter(),j.addValue("_isHaveGlowFilter",N),N&&(p=50,x=25),(y=new a).copyFrom(B.getSelfBounds()),y.x+=B.x,y.y+=B.y,y.x-=B.pivotX+4,y.y-=B.pivotY+4;var C=y.x,m=y.y;if(y.width+=p+8,y.height+=p+8,A.x=y.x*K.a+y.y*K.c,A.y=y.y*K.d+y.x*K.b,y.x=A.x,y.y=A.y,A.x=y.width*K.a+y.height*K.c,A.y=y.height*K.d+y.width*K.b,y.width=A.x,y.height=A.y,y.width<=0||y.height<=0)return;F&&F.recycle(),j.addValue("bounds",y);var M=yB.create([j,B,g,0,0],X._filterStart);g.addRenderObject(M),g.ctx._renderKey=0,g.ctx._shader2D.glTexture=null;var b=B.x-C+x,D=B.y-m+x;V._fun.call(V,B,g,b,D),M=yB.create([j,B,g,0,0],X._filterEnd),g.addRenderObject(M);for(var v=0;v<d;v++){0!=v&&(M=yB.create([j],X._useSrc),g.addRenderObject(M),U=XB.create(1,0),w.TEMP.identity(),g.ctx.drawTarget(j,0,0,y.width,y.height,w.TEMP,"out",U,null,T.TOINT.overlay),M=yB.create([j],X._useOut),g.addRenderObject(M)),G[v].action.apply3d(j,B,g,0,0)}M=yB.create([j,g],X._EndTarget),g.addRenderObject(M)}else{if((N=!!B._$P._isHaveGlowFilter&&B._$P._isHaveGlowFilter)&&(p=50,x=25),(y=B.getBounds()).width<=0||y.height<=0)return;y.width+=p,y.height+=p,A.x=y.x*K.a+y.y*K.c,A.y=y.y*K.d+y.x*K.b,y.x=A.x,y.y=A.y,A.x=y.width*K.a+y.height*K.c,A.y=y.height*K.d+y.width*K.b,y.width=A.x,y.height=A.y,j.addValue("out",F)}l=l-x-B.x,o=o-x-B.y,A.setTo(l,o),K.transformPoint(A),l=A.x+y.x,o=A.y+y.y,U=XB.create(1,0),w.TEMP.identity(),g.ctx.drawTarget(j,l,o,y.width,y.height,w.TEMP,"out",U,null,T.TOINT.overlay),M=yB.create([j],X._recycleScope),g.addRenderObject(M),K.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=y._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=y._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=y._uint8ArraySlice),!0},y.onStageResize=function(B,g){null!=y.mainContext&&(y.mainContext.viewport(0,0,B,g),mB.width=B,mB.height=g)},y.onInvalidGLRes=function(){r.instance.freeAll(),b.releaseContentManagers(!0),y.doNodeRepaint(v.stage),y.mainContext.viewport(0,0,mB.width,mB.height),v.stage.event("devicelost")},y.doNodeRepaint=function(B){0==B.numChildren&&B.repaint();for(var g=0;g<B.numChildren;g++)y.doNodeRepaint(B.getChildAt(g))},y.init=function(B,g,l){y.mainCanvas=B,j._createContext=function(B){return new sB(B)},WB._createContext=function(B){return new sB(B)};var o=laya.webgl.WebGL.mainContext;if(null!=o.getShaderPrecisionFormat){var V=o.getShaderPrecisionFormat(35633,36338),U=o.getShaderPrecisionFormat(35632,36338);y.shaderHighPrecision=!(!V.precision||!U.precision)}else y.shaderHighPrecision=!1;if(y.compressAstc=o.getExtension("WEBGL_compressed_texture_astc"),y.compressAtc=o.getExtension("WEBGL_compressed_texture_atc"),y.compressEtc=o.getExtension("WEBGL_compressed_texture_etc"),y.compressEtc1=o.getExtension("WEBGL_compressed_texture_etc1"),y.compressPvrtc=o.getExtension("WEBGL_compressed_texture_pvrtc"),y.compressS3tc=o.getExtension("WEBGL_compressed_texture_s3tc"),y.compressS3tc_srgb=o.getExtension("WEBGL_compressed_texture_s3tc_srgb"),y.compressAstc=y.compressAstc?y.compressAstc:{},y.compressAtc=y.compressAtc?y.compressAtc:{},y.compressEtc=y.compressEtc?y.compressEtc:{},y.compressEtc1=y.compressEtc1?y.compressEtc1:{},y.compressPvrtc=y.compressPvrtc?y.compressPvrtc:{},y.compressS3tc=y.compressS3tc?y.compressS3tc:{},y.compressS3tc_srgb=y.compressS3tc_srgb?y.compressS3tc_srgb:{},o.deleteTexture1=o.deleteTexture,o.deleteTexture=function(B){B==DB.curBindTexValue&&(DB.curBindTexValue=null),o.deleteTexture1(B)},y.onStageResize(g,l),null==y.mainContext)throw new Error("webGL getContext err!");S.__init__(),r.__init__(),zB.__init__(),UB.__init__(),sB.__init__(),XB.__init__(),q.__init__(),JB.__int__(o),T._init_(o),C.isConchApp&&conch.setOnInvalidGLRes(y.onInvalidGLRes)},y.mainCanvas=null,y.antialias=!0,y.shaderHighPrecision=!1,y._bg_null=[0,0,0,0],y}(),DB=function(){function o(){}return K(o,"laya.webgl.WebGLContext"),o.UseProgram=function(B){return o._useProgram!==B&&(bB.mainContext.useProgram(B),o._useProgram=B,!0)},o.setDepthTest=function(B,g){g!==o._depthTest&&((o._depthTest=g)?B.enable(2929):B.disable(2929))},o.setDepthMask=function(B,g){g!==o._depthMask&&(o._depthMask=g,B.depthMask(g))},o.setDepthFunc=function(B,g){g!==o._depthFunc&&(o._depthFunc=g,B.depthFunc(g))},o.setBlend=function(B,g){g!==o._blend&&((o._blend=g)?B.enable(3042):B.disable(3042))},o.setBlendFunc=function(B,g,l){(g!==o._sFactor||l!==o._dFactor)&&(o._sFactor=g,o._dFactor=l,B.blendFunc(g,l))},o.setCullFace=function(B,g){g!==o._cullFace&&((o._cullFace=g)?B.enable(2884):B.disable(2884))},o.setFrontFace=function(B,g){g!==o._frontFace&&(o._frontFace=g,B.frontFace(g))},o.bindTexture=function(B,g,l){B.bindTexture(g,l),o.curBindTexTarget=g,o.curBindTexValue=l},o.DEPTH_BUFFER_BIT=256,o.STENCIL_BUFFER_BIT=1024,o.COLOR_BUFFER_BIT=16384,o.POINTS=0,o.LINES=1,o.LINE_LOOP=2,o.LINE_STRIP=3,o.TRIANGLES=4,o.TRIANGLE_STRIP=5,o.TRIANGLE_FAN=6,o.ZERO=0,o.ONE=1,o.SRC_COLOR=768,o.ONE_MINUS_SRC_COLOR=769,o.SRC_ALPHA=770,o.ONE_MINUS_SRC_ALPHA=771,o.DST_ALPHA=772,o.ONE_MINUS_DST_ALPHA=773,o.DST_COLOR=774,o.ONE_MINUS_DST_COLOR=775,o.SRC_ALPHA_SATURATE=776,o.FUNC_ADD=32774,o.BLEND_EQUATION=32777,o.BLEND_EQUATION_RGB=32777,o.BLEND_EQUATION_ALPHA=34877,o.FUNC_SUBTRACT=32778,o.FUNC_REVERSE_SUBTRACT=32779,o.BLEND_DST_RGB=32968,o.BLEND_SRC_RGB=32969,o.BLEND_DST_ALPHA=32970,o.BLEND_SRC_ALPHA=32971,o.CONSTANT_COLOR=32769,o.ONE_MINUS_CONSTANT_COLOR=32770,o.CONSTANT_ALPHA=32771,o.ONE_MINUS_CONSTANT_ALPHA=32772,o.BLEND_COLOR=32773,o.ARRAY_BUFFER=34962,o.ELEMENT_ARRAY_BUFFER=34963,o.ARRAY_BUFFER_BINDING=34964,o.ELEMENT_ARRAY_BUFFER_BINDING=34965,o.STREAM_DRAW=35040,o.STATIC_DRAW=35044,o.DYNAMIC_DRAW=35048,o.BUFFER_SIZE=34660,o.BUFFER_USAGE=34661,o.CURRENT_VERTEX_ATTRIB=34342,o.FRONT=1028,o.BACK=1029,o.CULL_FACE=2884,o.FRONT_AND_BACK=1032,o.BLEND=3042,o.DITHER=3024,o.STENCIL_TEST=2960,o.DEPTH_TEST=2929,o.SCISSOR_TEST=3089,o.POLYGON_OFFSET_FILL=32823,o.SAMPLE_ALPHA_TO_COVERAGE=32926,o.SAMPLE_COVERAGE=32928,o.NO_ERROR=0,o.INVALID_ENUM=1280,o.INVALID_VALUE=1281,o.INVALID_OPERATION=1282,o.OUT_OF_MEMORY=1285,o.CW=2304,o.CCW=2305,o.LINE_WIDTH=2849,o.ALIASED_POINT_SIZE_RANGE=33901,o.ALIASED_LINE_WIDTH_RANGE=33902,o.CULL_FACE_MODE=2885,o.FRONT_FACE=2886,o.DEPTH_RANGE=2928,o.DEPTH_WRITEMASK=2930,o.DEPTH_CLEAR_VALUE=2931,o.DEPTH_FUNC=2932,o.STENCIL_CLEAR_VALUE=2961,o.STENCIL_FUNC=2962,o.STENCIL_FAIL=2964,o.STENCIL_PASS_DEPTH_FAIL=2965,o.STENCIL_PASS_DEPTH_PASS=2966,o.STENCIL_REF=2967,o.STENCIL_VALUE_MASK=2963,o.STENCIL_WRITEMASK=2968,o.STENCIL_BACK_FUNC=34816,o.STENCIL_BACK_FAIL=34817,o.STENCIL_BACK_PASS_DEPTH_FAIL=34818,o.STENCIL_BACK_PASS_DEPTH_PASS=34819,o.STENCIL_BACK_REF=36003,o.STENCIL_BACK_VALUE_MASK=36004,o.STENCIL_BACK_WRITEMASK=36005,o.VIEWPORT=2978,o.SCISSOR_BOX=3088,o.COLOR_CLEAR_VALUE=3106,o.COLOR_WRITEMASK=3107,o.UNPACK_ALIGNMENT=3317,o.PACK_ALIGNMENT=3333,o.MAX_TEXTURE_SIZE=3379,o.MAX_VIEWPORT_DIMS=3386,o.SUBPIXEL_BITS=3408,o.RED_BITS=3410,o.GREEN_BITS=3411,o.BLUE_BITS=3412,o.ALPHA_BITS=3413,o.DEPTH_BITS=3414,o.STENCIL_BITS=3415,o.POLYGON_OFFSET_UNITS=10752,o.POLYGON_OFFSET_FACTOR=32824,o.TEXTURE_BINDING_2D=32873,o.SAMPLE_BUFFERS=32936,o.SAMPLES=32937,o.SAMPLE_COVERAGE_VALUE=32938,o.SAMPLE_COVERAGE_INVERT=32939,o.NUM_COMPRESSED_TEXTURE_FORMATS=34466,o.COMPRESSED_TEXTURE_FORMATS=34467,o.DONT_CARE=4352,o.FASTEST=4353,o.NICEST=4354,o.GENERATE_MIPMAP_HINT=33170,o.BYTE=5120,o.UNSIGNED_BYTE=5121,o.SHORT=5122,o.UNSIGNED_SHORT=5123,o.INT=5124,o.UNSIGNED_INT=5125,o.FLOAT=5126,o.DEPTH_COMPONENT=6402,o.ALPHA=6406,o.RGB=6407,o.RGBA=6408,o.LUMINANCE=6409,o.LUMINANCE_ALPHA=6410,o.UNSIGNED_SHORT_4_4_4_4=32819,o.UNSIGNED_SHORT_5_5_5_1=32820,o.UNSIGNED_SHORT_5_6_5=33635,o.FRAGMENT_SHADER=35632,o.VERTEX_SHADER=35633,o.MAX_VERTEX_ATTRIBS=34921,o.MAX_VERTEX_UNIFORM_VECTORS=36347,o.MAX_VARYING_VECTORS=36348,o.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,o.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,o.MAX_TEXTURE_IMAGE_UNITS=34930,o.MAX_FRAGMENT_UNIFORM_VECTORS=36349,o.SHADER_TYPE=35663,o.DELETE_STATUS=35712,o.LINK_STATUS=35714,o.VALIDATE_STATUS=35715,o.ATTACHED_SHADERS=35717,o.ACTIVE_UNIFORMS=35718,o.ACTIVE_ATTRIBUTES=35721,o.SHADING_LANGUAGE_VERSION=35724,o.CURRENT_PROGRAM=35725,o.NEVER=512,o.LESS=513,o.EQUAL=514,o.LEQUAL=515,o.GREATER=516,o.NOTEQUAL=517,o.GEQUAL=518,o.ALWAYS=519,o.KEEP=7680,o.REPLACE=7681,o.INCR=7682,o.DECR=7683,o.INVERT=5386,o.INCR_WRAP=34055,o.DECR_WRAP=34056,o.VENDOR=7936,o.RENDERER=7937,o.VERSION=7938,o.NEAREST=9728,o.LINEAR=9729,o.NEAREST_MIPMAP_NEAREST=9984,o.LINEAR_MIPMAP_NEAREST=9985,o.NEAREST_MIPMAP_LINEAR=9986,o.LINEAR_MIPMAP_LINEAR=9987,o.TEXTURE_MAG_FILTER=10240,o.TEXTURE_MIN_FILTER=10241,o.TEXTURE_WRAP_S=10242,o.TEXTURE_WRAP_T=10243,o.TEXTURE_2D=3553,o.TEXTURE=5890,o.TEXTURE_CUBE_MAP=34067,o.TEXTURE_BINDING_CUBE_MAP=34068,o.TEXTURE_CUBE_MAP_POSITIVE_X=34069,o.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,o.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,o.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,o.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,o.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,o.MAX_CUBE_MAP_TEXTURE_SIZE=34076,o.TEXTURE0=33984,o.TEXTURE1=33985,o.TEXTURE2=33986,o.TEXTURE3=33987,o.TEXTURE4=33988,o.TEXTURE5=33989,o.TEXTURE6=33990,o.TEXTURE7=33991,o.TEXTURE8=33992,o.TEXTURE9=33993,o.TEXTURE10=33994,o.TEXTURE11=33995,o.TEXTURE12=33996,o.TEXTURE13=33997,o.TEXTURE14=33998,o.TEXTURE15=33999,o.TEXTURE16=34e3,o.TEXTURE17=34001,o.TEXTURE18=34002,o.TEXTURE19=34003,o.TEXTURE20=34004,o.TEXTURE21=34005,o.TEXTURE22=34006,o.TEXTURE23=34007,o.TEXTURE24=34008,o.TEXTURE25=34009,o.TEXTURE26=34010,o.TEXTURE27=34011,o.TEXTURE28=34012,o.TEXTURE29=34013,o.TEXTURE30=34014,o.TEXTURE31=34015,o.ACTIVE_TEXTURE=34016,o.REPEAT=10497,o.CLAMP_TO_EDGE=33071,o.MIRRORED_REPEAT=33648,o.FLOAT_VEC2=35664,o.FLOAT_VEC3=35665,o.FLOAT_VEC4=35666,o.INT_VEC2=35667,o.INT_VEC3=35668,o.INT_VEC4=35669,o.BOOL=35670,o.BOOL_VEC2=35671,o.BOOL_VEC3=35672,o.BOOL_VEC4=35673,o.FLOAT_MAT2=35674,o.FLOAT_MAT3=35675,o.FLOAT_MAT4=35676,o.SAMPLER_2D=35678,o.SAMPLER_CUBE=35680,o.VERTEX_ATTRIB_ARRAY_ENABLED=34338,o.VERTEX_ATTRIB_ARRAY_SIZE=34339,o.VERTEX_ATTRIB_ARRAY_STRIDE=34340,o.VERTEX_ATTRIB_ARRAY_TYPE=34341,o.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,o.VERTEX_ATTRIB_ARRAY_POINTER=34373,o.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,o.COMPILE_STATUS=35713,o.LOW_FLOAT=36336,o.MEDIUM_FLOAT=36337,o.HIGH_FLOAT=36338,o.LOW_INT=36339,o.MEDIUM_INT=36340,o.HIGH_INT=36341,o.FRAMEBUFFER=36160,o.RENDERBUFFER=36161,o.RGBA4=32854,o.RGB5_A1=32855,o.RGB565=36194,o.DEPTH_COMPONENT16=33189,o.STENCIL_INDEX=6401,o.STENCIL_INDEX8=36168,o.DEPTH_STENCIL=34041,o.RENDERBUFFER_WIDTH=36162,o.RENDERBUFFER_HEIGHT=36163,o.RENDERBUFFER_INTERNAL_FORMAT=36164,o.RENDERBUFFER_RED_SIZE=36176,o.RENDERBUFFER_GREEN_SIZE=36177,o.RENDERBUFFER_BLUE_SIZE=36178,o.RENDERBUFFER_ALPHA_SIZE=36179,o.RENDERBUFFER_DEPTH_SIZE=36180,o.RENDERBUFFER_STENCIL_SIZE=36181,o.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,o.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,o.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,o.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,o.COLOR_ATTACHMENT0=36064,o.DEPTH_ATTACHMENT=36096,o.STENCIL_ATTACHMENT=36128,o.DEPTH_STENCIL_ATTACHMENT=33306,o.NONE=0,o.FRAMEBUFFER_COMPLETE=36053,o.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,o.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,o.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,o.FRAMEBUFFER_UNSUPPORTED=36061,o.FRAMEBUFFER_BINDING=36006,o.RENDERBUFFER_BINDING=36007,o.MAX_RENDERBUFFER_SIZE=34024,o.INVALID_FRAMEBUFFER_OPERATION=1286,o.UNPACK_FLIP_Y_WEBGL=37440,o.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,o.CONTEXT_LOST_WEBGL=37442,o.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,o.BROWSER_DEFAULT_WEBGL=37444,o._useProgram=null,o._depthTest=!0,o._depthMask=!0,o._blend=!1,o._cullFace=!1,o.curBindTexTarget=null,o.curBindTexValue=null,y(o,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),o}(),vB=function(B){function g(){g.__super.call(this)}K(g,"laya.webgl.display.GraphicsGL",G);var l=g.prototype;return l.setShader=function(B){this._saveToCmd(C.context._setShader,[B])},l.setIBVB=function(B,g,l,o,V,U){this._saveToCmd(C.context._setIBVB,[B,g,l,o,V,U])},l.drawParticle=function(B,g,l){var o=D.createParticleTemplate2D(l);o.x=B,o.y=g,this._saveToCmd(C.context._drawParticle,[o])},g}(),sB=function(B){var l;function c(B){this._x=0,this._y=0,this._id=++c._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,c.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=c.MAXCLIPRECT,this.mOutPoint,this._canvas=B,this._canvas._addReference(),c._contextcount++,C.isFlash?(this._ib=qB.create(35044),FB.fillIBQuadrangle(this._ib,16)):this._ib=qB.QuadrangleIB,this.clear()}K(c,"laya.webgl.canvas.WebGLContext2D",V);var g=c.prototype;return g.setIsMainContext=function(){this._isMain=!0},g.clearBG=function(B,g,l,o){var V=bB.mainContext;V.clearColor(B,g,l,o),V.clear(16384)},g._getSubmits=function(){return this._submits},g._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var B=0,g=this._submits._length;B<g;B++)this._submits[B].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},g.destroy=function(){--c._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=qB.QuadrangleIB&&this._ib.releaseResource()},g.clear=function(){this._submits||(this._other=l.DEFAULT,this._curMat=w.create(),this._vb=OB.create(-1),this._submits=[],this._save=[k.Create(this)],this._save.length=10,this._shader2D=new q,this._triangleMesh=eB.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=l.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=c.MAXCLIPRECT,this._curSubmit=UB.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=R.DEFAULT;for(var B=0,g=this._submits._length;B<g;B++)this._submits[B].releaseRender(),this._submits[B]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},g.size=function(B,g){if(this._width!=B||this._height!=g)if(0==B||0==g){0!=this._vb._byteLength&&(this._width=B,this._height=g,this._vb.clear(),this._vb.upload());for(var l=0,o=this._submits._length;l<o;l++)this._submits[l].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=B,this._height=g,this._targets&&this._targets.size(B,g),this._canvas.memorySize-=this._canvas.memorySize;0===B&&0===g&&this._releaseMem()},g._getTransformMatrix=function(){return this._curMat},g.translate=function(B,g){0===B&&0===g||($.save(this),this._curMat.bTransform&&(J.save(this),this._curMat.transformPointN(i.TEMP.setTo(B,g)),B=i.TEMP.x,g=i.TEMP.y),this._x+=B,this._y+=g)},g.save=function(){this._save[this._save._length++]=k.Create(this)},g.restore=function(){var B=this._save._length;if(!(B<1))for(var g=B-1;0<=g;g--){var l=this._save[g];if(l.restore(this),l.isSaveMark())return void(this._save._length=g)}},g._fillText=function(B,g,l,o,V,U,y,G,d,j){void 0===j&&(j=0);var A=this._shader2D,H=this._curSubmit.shaderValue,K=V?xB.create(V):this._other.font;if(r.enabled)A.ALPHA!==H.ALPHA&&(A.glTexture=null),pB.drawText(this,B,g,this._curMat,K,d||this._other.textAlign,U,y,G,l,o,j);else{this._shader2D.defines.getValue();var p=U?x.create(U)._color:A.colorAdd;A.ALPHA===H.ALPHA&&p===A.colorAdd&&H.colorAdd===A.colorAdd||(A.glTexture=null,A.colorAdd=p),pB.drawText(this,B,g,this._curMat,K,d||this._other.textAlign,U,y,G,l,o,j)}},g.fillWords=function(B,g,l,o,V,U){this._fillText(null,B,g,l,o,V,null,-1,null,U)},g.fillBorderWords=function(B,g,l,o,V,U,y){this._fillBorderText(null,B,g,l,o,V,U,y,null)},g.fillText=function(B,g,l,o,V,U){this._fillText(B,null,g,l,o,V,null,-1,U)},g.strokeText=function(B,g,l,o,V,U,y){this._fillText(B,null,g,l,o,null,V,U||1,y)},g.fillBorderText=function(B,g,l,o,V,U,y,G){this._fillBorderText(B,null,g,l,o,V,U,y,G)},g._fillBorderText=function(B,g,l,o,V,U,y,G,d){if(!r.enabled)return this._fillText(B,g,l,o,V,null,y,G||1,d),void this._fillText(B,g,l,o,V,U,null,-1,d);var j=this._shader2D,A=this._curSubmit.shaderValue;j.ALPHA!==A.ALPHA&&(j.glTexture=null);var H=V?(c._fontTemp.setFont(V),c._fontTemp):this._other.font;pB.drawText(this,B,g,this._curMat,H,d||this._other.textAlign,U,y,G||1,l,o,0)},g.fillRect=function(B,g,l,o,V){var U=this._vb;if(FB.fillRectImgVb(U,this._clipRect,B,g,l,o,e.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var y=this._shader2D.fillStyle;V&&(this._shader2D.fillStyle=R.create(V));var G=this._shader2D,d=this._curSubmit.shaderValue;if(G.fillStyle!==d.fillStyle||G.ALPHA!==d.ALPHA){G.glTexture=null;var j=this._curSubmit=UB.createSubmit(this,this._ib,U,(U._byteLength-64)/32*3,XB.create(2,0));j.shaderValue.color=G.fillStyle._color._color,j.shaderValue.ALPHA=G.ALPHA,this._submits[this._submits._length++]=j}this._curSubmit._numEle+=6,this._shader2D.fillStyle=y}},g.fillTexture=function(B,g,l,o,V,U,y,G){if(B.loaded&&B.bitmap&&B.source){var d=this._vb,j=B.bitmap.width,A=B.bitmap.height,H=B.uv,K=y.x%B.width,p=y.y%B.height;if(j!=G.w||A!=G.h){if(!G.w&&!G.h)switch(G.oy=G.ox=0,U){case"repeat":G.width=o,G.height=V;break;case"repeat-x":G.width=o,p<0?B.height+p>V?G.height=V:G.height=B.height+p:(G.oy=p,B.height+p>V?G.height=V-p:G.height=B.height);break;case"repeat-y":K<0?B.width+K>o?G.width=o:G.width=B.width+K:(G.ox=K,B.width+K>o?G.width=o-K:G.width=B.width),G.height=V;break;case"no-repeat":K<0?B.width+K>o?G.width=o:G.width=B.width+K:(G.ox=K,B.width+K>o?G.width=o-K:G.width=B.width),p<0?B.height+p>V?G.height=V:G.height=B.height+p:(G.oy=p,B.height+p>V?G.height=V-p:G.height=B.height);break;default:G.width=o,G.height=V}G.w=j,G.h=A,G.uv=[0,0,G.width/j,0,G.width/j,G.height/A,0,G.height/A]}if(g+=G.ox,l+=G.oy,K-=G.ox,p-=G.oy,FB.fillRectImgVb(d,this._clipRect,g,l,G.width,G.height,G.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var x=EB.create(this,this._ib,d,(d._byteLength-64)/32*3,XB.create(256,0)),N=(this._submits[this._submits._length++]=x).shaderValue;N.textureHost=B;var F=H[0]*j,C=H[1]*A,m=(H[2]-H[0])*j,M=(H[5]-H[3])*A,b=-K/j,D=-p/A;N.u_TexRange[0]=F/j,N.u_TexRange[1]=m/j,N.u_TexRange[2]=C/A,N.u_TexRange[3]=M/A,N.u_offset[0]=b,N.u_offset[1]=D,r.enabled&&!this._isMain&&x.addTexture(B,(d._byteLength>>2)-16),(this._curSubmit=x)._renderType=10017,x._numEle+=6}}else this.sprite&&v.timer.callLater(this,this._repaintSprite)},g.setShader=function(B){n.save(this,1048576,this._shader2D,!0),this._shader2D.shader=B},g.setFilters=function(B){n.save(this,2097152,this._shader2D,!0),this._shader2D.filters=B,this._curSubmit=UB.RENDERBASE,this._renderKey=0,this._drawCount++},g.drawTexture=function(B,g,l,o,V,U,y){this._drawTextureM(B,g,l,o,V,U,y,null,1)},g.addTextureVb=function(B,g,l){var o=this._curSubmit._vb||this._vb,V=o._byteLength>>2;o.byteLength=V+16<<2;for(var U=o.getFloat32Array(),y=0;y<16;y+=4)U[V++]=B[y]+g,U[V++]=B[y+1]+l,U[V++]=B[y+2],U[V++]=B[y+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),o._upload=!0},g.willDrawTexture=function(B,g){if(!(B.loaded&&B.bitmap&&B.source))return this.sprite&&v.timer.callLater(this,this._repaintSprite),0;var l=B.bitmap,o=l.id+this._shader2D.ALPHA*g+10016;if(o==this._renderKey)return o;var V=this._shader2D,U=V.ALPHA,y=this._curSubmit.shaderValue;V.ALPHA*=g,this._renderKey=o,this._drawCount++,V.glTexture=l;var G=this._vb,d=null,j=G._byteLength/32*3,A=y.textureHost&&y.textureHost==B&&y.textureHost.alphaTexture==B.alphaTexture;return d=EB.create(this,this._ib,G,j,XB.create(1,0)),(this._submits[this._submits._length++]=d).shaderValue.textureHost=B,d._renderType=10016,d._preIsSameTextureShader=10016===this._curSubmit._renderType&&V.ALPHA===y.ALPHA&&A,this._curSubmit=d,V.ALPHA=U,o},g.drawTextures=function(B,g,l,o){if(B.loaded&&B.bitmap&&B.source){var V=this._clipRect;if(this._clipRect=c.MAXCLIPRECT,this._drawTextureM(B,g[0],g[1],B.width,B.height,l,o,null,1)){if(this._clipRect=V,h.drawCall++,!(g.length<4)){for(var U=this._curSubmit._vb||this._vb,y=this._curMat.a,G=this._curMat.d,d=2,j=g.length;d<j;d+=2)FB.copyPreImgVb(U,(g[d]-g[d-2])*y,(g[d+1]-g[d-1])*G),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&v.timer.callLater(this,this._repaintSprite)},g._drawTextureM=function(B,g,l,o,V,U,y,G,d){if(!B.loaded||!B.source)return this.sprite&&v.timer.callLater(this,this._repaintSprite),!1;var j=this._curSubmit._vb||this._vb,A=B.bitmap;g+=U,l+=y,this._drawCount++;var H=A.id+this._shader2D.ALPHA*d+10016;if(H!=this._renderKey){this._renderKey=H;var K=this._curSubmit.shaderValue,p=this._shader2D,x=p.ALPHA;p.ALPHA*=d,p.glTexture=A;var N=this._vb,F=null,C=N._byteLength/32*3,m=K.textureHost&&K.textureHost==B&&K.textureHost.alphaTexture==B.alphaTexture;F=EB.create(this,this._ib,N,C,XB.create(1,0)),(this._submits[this._submits._length++]=F).shaderValue.textureHost=B,F._renderType=10016,F._preIsSameTextureShader=10016===this._curSubmit._renderType&&p.ALPHA===K.ALPHA&&m,this._curSubmit=F,j=this._curSubmit._vb||this._vb,p.ALPHA=x}return!!FB.fillRectImgVb(j,this._clipRect,g,l,o||B.width,V||B.height,B.uv,G||this._curMat,this._x,this._y,0,0)&&(r.enabled&&!this._isMain&&this._curSubmit.addTexture(B,(j._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},g._repaintSprite=function(){this.sprite&&this.sprite.repaint()},g._drawText=function(B,g,l,o,V,U,y,G,d,j){var A=B.bitmap;this._drawCount++;var H=A.id+this._shader2D.ALPHA+10016;if(H!=this._renderKey){this._renderKey=H;var K=this._curSubmit.shaderValue,p=this._shader2D;p.glTexture=A;var x=this._vb,N=null,F=x._byteLength/32*3,C=K.textureHost&&K.textureHost==B&&K.textureHost.alphaTexture==B.alphaTexture;(N=r.enabled?EB.create(this,this._ib,x,F,XB.create(1,0)):EB.create(this,this._ib,x,F,$B.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&p.ALPHA===K.ALPHA&&C,(this._submits[this._submits._length++]=N).shaderValue.textureHost=B,N._renderType=10016,this._curSubmit=N}B.active();var m=this._curSubmit._vb||this._vb;FB.fillRectImgVb(m,this._clipRect,g+y,l+G,o||B.width,V||B.height,B.uv,U||this._curMat,this._x,this._y,d,j,!0)&&(r.enabled&&!this._isMain&&this._curSubmit.addTexture(B,(m._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},g.drawTextureWithTransform=function(B,g,l,o,V,U,y,G,d){if(U){var j=this._curMat,A=this._x,H=this._y;(0!==y||0!==G)&&(this._x=y*j.a+G*j.c,this._y=G*j.d+y*j.b),U&&j.bTransform?(w.mul(U,j,c._tmpMatrix),(U=c._tmpMatrix)._checkTransform()):(this._x+=j.tx,this._y+=j.ty),this._drawTextureM(B,g,l,o,V,0,0,U,d),this._x=A,this._y=H}else this._drawTextureM(B,g,l,o,V,y,G,null,d)},g.fillQuadrangle=function(B,g,l,o,V){var U=this._curSubmit,y=this._vb,G=this._shader2D,d=U.shaderValue;if(this._renderKey=0,B.bitmap){var j=B.bitmap;G.glTexture==j&&G.ALPHA===d.ALPHA||(G.glTexture=j,(U=this._curSubmit=UB.createSubmit(this,this._ib,y,y._byteLength/32*3,XB.create(1,0))).shaderValue.glTexture=j,this._submits[this._submits._length++]=U),FB.fillQuadrangleImgVb(y,g,l,o,B.uv,V||this._curMat,this._x,this._y)}else U.shaderValue.fillStyle&&U.shaderValue.fillStyle.equal(B)&&G.ALPHA===d.ALPHA||(G.glTexture=null,(U=this._curSubmit=UB.createSubmit(this,this._ib,y,y._byteLength/32*3,XB.create(2,0))).shaderValue.defines.add(2),U.shaderValue.fillStyle=R.create(B),this._submits[this._submits._length++]=U),FB.fillQuadrangleImgVb(y,g,l,o,e.DEF_UV,V||this._curMat,this._x,this._y);U._numEle+=6},g.drawTexture2=function(B,g,l,o,V,U,y,G){if(0!=U){var d=this._curMat;if(this._x=B*d.a+g*d.c,this._y=g*d.d+B*d.b,V&&(V=d.bTransform||V.bTransform?(w.mul(V,d,c._tmpMatrix),c._tmpMatrix):(this._x+=V.tx+d.tx,this._y+=V.ty+d.ty,w.EMPTY)),1!==U||y){var j=this._shader2D.ALPHA,A=this._nBlendType;this._shader2D.ALPHA=U,y&&(this._nBlendType=T.TOINT(y)),this._drawTextureM(G[0],G[1]-l,G[2]-o,G[3],G[4],0,0,V,1),this._shader2D.ALPHA=j,this._nBlendType=A}else this._drawTextureM(G[0],G[1]-l,G[2]-o,G[3],G[4],0,0,V,1);this._x=this._y=0}},g.drawCanvas=function(B,g,l,o,V){var U=B.context;if(this._renderKey=0,U._targets)this._submits[this._submits._length++]=SB.create(U,0,null),this._curSubmit=UB.RENDERBASE,U._targets.drawTo(this,g,l,o,V);else{var y=this._submits[this._submits._length++]=SB.create(U,this._shader2D.ALPHA,this._shader2D.filters),G=o/B.width,d=V/B.height,j=y._matrix;this._curMat.copyTo(j),1!=G&&1!=d&&j.scale(G,d);var A=j.tx,H=j.ty;j.tx=j.ty=0,j.transformPoint(i.TEMP.setTo(g,l)),j.translate(i.TEMP.x+A,i.TEMP.y+H),this._curSubmit=UB.RENDERBASE}s.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=U._targets?"yellow":"green",this.strokeRect(g-1,l-1,o+2,V+2,1),this.strokeRect(g,l,o,V,1),this.restore())},g.drawTarget=function(B,g,l,o,V,U,y,G,d,j){void 0===j&&(j=-1);var A=this._vb;if(FB.fillRectImgVb(A,this._clipRect,g,l,o,V,d||e.DEF_UV,U||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var H=this._curSubmit=HB.create(this,this._ib,A,(A._byteLength-64)/32*3,G,y);H.blendType=-1==j?this._nBlendType:j,H.scope=B,this._submits[this._submits._length++]=H,this._curSubmit._numEle+=6}},g.mixRGBandAlpha=function(B){return this._mixRGBandAlpha(B,this._shader2D.ALPHA)},g._mixRGBandAlpha=function(B,g){var l=(4278190080&B)>>>24;return 0!=l?l*=g:l=255*g,16777215&B|l<<24},g.drawTriangles=function(B,g,l,o,V,U,y,G,d,j){if(!B.loaded||!B.source)return this.sprite&&v.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;B.bitmap;var A=this._mixRGBandAlpha(4294967295,G),H=(o.length,U.length);this._renderKey=-1;var K=this._curSubmit=EB.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,XB.create(1,0));return K.shaderValue.textureHost=B,K._renderType=10016,this._submits[this._submits._length++]=K,y?(c._tmpMatrix.a=y.a,c._tmpMatrix.b=y.b,c._tmpMatrix.c=y.c,c._tmpMatrix.d=y.d,c._tmpMatrix.tx=y.tx+g,c._tmpMatrix.ty=y.ty+l,w.mul(c._tmpMatrix,this._curMat,c._tmpMatrix)):(c._tmpMatrix.a=this._curMat.a,c._tmpMatrix.b=this._curMat.b,c._tmpMatrix.c=this._curMat.c,c._tmpMatrix.d=this._curMat.d,c._tmpMatrix.tx=this._curMat.tx+g,c._tmpMatrix.ty=this._curMat.ty+l),this._triangleMesh.addData(o,V,U,c._tmpMatrix,A,this),this._curSubmit._numEle+=H,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},g.transform=function(B,g,l,o,V,U){J.save(this),w.mul(w.TEMP.setTo(B,g,l,o,V,U),this._curMat,this._curMat),this._curMat._checkTransform()},g.setTransformByMatrix=function(B){B.copyTo(this._curMat)},g.transformByMatrix=function(B){J.save(this),w.mul(B,this._curMat,this._curMat),this._curMat._checkTransform()},g.rotate=function(B){J.save(this),this._curMat.rotateEx(B)},g.scale=function(B,g){J.save(this),this._curMat.scaleEx(B,g)},g.clipRect=function(B,g,l,o){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var V=AB.create(4);this.addRenderObject(V);var U=this._vb,y=U._byteLength>>2;if(FB.fillRectImgVb(U,null,B,g,l,o,e.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var G=this._curSubmit=UB.createSubmit(this,this._ib,U,(U._byteLength-64)/32*3,XB.create(2,0));G.shaderValue.ALPHA=1,this._submits[this._submits._length++]=G,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var d=AB.create(5);this.addRenderObject(d);var j=U.getFloat32Array(),A=Math.min(Math.min(Math.min(j[0+y],j[4+y]),j[8+y]),j[12+y]),H=Math.max(Math.max(Math.max(j[0+y],j[4+y]),j[8+y]),j[12+y]),K=Math.min(Math.min(Math.min(j[1+y],j[5+y]),j[9+y]),j[13+y]),p=Math.max(Math.max(Math.max(j[1+y],j[5+y]),j[9+y]),j[13+y]);I.save(this,d,B,g,l,o,A,K,H-A,p-K),this._curSubmit=UB.RENDERBASE}else{l*=this._curMat.a,o*=this._curMat.d;var x=i.TEMP;this._curMat.transformPoint(x.setTo(B,g)),l<0&&(x.x=x.x+l,l=-l),o<0&&(x.y=x.y+o,o=-o),this._renderKey=0;var N=this._curSubmit=jB.create(this);(this._submits[this._submits._length++]=N).submitIndex=this._submits._length,N.submitLength=9999999,L.save(this,N);var F=this._clipRect,C=F.x,m=F.y,M=x.x+l,b=x.y+o;C<x.x&&(F.x=x.x),m<x.y&&(F.y=x.y),F.width=Math.min(M,C+F.width)-F.x,F.height=Math.min(b,m+F.height)-F.y,this._shader2D.glTexture=null,N.clipRect.copyFrom(F),this._curSubmit=UB.RENDERBASE}},g.setIBVB=function(B,g,l,o,V,U,y,G,d,j,A){if(void 0===d&&(d=0),void 0===j&&(j=0),void 0===A&&(A=0),null===l){if(C.isFlash){var H=o;H._selfIB||(H._selfIB=qB.create(35044)),H._selfIB.clear(),l=H._selfIB}else l=this._ib;FB.expandIBQuadrangle(l,o._byteLength/(4*o.vertexStride*4))}if(!G||!y)throw Error("setIBVB must input:shader shaderValues");var K=dB.create(this,o,l,V,y,G,d,j,A);U||(U=w.EMPTY),U.translate(B,g),w.mul(U,this._curMat,K._mat),U.translate(-B,-g),this._submits[this._submits._length++]=K,this._curSubmit=UB.RENDERBASE,this._renderKey=0},g.addRenderObject=function(B){this._submits[this._submits._length++]=B},g.fillTrangles=function(B,g,l,o,V){var U=this._curSubmit,y=this._vb,G=this._shader2D,d=U.shaderValue,j=o.length>>4,A=B.bitmap;this._renderKey=0,G.glTexture==A&&G.ALPHA===d.ALPHA||((U=this._curSubmit=UB.createSubmit(this,this._ib,y,y._byteLength/32*3,XB.create(1,0))).shaderValue.textureHost=B,this._submits[this._submits._length++]=U),FB.fillTranglesVB(y,g,l,o,V||this._curMat,this._x,this._y),U._numEle+=6*j},g.submitElement=function(B,g){var l=this._submits;for(g<0&&(g=l._length);B<g;)B+=l[B].renderSubmit()},g.finish=function(){bB.mainContext.finish()},g.flush=function(){var B=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(B>this._ib.bufferLength/12&&FB.expandIBQuadrangle(this._ib,B),!this._isMain&&r.enabled&&r._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=r._atlasRestore;for(var g=this._submits,l=0,o=g._length;l<o;l++){var V=g[l];10016===V.getRenderType()&&V.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),gB.instance&&gB.getInstance().reset();var U;for(l=0,U=this.meshlist.length;l<U;l++){var y=this.meshlist[l];y.canReuse?y.releaseMesh():y.destroy()}return this.meshlist.length=0,this._curSubmit=UB.RENDERBASE,this._renderKey=0,this._triangleMesh=eB.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},g.setPathId=function(B){if(this.mId=B,-1!=this.mId){this.mHaveKey=!1;var g=_.getInstance();g.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,g.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},g.movePath=function(B,g){var l=B,o=g;B=this._curMat.a*l+this._curMat.c*o+this._curMat.tx,g=this._curMat.b*l+this._curMat.d*o+this._curMat.ty,this.mX+=B,this.mY+=g},g.beginPath=function(){var B=this._getPath();B.tempArray.length=0,B.closePath=!1,this.mX=0,this.mY=0},g.closePath=function(){this._path.closePath=!0},g.fill=function(B){void 0===B&&(B=!1);var g=this._getPath();this.drawPoly(0,0,g.tempArray,this.fillStyle._color.numColor,0,0,B)},g.stroke=function(){var B=this._getPath();if(0<this.lineWidth){if(-1==this.mId)B.drawLine(0,0,B.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var g=_.getInstance().shapeLineDic[this.mId];g.rebuild(B.tempArray),B.setGeomtry(g)}else _.getInstance().addLine(this.mId,B.drawLine(0,0,B.tempArray,this.lineWidth,this.strokeStyle._color.numColor));B.update();var l=[this.mX,this.mY],o=UB.createShape(this,B.ib,B.vb,B.count,B.offset,XB.create(4,0));o.shaderValue.ALPHA=this._shader2D.ALPHA,o.shaderValue.u_pos=l,o.shaderValue.u_mmat2=mB.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=o,this._renderKey=-1}},g.line=function(B,g,l,o,V,U){var y=this._curSubmit,G=this._vb;if(FB.fillLineVb(G,this._clipRect,B,g,l,o,V,U)){this._renderKey=0;var d=this._shader2D,j=y.shaderValue;d.strokeStyle===j.strokeStyle&&d.ALPHA===j.ALPHA||(d.glTexture=null,(y=this._curSubmit=UB.createSubmit(this,this._ib,G,(G._byteLength-64)/32*3,XB.create(2,0))).shaderValue.strokeStyle=d.strokeStyle,y.shaderValue.mainID=2,y.shaderValue.ALPHA=d.ALPHA,this._submits[this._submits._length++]=y),y._numEle+=6}},g.moveTo=function(B,g,l){void 0===l&&(l=!0);var o=this._getPath();if(l){var V=B,U=g;B=this._curMat.a*V+this._curMat.c*U,g=this._curMat.b*V+this._curMat.d*U}o.addPoint(B,g)},g.lineTo=function(B,g,l){void 0===l&&(l=!0);var o=this._getPath();if(l){var V=B,U=g;B=this._curMat.a*V+this._curMat.c*U,g=this._curMat.b*V+this._curMat.d*U}o.addPoint(B,g)},g.drawCurves=function(B,g,l){this.setPathId(-1),this.beginPath(),this.strokeStyle=l[3],this.lineWidth=l[4];var o=l[2];B+=l[0],g+=l[1],this.movePath(B,g),this.moveTo(o[0],o[1]);for(var V=2,U=o.length;V<U;)this.quadraticCurveTo(o[V++],o[V++],o[V++],o[V++]);this.stroke()},g.arcTo=function(B,g,l,o,V){if(-1==this.mId||!this.mHaveKey){var U=0,y=0,G=0,d=this._getPath();this._curMat.copyTo(c._tmpMatrix),c._tmpMatrix.tx=c._tmpMatrix.ty=0,c._tempPoint.setTo(d.getEndPointX(),d.getEndPointY()),c._tmpMatrix.invertTransformPoint(c._tempPoint);var j=c._tempPoint.x-B,A=c._tempPoint.y-g,H=Math.sqrt(j*j+A*A);if(!(H<=1e-6)){var K=j/H,p=A/H,x=l-B,N=o-g,F=x*x+N*N,C=Math.sqrt(F);if(!(C<=1e-6)){var m=x/C,M=N/C,b=K+m,D=p+M,v=Math.sqrt(b*b+D*D);if(!(v<=1e-6)){var s=b/v,X=D/v,w=Math.acos(s*K+X*p),i=Math.PI/2-w,a=(H=V/Math.tan(i))*K+B,z=H*p+g,t=Math.sqrt(H*H+V*V),h=B+s*t,f=g+X*t,S=0,E=0;if(0<=K*M-p*m){var e=2*i/c.SEGNUM;S=Math.sin(e),E=Math.cos(e)}else e=2*-i/c.SEGNUM,S=Math.sin(e),E=Math.cos(e);y=this._curMat.a*a+this._curMat.c*z,G=this._curMat.b*a+this._curMat.d*z,y==this._path.getEndPointX()&&G==this._path.getEndPointY()||d.addPoint(y,G);var Q=a-h,_=z-f;for(U=0;U<c.SEGNUM;U++){var P=Q*E+_*S,Y=-Q*S+_*E;y=P+h,G=Y+f,B=this._curMat.a*y+this._curMat.c*G,G=g=this._curMat.b*y+this._curMat.d*G,(y=B)==this._path.getEndPointX()&&G==this._path.getEndPointY()||d.addPoint(y,G),Q=P,_=Y}}}}}},g.arc=function(B,g,l,o,V,U,y){if(void 0===U&&(U=!1),void 0===y&&(y=!0),-1!=this.mId){var G=_.getInstance().shapeDic[this.mId];if(G&&this.mHaveKey&&!G.needUpdate(this._curMat))return;g=B=0}var d,j=0,A=0,H=0,K=0,p=0,x=0,N=0;if(A=V-o,U)if(Math.abs(A)>=2*Math.PI)A=2*-Math.PI;else for(;0<A;)A-=2*Math.PI;else if(Math.abs(A)>=2*Math.PI)A=2*Math.PI;else for(;A<0;)A+=2*Math.PI;d=A/(N=l<101?Math.max(10,A*l/5):l<201?Math.max(10,A*l/20):Math.max(10,A*l/40))/2,H=Math.abs(4/3*(1-Math.cos(d))/Math.sin(d)),U&&(H=-H);var F=this._getPath(),C=NaN,m=NaN;for(x=0;x<=N;x++)j=o+A*(x/N),K=B+Math.cos(j)*l,p=g+Math.sin(j)*l,y&&(C=K,m=p,K=this._curMat.a*C+this._curMat.c*m,p=this._curMat.b*C+this._curMat.d*m),K==this._path.getEndPointX()&&p==this._path.getEndPointY()||F.addPoint(K,p);K=B+Math.cos(V)*l,p=g+Math.sin(V)*l,y&&(C=K,m=p,K=this._curMat.a*C+this._curMat.c*m,p=this._curMat.b*C+this._curMat.d*m),K==this._path.getEndPointX()&&p==this._path.getEndPointY()||F.addPoint(K,p)},g.quadraticCurveTo=function(B,g,l,o){var V=H.I,U=l,y=o;l=this._curMat.a*U+this._curMat.c*y,o=this._curMat.b*U+this._curMat.d*y,U=B,y=g,B=this._curMat.a*U+this._curMat.c*y,g=this._curMat.b*U+this._curMat.d*y;for(var G=V.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),B,g,l,o],30,2),d=0,j=G.length/2;d<j;d++)this.lineTo(G[2*d],G[2*d+1],!1);this.lineTo(l,o,!1)},g.rect=function(B,g,l,o){this._other=this._other.make(),this._other.path||(this._other.path=new W),this._other.path.rect(B,g,l,o)},g.strokeRect=function(B,g,l,o,V){var U=.5*V;this.line(B-U,g,B+l+U,g,V,this._curMat),this.line(B+l,g,B+l,g+o,V,this._curMat),this.line(B,g,B,g+o,V,this._curMat),this.line(B-U,g+o,B+l+U,g+o,V,this._curMat)},g.clip=function(){},g.drawPoly=function(B,g,l,o,V,U,y){void 0===y&&(y=!1),this._renderKey=0,this._shader2D.glTexture=null;var G=this._getPath();if(-1==this.mId)G.polygon(B,g,l,o,V||1,U);else if(this.mHaveKey){var d=_.getInstance().shapeDic[this.mId];d.setMatrix(this._curMat),d.rebuild(G.tempArray),G.setGeomtry(d)}else{var j=G.polygon(B,g,l,o,V||1,U);_.getInstance().addShape(this.mId,j),j.setMatrix(this._curMat)}G.update();var A,H=[this.mX,this.mY];if((A=UB.createShape(this,G.ib,G.vb,G.count,G.offset,XB.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,A.shaderValue.u_pos=H,A.shaderValue.u_mmat2=mB.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=A,0<V){if(this.mHaveLineKey){var K=_.getInstance().shapeLineDic[this.mId];K.rebuild(G.tempArray),G.setGeomtry(K)}else _.getInstance().addShape(this.mId,G.drawLine(B,g,l,V,U));G.update(),(A=UB.createShape(this,G.ib,G.vb,G.count,G.offset,XB.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,A.shaderValue.u_mmat2=mB.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=A}},g.drawParticle=function(B,g,l){l.x=B,l.y=g,this._submits[this._submits._length++]=l},g._getPath=function(){return this._path||(this._path=new W)},o(0,g,"globalCompositeOperation",function(){return T.NAMES[this._nBlendType]},function(B){var g=T.TOINT[B];null==g||this._nBlendType===g||(n.save(this,65536,this,!0),this._curSubmit=UB.RENDERBASE,this._renderKey=0,this._nBlendType=g)}),o(0,g,"strokeStyle",function(){return this._shader2D.strokeStyle},function(B){this._shader2D.strokeStyle.equal(B)||(n.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=R.create(B))}),o(0,g,"globalAlpha",function(){return this._shader2D.ALPHA},function(B){(B=Math.floor(1e3*B)/1e3)!=this._shader2D.ALPHA&&(n.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=B)}),o(0,g,"asBitmap",null,function(B){if(B){if(this._targets||(this._targets=new u),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),o(0,g,"fillStyle",function(){return this._shader2D.fillStyle},function(B){this._shader2D.fillStyle.equal(B)||(n.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=R.create(B))}),o(0,g,"textAlign",function(){return this._other.textAlign},function(B){this._other.textAlign===B||(this._other=this._other.make(),n.save(this,32768,this._other,!1),this._other.textAlign=B)}),o(0,g,"lineWidth",function(){return this._other.lineWidth},function(B){this._other.lineWidth===B||(this._other=this._other.make(),n.save(this,256,this._other,!1),this._other.lineWidth=B)}),o(0,g,"textBaseline",function(){return this._other.textBaseline},function(B){this._other.textBaseline===B||(this._other=this._other.make(),n.save(this,16384,this._other,!1),this._other.textBaseline=B)}),o(0,g,"font",null,function(B){B!=this._other.font.toString()&&(this._other=this._other.make(),n.save(this,8,this._other,!1),this._other.font===xB.EMPTY?this._other.font=new xB(B):this._other.font.setFont(B))}),c.__init__=function(){l.DEFAULT=new l},c._tempPoint=new i,c._SUBMITVBSIZE=32e3,c._MAXSIZE=99999999,c._RECTVBSIZE=16,c.MAXCLIPRECT=new a(0,0,99999999,99999999),c._COUNT=0,c._tmpMatrix=new w,c.SEGNUM=32,c._contextcount=0,y(c,["_fontTemp",function(){return this._fontTemp=new xB},"_drawStyleTemp",function(){return this._drawStyleTemp=new R(null)}]),c.__init$=function(){l=function(){function B(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=xB.EMPTY}K(B,"");var g=B.prototype;return g.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=xB.EMPTY},g.make=function(){return this===B.DEFAULT?new B:this},B.DEFAULT=null,B}()},c}(),XB=function(B){function o(B,g){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,o.__super.call(this),this.defines=new zB,this.position=o._POSITION,this.mainID=B,this.subID=g,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=B|g,this._inClassCache=o._cache[this._cacheID],0<B&&!this._inClassCache&&(this._inClassCache=o._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}K(o,"laya.webgl.shader.d2.value.Value2D",Y);var g=o.prototype;return g.setValue=function(B){},g.refresh=function(){var B=this.size;return B[0]=mB.width,B[1]=mB.height,this.alpha=this.ALPHA*mB.worldAlpha,this.mmat=mB.worldMatrix4,this},g._ShaderWithCompile=function(){return kB.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,uB.create)},g._withWorldShaderDefines=function(){var B=mB.worldShaderDefines,g=kB.sharders[this.mainID|this.defines._value|B.getValue()];if(!g){var l,o={};for(l in this.defines.toNameDic())o[l]="";for(l in B.toNameDic())o[l]="";g=kB.withCompile2D(0,this.mainID,o,this.mainID|this.defines._value|B.getValue(),uB.create)}var V=mB.worldFilters;if(!V)return g;for(var U,y=V.length,G=0;G<y;G++)(U=V[G])&&U.action.setValue(this);return g},g.upload=function(){var B=mB;this.alpha=this.ALPHA*B.worldAlpha,mB.worldMatrix4!==mB.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),bB.shaderHighPrecision&&this.defines.add(1024);var g,l=B.worldShaderDefines?this._withWorldShaderDefines():kB.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=B.width,this.size[1]=B.height,this.mmat=B.worldMatrix4,QB.activeShader!==l?l._shaderValueWidth!==B.width||l._shaderValueHeight!==B.height?(l._shaderValueWidth=B.width,l._shaderValueHeight=B.height):g=l._params2dQuick2||l._make2dQuick2():l._shaderValueWidth!==B.width||l._shaderValueHeight!==B.height?(l._shaderValueWidth=B.width,l._shaderValueHeight=B.height):g=l._params2dQuick1||l._make2dQuick1(),l.upload(this,g)},g.setFilters=function(B){if(this.filters=B)for(var g,l=B.length,o=0;o<l;o++)(g=B[o])&&(this.defines.add(g.type),g.action.setValue(this))},g.clear=function(){this.defines.setValue(this.subID)},g.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},o._initone=function(B,g){o._typeClass[B]=g,o._cache[B]=[],o._cache[B]._length=0},o.__init__=function(){o._POSITION=[2,5126,!1,4*NB.BYTES_PE,0],o._TEXCOORD=[2,5126,!1,4*NB.BYTES_PE,2*NB.BYTES_PE],o._initone(2,cB),o._initone(4,TB),o._initone(256,rB),o._initone(512,YB),o._initone(1,ZB),o._initone(65,$B),o._initone(9,ZB)},o.create=function(B,g){var l=o._cache[B|g];return l._length?l[--l._length]:new o._typeClass[B|g](g)},o._POSITION=null,o._TEXCOORD=null,o._cache=[],o._typeClass=[],o.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o}(),wB=function(B){function F(B,g){F.__super.call(this,B,g)}K(F,"laya.webgl.utils.RenderSprite3D",m);var g=F.prototype;return g.onCreate=function(B){switch(B){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},g._mask=function(B,g,l,o){var V,U,y=this._next,G=B.mask;if(G){g.ctx.save();var d=g.ctx.globalCompositeOperation,j=new a;if(j.copyFrom(G.getBounds()),j.width=Math.round(j.width),j.height=Math.round(j.height),j.x=Math.round(j.x),j.y=Math.round(j.y),0<j.width&&0<j.height){var A=B._style._tf,H=GB.create();H.addValue("bounds",j),V=yB.create([H,g],laya.webgl.utils.RenderSprite3D.tmpTarget),g.addRenderObject(V),G.render(g,-j.x,-j.y),V=yB.create([H],laya.webgl.utils.RenderSprite3D.endTmpTarget),g.addRenderObject(V),g.ctx.save(),g.clipRect(l-A.translateX+j.x,o-A.translateY+j.y,j.width,j.height),y._fun.call(y,B,g,l,o),g.ctx.restore(),U=AB.create(6),d=g.ctx.globalCompositeOperation,U.blendMode="mask",g.addRenderObject(U),w.TEMP.identity();var K=XB.create(1,0),p=e.INV_UV,x=j.width,N=j.height;(j.width<32||j.height<32)&&((p=F.tempUV)[0]=0,p[1]=0,p[2]=32<=j.width?1:j.width/32,p[3]=0,p[4]=32<=j.width?1:j.width/32,p[5]=32<=j.height?1:j.height/32,p[6]=0,p[7]=32<=j.height?1:j.height/32,j.width=32<=j.width?j.width:32,j.height=32<=j.height?j.height:32,p[1]*=-1,p[3]*=-1,p[5]*=-1,p[7]*=-1,p[1]+=1,p[3]+=1,p[5]+=1,p[7]+=1),g.ctx.drawTarget(H,l+j.x-A.translateX,o+j.y-A.translateY,x,N,w.TEMP,"tmpTarget",K,p,6),V=yB.create([H],laya.webgl.utils.RenderSprite3D.recycleTarget),g.addRenderObject(V),(U=AB.create(6)).blendMode=d,g.addRenderObject(U)}g.ctx.restore()}else y._fun.call(y,B,g,l,o)},g._blend=function(B,g,l,o){var V=B._style,U=this._next;V.blendMode?(g.ctx.save(),g.ctx.globalCompositeOperation=V.blendMode,U._fun.call(U,B,g,l,o),g.ctx.restore()):U._fun.call(U,B,g,l,o)},g._transform=function(B,g,l,o){var V=B.transform,U=this._next;if(V&&U!=m.NORENDER){var y=g.ctx;B._style;V.tx=l,V.ty=o;var G=y._getTransformMatrix(),d=G.clone();w.mul(V,G,G),G._checkTransform(),V.tx=V.ty=0,U._fun.call(U,B,g,0,0),d.copyTo(G),d.destroy()}else U._fun.call(U,B,g,l,o)},F.tmpTarget=function(B,g){var l=B.getValue("bounds"),o=_B.create(l.width,l.height);o.start(),o.clear(0,0,0,0),B.addValue("tmpTarget",o)},F.endTmpTarget=function(B){B.getValue("tmpTarget").end()},F.recycleTarget=function(B){B.getValue("tmpTarget").recycle(),B.recycle()},y(F,["tempUV",function(){return this.tempUV=new Array(8)}]),F}(),iB=function(B){function g(){this.data=null,g.__super.call(this)}K(g,"laya.filters.webgl.ColorFilterActionGL",P);var l=g.prototype;return v.imps(l,{"laya.filters.IFilterActionGL":!0}),l.setValue=function(B){B.colorMat=this.data._mat,B.colorAlpha=this.data._alpha},l.apply3d=function(B,g,l,o,V){var U=B.getValue("bounds"),y=XB.create(1,0);y.setFilters([this.data]);var G=w.TEMP;G.identity(),l.ctx.drawTarget(B,0,0,U.width,U.height,G,"src",y)},g}(),aB=function(B){function U(B,g,l,o,V){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,U.__super.call(this,B,g,V),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new RB,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=l,this._atlasCanvas.height=o,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}K(U,"laya.webgl.atlas.Atlaser",c);var g=U.prototype;return g.computeUVinAtlasTexture=function(B,g,l,o){var V=r.atlasTextureWidth,U=r.atlasTextureHeight,y=l/V,G=o/U,d=(l+B.bitmap.width)/V,j=(o+B.bitmap.height)/U,A=B.bitmap.width/V,H=B.bitmap.height/U;B.uv=[y+g[0]*A,G+g[1]*H,d-(1-g[2])*A,G+g[3]*H,d-(1-g[4])*A,j-(1-g[5])*H,y+g[6]*A,j-(1-g[7])*H]},g.findBitmapIsExist=function(B){if(B instanceof laya.webgl.resource.WebGLImage){var g=B,l=g.url,o=this._InAtlasWebGLImagesKey[l||g.id];if(o)return o.offsetInfoID}return-1},g.addToAtlasTexture=function(B,g,l){if(B instanceof laya.webgl.resource.WebGLImage){var o=B,V=o.url;this._InAtlasWebGLImagesKey[V||o.id]={bitmap:B,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([g,l])}this._atlasCanvas.texSubImage2D(g,l,B.atlasSource),B.clearAtlasSource()},g.addToAtlas=function(B,g,l){B._atlasID=this._inAtlasTextureKey.length;var o=B.uv.slice(),V=B.bitmap;this._inAtlasTextureKey.push(B),this._inAtlasTextureOriUVValue.push(o),this._inAtlasTextureBitmapValue.push(V),this.computeUVinAtlasTexture(B,o,g,l),B.bitmap=this._atlasCanvas},g.clear=function(){for(var B=0,g=this._inAtlasTextureKey.length;B<g;B++)this._inAtlasTextureKey[B].bitmap=this._inAtlasTextureBitmapValue[B],this._inAtlasTextureKey[B].uv=this._inAtlasTextureOriUVValue[B],this._inAtlasTextureKey[B]._atlasID=-1,this._inAtlasTextureKey[B].bitmap.lock=!1,this._inAtlasTextureKey[B].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},g.dispose=function(){this.clear(),this._atlasCanvas.destroy()},o(0,g,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),o(0,g,"texture",function(){return this._atlasCanvas}),o(0,g,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),U}(),zB=function(B){function l(){l.__super.call(this,l.__name2int,l.__int2name,l.__int2nameMap)}return K(l,"laya.webgl.shader.d2.ShaderDefines2D",O),l.__init__=function(){l.reg("TEXTURE2D",1),l.reg("COLOR2D",2),l.reg("PRIMITIVE",4),l.reg("GLOW_FILTER",8),l.reg("BLUR_FILTER",16),l.reg("COLOR_FILTER",32),l.reg("COLOR_ADD",64),l.reg("WORLDMAT",128),l.reg("FILLTEXTURE",256),l.reg("FSHIGHPRECISION",1024),l.reg("TXTALPHA",2048),l.reg("TXTCOMPRESS",4096)},l.reg=function(B,g){O._reg(B,g,l.__name2int,l.__int2name)},l.toText=function(B,g,l){return O._toText(B,g,l)},l.toInt=function(B){return O._toInt(B,l.__name2int)},l.TEXTURE2D=1,l.COLOR2D=2,l.PRIMITIVE=4,l.FILTERGLOW=8,l.FILTERBLUR=16,l.FILTERCOLOR=32,l.COLORADD=64,l.WORLDMAT=128,l.FILLTEXTURE=256,l.SKINMESH=512,l.SHADERDEFINE_FSHIGHPRECISION=1024,l.TXTALPHA=2048,l.TXTCOMPRESS=4096,l.__name2int={},l.__int2name=[],l.__int2nameMap=[],l}(),tB=(function(B){function G(B,g,l,o,V,U,y){G.__super.call(this,B,g,l,o,40,V,U,y)}K(G,"laya.webgl.shapes.Ellipse",lB)}(),function(B){function U(B,g,l,o,V){this._points=[],this.rebuild(l),U.__super.call(this,B,g,0,0,0,V,o,V,0)}K(U,"laya.webgl.shapes.Line",lB);var g=U.prototype;return g.rebuild=function(B){var g=B.length;g!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(g/2-1)),this.mFloat32Array=new Float32Array(5*g)),this._points.length=0;for(var l=NaN,o=NaN,V=-1,U=-1,y=B.length/2,G=0;G<y;G++)l=B[2*G],o=B[2*G+1],(.01<Math.abs(V-l)||.01<Math.abs(U-o))&&this._points.push(l,o),V=l,U=o},g.getData=function(B,g,l){var o=[],V=[];0<this.borderWidth&&this.createLine2(this._points,o,this.borderWidth,l,V,this._points.length/2),this.mUint16Array.set(o,0),this.mFloat32Array.set(V,0),B.append(this.mUint16Array),g.append(this.mFloat32Array)},U}()),hB=function(B){function H(B,g,l,o,V){this._points=[];for(var U=NaN,y=NaN,G=-1,d=-1,j=l.length/2-1,A=0;A<j;A++)U=l[2*A],y=l[2*A+1],(.01<Math.abs(G-U)||.01<Math.abs(d-y))&&this._points.push(U,y),G=U,d=y;U=l[2*j],y=l[2*j+1],G=this._points[0],d=this._points[1],(.01<Math.abs(G-U)||.01<Math.abs(d-y))&&this._points.push(U,y),H.__super.call(this,B,g,0,0,this._points.length/2,0,o,V)}K(H,"laya.webgl.shapes.LoopLine",lB);var g=H.prototype;return g.getData=function(B,g,l){if(0<this.borderWidth){for(var o=this.color,V=(o>>16&255)/255,U=(o>>8&255)/255,y=(255&o)/255,G=[],d=0,j=0,A=[],H=Math.floor(this._points.length/2),K=0;K<H;K++)d=this._points[2*K],j=this._points[2*K+1],G.push(this.x+d,this.y+j,V,U,y);this.createLoopLine(G,A,this.borderWidth,l+G.length/5),B.append(new Uint16Array(A)),g.append(new Float32Array(G))}},g.createLoopLine=function(B,g,l,o,V,U){B.length;var y=B.concat(),G=V||B,d=this.borderColor,j=(d>>16&255)/255,A=(d>>8&255)/255,H=(255&d)/255,K=[y[0],y[1]],p=[y[y.length-5],y[y.length-4]],x=p[0]+.5*(K[0]-p[0]),N=p[1]+.5*(K[1]-p[1]);y.unshift(x,N,0,0,0),y.push(x,N,0,0,0);var F,C,m,M,b,D,v,s,X,w,i,a,z,t,h,f,S,E,e,Q,_=y.length/5,P=o,Y=l/2;m=y[0],M=y[1],w=m-(b=y[5]),X=(X=-(M-(D=y[6])))/(Q=Math.sqrt(X*X+w*w))*Y,w=w/Q*Y,G.push(m-X,M-w,j,A,H,m+X,M+w,j,A,H);for(var c=1;c<_-1;c++)m=y[5*(c-1)],M=y[5*(c-1)+1],b=y[5*c],D=y[5*c+1],v=y[5*(c+1)],s=y[5*(c+1)+1],w=m-b,a=b-v,h=(-(X=(X=-(M-D))/(Q=Math.sqrt(X*X+w*w))*Y)+m)*(-(w=w/Q*Y)+D)-(-X+b)*(-w+M),E=(-(i=(i=-(D-s))/(Q=Math.sqrt(i*i+a*a))*Y)+v)*(-(a=a/Q*Y)+D)-(-i+b)*(-a+s),e=(z=-w+M-(-w+D))*(S=-i+b-(-i+v))-(f=-a+s-(-a+D))*(t=-X+b-(-X+m)),Math.abs(e)<.1?(e+=10.1,G.push(b-X,D-w,j,A,H,b+X,D+w,j,A,H)):(((F=(t*E-S*h)/e)-b)*(F-b)+((C=(f*h-z*E)/e)-D)+(C-D),G.push(F,C,j,A,H,b-(F-b),D-(C-D),j,A,H));U&&(g=U);var r=this.edges+1;for(c=1;c<r;c++)g.push(P+2*(c-1),P+2*(c-1)+1,P+2*c+1,P+2*c+1,P+2*c,P+2*(c-1));return g.push(P+2*(c-1),P+2*(c-1)+1,P+1,P+1,P,P+2*(c-1)),G},H}(),fB=function(B){function y(B,g,l,o,V,U){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=w.create(),this._points=l.slice(0,l.length),y.__super.call(this,B,g,0,0,this._points.length/2,o,V,U)}K(y,"laya.webgl.shapes.Polygon",lB);var g=y.prototype;return g.rebuild=function(B){this._repaint||(this._points.length=0,this._points=this._points.concat(B))},g.setMatrix=function(B){B.copyTo(this._mat)},g.needUpdate=function(B){return this._repaint=this._mat.a==B.a&&this._mat.b==B.b&&this._mat.c==B.c&&this._mat.d==B.d&&this._mat.tx==B.tx&&this._mat.ty==B.ty,!this._repaint},g.getData=function(B,g,l){var o,V=0,U=this._points,y=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=l){for(this._start=l,o=[],y=this.earcutTriangles.length,V=0;V<y;V++)o.push(this.earcutTriangles[V]+l);this.mUint16Array=new Uint16Array(o)}}else{this._start=l,o=[];var G=[],d=[],j=this.color,A=(j>>16&255)/255,H=(j>>8&255)/255,K=(255&j)/255;for(y=Math.floor(U.length/2),V=0;V<y;V++)G.push(this.x+U[2*V],this.y+U[2*V+1],A,H,K),d.push(this.x+U[2*V],this.y+U[2*V+1]);for(this.earcutTriangles=oB.earcut(d,null,2),y=this.earcutTriangles.length,V=0;V<y;V++)o.push(this.earcutTriangles[V]+l);this.mUint16Array=new Uint16Array(o),this.mFloat32Array=new Float32Array(G)}B.append(this.mUint16Array),g.append(this.mFloat32Array)},y}(),SB=function(B){function U(){this._matrix=new w,this._matrix4=NB.defaultMatrix4.concat(),U.__super.call(this,1e4),this.shaderValue=new XB(0,0)}K(U,"laya.webgl.submit.SubmitCanvas",UB);var g=U.prototype;return g.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var B=mB.worldAlpha,g=mB.worldMatrix4,l=mB.worldMatrix,o=mB.worldFilters,V=mB.worldShaderDefines,U=this.shaderValue,y=this._matrix,G=this._matrix4,d=w.TEMP;return w.mul(y,l,d),G[0]=d.a,G[1]=d.b,G[4]=d.c,G[5]=d.d,G[12]=d.tx,G[13]=d.ty,mB.worldMatrix=d.clone(),mB.worldMatrix4=G,mB.worldAlpha=mB.worldAlpha*U.alpha,U.filters&&U.filters.length&&(mB.worldFilters=U.filters,mB.worldShaderDefines=U.defines),this._ctx_src.flush(),mB.worldAlpha=B,mB.worldMatrix4=g,mB.worldMatrix.destroy(),mB.worldMatrix=l,mB.worldFilters=o,mB.worldShaderDefines=V,1},g.releaseRender=function(){var B=U._cache;this._ctx_src=null,B[B._length++]=this},g.getRenderType=function(){return 10003},U.create=function(B,g,l){var o=U._cache._length?U._cache[--U._cache._length]:new U;o._ctx_src=B;var V=o.shaderValue;return V.alpha=g,V.defines.setValue(0),l&&l.length&&V.setFilters(l),o},U._cache=((U._cache=[])._length=0,U._cache),U}(),EB=function(B){function j(B){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===B&&(B=1e4),j.__super.call(this,B)}K(j,"laya.webgl.submit.SubmitTexture",UB);var g=j.prototype;return g.releaseRender=function(){var B=j._cache;(B[B._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},g.addTexture=function(B,g){this._texsID[this._texs.length]=B._uvID,this._texs.push(B),this._vbPos.push(g)},g.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var B=this.shaderValue.textureHost.bitmap;if(null!==B)for(var g=this._vb.getFloat32Array(),l=0,o=this._texs.length;l<o;l++){var V=this._texs[l];V.active();var U=V.uv;if(this._texsID[l]!==V._uvID){this._texsID[l]=V._uvID;var y=this._vbPos[l];g[y+2]=U[0],g[y+3]=U[1],g[y+6]=U[2],g[y+7]=U[3],g[y+10]=U[4],g[y+11]=U[5],g[y+14]=U[6],g[y+15]=U[7],this._vb.setNeedUpload()}V.bitmap!==B&&(this._isSameTexture=!1)}}},g.renderSubmit=function(){if(0===this._numEle)return j._shaderSet=!1,1;var B=this.shaderValue.textureHost;if(B){var g=B.source;if(!B.bitmap||!g)return j._shaderSet=!1,1;this.shaderValue.texture=g,B.alphaTexture&&B.alphaTexture.source&&(this.shaderValue.texture1=B.alphaTexture.source)}this._vb.bind_upload(this._ib);var l=bB.mainContext;if(T.activeBlendFunction!==this._blendFn&&(l.enable(3042),this._blendFn(l),T.activeBlendFunction=this._blendFn),h.drawCall++,h.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&QB.activeShader&&j._shaderSet?(QB.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&QB.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),j._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var o=B.bitmap,V=0,U=QB.activeShader,y=0,G=this._texs.length;y<G;y++){var d=this._texs[y];d.bitmap===o&&y+1!==G||(U.uploadTexture2D(d.source),l.drawElements(4,6*(y-V+1),5123,this._startIdx+6*V*NB.BYTES_PIDX),o=d.bitmap,V=y)}else l.drawElements(4,this._numEle,5123,this._startIdx);return 1},j.create=function(B,g,l,o,V){var U=j._cache._length?j._cache[--j._cache._length]:new j;null==l&&((l=U._selfVb||(U._selfVb=OB.create(-1))).clear(),o=0),U._ib=g,U._vb=l,U._startIdx=o*NB.BYTES_PIDX,U._numEle=0;var y=B._nBlendType;U._blendFn=B._targets?T.targetFns[y]:T.fns[y],U.shaderValue=V,U.shaderValue.setValue(B._shader2D);var G=B._shader2D.filters;return G&&U.shaderValue.setFilters(G),U},j._cache=((j._cache=[])._length=0,j._cache),j._shaderSet=!0,j}(),eB=function(B){function C(){C.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}K(C,"laya.webgl.utils.MeshTexture",CB);var g=C.prototype;return g.addData=function(B,g,l,o,V,U){for(var y=B.length/2,G=this._vb.needSize(y*C.const_stride)>>2,d=this._vb.getFloat32Array(),j=0,A=0;A<y;A++){var H=B[j],K=B[j+1],p=H*o.a+K*o.c+o.tx,x=H*o.b+K*o.d+o.ty;d[G++]=p,d[G++]=x,d[G++]=g[j],d[G++]=g[j+1],j+=2}this._vb.setNeedUpload();var N=this.vertNum;if(0<N){(y=l.length)>C.tmpIdx.length&&(C.tmpIdx=new Uint16Array(y));for(var F=0;F<y;F++)C.tmpIdx[F]=l[F]+N;this._ib.appendU16Array(C.tmpIdx,l.length)}else this._ib.append(l);this._ib.setNeedUpload(),this.vertNum+=y,this.indexNum+=l.length},g.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},g.destroy=function(){this._ib.destroy(),this._vb.destroy()},C.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new C},C.const_stride=16,C._POOL=[],y(C,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),C}(),QB=function(B){function g(){g.__super.call(this),this.lock=!0}return K(g,"laya.webgl.shader.BaseShader",M),g.activeShader=null,g.bindShader=null,g}(),_B=function(g){function A(B,g,l,o,V,U,y,G,d){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===l&&(l=6408),void 0===o&&(o=5121),void 0===V&&(V=34041),void 0===U&&(U=!1),void 0===y&&(y=!1),void 0===G&&(G=-1),void 0===d&&(d=-1),this._type=1,this._w=B,this._h=g,this._surfaceFormat=l,this._surfaceType=o,this._depthStencilFormat=V,C.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=U,this._repeat=y,this._minFifter=G,this._magFifter=d,this._createWebGLRenderTarget(),this.bitmap.lock=!0,A.__super.call(this,this.bitmap,e.INV_UV)}K(A,"laya.webgl.resource.RenderTarget2D",g);var B=A.prototype;return v.imps(B,{"laya.resource.IDispose":!0}),B.getType=function(){return this._type},B.getTexture=function(){return this},B.size=function(B,g){this._w==B&&this._h==g||(this._w=B,this._h=g,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},B.release=function(){this.destroy()},B.recycle=function(){A.POOL.push(this)},B.start=function(){var B=bB.mainContext;return this._preRenderTarget=mB.curRenderTarget,mB.curRenderTarget=this,B.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(B.viewport(0,0,this._w,this._h),this._svWidth=mB.width,this._svHeight=mB.height,mB.width=this._w,mB.height=this._h,QB.activeShader=null),this},B.clear=function(B,g,l,o){void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=1);var V=bB.mainContext;V.clearColor(B,g,l,o);var U=16384;switch(this._depthStencilFormat){case 33189:U|=256;break;case 36168:U|=1024;break;case 34041:U|=256,U|=1024}V.clear(U)},B.end=function(){var B=bB.mainContext;B.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,mB.curRenderTarget=this._preRenderTarget,1==this._type?(B.viewport(0,0,this._svWidth,this._svHeight),mB.width=this._svWidth,mB.height=this._svHeight,QB.activeShader=null):B.viewport(0,0,v.stage.width,v.stage.height)},B.getData=function(B,g,l,o){var V=bB.mainContext;if(V.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===V.checkFramebufferStatus(36160)))return V.bindFramebuffer(36160,null),null;var U=new Uint8Array(this._w*this._h*4);return V.readPixels(B,g,l,o,this._surfaceFormat,this._surfaceType,U),V.bindFramebuffer(36160,null),U},B.destroy=function(B){void 0===B&&(B=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,g.prototype.destroy.call(this))},B.dispose=function(){},B._createWebGLRenderTarget=function(){this.bitmap=new LB(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(B){this.event("recovered")})},o(0,B,"surfaceFormat",function(){return this._surfaceFormat}),o(0,B,"magFifter",function(){return this._magFifter}),o(0,B,"surfaceType",function(){return this._surfaceType}),o(0,B,"mipMap",function(){return this._mipMap}),o(0,B,"depthStencilFormat",function(){return this._depthStencilFormat}),o(0,B,"minFifter",function(){return this._minFifter}),o(0,B,"source",function(){return this._alreadyResolved?v.superGet(e,this,"source"):null}),A.create=function(B,g,l,o,V,U,y,G,d){void 0===l&&(l=6408),void 0===o&&(o=5121),void 0===V&&(V=34041),void 0===U&&(U=!1),void 0===y&&(y=!1),void 0===G&&(G=-1),void 0===d&&(d=-1);var j=A.POOL.pop();return j||(j=new A(B,g)),j.bitmap&&j._w==B&&j._h==g&&j._surfaceFormat==l&&j._surfaceType==o&&j._depthStencilFormat==V&&j._mipMap==U&&j._repeat==y&&j._minFifter==G&&j._magFifter==d||(j._w=B,j._h=g,j._surfaceFormat=l,j._surfaceType=o,j._depthStencilFormat=V,C.isConchWebGL&&34041===j._depthStencilFormat&&(j._depthStencilFormat=33189),j._mipMap=U,j._repeat=y,j._minFifter=G,j._magFifter=d,j.release(),j._createWebGLRenderTarget()),j},A.TYPE2D=1,A.TYPE3D=2,A.POOL=[],A}(e),PB=function(B){function g(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,g.__super.call(this),g._gl=bB.mainContext}K(g,"laya.webgl.utils.Buffer",M);var l=g.prototype;return l._bind=function(){this.activeResource(),g._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(g._bindVertexBuffer=this._glBuffer),g._gl.bindBuffer(this._bufferType,g._bindActive[this._bufferType]=this._glBuffer),QB.activeShader=null)},l.recreateResource=function(){this._glBuffer||(this._glBuffer=g._gl.createBuffer()),this.completeCreate()},l.disposeResource=function(){this._glBuffer&&(bB.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},o(0,l,"bufferUsage",function(){return this._bufferUsage}),g._gl=null,g._bindActive={},g._bindVertexBuffer=null,g._enableAtributes=[],g}(),YB=function(B){function l(B){this.texcoord=null,this.offsetX=300,this.offsetY=0,l.__super.call(this,512,0);var g=8*NB.BYTES_PE;this.position=[2,5126,!1,g,0],this.texcoord=[2,5126,!1,g,2*NB.BYTES_PE],this.color=[4,5126,!1,g,4*NB.BYTES_PE]}return K(l,"laya.webgl.shader.d2.skinAnishader.SkinSV",XB),l}(),cB=function(B){function g(B){g.__super.call(this,2,0),this.color=[]}return K(g,"laya.webgl.shader.d2.value.Color2dSV",XB),g.prototype.setValue=function(B){B.fillStyle&&(this.color=B.fillStyle._color._color),B.strokeStyle&&(this.color=B.strokeStyle._color._color)},g}(),rB=function(B){function g(B){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=XB._TEXCOORD,g.__super.call(this,256,0)}K(g,"laya.webgl.shader.d2.value.FillTextureSV",XB);var l=g.prototype;return l.setValue=function(B){this.ALPHA=B.ALPHA,B.filters&&this.setFilters(B.filters)},l.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},g}(),ZB=function(B){function g(B){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=XB._TEXCOORD,void 0===B&&(B=0),g.__super.call(this,1,B)}K(g,"laya.webgl.shader.d2.value.TextureSV",XB);var l=g.prototype;return l.setValue=function(B){this.ALPHA=B.ALPHA,B.filters&&this.setFilters(B.filters)},l.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},g}(),TB=function(B){function g(B){this.a_color=null,this.u_pos=[0,0],g.__super.call(this,4,0),this.position=[2,5126,!1,5*NB.BYTES_PE,0],this.a_color=[3,5126,!1,5*NB.BYTES_PE,2*NB.BYTES_PE]}return K(g,"laya.webgl.shader.d2.value.PrimitiveSV",XB),g}(),RB=function(B){function g(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,g.__super.call(this)}K(g,"laya.webgl.atlas.AtlasWebGLCanvas",B);var l=g.prototype;return l.recreateResource=function(){var B=bB.mainContext,g=this._source=B.createTexture(),l=DB.curBindTexTarget,o=DB.curBindTexValue;DB.bindTexture(B,3553,g),B.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),B.texParameteri(3553,10241,9729),B.texParameteri(3553,10240,9729),B.texParameteri(3553,10242,33071),B.texParameteri(3553,10243,33071),l&&o&&DB.bindTexture(B,l,o),this.memorySize=this._w*this._h*4,this.completeCreate()},l.disposeResource=function(){this._source&&(bB.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},l.texSubImage2D=function(B,g,l){if(C.isFlash){this._flashCacheImage||(this._flashCacheImage=N.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var o=l.bitmapdata;this._flashCacheImage._image.copyPixels(o,0,0,o.width,o.height,B,g),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var V=bB.mainContext,U=DB.curBindTexTarget,y=DB.curBindTexValue;DB.bindTexture(V,3553,this._source),V.pixelStorei(37441,!0),0<=B-1&&V.texSubImage2D(3553,0,B-1,g,6408,5121,l),B+1<=this._w&&V.texSubImage2D(3553,0,B+1,g,6408,5121,l),0<=g-1&&V.texSubImage2D(3553,0,B,g-1,6408,5121,l),g+1<=this._h&&V.texSubImage2D(3553,0,B,g+1,6408,5121,l),V.texSubImage2D(3553,0,B,g,6408,5121,l),V.pixelStorei(37441,!1),U&&y&&DB.bindTexture(V,U,y)}},l.texSubImage2DPixel=function(B,g,l,o,V){var U=bB.mainContext,y=DB.curBindTexTarget,G=DB.curBindTexValue;DB.bindTexture(U,3553,this._source);var d=new Uint8Array(V.data);U.pixelStorei(37441,!0),U.texSubImage2D(3553,0,B,g,l,o,6408,5121,d),U.pixelStorei(37441,!1),y&&G&&DB.bindTexture(U,y,G)},o(0,l,"width",B.prototype._$get_width,function(B){this._w=B}),o(0,l,"height",B.prototype._$get_height,function(B){this._h=B}),g}(l),WB=function(B){function V(){this.flipY=!0,this.alwaysChange=!1,V.__super.call(this)}K(V,"laya.webgl.resource.WebGLCanvas",l);var g=V.prototype;return g.getCanvas=function(){return this._canvas},g.clear=function(){this._ctx&&this._ctx.clear()},g.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},g._setContext=function(B){this._ctx=B},g.getContext=function(B,g){return this._ctx?this._ctx:this._ctx=V._createContext(this)},g.size=function(B,g){this._w==B&&this._h==g||(this._w=B,this._h=g,this._ctx&&this._ctx.size(B,g),this._canvas&&(this._canvas.height=g,this._canvas.width=B))},g.activeResource=function(B){void 0===B&&(B=!1),this._source||this.recreateResource()},g.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},g.disposeResource=function(){this._source&&!this.iscpuSource&&(bB.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},g.createWebGlTexture=function(){var B=bB.mainContext;this._canvas;var g=this._source=B.createTexture();this.iscpuSource=!1;var l=DB.curBindTexTarget,o=DB.curBindTexValue;DB.bindTexture(B,3553,g),B.pixelStorei(37440,this.flipY?1:0),V.premulAlpha&&B.pixelStorei(37441,!0),B.texImage2D(3553,0,6408,6408,5121,this._imgData),V.premulAlpha&&B.pixelStorei(37441,!1),B.texParameteri(3553,10240,9729),B.texParameteri(3553,10241,9729),B.texParameteri(3553,10242,33071),B.texParameteri(3553,10243,33071),B.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,l&&o&&DB.bindTexture(B,l,o)},g.reloadCanvasData=function(){var B=bB.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var g=DB.curBindTexTarget,l=DB.curBindTexValue;DB.bindTexture(B,3553,this._source),V.premulAlpha&&B.pixelStorei(37441,!0),B.texImage2D(3553,0,6408,6408,5121,this._imgData),V.premulAlpha&&B.pixelStorei(37441,!1),B.pixelStorei(37440,0),g&&l&&DB.bindTexture(B,g,l)},g.texSubImage2D=function(B,g,l){var o=bB.mainContext,V=DB.curBindTexTarget,U=DB.curBindTexValue;DB.bindTexture(o,3553,this._source),o.pixelStorei(37441,!0),o.texSubImage2D(3553,0,g,l,6408,5121,B._source),o.pixelStorei(37441,!1),V&&U&&DB.bindTexture(o,V,U)},g.toBase64=function(B,g,l){var o=null;this._canvas&&(o=this._canvas.toDataURL(B,g)),l.call(this,o)},o(0,g,"context",function(){return this._ctx}),o(0,g,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),o(0,g,"asBitmap",null,function(B){this._ctx&&(this._ctx.asBitmap=B)}),V._createContext=null,V.premulAlpha=!1,V}(),nB=function(B){function U(B,g){this.CborderSize=12,U.__super.call(this),this.char=B,this.isSpace=" "===B,this.xs=g.scaleX,this.ys=g.scaleY,this.font=g.font.toString(),this.fontSize=g.font.size,this.fillColor=g.fillColor,this.borderColor=g.borderColor,this.lineWidth=g.lineWidth,this.underLine=g.underLine;var l,o=C.isConchApp;o?((l=ConchTextCanvas)._source=ConchTextCanvas,l._source.canvas=ConchTextCanvas):l=p.canvas.source,this.canvas=l,this._enableMerageInAtlas=!0,this._ctx=o?l:this.canvas.getContext("2d",void 0);var V=Q.measureText(this.char,this.font);this.cw=V.width*this.xs,this.ch=(V.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new e(this)}K(U,"laya.webgl.resource.WebGLCharImage",l);var g=U.prototype;return v.imps(g,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),g.active=function(){this.texture.active()},g.recreateResource=function(){var B=C.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),B){var g=this.fontSize;1==this.xs&&1==this.ys||(g=parseInt(g*(this.xs>this.ys?this.xs:this.ys)+""));var l="normal 100 "+this.font;l=l.replace(U._fontSizeReg,g),this.borderColor&&(l+=" 1 "+this.borderColor),this._ctx.font=l,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,E.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var o=this._ctx.measureText(this.char);o||(o={width:16});var V=o.width+1;this._ctx.lineTo(V,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},g.onresize=function(B,g){this._w=B,this._h=g,this._allowMerageInAtlas=!0},g.clearAtlasSource=function(){},o(0,g,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),o(0,g,"atlasSource",function(){return this.canvas}),o(0,g,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(B){this._enableMerageInAtlas=B}),U.createOneChar=function(B,g){return new U(B,g)},U._fontSizeReg=new RegExp("\\d+(?=px)","g"),U}(),LB=function(B){function j(B,g,l,o,V,U,y,G,d){void 0===l&&(l=6408),void 0===o&&(o=5121),void 0===V&&(V=34041),void 0===U&&(U=!1),void 0===y&&(y=!1),void 0===G&&(G=-1),void 0===d&&(d=1),j.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=B,this._h=g,this._surfaceFormat=l,this._surfaceType=o,this._depthStencilFormat=V,this._mipMap=U,this._repeat=y,this._minFifter=G,this._magFifter=d}K(j,"laya.webgl.resource.WebGLRenderTarget",l);var g=j.prototype;return g.recreateResource=function(){var B=bB.mainContext;this._frameBuffer||(this._frameBuffer=B.createFramebuffer()),this._source||(this._source=B.createTexture());var g=DB.curBindTexTarget,l=DB.curBindTexValue;DB.bindTexture(B,3553,this._source),B.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var o=this._minFifter,V=this._magFifter,U=this._repeat?10497:33071,y=A.isPOT(this._w,this._h);if(y?(this._mipMap?-1!==o||(o=9987):-1!==o||(o=9729),-1!==V||(V=9729),B.texParameteri(3553,10241,o),B.texParameteri(3553,10240,V),B.texParameteri(3553,10242,U),B.texParameteri(3553,10243,U),this._mipMap&&B.generateMipmap(3553)):(-1!==o||(o=9729),-1!==V||(V=9729),B.texParameteri(3553,10241,o),B.texParameteri(3553,10240,V),B.texParameteri(3553,10242,33071),B.texParameteri(3553,10243,33071)),B.bindFramebuffer(36160,this._frameBuffer),B.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=B.createRenderbuffer()),B.bindRenderbuffer(36161,this._depthStencilBuffer),B.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:B.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:B.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:B.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}B.bindFramebuffer(36160,null),g&&l&&DB.bindTexture(B,g,l),B.bindRenderbuffer(36161,null),y&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},g.disposeResource=function(){this._frameBuffer&&(bB.mainContext.deleteTexture(this._source),bB.mainContext.deleteFramebuffer(this._frameBuffer),bB.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},o(0,g,"depthStencilBuffer",function(){return this._depthStencilBuffer}),o(0,g,"frameBuffer",function(){return this._frameBuffer}),j}(),IB=function(B){function G(B,g,l,o,V,U,y){this.offsetX=0,this.offsetY=0,G.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=U,this.canvas=B,this._ctx=B.getContext("2d",void 0),this._w=o,this._h=V,this.offsetX=g,this.offsetY=l,this.src=y,this._enableMerageInAtlas=!0,r.enabled&&this._w<r.atlasLimitWidth&&this._h<r.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}K(G,"laya.webgl.resource.WebGLSubImage",l);var g=G.prototype;return v.imps(g,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),g.size=function(B,g){this._w=B,this._h=g,this._ctx&&this._ctx.size(B,g),this.canvas&&(this.canvas.height=g,this.canvas.width=B)},g.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},g.createWebGlTexture=function(){var B=bB.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var g=this._source=B.createTexture(),l=DB.curBindTexTarget,o=DB.curBindTexValue;DB.bindTexture(B,3553,g),B.pixelStorei(37441,!0),B.texImage2D(3553,0,6408,6408,5121,this.canvas),B.pixelStorei(37441,!1);var V=this.minFifter,U=this.magFifter,y=this.repeat?10497:33071,G=A.isPOT(this.width,this.height);G?(this.mipmap?-1!==V||(V=9987):-1!==V||(V=9729),-1!==U||(U=9729),B.texParameteri(3553,10240,U),B.texParameteri(3553,10241,V),B.texParameteri(3553,10242,y),B.texParameteri(3553,10243,y),this.mipmap&&B.generateMipmap(3553)):(-1!==V||(V=9729),-1!==U||(U=9729),B.texParameteri(3553,10241,V),B.texParameteri(3553,10240,U),B.texParameteri(3553,10242,33071),B.texParameteri(3553,10243,33071)),l&&o&&DB.bindTexture(B,l,o),this.canvas=null,G&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},g.disposeResource=function(){r.enabled&&this._allowMerageInAtlas||!this._source||(bB.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},g.clearAtlasSource=function(){},o(0,g,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),o(0,g,"atlasSource",function(){return this.canvas}),o(0,g,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(B){this._allowMerageInAtlas=B}),G}(),kB=function(B){function j(B,g,l,o){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,j.__super.call(this),!B||!g)throw"Shader Error";this._id=++j._count,this._vs=B,this._ps=g,this._nameMap=o||{},null!=l&&(j.sharders[l]=this)}K(j,"laya.webgl.shader.Shader",QB);var g=j.prototype;return g.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},g.disposeResource=function(){bB.mainContext.deleteShader(this._vshader),bB.mainContext.deleteShader(this._pshader),bB.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},g._compile=function(){if(!bB.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var B=[this._vs,this._ps],g=bB.mainContext;if(this._program=g.createProgram(),this._vshader=j._createShader(g,B[0],35633),this._pshader=j._createShader(g,B[1],35632),g.attachShader(this._program,this._vshader),g.attachShader(this._program,this._pshader),g.linkProgram(this._program),!C.isConchApp&&!g.getProgramParameter(this._program,35714))throw g.getProgramInfoLog(this._program);var l,o,V=0,U=0;for(U=C.isConchApp?g.getProgramParameterEx(this._vs,this._ps,"",35721):g.getProgramParameter(this._program,35721),V=0;V<U;V++){var y=null;l={vartype:"attribute",glfun:null,ivartype:0,attrib:y=C.isConchApp?g.getActiveAttribEx(this._vs,this._ps,"",V):g.getActiveAttrib(this._program,V),location:g.getAttribLocation(this._program,y.name),name:y.name,type:y.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(l)}var G=0;for(G=C.isConchApp?g.getProgramParameterEx(this._vs,this._ps,"",35718):g.getProgramParameter(this._program,35718),V=0;V<G;V++){var d=null;d=C.isConchApp?g.getActiveUniformEx(this._vs,this._ps,"",V):g.getActiveUniform(this._program,V),0<(l={vartype:"uniform",glfun:null,ivartype:1,attrib:y,location:g.getUniformLocation(this._program,d.name),name:d.name,type:d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(l.name=l.name.substr(0,l.name.length-3),l.isArray=!0,l.location=g.getUniformLocation(this._program,l.name)),this._params.push(l)}for(V=0,o=this._params.length;V<o;V++)if((l=this._params[V]).indexOfParams=V,l.index=1,l.value=[l.location,null],l.codename=l.name,l.name=this._nameMap[l.codename]?this._nameMap[l.codename]:l.codename,(this._paramsMap[l.name]=l)._this=this,l.uploadedValue=[],"attribute"!==l.vartype)switch(l.type){case 5124:l.fun=l.isArray?this._uniform1iv:this._uniform1i;break;case 5126:l.fun=l.isArray?this._uniform1fv:this._uniform1f;break;case 35664:l.fun=l.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:l.fun=l.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:l.fun=l.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:l.fun=this._uniform_sampler2D;break;case 35680:l.fun=this._uniform_samplerCube;break;case 35676:l.glfun=g.uniformMatrix4fv,l.fun=this._uniformMatrix4fv;break;case 35670:l.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else l.fun=this._attribute}},g.getUniform=function(B){return this._paramsMap[B]},g._attribute=function(B,g){var l=bB.mainContext,o=PB._enableAtributes,V=B.location;return o[V]||l.enableVertexAttribArray(V),l.vertexAttribPointer(V,g[0],g[1],g[2],g[3],g[4]+this._offset),o[V]=PB._bindVertexBuffer,1},g._uniform1f=function(B,g){var l=B.uploadedValue;return l[0]!==g?(bB.mainContext.uniform1f(B.location,l[0]=g),1):0},g._uniform1fv=function(B,g){if(g.length<4){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(bB.mainContext.uniform1fv(B.location,g),l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],1):0}return bB.mainContext.uniform1fv(B.location,g),1},g._uniform_vec2=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]?(bB.mainContext.uniform2f(B.location,l[0]=g[0],l[1]=g[1]),1):0},g._uniform_vec2v=function(B,g){if(g.length<2){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(bB.mainContext.uniform2fv(B.location,g),l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],1):0}return bB.mainContext.uniform2fv(B.location,g),1},g._uniform_vec3=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]?(bB.mainContext.uniform3f(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2]),1):0},g._uniform_vec3v=function(B,g){return bB.mainContext.uniform3fv(B.location,g),1},g._uniform_vec4=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(bB.mainContext.uniform4f(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3]),1):0},g._uniform_vec4v=function(B,g){return bB.mainContext.uniform4fv(B.location,g),1},g._uniformMatrix2fv=function(B,g){return bB.mainContext.uniformMatrix2fv(B.location,!1,g),1},g._uniformMatrix3fv=function(B,g){return bB.mainContext.uniformMatrix3fv(B.location,!1,g),1},g._uniformMatrix4fv=function(B,g){return bB.mainContext.uniformMatrix4fv(B.location,!1,g),1},g._uniform1i=function(B,g){var l=B.uploadedValue;return l[0]!==g?(bB.mainContext.uniform1i(B.location,l[0]=g),1):0},g._uniform1iv=function(B,g){return bB.mainContext.uniform1iv(B.location,g),1},g._uniform_ivec2=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]?(bB.mainContext.uniform2i(B.location,l[0]=g[0],l[1]=g[1]),1):0},g._uniform_ivec2v=function(B,g){return bB.mainContext.uniform2iv(B.location,g),1},g._uniform_vec3i=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]?(bB.mainContext.uniform3i(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2]),1):0},g._uniform_vec3vi=function(B,g){return bB.mainContext.uniform3iv(B.location,g),1},g._uniform_vec4i=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(bB.mainContext.uniform4i(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3]),1):0},g._uniform_vec4vi=function(B,g){return bB.mainContext.uniform4iv(B.location,g),1},g._uniform_sampler2D=function(B,g){var l=bB.mainContext,o=B.uploadedValue;return null==o[0]?(o[0]=this._curActTexIndex,l.uniform1i(B.location,this._curActTexIndex),l.activeTexture(j._TEXTURES[this._curActTexIndex]),DB.bindTexture(l,3553,g),this._curActTexIndex++,1):(l.activeTexture(j._TEXTURES[o[0]]),DB.bindTexture(l,3553,g),0)},g._uniform_samplerCube=function(B,g){var l=bB.mainContext,o=B.uploadedValue;return null==o[0]?(o[0]=this._curActTexIndex,l.uniform1i(B.location,this._curActTexIndex),l.activeTexture(j._TEXTURES[this._curActTexIndex]),DB.bindTexture(l,34067,g),this._curActTexIndex++,1):(l.activeTexture(j._TEXTURES[o[0]]),DB.bindTexture(l,34067,g),0)},g._noSetValue=function(B){console.log("no....:"+B.name)},g.uploadOne=function(B,g){this.activeResource(),DB.UseProgram(this._program);var l=this._paramsMap[B];l.fun.call(this,l,g)},g.uploadTexture2D=function(B){h.shaderCall++;var g=bB.mainContext;g.activeTexture(33984),DB.bindTexture(g,3553,B)},g.uploadTexture2D1=function(B){h.shaderCall++;var g=bB.mainContext;g.activeTexture(33985),DB.bindTexture(g,3553,B)},g.upload=function(B,g){QB.activeShader=QB.bindShader=this,this._lastUseFrameCount===h.loopCount||this.activeResource(),DB.UseProgram(this._program),this._reCompile?(g=this._params,this._reCompile=!1):g=g||this._params;bB.mainContext;for(var l,o,V=g.length,U=0,y=0;y<V;y++)null!==(o=B[(l=g[y]).name])&&(U+=l.fun.call(this,l,o));h.shaderCall+=U},g.uploadArray=function(B,g,l){QB.activeShader=this,(QB.bindShader=this).activeResource(),DB.UseProgram(this._program);this._params;for(var o,V,U=0,y=g-2;0<=y;y-=2)(V=this._paramsMap[B[y]])&&null!=(o=B[y+1])&&(l&&l[V.name]&&l[V.name].bind(),U+=V.fun.call(this,V,o));h.shaderCall+=U},g.getParams=function(){return this._params},j.getShader=function(B){return j.sharders[B]},j.create=function(B,g,l,o){return new j(B,g,l,o)},j.withCompile=function(B,g,l,o){if(l&&j.sharders[l])return j.sharders[l];var V=j._preCompileShader[2e-4*B];if(!V)throw new Error("withCompile shader err!"+B);return V.createShader(g,l,o)},j.withCompile2D=function(B,g,l,o,V){if(o&&j.sharders[o])return j.sharders[o];var U=j._preCompileShader[2e-4*B+g];if(!U)throw new Error("withCompile shader err!"+B+" "+g);return U.createShader(l,o,V)},j.addInclude=function(B,g){MB.addInclude(B,g)},j.preCompile=function(B,g,l,o){var V=2e-4*B;j._preCompileShader[V]=new MB(V,g,l,o)},j.preCompile2D=function(B,g,l,o,V){var U=2e-4*B+g;j._preCompileShader[U]=new MB(U,l,o,V)},j._createShader=function(B,g,l){var o=B.createShader(l);return B.shaderSource(o,g),B.compileShader(o),o},j._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],j._count=0,j._preCompileShader={},j.SHADERNAME2ID=2e-4,j.sharders=((j.sharders=[]).length=32,j.sharders),y(j,["nameKey",function(){return this.nameKey=new f}]),j}(),JB=function(B){function g(){this._maxsize=0,this._upload=!0,this._uploadSize=0,g.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}K(g,"laya.webgl.utils.Buffer2D",B);var l=g.prototype;return l.needSize=function(B){var g=this._byteLength;if(B){var l=this._byteLength+B;l<=this._buffer.byteLength||this._resizeBuffer(l<<1,!0),this._byteLength=l}return g},l._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),h.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,PB._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),PB._gl.bufferSubData(this._bufferType,0,this._buffer)},l._bufferSubData=function(B,g,l){if(void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),this._maxsize=Math.max(this._maxsize,this._byteLength),h.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,PB._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),g||l){var o=this._buffer.slice(g,l);PB._gl.bufferSubData(this._bufferType,B,o)}else PB._gl.bufferSubData(this._bufferType,B,this._buffer)},l._checkArrayUse=function(){},l._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},l._bind_subUpload=function(B,g,l){return void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(B,g,l),!0)},l._resizeBuffer=function(B,g){if(B<this._buffer.byteLength)return this;if(this.memorySize=B,g&&this._buffer&&0<this._buffer.byteLength){var l=new ArrayBuffer(B);new Uint8Array(l).set(new Uint8Array(this._buffer),0),this._buffer=l}else this._buffer=new ArrayBuffer(B);return this._checkArrayUse(),this._upload=!0,this},l.append=function(B){this._upload=!0;var g,l;g=B.byteLength,B instanceof Uint8Array?(this._resizeBuffer(this._byteLength+g,!0),l=new Uint8Array(this._buffer,this._byteLength)):B instanceof Uint16Array?(this._resizeBuffer(this._byteLength+g,!0),l=new Uint16Array(this._buffer,this._byteLength)):B instanceof Float32Array&&(this._resizeBuffer(this._byteLength+g,!0),l=new Float32Array(this._buffer,this._byteLength)),l.set(B,0),this._byteLength+=g,this._checkArrayUse()},l.appendU16Array=function(B,g){this._resizeBuffer(this._byteLength+2*g,!0);for(var l=new Uint16Array(this._buffer,this._byteLength,g),o=0;o<g;o++)l[o]=B[o];this._byteLength+=2*g,this._checkArrayUse()},l.appendEx=function(B,g){this._upload=!0;var l;l=B.byteLength,this._resizeBuffer(this._byteLength+l,!0),new g(this._buffer,this._byteLength).set(B,0),this._byteLength+=l,this._checkArrayUse()},l.appendEx2=function(B,g,l,o){void 0===o&&(o=1),this._upload=!0;var V,U;V=l*o,this._resizeBuffer(this._byteLength+V,!0),U=new g(this._buffer,this._byteLength);var y=0;for(y=0;y<l;y++)U[y]=B[y];this._byteLength+=V,this._checkArrayUse()},l.getBuffer=function(){return this._buffer},l.setNeedUpload=function(){this._upload=!0},l.getNeedUpload=function(){return this._upload},l.upload=function(){var B=this._bind_upload();return PB._gl.bindBuffer(this._bufferType,null),PB._bindActive[this._bufferType]=null,QB.activeShader=null,B},l.subUpload=function(B,g,l){void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0);var o=this._bind_subUpload();return PB._gl.bindBuffer(this._bufferType,null),PB._bindActive[this._bufferType]=null,QB.activeShader=null,o},l.disposeResource=function(){B.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},l.clear=function(){this._byteLength=0,this._upload=!0},o(0,l,"bufferLength",function(){return this._buffer.byteLength}),o(0,l,"byteLength",null,function(B){this._byteLength!==B&&(B<=this._buffer.byteLength||this._resizeBuffer(2*B+256,!0),this._byteLength=B)}),g.__int__=function(B){qB.QuadrangleIB=qB.create(35044),FB.fillIBQuadrangle(qB.QuadrangleIB,16)},g.FLOAT32=4,g.SHORT=2,g}(PB),$B=(function(g){function l(B){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,l.__super.call(this,9)}K(l,"laya.webgl.shader.d2.value.GlowSV",g);var B=l.prototype;B.setValue=function(B){g.prototype.setValue.call(this,B)},B.clear=function(){g.prototype.clear.call(this)}}(ZB),function(B){function g(B){g.__super.call(this,64),this.defines.add(64)}K(g,"laya.webgl.shader.d2.value.TextSV",B);var l=g.prototype;return l.release=function(){(g.pool[g._length++]=this).clear()},l.clear=function(){B.prototype.clear.call(this)},g.create=function(){return g._length?g.pool[--g._length]:new g(null)},g.pool=[],g._length=0,g}(ZB)),uB=function(B){function V(B,g,l,o){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,V.__super.call(this,B,g,l,o)}K(V,"laya.webgl.shader.d2.Shader2X",B);var g=V.prototype;return g.upload2dQuick1=function(B){this.upload(B,this._params2dQuick1||this._make2dQuick1())},g._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var B,g=this._params,l=0,o=g.length;l<o;l++)B=g[l],(C.isFlash||"size"!==B.name&&"position"!==B.name&&"texcoord"!==B.name)&&this._params2dQuick1.push(B)}return this._params2dQuick1},g.disposeResource=function(){B.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},g.upload2dQuick2=function(B){this.upload(B,this._params2dQuick2||this._make2dQuick2())},g._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var B,g=this._params,l=0,o=g.length;l<o;l++)B=g[l],(C.isFlash||"size"!==B.name)&&this._params2dQuick2.push(B)}return this._params2dQuick2},V.create=function(B,g,l,o){return new V(B,g,l,o)},V}(kB),qB=function(B){function g(B){this._uint8Array=null,this._uint16Array=null,void 0===B&&(B=35044),g.__super.call(this),this._bufferUsage=B,this._bufferType=34963,C.isFlash||(this._buffer=new ArrayBuffer(8))}K(g,"laya.webgl.utils.IndexBuffer2D",JB);var l=g.prototype;return l._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},l.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},l.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},l.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},g.QuadrangleIB=null,g.create=function(B){return void 0===B&&(B=35044),new g(B)},g}(),OB=function(B){function l(B,g){this._floatArray32=null,this._vertexStride=0,l.__super.call(this),this._vertexStride=B,this._bufferUsage=g,this._bufferType=34962,C.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}K(l,"laya.webgl.utils.VertexBuffer2D",B);var g=l.prototype;return g.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},g.bind=function(B){B&&B._bind(),this._bind()},g.insertData=function(B,g){this.getFloat32Array().set(B,g),this._upload=!0},g.bind_upload=function(B){B._bind_upload()||B._bind(),this._bind_upload()||this._bind()},g._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},g.disposeResource=function(){B.prototype.disposeResource.call(this)},g.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},o(0,g,"vertexStride",function(){return this._vertexStride}),l.create=function(B,g){return void 0===g&&(g=35048),new l(B,g)},l}(JB),Bg=function(B){function G(B,g,l,o,V,U){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===l&&(l=6408),void 0===o&&(o=!0),G.__super.call(this,B,g),B){if(this._format=l,this._mipmap=o,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof B)this._url=B,this._src=B,this._image=new p.window.Image,g&&(g.onload&&(this.onload=g.onload),g.onerror&&(this.onerror=g.onerror),g.onCreate&&g.onCreate(this)),this._image.crossOrigin=B&&0==B.indexOf("data:")?null:"",B&&(this._image.src=B);else if(B instanceof ArrayBuffer){this._src=g,this._url=this._src;var y=new d(B);y.readUTFBytes(4),y.readUTFBytes(2),y.getInt16();y.endian="bigEndian",this._w=y.getInt16(),this._h=y.getInt16();y.getInt16(),y.getInt16();this._image=new Uint8Array(B,y.pos),this._format=bB.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,r.enabled&&this._w<r.atlasLimitWidth&&this._h<r.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(B instanceof Uint8Array))return this._src=g,this._url=this._src,this._image=B.source||B,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=g,this._url=this._src,this._w=V,this._h=U,this._image=B,this._format=0===l?B.byteLength/(V*U)==4?6408:6407:l}this._$5__enableMerageInAtlas=!0}}K(G,"laya.webgl.resource.WebGLImage",N);var g=G.prototype;return v.imps(g,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),g._init_=function(B,g){},g._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var B=bB.mainContext,g=this._source=B.createTexture(),l=DB.curBindTexTarget,o=DB.curBindTexValue;DB.bindTexture(B,3553,g);var V=this.minFifter,U=this.magFifter,y=this.repeat?10497:33071,G=A.isPOT(this._w,this._h),d=!1;switch(G?(this.mipmap?-1!==V||(V=9987):-1!==V||(V=9729),-1!==U||(U=9729),B.texParameteri(3553,10241,V),B.texParameteri(3553,10240,U),B.texParameteri(3553,10242,y),B.texParameteri(3553,10243,y),this.mipmap&&B.generateMipmap(3553)):(-1!==V||(V=9729),-1!==U||(U=9729),B.texParameteri(3553,10241,V),B.texParameteri(3553,10240,U),B.texParameteri(3553,10242,33071),B.texParameteri(3553,10243,33071)),B.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&B.pixelStorei(B.UNPACK_ALIGNMENT,1),B.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&B.pixelStorei(B.UNPACK_ALIGNMENT,1),B.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:d=!0,B.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case bB.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:d=!0,B.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}B.pixelStorei(37441,!1),l&&o&&DB.bindTexture(B,l,o),this.uri||(this.uri=this._url),d?this.memorySize=this._image.length:G&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},g.recreateResource=function(){var B=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var g=this;this._image=new p.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(g._needReleaseAgain)return g._needReleaseAgain=!1,g._image.onload=null,void(g._image=null);g._allowMerageInAtlas&&g._enableMerageInAtlas?(B.memorySize=0,B._recreateLock=!1):g._createWebGlTexture(),g.completeCreate()},this._image.src=this._src}},g.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&bB.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},g.onresize=function(){this._w=this._image.width,this._h=this._image.height,r.enabled&&this._w<r.atlasLimitWidth&&this._h<r.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},g.clearAtlasSource=function(){this._image=null},o(0,g,"format",function(){return this._format}),o(0,g,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(B){this._$5__enableMerageInAtlas=B}),o(0,g,"mipmap",function(){return this._mipmap}),o(0,g,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),o(0,g,"atlasSource",function(){return this._image}),o(0,g,"onload",null,function(B){var g=this;this._onload=B,this._image&&(this._image.onload=null!=this._onload?function(){g.onresize(),g._onload()}:null)}),o(0,g,"onerror",null,function(B){var g=this;this._onerror=B,this._image&&(this._image.onerror=null!=this._onerror?function(){g._onerror()}:null)}),G}();v.__init([pB,c,sB,MB])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(B,g){"use strict";for(var l in Object.defineProperty(g,"__esModule",{value:!0}),Laya){var o=Laya[l];o&&o.__isclass&&(g[l]=o)}}),function(U,B,o){o.un,o.uns;var V=o.static,y=o.class,G=o.getset,d=(o.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),x=laya.utils.ClassUtils,H=(laya.events.Event,laya.utils.HTMLChar),j=laya.net.Loader,A=(laya.display.Node,laya.maths.Rectangle),K=laya.renders.Render,p=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),N=laya.utils.Stat,Q=laya.display.Text,F=laya.resource.Texture,C=laya.net.URL,m=laya.utils.Utils,M=function(){function p(){}return y(p,"laya.html.utils.HTMLParse"),p.parse=function(B,g,l){g=(g="<root>"+(g=g.replace(/<br>/g,"<br/>"))+"</root>").replace(p.spacePattern,p.char255);var o=m.parseXMLFromString(g);p._parseXML(B,o.childNodes[0].childNodes,l)},p._parseXML=function(B,g,l,o){var V=0,U=0;if(g.join||g.item)for(V=0,U=g.length;V<U;++V)p._parseXML(B,g[V],l,o);else{var y,G,d;if(3==g.nodeType)return void(B instanceof laya.html.dom.HTMLDivElement?(null==g.nodeName&&(g.nodeName="#text"),G=g.nodeName.toLowerCase(),0<(d=g.textContent.replace(/^\s+|\s+$/g,"")).length&&(y=x.getInstance(G))&&(B.addChild(y),y.innerTEXT=d.replace(p.char255AndOneSpacePattern," "))):0<(d=g.textContent.replace(/^\s+|\s+$/g,"")).length&&(B.innerTEXT=d.replace(p.char255AndOneSpacePattern," ")));if("#comment"==(G=g.nodeName.toLowerCase()))return;if(y=x.getInstance(G)){(y=B.addChild(y)).URI=l,y.href=o;var j=g.attributes;if(j&&0<j.length)for(V=0,U=j.length;V<U;++V){var A=j[V],H=A.nodeName,K=A.value;y._setAttributes(H,K)}p._parseXML(y,g.childNodes,l,y.href)}else p._parseXML(B,g.childNodes,l,o)}},p.char255=String.fromCharCode(255),p.spacePattern=/&nbsp;|&#160;/g,p.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),p}(),b=function(){function e(){}return y(e,"laya.html.utils.Layout"),e.later=function(B){null==e._will&&(e._will=[],o.stage.frameLoop(1,null,function(){if(!(e._will.length<1)){for(var B=0;B<e._will.length;B++)laya.html.utils.Layout.layout(e._will[B]);e._will.length=0}})),e._will.push(B)},e.layout=function(B){if(!B||!B._style)return null;if(0==(512&B._style._type))return null;B.getStyle()._type&=-513;var g=e._multiLineLayout(B);return K.isConchApp&&B.layaoutCallNative&&B.layaoutCallNative(),g},e._multiLineLayout=function(B){if(Q.RightToLeft)return e._multiLineLayout2(B);var g=new Array;B._addChildsToLayout(g);var l,o,V,U,y,G=0,d=g.length,j=B._getCSSStyle(),A=j.letterSpacing,H=j.leading,K=j.lineHeight,p=j._widthAuto()||!j.wordWrap,x=p?999999:B.width,N=(B.height,0),F=j.italic?j.fontSize/3:0,C=j._getAlign(),m=j._getValign(),M=0!==m||0!==C||0!=K,b=0,D=0,v=0,s=0,X=new Array,w=X[0]=new _,i=!1,a=!1;w.h=0,j.italic&&(x-=j.fontSize/3);var z=0,t=!0;function h(){w.y=D,D+=w.h+H,0==w.h&&(D+=K),w.mWidth=z,z=0,w=new _,X.push(w),w.h=0,i=!(t=!(b=0))}for(G=0;G<d;G++)if(null!=(l=g[G]))if(t=!1,l instanceof laya.html.dom.HTMLBrElement)h(),w.y=D;else{if(l._isChar()){if((U=l).isWord)i=a||"\n"===U.char,w.wordStartIndex=w.elements.length;else{if(v=U.width+U.style.letterSpacin,0<X.length&&x<b+v&&0<w.wordStartIndex){var f;f=w.elements.length-w.wordStartIndex+1,w.elements.length=w.wordStartIndex,G-=f,h();continue}i=!1,z+=U.width}v=U.width+A,s=U.height,a=!1,(i=i||x<b+v)&&h(),w.minTextHeight=Math.min(w.minTextHeight,l.height)}else o=l._getCSSStyle(),y=l,V=o.padding,0===o._getCssFloat()||(M=!0),i=a||o.lineElement,v=y.width*y._style._tf.scaleX+V[1]+V[3]+A,s=y.height*y._style._tf.scaleY+V[0]+V[2],a=o.lineElement,(i=i||x<b+v&&o.wordWrap)&&h();w.elements.push(l),w.h=Math.max(w.h,s),l.x=b,l.y=D,b+=v,w.w=b-A,w.y=D,N=Math.max(b+F,N)}else t||(b+=e.DIV_ELEMENT_PADDING),w.wordStartIndex=w.elements.length;if(D=w.y+w.h,M){var S=0,E=x;for(p&&0<B.width&&(E=B.width),G=0,d=X.length;G<d;G++)X[G].updatePos(0,E,G,S,C,m,K),S+=Math.max(K,X[G].h+H);D=S}return p&&(B.width=N),D>B.height&&(B.height=D),[N,D]},e._multiLineLayout2=function(B){var g=new Array;B._addChildsToLayout(g);var l,o,V,U,y,G=0,d=g.length,j=B._getCSSStyle(),A=j.letterSpacing,H=j.leading,K=j.lineHeight,p=j._widthAuto()||!j.wordWrap,x=p?999999:B.width,N=(B.height,0),F=j.italic?j.fontSize/3:0,C=2-j._getAlign(),m=j._getValign(),M=0!==m||0!=C||0!=K,b=0,D=0,v=0,s=0,X=new Array,w=X[0]=new _,i=!1,a=!1;w.h=0,j.italic&&(x-=j.fontSize/3);var z=0,t=!0;function h(){w.y=D,D+=w.h+H,0==w.h&&(D+=K),w.mWidth=z,z=0,w=new _,X.push(w),w.h=0,i=!(t=!(b=0))}for(G=0;G<d;G++)if(null!=(l=g[G]))if(t=!1,l instanceof laya.html.dom.HTMLBrElement)h(),w.y=D;else{if(l._isChar()){if((U=l).isWord)i=a||"\n"===U.char,w.wordStartIndex=w.elements.length;else{if(0<X.length&&x<b+v&&0<w.wordStartIndex){var f;f=w.elements.length-w.wordStartIndex+1,w.elements.length=w.wordStartIndex,G-=f,h();continue}i=!1,z+=U.width}v=U.width+A,s=U.height,a=!1,(i=i||x<b+v)&&h(),w.minTextHeight=Math.min(w.minTextHeight,l.height)}else o=l._getCSSStyle(),y=l,V=o.padding,0===o._getCssFloat()||(M=!0),i=a||o.lineElement,v=y.width*y._style._tf.scaleX+V[1]+V[3]+A,s=y.height*y._style._tf.scaleY+V[0]+V[2],a=o.lineElement,(i=i||x<b+v&&o.wordWrap)&&h();w.elements.push(l),w.h=Math.max(w.h,s),l.x=b,l.y=D,b+=v,w.w=b-A,w.y=D,N=Math.max(b+F,N)}else t||(b+=e.DIV_ELEMENT_PADDING),w.wordStartIndex=w.elements.length;if(D=w.y+w.h,M){var S=0,E=x;for(G=0,d=X.length;G<d;G++)X[G].updatePos(0,E,G,S,C,m,K),S+=Math.max(K,X[G].h+H);D=S}for(p&&(B.width=N),D>B.height&&(B.height=D),G=0,d=X.length;G<d;G++)X[G].revertOrder(x);return[N,D]},e._will=null,e.DIV_ELEMENT_PADDING=0,e}(),_=function(){function B(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}y(B,"laya.html.utils.LayoutLine");var g=B.prototype;return g.updatePos=function(B,g,l,o,V,U,y){var G,d=0;0<this.elements.length&&(d=(G=this.elements[this.elements.length-1]).x+G.width-this.elements[0].x);var j=0,A=NaN;1===V&&(j=(g-d)/2),2===V&&(j=g-d),0===y||0!=U||(U=1);for(var H=0,K=this.elements.length;H<K;H++){var p=(G=this.elements[H])._getCSSStyle();switch(0!==j&&(G.x+=j),p._getValign()){case 0:G.y=o;break;case 1:var x=0;99999!=this.minTextHeight&&(x=this.minTextHeight);var N=(x+y)/2;N=Math.max(N,this.h),A=(laya.html.dom.HTMLImageElement,o+N-G.height),G.y=A;break;case 2:G.y=o+(y-G.height)}}},g.revertOrder=function(B){var g;if(0<this.elements.length){var l,o=0;for(l=this.elements.length,o=0;o<l;o++)(g=this.elements[o]).x=B-g.x-g.width}},B}(),D=function(l){function g(){this.URI=null,this._href=null,g.__super.call(this),this._text=g._EMPTYTEXT,this.setStyle(new d(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}y(g,"laya.html.dom.HTMLElement",l);var B=g.prototype;return B.layaoutCallNative=function(){var B=0;if(this._childs&&0<(B=this._childs.length))for(var g=0;g<B;g++)this._childs[g].layaoutCallNative&&this._childs[g].layaoutCallNative();var l=this._getWords();l?laya.html.dom.HTMLElement.fillWords(this,l,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},B.appendChild=function(B){return this.addChild(B)},B._getWords2=function(){var B=this._text.text;if(!B||0===B.length)return null;var g,l,o=0,V=0;if(this._text.drawWords)l=this._text.drawWords;else{for(V=(g=B.split(" ")).length-1,l=[],o=0;o<V;o++)l.push(g[o]," ");0<=V&&l.push(g[V]),this._text.drawWords=l}var U,y=this._text.words;if(y&&y.length===l.length)return y;null===y&&(this._text.words=y=[]),y.length=l.length;var G=this.style,d=G.font;for(o=0,V=l.length;o<V;o++){U=m.measureText(l[o],d);var j=y[o]=new H(l[o],U.width,U.height||G.fontSize,G);if(1<j.char.length&&(j.charNum=j.char),this.href){var A=new p;this.addChild(A),j.setSprite(A)}}return y},B._getWords=function(){if(!Q.CharacterCache)return this._getWords2();var B=this._text.text;if(!B||0===B.length)return null;var g,l=this._text.words;if(l&&l.length===B.length)return l;null===l&&(this._text.words=l=[]),l.length=B.length;for(var o=this.style,V=o.font,U=0,y=B.length;U<y;U++)if(g=m.measureText(B.charAt(U),V)){var G=l[U]=new H(B.charAt(U),g.width,g.height||o.fontSize,o);if(this.href){var d=new p;this.addChild(d),G.setSprite(d)}}else console.warn("_getWords size is null"+B.charAt(U),V);return l},B.showLinkSprite=function(){var B=this._text.words;if(B)for(var g,l,o=[],V=0;V<B.length;V++)l=B[V],(g=new p).graphics.drawRect(0,0,l.width,l.height,"#ff0000"),g.width=l.width,g.height=l.height,this.addChild(g),o.push(g)},B._layoutLater=function(){var B=this.style;512&B._type||(B.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&B.block?(b.later(this),B._type|=512):this.parent&&this.parent._layoutLater())},B._setAttributes=function(B,g){switch(B){case"style":return void this.style.cssText(g);case"class":return void(this.className=g)}l.prototype._setAttributes.call(this,B,g)},B.updateHref=function(){if(null!=this._href){var B=this._getWords();if(B)for(var g,l,o=0;o<B.length;o++)(l=(g=B[o]).getSprite())&&(l.size(g.width,g.height),l.on("click",this,this.onLinkHandler))}},B.onLinkHandler=function(B){switch(B.type){case"click":for(var g=this;g;)g.event("link",[this.href]),g=g.parent}},B.formatURL=function(B){return this.URI?C.formatURL(B,this.URI?this.URI.path:null):B},G(0,B,"href",function(){return this._href},function(B){null!=(this._href=B)&&(this._getCSSStyle().underLine=1,this.updateHref())}),G(0,B,"color",null,function(B){this.style.color=B}),G(0,B,"onClick",null,function(B){o._runScript("fn=function(event){"+B+";}"),this.on("click",this,void 0)}),G(0,B,"id",null,function(B){v.document.setElementById(B,this)}),G(0,B,"innerTEXT",function(){return this._text.text},function(B){this.text=B}),G(0,B,"style",function(){return this._style}),G(0,B,"text",function(){return this._text.text},function(B){this._text==g._EMPTYTEXT?this._text={text:B,words:null}:(this._text.text=B,this._text.words&&(this._text.words.length=0)),K.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),G(0,B,"parent",l.prototype._$get_parent,function(B){if(B instanceof laya.html.dom.HTMLElement){var g=B;this.URI||(this.URI=g.URI),this.style.inherit(g.style)}o.superSet(p,this,"parent",B)}),G(0,B,"className",null,function(B){this.style.attrs(v.document.styleSheets["."+B])}),g.fillWords=function(B,g,l,o,V,U,y){B.graphics.clear();for(var G=0,d=g.length;G<d;G++){var j=g[G];B.graphics.fillText(j.char,j.x+l,j.y+o,V,U,"left",y)}},g._EMPTYTEXT={text:null,words:null},g}(p),g=(function(B){function g(){g.__super.call(this),this.style.lineElement=!0,this.style.block=!0}y(g,"laya.html.dom.HTMLBrElement",D)}(),function(B){function g(){this.contextHeight=NaN,this.contextWidth=NaN,g.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}y(g,"laya.html.dom.HTMLDivElement",B);var l=g.prototype;return l.appendHTML=function(B){M.parse(this,B,this.URI),this.layout()},l._addChildsToLayout=function(g){var B=this._getWords();if(null==B&&0==this._childs.length)return!1;B&&B.forEach(function(B){g.push(B)});for(var l=!0,o=0,V=this._childs.length;o<V;o++){var U=this._childs[o];l?l=!1:g.push(null),U._addToLayout(g)}return!0},l._addToLayout=function(B){this.layout()},l.layout=function(){if(this.style){this.style._type|=512;var B=b.layout(this);if(B){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new A);var g=this._$P.mHtmlBounds;g.x=g.y=0,g.width=this.contextWidth=B[0],g.height=this.contextHeight=B[1],this.setBounds(g)}}},G(0,l,"height",function(){return this._height?this._height:this.contextHeight},B.prototype._$set_height),G(0,l,"innerHTML",null,function(B){this.destroyChildren(),this.appendHTML(B)}),G(0,l,"width",function(){return this._width?this._width:this.contextWidth},function(B){var g=!1;g=0===B?B!=this._width:B!=this.width,o.superSet(D,this,"width",B),g&&this.layout()}),g}(D)),v=function(B){function g(){this.all=new Array,this.styleSheets=d.styleSheets,g.__super.call(this)}y(g,"laya.html.dom.HTMLDocument",D);var l=g.prototype;return l.getElementById=function(B){return this.all[B]},l.setElementById=function(B,g){this.all[B]=g},V(g,["document",function(){return this.document=new g}]),g}();(function(B){function g(){this._tex=null,this._url=null,this._renderArgs=[],g.__super.call(this),this.style.block=!0}y(g,"laya.html.dom.HTMLImageElement",D);var l=g.prototype;l._addToLayout=function(B){!this._style.absolute&&B.push(this)},l.render=function(B,g,l){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(N.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,B.ctx.drawTexture2(g,l,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},l.layaoutCallNative=function(){var B=0;if(this._childs&&0<(B=this._childs.length))for(var g=0;g<B;g++)this._childs[g].layaoutCallNative&&this._childs[g].layaoutCallNative()},G(0,l,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(B){this._width!==B&&(this._width=B,this._style.width=B,this.repaint())}),G(0,l,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(B){this._height!==B&&(this._height=B,this._style.height=B,this.repaint())}),l.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),j.clearCache(this,this._url),this._tex=null),D.prototype.destroy.call(this)},l.onloaded=function(){var B=this._style;B&&!B.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),B&&!B.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),K.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},l._loadImageComplete=function(B,g,l){if(!this._destroyed)if(null!=l)if(l instanceof ArrayBuffer){var o=new DataView(l);new laya.webgl.resource.WebGLImage(new Uint8Array(l,8),B,0,!1,o.getUint32(0),o.getUint32(4));this.onloaded()}else if(l instanceof F)j.imgMgrSet[B]=g,U.imgMgrLock(B,j.imgMgrSet[B]),this._url=B,this._tex=l,j.keepCache(this,B),j.cacheRes(B,this._tex),this.onloaded();else{var V=-1!=B.indexOf(".png",B.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(l,B,V,!1,l.width,l.height);this.onloaded()}else this.event("error","Load image failed")},G(0,l,"src",null,function(B){(B=this.formatURL(B),this._url!=B)&&(null!=this._tex&&(j.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=B,(this._tex=j.getRes(B))?(j.keepCache(this,B),this.onloaded()):U.imgMgrLoad(B,this._loadImageComplete.bind(this),2,!1))})})(),function(B){function g(){this.type=null,g.__super.call(this),this.visible=!1}y(g,"laya.html.dom.HTMLLinkElement",B);var l=g.prototype;l._onload=function(B){switch(this.type){case"text/css":d.parseCSS(B,this.URI)}},G(0,l,"href",B.prototype._$get_href,function(B){var g=this;B=this.formatURL(B),this.URI=new C(B);var l=new j;l.once("complete",null,function(B){g._onload(B)}),l.load(B,"text")}),g._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(D),function(B){function g(){g.__super.call(this),this.visible=!1}y(g,"laya.html.dom.HTMLStyleElement",B),G(0,g.prototype,"text",B.prototype._$get_text,function(B){d.parseCSS(B,null)})}(D),function(B){function g(){g.__super.call(this),this._getCSSStyle().valign="middle"}y(g,"laya.html.dom.HTMLIframeElement",B),G(0,g.prototype,"href",B.prototype._$get_href,function(l){var o=this;l=this.formatURL(l);var B=new j;B.once("complete",null,function(B){var g=o.URI;o.URI=new C(l),o.innerHTML=B,!g||(o.URI=g)}),B.load(l,"text")})}(g)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(B,g){"use strict";for(var l in Object.defineProperty(g,"__esModule",{value:!0}),Laya){var o=Laya[l];o&&o.__isclass&&(g[l]=o)}}),function(V,B,N){N.un,N.uns;var o=N.static,U=N.class,y=N.getset,l=(N.__newvec,laya.display.Animation),F=(laya.utils.Browser,laya.utils.ClassUtils),G=laya.filters.ColorFilter,d=laya.utils.Ease,j=laya.events.Event,A=(laya.events.EventDispatcher,laya.display.css.Font),H=laya.display.FrameAnimation,g=laya.display.Graphics,K=laya.utils.Handler,p=laya.display.Input,m=laya.net.Loader,x=(laya.display.Node,laya.maths.Point),C=laya.maths.Rectangle,M=laya.renders.Render,b=laya.display.Sprite,D=laya.display.Text,v=laya.resource.Texture,s=laya.utils.Tween,X=laya.utils.Utils,w=laya.utils.WeakObject;N.interface("laya.ui.IItem"),N.interface("laya.ui.ISelect"),N.interface("laya.ui.IRender"),N.interface("laya.ui.IComponent"),N.interface("laya.ui.IBox","IComponent");var i=function(){function B(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return U(B,"laya.ui.LayoutStyle"),o(B,["EMPTY",function(){return this.EMPTY=new B}]),B}(),a=function(){function B(){}return U(B,"laya.ui.Styles"),B.labelColor="#000000",B.buttonStateNum=3,B.scrollBarMinNum=15,B.scrollBarDelayTime=500,o(B,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),B}(),z=function(){function V(){}return U(V,"laya.ui.UIUtils"),V.fillArray=function(B,g,l){var o=B.concat();if(g)for(var V=g.split(","),U=0,y=Math.min(o.length,V.length);U<y;U++){var G=V[U];o[U]="true"==G||"false"!=G&&G,null!=l&&(o[U]=l(G))}return o},V.toColor=function(B){return X.toHexColor(B)},V.gray=function(B,g){void 0===g&&(g=!0),g?V.addFilter(B,V.grayFilter):V.clearFilter(B,G)},V.addFilter=function(B,g){var l=B.filters||[];l.push(g),B.filters=l},V.clearFilter=function(B,g){var l=B.filters;if(null!=l&&0<l.length){for(var o=l.length-1;-1<o;o--){var V=l[o];N.__typeof(V,g)&&l.splice(o,1)}B.filters=l}},V._getReplaceStr=function(B){return V.escapeSequence[B]},V.adptString=function(B){return B.replace(/\\(\w)/g,V._getReplaceStr)},V.getBindFun=function(B){var g=V._funMap.get(B);if(null==g){var l='"'+B+'"',o="(function(data){if(data==null)return;with(data){try{\nreturn "+(l=l.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";g=N._runScript(o),V._funMap.set(B,g)}return g},o(V,["grayFilter",function(){return this.grayFilter=new G([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new w}]),V}(),t=function(){function B(){}return U(B,"UIConfig"),B.touchScrollEnable=!0,B.mouseWheelEnable=!0,B.showButtons=!0,B.popupBgColor="#000000",B.popupBgAlpha=.5,B.closeDialogOnSide=!0,B}(),h=function(l){function C(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,C.__super.call(this),this._weakKeys=[]}U(C,"laya.ui.AutoBitmap",l);var B=C.prototype;return B.destroy=function(){if(m.clearObject(this,this._weakKey),this._weakKeys){for(var B=0,g=this._weakKeys.length;B<g;++B)m.clearObject(this,this._weakKeys[B]);this._weakKeys=null}l.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},B._setChanged=function(){this._isChanged||(this._isChanged=!0,N.timer.callLater(this,this.changeSource))},B.changeSource=function(){this._isChanged=!1;var B=this._source;if(B&&B.bitmap){var g=this.width,l=this.height,o=this._sizeGrid,V=B.sourceWidth,U=B.sourceHeight;if(!o||V===g&&U===l)this.cleanByTexture(B,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,g,l);else{m.clearObject(this,this._weakKey),B.$_GID||(B.$_GID=X.getGID());var y=B.$_GID+"."+g+"."+l+"."+o.join("."),G=m.findObject(y);if(X.isOKCmdList(G))return this._weakKey=y,m.keepObject(this,this._weakKey),void(this.cmds=G);this.clear();var d,j,A=o[0],H=o[1],K=o[2],p=o[3],x=o[4],N=!1;if(g==V&&(p=H=0),l==U&&(A=K=0),g<p+H){var F=g;N=!0,g=p+H,this.save(),this.clipRect(0,0,F,l)}p&&A&&(d=C.getTexture(B,0,0,p,A),j=this._weakKeys[0],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[0]=d.weakKey),this.drawTexture(d,0,0,p,A)):(m.clearObject(this,j),this._weakKeys[0]="")),H&&A&&(d=C.getTexture(B,V-H,0,H,A),j=this._weakKeys[1],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[1]=d.weakKey),this.drawTexture(d,g-H,0,H,A)):(m.clearObject(this,j),this._weakKeys[1]="")),p&&K&&(d=C.getTexture(B,0,U-K,p,K),j=this._weakKeys[2],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[2]=d.weakKey),this.drawTexture(d,0,l-K,p,K)):(m.clearObject(this,j),this._weakKeys[2]="")),H&&K&&(d=C.getTexture(B,V-H,U-K,H,K),j=this._weakKeys[3],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[3]=d.weakKey),this.drawTexture(d,g-H,l-K,H,K)):(m.clearObject(this,j),this._weakKeys[3]="")),A&&(d=C.getTexture(B,p,0,V-p-H,A),j=this._weakKeys[4],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[4]=d.weakKey),this.drawBitmap(x,d,p,0,g-p-H,A)):(m.clearObject(this,j),this._weakKeys[4]="")),K&&(d=C.getTexture(B,p,U-K,V-p-H,K),j=this._weakKeys[5],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[5]=d.weakKey),this.drawBitmap(x,d,p,l-K,g-p-H,K)):(m.clearObject(this,j),this._weakKeys[5]="")),p&&(d=C.getTexture(B,0,A,p,U-A-K),j=this._weakKeys[6],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[6]=d.weakKey),this.drawBitmap(x,d,0,A,p,l-A-K)):(m.clearObject(this,j),this._weakKeys[6]="")),H&&(d=C.getTexture(B,V-H,A,H,U-A-K),j=this._weakKeys[7],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[7]=d.weakKey),this.drawBitmap(x,d,g-H,A,H,l-A-K)):(m.clearObject(this,j),this._weakKeys[7]="")),d=C.getTexture(B,p,A,V-p-H,U-A-K),j=this._weakKeys[8],d?(j!=d.weakKey&&(m.clearObject(this,j),m.keepObject(this,d.weakKey),this._weakKeys[8]=d.weakKey),this.drawBitmap(x,d,p,A,g-p-H,l-A-K)):(m.clearObject(this,j),this._weakKeys[8]=""),N&&this.restore(),this.autoCacheCmd&&!M.isConchApp&&(m.saveObject(y,this.cmds,null),this._weakKey=y,m.keepObject(this,this._weakKey))}this._repaint()}},B.drawBitmap=function(B,g,l,o,V,U){void 0===V&&(V=0),void 0===U&&(U=0),V<.1||U<.1||(!B||g.width==V&&g.height==U?this.drawTexture(g,l,o,V,U):this.fillTexture(g,l,o,V,U))},B.clear=function(B){void 0===B&&(B=!0),l.prototype.clear.call(this,!1)},y(0,B,"sizeGrid",function(){return this._sizeGrid},function(B){this._sizeGrid=B,this._setChanged()}),y(0,B,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(B){this._width!=B&&(this._width=B,this._setChanged())}),y(0,B,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(B){this._height!=B&&(this._height=B,this._setChanged())}),y(0,B,"source",function(){return this._source},function(B){B?(this._source=B,this._setChanged()):(this._source=null,this.clear())}),C.getTexture=function(B,g,l,o,V){o<=0&&(o=1),V<=0&&(V=1),B.$_GID||(B.$_GID=X.getGID());var U=B.$_GID+"."+g+"."+l+"."+o+"."+V,y=m.findObject(U);if((!y||!y.source)&&(y=v.createFromTexture(B,g,l,o,V))){if(B.alphaTexture){var G=B.width/B.alphaTexture.width;y.alphaTexture=v.createFromTexture(B.alphaTexture,g/G,l/G,o/G,V/G)}m.saveObject(U,y),y.weakKey=U}return y},C}(g),f=(function(B){function g(){g.__super.call(this)}U(g,"laya.ui.UIEvent",j),g.SHOW_TIP="showtip",g.HIDE_TIP="hidetip"}(),function(g){function B(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,B.__super.call(this),this._layout=i.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}U(B,"laya.ui.Component",g);var l=B.prototype;return N.imps(l,{"laya.ui.IComponent":!0}),l.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},l.preinitialize=function(){},l.createChildren=function(){},l.initialize=function(){},l.callLater=function(B,g){N.timer.callLater(this,B,g)},l.runCallLater=function(B){N.timer.runCallLater(this,B)},l.commitMeasure=function(){},l.changeSize=function(){this.event("resize")},l.getLayout=function(){return this._layout===i.EMPTY&&(this._layout=new i),this._layout},l._setLayoutEnabled=function(B){this._layout&&this._layout.enable!=B&&(this._layout.enable=B,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},l.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},l.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},l.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},l.resetLayoutX=function(){var B=this._layout;if(isNaN(B.anchorX)||(this.pivotX=B.anchorX*this.width),this.layoutEnabled){var g=this.parent;g&&(isNaN(B.centerX)?isNaN(B.left)?isNaN(B.right)||(this.x=Math.round(g.width-this.displayWidth-B.right+this.pivotX*this.scaleX)):(this.x=Math.round(B.left+this.pivotX*this.scaleX),isNaN(B.right)||(this.width=(g._width-B.left-B.right)/(this.scaleX||.01))):this.x=Math.round(.5*(g.width-this.displayWidth)+B.centerX+this.pivotX*this.scaleX))}},l.resetLayoutY=function(){var B=this._layout;if(isNaN(B.anchorY)||(this.pivotY=B.anchorY*this.height),this.layoutEnabled){var g=this.parent;g&&(isNaN(B.centerY)?isNaN(B.top)?isNaN(B.bottom)||(this.y=Math.round(g.height-this.displayHeight-B.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(B.top+this.pivotY*this.scaleY),isNaN(B.bottom)||(this.height=(g._height-B.top-B.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(g.height-this.displayHeight)+B.centerY+this.pivotY*this.scaleY))}},l.onMouseOver=function(B){N.stage.event("showtip",this._toolTip)},l.onMouseOut=function(B){N.stage.event("hidetip",this._toolTip)},y(0,l,"displayWidth",function(){return this.width*this.scaleX}),y(0,l,"width",function(){return this._width?this._width:this.measureWidth},function(B){this._width!=B&&(this._width=B,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),y(0,l,"measureWidth",function(){var B=0;this.commitMeasure();for(var g=this.numChildren-1;-1<g;g--){var l=this.getChildAt(g);l.visible&&(B=Math.max(l.x+l.width*l.scaleX,B))}return B}),y(0,l,"displayHeight",function(){return this.height*this.scaleY}),y(0,l,"height",function(){return this._height?this._height:this.measureHeight},function(B){this._height!=B&&(this._height=B,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),y(0,l,"dataSource",function(){return this._dataSource},function(B){for(var g in this._dataSource=B,this._dataSource)this.hasOwnProperty(g)&&"function"!=typeof this[g]&&(this[g]=this._dataSource[g])}),y(0,l,"scaleY",g.prototype._$get_scaleY,function(B){N.superGet(b,this,"scaleY")!=B&&(N.superSet(b,this,"scaleY",B),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),y(0,l,"measureHeight",function(){var B=0;this.commitMeasure();for(var g=this.numChildren-1;-1<g;g--){var l=this.getChildAt(g);l.visible&&(B=Math.max(l.y+l.height*l.scaleY,B))}return B}),y(0,l,"scaleX",g.prototype._$get_scaleX,function(B){N.superGet(b,this,"scaleX")!=B&&(N.superSet(b,this,"scaleX",B),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),y(0,l,"top",function(){return this._layout.top},function(B){B!=this._layout.top&&(this.getLayout().top=B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),y(0,l,"bottom",function(){return this._layout.bottom},function(B){B!=this._layout.bottom&&(this.getLayout().bottom=B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),y(0,l,"left",function(){return this._layout.left},function(B){B!=this._layout.left&&(this.getLayout().left=B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),y(0,l,"right",function(){return this._layout.right},function(B){B!=this._layout.right&&(this.getLayout().right=B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),y(0,l,"centerX",function(){return this._layout.centerX},function(B){B!=this._layout.centerX&&(this.getLayout().centerX=B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),y(0,l,"centerY",function(){return this._layout.centerY},function(B){B!=this._layout.centerY&&(this.getLayout().centerY=B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),y(0,l,"anchorX",function(){return this._layout.anchorX},function(B){B!=this._layout.anchorX&&(this.getLayout().anchorX=B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),y(0,l,"anchorY",function(){return this._layout.anchorY},function(B){B!=this._layout.anchorY&&(this.getLayout().anchorY=B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),y(0,l,"tag",function(){return this._tag},function(B){this._tag=B}),y(0,l,"toolTip",function(){return this._toolTip},function(B){this._toolTip!=B&&(null!=(this._toolTip=B)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),y(0,l,"comXml",function(){return this._comXml},function(B){this._comXml=B}),y(0,l,"gray",function(){return this._gray},function(B){B!==this._gray&&(this._gray=B,z.gray(this,B))}),y(0,l,"disabled",function(){return this._disabled},function(B){B!==this._disabled&&(this.gray=this._disabled=B,this.mouseEnabled=!B)}),B}(b)),S=function(B){function g(){this.lockLayer=null,this.popupEffect=function(B){B.scale(1,1),s.from(B,{x:N.stage.width/2,y:N.stage.height/2,scaleX:0,scaleY:0},300,d.backOut,K.create(this,this.doOpen,[B]))},this.closeEffect=function(B,g){s.to(B,{x:N.stage.width/2,y:N.stage.height/2,scaleX:0,scaleY:0},300,d.strongOut,K.create(this,this.doClose,[B,g]))},g.__super.call(this),this.maskLayer=new b,this.popupEffectHandler=K.create(this,this.popupEffect,null,!1),this.closeEffectHandler=K.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,N.stage.addChild(this),N.stage.on("resize",this,this._onResize),t.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}U(g,"laya.ui.DialogManager",b);var l=g.prototype;return l._closeOnSide=function(){var B=this.getChildAt(this.numChildren-1);B instanceof laya.ui.Dialog&&B.close("side")},l.setLockView=function(B){this.lockLayer||(this.lockLayer=new E,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(N.stage.width,N.stage.height)),this.lockLayer.removeChildren(),B&&(B.centerX=B.centerY=0,this.lockLayer.addChild(B))},l._onResize=function(B){var g=this.maskLayer.width=N.stage.width,l=this.maskLayer.height=N.stage.height;this.lockLayer&&this.lockLayer.size(g,l),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,g,l,t.popupBgColor),this.maskLayer.alpha=t.popupBgAlpha;for(var o=this.numChildren-1;-1<o;o--){var V=this.getChildAt(o);V.popupCenter&&this._centerDialog(V)}},l._centerDialog=function(B){B.x=Math.round((N.stage.width-B.width>>1)+B.pivotX),B.y=Math.round((N.stage.height-B.height>>1)+B.pivotY)},l.open=function(B,g,l){void 0===g&&(g=!1),void 0===l&&(l=!1),g&&this._closeAll(),B.popupCenter&&this._centerDialog(B),this.addChild(B),(B.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),l&&null!=B.popupEffect?B.popupEffect.runWith(B):this.doOpen(B),this.event("open")},l.doOpen=function(B){B.onOpened()},l.lock=function(B){this.lockLayer&&(B?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},l.close=function(B,g,l){void 0===l&&(l=!1),l&&null!=B.closeEffect?B.closeEffect.runWith([B,g]):this.doClose(B,g),this.event("close")},l.doClose=function(B,g){B.removeSelf(),B.isModal&&this._checkMask(),B.closeHandler&&B.closeHandler.runWith(g),B.onClosed(g)},l.closeAll=function(){this._closeAll(),this.event("close")},l._closeAll=function(){for(var B=this.numChildren-1;-1<B;B--){var g=this.getChildAt(B);g&&null!=g.close&&this.doClose(g)}},l.getDialogsByGroup=function(B){for(var g=[],l=this.numChildren-1;-1<l;l--){var o=this.getChildAt(l);o&&o.group===B&&g.push(o)}return g},l.closeByGroup=function(B){for(var g=[],l=this.numChildren-1;-1<l;l--){var o=this.getChildAt(l);o&&o.group===B&&(o.close(),g.push(o))}return g},l._checkMask=function(){this.maskLayer.removeSelf();for(var B=this.numChildren-1;-1<B;B--){var g=this.getChildAt(B);if(g&&g.isModal)return void this.addChildAt(this.maskLayer,B)}},g}(),E=function(B){function g(){g.__super.call(this)}U(g,"laya.ui.Box",B);var l=g.prototype;return N.imps(l,{"laya.ui.IBox":!0}),y(0,l,"dataSource",B.prototype._$get_dataSource,function(B){for(var g in this._dataSource=B){var l=this.getChildByName(g);l?l.dataSource=B[g]:this.hasOwnProperty(g)&&"function"!=typeof this[g]&&(this[g]=B[g])}}),g}(f),e=function(g){function l(B,g){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,l.__super.call(this),this._labelColors=a.buttonLabelColors,this._stateNum=a.buttonStateNum,void 0===g&&(g=""),this.skin=B,this.label=g}U(l,"laya.ui.Button",g);var B=l.prototype;return N.imps(B,{"laya.ui.ISelect":!0}),B.destroy=function(B){this.clearEvent(),m.clearCache(this,this._skin),m.clearObject(this,this._weakKey),void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(B),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},B.clearEvent=function(){this._skin&&V.atalsNotify&&V.atalsNotify.off(this._skin,this,this._setBtnSource)},B.createChildren=function(){this.graphics=this._bitmap=new h},B.createText=function(){this._text||(this._text=new D,this._text.overflow=D.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},B.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},B.onMouse=function(B){if(!1!==this.toggle||!this._selected)return"click"===B.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=l.stateMap[B.type]))},B.changeClips=function(){var B=m.getRes(this._skin);if(B)if(this._skin&&""!=this._skin){m.clearObject(this,this._weakKey);var g=B.sourceWidth,l=B.sourceHeight/this._stateNum;B.$_GID||(B.$_GID=X.getGID());var o=B.$_GID+"-"+this._stateNum,V=m.findObject(o);if(X.isOkTextureList(V)||(V=null),V)this._weakKey=o,m.keepObject(this,this._weakKey),this._sources=V;else{if(this._sources=[],1===this._stateNum)this._sources.push(B);else for(var U=0;U<this._stateNum;U++){var y=v.createFromTexture(B,0,l*U,g,l);if(B.alphaTexture){var G=B.width/B.alphaTexture.width;y.alphaTexture=v.createFromTexture(B.alphaTexture,0/G,l*U/G,g/G,l/G)}this._sources.push(y)}m.saveObject(o,this._sources),this._weakKey=o,m.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||g,this._bitmap.height=this._height||l,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=g)}else console.warn("lose skin ",this._skin,this.name,this.__className)},B.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var B=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[B]),this.label&&(this._text.color=this._labelColors[B],this._strokeColors&&(this._text.strokeColor=this._strokeColors[B]))},B._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},y(0,B,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(B){this.createText(),this._text.strokeColor=B}),y(0,B,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),y(0,B,"skin",function(){return this._skin},function(B){if(this._skin!=B)if(this.clearEvent(),m.clearCache(this,this._skin),this._skin=B,m.keepCache(this,this._skin),m.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var g=V.resAtalsObj&&V.resAtalsObj[this._skin];g?(V.atalsNotify&&V.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=g.sourceW),0==this.height&&(this.height=g.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),B._setBtnSource=function(B,g){B===this._skin&&g&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},y(0,B,"state",function(){return this._state},function(B){this._state!=B&&(this._state=B,this._setStateChanged())}),y(0,B,"text",function(){return this.createText(),this._text}),y(0,B,"stateNum",function(){return this._stateNum},function(B){"string"==typeof B&&(B=parseInt(B)),this._stateNum!=B&&(this._stateNum=B<1?1:3<B?3:B,this.callLater(this.changeClips))}),y(0,B,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(B){this._strokeColors=z.fillArray(a.buttonLabelColors,B,String),this._setStateChanged()}),y(0,B,"labelColors",function(){return this._labelColors.join(",")},function(B){this._labelColors=z.fillArray(a.buttonLabelColors,B,String),this._setStateChanged()}),y(0,B,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),y(0,B,"label",function(){return this._text?this._text.text:null},function(B){(this._text||B)&&(this.createText(),this._text.text!=B&&(B&&!this._text.parent&&this.addChild(this._text),this._text.text=(B+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),y(0,B,"selected",function(){return this._selected},function(B){this._selected!=B&&(this._selected=B,this.state=this._selected?2:0,this.event("change"))}),y(0,B,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(B){this.createText(),this._text.padding=z.fillArray(a.labelPadding,B,Number)}),y(0,B,"labelSize",function(){return this.createText(),this._text.fontSize},function(B){this.createText(),this._text.fontSize=B}),y(0,B,"labelStroke",function(){return this.createText(),this._text.stroke},function(B){this.createText(),this._text.stroke=B}),y(0,B,"labelBold",function(){return this.createText(),this._text.bold},function(B){this.createText(),this._text.bold=B}),y(0,B,"labelFont",function(){return this.createText(),this._text.font},function(B){this.createText(),this._text.font=B}),y(0,B,"labelAlign",function(){return this.createText(),this._text.align},function(B){this.createText(),this._text.align=B}),y(0,B,"clickHandler",function(){return this._clickHandler},function(B){this._clickHandler=B}),y(0,B,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(B){this._bitmap.sizeGrid=z.fillArray(a.defaultSizeGrid,B,Number)}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(f,this,"width",B),this._autoSize&&(this._bitmap.width=B,this._text&&(this._text.width=B))}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(f,this,"height",B),this._autoSize&&(this._bitmap.height=B,this._text&&(this._text.height=B))}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)||"string"==typeof B?this.label=B+"":N.superSet(f,this,"dataSource",B)}),y(0,B,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(B){this._bitmap._offset=B?z.fillArray([1,1],B,Number):[]}),o(l,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),l}(f),Q=function(g){function o(B,g,l){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,o.__super.call(this),void 0===g&&(g=1),void 0===l&&(l=1),this._clipX=g,this._clipY=l,this.skin=B}U(o,"laya.ui.Clip",g);var B=o.prototype;return B.destroy=function(B){this.clearEvent(),this.clearLoad(),m.clearCache(this,this._skin),m.clearObject(this,this._weakKey),void 0===B&&(B=!0),g.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},B.dispose=function(){this.destroy(!0),N.loader.clearRes(this._skin)},B.createChildren=function(){this.graphics=this._bitmap=new h},B._onDisplay=function(B){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},B.changeClip=function(){if(this._clipChanged=!1,this._skin){var B=m.getRes(this._skin);if(B)this.loadComplete(this._skin,B);else{if(V.resAtalsObj&&V.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=K.create(this,this.loadComplete,[this._skin]),this._progress=null,N.loader.load(this._skin,this._complete,this._progress)}}},B.loadComplete=function(B,g){if(B===this._skin&&g){m.clearObject(this,this._weakKey);var l=this._clipWidth||Math.ceil(g.sourceWidth/this._clipX),o=this._clipHeight||Math.ceil(g.sourceHeight/this._clipY),V=this._skin+l+o,U=m.findObject(V);if(X.isOkTextureList(U)||(U=null),U)this._weakKey=V,m.keepObject(this,this._weakKey),this._sources=U;else{this._sources=[];for(var y=0;y<this._clipY;y++)for(var G=0;G<this._clipX;G++){var d=v.createFromTexture(g,l*G,o*y,l,o);if(g.alphaTexture){var j=g.width/g.alphaTexture.width;d.alphaTexture=v.createFromTexture(g.alphaTexture,l*G/j,o*y/j,l/j,o/j)}this._sources.push(d)}m.saveObject(V,this._sources),this._weakKey=V,m.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},B.play=function(B,g){void 0===B&&(B=0),void 0===g&&(g=-1),this._isPlaying=!0,this.index=B,this._toIndex=g,this._index++,N.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},B._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},B.stop=function(){this._isPlaying=!1,N.timer.clear(this,this._loop),this.event("complete")},B._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},y(0,B,"interval",function(){return this._interval},function(B){this._interval!=B&&(this._interval=B,this._isPlaying&&this.play())}),B.clearEvent=function(){this._skin&&V.atalsNotify&&V.atalsNotify.off(this._skin,this,this._setBtnSource)},B.clearLoad=function(){this._skin&&((this._complete||this._progress)&&N.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},y(0,B,"skin",function(){return this._skin},function(B){if(this._skin!=B)if(this.clearLoad(),this.clearEvent(),m.clearCache(this,this._skin),this._skin=B){m.keepCache(this,this._skin);var g=m.getRes(B),l=V.resAtalsObj&&V.resAtalsObj[this._skin];!g&&l?V.atalsNotify&&V.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),B._setBtnSource=function(B,g){B===this._skin&&g&&(this.loadComplete(B,g),this.clearEvent())},y(0,B,"sources",function(){return this._sources},function(B){this._sources=B,this.index=this._index,this.event("loaded")}),y(0,B,"clipX",function(){return this._clipX},function(B){this._clipX=B||1,this._setClipChanged()}),y(0,B,"clipY",function(){return this._clipY},function(B){this._clipY=B||1,this._setClipChanged()}),y(0,B,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),y(0,B,"clipWidth",function(){return this._clipWidth},function(B){this._clipWidth=B,this._setClipChanged()}),y(0,B,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(B){this._bitmap.sizeGrid=z.fillArray(a.defaultSizeGrid,B,Number)}),y(0,B,"group",function(){return this._group},function(B){B&&this._skin&&m.setGroup(this._skin,B),this._group=B}),y(0,B,"clipHeight",function(){return this._clipHeight},function(B){this._clipHeight=B,this._setClipChanged()}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(f,this,"width",B),this._bitmap.width=B}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(f,this,"height",B),this._bitmap.height=B}),y(0,B,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),y(0,B,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),y(0,B,"index",function(){return this._index},function(B){this._index=B,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[B]),this.event("change")}),y(0,B,"autoPlay",function(){return this._autoPlay},function(B){this._autoPlay!=B&&((this._autoPlay=B)?this.play():this.stop())}),y(0,B,"isPlaying",function(){return this._isPlaying},function(B){this._isPlaying=B}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)&&Math.floor(B)==B||"string"==typeof B?this.index=parseInt(B):N.superSet(f,this,"dataSource",B)}),y(0,B,"bitmap",function(){return this._bitmap}),o}(f),_=function(g){function B(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,B.__super.call(this)}U(B,"laya.ui.ColorPicker",g);var l=B.prototype;return l.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._colorPanel&&this._colorPanel.destroy(B),this._colorButton&&this._colorButton.destroy(B),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},l.createChildren=function(){this.addChild(this._colorButton=new e),this._colorPanel=new E,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new b),this._colorPanel.addChild(this._colorBlock=new b),this._colorPanel.addChild(this._colorInput=new p)},l.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},l.onPanelMouseDown=function(B){B.stopPropagation()},l.changePanel=function(){this._panelChanged=!1;var B=this._colorPanel.graphics;B.clear(),B.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(B=this._colorTiles.graphics).clear();for(var g=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],l=0;l<12;l++)for(var o=0;o<20;o++){var V=0;V=0===o?g[l]:1===o?0:51*(((3*l+o/6)%3<<0)+3*(l/6<<0))<<16|o%6*51<<8|(l<<0)%6*51;var U=z.toColor(V);this._colors.push(U);var y=o*this._gridSize,G=l*this._gridSize;B.drawRect(y,G,this._gridSize,this._gridSize,U,"#000000")}},l.onColorButtonClick=function(B){this._colorPanel.parent?this.close():this.open()},l.open=function(){var B=this.localToGlobal(new x),g=B.x+this._colorPanel.width<=N.stage.width?B.x:N.stage.width-this._colorPanel.width,l=B.y+this._colorButton.height;l=l+this._colorPanel.height<=N.stage.height?l:B.y-this._colorPanel.height,this._colorPanel.pos(g,l),this._colorPanel.zOrder=1001,N._currentStage.addChild(this._colorPanel),N.stage.on("mousedown",this,this.removeColorBox)},l.close=function(){N.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},l.removeColorBox=function(B){this.close()},l.onColorFieldKeyDown=function(B){13==B.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),B.stopPropagation())},l.onColorInputChange=function(B){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},l.onColorTilesClick=function(B){this.selectedColor=this.getColorByMouse(),this.close()},l.onColorTilesMouseMove=function(B){this._colorInput.focus=!1;var g=this.getColorByMouse();this._colorInput.text=g,this.drawBlock(g)},l.getColorByMouse=function(){var B=this._colorTiles.getMousePoint(),g=Math.floor(B.x/this._gridSize),l=Math.floor(B.y/this._gridSize);return this._colors[20*l+g]},l.drawBlock=function(B){var g=this._colorBlock.graphics;g.clear();var l=B||"#ffffff";g.drawRect(0,0,50,20,l,this._borderColor),B||g.drawLine(0,0,50,20,"#ff0000")},l.changeColor=function(){var B=this.graphics;B.clear();var g=this._selectedColor||"#000000";B.drawRect(0,0,this._colorButton.width,this._colorButton.height,g)},l._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},y(0,l,"inputBgColor",function(){return this._inputBgColor},function(B){this._inputBgColor=B,this._setPanelChanged()}),y(0,l,"selectedColor",function(){return this._selectedColor},function(B){this._selectedColor!=B&&(this._selectedColor=this._colorInput.text=B,this.drawBlock(B),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",j.EMPTY.setTo("change",this,this)))}),y(0,l,"skin",function(){return this._colorButton.skin},function(B){this._colorButton.skin=B,this.changeColor()}),y(0,l,"bgColor",function(){return this._bgColor},function(B){this._bgColor=B,this._setPanelChanged()}),y(0,l,"borderColor",function(){return this._borderColor},function(B){this._borderColor=B,this._setPanelChanged()}),y(0,l,"inputColor",function(){return this._inputColor},function(B){this._inputColor=B,this._setPanelChanged()}),B}(f),P=function(g){function l(B,g){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,l.__super.call(this),this._itemColors=a.comboBoxItemColors,this.skin=B,this.labels=g}U(l,"laya.ui.ComboBox",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._button&&this._button.destroy(B),this._list&&this._list.destroy(B),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},B.createChildren=function(){this.addChild(this._button=new e),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},B._createList=function(){this._list=new I,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},B._setListEvent=function(B){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=K.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},B.onListDown=function(B){B.stopPropagation()},B.onScrollBarDown=function(B){B.stopPropagation()},B.onButtonMouseDown=function(B){this.callLater(this.switchTo,[!this._isOpen])},B.changeList=function(){this._listChanged=!1;var B=this.width-2,g=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:B,height:this._itemHeight,fontSize:this._itemSize,color:g}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},B.onlistItemMouse=function(B,g){var l=B.type;if("mouseover"===l||"mouseout"===l){if(this._isCustomList)return;var o=this._list.getCell(g);if(!o)return;var V=o.getChildByName("label");V&&("mouseover"===l?(V.bgColor=this._itemColors[0],V.color=this._itemColors[1]):(V.bgColor=null,V.color=this._itemColors[2]))}else"click"===l&&(this.selectedIndex=g,this.isOpen=!1)},B.switchTo=function(B){this.isOpen=B},B.changeOpen=function(){this.isOpen=!this._isOpen},B.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var B=this._list.graphics;B.clear(),B.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var g=this._list.array||[],l=g.length=0,o=this._labels.length;l<o;l++)g.push({label:this._labels[l]});this._list.height=this._listHeight,this._list.array=g},B.changeSelected=function(){this._button.label=this.selectedLabel},B._onStageMouseWheel=function(B){this._list&&!this._list.contains(B.target)&&this.removeList(null)},B.removeList=function(B){N.stage.off("mousedown",this,this.removeList),N.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},y(0,B,"selectedIndex",function(){return this._selectedIndex},function(B){this._selectedIndex!=B&&(this._selectedIndex=B,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[j.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),y(0,B,"measureHeight",function(){return this._button.height}),y(0,B,"skin",function(){return this._button.skin},function(B){this._button.skin!=B&&(this._button.skin=B,this._listChanged=!0)}),y(0,B,"measureWidth",function(){return this._button.width}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(f,this,"width",B),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),y(0,B,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(B){this.selectedIndex=this._labels.indexOf(B)}),y(0,B,"labels",function(){return this._labels.join(",")},function(B){0<this._labels.length&&(this.selectedIndex=-1),B?this._labels=B.split(","):this._labels.length=0,this._itemChanged=!0}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(f,this,"height",B),this._button.height=this._height}),y(0,B,"selectHandler",function(){return this._selectHandler},function(B){this._selectHandler=B}),y(0,B,"visibleNum",function(){return this._visibleNum},function(B){this._visibleNum=B,this._listChanged=!0}),y(0,B,"labelBold",function(){return this._button.text.bold},function(B){this._button.text.bold=B}),y(0,B,"itemColors",function(){return String(this._itemColors)},function(B){this._itemColors=z.fillArray(this._itemColors,B,String),this._listChanged=!0}),y(0,B,"itemSize",function(){return this._itemSize},function(B){this._itemSize=B,this._listChanged=!0}),y(0,B,"scrollBar",function(){return this.list.scrollBar}),y(0,B,"isOpen",function(){return this._isOpen},function(B){if(this._isOpen!=B)if(this._isOpen=B,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var g=this.localToGlobal(x.TEMP.setTo(0,0)),l=g.y+this._button.height;l=l+this._listHeight<=N.stage.height?l:g.y-this._listHeight,this._list.pos(g.x,l),this._list.zOrder=1001,N._currentStage.addChild(this._list),N.stage.once("mousedown",this,this.removeList),N.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),y(0,B,"scrollBarSkin",function(){return this._scrollBarSkin},function(B){this._scrollBarSkin=B}),y(0,B,"sizeGrid",function(){return this._button.sizeGrid},function(B){this._button.sizeGrid=B}),y(0,B,"button",function(){return this._button}),y(0,B,"list",function(){return this._list||this._createList(),this._list},function(B){B&&(B.removeSelf(),this._isCustomList=!0,this._list=B,this._setListEvent(B),this._itemHeight=B.getCell(0).height+B.spaceY)}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)&&Math.floor(B)==B||"string"==typeof B?this.selectedIndex=parseInt(B):B instanceof Array?this.labels=B.join(","):N.superSet(f,this,"dataSource",B)}),y(0,B,"labelColors",function(){return this._button.labelColors},function(B){this._button.labelColors!=B&&(this._button.labelColors=B)}),y(0,B,"labelPadding",function(){return this._button.text.padding.join(",")},function(B){this._button.text.padding=z.fillArray(a.labelPadding,B,Number)}),y(0,B,"labelSize",function(){return this._button.text.fontSize},function(B){this._button.text.fontSize=B}),y(0,B,"labelFont",function(){return this._button.text.font},function(B){this._button.text.font=B}),y(0,B,"stateNum",function(){return this._button.stateNum},function(B){this._button.stateNum=B}),l}(f),Y=function(g){function l(B){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,l.__super.call(this),this._showButtons=t.showButtons,this._touchScrollEnable=t.touchScrollEnable,this._mouseWheelEnable=t.mouseWheelEnable,this.skin=B,this.max=1}U(l,"laya.ui.ScrollBar",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),this.stopScroll(),this.target=null,g.prototype.destroy.call(this,B),this.upButton&&this.upButton.destroy(B),this.downButton&&this.downButton.destroy(B),this.slider&&this.slider.destroy(B),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},B.createChildren=function(){this.addChild(this.slider=new c),this.addChild(this.upButton=new e),this.addChild(this.downButton=new e)},B.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},B.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},B.onButtonMouseDown=function(B){var g=B.currentTarget===this.upButton;this.slide(g),N.timer.once(a.scrollBarDelayTime,this,this.startLoop,[g]),N.stage.once("mouseup",this,this.onStageMouseUp)},B.startLoop=function(B){N.timer.frameLoop(1,this,this.slide,[B])},B.slide=function(B){B?this.value-=this._scrollSize:this.value+=this._scrollSize},B.onStageMouseUp=function(B){N.timer.clear(this,this.startLoop),N.timer.clear(this,this.slide)},B.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},B.changeSize=function(){g.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},B.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},B.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},B.setScroll=function(B,g,l){this.runCallLater(this.changeSize),this.slider.setSlider(B,g,l),this.slider.bar.visible=0<g,!this._hide&&this.autoHide&&(this.visible=!1)},B.onTargetMouseWheel=function(B){this.value-=B.delta*this._scrollSize,this.target=this._target},B.onTargetMouseDown=function(B){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new x),this._lastPoint.setTo(N.stage.mouseX,N.stage.mouseY),N.timer.clear(this,this.tweenMove),s.clearTween(this),N.stage.once("mouseup",this,this.onStageMouseUp2),N.stage.once("mouseout",this,this.onStageMouseUp2),N.timer.frameLoop(1,this,this.loop)},B.loop=function(){var B=N.stage.mouseY,g=N.stage.mouseX;if(this._lastOffset=this.isVertical?B-this._lastPoint.y:g-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?N.stage._canvasTransform.getScaleY():N.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=g,this._lastPoint.y=B,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},B.onStageMouseUp2=function(B){if(N.stage.off("mouseup",this,this.onStageMouseUp2),N.stage.off("mouseout",this,this.onStageMouseUp2),N.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?s.to(this,{value:this.min},this.elasticBackTime,d.sineOut,K.create(this,this.elasticOver)):this._value>this.max&&s.to(this,{value:this.max},this.elasticBackTime,d.sineOut,K.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?N.stage.mouseY-this._lastPoint.y:N.stage.mouseX-this._lastPoint.x);for(var g=0,l=Math.min(this._offsets.length,3),o=0;o<l;o++)g+=this._offsets[this._offsets.length-1-o];if(this._lastOffset=g/l,(g=Math.abs(this._lastOffset))<2)return void this.event("end");60<g&&(this._lastOffset=0<this._lastOffset?60:-60);var V=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));N.timer.frameLoop(1,this,this.tweenMove,[V])}},B.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&s.to(this,{alpha:0},500),this.event("end")},B.tweenMove=function(B){this._lastOffset*=this.rollRatio;var g=NaN;if(0<B&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,g=.5*-(this.min-B-this.value),this._lastOffset>g&&(this._lastOffset=g)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,g=.5*-(this.max+B-this.value),this._lastOffset<g&&(this._lastOffset=g))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(N.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?s.to(this,{value:this.min},this.elasticBackTime,d.sineOut,K.create(this,this.elasticOver)):this._value>this.max?s.to(this,{value:this.max},this.elasticBackTime,d.sineOut,K.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&s.to(this,{alpha:0},500)}},B.stopScroll=function(){this.onStageMouseUp2(null),N.timer.clear(this,this.tweenMove),s.clearTween(this)},y(0,B,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),y(0,B,"skin",function(){return this._skin},function(B){this._skin!=B&&(this._skin=B,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),y(0,B,"max",function(){return this.slider.max},function(B){this.slider.max=B}),y(0,B,"showButtons",function(){return this._showButtons},function(B){this._showButtons=B,this.callLater(this.changeScrollBar)}),y(0,B,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),y(0,B,"min",function(){return this.slider.min},function(B){this.slider.min=B}),y(0,B,"value",function(){return this._value},function(B){B!==this._value&&(this._value=B,this._isElastic||(this.slider._value!=B&&(this.slider._value=B,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),y(0,B,"isVertical",function(){return this.slider.isVertical},function(B){this.slider.isVertical=B}),y(0,B,"sizeGrid",function(){return this.slider.sizeGrid},function(B){this.slider.sizeGrid=B}),y(0,B,"scrollSize",function(){return this._scrollSize},function(B){this._scrollSize=B}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)||"string"==typeof B?this.value=Number(B):N.superSet(f,this,"dataSource",B)}),y(0,B,"thumbPercent",function(){return this._thumbPercent},function(B){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),B=1<=B?.99:B,this._thumbPercent=B,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*B,a.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*B,a.scrollBarMinNum))}),y(0,B,"target",function(){return this._target},function(B){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=B)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),y(0,B,"hide",function(){return this._hide},function(B){this._hide=B,this.visible=!B}),y(0,B,"touchScrollEnable",function(){return this._touchScrollEnable},function(B){this._touchScrollEnable=B,this.target=this._target}),y(0,B,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(B){this._mouseWheelEnable=B,this.target=this._target}),y(0,B,"tick",function(){return this.slider.tick},function(B){this.slider.tick=B}),l}(f),c=function(g){function l(B){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,l.__super.call(this),this.skin=B}U(l,"laya.ui.Slider",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._bg&&this._bg.destroy(B),this._bar&&this._bar.destroy(B),this._progress&&this._progress.destroy(B),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},B.createChildren=function(){this.addChild(this._bg=new r),this.addChild(this._bar=new e)},B.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},B.onBarMouseDown=function(B){this._globalSacle||(this._globalSacle=new x),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=N.stage.mouseX,this._ty=N.stage.mouseY,N.stage.on("mousemove",this,this.mouseMove),N.stage.once("mouseup",this,this.mouseUp),N.stage.once("mouseout",this,this.mouseUp),this.showValueText()},B.showValueText=function(){if(this.showLabel){var B=laya.ui.Slider.label;this.addChild(B),B.textField.changeText(this._value+""),this.isVertical?(B.x=this._bar.x+20,B.y=.5*(this._bar.height-B.height)+this._bar.y):(B.y=this._bar.y-20,B.x=.5*(this._bar.width-B.width)+this._bar.x)}},B.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},B.mouseUp=function(B){N.stage.off("mousemove",this,this.mouseMove),N.stage.off("mouseup",this,this.mouseUp),N.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},B.mouseMove=function(B){var g=this._value;this.isVertical?(this._bar.y+=(N.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(N.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=N.stage.mouseX,this._ty=N.stage.mouseY;var l=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*l)/l,this._value!=g&&this.sendChangeEvent(),this.showValueText()},B.sendChangeEvent=function(B){void 0===B&&(B="change"),this.event(B),this.changeHandler&&this.changeHandler.runWith(this._value)},B.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},B.changeSize=function(){g.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},B.setSlider=function(B,g,l){this._value=-1,this._min=B,this._max=B<g?g:B,this.value=l<B?B:g<l?g:l},B.changeValue=function(){var B=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*B)/B,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var g=this._max-this._min;0===g&&(g=1),this.isVertical?(this._bar.y=(this._value-this._min)/g*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/g*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},B.onBgMouseDown=function(B){var g=this._bg.getMousePoint();this.isVertical?this.value=g.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=g.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},y(0,B,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),y(0,B,"skin",function(){return this._skin},function(B){if(this._skin!=B){this._skin=B,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var g=this._skin.replace(".png","$progress.png");m.getRes(g)&&(this._progress||(this.addChild(this._progress=new r),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=g),this.setBarPoint(),this.callLater(this.changeValue)}}),y(0,B,"allowClickBack",function(){return this._allowClickBack},function(B){this._allowClickBack!=B&&((this._allowClickBack=B)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),y(0,B,"max",function(){return this._max},function(B){this._max!=B&&(this._max=B,this.callLater(this.changeValue))}),y(0,B,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),y(0,B,"tick",function(){return this._tick},function(B){this._tick!=B&&(this._tick=B,this.callLater(this.changeValue))}),y(0,B,"sizeGrid",function(){return this._bg.sizeGrid},function(B){this._bg.sizeGrid=B,this._bar.sizeGrid=B,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),y(0,B,"min",function(){return this._min},function(B){this._min!=B&&(this._min=B,this.callLater(this.changeValue))}),y(0,B,"value",function(){return this._value},function(B){if(this._value!=B){var g=this._value;this._value=B,this.changeValue(),this._value!=g&&this.sendChangeEvent()}}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)||"string"==typeof B?this.value=Number(B):N.superSet(f,this,"dataSource",B)}),y(0,B,"bar",function(){return this._bar}),o(l,["label",function(){return this.label=new Z}]),l}(f),r=function(g){function l(B){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,l.__super.call(this),this.skin=B}U(l,"laya.ui.Image",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,m.clearCache(this,this._skin)},B.dispose=function(){this.destroy(!0),m.clearCache(this,this._skin),this.clearEvent()},B.createChildren=function(){this.graphics=this._bitmap=new h},B.setSource=function(B,g){this.destroyed||B===this._skin&&g&&(this.source=g,this.onCompResize(),this.clearEvent())},B.clearEvent=function(){this._skin&&V.atalsNotify&&V.atalsNotify.off(this._skin,this,this.setSource)},B.clearLoad=function(){this._skin&&((this._complete||this._progress)&&N.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},y(0,B,"source",function(){return this._bitmap.source},function(B){this._bitmap&&(this._bitmap.source=B,this.event("loaded"),this.repaint())}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"string"==typeof(this._dataSource=B)?this.skin=B:N.superSet(f,this,"dataSource",B)}),y(0,B,"measureHeight",function(){return this._bitmap.height}),y(0,B,"skin",function(){return this._skin},function(B){if(this._skin!=B)if(m.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=B){m.keepCache(this,this._skin);var g=m.getRes(B),l=V.resAtalsObj&&V.resAtalsObj[this._skin];g?(this.source=g,this.onCompResize()):l?(V.atalsNotify&&V.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=l.sourceW),0==this.height&&(this.height=l.sourceH)):(this._complete=K.create(this,this.setSource,[this._skin]),this._progress=null,N.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),y(0,B,"group",function(){return this._group},function(B){B&&this._skin&&m.setGroup(this._skin,B),this._group=B}),y(0,B,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(B){this._bitmap.sizeGrid=z.fillArray(a.defaultSizeGrid,B,Number)}),y(0,B,"measureWidth",function(){return this._bitmap.width}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(f,this,"width",B),this._bitmap.width=0==B?1e-7:B}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(f,this,"height",B),this._bitmap.height=0==B?1e-7:B}),l}(f),Z=function(g){function l(B){this._tf=null,l.__super.call(this),void 0===B&&(B=""),A.defaultColor=a.labelColor,this.text=B}U(l,"laya.ui.Label",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._tf=null},B.createChildren=function(){this.addChild(this._tf=new D)},B.changeText=function(B){this._tf.changeText(B)},y(0,B,"padding",function(){return this._tf.padding.join(",")},function(B){this._tf.padding=z.fillArray(a.labelPadding,B,Number)}),y(0,B,"bold",function(){return this._tf.bold},function(B){this._tf.bold=B}),y(0,B,"align",function(){return this._tf.align},function(B){this._tf.align=B}),y(0,B,"text",function(){return this._tf.text},function(B){this._tf.text!=B&&(B&&(B=z.adptString(B+"")),this._tf.text=B,this.event("change"),this._width&&this._height||this.onCompResize())}),y(0,B,"italic",function(){return this._tf.italic},function(B){this._tf.italic=B}),y(0,B,"wordWrap",function(){return this._tf.wordWrap},function(B){this._tf.wordWrap=B}),y(0,B,"font",function(){return this._tf.font},function(B){this._tf.font=B}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)||"string"==typeof B?this.text=B+"":N.superSet(f,this,"dataSource",B)}),y(0,B,"color",function(){return this._tf.color},function(B){this._tf.color=B}),y(0,B,"valign",function(){return this._tf.valign},function(B){this._tf.valign=B}),y(0,B,"leading",function(){return this._tf.leading},function(B){this._tf.leading=B}),y(0,B,"fontSize",function(){return this._tf.fontSize},function(B){this._tf.fontSize=B}),y(0,B,"bgColor",function(){return this._tf.bgColor},function(B){this._tf.bgColor=B}),y(0,B,"borderColor",function(){return this._tf.borderColor},function(B){this._tf.borderColor=B}),y(0,B,"stroke",function(){return this._tf.stroke},function(B){this._tf.stroke=B}),y(0,B,"strokeColor",function(){return this._tf.strokeColor},function(B){this._tf.strokeColor=B}),y(0,B,"textField",function(){return this._tf}),y(0,B,"measureWidth",function(){return this._tf.width}),y(0,B,"measureHeight",function(){return this._tf.height}),y(0,B,"width",function(){return this._width||this._tf.text?N.superGet(f,this,"width"):0},function(B){N.superSet(f,this,"width",B),this._tf.width=B}),y(0,B,"height",function(){return this._height||this._tf.text?N.superGet(f,this,"height"):0},function(B){N.superSet(f,this,"height",B),this._tf.height=B}),y(0,B,"overflow",function(){return this._tf.overflow},function(B){this._tf.overflow=B}),y(0,B,"underline",function(){return this._tf.underline},function(B){this._tf.underline=B}),y(0,B,"underlineColor",function(){return this._tf.underlineColor},function(B){this._tf.underlineColor=B}),l}(f),T=function(g){function l(B){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,l.__super.call(this),this.skin=B}U(l,"laya.ui.ProgressBar",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._bg&&this._bg.destroy(B),this._bar&&this._bar.destroy(B),this._bg=this._bar=null,this.changeHandler=null},B.createChildren=function(){this.addChild(this._bg=new r),this.addChild(this._bar=new r)},B.changeValue=function(){if(this.sizeGrid){var B=this.sizeGrid.split(","),g=Number(B[3]),l=Number(B[1]),o=(this.width-g-l)*this._value;this._bar.width=g+l+o,this._bar.visible=this._bar.width>g+l}else this._bar.width=this.width*this._value},y(0,B,"measureHeight",function(){return this._bg.height}),y(0,B,"skin",function(){return this._skin},function(B){this._skin!=B&&(this._skin=B,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),y(0,B,"measureWidth",function(){return this._bg.width}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(f,this,"height",B),this._bg.height=this._height,this._bar.height=this._height}),y(0,B,"bar",function(){return this._bar}),y(0,B,"value",function(){return this._value},function(B){this._value!=B&&(B=1<B?1:B<0?0:B,this._value=B,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(B))}),y(0,B,"bg",function(){return this._bg}),y(0,B,"sizeGrid",function(){return this._bg.sizeGrid},function(B){this._bg.sizeGrid=this._bar.sizeGrid=B}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(f,this,"width",B),this._bg.width=this._width,this.callLater(this.changeValue)}),y(0,B,"dataSource",g.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)||"string"==typeof B?this.value=Number(B):N.superSet(f,this,"dataSource",B)}),l}(f),R=(function(B){function l(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,l.__super.call(this),this._tipBox=new f,this._tipBox.addChild(this._tipText=new D),this._tipText.x=this._tipText.y=5,this._tipText.color=l.tipTextColor,this._defaultTipHandler=this._showDefaultTip,N.stage.on("showtip",this,this._onStageShowTip),N.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}U(l,"laya.ui.TipManager",f);var g=l.prototype;g._onStageHideTip=function(B){N.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},g._onStageShowTip=function(B){N.timer.once(l.tipDelay,this,this._showTip,[B],!0)},g._showTip=function(B){if("string"==typeof B){var g=String(B);Boolean(g)&&this._defaultTipHandler(g)}else B instanceof laya.utils.Handler?B.run():"function"==typeof B&&B.apply();N.stage.on("mousemove",this,this._onStageMouseMove),N.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},g._onStageMouseDown=function(B){this.closeAll()},g._onStageMouseMove=function(B){this._showToStage(this,l.offsetX,l.offsetY)},g._showToStage=function(B,g,l){void 0===g&&(g=0),void 0===l&&(l=0);var o=B.getBounds();B.x=N.stage.mouseX+g,B.y=N.stage.mouseY+l,B.x+o.width>N.stage.width&&(B.x-=o.width+g),B.y+o.height>N.stage.height&&(B.y-=o.height+l)},g.closeAll=function(){N.timer.clear(this,this._showTip),N.stage.off("mousemove",this,this._onStageMouseMove),N.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},g.showDislayTip=function(B){this.addChild(B),this._showToStage(this),N._currentStage.addChild(this)},g._showDefaultTip=function(B){this._tipText.text=B;var g=this._tipBox.graphics;g.clear(),g.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,l.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),N._currentStage.addChild(this)},y(0,g,"defaultTipHandler",function(){return this._defaultTipHandler},function(B){this._defaultTipHandler=B}),l.offsetX=10,l.offsetY=15,l.tipTextColor="#ffffff",l.tipBackColor="#111111",l.tipDelay=200}(),function(B){var p;function x(){this._idMap=null,this._aniList=null,this._watchMap={},x.__super.call(this)}U(x,"laya.ui.View",E);var g=x.prototype;return g.createView=function(B){if(B.animations&&!this._idMap&&(this._idMap={}),x.createComp(B,this,this),B.animations){var g,l,o=[],V=B.animations,U=0,y=V.length;for(U=0;U<y;U++){switch(g=new H,l=V[U],g._setUp(this._idMap,l),(this[l.name]=g)._setControlNode(this),l.action){case 1:g.play(0,!1);break;case 2:g.play(0,!0)}o.push(g)}this._aniList=o}0<this._width&&null==B.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},g.onEvent=function(B,g){},g.loadUI=function(B){var g=x.uiMap[B];g&&this.createView(g)},g.destroy=function(B){void 0===B&&(B=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,B)},g.changeData=function(B){var g=this._watchMap[B];if(g){console.log("change",B);for(var l=0,o=g.length;l<o;l++){g[l].exe(this)}}},x._regs=function(){for(var B in x.uiClassMap)F.regClass(B,x.uiClassMap[B])},x.createComp=function(B,g,l,o){if(!(g=g||x.getCompInstance(B)))return console.warn("can not create:"+B.type),null;var V=B.child;if(V)for(var U=g instanceof laya.ui.List,y=0,G=V.length;y<G;y++){var d=V[y];if(!g.hasOwnProperty("itemRender")||"render"!=d.props.name&&"render"!==d.props.renderType)if("Graphic"==d.type)F.addGraphicsToSprite(d,g);else if(F.isDrawType(d.type))F.addGraphicToSprite(d,g,!0);else{if(U){var j=[],A=x.createComp(d,null,l,j);j.length&&(A._$bindData=j)}else A=x.createComp(d,null,l,o);"Script"==d.type?"owner"in A?A.owner=g:"target"in A&&(A.target=g):"mask"==d.props.renderType||"mask"==d.props.name?g.mask=A:A instanceof laya.display.Sprite&&g.addChild(A)}else g.itemRender=d}var H=B.props;for(var K in H){var p=H[K];x.eventDic[K]?p&&l&&g.on(K,l,l.onEvent,[p]):x.setCompValue(g,K,p,l,o)}return N.__typeof(g,"laya.ui.IItem")&&g.initItems(),B.compId&&l&&l._idMap&&(l._idMap[B.compId]=g),g},x.setCompValue=function(B,g,l,o,V){if("string"==typeof l&&-1<l.indexOf("${")){if(x._sheet||(x._sheet=F.getClass("laya.data.Table")),!x._sheet)return void console.warn("Can not find class Sheet");if(V)V.push(B,g,l);else if(o){-1==l.indexOf("].")&&(l=l.replace(".","[0]."));var U,y,G=new p(B,g,l);G.exe(o);for(var d=l.replace(/\[.*?\]\./g,".");null!=(U=x._parseWatchData.exec(d));){for(var j=U[1];null!=(y=x._parseKeyWord.exec(j));){var A=y[0],H=o._watchMap[A]||(o._watchMap[A]=[]);H.push(G),x._sheet.I.notifer.on(A,o,o.changeData,[A])}(H=o._watchMap[j]||(o._watchMap[j]=[])).push(G),x._sheet.I.notifer.on(j,o,o.changeData,[j])}}}else if("var"===g&&o)o[l]=B;else if("onClick"==g){var K=N._runScript("(function(){"+l+"})");B.on("click",o,K)}else B[g]="true"===l||"false"!==l&&l},x.getCompInstance=function(B){var g,l=B.props?B.props.runtime:null;return g=l?x.viewClassMap[l]||x.uiClassMap[l]||N.__classmap[l]:x.uiClassMap[B.type],B.props&&B.props.hasOwnProperty("renderType")&&"instance"==B.props.renderType?g.instance:g?new g:null},x.regComponent=function(B,g){x.uiClassMap[B]=g,F.regClass(B,g)},x.regViewRuntime=function(B,g){x.viewClassMap[B]=g},x.uiMap={},x.viewClassMap={},x._sheet=null,o(x,["uiClassMap",function(){return this.uiClassMap={ViewStack:BB,LinkButton:e,TextArea:jB,ColorPicker:_,Box:E,Button:e,CheckBox:W,Clip:Q,ComboBox:P,Component:f,HScrollBar:k,HSlider:$,Image:r,Label:Z,List:I,Panel:J,ProgressBar:T,Radio:q,RadioGroup:GB,ScrollBar:Y,Slider:c,Tab:dB,TextInput:lB,View:x,VScrollBar:gB,VSlider:oB,Tree:O,HBox:UB,VBox:yB,Sprite:b,Animation:l,Text:D,FontClip:L}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),x.__init$=function(){x._regs(),p=function(){function B(B,g,l){this.comp=null,this.prop=null,this.value=null,this.comp=B,this.prop=g,this.value=l}return U(B,""),B.prototype.exe=function(B){var g=z.getBindFun(this.value);this.comp[this.prop]=g.call(this,B)},B}()},x}()),W=function(B){function l(B,g){void 0===g&&(g=""),l.__super.call(this,B,g)}U(l,"laya.ui.CheckBox",B);var g=l.prototype;return g.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},g.initialize=function(){B.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},y(0,g,"dataSource",B.prototype._$get_dataSource,function(B){"boolean"==typeof(this._dataSource=B)?this.selected=B:"string"==typeof B?this.selected="true"===B:N.superSet(e,this,"dataSource",B)}),l}(e),n=function(B){function g(){this._space=0,this._align="none",this._itemChanged=!1,g.__super.call(this)}U(g,"laya.ui.LayoutBox",E);var l=g.prototype;return l.addChild=function(B){return B.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,B)},l.onResize=function(B){this._setItemChanged()},l.addChildAt=function(B,g){return B.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,B,g)},l.removeChild=function(B){return B.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,B)},l.removeChildAt=function(B){return this.getChildAt(B).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,B)},l.refresh=function(){this._setItemChanged()},l.changeItems=function(){this._itemChanged=!1},l.sortItem=function(B){B&&B.sort(function(B,g){return B.y-g.y})},l._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},y(0,l,"space",function(){return this._space},function(B){this._space=B,this._setItemChanged()}),y(0,l,"align",function(){return this._align},function(B){this._align=B,this._setItemChanged()}),g}(),L=function(g){function l(B,g){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,l.__super.call(this),B&&(this.skin=B),g&&(this.sheet=g)}U(l,"laya.ui.FontClip",g);var B=l.prototype;return B.createChildren=function(){this._bitmap=new h,this.on("loaded",this,this._onClipLoaded)},B._onClipLoaded=function(){this.callLater(this.changeValue)},B.changeValue=function(){var B;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),B=this._sources[0]))){var g="horizontal"===this._direction;g?(this._wordsW=this._valueArr.length*(B.sourceWidth+this.spaceX),this._wordsH=B.sourceHeight):(this._wordsW=B.sourceWidth,this._wordsH=(B.sourceHeight+this.spaceY)*this._valueArr.length);var l=0;if(this._width)switch(this._align){case"center":l=.5*(this._width-this._wordsW);break;case"right":l=this._width-this._wordsW;break;default:l=0}for(var o=0,V=this._valueArr.length;o<V;o++){var U=this._indexMap[this._valueArr.charAt(o)];this.sources[U]&&(B=this.sources[U],g?this.graphics.drawTexture(B,l+o*(B.sourceWidth+this.spaceX),0,B.sourceWidth,B.sourceHeight):this.graphics.drawTexture(B,0+l,o*(B.sourceHeight+this.spaceY),B.sourceWidth,B.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},B.destroy=function(B){void 0===B&&(B=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),g.prototype.destroy.call(this,B)},y(0,B,"sheet",function(){return this._sheet},function(B){B+="";var g=(this._sheet=B).split(" ");this._clipX=String(g[0]).length,this.clipY=g.length,this._indexMap={};for(var l=0;l<this._clipY;l++)for(var o=g[l].split(""),V=0,U=o.length;V<U;V++)this._indexMap[o[V]]=l*this._clipX+V}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(Q,this,"height",B),this.callLater(this.changeValue)}),y(0,B,"direction",function(){return this._direction},function(B){this._direction=B,this.callLater(this.changeValue)}),y(0,B,"value",function(){return this._valueArr?this._valueArr:""},function(B){B+="",this._valueArr=B,this.callLater(this.changeValue)}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(Q,this,"width",B),this.callLater(this.changeValue)}),y(0,B,"spaceX",function(){return this._spaceX},function(B){this._spaceX=B,"horizontal"===this._direction&&this.callLater(this.changeValue)}),y(0,B,"spaceY",function(){return this._spaceY},function(B){this._spaceY=B,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),y(0,B,"align",function(){return this._align},function(B){this._align=B,this.callLater(this.changeValue)}),y(0,B,"measureWidth",function(){return this._wordsW}),y(0,B,"measureHeight",function(){return this._wordsH}),l}(Q),I=function(B){function g(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new x,g.__super.call(this)}U(g,"laya.ui.List",B);var l=g.prototype;return N.imps(l,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),l.destroy=function(B){void 0===B&&(B=!0),this._content&&this._content.destroy(B),this._scrollBar&&this._scrollBar.destroy(B),laya.ui.Component.prototype.destroy.call(this,B),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},l.createChildren=function(){this.addChild(this._content=new E)},l.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=N.superGet(E,this,"cacheAs")),N.superSet(E,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},l.onScrollEnd=function(){N.superSet(E,this,"cacheAs",this._$P.cacheAs)},l._removePreScrollBar=function(){var B=this.removeChildByName("scrollBar");B&&B.destroy(!0)},l.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var B=this._getOneCell(),g=B.width+this._spaceX||1,l=B.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/g):Math.ceil(this._width/g)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/l):Math.round(this._height/l));var o=this._width?this._width:g*this.repeatX-this._spaceX,V=this._height?this._height:l*this.repeatY-this._spaceY;this._cellSize=this._isVertical?l:g,this._cellOffset=this._isVertical?l*Math.max(this._repeatY2,this._repeatY)-V-this._spaceY:g*Math.max(this._repeatX2,this._repeatX)-o-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=V:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=o),this.setContentSize(o,V);var U=this._isVertical?this.repeatX:this.repeatY,y=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,U,y),this._createdLine=y,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},l._getOneCell=function(){if(0===this._cells.length){var B=this.createItem();if(this._offset.setTo(B.x,B.y),this.cacheContent)return B;this._cells.push(B)}return this._cells[0]},l._createItems=function(B,g,l){var o=this._content,V=this._getOneCell(),U=V.width+this._spaceX,y=V.height+this._spaceY;if(this.cacheContent){var G=new E;G.cacheAsBitmap=!0,G.pos((this._isVertical?0:B)*U,(this._isVertical?B:0)*y),this._content.addChild(G),this._content.optimizeScrollRect=!0,o=G}else{for(var d=[],j=this._cells.length-1;-1<j;j--){var A=this._cells[j];A.removeSelf(),d.push(A)}this._cells.length=0}for(var H=B;H<l;H++)for(var K=0;K<g;K++)(V=d&&d.length?d.pop():this.createItem()).x=(this._isVertical?K:H)*U-o.x,V.y=(this._isVertical?H:K)*y-o.y,V.name="item"+(H*g+K),o.addChild(V),this.addCell(V)},l.createItem=function(){var B=[];if("function"==typeof this._itemRender)var g=new this._itemRender;else g=R.createComp(this._itemRender,null,null,B);if(0==B.length&&g._watchMap){var l=g._watchMap;for(var o in l)for(var V=l[o],U=0;U<V.length;U++){var y=V[U];B.push(y.comp,y.prop,y.value)}}return B.length&&(g._$bindData=B),g},l.addCell=function(B){B.on("click",this,this.onCellMouse),B.on("rightclick",this,this.onCellMouse),B.on("mouseover",this,this.onCellMouse),B.on("mouseout",this,this.onCellMouse),B.on("mousedown",this,this.onCellMouse),B.on("mouseup",this,this.onCellMouse),this._cells.push(B)},l.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var B=0,g=B=0;g<1e4;g++){var l=this.getChildByName("item"+g);if(!l)break;this.addCell(l),B++}this.repeatY=B}},l.setContentSize=function(B,g){this._content.width=B,this._content.height=g,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new C),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,B,g),this._content.scrollRect=this._content.scrollRect),this.event("resize")},l.onCellMouse=function(B){"mousedown"===B.type&&(this._isMoved=!1);var g=B.currentTarget,l=this._startIndex+this._cells.indexOf(g);l<0||("click"===B.type||"rightclick"===B.type?this.selectEnable&&!this._isMoved?this.selectedIndex=l:this.changeCellState(g,!0,0):"mouseover"!==B.type&&"mouseout"!==B.type||this._selectedIndex===l||this.changeCellState(g,"mouseover"===B.type,0),this.mouseHandler&&this.mouseHandler.runWith([B,l]))},l.changeCellState=function(B,g,l){var o=B.getChildByName("selectBox");o&&(this.selectEnable=!0,o.visible=g,o.index=l)},l.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},l.onScrollBarChange=function(B){this.runCallLater(this.changeCells);var g=this._scrollBar.value,l=this._isVertical?this.repeatX:this.repeatY,o=this._isVertical?this.repeatY:this.repeatX,V=Math.floor(g/this._cellSize);if(this.cacheContent)y=o+1,this._createdLine-V<y&&(this._createItems(this._createdLine,l,this._createdLine+y),this.renderItems(this._createdLine*l,0),this._createdLine+=y);else{var U=V*l,y=0;if(U>this._startIndex){y=U-this._startIndex;var G=!0,d=this._startIndex+l*(o+1);this._isMoved=!0}else U<this._startIndex&&(y=this._startIndex-U,G=!1,d=this._startIndex-1,this._isMoved=!0);for(var j=0;j<y;j++){if(G){var A=this._cells.shift();this._cells[this._cells.length]=A;var H=d+j}else A=this._cells.pop(),this._cells.unshift(A),H=d-j;var K=Math.floor(H/l)*this._cellSize;this._isVertical?A.y=K:A.x=K,this.renderItem(A,H)}this._startIndex=U,this.changeSelectStatus()}var p=this._content.scrollRect;this._isVertical?(p.y=g-this._offset.y,p.x=-this._offset.x):(p.y=-this._offset.y,p.x=g-this._offset.x),this._content.scrollRect=p},l.posCell=function(B,g){if(this._scrollBar){var l=this._isVertical?this.repeatX:this.repeatY,o=(this._isVertical?this.repeatY:this.repeatX,Math.floor(g/l)*this._cellSize);this._isVertical?B.y=o:B.x=o}},l.changeSelectStatus=function(){for(var B=0,g=this._cells.length;B<g;B++)this.changeCellState(this._cells[B],this._selectedIndex===this._startIndex+B,1)},l.renderItems=function(B,g){void 0===B&&(B=0),void 0===g&&(g=0);for(var l=B,o=g||this._cells.length;l<o;l++)this.renderItem(this._cells[l],this._startIndex+l);this.changeSelectStatus(),this._twDone=!0},l.renderItem=function(B,g){this._array&&0<=g&&g<this._array.length?(B.visible=!0,B._$bindData?(B._dataSource=this._array[g],this._bindData(B,this._array[g])):B.dataSource=this._array[g],this.cacheContent||this.posCell(B,g),this.hasListener("render")&&this.event("render",[B,g]),this.renderHandler&&this.renderHandler.runWith([B,g]),this.renderTwHandler&&this.renderTwHandler.runWith([B,g])):(B.visible=!1,B.dataSource=null)},l._bindData=function(B,g){for(var l=B._$bindData,o=0,V=l.length;o<V;o++){var U=l[o++],y=l[o++],G=l[o],d=z.getBindFun(G);U[y]=d.call(this,g)}},l.refresh=function(){this.array=this._array},l.getItem=function(B){return-1<B&&B<this._array.length?this._array[B]:null},l.changeItem=function(B,g){-1<B&&B<this._array.length&&(this._array[B]=g,B>=this._startIndex&&B<this._startIndex+this._cells.length&&this.renderItem(this.getCell(B),B))},l.setItem=function(B,g){this.changeItem(B,g)},l.addItem=function(B){this._array.push(B),this.array=this._array},l.addItemAt=function(B,g){this._array.splice(g,0,B),this.array=this._array},l.deleteItem=function(B){this._array.splice(B,1),this.array=this._array},l.getCell=function(B){return this.runCallLater(this.changeCells),-1<B&&this._cells?this._cells[(B-this._startIndex)%this._cells.length]:null},l.scrollTo=function(B){if(this._scrollBar){var g=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(B/g)*this._cellSize}else this.startIndex=B},l.tweenTo=function(B,g,l){if(void 0===g&&(g=200),this._scrollBar){var o=this._isVertical?this.repeatX:this.repeatY;s.to(this._scrollBar,{value:Math.floor(B/o)*this._cellSize},g,null,l,0,!0)}else this.startIndex=B,l&&l.run()},l._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},l.commitMeasure=function(){this.runCallLater(this.changeCells)},y(0,l,"cacheAs",B.prototype._$get_cacheAs,function(B){N.superSet(E,this,"cacheAs",B),this._scrollBar&&(this._$P.cacheAs=null,"none"!==B?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),y(0,l,"content",function(){return this._content}),y(0,l,"height",B.prototype._$get_height,function(B){B!=this._height&&(N.superSet(E,this,"height",B),this._setCellChanged())}),y(0,l,"itemRender",function(){return this._itemRender},function(B){if(this._itemRender!=B){this._itemRender=B;for(var g=this._cells.length-1;-1<g;g--)this._cells[g].destroy();this._cells.length=0,this._setCellChanged()}}),y(0,l,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(B){this._removePreScrollBar();var g=new gB;g.name="scrollBar",g.right=0,B&&" "!=B&&(g.skin=B),this.scrollBar=g,this.addChild(g),this._setCellChanged()}),y(0,l,"page",function(){return this._page},function(B){this._page=B,this._array&&(this._page=0<B?B:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),y(0,l,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(B){this._removePreScrollBar();var g=new k;g.name="scrollBar",g.bottom=0,B&&" "!=B&&(g.skin=B),this.scrollBar=g,this.addChild(g),this._setCellChanged()}),y(0,l,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(B){this._repeatX=B,this._setCellChanged()}),y(0,l,"scrollBar",function(){return this._scrollBar},function(B){this._scrollBar!=B&&(this._scrollBar=B)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),y(0,l,"width",B.prototype._$get_width,function(B){B!=this._width&&(N.superSet(E,this,"width",B),this._setCellChanged())}),y(0,l,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(B){this._repeatY=B,this._setCellChanged()}),y(0,l,"spaceX",function(){return this._spaceX},function(B){this._spaceX=B,this._setCellChanged()}),y(0,l,"spaceY",function(){return this._spaceY},function(B){this._spaceY=B,this._setCellChanged()}),y(0,l,"selectedIndex",function(){return this._selectedIndex},function(B){this._selectedIndex!=B&&(this._selectedIndex=B,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(B),this.startIndex=this._startIndex)}),y(0,l,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(B){this.selectedIndex=this._array.indexOf(B)}),y(0,l,"length",function(){return this._array?this._array.length:0}),y(0,l,"selection",function(){return this.getCell(this._selectedIndex)},function(B){this.selectedIndex=this._startIndex+this._cells.indexOf(B)}),y(0,l,"startIndex",function(){return this._startIndex},function(B){this._startIndex=0<B?B:0,this.callLater(this.renderItems)}),y(0,l,"twSwitch",function(){return this._twSwitch},function(B){this._twSwitch=B}),y(0,l,"twDone",function(){return this._twDone},function(B){this._twDone=B}),y(0,l,"array",function(){return this._array},function(B){this.runCallLater(this.changeCells),this._array=B||[];var g=this._array.length;if(this.totalPage=Math.ceil(g/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<g?this._selectedIndex:g-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var l=this._isVertical?this.repeatX:this.repeatY,o=this._isVertical?this.repeatY:this.repeatX,V=Math.ceil(g/l);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=o/V,this._scrollBar.setScroll(0,(V-o)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),y(0,l,"dataSource",B.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)&&Math.floor(B)==B||"string"==typeof B?this.selectedIndex=parseInt(B):B instanceof Array?this.array=B:N.superSet(E,this,"dataSource",B)}),y(0,l,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),g}(E),k=function(B){function g(){g.__super.call(this)}return U(g,"laya.ui.HScrollBar",B),g.prototype.initialize=function(){B.prototype.initialize.call(this),this.slider.isVertical=!1},g}(Y),J=function(B){function g(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,g.__super.call(this),this.width=this.height=100}U(g,"laya.ui.Panel",B);var l=g.prototype;return l.destroy=function(B){void 0===B&&(B=!0),laya.ui.Component.prototype.destroy.call(this,B),this._content&&this._content.destroy(B),this._vScrollBar&&this._vScrollBar.destroy(B),this._hScrollBar&&this._hScrollBar.destroy(B),this._vScrollBar=null,this._hScrollBar=null,this._content=null},l.destroyChildren=function(){this._content.destroyChildren()},l.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new E)},l.addChild=function(B){return B.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(B)},l.onResize=function(){this._setScrollChanged()},l.addChildAt=function(B,g){return B.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(B,g)},l.removeChild=function(B){return B.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(B)},l.removeChildAt=function(B){return this.getChildAt(B).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(B)},l.removeChildren=function(B,g){return void 0===B&&(B=0),void 0===g&&(g=2147483647),this._content.removeChildren(B,g),this._setScrollChanged(),this},l.getChildAt=function(B){return this._content.getChildAt(B)},l.getChildByName=function(B){return this._content.getChildByName(B)},l.getChildIndex=function(B){return this._content.getChildIndex(B)},l.changeScroll=function(){this._scrollChanged=!1;var B=this.contentWidth||1,g=this.contentHeight||1,l=this._vScrollBar,o=this._hScrollBar,V=l&&g>this._height,U=o&&B>this._width,y=V?this._width-l.width:this._width,G=U?this._height-o.height:this._height;l&&(l.x=this._width-l.width,l.y=0,l.height=this._height-(U?o.height:0),l.scrollSize=Math.max(.033*this._height,1),l.thumbPercent=G/g,l.setScroll(0,g-G,l.value)),o&&(o.x=0,o.y=this._height-o.height,o.width=this._width-(V?l.width:0),o.scrollSize=Math.max(.033*this._width,1),o.thumbPercent=y/B,o.setScroll(0,B-y,o.value))},l.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},l.setContentSize=function(B,g){var l=this._content;l.width=B,l.height=g,l.scrollRect||(l.scrollRect=new C),l.scrollRect.setTo(0,0,B,g),l.scrollRect=l.scrollRect},l.onScrollBarChange=function(B){var g=this._content.scrollRect;if(g){var l=Math.round(B.value);B.isVertical?g.y=l:g.x=l,this._content.scrollRect=g}},l.scrollTo=function(B,g){void 0===B&&(B=0),void 0===g&&(g=0),this.vScrollBar&&(this.vScrollBar.value=g),this.hScrollBar&&(this.hScrollBar.value=B)},l.refresh=function(){this.changeScroll()},l.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=N.superGet(E,this,"cacheAs")),N.superSet(E,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},l.onScrollEnd=function(){N.superSet(E,this,"cacheAs",this._$P.cacheAs)},l._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},y(0,l,"numChildren",function(){return this._content.numChildren}),y(0,l,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(B){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new k),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=B}),y(0,l,"contentWidth",function(){for(var B=0,g=this._content.numChildren-1;-1<g;g--){var l=this._content.getChildAt(g);B=Math.max(l.x+l.width*l.scaleX,B)}return B}),y(0,l,"contentHeight",function(){for(var B=0,g=this._content.numChildren-1;-1<g;g--){var l=this._content.getChildAt(g);B=Math.max(l.y+l.height*l.scaleY,B)}return B}),y(0,l,"width",B.prototype._$get_width,function(B){N.superSet(E,this,"width",B),this._setScrollChanged()}),y(0,l,"hScrollBar",function(){return this._hScrollBar}),y(0,l,"content",function(){return this._content}),y(0,l,"height",B.prototype._$get_height,function(B){N.superSet(E,this,"height",B),this._setScrollChanged()}),y(0,l,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(B){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new gB),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=B}),y(0,l,"vScrollBar",function(){return this._vScrollBar}),y(0,l,"cacheAs",B.prototype._$get_cacheAs,function(B){N.superSet(E,this,"cacheAs",B),this._$P.cacheAs=null,"none"!==B?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),g}(E),$=function(B){function g(B){g.__super.call(this,B),this.isVertical=!1}return U(g,"laya.ui.HSlider",c),g}(),u=function(B){function l(B,g){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,l.__super.call(this),this.skin=g,this.labels=B}U(l,"laya.ui.UIGroup",B);var g=l.prototype;return N.imps(g,{"laya.ui.IItem":!0}),g.preinitialize=function(){this.mouseEnabled=!0},g.destroy=function(B){void 0===B&&(B=!0),laya.ui.Component.prototype.destroy.call(this,B),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},g.addItem=function(B,g){void 0===g&&(g=!0);var l=B,o=this._items.length;if(l.name="item"+o,this.addChild(l),this.initItems(),g&&0<o){var V=this._items[o-1];"horizontal"==this._direction?l.x=V.x+V.width+this._space:l.y=V.y+V.height+this._space}else g&&(l.x=0,l.y=0);return o},g.delItem=function(B,g){void 0===g&&(g=!0);var l=this._items.indexOf(B);if(-1!=l){var o=B;this.removeChild(o);for(var V=l+1,U=this._items.length;V<U;V++){var y=this._items[V];y.name="item"+(V-1),g&&("horizontal"==this._direction?y.x-=o.width+this._space:y.y-=o.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var G;G=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=G}}},g.initItems=function(){this._items||(this._items=[]);for(var B=this._items.length=0;B<1e4;B++){var g=this.getChildByName("item"+B);if(null==g)break;this._items.push(g),g.selected=B===this._selectedIndex,g.clickHandler=K.create(this,this.itemClick,[B],!1)}},g.itemClick=function(B){this.selectedIndex=B},g.setSelect=function(B,g){this._items&&-1<B&&B<this._items.length&&(this._items[B].selected=g)},g.createItem=function(B,g){return null},g.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var B=0,g=0,l=this._items.length;g<l;g++){var o=this._items[g];this._skin&&(o.skin=this._skin),this._labelColors&&(o.labelColors=this._labelColors),this._labelSize&&(o.labelSize=this._labelSize),this._labelStroke&&(o.labelStroke=this._labelStroke),this._labelStrokeColor&&(o.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(o.strokeColors=this._strokeColors),this._labelBold&&(o.labelBold=this._labelBold),this._labelPadding&&(o.labelPadding=this._labelPadding),this._labelAlign&&(o.labelAlign=this._labelAlign),this._stateNum&&(o.stateNum=this._stateNum),this._labelFont&&(o.labelFont=this._labelFont),"horizontal"===this._direction?(o.y=0,o.x=B,B+=o.width+this._space):(o.x=0,o.y=B,B+=o.height+this._space)}this.changeSize()},g.commitMeasure=function(){this.runCallLater(this.changeLabels)},g._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},y(0,g,"labelStrokeColor",function(){return this._labelStrokeColor},function(B){this._labelStrokeColor!=B&&(this._labelStrokeColor=B,this._setLabelChanged())}),y(0,g,"skin",function(){return this._skin},function(B){this._skin!=B&&(this._skin=B,this._setLabelChanged())}),y(0,g,"selectedIndex",function(){return this._selectedIndex},function(B){this._selectedIndex!=B&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=B,this.setSelect(B,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),y(0,g,"labels",function(){return this._labels},function(B){if(this._labels!=B){if(this._labels=B,this.removeChildren(),this._setLabelChanged(),this._labels)for(var g=this._labels.split(","),l=0,o=g.length;l<o;l++){var V=this.createItem(this._skin,g[l]);V.name="item"+l,this.addChild(V)}this.initItems()}}),y(0,g,"strokeColors",function(){return this._strokeColors},function(B){this._strokeColors!=B&&(this._strokeColors=B,this._setLabelChanged())}),y(0,g,"labelColors",function(){return this._labelColors},function(B){this._labelColors!=B&&(this._labelColors=B,this._setLabelChanged())}),y(0,g,"labelStroke",function(){return this._labelStroke},function(B){this._labelStroke!=B&&(this._labelStroke=B,this._setLabelChanged())}),y(0,g,"labelSize",function(){return this._labelSize},function(B){this._labelSize!=B&&(this._labelSize=B,this._setLabelChanged())}),y(0,g,"stateNum",function(){return this._stateNum},function(B){this._stateNum!=B&&(this._stateNum=B,this._setLabelChanged())}),y(0,g,"labelBold",function(){return this._labelBold},function(B){this._labelBold!=B&&(this._labelBold=B,this._setLabelChanged())}),y(0,g,"labelFont",function(){return this._labelFont},function(B){this._labelFont!=B&&(this._labelFont=B,this._setLabelChanged())}),y(0,g,"labelPadding",function(){return this._labelPadding},function(B){this._labelPadding!=B&&(this._labelPadding=B,this._setLabelChanged())}),y(0,g,"direction",function(){return this._direction},function(B){this._direction=B,this._setLabelChanged()}),y(0,g,"space",function(){return this._space},function(B){this._space=B,this._setLabelChanged()}),y(0,g,"items",function(){return this._items}),y(0,g,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(B){this.selectedIndex=this._items.indexOf(B)}),y(0,g,"dataSource",B.prototype._$get_dataSource,function(B){"number"==typeof(this._dataSource=B)&&Math.floor(B)==B||"string"==typeof B?this.selectedIndex=parseInt(B):B instanceof Array?this.labels=B.join(","):N.superSet(E,this,"dataSource",B)}),l}(E),q=function(g){function l(B,g){this._value=null,void 0===g&&(g=""),l.__super.call(this,B,g)}U(l,"laya.ui.Radio",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._value=null},B.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},B.initialize=function(){g.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},B.onClick=function(B){this.selected=!0},y(0,B,"value",function(){return null!=this._value?this._value:this.label},function(B){this._value=B}),l}(e),O=function(B){function g(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,g.__super.call(this),this.width=this.height=200}U(g,"laya.ui.Tree",B);var l=g.prototype;return N.imps(l,{"laya.ui.IRender":!0}),l.destroy=function(B){void 0===B&&(B=!0),laya.ui.Component.prototype.destroy.call(this,B),this._list&&this._list.destroy(B),this._list=null,this._source=null,this._renderHandler=null},l.createChildren=function(){this.addChild(this._list=new I),this._list.renderHandler=K.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},l.onListChange=function(B){this.event("change")},l.getArray=function(){var B,g=[];for(var l in this._source)B=this._source[l],this.getParentOpenStatus(B)&&(B.x=this._spaceLeft*this.getDepth(B),g.push(B));return g},l.getDepth=function(B,g){return void 0===g&&(g=0),null==B.nodeParent?g:this.getDepth(B.nodeParent,g+1)},l.getParentOpenStatus=function(B){var g=B.nodeParent;return null==g||!!g.isOpen&&(null==g.nodeParent||this.getParentOpenStatus(g))},l.renderItem=function(B,g){var l=B.dataSource;if(l){B.left=l.x;var o=B.getChildByName("arrow");o&&(l.hasChild?(o.visible=!0,o.index=l.isOpen?1:0,o.tag=g,o.off("click",this,this.onArrowClick),o.on("click",this,this.onArrowClick)):o.visible=!1);var V=B.getChildByName("folder");V&&(2==V.clipY?V.index=l.isDirectory?0:1:V.index=l.isDirectory?l.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([B,g])}},l.onArrowClick=function(B){var g=B.currentTarget.tag;this._list.array[g].isOpen=!this._list.array[g].isOpen,this.event("open"),this._list.array=this.getArray()},l.setItemState=function(B,g){this._list.array[B]&&(this._list.array[B].isOpen=g,this._list.array=this.getArray())},l.fresh=function(){this._list.array=this.getArray(),this.repaint()},l.parseXml=function(B,g,l,o){var V,U=B.childNodes,y=U.length;if(!o){V={};var G,d=B.attributes;for(var j in d){var A=(G=d[j]).nodeName,H=G.nodeValue;V[A]="true"==H||"false"!=H&&H}V.nodeParent=l,0<y&&(V.isDirectory=!0),V.hasChild=0<y,g.push(V)}for(var K=0;K<y;K++){var p=U[K];this.parseXml(p,g,V,!1)}},l.parseOpenStatus=function(B,g){for(var l=0,o=g.length;l<o;l++){var V=g[l];if(V.isDirectory)for(var U=0,y=B.length;U<y;U++){var G=B[U];if(G.isDirectory&&this.isSameParent(G,V)&&V.label==G.label){V.isOpen=G.isOpen;break}}}},l.isSameParent=function(B,g){return null==B.nodeParent&&null==g.nodeParent||null!=B.nodeParent&&null!=g.nodeParent&&(B.nodeParent.label==g.nodeParent.label&&this.isSameParent(B.nodeParent,g.nodeParent))},l.filter=function(B){if(Boolean(B)){var g=[];this.getFilterSource(this._source,g,B),this._list.array=g}else this._list.array=this.getArray()},l.getFilterSource=function(B,g,l){var o;for(var V in l=l.toLocaleLowerCase(),B)!(o=B[V]).isDirectory&&-1<String(o.label).toLowerCase().indexOf(l)&&(o.x=0,g.push(o)),o.child&&0<o.child.length&&this.getFilterSource(o.child,g,l)},y(0,l,"spaceBottom",function(){return this._list.spaceY},function(B){this._list.spaceY=B}),y(0,l,"keepStatus",function(){return this._keepStatus},function(B){this._keepStatus=B}),y(0,l,"itemRender",function(){return this._list.itemRender},function(B){this._list.itemRender=B}),y(0,l,"array",function(){return this._list.array},function(B){this._keepStatus&&this._list.array&&B&&this.parseOpenStatus(this._list.array,B),this._source=B,this._list.array=this.getArray()}),y(0,l,"mouseHandler",function(){return this._list.mouseHandler},function(B){this._list.mouseHandler=B}),y(0,l,"dataSource",B.prototype._$get_dataSource,function(B){this._dataSource=B,N.superSet(E,this,"dataSource",B)}),y(0,l,"source",function(){return this._source}),y(0,l,"scrollBar",function(){return this._list.scrollBar}),y(0,l,"list",function(){return this._list}),y(0,l,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(B){this._list.vScrollBarSkin=B}),y(0,l,"renderHandler",function(){return this._renderHandler},function(B){this._renderHandler=B}),y(0,l,"selectedIndex",function(){return this._list.selectedIndex},function(B){this._list.selectedIndex=B}),y(0,l,"spaceLeft",function(){return this._spaceLeft},function(B){this._spaceLeft=B}),y(0,l,"selectedItem",function(){return this._list.selectedItem},function(B){this._list.selectedItem=B}),y(0,l,"width",B.prototype._$get_width,function(B){N.superSet(E,this,"width",B),this._list.width=B}),y(0,l,"height",B.prototype._$get_height,function(B){N.superSet(E,this,"height",B),this._list.height=B}),y(0,l,"xml",null,function(B){var g=[];this.parseXml(B.childNodes[0],g,null,!0),this.array=g}),y(0,l,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),g}(E),BB=function(B){function g(){this._items=null,this._selectedIndex=0,g.__super.call(this),this._setIndexHandler=K.create(this,this.setIndex,null,!1)}U(g,"laya.ui.ViewStack",B);var l=g.prototype;return N.imps(l,{"laya.ui.IItem":!0}),l.setItems=function(B){this.removeChildren();for(var g=0,l=0,o=B.length;l<o;l++){var V=B[l];V&&(V.name="item"+g,this.addChild(V),g++)}this.initItems()},l.addItem=function(B){B.name="item"+this._items.length,this.addChild(B),this.initItems()},l.initItems=function(){this._items=[];for(var B=0;B<1e4;B++){var g=this.getChildByName("item"+B);if(null==g)break;this._items.push(g),g.visible=B==this._selectedIndex}},l.setSelect=function(B,g){this._items&&-1<B&&B<this._items.length&&(this._items[B].visible=g)},l.setIndex=function(B){this.selectedIndex=B},y(0,l,"dataSource",B.prototype._$get_dataSource,function(B){if("number"==typeof(this._dataSource=B)&&Math.floor(B)==B||"string"==typeof B)this.selectedIndex=parseInt(B);else for(var g in this._dataSource)this.hasOwnProperty(g)&&(this[g]=this._dataSource[g])}),y(0,l,"selectedIndex",function(){return this._selectedIndex},function(B){this._selectedIndex!=B&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=B,this.setSelect(this._selectedIndex,!0))}),y(0,l,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(B){this.selectedIndex=this._items.indexOf(B)}),y(0,l,"items",function(){return this._items}),y(0,l,"setIndexHandler",function(){return this._setIndexHandler},function(B){this._setIndexHandler=B}),g}(E),gB=function(B){function g(){g.__super.call(this)}return U(g,"laya.ui.VScrollBar",Y),g}(),lB=function(g){function l(B){this._bg=null,this._skin=null,l.__super.call(this),void 0===B&&(B=""),this.text=B,this.skin=this.skin}U(l,"laya.ui.TextInput",g);var B=l.prototype;return B.preinitialize=function(){this.mouseEnabled=!0},B.destroy=function(B){m.clearCache(this,this._skin),void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._bg&&this._bg.destroy(),this._bg=null},B.createChildren=function(){this.addChild(this._tf=new p),this._tf.padding=a.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},B._onFocus=function(){this.event("focus",this)},B._onBlur=function(){this.event("blur",this)},B._onInput=function(){this.event("input",this)},B._onEnter=function(){this.event("enter",this)},B.initialize=function(){this.width=128,this.height=22},B.select=function(){this._tf.select()},B.setSelection=function(B,g){this._tf.setSelection(B,g)},y(0,B,"text",g.prototype._$get_text,function(B){this._tf.text!=B&&(B+="",this._tf.text=B,this.event("change"))}),y(0,B,"bg",function(){return this._bg},function(B){this.graphics=this._bg=B}),y(0,B,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(B){this._tf.inputElementYAdjuster=B}),y(0,B,"multiline",function(){return this._tf.multiline},function(B){this._tf.multiline=B}),y(0,B,"skin",function(){return this._skin},function(B){this._skin!=B&&(m.clearCache(this,this._skin),this._skin=B,this._bg||(this.graphics=this._bg=new h),m.keepCache(this,this._skin),this._bg.source=m.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),y(0,B,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(B){this._bg||(this.graphics=this._bg=new h),this._bg.sizeGrid=z.fillArray(a.defaultSizeGrid,B,Number)}),y(0,B,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(B){this._tf.inputElementXAdjuster=B}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(Z,this,"width",B),this._bg&&(this._bg.width=B)}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(Z,this,"height",B),this._bg&&(this._bg.height=B)}),y(0,B,"editable",function(){return this._tf.editable},function(B){this._tf.editable=B}),y(0,B,"restrict",function(){return this._tf.restrict},function(B){this._tf.restrict=B}),y(0,B,"prompt",function(){return this._tf.prompt},function(B){this._tf.prompt=B}),y(0,B,"promptColor",function(){return this._tf.promptColor},function(B){this._tf.promptColor=B}),y(0,B,"maxChars",function(){return this._tf.maxChars},function(B){this._tf.maxChars=B}),y(0,B,"focus",function(){return this._tf.focus},function(B){this._tf.focus=B}),y(0,B,"type",function(){return this._tf.type},function(B){this._tf.type=B}),y(0,B,"asPassword",function(){return this._tf.asPassword},function(B){this._tf.asPassword=B}),l}(Z),oB=function(B){function g(){g.__super.call(this)}return U(g,"laya.ui.VSlider",c),g}(),VB=function(B){function o(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,o.__super.call(this)}U(o,"laya.ui.Dialog",B);var g=o.prototype;return g.initialize=function(){this.popupEffect=o.manager.popupEffectHandler,this.closeEffect=o.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},g._dealDragArea=function(){var B=this.getChildByName("drag");B&&(this.dragArea=B.x+","+B.y+","+B.width+","+B.height,B.removeSelf())},g._onClick=function(B){var g=B.target;if(g)switch(g.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(g.name)}},g.show=function(B,g){void 0===B&&(B=!1),void 0===g&&(g=!0),this._open(!1,B,g)},g.popup=function(B,g){void 0===B&&(B=!1),void 0===g&&(g=!0),this._open(!0,B,g)},g._open=function(B,g,l){o.manager.lock(!1),this.isModal=B,o.manager.open(this,g,l)},g.onOpened=function(){},g.close=function(B,g){void 0===g&&(g=!0),o.manager.close(this,B,g)},g.onClosed=function(B){},g._onMouseDown=function(B){var g=this.getMousePoint();this._dragArea.contains(g.x,g.y)?this.startDrag():this.stopDrag()},y(0,g,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(B){if(B){var g=z.fillArray([0,0,0,0],B,Number);this._dragArea=new C(g[0],g[1],g[2],g[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),y(0,g,"isPopup",function(){return null!=this.parent}),y(0,g,"zOrder",B.prototype._$get_zOrder,function(B){N.superSet(R,this,"zOrder",B),o.manager._checkMask()}),y(1,o,"manager",function(){return o._manager=o._manager||new S},function(B){o._manager=B}),o.setLockView=function(B){o.manager.setLockView(B)},o.lock=function(B){o.manager.lock(B)},o.closeAll=function(){o.manager.closeAll()},o.getDialogsByGroup=function(B){return o.manager.getDialogsByGroup(B)},o.closeByGroup=function(B){return o.manager.closeByGroup(B)},o.CLOSE="close",o.CANCEL="cancel",o.SURE="sure",o.NO="no",o.OK="ok",o.YES="yes",o._manager=null,o}(R),UB=function(B){function g(){g.__super.call(this)}U(g,"laya.ui.HBox",B);var l=g.prototype;return l.sortItem=function(B){B&&B.sort(function(B,g){return B.x-g.x})},l.changeItems=function(){this._itemChanged=!1;for(var B=[],g=0,l=0,o=this.numChildren;l<o;l++){var V=this.getChildAt(l);V&&V.layoutEnabled&&(B.push(V),g=this._height?this._height:Math.max(g,V.height*V.scaleY))}this.sortItem(B);var U=0;for(l=0,o=B.length;l<o;l++)(V=B[l]).x=U,U+=V.width*V.scaleX+this._space,"top"==this._align?V.y=0:"middle"==this._align?V.y=.5*(g-V.height*V.scaleY):"bottom"==this._align&&(V.y=g-V.height*V.scaleY);this.changeSize()},y(0,l,"height",B.prototype._$get_height,function(B){this._height!=B&&(N.superSet(n,this,"height",B),this.callLater(this.changeItems))}),g.NONE="none",g.TOP="top",g.MIDDLE="middle",g.BOTTOM="bottom",g}(n),yB=function(B){function g(){g.__super.call(this)}U(g,"laya.ui.VBox",B);var l=g.prototype;return l.changeItems=function(){this._itemChanged=!1;for(var B=[],g=0,l=0,o=this.numChildren;l<o;l++){var V=this.getChildAt(l);V&&V.layoutEnabled&&(B.push(V),g=this._width?this._width:Math.max(g,V.width*V.scaleX))}this.sortItem(B);var U=0;for(l=0,o=B.length;l<o;l++)(V=B[l]).y=U,U+=V.height*V.scaleY+this._space,"left"==this._align?V.x=0:"center"==this._align?V.x=.5*(g-V.width*V.scaleX):"right"==this._align&&(V.x=g-V.width*V.scaleX);this.changeSize()},y(0,l,"width",B.prototype._$get_width,function(B){this._width!=B&&(N.superSet(n,this,"width",B),this.callLater(this.changeItems))}),g.NONE="none",g.LEFT="left",g.CENTER="center",g.RIGHT="right",g}(n),GB=function(B){function g(){g.__super.call(this)}return U(g,"laya.ui.RadioGroup",u),g.prototype.createItem=function(B,g){return new q(B,g)},g}(),dB=function(B){function g(){g.__super.call(this)}return U(g,"laya.ui.Tab",u),g.prototype.createItem=function(B,g){return new e(B,g)},g}(),jB=function(g){function l(B){this._vScrollBar=null,this._hScrollBar=null,void 0===B&&(B=""),l.__super.call(this,B)}U(l,"laya.ui.TextArea",g);var B=l.prototype;return B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},B.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},B.onVBarChanged=function(B){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},B.onHBarChanged=function(B){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},B.changeScroll=function(){var B=this._vScrollBar&&0<this._tf.maxScrollY,g=this._hScrollBar&&0<this._tf.maxScrollX,l=B?this._width-this._vScrollBar.width:this._width,o=g?this._height-this._hScrollBar.height:this._height,V=this._tf.padding||a.labelPadding;this._tf.width=l,this._tf.height=o,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-V[2],this._vScrollBar.y=V[1],this._vScrollBar.height=this._height-(g?this._hScrollBar.height:0)-V[1]-V[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=o/Math.max(this._tf.textHeight,o),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=B),this._hScrollBar&&(this._hScrollBar.x=V[0],this._hScrollBar.y=this._height-this._hScrollBar.height-V[3],this._hScrollBar.width=this._width-(B?this._vScrollBar.width:0)-V[0]-V[2],this._hScrollBar.scrollSize=Math.max(.033*l,1),this._hScrollBar.thumbPercent=l/Math.max(this._tf.textWidth,l),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=g)},B.scrollTo=function(B){this.commitMeasure(),this._tf.scrollY=B},y(0,B,"scrollY",function(){return this._tf.scrollY}),y(0,B,"width",g.prototype._$get_width,function(B){N.superSet(lB,this,"width",B),this.callLater(this.changeScroll)}),y(0,B,"hScrollBar",function(){return this._hScrollBar}),y(0,B,"height",g.prototype._$get_height,function(B){N.superSet(lB,this,"height",B),this.callLater(this.changeScroll)}),y(0,B,"maxScrollX",function(){return this._tf.maxScrollX}),y(0,B,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(B){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new gB),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=B}),y(0,B,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(B){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new k),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=B}),y(0,B,"vScrollBar",function(){return this._vScrollBar}),y(0,B,"maxScrollY",function(){return this._tf.maxScrollY}),y(0,B,"scrollX",function(){return this._tf.scrollX}),l}(lB);!function(B){function g(){this._uiView=null,this.isCloseOther=!1,g.__super.call(this)}U(g,"laya.ui.AsynDialog",VB);var l=g.prototype;l.createView=function(B){this._uiView=B},l._open=function(B,g,l){this.isModal=B,this.isCloseOther=g,VB.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},l.onCreated=function(){this.createUI(),this.onOpen()},l.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},l.onOpen=function(){VB.manager.open(this,this.isCloseOther),VB.manager.lock(!1)},l.close=function(B,g){void 0===g&&(g=!0),VB.manager.close(this),this.onClose()},l.onClose=function(){},l.destroy=function(B){void 0===B&&(B=!0),laya.ui.View.prototype.destroy.call(this,B),this._uiView=null,this.onDestroy()},l.onDestroy=function(){}}();N.__init([R])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(B,g){"use strict";for(var l in Object.defineProperty(g,"__esModule",{value:!0}),Laya){var o=Laya[l];o&&o.__isclass&&(g[l]=o)}}),function(K,B,D){D.un,D.uns;var H=D.static,p=D.class,x=D.getset,o=D.__newvec,b=laya.maths.Arith,y=laya.webgl.atlas.AtlasResourceManager,l=laya.webgl.shader.BaseShader,f=laya.utils.Browser,G=laya.webgl.utils.Buffer,v=laya.utils.Byte,V=laya.utils.ClassUtils,d=D.Config,U=(laya.events.Event,laya.events.EventDispatcher),a=laya.utils.Handler,C=laya.net.Loader,g=laya.net.LoaderManager,j=(laya.maths.MathUtil,laya.display.Node),N=laya.renders.Render,A=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),F=laya.resource.Resource,m=laya.utils.RunDriver,M=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),s=laya.display.Sprite,X=laya.utils.Stat,w=laya.utils.StringKey,z=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),i=laya.utils.Utils,t=laya.webgl.WebGL,h=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;D.interface("laya.d3.core.IClone"),D.interface("laya.d3.graphics.IVertex"),D.interface("laya.d3.core.render.IUpdate"),D.interface("laya.d3.core.scene.ITreeNode"),D.interface("laya.d3.core.render.IRenderable");(function(){function e(){}p(e,"laya.d3.animation.AnimationClipParser01"),e.READ_DATA=function(){e._DATA.offset=e._reader.getUint32(),e._DATA.size=e._reader.getUint32()},e.READ_BLOCK=function(){for(var B=e._BLOCK.count=e._reader.getUint16(),g=e._BLOCK.blockStarts=[],l=e._BLOCK.blockLengths=[],o=0;o<B;o++)g.push(e._reader.getUint32()),l.push(e._reader.getUint32())},e.READ_STRINGS=function(){var B=e._reader.getUint32(),g=e._reader.getUint16(),l=e._reader.pos;e._reader.pos=B+e._DATA.offset;for(var o=0;o<g;o++)e._strings[o]=e._reader.readUTFString();e._reader.pos=l},e.parse=function(B,g){e._animationClip=B;(e._reader=g).__getBuffer();e.READ_DATA(),e.READ_BLOCK(),e.READ_STRINGS();for(var l=0,o=e._BLOCK.count;l<o;l++){var V=g.getUint16(),U=e._strings[V],y=e["READ_"+U];if(null==y)throw new Error("model file err,no this function:"+V+" "+U);y.call()}},e.READ_ANIMATIONS=function(){var B,g=0,l=0,o=e._reader,V=o.__getBuffer(),U=[],y=o.getUint8();for(U.length=y,g=0;g<y;g++)U[g]=o.getUint16();var G=[],d=o.getUint16();for(G.length=d,g=0;g<d;g++)G[g]=o.getFloat32();var j=e._animationClip;j.name=e._strings[o.getUint16()];var A=j._duration=o.getFloat32();j.islooping=!!o.getByte(),j._frameRate=o.getInt16();var H=o.getInt16(),K=j._nodes=new Array;K.length=H,(j._publicClipDatas=[]).length=H;var p=j._nodesMap={},x=0,N=0;for(g=0;g<H;g++){B=K[g]=new T;var F=o.getUint16(),C=B.path=[];for(C.length=F,l=0;l<F;l++)C[l]=e._strings[o.getUint16()];var m=C.join("/"),M=p[m];M||(p[m]=M=[]),M.push(B);var b=o.getInt16();-1!==b&&(B.componentType=e._strings[b]);var D=r._propertyIndexDic[e._strings[o.getUint16()]];if(null==D)throw new Error("AnimationClipParser01:unknown property name.");var v=D<4,s=!v||v&&""===C[0];(B._cacheProperty=s)?x++:N++,B.propertyNameID=D;var X=U[o.getUint8()];B.keyFrameWidth=X/4;var w=B.keyFrames=[],i=w.length=o.getUint16(),a=null,z=NaN;for(l=0;l<i;l++){var t=w[l]=new Z;z=t.startTime=G[o.getUint16()];var h=o.pos;t.inTangent=new Float32Array(V.slice(h,h+X)),o.pos+=X,h=o.pos,t.outTangent=new Float32Array(V.slice(h,h+X)),o.pos+=X,h=o.pos,t.data=new Float32Array(V.slice(h,h+X)),o.pos+=X,a&&(a.next=t,a.duration=z-a.startTime),a=t}t.next=null,t.duration=A-z}var f=j._nodeToCachePropertyMap=new Int32Array(H),S=j._cachePropertyMap=new Int32Array(x),E=j._unCachePropertyMap=new Int32Array(N);for(x=N=0,g=0;g<H;g++)(B=K[g])._cacheProperty?(f[g]=x,S[x++]=g):E[N++]=g},e._animationClip=null,e._reader=null,e._strings=[],H(e,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function Y(){}p(Y,"laya.d3.animation.AnimationClipParser02"),Y.READ_DATA=function(){Y._DATA.offset=Y._reader.getUint32(),Y._DATA.size=Y._reader.getUint32()},Y.READ_BLOCK=function(){for(var B=Y._BLOCK.count=Y._reader.getUint16(),g=Y._BLOCK.blockStarts=[],l=Y._BLOCK.blockLengths=[],o=0;o<B;o++)g.push(Y._reader.getUint32()),l.push(Y._reader.getUint32())},Y.READ_STRINGS=function(){var B=Y._reader.getUint32(),g=Y._reader.getUint16(),l=Y._reader.pos;Y._reader.pos=B+Y._DATA.offset;for(var o=0;o<g;o++)Y._strings[o]=Y._reader.readUTFString();Y._reader.pos=l},Y.parse=function(B,g){Y._animationClip=B;(Y._reader=g).__getBuffer();Y.READ_DATA(),Y.READ_BLOCK(),Y.READ_STRINGS();for(var l=0,o=Y._BLOCK.count;l<o;l++){var V=g.getUint16(),U=Y._strings[V],y=Y["READ_"+U];if(null==y)throw new Error("model file err,no this function:"+V+" "+U);y.call()}},Y.READ_ANIMATIONS=function(){var B,g=0,l=0,o=Y._reader,V=o.__getBuffer(),U=[],y=o.getUint8();for(U.length=y,g=0;g<y;g++)U[g]=o.getUint16();var G=[],d=o.getUint16();for(G.length=d,g=0;g<d;g++)G[g]=o.getFloat32();var j=Y._animationClip;j.name=Y._strings[o.getUint16()];var A=j._duration=o.getFloat32();j.islooping=!!o.getByte(),j._frameRate=o.getInt16();var H=o.getInt16(),K=j._nodes=new Array;K.length=H,(j._publicClipDatas=[]).length=H;var p=j._nodesMap={},x=0,N=0;for(g=0;g<H;g++){B=K[g]=new T;var F=o.getUint16(),C=B.path=[];for(C.length=F,l=0;l<F;l++)C[l]=Y._strings[o.getUint16()];var m=C.join("/"),M=p[m];M||(p[m]=M=[]),M.push(B);var b=o.getInt16();-1!==b&&(B.componentType=Y._strings[b]);var D=r._propertyIndexDic[Y._strings[o.getUint16()]];if(null==D)throw new Error("AnimationClipParser02:unknown property name.");var v=D<4,s=!v||v&&""===C[0];(B._cacheProperty=s)?x++:N++,B.propertyNameID=D;var X=U[o.getUint8()];B.keyFrameWidth=X/4;var w=B.keyFrames=[],i=w.length=o.getUint16(),a=null,z=NaN;for(l=0;l<i;l++){var t=w[l]=new Z;z=t.startTime=G[o.getUint16()];var h=o.pos;t.inTangent=new Float32Array(V.slice(h,h+X)),o.pos+=X,h=o.pos,t.outTangent=new Float32Array(V.slice(h,h+X)),o.pos+=X,h=o.pos,t.data=new Float32Array(V.slice(h,h+X)),o.pos+=X,a&&(a.next=t,a.duration=z-a.startTime),a=t}t.next=null,t.duration=A-z}var f=o.getUint16();for(g=0;g<f;g++){var S,E=new c;E.time=o.getFloat32(),E.eventName=Y._strings[o.getUint16()];var e=o.getUint16();for(0<e&&(E.params=S=[]),l=0;l<e;l++){switch(o.getByte()){case 0:S.push(!!o.getByte());break;case 1:S.push(o.getInt32());break;case 2:S.push(o.getFloat32());break;case 3:S.push(Y._strings[o.getUint16()]);break;default:throw new Error("unknown type.")}}j.addEvent(E)}var Q=j._nodeToCachePropertyMap=new Int32Array(H),_=j._cachePropertyMap=new Int32Array(x),P=j._unCachePropertyMap=new Int32Array(N);for(x=N=0,g=0;g<H;g++)(B=K[g])._cacheProperty?(Q[g]=x,_[x++]=g):P[N++]=g},Y._animationClip=null,Y._reader=null,Y._strings=[],H(Y,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var c=function(){function B(){this.time=NaN,this.eventName=null,this.params=null}return p(B,"laya.d3.animation.AnimationEvent"),B}(),r=function(){function o(){this._childs=[],this.transform=new mg(this)}p(o,"laya.d3.animation.AnimationNode");var B=o.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.addChild=function(B){B._parent=this,B.transform.setParent(this.transform),this._childs.push(B)},B.removeChild=function(B){var g=this._childs.indexOf(B);-1!==g&&this._childs.splice(g,1)},B.getChildByName=function(B){for(var g=0,l=this._childs.length;g<l;g++){var o=this._childs[g];if(o.name===B)return o}return null},B.getChildByIndex=function(B){return this._childs[B]},B.getChildCount=function(){return this._childs.length},B.cloneTo=function(B){var g=B;g.name=this.name;for(var l=0,o=this._childs.length;l<o;l++){var V=this._childs[l],U=V.clone();g.addChild(U);var y=V.transform,G=U.transform;G.setLocalPosition(y.getLocalPosition()),G.setLocalRotation(y.getLocalRotation()),G.setLocalScale(y.getLocalScale()),G._localRotationEuler=y._localRotationEuler,G._setWorldMatrixIgnoreUpdate(y.getWorldMatrix())}},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},o.__init__=function(){o.registerAnimationNodeProperty("localPosition",o._getLocalPosition,o._setLocalPosition),o.registerAnimationNodeProperty("localRotation",o._getLocalRotation,o._setLocalRotation),o.registerAnimationNodeProperty("localScale",o._getLocalScale,o._setLocalScale),o.registerAnimationNodeProperty("localRotationEuler",o._getLocalRotationEuler,o._setLocalRotationEuler),o.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",o._getParticleRenderSharedMaterialTintColor,o._setParticleRenderSharedMaterialTintColor),o.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",o._getMeshRenderSharedMaterialTilingOffset,o._setMeshRenderSharedMaterialTilingOffset),o.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",o._getMeshRenderSharedMaterialAlbedo,o._setMeshRenderSharedMaterialAlbedo),o.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",o._getSkinnedMeshRenderSharedMaterialTilingOffset,o._setSkinnedMeshRenderSharedMaterialTilingOffset),o.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",o._getSkinnedMeshRenderSharedMaterialAlbedo,o._setSkinnedMeshRenderSharedMaterialAlbedo),o.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",o._getMeshRenderSharedMaterialAlbedo,o._setMeshRenderSharedMaterialAlbedo),o.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",o._getSkinnedMeshRenderSharedMaterialAlbedo,o._setSkinnedMeshRenderSharedMaterialAlbedo),o.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",o._getMeshRenderSharedMaterialIntensity,o._setMeshRenderSharedMaterialIntensity),o.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",o._getMeshRenderSharedMaterialAlpha,o._setMeshRenderSharedMaterialAlpha),o.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",o._getMeshRenderSharedMaterialAlphaColor,o._setMeshRenderSharedMaterialAlphaColor),o.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",o._getMeshRenderSharedMaterialBaseColor,o._setMeshRenderSharedMaterialBaseColor),o.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",o._getMeshRenderSharedMaterialDissolve,o._setMeshRenderSharedMaterialDissolve),o.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",o._getMeshRenderSharedMaterialDissolveSpeed,o._setMeshRenderSharedMaterialDissolveSpeed),o.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",o._getMeshRenderSharedMaterialMMultiplier,o._setMeshRenderSharedMaterialMMultiplier),o.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",o._getMeshRenderSharedMaterialBaseScrollSpeedX,o._setMeshRenderSharedMaterialBaseScrollSpeedX),o.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",o._getMeshRenderSharedMaterialBaseScrollSpeedY,o._setMeshRenderSharedMaterialBaseScrollSpeedY),o.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",o._getMeshRenderSharedMaterialSecondScrollSpeedX,o._setMeshRenderSharedMaterialSecondScrollSpeedX),o.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",o._getMeshRenderSharedMaterialSecondScrollSpeedY,o._setMeshRenderSharedMaterialSecondScrollSpeedY),o.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",o._getMeshRenderSharedMaterialDetailTilingOffset,o._setMeshRenderSharedMaterialDetailTilingOffset),o.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",o._getMeshRenderSharedMaterialDissolveTilingOffset,o._setMeshRenderSharedMaterialDissolveTilingOffset),o.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",o._getMeshRenderSharedMaterialMaskTilingOffset,o._setMeshRenderSharedMaterialMaskTilingOffset)},o.registerAnimationNodeProperty=function(B,g,l){if(o._propertyIndexDic[B])throw new Error("AnimationNode: this propertyName has registered.");o._propertyIndexDic[B]=o._propertyIDCounter,o._propertyGetFuncs[o._propertyIDCounter]=g,o._propertySetFuncs[o._propertyIDCounter]=l,o._propertyIDCounter++},o._getLocalPosition=function(B,g){return B?B.transform.getLocalPosition():g._transform.localPosition.elements},o._setLocalPosition=function(B,g,l){if(B)B.transform.setLocalPosition(l);else{var o=g._transform,V=o.localPosition;V.elements=l,o.localPosition=V}},o._getLocalRotation=function(B,g){return B?B.transform.getLocalRotation():g._transform.localRotation.elements},o._setLocalRotation=function(B,g,l){if(B)B.transform.setLocalRotation(l);else{var o=g._transform,V=o.localRotation;V.elements=l,o.localRotation=V}},o._getLocalScale=function(B,g){return B?B.transform.getLocalScale():g._transform.localScale.elements},o._setLocalScale=function(B,g,l){if(B)B.transform.setLocalScale(l);else{var o=g._transform,V=o.localScale;V.elements=l,o.localScale=V}},o._getLocalRotationEuler=function(B,g){return B?B.transform.getLocalRotationEuler():g._transform.localRotationEuler.elements},o._setLocalRotationEuler=function(B,g,l){if(B)B.transform.setLocalRotationEuler(l);else{var o=g._transform,V=o.localRotationEuler;V.elements=l,o.localRotationEuler=V}},o._getMeshRenderSharedMaterialTilingOffset=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return g.meshRender.sharedMaterial.tilingOffset.elements},o._setMeshRenderSharedMaterialTilingOffset=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).tilingOffset).elements=l,o.tilingOffset=V)}else(V=(o=g.meshRender.material).tilingOffset).elements=l,o.tilingOffset=V},o._getMeshRenderSharedMaterialAlbedo=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.albedoColor.elements:null}return g.meshRender.sharedMaterial.albedoColor.elements},o._setMeshRenderSharedMaterialAlbedo=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).albedoColor).elements=l,o.albedoColor=V)}else(V=(o=g.meshRender.material).albedoColor).elements=l,o.albedoColor=V},o._getSkinnedMeshRenderSharedMaterialTilingOffset=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return g.skinnedMeshRender.sharedMaterial.tilingOffset.elements},o._setSkinnedMeshRenderSharedMaterialTilingOffset=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.skinnedMeshRender.material).tilingOffset).elements=l,o.tilingOffset=V)}else(V=(o=g.skinnedMeshRender.material).tilingOffset).elements=l,o.tilingOffset=V},o._getSkinnedMeshRenderSharedMaterialAlbedo=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return g.skinnedMeshRender.sharedMaterial.albedoColor.elements},o._setSkinnedMeshRenderSharedMaterialAlbedo=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.skinnedMeshRender.material).albedoColor).elements=l,o.albedoColor=V)}else(V=(o=g.skinnedMeshRender.material).albedoColor).elements=l,o.albedoColor=V},o._getParticleRenderSharedMaterialTintColor=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.particleRender.sharedMaterial.tintColor.elements:null}return g.particleRender.sharedMaterial.tintColor.elements},o._setParticleRenderSharedMaterialTintColor=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.particleRender.material).tintColor).elements=l,o.tintColor=V)}else(V=(o=g.particleRender.material).tintColor).elements=l,o.tintColor=V},o._getMeshRenderSharedMaterialAlphaColor=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.alphaColor.elements:null}return g.meshRender.sharedMaterial.alphaColor.elements},o._setMeshRenderSharedMaterialAlphaColor=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).alphaColor).elements=l,o.alphaColor=V)}else(V=(o=g.meshRender.material).alphaColor).elements=l,o.alphaColor=V},o._getMeshRenderSharedMaterialBaseColor=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.baseColor.elements:null}return g.meshRender.sharedMaterial.baseColor.elements},o._setMeshRenderSharedMaterialBaseColor=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).baseColor).elements=l,o.baseColor=V)}else(V=(o=g.meshRender.material).baseColor).elements=l,o.baseColor=V},o._getMeshRenderSharedMaterialDissolve=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.dissolve:0}return g.meshRender.sharedMaterial.dissolve},o._setMeshRenderSharedMaterialDissolve=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.dissolve=l[0])}else g.meshRender.material.dissolve=l[0]},o._getMeshRenderSharedMaterialDissolveSpeed=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.dissolveSpeed:0}return g.meshRender.sharedMaterial.dissolveSpeed},o._setMeshRenderSharedMaterialDissolveSpeed=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.dissolveSpeed=l[0])}else g.meshRender.material.dissolveSpeed=l[0]},o._getMeshRenderSharedMaterialMMultiplier=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.mMultiplier:0}return g.meshRender.sharedMaterial.mMultiplier},o._setMeshRenderSharedMaterialMMultiplier=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.mMultiplier=l[0])}else g.meshRender.material.mMultiplier=l[0]},o._getMeshRenderSharedMaterialBaseScrollSpeedX=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return g.meshRender.sharedMaterial.baseScrollSpeedX},o._setMeshRenderSharedMaterialBaseScrollSpeedX=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.baseScrollSpeedX=l[0])}else g.meshRender.material.baseScrollSpeedX=l[0]},o._getMeshRenderSharedMaterialBaseScrollSpeedY=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return g.meshRender.sharedMaterial.baseScrollSpeedY},o._setMeshRenderSharedMaterialBaseScrollSpeedY=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.baseScrollSpeedY=l[0])}else g.meshRender.material.baseScrollSpeedY=l[0]},o._getMeshRenderSharedMaterialSecondScrollSpeedX=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return g.meshRender.sharedMaterial.secondScrollSpeedX},o._setMeshRenderSharedMaterialSecondScrollSpeedX=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.secondScrollSpeedX=l[0])}else g.meshRender.material.secondScrollSpeedX=l[0]},o._getMeshRenderSharedMaterialSecondScrollSpeedY=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return g.meshRender.sharedMaterial.secondScrollSpeedY},o._setMeshRenderSharedMaterialSecondScrollSpeedY=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.secondScrollSpeedY=l[0])}else g.meshRender.material.secondScrollSpeedY=l[0]},o._getMeshRenderSharedMaterialAlpha=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.alpha:0}return g.meshRender.sharedMaterial.alpha},o._setMeshRenderSharedMaterialAlpha=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.alpha=l[0])}else g.meshRender.material.alpha=l[0]},o._getMeshRenderSharedMaterialIntensity=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.intensity:0}return g.meshRender.sharedMaterial.intensity},o._setMeshRenderSharedMaterialIntensity=function(B,g,l){if(B){var o=B.transform._entity;o&&(o.owner.meshRender.material.intensity=l[0])}else g.meshRender.material.intensity=l[0]},o._getMeshRenderSharedMaterialDetailTilingOffset=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return g.meshRender.sharedMaterial.detailTilingOffset.elements},o._setMeshRenderSharedMaterialDetailTilingOffset=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).detailTilingOffset).elements=l,o.detailTilingOffset=V)}else(V=(o=g.meshRender.material).detailTilingOffset).elements=l,o.detailTilingOffset=V},o._getMeshRenderSharedMaterialDissolveTilingOffset=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return g.meshRender.sharedMaterial.dissolveTilingOffset.elements},o._setMeshRenderSharedMaterialDissolveTilingOffset=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).dissolveTilingOffset).elements=l,o.dissolveTilingOffset=V)}else(V=(o=g.meshRender.material).dissolveTilingOffset).elements=l,o.dissolveTilingOffset=V},o._getMeshRenderSharedMaterialMaskTilingOffset=function(B,g){if(B){var l=B.transform._entity;return l?l.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return g.meshRender.sharedMaterial.maskTilingOffset.elements},o._setMeshRenderSharedMaterialMaskTilingOffset=function(B,g,l){var o,V;if(B){var U=B.transform._entity;U&&((V=(o=U.owner.meshRender.material).maskTilingOffset).elements=l,o.maskTilingOffset=V)}else(V=(o=g.meshRender.material).maskTilingOffset).elements=l,o.maskTilingOffset=V},o._propertyIDCounter=0,o._propertyIndexDic={},o._propertySetFuncs=[],o._propertyGetFuncs=[],o}(),Z=function(){function B(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return p(B,"laya.d3.animation.Keyframe"),B}(),T=function(){function B(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return p(B,"laya.d3.animation.KeyframeNode"),B}(),S=(function(){function B(){this._tempVector30=new yg,this._tempVector31=new yg,this._tempVector32=new yg,this._a=new yg,this._b=new yg,this._c=new yg,this._d=new yg}p(B,"laya.d3.core.glitter.SplineCurvePositionVelocity");var g=B.prototype;g.Init=function(B,g,l,o){B.cloneTo(this._d),g.cloneTo(this._c),yg.scale(B,2,this._a),yg.scale(l,2,this._tempVector30),yg.subtract(this._a,this._tempVector30,this._a),yg.add(this._a,g,this._a),yg.add(this._a,o,this._a),yg.scale(l,3,this._b),yg.scale(B,3,this._tempVector30),yg.subtract(this._b,this._tempVector30,this._b),yg.subtract(this._b,o,this._b),yg.scale(g,2,this._tempVector30),yg.subtract(this._b,this._tempVector30,this._b)},g.Slerp=function(B,g){yg.scale(this._a,B*B*B,this._tempVector30),yg.scale(this._b,B*B,this._tempVector31),yg.scale(this._c,B,this._tempVector32),yg.add(this._tempVector30,this._tempVector31,g),yg.add(g,this._tempVector32,g),yg.add(g,this._d,g)}}(),function(){function _(B,g,l,o){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=B,this._h=g,this._minHeight=l,this._maxHeight=o}p(_,"laya.d3.core.HeightMap");var B=_.prototype;B._inBounds=function(B,g){return 0<=B&&B<this._h&&0<=g&&g<this._w},B.getHeight=function(B,g){return this._inBounds(B,g)?this._datas[B][g]:NaN},x(0,B,"width",function(){return this._w}),x(0,B,"height",function(){return this._h}),x(0,B,"maxHeight",function(){return this._maxHeight}),x(0,B,"minHeight",function(){return this._minHeight}),_.creatFromMesh=function(B,g,l,o){for(var V=[],U=[],y=B.getSubMeshCount(),G=0;G<y;G++){for(var d=B.getSubMesh(G),j=d._getVertexBuffer(),A=j.getData(),H=[],K=0;K<A.length;K+=j.vertexDeclaration.vertexStride/4){var p=new yg(A[K+0],A[K+1],A[K+2]);H.push(p)}V.push(H);var x=d._getIndexBuffer();U.push(x.getData())}var N=B.boundingBox,F=N.min.x,C=N.min.z,m=N.max.x,M=N.max.z,b=N.min.y,D=N.max.y,v=m-F,s=M-C,X=o.elements[0]=v/(g-1),w=o.elements[1]=s/(l-1),i=new _(g,l,b,D),a=_._tempRay,z=a.direction.elements;z[0]=0,z[1]=-1,z[2]=0;var t=D+.1;a.origin.elements[1]=t;for(var h=0;h<l;h++){var f=C+h*w;i._datas[h]=[];for(var S=0;S<g;S++){var E=F+S*X,e=a.origin.elements;e[0]=E,e[2]=f;var Q=_._getPosition(a,V,U);i._datas[h][S]=Q===Number.MAX_VALUE?NaN:t-Q}}return i},_.createFromImage=function(B,g,l){for(var o=B.width,V=B.height,U=new _(o,V,g,l),y=(l-g)/254,G=B.getPixels(),d=0,j=0;j<V;j++)for(var A=U._datas[j]=[],H=0;H<o;H++){var K=G[d++],p=G[d++],x=G[d++],N=G[d++];A[H]=255==K&&255==p&&255==x&&255==N?NaN:(K+p+x)/3*y+g}return U},_._getPosition=function(B,g,l){for(var o=Number.MAX_VALUE,V=0;V<g.length;V++)for(var U=g[V],y=l[V],G=0;G<y.length;G+=3){var d=U[y[G+0]],j=U[y[G+1]],A=U[y[G+2]],H=xg.rayIntersectsTriangle(B,d,j,A);!isNaN(H)&&H<o&&(o=H)}return o},H(_,["_tempRay",function(){return this._tempRay=new Vg(new yg,new yg)}])}(),function(){function V(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}p(V,"laya.d3.core.Layer");var B=V.prototype;return B._binarySearchIndex=function(){for(var B=0,g=V._collsionTestList.length-1,l=0;B<=g;){l=Math.floor((B+g)/2);var o=V._collsionTestList[l];if(o==this._number)return l;o>this._number?g=l-1:B=l+1}return B},B._addCollider=function(B){0===this._colliders.length&&V._collsionTestList.splice(this._binarySearchIndex(),0,this._number),B._isRigidbody?(this._colliders.unshift(B),this._nonRigidbodyOffset++):this._colliders.push(B)},B._removeCollider=function(B){var g=this._colliders.indexOf(B);g<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(g,1),0===this._colliders.length&&V._collsionTestList.splice(V._collsionTestList.indexOf(this._number),1)},x(0,B,"number",function(){return this._number}),x(0,B,"visible",function(){return this._visible},function(B){this._visible=B,V._visibleLayers=B?V._visibleLayers|this.mask:V._visibleLayers&~this.mask}),x(0,B,"mask",function(){return this._mask}),x(1,V,"visibleLayers",function(){return V._visibleLayers},function(B){V._visibleLayers=B;for(var g=0,l=V._layerList.length;g<l;g++){var o=V._layerList[g];o._visible=0!=(o._mask&V._visibleLayers)}}),V.__init__=function(){V._layerList.length=31;for(var B=0;B<31;B++){var g=new V;V._layerList[B]=g,0===B?(g.name="Default Layer",g.visible=!0):(g.name="Layer-"+B,g.visible=!1),g._number=B,g._mask=Math.pow(2,B)}V.currentCreationLayer=V._layerList[0]},V.getLayerByNumber=function(B){if(B<0||30<B)throw new Error("无法返回指定Layer，该number超出范围！");return V._layerList[B]},V.getLayerByName=function(B){for(var g=0;g<31;g++)if(V._layerList[g].name===B)return V._layerList[g];throw new Error("无法返回指定Layer,该name不存在")},V.isVisible=function(B){return 0!=(B&V._currentCameraCullingMask&V._visibleLayers)},V._layerList=[],V._visibleLayers=2147483647,V._collsionTestList=[],V._currentCameraCullingMask=2147483647,V.maxCount=31,V.currentCreationLayer=null,V}()),E=(function(){function B(B,g,l){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=B,this._minCount=g,this._maxCount=l}p(B,"laya.d3.core.particleShuriKen.module.Burst");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.cloneTo=function(B){var g=B;g._time=this._time,g._minCount=this._minCount,g._maxCount=this._maxCount},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"time",function(){return this._time}),x(0,g,"minCount",function(){return this._minCount}),x(0,g,"maxCount",function(){return this._maxCount})}(),function(){function B(B){this._color=null,this.enbale=!1,this._color=B}p(B,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var g=B.prototype;g.cloneTo=function(B){var g=B;this._color.cloneTo(g._color),g.enbale=this.enbale},g.clone=function(){var B;switch(this._color.type){case 0:B=Q.createByConstant(this._color.constant.clone());break;case 1:B=Q.createByGradient(this._color.gradient.clone());break;case 2:B=Q.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:B=Q.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var g=new this.constructor(B);return g.enbale=this.enbale,g},x(0,g,"color",function(){return this._color})}(),function(){function B(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}p(B,"laya.d3.core.particleShuriKen.module.Emission");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),g._destroy=function(){this._bursts=null,this._destroyed=!0},g.getBurstsCount=function(){return this._bursts.length},g.getBurstByIndex=function(B){return this._bursts[B]},g.addBurst=function(B){var g=this._bursts.length;if(0<g)for(var l=0;l<g;l++)this._bursts[l].time>B.time&&this._bursts.splice(l,0,B);this._bursts.push(B)},g.removeBurst=function(B){var g=this._bursts.indexOf(B);-1!==g&&this._bursts.splice(g,1)},g.removeBurstByIndex=function(B){this._bursts.splice(B,1)},g.clearBurst=function(){this._bursts.length=0},g.cloneTo=function(B){var g=B,l=g._bursts;l.length=this._bursts.length;for(var o=0,V=this._bursts.length;o<V;o++){var U=l[o];U?this._bursts[o].cloneTo(U):l[o]=this._bursts[o].clone()}g._emissionRate=this._emissionRate,g.enbale=this.enbale},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"destroyed",function(){return this._destroyed}),x(0,g,"emissionRate",function(){return this._emissionRate},function(B){if(B<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=B})}(),function(){function o(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}p(o,"laya.d3.core.particleShuriKen.module.FrameOverTime");var B=o.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.cloneTo=function(B){var g=B;g._type=this._type,g._constant=this._constant,this._overTime.cloneTo(g._overTime),g._constantMin=this._constantMin,g._constantMax=this._constantMax,this._overTimeMin.cloneTo(g._overTimeMin),this._overTimeMax.cloneTo(g._overTimeMax)},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,B,"frameOverTimeData",function(){return this._overTime}),x(0,B,"constant",function(){return this._constant}),x(0,B,"type",function(){return this._type}),x(0,B,"frameOverTimeDataMin",function(){return this._overTimeMin}),x(0,B,"constantMin",function(){return this._constantMin}),x(0,B,"frameOverTimeDataMax",function(){return this._overTimeMax}),x(0,B,"constantMax",function(){return this._constantMax}),o.createByConstant=function(B){var g=new o;return g._type=0,g._constant=B,g},o.createByOverTime=function(B){var g=new o;return g._type=1,g._overTime=B,g},o.createByRandomTwoConstant=function(B,g){var l=new o;return l._type=2,l._constantMin=B,l._constantMax=g,l},o.createByRandomTwoOverTime=function(B,g){var l=new o;return l._type=3,l._overTimeMin=B,l._overTimeMax=g,l},o}()),e=function(){function j(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}p(j,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var B=j.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.cloneTo=function(B){var g=B;g._type=this._type,g._separateAxes=this._separateAxes,g._constant=this._constant,this._constantSeparate.cloneTo(g._constantSeparate),this._gradient.cloneTo(g._gradient),this._gradientX.cloneTo(g._gradientX),this._gradientY.cloneTo(g._gradientY),this._gradientZ.cloneTo(g._gradientZ),g._constantMin=this._constantMin,g._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(g._constantMinSeparate),this._constantMaxSeparate.cloneTo(g._constantMaxSeparate),this._gradientMin.cloneTo(g._gradientMin),this._gradientMax.cloneTo(g._gradientMax),this._gradientXMin.cloneTo(g._gradientXMin),this._gradientXMax.cloneTo(g._gradientXMax),this._gradientYMin.cloneTo(g._gradientYMin),this._gradientYMax.cloneTo(g._gradientYMax),this._gradientZMin.cloneTo(g._gradientZMin),this._gradientZMax.cloneTo(g._gradientZMax)},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,B,"gradientZ",function(){return this._gradientZ}),x(0,B,"constant",function(){return this._constant}),x(0,B,"gradient",function(){return this._gradient}),x(0,B,"separateAxes",function(){return this._separateAxes}),x(0,B,"type",function(){return this._type}),x(0,B,"constantSeparate",function(){return this._constantSeparate}),x(0,B,"gradientX",function(){return this._gradientX}),x(0,B,"gradientY",function(){return this._gradientY}),x(0,B,"gradientW",function(){return this._gradientW}),x(0,B,"gradientMin",function(){return this._gradientMin}),x(0,B,"constantMin",function(){return this._constantMin}),x(0,B,"gradientMax",function(){return this._gradientMax}),x(0,B,"constantMax",function(){return this._constantMax}),x(0,B,"gradientWMin",function(){return this._gradientWMin}),x(0,B,"constantMinSeparate",function(){return this._constantMinSeparate}),x(0,B,"constantMaxSeparate",function(){return this._constantMaxSeparate}),x(0,B,"gradientXMin",function(){return this._gradientXMin}),x(0,B,"gradientXMax",function(){return this._gradientXMax}),x(0,B,"gradientWMax",function(){return this._gradientWMax}),x(0,B,"gradientYMin",function(){return this._gradientYMin}),x(0,B,"gradientYMax",function(){return this._gradientYMax}),x(0,B,"gradientZMin",function(){return this._gradientZMin}),x(0,B,"gradientZMax",function(){return this._gradientZMax}),j.createByConstant=function(B){var g=new j;return g._type=0,g._separateAxes=!1,g._constant=B,g},j.createByConstantSeparate=function(B){var g=new j;return g._type=0,g._separateAxes=!0,g._constantSeparate=B,g},j.createByGradient=function(B){var g=new j;return g._type=1,g._separateAxes=!1,g._gradient=B,g},j.createByGradientSeparate=function(B,g,l,o){var V=new j;return V._type=1,V._separateAxes=!0,V._gradientX=B,V._gradientY=g,V._gradientZ=l,V._gradientW=o,V},j.createByRandomTwoConstant=function(B,g){var l=new j;return l._type=2,l._separateAxes=!1,l._constantMin=B,l._constantMax=g,l},j.createByRandomTwoConstantSeparate=function(B,g){var l=new j;return l._type=2,l._separateAxes=!0,l._constantMinSeparate=B,l._constantMaxSeparate=g,l},j.createByRandomTwoGradient=function(B,g){var l=new j;return l._type=3,l._separateAxes=!1,l._gradientMin=B,l._gradientMax=g,l},j.createByRandomTwoGradientSeparate=function(B,g,l,o,V,U,y,G){var d=new j;return d._type=3,d._separateAxes=!0,d._gradientXMin=B,d._gradientXMax=g,d._gradientYMin=l,d._gradientYMax=o,d._gradientZMin=V,d._gradientZMax=U,d._gradientWMin=y,d._gradientWMax=G,d},j}(),Q=function(){function o(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}p(o,"laya.d3.core.particleShuriKen.module.GradientColor");var B=o.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.cloneTo=function(B){var g=B;g._type=this._type,this._constant.cloneTo(g._constant),this._constantMin.cloneTo(g._constantMin),this._constantMax.cloneTo(g._constantMax),this._gradient.cloneTo(g._gradient),this._gradientMin.cloneTo(g._gradientMin),this._gradientMax.cloneTo(g._gradientMax)},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,B,"gradient",function(){return this._gradient}),x(0,B,"constant",function(){return this._constant}),x(0,B,"type",function(){return this._type}),x(0,B,"gradientMin",function(){return this._gradientMin}),x(0,B,"constantMin",function(){return this._constantMin}),x(0,B,"gradientMax",function(){return this._gradientMax}),x(0,B,"constantMax",function(){return this._constantMax}),o.createByConstant=function(B){var g=new o;return g._type=0,g._constant=B,g},o.createByGradient=function(B){var g=new o;return g._type=1,g._gradient=B,g},o.createByRandomTwoConstant=function(B,g){var l=new o;return l._type=2,l._constantMin=B,l._constantMax=g,l},o.createByRandomTwoGradient=function(B,g){var l=new o;return l._type=3,l._gradientMin=B,l._gradientMax=g,l},o}(),_=(function(){function B(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}p(B,"laya.d3.core.particleShuriKen.module.GradientDataColor");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.addAlpha=function(B,g){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==B&&(B=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=B,this._alphaElements[this._alphaCurrentLength++]=g):DEBUG},g.addRGB=function(B,g){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==B&&(B=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=B,this._rgbElements[this._rgbCurrentLength++]=g.x,this._rgbElements[this._rgbCurrentLength++]=g.y,this._rgbElements[this._rgbCurrentLength++]=g.z):DEBUG},g.cloneTo=function(B){var g=B,l=0,o=0;g._alphaCurrentLength=this._alphaCurrentLength;var V=g._alphaElements;for(V.length=this._alphaElements.length,l=0,o=this._alphaElements.length;l<o;l++)V[l]=this._alphaElements[l];g._rgbCurrentLength=this._rgbCurrentLength;var U=g._rgbElements;for(U.length=this._rgbElements.length,l=0,o=this._rgbElements.length;l<o;l++)U[l]=this._rgbElements[l]},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),x(0,g,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function B(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}p(B,"laya.d3.core.particleShuriKen.module.GradientDataInt");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.add=function(B,g){this._currentLength<8?(6===this._currentLength&&1!==B&&(B=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=B,this._elements[this._currentLength++]=g):console.log("Warning:data count must lessEqual than 4")},g.cloneTo=function(B){var g=B;g._currentLength=this._currentLength;var l=g._elements;l.length=this._elements.length;for(var o=0,V=this._elements.length;o<V;o++)l[o]=this._elements[o]},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"gradientCount",function(){return this._currentLength/2})}(),function(){function B(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}p(B,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.add=function(B,g){this._currentLength<8?(6===this._currentLength&&1!==B&&(B=1,DEBUG),this._elements[this._currentLength++]=B,this._elements[this._currentLength++]=g):DEBUG},g.getKeyByIndex=function(B){return this._elements[2*B]},g.getValueByIndex=function(B){return this._elements[2*B+1]},g.getAverageValue=function(){for(var B=0,g=this._currentLength-2;B<g;B+=2){this._elements[B+1];this._elements[B+3],this._elements[B+2]-this._elements[B]}return 0},g.cloneTo=function(B){var g=B;g._currentLength=this._currentLength;var l=g._elements;l.length=this._elements.length;for(var o=0,V=this._elements.length;o<V;o++)l[o]=this._elements[o]},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"gradientCount",function(){return this._currentLength/2})}(),function(){function B(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}p(B,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.add=function(B,g){this._currentLength<8?(6===this._currentLength&&1!==B&&(B=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=B,this._elements[this._currentLength++]=g.x,this._elements[this._currentLength++]=g.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},g.cloneTo=function(B){var g=B;g._currentLength=this._currentLength;var l=g._elements;l.length=this._elements.length;for(var o=0,V=this._elements.length;o<V;o++)l[o]=this._elements[o]},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"gradientCount",function(){return this._currentLength/3})}(),function(){function G(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}p(G,"laya.d3.core.particleShuriKen.module.GradientSize");var B=G.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.getMaxSizeInGradient=function(){var B=0,g=0,l=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(B=0,g=this._gradientX.gradientCount;B<g;B++)l=Math.max(l,this._gradientX.getValueByIndex(B));for(B=0,g=this._gradientY.gradientCount;B<g;B++)l=Math.max(l,this._gradientY.getValueByIndex(B))}else for(B=0,g=this._gradient.gradientCount;B<g;B++)l=Math.max(l,this._gradient.getValueByIndex(B));break;case 1:l=this._separateAxes?(l=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),l=Math.max(l,this._constantMinSeparate.y),Math.max(l,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(B=0,g=this._gradientXMin.gradientCount;B<g;B++)l=Math.max(l,this._gradientXMin.getValueByIndex(B));for(B=0,g=this._gradientXMax.gradientCount;B<g;B++)l=Math.max(l,this._gradientXMax.getValueByIndex(B));for(B=0,g=this._gradientYMin.gradientCount;B<g;B++)l=Math.max(l,this._gradientYMin.getValueByIndex(B));for(B=0,g=this._gradientZMax.gradientCount;B<g;B++)l=Math.max(l,this._gradientZMax.getValueByIndex(B))}else{for(B=0,g=this._gradientMin.gradientCount;B<g;B++)l=Math.max(l,this._gradientMin.getValueByIndex(B));for(B=0,g=this._gradientMax.gradientCount;B<g;B++)l=Math.max(l,this._gradientMax.getValueByIndex(B))}}return l},B.cloneTo=function(B){var g=B;g._type=this._type,g._separateAxes=this._separateAxes,this._gradient.cloneTo(g._gradient),this._gradientX.cloneTo(g._gradientX),this._gradientY.cloneTo(g._gradientY),this._gradientZ.cloneTo(g._gradientZ),g._constantMin=this._constantMin,g._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(g._constantMinSeparate),this._constantMaxSeparate.cloneTo(g._constantMaxSeparate),this._gradientMin.cloneTo(g._gradientMin),this._gradientMax.cloneTo(g._gradientMax),this._gradientXMin.cloneTo(g._gradientXMin),this._gradientXMax.cloneTo(g._gradientXMax),this._gradientYMin.cloneTo(g._gradientYMin),this._gradientYMax.cloneTo(g._gradientYMax),this._gradientZMin.cloneTo(g._gradientZMin),this._gradientZMax.cloneTo(g._gradientZMax)},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,B,"gradientZ",function(){return this._gradientZ}),x(0,B,"gradient",function(){return this._gradient}),x(0,B,"separateAxes",function(){return this._separateAxes}),x(0,B,"type",function(){return this._type}),x(0,B,"gradientMin",function(){return this._gradientMin}),x(0,B,"constantMin",function(){return this._constantMin}),x(0,B,"gradientX",function(){return this._gradientX}),x(0,B,"gradientY",function(){return this._gradientY}),x(0,B,"gradientMax",function(){return this._gradientMax}),x(0,B,"constantMax",function(){return this._constantMax}),x(0,B,"constantMinSeparate",function(){return this._constantMinSeparate}),x(0,B,"constantMaxSeparate",function(){return this._constantMaxSeparate}),x(0,B,"gradientXMin",function(){return this._gradientXMin}),x(0,B,"gradientXMax",function(){return this._gradientXMax}),x(0,B,"gradientYMin",function(){return this._gradientYMin}),x(0,B,"gradientYMax",function(){return this._gradientYMax}),x(0,B,"gradientZMin",function(){return this._gradientZMin}),x(0,B,"gradientZMax",function(){return this._gradientZMax}),G.createByGradient=function(B){var g=new G;return g._type=0,g._separateAxes=!1,g._gradient=B,g},G.createByGradientSeparate=function(B,g,l){var o=new G;return o._type=0,o._separateAxes=!0,o._gradientX=B,o._gradientY=g,o._gradientZ=l,o},G.createByRandomTwoConstant=function(B,g){var l=new G;return l._type=1,l._separateAxes=!1,l._constantMin=B,l._constantMax=g,l},G.createByRandomTwoConstantSeparate=function(B,g){var l=new G;return l._type=1,l._separateAxes=!0,l._constantMinSeparate=B,l._constantMaxSeparate=g,l},G.createByRandomTwoGradient=function(B,g){var l=new G;return l._type=2,l._separateAxes=!1,l._gradientMin=B,l._gradientMax=g,l},G.createByRandomTwoGradientSeparate=function(B,g,l,o,V,U){var y=new G;return y._type=2,y._separateAxes=!0,y._gradientXMin=B,y._gradientXMax=g,y._gradientYMin=l,y._gradientYMax=o,y._gradientZMin=V,y._gradientZMax=U,y},G}()),P=function(){function G(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}p(G,"laya.d3.core.particleShuriKen.module.GradientVelocity");var B=G.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.cloneTo=function(B){var g=B;g._type=this._type,this._constant.cloneTo(g._constant),this._gradientX.cloneTo(g._gradientX),this._gradientY.cloneTo(g._gradientY),this._gradientZ.cloneTo(g._gradientZ),this._constantMin.cloneTo(g._constantMin),this._constantMax.cloneTo(g._constantMax),this._gradientXMin.cloneTo(g._gradientXMin),this._gradientXMax.cloneTo(g._gradientXMax),this._gradientYMin.cloneTo(g._gradientYMin),this._gradientYMax.cloneTo(g._gradientYMax),this._gradientZMin.cloneTo(g._gradientZMin),this._gradientZMax.cloneTo(g._gradientZMax)},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,B,"gradientZ",function(){return this._gradientZ}),x(0,B,"constant",function(){return this._constant}),x(0,B,"type",function(){return this._type}),x(0,B,"gradientXMax",function(){return this._gradientXMax}),x(0,B,"constantMin",function(){return this._constantMin}),x(0,B,"gradientX",function(){return this._gradientX}),x(0,B,"gradientY",function(){return this._gradientY}),x(0,B,"gradientXMin",function(){return this._gradientXMin}),x(0,B,"constantMax",function(){return this._constantMax}),x(0,B,"gradientYMin",function(){return this._gradientYMin}),x(0,B,"gradientYMax",function(){return this._gradientYMax}),x(0,B,"gradientZMin",function(){return this._gradientZMin}),x(0,B,"gradientZMax",function(){return this._gradientZMax}),G.createByConstant=function(B){var g=new G;return g._type=0,g._constant=B,g},G.createByGradient=function(B,g,l){var o=new G;return o._type=1,o._gradientX=B,o._gradientY=g,o._gradientZ=l,o},G.createByRandomTwoConstant=function(B,g){var l=new G;return l._type=2,l._constantMin=B,l._constantMax=g,l},G.createByRandomTwoGradient=function(B,g,l,o,V,U){var y=new G;return y._type=3,y._gradientXMin=B,y._gradientXMax=g,y._gradientYMin=l,y._gradientYMax=o,y._gradientZMin=V,y._gradientZMax=U,y},G}(),Y=(function(){function B(B){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=B}p(B,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.cloneTo=function(B){var g=B;this._angularVelocity.cloneTo(g._angularVelocity),g.enbale=this.enbale},g.clone=function(){var B;switch(this._angularVelocity.type){case 0:B=this._angularVelocity.separateAxes?e.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):e.createByConstant(this._angularVelocity.constant);break;case 1:B=this._angularVelocity.separateAxes?e.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):e.createByGradient(this._angularVelocity.gradient.clone());break;case 2:B=this._angularVelocity.separateAxes?e.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):e.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:B=this._angularVelocity.separateAxes?e.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):e.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var g=new this.constructor(B);return g.enbale=this.enbale,g},x(0,g,"angularVelocity",function(){return this._angularVelocity})}(),function(){function B(){this.enable=!1,this.randomDirection=!1}p(B,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var g=B.prototype;return D.imps(g,{"laya.d3.core.IClone":!0}),g._getShapeBoundBox=function(B){throw new Error("BaseShape: must override it.")},g._getSpeedBoundBox=function(B){throw new Error("BaseShape: must override it.")},g.generatePositionAndDirection=function(B,g,l,o){throw new Error("BaseShape: must override it.")},g._calculateProceduralBounds=function(B,g,l){this._getShapeBoundBox(B);var o=B.min,V=B.max;yg.multiply(o,g,o),yg.multiply(V,g,V);var U=new JB(new yg,new yg);this.randomDirection?(U.min=new yg(-1,-1,-1),U.max=new yg(1,1,1)):this._getSpeedBoundBox(U);var y=new JB(new yg,new yg),G=y.min,d=y.max;yg.scale(U.min,l.y,G),yg.scale(U.max,l.y,d),yg.add(B.min,G,G),yg.add(B.max,d,d),yg.min(B.min,G,B.min),yg.max(B.max,G,B.max);var j=new JB(new yg,new yg),A=j.min,H=j.max;yg.scale(U.min,l.x,A),yg.scale(U.max,l.x,H),yg.min(j.min,H,G),yg.max(j.min,H,d),yg.min(B.min,G,B.min),yg.max(B.max,G,B.max)},g.cloneTo=function(B){B.enable=this.enable},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},B}()),R=function(){function U(){}return p(U,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),U._randomPointUnitArcCircle=function(B,g,l){var o=g.elements,V=NaN;V=l?l.getFloat()*B:Math.random()*B,o[0]=Math.cos(V),o[1]=Math.sin(V)},U._randomPointInsideUnitArcCircle=function(B,g,l){var o=g.elements;U._randomPointUnitArcCircle(B,g,l);var V=NaN;V=l?Math.pow(l.getFloat(),.5):Math.pow(Math.random(),.5),o[0]=o[0]*V,o[1]=o[1]*V},U._randomPointUnitCircle=function(B,g){var l=B.elements,o=NaN;o=g?g.getFloat()*Math.PI*2:Math.random()*Math.PI*2,l[0]=Math.cos(o),l[1]=Math.sin(o)},U._randomPointInsideUnitCircle=function(B,g){var l=B.elements;U._randomPointUnitCircle(B);var o=NaN;o=g?Math.pow(g.getFloat(),.5):Math.pow(Math.random(),.5),l[0]=l[0]*o,l[1]=l[1]*o},U._randomPointUnitSphere=function(B,g){var l=B.elements,o=NaN,V=NaN;V=g?(o=l[2]=2*g.getFloat()-1,g.getFloat()*Math.PI*2):(o=l[2]=2*Math.random()-1,Math.random()*Math.PI*2);var U=Math.sqrt(1-o*o);l[0]=U*Math.cos(V),l[1]=U*Math.sin(V)},U._randomPointInsideUnitSphere=function(B,g){var l=B.elements;U._randomPointUnitSphere(B);var o=NaN;o=g?Math.pow(g.getFloat(),1/3):Math.pow(Math.random(),1/3),l[0]=l[0]*o,l[1]=l[1]*o,l[2]=l[2]*o},U._randomPointInsideHalfUnitBox=function(B,g){var l=B.elements;g?(l[0]=g.getFloat()-.5,l[1]=g.getFloat()-.5,l[2]=g.getFloat()-.5):(l[0]=Math.random()-.5,l[1]=Math.random()-.5,l[2]=Math.random()-.5)},U}(),W=(function(){function B(B){this._size=null,this.enbale=!1,this._size=B}p(B,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.cloneTo=function(B){var g=B;this._size.cloneTo(g._size),g.enbale=this.enbale},g.clone=function(){var B;switch(this._size.type){case 0:B=this._size.separateAxes?_.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):_.createByGradient(this._size.gradient.clone());break;case 1:B=this._size.separateAxes?_.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):_.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:B=this._size.separateAxes?_.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):_.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var g=new this.constructor(B);return g.enbale=this.enbale,g},x(0,g,"size",function(){return this._size})}(),function(){function o(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}p(o,"laya.d3.core.particleShuriKen.module.StartFrame");var B=o.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.cloneTo=function(B){var g=B;g._type=this._type,g._constant=this._constant,g._constantMin=this._constantMin,g._constantMax=this._constantMax},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,B,"constant",function(){return this._constant}),x(0,B,"type",function(){return this._type}),x(0,B,"constantMin",function(){return this._constantMin}),x(0,B,"constantMax",function(){return this._constantMax}),o.createByConstant=function(B){var g=new o;return g._type=0,g._constant=B,g},o.createByRandomTwoConstant=function(B,g){var l=new o;return l._type=1,l._constantMin=B,l._constantMax=g,l},o}()),n=(function(){function B(B,g){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new Ug(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=B,this._startFrame=g}p(B,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.cloneTo=function(B){var g=B;this.tiles.cloneTo(g.tiles),g.type=this.type,g.randomRow=this.randomRow,this._frame.cloneTo(g._frame),this._startFrame.cloneTo(g._startFrame),g.cycles=this.cycles,g.enableUVChannels=this.enableUVChannels,g.enable=this.enable},g.clone=function(){var B,g;switch(this._frame.type){case 0:B=E.createByConstant(this._frame.constant);break;case 1:B=E.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:B=E.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:B=E.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:g=W.createByConstant(this._startFrame.constant);break;case 1:g=W.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var l=new this.constructor(B,g);return this.tiles.cloneTo(l.tiles),l.type=this.type,l.randomRow=this.randomRow,l.cycles=this.cycles,l.enableUVChannels=this.enableUVChannels,l.enable=this.enable,l},x(0,g,"frame",function(){return this._frame}),x(0,g,"startFrame",function(){return this._startFrame})}(),function(){function B(B){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=B}p(B,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var g=B.prototype;D.imps(g,{"laya.d3.core.IClone":!0}),g.cloneTo=function(B){var g=B;this._velocity.cloneTo(g._velocity),g.enbale=this.enbale,g.space=this.space},g.clone=function(){var B;switch(this._velocity.type){case 0:B=P.createByConstant(this._velocity.constant.clone());break;case 1:B=P.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:B=P.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:B=P.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var g=new this.constructor(B);return g.enbale=this.enbale,g.space=this.space,g},x(0,g,"velocity",function(){return this._velocity})}(),function(){function B(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new Kg,this._vb=Yg.create(B._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=Pg.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Qg.nameKey.getID("LINE"),this._shaderCompile=Xg._preCompileShader[this._sharderNameID]}p(B,"laya.d3.core.PhasorSpriter3D");var g=B.prototype;return g.line=function(B,g,l,o){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(B.x,B.y,B.z,g.x,g.y,g.z,g.w),this.addVertex(l.x,l.y,l.z,o.x,o.y,o.z,o.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},g.circle=function(B,g,l,o,V,U){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*g,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/g,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*B,Math.cos(this._tempNumver0)*B,0,l,o,V,U),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},g.plane=function(B,g,l,o,V,U,y,G,d){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=o/2,this._tempNumver1=V/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(B-this._tempNumver0,g+this._tempNumver1,l,U,y,G,d),this.addVertex(B+this._tempNumver0,g+this._tempNumver1,l,U,y,G,d),this.addVertex(B-this._tempNumver0,g-this._tempNumver1,l,U,y,G,d),this.addVertex(B+this._tempNumver0,g-this._tempNumver1,l,U,y,G,d),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},g.box=function(B,g,l,o,V,U,y,G,d,j){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=o/2,this._tempNumver1=V/2,this._tempNumver2=U/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(B-this._tempNumver0,g+this._tempNumver1,l+this._tempNumver2,y,G,d,j),this.addVertex(B+this._tempNumver0,g+this._tempNumver1,l+this._tempNumver2,y,G,d,j),this.addVertex(B-this._tempNumver0,g-this._tempNumver1,l+this._tempNumver2,y,G,d,j),this.addVertex(B+this._tempNumver0,g-this._tempNumver1,l+this._tempNumver2,y,G,d,j),this.addVertex(B+this._tempNumver0,g+this._tempNumver1,l-this._tempNumver2,y,G,d,j),this.addVertex(B-this._tempNumver0,g+this._tempNumver1,l-this._tempNumver2,y,G,d,j),this.addVertex(B+this._tempNumver0,g-this._tempNumver1,l-this._tempNumver2,y,G,d,j),this.addVertex(B-this._tempNumver0,g-this._tempNumver1,l-this._tempNumver2,y,G,d,j),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},g.cone=function(B,g,l,o,V,U,y){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*l+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*l>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/l,this.addVertexIndex(0,g,0,o,V,U,y,this._tempUint0),this.addVertexIndex(0,0,0,o,V,U,y,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<l;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(B*this._tempNumver2,0,B*this._tempNumver3,o,V,U,y,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==l-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(B*this._tempNumver2,0,B*this._tempNumver3,o,V,U,y,this._tempUint0+(this._tempInt0+l)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==l-1?this.addIndexes(this._tempUint1+l+2):this.addIndexes(this._tempUint1+this._tempInt0+l+1),this.addIndexes(this._tempUint1+this._tempInt0+l),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},g.boundingBoxLine=function(B,g,l,o,V,U,y,G,d,j){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(B,V,U,y,G,d,j),this.addVertex(o,V,U,y,G,d,j),this.addVertex(B,g,U,y,G,d,j),this.addVertex(o,g,U,y,G,d,j),this.addVertex(o,V,l,y,G,d,j),this.addVertex(B,V,l,y,G,d,j),this.addVertex(o,g,l,y,G,d,j),this.addVertex(B,g,l,y,G,d,j),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},g.addVertex=function(B,g,l,o,V,U,y){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=B,this._vbData[this._posInVBData+1]=g,this._vbData[this._posInVBData+2]=l,this._vbData[this._posInVBData+3]=o,this._vbData[this._posInVBData+4]=V,this._vbData[this._posInVBData+5]=U,this._vbData[this._posInVBData+6]=y,this._posInVBData+=this._floatSizePerVer,this},g.addVertexIndex=function(B,g,l,o,V,U,y,G){return this._hasBegun||this.addVertexIndexException(),this._vbData[G]=B,this._vbData[G+1]=g,this._vbData[G+2]=l,this._vbData[G+3]=o,this._vbData[G+4]=V,this._vbData[G+5]=U,this._vbData[G+6]=y,(G+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=G),this},g.addIndexes=function(B){var g=arguments;this._hasBegun||this.addVertexIndexException();for(var l=0;l<g.length;l++)this._ibData[this._posInIBData]=g[l],this._posInIBData++;return this},g.begin=function(B,g){return this._hasBegun&&this.beginException0(),1!==B&&4!==B&&this.beginException1(),this._primitiveType=B,this._camera=g,this._hasBegun=!0,this},g.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},g.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(B._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),X.drawCall++,t.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},g.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},g.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},g.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},g.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},g.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},g.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(28,[new yB(0,"vector3",0),new yB(12,"vector4",1)])}]),B}()),L=function(){function B(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++B._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new Kg}p(B,"laya.d3.core.render.RenderElement");var g=B.prototype;return g.getDynamicBatchBakedVertexs=function(B){for(var g=this._renderObj._getVertexBuffer(B),l=g.getData().slice(),o=g.vertexDeclaration,V=o.getVertexElementByUsage(0).offset/4,U=o.getVertexElementByUsage(3).offset/4,y=this._sprite3D.transform,G=y.worldMatrix,d=y.rotation,j=o.vertexStride/4,A=0,H=l.length;A<H;A+=j){var K=A+V,p=A+U;Fg.transformVector3ArrayToVector3ArrayCoordinate(l,K,G,l,K),Fg.transformVector3ArrayByQuat(l,p,d,l,p)}return l},g.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},g._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},x(0,g,"id",function(){return this._id}),x(0,g,"renderObj",function(){return this._renderObj},function(B){this._renderObj!==B&&(this._renderObj=B)}),B._uniqueIDCounter=0,B}(),I=function(){function g(B){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++g._uniqueIDCounter,this._needSort=!1,this._scene=B,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}p(g,"laya.d3.core.render.RenderQueue");var B=g.prototype;return B._sortOpaqueFunc=function(B,g){if(B._render&&g._render){var l=B._material.renderQueue-g._material.renderQueue;return 0==l?B._render._distanceForSort-g._render._distanceForSort:l}return 0},B._sortAlphaFunc=function(B,g){if(B._render&&g._render){var l=B._material.renderQueue-g._material.renderQueue;return 0==l?g._render._distanceForSort-B._render._distanceForSort:l}return 0},B._begainRenderElement=function(B,g,l){return!!g._beforeRender(B)},B._sortAlpha=function(B){g._cameraPosition=B,this._finalElements.sort(this._sortAlphaFunc)},B._sortOpaque=function(B){g._cameraPosition=B,this._finalElements.sort(this._sortOpaqueFunc)},B._preRender=function(B){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},B._render=function(B,g){for(var l,o,V,U,y,G,d=X.loopCount,j=this._scene,A=B.camera,H=(A.id,!1),K=0,p=this._finalElements.length;K<p;K++){var x,N,F,C=this._finalElements[K];if(null!=C._onPreRenderFunction&&C._onPreRenderFunction.call(C._sprite3D,B),0===C._type){if(B.owner=F=C._sprite3D,B.renderElement=C,F._preRenderUpdateComponents(B),x=C.renderObj,N=C._material,this._begainRenderElement(B,x,N)){if(l=x._getVertexBuffers(),!(V=(o=x._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[o.id]){this._errorRecord[o.id]=1;var m="vertexBuffer:"+("("+o._destroyed+","+o._released+","+o._referenceCount+","+o._buffer+")")+", material:"+(N?N.__className+"("+N._destroyed+","+N._released+")":"null")+", owner:"+(F?F.__className+"("+F._destroyed+","+F._activeInHierarchy+","+F._displayedInStage+")":"null")+", renderObj:"+(x?x.__className+"("+x._destroyed+","+x._released+","+x._referenceCount+")":"")+", parent:, url:"+(F?F.url:"")+", disposeStack:"+o.disposeStack;D.recordError("报错：unknown vertexDeclaration  "+m)}continue}if(H=(U=B._shader=N._getShader(j._shaderDefineValue,V.shaderDefineValue,F._shaderDefineValue)).bind()||d!==U._uploadLoopCount,l){if(U._uploadVertexBuffer!==l||H){for(var M=0;M<l.length;M++){var b=l[M];U.uploadAttributesX(b.vertexDeclaration.shaderValues.data,b)}U._uploadVertexBuffer=l}}else(U._uploadVertexBuffer!==o||H)&&(U.uploadAttributes(V.shaderValues.data,null),U._uploadVertexBuffer=o);(U._uploadScene!==j||H)&&(U.uploadSceneUniforms(j._shaderValues.data),U._uploadScene=j),(A!==U._uploadCamera||U._uploadSprite3D!==F||H)&&(U.uploadSpriteUniforms(F._shaderValues.data),U._uploadSprite3D=F),(A!==U._uploadCamera||H)&&(U.uploadCameraUniforms(A._shaderValues.data),U._uploadCamera=A),(U._uploadMaterial!==N||H)&&(N._upload(),U._uploadMaterial=N),y!==N?(N._setRenderStateBlendDepth(),N._setRenderStateFrontFace(g,F.transform),y=N,G=F):G!==F&&(N._setRenderStateFrontFace(g,F.transform),G=F),x._render(B),U._uploadLoopCount=d}F._postRenderUpdateComponents(B)}else if(2===C._type){C.renderObj;B.owner=F=C._sprite3D,B.renderElement=C,B._batchIndexStart=C._tempBatchIndexStart,B._batchIndexEnd=C._tempBatchIndexEnd,x=C.renderObj,N=C._material,this._begainRenderElement(B,x,N)&&(V=(o=x._getVertexBuffer(0)).vertexDeclaration,H=(U=B._shader=N._getShader(j._shaderDefineValue,V.shaderDefineValue,F._shaderDefineValue)).bind()||d!==U._uploadLoopCount,(U._uploadVertexBuffer!==o||H)&&(U.uploadAttributes(V.shaderValues.data,null),U._uploadVertexBuffer=o),(U._uploadScene!==j||H)&&(U.uploadSceneUniforms(j._shaderValues.data),U._uploadScene=j),(A!==U._uploadCamera||U._uploadSprite3D!==F||H)&&(U.uploadSpriteUniforms(F._shaderValues.data),U._uploadSprite3D=F),(A!==U._uploadCamera||H)&&(U.uploadCameraUniforms(A._shaderValues.data),U._uploadCamera=A),(U._uploadMaterial!==N||H)&&(N._upload(),U._uploadMaterial=N),y!==N?(N._setRenderStateBlendDepth(),N._setRenderStateFrontFace(g,F.transform),y=N,G=F):G!==F&&(N._setRenderStateFrontFace(g,F.transform),G=F),x._render(B),U._uploadLoopCount=d)}}},B._renderShadow=function(B,g){for(var l,o,V,U,y,G=X.loopCount,d=this._scene,j=B.camera,A=!1,H=0,K=this._finalElements.length;H<K;H++){var p,x,N,F=this._finalElements[H];0===F._type&&(B.owner=N=F._sprite3D,g||N._projectionViewWorldUpdateCamera===j&&N._projectionViewWorldUpdateLoopCount===X.loopCount||(N._render._renderUpdate(B._projectionViewMatrix),N._projectionViewWorldUpdateLoopCount=X.loopCount,N._projectionViewWorldUpdateCamera=j),B.renderElement=F,N._preRenderUpdateComponents(B),p=F.renderObj,x=F._material,this._begainRenderElement(B,p,null)&&(o=(l=p._getVertexBuffer(0)).vertexDeclaration,A=(V=B._shader=x._getShader(d._shaderDefineValue,o.shaderDefineValue,N._shaderDefineValue)).bind()||G!==V._uploadLoopCount,(V._uploadVertexBuffer!==l||A)&&(V.uploadAttributes(o.shaderValues.data,null),V._uploadVertexBuffer=l),(j!==V._uploadCamera||V._uploadSprite3D!==N||A)&&(V.uploadSpriteUniforms(N._shaderValues.data),V._uploadSprite3D=N),(j!==V._uploadCamera||A)&&(V.uploadCameraUniforms(j._shaderValues.data),V._uploadCamera=j),(V._uploadMaterial!==x||A)&&(x._upload(),V._uploadMaterial=x),V._uploadRenderElement,U!==x?(x._setRenderStateFrontFace(!1,N.transform),U=x,y=N):y!==N&&(x._setRenderStateFrontFace(!1,N.transform),y=N),p._render(B),V._uploadLoopCount=G),N._postRenderUpdateComponents(B))}},B._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},B._addRenderElement=function(B){this._renderElements.push(B),this._needSort=!0},B._addDynamicBatchElement=function(B){this._dynamicBatchCombineRenderElements.push(B)},x(0,B,"id",function(){return this._id}),g._uniqueIDCounter=0,g._cameraPosition=null,g}(),k=function(){function B(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return p(B,"laya.d3.core.render.RenderState"),B.clientWidth=0,B.clientHeight=0,B}(),J=function(){function y(B,g){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new uB(new yg,0),this._corners=[new yg,new yg,new yg,new yg,new yg,new yg,new yg,new yg],this._boundingBoxCenter=new yg,this._children=o(8),this._objects=[],this._tempBoundBoxCorners=[new yg,new yg,new yg,new yg,new yg,new yg,new yg,new yg],this._scene=B,this._currentDepth=g}p(y,"laya.d3.core.scene.OctreeNode");var B=y.prototype;return D.imps(B,{"laya.d3.core.scene.ITreeNode":!0}),B.init=function(B,g){var l=new yg,o=new yg;yg.scale(g,-.5,l),yg.scale(g,.5,o),yg.add(l,B,l),yg.add(o,B,o),this.exactBox=new JB(l,o),this.relaxBox=new JB(l,o)},B.addTreeNode=function(B){1===Collision.boxContainsBox(this._relaxBox,B.boundingBox)?this.addNodeDown(B,0):this.addObject(B)},B.addChild=function(B){var g=this._children[B];if(null==g){g=new y(this._scene,this._currentDepth+1),(this._children[B]=g)._parent=this,yg.subtract(this._exactBox.max,this._exactBox.min,y.tempSize),yg.multiply(y.tempSize,y._octreeSplit[B],y.tempCenter),yg.add(this._exactBox.min,y.tempCenter,y.tempCenter),yg.scale(y.tempSize,.25,y.tempSize);var l=new yg,o=new yg;yg.subtract(y.tempCenter,y.tempSize,l),yg.add(y.tempCenter,y.tempSize,o),g.exactBox=new JB(l,o),yg.scale(y.tempSize,y.relax,y.tempSize);var V=new yg,U=new yg;yg.subtract(y.tempCenter,y.tempSize,V),yg.add(y.tempCenter,y.tempSize,U),g.relaxBox=new JB(V,U)}return g},B.addObject=function(B){(B._treeNode=this)._objects.push(B)},B.removeObject=function(B){if(B._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var g=this._objects.indexOf(B);return-1!==g&&(this._objects.splice(g,1),!0)},B.clearObject=function(){this._objects.length=0},B.addNodeUp=function(B,g){this._parent&&1!==Collision.boxContainsBox(this._exactBox,B.boundingBox)?this._parent.addNodeUp(B,g-1):this.addNodeDown(B,g)},B.addNodeDown=function(B,g){if(g<this._scene.treeLevel){var l=this.inChildIndex(B.boundingBoxCenter),o=this.addChild(l);1===Collision.boxContainsBox(o._relaxBox,B.boundingBox)?o.addNodeDown(B,++g):this.addObject(B)}else this.addObject(B)},B.inChildIndex=function(B){return 4*(B.z<this._boundingBoxCenter.z?0:1)+2*(B.y<this._boundingBoxCenter.y?0:1)+(B.x<this._boundingBoxCenter.x?0:1)},B.updateObject=function(B){1===Collision.boxContainsBox(this._relaxBox,B.boundingBox)?(this.removeObject(B),B._treeNode=null,this.addNodeDown(B,this._currentDepth)):this._parent&&(this.removeObject(B),B._treeNode=null,this._parent.addNodeUp(B,this._currentDepth-1))},B.cullingObjects=function(B,g,l,o,V){var U,y=0,G=0,d=0,j=this._scene._dynamicBatchManager;for(y=0,U=this._objects.length;y<U;y++){var A=this._objects[y];if(S.isVisible(A._owner.layer.mask)&&A.enable){if(g&&(X.treeSpriteCollision+=1,0===B.containsBoundSphere(A.boundingSphere)))continue;A._renderUpdate(V),A._distanceForSort=yg.distance(A.boundingSphere.center,o)+A.sortingFudge;var H=A._renderElements;for(G=0,d=H.length;G<d;G++){var K=H[G],p=K._staticBatch;if(p&&p._material===K._material)p._addBatchRenderElement(K);else{var x=K.renderObj;x.triangleCount<10&&1===x._vertexBufferCount&&x._getIndexBuffer()&&K._material.renderQueue<2&&K._canDynamicBatch&&!A._owner.isStatic?j._addPrepareRenderElement(K):this._scene.getRenderQueue(K._material.renderQueue)._addRenderElement(K)}}}}for(y=0;y<8;y++){var N=this._children[y];if(null!=N){var F=g;if(g){var C=B.containsBoundBox(N._relaxBox);if(X.treeNodeCollision+=1,0===C)continue;F=2===C}N.cullingObjects(B,F,l,o,V)}}},B.cullingShadowObjects=function(B,g,l,o,V){var U,y=0,G=0,d=0;this._scene._dynamicBatchManager;for(y=0,U=this._objects.length;y<U;y++){var j=this._objects[y];if(j.castShadow&&S.isVisible(j._owner.layer.mask)&&j.enable){if(l&&0===B[0].containsBoundSphere(j.boundingSphere))continue;for(var A=1,H=B.length;A<H;A++){var K=g[A-1];if(0!==B[A].containsBoundSphere(j.boundingSphere)){var p=j._renderElements;for(G=0,d=p.length;G<d;G++)K._addRenderElement(p[G])}}}}for(y=0;y<8;y++){var x=this._children[y];if(null!=x){var N=l;if(l){var F=B[0].containsBoundBox(x._relaxBox);if(0===F)continue;N=2===F}x.cullingShadowObjects(B,g,N,o,V)}}},B.cullingShadowObjectsOnePSSM=function(B,g,l,o,V,U){var y,G=g[0],d=0,j=0,A=0;for(d=0,y=this._objects.length;d<y;d++){var H=this._objects[d];if(H.castShadow&&S.isVisible(H._owner.layer.mask)&&H.enable){if(o&&0===B.containsBoundSphere(H.boundingSphere))continue;H._renderUpdate(l);var K=H._renderElements;for(j=0,A=K.length;j<A;j++)G._addRenderElement(K[j])}}for(d=0;d<8;d++){var p=this._children[d];if(null!=p){var x=o;if(o){var N=B.containsBoundBox(p._relaxBox);if(0===N)continue;x=2===N}p.cullingShadowObjectsOnePSSM(B,g,l,x,V,U)}}},B.renderBoudingBox=function(B){this._renderBoudingBox(B);for(var g=0;g<8;++g){var l=this._children[g];l&&l.renderBoudingBox(B)}},B.buildAllChild=function(B){if(B<this._scene.treeLevel)for(var g=0;g<8;g++){this.addChild(g).buildAllChild(B+1)}},B._renderBoudingBox=function(B){},x(0,B,"exactBox",function(){return this._exactBox},function(B){this._exactBox=B,yg.add(B.min,B.max,this._boundingBoxCenter),yg.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),x(0,B,"relaxBox",function(){return this._relaxBox},function(B){(this._relaxBox=B).getCorners(this._corners),uB.createfromPoints(this._corners,this._boundingSphere)}),y.debugMode=!1,y.relax=1.15,y.CHILDNUM=8,H(y,["tempVector0",function(){return this.tempVector0=new yg},"tempSize",function(){return this.tempSize=new yg},"tempCenter",function(){return this.tempCenter=new yg},"_octreeSplit",function(){return this._octreeSplit=[new yg(.25,.25,.25),new yg(.75,.25,.25),new yg(.25,.75,.25),new yg(.75,.75,.25),new yg(.25,.25,.75),new yg(.75,.25,.75),new yg(.25,.75,.75),new yg(.75,.75,.75)]}]),y}(),$=(function(){function B(){}p(B,"laya.d3.core.scene.SceneManager")}(),function(){function B(B,g,l,o){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===B&&(B=1),void 0===g&&(g=1),void 0===l&&(l=1),void 0===o&&(o=1),this._r=B,this._g=g,this._b=l,this._a=o}return p(B,"laya.d3.core.trail.module.Color",null,"Color$1"),B.prototype.cloneTo=function(B){B._r=this._r,B._g=this._g,B._b=this._b,B._a=this._a},H(B,["RED",function(){return this.RED=new B(1,0,0,1)},"GREEN",function(){return this.GREEN=new B(0,1,0,1)},"BLUE",function(){return this.BLUE=new B(0,0,1,1)},"CYAN",function(){return this.CYAN=new B(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new B(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new B(1,0,1,1)},"GRAY",function(){return this.GRAY=new B(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new B(1,1,1,1)},"BLACK",function(){return this.BLACK=new B(0,0,0,1)}]),B}()),u=(function(){function B(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}p(B,"laya.d3.core.trail.module.Gradient");var g=B.prototype;g.setKeys=function(B,g){var l,o;this._colorKeys=B;for(var V=this.index=0;V<B.length;V++){var U=(l=B[V]).color;this._colorKeyData[this.index++]=U._r,this._colorKeyData[this.index++]=U._g,this._colorKeyData[this.index++]=U._b,this._colorKeyData[this.index++]=l.time}this._alphaKeys=g;for(var y=this.index=0;y<g.length;y++)o=g[y],this._alphaKeyData[this.index++]=o.alpha,this._alphaKeyData[this.index++]=o.time},g.cloneTo=function(B){var g=0,l=0,o=this.colorKeys,V=[];for(g=0,l=o.length;g<l;g++){var U=new q;o[g].cloneTo(U),V.push(U)}var y=this.alphaKeys,G=[];for(g=0,l=y.length;g<l;g++){var d=new u;y[g].cloneTo(d),G.push(d)}B.setKeys(V,G)},x(0,g,"mode",function(){return this._mode},function(B){this._mode=B}),x(0,g,"colorKeys",function(){return this._colorKeys},function(B){this._colorKeys=B;for(var g=this.index=0;g<B.length;g++){var l=B[g],o=l.color;this._colorKeyData[this.index++]=o._r,this._colorKeyData[this.index++]=o._g,this._colorKeyData[this.index++]=o._b,this._colorKeyData[this.index++]=l.time}}),x(0,g,"alphaKeys",function(){return this._alphaKeys},function(B){this._alphaKeys=B;for(var g=this.index=0;g<B.length;g++){var l=B[g];this._alphaKeyData[this.index++]=l.alpha,this._alphaKeyData[this.index++]=l.time}})}(),function(){function B(B,g){this._alpha=NaN,this._time=NaN,void 0===B&&(B=0),void 0===g&&(g=0),this._alpha=B,this._time=g}p(B,"laya.d3.core.trail.module.GradientAlphaKey");var g=B.prototype;return g.cloneTo=function(B){B.alpha=this.alpha,B.time=this.time},x(0,g,"alpha",function(){return this._alpha},function(B){this._alpha=B}),x(0,g,"time",function(){return this._time},function(B){this._time=B}),B}()),q=function(){function B(B,g){this._color=null,this._time=NaN,void 0===g&&(g=0),this._color=B||new $,this._time=g}p(B,"laya.d3.core.trail.module.GradientColorKey");var g=B.prototype;return g.cloneTo=function(B){this.color.cloneTo(B.color),B.time=this.time},x(0,g,"color",function(){return this._color},function(B){this._color=B}),x(0,g,"time",function(){return this._time},function(B){this._time=B}),B}(),O=(function(){function B(){}p(B,"laya.d3.core.trail.module.GradientMode"),B.Blend=0,B.Fixed=1}(),function(){function B(){}p(B,"laya.d3.core.trail.module.TextureMode"),B.Stretch=0,B.Tile=1}(),function(){function B(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}p(B,"laya.d3.core.trail.module.TrailKeyFrame"),B.prototype.cloneTo=function(B){B.time=this.time,B.inTangent=this.inTangent,B.outTangent=this.outTangent,B.value=this.value}}(),function(){function g(B){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new yg,this._curPosition=new yg,this._delVector3=new yg,this._lastFixedVertexPosition=new yg,this._pointAtoBVector3=new yg,this._pointA=new yg,this._pointB=new yg,this._owner=B,this._id=g.renderElementCount++,0==this._id?B._owner.transform.position.cloneTo(this._lastPosition):B._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new Yg(O.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new Yg(O.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}p(g,"laya.d3.core.trail.TrailRenderElement");var B=g.prototype;D.imps(B,{"laya.d3.core.render.IRenderable":!0}),B._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},B._addTrailByFirstPosition=function(B,g){yg.subtract(g,B,this._delVector3),yg.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),yg.normalize(this._pointAtoBVector3,this._pointAtoBVector3),yg.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(B),B.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},B._addTrailByNextPosition=function(B){yg.subtract(B,this._lastFixedVertexPosition,this._delVector3),yg.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),yg.normalize(this._pointAtoBVector3,this._pointAtoBVector3),yg.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=yg.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=qB.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(B),B.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(B),this._virtualVerticesCount=2)},B._updateVerticesByPosition=function(B){this._pointe=B.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},B._updateVertexBuffer2=function(){var B,g=0,l=0,o=0;for(o=0,B=(this._verticesCount+this._virtualVerticesCount)/2;o<B;o++)l=0==this._owner.textureMode?(this._VerticesToTailLength[o]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[o],this._vertices2[g++]=1-l,this._vertices2[g++]=1-l;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},B._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},B._updateDisappear=function(){var B,g=0;for(g=this._curDisappearIndex,B=(this._verticesCount+this._virtualVerticesCount)/2;g<B;g++)this._owner._curtime-this._everyGroupVertexBirthTime[g]>=this._owner.time+qB.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},B._beforeRender=function(B){return this._camera=B.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),yg.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},B._render=function(B){this._isDead||(t.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),X.drawCall++,X.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},B._getVertexBuffer=function(B){return void 0===B&&(B=0),0===B?this._vertexBuffer1:1===B?this._vertexBuffer2:null},B._getVertexBuffers=function(){return this._vertexBuffers},B._getIndexBuffer=function(){return null},B.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},B._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},x(0,B,"_vertexBufferCount",function(){return this._vertexBuffers.length}),x(0,B,"triangleCount",function(){return 0}),g.renderElementCount=0}(),function(){function B(){}p(B,"laya.d3.core.trail.VertexTrail");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration1}),x(1,B,"vertexDeclaration1",function(){return B._vertexDeclaration1}),x(1,B,"vertexDeclaration2",function(){return B._vertexDeclaration2}),H(B,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new UB(32,[new yB(0,"vector3",0),new yB(12,"vector3",41),new yB(24,"single",33),new yB(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new UB(4,[new yB(0,"single",38)])}]),B}()),BB=function(){function b(B){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=B}p(b,"laya.d3.graphics.DynamicBatch");var B=b.prototype;return D.imps(B,{"laya.d3.core.render.IRenderable":!0}),B._getVertexBuffer=function(B){return void 0===B&&(B=0),0===B?this._vertexBuffer:null},B._getIndexBuffer=function(){return this._indexBuffer},B._getCombineRenderElementFromPool=function(B,g,l){var o=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return o||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=o=new L,o._sprite3D=new Ig),o._sprite3D._render._renderUpdate(l),o},B._getRenderElement=function(B,g,l){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*b.maxVertexCount),this._indexDatas=new Uint16Array(b.maxIndexCount),this._vertexBuffer=Yg.create(this._vertexDeclaration,b.maxVertexCount,35048),this._indexBuffer=Pg.create("ushort",b.maxIndexCount,35048));for(var o=this._merageElements.length=0,V=0,U=0,y=this._combineRenderElements.length;U<y;U++){var G=this._combineRenderElements[U],d=G.getDynamicBatchBakedVertexs(0),j=G.getBakedIndices(),A=G._sprite3D.transform._isFrontFaceInvert,H=o/(this._vertexDeclaration.vertexStride/4),K=V,p=K+j.length;G._tempBatchIndexStart=K,G._tempBatchIndexEnd=p,this._indexDatas.set(j,V);var x=0;if(A)for(x=K;x<p;x+=3){this._indexDatas[x]=H+this._indexDatas[x];var N=this._indexDatas[x+1],F=this._indexDatas[x+2];this._indexDatas[x+1]=H+F,this._indexDatas[x+2]=H+N}else for(x=K;x<p;x+=3)this._indexDatas[x]=H+this._indexDatas[x],this._indexDatas[x+1]=H+this._indexDatas[x+1],this._indexDatas[x+2]=H+this._indexDatas[x+2];V+=j.length,this._vertexDatas.set(d,o),o+=d.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),U=this._combineRenderElementPoolIndex=0,y=this._materials.length;U<y;U++){var C=this._getCombineRenderElementFromPool(B,g,l);C._type=2,C._staticBatch=null;var m=(C.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[U]]._tempBatchIndexStart,M=U+1===this._materialToRenderElementsOffsets.length?V:this._combineRenderElements[this._materialToRenderElementsOffsets[U+1]]._tempBatchIndexStart;C._tempBatchIndexStart=m,C._tempBatchIndexEnd=M,C._material=this._materials[U],this._merageElements.push(C)}},B._addCombineRenderObjTest=function(B){var g=B.renderObj,l=this._currentCombineIndexCount+g._getIndexBuffer().indexCount,o=this._currentCombineVertexCount+g._getVertexBuffer().vertexCount;return!(b.maxVertexCount<o||b.maxIndexCount<l)},B._addCombineRenderObj=function(B){var g=B.renderObj;this._combineRenderElements.push(B),this._currentCombineIndexCount=this._currentCombineIndexCount+g._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+g._getVertexBuffer().vertexCount},B._addCombineMaterial=function(B){this._materials.push(B)},B._addMaterialToRenderElementOffset=function(B){this._materialToRenderElementsOffsets.push(B)},B._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},B._addToRenderQueue=function(B,g,l,o){this._getRenderElement(g,l,o);for(var V=0,U=this._materials.length;V<U;V++)B.getRenderQueue(this._materials[V].renderQueue)._addDynamicBatchElement(this._merageElements[V])},B._beforeRender=function(B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},B._render=function(B){var g=B._batchIndexEnd-B._batchIndexStart;t.mainContext.drawElements(4,g,5123,2*B._batchIndexStart),X.drawCall++,X.trianglesFaces+=g/3},B._getVertexBuffers=function(){return null},x(0,B,"_vertexBufferCount",function(){return 1}),x(0,B,"triangleCount",function(){return this._indexBuffer.indexCount/3}),x(0,B,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),b.maxVertexCount=2e4,b.maxIndexCount=4e4,b.maxCombineTriangleCount=10,b}(),gB=function(){function b(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}p(b,"laya.d3.graphics.DynamicBatchManager");var B=b.prototype;return B.getDynamicBatch=function(B,g){var l,o=B.id.toString()+g;return this._dynamicBatches[o]?l=this._dynamicBatches[o]:this._dynamicBatches[o]=l=new BB(B),l},B._garbageCollection=function(){for(var B in this._dynamicBatches)0===this._dynamicBatches[B].combineRenderElementsCount&&delete this._dynamicBatches[B]},B._addPrepareRenderElement=function(B){this._prepareDynamicBatchCombineElements.push(B)},B._finishCombineDynamicBatch=function(B){var g,l,o;this._prepareDynamicBatchCombineElements.sort(b._sortPrepareDynamicBatch);for(var V,U,y,G,d,j=-1,A=!0,H=0,K=-1,p=0,x=this._prepareDynamicBatchCombineElements.length;p<x;p++){var N=(U=this._prepareDynamicBatchCombineElements[p]).renderObj._getVertexBuffer(0).vertexDeclaration,F=l!==N;F&&(H=0,l=N);var C=H!==j;if(C&&(j=H),(F||C)&&(y=this.getDynamicBatch(N,H),g=null),A)if(y._addCombineRenderObjTest(U)){if(g!==(V=U._material))G&&(B.getRenderQueue(d._material.renderQueue)._addRenderElement(d),d=G=null,K=-1),G=V,K=y.combineRenderElementsCount,d=U,g=V;else if(G){var m=d.renderObj,M=U.renderObj;m._getVertexBuffer().vertexCount+M._getVertexBuffer().vertexCount>BB.maxVertexCount||m._getIndexBuffer().indexCount+M._getIndexBuffer().indexCount>BB.maxIndexCount?(B.getRenderQueue(d._material.renderQueue)._addRenderElement(d),G=V,K=y.combineRenderElementsCount,d=U):(y._addCombineMaterial(G),y._addMaterialToRenderElementOffset(K),y._addCombineRenderObj(d),d=G=null,K=-1,y._addCombineRenderObj(U))}else y._addCombineRenderObj(U);A=!0}else G&&(B.getRenderQueue(d._material.renderQueue)._addRenderElement(d),d=G=null,K=-1),H++,A=!1;else o=this._prepareDynamicBatchCombineElements[p-1],y._addMaterialToRenderElementOffset(y.combineRenderElementsCount),g=o._material,y._addCombineMaterial(g),y._addCombineRenderObj(o),A=!0,g!==(V=U._material)?(G=V,K=y.combineRenderElementsCount,d=U):y._addCombineRenderObj(U),g=V}G&&(B.getRenderQueue(d._material.renderQueue)._addRenderElement(d),d=G=null,K=-1),this._prepareDynamicBatchCombineElements.length=0},B._clearRenderElements=function(){for(var B in this._dynamicBatches)this._dynamicBatches[B]._clearRenderElements()},B._addToRenderQueue=function(B,g,l,o){for(var V in this._dynamicBatches){var U=this._dynamicBatches[V];0<U.combineRenderElementsCount&&U._addToRenderQueue(B,g,l,o)}},B.dispose=function(){this._dynamicBatches=null},b._sortPrepareDynamicBatch=function(B,g){return B._mainSortID-g._mainSortID},b}(),lB=function(){function B(){}return p(B,"laya.d3.graphics.FrustumCulling"),B.renderShadowObjectCulling=function(B,g,l,o,V){var U=0,y=0,G=0,d=0;for(U=0,G=l.length;U<G;U++){var j=l[U];j&&j._clearRenderElements()}var A,H,K,p=B._cullingRenders;if(1<V){for(U=0,G=B._cullingRendersLength;U<G;U++)if((A=p[U]).castShadow&&S.isVisible(A._owner.layer.mask)&&A.enable)for(var x=1,N=g.length;x<N;x++)if(H=l[x-1],0!==g[x].containsBoundSphere(A.boundingSphere))for(y=0,d=(K=A._renderElements).length;y<d;y++)H._addRenderElement(K[y])}else for(U=0,G=B._cullingRendersLength;U<G;U++)if((A=p[U]).castShadow&&S.isVisible(A._owner.layer.mask)&&A.enable&&0!==g[0].containsBoundSphere(A.boundingSphere))for(A._renderUpdate(o),H=l[0],y=0,d=(K=A._renderElements).length;y<d;y++)H._addRenderElement(K[y])},B.renderShadowObjectCullingOctree=function(B,g,l,o,V){for(var U=0,y=l.length;U<y;U++){var G=l[U];G&&G._clearRenderElements()}1<V?B.treeRoot.cullingShadowObjects(g,l,!0,0,B):B.treeRoot.cullingShadowObjectsOnePSSM(g[0],l,o,!0,0,B)},B.renderObjectCulling=function(B,g,l,o,V,U){var y=0,G=0,d=0,j=0,A=g._quenes,H=g._dynamicBatchManager,K=g._cullingRenders;for(y=0,G=A.length;y<G;y++){var p=A[y];p&&p._clearRenderElements()}var x=oB._staticBatchManagers;for(y=0,G=x.length;y<G;y++)x[y]._clearRenderElements();H._clearRenderElements();var N=l.transform.position;for(y=0,G=g._cullingRendersLength;y<G;y++){var F=K[y];if(S.isVisible(F._owner.layer.mask)&&F.enable&&0!==B.containsBoundSphere(F.boundingSphere)&&F._renderUpdate(U)){F._distanceForSort=yg.distance(F.boundingSphere.center,N)+F.sortingFudge;var C=F._renderElements;for(d=0,j=C.length;d<j;d++){var m=C[d],M=m._staticBatch;if(M&&M._material===m._material)M._addBatchRenderElement(m);else{var b=m.renderObj;b.triangleCount<10&&1===b._vertexBufferCount&&b._getIndexBuffer()&&m._material.renderQueue<2&&m._canDynamicBatch&&!F._owner.isStatic?H._addPrepareRenderElement(m):g.getRenderQueue(m._material.renderQueue)._addRenderElement(m)}}}}for(y=0,G=x.length;y<G;y++)x[y]._addToRenderQueue(g,o,V,U);H._finishCombineDynamicBatch(g),H._addToRenderQueue(g,o,V,U)},B.renderObjectCullingOctree=function(B,g,l,o,V,U){var y=0,G=0,d=g._quenes,j=g._dynamicBatchManager;for(y=0,G=d.length;y<G;y++){var A=d[y];A&&A._clearRenderElements()}var H=oB._staticBatchManagers;for(y=0,G=H.length;y<G;y++)H[y]._clearRenderElements();for(j._clearRenderElements(),g._cullingRenders.length=0,g.treeRoot.cullingObjects(B,!0,0,l.transform.position,U),y=0,G=H.length;y<G;y++)H[y]._addToRenderQueue(g,o,V,U);j._finishCombineDynamicBatch(g),j._addToRenderQueue(g,o,V,U)},B.renderObjectCullingNoBoundFrustum=function(B,g,l,o,V){var U=0,y=0,G=0,d=0,j=B._quenes,A=B._dynamicBatchManager,H=B._cullingRenders;for(U=0,y=j.length;U<y;U++){var K=j[U];K&&K._clearRenderElements()}var p=oB._staticBatchManagers;for(U=0,y=p.length;U<y;U++)p[U]._clearRenderElements();A._clearRenderElements();var x=g.transform.position;for(U=0,y=B._cullingRendersLength;U<y;U++){var N=H[U];if(S.isVisible(N._owner.layer.mask)&&N.enable){N._renderUpdate(V),N._distanceForSort=yg.distance(N.boundingSphere.center,x)+N.sortingFudge;var F=N._renderElements;for(G=0,d=F.length;G<d;G++){var C=F[G],m=C._staticBatch;if(m&&m._material===C._material)m._addBatchRenderElement(C);else{var M=C.renderObj;M.triangleCount<10&&1===M._vertexBufferCount&&M._getIndexBuffer()&&C._material.renderQueue<2&&C._canDynamicBatch&&!N._owner.isStatic?A._addPrepareRenderElement(C):B.getRenderQueue(C._material.renderQueue)._addRenderElement(C)}}}}for(U=0,y=p.length;U<y;U++)p[U]._addToRenderQueue(B,l,o,V);A._finishCombineDynamicBatch(B),A._addToRenderQueue(B,l,o,V)},B}(),oB=function(){function U(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}p(U,"laya.d3.graphics.StaticBatchManager");var B=U.prototype;return B._finishInit=function(){for(var B in this._staticBatches)this._staticBatches[B]._finishInit();this._initBatchRenderElements.length=0},B._initStaticBatchs=function(B){throw new Error("StaticBatchManager:must override this function.")},B._addInitBatchSprite=function(B){for(var g=B._render._renderElements,l=0,o=g.length;l<o;l++)this._initBatchRenderElements.push(g[l])},B._clearRenderElements=function(){for(var B in this._staticBatches)this._staticBatches[B]._clearRenderElements()},B._garbageCollection=function(B){var g=B._staticBatch,l=g._initBatchRenderElements,o=l.indexOf(B);l.splice(o,1),0===l.length&&(g.dispose(),delete this._staticBatches[g._key])},B._addToRenderQueue=function(B,g,l,o){for(var V in this._staticBatches){var U=this._staticBatches[V];0<U._batchRenderElements.length&&U._updateToRenderQueue(B,o)}},B.dispose=function(){this._staticBatches=null},U._addToStaticBatchQueue=function(B){B instanceof laya.d3.core.RenderableSprite3D&&B._addToInitStaticBatchManager();for(var g=0,l=B.numChildren;g<l;g++)U._addToStaticBatchQueue(B._childs[g])},U.combine=function(B,g){var l,o=0,V=0;if(g)for(o=0,V=g.length;o<V;o++){g[o]._addToInitStaticBatchManager()}else B&&U._addToStaticBatchQueue(B);for(o=0,V=U._staticBatchManagers.length;o<V;o++)(l=U._staticBatchManagers[o])._initStaticBatchs(B),l._finishInit()},U._staticBatchManagers=[],U}(),VB=function(){function B(B,g,l){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=B,this._manager=g,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=l}p(B,"laya.d3.graphics.StaticBatch");var g=B.prototype;return D.imps(g,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),g._binarySearch=function(B){for(var g=0,l=this._batchRenderElements.length-1,o=0;g<=l;)o=Math.floor((g+l)/2),this._compareBatchRenderElement(this._batchRenderElements[o],B)?l=o-1:g=o+1;return g},g._compareBatchRenderElement=function(B,g){throw new Error("StaticBatch:must override this function.")},g._getVertexDecLightMap=function(B){return B===PB.vertexDeclaration?SB.vertexDeclaration:B===_B.vertexDeclaration?fB.vertexDeclaration:B===wB.vertexDeclaration?bB.vertexDeclaration:B===ZB.vertexDeclaration?null:B===NB.vertexDeclaration?FB.vertexDeclaration:B===cB.vertexDeclaration?eB.vertexDeclaration:B===tB.vertexDeclaration?hB.vertexDeclaration:B===YB.vertexDeclaration?EB.vertexDeclaration:B===_B.vertexDeclaration?fB.vertexDeclaration:B===iB.vertexDeclaration?DB.vertexDeclaration:B===ZB.vertexDeclaration?null:B===NB.vertexDeclaration?FB.vertexDeclaration:B===rB.vertexDeclaration?QB.vertexDeclaration:B===tB.vertexDeclaration?hB.vertexDeclaration:B},g._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},g._addBatchRenderElement=function(B){this._batchRenderElements.splice(this._binarySearch(B),0,B)},g._updateToRenderQueue=function(B,g){this._combineRenderElementPoolIndex=0,this._getRenderElement(B.getRenderQueue(this._material.renderQueue)._renderElements,B,g)},g._getRenderElement=function(B,g,l){throw new Error("StaticBatch:must override this function.")},g._finishInit=function(){throw new Error("StaticBatch:must override this function.")},g._clearRenderElements=function(){this._batchRenderElements.length=0},g.dispose=function(){},g._getVertexBuffer=function(B){return void 0===B&&(B=0),null},g._getIndexBuffer=function(){return null},g._beforeRender=function(B){return!0},g._render=function(B){},g._getVertexBuffers=function(){return null},x(0,g,"_vertexBufferCount",function(){return 1}),x(0,g,"triangleCount",function(){return 0}),B.combine=function(B){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),oB.combine(B)},B.maxBatchVertexCount=65535,B}(),UB=function(){function y(B,g){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++y._uniqueIDCounter,this._id>y.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",y.maxVertexDeclaration);this._shaderValues=new Kg,this._vertexElementsDic={},this._vertexStride=B,this._vertexElements=g;for(var l=0;l<g.length;l++){var o=g[l],V=o.elementUsage;this._vertexElementsDic[V]=o;var U=[y._getTypeSize(o.elementFormat)/4,5126,!1,this._vertexStride,o.offset];switch(this._shaderValues.setValue(V,U),V){case 1:this._addShaderDefine(Xg.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(Xg.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(Xg.SHADERDEFINE_UV1)}}}p(y,"laya.d3.graphics.VertexDeclaration");var B=y.prototype;return B._addShaderDefine=function(B){this._shaderDefineValue|=B},B._removeShaderDefine=function(B){this._shaderDefineValue&=~B},B.getVertexElements=function(){return this._vertexElements.slice()},B.getVertexElementByUsage=function(B){return this._vertexElementsDic[B]},B.unBinding=function(){},x(0,B,"shaderDefineValue",function(){return this._shaderDefineValue}),x(0,B,"id",function(){return this._id}),x(0,B,"vertexStride",function(){return this._vertexStride}),x(0,B,"shaderValues",function(){return this._shaderValues}),y._getTypeSize=function(B){switch(B){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},y.getVertexStride=function(B){for(var g=0,l=0;l<B.Length;l++){var o=B[l],V=o.offset+y._getTypeSize(o.elementFormat);g<V&&(g=V)}return g},y._maxVertexDeclarationBit=1e3,y._uniqueIDCounter=1,H(y,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),y}(),yB=function(){function B(B,g,l){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=B,this.elementFormat=g,this.elementUsage=l}return p(B,"laya.d3.graphics.VertexElement"),B}(),GB=(function(){function B(){}p(B,"laya.d3.graphics.VertexElementFormat"),B.Single="single",B.Vector2="vector2",B.Vector3="vector3",B.Vector4="vector4",B.Color="color",B.Byte4="byte4",B.Short2="short2",B.Short4="short4",B.NormalizedShort2="normalizedshort2",B.NormalizedShort4="normalizedshort4",B.HalfVector2="halfvector2",B.HalfVector4="halfvector4"}(),function(){function B(){}p(B,"laya.d3.graphics.VertexElementUsage"),B.POSITION0=0,B.COLOR0=1,B.TEXTURECOORDINATE0=2,B.NORMAL0=3,B.BINORMAL0=4,B.TANGENT0=5,B.BLENDINDICES0=6,B.BLENDWEIGHT0=7,B.DEPTH0=8,B.FOG0=9,B.POINTSIZE0=10,B.SAMPLE0=11,B.TESSELLATEFACTOR0=12,B.COLOR1=13,B.NEXTTEXTURECOORDINATE0=14,B.TEXTURECOORDINATE1=15,B.NEXTTEXTURECOORDINATE1=16,B.CORNERTEXTURECOORDINATE0=17,B.VELOCITY0=18,B.STARTCOLOR0=19,B.STARTSIZE=20,B.AGEADDSCALE0=21,B.STARTROTATION=22,B.ENDCOLOR0=23,B.STARTLIFETIME=24,B.TIME0=33,B.SHAPEPOSITIONSTARTLIFETIME=30,B.DIRECTIONTIME=32,B.SIZEROTATION0=27,B.RADIUS0=28,B.RADIAN0=29,B.STARTSPEED=31,B.RANDOM0=34,B.RANDOM1=35,B.SIMULATIONWORLDPOSTION=36,B.SIMULATIONWORLDROTATION=37,B.TEXTURECOORDINATE0X=38,B.TEXTURECOORDINATE0X1=39,B.TEXTURECOORDINATE0Y=40,B.OFFSETVECTOR=41}(),function(){function B(B,g,l){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=B,this._textureCoordinate0=g,this._time=l}p(B,"laya.d3.graphics.VertexGlitter");var g=B.prototype;D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate0}),x(0,g,"position",function(){return this._position}),x(0,g,"time",function(){return this._time}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(24,[new yB(0,"vector3",0),new yB(12,"vector2",2),new yB(20,"single",33)])}])}(),function(){function B(B,g,l,o,V,U,y,G,d,j){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=B,this._position=g,this._velocity=l,this._startColor=o,this._endColor=V,this._sizeRotation=U,this._radius=y,this._radian=G,this._ageAddScale=d,this._time=j}p(B,"laya.d3.graphics.VertexParticle");var g=B.prototype;D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"endColor",function(){return this._endColor}),x(0,g,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),x(0,g,"sizeRotation",function(){return this._sizeRotation}),x(0,g,"velocity",function(){return this._velocity}),x(0,g,"position",function(){return this._position}),x(0,g,"startColor",function(){return this._startColor}),x(0,g,"radius",function(){return this._radius}),x(0,g,"radian",function(){return this._radian}),x(0,g,"ageAddScale",function(){return this._ageAddScale}),x(0,g,"time",function(){return this._time}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(116,[new yB(0,"vector4",17),new yB(16,"vector3",0),new yB(28,"vector3",18),new yB(40,"vector4",19),new yB(56,"vector4",23),new yB(72,"vector3",27),new yB(84,"vector2",28),new yB(92,"vector4",29),new yB(108,"single",24),new yB(112,"single",33)])}])}(),function(){function B(B){this._position=null,this._position=B}p(B,"laya.d3.graphics.VertexPosition");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(12,[new yB(0,"vector3",0)])}]),B}()),dB=function(){function B(B,g){this._position=null,this._normal=null,this._position=B,this._normal=g}p(B,"laya.d3.graphics.VertexPositionNormal");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(24,[new yB(0,"vector3",0),new yB(12,"vector3",3)])}]),B}(),jB=function(){function B(B,g,l){this._position=null,this._normal=null,this._color=null,this._position=B,this._normal=g,this._color=l}p(B,"laya.d3.graphics.VertexPositionNormalColor");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(40,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1)])}]),B}(),AB=function(){function B(B,g,l,o,V){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=B,this._normal=g,this._color=l,this._blendIndex=o,this._blendWeight=V}p(B,"laya.d3.graphics.VertexPositionNormalColorSkin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(72,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector4",7),new yB(56,"vector4",6)])}]),B}(),HB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._tangent=o,this._blendIndex=V,this._blendWeight=U}p(B,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(88,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector4",7),new yB(56,"vector4",6),new yB(72,"vector4",5)])}]),B}(),KB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._tangent=o,this._blendIndex=V,this._blendWeight=U}p(B,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(84,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector4",7),new yB(56,"vector4",6),new yB(72,"vector3",5)])}]),B}(),pB=function(){function B(B,g,l,o){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._tangent=o}p(B,"laya.d3.graphics.VertexPositionNormalColorSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(56,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector4",5)])}]),B}(),xB=function(){function B(B,g,l,o){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._tangent=o}p(B,"laya.d3.graphics.VertexPositionNormalColorTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(52,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector3",5)])}]),B}(),NB=function(){function B(B,g,l,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate=o}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(48,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2)])}]),B}(),FB=function(){function B(B,g,l,o,V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate0=o,this._textureCoordinate1=V}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(56,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector2",15)])}]),B}(),CB=function(){function B(B,g,l,o,V,U,y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate0=o,this._textureCoordinate1=V,this._blendIndex=U,this._blendWeight=y}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(88,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector2",15),new yB(56,"vector4",7),new yB(72,"vector4",6)])}]),B}(),mB=function(){function B(B,g,l,o,V,U,y,G){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate0=o,this._textureCoordinate1=V,this._tangent=U,this._blendIndex=y,this._blendWeight=G}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(104,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector2",15),new yB(56,"vector4",7),new yB(72,"vector4",6),new yB(88,"vector4",5)])}]),B}(),MB=function(){function B(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),g.VertexPositionNormalColorTexture0SkinTangent=function(B,g,l,o,V,U,y,G){this._position=B,this._normal=g,this._color=l,this._textureCoordinate0=o,this._textureCoordinate1=V,this._tangent=U,this._blendIndex=y,this._blendWeight=G},x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(100,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector2",15),new yB(56,"vector4",7),new yB(72,"vector4",6),new yB(88,"vector3",5)])}]),B}(),bB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate0=o,this._textureCoordinate1=V,this._tangent=U}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(72,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector2",15),new yB(56,"vector4",5)])}]),B}(),DB=function(){function B(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}p(B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),g.VertexPositionNormalColorTexture0Tangent=function(B,g,l,o,V,U){this._position=B,this._normal=g,this._color=l,this._textureCoordinate0=o,this._textureCoordinate1=V,this._tangent=U},x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(68,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector2",15),new yB(56,"vector3",5)])}]),B}(),vB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate=o,this._blendIndex=V,this._blendWeight=U}p(B,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(80,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector4",7),new yB(64,"vector4",6)])}]),B}(),sB=function(){function B(B,g,l,o,V,U,y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate=o,this._tangent=V,this._blendIndex=U,this._blendWeight=y}p(B,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(96,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector4",7),new yB(64,"vector4",6),new yB(80,"vector4",5)])}]),B}(),XB=function(){function B(B,g,l,o,V,U,y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate=o,this._tangent=V,this._blendIndex=U,this._blendWeight=y}p(B,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"color",function(){return this._color}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(92,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector4",7),new yB(64,"vector4",6),new yB(80,"vector3",5)])}]),B}(),wB=function(){function B(B,g,l,o,V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate=o,this._tangent=V}p(B,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(64,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector4",5)])}]),B}(),iB=function(){function B(B,g,l,o,V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=B,this._normal=g,this._color=l,this._textureCoordinate=o,this._tangent=V}p(B,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"color",function(){return this._color}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(60,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",1),new yB(40,"vector2",2),new yB(48,"vector3",5)])}]),B}(),aB=function(){function B(B,g,l){this._position=null,this._normal=null,this._tangent=null,this._position=B,this._normal=g,this._tangent=l}p(B,"laya.d3.graphics.VertexPositionNormalSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(40,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector4",5)])}]),B}(),zB=function(){function B(B,g,l){this._position=null,this._normal=null,this._tangent=null,this._position=B,this._normal=g,this._tangent=l}p(B,"laya.d3.graphics.VertexPositionNormalTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(36,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector3",5)])}]),B}(),tB=function(){function B(B,g,l){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=B,this._normal=g,this._textureCoordinate=l}p(B,"laya.d3.graphics.VertexPositionNormalTexture");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(32,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2)])}]),B}(),hB=function(){function B(B,g,l,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=B,this._normal=g,this._textureCoordinate0=l,this._textureCoordinate1=o}p(B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(40,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15)])}]),B}(),fB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=B,this._normal=g,this._textureCoordinate0=l,this._textureCoordinate1=o,this._blendIndex=V,this._blendWeight=U}p(B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(72,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15),new yB(40,"vector4",7),new yB(56,"vector4",6)])}]),B}(),SB=function(){function B(B,g,l,o,V,U,y){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._textureCoordinate0=l,this._textureCoordinate1=o,this._tangent=V,this._blendIndex=U,this._blendWeight=y}p(B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(88,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15),new yB(40,"vector4",7),new yB(56,"vector4",6),new yB(72,"vector4",5)])}]),B}(),EB=function(){function B(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}p(B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),g.VertexPositionNormalTexture0SkinTangent=function(B,g,l,o,V,U,y){this._position=B,this._normal=g,this._textureCoordinate0=l,this._textureCoordinate1=o,this._tangent=V,this._blendIndex=U,this._blendWeight=y},x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(84,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15),new yB(40,"vector4",7),new yB(56,"vector4",6),new yB(72,"vector3",5)])}]),B}(),eB=function(){function B(B,g,l,o,V){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=B,this._normal=g,this._textureCoordinate0=l,this._textureCoordinate1=o,this._tangent=V}p(B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(56,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15),new yB(40,"vector4",5)])}]),B}(),QB=function(){function B(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}p(B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),g.VertexPositionNormalTexture0Tangent=function(B,g,l,o,V){this._position=B,this._normal=g,this._textureCoordinate0=l,this._textureCoordinate1=o,this._tangent=V},x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(52,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15),new yB(40,"vector3",5)])}]),B}(),_B=function(){function B(B,g,l,o,V){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=B,this._normal=g,this._textureCoordinate=l,this._blendIndex=o,this._blendWeight=V}p(B,"laya.d3.graphics.VertexPositionNormalTextureSkin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(64,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector4",7),new yB(48,"vector4",6)])}]),B}(),PB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._textureCoordinate=l,this._tangent=o,this._blendIndex=V,this._blendWeight=U}p(B,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(80,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector4",7),new yB(48,"vector4",6),new yB(64,"vector4",5)])}]),B}(),YB=function(){function B(B,g,l,o,V,U){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=B,this._normal=g,this._textureCoordinate=l,this._tangent=o,this._blendIndex=V,this._blendWeight=U}p(B,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(76,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector4",7),new yB(48,"vector4",6),new yB(64,"vector3",5)])}]),B}(),cB=function(){function B(B,g,l,o){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=B,this._normal=g,this._textureCoordinate=l,this._tangent=o}p(B,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(48,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector4",5)])}]),B}(),rB=function(){function B(B,g,l,o){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=B,this._normal=g,this._textureCoordinate=l,this._tangent=o}p(B,"laya.d3.graphics.VertexPositionNormalTextureTangent");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(44,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector3",5)])}]),B}(),ZB=function(){function B(B,g,l){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=B,this._normal=g,this._textureCoordinate=l}p(B,"laya.d3.graphics.VertexPositionNTBTexture");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(56,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector3",5),new yB(36,"vector3",4),new yB(48,"vector2",2)])}]),B}(),TB=function(){function B(B,g,l,o,V,U,y,G){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=B,this._normal=g,this._textureCoordinate0=o,this._textureCoordinate1=V,this._tangent=U,l=l,this._blendIndex=y,this._blendWeight=G}p(B,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"tangent",function(){return this._tangent}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(0,g,"textureCoordinate1",function(){return this._textureCoordinate1}),x(0,g,"blendIndex",function(){return this._blendIndex}),x(0,g,"blendWeight",function(){return this._blendWeight}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(96,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector3",5),new yB(36,"vector3",4),new yB(48,"vector2",2),new yB(56,"vector2",15),new yB(64,"vector4",7),new yB(80,"vector4",6)])}]),B}(),RB=function(){function B(B,g,l){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=B,this._normal=g,this._textureCoordinate=l}p(B,"laya.d3.graphics.VertexPositionNTBTextureSkin");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"textureCoordinate",function(){return this._textureCoordinate}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(88,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector3",5),new yB(36,"vector3",4),new yB(48,"vector2",2),new yB(56,"vector4",7),new yB(72,"vector4",6)])}]),B}(),WB=(function(){function B(B,g,l,o){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=B,this._normal=g,this._textureCoord0=l,this._textureCoord1=o}p(B,"laya.d3.graphics.VertexPositionTerrain");var g=B.prototype;D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"normal",function(){return this._normal}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoord0",function(){return this._textureCoord0}),x(0,g,"textureCoord1",function(){return this._textureCoord1}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(40,[new yB(0,"vector3",0),new yB(12,"vector3",3),new yB(24,"vector2",2),new yB(32,"vector2",15)])}])}(),function(){function B(B,g){this._position=null,this._textureCoordinate0=null,this._position=B,this._textureCoordinate0=g}p(B,"laya.d3.graphics.VertexPositionTexture0");var g=B.prototype;return D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"position",function(){return this._position}),x(0,g,"textureCoordinate0",function(){return this._textureCoordinate0}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(20,[new yB(0,"vector3",0),new yB(12,"vector2",2)])}]),B}()),nB=(function(){function B(B,g,l,o,V,U,y,G,d,j,A,H,K,p){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=B,this._positionStartLifeTime=g,this._velocity=l,this._startColor=o,this._startSize=V,this._startRotation0=U,this._startRotation1=y,this._startRotation2=G,this._startLifeTime=d,this._time=j,this._startSpeed=A,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=p}p(B,"laya.d3.graphics.VertexShurikenParticleBillboard");var g=B.prototype;D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),x(0,g,"random1",function(){return this._randoms1}),x(0,g,"startRotation2",function(){return this._startRotation2}),x(0,g,"positionStartLifeTime",function(){return this._positionStartLifeTime}),x(0,g,"velocity",function(){return this._velocity}),x(0,g,"random0",function(){return this._randoms0}),x(0,g,"startSize",function(){return this._startSize}),x(0,g,"startColor",function(){return this._startColor}),x(0,g,"startRotation0",function(){return this._startRotation0}),x(0,g,"startRotation1",function(){return this._startRotation1}),x(0,g,"startLifeTime",function(){return this._startLifeTime}),x(0,g,"time",function(){return this._time}),x(0,g,"startSpeed",function(){return this._startSpeed}),x(0,g,"simulationWorldPostion",function(){return this._simulationWorldPostion}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(152,[new yB(0,"vector4",17),new yB(16,"vector4",30),new yB(32,"vector4",32),new yB(48,"vector4",19),new yB(64,"vector3",20),new yB(76,"vector3",22),new yB(88,"single",31),new yB(92,"vector4",34),new yB(108,"vector4",35),new yB(124,"vector3",36),new yB(136,"vector4",37)])}])}(),function(){function B(B,g,l,o,V,U,y,G,d,j,A,H,K,p){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=B,this._positionStartLifeTime=g,this._velocity=l,this._startColor=o,this._startSize=V,this._startRotation0=U,this._startRotation1=y,this._startRotation2=G,this._startLifeTime=d,this._time=j,this._startSpeed=A,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=p}p(B,"laya.d3.graphics.VertexShurikenParticleMesh");var g=B.prototype;D.imps(g,{"laya.d3.graphics.IVertex":!0}),x(0,g,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),x(0,g,"velocity",function(){return this._velocity}),x(0,g,"position",function(){return this._positionStartLifeTime}),x(0,g,"random0",function(){return this._randoms0}),x(0,g,"startSize",function(){return this._startSize}),x(0,g,"startColor",function(){return this._startColor}),x(0,g,"startRotation0",function(){return this._startRotation0}),x(0,g,"startRotation1",function(){return this._startRotation1}),x(0,g,"random1",function(){return this._randoms1}),x(0,g,"startRotation2",function(){return this._startRotation2}),x(0,g,"startLifeTime",function(){return this._startLifeTime}),x(0,g,"time",function(){return this._time}),x(0,g,"startSpeed",function(){return this._startSpeed}),x(0,g,"simulationWorldPostion",function(){return this._simulationWorldPostion}),x(0,g,"vertexDeclaration",function(){return B._vertexDeclaration}),x(1,B,"vertexDeclaration",function(){return B._vertexDeclaration}),H(B,["_vertexDeclaration",function(){return this._vertexDeclaration=new UB(172,[new yB(0,"vector3",0),new yB(12,"vector4",1),new yB(28,"vector2",2),new yB(36,"vector4",30),new yB(52,"vector4",32),new yB(68,"vector4",19),new yB(84,"vector3",20),new yB(96,"vector3",22),new yB(108,"single",31),new yB(112,"vector4",34),new yB(128,"vector4",35),new yB(144,"vector3",36),new yB(156,"vector4",37)])}])}(),function(){function M(B,g,l,o,V,U){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=l,this._materials=o,this._subMeshes=V,this._materialMap=U,this._version=g,this._onLoaded(B)}p(M,"laya.d3.loaders.LoadModelV01");var B=M.prototype;return B._onLoaded=function(B){this._readData=B,this.READ_BLOCK();for(var g=0;g<this._BLOCK.count;g++){var l=this._readData.getUint16(),o=this._strings[l],V=this["READ_"+o];if(null==V)throw new Error("model file err,no this function:"+l+" "+o);if(!V.call(this))break}return this._mesh},B.onError=function(){},B._readString=function(){return this._strings[this._readData.getUint16()]},B.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},B.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},B.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var B=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var g=0;g<this._STRINGS.size;g++)this._strings[g]=this._readData.readUTFString();return this._readData.pos=B,!0},B.READ_MATERIAL=function(){var B=this._readData.getUint16(),g=(this._readString(),this._readString());return this._materials[B]="null"!==g?C.getRes(this._materialMap[g]):new zg,!0},B.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var B,g=this._readData.__getBuffer(),l=0,o=this._readData.getUint32(),V=this._readData.getUint32(),U=(new Float32Array(g.slice(o+this._DATA.offset,o+this._DATA.offset+V)),this._readData.getUint32()),y=this._readData.getUint32(),G=new Float32Array(g.slice(U+this._DATA.offset,U+this._DATA.offset+y));for(this.mesh._inverseBindPoses=[],l=0,B=G.length;l<B;l+=16){var d=new Bg(G[l+0],G[l+1],G[l+2],G[l+3],G[l+4],G[l+5],G[l+6],G[l+7],G[l+8],G[l+9],G[l+10],G[l+11],G[l+12],G[l+13],G[l+14],G[l+15]);this.mesh._inverseBindPoses.push(d)}break;default:throw new Error("LoadModel:unknown version.")}return!0},B.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var B=this._readString();this._shaderAttributes=B.match(M._attrReg);var g=this._readData.getUint32(),l=this._readData.getUint32(),o=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),V=this._readData.getUint32(),U=this._readData.getUint32(),y=this._readData.getUint32(),G=this._readData.__getBuffer(),d=new jg(this._mesh),j=this._getVertexDeclaration(),A=Yg.create(j,V/j.vertexStride,35044,!0),H=o+this._DATA.offset,K=G.slice(H,H+V);A.setData(new Float32Array(K));for(var p=(d._vertexBuffer=A).vertexDeclaration.getVertexElements(),x=0;x<p.length;x++)d._bufferUsage[p[x].elementUsage]=A;var N=Pg.create("ushort",l/2,35044,!0),F=g+this._DATA.offset,C=G.slice(F,F+l);N.setData(new Uint16Array(C)),d._indexBuffer=N;var m=G.slice(U+this._DATA.offset,U+this._DATA.offset+y);return d._boneIndicesList[0]=new Uint8Array(m),this._subMeshes.push(d),!0},B.READ_DATAAREA=function(){return!1},B._getVertexDeclaration=function(){for(var B,g=!1,l=!1,o=!1,V=!1,U=!1,y=!1,G=!1,d=!1,j=!1,A=0;A<this._shaderAttributes.length;A+=8)switch(this._shaderAttributes[A]){case"POSITION":g=!0;break;case"NORMAL":l=!0;break;case"COLOR":o=!0;break;case"UV":V=!0;break;case"UV1":U=!0;break;case"BLENDWEIGHT":G=!0;break;case"BLENDINDICES":d=!0;break;case"TANGENT":y=!0;break;case"BINORMAL":j=!0}return g&&l&&o&&V&&U&&G&&d&&y?B=MB.vertexDeclaration:g&&l&&o&&V&&U&&G&&d?B=CB.vertexDeclaration:g&&l&&V&&U&&G&&d&&y?B=EB.vertexDeclaration:g&&l&&V&&U&&G&&d?B=fB.vertexDeclaration:g&&l&&o&&V&&G&&d&&y?B=XB.vertexDeclaration:g&&l&&o&&V&&G&&d?B=vB.vertexDeclaration:g&&l&&y&&j&&V&&G&&d?B=RB.vertexDeclaration:g&&l&&V&&G&&d&&y?B=YB.vertexDeclaration:g&&l&&V&&G&&d?B=_B.vertexDeclaration:g&&l&&o&&G&&d&&y?B=KB.vertexDeclaration:g&&l&&o&&G&&d?B=AB.vertexDeclaration:g&&l&&o&&V&&U&&y?B=DB.vertexDeclaration:g&&l&&o&&V&&U?B=FB.vertexDeclaration:g&&l&&V&&U&&y?B=QB.vertexDeclaration:g&&l&&V&&U?B=hB.vertexDeclaration:g&&l&&o&&V&&y?B=iB.vertexDeclaration:g&&l&&V&&y&&j?B=ZB.vertexDeclaration:g&&l&&o&&V?B=NB.vertexDeclaration:g&&l&&V&&y?B=rB.vertexDeclaration:g&&l&&V?B=tB.vertexDeclaration:g&&l&&o&&y?B=xB.vertexDeclaration:g&&l&&o&&(B=jB.vertexDeclaration),B},x(0,B,"mesh",function(){return this._mesh}),M._attrReg=new RegExp("(\\w+)|([:,;])","g"),M}()),LB=function(){function s(){}return p(s,"laya.d3.loaders.LoadModelV02"),s.parse=function(B,g,l,o,V,U){s._mesh=l,s._materials=o,s._subMeshes=V,s._materialMap=U,s._version=g,s._readData=B,s.READ_DATA(),s.READ_BLOCK(),s.READ_STRINGS();for(var y=0,G=s._BLOCK.count;y<G;y++){s._readData.pos=s._BLOCK.blockStarts[y];var d=s._readData.getUint16(),j=s._strings[d],A=s["READ_"+j];if(null==A)throw new Error("model file err,no this function:"+d+" "+j);A.call()}s._strings.length=0,s._readData=null,s._version=null,s._mesh=null,s._materials=null,s._subMeshes=null,s._materialMap=null},s._readString=function(){return s._strings[s._readData.getUint16()]},s.READ_DATA=function(){s._DATA.offset=s._readData.getUint32(),s._DATA.size=s._readData.getUint32()},s.READ_BLOCK=function(){for(var B=s._BLOCK.count=s._readData.getUint16(),g=s._BLOCK.blockStarts=[],l=s._BLOCK.blockLengths=[],o=0;o<B;o++)g.push(s._readData.getUint32()),l.push(s._readData.getUint32())},s.READ_STRINGS=function(){var B=s._readData.getUint32(),g=s._readData.getUint16(),l=s._readData.pos;s._readData.pos=B+s._DATA.offset;for(var o=0;o<g;o++)s._strings[o]=s._readData.readUTFString();s._readData.pos=l},s.READ_MATERIAL=function(){s._readString(),s._readString();var B=s._readString();return""!==B&&s._materials.push(C.getRes(s._materialMap[B])),!0},s.READ_MESH=function(){s._readString();var B,g=s._readData.__getBuffer(),l=0,o=s._readData.getInt16(),V=s._DATA.offset;for(l=0;l<o;l++){var U=V+s._readData.getUint32(),y=s._readData.getUint32(),G=new Float32Array(g.slice(U,U+y)),d=s._readString().match(s._attrReg),j=s._getVertexDeclaration(d),A=Yg.create(j,4*G.length/j.vertexStride,35044,!0);A.setData(G),s._mesh._vertexBuffers.push(A)}var H=V+s._readData.getUint32(),K=s._readData.getUint32(),p=new Uint16Array(g.slice(H,H+K)),x=Pg.create("ushort",K/2,35044,!0);x.setData(p),s._mesh._indexBuffer=x;var N=s._mesh._boneNames=[],F=s._readData.getUint16();for(N.length=F,l=0;l<F;l++)N[l]=s._strings[s._readData.getUint16()];var C=s._readData.getUint32(),m=s._readData.getUint32(),M=(new Float32Array(g.slice(V+C,V+C+m)),s._readData.getUint32()),b=s._readData.getUint32(),D=new Float32Array(g.slice(V+M,V+M+b));for(s._mesh._inverseBindPoses=[],l=0,B=D.length;l<B;l+=16){var v=new Bg(D[l+0],D[l+1],D[l+2],D[l+3],D[l+4],D[l+5],D[l+6],D[l+7],D[l+8],D[l+9],D[l+10],D[l+11],D[l+12],D[l+13],D[l+14],D[l+15]);s._mesh._inverseBindPoses.push(v)}return s._mesh._skinnedDatas=new Float32Array(16*D.length),!0},s.READ_SUBMESH=function(){var B=s._readData.__getBuffer(),g=new jg(s._mesh),l=s._readData.getInt16(),o=s._readData.getUint32(),V=s._readData.getUint32();g._vertexBuffer=s._mesh._vertexBuffers[l],g._vertexStart=o,g._vertexCount=V;var U=s._readData.getUint32(),y=s._readData.getUint32(),G=s._mesh._indexBuffer;g._indexBuffer=G,g._indexStart=U,g._indexCount=y,g._indices=new Uint16Array(G.getData().buffer,2*U,y);var d=s._DATA.offset,j=g._subIndexBufferStart,A=g._subIndexBufferCount,H=g._boneIndicesList,K=s._readData.getUint16();j.length=K,A.length=K,H.length=K;for(var p=0;p<K;p++){j[p]=s._readData.getUint32(),A[p]=s._readData.getUint32();var x=s._readData.getUint32(),N=s._readData.getUint32();g._boneIndicesList[p]=new Uint8Array(B.slice(d+x,d+x+N))}return s._subMeshes.push(g),!0},s._getVertexDeclaration=function(B){for(var g,l=!1,o=!1,V=!1,U=!1,y=!1,G=!1,d=!1,j=!1,A=!1,H=0;H<B.length;H++)switch(B[H]){case"POSITION":l=!0;break;case"NORMAL":o=!0;break;case"COLOR":V=!0;break;case"UV":U=!0;break;case"UV1":y=!0;break;case"BLENDWEIGHT":d=!0;break;case"BLENDINDICES":j=!0;break;case"TANGENT":G=!0;break;case"BINORMAL":A=!0}return l&&o&&V&&U&&y&&d&&j&&G?g=MB.vertexDeclaration:l&&o&&V&&U&&y&&d&&j?g=CB.vertexDeclaration:l&&o&&U&&y&&d&&j&&G?g=EB.vertexDeclaration:l&&o&&U&&y&&d&&j?g=fB.vertexDeclaration:l&&o&&V&&U&&d&&j&&G?g=XB.vertexDeclaration:l&&o&&V&&U&&d&&j?g=vB.vertexDeclaration:l&&o&&U&&d&&j&&G?g=YB.vertexDeclaration:l&&o&&U&&d&&j?g=_B.vertexDeclaration:l&&o&&V&&d&&j&&G?g=KB.vertexDeclaration:l&&o&&V&&d&&j?g=AB.vertexDeclaration:l&&o&&V&&U&&y&&G?g=DB.vertexDeclaration:l&&o&&V&&U&&y?g=FB.vertexDeclaration:l&&o&&U&&y&&G?g=QB.vertexDeclaration:l&&o&&U&&y?g=hB.vertexDeclaration:l&&o&&V&&U&&G?g=iB.vertexDeclaration:l&&o&&U&&G&&A?g=ZB.vertexDeclaration:l&&o&&V&&U?g=NB.vertexDeclaration:l&&o&&U&&G?g=rB.vertexDeclaration:l&&o&&U?g=tB.vertexDeclaration:l&&o&&V&&G?g=xB.vertexDeclaration:l&&o&&V&&(g=jB.vertexDeclaration),g},s._attrReg=new RegExp("(\\w+)|([:,;])","g"),s._strings=[],s._readData=null,s._version=null,s._mesh=null,s._materials=null,s._subMeshes=null,s._materialMap=null,H(s,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),s}(),IB=function(){function v(){}return p(v,"laya.d3.loaders.LoadModelV03"),v.parse=function(B,g,l,o,V){v._mesh=l,v._subMeshes=o,v._materialMap=V,v._version=g,v._readData=B,v.READ_DATA(),v.READ_BLOCK(),v.READ_STRINGS();for(var U=0,y=v._BLOCK.count;U<y;U++){v._readData.pos=v._BLOCK.blockStarts[U];var G=v._readData.getUint16(),d=v._strings[G],j=v["READ_"+d];if(null==j)throw new Error("model file err,no this function:"+G+" "+d);j.call()}v._strings.length=0,v._readData=null,v._version=null,v._mesh=null,v._subMeshes=null,v._materialMap=null},v._readString=function(){return v._strings[v._readData.getUint16()]},v.READ_DATA=function(){v._DATA.offset=v._readData.getUint32(),v._DATA.size=v._readData.getUint32()},v.READ_BLOCK=function(){for(var B=v._BLOCK.count=v._readData.getUint16(),g=v._BLOCK.blockStarts=[],l=v._BLOCK.blockLengths=[],o=0;o<B;o++)g.push(v._readData.getUint32()),l.push(v._readData.getUint32())},v.READ_STRINGS=function(){var B=v._readData.getUint32(),g=v._readData.getUint16(),l=v._readData.pos;v._readData.pos=B+v._DATA.offset;for(var o=0;o<g;o++)v._strings[o]=v._readData.readUTFString();v._readData.pos=l},v.READ_MESH=function(){var B,g=v._readString(),l=v._readData.__getBuffer(),o=0,V=v._readData.getInt16(),U=v._DATA.offset;for(o=0;o<V;o++){var y,G=U+v._readData.getUint32(),d=v._readData.getUint32(),j=new Float32Array(l.slice(G,G+d)),A=v._readString();switch(v._version){case"LAYAMODEL:03":y=v._vertexDeclarationMap_Discard[A];break;case"LAYAMODEL:0301":y=v._vertexDeclarationMap[A];break;default:throw new Error("LoadModelV03: unknown version.")}if(!y)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+v._version+"  bufferAttribute="+A+"  name="+g+"  url="+(v._mesh?v._mesh.url:"null"));var H=Yg.create(y,4*j.length/y.vertexStride,35044,!0,v._mesh._url+"_"+o);H.setData(j),v._mesh._vertexBuffers.push(H)}var K=U+v._readData.getUint32(),p=v._readData.getUint32(),x=new Uint16Array(l.slice(K,K+p)),N=Pg.create("ushort",p/2,35044,!0,v._mesh._url);N.setData(x),v._mesh._indexBuffer=N;var F=v._mesh._boneNames=[],C=v._readData.getUint16();for(F.length=C,o=0;o<C;o++)F[o]=v._strings[v._readData.getUint16()];v._readData.pos+=8;var m=v._readData.getUint32(),M=v._readData.getUint32(),b=new Float32Array(l.slice(U+m,U+m+M));for(v._mesh._inverseBindPoses=[],o=0,B=b.length;o<B;o+=16){var D=new Bg(b[o+0],b[o+1],b[o+2],b[o+3],b[o+4],b[o+5],b[o+6],b[o+7],b[o+8],b[o+9],b[o+10],b[o+11],b[o+12],b[o+13],b[o+14],b[o+15]);v._mesh._inverseBindPoses.push(D)}return v._mesh._skinnedDatas=new Float32Array(16*b.length),!0},v.READ_SUBMESH=function(){var B=v._readData.__getBuffer(),g=new jg(v._mesh),l=v._readData.getInt16(),o=v._readData.getUint32(),V=v._readData.getUint32();g._vertexBuffer=v._mesh._vertexBuffers[l],g._vertexStart=o,g._vertexCount=V;var U=v._readData.getUint32(),y=v._readData.getUint32(),G=v._mesh._indexBuffer;g._indexBuffer=G,g._indexStart=U,g._indexCount=y,g._indices=new Uint16Array(G.getData().buffer,2*U,y);var d=v._DATA.offset,j=g._subIndexBufferStart,A=g._subIndexBufferCount,H=g._boneIndicesList,K=v._readData.getUint16();j.length=K,A.length=K,H.length=K;for(var p=0;p<K;p++){j[p]=v._readData.getUint32(),A[p]=v._readData.getUint32();var x=v._readData.getUint32(),N=v._readData.getUint32();H[p]=new Uint8Array(B.slice(d+x,d+x+N))}return v._subMeshes.push(g),!0},v._strings=[],v._readData=null,v._version=null,v._mesh=null,v._subMeshes=null,v._materialMap=null,H(v,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":MB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":CB.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":TB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":EB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":fB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":XB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":vB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":YB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":_B.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":KB.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":AB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":DB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":FB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":QB.vertexDeclaration,"POSITION,NORMAL,UV,UV1":hB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":iB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":ZB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":NB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":rB.vertexDeclaration,"POSITION,NORMAL,UV":tB.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":xB.vertexDeclaration,"POSITION,NORMAL,COLOR":jB.vertexDeclaration,"POSITION,NORMAL,TANGENT":zB.vertexDeclaration,"POSITION,NORMAL":dB.vertexDeclaration,"POSITION,UV":WB.vertexDeclaration,POSITION:GB.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":mB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":CB.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":TB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":SB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":fB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":sB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":vB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":PB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":_B.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":HB.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":AB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":bB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":FB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":eB.vertexDeclaration,"POSITION,NORMAL,UV,UV1":hB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":wB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":ZB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":NB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":cB.vertexDeclaration,"POSITION,NORMAL,UV":tB.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":pB.vertexDeclaration,"POSITION,NORMAL,COLOR":jB.vertexDeclaration,"POSITION,NORMAL,TANGENT":aB.vertexDeclaration,"POSITION,NORMAL":dB.vertexDeclaration,"POSITION,UV":WB.vertexDeclaration,POSITION:GB.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),v}(),kB=function(){function G(){}return p(G,"laya.d3.loaders.MeshReader"),G.read=function(B,g,l,o,V){var U=new v(B);U.pos=0;var y=U.readUTFString();switch(y){case"LAYAMODEL:01":case"LAYASKINANI:01":G._readVersion01(U,y,g,l,o,V);break;case"LAYAMODEL:02":LB.parse(U,y,g,l,o,V);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":IB.parse(U,y,g,o,V);break;default:throw new Error("MeshReader: unknown mesh version.")}g._setSubMeshes(o)},G._readVersion01=function(B,g,l,o,V,U){new nB(B,g,l,o,V,U)},G}(),JB=function(){function B(B,g){this.min=null,this.max=null,this.min=B,this.max=g}p(B,"laya.d3.math.BoundBox");var g=B.prototype;return D.imps(g,{"laya.d3.core.IClone":!0}),g.getCorners=function(B){B.length=8;var g=this.min.elements,l=this.max.elements,o=g[0],V=g[1],U=g[2],y=l[0],G=l[1],d=l[2];B[0]=new yg(o,G,d),B[1]=new yg(y,G,d),B[2]=new yg(y,V,d),B[3]=new yg(o,V,d),B[4]=new yg(o,G,U),B[5]=new yg(y,G,U),B[6]=new yg(y,V,U),B[7]=new yg(o,V,U)},g.toDefault=function(){this.min.toDefault(),this.max.toDefault()},g.cloneTo=function(B){var g=B;this.min.cloneTo(g.min),this.max.cloneTo(g.max)},g.clone=function(){var B=new this.constructor(new yg,new yg);return this.cloneTo(B),B},B.createfromPoints=function(B,g){if(null==B)throw new Error("points");var l=g.min,o=g.max,V=l.elements;V[0]=Number.MAX_VALUE,V[1]=Number.MAX_VALUE,V[2]=Number.MAX_VALUE;var U=o.elements;U[0]=-Number.MAX_VALUE,U[1]=-Number.MAX_VALUE,U[2]=-Number.MAX_VALUE;for(var y=0,G=B.length;y<G;++y)yg.min(l,B[y],l),yg.max(o,B[y],o)},B.merge=function(B,g,l){yg.min(B.min,g.min,l.min),yg.max(B.max,g.max,l.max)},B}(),$B=function(){function j(B){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=B,this._near=new gg(new yg),this._far=new gg(new yg),this._left=new gg(new yg),this._right=new gg(new yg),this._top=new gg(new yg),this._bottom=new gg(new yg),j._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}p(j,"laya.d3.math.BoundFrustum");var B=j.prototype;return B.equalsBoundFrustum=function(B){return this._matrix.equalsOtherMatrix(B.matrix)},B.equalsObj=function(B){if(B instanceof laya.d3.math.BoundFrustum){var g=B;return this.equalsBoundFrustum(g)}return!1},B.getPlane=function(B){switch(B){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},B.getCorners=function(B){j._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(B[0]),j._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(B[1]),j._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(B[2]),j._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(B[3]),j._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(B[4]),j._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(B[5]),j._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(B[6]),j._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(B[7])},B.containsPoint=function(B){for(var g=gg.PlaneIntersectionType_Front,l=gg.PlaneIntersectionType_Front,o=0;o<6;o++){switch(o){case 0:l=Collision.intersectsPlaneAndPoint(this._near,B);break;case 1:l=Collision.intersectsPlaneAndPoint(this._far,B);break;case 2:l=Collision.intersectsPlaneAndPoint(this._left,B);break;case 3:l=Collision.intersectsPlaneAndPoint(this._right,B);break;case 4:l=Collision.intersectsPlaneAndPoint(this._top,B);break;case 5:l=Collision.intersectsPlaneAndPoint(this._bottom,B)}switch(l){case gg.PlaneIntersectionType_Back:return 0;case gg.PlaneIntersectionType_Intersecting:g=gg.PlaneIntersectionType_Intersecting}}switch(g){case gg.PlaneIntersectionType_Intersecting:return 2;default:return 1}},B.containsBoundBox=function(B){for(var g,l=j._tempV30,o=j._tempV31,V=1,U=0;U<6;U++){if(g=this.getPlane(U),this._getBoxToPlanePVertexNVertex(B,g.normal,l,o),Collision.intersectsPlaneAndPoint(g,l)===gg.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(g,o)===gg.PlaneIntersectionType_Back&&(V=2)}return V},B.containsBoundSphere=function(B){for(var g=gg.PlaneIntersectionType_Front,l=gg.PlaneIntersectionType_Front,o=0;o<6;o++){switch(o){case 0:l=Collision.intersectsPlaneAndSphere(this._near,B);break;case 1:l=Collision.intersectsPlaneAndSphere(this._far,B);break;case 2:l=Collision.intersectsPlaneAndSphere(this._left,B);break;case 3:l=Collision.intersectsPlaneAndSphere(this._right,B);break;case 4:l=Collision.intersectsPlaneAndSphere(this._top,B);break;case 5:l=Collision.intersectsPlaneAndSphere(this._bottom,B)}switch(l){case gg.PlaneIntersectionType_Back:return 0;case gg.PlaneIntersectionType_Intersecting:g=gg.PlaneIntersectionType_Intersecting}}switch(g){case gg.PlaneIntersectionType_Intersecting:return 2;default:return 1}},B._getBoxToPlanePVertexNVertex=function(B,g,l,o){var V=B.min,U=V.elements,y=B.max,G=y.elements,d=g.elements,j=d[0],A=d[1],H=d[2];V.cloneTo(l);var K=l.elements;0<=j&&(K[0]=G[0]),0<=A&&(K[1]=G[1]),0<=H&&(K[2]=G[2]),y.cloneTo(o);var p=o.elements;0<=j&&(p[0]=U[0]),0<=A&&(p[1]=U[1]),0<=H&&(p[2]=U[2])},x(0,B,"top",function(){return this._top}),x(0,B,"matrix",function(){return this._matrix},function(B){this._matrix=B,j._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),x(0,B,"near",function(){return this._near}),x(0,B,"far",function(){return this._far}),x(0,B,"left",function(){return this._left}),x(0,B,"right",function(){return this._right}),x(0,B,"bottom",function(){return this._bottom}),j._getPlanesFromMatrix=function(B,g,l,o,V,U,y){var G=B.elements,d=G[0],j=G[1],A=G[2],H=G[3],K=G[4],p=G[5],x=G[6],N=G[7],F=G[8],C=G[9],m=G[10],M=G[11],b=G[12],D=G[13],v=G[14],s=G[15],X=g.normal.elements;X[0]=H+A,X[1]=N+x,X[2]=M+m,g.distance=s+v,g.normalize();var w=l.normal.elements;w[0]=H-A,w[1]=N-x,w[2]=M-m,l.distance=s-v,l.normalize();var i=o.normal.elements;i[0]=H+d,i[1]=N+K,i[2]=M+F,o.distance=s+b,o.normalize();var a=V.normal.elements;a[0]=H-d,a[1]=N-K,a[2]=M-F,V.distance=s-b,V.normalize();var z=U.normal.elements;z[0]=H-j,z[1]=N-p,z[2]=M-C,U.distance=s-D,U.normalize();var t=y.normal.elements;t[0]=H+j,t[1]=N+p,t[2]=M+C,y.distance=s+D,y.normalize()},j._get3PlaneInterPoint=function(B,g,l){var o=B.normal,V=g.normal,U=l.normal;yg.cross(V,U,j._tempV30),yg.cross(U,o,j._tempV31),yg.cross(o,V,j._tempV32);var y=yg.dot(o,j._tempV30),G=yg.dot(V,j._tempV31),d=yg.dot(U,j._tempV32);return yg.scale(j._tempV30,-B.distance/y,j._tempV33),yg.scale(j._tempV31,-g.distance/G,j._tempV34),yg.scale(j._tempV32,-l.distance/d,j._tempV35),yg.add(j._tempV33,j._tempV34,j._tempV36),yg.add(j._tempV35,j._tempV36,j._tempV37),j._tempV37},H(j,["_tempV30",function(){return this._tempV30=new yg},"_tempV31",function(){return this._tempV31=new yg},"_tempV32",function(){return this._tempV32=new yg},"_tempV33",function(){return this._tempV33=new yg},"_tempV34",function(){return this._tempV34=new yg},"_tempV35",function(){return this._tempV35=new yg},"_tempV36",function(){return this._tempV36=new yg},"_tempV37",function(){return this._tempV37=new yg}]),j}(),uB=function(){function A(B,g){this.center=null,this.radius=NaN,this.center=B,this.radius=g}p(A,"laya.d3.math.BoundSphere");var B=A.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.toDefault=function(){this.center.toDefault(),this.radius=0},B.intersectsRayDistance=function(B){return Collision.intersectsRayAndSphereRD(B,this)},B.intersectsRayPoint=function(B,g){return Collision.intersectsRayAndSphereRP(B,this,g)},B.cloneTo=function(B){var g=B;this.center.cloneTo(g.center),g.radius=this.radius},B.clone=function(){var B=new this.constructor(new yg,new yg);return this.cloneTo(B),B},A.createFromSubPoints=function(B,g,l,o){if(null==B)throw new Error("points");if(g<0||g>=B.length)throw new Error("start"+g+"Must be in the range [0, "+(B.length-1)+"]");if(l<0||g+l>B.length)throw new Error("count"+l+"Must be in the range <= "+B.length+"}");var V=g+l,U=A._tempVector3;U.elements[0]=0,U.elements[1]=0,U.elements[2]=0;for(var y=g;y<V;++y)yg.add(B[y],U,U);var G=o.center;yg.scale(U,1/l,G);var d=0;for(y=g;y<V;++y){var j=yg.distanceSquared(G,B[y]);d<j&&(d=j)}o.radius=Math.sqrt(d)},A.createfromPoints=function(B,g){if(null==B)throw new Error("points");A.createFromSubPoints(B,0,B.length,g)},H(A,["_tempVector3",function(){return this._tempVector3=new yg}]),A}(),qB=(function(){function B(){}p(B,"laya.d3.math.ContainmentType"),B.Disjoint=0,B.Contains=1,B.Intersects=2}(),function(){function l(){}return p(l,"laya.d3.math.MathUtils3D"),l.isZero=function(B){return Math.abs(B)<l.zeroTolerance},l.nearEqual=function(B,g){return!!l.isZero(B-g)},l.fastInvSqrt=function(B){return l.isZero(B)?B:1/Math.sqrt(B)},H(l,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),l}()),OB=function(){function d(){var B=this.elements=new Float32Array(9);B[0]=1,B[1]=0,B[2]=0,B[3]=0,B[4]=1,B[5]=0,B[6]=0,B[7]=0,B[8]=1}p(d,"laya.d3.math.Matrix3x3");var B=d.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.determinant=function(){var B=this.elements,g=B[0],l=B[1],o=B[2],V=B[3],U=B[4],y=B[5],G=B[6],d=B[7],j=B[8];return g*(j*U-y*d)+l*(-j*V+y*G)+o*(d*V-U*G)},B.translate=function(B,g){var l=g.elements,o=this.elements,V=B.elements,U=o[0],y=o[1],G=o[2],d=o[3],j=o[4],A=o[5],H=o[6],K=o[7],p=o[8],x=V[0],N=V[1];l[0]=U,l[1]=y,l[2]=G,l[3]=d,l[4]=j,l[5]=A,l[6]=x*U+N*d+H,l[7]=x*y+N*j+K,l[8]=x*G+N*A+p},B.rotate=function(B,g){var l=g.elements,o=this.elements,V=o[0],U=o[1],y=o[2],G=o[3],d=o[4],j=o[5],A=o[6],H=o[7],K=o[8],p=Math.sin(B),x=Math.cos(B);l[0]=x*V+p*G,l[1]=x*U+p*d,l[2]=x*y+p*j,l[3]=x*G-p*V,l[4]=x*d-p*U,l[5]=x*j-p*y,l[6]=A,l[7]=H,l[8]=K},B.scale=function(B,g){var l=g.elements,o=this.elements,V=B.elements,U=V[0],y=V[1];l[0]=U*o[0],l[1]=U*o[1],l[2]=U*o[2],l[3]=y*o[3],l[4]=y*o[4],l[5]=y*o[5],l[6]=o[6],l[7]=o[7],l[8]=o[8]},B.invert=function(B){var g=B.elements,l=this.elements,o=l[0],V=l[1],U=l[2],y=l[3],G=l[4],d=l[5],j=l[6],A=l[7],H=l[8],K=H*G-d*A,p=-H*y+d*j,x=A*y-G*j,N=o*K+V*p+U*x;N||(B=null),N=1/N,g[0]=K*N,g[1]=(-H*V+U*A)*N,g[2]=(d*V-U*G)*N,g[3]=p*N,g[4]=(H*o-U*j)*N,g[5]=(-d*o+U*y)*N,g[6]=x*N,g[7]=(-A*o+V*j)*N,g[8]=(G*o-V*y)*N},B.transpose=function(B){var g=B.elements,l=this.elements;if(B===this){var o=l[1],V=l[2],U=l[5];g[1]=l[3],g[2]=l[6],g[3]=o,g[5]=l[7],g[6]=V,g[7]=U}else g[0]=l[0],g[1]=l[3],g[2]=l[6],g[3]=l[1],g[4]=l[4],g[5]=l[7],g[6]=l[2],g[7]=l[5],g[8]=l[8]},B.identity=function(){var B=this.elements;B[0]=1,B[1]=0,B[2]=0,B[3]=0,B[4]=1,B[5]=0,B[6]=0,B[7]=0,B[8]=1},B.cloneTo=function(B){var g,l,o;if((l=this.elements)!==(o=B.elements))for(g=0;g<9;++g)o[g]=l[g]},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},d.createFromTranslation=function(B,g){g.elements;var l=B.elements;g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=1,g[5]=0,g[6]=l[0],g[7]=l[1],g[8]=1},d.createFromRotation=function(B,g){var l=g.elements,o=Math.sin(B),V=Math.cos(B);l[0]=V,l[1]=o,l[2]=0,l[3]=-o,l[4]=V,l[5]=0,l[6]=0,l[7]=0,l[8]=1},d.createFromScaling=function(B,g){var l=g.elements,o=B.elements;l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=o[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1},d.createFromMatrix4x4=function(B,g){g[0]=B[0],g[1]=B[1],g[2]=B[2],g[3]=B[4],g[4]=B[5],g[5]=B[6],g[6]=B[8],g[7]=B[9],g[8]=B[10]},d.multiply=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements,y=V[0],G=V[1],d=V[2],j=V[3],A=V[4],H=V[5],K=V[6],p=V[7],x=V[8],N=U[0],F=U[1],C=U[2],m=U[3],M=U[4],b=U[5],D=U[6],v=U[7],s=U[8];o[0]=N*y+F*j+C*K,o[1]=N*G+F*A+C*p,o[2]=N*d+F*H+C*x,o[3]=m*y+M*j+b*K,o[4]=m*G+M*A+b*p,o[5]=m*d+M*H+b*x,o[6]=D*y+v*j+s*K,o[7]=D*G+v*A+s*p,o[8]=D*d+v*H+s*x},d.lookAt=function(B,g,l,o){yg.subtract(B,g,d._tempV30),yg.normalize(d._tempV30,d._tempV30),yg.cross(l,d._tempV30,d._tempV31),yg.normalize(d._tempV31,d._tempV31),yg.cross(d._tempV30,d._tempV31,d._tempV32);var V=d._tempV30.elements,U=d._tempV31.elements,y=d._tempV32.elements,G=o.elements;G[0]=U[0],G[3]=U[1],G[6]=U[2],G[1]=y[0],G[4]=y[1],G[7]=y[2],G[2]=V[0],G[5]=V[1],G[8]=V[2]},d.DEFAULT=new d,H(d,["_tempV30",function(){return this._tempV30=new yg},"_tempV31",function(){return this._tempV31=new yg},"_tempV32",function(){return this._tempV32=new yg}]),d}(),Bg=function(){function w(B,g,l,o,V,U,y,G,d,j,A,H,K,p,x,N){void 0===B&&(B=1),void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0),void 0===V&&(V=0),void 0===U&&(U=1),void 0===y&&(y=0),void 0===G&&(G=0),void 0===d&&(d=0),void 0===j&&(j=0),void 0===A&&(A=1),void 0===H&&(H=0),void 0===K&&(K=0),void 0===p&&(p=0),void 0===x&&(x=0),void 0===N&&(N=1);var F=this.elements=new Float32Array(16);F[0]=B,F[1]=g,F[2]=l,F[3]=o,F[4]=V,F[5]=U,F[6]=y,F[7]=G,F[8]=d,F[9]=j,F[10]=A,F[11]=H,F[12]=K,F[13]=p,F[14]=x,F[15]=N}p(w,"laya.d3.math.Matrix4x4");var B=w.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.getElementByRowColumn=function(B,g){if(B<0||3<B)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(g<0||3<g)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*B+g]},B.setElementByRowColumn=function(B,g,l){if(B<0||3<B)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(g<0||3<g)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*B+g]=l},B.equalsOtherMatrix=function(B){var g=this.elements,l=B.elements;return qB.nearEqual(g[0],l[0])&&qB.nearEqual(g[1],l[1])&&qB.nearEqual(g[2],l[2])&&qB.nearEqual(g[3],l[3])&&qB.nearEqual(g[4],l[4])&&qB.nearEqual(g[5],l[5])&&qB.nearEqual(g[6],l[6])&&qB.nearEqual(g[7],l[7])&&qB.nearEqual(g[8],l[8])&&qB.nearEqual(g[9],l[9])&&qB.nearEqual(g[10],l[10])&&qB.nearEqual(g[11],l[11])&&qB.nearEqual(g[12],l[12])&&qB.nearEqual(g[13],l[13])&&qB.nearEqual(g[14],l[14])&&qB.nearEqual(g[15],l[15])},B.decomposeTransRotScale=function(B,g,l){var o=w._tempMatrix4x4;return this.decomposeTransRotMatScale(B,o,l)?(lg.createFromMatrix4x4(o,g),!0):(g.identity(),!1)},B.decomposeTransRotMatScale=function(B,g,l){var o=this.elements,V=B.elements,U=g.elements,y=l.elements;V[0]=o[12],V[1]=o[13],V[2]=o[14];var G=o[0],d=o[1],j=o[2],A=o[4],H=o[5],K=o[6],p=o[8],x=o[9],N=o[10],F=y[0]=Math.sqrt(G*G+d*d+j*j),C=y[1]=Math.sqrt(A*A+H*H+K*K),m=y[2]=Math.sqrt(p*p+x*x+N*N);if(qB.isZero(F)||qB.isZero(C)||qB.isZero(m))return U[1]=U[2]=U[3]=U[4]=U[6]=U[7]=U[8]=U[9]=U[11]=U[12]=U[13]=U[14]=0,U[0]=U[5]=U[10]=U[15]=1,!1;var M=w._tempVector0,b=M.elements;b[0]=p/m,b[1]=x/m,b[2]=N/m;var D=w._tempVector1,v=D.elements;v[0]=G/F,v[1]=d/F,v[2]=j/F;var s=w._tempVector2;yg.cross(M,D,s);var X=w._tempVector1;return yg.cross(s,M,X),U[3]=U[7]=U[11]=U[12]=U[13]=U[14]=0,U[15]=1,U[0]=X.x,U[1]=X.y,U[2]=X.z,U[4]=s.x,U[5]=s.y,U[6]=s.z,U[8]=M.x,U[9]=M.y,U[10]=M.z,U[0]*G+U[1]*d+U[2]*j<0&&(y[0]=-F),U[4]*A+U[5]*H+U[6]*K<0&&(y[1]=-C),U[8]*p+U[9]*x+U[10]*N<0&&(y[2]=-m),!0},B.decomposeYawPitchRoll=function(B){var g=B.elements,l=Math.asin(-this.elements[9]);g[1]=l,Math.cos(l)>qB.zeroTolerance?(g[2]=Math.atan2(this.elements[1],this.elements[5]),g[0]=Math.atan2(this.elements[8],this.elements[10])):(g[2]=Math.atan2(-this.elements[4],this.elements[0]),g[0]=0)},B.normalize=function(){var B=this.elements,g=B[0],l=B[1],o=B[2],V=Math.sqrt(g*g+l*l+o*o);if(!V)return B[0]=0,B[1]=0,void(B[2]=0);1!=V&&(V=1/V,B[0]=g*V,B[1]=l*V,B[2]=o*V)},B.transpose=function(){var B,g;return g=(B=this.elements)[1],B[1]=B[4],B[4]=g,g=B[2],B[2]=B[8],B[8]=g,g=B[3],B[3]=B[12],B[12]=g,g=B[6],B[6]=B[9],B[9]=g,g=B[7],B[7]=B[13],B[13]=g,g=B[11],B[11]=B[14],B[14]=g,this},B.invert=function(B){var g=this.elements,l=B.elements,o=g[0],V=g[1],U=g[2],y=g[3],G=g[4],d=g[5],j=g[6],A=g[7],H=g[8],K=g[9],p=g[10],x=g[11],N=g[12],F=g[13],C=g[14],m=g[15],M=o*d-V*G,b=o*j-U*G,D=o*A-y*G,v=V*j-U*d,s=V*A-y*d,X=U*A-y*j,w=H*F-K*N,i=H*C-p*N,a=H*m-x*N,z=K*C-p*F,t=K*m-x*F,h=p*m-x*C,f=M*h-b*t+D*z+v*a-s*i+X*w;0!==Math.abs(f)&&(f=1/f,l[0]=(d*h-j*t+A*z)*f,l[1]=(U*t-V*h-y*z)*f,l[2]=(F*X-C*s+m*v)*f,l[3]=(p*s-K*X-x*v)*f,l[4]=(j*a-G*h-A*i)*f,l[5]=(o*h-U*a+y*i)*f,l[6]=(C*D-N*X-m*b)*f,l[7]=(H*X-p*D+x*b)*f,l[8]=(G*t-d*a+A*w)*f,l[9]=(V*a-o*t-y*w)*f,l[10]=(N*s-F*D+m*M)*f,l[11]=(K*D-H*s-x*M)*f,l[12]=(d*i-G*z-j*w)*f,l[13]=(o*z-V*i+U*w)*f,l[14]=(F*b-N*v-C*M)*f,l[15]=(H*v-K*b+p*M)*f)},B.identity=function(){var B=this.elements;B[1]=B[2]=B[3]=B[4]=B[6]=B[7]=B[8]=B[9]=B[11]=B[12]=B[13]=B[14]=0,B[0]=B[5]=B[10]=B[15]=1},B.cloneTo=function(B){var g,l,o;if((l=this.elements)!==(o=B.elements))for(g=0;g<16;++g)o[g]=l[g]},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},B.getTranslationVector=function(B){var g=this.elements,l=B.elements;l[0]=g[12],l[1]=g[13],l[2]=g[14]},B.setTranslationVector=function(B){var g=this.elements,l=B.elements;g[12]=l[0],g[13]=l[1],g[14]=l[2]},B.getForward=function(B){var g=this.elements,l=B.elements;l[0]=-g[8],l[1]=-g[9],l[2]=-g[10]},B.setForward=function(B){var g=this.elements,l=B.elements;g[8]=-l[0],g[9]=-l[1],g[10]=-l[2]},w.createRotationX=function(B,g){var l=g.elements,o=Math.sin(B),V=Math.cos(B);l[1]=l[2]=l[3]=l[4]=l[7]=l[8]=l[11]=l[12]=l[13]=l[14]=0,l[0]=l[15]=1,l[5]=l[10]=V,l[6]=o,l[9]=-o},w.createRotationY=function(B,g){var l=g.elements,o=Math.sin(B),V=Math.cos(B);l[1]=l[3]=l[4]=l[6]=l[7]=l[9]=l[11]=l[12]=l[13]=l[14]=0,l[5]=l[15]=1,l[0]=l[10]=V,l[2]=-o,l[8]=o},w.createRotationZ=function(B,g){var l=g.elements,o=Math.sin(B),V=Math.cos(B);l[2]=l[3]=l[6]=l[7]=l[8]=l[9]=l[11]=l[12]=l[13]=l[14]=0,l[10]=l[15]=1,l[0]=l[5]=V,l[1]=o,l[4]=-o},w.createRotationYawPitchRoll=function(B,g,l,o){lg.createFromYawPitchRoll(B,g,l,w._tempQuaternion),w.createRotationQuaternion(w._tempQuaternion,o)},w.createRotationAxis=function(B,g,l){var o=B.elements,V=o[0],U=o[1],y=o[2],G=Math.cos(g),d=Math.sin(g),j=V*V,A=U*U,H=y*y,K=V*U,p=V*y,x=U*y,N=l.elements;N[3]=N[7]=N[11]=N[12]=N[13]=N[14]=0,N[15]=1,N[0]=j+G*(1-j),N[1]=K-G*K+d*y,N[2]=p-G*p-d*U,N[4]=K-G*K-d*y,N[5]=A+G*(1-A),N[6]=x-G*x+d*V,N[8]=p-G*p+d*U,N[9]=x-G*x-d*V,N[10]=H+G*(1-H)},w.createRotationQuaternion=function(B,g){var l=B.elements,o=g.elements,V=l[0],U=l[1],y=l[2],G=l[3],d=V*V,j=U*U,A=y*y,H=V*U,K=y*G,p=y*V,x=U*G,N=U*y,F=V*G;o[3]=o[7]=o[11]=o[12]=o[13]=o[14]=0,o[15]=1,o[0]=1-2*(j+A),o[1]=2*(H+K),o[2]=2*(p-x),o[4]=2*(H-K),o[5]=1-2*(A+d),o[6]=2*(N+F),o[8]=2*(p+x),o[9]=2*(N-F),o[10]=1-2*(j+d)},w.createTranslate=function(B,g){var l=B.elements,o=g.elements;o[4]=o[8]=o[1]=o[9]=o[2]=o[6]=o[3]=o[7]=o[11]=0,o[0]=o[5]=o[10]=o[15]=1,o[12]=l[0],o[13]=l[1],o[14]=l[2]},w.createScaling=function(B,g){var l=B.elements,o=g.elements;o[0]=l[0],o[5]=l[1],o[10]=l[2],o[1]=o[4]=o[8]=o[12]=o[9]=o[13]=o[2]=o[6]=o[14]=o[3]=o[7]=o[11]=0,o[15]=1},w.multiply=function(B,g,l){var o,V,U,y,G,d,j,A;for(V=l.elements,U=B.elements,V===(y=g.elements)&&(y=y.slice()),o=0;o<4;o++)G=U[o],d=U[o+4],j=U[o+8],A=U[o+12],V[o]=G*y[0]+d*y[1]+j*y[2]+A*y[3],V[o+4]=G*y[4]+d*y[5]+j*y[6]+A*y[7],V[o+8]=G*y[8]+d*y[9]+j*y[10]+A*y[11],V[o+12]=G*y[12]+d*y[13]+j*y[14]+A*y[15]},w.createFromQuaternion=function(B,g){var l=g.elements,o=B.elements,V=o[0],U=o[1],y=o[2],G=o[3],d=V+V,j=U+U,A=y+y,H=V*d,K=U*d,p=U*j,x=y*d,N=y*j,F=y*A,C=G*d,m=G*j,M=G*A;l[0]=1-p-F,l[1]=K+M,l[2]=x-m,l[3]=0,l[4]=K-M,l[5]=1-H-F,l[6]=N+C,l[7]=0,l[8]=x+m,l[9]=N-C,l[10]=1-H-p,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1},w.createAffineTransformation=function(B,g,l,o){var V=B.elements,U=g.elements,y=l.elements,G=o.elements,d=U[0],j=U[1],A=U[2],H=U[3],K=d+d,p=j+j,x=A+A,N=d*K,F=d*p,C=d*x,m=j*p,M=j*x,b=A*x,D=H*K,v=H*p,s=H*x,X=y[0],w=y[1],i=y[2];G[0]=(1-(m+b))*X,G[1]=(F+s)*X,G[2]=(C-v)*X,G[3]=0,G[4]=(F-s)*w,G[5]=(1-(N+b))*w,G[6]=(M+D)*w,G[7]=0,G[8]=(C+v)*i,G[9]=(M-D)*i,G[10]=(1-(N+m))*i,G[11]=0,G[12]=V[0],G[13]=V[1],G[14]=V[2],G[15]=1},w.createLookAt=function(B,g,l,o){var V=o.elements,U=w._tempVector0,y=w._tempVector1,G=w._tempVector2;yg.subtract(B,g,G),yg.normalize(G,G),yg.cross(l,G,U),yg.normalize(U,U),yg.cross(G,U,y),o.identity(),V[0]=U.x,V[4]=U.y,V[8]=U.z,V[1]=y.x,V[5]=y.y,V[9]=y.z,V[2]=G.x,V[6]=G.y,V[10]=G.z,V[12]=-yg.dot(U,B),V[13]=-yg.dot(y,B),V[14]=-yg.dot(G,B)},w.createPerspective=function(B,g,l,o,V){var U=V.elements,y=1/Math.tan(B/2),G=1/(l-o);U[0]=y/g,U[5]=y,U[10]=(o+l)*G,U[11]=-1,U[14]=2*o*l*G,U[1]=U[2]=U[3]=U[4]=U[6]=U[7]=U[8]=U[9]=U[12]=U[13]=U[15]=0},w.createOrthoOffCenterRH=function(B,g,l,o,V,U,y){var G=y.elements,d=1/(B-g),j=1/(l-o),A=1/(V-U);G[1]=G[2]=G[3]=G[4]=G[6]=G[7]=G[8]=G[9]=G[11]=0,G[15]=1,G[0]=-2*d,G[5]=-2*j,G[10]=2*A,G[12]=(B+g)*d,G[13]=(o+l)*j,G[14]=(U+V)*A},w.translation=function(B,g){var l=B.elements,o=g.elements;o[0]=o[5]=o[10]=o[15]=1,o[12]=l[0],o[13]=l[1],o[14]=l[2]},H(w,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new w},"_tempVector0",function(){return this._tempVector0=new yg},"_tempVector1",function(){return this._tempVector1=new yg},"_tempVector2",function(){return this._tempVector2=new yg},"_tempQuaternion",function(){return this._tempQuaternion=new lg},"DEFAULT",function(){return this.DEFAULT=new w},"ZERO",function(){return this.ZERO=new w(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),w}(),gg=(function(){function M(B,g){this.extents=null,this.transformation=null,this.extents=B,this.transformation=g}p(M,"laya.d3.math.OrientedBoundBox");var B=M.prototype;B.getCorners=function(B){var g=M._tempV30.elements,l=M._tempV31.elements,o=M._tempV32.elements,V=this.extents.elements;g[0]=V[0],g[1]=g[2]=0,l[1]=V[1],l[0]=l[2]=0,o[2]=V[2],o[0]=o[1]=0,yg.TransformNormal(M._tempV30,this.transformation,M._tempV30),yg.TransformNormal(M._tempV31,this.transformation,M._tempV31),yg.TransformNormal(M._tempV32,this.transformation,M._tempV32);var U=M._tempV33;this.transformation.getTranslationVector(U),B.length=8,yg.add(U,M._tempV30,M._tempV34),yg.add(M._tempV34,M._tempV31,M._tempV34),yg.add(M._tempV34,M._tempV32,B[0]),yg.add(U,M._tempV30,M._tempV34),yg.add(M._tempV34,M._tempV31,M._tempV34),yg.subtract(M._tempV34,M._tempV32,B[1]),yg.subtract(U,M._tempV30,M._tempV34),yg.add(M._tempV34,M._tempV31,M._tempV34),yg.subtract(M._tempV34,M._tempV32,B[2]),yg.subtract(U,M._tempV30,M._tempV34),yg.add(M._tempV34,M._tempV31,M._tempV34),yg.add(M._tempV34,M._tempV32,B[3]),yg.add(U,M._tempV30,M._tempV34),yg.subtract(M._tempV34,M._tempV31,M._tempV34),yg.add(M._tempV34,M._tempV32,B[4]),yg.add(U,M._tempV30,M._tempV34),yg.subtract(M._tempV34,M._tempV31,M._tempV34),yg.subtract(M._tempV34,M._tempV32,B[5]),yg.subtract(U,M._tempV30,M._tempV34),yg.subtract(M._tempV34,M._tempV31,M._tempV34),yg.subtract(M._tempV34,M._tempV32,B[6]),yg.subtract(U,M._tempV30,M._tempV34),yg.subtract(M._tempV34,M._tempV31,M._tempV34),yg.add(M._tempV34,M._tempV32,B[7])},B.transform=function(B){Bg.multiply(this.transformation,B,this.transformation)},B.scale=function(B){yg.multiply(this.extents,B,this.extents)},B.translate=function(B){this.transformation.getTranslationVector(M._tempV30),yg.add(M._tempV30,B,M._tempV31),this.transformation.setTranslationVector(M._tempV31)},B.Size=function(B){yg.scale(this.extents,2,B)},B.getSize=function(B){var g=this.extents.elements;M._tempV30.x=g[0],M._tempV31.y=g[1],M._tempV32.z=g[2],yg.TransformNormal(M._tempV30,this.transformation,M._tempV30),yg.TransformNormal(M._tempV31,this.transformation,M._tempV31),yg.TransformNormal(M._tempV31,this.transformation,M._tempV32);var l=B.elements;l[0]=yg.scalarLength(M._tempV30),l[1]=yg.scalarLength(M._tempV31),l[2]=yg.scalarLength(M._tempV32)},B.getSizeSquared=function(B){var g=this.extents.elements;M._tempV30.x=g[0],M._tempV31.y=g[1],M._tempV32.z=g[2],yg.TransformNormal(M._tempV30,this.transformation,M._tempV30),yg.TransformNormal(M._tempV31,this.transformation,M._tempV31),yg.TransformNormal(M._tempV31,this.transformation,M._tempV32);var l=B.elements;l[0]=yg.scalarLengthSquared(M._tempV30),l[1]=yg.scalarLengthSquared(M._tempV31),l[2]=yg.scalarLengthSquared(M._tempV32)},B.getCenter=function(B){this.transformation.getTranslationVector(B)},B.containsPoint=function(B){var g=this.extents.elements,l=g[0],o=g[1],V=g[2];this.transformation.invert(M._tempM0),yg.transformCoordinate(B,M._tempM0,M._tempV30);var U=M._tempV30.elements,y=Math.abs(U[0]),G=Math.abs(U[1]),d=Math.abs(U[2]);return qB.nearEqual(y,l)&&qB.nearEqual(G,o)&&qB.nearEqual(d,V)?2:y<l&&G<o&&d<V?1:0},B.containsPoints=function(B){var g=this.extents.elements,l=g[0],o=g[1],V=g[2];this.transformation.invert(M._tempM0);for(var U=!0,y=!1,G=0;G<B.length;G++){yg.transformCoordinate(B[G],M._tempM0,M._tempV30);var d=M._tempV30.elements,j=Math.abs(d[0]),A=Math.abs(d[1]),H=Math.abs(d[2]);qB.nearEqual(j,l)&&qB.nearEqual(A,o)&&qB.nearEqual(H,V)&&(y=!0),j<l&&A<o&&H<V?y=!0:U=!1}return U?1:y?2:0},B.containsSphere=function(B,g){void 0===g&&(g=!1);var l=this.extents.elements,o=l[0],V=l[1],U=l[2],y=B.radius;this.transformation.invert(M._tempM0),yg.transformCoordinate(B.center,M._tempM0,M._tempV30);var G=NaN;if(G=g?y:(yg.scale(yg.UnitX,y,M._tempV31),yg.TransformNormal(M._tempV31,M._tempM0,M._tempV31),yg.scalarLength(M._tempV31)),yg.scale(this.extents,-1,M._tempV32),yg.Clamp(M._tempV30,M._tempV32,this.extents,M._tempV33),G*G<yg.distanceSquared(M._tempV30,M._tempV33))return 0;var d=M._tempV30.elements,j=d[0],A=d[1],H=d[2],K=M._tempV32.elements,p=K[0],x=K[1],N=K[2];return p+G<=j&&j<=o-G&&G<o-p&&x+G<=A&&A<=V-G&&G<V-x&&N+G<=H&&H<=U-G&&G<U-N?1:2},B.containsOrientedBoundBox=function(B){var g=0,l=0;B.getCorners(M._corners);var o=this.containsPoints(M._corners);if(0!=o)return o;var V=this.extents.elements;B.extents.cloneTo(M._tempV35);var U=M._tempV35.elements;M._getRows(this.transformation,M._rows1),M._getRows(B.transformation,M._rows2);var y=NaN;for(g=0;g<4;g++)for(l=0;l<4;l++)3==g||3==l?(M._tempM0.setElementByRowColumn(g,l,0),M._tempM1.setElementByRowColumn(g,l,0)):(y=yg.dot(M._rows1[g],M._rows2[l]),M._tempM0.setElementByRowColumn(g,l,y),M._tempM1.setElementByRowColumn(g,l,Math.abs(y)));B.getCenter(M._tempV34),this.getCenter(M._tempV36),yg.subtract(M._tempV34,M._tempV36,M._tempV30);var G=M._tempV31.elements;G[0]=yg.dot(M._tempV30,M._rows1[0]),G[1]=yg.dot(M._tempV30,M._rows1[1]),G[2]=yg.dot(M._tempV30,M._rows1[2]);var d=M._tempV32.elements,j=M._tempV33.elements;for(g=0;g<3;g++)if(d[0]=M._tempM1.getElementByRowColumn(g,0),d[1]=M._tempM1.getElementByRowColumn(g,1),d[2]=M._tempM1.getElementByRowColumn(g,2),V[g]+yg.dot(M._tempV35,M._tempV32)<Math.abs(G[g]))return 0;for(l=0;l<3;l++)if(d[0]=M._tempM1.getElementByRowColumn(0,l),d[1]=M._tempM1.getElementByRowColumn(1,l),d[2]=M._tempM1.getElementByRowColumn(2,l),j[0]=M._tempM0.getElementByRowColumn(0,l),j[1]=M._tempM0.getElementByRowColumn(1,l),j[2]=M._tempM0.getElementByRowColumn(2,l),yg.dot(this.extents,M._tempV32)+U[l]<Math.abs(yg.dot(M._tempV31,M._tempV33)))return 0;for(g=0;g<3;g++)for(l=0;l<3;l++){var A=(g+1)%3,H=(g+2)%3,K=(l+1)%3,p=(l+2)%3;if(V[A]*M._tempM1.getElementByRowColumn(H,l)+V[H]*M._tempM1.getElementByRowColumn(A,l)+(U[K]*M._tempM1.getElementByRowColumn(g,p)+U[p]*M._tempM1.getElementByRowColumn(g,K))<Math.abs(G[H]*M._tempM0.getElementByRowColumn(A,l)-G[A]*M._tempM0.getElementByRowColumn(H,l)))return 0}return 2},B.containsLine=function(B,g){M._corners[0]=B,M._corners[1]=g;var l=this.containsPoints(M._corners);if(0!=l)return l;var o=this.extents.elements,V=o[0],U=o[1],y=o[2];this.transformation.invert(M._tempM0),yg.transformCoordinate(B,M._tempM0,M._tempV30),yg.transformCoordinate(g,M._tempM0,M._tempV31),yg.add(M._tempV30,M._tempV31,M._tempV32),yg.scale(M._tempV32,.5,M._tempV32),yg.subtract(M._tempV30,M._tempV32,M._tempV33);var G=M._tempV33.elements,d=G[0],j=G[1],A=G[2],H=M._tempV34.elements,K=H[0]=Math.abs(G[0]),p=H[1]=Math.abs(G[1]),x=H[2]=Math.abs(G[2]),N=M._tempV32.elements,F=N[0],C=N[1],m=N[2];return Math.abs(F)>V+K?0:Math.abs(C)>U+p?0:Math.abs(m)>y+x?0:Math.abs(C*A-m*j)>U*x+y*p?0:Math.abs(F*A-m*d)>V*x+y*K?0:Math.abs(F*j-C*d)>V*p+U*K?0:2},B.containsBoundBox=function(B){var g=0,l=0,o=B.min,V=B.max;B.getCorners(M._corners);var U=this.containsPoints(M._corners);if(0!=U)return U;yg.subtract(V,o,M._tempV30),yg.scale(M._tempV30,.5,M._tempV30),yg.add(o,M._tempV30,M._tempV30),yg.subtract(V,M._tempV30,M._tempV31);var y=this.extents.elements,G=M._tempV31.elements;M._getRows(this.transformation,M._rows1),this.transformation.invert(M._tempM0);for(g=0;g<3;g++)for(l=0;l<3;l++)M._tempM1.setElementByRowColumn(g,l,Math.abs(M._tempM0.getElementByRowColumn(g,l)));this.getCenter(M._tempV35),yg.subtract(M._tempV30,M._tempV35,M._tempV32);var d=M._tempV31.elements;d[0]=yg.dot(M._tempV32,M._rows1[0]),d[1]=yg.dot(M._tempV32,M._rows1[1]),d[2]=yg.dot(M._tempV32,M._rows1[2]);var j=M._tempV33.elements,A=M._tempV34.elements;for(g=0;g<3;g++)if(j[0]=M._tempM1.getElementByRowColumn(g,0),j[1]=M._tempM1.getElementByRowColumn(g,1),j[2]=M._tempM1.getElementByRowColumn(g,2),y[g]+yg.dot(M._tempV31,M._tempV33)<Math.abs(d[g]))return 0;for(l=0;l<3;l++)if(j[0]=M._tempM1.getElementByRowColumn(0,l),j[1]=M._tempM1.getElementByRowColumn(1,l),j[2]=M._tempM1.getElementByRowColumn(2,l),A[0]=M._tempM0.getElementByRowColumn(0,l),A[1]=M._tempM0.getElementByRowColumn(1,l),A[2]=M._tempM0.getElementByRowColumn(2,l),yg.dot(this.extents,M._tempV33)+G[l]<Math.abs(yg.dot(M._tempV31,M._tempV34)))return 0;for(g=0;g<3;g++)for(l=0;l<3;l++){var H=(g+1)%3,K=(g+2)%3,p=(l+1)%3,x=(l+2)%3;if(y[H]*M._tempM1.getElementByRowColumn(K,l)+y[K]*M._tempM1.getElementByRowColumn(H,l)+(G[p]*M._tempM1.getElementByRowColumn(g,x)+G[x]*M._tempM1.getElementByRowColumn(g,p))<Math.abs(d[K]*M._tempM0.getElementByRowColumn(H,l)-d[H]*M._tempM0.getElementByRowColumn(K,l)))return 0}return 2},B.intersectsRay=function(B,g){yg.scale(this.extents,-1,M._tempV30),this.transformation.invert(M._tempM0),yg.TransformNormal(B.direction,M._tempM0,M._ray.direction),yg.transformCoordinate(B.origin,M._tempM0,M._ray.origin),M._boxBound1.min=M._tempV30,M._boxBound1.max=this.extents;var l=Collision.intersectsRayAndBoxRP(M._ray,M._boxBound1,g);return-1!==l&&yg.transformCoordinate(g,this.transformation,g),l},B._getLocalCorners=function(B){B.length=8;var g=this.extents.elements;M._tempV30.x=g[0],M._tempV31.y=g[1],M._tempV32.z=g[2],yg.add(M._tempV30,M._tempV31,M._tempV33),yg.add(M._tempV33,M._tempV32,B[0]),yg.add(M._tempV30,M._tempV31,M._tempV33),yg.subtract(M._tempV33,M._tempV32,B[1]),yg.subtract(M._tempV31,M._tempV30,M._tempV33),yg.subtract(M._tempV33,M._tempV30,B[2]),yg.subtract(M._tempV31,M._tempV30,M._tempV33),yg.add(M._tempV33,M._tempV32,B[3]),yg.subtract(M._tempV30,M._tempV31,M._tempV33),yg.add(M._tempV33,M._tempV32,B[4]),yg.subtract(M._tempV30,M._tempV31,M._tempV33),yg.subtract(M._tempV33,M._tempV32,B[5]),yg.scale(B[0],-1,B[6]),yg.subtract(M._tempV32,M._tempV30,M._tempV33),yg.subtract(M._tempV33,M._tempV31,B[7])},B.equals=function(B){return this.extents==B.extents&&this.transformation==B.transformation},B.cloneTo=function(B){var g=B;this.extents.cloneTo(g.extents),this.transformation.cloneTo(g.transformation)},M.createByBoundBox=function(B,g){var l=B.min,o=B.max;yg.subtract(o,l,M._tempV30),yg.scale(M._tempV30,.5,M._tempV30),yg.add(l,M._tempV30,M._tempV31),yg.subtract(o,M._tempV31,M._tempV32),Bg.translation(M._tempV31,M._tempM0);var V=M._tempV32.clone(),U=M._tempM0.clone();g.extents=V,g.transformation=U},M.createByMinAndMaxVertex=function(B,g){return yg.subtract(g,B,M._tempV30),yg.scale(M._tempV30,.5,M._tempV30),yg.add(B,M._tempV30,M._tempV31),yg.subtract(g,M._tempV31,M._tempV32),Bg.translation(M._tempV31,M._tempM0),new M(M._tempV32,M._tempM0)},M._getRows=function(B,g){g.length=3;var l=B.elements,o=g[0].elements;o[0]=l[0],o[1]=l[1],o[2]=l[2];var V=g[1].elements;V[0]=l[4],V[1]=l[5],V[2]=l[6];var U=g[2].elements;U[0]=l[8],U[1]=l[9],U[2]=l[10]},M.getObbtoObbMatrix4x4=function(B,g,l,o){var V=B.transformation,U=g.transformation;if(l){M._getRows(V,M._rows1),M._getRows(U,M._rows2);for(var y=0;y<3;y++)for(var G=0;G<3;G++)o.setElementByRowColumn(y,G,yg.dot(M._rows2[y],M._rows1[G]));g.getCenter(M._tempV30),B.getCenter(M._tempV31),yg.subtract(M._tempV30,M._tempV31,M._tempV32);var d=o.elements;d[12]=yg.dot(M._tempV32,M._rows1[0]),d[13]=yg.dot(M._tempV32,M._rows1[1]),d[14]=yg.dot(M._tempV32,M._rows1[2]),d[15]=1}else V.invert(M._tempM0),Bg.multiply(U,M._tempM0,o)},M.merge=function(B,g,l){var o=B.extents,V=B.transformation;M.getObbtoObbMatrix4x4(B,g,l,M._tempM0),g._getLocalCorners(M._corners),yg.transformCoordinate(M._corners[0],M._tempM0,M._corners[0]),yg.transformCoordinate(M._corners[1],M._tempM0,M._corners[1]),yg.transformCoordinate(M._corners[2],M._tempM0,M._corners[2]),yg.transformCoordinate(M._corners[3],M._tempM0,M._corners[3]),yg.transformCoordinate(M._corners[4],M._tempM0,M._corners[4]),yg.transformCoordinate(M._corners[5],M._tempM0,M._corners[5]),yg.transformCoordinate(M._corners[6],M._tempM0,M._corners[6]),yg.transformCoordinate(M._corners[7],M._tempM0,M._corners[7]),yg.scale(o,-1,M._boxBound1.min),o.cloneTo(M._boxBound1.max),JB.createfromPoints(M._corners,M._boxBound2),JB.merge(M._boxBound2,M._boxBound1,M._boxBound3);var U=M._boxBound3.min,y=M._boxBound3.max;yg.subtract(y,U,M._tempV30),yg.scale(M._tempV30,.5,M._tempV30),yg.add(U,M._tempV30,M._tempV32),yg.subtract(y,M._tempV32,o),yg.transformCoordinate(M._tempV32,V,M._tempV33)},H(M,["_tempV30",function(){return this._tempV30=new yg},"_tempV31",function(){return this._tempV31=new yg},"_tempV32",function(){return this._tempV32=new yg},"_tempV33",function(){return this._tempV33=new yg},"_tempV34",function(){return this._tempV34=new yg},"_tempV35",function(){return this._tempV35=new yg},"_tempV36",function(){return this._tempV36=new yg},"_tempM0",function(){return this._tempM0=new Bg},"_tempM1",function(){return this._tempM1=new Bg},"_corners",function(){return this._corners=[new yg,new yg,new yg,new yg,new yg,new yg,new yg,new yg]},"_rows1",function(){return this._rows1=[new yg,new yg,new yg]},"_rows2",function(){return this._rows2=[new yg,new yg,new yg]},"_ray",function(){return this._ray=new Vg(new yg,new yg)},"_boxBound1",function(){return this._boxBound1=new JB(new yg,new yg)},"_boxBound2",function(){return this._boxBound2=new JB(new yg,new yg)},"_boxBound3",function(){return this._boxBound3=new JB(new yg,new yg)}])}(),function(){function D(B,g){this.normal=null,this.distance=NaN,void 0===g&&(g=0),this.normal=B,this.distance=g}return p(D,"laya.d3.math.Plane"),D.prototype.normalize=function(){var B=this.normal.elements,g=B[0],l=B[1],o=B[2],V=1/Math.sqrt(g*g+l*l+o*o);B[0]=g*V,B[1]=l*V,B[2]=o*V,this.distance*=V},D.createPlaneBy3P=function(B,g,l){var o=B.elements,V=g.elements,U=l.elements,y=V[0]-o[0],G=V[1]-o[1],d=V[2]-o[2],j=U[0]-o[0],A=U[1]-o[1],H=U[2]-o[2],K=G*H-d*A,p=d*j-y*H,x=y*A-G*j,N=1/Math.sqrt(K*K+p*p+x*x),F=K*N,C=p*N,m=x*N,M=D._TEMPVec3.elements;M[0]=F,M[1]=C,M[2]=m;var b=-(F*o[0]+C*o[1]+m*o[2]);return new D(D._TEMPVec3,b)},D.PlaneIntersectionType_Back=0,D.PlaneIntersectionType_Front=1,D.PlaneIntersectionType_Intersecting=2,H(D,["_TEMPVec3",function(){return this._TEMPVec3=new yg}]),D}()),lg=function(){function V(B,g,l,o){this.elements=new Float32Array(4),void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=1),this.elements[0]=B,this.elements[1]=g,this.elements[2]=l,this.elements[3]=o}p(V,"laya.d3.math.Quaternion");var B=V.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.scaling=function(B,g){var l=g.elements,o=this.elements;l[0]=o[0]*B,l[1]=o[1]*B,l[2]=o[2]*B,l[3]=o[3]*B},B.normalize=function(B){var g=B.elements,l=this.elements,o=l[0],V=l[1],U=l[2],y=l[3],G=o*o+V*V+U*U+y*y;0<G&&(G=1/Math.sqrt(G),g[0]=o*G,g[1]=V*G,g[2]=U*G,g[3]=y*G)},B.length=function(){var B=this.elements,g=B[0],l=B[1],o=B[2],V=B[3];return Math.sqrt(g*g+l*l+o*o+V*V)},B.rotateX=function(B,g){var l=g.elements,o=this.elements;B*=.5;var V=o[0],U=o[1],y=o[2],G=o[3],d=Math.sin(B),j=Math.cos(B);l[0]=V*j+G*d,l[1]=U*j+y*d,l[2]=y*j-U*d,l[3]=G*j-V*d},B.rotateY=function(B,g){var l=g.elements,o=this.elements;B*=.5;var V=o[0],U=o[1],y=o[2],G=o[3],d=Math.sin(B),j=Math.cos(B);l[0]=V*j-y*d,l[1]=U*j+G*d,l[2]=y*j+V*d,l[3]=G*j-U*d},B.rotateZ=function(B,g){var l=g.elements,o=this.elements;B*=.5;var V=o[0],U=o[1],y=o[2],G=o[3],d=Math.sin(B),j=Math.cos(B);l[0]=V*j+U*d,l[1]=U*j-V*d,l[2]=y*j+G*d,l[3]=G*j-y*d},B.getYawPitchRoll=function(B){yg.transformQuat(yg.ForwardRH,this,V.TEMPVector31),yg.transformQuat(yg.Up,this,V.TEMPVector32);var g=V.TEMPVector32.elements;V.angleTo(yg.ZERO,V.TEMPVector31,V.TEMPVector33);var l=V.TEMPVector33.elements;l[0]==Math.PI/2?(l[1]=V.arcTanAngle(g[2],g[0]),l[2]=0):l[0]==-Math.PI/2?(l[1]=V.arcTanAngle(-g[2],-g[0]),l[2]=0):(Bg.createRotationY(-l[1],V.TEMPMatrix0),Bg.createRotationX(-l[0],V.TEMPMatrix1),yg.transformCoordinate(V.TEMPVector32,V.TEMPMatrix0,V.TEMPVector32),yg.transformCoordinate(V.TEMPVector32,V.TEMPMatrix1,V.TEMPVector32),l[2]=V.arcTanAngle(g[1],-g[0])),l[1]<=-Math.PI&&(l[1]=Math.PI),l[2]<=-Math.PI&&(l[2]=Math.PI),l[1]>=Math.PI&&l[2]>=Math.PI&&(l[1]=0,l[2]=0,l[0]=Math.PI-l[0]);var o=B.elements;o[0]=l[1],o[1]=l[0],o[2]=l[2]},B.invert=function(B){var g=B.elements,l=this.elements,o=l[0],V=l[1],U=l[2],y=l[3],G=o*o+V*V+U*U+y*y,d=G?1/G:0;g[0]=-o*d,g[1]=-V*d,g[2]=-U*d,g[3]=y*d},B.identity=function(){var B=this.elements;B[0]=0,B[1]=0,B[2]=0,B[3]=1},B.fromArray=function(B,g){void 0===g&&(g=0),this.elements[0]=B[g+0],this.elements[1]=B[g+1],this.elements[2]=B[g+2],this.elements[3]=B[g+3]},B.cloneTo=function(B){var g,l,o;if((l=this.elements)!==(o=B.elements))for(g=0;g<4;++g)o[g]=l[g]},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},B.equals=function(B){var g=this.elements,l=B.elements;return qB.nearEqual(g[0],l[0])&&qB.nearEqual(g[1],l[1])&&qB.nearEqual(g[2],l[2])&&qB.nearEqual(g[3],l[3])},B.lengthSquared=function(){var B=this.elements[0],g=this.elements[1],l=this.elements[2],o=this.elements[3];return B*B+g*g+l*l+o*o},x(0,B,"x",function(){return this.elements[0]}),x(0,B,"y",function(){return this.elements[1]}),x(0,B,"z",function(){return this.elements[2]}),x(0,B,"w",function(){return this.elements[3]}),V.createFromYawPitchRoll=function(B,g,l,o){var V=.5*l,U=.5*g,y=.5*B,G=Math.sin(V),d=Math.cos(V),j=Math.sin(U),A=Math.cos(U),H=Math.sin(y),K=Math.cos(y),p=o.elements;p[0]=K*j*d+H*A*G,p[1]=H*A*d-K*j*G,p[2]=K*A*G-H*j*d,p[3]=K*A*d+H*j*G},V.multiply=function(B,g,l){var o=B.elements,V=g.elements,U=l.elements,y=o[0],G=o[1],d=o[2],j=o[3],A=V[0],H=V[1],K=V[2],p=V[3],x=G*K-d*H,N=d*A-y*K,F=y*H-G*A,C=y*A+G*H+d*K;U[0]=y*p+A*j+x,U[1]=G*p+H*j+N,U[2]=d*p+K*j+F,U[3]=j*p-C},V.arcTanAngle=function(B,g){return 0==B?1==g?Math.PI/2:-Math.PI/2:0<B?Math.atan(g/B):B<0?0<g?Math.atan(g/B)+Math.PI:Math.atan(g/B)-Math.PI:0},V.angleTo=function(B,g,l){yg.subtract(g,B,V.TEMPVector30),yg.normalize(V.TEMPVector30,V.TEMPVector30),l.elements[0]=Math.asin(V.TEMPVector30.y),l.elements[1]=V.arcTanAngle(-V.TEMPVector30.z,-V.TEMPVector30.x)},V.createFromAxisAngle=function(B,g,l){var o=l.elements,V=B.elements;g*=.5;var U=Math.sin(g);o[0]=U*V[0],o[1]=U*V[1],o[2]=U*V[2],o[3]=Math.cos(g)},V.createFromMatrix3x3=function(B,g){var l,o=g.elements,V=B.elements,U=V[0]+V[4]+V[8];if(0<U)l=Math.sqrt(U+1),o[3]=.5*l,l=.5/l,o[0]=(V[5]-V[7])*l,o[1]=(V[6]-V[2])*l,o[2]=(V[1]-V[3])*l;else{var y=0;V[4]>V[0]&&(y=1),V[8]>V[3*y+y]&&(y=2);var G=(y+1)%3,d=(y+2)%3;l=Math.sqrt(V[3*y+y]-V[3*G+G]-V[3*d+d]+1),o[y]=.5*l,l=.5/l,o[3]=(V[3*G+d]-V[3*d+G])*l,o[G]=(V[3*G+y]+V[3*y+G])*l,o[d]=(V[3*d+y]+V[3*y+d])*l}},V.createFromMatrix4x4=function(B,g){var l,o,V=B.elements,U=g.elements,y=V[0]+V[5]+V[10];0<y?(l=Math.sqrt(y+1),U[3]=.5*l,l=.5/l,U[0]=(V[6]-V[9])*l,U[1]=(V[8]-V[2])*l,U[2]=(V[1]-V[4])*l):V[0]>=V[5]&&V[0]>=V[10]?(o=.5/(l=Math.sqrt(1+V[0]-V[5]-V[10])),U[0]=.5*l,U[1]=(V[1]+V[4])*o,U[2]=(V[2]+V[8])*o,U[3]=(V[6]-V[9])*o):V[5]>V[10]?(o=.5/(l=Math.sqrt(1+V[5]-V[0]-V[10])),U[0]=(V[4]+V[1])*o,U[1]=.5*l,U[2]=(V[9]+V[6])*o,U[3]=(V[8]-V[2])*o):(o=.5/(l=Math.sqrt(1+V[10]-V[0]-V[5])),U[0]=(V[8]+V[2])*o,U[1]=(V[9]+V[6])*o,U[2]=.5*l,U[3]=(V[1]-V[4])*o)},V.slerp=function(B,g,l,o){var V,U,y,G,d,j=B.elements,A=g.elements,H=o.elements,K=j[0],p=j[1],x=j[2],N=j[3],F=A[0],C=A[1],m=A[2],M=A[3];return(U=K*F+p*C+x*m+N*M)<0&&(U=-U,F=-F,C=-C,m=-m,M=-M),d=1e-6<1-U?(V=Math.acos(U),y=Math.sin(V),G=Math.sin((1-l)*V)/y,Math.sin(l*V)/y):(G=1-l,l),H[0]=G*K+d*F,H[1]=G*p+d*C,H[2]=G*x+d*m,H[3]=G*N+d*M,H},V.lerp=function(B,g,l,o){var V=o.elements,U=B.elements,y=g.elements,G=U[0],d=U[1],j=U[2],A=U[3];V[0]=G+l*(y[0]-G),V[1]=d+l*(y[1]-d),V[2]=j+l*(y[2]-j),V[3]=A+l*(y[3]-A)},V.add=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]+U[0],o[1]=V[1]+U[1],o[2]=V[2]+U[2],o[3]=V[3]+U[3]},V.dot=function(B,g){var l=B.elements,o=g.elements;return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},V.rotationLookAt=function(B,g,l){V.lookAt(yg.ZERO,B,g,l)},V.lookAt=function(B,g,l,o){OB.lookAt(B,g,l,V._tempMatrix3x3),V.rotationMatrix(V._tempMatrix3x3,o)},V.invert=function(B,g){var l=B.elements,o=g.elements,V=B.lengthSquared();qB.isZero(V)||(V=1/V,o[0]=-l[0]*V,o[1]=-l[1]*V,o[2]=-l[2]*V,o[3]=l[3]*V)},V.rotationMatrix=function(B,g){var l=B.elements,o=l[0],V=l[1],U=l[2],y=l[3],G=l[4],d=l[5],j=l[6],A=l[7],H=l[8],K=g.elements,p=NaN,x=NaN,N=o+G+H;0<N?(p=Math.sqrt(N+1),K[3]=.5*p,p=.5/p,K[0]=(d-A)*p,K[1]=(j-U)*p,K[2]=(V-y)*p):G<=o&&H<=o?(x=.5/(p=Math.sqrt(1+o-G-H)),K[0]=.5*p,K[1]=(V+y)*x,K[2]=(U+j)*x,K[3]=(d-A)*x):H<G?(x=.5/(p=Math.sqrt(1+G-o-H)),K[0]=(y+V)*x,K[1]=.5*p,K[2]=(A+d)*x,K[3]=(j-U)*x):(x=.5/(p=Math.sqrt(1+H-o-G)),K[0]=(j+U)*x,K[1]=(A+d)*x,K[2]=.5*p,K[3]=(V-y)*x)},V.DEFAULT=new V,H(V,["TEMPVector30",function(){return this.TEMPVector30=new yg},"TEMPVector31",function(){return this.TEMPVector31=new yg},"TEMPVector32",function(){return this.TEMPVector32=new yg},"TEMPVector33",function(){return this.TEMPVector33=new yg},"TEMPMatrix0",function(){return this.TEMPMatrix0=new Bg},"TEMPMatrix1",function(){return this.TEMPMatrix1=new Bg},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new OB},"NAN",function(){return this.NAN=new V(NaN,NaN,NaN,NaN)}]),V}(),og=function(){function B(B){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=B,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}p(B,"laya.d3.math.Rand");var g=B.prototype;return g.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},g.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},g.getSignedFloat=function(){return 2*this.getFloat()-1},x(0,g,"seed",function(){return this.seeds[0]},function(B){this.seeds[0]=B,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),B.getFloatFromInt=function(B){return 1/8388607*(8388607&B)},B.getByteFromInt=function(B){return(8388607&B)>>>15},B}(),Vg=(function(){function V(B){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(B instanceof Array)||4!==B.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|B[0],this._state0L=0|B[1],this._state1U=0|B[2],this._state1L=0|B[3]}p(V,"laya.d3.math.RandX");var B=V.prototype;B.randomint=function(){var B=this._state0U,g=this._state0L,l=this._state1U,o=this._state1L,V=(o>>>0)+(g>>>0),U=l+B+(V/2>>>31)>>>0,y=V>>>0,G=0,d=0;G=(B^=G=B<<23|(-512&g)>>>9)^(this._state0U=l),d=(g^=d=g<<23)^(this._state0L=o);G^=B>>>18,d^=g>>>18|(262143&B)<<14;return G^=l>>>5,d^=o>>>5|(31&l)<<27,this._state1U=G,this._state1L=d,[U,y]},B.random=function(){var B=this.randomint(),g=B[0],l=1023<<20|g>>>12,o=0|(B[1]>>>12|(4095&g)<<20);return V._CONVERTION_BUFFER.setUint32(0,l,!1),V._CONVERTION_BUFFER.setUint32(4,o,!1),og._CONVERTION_BUFFER.getFloat64(0,!1)-1},H(V,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new og([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function B(B,g){this.origin=null,this.direction=null,this.origin=B,this.direction=g}return p(B,"laya.d3.math.Ray"),B}()),Ug=function(){function B(B,g){this.elements=new Float32Array(2),void 0===B&&(B=0),void 0===g&&(g=0);var l=this.elements;l[0]=B,l[1]=g}p(B,"laya.d3.math.Vector2");var g=B.prototype;return D.imps(g,{"laya.d3.core.IClone":!0}),g.fromArray=function(B,g){void 0===g&&(g=0),this.elements[0]=B[g+0],this.elements[1]=B[g+1]},g.cloneTo=function(B){var g=B.elements,l=this.elements;g[0]=l[0],g[1]=l[1]},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"x",function(){return this.elements[0]},function(B){this.elements[0]=B}),x(0,g,"y",function(){return this.elements[1]},function(B){this.elements[1]=B}),B.scale=function(B,g,l){var o=l.elements,V=B.elements;o[0]=V[0]*g,o[1]=V[1]*g},H(B,["ZERO",function(){return this.ZERO=new B(0,0)},"ONE",function(){return this.ONE=new B(1,1)}]),B}(),yg=function(){function A(B,g,l){this.elements=new Float32Array(3),void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0);var o=this.elements;o[0]=B,o[1]=g,o[2]=l}p(A,"laya.d3.math.Vector3");var B=A.prototype;return D.imps(B,{"laya.d3.core.IClone":!0}),B.fromArray=function(B,g){void 0===g&&(g=0),this.elements[0]=B[g+0],this.elements[1]=B[g+1],this.elements[2]=B[g+2]},B.cloneTo=function(B){var g=B.elements,l=this.elements;g[0]=l[0],g[1]=l[1],g[2]=l[2]},B.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},B.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},B.reset=function(B,g,l){this.elements[0]=B,this.elements[1]=g,this.elements[2]=l},x(0,B,"x",function(){return this.elements[0]},function(B){this.elements[0]=B}),x(0,B,"y",function(){return this.elements[1]},function(B){this.elements[1]=B}),x(0,B,"z",function(){return this.elements[2]},function(B){this.elements[2]=B}),A.distanceSquared=function(B,g){var l=B.elements,o=g.elements,V=l[0]-o[0],U=l[1]-o[1],y=l[2]-o[2];return V*V+U*U+y*y},A.distance=function(B,g){var l=B.elements,o=g.elements,V=l[0]-o[0],U=l[1]-o[1],y=l[2]-o[2];return Math.sqrt(V*V+U*U+y*y)},A.min=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=Math.min(V[0],U[0]),o[1]=Math.min(V[1],U[1]),o[2]=Math.min(V[2],U[2])},A.max=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=Math.max(V[0],U[0]),o[1]=Math.max(V[1],U[1]),o[2]=Math.max(V[2],U[2])},A.transformQuat=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements,y=V[0],G=V[1],d=V[2],j=U[0],A=U[1],H=U[2],K=U[3],p=K*y+A*d-H*G,x=K*G+H*y-j*d,N=K*d+j*G-A*y,F=-j*y-A*G-H*d;o[0]=p*K+F*-j+x*-H-N*-A,o[1]=x*K+F*-A+N*-j-p*-H,o[2]=N*K+F*-H+p*-A-x*-j},A.scalarLength=function(B){var g=B.elements,l=g[0],o=g[1],V=g[2];return Math.sqrt(l*l+o*o+V*V)},A.scalarLengthSquared=function(B){var g=B.elements,l=g[0],o=g[1],V=g[2];return l*l+o*o+V*V},A.normalize=function(B,g){var l=B.elements,o=g.elements,V=l[0],U=l[1],y=l[2],G=V*V+U*U+y*y;0<G&&(G=1/Math.sqrt(G),o[0]=l[0]*G,o[1]=l[1]*G,o[2]=l[2]*G)},A.multiply=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]*U[0],o[1]=V[1]*U[1],o[2]=V[2]*U[2]},A.scale=function(B,g,l){var o=l.elements,V=B.elements;o[0]=V[0]*g,o[1]=V[1]*g,o[2]=V[2]*g},A.lerp=function(B,g,l,o){var V=o.elements,U=B.elements,y=g.elements,G=U[0],d=U[1],j=U[2];V[0]=G+l*(y[0]-G),V[1]=d+l*(y[1]-d),V[2]=j+l*(y[2]-j)},A.transformV3ToV3=function(B,g,l){var o=A._tempVector4;A.transformV3ToV4(B,g,o);var V=o.elements,U=l.elements;U[0]=V[0],U[1]=V[1],U[2]=V[2]},A.transformV3ToV4=function(B,g,l){var o=B.elements,V=o[0],U=o[1],y=o[2],G=g.elements,d=l.elements;d[0]=V*G[0]+U*G[4]+y*G[8]+G[12],d[1]=V*G[1]+U*G[5]+y*G[9]+G[13],d[2]=V*G[2]+U*G[6]+y*G[10]+G[14],d[3]=V*G[3]+U*G[7]+y*G[11]+G[15]},A.TransformNormal=function(B,g,l){var o=B.elements,V=o[0],U=o[1],y=o[2],G=g.elements,d=l.elements;d[0]=V*G[0]+U*G[4]+y*G[8],d[1]=V*G[1]+U*G[5]+y*G[9],d[2]=V*G[2]+U*G[6]+y*G[10]},A.transformCoordinate=function(B,g,l){var o=A._tempVector4.elements,V=B.elements,U=V[0],y=V[1],G=V[2],d=g.elements;o[0]=U*d[0]+y*d[4]+G*d[8]+d[12],o[1]=U*d[1]+y*d[5]+G*d[9]+d[13],o[2]=U*d[2]+y*d[6]+G*d[10]+d[14],o[3]=1/(U*d[3]+y*d[7]+G*d[11]+d[15]);var j=l.elements;j[0]=o[0]*o[3],j[1]=o[1]*o[3],j[2]=o[2]*o[3]},A.Clamp=function(B,g,l,o){var V=B.elements,U=V[0],y=V[1],G=V[2],d=g.elements,j=d[0],A=d[1],H=d[2],K=l.elements,p=K[0],x=K[1],N=K[2],F=o.elements;U=(U=p<U?p:U)<j?j:U,y=(y=x<y?x:y)<A?A:y,G=(G=N<G?N:G)<H?H:G,F[0]=U,F[1]=y,F[2]=G},A.add=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]+U[0],o[1]=V[1]+U[1],o[2]=V[2]+U[2]},A.subtract=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]-U[0],o[1]=V[1]-U[1],o[2]=V[2]-U[2]},A.cross=function(B,g,l){var o=B.elements,V=g.elements,U=l.elements,y=o[0],G=o[1],d=o[2],j=V[0],A=V[1],H=V[2];U[0]=G*H-d*A,U[1]=d*j-y*H,U[2]=y*A-G*j},A.dot=function(B,g){var l=B.elements,o=g.elements;return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]},A.equals=function(B,g){var l=B.elements,o=g.elements;return qB.nearEqual(Math.abs(l[0]),Math.abs(o[0]))&&qB.nearEqual(Math.abs(l[1]),Math.abs(o[1]))&&qB.nearEqual(Math.abs(l[2]),Math.abs(o[2]))},A.ZERO=new A(0,0,0),A.ONE=new A(1,1,1),A.NegativeUnitX=new A(-1,0,0),A.UnitX=new A(1,0,0),A.UnitY=new A(0,1,0),A.UnitZ=new A(0,0,1),A.ForwardRH=new A(0,0,-1),A.ForwardLH=new A(0,0,1),A.Up=new A(0,1,0),A.NAN=new A(NaN,NaN,NaN),H(A,["_tempVector4",function(){return this._tempVector4=new Gg}]),A}(),Gg=function(){function B(B,g,l,o){this.elements=new Float32Array(4),void 0===B&&(B=0),void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=0);var V=this.elements;V[0]=B,V[1]=g,V[2]=l,V[3]=o}p(B,"laya.d3.math.Vector4");var g=B.prototype;return D.imps(g,{"laya.d3.core.IClone":!0}),g.fromArray=function(B,g){void 0===g&&(g=0),this.elements[0]=B[g+0],this.elements[1]=B[g+1],this.elements[2]=B[g+2],this.elements[3]=B[g+3]},g.cloneTo=function(B){var g=B.elements,l=this.elements;g[0]=l[0],g[1]=l[1],g[2]=l[2],g[3]=l[3]},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},g.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},g.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},x(0,g,"x",function(){return this.elements[0]},function(B){this.elements[0]=B}),x(0,g,"y",function(){return this.elements[1]},function(B){this.elements[1]=B}),x(0,g,"z",function(){return this.elements[2]},function(B){this.elements[2]=B}),x(0,g,"w",function(){return this.elements[3]},function(B){this.elements[3]=B}),B.lerp=function(B,g,l,o){var V=o.elements,U=B.elements,y=g.elements,G=U[0],d=U[1],j=U[2],A=U[3];V[0]=G+l*(y[0]-G),V[1]=d+l*(y[1]-d),V[2]=j+l*(y[2]-j),V[3]=A+l*(y[3]-A)},B.transformByM4x4=function(B,g,l){var o=B.elements,V=o[0],U=o[1],y=o[2],G=o[3],d=g.elements,j=l.elements;j[0]=V*d[0]+U*d[4]+y*d[8]+G*d[12],j[1]=V*d[1]+U*d[5]+y*d[9]+G*d[13],j[2]=V*d[2]+U*d[6]+y*d[10]+G*d[14],j[3]=V*d[3]+U*d[7]+y*d[11]+G*d[15]},B.equals=function(B,g){var l=B.elements,o=g.elements;return qB.nearEqual(Math.abs(l[0]),Math.abs(o[0]))&&qB.nearEqual(Math.abs(l[1]),Math.abs(o[1]))&&qB.nearEqual(Math.abs(l[2]),Math.abs(o[2]))&&qB.nearEqual(Math.abs(l[3]),Math.abs(o[3]))},B.normalize=function(B,g){var l=B.elements,o=g.elements,V=B.length();0<V&&(o[0]=l[0]*V,o[1]=l[1]*V,o[2]=l[2]*V,o[3]=l[3]*V)},B.add=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]+U[0],o[1]=V[1]+U[1],o[2]=V[2]+U[2],o[3]=V[3]+U[3]},B.subtract=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]-U[0],o[1]=V[1]-U[1],o[2]=V[2]-U[2],o[3]=V[3]-U[3]},B.multiply=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=V[0]*U[0],o[1]=V[1]*U[1],o[2]=V[2]*U[2],o[3]=V[3]*U[3]},B.scale=function(B,g,l){var o=l.elements,V=B.elements;o[0]=V[0]*g,o[1]=V[1]*g,o[2]=V[2]*g,o[3]=V[3]*g},B.Clamp=function(B,g,l,o){var V=B.elements,U=V[0],y=V[1],G=V[2],d=V[3],j=g.elements,A=j[0],H=j[1],K=j[2],p=j[3],x=l.elements,N=x[0],F=x[1],C=x[2],m=x[3],M=o.elements;U=(U=N<U?N:U)<A?A:U,y=(y=F<y?F:y)<H?H:y,G=(G=C<G?C:G)<K?K:G,d=(d=m<d?m:d)<p?p:d,M[0]=U,M[1]=y,M[2]=G,M[3]=d},B.distanceSquared=function(B,g){var l=B.elements,o=g.elements,V=l[0]-o[0],U=l[1]-o[1],y=l[2]-o[2],G=l[3]-o[3];return V*V+U*U+y*y+G*G},B.distance=function(B,g){var l=B.elements,o=g.elements,V=l[0]-o[0],U=l[1]-o[1],y=l[2]-o[2],G=l[3]-o[3];return Math.sqrt(V*V+U*U+y*y+G*G)},B.dot=function(B,g){var l=B.elements,o=g.elements;return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},B.min=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=Math.min(V[0],U[0]),o[1]=Math.min(V[1],U[1]),o[2]=Math.min(V[2],U[2]),o[3]=Math.min(V[3],U[3])},B.max=function(B,g,l){var o=l.elements,V=B.elements,U=g.elements;o[0]=Math.max(V[0],U[0]),o[1]=Math.max(V[1],U[1]),o[2]=Math.max(V[2],U[2]),o[3]=Math.max(V[3],U[3])},H(B,["ZERO",function(){return this.ZERO=new B},"ONE",function(){return this.ONE=new B(1,1,1,1)},"UnitX",function(){return this.UnitX=new B(1,0,0,0)},"UnitY",function(){return this.UnitY=new B(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new B(0,0,1,0)},"UnitW",function(){return this.UnitW=new B(0,0,0,1)}]),B}(),dg=function(){function U(B,g,l,o){this.minDepth=0,this.maxDepth=1,this.x=B,this.y=g,this.width=l,this.height=o}p(U,"laya.d3.math.Viewport");var B=U.prototype;return B.project=function(B,g,l){yg.transformV3ToV3(B,g,l);var o=B.elements,V=g.elements,U=l.elements,y=o[0]*V[3]+o[1]*V[7]+o[2]*V[11]+V[15];1!==y&&(U[0]=U[0]/y,U[1]=U[1]/y,U[2]=U[2]/y),U[0]=.5*(U[0]+1)*this.width+this.x,U[1]=.5*(1-U[1])*this.height+this.y,U[2]=U[2]*(this.maxDepth-this.minDepth)+this.minDepth},B.unprojectFromMat=function(B,g,l){var o=B.elements,V=g.elements,U=l.elements;U[0]=(o[0]-this.x)/this.width*2-1,U[1]=-((o[1]-this.y)/this.height*2-1);var y=(this.maxDepth-this.minDepth)/2;U[2]=(o[2]-this.minDepth-y)/y;var G=U[0]*V[3]+U[1]*V[7]+U[2]*V[11]+V[15];yg.transformV3ToV3(l,g,l),1!==G&&(U[0]=U[0]/G,U[1]=U[1]/G,U[2]=U[2]/G)},B.unprojectFromWVP=function(B,g,l,o,V){Bg.multiply(g,l,U._tempMatrix4x4),o&&Bg.multiply(U._tempMatrix4x4,o,U._tempMatrix4x4),U._tempMatrix4x4.invert(U._tempMatrix4x4),this.unprojectFromMat(B,U._tempMatrix4x4,V)},H(U,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new Bg}]),U}(),jg=function(){function z(B){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=B,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}p(z,"laya.d3.resource.models.SubMesh");var B=z.prototype;return D.imps(B,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),B._getVertexBuffer=function(B){return void 0===B&&(B=0),0===B?this._vertexBuffer:null},B._getIndexBuffer=function(){return this._indexBuffer},B._getStaticBatchBakedVertexs=function(B,g){var l,o,V=this._vertexBuffer,U=V.vertexDeclaration,y=U.getVertexElementByUsage(0).offset/4,G=U.getVertexElementByUsage(3).offset/4,d=g.meshRender.lightmapScaleOffset,j=0,A=0,H=0,K=0,p=0,x=0;if(d)if(o=U.getVertexElementByUsage(15))H=U.vertexStride/4,l=0<this._vertexCount?V.getData().slice(this._vertexStart*H,(this._vertexStart+this._vertexCount)*H):V.getData().slice(),K=o.offset/4;else{H=(x=U.vertexStride/4)+2,l=this._vertexCount?new Float32Array(this._vertexCount*(V.vertexDeclaration.vertexStride/4+2)):new Float32Array(V.vertexCount*(V.vertexDeclaration.vertexStride/4+2)),K=(p=U.getVertexElementByUsage(2).offset/4)+2;var N=V.getData();for(j=0,A=N.length/x;j<A;j++){var F=0;F=0<this._vertexCount?(this._vertexStart+j)*x:j*x;var C=j*H,m=0;for(m=0;m<K;m++)l[C+m]=N[F+m];for(m=K;m<x;m++)l[C+m+2]=N[F+m]}}else H=U.vertexStride/4,l=this._vertexCount?V.getData().slice(this._vertexStart*H,(this._vertexStart+this._vertexCount)*H):V.getData().slice();if(B){var M=B.worldMatrix,b=z._tempMatrix4x40;M.invert(b);var D=z._tempMatrix4x41,v=g.transform.worldMatrix;Bg.multiply(b,v,D)}else D=g.transform.worldMatrix;var s=z._tempQuaternion0;for(D.decomposeTransRotScale(z._tempVector30,s,z._tempVector31),j=0,A=l.length/H;j<A;j++){var X=j*H+y,w=j*H+G;if(Fg.transformVector3ArrayToVector3ArrayCoordinate(l,X,D,l,X),Fg.transformVector3ArrayByQuat(l,w,s,l,w),d){var i=j*H+K;if(o)Fg.transformLightingMapTexcoordByUV1Array(l,i,d,l,i);else{var a=j*x+p;Fg.transformLightingMapTexcoordByUV0Array(N,a,d,l,i)}}}return l},B._getVertexBuffers=function(){return null},B._beforeRender=function(B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},B._render=function(B){var g,l=0,o=B.renderElement;if(1<this._indexCount){var V=this._boneIndicesList.length;if(1<V){for(var U=0;U<V;U++)(g=o._skinAnimationDatas||this._skinAnimationDatas)&&(o._shaderValue.setValue(0,g[U]),B._shader.uploadRenderElementUniforms(o._shaderValue.data)),t.mainContext.drawElements(4,this._subIndexBufferCount[U],5123,2*this._subIndexBufferStart[U]);X.drawCall+=V}else(g=o._skinAnimationDatas||this._skinAnimationDatas)&&(o._shaderValue.setValue(0,g[0]),B._shader.uploadRenderElementUniforms(o._shaderValue.data)),t.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),X.drawCall++;l=this._indexCount}else l=this._indexBuffer.indexCount,(g=o._skinAnimationDatas||this._skinAnimationDatas)&&(o._shaderValue.setValue(0,g[0]),B._shader.uploadRenderElementUniforms(o._shaderValue.data)),t.mainContext.drawElements(4,l,5123,0),X.drawCall++;X.trianglesFaces+=l/3},B.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},B.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},x(0,B,"_vertexBufferCount",function(){return 1}),x(0,B,"triangleCount",function(){return this._indexBuffer.indexCount/3}),H(z,["_tempVector30",function(){return this._tempVector30=new yg},"_tempVector31",function(){return this._tempVector31=new yg},"_tempQuaternion0",function(){return this._tempQuaternion0=new lg},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Bg},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new Bg}]),z}(),Ag=function(){function B(B){this.defineCounter=0,this.defines=null,B?(this.defineCounter=B.defineCounter,this.defines=B.defines.slice()):(this.defineCounter=0,this.defines=[])}return p(B,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),B.prototype.registerDefine=function(B){var g=Math.pow(2,this.defineCounter++);return this.defines[g]=B,g},B}(),Hg=function(){function B(){}return p(B,"laya.d3.shader.ShaderInit3D"),B.__init__=function(){var B,g;Xg._globalRegDefine("HIGHPRECISION",Xg.SHADERDEFINE_HIGHPRECISION),Xg._globalRegDefine("FOG",Xg.SHADERDEFINE_FOG),Xg._globalRegDefine("DIRECTIONLIGHT",Xg.SHADERDEFINE_DIRECTIONLIGHT),Xg._globalRegDefine("POINTLIGHT",Xg.SHADERDEFINE_POINTLIGHT),Xg._globalRegDefine("SPOTLIGHT",Xg.SHADERDEFINE_SPOTLIGHT),Xg._globalRegDefine("UV",Xg.SHADERDEFINE_UV0),Xg._globalRegDefine("COLOR",Xg.SHADERDEFINE_COLOR),Xg._globalRegDefine("UV1",Xg.SHADERDEFINE_UV1),Xg._globalRegDefine("CASTSHADOW",pg.SHADERDEFINE_CAST_SHADOW),Xg._globalRegDefine("SHADOWMAP_PSSM1",pg.SHADERDEFINE_SHADOW_PSSM1),Xg._globalRegDefine("SHADOWMAP_PSSM2",pg.SHADERDEFINE_SHADOW_PSSM2),Xg._globalRegDefine("SHADOWMAP_PSSM3",pg.SHADERDEFINE_SHADOW_PSSM3),Xg._globalRegDefine("SHADOWMAP_PCF_NO",pg.SHADERDEFINE_SHADOW_PCF_NO),Xg._globalRegDefine("SHADOWMAP_PCF1",pg.SHADERDEFINE_SHADOW_PCF1),Xg._globalRegDefine("SHADOWMAP_PCF2",pg.SHADERDEFINE_SHADOW_PCF2),Xg._globalRegDefine("SHADOWMAP_PCF3",pg.SHADERDEFINE_SHADOW_PCF3),Xg._globalRegDefine("DEPTHFOG",Xg.SAHDERDEFINE_DEPTHFOG),Qg.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Qg.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),B={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},g={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var l=Qg.nameKey.add("SIMPLE");shaderCompile=Xg.add(l,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',B,g),_g.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),_g.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),_g.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),_g.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),_g.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),_g.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),_g.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),_g.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),_g.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},B}(),Kg=function(){function B(){this._data=null,this._data=[]}p(B,"laya.d3.shader.ValusArray");var g=B.prototype;return g.setValue=function(B,g){this._data[B]=g},x(0,g,"data",function(){return this._data}),B}(),pg=function(){function B(){}return B.SHADERDEFINE_RECEIVE_SHADOW=1,B.SHADERDEFINE_CAST_SHADOW=512,B.SHADERDEFINE_SHADOW_PSSM1=1024,B.SHADERDEFINE_SHADOW_PSSM2=2048,B.SHADERDEFINE_SHADOW_PSSM3=4096,B.SHADERDEFINE_SHADOW_PCF_NO=8192,B.SHADERDEFINE_SHADOW_PCF1=16384,B.SHADERDEFINE_SHADOW_PCF2=32768,B.SHADERDEFINE_SHADOW_PCF3=65536,B.MAX_PSSM_COUNT=3,B}(),xg=function(){function I(){}return p(I,"laya.d3.utils.Picker"),I.calculateCursorRay=function(B,g,l,o,V,U){var y=B.elements[0],G=B.elements[1],d=I._tempVector30,j=d.elements;j[0]=y,j[1]=G,j[2]=g.minDepth;var A=I._tempVector31,H=A.elements;H[0]=y,H[1]=G,H[2]=g.maxDepth;var K=U.origin,p=I._tempVector32;g.unprojectFromWVP(d,l,o,V,K),g.unprojectFromWVP(A,l,o,V,p);var x=U.direction.elements;x[0]=p.x-K.x,x[1]=p.y-K.y,x[2]=p.z-K.z,yg.normalize(U.direction,U.direction)},I.rayIntersectsPositionsAndIndices=function(B,g,l,o,V){for(var U=l.vertexStride/4,y=l.getVertexElementByUsage(0).offset/4,G=Number.MAX_VALUE,d=-1,j=-1,A=-1,H=0;H<o.length;H+=3){var K=I._tempVector35,p=K.elements,x=o[H]*U,N=x+y;p[0]=g[N],p[1]=g[1+N],p[2]=g[2+N];var F=I._tempVector36,C=F.elements,m=o[H+1]*U,M=m+y;C[0]=g[M],C[1]=g[1+M],C[2]=g[2+M];var b=I._tempVector37,D=b.elements,v=o[H+2]*U,s=v+y;D[0]=g[s],D[1]=g[1+s],D[2]=g[2+s];var X=laya.d3.utils.Picker.rayIntersectsTriangle(B,K,F,b);!isNaN(X)&&X<G&&(G=X,d=x,j=m,A=v)}if(G===Number.MAX_VALUE)return V.position.toDefault(),V.distance=Number.MAX_VALUE,V.trianglePositions[0].toDefault(),V.trianglePositions[1].toDefault(),V.trianglePositions[2].toDefault(),V.triangleNormals[0].toDefault(),V.triangleNormals[1].toDefault(),V.triangleNormals[2].toDefault(),!1;V.distance=G,yg.scale(B.direction,G,V.position),yg.add(B.origin,V.position,V.position);var w=V.trianglePositions,i=w[0],a=w[1],z=w[2],t=i.elements,h=a.elements,f=z.elements,S=d+y;t[0]=g[S],t[1]=g[S+1],t[2]=g[S+2];var E=j+y;h[0]=g[E],h[1]=g[E+1],h[2]=g[E+2];var e=A+y;f[0]=g[e],f[1]=g[e+1],f[2]=g[e+2];var Q=l.getVertexElementByUsage(3);if(Q){var _=Q.offset/4,P=V.triangleNormals,Y=P[0],c=P[1],r=P[2],Z=Y.elements,T=c.elements,R=r.elements,W=d+_;Z[0]=g[W],Z[1]=g[W+1],Z[2]=g[W+2];var n=j+_;T[0]=g[n],T[1]=g[n+1],T[2]=g[n+2];var L=A+_;R[0]=g[L],R[1]=g[L+1],R[2]=g[L+2]}return!0},I.rayIntersectsTriangle=function(B,g,l,o){var V=I._tempVector30,U=I._tempVector31;yg.subtract(l,g,V),yg.subtract(o,g,U);var y,G=I._tempVector32;if(yg.cross(B.direction,U,G),(y=yg.dot(V,G))>-Number.MIN_VALUE&&y<Number.MIN_VALUE)return Number.NaN;var d,j=1/y,A=I._tempVector33;if(yg.subtract(B.origin,g,A),d=yg.dot(A,G),(d*=j)<0||1<d)return Number.NaN;var H,K,p=I._tempVector34;return yg.cross(A,V,p),H=yg.dot(B.direction,p),(H*=j)<0||1<d+H?Number.NaN:(K=yg.dot(U,p),(K*=j)<0?Number.NaN:K)},H(I,["_tempVector30",function(){return this._tempVector30=new yg},"_tempVector31",function(){return this._tempVector31=new yg},"_tempVector32",function(){return this._tempVector32=new yg},"_tempVector33",function(){return this._tempVector33=new yg},"_tempVector34",function(){return this._tempVector34=new yg},"_tempVector35",function(){return this._tempVector35=new yg},"_tempVector36",function(){return this._tempVector36=new yg},"_tempVector37",function(){return this._tempVector37=new yg}]),I}(),Ng=(function(){function B(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new yg,new yg,new yg],this.trianglePositions.length=3,this.triangleNormals=[new yg,new yg,new yg],this.triangleNormals.length=3,this.position=new yg}p(B,"laya.d3.utils.RaycastHit"),B.prototype.cloneTo=function(B){B.distance=this.distance,this.trianglePositions[0].cloneTo(B.trianglePositions[0]),this.trianglePositions[1].cloneTo(B.trianglePositions[1]),this.trianglePositions[2].cloneTo(B.trianglePositions[2]),this.triangleNormals[0].cloneTo(B.triangleNormals[0]),this.triangleNormals[1].cloneTo(B.triangleNormals[1]),this.triangleNormals[2].cloneTo(B.triangleNormals[2]),this.position.cloneTo(B.position),B.sprite3D=this.sprite3D}}(),function(){function B(B,g){this._width=0,this._height=0,this._width=B,this._height=g}p(B,"laya.d3.utils.Size");var g=B.prototype;return x(0,g,"width",function(){return-1===this._width?k.clientWidth:this._width}),x(0,g,"height",function(){return-1===this._height?k.clientHeight:this._height}),x(1,B,"fullScreen",function(){return new B(-1,-1)}),B}()),Fg=function(){function S(){}return p(S,"laya.d3.utils.Utils3D"),S._rotationTransformScaleSkinAnimation=function(B,g,l,o,V,U,y,G,d,j,A,H){var K,p,x,N,F,C=S._tempArray16_0,m=S._tempArray16_1,M=S._tempArray16_2,b=o+o,D=V+V,v=U+U,s=o*b,X=V*b,w=V*D,i=U*b,a=U*D,z=U*v,t=y*b,h=y*D,f=y*v;for(C[15]=1,C[0]=1-w-z,C[1]=X+f,C[2]=i-h,C[4]=X-f,C[5]=1-s-z,C[6]=a+t,C[8]=i+h,C[9]=a-t,C[10]=1-s-w,m[15]=1,m[0]=G,m[5]=d,m[10]=j,K=0;K<4;K++)p=C[K],x=C[K+4],N=C[K+8],F=C[K+12],M[K]=p,M[K+4]=x,M[K+8]=N,M[K+12]=p*B+x*g+N*l+F;for(K=0;K<4;K++)p=M[K],x=M[K+4],N=M[K+8],F=M[K+12],A[K+H]=p*m[0]+x*m[1]+N*m[2]+F*m[3],A[K+H+4]=p*m[4]+x*m[5]+N*m[6]+F*m[7],A[K+H+8]=p*m[8]+x*m[9]+N*m[10]+F*m[11],A[K+H+12]=p*m[12]+x*m[13]+N*m[14]+F*m[15]},S._createNodeByJson=function(B,g,l,o){if(!l)switch(g.type){case"Sprite3D":l=new eg;break;case"MeshSprite3D":l=new Ig;break;case"SkinnedMeshSprite3D":l=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":l=new ShuriKenParticle3D;break;case"TrailSprite3D":l=new TrailSprite3D;break;case"Terrain":l=new Terrain;break;case"Camera":l=new Lg;break;case"DirectionLight":l=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var V=g.props;if(V)for(var U in V)l[U]=V[U];var y=g.customProps;y&&(l instanceof laya.d3.core.Sprite3D?(l._parseBaseCustomProps(y),l._parseCustomProps(B,o,y,g),l._parseCustomComponent(B,o,g.components)):l._parseCustomProps(B,o,y,g));var G=g.child;if(G)for(var d=0,j=G.length;d<j;d++){var A=S._createNodeByJson(B,G[d],null,o);l.addChild(A)}return l},S._computeBoneAndAnimationDatasByBindPoseMatrxix=function(B,g,l,o,V,U){var y,G,d=0,j=0,A=B.length;for(y=0;y<A;d+=B[y].keyframeWidth,j+=16,y++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(g[d+0],g[d+1],g[d+2],g[d+3],g[d+4],g[d+5],g[d+6],g[d+7],g[d+8],g[d+9],o,j),0!=y&&(G=16*B[y].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(o,G,o,j,o,j));var H=l.length;for(y=0;y<H;y++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(o,16*U[y],l[y],V,16*y)},S._computeAnimationDatasByArrayAndMatrixFast=function(B,g,l,o){for(var V=0,U=B.length;V<U;V++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(g,16*o[V],B[V],l,16*V)},S._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(B,g,l,o,V){var U,y,G=0,d=0,j=B.length;for(U=0;U<j;G+=B[U].keyframeWidth,d+=16,U++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(g[G+7],g[G+8],g[G+9],g[G+3],g[G+4],g[G+5],g[G+6],g[G+0],g[G+1],g[G+2],o,d),0!=U&&(y=16*B[U].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(o,y,o,d,o,d));var A=l.length;for(U=0;U<A;U++){var H=16*U;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(o,H,l[U],V,H)}},S._computeAnimationDatasByArrayAndMatrixFastOld=function(B,g,l){for(var o=B.length,V=0;V<o;V++){var U=16*V;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(g,U,B[V],l,U)}},S._computeRootAnimationData=function(B,g,l){for(var o=0,V=0,U=0,y=B.length;o<y;V+=B[o].keyframeWidth,U+=16,o++)laya.d3.utils.Utils3D.createAffineTransformationArray(g[V+0],g[V+1],g[V+2],g[V+3],g[V+4],g[V+5],g[V+6],g[V+7],g[V+8],g[V+9],l,U)},S.transformVector3ArrayByQuat=function(B,g,l,o,V){var U=l.elements,y=B[g],G=B[g+1],d=B[g+2],j=U[0],A=U[1],H=U[2],K=U[3],p=K*y+A*d-H*G,x=K*G+H*y-j*d,N=K*d+j*G-A*y,F=-j*y-A*G-H*d;o[V]=p*K+F*-j+x*-H-N*-A,o[V+1]=x*K+F*-A+N*-j-p*-H,o[V+2]=N*K+F*-H+p*-A-x*-j},S.mulMatrixByArray=function(B,g,l,o,V,U){var y,G,d,j,A;if(V===l){for(l=S._tempArray16_3,y=0;y<16;++y)l[y]=V[U+y];o=0}for(y=0;y<4;y++)G=B[g+y],d=B[g+y+4],j=B[g+y+8],A=B[g+y+12],V[U+y]=G*l[o+0]+d*l[o+1]+j*l[o+2]+A*l[o+3],V[U+y+4]=G*l[o+4]+d*l[o+5]+j*l[o+6]+A*l[o+7],V[U+y+8]=G*l[o+8]+d*l[o+9]+j*l[o+10]+A*l[o+11],V[U+y+12]=G*l[o+12]+d*l[o+13]+j*l[o+14]+A*l[o+15]},S.mulMatrixByArrayFast=function(B,g,l,o,V,U){var y,G,d,j,A;for(y=0;y<4;y++)G=B[g+y],d=B[g+y+4],j=B[g+y+8],A=B[g+y+12],V[U+y]=G*l[o+0]+d*l[o+1]+j*l[o+2]+A*l[o+3],V[U+y+4]=G*l[o+4]+d*l[o+5]+j*l[o+6]+A*l[o+7],V[U+y+8]=G*l[o+8]+d*l[o+9]+j*l[o+10]+A*l[o+11],V[U+y+12]=G*l[o+12]+d*l[o+13]+j*l[o+14]+A*l[o+15]},S.mulMatrixByArrayAndMatrixFast=function(B,g,l,o,V){var U,y,G,d,j,A=l.elements,H=A[0],K=A[1],p=A[2],x=A[3],N=A[4],F=A[5],C=A[6],m=A[7],M=A[8],b=A[9],D=A[10],v=A[11],s=A[12],X=A[13],w=A[14],i=A[15],a=g,z=g+4,t=g+8,h=g+12,f=V,S=V+4,E=V+8,e=V+12;for(U=0;U<4;U++)y=B[a+U],G=B[z+U],d=B[t+U],j=B[h+U],o[f+U]=y*H+G*K+d*p+j*x,o[S+U]=y*N+G*F+d*C+j*m,o[E+U]=y*M+G*b+d*D+j*v,o[e+U]=y*s+G*X+d*w+j*i},S.createAffineTransformationArray=function(B,g,l,o,V,U,y,G,d,j,A,H){var K=o+o,p=V+V,x=U+U,N=o*K,F=o*p,C=o*x,m=V*p,M=V*x,b=U*x,D=y*K,v=y*p,s=y*x;A[H+0]=(1-(m+b))*G,A[H+1]=(F+s)*G,A[H+2]=(C-v)*G,A[H+3]=0,A[H+4]=(F-s)*d,A[H+5]=(1-(N+b))*d,A[H+6]=(M+D)*d,A[H+7]=0,A[H+8]=(C+v)*j,A[H+9]=(M-D)*j,A[H+10]=(1-(N+m))*j,A[H+11]=0,A[H+12]=B,A[H+13]=g,A[H+14]=l,A[H+15]=1},S.transformVector3ArrayToVector3ArrayCoordinate=function(B,g,l,o,V){var U=S._tempArray4_0,y=B[g+0],G=B[g+1],d=B[g+2],j=l.elements;U[0]=y*j[0]+G*j[4]+d*j[8]+j[12],U[1]=y*j[1]+G*j[5]+d*j[9]+j[13],U[2]=y*j[2]+G*j[6]+d*j[10]+j[14],U[3]=1/(y*j[3]+G*j[7]+d*j[11]+j[15]),o[V+0]=U[0]*U[3],o[V+1]=U[1]*U[3],o[V+2]=U[2]*U[3]},S.transformLightingMapTexcoordByUV0Array=function(B,g,l,o,V){var U=l.elements;o[V+0]=B[g+0]*U[0]+U[2],o[V+1]=(B[g+1]-1)*U[1]+U[3]},S.transformLightingMapTexcoordByUV1Array=function(B,g,l,o,V){var U=l.elements;o[V+0]=B[g+0]*U[0]+U[2],o[V+1]=1+B[g+1]*U[1]+U[3]},S.getURLVerion=function(B){var g=B.indexOf("?");return 0<=g?B.substr(g):null},S._quaternionCreateFromYawPitchRollArray=function(B,g,l,o){var V=.5*l,U=.5*g,y=.5*B,G=Math.sin(V),d=Math.cos(V),j=Math.sin(U),A=Math.cos(U),H=Math.sin(y),K=Math.cos(y);o[0]=K*j*d+H*A*G,o[1]=H*A*d-K*j*G,o[2]=K*A*G-H*j*d,o[3]=K*A*d+H*j*G},S._createAffineTransformationArray=function(B,g,l,o){var V=g[0],U=g[1],y=g[2],G=g[3],d=V+V,j=U+U,A=y+y,H=V*d,K=V*j,p=V*A,x=U*j,N=U*A,F=y*A,C=G*d,m=G*j,M=G*A,b=l[0],D=l[1],v=l[2];o[0]=(1-(x+F))*b,o[1]=(K+M)*b,o[2]=(p-m)*b,o[3]=0,o[4]=(K-M)*D,o[5]=(1-(H+F))*D,o[6]=(N+C)*D,o[7]=0,o[8]=(p+m)*v,o[9]=(N-C)*v,o[10]=(1-(H+x))*v,o[11]=0,o[12]=B[0],o[13]=B[1],o[14]=B[2],o[15]=1},S._mulMatrixArray=function(B,g,l,o){var V,U,y,G,d,j=g.elements,A=j[0],H=j[1],K=j[2],p=j[3],x=j[4],N=j[5],F=j[6],C=j[7],m=j[8],M=j[9],b=j[10],D=j[11],v=j[12],s=j[13],X=j[14],w=j[15],i=o,a=o+4,z=o+8,t=o+12;for(V=0;V<4;V++)U=B[V],y=B[V+4],G=B[V+8],d=B[V+12],l[i+V]=U*A+y*H+G*K+d*p,l[a+V]=U*x+y*N+G*F+d*C,l[z+V]=U*m+y*M+G*b+d*D,l[t+V]=U*v+y*s+G*X+d*w},S.getYawPitchRoll=function(B,g){S.transformQuat(yg.ForwardRH,B,lg.TEMPVector31),S.transformQuat(yg.Up,B,lg.TEMPVector32);var l=lg.TEMPVector32.elements;S.angleTo(yg.ZERO,lg.TEMPVector31,lg.TEMPVector33);var o=lg.TEMPVector33.elements;o[0]==Math.PI/2?(o[1]=S.arcTanAngle(l[2],l[0]),o[2]=0):o[0]==-Math.PI/2?(o[1]=S.arcTanAngle(-l[2],-l[0]),o[2]=0):(Bg.createRotationY(-o[1],lg.TEMPMatrix0),Bg.createRotationX(-o[0],lg.TEMPMatrix1),yg.transformCoordinate(lg.TEMPVector32,lg.TEMPMatrix0,lg.TEMPVector32),yg.transformCoordinate(lg.TEMPVector32,lg.TEMPMatrix1,lg.TEMPVector32),o[2]=S.arcTanAngle(l[1],-l[0])),o[1]<=-Math.PI&&(o[1]=Math.PI),o[2]<=-Math.PI&&(o[2]=Math.PI),o[1]>=Math.PI&&o[2]>=Math.PI&&(o[1]=0,o[2]=0,o[0]=Math.PI-o[0]),g[0]=o[1],g[1]=o[0],g[2]=o[2]},S.arcTanAngle=function(B,g){return 0==B?1==g?Math.PI/2:-Math.PI/2:0<B?Math.atan(g/B):B<0?0<g?Math.atan(g/B)+Math.PI:Math.atan(g/B)-Math.PI:0},S.angleTo=function(B,g,l){yg.subtract(g,B,lg.TEMPVector30),yg.normalize(lg.TEMPVector30,lg.TEMPVector30),l.elements[0]=Math.asin(lg.TEMPVector30.y),l.elements[1]=S.arcTanAngle(-lg.TEMPVector30.z,-lg.TEMPVector30.x)},S.transformQuat=function(B,g,l){var o=l.elements,V=B.elements,U=g,y=V[0],G=V[1],d=V[2],j=U[0],A=U[1],H=U[2],K=U[3],p=K*y+A*d-H*G,x=K*G+H*y-j*d,N=K*d+j*G-A*y,F=-j*y-A*G-H*d;o[0]=p*K+F*-j+x*-H-N*-A,o[1]=x*K+F*-A+N*-j-p*-H,o[2]=N*K+F*-H+p*-A-x*-j},S.quaterionNormalize=function(B,g){var l=B[0],o=B[1],V=B[2],U=B[3],y=l*l+o*o+V*V+U*U;0<y&&(y=1/Math.sqrt(y),g[0]=l*y,g[1]=o*y,g[2]=V*y,g[3]=U*y)},S.matrix4x4MultiplyFFF=function(B,g,l){var o,V,U,y,G;if(l===g)for(g=new Float32Array(16),o=0;o<16;++o)g[o]=l[o];for(o=0;o<4;o++)V=B[o],U=B[o+4],y=B[o+8],G=B[o+12],l[o]=V*g[0]+U*g[1]+y*g[2]+G*g[3],l[o+4]=V*g[4]+U*g[5]+y*g[6]+G*g[7],l[o+8]=V*g[8]+U*g[9]+y*g[10]+G*g[11],l[o+12]=V*g[12]+U*g[13]+y*g[14]+G*g[15]},S.matrix4x4MultiplyMFM=function(B,g,l){S.matrix4x4MultiplyFFF(B.elements,g,l.elements)},H(S,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new yg},"_tempVector3_1",function(){return this._tempVector3_1=new yg},"_tempVector3_2",function(){return this._tempVector3_2=new yg},"_tempVector3_3",function(){return this._tempVector3_3=new yg},"_tempVector3_4",function(){return this._tempVector3_4=new yg},"_tempVector3_5",function(){return this._tempVector3_5=new yg},"_tempVector3_6",function(){return this._tempVector3_6=new yg},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),S}(),Cg=function(){function h(){}return p(h,"Laya3D"),h._cancelLoadByUrl=function(B){D.loader.cancelLoadByUrl(B),h._innerFirstLevelLoaderManager.cancelLoadByUrl(B),h._innerSecondLevelLoaderManager.cancelLoadByUrl(B),h._innerThirdLevelLoaderManager.cancelLoadByUrl(B),h._innerFourthLevelLoaderManager.cancelLoadByUrl(B)},h._changeWebGLSize=function(B,g){t.onStageResize(B,g),k.clientWidth=B,k.clientHeight=g},h.__init__=function(){var B=g.createMap;B.lh=[eg,"SPRITE3DHIERARCHY"],B.ls=[Eg,"SPRITE3DHIERARCHY"],B.lm=[Zg,"MESH"],B.lmat=[_g,"MATERIAL"],B.jpg=[Rg,"nativeimage"],B.jpeg=[Rg,"nativeimage"],B.png=[Rg,"nativeimage"],B.pkm=[Rg,"arraybuffer"],B.raw=[cg,"arraybuffer"],B.mipmaps=[cg,"arraybuffer"],C.parserMap.SPRITE3DHIERARCHY=h._loadHierarchy,C.parserMap.MESH=h._loadMesh,C.parserMap.MATERIAL=h._loadMaterial,C.parserMap.TEXTURECUBE=h._loadTextureCube,C.parserMap.TERRAIN=h._loadTerrain,h._innerFirstLevelLoaderManager.on("error",null,h._eventLoadManagerError),h._innerSecondLevelLoaderManager.on("error",null,h._eventLoadManagerError),h._innerThirdLevelLoaderManager.on("error",null,h._eventLoadManagerError),h._innerFourthLevelLoaderManager.on("error",null,h._eventLoadManagerError)},h.READ_BLOCK=function(){return h._readData.pos+=4,!0},h.READ_DATA=function(){return h._DATA.offset=h._readData.getUint32(),h._DATA.size=h._readData.getUint32(),!0},h.READ_STRINGS=function(){var B=[],g={offset:0,size:0};g.offset=h._readData.getUint16(),g.size=h._readData.getUint16();h._readData.pos;h._readData.pos=g.offset+h._DATA.offset;for(var l=0;l<g.size;l++){var o=h._readData.readUTFString();-1===o.lastIndexOf(".lmat")&&-1===o.lastIndexOf(".lpbr")||B.push(o)}return B},h.formatRelativePath=function(B,g){var l;if("."===g.charAt(0)){for(var o=(B+g).split("/"),V=0,U=o.length;V<U;V++)if(".."==o[V]){var y=V-1;0<y&&".."!==o[y]&&(o.splice(y,2),V-=2)}l=o.join("/")}else l=B+g;return null!=z.customFormat&&(l=z.customFormat(l,null)),l},h._eventLoadManagerError=function(B){D.loader.event("error",B)},h._addHierarchyInnerUrls=function(B,g,l,o,V,U){var y=h.formatRelativePath(o,V);l&&(y+=l),B.push({url:y,clas:U}),g[V]=y},h._getSprite3DHierarchyInnerUrls=function(B,g,l,o,V,U,y){var G,d=0,j=0;switch(B.type){case"Scene":var A=B.customProps.lightmaps;for(d=0,j=A.length;d<j;d++){var H=A[d].replace(".exr",".png");h._addHierarchyInnerUrls(o,V,U,y,H,Rg)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var K;if(B.instanceParams)(K=B.instanceParams.loadPath)&&h._addHierarchyInnerUrls(g,V,U,y,K,Zg);else{(K=(G=B.customProps).meshPath)&&h._addHierarchyInnerUrls(g,V,U,y,K,Zg);var p=G.materials;if(p)for(d=0,j=p.length;d<j;d++){for(var x=p[d],N=x.type.split("."),F=f.window,C=0,m=N.length;C<m;++C){F=F[this.clasPaths[C]]}if("function"!=typeof F)throw"_getSprite3DHierarchyInnerUrls 错误: "+x.type+" 不是类";h._addHierarchyInnerUrls(l,V,U,y,x.path,F)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var M=(G=B.customProps).meshPath;M&&h._addHierarchyInnerUrls(g,V,U,y,M,Zg);var b=G.material;if(b){N=b.type.split("."),F=f.window;for(C=0,m=N.length;C<m;++C){F=F[this.clasPaths[C]]}h._addHierarchyInnerUrls(l,V,U,y,b.path,F)}else{var D=G.materialPath;if(D)h._addHierarchyInnerUrls(l,V,U,y,D,ShurikenParticleMaterial);else{var v=G.texturePath;v&&h._addHierarchyInnerUrls(o,V,U,y,v,Rg)}}break;case"Terrain":h._addHierarchyInnerUrls(o,V,U,y,B.customProps.dataPath,TerrainRes)}var s=B.components;for(var X in s){var w=s[X];switch(X){case"Animator":var i=w.avatarPath;if(i)h._addHierarchyInnerUrls(o,V,U,y,i,Avatar);else{var a=w.avatar;a&&h._addHierarchyInnerUrls(o,V,U,y,a.path,Avatar)}var z=w.clipPaths;for(d=0,j=z.length;d<j;d++)h._addHierarchyInnerUrls(o,V,U,y,z[d],AnimationClip)}}var t=B.child;for(d=0,j=t.length;d<j;d++)h._getSprite3DHierarchyInnerUrls(t[d],g,l,o,V,U,y)},h._loadHierarchy=function(B){B.on("loaded",null,h._onHierarchylhLoaded,[B,B._class._getGroup()]),B.load(B.url,"json",!1,null,!0)},h._onHierarchylhLoaded=function(B,g,l){if(B._class.destroyed)B.endLoad();else{var o=B.url,V=Fg.getURLVerion(o),U=z.getPath(o),y=[],G=[],d=[],j={};h._getSprite3DHierarchyInnerUrls(l,y,G,d,j,V,U);var A=y.length+G.length+d.length,H=A+1,K=1/H;if(h._onProcessChange(B,0,K,1),0<d.length){var p=A/H,x=a.create(null,h._onProcessChange,[B,K,p],!1);h._innerFourthLevelLoaderManager.create(d,a.create(null,h._onHierarchyInnerForthLevResouLoaded,[B,g,x,l,j,y,G,K+p*d.length,p]),x,null,null,1,!0,g)}else h._onHierarchyInnerForthLevResouLoaded(B,g,null,l,j,y,G,K,p)}},h._onHierarchyInnerForthLevResouLoaded=function(B,g,l,o,V,U,y,G,d){if(B._class.destroyed)B.endLoad();else if(l&&l.recover(),0<y.length){var j=a.create(null,h._onProcessChange,[B,G,d],!1);h._innerSecondLevelLoaderManager.create(y,a.create(null,h._onHierarchyInnerSecondLevResouLoaded,[B,g,j,o,V,U,G+d*y.length,d]),l,null,null,1,!0,g)}else h._onHierarchyInnerSecondLevResouLoaded(B,g,null,o,V,U,G,d)},h._onHierarchyInnerSecondLevResouLoaded=function(B,g,l,o,V,U,y,G){if(B._class.destroyed)B.endLoad();else if(l&&l.recover(),0<U.length){var d=a.create(null,h._onProcessChange,[B,y,G],!1);h._innerFirstLevelLoaderManager.create(U,a.create(null,h._onHierarchyInnerFirstLevResouLoaded,[B,d,o,V]),l,null,null,1,!0,g)}else h._onHierarchyInnerFirstLevResouLoaded(B,null,o,V)},h._onHierarchyInnerFirstLevResouLoaded=function(B,g,l,o){g&&g.recover(),B.endLoad([l,o])},h._loadTerrain=function(B){B.on("loaded",null,h._onTerrainLtLoaded,[B,B._class._getGroup()]),B.load(B.url,"json",!1,null,!0)},h._onTerrainLtLoaded=function(B,g,l){if(B._class.destroyed)B.endLoad();else{var o,V,U=B.url,y=Fg.getURLVerion(U),G=z.getPath(U),d=[],j={},A=0,H=0,K=l.heightData;o=K.url,V=h.formatRelativePath(G,o),y&&(V+=y),o=j[o]=V;var p=l.detailTexture;for(A=0,H=p.length;A<H;A++)d.push({url:p[A].diffuse});var x=l.normalMap;for(A=0,H=x.length;A<H;A++)d.push({url:x[A]});var N=l.alphaMap;for(A=0,H=N.length;A<H;A++)d.push({url:N[A],params:[!1,!1,6408,!0]});for(A=0,H=d.length;A<H;A++){var F=d[A].url;V=h.formatRelativePath(G,F),y&&(V+=y),d[A].url=V,j[F]=V}var C=d.length,m=C+2,M=1/m;h._onProcessChange(B,0,M,1);var b={heightMapLoaded:!1,texturesLoaded:!1},D=a.create(null,h._onProcessChange,[B,M,M],!1);h._innerFourthLevelLoaderManager.create(o,a.create(null,h._onTerrainHeightMapLoaded,[B,D,l,j,b]),D,null,[K.numX,K.numZ,K.bitType,K.value],1,!0,g);var v=a.create(null,h._onProcessChange,[B,2*M,C/m],!1);h._innerFourthLevelLoaderManager.create(d,a.create(null,h._onTerrainTexturesLoaded,[B,v,l,j,b]),v,null,null,1,!0,g)}},h._onTerrainHeightMapLoaded=function(B,g,l,o,V){V.heightMapLoaded=!0,V.texturesLoaded&&(B.endLoad([l,o]),g.recover())},h._onTerrainTexturesLoaded=function(B,g,l,o,V){V.texturesLoaded=!0,V.heightMapLoaded&&(B.endLoad([l,o]),g.recover())},h._loadMesh=function(B){B.on("loaded",null,h._onMeshLmLoaded,[B,B._class._getGroup()]),B.load(B.url,"arraybuffer",!1,null,!0)},h._onMeshLmLoaded=function(B,g,l){if(B._class.destroyed)B.endLoad();else{var o,V,U,y=B.url,G=Fg.getURLVerion(y),d=z.getPath(y),j={},A=0,H=0;switch((h._readData=new v(l)).pos=0,h._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var K=h._readData.getUint32();h._readData.pos=h._readData.pos+4,H=h._readData.getUint16(),h._readData.pos=h._readData.pos+8*H;var p=h._readData.getUint32();for(H=h._readData.getUint16(),h._readData.pos=K+p,o=[],A=0;A<H;A++){var x=h._readData.readUTFString();-1!==x.lastIndexOf(".lmat")&&o.push(x)}break;default:for(h.READ_BLOCK(),A=0;A<2;A++){var N=h._readData.getUint16(),F=h._strings[N],C=h["READ_"+F];if(null==C)throw new Error("model file err,no this function:"+N+" "+F);1===A?o=C.call():C.call()}}for(A=0,U=o.length;A<U;A++){var m=o[A];V=h.formatRelativePath(d,m),G&&(V+=G),o[A]=V,j[m]=V}if(0<o.length){h._onProcessChange(B,0,.5,1);var M=a.create(null,h._onProcessChange,[B,.5,.5],!1);h._innerSecondLevelLoaderManager.create(o,a.create(null,h._onMeshMateialLoaded,[B,M,l,j]),M,null,null,1,!0,g)}else B.endLoad([l,j])}},h._onMeshMateialLoaded=function(B,g,l,o){B.endLoad([l,o]),g.recover()},h._getMaterialTexturePath=function(B,g,l){var o=B.length-4;return B.indexOf(".dds")!=o&&B.indexOf(".tga")!=o&&B.indexOf(".exr")!=o&&B.indexOf(".DDS")!=o&&B.indexOf(".TGA")!=o&&B.indexOf(".EXR")!=o||(B=B.substr(0,o)+".png"),B=h.formatRelativePath(l,B),g&&(B+=g),B},h._loadMaterial=function(B){B.on("loaded",null,h._onMaterilLmatLoaded,[B,B._class._getGroup()]),B.load(B.url,"json",!1,null,!0)},h._onMaterilLmatLoaded=function(B,g,l){if(B._class.destroyed)B.endLoad();else{var o,V=B.url,U=Fg.getURLVerion(V),y=z.getPath(V),G=[],d={},j=l.customProps,A=l.version;if(A)switch(A){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var H=l.props.textures,K=0,p=H.length;K<p;K++){var x=H[K],N=x.path;if(N){var F=N.length-4;N.indexOf(".exr")!=F&&N.indexOf(".EXR")!=F||(N=N.substr(0,F)+".png"),o=h.formatRelativePath(y,N),U&&(o+=U),G.push({url:o,params:x.params}),d[N]=o}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var C=j.diffuseTexture.texture2D;if(C&&(o=h._getMaterialTexturePath(C,U,y),G.push(o),d[C]=o),j.normalTexture){var m=j.normalTexture.texture2D;m&&(o=h._getMaterialTexturePath(m,U,y),G.push(o),d[m]=o)}if(j.specularTexture){var M=j.specularTexture.texture2D;M&&(o=h._getMaterialTexturePath(M,U,y),G.push(o),d[M]=o)}if(j.emissiveTexture){var b=j.emissiveTexture.texture2D;b&&(o=h._getMaterialTexturePath(b,U,y),G.push(o),d[b]=o)}if(j.ambientTexture){var D=j.ambientTexture.texture2D;D&&(o=h._getMaterialTexturePath(D,U,y),G.push(o),d[D]=o)}if(j.reflectTexture){var v=j.reflectTexture.texture2D;v&&(o=h._getMaterialTexturePath(v,U,y),G.push(o),d[v]=o)}}var s=G.length,X=s+1,w=1/X;if(h._onProcessChange(B,0,w,1),0<s){var i=a.create(null,h._onProcessChange,[B,w,s/X],!1);h._innerFourthLevelLoaderManager.create(G,a.create(null,h._onMateialTexturesLoaded,[B,i,l,d]),i,Rg,null,1,!0,g)}else h._onMateialTexturesLoaded(B,null,l,null)}},h._onMateialTexturesLoaded=function(B,g,l,o){B.endLoad([l,o]),g&&g.recover()},h._loadTextureCube=function(B){B.on("loaded",null,h._onTextureCubeLtcLoaded,[B]),B.load(B.url,"json",!1,null,!0)},h._onTextureCubeLtcLoaded=function(B,g){if(B._class.destroyed)B.endLoad();else{var l=z.getPath(B.url),o=[h.formatRelativePath(l,g.px),h.formatRelativePath(l,g.nx),h.formatRelativePath(l,g.py),h.formatRelativePath(l,g.ny),h.formatRelativePath(l,g.pz),h.formatRelativePath(l,g.nz)];h._onProcessChange(B,0,1/7,1);var V=a.create(null,h._onProcessChange,[B,1/7,6/7],!1);h._innerFourthLevelLoaderManager.load(o,a.create(null,h._onTextureCubeImagesLoaded,[B,o,V]),V,"nativeimage")}},h._onTextureCubeImagesLoaded=function(B,g,l){var o=[];o.length=6;for(var V=0;V<6;V++){var U=g[V];o[V]=C.getRes(U),C.clearRes(U)}B.endLoad(o),l.recover()},h._onProcessChange=function(B,g,l,o){(o=g+o*l)<1&&B.event("progress",o)},h.init=function(B,g,l,o,V,U){if(void 0===l&&(l=!1),void 0===o&&(o=!1),void 0===V&&(V=!0),void 0===U&&(U=!0),m.update3DLoop=function(){},m.cancelLoadByUrl=function(B){h._cancelLoadByUrl(B)},d.isAntialias=l,d.isAlpha=o,d.premultipliedAlpha=V,d.isStencil=U,!t.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");m.changeWebGLSize=h._changeWebGLSize,N.is3DMode=!0,D.init(B,g),S.__init__(),Hg.__init__(),Ig.__init__(),r.__init__(),h.__init__(),y.maxTextureCount=2,(h.debugMode||J.debugMode)&&(h._debugPhasorSprite=new n)},h.HIERARCHY="SPRITE3DHIERARCHY",h.MESH="MESH",h.MATERIAL="MATERIAL",h.PBRMATERIAL="PBRMTL",h.TEXTURECUBE="TEXTURECUBE",h.TERRAIN="TERRAIN",h._readData=null,h._debugPhasorSprite=null,h.debugMode=!1,H(h,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new g},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new g},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new g},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new g}]),h}(),mg=function(B){function V(B){V.__super.call(this),this._owner=B,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}p(V,"laya.d3.animation.AnimationTransform3D",U);var g=V.prototype;return g._getlocalMatrix=function(){return this._localUpdate&&(Fg._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},g._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldTransform()}},g._setWorldMatrixAndUpdate=function(B){if(this._worldMatrix=B,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var g=this._getlocalMatrix(),l=0;l<16;++l)this._worldMatrix[l]=g[l];else Fg.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},g._setWorldMatrixNoUpdate=function(B){this._worldMatrix=B},g._setWorldMatrixIgnoreUpdate=function(B){this._worldMatrix=B,this._worldUpdate=!1},g.getLocalPosition=function(){return this._localPosition},g.setLocalPosition=function(B){if(this._parent)this._localPosition=B,this._localUpdate=!0,this._onWorldTransform();else{var g=this._entity.owner._transform,l=this._entity.localPosition,o=l.elements;o[0]=B[0],o[1]=B[1],o[2]=B[2],g.localPosition=l}},g.getLocalRotation=function(){if(this._localQuaternionUpdate){var B=this._localRotationEuler;Fg._quaternionCreateFromYawPitchRollArray(B[1]/V._angleToRandin,B[0]/V._angleToRandin,B[2]/V._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},g.setLocalRotation=function(B){if(this._parent)this._localRotation=B,Fg.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var g=this._entity.owner._transform,l=this._entity.localRotation,o=l.elements;o[0]=B[0],o[1]=B[1],o[2]=B[2],o[3]=B[3],g.localRotation=l}},g.getLocalScale=function(){return this._localScale},g.setLocalScale=function(B){if(this._parent)this._localScale=B,this._localUpdate=!0,this._onWorldTransform();else{var g=this._entity.owner._transform,l=this._entity.localScale,o=l.elements;o[0]=B[0],o[1]=B[1],o[2]=B[2],g.localScale=l}},g.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){Fg.getYawPitchRoll(this._localRotation,V._tempVector3);var B=V._tempVector3,g=this._localRotationEuler;g[0]=B[1]*V._angleToRandin,g[1]=B[0]*V._angleToRandin,g[2]=B[2]*V._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},g.setLocalRotationEuler=function(B){if(this._parent)Fg._quaternionCreateFromYawPitchRollArray(B[1]/V._angleToRandin,B[0]/V._angleToRandin,B[2]/V._angleToRandin,this._localRotation),this._localRotationEuler=B,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var g=this._entity.owner._transform,l=this._entity.localRotationEuler,o=l.elements;o[0]=B[0],o[1]=B[1],o[2]=B[2],g.localRotationEuler=l}},g.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)Fg.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var B=this._getlocalMatrix(),g=0;g<16;++g)this._worldMatrix[g]=B[g];this._worldUpdate=!1}return this._worldMatrix},g.setParent=function(B){if(this._parent!==B){if(this._parent){var g=this._parent._childs,l=g.indexOf(this);g.splice(l,1)}B&&(B._childs.push(this),B&&this._onWorldTransform()),this._parent=B}},H(V,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),V}(),Mg=function(B){function g(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,g.__super.call(this),this._destroyed=!1,this._id=g._uniqueIDCounter,g._uniqueIDCounter++}p(g,"laya.d3.component.Component3D",U);var l=g.prototype;return D.imps(l,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),l._initialize=function(B){this._owner=B,this._enable=!0,this.started=!1,this._load(B)},l._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},l._load=function(B){},l._start=function(B){},l._update=function(B){},l._lateUpdate=function(B){},l._preRenderUpdate=function(B){},l._postRenderUpdate=function(B){},l._unload=function(B){this.offAll()},l._cloneTo=function(B){},x(0,l,"id",function(){return this._id}),x(0,l,"destroyed",function(){return this._destroyed}),x(0,l,"owner",function(){return this._owner}),x(0,l,"enable",function(){return this._enable},function(B){this._enable!==B&&(this._enable=B,this.event("enablechanged",this._enable))}),x(0,l,"isSingleton",function(){return g._isSingleton}),g._isSingleton=!0,g._uniqueIDCounter=1,g}(),bg=function(B){function g(){this._destroyed=!1,g.__super.call(this),this._destroyed=!1}p(g,"laya.d3.core.GeometryFilter",U);var l=g.prototype;return D.imps(l,{"laya.resource.IDestroy":!0}),l._destroy=function(){this.offAll(),this._destroyed=!0},x(0,l,"_isAsyncLoaded",function(){return!0}),x(0,l,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),x(0,l,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),x(0,l,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),x(0,l,"destroyed",function(){return this._destroyed}),g}(),Dg=function(B){function o(B){o.__super.call(this),this._id=++o._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new JB(new yg,new yg),this._boundingBoxCenter=new yg,this._boundingSphere=new uB(new yg,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=B,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}p(o,"laya.d3.core.render.BaseRender",U);var g=o.prototype;return D.imps(g,{"laya.resource.IDestroy":!0}),g._changeMaterialReference=function(B,g){B&&B._removeReference(),g._addReference()},g._getInstanceMaterial=function(B,g){var l=new B.constructor;return B.cloneTo(l),l.name=l.name+"(Instance)",this._materialsInstance[g]=!0,this._changeMaterialReference(this._materials[g],l),this._materials[g]=l},g._setShaderValuelightMap=function(B){this._setShaderValueTexture(3,B)},g._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},g._renderRenderableBoundBox=function(){var B=Cg._debugPhasorSprite,g=this.boundingBox,l=o._tempBoundBoxCorners;g.getCorners(l),B.line(l[0],o._greenColor,l[1],o._greenColor),B.line(l[2],o._greenColor,l[3],o._greenColor),B.line(l[4],o._greenColor,l[5],o._greenColor),B.line(l[6],o._greenColor,l[7],o._greenColor),B.line(l[0],o._greenColor,l[3],o._greenColor),B.line(l[1],o._greenColor,l[2],o._greenColor),B.line(l[2],o._greenColor,l[6],o._greenColor),B.line(l[3],o._greenColor,l[7],o._greenColor),B.line(l[0],o._greenColor,l[4],o._greenColor),B.line(l[1],o._greenColor,l[5],o._greenColor),B.line(l[4],o._greenColor,l[7],o._greenColor),B.line(l[5],o._greenColor,l[6],o._greenColor)},g._calculateBoundingSphere=function(){throw"BaseRender: must override it."},g._calculateBoundingBox=function(){throw"BaseRender: must override it."},g._setShaderValueTexture=function(B,g){this._owner._shaderValues.setValue(B,g)},g._setShaderValueMatrix4x4=function(B,g){this._owner._shaderValues.setValue(B,g?g.elements:null)},g._setShaderValueColor=function(B,g){this._owner._shaderValues.setValue(B,g?g.elements:null)},g._setShaderValueBuffer=function(B,g){this._owner._shaderValues.setValue(B,g)},g._setShaderValueInt=function(B,g){this._owner._shaderValues.setValue(B,g)},g._setShaderValueBool=function(B,g){this._owner._shaderValues.setValue(B,g)},g._setShaderValueNumber=function(B,g){this._owner._shaderValues.setValue(B,g)},g._setShaderValueVector2=function(B,g){this._owner._shaderValues.setValue(B,g?g.elements:null)},g._addShaderDefine=function(B){this._owner._shaderDefineValue|=B},g._removeShaderDefine=function(B){this._owner._shaderDefineValue&=~B},g._renderUpdate=function(B){return!0},g._applyLightMapParams=function(){if(0<=this._lightmapIndex){var B=this._owner.scene;if(B){var g=B.getlightmaps()[this._lightmapIndex];g?(this._addShaderDefine(ng.SAHDERDEFINE_LIGHTMAP),g.loaded?this._setShaderValuelightMap(g):g.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(ng.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(ng.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(ng.SAHDERDEFINE_LIGHTMAP)},g._updateOctreeNode=function(){var B=this._treeNode;B&&this._octreeNodeNeedChange&&(B.updateObject(this),this._octreeNodeNeedChange=!1)},g._destroy=function(){this.offAll();var B=0,g=0;for(B=0,g=this._renderElements.length;B<g;B++)this._renderElements[B]._destroy();for(B=0,g=this._materials.length;B<g;B++)this._materials[B]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},x(0,g,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),x(0,g,"id",function(){return this._id}),x(0,g,"material",function(){var B=this._materials[0];if(B&&!this._materialsInstance[0]){var g=this._getInstanceMaterial(B,0);this.event("materialchanged",[this,0,g])}return this._materials[0]},function(B){this.sharedMaterial=B}),x(0,g,"sharedMaterial",function(){return this._materials[0]},function(B){var g=this._materials[0];g!==B&&(this._materials[0]=B,this._materialsInstance[0]=!1,this._changeMaterialReference(g,B),this.event("materialchanged",[this,0,B]))}),x(0,g,"lightmapIndex",function(){return this._lightmapIndex},function(B){this._lightmapIndex=B,this._applyLightMapParams()}),x(0,g,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(B){this._lightmapScaleOffset=B,this._setShaderValueColor(2,B),this._addShaderDefine(ng.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),x(0,g,"enable",function(){return this._enable},function(B){this._enable=B,this.event("enablechanged",[this,B])}),x(0,g,"materials",function(){for(var B=0,g=this._materials.length;B<g;B++)if(!this._materialsInstance[B]){var l=this._getInstanceMaterial(this._materials[B],B);this.event("materialchanged",[this,B,l])}return this._materials.slice()},function(B){this.sharedMaterials=B}),x(0,g,"sharedMaterials",function(){return this._materials.slice()},function(B){if(!B)throw new Error("MeshRender: shadredMaterials value can't be null.");var g=B.length;this._materialsInstance.length=g;for(var l=0;l<g;l++){var o=this._materials[l];o!==B[l]&&(this._materialsInstance[l]=!1,this._changeMaterialReference(o,B[l]),this.event("materialchanged",[this,l,B[l]]))}this._materials=B}),x(0,g,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),x(0,g,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var B=this.boundingBox;yg.add(B.min,B.max,this._boundingBoxCenter),yg.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),x(0,g,"receiveShadow",function(){return this._receiveShadow},function(B){this._receiveShadow!==B&&((this._receiveShadow=B)?this._addShaderDefine(pg.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(pg.SHADERDEFINE_RECEIVE_SHADOW))}),x(0,g,"destroyed",function(){return this._destroyed}),o._uniqueIDCounter=0,H(o,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new yg,new yg,new yg,new yg,new yg,new yg,new yg,new yg]},"_greenColor",function(){return this._greenColor=new Gg(0,1,0,1)}]),o}(),vg=function(B){function G(B){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,G.__super.call(this),this._localPosition=new yg,this._localRotation=new lg(0,0,0,1),this._localScale=new yg(1,1,1),this._localRotationEuler=new yg,this._localMatrix=new Bg,this._position=new yg,this._rotation=new lg(0,0,0,1),this._scale=new yg(1,1,1),this._worldMatrix=new Bg,this._forward=new yg,this._up=new yg,this._right=new yg,this._owner=B,this._childs=[]}p(G,"laya.d3.core.Transform3D",U);var g=G.prototype;return g._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)Bg.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var B=G._tempVector30;yg.multiply(this.pivot,this._localScale,B);var g=G._tempVector31;yg.subtract(B,this.pivot,g);var l=G._tempVector32,o=this.localRotation;yg.transformQuat(B,o,l),yg.subtract(l,B,l);var V=G._tempVector33;yg.subtract(this._localPosition,g,V),yg.subtract(V,l,V),Bg.createAffineTransformation(V,o,this._localScale,this._localMatrix)}},g._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldPositionRotationTransform()}},g._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldPositionScaleTransform()}},g._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldPositionTransform()}},g._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldPositionRotationTransform()}},g._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldPositionScaleTransform()}},g._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._onWorldTransform()}},g.translate=function(B,g){void 0===g&&(g=!0),g?(Bg.createFromQuaternion(this.localRotation,G._tempMatrix0),yg.transformCoordinate(B,G._tempMatrix0,G._tempVector30),yg.add(this.localPosition,G._tempVector30,this._localPosition),this.localPosition=this._localPosition):(yg.add(this.position,B,this._position),this.position=this._position)},g.rotate=function(B,g,l){var o;void 0===g&&(g=!0),void 0===l&&(l=!0),o=l?B:(yg.scale(B,Math.PI/180,G._tempVector30),G._tempVector30),lg.createFromYawPitchRoll(o.y,o.x,o.z,G._tempQuaternion0),g?(lg.multiply(this._localRotation,G._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(lg.multiply(G._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},g.lookAt=function(B,g,l){void 0===l&&(l=!1);var o,V=B.elements;if(l){if(o=this._localPosition.elements,Math.abs(o[0]-V[0])<qB.zeroTolerance&&Math.abs(o[1]-V[1])<qB.zeroTolerance&&Math.abs(o[2]-V[2])<qB.zeroTolerance)return;lg.lookAt(this._localPosition,B,g,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var U=this.position;if(o=U.elements,Math.abs(o[0]-V[0])<qB.zeroTolerance&&Math.abs(o[1]-V[1])<qB.zeroTolerance&&Math.abs(o[2]-V[2])<qB.zeroTolerance)return;lg.lookAt(U,B,g,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},x(0,g,"_isFrontFaceInvert",function(){var B=this.scale,g=B.x<0;return B.y<0&&(g=!g),B.z<0&&(g=!g),g}),x(0,g,"owner",function(){return this._owner}),x(0,g,"localRotation",function(){if(this._localQuaternionUpdate){var B=this._localRotationEuler.elements;lg.createFromYawPitchRoll(B[1]/G._angleToRandin,B[0]/G._angleToRandin,B[2]/G._angleToRandin,this._localRotation)}return this._localRotation},function(B){this._localRotation=B,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),x(0,g,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?Bg.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(B){null===this._parent?B.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),Bg.multiply(this._localMatrix,B,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=B,this._worldUpdate=!1}),x(0,g,"worldNeedUpdate",function(){return this._worldUpdate}),x(0,g,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(B){this._localMatrix=B,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),x(0,g,"dummy",function(){return this._dummy},function(B){this._dummy!==B&&(this._dummy&&(this._dummy._entity=null),B&&(B._entity=this),this._dummy=B)}),x(0,g,"localPosition",function(){return this._localPosition},function(B){this._localPosition=B,this._localUpdate=!0,this._onWorldPositionTransform()}),x(0,g,"position",function(){if(this._positionUpdate){if(null!=this._parent){var B=this._parent.position;yg.multiply(this._localPosition,this._parent.scale,G._tempVector30),yg.transformQuat(G._tempVector30,this._parent.rotation,G._tempVector30),yg.add(B,G._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(B){if(null!=this._parent){yg.subtract(B,this._parent.position,this._localPosition);var g=this._parent.scale.elements,l=g[0],o=g[1],V=g[2];if(1!==l||1!==o||1!==V){var U=G._tempVector30,y=U.elements;y[0]=1/l,y[1]=1/o,y[2]=1/V,yg.multiply(this._localPosition,U,this._localPosition)}this._parent.rotation.invert(G._tempQuaternion0),yg.transformQuat(this._localPosition,G._tempQuaternion0,this._localPosition)}else B.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=B,this._positionUpdate=!1}),x(0,g,"localScale",function(){return this._localScale},function(B){this._localScale=B,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),x(0,g,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(G._tempVector30);var B=G._tempVector30.elements,g=this._localRotationEuler.elements;g[0]=B[1]*G._angleToRandin,g[1]=B[0]*G._angleToRandin,g[2]=B[2]*G._angleToRandin}return this._localRotationEuler},function(B){this._localRotationEuler=B,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),x(0,g,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?lg.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(B){null!=this._parent?(this._parent.rotation.invert(G._tempQuaternion0),lg.multiply(B,G._tempQuaternion0,this._localRotation)):B.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=B,this._rotationUpdate=!1}),x(0,g,"scale",function(){return this._scaleUpdate&&(null!==this._parent?yg.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(B){if(null!==this._parent){var g=this._parent.scale.elements,l=G._tempVector30.elements;l[0]=1/g[0],l[1]=1/g[1],l[2]=1/g[2],yg.multiply(B,G._tempVector30,this._localScale)}else B.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=B,this._scaleUpdate=!1}),x(0,g,"rotationEuler",null,function(B){lg.createFromYawPitchRoll(B.y,B.x,B.z,this._rotation),this.rotation=this._rotation}),x(0,g,"forward",function(){var B=this.worldMatrix.elements;return this._forward.elements[0]=-B[8],this._forward.elements[1]=-B[9],this._forward.elements[2]=-B[10],this._forward}),x(0,g,"up",function(){var B=this.worldMatrix.elements;return this._up.elements[0]=B[4],this._up.elements[1]=B[5],this._up.elements[2]=B[6],this._up}),x(0,g,"right",function(){var B=this.worldMatrix.elements;return this._right.elements[0]=B[0],this._right.elements[1]=B[1],this._right.elements[2]=B[2],this._right}),x(0,g,"parent",function(){return this._parent},function(B){if(this._parent!==B){if(this._parent){var g=this._parent._childs,l=g.indexOf(this);g.splice(l,1)}B&&(B._childs.push(this),B&&this._onWorldTransform()),this._parent=B}}),H(G,["_tempVector30",function(){return this._tempVector30=new yg},"_tempVector31",function(){return this._tempVector31=new yg},"_tempVector32",function(){return this._tempVector32=new yg},"_tempVector33",function(){return this._tempVector33=new yg},"_tempQuaternion0",function(){return this._tempQuaternion0=new lg},"_tempMatrix0",function(){return this._tempMatrix0=new Bg},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),G}(),sg=(function(B){function g(){this._rotation=0,this._matNeedUpdte=!1,g.__super.call(this),this._matrix=new Bg,this._offset=new Ug,this._tiling=new Ug(1,1)}p(g,"laya.d3.core.TransformUV",U);var l=g.prototype;D.imps(l,{"laya.d3.core.IClone":!0}),l._updateMatrix=function(){g._tempOffsetV3.elements[0]=this._offset.x,g._tempOffsetV3.elements[1]=this._offset.y,lg.createFromYawPitchRoll(0,0,this._rotation,g._tempRotationQua),g._tempTitlingV3.elements[0]=this._tiling.x,g._tempTitlingV3.elements[1]=this._tiling.y,Bg.createAffineTransformation(g._tempOffsetV3,g._tempRotationQua,g._tempTitlingV3,this._matrix)},l.cloneTo=function(B){B._matrix=this._matrix.clone(),B._offset=this._offset.clone(),B._rotation=this._rotation,B._tiling=this._tiling.clone()},l.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,l,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),x(0,l,"tiling",function(){return this._tiling},function(B){this._tiling=B,this._matNeedUpdte=!0}),x(0,l,"offset",function(){return this._offset},function(B){this._offset=B,this._matNeedUpdte=!0}),x(0,l,"rotation",function(){return this._rotation},function(B){this._rotation=B,this._matNeedUpdte=!0}),H(g,["_tempOffsetV3",function(){return this._tempOffsetV3=new yg(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new lg},"_tempTitlingV3",function(){return this._tempTitlingV3=new yg(1,1,1)}])}(),function(l){function B(){this.x=NaN,this.y=NaN,this.z=NaN,B.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}p(B,"laya.d3.core.particleShuriKen.module.shape.BoxShape",l);var g=B.prototype;g._getShapeBoundBox=function(B){var g=B.min.elements;g[0]=.5*-this.x,g[1]=.5*-this.y,g[2]=.5*-this.z;var l=B.max.elements;l[0]=.5*this.x,l[1]=.5*this.y,l[2]=.5*this.z},g._getSpeedBoundBox=function(B){var g=B.min.elements;g[0]=0,g[1]=0,g[2]=0;var l=B.max.elements;l[0]=0,l[1]=1,l[2]=0},g.generatePositionAndDirection=function(B,g,l,o){var V=B.elements,U=g.elements;l?(l.seed=o[16],R._randomPointInsideHalfUnitBox(B,l),o[16]=l.seed):R._randomPointInsideHalfUnitBox(B),V[0]=this.x*V[0],V[1]=this.y*V[1],V[2]=this.z*V[2],this.randomDirection?l?(l.seed=o[17],R._randomPointUnitSphere(g,l),o[17]=l.seed):R._randomPointUnitSphere(g):(U[0]=0,U[1]=0,U[2]=1)},g.cloneTo=function(B){l.prototype.cloneTo.call(this,B);var g=B;g.x=this.x,g.y=this.y,g.z=this.z,g.randomDirection=this.randomDirection}}(Y),function(l){function y(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,y.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}p(y,"laya.d3.core.particleShuriKen.module.shape.CircleShape",l);var B=y.prototype;B._getShapeBoundBox=function(B){var g=B.min.elements;g[0]=g[2]=-this.radius,g[1]=0;var l=B.max.elements;l[0]=l[2]=this.radius,l[1]=0},B._getSpeedBoundBox=function(B){var g=B.min.elements;g[0]=g[1]=-1,g[2]=0;var l=B.max.elements;l[0]=l[1]=1,l[2]=0},B.generatePositionAndDirection=function(B,g,l,o){var V=B.elements,U=y._tempPositionPoint.elements;l?(l.seed=o[16],this.emitFromEdge?R._randomPointUnitArcCircle(this.arc,y._tempPositionPoint,l):R._randomPointInsideUnitArcCircle(this.arc,y._tempPositionPoint,l),o[16]=l.seed):this.emitFromEdge?R._randomPointUnitArcCircle(this.arc,y._tempPositionPoint):R._randomPointInsideUnitArcCircle(this.arc,y._tempPositionPoint),V[0]=-U[0],V[1]=U[1],V[2]=0,yg.scale(B,this.radius,B),this.randomDirection?l?(l.seed=o[17],R._randomPointUnitSphere(g,l),o[17]=l.seed):R._randomPointUnitSphere(g):B.cloneTo(g)},B.cloneTo=function(B){l.prototype.cloneTo.call(this,B);var g=B;g.radius=this.radius,g.arc=this.arc,g.emitFromEdge=this.emitFromEdge,g.randomDirection=this.randomDirection},H(y,["_tempPositionPoint",function(){return this._tempPositionPoint=new Ug}])}(Y),function(l){function K(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,K.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}p(K,"laya.d3.core.particleShuriKen.module.shape.ConeShape",l);var B=K.prototype;B._getShapeBoundBox=function(B){var g=this.radius+this.length*Math.sin(this.angle),l=this.length*Math.cos(this.angle),o=B.min.elements;o[0]=o[1]=-g,o[2]=0;var V=B.max.elements;V[0]=V[1]=g,V[2]=l},B._getSpeedBoundBox=function(B){var g=Math.sin(this.angle),l=B.min.elements;l[0]=l[1]=-g,l[2]=0;var o=B.max.elements;o[0]=l[1]=g,o[2]=1},B.generatePositionAndDirection=function(B,g,l,o){var V,U=B.elements,y=g.elements,G=K._tempPositionPoint.elements,d=NaN,j=NaN,A=Math.cos(this.angle),H=Math.sin(this.angle);switch(this.emitType){case 0:l?(l.seed=o[16],R._randomPointInsideUnitCircle(K._tempPositionPoint,l),o[16]=l.seed):R._randomPointInsideUnitCircle(K._tempPositionPoint),d=G[0],j=G[1],U[0]=d*this.radius,U[1]=j*this.radius,U[2]=0,this.randomDirection?(l?(l.seed=o[17],R._randomPointInsideUnitCircle(K._tempDirectionPoint,l),o[17]=l.seed):R._randomPointInsideUnitCircle(K._tempDirectionPoint),V=K._tempDirectionPoint.elements,y[0]=V[0]*H,y[1]=V[1]*H):(y[0]=d*H,y[1]=j*H),y[2]=A;break;case 1:l?(l.seed=o[16],R._randomPointUnitCircle(K._tempPositionPoint,l),o[16]=l.seed):R._randomPointUnitCircle(K._tempPositionPoint),d=G[0],j=G[1],U[0]=d*this.radius,U[1]=j*this.radius,U[2]=0,this.randomDirection?(l?(l.seed=o[17],R._randomPointInsideUnitCircle(K._tempDirectionPoint,l),o[17]=l.seed):R._randomPointInsideUnitCircle(K._tempDirectionPoint),V=K._tempDirectionPoint.elements,y[0]=V[0]*H,y[1]=V[1]*H):(y[0]=d*H,y[1]=j*H),y[2]=A;break;case 2:l?(l.seed=o[16],R._randomPointInsideUnitCircle(K._tempPositionPoint,l)):R._randomPointInsideUnitCircle(K._tempPositionPoint),d=G[0],j=G[1],U[0]=d*this.radius,U[1]=j*this.radius,y[U[2]=0]=d*H,y[1]=j*H,y[2]=A,yg.normalize(g,g),l?(yg.scale(g,this.length*l.getFloat(),g),o[16]=l.seed):yg.scale(g,this.length*Math.random(),g),yg.add(B,g,B),this.randomDirection&&(l?(l.seed=o[17],R._randomPointUnitSphere(g,l),o[17]=l.seed):R._randomPointUnitSphere(g));break;case 3:l?(l.seed=o[16],R._randomPointUnitCircle(K._tempPositionPoint,l)):R._randomPointUnitCircle(K._tempPositionPoint),d=G[0],j=G[1],U[0]=d*this.radius,U[1]=j*this.radius,y[U[2]=0]=d*H,y[1]=j*H,y[2]=A,yg.normalize(g,g),l?(yg.scale(g,this.length*l.getFloat(),g),o[16]=l.seed):yg.scale(g,this.length*Math.random(),g),yg.add(B,g,B),this.randomDirection&&(l?(l.seed=o[17],R._randomPointUnitSphere(g,l),o[17]=l.seed):R._randomPointUnitSphere(g));break;default:throw new Error("ConeShape:emitType is invalid.")}},B.cloneTo=function(B){l.prototype.cloneTo.call(this,B);var g=B;g.angle=this.angle,g.radius=this.radius,g.length=this.length,g.emitType=this.emitType,g.randomDirection=this.randomDirection},H(K,["_tempPositionPoint",function(){return this._tempPositionPoint=new Ug},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new Ug}])}(Y),function(l){function B(){this.radius=NaN,this.emitFromShell=!1,B.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}p(B,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",l);var g=B.prototype;g._getShapeBoundBox=function(B){var g=B.min.elements;g[0]=g[1]=g[2]=-this.radius;var l=B.max.elements;l[0]=l[1]=this.radius,l[2]=0},g._getSpeedBoundBox=function(B){var g=B.min.elements;g[0]=g[1]=-1,g[2]=0;var l=B.max.elements;l[0]=l[1]=l[2]=1},g.generatePositionAndDirection=function(B,g,l,o){var V=B.elements;l?(l.seed=o[16],this.emitFromShell?R._randomPointUnitSphere(B,l):R._randomPointInsideUnitSphere(B,l),o[16]=l.seed):this.emitFromShell?R._randomPointUnitSphere(B):R._randomPointInsideUnitSphere(B),yg.scale(B,this.radius,B);var U=V[2];U<0&&(V[2]=-1*U),this.randomDirection?l?(l.seed=o[17],R._randomPointUnitSphere(g,l),o[17]=l.seed):R._randomPointUnitSphere(g):B.cloneTo(g)},g.cloneTo=function(B){l.prototype.cloneTo.call(this,B);var g=B;g.radius=this.radius,g.emitFromShell=this.emitFromShell,g.randomDirection=this.randomDirection}}(Y),function(l){function B(){this.radius=NaN,this.emitFromShell=!1,B.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}p(B,"laya.d3.core.particleShuriKen.module.shape.SphereShape",l);var g=B.prototype;g._getShapeBoundBox=function(B){var g=B.min.elements;g[0]=g[1]=g[2]=-this.radius;var l=B.max.elements;l[0]=l[1]=l[2]=this.radius},g._getSpeedBoundBox=function(B){var g=B.min.elements;g[0]=g[1]=g[2]=-1;var l=B.max.elements;l[0]=l[1]=l[2]=1},g.generatePositionAndDirection=function(B,g,l,o){l?(l.seed=o[16],this.emitFromShell?R._randomPointUnitSphere(B,l):R._randomPointInsideUnitSphere(B,l),o[16]=l.seed):this.emitFromShell?R._randomPointUnitSphere(B):R._randomPointInsideUnitSphere(B),yg.scale(B,this.radius,B),this.randomDirection?l?(l.seed=o[17],R._randomPointUnitSphere(g,l),o[17]=l.seed):R._randomPointUnitSphere(g):B.cloneTo(g)},g.cloneTo=function(B){l.prototype.cloneTo.call(this,B);var g=B;g.radius=this.radius,g.emitFromShell=this.emitFromShell,g.randomDirection=this.randomDirection}}(Y),function(B){function g(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,g.__super.call(this)}return p(g,"laya.d3.core.render.SubMeshRenderElement",L),g}()),Xg=function(B){function F(B,g,l,o,V,U){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=B,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[pg.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[ng.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[ng.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[zg.SHADERDEFINE_ALPHATEST]="ALPHATEST";F.__super.call(this,B,g,l,null,{}),this._attributeMap=o;var y;for(y in V){var G=V[y];switch(G[1]){case 0:this._renderElementUniformMap[y]=G[0];break;case 1:this._materialUniformMap[y]=G[0];break;case 2:this._spriteUniformMap[y]=G[0];break;case 3:this._cameraUniformMap[y]=G[0];break;case 4:this._sceneUniformMap[y]=G[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}p(F,"laya.d3.shader.ShaderCompile3D",M);var g=F.prototype;return g._definesToNameDic=function(B,g){for(var l={},o=1,V=0;V<32&&!(B<(o=1<<V));V++)if(B&o){var U=g[o];U&&(l[U]="")}return l},g.withCompile=function(B,g,l,o){var V,U,y;if(U=this.sharders[B])if(y=U[g]){if(V=y[l])return V}else y=U[g]=[];else y=(U=this.sharders[B]=[])[g]=[];var G,d=this._definesToNameDic(B,F._globalInt2name),j=this._definesToNameDic(g,this._spriteInt2name),A=this._definesToNameDic(l,this._materialInt2name),H={},K="";if(d)for(G in d)K+="#define "+G+"\n",H[G]=!0;if(j)for(G in j)K+="#define "+G+"\n",H[G]=!0;if(A)for(G in A)K+="#define "+G+"\n",H[G]=!0;var p=Qg.nameKey.getName(this._name)+" compile ("+B+","+g+","+l+")",x=this._VS.toscript(H,[]),N=this._PS.toscript(H,[]);f.now();if(V=Qg.create(K+x.join("\n"),K+N.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,o,p),y[l]=V,laya.d3.shader.ShaderCompile3D.debugMode)f.now();return V},g.precompileShaderWithShaderDefine=function(B,g,l){this.withCompile(B,g,l,!0)},g.addMaterialDefines=function(B){var g=B.defines;for(var l in g){var o=g[l],V=parseInt(l);this._materialInt2name[V]=o,this._materialName2Int[o]=V}},g.addSpriteDefines=function(B){var g=B.defines;for(var l in g){var o=g[l],V=parseInt(l);this._spriteInt2name[V]=o,this._spriteName2Int[o]=V}},g.getMaterialDefineByName=function(B){return this._materialName2Int[B]},g.registerMaterialDefine=function(B){var g=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[g]=B,this._materialName2Int[B]=g},g.registerSpriteDefine=function(B){var g=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[g]=B,this._spriteName2Int[B]=g},F._globalRegDefine=function(B,g){F._globalInt2name[g]=B},F.add=function(B,g,l,o,V){return laya.d3.shader.ShaderCompile3D._preCompileShader[B]=new F(B,g,l,o,V,M.includes)},F.get=function(B){return laya.d3.shader.ShaderCompile3D._preCompileShader[Qg.nameKey.getID(B)]},F._preCompileShader={},F._globalInt2name=[],F.debugMode=!1,F.SHADERDEFINE_HIGHPRECISION=1,F.SHADERDEFINE_FOG=4,F.SHADERDEFINE_DIRECTIONLIGHT=8,F.SHADERDEFINE_POINTLIGHT=16,F.SHADERDEFINE_SPOTLIGHT=32,F.SHADERDEFINE_UV0=64,F.SHADERDEFINE_COLOR=128,F.SHADERDEFINE_UV1=256,F.SAHDERDEFINE_DEPTHFOG=131072,F}(),wg=function(B){function x(){x.__super.call(this)}p(x,"laya.d3.graphics.MeshSprite3DStaticBatchManager",oB);var g=x.prototype;return g._getStaticBatch=function(B,g,l,o){var V,U;return U=B?B.id.toString()+l.id.toString()+g.id.toString()+o.toString():l.id.toString()+g.id.toString()+o.toString(),this._staticBatches[U]?V=this._staticBatches[U]:this._staticBatches[U]=V=new ig(U,this,B,g,l),V},g._initStaticBatchs=function(B){var g,l;this._initBatchRenderElements.sort(x._sortPrepareStaticBatch);for(var o,V=!1,U=0,y=0,G=this._initBatchRenderElements.length;y<G;y++){var d,j=this._initBatchRenderElements[y],A=j.renderObj._getVertexBuffer(0);j._sprite3D;if(l===A.vertexDeclaration&&g===j._material)if(V)o._addCombineBatchRenderObjTest(j)?(d=j._staticBatch)!==o&&(d&&d._deleteCombineBatchRenderObj(j),o._addCombineBatchRenderObj(j)):(V=!1,U++);else{var H=this._initBatchRenderElements[y-1],K=H.renderObj,p=j.renderObj;V=!(65535<K._getVertexBuffer().vertexCount+p._getVertexBuffer().vertexCount)&&(o=this._getStaticBatch(B,l,g,U),(d=H._staticBatch)!==o&&(d&&d._deleteCombineBatchRenderObj(H),o._addCombineBatchRenderObj(H)),(d=j._staticBatch)!==o&&(d&&d._deleteCombineBatchRenderObj(j),o._addCombineBatchRenderObj(j)),!0)}else V=!1,U=0;g=j._material,l=A.vertexDeclaration}},x._sortPrepareStaticBatch=function(B,g){var l=B._render,o=g._render,V=l.lightmapIndex-o.lightmapIndex;if(0!=V)return V;var U=l.receiveShadow-o.receiveShadow;if(0!=U)return U;var y=B._mainSortID-g._mainSortID;return 0==y?B.renderObj.triangleCount-g.renderObj.triangleCount:y},x}(),ig=function(B){function U(B,g,l,o,V){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,U.__super.call(this,B,g,l),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=o,this._material=V}p(U,"laya.d3.graphics.SubMeshStaticBatch",VB);var g=U.prototype;return g._compareBatchRenderElement=function(B,g){return B._batchIndexStart>g._batchIndexStart},g._addCombineBatchRenderObjTest=function(B){var g=B.renderObj._vertexCount;return!(65535<(0<g?this._currentCombineVertexCount+g:this._currentCombineVertexCount+B.renderObj._getVertexBuffer().vertexCount))},g._addCombineBatchRenderObj=function(B){var g=B.renderObj,l=g._vertexCount;this._initBatchRenderElements.push(B),B._staticBatch=this,0<l?(this._currentCombineIndexCount+=g._indexCount,this._currentCombineVertexCount+=l):(this._currentCombineIndexCount=this._currentCombineIndexCount+g._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+g._getVertexBuffer().vertexCount),this._needFinishCombine=!0},g._deleteCombineBatchRenderObj=function(B){var g=B.renderObj,l=this._initBatchRenderElements.indexOf(B);if(-1!==l){this._initBatchRenderElements.splice(l,1),B._staticBatch=null;var o=g._vertexCount;0<o?(this._currentCombineIndexCount=this._currentCombineIndexCount-g._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-o):(this._currentCombineIndexCount=this._currentCombineIndexCount-g._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-g._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},g._finishInit=function(){if(this._needFinishCombine){var B=0,g=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var l=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),o=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=Yg.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=Pg.create("ushort",this._currentCombineIndexCount,35044);for(var V=0,U=this._initBatchRenderElements.length;V<U;V++){var y=this._initBatchRenderElements[V],G=y.renderObj,d=G._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,y._sprite3D),j=G.getIndices(),A=y._sprite3D.transform._isFrontFaceInvert,H=B/(this._vertexDeclaration.vertexStride/4)-G._vertexStart,K=g,p=K+j.length;y._batchIndexStart=K,y._batchIndexEnd=p,o.set(j,g);var x=0;if(A)for(x=K;x<p;x+=3){o[x]=H+o[x];var N=o[x+1],F=o[x+2];o[x+1]=H+F,o[x+2]=H+N}else for(x=K;x<p;x+=3)o[x]=H+o[x],o[x+1]=H+o[x+1],o[x+2]=H+o[x+2];g+=j.length,l.set(d,B),B+=d.length}this._vertexBuffer.setData(l),this._indexBuffer.setData(o),this._needFinishCombine=!1}},g._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new sg)},g._getRenderElement=function(B,g,l){for(var o,V,U=this._batchRenderElements.length,y=!0,G=0;G<U;G++){var d,j,A=(V=this._batchRenderElements[G])._sprite3D._render;if(0!==G&&(y=(d=(o=this._batchRenderElements[G-1])._sprite3D._render).lightmapIndex!==A.lightmapIndex||d.receiveShadow!==A.receiveShadow||o._batchIndexEnd!==V._batchIndexStart),y){(j=this._getCombineRenderElementFromPool()).renderObj=this,j._material=this._material,j._batchIndexStart=V._batchIndexStart,j._batchIndexEnd=V._batchIndexEnd;var H=A.lightmapIndex,K=H+1,p=this._batchOwnerIndices[K];p||(p=this._batchOwnerIndices[K]=[]);var x,N=p[V._render.receiveShadow?1:0];void 0===N?(p[A.receiveShadow?1:0]=this._batchOwners.length,(x=new Ig(null,"StaticBatchMeshSprite3D"))._scene=g,x._transform=this._rootOwner?this._rootOwner._transform:null,x._render.lightmapIndex=H,x._render.receiveShadow=V._render.receiveShadow,this._batchOwners.push(x)):x=this._batchOwners[N],x._render._renderUpdate(l),j._sprite3D=x,B.push(j)}else j._batchIndexEnd=V._batchIndexEnd}},g._beforeRender=function(B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},g._render=function(B){var g=B.renderElement,l=g._batchIndexStart,o=g._batchIndexEnd-l;t.mainContext.drawElements(4,o,5123,2*l),X.drawCall++,X.trianglesFaces+=o/3},g.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},g._getVertexBuffer=function(B){return void 0===B&&(B=0),this._vertexBuffer},U}(),ag=function(B){function g(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,g.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}p(g,"laya.d3.core.ComponentNode",j);var l=g.prototype;return l.addComponent=function(B){var g,l=this._componentsMap.indexOf(B);if(-1===l)g=[],this._componentsMap.push(B),this._typeComponentsIndices.push(g);else if(g=this._typeComponentsIndices[l],this._components[g[0]].isSingleton)throw new Error("无法单实例创建"+B+"组件，"+B+"组件已存在！");var o=V.getInstance(B);return g.push(this._components.length),this._components.push(o),o instanceof laya.d3.component.Script&&this._scripts.push(o),o._initialize(this),o},l._removeComponent=function(B,g){var l=this._typeComponentsIndices[B],o=l[g],V=this._components[o];this._components.splice(o,1),V instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(V),1),l.splice(g,1),0===l.length&&(this._typeComponentsIndices.splice(B,1),this._componentsMap.splice(B,1));for(var U=0,y=this._componentsMap.length;U<y;U++)for(var G=(l=this._typeComponentsIndices[U]).length-1;0<=G;G--){var d=l[G];if(!(o<d))break;l[G]=--d}V._destroy()},l.getComponentByType=function(B,g){void 0===g&&(g=0);var l=this._componentsMap.indexOf(B);return-1===l?null:this._components[this._typeComponentsIndices[l][g]]},l.getComponentsByType=function(B,g){var l=this._componentsMap.indexOf(B);if(-1!==l){var o=this._typeComponentsIndices[l],V=o.length;g.length=V;for(var U=0;U<V;U++)g[U]=this._components[o[U]]}else g.length=0},l.getComponentByIndex=function(B){return this._components[B]},l.removeComponentByType=function(B,g){void 0===g&&(g=0);var l=this._componentsMap.indexOf(B);-1!==l&&this._removeComponent(l,g)},l.removeComponentsByType=function(B){var g=this._componentsMap.indexOf(B);if(-1!==g)for(var l=this._typeComponentsIndices[g],o=0,V=l.length;o<V;l.length<V?V--:o++)this._removeComponent(g,o)},l.removeAllComponent=function(){for(var B=0,g=this._componentsMap.length;B<g;this._componentsMap.length<g?g--:B++)this.removeComponentsByType(this._componentsMap[B])},l._updateComponents=function(B){for(var g=0,l=this._components.length;g<l;g++){var o=this._components[g];!o.started&&(o._start(B),o.started=!0),o.enable&&o._update(B)}},l._lateUpdateComponents=function(B){for(var g=0;g<this._components.length;g++){var l=this._components[g];!l.started&&(l._start(B),l.started=!0),l.enable&&l._lateUpdate(B)}},l._preRenderUpdateComponents=function(B){for(var g=0;g<this._components.length;g++){var l=this._components[g];!l.started&&(l._start(B),l.started=!0),l.enable&&l._preRenderUpdate(B)}},l._postRenderUpdateComponents=function(B){for(var g=0;g<this._components.length;g++){var l=this._components[g];!l.started&&(l._start(B),l.started=!0),l.enable&&l._postRenderUpdate(B)}},g}(),zg=function(o){function B(){B.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new Kg,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new Gg(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}p(B,"laya.d3.core.material.BaseMaterial",o);var g=B.prototype;return D.imps(g,{"laya.d3.core.IClone":!0}),g._addShaderDefine=function(B){this._shaderDefineValue|=B},g._removeShaderDefine=function(B){this._shaderDefineValue&=~B},g._addDisablePublicShaderDefine=function(B){this._disablePublicShaderDefine|=B},g._removeDisablePublicShaderDefine=function(B){this._disablePublicShaderDefine&=~B},g._setBuffer=function(B,g){this._shaderValues.setValue(B,g),this._values[B]=g},g._getBuffer=function(B){return this._values[B]},g._setMatrix4x4=function(B,g){this._shaderValues.setValue(B,g?g.elements:null),this._values[B]=g},g._getMatrix4x4=function(B){return this._values[B]},g._setInt=function(B,g){this._shaderValues.setValue(B,g),this._values[B]=g},g._getInt=function(B){return this._values[B]},g._setNumber=function(B,g){this._shaderValues.setValue(B,g),this._values[B]=g},g._getNumber=function(B){return this._values[B]},g._setBool=function(B,g){this._shaderValues.setValue(B,g),this._values[B]=g},g._getBool=function(B){return this._values[B]},g._setVector2=function(B,g){this._shaderValues.setValue(B,g?g.elements:null),this._values[B]=g},g._getVector2=function(B){return this._values[B]},g._setColor=function(B,g){this._shaderValues.setValue(B,g?g.elements:null),this._values[B]=g},g._getColor=function(B){return this._values[B]},g._setTexture=function(B,g){var l=this._values[B];this._values[B]=g,this._shaderValues.setValue(B,g),0<this.referenceCount&&(l&&l._removeReference(),g&&g._addReference())},g._getTexture=function(B){return this._values[B]},g._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},g._getShader=function(B,g,l){var o=(B|g)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(o,l,this._shaderDefineValue),this._shader},g._setRenderStateBlendDepth=function(){var B=t.mainContext;switch(h.setDepthMask(B,this.depthWrite),0===this.depthTest?h.setDepthTest(B,!1):(h.setDepthTest(B,!0),h.setDepthFunc(B,this.depthTest)),this.blend){case 0:h.setBlend(B,!1);break;case 1:h.setBlend(B,!0),h.setBlendFunc(B,this.srcBlend,this.dstBlend);break;case 2:h.setBlend(B,!0)}},g._setRenderStateFrontFace=function(B,g){var l=t.mainContext,o=0;switch(this.cull){case 0:h.setCullFace(l,!1);break;case 1:h.setCullFace(l,!0),o=B?g&&g._isFrontFaceInvert?2305:2304:g&&g._isFrontFaceInvert?2304:2305,h.setFrontFace(l,o);break;case 2:h.setCullFace(l,!0),o=B?g&&g._isFrontFaceInvert?2304:2305:g&&g._isFrontFaceInvert?2305:2304,h.setFrontFace(l,o)}},g.onAsynLoaded=function(B,g,l){var o=g[0],V=g[1];switch(o.version){case"LAYAMATERIAL:01":var U=0,y=0,G=o.props;for(var d in G)switch(d){case"vectors":var j=G[d];for(U=0,y=j.length;U<y;U++){var A=j[U],H=A.value;switch(H.length){case 2:this[A.name]=new Ug(H[0],H[1]);break;case 3:this[A.name]=new yg(H[0],H[1],H[2]);break;case 4:this[A.name]=new Gg(H[0],H[1],H[2],H[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var K=G[d];for(U=0,y=K.length;U<y;U++){var p=K[U],x=p.path;x&&(this[p.name]=C.getRes(V[x]))}break;case"defines":var N=G[d];for(U=0,y=N.length;U<y;U++){var F=this._shaderCompile.getMaterialDefineByName(N[U]);this._addShaderDefine(F)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[d]=G[d];break;case"renderQueue":switch(G[d]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[d]=G[d]}break;case"LAYAMATERIAL:02":for(d in G=o.props)switch(d){case"vectors":for(U=0,y=(j=G[d]).length;U<y;U++)switch((H=(A=j[U]).value).length){case 2:this[A.name]=new Ug(H[0],H[1]);break;case 3:this[A.name]=new yg(H[0],H[1],H[2]);break;case 4:this[A.name]=new Gg(H[0],H[1],H[2],H[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(U=0,y=(K=G[d]).length;U<y;U++)(x=(p=K[U]).path)&&(this[p.name]=C.getRes(V[x]));break;case"defines":for(U=0,y=(N=G[d]).length;U<y;U++)F=this._shaderCompile.getMaterialDefineByName(N[U]),this._addShaderDefine(F);break;default:this[d]=G[d]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},g._addReference=function(){o.prototype._addReference.call(this);for(var B=0,g=this._values.length;B<g;B++){var l=this._values[B];l&&l instanceof laya.d3.resource.BaseTexture&&l._addReference()}},g._removeReference=function(){o.prototype._removeReference.call(this);for(var B=0,g=this._values.length;B<g;B++){var l=this._values[B];l&&l instanceof laya.d3.resource.BaseTexture&&l._removeReference()}},g.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},g.setShaderName=function(B){var g=Qg.nameKey.getID(B);if(-1===g)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=Xg._preCompileShader[g]},g.cloneTo=function(B){var g=B;g.name=this.name,g.cull=this.cull,g.blend=this.blend,g.srcBlend=this.srcBlend,g.dstBlend=this.dstBlend,g.srcBlendRGB=this.srcBlendRGB,g.dstBlendRGB=this.dstBlendRGB,g.srcBlendAlpha=this.srcBlendAlpha,g.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(g.blendConstColor),g.blendEquation=this.blendEquation,g.blendEquationRGB=this.blendEquationRGB,g.blendEquationAlpha=this.blendEquationAlpha,g.depthTest=this.depthTest,g.depthWrite=this.depthWrite,g.renderQueue=this.renderQueue,g._shader=this._shader,g._disablePublicShaderDefine=this._disablePublicShaderDefine,g._shaderDefineValue=this._shaderDefineValue;var l,o=0,V=g._shaderValues;g._shaderValues.data.length=this._shaderValues.data.length;var U=this._values.length,y=g._values;for(o=0,l=y.length=U;o<l;o++){var G=this._values[o];if(G)if("number"==typeof G)y[o]=G,V.data[o]=G;else if("number"==typeof G&&Math.floor(G)==G)y[o]=G,V.data[o]=G;else if("boolean"==typeof G)y[o]=G,V.data[o]=G;else if(G instanceof laya.d3.math.Vector2){var d=y[o]||(y[o]=new Ug);G.cloneTo(d),V.data[o]=d.elements}else if(G instanceof laya.d3.math.Vector3){var j=y[o]||(y[o]=new yg);G.cloneTo(j),V.data[o]=j.elements}else if(G instanceof laya.d3.math.Vector4){var A=y[o]||(y[o]=new Gg);G.cloneTo(A),V.data[o]=A.elements}else if(G instanceof laya.d3.math.Matrix4x4){var H=y[o]||(y[o]=new Bg);G.cloneTo(H),V.data[o]=H.elements}else G instanceof laya.d3.resource.BaseTexture&&(y[o]=G,V.data[o]=G)}},g.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},x(0,g,"alphaTestValue",function(){return this._getNumber(0)},function(B){this._setNumber(0,B)}),x(0,g,"alphaTest",function(){return this._alphaTest},function(B){(this._alphaTest=B)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),B.__init__=function(){B.SHADERDEFINE_ALPHATEST=B.shaderDefines.registerDefine("ALPHATEST")},B.RENDERQUEUE_OPAQUE=2e3,B.RENDERQUEUE_ALPHATEST=2450,B.RENDERQUEUE_TRANSPARENT=3e3,B.CULL_NONE=0,B.CULL_FRONT=1,B.CULL_BACK=2,B.BLEND_DISABLE=0,B.BLEND_ENABLE_ALL=1,B.BLEND_ENABLE_SEPERATE=2,B.BLENDPARAM_ZERO=0,B.BLENDPARAM_ONE=1,B.BLENDPARAM_SRC_COLOR=768,B.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,B.BLENDPARAM_DST_COLOR=774,B.BLENDPARAM_ONE_MINUS_DST_COLOR=775,B.BLENDPARAM_SRC_ALPHA=770,B.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,B.BLENDPARAM_DST_ALPHA=772,B.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,B.BLENDPARAM_SRC_ALPHA_SATURATE=776,B.BLENDEQUATION_ADD=0,B.BLENDEQUATION_SUBTRACT=1,B.BLENDEQUATION_REVERSE_SUBTRACT=2,B.DEPTHTEST_OFF=0,B.DEPTHTEST_NEVER=512,B.DEPTHTEST_LESS=513,B.DEPTHTEST_EQUAL=514,B.DEPTHTEST_LEQUAL=515,B.DEPTHTEST_GREATER=516,B.DEPTHTEST_NOTEQUAL=517,B.DEPTHTEST_GEQUAL=518,B.DEPTHTEST_ALWAYS=519,B.SHADERDEFINE_ALPHATEST=1,B.ALPHATESTVALUE=0,H(B,["shaderDefines",function(){return this.shaderDefines=new Ag}]),B}(F),tg=function(B){function g(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,g.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}p(g,"laya.d3.resource.BaseTexture",F);var l=g.prototype;return x(0,l,"width",function(){return this._width}),x(0,l,"repeat",function(){return this._repeat},function(B){if(this._repeat!==B&&(this._repeat=B,this._source)){var g=t.mainContext;h.bindTexture(g,this._type,this._source),b.isPOT(this._width,this._height)&&this._repeat?(g.texParameteri(this._type,10242,10497),g.texParameteri(this._type,10243,10497)):(g.texParameteri(this._type,10242,33071),g.texParameteri(this._type,10243,33071))}}),x(0,l,"height",function(){return this._height}),x(0,l,"magFifter",function(){return this._magFifter},function(B){(this._magFifter=B)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(B)}),x(0,l,"wrapModeV",function(){return this._wrapModeV}),x(0,l,"size",function(){return this._size}),x(0,l,"wrapModeU",function(){return this._wrapModeU}),x(0,l,"mipmap",function(){return this._mipmap},function(B){this._mipmap=B,this._mipmap!=B&&this._conchTexture&&this._conchTexture.setMipMap(B)}),x(0,l,"minFifter",function(){return this._minFifter},function(B){this._minFifter=B,this._minFifter!=B&&this._conchTexture&&this._conchTexture.setMinFifter(B)}),x(0,l,"format",function(){return this._format}),x(0,l,"source",function(){return this.activeResource(),this._source}),x(0,l,"defaulteTexture",function(){return Tg.grayTexture}),g.WARPMODE_REPEAT=0,g.WARPMODE_CLAMP=1,g}(),hg=function(B){function g(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,g.__super.call(this),this._boundingBoxCorners=o(8,null)}p(g,"laya.d3.resource.models.BaseMesh",F);var l=g.prototype;return l._getPositions=function(){throw new Error("未Override,请重载该属性！")},l._generateBoundingObject=function(){this._boundingSphere=new uB(new yg,0),uB.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new JB(new yg,new yg),JB.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},l.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},l.getRenderElement=function(B){throw new Error("未Override,请重载该属性！")},x(0,l,"subMeshCount",function(){return this._subMeshCount}),x(0,l,"boundingBox",function(){return this._boundingBox}),x(0,l,"boundingBoxCorners",function(){return this._boundingBoxCorners}),x(0,l,"boundingSphere",function(){return this._boundingSphere}),g}(),fg=(function(B){function g(){g.__super.call(this)}p(g,"laya.d3.component.Script",Mg);var l=g.prototype;l.onTriggerEnter=function(B){},l.onTriggerExit=function(B){},l.onTriggerStay=function(B){},x(0,l,"isSingleton",function(){return g._isSingleton}),g._isSingleton=!1}(),function(B){function g(B){this._owner=null,this._sharedMesh=null,g.__super.call(this),this._owner=B}p(g,"laya.d3.core.MeshFilter",B);var l=g.prototype;return l._sharedMeshLoaded=function(){this.event("loaded")},l._destroy=function(){B.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},x(0,l,"sharedMesh",function(){return this._sharedMesh},function(B){var g=this._sharedMesh;g&&g._removeReference(),(this._sharedMesh=B)._addReference(),this.event("meshchanged",[this,g,B]),B.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),x(0,l,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),x(0,l,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),x(0,l,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),x(0,l,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),g}(bg)),Sg=function(B){function g(B){g.__super.call(this,B),B.meshFilter.on("meshchanged",this,this._onMeshChanged)}p(g,"laya.d3.core.MeshRender",Dg);var l=g.prototype;return l._onMeshChanged=function(B,g,l){l.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:l.once("loaded",this,this._onMeshLoaed)},l._onMeshLoaed=function(B,g){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},l._calculateBoundingSphereByInitSphere=function(B){var g=NaN,l=this._owner.transform,o=l.scale.elements,V=Math.abs(o[0]),U=Math.abs(o[1]),y=Math.abs(o[2]);g=U<=V&&y<=V?V:y<=U?U:y,yg.transformCoordinate(B.center,l.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=B.radius*g},l._calculateBoundBoxByInitCorners=function(B){for(var g=this._owner.transform.worldMatrix,l=0;l<8;l++)yg.transformCoordinate(B[l],g,Dg._tempBoundBoxCorners[l]);JB.createfromPoints(Dg._tempBoundBoxCorners,this._boundingBox)},l._calculateBoundingSphere=function(){var B=this._owner.meshFilter.sharedMesh;null==B||null==B.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(B.boundingSphere)},l._calculateBoundingBox=function(){var B=this._owner.meshFilter.sharedMesh;null==B||null==B.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(B.boundingBoxCorners)},l._renderUpdate=function(B){var g=this._owner.transform;if(g){this._setShaderValueMatrix4x4(0,g.worldMatrix);var l=this._owner.getProjectionViewWorldMatrix(B);this._setShaderValueMatrix4x4(1,l)}else this._setShaderValueMatrix4x4(0,Bg.DEFAULT),this._setShaderValueMatrix4x4(1,B);return Cg.debugMode&&this._renderRenderableBoundBox(),!0},g}(),Eg=function(g){function o(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,o.__super.call(this),this._renderState=new k,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new Kg,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new gB,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new yg(.7,.7,.7),this.ambientColor=new yg(.212,.227,.259),t.shaderHighPrecision&&this.addShaderDefine(Xg.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}p(o,"laya.d3.core.scene.Scene",g);var B=o.prototype;return D.imps(B,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),B._setUrl=function(B){this._url=B},B._getGroup=function(){return this._group},B._setGroup=function(B){this._group=B},B._display=function(){D.stage._scenes.push(this),D.stage._scenes.sort(o._sortScenes);for(var B=0,g=this._childs.length;B<g;B++){var l=this._childs[B];l.active&&l._activeHierarchy()}},B._unDisplay=function(){var B=D.stage._scenes;B.splice(B.indexOf(this),1);for(var g=0,l=this._childs.length;g<l;g++){var o=this._childs[g];o.active&&o._inActiveHierarchy()}},B._addChild3D=function(B){B.transform._onWorldTransform(),B._setBelongScene(this),this.displayedInStage&&B.active&&B._activeHierarchy()},B._removeChild3D=function(B){B.transform.parent=null,this.displayedInStage&&B.active&&B._inActiveHierarchy(),B._setUnBelongScene()},B.initOctree=function(B,g,l,o,V){void 0===V&&(V=6),this.treeSize=new yg(B,g,l),this.treeLevel=V,this.treeRoot=new J(this,0),this.treeRoot.init(o,this.treeSize)},B._prepareUpdateToRenderState=function(B,g){g.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,g.scene=this},B._prepareSceneToRender=function(B){var g=this._lights.length;if(0<g)for(var l=0,o=0;o<g&&!(this._lights[o]._prepareToScene(B)&&++l>=this._enableLightCount);o++);},B._updateChilds=function(B){for(var g=0,l=this._childs.length;g<l;++g)this._childs[g]._update(B)},B._preRenderScene=function(B,g,l){var o,V=g._viewMatrix,U=g._projectionMatrix,y=g._projectionViewMatrix,G=0,d=g.camera;for(d.useOcclusionCulling?this.treeRoot?lB.renderObjectCullingOctree(l,this,d,V,U,y):lB.renderObjectCulling(l,this,d,V,U,y):lB.renderObjectCullingNoBoundFrustum(this,d,V,U,y),G=0,o=this._quenes.length;G<o;G++)this._quenes[G]&&this._quenes[G]._preRender(g)},B._clear=function(B,g){var l=g._viewport,o=g.camera,V=l.x,U=o.renderTargetSize.height-l.y-l.height,y=l.width,G=l.height;B.viewport(V,U,y,G);var d=256,j=o.renderTarget;switch(o.clearFlag){case 0:var A=o.clearColor;if(A){B.enable(3089),B.scissor(V,U,y,G);var H=A.elements;B.clearColor(H[0],H[1],H[2],H[3]),d|=16384}if(j)switch(A||(d=16384),j.depthStencilFormat){case 33189:d|=256;break;case 36168:d|=1024;break;case 34041:d|=256,d|=1024}B.clear(d),A&&B.disable(3089);break;case 1:case 2:if(j)switch(d=16384,j.depthStencilFormat){case 33189:d|=256;break;case 36168:d|=1024;break;case 34041:d|=256,d|=1024}B.clear(d);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},B._renderScene=function(B,g){var l,o,V=g.camera,U=0;for(U=0;U<2;U++)(o=this._quenes[U])&&(V.renderTarget?o._render(g,!0):o._render(g,!1));if(1===V.clearFlag){var y=V.sky;y&&(h.setCullFace(B,!1),h.setDepthFunc(B,515),h.setDepthMask(B,!1),y._render(g),h.setDepthFunc(B,513),h.setDepthMask(B,!0))}for(U=2,l=this._quenes.length;U<l;U++)(o=this._quenes[U])&&(o._sortAlpha(g.camera.transform.position),V.renderTarget?o._render(g,!0):o._render(g,!1))},B._set3DRenderConfig=function(B){B.disable(3042),h._blend=!1,B.blendFunc(770,771),h._sFactor=770,h._dFactor=771,B.disable(2929),h._depthTest=!1,B.enable(2884),h._cullFace=!0,B.depthMask(1),h._depthMask=!0,B.frontFace(2304),h._frontFace=2304},B._set2DRenderConfig=function(B){h.setBlend(B,!0),h.setBlendFunc(B,1,771),h.setDepthTest(B,!1),h.setCullFace(B,!1),h.setDepthMask(B,!0),h.setFrontFace(B,2305),B.viewport(0,0,A.width,A.height)},B._parseCustomProps=function(B,g,l,o){var V=o.customProps.lightmaps,U=V.length,y=this._lightmaps;y.length=U;for(var G=0;G<U;G++)y[G]=C.getRes(g[V[G].replace(".exr",".png")]);this.setlightmaps(y);var d=o.customProps.ambientColor;d&&(this.ambientColor=new yg(d[0],d[1],d[2]));var j=o.customProps.fogColor;j&&(this.fogColor=new yg(j[0],j[1],j[2]))},B._addLight=function(B){this._lights.indexOf(B)<0&&this._lights.push(B)},B._removeLight=function(B){var g=this._lights.indexOf(B);0<=g&&this._lights.splice(g,1)},B._updateScene=function(){var B=this._renderState;this._prepareUpdateToRenderState(t.mainContext,B),this._updateComponents(B),this._updateChilds(B),this._lateUpdateComponents(B),this._time+=B.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},B._updateSceneConch=function(){var B=this._renderState;this._prepareUpdateToRenderState(t.mainContext,B),this._updateComponents(B),this._lateUpdateComponents(B),this._prepareSceneToRender(B);for(var g=0,l=this._cameraPool.length;g<l;g++){var o=this._cameraPool[g];(B.camera=o)._prepareCameraToRender()}},B._preRenderShadow=function(B,g,l,o,V){this.treeRoot?lB.renderShadowObjectCullingOctree(this,g,l,o,V):lB.renderShadowObjectCulling(this,g,l,o,V);for(var U=0,y=l.length;U<y;U++)l[U]&&l[U]._preRender(B)},B._renderShadowMap=function(B,g,l){var o=this.parallelSplitShadowMaps[0];o._calcAllLightCameraInfo(l);var V,U,y,G=o.PSSMNum;if(this._preRenderShadow(g,o._lightCulling,o._shadowQuenes,o._lightVPMatrix[0],G),this.addShaderDefine(pg.SHADERDEFINE_CAST_SHADOW),1<G)for(var d=0;d<G;d++)V=o.getRenderTarget(d+1),o.beginRenderTarget(d+1),B.clearColor(1,1,1,1),B.clear(16640),B.viewport(0,0,V.width,V.height),g.camera=y=o.getLightCamera(d),y._prepareCameraToRender(),y._prepareCameraViewProject(y.viewMatrix,y.projectionMatrix),g._projectionViewMatrix=o._lightVPMatrix[d+1],(U=o._shadowQuenes[d])._preRender(g),U._renderShadow(g,!1),o.endRenderTarget(d+1);else V=o.getRenderTarget(1),o.beginRenderTarget(1),B.clearColor(1,1,1,1),B.clear(16640),B.viewport(0,0,V.width,V.height),g.camera=y=o.getLightCamera(0),y._prepareCameraToRender(),y._prepareCameraViewProject(y.viewMatrix,y.projectionMatrix),g._projectionViewMatrix=o._lightVPMatrix[0],(U=o._shadowQuenes[0])._preRender(g),U._renderShadow(g,!0),o.endRenderTarget(1);this.removeShaderDefine(pg.SHADERDEFINE_CAST_SHADOW)},B.addTreeNode=function(B){this.treeRoot.addTreeNode(B)},B.removeTreeNode=function(B){this.treeSize&&B._treeNode&&B._treeNode.removeObject(B)},B.setlightmaps=function(B){this._lightmaps=B;for(var g=0,l=this._renderableSprite3Ds.length;g<l;g++)this._renderableSprite3Ds[g]._render._applyLightMapParams()},B.getlightmaps=function(){return this._lightmaps},B.addChildAt=function(B,g){if(!(B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(B&&B.__className));if(!B||this.destroyed||B===this)return B;if(B.zOrder&&this._set$P("hasZorder",!0),0<=g&&g<=this._childs.length){if(B._parent===this){var l=this.getChildIndex(B);this._childs.splice(l,1),this._childs.splice(g,0,B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,g)),this._childChanged()}else B.parent&&B.parent.removeChild(B),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(g,0,B),this.conchModel&&this.conchModel.addChildAt(B.conchModel,g),(B.parent=this)._addChild3D(B);return B}throw new Error("appendChildAt:The index is out of bounds")},B.addChild=function(B){if(!(B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!B||this.destroyed||B===this)return B;if(B.zOrder&&this._set$P("hasZorder",!0),B._parent===this){var g=this.getChildIndex(B);g!==this._childs.length-1&&(this._childs.splice(g,1),this._childs.push(B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,this._childs.length-1)),this._childChanged())}else B.parent&&B.parent.removeChild(B),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(B),this.conchModel&&this.conchModel.addChildAt(B.conchModel,this._childs.length-1),(B.parent=this)._childChanged(),this._addChild3D(B);return B},B.removeChildAt=function(B){var g=this.getChildAt(B);return g&&(this._removeChild3D(g),this._childs.splice(B,1),this.conchModel&&this.conchModel.removeChild(g.conchModel),g.parent=null),g},B.removeChildren=function(B,g){if(void 0===B&&(B=0),void 0===g&&(g=2147483647),this._childs&&0<this._childs.length){var l=this._childs;if(0===B&&U<=g){var o=l;this._childs=j.ARRAY_EMPTY}else o=l.splice(B,g-B);for(var V=0,U=o.length;V<U;V++)this._removeChild3D(o[V]),o[V].parent=null,this.conchModel&&this.conchModel.removeChild(o[V].conchModel)}return this},B.addFrustumCullingObject=function(B){this.treeRoot?this.addTreeNode(B):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(B):this._cullingRenders[this._cullingRendersLength]=B,B._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},B.removeFrustumCullingObject=function(B){if(this.treeRoot)this.removeTreeNode(B);else{this._cullingRendersLength--;var g=B._indexInSceneFrustumCullingObjects;if(g!==this._cullingRendersLength){var l=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[g]=l)._indexInSceneFrustumCullingObjects=g,B._indexInSceneFrustumCullingObjects=-1}}},B.getRenderQueue=function(B){return B<3e3?this._quenes[1]||(this._quenes[1]=new I(this)):this._quenes[2]||(this._quenes[2]=new I(this))},B.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new I(this)},B.addShaderDefine=function(B){this._shaderDefineValue|=B},B.removeShaderDefine=function(B){this._shaderDefineValue&=~B},B.addScript=function(B){return this._addComponent(B)},B.getScriptByType=function(B,g){return void 0===g&&(g=0),this._getComponentByType(B,g)},B.getScriptsByType=function(B,g){this._getComponentsByType(B,g)},B.getScriptByIndex=function(B){return this._getComponentByIndex(B)},B.removeScriptByType=function(B,g){void 0===g&&(g=0),this._removeComponentByType(B,g)},B.removeScriptsByType=function(B){this._removeComponentByType(B)},B.removeAllScript=function(){this._removeAllComponent()},B.render=function(B,g,l){(N._context.ctx._renderKey=0)<this._childs.length&&B.addRenderObject(this)},B.renderSubmit=function(){var B=t.mainContext,g=this._renderState;this._set3DRenderConfig(B),this._prepareSceneToRender(this._renderState);var l,o=0,V=0;if(Cg.debugMode||J.debugMode)for(o=0,V=this._cameraPool.length;o<V;o++)l=this._cameraPool[o],Cg._debugPhasorSprite.begin(1,l),l.activeInHierarchy&&l._renderCamera(B,g,this),Cg._debugPhasorSprite.end();else for(o=0,V=this._cameraPool.length;o<V;o++)(l=this._cameraPool[o]).activeInHierarchy&&l._renderCamera(B,g,this);return this._set2DRenderConfig(B),1},B.onAsynLoaded=function(B,g,l){var o=g[0];if("Scene"!==o.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var V=g[1];Fg._createNodeByJson(this,o,this,V),this.event("hierarchyloaded",[this]),this.__loaded=!0},B.destroy=function(B){void 0===B&&(B=!0),this.destroyed||(g.prototype.destroy.call(this,B),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,C.clearRes(this.url),this.loaded||Cg._cancelLoadByUrl(this.url))},B.getRenderType=function(){return 0},B.releaseRender=function(){},B._addComponent=function(B){var g,l=this._componentsMap.indexOf(B);if(-1===l)g=[],this._componentsMap.push(B),this._typeComponentsIndices.push(g);else if(g=this._typeComponentsIndices[l],this._components[g[0]].isSingleton)throw new Error("无法单实例创建"+B+"组件，"+B+"组件已存在！");var o=V.getInstance(B);g.push(this._components.length),this._components.push(o);return o._initialize(this),o},B._removeComponent=function(B,g){var l=this._typeComponentsIndices[B],o=l[g],V=this._components[o];this._components.splice(o,1),l.splice(g,1),0===l.length&&(this._typeComponentsIndices.splice(B,1),this._componentsMap.splice(B,1));for(var U=0,y=this._componentsMap.length;U<y;U++)for(var G=(l=this._typeComponentsIndices[U]).length-1;0<=G;G--){var d=l[G];if(!(o<d))break;l[G]=--d}V._destroy()},B._getComponentByType=function(B,g){void 0===g&&(g=0);var l=this._componentsMap.indexOf(B);return-1===l?null:this._components[this._typeComponentsIndices[l][g]]},B._getComponentsByType=function(B,g){var l=this._componentsMap.indexOf(B);if(-1!==l){var o=this._typeComponentsIndices[l],V=o.length;g.length=V;for(var U=0;U<V;U++)g[U]=this._components[o[U]]}else g.length=0},B._getComponentByIndex=function(B){return this._components[B]},B._removeComponentByType=function(B,g){void 0===g&&(g=0);var l=this._componentsMap.indexOf(B);-1!==l&&this._removeComponent(l,g)},B._removeComponentsByType=function(B){var g=this._componentsMap.indexOf(B);if(-1!==g)for(var l=this._typeComponentsIndices[g],o=0,V=l.length;o<V;l.length<V?V--:o++)this._removeComponent(g,o)},B._removeAllComponent=function(){for(var B=0,g=this._componentsMap.length;B<g;this._componentsMap.length<g?g--:B++)this._removeComponentsByType(this._componentsMap[B])},B._updateComponents=function(B){for(var g=0,l=this._components.length;g<l;g++){var o=this._components[g];!o.started&&(o._start(B),o.started=!0),o.enable&&o._update(B)}},B._lateUpdateComponents=function(B){for(var g=0;g<this._components.length;g++){var l=this._components[g];!l.started&&(l._start(B),l.started=!0),l.enable&&l._lateUpdate(B)}},B._preRenderUpdateComponents=function(B){for(var g=0;g<this._components.length;g++){var l=this._components[g];!l.started&&(l._start(B),l.started=!0),l.enable&&l._preRenderUpdate(B)}},B._postRenderUpdateComponents=function(B){for(var g=0;g<this._components.length;g++){var l=this._components[g];!l.started&&(l._start(B),l.started=!0),l.enable&&l._postRenderUpdate(B)}},x(0,B,"_loaded",null,function(B){this.__loaded=B}),x(0,B,"fogColor",function(){return this._fogColor},function(B){this._fogColor=B,this._shaderValues.setValue(0,B.elements)}),x(0,B,"enableFog",function(){return this._enableFog},function(B){this._enableFog!==B&&((this._enableFog=B)?(this.addShaderDefine(Xg.SHADERDEFINE_FOG),this.removeShaderDefine(Xg.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(Xg.SHADERDEFINE_FOG))}),x(0,B,"url",function(){return this._url}),x(0,B,"loaded",function(){return this.__loaded}),x(0,B,"enableDepthFog",function(){return this._enableDepthFog},function(B){this._enableDepthFog!=B&&((this._enableDepthFog=B)?(this.addShaderDefine(Xg.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(Xg.SHADERDEFINE_FOG)):this.removeShaderDefine(Xg.SAHDERDEFINE_DEPTHFOG))}),x(0,B,"fogStart",function(){return this._fogStart},function(B){this._fogStart=B,this._shaderValues.setValue(1,B)}),x(0,B,"fogRange",function(){return this._fogRange},function(B){this._fogRange=B,this._shaderValues.setValue(2,B)}),x(0,B,"ambientColor",function(){return this._ambientColor},function(B){this._ambientColor=B,this._shaderValues.setValue(21,B.elements)}),x(0,B,"scene",function(){return this}),x(0,B,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),o._sortScenes=function(B,g){if(B.parent!==D.stage||g.parent!==D.stage)return B.parent!==D.stage&&g.parent!==D.stage?o._sortScenes(B.parent,g.parent):B.parent===D.stage?-1:1;var l=D.stage._childs;return l.indexOf(B)-l.indexOf(g)},o.load=function(B){return D.loader.create(B,null,null,o)},o.FOGCOLOR=0,o.FOGSTART=1,o.FOGRANGE=2,o.LIGHTDIRECTION=3,o.LIGHTDIRCOLOR=4,o.POINTLIGHTPOS=5,o.POINTLIGHTRANGE=6,o.POINTLIGHTATTENUATION=7,o.POINTLIGHTCOLOR=8,o.SPOTLIGHTPOS=9,o.SPOTLIGHTDIRECTION=10,o.SPOTLIGHTSPOT=11,o.SPOTLIGHTRANGE=12,o.SPOTLIGHTATTENUATION=13,o.SPOTLIGHTCOLOR=14,o.SHADOWDISTANCE=15,o.SHADOWLIGHTVIEWPROJECT=16,o.SHADOWMAPPCFOFFSET=17,o.SHADOWMAPTEXTURE1=18,o.SHADOWMAPTEXTURE2=19,o.SHADOWMAPTEXTURE3=20,o.AMBIENTCOLOR=21,o.TIME=22,o}(s),eg=function(B){function g(B){g.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new Bg,this._shaderValues=new Kg,this._colliders=[],this._id=++g._uniqueIDCounter,this._transform=new vg(this),this.name=B||"Sprite3D-"+g._nameNumberCounter++,this.layer=S.currentCreationLayer,this.active=!0}p(g,"laya.d3.core.Sprite3D",ag);var l=g.prototype;return D.imps(l,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),l._setUrl=function(B){this._url=B},l._getGroup=function(){return this._group},l._setGroup=function(B){this._group=B},l._addChild3D=function(B){B.transform.parent=this.transform,this._hierarchyAnimator&&(!B._hierarchyAnimator&&B._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(B,!0,[B.name])),this._scene&&(B._setBelongScene(this._scene),this._activeInHierarchy&&B._active&&B._activeHierarchy())},l._removeChild3D=function(B){B.transform.parent=null,this._scene&&(this._activeInHierarchy&&B._active&&B._inActiveHierarchy(),B._setUnBelongScene()),this._hierarchyAnimator&&(B._hierarchyAnimator==this._hierarchyAnimator&&B._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(B,!1,[B.name]))},l._parseBaseCustomProps=function(B){var g=this.transform.localPosition;B.translate?(g.fromArray(B.translate),g.x*=100,g.y*=100,g.z*=100):g.elements.fill(0),this.transform.localPosition=g;var l=this.transform.localRotation;B.rotation?l.fromArray(B.rotation):l.fromArray([0,0,0,-1]),this.transform.localRotation=l;var o=this.transform.localScale;B.scale?o.fromArray(B.scale):o.elements.fill(1),this.transform.localScale=o;var V=B.layer;null!=V&&(this.layer=S.getLayerByNumber(V))},l._parseCustomComponent=function(B,g,l){for(var o in l){var V=l[o];switch(o){case"Animator":var U=this.addComponent(Animator);if(V.avatarPath)U.avatar=C.getRes(g[V.avatarPath]);else{var y=V.avatar;if(y){U.avatar=C.getRes(g[y.path]);var G=y.linkSprites;G&&B.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[U,G])}}for(var d=V.clipPaths,j=d.length,A=0;A<j;A++)U.addClip(C.getRes(g[d[A]]));U.clip=C.getRes(g[d[0]]);var H=V.playOnWake;void 0!==H&&(U.playOnWake=H);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var K=this.addComponent(SphereCollider);K.isTrigger=V.isTrigger;var p=K.center;p.fromArray(V.center),K.center=p,K.radius=V.radius;break;case"BoxCollider":var x=this.addComponent(BoxCollider);x.isTrigger=V.isTrigger,x.center.fromArray(V.center);var N=x.size;N.fromArray(V.size),x.size=N;break;case"MeshCollider":this.addComponent(MeshCollider)}}},l._onRootNodeHierarchyLoaded=function(B,g){for(var l in g){for(var o=this,V=g[l],U=0,y=V.length;U<y;U++){var G=V[U];if(""===G)break;if(!(o=o.getChildByName(G)))break}o&&B.linkSprite3DToAvatarNode(l,o)}},l._setHierarchyAnimator=function(B,g){this._changeHierarchyAnimator(B);for(var l=0,o=this._childs.length;l<o;l++){var V=this._childs[l];V._hierarchyAnimator==g&&V._setHierarchyAnimator(B,g)}},l._clearHierarchyAnimator=function(B,g){this._changeHierarchyAnimator(g);for(var l=0,o=this._childs.length;l<o;l++){var V=this._childs[l];V._hierarchyAnimator==B&&V._clearHierarchyAnimator(B,g)}},l._getAnimatorToLinkSprite3D=function(B,g,l){var o=this.getComponentByType(Animator);if(o&&(o.avatar?o.avatar._version||B._setAnimatorToLinkAvatar(o,g):B._setAnimatorToLinkSprite3DNoAvatar(o,g,l)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){l.unshift(this._parent.name);var V=this._parent;V._hierarchyAnimator&&V._getAnimatorToLinkSprite3D(B,g,l)}},l._setAnimatorToLinkSprite3DNoAvatar=function(B,g,l){var o=0,V=0;for(o=0,V=B.getClipCount();o<V;o++)B._handleSpriteOwnersBySprite(o,g,l,this);for(o=0,V=this._childs.length;o<V;o++){var U=this._childs[o],y=l.length;l.push(U.name),U._setAnimatorToLinkSprite3DNoAvatar(B,g,l),l.splice(y,1)}},l._changeHierarchyAnimator=function(B){this._hierarchyAnimator=B},l._isLinkSpriteToAnimationNode=function(B,g,l){var o=B._avatarNodes.indexOf(g),V=B._cacheSpriteToNodesMap;if(l)this._transform.dummy=g.transform,B._cacheNodesToSpriteMap[o]=V.length,V.push(o);else{this._transform.dummy=null;var U=B._cacheNodesToSpriteMap[o];B._cacheNodesToSpriteMap[o]=null,V.splice(U,1)}},l._setBelongScene=function(B){this._scene=B;for(var g=0,l=this._childs.length;g<l;g++)this._childs[g]._setBelongScene(B)},l._setUnBelongScene=function(){this._scene=null;for(var B=0,g=this._childs.length;B<g;B++)this._childs[B]._setUnBelongScene()},l._activeHierarchy=function(){var B=0,g=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),B=0,g=this._colliders.length;B<g;B++)this._layer._addCollider(this._colliders[B]);for(this.event("activeinhierarchychanged",!0),B=0,g=this._childs.length;B<g;B++){var l=this._childs[B];l._active&&l._activeHierarchy()}},l._inActiveHierarchy=function(){var B=0,g=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),B=0,g=this._colliders.length;B<g;B++){var l=this._colliders[B];l._clearCollsionMap(),this._layer._removeCollider(l)}for(this.event("activeinhierarchychanged",!1),B=0,g=this._childs.length;B<g;B++){var o=this._childs[B];o._active&&o._inActiveHierarchy()}},l.addComponent=function(B){var g,l=this._componentsMap.indexOf(B);if(-1===l)g=[],this._componentsMap.push(B),this._typeComponentsIndices.push(g);else if(g=this._typeComponentsIndices[l],this._components[g[0]].isSingleton)throw new Error("无法单实例创建"+B+"组件，"+B+"组件已存在！");var o=V.getInstance(B);return g.push(this._components.length),this._components.push(o),o instanceof laya.d3.component.Script&&this._scripts.push(o),o._initialize(this),o},l._removeComponent=function(B,g){var l,o=0,V=this._typeComponentsIndices[B],U=V[g],y=this._components[U];for(y instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(y),1),V.splice(g,1),0===V.length&&(this._typeComponentsIndices.splice(B,1),this._componentsMap.splice(B,1)),o=0,l=this._componentsMap.length;o<l;o++)for(var G=(V=this._typeComponentsIndices[o]).length-1;0<=G;G--){var d=V[G];if(!(U<d))break;V[G]=--d}y._destroy()},l._clearSelfRenderObjects=function(){},l._addSelfRenderObjects=function(){},l._parseCustomProps=function(B,g,l,o){},l._updateChilds=function(B){var g=this._childs.length;if(0!==g)for(var l=0;l<g;++l)this._childs[l]._update(B)},l._getSortID=function(B,g){return 1e3*g.id+B._getVertexBuffer().vertexDeclaration.id},l._update=function(B){(B.owner=this)._activeInHierarchy&&(this._updateComponents(B),this._lateUpdateComponents(B),X.spriteCount++,this._childs.length&&this._updateChilds(B))},l.getProjectionViewWorldMatrix=function(B){return Bg.multiply(B,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},l.loadHierarchy=function(B){this.addChild(laya.d3.core.Sprite3D.load(B))},l.addChildAt=function(B,g){if(!(B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!B||this.destroyed||B===this)return B;if(B.zOrder&&this._set$P("hasZorder",!0),0<=g&&g<=this._childs.length){if(B._parent===this){var l=this.getChildIndex(B);this._childs.splice(l,1),this._childs.splice(g,0,B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,g)),this._childChanged()}else B.parent&&B.parent.removeChild(B),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(g,0,B),this.conchModel&&this.conchModel.addChildAt(B.conchModel,g),(B.parent=this)._addChild3D(B);return B}throw new Error("appendChildAt:The index is out of bounds")},l.addChild=function(B){if(!(B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!B||this.destroyed||B===this)return B;if(B.zOrder&&this._set$P("hasZorder",!0),B._parent===this){var g=this.getChildIndex(B);g!==this._childs.length-1&&(this._childs.splice(g,1),this._childs.push(B),this.conchModel&&(this.conchModel.removeChild(B.conchModel),this.conchModel.addChildAt(B.conchModel,this._childs.length-1)),this._childChanged())}else B.parent&&B.parent.removeChild(B),this._childs===j.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(B),this.conchModel&&this.conchModel.addChildAt(B.conchModel,this._childs.length-1),(B.parent=this)._childChanged(),this._addChild3D(B);return B},l.removeChildAt=function(B){var g=this.getChildAt(B);return g&&(this._removeChild3D(g),this._childs.splice(B,1),this.conchModel&&this.conchModel.removeChild(g.conchModel),g.parent=null),g},l.removeChildren=function(B,g){if(void 0===B&&(B=0),void 0===g&&(g=2147483647),this._childs&&0<this._childs.length){var l=this._childs;if(0===B&&U<=g){var o=l;this._childs=j.ARRAY_EMPTY}else o=l.splice(B,g-B);for(var V=0,U=o.length;V<U;V++)this._removeChild3D(o[V]),o[V].parent=null,this.conchModel&&this.conchModel.removeChild(o[V].conchModel)}return this},l.onAsynLoaded=function(B,g,l){var o=g[0];if("Sprite3D"!==o.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var V=g[1];Fg._createNodeByJson(this,o,this,V),this.event("hierarchyloaded",[this]),this.__loaded=!0},l.cloneTo=function(B){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var g=B;g.name=this.name,g._destroyed=this._destroyed,g.timer=this.timer,g._$P=this._$P,g.active=this._active;var l=g.transform.localPosition;this.transform.localPosition.cloneTo(l),g.transform.localPosition=l;var o=g.transform.localRotation;this.transform.localRotation.cloneTo(o),g.transform.localRotation=o;var V=g.transform.localScale;this.transform.localScale.cloneTo(V),g.transform.localScale=V,g.isStatic=this.isStatic;var U=0,y=0;for(U=0,y=this._componentsMap.length;U<y;U++){var G=g.addComponent(this._componentsMap[U]);this._components[U]._cloneTo(G)}for(U=0,y=this._childs.length;U<y;U++)g.addChild(this._childs[U].clone());var d=g.getComponentByType(Animator);if(d){var j=d._linkSpritesData;if(j)for(var A in j){for(var H=j[A],K=g,p=0,x=H.length;p<x&&(K=K.getChildByName(H[p]));p++);if(K){var N=d._avatarNodeMap[A];K._isLinkSpriteToAnimationNode(d,N,!0)}}}},l.clone=function(){var B=new this.constructor;return this.cloneTo(B),B},l.destroy=function(B){if(void 0===B&&(B=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,B);var g,l=0;for(l=0,g=this._components.length;l<g;l++)this._components[l]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,C.clearRes(this.url),this.loaded||Cg._cancelLoadByUrl(this.url)}},l._handleSpriteToAvatar=function(B,g){B._avatarNodes;var l=B._avatarNodeMap[this.name];l&&l.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(B,l,g)},l._setAnimatorToLinkAvatar=function(B,g){this._handleSpriteToAvatar(B,g);for(var l=0,o=this._childs.length;l<o;l++){this._childs[l]._setAnimatorToLinkAvatar(B,g)}},x(0,l,"activeInHierarchy",function(){return this._activeInHierarchy}),x(0,l,"_loaded",null,function(B){this.__loaded=B}),x(0,l,"active",function(){return this._active},function(B){this._active!==B&&(this._active=B,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(B?this._activeHierarchy():this._inActiveHierarchy()))}),x(0,l,"componentsCount",function(){return this._components.length}),x(0,l,"loaded",function(){return this.__loaded}),x(0,l,"id",function(){return this._id}),x(0,l,"url",function(){return this._url}),x(0,l,"layer",function(){return this._layer},function(B){if(this._layer!==B){if(!B)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var g=0,l=this._colliders.length;if(this._layer)for(g=0;g<l;g++)this._layer._removeCollider(this._colliders[g]);for(g=0;g<l;g++)B._addCollider(this._colliders[g])}this._layer=B,this.event("layerchanged",B)}}),x(0,l,"scene",function(){return this._scene}),x(0,l,"transform",function(){return this._transform}),g.instantiate=function(B,g,l,o,V){void 0===l&&(l=!0);var U=B.clone();g&&g.addChild(U);var y=U.transform;if(l){var G=y.worldMatrix;B.transform.worldMatrix.cloneTo(G),y.worldMatrix=G}else o&&(y.position=o),V&&(y.rotation=V);return U},g.load=function(B){return D.loader.create(B,null,null,g)},g.WORLDMATRIX=0,g.MVPMATRIX=1,g._uniqueIDCounter=0,g._nameNumberCounter=0,g}(),Qg=function(B){function A(B,g,l,o,V,U,y,G,d,j){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],A.__super.call(this),!B||!g)throw"Shader Error";this._id=++A._count,this._vs=B,this._ps=g,this._attributeMap=l,this._sceneUniformMap=o,this._cameraUniformMap=V,this._spriteUniformMap=U,this._materialUniformMap=y,this._renderElementUniformMap=G,this._precompile=d,this._define=j,this._precompile&&A.extCompileObj&&A.extCompileFunc?A.extCompileFunc.call(A.extCompileObj,B,g,j):this.recreateResource()}p(A,"laya.d3.shader.Shader3D",l);var g=A.prototype;return g.recreateResource=function(){f.now();this._compile(),this.completeCreate(),this.memorySize=0},g.disposeResource=function(){t.mainContext.deleteShader(this._vshader),t.mainContext.deleteShader(this._pshader),t.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},g._compile=function(){if(!t.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var B=[this._vs,this._ps],g=t.mainContext;if(this._program=g.createProgram(),this._vshader=A._createShader(g,B[0],35633),this._pshader=A._createShader(g,B[1],35632),g.attachShader(this._program,this._vshader),g.attachShader(this._program,this._pshader),g.linkProgram(this._program),!N.isConchApp&&Xg.debugMode&&!g.getProgramParameter(this._program,35714))throw g.getProgramInfoLog(this._program);var l,o=0,V=0,U=0;for(U=N.isConchApp?g.getProgramParameterEx(this._vs,this._ps,"",35721):g.getProgramParameter(this._program,35721),o=0;o<U;o++){var y=null;l={vartype:"attribute",ivartype:0,attrib:y=N.isConchApp?g.getActiveAttribEx(this._vs,this._ps,"",o):g.getActiveAttrib(this._program,o),location:g.getAttribLocation(this._program,y.name),name:y.name,type:y.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(l)}var G=0;for(G=N.isConchApp?g.getProgramParameterEx(this._vs,this._ps,"",35718):g.getProgramParameter(this._program,35718),o=0;o<G;o++){var d=null;d=N.isConchApp?g.getActiveUniformEx(this._vs,this._ps,"",o):g.getActiveUniform(this._program,o),0<(l={vartype:"uniform",ivartype:1,attrib:y,location:g.getUniformLocation(this._program,d.name),name:d.name,type:d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(l.name=l.name.substr(0,l.name.length-3),l.isArray=!0,l.location=g.getUniformLocation(this._program,l.name)),this._uniformParams.push(l)}for(o=0,V=this._attributeParams.length;o<V;o++)(l=this._attributeParams[o]).indexOfParams=o,l.index=1,l.value=[l.location,null],l.codename=l.name,l.name=null!=this._attributeMap[l.codename]?this._attributeMap[l.codename]:l.codename,this._attributeParamsMap.push(l.name),this._attributeParamsMap.push(l),l._this=this,l.uploadedValue=[],l.fun=this._attribute;for(o=0,V=this._uniformParams.length;o<V;o++)switch((l=this._uniformParams[o]).indexOfParams=o,l.index=1,l.value=[l.location,null],l.codename=l.name,null!=this._sceneUniformMap[l.codename]?(l.name=this._sceneUniformMap[l.codename],this._sceneUniformParamsMap.push(l.name),this._sceneUniformParamsMap.push(l)):null!=this._cameraUniformMap[l.codename]?(l.name=this._cameraUniformMap[l.codename],this._cameraUniformParamsMap.push(l.name),this._cameraUniformParamsMap.push(l)):null!=this._spriteUniformMap[l.codename]?(l.name=this._spriteUniformMap[l.codename],this._spriteUniformParamsMap.push(l.name),this._spriteUniformParamsMap.push(l)):null!=this._materialUniformMap[l.codename]?(l.name=this._materialUniformMap[l.codename],this._materialUniformParamsMap.push(l.name),this._materialUniformParamsMap.push(l)):null!=this._renderElementUniformMap[l.codename]?(l.name=this._renderElementUniformMap[l.codename],this._renderElementUniformParamsMap.push(l.name),this._renderElementUniformParamsMap.push(l)):console.log("Shader:can't find uinform name:"+l.codename+" in shader file."),l._this=this,l.uploadedValue=[],l.type){case 5124:l.fun=l.isArray?this._uniform1iv:this._uniform1i;break;case 5126:l.fun=l.isArray?this._uniform1fv:this._uniform1f;break;case 35664:l.fun=l.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:l.fun=l.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:l.fun=l.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:l.fun=this._uniform_sampler2D;break;case 35680:l.fun=this._uniform_samplerCube;break;case 35676:l.fun=this._uniformMatrix4fv;break;case 35670:l.fun=this._uniform1i;break;case 35674:l.fun=this._uinformMatrix2fv;break;case 35675:l.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},g._attribute=function(B,g){var l=t.mainContext,o=G._enableAtributes,V=B.location;return o[V]||l.enableVertexAttribArray(V),l.vertexAttribPointer(V,g[0],g[1],g[2],g[3],g[4]),o[V]=G._bindVertexBuffer,1},g._uniform1f=function(B,g){var l=B.uploadedValue;return l[0]!==g?(t.mainContext.uniform1f(B.location,l[0]=g),1):0},g._uniform1fv=function(B,g){if(g.length<4){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(t.mainContext.uniform1fv(B.location,g),l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],1):0}return t.mainContext.uniform1fv(B.location,g),1},g._uniform_vec2=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]?(t.mainContext.uniform2f(B.location,l[0]=g[0],l[1]=g[1]),1):0},g._uniform_vec2v=function(B,g){if(g.length<2){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(t.mainContext.uniform2fv(B.location,g),l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],1):0}return t.mainContext.uniform2fv(B.location,g),1},g._uniform_vec3=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]?(t.mainContext.uniform3f(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2]),1):0},g._uniform_vec3v=function(B,g){return t.mainContext.uniform3fv(B.location,g),1},g._uniform_vec4=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(t.mainContext.uniform4f(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3]),1):0},g._uniform_vec4v=function(B,g){return t.mainContext.uniform4fv(B.location,g),1},g._uniformMatrix2fv=function(B,g){return t.mainContext.uniformMatrix2fv(B.location,!1,g),1},g._uniformMatrix3fv=function(B,g){return t.mainContext.uniformMatrix3fv(B.location,!1,g),1},g._uniformMatrix4fv=function(B,g){return t.mainContext.uniformMatrix4fv(B.location,!1,g),1},g._uinformMatrix2fv=function(B,g){return t.mainContext.uniformMatrix2fv(B.location,!1,g),1},g._uinformMatrix3fv=function(B,g){return t.mainContext.uniformMatrix3fv(B.location,!1,g),1},g._uniform1i=function(B,g){var l=B.uploadedValue;return l[0]!==g?(t.mainContext.uniform1i(B.location,l[0]=g),1):0},g._uniform1iv=function(B,g){return t.mainContext.uniform1iv(B.location,g),1},g._uniform_ivec2=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]?(t.mainContext.uniform2i(B.location,l[0]=g[0],l[1]=g[1]),1):0},g._uniform_ivec2v=function(B,g){return t.mainContext.uniform2iv(B.location,g),1},g._uniform_vec3i=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]?(t.mainContext.uniform3i(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2]),1):0},g._uniform_vec3vi=function(B,g){return t.mainContext.uniform3iv(B.location,g),1},g._uniform_vec4i=function(B,g){var l=B.uploadedValue;return l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]?(t.mainContext.uniform4i(B.location,l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3]),1):0},g._uniform_vec4vi=function(B,g){return t.mainContext.uniform4iv(B.location,g),1},g._uniform_sampler2D=function(B,g){var l=g.source||g.defaulteTexture.source,o=t.mainContext,V=B.uploadedValue;if(null!=V[0])return o.activeTexture(A._TEXTURES[V[0]]),l&&h.bindTexture(o,3553,l),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return V[0]=this._curActTexIndex,o.uniform1i(B.location,this._curActTexIndex),o.activeTexture(A._TEXTURES[this._curActTexIndex]),l&&h.bindTexture(o,3553,l),this._curActTexIndex++,1},g._uniform_samplerCube=function(B,g){var l=g.source||g.defaulteTexture.source,o=t.mainContext,V=B.uploadedValue;if(null!=V[0])return o.activeTexture(A._TEXTURES[V[0]]),l?h.bindTexture(o,34067,l):h.bindTexture(o,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return V[0]=this._curActTexIndex,o.uniform1i(B.location,this._curActTexIndex),o.activeTexture(A._TEXTURES[this._curActTexIndex]),l?h.bindTexture(o,34067,l):h.bindTexture(o,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},g._noSetValue=function(B){console.log("no....:"+B.name)},g.bind=function(){return l.activeShader=this,(l.bindShader=this).activeResource(),h.UseProgram(this._program)},g.uploadAttributes=function(B,g){for(var l,o,V=0,U=0,y=this._attributeParamsMap.length;U<y;U+=2)o=this._attributeParamsMap[U+1],null!=(l=B[this._attributeParamsMap[U]])&&(g&&g[o.name]&&g[o.name].bind(),V+=o.fun.call(this,o,l));X.shaderCall+=V},g.uploadAttributesX=function(B,g){for(var l,o,V=0,U=0,y=this._attributeParamsMap.length;U<y;U+=2)o=this._attributeParamsMap[U+1],null!=(l=B[this._attributeParamsMap[U]])&&(g._bind(),V+=o.fun.call(this,o,l));X.shaderCall+=V},g.uploadSceneUniforms=function(B){for(var g,l,o=0,V=0,U=this._sceneUniformParamsMap.length;V<U;V+=2)l=this._sceneUniformParamsMap[V+1],null!=(g=B[this._sceneUniformParamsMap[V]])&&(o+=l.fun.call(this,l,g));X.shaderCall+=o},g.uploadCameraUniforms=function(B){for(var g,l,o=0,V=0,U=this._cameraUniformParamsMap.length;V<U;V+=2)l=this._cameraUniformParamsMap[V+1],null!=(g=B[this._cameraUniformParamsMap[V]])&&(o+=l.fun.call(this,l,g));X.shaderCall+=o},g.uploadSpriteUniforms=function(B){for(var g,l,o=0,V=0,U=this._spriteUniformParamsMap.length;V<U;V+=2)l=this._spriteUniformParamsMap[V+1],null!=(g=B[this._spriteUniformParamsMap[V]])&&(o+=l.fun.call(this,l,g));X.shaderCall+=o},g.uploadMaterialUniforms=function(B){for(var g,l,o=0,V=0,U=this._materialUniformParamsMap.length;V<U;V+=2)l=this._materialUniformParamsMap[V+1],null!=(g=B[this._materialUniformParamsMap[V]])&&(o+=l.fun.call(this,l,g));X.shaderCall+=o},g.uploadRenderElementUniforms=function(B){for(var g,l,o=0,V=0,U=this._renderElementUniformParamsMap.length;V<U;V+=2)l=this._renderElementUniformParamsMap[V+1],null!=(g=B[this._renderElementUniformParamsMap[V]])&&(o+=l.fun.call(this,l,g));X.shaderCall+=o},A.create=function(B,g,l,o,V,U,y,G,d,j){return new A(B,g,l,o,V,U,y,G,d,j)},A.addInclude=function(B,g){M.addInclude(B,g)},A._createShader=function(B,g,l){var o=B.createShader(l);if(B.shaderSource(o,g),B.compileShader(o),Xg.debugMode&&!B.getShaderParameter(o,35713))throw B.getShaderInfoLog(o);return o},A.PERIOD_RENDERELEMENT=0,A.PERIOD_MATERIAL=1,A.PERIOD_SPRITE=2,A.PERIOD_CAMERA=3,A.PERIOD_SCENE=4,A._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],A._count=0,A._preCompile=!1,A.extCompileFunc=null,A.extCompileObj=null,H(A,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new w}]),A}(),_g=function(G){function d(){this._transformUV=null,d.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new yg(.6,.6,.6)),this._setColor(10,new yg(1,1,1)),this._setColor(11,new Gg(1,1,1,8)),this._setColor(12,new yg(1,1,1)),this._setColor(7,new Gg(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new Gg(1,1,0,0)),this.renderMode=1}p(d,"laya.d3.core.material.StandardMaterial",G);var B=d.prototype;return B.disableLight=function(){this._addDisablePublicShaderDefine(Xg.SHADERDEFINE_POINTLIGHT|Xg.SHADERDEFINE_SPOTLIGHT|Xg.SHADERDEFINE_DIRECTIONLIGHT)},B.disableFog=function(){this._addDisablePublicShaderDefine(Xg.SHADERDEFINE_FOG)},B.onAsynLoaded=function(B,g,l){var o=g[0];if(o.version)G.prototype.onAsynLoaded.call(this,B,g,l);else{var V=g[1],U=o.props;for(var y in U)this[y]=U[y];d._parseStandardMaterial(V,this,o),this._endLoaded()}},B.cloneTo=function(B){G.prototype.cloneTo.call(this,B);var g=B;this._transformUV&&(g._transformUV=this._transformUV.clone())},x(0,B,"ambientColor",function(){return this._getColor(9)},function(B){this._setColor(9,B)}),x(0,B,"ambientTexture",function(){return this._getTexture(5)},function(B){B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,B)}),x(0,B,"renderMode",null,function(B){switch(B){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(B)}),x(0,B,"reflectColor",function(){return this._getColor(12)},function(B){this._setColor(12,B)}),x(0,B,"tilingOffset",function(){return this._getColor(15)},function(B){if(B){var g=B.elements;1!=g[0]||1!=g[1]||0!=g[2]||0!=g[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,B)}),x(0,B,"albedo",function(){return this._getColor(7)},function(B){this._setColor(7,B)}),x(0,B,"diffuseColor",function(){return this._getColor(10)},function(B){this._setColor(10,B)}),x(0,B,"albedoColor",function(){return this._getColor(7)},function(B){this._setColor(7,B)}),x(0,B,"specularColor",function(){return this._getColor(11)},function(B){this._setColor(11,B)}),x(0,B,"diffuseTexture",function(){return this._getTexture(1)},function(B){B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,B)}),x(0,B,"normalTexture",function(){return this._getTexture(2)},function(B){B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,B)}),x(0,B,"specularTexture",function(){return this._getTexture(3)},function(B){B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,B)}),x(0,B,"emissiveTexture",function(){return this._getTexture(4)},function(B){B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,B)}),x(0,B,"reflectTexture",function(){return this._getTexture(6)},function(B){B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,B)}),x(0,B,"transformUV",function(){return this._transformUV},function(B){this._transformUV=B,this._setMatrix4x4(13,B.matrix),B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,B.matrix.elements,0)}),d.__init__=function(){d.SHADERDEFINE_DIFFUSEMAP=d.shaderDefines.registerDefine("DIFFUSEMAP"),d.SHADERDEFINE_NORMALMAP=d.shaderDefines.registerDefine("NORMALMAP"),d.SHADERDEFINE_SPECULARMAP=d.shaderDefines.registerDefine("SPECULARMAP"),d.SHADERDEFINE_EMISSIVEMAP=d.shaderDefines.registerDefine("EMISSIVEMAP"),d.SHADERDEFINE_AMBIENTMAP=d.shaderDefines.registerDefine("AMBIENTMAP"),d.SHADERDEFINE_REFLECTMAP=d.shaderDefines.registerDefine("REFLECTMAP"),d.SHADERDEFINE_UVTRANSFORM=d.shaderDefines.registerDefine("UVTRANSFORM"),d.SHADERDEFINE_TILINGOFFSET=d.shaderDefines.registerDefine("TILINGOFFSET"),d.SHADERDEFINE_ADDTIVEFOG=d.shaderDefines.registerDefine("ADDTIVEFOG")},d.load=function(B){return D.loader.create(B,null,null,d)},d._parseStandardMaterial=function(B,g,l){var o=l.customProps,V=o.ambientColor;g.ambientColor=new yg(V[0],V[1],V[2]);var U=o.diffuseColor;g.diffuseColor=new yg(U[0],U[1],U[2]);var y=o.specularColor;g.specularColor=new Gg(y[0],y[1],y[2],y[3]);var G=o.reflectColor;g.reflectColor=new yg(G[0],G[1],G[2]);var d=o.albedoColor;d&&(g.albedo=new Gg(d[0],d[1],d[2],d[3]));var j=o.diffuseTexture.texture2D;j&&(g.diffuseTexture=C.getRes(B[j]));var A=o.normalTexture.texture2D;A&&(g.normalTexture=C.getRes(B[A]));var H=o.specularTexture.texture2D;H&&(g.specularTexture=C.getRes(B[H]));var K=o.emissiveTexture.texture2D;K&&(g.emissiveTexture=C.getRes(B[K]));var p=o.ambientTexture.texture2D;p&&(g.ambientTexture=C.getRes(B[p]));var x=o.reflectTexture.texture2D;x&&(g.reflectTexture=C.getRes(B[x]))},d.RENDERMODE_OPAQUE=1,d.RENDERMODE_OPAQUEDOUBLEFACE=2,d.RENDERMODE_CUTOUT=3,d.RENDERMODE_CUTOUTDOUBLEFACE=4,d.RENDERMODE_TRANSPARENT=13,d.RENDERMODE_TRANSPARENTDOUBLEFACE=14,d.RENDERMODE_ADDTIVE=15,d.RENDERMODE_ADDTIVEDOUBLEFACE=16,d.RENDERMODE_DEPTHREAD_TRANSPARENT=5,d.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,d.RENDERMODE_DEPTHREAD_ADDTIVE=7,d.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,d.RENDERMODE_NONDEPTH_TRANSPARENT=9,d.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,d.RENDERMODE_NONDEPTH_ADDTIVE=11,d.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,d.SHADERDEFINE_DIFFUSEMAP=0,d.SHADERDEFINE_NORMALMAP=0,d.SHADERDEFINE_SPECULARMAP=0,d.SHADERDEFINE_EMISSIVEMAP=0,d.SHADERDEFINE_AMBIENTMAP=0,d.SHADERDEFINE_REFLECTMAP=0,d.SHADERDEFINE_UVTRANSFORM=0,d.SHADERDEFINE_TILINGOFFSET=0,d.SHADERDEFINE_ADDTIVEFOG=0,d.DIFFUSETEXTURE=1,d.NORMALTEXTURE=2,d.SPECULARTEXTURE=3,d.EMISSIVETEXTURE=4,d.AMBIENTTEXTURE=5,d.REFLECTTEXTURE=6,d.ALBEDO=7,d.UVANIAGE=8,d.MATERIALAMBIENT=9,d.MATERIALDIFFUSE=10,d.MATERIALSPECULAR=11,d.MATERIALREFLECT=12,d.UVMATRIX=13,d.UVAGE=14,d.TILINGOFFSET=15,H(d,["defaultMaterial",function(){var B=new d;return B.lock=!0,this.defaultMaterial=B},"shaderDefines",function(){return this.shaderDefines=new Ag(zg.shaderDefines)}]),d}(zg),Pg=function(B){function y(B,g,l,o,V){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===l&&(l=35044),void 0===o&&(o=!1),y.__super.call(this),this._indexType=B,this._indexCount=g,this._bufferUsage=l,this._bufferType=34963,this._canRead=o;var U;if("ushort"==B)this._indexTypeByteCount=2;else{if("ubyte"!=B)throw new Error("unidentification index type.");this._indexTypeByteCount=1}U=this._indexTypeByteCount*g,this._byteLength=U,this._bind(),G._gl.bufferData(this._bufferType,U,this._bufferUsage),this.uri=V,o?("ushort"==B?this._buffer=new Uint16Array(g):"ubyte"==B&&(this._buffer=new Uint8Array(g)),this.memorySize=2*U):this.memorySize=U}p(y,"laya.d3.graphics.IndexBuffer3D",B);var g=y.prototype;return g.setData=function(B,g,l,o){void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=4294967295);var V=0;if("ushort"==this._indexType?(V=2,0===l&&4294967295===o||(B=new Uint16Array(B.buffer,l*V,o))):"ubyte"==this._indexType&&(V=1,0===l&&4294967295===o||(B=new Uint8Array(B.buffer,l*V,o))),this._bind(),G._gl.bufferSubData(this._bufferType,g*V,B),this._canRead)if(0!==g||0!==l||4294967295!==o){var U=this._buffer.length-g;U<o&&(o=U);for(var y=0;y<o;y++)this._buffer[g+y]=B[y]}else this._buffer=B},g.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},g.disposeResource=function(){B.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},x(0,g,"indexType",function(){return this._indexType}),x(0,g,"indexTypeByteCount",function(){return this._indexTypeByteCount}),x(0,g,"indexCount",function(){return this._indexCount}),x(0,g,"canRead",function(){return this._canRead}),y.INDEXTYPE_UBYTE="ubyte",y.INDEXTYPE_USHORT="ushort",y.create=function(B,g,l,o,V){return void 0===l&&(l=35044),void 0===o&&(o=!1),new y(B,g,l,o,V)},y}(G),Yg=function(U){function y(B,g,l,o,V){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===o&&(o=!1),y.__super.call(this),this._vertexDeclaration=B,this._vertexCount=g,this._bufferUsage=l,this._bufferType=34962,this._canRead=o,this.uri=V,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*g,this._bind(),G._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),o&&(this._buffer=new Float32Array(this._byteLength/4))}p(y,"laya.d3.graphics.VertexBuffer3D",U);var B=y.prototype;return B.bindWithIndexBuffer=function(B){B&&B._bind(),this._bind()},B.setData=function(B,g,l,o){if(void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=4294967295),0===l&&4294967295===o||(B=new Float32Array(B.buffer,4*l,o)),this._bind(),G._gl.bufferSubData(this._bufferType,4*g,B),this._canRead)if(0!==g||0!==l||4294967295!==o){var V=this._buffer.length-g;V<o&&(o=V);for(var U=0;U<o;U++)this._buffer[g+U]=B[U]}else this._buffer=B},B.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},B.disposeResource=function(){for(var B=t.mainContext,g=this._vertexDeclaration.getVertexElements(),l=G._enableAtributes,o=0,V=g.length;o<V;o++)l[o]===this._glBuffer&&(B.disableVertexAttribArray(o),l[o]=null);U.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},x(0,B,"vertexDeclaration",function(){return this._vertexDeclaration}),x(0,B,"vertexCount",function(){return this._vertexCount}),x(0,B,"canRead",function(){return this._canRead}),y.create=function(B,g,l,o,V){return void 0===l&&(l=35044),void 0===o&&(o=!1),new y(B,g,l,o,V)},y}(G),cg=function(B){function M(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,M.__super.call(this),this._type=3553}p(M,"laya.d3.resource.DataTexture2D",tg);var g=M.prototype;return g.genDebugMipmaps=function(){var B=[];return B.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),B.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),B.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),B.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),B.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),B.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),B.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),B.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),B.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),B.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),B},g._onTextureLoaded=function(B){},g._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var B=t.mainContext,g=this._source=B.createTexture(),l=this._width,o=this._height,V=h.curBindTexTarget,U=h.curBindTexValue,y=!1;if(h.bindTexture(B,this._type,g),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var G=0;B.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var d=0;d<this._mipmaps.length;d++){if(this._mipmaps[d].byteLength!=j*A*4)throw"mipmap size error  level:"+d;B.texSubImage2D(this._type,0,M.simLodRect[G++],M.simLodRect[G++],M.simLodRect[G++],M.simLodRect[G++],6408,5121,new Uint8Array(this._mipmaps[d]))}this.minFifter=9729,this.magFifter=9729}else{var j=this._width,A=this._height;for(G=0,B.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),d=0;d<this._mipmaps.length;d++){if(this._mipmaps[d].byteLength!=j*A*4)throw"mipmap size error  level:"+d;B.texImage2D(this._type,d,6408,j,A,0,6408,5121,new Uint8Array(this._mipmaps[d])),(j/=2)<1&&(j=1),(A/=2)<1&&(A=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&B.pixelStorei(B.UNPACK_ALIGNMENT,1),B.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var H=0,K=!1,p=!1;this._buffer.byteLength==4*l*o?(H=6408,K=!0):this._buffer.byteLength==3*l*o?(H=6407,p=!0):H=this._format,K||p?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),p&&B.pixelStorei(B.UNPACK_ALIGNMENT,1),B.texImage2D(this._type,0,H,l,o,0,H,5121,this._buffer)):B&&H==B.ALPHA?(B.texImage2D(3553,0,H,l,o,0,H,B.UNSIGNED_BYTE,this._buffer),y=!0):0!=H&&(B.compressedTexImage2D(3553,0,H,l,o,0,this._buffer),y=!0)}var x=this._minFifter,N=this._magFifter,F=0==this._wrapModeU?10497:33071,C=0==this._wrapModeV?10497:33071,m=b.isPOT(l,o);m?(this._mipmap||this._mipmaps?-1!==x||(x=9987):-1!==x||(x=9729),-1!==N||(N=9729),B.texParameteri(this._type,10241,x),B.texParameteri(this._type,10240,N),B.texParameteri(this._type,10242,F),B.texParameteri(this._type,10243,C),this._mipmap&&B.generateMipmap(this._type)):(-1!==x||(x=9729),-1!==N||(N=9729),B.texParameteri(this._type,10241,x),B.texParameteri(this._type,10240,N),B.texParameteri(this._type,10242,33071),B.texParameteri(this._type,10243,33071)),V&&U&&h.bindTexture(B,V,U),this.memorySize=y?this._buffer.length:m?l*o*4*(1+1/3):l*o*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},g.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},g.onAsynLoaded=function(B,g,l){var o;l&&(o=l[0].call(this,g)),o&&(this._width=o.width,this._height=o.height,this._buffer=o.data),this._src=B,this._size=new Ng(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},g.getPixels=function(){return new Uint8Array(this._buffer)},g.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(t.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},x(0,g,"src",function(){return this._src}),M.create=function(B,g,l,o,V,U,y){if(void 0===o&&(o=9729),void 0===V&&(V=9729),void 0===U&&(U=!0),!B||B.byteLength<g*l*4)throw"DataTexture2D create error";var G=new M;return G.uri=y,G._buffer=B,G._width=g,G._height=l,G._mipmap=U,G._magFifter=o,G._minFifter=V,G._size=new Ng(G._width,G._height),G._conchTexture?alert("怎么给runtime传递datatexture数据"):G.activeResource(),G},M.load=function(B,g,l,o,V){if(void 0===g&&(g=0),void 0===l&&(l=0),void 0===o&&(o=9729),void 0===V&&(V=9729),"mipmaps"===i.getFileExtension(B)){var U=D.loader.create(B,null,null,M,[function(B){this._mipmaps=[];var g=new Uint32Array(B);this._width=g[0];var l=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,l=1024),this._width!=l)throw"现在只支持512x256的环境贴图。当前的是"+g[0];this._height=g[1];for(var o=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,V=this._height,U=8;;){var y=o*V*4;if(U+y>B.byteLength)throw"load mipmaps data size error ";var G=new Uint8Array(B,U,y);if(this._mipmaps.push(G),U+=y,1==o&&1==V)break;(o/=2)<1&&(o=1),(V/=2)<1&&(V=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){U.simLodInfo=new Float32Array(40);for(var y=0;y<U.simLodInfo.length;)U.simLodInfo[y]=(M.simLodRect[y]+.5)/1024,y++,U.simLodInfo[y]=(M.simLodRect[y]+.5)/256,y++,U.simLodInfo[y]=Math.max(M.simLodRect[y]-1,.1)/1024,y++,U.simLodInfo[y]=Math.max(M.simLodRect[y]-1.5,.1)/256,y++}return U}if("number"==typeof g)return D.loader.create(B,null,null,M,[function(B){return this._width=g,this._height=l,this._buffer=B,null}]);if("function"==typeof g)return D.loader.create(B,null,null,M,[g]);throw new Error("unknown params.")},M.lodasatlas=!1,H(M,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),M}(),rg=function(B){function g(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,g.__super.call(this)}p(g,"laya.d3.resource.models.PrimitiveMesh",hg);var l=g.prototype;return D.imps(l,{"laya.d3.core.render.IRenderable":!0}),l._getVertexBuffer=function(B){return void 0===B&&(B=0),0===B?this._vertexBuffer:null},l._getVertexBuffers=function(){return null},l._getIndexBuffer=function(){return this._indexBuffer},l._getPositions=function(){var B,g=[],l=this._vertexBuffer.vertexDeclaration.getVertexElements(),o=0;for(o=0;o<l.length;o++){var V=l[o];if("vector3"===V.elementFormat&&0===V.elementUsage){B=V;break}}var U=this._vertexBuffer.getData();for(o=0;o<U.length;o+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var y=o+B.offset/4,G=new yg(U[y+0],U[y+1],U[y+2]);g.push(G)}return g},l.getRenderElement=function(B){return this},l.getRenderElementsCount=function(){return 1},l.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},l._beforeRender=function(B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},l._render=function(B){t.mainContext.drawElements(4,this._numberIndices,5123,0),X.drawCall++,X.trianglesFaces+=this._numberIndices/3},x(0,l,"_vertexBufferCount",function(){return 1}),x(0,l,"triangleCount",function(){return this._indexBuffer.indexCount/3}),g}(),Zg=function(B){function g(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,g.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}p(g,"laya.d3.resource.models.Mesh",hg);var l=g.prototype;return l._getPositions=function(){var B,g,l,o,V,U=[],y=0,G=0,d=0;if(0!==this._vertexBuffers.length){var j=this._vertexBuffers.length;for(y=0;y<j;y++){for(l=(B=this._vertexBuffers[y]).vertexDeclaration.getVertexElements(),G=0;G<l.length;G++)if("vector3"===(o=l[G]).elementFormat&&0===o.elementUsage){g=o;break}for(V=B.getData(),G=0;G<V.length;G+=B.vertexDeclaration.vertexStride/4)d=G+g.offset/4,U.push(new yg(V[d+0],V[d+1],V[d+2]))}}else{var A=this._subMeshes.length;for(y=0;y<A;y++){for(l=(B=this._subMeshes[y]._getVertexBuffer()).vertexDeclaration.getVertexElements(),G=0;G<l.length;G++)if("vector3"===(o=l[G]).elementFormat&&0===o.elementUsage){g=o;break}for(V=B.getData(),G=0;G<V.length;G+=B.vertexDeclaration.vertexStride/4)d=G+g.offset/4,U.push(new yg(V[d+0],V[d+1],V[d+2]))}}return U},l._setSubMeshes=function(B){this._subMeshes=B,this._subMeshCount=B.length;for(var g=0;g<this._subMeshCount;g++)B[g]._indexInMesh=g;this._positions=this._getPositions(),this._generateBoundingObject()},l.onAsynLoaded=function(B,g,l){var o=g[0],V=g[1];kB.read(o,this,this._materials,this._subMeshes,V),this.completeCreate(),this._endLoaded()},l.getSubMesh=function(B){return this._subMeshes[B]},l.getSubMeshCount=function(){return this._subMeshes.length},l.getRenderElementsCount=function(){return this._subMeshes.length},l.getRenderElement=function(B){return this._subMeshes[B]},l.disposeResource=function(){for(var B=0;B<this._subMeshes.length;B++)this._subMeshes[B].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},x(0,l,"materials",function(){return this._materials.slice()}),x(0,l,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),g.load=function(B){return D.loader.create(B,null,null,g)},g}(),Tg=(function(B){function j(B,g,l,o,V,U,y,G,d){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===l&&(l=6408),void 0===o&&(o=5121),void 0===V&&(V=33189),void 0===U&&(U=!1),void 0===y&&(y=!1),void 0===G&&(G=-1),void 0===d&&(d=-1),j.__super.call(this),this._type=3553,this._width=B,this._height=g,this._size=new Ng(B,g),this._surfaceFormat=l,this._surfaceType=o,this._depthStencilFormat=V,N.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=U,this._repeat=y,this._minFifter=G,this._magFifter=d,this.activeResource(),this._alreadyResolved=!0}p(j,"laya.d3.resource.RenderTexture",tg);var g=j.prototype;g.recreateResource=function(){var B=t.mainContext;this._frameBuffer=B.createFramebuffer(),this._source=B.createTexture();var g=h.curBindTexTarget,l=h.curBindTexValue;h.bindTexture(B,this._type,this._source),B.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var o=this._minFifter,V=this._magFifter,U=this._repeat?10497:33071;if(b.isPOT(this._width,this._height)?(this._mipmap?-1!==o||(o=9987):-1!==o||(o=9729),-1!==V||(V=9729),B.texParameteri(this._type,10241,o),B.texParameteri(this._type,10240,V),B.texParameteri(this._type,10242,U),B.texParameteri(this._type,10243,U),this._mipmap&&B.generateMipmap(this._type)):(-1!==o||(o=9729),-1!==V||(V=9729),B.texParameteri(this._type,10241,o),B.texParameteri(this._type,10240,V),B.texParameteri(this._type,10242,33071),B.texParameteri(this._type,10243,33071)),g&&l&&h.bindTexture(B,g,l),B.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=B.createRenderbuffer(),B.bindRenderbuffer(36161,this._depthStencilBuffer),B.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),B.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:B.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:B.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:B.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}B.framebufferTexture2D(36160,36064,3553,this._source,0),B.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},g.start=function(){t.mainContext.bindFramebuffer(36160,this.frameBuffer),(j._currentRenderTarget=this)._alreadyResolved=!1},g.end=function(){t.mainContext.bindFramebuffer(36160,null),j._currentRenderTarget=null,this._alreadyResolved=!0},g.getData=function(B,g,l,o){var V=t.mainContext;if(V.bindFramebuffer(36160,this._frameBuffer),!(36053===V.checkFramebufferStatus(36160)))return V.bindFramebuffer(36160,null),null;var U=new Uint8Array(this._width*this._height*4);return V.readPixels(B,g,l,o,this._surfaceFormat,this._surfaceType,U),V.bindFramebuffer(36160,null),U},g.disposeResource=function(){if(this._frameBuffer){var B=t.mainContext;B.deleteTexture(this._source),B.deleteFramebuffer(this._frameBuffer),B.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},x(0,g,"surfaceFormat",function(){return this._surfaceFormat}),x(0,g,"surfaceType",function(){return this._surfaceType}),x(0,g,"depthStencilFormat",function(){return this._depthStencilFormat}),x(0,g,"source",function(){return this._alreadyResolved?D.superGet(tg,this,"source"):null}),x(0,g,"depthStencilBuffer",function(){return this._depthStencilBuffer}),x(0,g,"frameBuffer",function(){return this._frameBuffer}),j._currentRenderTarget=null}(),function(B){function g(B){this._color=null,this._pixels=null,g.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new Ng(this.width,this.height),this._color=B,this._pixels=new Uint8Array([255*B.x,255*B.y,255*B.z,255*B.w]),this.uri="SolidColorTexture2D_"+this.id}p(g,"laya.d3.resource.SolidColorTexture2D",tg);var l=g.prototype;return l._createWebGlTexture=function(){var B=t.mainContext,g=this._source=B.createTexture(),l=this._width,o=this._height,V=h.curBindTexTarget,U=h.curBindTexValue;h.bindTexture(B,this._type,g),B.texImage2D(this._type,0,6408,l,o,0,6408,5121,this._pixels);var y=this._minFifter,G=this._magFifter,d=this._repeat?10497:33071,j=b.isPOT(l,o);j?(this._mipmap?-1!==y||(y=9987):-1!==y||(y=9729),-1!==G||(G=9729),B.texParameteri(this._type,10241,y),B.texParameteri(this._type,10240,G),B.texParameteri(this._type,10242,d),B.texParameteri(this._type,10243,d),this._mipmap&&B.generateMipmap(this._type)):(-1!==y||(y=9729),-1!==G||(G=9729),B.texParameteri(this._type,10241,y),B.texParameteri(this._type,10240,G),B.texParameteri(this._type,10242,33071),B.texParameteri(this._type,10243,33071)),V&&U&&h.bindTexture(B,V,U),this.memorySize=j?l*o*4*(1+1/3):l*o*4},l.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},l.disposeResource=function(){this._source&&(t.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},H(g,["magentaTexture",function(){var B=new g(new Gg(1,0,1,1));return B.lock=!0,this.magentaTexture=B},"grayTexture",function(){var B=new g(new Gg(.5,.5,.5,1));return B.lock=!0,this.grayTexture=B}]),g}()),Rg=function(B){function V(B,g,l,o){this._canRead=!1,this._image=null,this._pixels=null,void 0===B&&(B=!1),void 0===g&&(g=!0),void 0===l&&(l=6408),void 0===o&&(o=!0),V.__super.call(this),this._type=3553,this._repeat=g,this._canRead=B,this._format=l,this._mipmap=o}p(V,"laya.d3.resource.Texture2D",tg);var g=V.prototype;return g._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var B=t.mainContext,g=this._source=B.createTexture(),l=this._width,o=this._height,V=h.curBindTexTarget,U=h.curBindTexValue;switch(h.bindTexture(B,this._type,g),this._format){case 6407:case 6408:this._canRead?B.texImage2D(this._type,0,this._format,l,o,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?B.texImage2D(this._type,0,this._image._format,l,o,0,this._image._format,5121,this._image.atlasSource):B.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case t.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:B.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var y=this._minFifter,G=this._magFifter,d=this._repeat?10497:33071,j=0==this._wrapModeU?10497:33071,A=0==this._wrapModeV?10497:33071,H=b.isPOT(l,o);H?(this._mipmap?-1!==y||(y=9987):-1!==y||(y=9729),-1!==G||(G=9729),B.texParameteri(this._type,10241,y),B.texParameteri(this._type,10240,G),B.texParameteri(this._type,10242,d),B.texParameteri(this._type,10243,d),B.texParameteri(this._type,10242,j),B.texParameteri(this._type,10243,A),this._mipmap&&B.generateMipmap(this._type)):(-1!==y||(y=9729),-1!==G||(G=9729),B.texParameteri(this._type,10241,y),B.texParameteri(this._type,10240,G),B.texParameteri(this._type,10242,33071),B.texParameteri(this._type,10243,33071)),V&&U&&h.bindTexture(B,V,U),this._image.onload=null,this._image=null,this.memorySize=H?l*o*4*(1+1/3):l*o*4},g.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},g.onAsynLoaded=function(B,g,l){if(l){var o=l[0];void 0!==o&&(this._canRead=o);var V=l[1];void 0!==V&&(this._repeat=V);var U=l[2];void 0!==U&&(this._format=U);var y=l[3];void 0!==y&&(this._mipmap=y);var G=l.wrapModeU;void 0!==G&&(this._wrapModeU=G);var d=l.wrapModeV;void 0!==d&&(this._wrapModeV=d)}switch(this._format){case 6407:case 6408:var j=(this._image=g).width,A=g.height;this._width=j,this._height=A,this._size=new Ng(j,A),this._canRead&&(N.isConchApp?g instanceof K.HTMLElement&&(this._pixels=new Uint8Array(g.getImageData(0,0,j,A))):(f.canvas.size(j,A),f.canvas.clear(),f.context.drawImage(g,0,0,j,A),this._pixels=new Uint8Array(f.context.getImageData(0,0,j,A).data.buffer)));break;case t.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var H=new v(g);H.readUTFBytes(4),H.readUTFBytes(2),H.getInt16();H.endian="bigEndian",this._width=H.getInt16(),this._height=H.getInt16(),this._size=new Ng(this._width,this._height);H.getInt16(),H.getInt16();this._image=new Uint8Array(g,H.pos)}this.recreateResource(),this._endLoaded()},g.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},g.disposeResource=function(){this._source&&(t.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},x(0,g,"_src",function(){return this.url}),x(0,g,"src",function(){return this.url}),V.load=function(B){return D.loader.create(B,null,null,V)},V}(),Wg=function(g){function l(B,g){l.__super.call(this),void 0===B&&(B=.3),void 0===g&&(g=1e3),this._tempVector3=new yg,this._position=new yg,this._up=new yg,this._forward=new yg,this._right=new yg,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=Ng.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=B,this._farPlane=g,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),D.stage.on("resize",this,this._onScreenSizeChanged)}p(l,"laya.d3.core.BaseCamera",g);var B=l.prototype;return B._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var B=this.scene._cameraPool,g=B.length-1,l=0;l<g;l++)if(B[l].renderingOrder>B[g].renderingOrder){var o=B[l];B[l]=B[g],B[g]=o}},B._calculateProjectionMatrix=function(){},B._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},B._prepareCameraToRender=function(){S._currentCameraCullingMask=this.cullingMask;var B=this._shaderValues;B.setValue(0,this.transform.position.elements),B.setValue(5,this.forward.elements),B.setValue(6,this.up.elements)},B._prepareCameraViewProject=function(B,g){var l=this._shaderValues;l.setValue(1,B.elements),l.setValue(2,g.elements)},B._renderCamera=function(B,g,l){},B.addLayer=function(B){29!==B.number&&30!=B.number&&(this.cullingMask=this.cullingMask|B.mask)},B.removeLayer=function(B){29!==B.number&&30!=B.number&&(this.cullingMask=this.cullingMask&~B.mask)},B.addAllLayers=function(){this.cullingMask=2147483647},B.removeAllLayers=function(){this.cullingMask=0|S.getLayerByNumber(29).mask|S.getLayerByNumber(30).mask},B.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},B.moveForward=function(B){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=B,this.transform.translate(this._tempVector3)},B.moveRight=function(B){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=B,this.transform.translate(this._tempVector3)},B.moveVertical=function(B){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=B,this.transform.translate(this._tempVector3,!1)},B._addSelfRenderObjects=function(){var B=this.scene._cameraPool,g=B.length;if(0<g){for(var l=g-1;0<=l;l--)if(this.renderingOrder<=B[l].renderingOrder){B.splice(l+1,0,this);break}}else B.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},B._clearSelfRenderObjects=function(){var B=this.scene._cameraPool;B.splice(B.indexOf(this),1)},B.destroy=function(B){void 0===B&&(B=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,D.stage.off("resize",this,this._onScreenSizeChanged),g.prototype.destroy.call(this,B)},x(0,B,"sky",function(){return this._sky},function(B){(this._sky=B)._ownerCamera=this}),x(0,B,"forward",function(){var B=this.transform.worldMatrix.elements,g=this._forward.elements;return g[0]=-B[8],g[1]=-B[9],g[2]=-B[10],this._forward}),x(0,B,"position",function(){var B=this.transform.worldMatrix.elements,g=this._position.elements;return g[0]=B[12],g[1]=B[13],g[2]=B[14],this._position}),x(0,B,"renderTarget",function(){return this._renderTarget},function(B){null!=(this._renderTarget=B)&&(this._renderTargetSize=B.size)}),x(0,B,"up",function(){var B=this.transform.worldMatrix.elements,g=this._up.elements;return g[0]=B[4],g[1]=B[5],g[2]=B[6],this._up}),x(0,B,"right",function(){var B=this.transform.worldMatrix.elements,g=this._right.elements;return g[0]=B[0],g[1]=B[1],g[2]=B[2],this._right}),x(0,B,"renderTargetSize",function(){return this._renderTargetSize},function(B){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=B,this._calculateProjectionMatrix()}),x(0,B,"fieldOfView",function(){return this._fieldOfView},function(B){this._fieldOfView=B,this._calculateProjectionMatrix()}),x(0,B,"nearPlane",function(){return this._nearPlane},function(B){this._nearPlane=B,this._calculateProjectionMatrix()}),x(0,B,"farPlane",function(){return this._farPlane},function(B){this._farPlane=B,this._calculateProjectionMatrix()}),x(0,B,"orthographic",function(){return this._orthographic},function(B){this._orthographic=B,this._calculateProjectionMatrix()}),x(0,B,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(B){this._orthographicVerticalSize=B,this._calculateProjectionMatrix()}),x(0,B,"renderingOrder",function(){return this._renderingOrder},function(B){this._renderingOrder=B,this._sortCamerasByRenderingOrder()}),l.CAMERAPOS=0,l.VIEWMATRIX=1,l.PROJECTMATRIX=2,l.VPMATRIX=3,l.VPMATRIX_NO_TRANSLATE=4,l.CAMERADIRECTION=5,l.CAMERAUP=6,l.ENVIRONMENTDIFFUSE=7,l.ENVIRONMENTSPECULAR=8,l.SIMLODINFO=9,l.DIFFUSEIRRADMATR=10,l.DIFFUSEIRRADMATG=11,l.DIFFUSEIRRADMATB=12,l.HDREXPOSURE=13,l.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",l.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",l.CLEARFLAG_SOLIDCOLOR=0,l.CLEARFLAG_SKY=1,l.CLEARFLAG_DEPTHONLY=2,l.CLEARFLAG_NONE=3,H(l,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new Bg(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new Bg},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new Bg}]),l}(eg),ng=function(l){function g(B){this._render=null,this._geometryFilter=null,g.__super.call(this,B)}p(g,"laya.d3.core.RenderableSprite3D",l);var B=g.prototype;return B._addToInitStaticBatchManager=function(){},B._setBelongScene=function(B){l.prototype._setBelongScene.call(this,B),B._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},B._setUnBelongScene=function(){var B=this._scene._renderableSprite3Ds,g=B.indexOf(this);B.splice(g,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),l.prototype._setUnBelongScene.call(this)},B._update=function(B){(B.owner=this)._activeInHierarchy&&(this._updateComponents(B),this._render._updateOctreeNode(),this._lateUpdateComponents(B),X.spriteCount++,this._childs.length&&this._updateChilds(B))},B.destroy=function(B){void 0===B&&(B=!0),l.prototype.destroy.call(this,B),this._render._destroy(),this._render=null},g.__init__=function(){g.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=g.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),g.SAHDERDEFINE_LIGHTMAP=g.shaderDefines.registerDefine("LIGHTMAP")},g.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,g.SAHDERDEFINE_LIGHTMAP=4,g.LIGHTMAPSCALEOFFSET=2,g.LIGHTMAP=3,H(g,["shaderDefines",function(){return this.shaderDefines=new Ag}]),g}(eg),Lg=(function(B){function o(B,g,l){this._long=NaN,this._width=NaN,this._height=NaN,void 0===B&&(B=1),void 0===g&&(g=1),void 0===l&&(l=1),o.__super.call(this),this._long=B,this._width=g,this._height=l,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}p(o,"laya.d3.resource.models.BoxMesh",rg);var g=o.prototype;g.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var B=tB.vertexDeclaration,g=(B.vertexStride,this._long/2),l=this._height/2,o=this._width/2,V=new Float32Array([-g,l,-o,0,1,0,0,0,g,l,-o,0,1,0,1,0,g,l,o,0,1,0,1,1,-g,l,o,0,1,0,0,1,-g,-l,-o,0,-1,0,0,1,g,-l,-o,0,-1,0,1,1,g,-l,o,0,-1,0,1,0,-g,-l,o,0,-1,0,0,0,-g,l,-o,-1,0,0,0,0,-g,l,o,-1,0,0,1,0,-g,-l,o,-1,0,0,1,1,-g,-l,-o,-1,0,0,0,1,g,l,-o,1,0,0,1,0,g,l,o,1,0,0,0,0,g,-l,o,1,0,0,0,1,g,-l,-o,1,0,0,1,1,-g,l,o,0,0,1,0,0,g,l,o,0,0,1,1,0,g,-l,o,0,0,1,1,1,-g,-l,o,0,0,1,0,1,-g,l,-o,0,0,-1,1,0,g,l,-o,0,0,-1,0,0,g,-l,-o,0,0,-1,0,1,-g,-l,-o,0,0,-1,1,1]),U=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new Yg(B,this._numberVertices,35044,!0),this._indexBuffer=new Pg("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(V),this._indexBuffer.setData(U),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},x(0,g,"long",function(){return this._long},function(B){this._long!==B&&(this._long=B,this.releaseResource(),this.activeResource())}),x(0,g,"width",function(){return this._width},function(B){this._width!==B&&(this._width=B,this.releaseResource(),this.activeResource())}),x(0,g,"height",function(){return this._height},function(B){this._height!==B&&(this._height=B,this.releaseResource(),this.activeResource())})}(),function(B){function V(B,g,l,o){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===B&&(B=10),void 0===g&&(g=10),void 0===l&&(l=10),void 0===o&&(o=10),V.__super.call(this),this._long=B,this._width=g,this._stacks=l,this._slices=o,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}p(V,"laya.d3.resource.models.PlaneMesh",rg);var g=V.prototype;g.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var B=new Uint16Array(this._numberIndices),g=tB.vertexDeclaration,l=g.vertexStride/4,o=new Float32Array(this._numberVertices*l),V=this._long/2,U=this._width/2,y=this._long/this._stacks,G=this._width/this._slices,d=0,j=0;j<=this._slices;j++)for(var A=0;A<=this._stacks;A++)o[d++]=A*y-V,o[d++]=0,o[d++]=j*G-U,o[d++]=0,o[d++]=1,o[d++]=0,o[d++]=1*A/this._stacks,o[d++]=1*j/this._slices;var H=0;for(j=0;j<this._slices;j++)for(A=0;A<this._stacks;A++)B[H++]=(j+1)*(this._stacks+1)+A,B[H++]=j*(this._stacks+1)+A,B[H++]=(j+1)*(this._stacks+1)+A+1,B[H++]=j*(this._stacks+1)+A,B[H++]=j*(this._stacks+1)+A+1,B[H++]=(j+1)*(this._stacks+1)+A+1;this._vertexBuffer=new Yg(g,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new Pg("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData(o),this._indexBuffer.setData(B),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},x(0,g,"long",function(){return this._long},function(B){this._long!==B&&(this._long=B,this.releaseResource(),this.activeResource())}),x(0,g,"width",function(){return this._width},function(B){this._width!==B&&(this._width=B,this.releaseResource(),this.activeResource())}),x(0,g,"stacks",function(){return this._stacks},function(B){this._stacks!==B&&(this._stacks=B,this.releaseResource(),this.activeResource())}),x(0,g,"slices",function(){return this._slices},function(B){this._slices!==B&&(this._slices=B,this.releaseResource(),this.activeResource())})}(),function(B){function y(B,g,l){void 0===B&&(B=0),void 0===g&&(g=.3),void 0===l&&(l=1e3),this._viewMatrix=new Bg,this._projectionMatrix=new Bg,this._projectionViewMatrix=new Bg,this._viewport=new dg(0,0,0,0),this._normalizedViewport=new dg(0,0,1,1),this._aspectRatio=B,this._boundFrustumUpdate=!0,this._boundFrustum=new $B(Bg.DEFAULT),y.__super.call(this,g,l),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}p(y,"laya.d3.core.Camera",Wg);var g=y.prototype;return g._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},g._parseCustomProps=function(B,g,l,o){var V=l.clearColor;this.clearColor=new Gg(V[0],V[1],V[2],V[3]);var U=l.viewport;this.normalizedViewport=new dg(U[0],U[1],U[2],U[3])},g._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var B=this.orthographicVerticalSize*this.aspectRatio*.5,g=.5*this.orthographicVerticalSize;Bg.createOrthoOffCenterRH(-B,B,-g,g,this.nearPlane,this.farPlane,this._projectionMatrix)}else Bg.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},g._update=function(B){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,B)},g._renderCamera=function(B,g,l){var o,V;l.parallelSplitShadowMaps[0]&&l._renderShadowMap(B,g,this),(g.camera=this)._prepareCameraToRender(),l._preRenderUpdateComponents(g),o=g._viewMatrix=this.viewMatrix;var U=this._renderTarget;U?(U.start(),Bg.multiply(Wg._invertYScaleMatrix,this._projectionMatrix,Wg._invertYProjectionMatrix),Bg.multiply(Wg._invertYScaleMatrix,this.projectionViewMatrix,Wg._invertYProjectionViewMatrix),V=g._projectionMatrix=Wg._invertYProjectionMatrix,g._projectionViewMatrix=Wg._invertYProjectionViewMatrix):(V=g._projectionMatrix=this._projectionMatrix,g._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(o,V),g._viewport=this.viewport,l._preRenderScene(B,g,this.boundFrustum),l._clear(B,g),l._renderScene(B,g),l._postRenderUpdateComponents(g),U&&U.end()},g.viewportPointToRay=function(B,g){xg.calculateCursorRay(B,this.viewport,this._projectionMatrix,this.viewMatrix,null,g)},g.normalizedViewportPointToRay=function(B,g){var l=y._tempVector20,o=this.viewport,V=B.elements,U=l.elements;U[0]=V[0]*o.width,U[1]=V[1]*o.height,xg.calculateCursorRay(l,this.viewport,this._projectionMatrix,this.viewMatrix,null,g)},g.worldToViewportPoint=function(B,g){Bg.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(B,this._projectionViewMatrix,g);var l=g.elements;l[0]=l[0]/D.stage.clientScaleX,l[1]=l[1]/D.stage.clientScaleY},g.worldToNormalizedViewportPoint=function(B,g){Bg.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(B,this._projectionViewMatrix,g);var l=g.elements;l[0]=l[0]/D.stage.clientScaleX,l[1]=l[1]/D.stage.clientScaleY},g.convertScreenCoordToOrthographicCoord=function(B,g){if(this._orthographic){var l=k.clientWidth,o=k.clientHeight,V=this.orthographicVerticalSize*this.aspectRatio/l,U=this.orthographicVerticalSize/o,y=B.elements,G=g.elements;return G[0]=(-l/2+y[0])*V,G[1]=(o/2-y[1])*U,G[2]=(this.nearPlane-this.farPlane)*(y[2]+1)/2-this.nearPlane,yg.transformCoordinate(g,this.transform.worldMatrix,g),!0}return!1},x(0,g,"projectionViewMatrix",function(){return Bg.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),x(0,g,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var B=this.viewport;return B.width/B.height},function(B){if(B<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=B,this._calculateProjectionMatrix()}),x(0,g,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),x(0,g,"needViewport",function(){var B=this.normalizedViewport;return 0===B.x&&0===B.y&&1===B.width&&1===B.height}),x(0,g,"viewport",function(){if(this._viewportExpressedInClipSpace){var B=this._normalizedViewport,g=this.renderTargetSize,l=g.width,o=g.height;this._viewport.x=B.x*l,this._viewport.y=B.y*o,this._viewport.width=B.width*l,this._viewport.height=B.height*o}return this._viewport},function(B){if(null!=this.renderTarget&&(B.x<0||B.y<0||0==B.width||0==B.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=B,this._calculateProjectionMatrix()}),x(0,g,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var B=this._viewport,g=this.renderTargetSize,l=g.width,o=g.height;this._normalizedViewport.x=B.x/l,this._normalizedViewport.y=B.y/o,this._normalizedViewport.width=B.width/l,this._normalizedViewport.height=B.height/o}return this._normalizedViewport},function(B){B.x<0&&(B.x=0,console.warn("Camera: viewport.x must large than 0.0.")),B.y<0&&(B.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<B.x+B.width&&(B.width=1-B.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<B.y+B.height&&(B.height=1-B.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=B,this._calculateProjectionMatrix()}),x(0,g,"projectionMatrix",function(){return this._projectionMatrix},function(B){this._projectionMatrix=B,this._useUserProjectionMatrix=!0}),x(0,g,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),H(y,["_tempVector20",function(){return this._tempVector20=new Ug}]),y}()),Ig=function(l){function o(B,g){o.__super.call(this,g),this._geometryFilter=new fg(this),this._render=new Sg(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),B&&(this._geometryFilter.sharedMesh=B)instanceof laya.d3.resource.models.Mesh&&(B.loaded?this._render.sharedMaterials=B.materials:B.once("loaded",this,this._applyMeshMaterials))}p(o,"laya.d3.core.MeshSprite3D",l);var B=o.prototype;return B._changeRenderObjectByMesh=function(B){var g=this._render._renderElements,l=g[B];l||(l=g[B]=new sg),l._render=this._render;var o=this._render.sharedMaterials[B];o||(o=_g.defaultMaterial);var V=this._geometryFilter.sharedMesh.getRenderElement(B);return l._mainSortID=this._getSortID(V,o),l._sprite3D=this,l.renderObj=V,l._material=o,l},B._changeRenderObjectByMaterial=function(B,g){var l=this._render._renderElements[B];g||(g=_g.defaultMaterial);var o=this._geometryFilter.sharedMesh.getRenderElement(B);return l._mainSortID=this._getSortID(o,g),l._sprite3D=this,l.renderObj=o,l._material=g,l},B._changeRenderObjectsByMesh=function(){var B=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=B;for(var g=0;g<B;g++)this._changeRenderObjectByMesh(g)},B._onMeshChanged=function(B){var g=B.sharedMesh;g.loaded?this._changeRenderObjectsByMesh():g.once("loaded",this,this._onMeshLoaded)},B._onMeshLoaded=function(B){B===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},B._onMaterialChanged=function(B,g,l){g<this._render._renderElements.length&&this._changeRenderObjectByMaterial(g,l)},B._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},B._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},B._parseCustomProps=function(B,g,l,o){var V=this.meshRender,U=l.lightmapIndex;null!=U&&(V.lightmapIndex=U);var y,G,d=l.lightmapScaleOffset;if(d&&(V.lightmapScaleOffset=new Gg(d[0],d[1],d[2],d[3])),o.instanceParams)(y=o.instanceParams.loadPath)&&(G=C.getRes(g[y]),(this.meshFilter.sharedMesh=G).loaded?V.sharedMaterials=G.materials:G.once("loaded",this,this._applyMeshMaterials));else{(y=l.meshPath)&&(G=C.getRes(g[y]),this.meshFilter.sharedMesh=G);var j=l.materials;if(j){var A=V.sharedMaterials,H=j.length;A.length=H;for(var K=0;K<H;K++)A[K]=C.getRes(g[j[K].path]);V.sharedMaterials=A}}},B._applyMeshMaterials=function(B){for(var g=this._render.sharedMaterials,l=B.materials,o=0,V=l.length;o<V;o++)g[o]||(g[o]=l[o]);this._render.sharedMaterials=g},B._addToInitStaticBatchManager=function(){o._staticBatchManager._addInitBatchSprite(this)},B.cloneTo=function(B){var g=B;g._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var l=this._render,o=g._render;o.enable=l.enable,o.sharedMaterials=l.sharedMaterials,o.castShadow=l.castShadow;var V=l.lightmapScaleOffset;V&&(o.lightmapScaleOffset=V.clone()),o.lightmapIndex=l.lightmapIndex,o.receiveShadow=l.receiveShadow,o.sortingFudge=l.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,B)},B.destroy=function(B){if(void 0===B&&(B=!0),!this.destroyed){var g=this.meshFilter.sharedMesh;null!=g&&(g.loaded||g.off("loaded",this,this._applyMeshMaterials)),l.prototype.destroy.call(this,B),this._geometryFilter._destroy()}},x(0,B,"meshFilter",function(){return this._geometryFilter}),x(0,B,"meshRender",function(){return this._render}),o.__init__=function(){oB._staticBatchManagers.push(o._staticBatchManager)},o.load=function(B){return D.loader.create(B,null,null,o)},H(o,["_staticBatchManager",function(){return this._staticBatchManager=new wg}]),o}(ng)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(B,g){"use strict";for(var l in Object.defineProperty(g,"__esModule",{value:!0}),Laya){var o=Laya[l];o&&o.__isclass&&(g[l]=o)}}),function(B,g,VB){VB.un,VB.uns;var l=VB.static,o=VB.class,U=VB.getset,N=VB.__newvec,G=laya.maths.Bezier,H=laya.utils.Browser,tB=laya.utils.Byte,V=(laya.events.Event,laya.events.EventDispatcher),y=laya.display.Graphics,d=(laya.resource.HTMLCanvas,laya.utils.Handler),j=laya.net.Loader,K=laya.maths.MathUtil,hB=laya.maths.Matrix,F=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),A=(laya.renders.RenderContext,laya.resource.Resource),p=laya.utils.RunDriver,UB=laya.display.Sprite,x=laya.utils.Stat,fB=laya.resource.Texture,C=(laya.net.URL,laya.utils.Utils),h=function(){function B(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return o(B,"laya.ani.AnimationContent"),B}(),f=function(){function B(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return o(B,"laya.ani.AnimationNodeContent"),B}(),M=function(){function B(){}return o(B,"laya.ani.AnimationParser01"),B.parse=function(B,g){var l=g.__getBuffer(),o=0,V=0,U=0,y=0,G=0,d=0,j=0,A=g.readUTFString();B._aniClassName=A;var H,K=g.readUTFString().split("\n"),p=g.getUint8(),x=g.getUint32(),N=g.getUint32();0<x&&(H=l.slice(x,N));var F=new tB(H);for(0<N&&(B._publicExtData=l.slice(N,l.byteLength)),B._useParent=!!g.getUint8(),B._anis.length=p,o=0;o<p;o++){var C=B._anis[o]=new h;C.nodes=new Array;var m=C.name=K[g.getUint16()];B._aniMap[m]=o,C.bone3DMap={},C.playTime=g.getFloat32(),C.playTime<=0&&console.error("播放时间不能为0  url="+B.url+" name="+C.name);var M=C.nodes.length=g.getUint8();for(V=C.totalKeyframeDatasLength=0;V<M;V++){var b=C.nodes[V]=new f;b.childs=[];var D=g.getInt16();0<=D&&(b.name=K[D],C.bone3DMap[b.name]=V),b.keyFrame=new Array,b.parentIndex=g.getInt16(),-1==b.parentIndex?b.parent=null:b.parent=C.nodes[b.parentIndex],b.lerpType=g.getUint8();var v=g.getUint32();F.pos=v;var s=b.keyframeWidth=F.getUint16();if(C.totalKeyframeDatasLength+=s,0===b.lerpType||1===b.lerpType)for(b.interpolationMethod=[],b.interpolationMethod.length=s,U=0;U<s;U++)b.interpolationMethod[U]=e.interpolation[F.getUint8()];null!=b.parent&&b.parent.childs.push(b);var X=g.getUint16();0<X&&(b.extenData=l.slice(g.pos,g.pos+X),g.pos+=X);var w,i=g.getUint16(),a=0;for(U=0,y=b.keyFrame.length=i;U<y;U++){if((w=b.keyFrame[U]=new S).duration=g.getFloat32(),w.startTime=a,2===b.lerpType){w.interpolationData=[];var z,t=g.getUint8();switch(z=g.getFloat32()){case 254:for(w.interpolationData.length=s,j=0;j<s;j++)w.interpolationData[j]=0;break;case 255:for(w.interpolationData.length=s,j=0;j<s;j++)w.interpolationData[j]=5;break;default:for(w.interpolationData.push(z),d=1;d<t;d++)w.interpolationData.push(g.getFloat32())}}for(w.data=new Float32Array(s),G=0;G<s;G++)w.data[G]=g.getFloat32(),-1e-8<w.data[G]&&w.data[G]<1e-8&&(w.data[G]=0);a+=w.duration}w.startTime=C.playTime,b.playTime=C.playTime,B._calculateKeyFrame(b,i,s)}}},B}(),b=function(){function D(){}return o(D,"laya.ani.AnimationParser02"),D.READ_DATA=function(){D._DATA.offset=D._reader.getUint32(),D._DATA.size=D._reader.getUint32()},D.READ_BLOCK=function(){for(var B=D._BLOCK.count=D._reader.getUint16(),g=D._BLOCK.blockStarts=[],l=D._BLOCK.blockLengths=[],o=0;o<B;o++)g.push(D._reader.getUint32()),l.push(D._reader.getUint32())},D.READ_STRINGS=function(){var B=D._reader.getUint32(),g=D._reader.getUint16(),l=D._reader.pos;D._reader.pos=B+D._DATA.offset;for(var o=0;o<g;o++)D._strings[o]=D._reader.readUTFString();D._reader.pos=l},D.parse=function(B,g){D._templet=B;(D._reader=g).__getBuffer();D.READ_DATA(),D.READ_BLOCK(),D.READ_STRINGS();for(var l=0,o=D._BLOCK.count;l<o;l++){var V=g.getUint16(),U=D._strings[V],y=D["READ_"+U];if(null==y)throw new Error("model file err,no this function:"+V+" "+U);y.call()}},D.READ_ANIMATIONS=function(){var B=D._reader,g=B.__getBuffer(),l=0,o=0,V=0,U=0,y=B.getUint16(),G=[];for(G.length=y,l=0;l<y;l++)G[l]=e.interpolation[B.getByte()];var d=B.getUint8();for(D._templet._anis.length=d,l=0;l<d;l++){var j=D._templet._anis[l]={};j.nodes=new Array;var A=j.name=D._strings[B.getUint16()];D._templet._aniMap[A]=l,j.bone3DMap={},j.playTime=B.getFloat32();var H=j.nodes.length=B.getInt16();for(o=j.totalKeyframeDatasLength=0;o<H;o++){var K=j.nodes[o]={};K.keyframeWidth=y,K.childs=[];var p=B.getUint16();0<=p&&(K.name=D._strings[p],j.bone3DMap[K.name]=o),K.keyFrame=new Array,K.parentIndex=B.getInt16(),-1==K.parentIndex?K.parent=null:K.parent=j.nodes[K.parentIndex],j.totalKeyframeDatasLength+=y,K.interpolationMethod=G,null!=K.parent&&K.parent.childs.push(K);var x=B.getUint16(),N=null,F=null;for(V=0,U=K.keyFrame.length=x;V<U;V++){(N=K.keyFrame[V]={}).startTime=B.getFloat32(),F&&(F.duration=N.startTime-F.startTime);var C=D._DATA.offset,m=B.getUint32(),M=4*y,b=g.slice(C+m,C+m+M);N.data=new Float32Array(b),F=N}N.duration=0,K.playTime=j.playTime,D._templet._calculateKeyFrame(K,x,y)}}},D._templet=null,D._reader=null,D._strings=[],l(D,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),D}(),SB=(function(){function B(){}o(B,"laya.ani.AnimationState"),B.stopped=0,B.paused=1,B.playing=2}(),function(){function V(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new nB,this.resultMatrix=new hB,this._children=[]}o(V,"laya.ani.bone.Bone");var B=V.prototype;return B.setTempMatrix=function(B){this._tempMatrix=B;var g,l=0;for(l=0,g=this._children.length;l<g;l++)this._children[l].setTempMatrix(this._tempMatrix)},B.update=function(B){var g;if(this.rotation=this.transform.skX,B)g=this.resultTransform.getMatrix(),hB.mul(g,B,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)g=this.resultTransform.getMatrix(),hB.mul(g,this.parentBone.resultMatrix,this.resultMatrix);else{var l=this.parentBone,o=NaN,V=NaN,U=NaN,y=this.parentBone.resultMatrix;g=this.resultTransform.getMatrix();var G=y.a*g.tx+y.c*g.ty+y.tx,d=y.b*g.tx+y.d*g.ty+y.ty,j=new hB;this.inheritRotation?(o=Math.atan2(l.resultMatrix.b,l.resultMatrix.a),V=Math.cos(o),U=Math.sin(o),j.setTo(V,U,-U,V,0,0),hB.mul(this._tempMatrix,j,hB.TEMP),hB.TEMP.copyTo(j),g=this.resultTransform.getMatrix(),hB.mul(g,j,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,g=this.resultTransform.getMatrix(),hB.TEMP.identity(),hB.TEMP.d=this.d,hB.mul(g,hB.TEMP,this.resultMatrix)),this.resultMatrix.tx=G,this.resultMatrix.ty=d}else(g=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var A,H=0;for(H=0,A=this._children.length;H<A;H++)this._children[H].update()},B.updateChild=function(){var B,g=0;for(g=0,B=this._children.length;g<B;g++)this._children[g].update()},B.setRotation=function(B){this._sprite&&(this._sprite.rotation=180*B/Math.PI)},B.updateDraw=function(B,g){V.ShowBones&&!V.ShowBones[this.name]||(this._sprite||(this._sprite=new UB,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),VB.stage.addChild(this._sprite)),this._sprite.x=B+this.resultMatrix.tx,this._sprite.y=g+this.resultMatrix.ty);var l,o=0;for(o=0,l=this._children.length;o<l;o++)this._children[o].updateDraw(B,g)},B.addChild=function(B){this._children.push(B),B.parentBone=this},B.findBone=function(B){if(this.name==B)return this;var g,l,o=0;for(o=0,g=this._children.length;o<g;o++)if(l=this._children[o].findBone(B))return l;return null},B.localToWorld=function(B){var g=B[0],l=B[1];B[0]=g*this.resultMatrix.a+l*this.resultMatrix.c+this.resultMatrix.tx,B[1]=g*this.resultMatrix.b+l*this.resultMatrix.d+this.resultMatrix.ty},V.ShowBones={},V}()),EB=function(){function N(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}o(N,"laya.ani.bone.BoneSlot");var B=N.prototype;return B.showSlotData=function(B,g){void 0===g&&(g=!0),this.currSlotData=B,g&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},B.showDisplayByName=function(B){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(B))},B.replaceDisplayByName=function(B,g){if(this.currSlotData){var l;l=this.currSlotData.getDisplayByName(B);var o;o=this.currSlotData.getDisplayByName(g),this.replaceDisplayByIndex(l,o)}},B.replaceDisplayByIndex=function(B,g){this.currSlotData&&(this._replaceDic[B]=g,this.displayIndex==B&&this.showDisplayByIndex(B))},B.showDisplayByIndex=function(B){if(null!=this._replaceDic[B]&&(B=this._replaceDic[B]),this.currSlotData&&-1<B&&B<this.currSlotData.displayArr.length){if(this.displayIndex=B,this.currDisplayData=this.currSlotData.displayArr[B],this.currDisplayData){var g=this.currDisplayData.name;this.currTexture=this.templet.getTexture(g),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!F.isConchApp||F.isConchApp&&"0.9.15"<UB.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},B.replaceSkin=function(B){this._diyTexture=B,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},B.setParentMatrix=function(B){this._parentMatrix=B},B.draw=function(B,g,l,o){if(void 0===l&&(l=!1),void 0===o&&(o=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var V,U=this.currTexture;switch(this._diyTexture&&(U=this._diyTexture),this.currDisplayData.type){case 0:if(B){var y=this.getDisplayMatrix();if(this._parentMatrix){var G=!1;if(y){var d;if(hB.mul(y,this._parentMatrix,hB.TEMP),d=l?(null==this._resultMatrix&&(this._resultMatrix=new hB),this._resultMatrix):new hB,!F.isWebGL&&this.currDisplayData.uvs||F.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var j=N._tempMatrix;j.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(j.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(G=!0,j.rotate(-Math.PI/2)),hB.mul(j,hB.TEMP,d)}else hB.TEMP.copyTo(d);G?B.drawTexture(U,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,d):B.drawTexture(U,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,d)}}}break;case 1:if(null==(V=l?(null==this._skinSprite&&(this._skinSprite=N.createSkinMesh()),this._skinSprite):N.createSkinMesh()))return;var A;if(null==this.currDisplayData.bones){var H,K=this.currDisplayData.weights;this.deformData&&(K=this.deformData),H=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=s.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=s.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=K;this.currDisplayData.triangles.length;A=this.currDisplayData.triangles,V.init2(U,null,A,this._mVerticleArr,H);var p,x=this.getDisplayMatrix();if(this._parentMatrix)if(x)hB.mul(x,this._parentMatrix,hB.TEMP),p=l?(null==this._resultMatrix&&(this._resultMatrix=new hB),this._resultMatrix):new hB,hB.TEMP.copyTo(p),V.transform=p}else this.skinMesh(g,V,o);B.drawSkin(V);break;case 2:if(null==(V=l?(null==this._skinSprite&&(this._skinSprite=N.createSkinMesh()),this._skinSprite):N.createSkinMesh()))return;this.skinMesh(g,V,o),B.drawSkin(V)}}},B.skinMesh=function(B,g,l){var o,V=this.currTexture,U=this.currDisplayData.bones;o=this._diyTexture?(V=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=s.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=s.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var y,G,d=this.currDisplayData.weights,j=this.currDisplayData.triangles,A=0,H=0,K=0,p=NaN,x=NaN,N=0,F=0,C=[],m=0,M=0;if(this.deformData&&0<this.deformData.length){var b=0;for(m=0,M=U.length;m<M;){for(K=U[m++]+m,H=A=0;m<K;m++)G=B[U[m]],p=d[N]+this.deformData[b++],x=d[N+1]+this.deformData[b++],F=d[N+2],A+=(p*G.a+x*G.c+G.tx)*F,H+=(p*G.b+x*G.d+G.ty)*F,N+=3;C.push(A,H)}}else for(m=0,M=U.length;m<M;){for(K=U[m++]+m,H=A=0;m<K;m++)G=B[U[m]],p=d[N],x=d[N+1],F=d[N+2],A+=(p*G.a+x*G.c+G.tx)*F,H+=(p*G.b+x*G.d+G.ty)*F,N+=3;C.push(A,H)}this._mVerticleArr=C,y=j,g.init2(V,null,y,this._mVerticleArr,o)},B.drawBonePoint=function(B){B&&this._parentMatrix&&B.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},B.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},B.getMatrix=function(){return this._resultMatrix},B.copy=function(){var B=new N;return B.type="copy",B.name=this.name,B.attachmentName=this.attachmentName,B.srcDisplayIndex=this.srcDisplayIndex,B.parent=this.parent,B.displayIndex=this.displayIndex,B.templet=this.templet,B.currSlotData=this.currSlotData,B.currTexture=this.currTexture,B.currDisplayData=this.currDisplayData,B},N.createSkinMesh=function(){return F.isWebGL||F.isConchApp?p.skinAniSprite():(F.isWebGL,null)},l(N,["_tempMatrix",function(){return this._tempMatrix=new hB}]),N}(),eB=function(){function B(){this.skinName=null,this.deformSlotDataList=[]}return o(B,"laya.ani.bone.DeformAniData"),B}(),QB=function(){function B(){this.deformSlotDisplayList=[]}return o(B,"laya.ani.bone.DeformSlotData"),B}(),_B=function(){function B(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}o(B,"laya.ani.bone.DeformSlotDisplayData");var g=B.prototype;return g.binarySearch1=function(B,g){var l=0,o=B.length-2;if(0==o)return 1;for(var V=o>>>1;;){if(B[Math.floor(V+1)]<=g?l=V+1:o=V,l==o)return l+1;V=l+o>>>1}return 0},g.apply=function(B,g,l){if(void 0===l&&(l=1),B+=.05,!(this.timeList.length<=0)){var o=0;if(!(B<this.timeList[0])){var V=this.vectices[0].length,U=[],y=this.binarySearch1(this.timeList,B);if(this.frameIndex=y,B>=this.timeList[this.timeList.length-1]){var G=this.vectices[this.vectices.length-1];if(l<1)for(o=0;o<V;o++)U[o]+=(G[o]-U[o])*l;else for(o=0;o<V;o++)U[o]=G[o];this.deformData=U}else{this.tweenKeyList[this.frameIndex];var d=this.vectices[this.frameIndex-1],j=this.vectices[this.frameIndex],A=this.timeList[this.frameIndex-1],H=this.timeList[this.frameIndex];l=this.tweenKeyList[y-1]?(B-A)/(H-A):0;var K=NaN;for(o=0;o<V;o++)K=d[o],U[o]=K+(j[o]-K)*l;this.deformData=U}}}},B}(),PB=function(){function B(){this.time=NaN,this.drawOrder=[]}return o(B,"laya.ani.bone.DrawOrderData"),B}(),YB=function(){function B(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return o(B,"laya.ani.bone.EventData"),B}(),m=function(){function oB(B,g){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=B,this._targetBone=g[B.targetBoneIndex],this.isSpine=B.isSpine,null==this._bones&&(this._bones=[]);for(var l=this._bones.length=0,o=B.boneIndexs.length;l<o;l++)this._bones.push(g[B.boneIndexs[l]]);this.name=B.name,this.mix=B.mix,this.bendDirection=B.bendDirection}o(oB,"laya.ani.bone.IkConstraint");var B=oB.prototype;return B.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},B._applyIk1=function(B,g,l,o){var V=B.parentBone,U=1/(V.resultMatrix.a*V.resultMatrix.d-V.resultMatrix.b*V.resultMatrix.c),y=g-V.resultMatrix.tx,G=l-V.resultMatrix.ty,d=(y*V.resultMatrix.d-G*V.resultMatrix.c)*U-B.transform.x,j=(G*V.resultMatrix.a-y*V.resultMatrix.b)*U-B.transform.y,A=Math.atan2(j,d)*oB.radDeg-0-B.transform.skX;B.transform.scX<0&&(A+=180),180<A?A-=360:A<-180&&(A+=360),B.transform.skX=B.transform.skY=B.transform.skX+A*o,B.update()},B.updatePos=function(B,g){this._sp&&this._sp.pos(B,g)},B._applyIk2=function(B,g,l,o,V,U){if(0!=U){var y=B.resultTransform.x,G=B.resultTransform.y,d=B.transform.scX,j=B.transform.scY,A=g.transform.scX,H=0,K=0,p=0;p=d<0?(d=-d,H=180,-1):(H=0,1),j<0&&(j=-j,p=-p),K=A<0?(A=-A,180):0;var x=g.resultTransform.x,N=NaN,F=NaN,C=NaN,m=B.resultMatrix.a,M=B.resultMatrix.c,b=B.resultMatrix.b,D=B.resultMatrix.d,v=Math.abs(d-j)<=1e-4;C=v?(F=m*x+M*(N=g.resultTransform.y)+B.resultMatrix.tx,b*x+D*N+B.resultMatrix.ty):(N=0,F=m*x+B.resultMatrix.tx,b*x+B.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new UB,VB.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(l,o,15,"#ffff00"),this._sp.graphics.drawCircle(F,C,15,"#ff00ff")),B.setRotation(Math.atan2(C-B.resultMatrix.ty,F-B.resultMatrix.tx));var s=B.parentBone;m=s.resultMatrix.a,M=s.resultMatrix.c,b=s.resultMatrix.b;var X=1/(m*(D=s.resultMatrix.d)-M*b),w=l-s.resultMatrix.tx,i=o-s.resultMatrix.ty,a=(w*D-i*M)*X-y,z=(i*m-w*b)*X-G,t=((w=F-s.resultMatrix.tx)*D-(i=C-s.resultMatrix.ty)*M)*X-y,h=(i*m-w*b)*X-G,f=Math.sqrt(t*t+h*h),S=g.length*A,E=NaN,e=NaN;if(v){var Q=(a*a+z*z-f*f-(S*=d)*S)/(2*f*S);Q<-1?Q=-1:1<Q&&(Q=1),e=Math.acos(Q)*V,m=f+S*Q,M=S*Math.sin(e),E=Math.atan2(z*m-a*M,a*m+z*M)}else{var _=(m=d*S)*m,P=(M=j*S)*M,Y=a*a+z*z,c=Math.atan2(z,a),r=-2*P*f,Z=P-_;if(0<(D=r*r-4*Z*(b=P*f*f+_*Y-_*P))){var T=Math.sqrt(D);r<0&&(T=-T);var R=(T=-(r+T)/2)/Z,W=b/T,n=Math.abs(R)<Math.abs(W)?R:W;n*n<=Y&&(i=Math.sqrt(Y-n*n)*V,E=c-Math.atan2(i,n),e=Math.atan2(i/j,(n-f)/d))}var L=0,I=Number.MAX_VALUE,k=0,J=0,$=0,u=0,q=0,O=0;u<(D=(w=f+m)*w)&&($=0,u=D,q=w),(D=(w=f-m)*w)<I&&(L=Math.PI,I=D,k=w);var BB=Math.acos(-m*f/(_-P));(D=(w=m*Math.cos(BB)+f)*w+(i=M*Math.sin(BB))*i)<I&&(L=BB,I=D,k=w,J=i),u<D&&($=BB,u=D,q=w,O=i),e=Y<=(I+u)/2?(E=c-Math.atan2(J*V,k),L*V):(E=c-Math.atan2(O*V,q),$*V)}var gB=Math.atan2(N,x)*p,lB=B.resultTransform.skX;180<(E=(E-gB)*oB.radDeg+H-lB)?E-=360:E<-180&&(E+=360),B.resultTransform.x=y,B.resultTransform.y=G,B.resultTransform.skX=B.resultTransform.skY=lB+E*U,lB=g.resultTransform.skX,180<(e=((e+gB)*oB.radDeg-0)*p+K-(lB%=360))?e-=360:e<-180&&(e+=360),g.resultTransform.x=x,g.resultTransform.y=N,g.resultTransform.skX=g.resultTransform.skY=g.resultTransform.skY+e*U,B.update()}},B._applyIk3=function(B,g,l,o,V,U){if(0!=U){var y,G,d=g.resultMatrix.a*g.length,j=g.resultMatrix.b*g.length,A=d*d+j*j,H=Math.sqrt(A),K=B.resultMatrix.tx,p=B.resultMatrix.ty,x=g.resultMatrix.tx,N=g.resultMatrix.ty,F=x-K,C=N-p,m=F*F+C*C,M=Math.sqrt(m),b=(F=l-B.resultMatrix.tx)*F+(C=o-B.resultMatrix.ty)*C,D=Math.sqrt(b);if(H+M<=D||D+H<=M||D+M<=H){var v=NaN;x=K+(v=H+M<=D?1:-1)*(l-K)*M/D,N=p+v*(o-p)*M/D}else{var s=(m-A+b)/(2*b),X=Math.sqrt(m-s*s*b)/D,w=K+F*s,i=p+C*s,a=-C*X,z=F*X;N=0<V?(x=w-a,i-z):(x=w+a,i+z)}y=x,G=N,this.isDebug&&(this._sp||(this._sp=new UB,VB.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(K,p,15,"#ff00ff"),this._sp.graphics.drawCircle(l,o,15,"#ffff00"),this._sp.graphics.drawCircle(y,G,15,"#ff00ff"));var t,h;t=Math.atan2(G-B.resultMatrix.ty,y-B.resultMatrix.tx),B.setRotation(t),(h=oB._tempMatrix).identity(),h.rotate(t),h.scale(B.resultMatrix.getScaleX(),B.resultMatrix.getScaleY()),h.translate(B.resultMatrix.tx,B.resultMatrix.ty),h.copyTo(B.resultMatrix),B.updateChild();var f,S;f=Math.atan2(o-G,l-y),g.setRotation(f),(S=oB._tempMatrix).identity(),S.rotate(f),S.scale(g.resultMatrix.getScaleX(),g.resultMatrix.getScaleY()),S.translate(y,G),h.copyTo(g.resultMatrix),g.updateChild()}},l(oB,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new hB}]),oB}(),cB=function(){function B(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return o(B,"laya.ani.bone.IkConstraintData"),B}(),D=function(){function S(B,g){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=B,this.position=B.position,this.spacing=B.spacing,this.rotateMix=B.rotateMix,this.translateMix=B.translateMix,this.bones=[];for(var l=this.data.bones,o=0,V=l.length;o<V;o++)this.bones.push(g[l[o]])}o(S,"laya.ani.bone.PathConstraint");var B=S.prototype;return B.apply=function(B,g){if(this.target){var l=this.translateMix,o=this.translateMix,V=0<o,U=this.data.spacingMode,y="length"==U,G=this.data.rotateMode,d="tangent"==G,j="chainScale"==G,A=[],H=this.bones.length,K=d?H:H+1,p=[];(this._spaces=p)[0]=this.position;var x=this.spacing;if(j||y)for(var N=0,F=K-1;N<F;){var C=this.bones[N],m=C.length,M=m*C.resultMatrix.a,b=m*C.resultMatrix.b;m=Math.sqrt(M*M+b*b),j&&(A[N]=m),p[++N]=y?Math.max(0,m+x):x}else for(N=1;N<K;N++)p[N]=x;var D=this.computeWorldPositions(this.target,B,g,K,d,"percent"==this.data.positionMode,"percent"==U);if(this._debugKey){for(N=0;N<D.length;N++)g.drawCircle(D[N++],D[N++],5,"#00ff00");var v=[];for(N=0;N<D.length;N++)v.push(D[N++],D[N++]);g.drawLines(0,0,v,"#ff0000")}var s=D[0],X=D[1],w=this.data.offsetRotation,i="chain"==G&&0==w,a=NaN;for(N=0,a=3;N<H;N++,a+=3){(C=this.bones[N]).resultMatrix.tx+=(s-C.resultMatrix.tx)*l,C.resultMatrix.ty+=(X-C.resultMatrix.ty)*l;var z=(M=D[a])-s,t=(b=D[a+1])-X;if(j&&0!=(m=A[N])){var h=(Math.sqrt(z*z+t*t)/m-1)*o+1;C.resultMatrix.a*=h,C.resultMatrix.c*=h}if(s=M,X=b,V){var f=C.resultMatrix.a,S=C.resultMatrix.c,E=C.resultMatrix.b,e=C.resultMatrix.d,Q=NaN,_=NaN,P=NaN;Q=d?D[a-1]:0==p[N+1]?D[a+2]:Math.atan2(t,z),Q-=Math.atan2(E,f)-w/180*Math.PI,i&&(_=Math.cos(Q),P=Math.sin(Q),s+=((m=C.length)*(_*f-P*E)-z)*o,X+=(m*(P*f+_*E)-t)*o),Q>Math.PI?Q-=2*Math.PI:Q<-Math.PI&&(Q+=2*Math.PI),Q*=o,_=Math.cos(Q),P=Math.sin(Q),C.resultMatrix.a=_*f-P*E,C.resultMatrix.c=_*S-P*e,C.resultMatrix.b=P*f+_*E,C.resultMatrix.d=P*S+_*e}}}},B.computeWorldVertices2=function(B,g,l,o,V,U){var y,G,d=B.currDisplayData.bones,j=B.currDisplayData.weights,A=B.currDisplayData.triangles,H=0,K=0,p=0,x=0,N=0,F=0,C=0,m=0,M=0,b=0,D=0;if(null!=d){for(H=0;H<l;H+=2)K+=(x=d[K])+1,p+=x;var v=g;for(N=U,F=3*p;N<o;N+=2){for(m=C=0,x=d[K++],x+=K;K<x;K++,F+=3){y=v[d[K]].resultMatrix,M=j[F],b=j[F+1];var s=j[F+2];C+=(M*y.a+b*y.c+y.tx)*s,m+=(M*y.b+b*y.d+y.ty)*s}V[N]=C,V[N+1]=m}}else{var X,w;if(A||(A=j),B.deformData&&(A=B.deformData),X=B.parent,g)for(D=g.length,H=0;H<D;H++)if(g[H].name==X){G=g[H];break}G&&(w=G.resultMatrix),w||(w=S._tempMt);var i=w.tx,a=w.ty,z=w.a,t=w.b,h=w.c,f=w.d;for(G&&(f*=G.d),K=l,N=U;N<o;K+=2,N+=2)M=A[K],b=A[K+1],V[N]=M*z+b*t+i,V[N+1]=-(M*h+b*f+a)}},B.computeWorldPositions=function(B,g,l,o,V,U,y){B.currDisplayData.bones,B.currDisplayData.weights,B.currDisplayData.triangles;var G=[],d=0,j=B.currDisplayData.verLen,A=this.position,H=this._spaces,K=[],p=[],x=j/6,N=-1,F=NaN,C=0,m=0,M=NaN,b=NaN,D=NaN,v=NaN;if(x--,j-=4,this.computeWorldVertices2(B,g,2,j,G,0),this._debugKey)for(d=0;d<G.length;)l.drawCircle(G[d++],G[d++],10,"#ff0000");K=G,this._curves.length=x;var s=this._curves,X=K[F=0],w=K[1],i=0,a=0,z=0,t=0,h=0,f=0,S=NaN,E=NaN,e=NaN,Q=NaN,_=NaN,P=NaN,Y=NaN,c=NaN,r=0;for(d=0,r=2;d<x;d++,r+=6)i=K[r],a=K[r+1],z=K[r+2],t=K[r+3],_=2*(S=.1875*(X-2*i+z))+(e=.09375*(3*(i-z)-X+(h=K[r+4]))),P=2*(E=.1875*(w-2*a+t))+(Q=.09375*(3*(a-t)-w+(f=K[r+5]))),Y=.75*(i-X)+S+.16666667*e,c=.75*(a-w)+E+.16666667*Q,F+=Math.sqrt(Y*Y+c*c),Y+=_,c+=P,_+=e,P+=Q,F+=Math.sqrt(Y*Y+c*c),Y+=_,c+=P,F+=Math.sqrt(Y*Y+c*c),Y+=_+e,c+=P+Q,F+=Math.sqrt(Y*Y+c*c),s[d]=F,X=h,w=f;if(U&&(A*=F),y)for(d=0;d<o;d++)H[d]*=F;var Z=this._segments,T=0,R=0;for(R=m=C=d=0;d<o;d++,C+=3)if((M=A+=b=H[d])<0)this.addBeforePosition(M,K,0,p,C);else if(F<M)this.addAfterPosition(M-F,K,j-4,p,C);else{for(;;m++)if(!((v=s[m])<M)){0==m?M/=v:M=(M-(D=s[m-1]))/(v-D);break}if(m!=N){var W=6*(N=m);for(X=K[W],w=K[W+1],i=K[W+2],a=K[W+3],z=K[W+4],t=K[W+5],_=2*(S=.03*(X-2*i+z))+(e=.006*(3*(i-z)-X+(h=K[W+6]))),P=2*(E=.03*(w-2*a+t))+(Q=.006*(3*(a-t)-w+(f=K[W+7]))),Y=.3*(i-X)+S+.16666667*e,c=.3*(a-w)+E+.16666667*Q,T=Math.sqrt(Y*Y+c*c),Z[0]=T,W=1;W<8;W++)Y+=_,c+=P,_+=e,P+=Q,T+=Math.sqrt(Y*Y+c*c),Z[W]=T;Y+=_,c+=P,T+=Math.sqrt(Y*Y+c*c),Z[8]=T,Y+=_+e,c+=P+Q,T+=Math.sqrt(Y*Y+c*c),Z[9]=T,R=0}for(M*=T;;R++)if(!((v=Z[R])<M)){0==R?M/=v:M=R+(M-(D=Z[R-1]))/(v-D);break}this.addCurvePosition(.1*M,X,w,i,a,z,t,h,f,p,C,V||0<d&&0==b)}return p},B.addBeforePosition=function(B,g,l,o,V){var U=g[l],y=g[l+1],G=g[l+2]-U,d=g[l+3]-y,j=Math.atan2(d,G);o[V]=U+B*Math.cos(j),o[V+1]=y+B*Math.sin(j),o[V+2]=j},B.addAfterPosition=function(B,g,l,o,V){var U=g[l+2],y=g[l+3],G=U-g[l],d=y-g[l+1],j=Math.atan2(d,G);o[V]=U+B*Math.cos(j),o[V+1]=y+B*Math.sin(j),o[V+2]=j},B.addCurvePosition=function(B,g,l,o,V,U,y,G,d,j,A,H){0==B&&(B=1e-4);var K=B*B,p=K*B,x=1-B,N=x*x,F=N*x,C=x*B,m=3*C,M=x*m,b=m*B,D=g*F+o*M+U*b+G*p,v=l*F+V*M+y*b+d*p;j[A]=D,j[A+1]=v,j[A+2]=H?Math.atan2(v-(l*N+V*C*2+y*K),D-(g*N+o*C*2+U*K)):0},S.NONE=-1,S.BEFORE=-2,S.AFTER=-3,l(S,["_tempMt",function(){return this._tempMt=new hB}]),S}(),rB=function(){function B(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return o(B,"laya.ani.bone.PathConstraintData"),B}(),ZB=function(){function B(){this.name=null,this.slotArr=[]}return o(B,"laya.ani.bone.SkinData"),B}(),TB=function(){function B(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}o(B,"laya.ani.bone.SkinSlotDisplayData");var g=B.prototype;return g.createTexture=function(B){return this.texture||(this.texture=new fB(B.bitmap,this.uvs),B.bitmap.alphaTexture&&(this.texture.alphaTexture=new fB(B.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=B.height,this.texture.height=B.width,this.texture.offsetX=-B.offsetX,this.texture.offsetY=-B.offsetY,this.texture.sourceWidth=B.sourceHeight,this.texture.sourceHeight=B.sourceWidth):(this.texture.width=B.width,this.texture.height=B.height,this.texture.offsetX=-B.offsetX,this.texture.offsetY=-B.offsetY,this.texture.sourceWidth=B.sourceWidth,this.texture.sourceHeight=B.sourceHeight),F.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},g.destory=function(){this.texture&&this.texture.destroy()},B}(),RB=function(){function B(){this.name=null,this.displayArr=[]}return o(B,"laya.ani.bone.SlotData"),B.prototype.getDisplayByName=function(B){for(var g=0,l=this.displayArr.length;g<l;g++)if(this.displayArr[g].attachmentName==B)return g;return-1},B}(),v=function(){function B(B,g){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=N(2,0),this._data=B,null==this._bones&&(this._bones=[]),this.target=g[B.targetIndex];var l,o=0;for(o=0,l=B.boneIndexs.length;o<l;o++)this._bones.push(g[B.boneIndexs[o]]);this.rotateMix=B.rotateMix,this.translateMix=B.translateMix,this.scaleMix=B.scaleMix,this.shearMix=B.shearMix}return o(B,"laya.ani.bone.TfConstraint"),B.prototype.apply=function(){for(var B,g=this.target.resultMatrix.a,l=this.target.resultMatrix.b,o=this.target.resultMatrix.c,V=this.target.resultMatrix.d,U=0,y=this._bones.length;U<y;U++){if(B=this._bones[U],0<this.rotateMix){var G=B.resultMatrix.a,d=B.resultMatrix.b,j=B.resultMatrix.c,A=B.resultMatrix.d,H=Math.atan2(o,g)-Math.atan2(j,G)+this._data.offsetRotation*Math.PI/180;H>Math.PI?H-=2*Math.PI:H<-Math.PI&&(H+=2*Math.PI),H*=this.rotateMix;var K=Math.cos(H),p=Math.sin(H);B.resultMatrix.a=K*G-p*j,B.resultMatrix.b=K*d-p*A,B.resultMatrix.c=p*G+K*j,B.resultMatrix.d=p*d+K*A}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),B.resultMatrix.tx+=(this._temp[0]-B.resultMatrix.tx)*this.translateMix,B.resultMatrix.ty+=(this._temp[1]-B.resultMatrix.ty)*this.translateMix,B.updateChild()),0<this.scaleMix){var x=Math.sqrt(B.resultMatrix.a*B.resultMatrix.a+B.resultMatrix.c*B.resultMatrix.c),N=Math.sqrt(g*g+o*o),F=1e-5<x?(x+(N-x+this._data.offsetScaleX)*this.scaleMix)/x:0;B.resultMatrix.a*=F,B.resultMatrix.c*=F,x=Math.sqrt(B.resultMatrix.b*B.resultMatrix.b+B.resultMatrix.d*B.resultMatrix.d),N=Math.sqrt(l*l+V*V),F=1e-5<x?(x+(N-x+this._data.offsetScaleY)*this.scaleMix)/x:0,B.resultMatrix.b*=F,B.resultMatrix.d*=F}if(0<this.shearMix){d=B.resultMatrix.b,A=B.resultMatrix.d;var C=Math.atan2(A,d);(H=Math.atan2(V,l)-Math.atan2(o,g)-(C-Math.atan2(B.resultMatrix.c,B.resultMatrix.a)))>Math.PI?H-=2*Math.PI:H<-Math.PI&&(H+=2*Math.PI),H=C+(H+this._data.offsetShearY*Math.PI/180)*this.shearMix,F=Math.sqrt(d*d+A*A),B.resultMatrix.b=Math.cos(H)*F,B.resultMatrix.d=Math.sin(H)*F}}},B}(),WB=function(){function B(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return o(B,"laya.ani.bone.TfConstraintData"),B}(),nB=function(){function B(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}o(B,"laya.ani.bone.Transform");var g=B.prototype;return g.initData=function(B){null!=B.x&&(this.x=B.x),null!=B.y&&(this.y=B.y),null!=B.skX&&(this.skX=B.skX),null!=B.skY&&(this.skY=B.skY),null!=B.scX&&(this.scX=B.scX),null!=B.scY&&(this.scY=B.scY)},g.getMatrix=function(){var B;return(B=this.mMatrix?this.mMatrix:this.mMatrix=new hB).identity(),B.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(B,this.skewX*Math.PI/180,this.skewY*Math.PI/180),B.rotate(this.skX*Math.PI/180),B.translate(this.x,this.y),B},g.skew=function(B,g,l){var o=Math.sin(l),V=Math.cos(l),U=Math.sin(g),y=Math.cos(g);return B.setTo(B.a*y-B.b*o,B.a*U+B.b*V,B.c*y-B.d*o,B.c*U+B.d*V,B.tx*y-B.ty*o,B.tx*U+B.ty*V),B},B}(),s=function(){function B(){}return o(B,"laya.ani.bone.UVTools"),B.getRelativeUV=function(B,g,l){var o=B[0],V=B[2]-B[0],U=B[1],y=B[5]-B[1];l||(l=[]),l.length=g.length;var G,d=0;G=l.length;var j=1/V,A=1/y;for(d=0;d<G;d+=2)l[d]=(g[d]-o)*j,l[d+1]=(g[d+1]-U)*A;return l},B.getAbsoluteUV=function(B,g,l){if(0==B[0]&&0==B[1]&&1==B[4]&&1==B[5])return l?(C.copyArray(l,g),l):g;var o=B[0],V=B[2]-B[0],U=B[1],y=B[5]-B[1];l||(l=[]),l.length=g.length;var G,d=0;for(G=l.length,d=0;d<G;d+=2)l[d]=g[d]*V+o,l[d+1]=g[d+1]*y+U;return l},B}(),S=function(){function B(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return o(B,"laya.ani.KeyFramesContent"),B}(),X=function(){function A(){}return o(A,"laya.ani.math.BezierLerp"),A.getBezierRate=function(B,g,l,o,V){var U=A._getBezierParamKey(g,l,o,V),y=100*U+B;if(A._bezierResultCache[y])return A._bezierResultCache[y];var G,d=A._getBezierPoints(g,l,o,V,U),j=0;for(G=d.length,j=0;j<G;j+=2)if(B<=d[j])return A._bezierResultCache[y]=d[j+1],d[j+1];return A._bezierResultCache[y]=1},A._getBezierParamKey=function(B,g,l,o){return 100*(100*(100*(100*B+g)+l)+o)},A._getBezierPoints=function(B,g,l,o,V){return A._bezierPointsCache[V]?A._bezierPointsCache[V]:(U=[0,0,B,g,l,o,1,1],y=(new G).getBezierPoints(U,100,3),A._bezierPointsCache[V]=y);var U,y},A._bezierResultCache={},A._bezierPointsCache={},A}(),w=function(B){function g(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,g.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}o(g,"laya.ani.AnimationPlayer",V);var l=g.prototype;return VB.imps(l,{"laya.resource.IDestroy":!0}),l._onTempletLoadedComputeFullKeyframeIndices=function(B,g,l){this._templet===l&&this._cachePlayRate===B&&this._cacheFrameRate===g&&this._computeFullKeyframeIndices()},l._computeFullKeyframeIndices=function(){for(var B=this._fullFrames=[],g=this._templet,l=this._cacheFrameRateInterval*this._cachePlayRate,o=0,V=g.getAnimationCount();o<V;o++){for(var U=[],y=0,G=g.getAnimation(o).nodes.length;y<G;y++){for(var d=g.getAnimation(o).nodes[y],j=Math.floor(d.playTime/l+.01),A=new Uint16Array(j+1),H=-1,K=0,p=d.keyFrame.length;K<p;K++){var x=d.keyFrame[K],N=x.startTime,F=N+x.duration+l;do{for(var C=Math.floor(N/l+.5),m=H+1;m<C;m++)A[m]=K;A[H=C]=K,N+=l}while(N<=F)}U.push(A)}B.push(U)}},l._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},l._calculatePlayDuration=function(){if(0!==this.state){var B=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=B),this._playEnd>B&&(this._playEnd=B),this._playDuration=this._playEnd-this._playStart}},l._setPlayParams=function(B,g){this._currentTime=B,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/g+.01),0),this._currentFrameTime=this._currentKeyframeIndex*g},l._setPlayParamsWhenStop=function(B,g){this._currentTime=B,this._currentKeyframeIndex=Math.max(Math.floor(B/g+.01),0),this._currentFrameTime=this._currentKeyframeIndex*g,this._currentAnimationClipIndex=-1},l._update=function(B){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var g=this._cacheFrameRateInterval*this._cachePlayRate,l=0;this._startUpdateLoopCount!==x.loopCount&&(l=B*this.playbackRate,this._elapsedPlaybackTime+=l);var o=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=o)return this._setPlayParamsWhenStop(o,g),void this.event("stopped");if(l+=this._currentTime,0<o)if(o<=l)do{if(l-=o,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(o,g),this._stopWhenCircleFinish=!1,void this.event("stopped");l<o&&(this._setPlayParams(l,g),this.event("complete"))}while(o<=l);else this._setPlayParams(l,g);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(o,g),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},l._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},l.play=function(B,g,l,o,V){if(void 0===B&&(B=0),void 0===g&&(g=1),void 0===l&&(l=2147483647),void 0===o&&(o=0),void 0===V&&(V=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(l<0||o<0||V<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==V&&V<o)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=g,this._overallDuration=l,this._playStart=o,this._playEnd=V,this._paused=!1,this._currentAnimationClipIndex=B,this._currentKeyframeIndex=0,this._startUpdateLoopCount=x.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},l.playByFrame=function(B,g,l,o,V,U){void 0===B&&(B=0),void 0===g&&(g=1),void 0===l&&(l=2147483647),void 0===o&&(o=0),void 0===V&&(V=0),void 0===U&&(U=30);var y=1e3/U;this.play(B,g,l,o*y,V*y)},l.stop=function(B){void 0===B&&(B=!0),B?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},U(0,l,"playEnd",function(){return this._playEnd}),U(0,l,"templet",function(){return this._templet},function(B){0===!this.state&&this.stop(!0),this._templet!==B&&((this._templet=B).loaded?this._computeFullKeyframeIndices():B.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),U(0,l,"playStart",function(){return this._playStart}),U(0,l,"playDuration",function(){return this._playDuration}),U(0,l,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),U(0,l,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),U(0,l,"overallDuration",function(){return this._overallDuration}),U(0,l,"currentFrameTime",function(){return this._currentFrameTime}),U(0,l,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),U(0,l,"currentPlayTime",function(){return this._currentTime+this._playStart}),U(0,l,"cachePlayRate",function(){return this._cachePlayRate},function(B){this._cachePlayRate!==B&&(this._cachePlayRate=B,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[B,this._cacheFrameRate])))}),U(0,l,"cacheFrameRate",function(){return this._cacheFrameRate},function(B){this._cacheFrameRate!==B&&(this._cacheFrameRate=B,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,B])))}),U(0,l,"currentTime",null,function(B){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(B<this._playStart||B>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=x.loopCount;var g=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=B,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/g),0),this._currentFrameTime=this._currentKeyframeIndex*g}}),U(0,l,"paused",function(){return this._paused},function(B){(this._paused=B)&&this.event("paused")}),U(0,l,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),U(0,l,"destroyed",function(){return this._destroyed}),g}(),E=function(B){function g(){g.__super.call(this),F.isConchNode&&(this.drawSkin=function(B){B.transform||(B.transform=hB.EMPTY),this._addCmd([B]),this.setSkinMesh&&this.setSkinMesh(B._ps,B.mVBData,B.mEleNum,0,B.mTexture,B.transform)})}return o(g,"laya.ani.GraphicsAni",y),g.prototype.drawSkin=function(B){var g=[B];this._saveToCmd(F._context._drawSkin,g)},g.create=function(){return g._caches.pop()||new g},g.recycle=function(B){B.clear(),g._caches.push(B)},g._caches=[],g}(),e=function(B){function m(){this._aniMap={},this.unfixedLastAniIndex=-1,m.__super.call(this),this._anis=new Array}o(m,"laya.ani.AnimationTemplet",A);var g=m.prototype;return g.parse=function(B){var g=new tB(B);this._aniVersion=g.readUTFString(),M.parse(this,g)},g._calculateKeyFrame=function(B,g,l){var o=B.keyFrame;o[g]=o[0];for(var V=0;V<g;V++){var U=o[V];U.nextData=0===U.duration?U.data:o[V+1].data}o.length--},g.onAsynLoaded=function(B,g,l){var o=new tB(g);switch(this._aniVersion=o.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":b.parse(this,o);break;default:M.parse(this,o)}this._endLoaded()},g.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},g.getAnimationCount=function(){return this._anis.length},g.getAnimation=function(B){return this._anis[B]},g.getAniDuration=function(B){return this._anis[B].playTime},g.getNodes=function(B){return this._anis[B].nodes},g.getNodeIndexWithName=function(B,g){return this._anis[B].bone3DMap[g]},g.getNodeCount=function(B){return this._anis[B].nodes.length},g.getTotalkeyframesLength=function(B){return this._anis[B].totalKeyframeDatasLength},g.getPublicExtData=function(){return this._publicExtData},g.getAnimationDataWithCache=function(B,g,l,o){var V=g[l];if(V){var U=V[B];return U?U[o]:null}return null},g.setAnimationDataWithCache=function(B,g,l,o,V){var U=g[l]||(g[l]={});(U[B]||(U[B]=[]))[o]=V},g.getOriginalData=function(B,g,l,o,V){for(var U=this._anis[B].nodes,y=0,G=0,d=U.length,j=0;G<d;G++){var A,H=U[G];A=H.keyFrame[l[G][o]],H.dataOffset=j;var K=V-A.startTime,p=H.lerpType;if(p)switch(p){case 0:case 1:for(y=0;y<H.keyframeWidth;)y+=H.interpolationMethod[y](H,y,g,j+y,A.data,K,null,A.duration,A.nextData);break;case 2:var x=A.interpolationData,N=x.length,F=0;for(y=0;y<N;){var C=x[y];switch(C){case 6:case 7:y+=m.interpolation[C](H,F,g,j+F,A.data,K,null,A.duration,A.nextData,x,y+1);break;default:y+=m.interpolation[C](H,F,g,j+F,A.data,K,null,A.duration,A.nextData)}F++}}else for(y=0;y<H.keyframeWidth;)y+=H.interpolationMethod[y](H,y,g,j+y,A.data,K,null,A.duration,A.nextData);j+=H.keyframeWidth}},g.getNodesCurrentFrameIndex=function(B,g){var l=this._anis[B].nodes;B!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(l.length),this.unfixedCurrentTimes=new Float32Array(l.length),this.unfixedLastAniIndex=B);for(var o=0,V=l.length;o<V;o++){var U=l[o];for(g<this.unfixedCurrentTimes[o]&&(this.unfixedCurrentFrameIndexes[o]=0),this.unfixedCurrentTimes[o]=g;this.unfixedCurrentFrameIndexes[o]<U.keyFrame.length&&!(U.keyFrame[this.unfixedCurrentFrameIndexes[o]].startTime>this.unfixedCurrentTimes[o]);)this.unfixedCurrentFrameIndexes[o]++;this.unfixedCurrentFrameIndexes[o]--}return this.unfixedCurrentFrameIndexes},g.getOriginalDataUnfixedRate=function(B,g,l){var o=this._anis[B].nodes;B!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(o.length),this.unfixedCurrentTimes=new Float32Array(o.length),this.unfixedKeyframes=N(o.length),this.unfixedLastAniIndex=B);for(var V=0,U=0,y=o.length,G=0;U<y;U++){var d=o[U];for(l<this.unfixedCurrentTimes[U]&&(this.unfixedCurrentFrameIndexes[U]=0),this.unfixedCurrentTimes[U]=l;this.unfixedCurrentFrameIndexes[U]<d.keyFrame.length&&!(d.keyFrame[this.unfixedCurrentFrameIndexes[U]].startTime>this.unfixedCurrentTimes[U]);)this.unfixedKeyframes[U]=d.keyFrame[this.unfixedCurrentFrameIndexes[U]],this.unfixedCurrentFrameIndexes[U]++;var j=this.unfixedKeyframes[U];d.dataOffset=G;var A=l-j.startTime;if(d.lerpType)switch(d.lerpType){case 0:case 1:for(V=0;V<d.keyframeWidth;)V+=d.interpolationMethod[V](d,V,g,G+V,j.data,A,null,j.duration,j.nextData);break;case 2:var H=j.interpolationData,K=H.length,p=0;for(V=0;V<K;){var x=H[V];switch(x){case 6:case 7:V+=m.interpolation[x](d,p,g,G+p,j.data,A,null,j.duration,j.nextData,H,V+1);break;default:V+=m.interpolation[x](d,p,g,G+p,j.data,A,null,j.duration,j.nextData)}p++}}else for(V=0;V<d.keyframeWidth;)V+=d.interpolationMethod[V](d,V,g,G+V,j.data,A,null,j.duration,j.nextData);G+=d.keyframeWidth}},m._LinearInterpolation_0=function(B,g,l,o,V,U,y,G,d,j){var A=0===G?0:U/G;return l[o]=(1-A)*V[g]+A*d[g],1},m._QuaternionInterpolation_1=function(B,g,l,o,V,U,y,G,d,j){var A=0===G?0:U/G;return K.slerpQuaternionArray(V,g,d,g,A,l,o),4},m._AngleInterpolation_2=function(B,g,l,o,V,U,y,G,d,j){return 0},m._RadiansInterpolation_3=function(B,g,l,o,V,U,y,G,d,j){return 0},m._Matrix4x4Interpolation_4=function(B,g,l,o,V,U,y,G,d,j){for(var A=0;A<16;A++,g++)l[o+A]=V[g]+U*y[g];return 16},m._NoInterpolation_5=function(B,g,l,o,V,U,y,G,d,j){return l[o]=V[g],1},m._BezierInterpolation_6=function(B,g,l,o,V,U,y,G,d,j,A){return void 0===A&&(A=0),l[o]=V[g]+(d[g]-V[g])*X.getBezierRate(U/G,j[A],j[A+1],j[A+2],j[A+3]),5},m._BezierInterpolation_7=function(B,g,l,o,V,U,y,G,d,j,A){return void 0===A&&(A=0),l[o]=j[A+4]+j[A+5]*X.getBezierRate((.001*U+j[A+6])/j[A+7],j[A],j[A+1],j[A+2],j[A+3]),9},m.load=function(B){return VB.loader.create(B,null,null,m)},m.interpolation=[m._LinearInterpolation_0,m._QuaternionInterpolation_1,m._AngleInterpolation_2,m._RadiansInterpolation_3,m._Matrix4x4Interpolation_4,m._NoInterpolation_5,m._BezierInterpolation_6,m._BezierInterpolation_7],m}(),i=function(g){function l(B,g){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,l.__super.call(this),void 0===g&&(g=0),B&&this.init(B,g)}o(l,"laya.ani.bone.Skeleton",g);var B=l.prototype;return B.init=function(B,g){void 0===g&&(g=0);var l,o,V,U=0,y=0;if(1==g)for(this._graphicsCache=[],U=0,y=B.getAnimationCount();U<y;U++)this._graphicsCache.push([]);if(this._yReverseMatrix=B.yReverseMatrix,this._aniMode=g,this._templet=B,this._player=new w,this._player.cacheFrameRate=B.rate,this._player.templet=B,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=B.mBoneArr,this._rootBone=B.mRootBone,this._aniSectionDic=B.aniSectionDic,0<B.ikArr.length)for(this._ikArr=[],U=0,y=B.ikArr.length;U<y;U++)this._ikArr.push(new m(B.ikArr[U],this._boneList));if(0<B.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),U=0,y=B.pathArr.length;U<y;U++)l=B.pathArr[U],o=new D(l,this._boneList),(V=this._boneSlotDic[l.name])&&((o=new D(l,this._boneList)).target=V),this._pathDic[l.name]=o;if(0<B.tfArr.length)for(this._tfArr=[],U=0,y=B.tfArr.length;U<y;U++)this._tfArr.push(new v(B.tfArr[U],this._boneList));if(0<B.skinDataArray.length){var G=this._templet.skinDataArray[this._skinIndex];this._skinName=G.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},B.load=function(B,g,l){},B._onLoaded=function(){},B._parseComplete=function(){var B=a.TEMPLET_DICTIONARY[this._aniPath];B&&(this.init(B,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},B._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},B._onPlay=function(){this.event("played")},B._onStop=function(){var B,g=this._templet.eventAniArr[this._aniClipIndex];if(g&&this._eventIndex<g.length)for(;this._eventIndex<g.length;this._eventIndex++)(B=g[this._eventIndex]).time>=this._player.playStart&&B.time<=this._player.playEnd&&this.event("label",B);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},B._onPause=function(){this.event("paused")},B._parseSrcBoneMatrix=function(){var B=0,g=0;for(g=this._templet.srcBoneMatrixArr.length,B=0;B<g;B++)this._boneMatrixArray.push(new hB);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var l,o,V=this._templet.boneSlotArray;for(B=0,g=V.length;B<g;B++)l=V[B],null==(o=this._bindBoneBoneSlotDic[l.parent])&&(this._bindBoneBoneSlotDic[l.parent]=o=[]),this._boneSlotDic[l.name]=l=l.copy(),o.push(l),this._boneSlotArray.push(l)}},B._emitMissedEvents=function(B,g,l){void 0===l&&(l=0);var o=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(o){var V,U,y=0;for(V=o.length,y=l;y<V;y++)(U=o[y]).time>=this._player.playStart&&U.time<=this._player.playEnd&&this.event("label",U)}},B._update=function(B){if(void 0===B&&(B=!0),!(this._pause||B&&this._indexControl)){var g=this.timer.currTimer,l=this._player.currentKeyframeIndex,o=g-this._lastTime;if(B?this._player._update(o):l=-1,this._lastTime=g,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<o&&this._clipIndex==l&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var V;this._lastUpdateAniClipIndex=this._aniClipIndex,l>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var U,y=this._templet.eventAniArr[this._aniClipIndex];if(y&&this._eventIndex<y.length&&((V=y[this._eventIndex]).time>=this._player.playStart&&V.time<=this._player.playEnd?this._player.currentPlayTime>=V.time&&(this.event("label",V),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(U=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=U&&(this.graphics=U));var G=0,d=0;for(d=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,d-1)&&0<d;)d--;if(d<this._clipIndex)for(G=d;G<this._clipIndex;G++)this._createGraphics(G)}else if(1==this._aniMode){if(U=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=U&&(this.graphics=U));for(d=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,d-1)&&0<d;)d--;if(d<this._clipIndex)for(G=d;G<this._clipIndex;G++)this._createGraphics(G)}this._createGraphics()}}},B._createGraphics=function(B){void 0===B&&(B=-1),-1==B&&(B=this._clipIndex);var g,l,o=B*this._player.cacheFrameRateInterval,V=this._templet.drawOrderAniArr[this._aniClipIndex];if(V&&0<V.length)for(this._drawOrderIndex=0,g=V[this._drawOrderIndex];o>=g.time&&(this._drawOrder=g.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=V.length));)g=V[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=E.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=E.create(),l=this.graphics;var U=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],B,o);var y,G,d,j,A=this._aniSectionDic[this._aniClipIndex],H=0,K=0,p=0,x=0,N=0,F=this._templet.srcBoneMatrixArr.length;for(N=A[K=0];K<F;K++)j=this._boneList[K],d=this._templet.srcBoneMatrixArr[K],j.resultTransform.scX=d.scX*this._curOriginalData[H++],j.resultTransform.skX=d.skX+this._curOriginalData[H++],j.resultTransform.skY=d.skY+this._curOriginalData[H++],j.resultTransform.scY=d.scY*this._curOriginalData[H++],j.resultTransform.x=d.x+this._curOriginalData[H++],j.resultTransform.y=d.y+this._curOriginalData[H++],8===this._templet.tMatrixDataLen&&(j.resultTransform.skewX=d.skewX+this._curOriginalData[H++],j.resultTransform.skewY=d.skewY+this._curOriginalData[H++]);var C,m={},M={};for(N+=A[1];K<N;K++)m[(C=U[K]).name]=this._curOriginalData[H++],M[C.name]=this._curOriginalData[H++],this._curOriginalData[H++],this._curOriginalData[H++],this._curOriginalData[H++],this._curOriginalData[H++];var b,D,v={},s={};for(N+=A[2];K<N;K++)v[(C=U[K]).name]=this._curOriginalData[H++],s[C.name]=this._curOriginalData[H++],this._curOriginalData[H++],this._curOriginalData[H++],this._curOriginalData[H++],this._curOriginalData[H++];if(this._pathDic)for(N+=A[3];K<N;K++){if(C=U[K],b=this._pathDic[C.name])switch(new tB(C.extenData).getByte()){case 1:b.position=this._curOriginalData[H++];break;case 2:b.spacing=this._curOriginalData[H++];break;case 3:b.rotateMix=this._curOriginalData[H++],b.translateMix=this._curOriginalData[H++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(hB.TEMP.identity()),this._ikArr)for(K=0,N=this._ikArr.length;K<N;K++)D=this._ikArr[K],v.hasOwnProperty(D.name)&&(D.bendDirection=v[D.name]),s.hasOwnProperty(D.name)&&(D.mix=s[D.name]),D.apply();if(this._pathDic)for(var X in this._pathDic)(b=this._pathDic[X]).apply(this._boneList,l);if(this._tfArr)for(K=0,x=this._tfArr.length;K<x;K++)this._tfArr[K].apply();for(K=0,x=this._boneList.length;K<x;K++)if(j=this._boneList[K],G=this._bindBoneBoneSlotDic[j.name],j.resultMatrix.copyTo(this._boneMatrixArray[K]),G)for(p=0,N=G.length;p<N;p++)(y=G[p])&&y.setParentMatrix(j.resultMatrix);var w,i,a,z,t={},h=this._templet.deformAniArr;if(h&&0<h.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,K=0,N=this._boneSlotArray.length;K<N;K++)(y=this._boneSlotArray[K]).deformData=null;var f,S=h[this._aniClipIndex];for(f in w=S.default,this._setDeform(w,t,this._boneSlotArray,o),S)"default"!=f&&f!=this._skinName&&(w=S[f],this._setDeform(w,t,this._boneSlotArray,o));w=S[this._skinName],this._setDeform(w,t,this._boneSlotArray,o)}if(this._drawOrder)for(K=0,N=this._drawOrder.length;K<N;K++)i=m[(y=this._boneSlotArray[this._drawOrder[K]]).name],a=M[y.name],isNaN(a)||(l.save(),l.alpha(a)),isNaN(i)||-2==i||(this._templet.attachmentNames?y.showDisplayByName(this._templet.attachmentNames[i]):y.showDisplayByIndex(i)),t[this._drawOrder[K]]?(z=t[this._drawOrder[K]],y.currDisplayData&&z[y.currDisplayData.attachmentName]?y.deformData=z[y.currDisplayData.attachmentName]:y.deformData=null):y.deformData=null,isNaN(a)?y.draw(l,this._boneMatrixArray,2==this._aniMode):y.draw(l,this._boneMatrixArray,2==this._aniMode,a),isNaN(a)||l.restore();else for(K=0,N=this._boneSlotArray.length;K<N;K++)i=m[(y=this._boneSlotArray[K]).name],a=M[y.name],isNaN(a)||(l.save(),l.alpha(a)),isNaN(i)||-2==i||(this._templet.attachmentNames?y.showDisplayByName(this._templet.attachmentNames[i]):y.showDisplayByIndex(i)),t[K]?(z=t[K],y.currDisplayData&&z[y.currDisplayData.attachmentName]?y.deformData=z[y.currDisplayData.attachmentName]:y.deformData=null):y.deformData=null,isNaN(a)?y.draw(l,this._boneMatrixArray,2==this._aniMode):y.draw(l,this._boneMatrixArray,2==this._aniMode,a),isNaN(a)||l.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,B,l):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,B,l)},B._setDeform=function(B,g,l,o){if(B){var V,U,y,G=0,d=0,j=0;if(B)for(G=0,d=B.deformSlotDataList.length;G<d;G++)for(V=B.deformSlotDataList[G],j=0;j<V.deformSlotDisplayList.length;j++)y=l[(U=V.deformSlotDisplayList[j]).slotIndex],U.apply(o,y),g[U.slotIndex]||(g[U.slotIndex]={}),g[U.slotIndex][U.attachment]=U.deformData}},B.getAnimNum=function(){return this._templet.getAnimationCount()},B.getAniNameByIndex=function(B){return this._templet.getAniNameByIndex(B)},B.getSlotByName=function(B){return this._boneSlotDic[B]},B.showSkinByName=function(B,g){void 0===g&&(g=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(B),g)},B.showSkinByIndex=function(B,g){void 0===g&&(g=!0);for(var l=0;l<this._boneSlotArray.length;l++)this._boneSlotArray[l].showSlotData(null,g);if(this._templet.showSkinByIndex(this._boneSlotDic,B,g)){var o=this._templet.skinDataArray[B];this._skinIndex=B,this._skinName=o.name}this._clearCache()},B.showSlotSkinByIndex=function(B,g){if(0!=this._aniMode){var l=this.getSlotByName(B);l&&l.showDisplayByIndex(g),this._clearCache()}},B.showSlotSkinByName=function(B,g){if(0!=this._aniMode){var l=this.getSlotByName(B);l&&l.showDisplayByName(g),this._clearCache()}},B.replaceSlotSkinName=function(B,g,l){if(0!=this._aniMode){var o=this.getSlotByName(B);o&&o.replaceDisplayByName(g,l),this._clearCache()}},B.replaceSlotSkinByIndex=function(B,g,l){if(0!=this._aniMode){var o=this.getSlotByName(B);o&&o.replaceDisplayByIndex(g,l),this._clearCache()}},B.setSlotSkin=function(B,g){if(0!=this._aniMode){var l=this.getSlotByName(B);l&&l.replaceSkin(g),this._clearCache()}},B._clearCache=function(){if(1==this._aniMode)for(var B=0,g=this._graphicsCache.length;B<g;B++){for(var l=0,o=this._graphicsCache[B].length;l<o;l++){var V=this._graphicsCache[B][l];V!=this.graphics&&E.recycle(V)}this._graphicsCache[B].length=0}},B.play=function(B,g,l,o,V,U){void 0===l&&(l=!0),void 0===o&&(o=0),void 0===V&&(V=0),void 0===U&&(U=!0),this._indexControl=!1;var y=-1,G=NaN;if(G=g?2147483647:0,"string"==typeof B)for(var d=0,j=this._templet.getAnimationCount();d<j;d++){var A=this._templet.getAnimation(d);if(A&&B==A.name){y=d;break}}else y=B;-1<y&&y<this.getAnimNum()&&(this._aniClipIndex=y,(l||this._pause||this._currAniIndex!=y)&&(this._currAniIndex=y,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(y)),this._drawOrder=null,this._eventIndex=0,this._player.play(y,this._player.playbackRate,G,o,V),U&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=H.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},B.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},B.playbackRate=function(B){this._player&&(this._player.playbackRate=B)},B.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},B.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=H.now(),this.timer.frameLoop(1,this,this._update,null,!0))},B._getGrahicsDataWithCache=function(B,g){return this._graphicsCache[B][g]},B._setGrahicsDataWithCache=function(B,g,l){this._graphicsCache[B][g]=l},B.destroy=function(B){void 0===B&&(B=!0),g.prototype.destroy.call(this,B),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},U(0,B,"url",function(){return this._aniPath},function(B){this.load(B)}),U(0,B,"index",function(){return this._index},function(B){this.player&&(this._index=B,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),U(0,B,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),U(0,B,"templet",function(){return this._templet}),U(0,B,"player",function(){return this._player}),l.useSimpleMeshInCanvas=!1,l}(UB),a=function(g){function V(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,V.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}o(V,"laya.ani.bone.Templet",g);var B=V.prototype;return B.getLoadList=function(){return this._loadList},B.loadAni=function(B){this._skBufferUrl=B,VB.loader.load(B,d.create(this,this.onComplete),null,"arraybuffer")},B.onComplete=function(B){if(this._isDestroyed)this.destroy();else{var g=j.getRes(this._skBufferUrl);g?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,g)):this.event("error","load failed:"+this._skBufferUrl)}},B.parseData=function(B,g,l){void 0===l&&(l=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=B,this._mainTexture&&F.isWebGL&&B.bitmap&&(B.bitmap.enableMerageInAtlas=!1),this._rate=l,this.parse(g)},B.buildArmature=function(B){return void 0===B&&(B=0),new i(this,B)},B.parse=function(B){g.prototype.parse.call(this,B),this._endLoaded(),this._aniVersion!=V.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+V.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},B._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var B=0;this._loadList=[];var g,l=new tB(this.getPublicExtData()),o=0,V=0,U=0,y=l.getInt32(),G=l.readUTFString(),d=G.split("\n");for(B=0;B<y;B++)g=this._path+d[2*B],G=d[2*B+1],l.getFloat32(),l.getFloat32(),o=l.getFloat32(),V=l.getFloat32(),U=l.getFloat32(),isNaN(U)?0:U,U=l.getFloat32(),isNaN(U)?0:U,U=l.getFloat32(),isNaN(U)?o:U,U=l.getFloat32(),isNaN(U)?V:U,-1==this._loadList.indexOf(g)&&this._loadList.push(g);this.event("inited",this)}},B._textureComplete=function(){for(var B,g,l=0,o=this._loadList.length;l<o;l++)g=this._loadList[l],B=this._textureDic[g]=j.getRes(g),F.isWebGL&&B&&B.bitmap&&(B.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},B._parsePublicExtData=function(){var B=0,g=0,l=0,o=0,V=0;for(B=0,V=this.getAnimationCount();B<V;B++)this._graphicsCache.push([]);var U;U="Dragon"!=this._aniClassName;var y,G,d=new tB(this.getPublicExtData()),j=0,A=0,H=0,K=0,p=0,x=0,N=0,F=0,C=0,m=d.getInt32(),M=d.readUTFString(),b=M.split("\n");for(B=0;B<m;B++){if(y=this._mainTexture,G=this._path+b[2*B],M=b[2*B+1],null==this._mainTexture&&(y=this._textureDic[G]),!y)return this.event("error",this),void(this.isParseFail=!0);j=d.getFloat32(),A=d.getFloat32(),H=d.getFloat32(),K=d.getFloat32(),C=d.getFloat32(),p=isNaN(C)?0:C,C=d.getFloat32(),x=isNaN(C)?0:C,C=d.getFloat32(),N=isNaN(C)?H:C,C=d.getFloat32(),F=isNaN(C)?K:C,this.subTextureDic[M]=fB.create(y,j,A,H,K,-p,-x,N,F),y.alphaTexture&&(this.subTextureDic[M].alphaTexture=fB.create(y.alphaTexture,j,A,H,K,-p,-x,N,F))}this._mainTexture=y;var D,v,s,X,w,i=d.getUint16();for(B=0;B<i;B++)(D=[]).push(d.getUint16()),D.push(d.getUint16()),D.push(d.getUint16()),D.push(d.getUint16()),this.aniSectionDic[B]=D;var a,z=d.getInt16(),t={};for(B=0;B<z;B++)v=new SB,0==B?a=v:v.root=a,v.d=U?-1:1,X=d.readUTFString(),w=d.readUTFString(),v.length=d.getFloat32(),1==d.getByte()&&(v.inheritRotation=!1),1==d.getByte()&&(v.inheritScale=!1),v.name=X,w&&((s=t[w])?s.addChild(v):this.mRootBone=v),t[X]=v,this.mBoneArr.push(v);this.tMatrixDataLen=d.getUint16();var h,f,S=d.getUint16(),E=Math.floor(S/this.tMatrixDataLen),e=this.srcBoneMatrixArr;for(B=0;B<E;B++)(h=new nB).scX=d.getFloat32(),h.skX=d.getFloat32(),h.skY=d.getFloat32(),h.scY=d.getFloat32(),h.x=d.getFloat32(),h.y=d.getFloat32(),8===this.tMatrixDataLen&&(h.skewX=d.getFloat32(),h.skewY=d.getFloat32()),e.push(h),(v=this.mBoneArr[B]).transform=h;var Q,_=d.getUint16(),P=0;for(B=0;B<_;B++){for(f=new cB,P=d.getUint16(),g=0;g<P;g++)f.boneNames.push(d.readUTFString()),f.boneIndexs.push(d.getInt16());f.name=d.readUTFString(),f.targetBoneName=d.readUTFString(),f.targetBoneIndex=d.getInt16(),f.bendDirection=d.getFloat32(),f.mix=d.getFloat32(),f.isSpine=U,this.ikArr.push(f)}var Y,c=d.getUint16(),r=0;for(B=0;B<c;B++){for(Q=new WB,r=d.getUint16(),g=0;g<r;g++)Q.boneIndexs.push(d.getInt16());Q.name=d.getUTFString(),Q.targetIndex=d.getInt16(),Q.rotateMix=d.getFloat32(),Q.translateMix=d.getFloat32(),Q.scaleMix=d.getFloat32(),Q.shearMix=d.getFloat32(),Q.offsetRotation=d.getFloat32(),Q.offsetX=d.getFloat32(),Q.offsetY=d.getFloat32(),Q.offsetScaleX=d.getFloat32(),Q.offsetScaleY=d.getFloat32(),Q.offsetShearY=d.getFloat32(),this.tfArr.push(Q)}var Z=d.getUint16(),T=0;for(B=0;B<Z;B++){for((Y=new rB).name=d.readUTFString(),T=d.getUint16(),g=0;g<T;g++)Y.bones.push(d.getInt16());Y.target=d.readUTFString(),Y.positionMode=d.readUTFString(),Y.spacingMode=d.readUTFString(),Y.rotateMode=d.readUTFString(),Y.offsetRotation=d.getFloat32(),Y.position=d.getFloat32(),Y.spacing=d.getFloat32(),Y.rotateMix=d.getFloat32(),Y.translateMix=d.getFloat32(),this.pathArr.push(Y)}var R,W,n,L,I,k=0,J=0,$=0,u=NaN,q=0,O=d.getInt16();for(B=0;B<O;B++){var BB=d.getUint8(),gB={};this.deformAniArr.push(gB);for(var lB=0;lB<BB;lB++)for((R=new eB).skinName=d.getUTFString(),gB[R.skinName]=R,k=d.getInt16(),g=0;g<k;g++)for(W=new QB,R.deformSlotDataList.push(W),J=d.getInt16(),l=0;l<J;l++)for(n=new _B,W.deformSlotDisplayList.push(n),n.slotIndex=d.getInt16(),n.attachment=d.getUTFString(),$=d.getInt16(),o=0;o<$;o++)for(1==d.getByte()?n.tweenKeyList.push(!0):n.tweenKeyList.push(!1),u=d.getFloat32(),n.timeList.push(u),L=[],n.vectices.push(L),q=d.getInt16(),V=0;V<q;V++)L.push(d.getFloat32())}var oB,VB,UB=d.getInt16(),yB=0,GB=0;for(B=0;B<UB;B++){for(yB=d.getInt16(),I=[],g=0;g<yB;g++){for((oB=new PB).time=d.getFloat32(),GB=d.getInt16(),l=0;l<GB;l++)oB.drawOrder.push(d.getInt16());I.push(oB)}this.drawOrderAniArr.push(I)}var dB,jB=d.getInt16(),AB=0;for(B=0;B<jB;B++){for(AB=d.getInt16(),VB=[],g=0;g<AB;g++)(dB=new YB).name=d.getUTFString(),dB.intValue=d.getInt32(),dB.floatValue=d.getFloat32(),dB.stringValue=d.getUTFString(),dB.time=d.getFloat32(),VB.push(dB);this.eventAniArr.push(VB)}var HB=d.getInt16();if(0<HB)for(this.attachmentNames=[],B=0;B<HB;B++)this.attachmentNames.push(d.getUTFString());var KB,pB,xB=d.getInt16();for(B=0;B<xB;B++)(KB=new EB).name=d.readUTFString(),KB.parent=d.readUTFString(),KB.attachmentName=d.readUTFString(),KB.srcDisplayIndex=KB.displayIndex=d.getInt16(),(KB.templet=this).boneSlotDic[KB.name]=KB,null==(pB=this.bindBoneBoneSlotDic[KB.parent])&&(this.bindBoneBoneSlotDic[KB.parent]=pB=[]),pB.push(KB),this.boneSlotArray.push(KB);var NB,FB,CB,mB=d.readUTFString().split("\n"),MB=0,bB=d.getUint8(),DB=0,vB=0,sB=0,XB=0,wB=0,iB=0,aB=0;for(B=0;B<bB;B++){for((NB=new ZB).name=mB[MB++],DB=d.getUint8(),g=0;g<DB;g++){for((FB=new RB).name=mB[MB++],KB=this.boneSlotDic[FB.name],vB=d.getUint8(),l=0;l<vB;l++){if(CB=new TB,this.skinSlotDisplayDataArr.push(CB),CB.name=mB[MB++],CB.attachmentName=mB[MB++],CB.transform=new nB,CB.transform.scX=d.getFloat32(),CB.transform.skX=d.getFloat32(),CB.transform.skY=d.getFloat32(),CB.transform.scY=d.getFloat32(),CB.transform.x=d.getFloat32(),CB.transform.y=d.getFloat32(),FB.displayArr.push(CB),CB.width=d.getFloat32(),CB.height=d.getFloat32(),CB.type=d.getUint8(),CB.verLen=d.getUint16(),0<(z=d.getUint16()))for(CB.bones=[],o=0;o<z;o++){var zB=d.getUint16();CB.bones.push(zB)}if(0<(sB=d.getUint16()))for(CB.uvs=[],o=0;o<sB;o++)CB.uvs.push(d.getFloat32());if(0<(XB=d.getUint16()))for(CB.weights=[],o=0;o<XB;o++)CB.weights.push(d.getFloat32());if(0<(wB=d.getUint16()))for(CB.triangles=[],o=0;o<wB;o++)CB.triangles.push(d.getUint16());if(0<(iB=d.getUint16()))for(CB.vertices=[],o=0;o<iB;o++)CB.vertices.push(d.getFloat32());if(0<(aB=d.getUint16()))for(CB.lengths=[],o=0;o<aB;o++)CB.lengths.push(d.getFloat32())}NB.slotArr.push(FB)}this.skinDic[NB.name]=NB,this.skinDataArray.push(NB)}1==d.getUint8()?(this.yReverseMatrix=new hB(1,0,0,-1,0,0),a&&a.setTempMatrix(this.yReverseMatrix)):a&&a.setTempMatrix(new hB),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},B.getTexture=function(B){var g=this.subTextureDic[B];return g||(g=this.subTextureDic[B.substr(0,B.length-1)]),null==g?this._mainTexture:g},B.showSkinByIndex=function(B,g,l){if(void 0===l&&(l=!0),g<0&&g>=this.skinDataArray.length)return!1;var o,V,U=0,y=0,G=this.skinDataArray[g];if(G){for(U=0,y=G.slotArr.length;U<y;U++)(V=G.slotArr[U])&&(o=B[V.name])&&(o.showSlotData(V,l),l&&"undefined"!=o.attachmentName&&"null"!=o.attachmentName?o.showDisplayByName(o.attachmentName):o.showDisplayByIndex(o.displayIndex));return!0}return!1},B.getSkinIndexByName=function(B){for(var g=0,l=this.skinDataArray.length;g<l;g++)if(this.skinDataArray[g].name==B)return g;return-1},B.getGrahicsDataWithCache=function(B,g){return this._graphicsCache[B][g]},B.setGrahicsDataWithCache=function(B,g,l){this._graphicsCache[B][g]=l},B.destroy=function(){var B;for(var g in this._isDestroyed=!0,this.subTextureDic)(B=this.subTextureDic[g])&&B.destroy();for(g in this._textureDic)(B=this._textureDic[g])&&B.destroy();for(var l=0,o=this.skinSlotDisplayDataArr.length;l<o;l++)this.skinSlotDisplayDataArr[l].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete V.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},B.getAniNameByIndex=function(B){var g=this.getAnimation(B);return g?g.name:null},U(0,B,"rate",function(){return this._rate},function(B){this._rate=B}),V.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",V.TEMPLET_DICTIONARY=null,V}(e)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(B,g){"use strict";for(var l in Object.defineProperty(g,"__esModule",{value:!0}),Laya){var o=Laya[l];o&&o.__isclass&&(g[l]=o)}});