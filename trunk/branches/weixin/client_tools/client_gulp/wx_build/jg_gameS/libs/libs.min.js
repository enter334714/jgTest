var Laya=window.Laya=function(sx,sd){var st={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(sd,sL){return 1==arguments.length?st.__presubstr.call(this,sd):st.__presubstr.call(this,sd,0<sL?sL:this.length+sL)},__init:function(sd){sd.forEach(function(sd){sd.__init$&&sd.__init$()})},__isClass:function(sd){return sd&&(sd.__isclass||sd==Object||sd==String||sd==Array)},__newvec:function(sd,sL){var sl=[];sl.length=sd;for(var sZ=0;sZ<sd;sZ++)sl[sZ]=sL;return sl},__extend:function(sd,sL){for(var sl in sL)if(sL.hasOwnProperty(sl)){var sZ=Object.getOwnPropertyDescriptor(sL,sl),sh=sZ.get,s_=sZ.set;sh||s_?sh&&s_?Object.defineProperty(sd,sl,sZ):(sh&&Object.defineProperty(sd,sl,sh),s_&&Object.defineProperty(sd,sl,s_)):sd[sl]=sL[sl]}function sN(){st.un(this,"constructor",sd)}sN.prototype=sL.prototype,sd.prototype=new sN,st.un(sd.prototype,"__imps",st.__copy({},sL.prototype.__imps))},__copy:function(sd,sL){if(!sL)return null;for(var sl in sd=sd||{},sL)sd[sl]=sL[sl];return sd},__package:function(sd,sL){if(!st.__packages[sd]){st.__packages[sd]=!0;var sl=sx,sZ=sd.split(".");if(1<sZ.length)for(var sh=0,s_=sZ.length-1;sh<s_;sh++){var sN=sl[sZ[sh]];sl=sN||(sl[sZ[sh]]={})}sl[sZ[sZ.length-1]]||(sl[sZ[sZ.length-1]]=sL||{})}},__hasOwnProperty:function(sd,sL){return sL=sL||this,Object.hasOwnProperty.call(sL,sd)||function sd(sL,sl){if(Object.hasOwnProperty.call(sl.prototype,sL))return!0;var sZ=sl.prototype.__super;return null==sZ?null:sd(sL,sZ)}(sd,sL.__class)},__typeof:function(sd,sL){if(!sd||!sL)return!1;if(sL===String)return"string"==typeof sd;if(sL===Number)return"number"==typeof sd;if(sL.__interface__)sL=sL.__interface__;else if("string"!=typeof sL)return sd instanceof sL;return sd.__imps&&sd.__imps[sL]||sd.__class==sL},__as:function(sd,sL){return this.__typeof(sd,sL)?sd:null},__int:function(sd){return sd?parseInt(sd):0},interface:function(sd,sL){st.__package(sd,{});var sl=st.__internals,sZ=sl[sd]=sl[sd]||{self:sd};if(sL){var sh=sL.split(",");sZ.extend=[];for(var s_=0;s_<sh.length;s_++){var sN=sh[s_];sl[sN]=sl[sN]||{self:sN},sZ.extend.push(sl[sN])}}var sm=sx,su=sd.split(".");for(s_=0;s_<su.length-1;s_++)sm=sm[su[s_]];sm[su[su.length-1]]={__interface__:sd}},class:function(sd,sL,sl,sZ){if(sl&&st.__extend(sd,sl),sL)if(st.__package(sL,sd),st.__classmap[sL]=sd,0<sL.indexOf(".")){if(0==sL.indexOf("laya.")){var sh=sL.split(".");sZ=sZ||sh[sh.length-1],st[sZ]&&console.log("Warning!,this class["+sZ+"] already exist:",st[sZ]),st[sZ]=sd}}else"Main"==sL?sx.Main=sd:"MainWX"==sL?sx.MainWX=sd:(st[sL]&&console.log("Error!,this class["+sL+"] already exist:",st[sL]),st[sL]=sd);var s_=st.un,sN=sd.prototype;s_(sN,"hasOwnProperty",st.__hasOwnProperty),s_(sN,"__class",sd),s_(sN,"__super",sl),s_(sN,"__className",sL),s_(sd,"__super",sl),s_(sd,"__className",sL),s_(sd,"__isclass",!0),s_(sd,"super",function(sd){this.__super.call(sd)})},imps:function(sd,sL){if(!sL)return null;var sh=sd.__imps||st.un(sd,"__imps",{});function s_(sd){var sL,sl;if((sL=st.__internals[sd])&&(sh[sd]=!0,sl=sL.extend))for(var sZ=0;sZ<sl.length;sZ++)s_(sl[sZ].self)}for(var sl in sL)s_(sl)},superSet:function(sd,sL,sl,sZ){var sh=sd.prototype["_$set_"+sl];sh&&sh.call(sL,sZ)},superGet:function(sd,sL,sl){var sZ=sd.prototype["_$get_"+sl];return sZ?sZ.call(sL):null},getset:function(sd,sL,sl,sZ,sh){sd?(sZ&&(sL["_$GET_"+sl]=sZ),sh&&(sL["_$SET_"+sl]=sh)):(sZ&&st.un(sL,"_$get_"+sl,sZ),sh&&st.un(sL,"_$set_"+sl,sh)),sZ&&sh?Object.defineProperty(sL,sl,{get:sZ,set:sh,enumerable:!1,configurable:!0}):(sZ&&Object.defineProperty(sL,sl,{get:sZ,enumerable:!1,configurable:!0}),sh&&Object.defineProperty(sL,sl,{set:sh,enumerable:!1,configurable:!0}))},static:function(sl,sZ){for(var sh=0,sd=sZ.length;sh<sd;sh+=2)if("length"==sZ[sh])sl.length=sZ[sh+1].call(sl);else{function sL(){var sL=sZ[sh],sd=sZ[sh+1];Object.defineProperty(sl,sL,{get:function(){return delete this[sL],this[sL]=sd.call(this)},set:function(sd){delete this[sL],this[sL]=sd},enumerable:!0,configurable:!0})}sL()}},un:function(sd,sL,sl){return sl||(sl=sd[sL]),st.__propun.value=sl,Object.defineProperty(sd,sL,st.__propun),sl},uns:function(sL,sd){sd.forEach(function(sd){st.un(sL,sd)})}};return sx.console=sx.console||{log:function(){}},sx.trace=sx.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),st}(window,document);!function(sd,sL,sl){sl.un,sl.uns,sl.static,sl.class,sl.getset,sl.__newvec}(window,document,Laya),function(sN,sL,s$){s$.un,s$.uns;var su=s$.static,sr=s$.class,st=s$.getset;s$.__newvec;s$.interface("laya.runtime.IMarket"),s$.interface("laya.filters.IFilter"),s$.interface("laya.display.ILayout"),s$.interface("laya.resource.IDispose"),s$.interface("laya.runtime.IPlatform"),s$.interface("laya.resource.IDestroy"),s$.interface("laya.runtime.IConchNode"),s$.interface("laya.filters.IFilterAction"),s$.interface("laya.runtime.ICPlatformClass"),s$.interface("laya.resource.ICreateResource"),s$.interface("laya.runtime.IConchRenderObject"),s$.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var sF=function(){function s_(){}return sr(s_,"laya.utils.RunDriver"),s_.FILTER_ACTIONS=[],s_.pixelRatio=-1,s_._charSizeTestDiv=null,s_.now=function(){return Date.now()},s_.getWindow=function(){return sN},s_.getPixelRatio=function(){if(s_.pixelRatio<0){var sd=si.context,sL=sd.backingStorePixelRatio||sd.webkitBackingStorePixelRatio||sd.mozBackingStorePixelRatio||sd.msBackingStorePixelRatio||sd.oBackingStorePixelRatio||sd.backingStorePixelRatio||1;(s_.pixelRatio=(si.window.devicePixelRatio||1)/sL)<1&&(s_.pixelRatio=1)}return s_.pixelRatio},s_.getIncludeStr=function(sd){return null},s_.createShaderCondition=function(sd){var sL="(function() {return "+sd+";})";return s$._runScript(sL)},s_.fontMap=[],s_.measureText=function(sd,sL){var sl=s_.hanzi.test(sd);if(sl&&s_.fontMap[sL])return s_.fontMap[sL];var sZ=si.context;sZ.font=sL;var sh=sZ.measureText(sd);return sl&&(s_.fontMap[sL]=sh),sh},s_.getWebGLContext=function(sd){},s_.beginFlush=function(){},s_.endFinish=function(){},s_.addToAtlas=null,s_.flashFlushImage=function(sd){},s_.drawToCanvas=function(sd,sL,sl,sZ,sh,s_){var sN=swd.create("2D"),sm=new sX(sl,sZ,sN);return sj.renders[sL]._fun(sd,sm,sh,s_),sN},s_.createParticleTemplate2D=null,s_.createGLTextur=null,s_.createWebGLContext2D=null,s_.changeWebGLSize=function(sd,sL){},s_.createRenderSprite=function(sd,sL){return new sj(sd,sL)},s_.createFilterAction=function(sd){return new sw},s_.createGraphics=function(){return new sq},s_.clear=function(sd){sH._context.ctx.clear()},s_.cancelLoadByUrl=function(sd){},s_.clearAtlas=function(sd){},s_.isAtlas=function(sd){return!1},s_.addTextureToAtlas=function(sd){},s_.getTexturePixels=function(sd,sL,sl,sZ,sh){return null},s_.skinAniSprite=function(){return null},s_.update3DLoop=function(){},su(s_,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),s_}(),sZ=(st(1,s$,"alertGlobalError",null,function(sd){var s_=0;si.window.onerror=sd?function(sd,sL,sl,sZ,sh){s_++<5&&sh&&alert(sh.stack||sh)}:null}),s$.init=function(sd,sL,sl){for(var sZ=[],sh=2,s_=arguments.length;sh<s_;sh++)sZ.push(arguments[sh]);if(!s$._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=s$._arrayBufferSlice),s$._isinit=!0,si.__init__(),sR.__init__(),sq.__init__(),s$.timer=new sv,s$.scaleTimer=new sv,s$.loader=new sud,sW.__init__(),sh=0;for(var sN=sZ.length;sh<sN;sh++)sZ[sh].enable&&sZ[sh].enable();return sY.__init__(),sm.__init__(),so.__init__(),sB.beginCheck(),s$._currentStage=s$.stage=new skd,s$.stage.conchModel&&s$.stage.conchModel.setRootNode(),s$._getUrlPath(),s$.render=new sH(0,0),s$.stage.size(sd,sL),sj.__init__(),sb.__init__(),sc.instance.__init__(s$.stage,sH.canvas),sAd.__init__(),sg.autoStopMusic=!0,sV.__init__(),sH.canvas}},s$._getUrlPath=function(){var sd=si.window.location,sL=sd.pathname;sL=sL&&":"==sL.charAt(2)?sL.substring(1):sL,sp.rootPath=sp.basePath=sp.getPath("file:"==sd.protocol?sL:sd.protocol+"//"+sd.host+sd.pathname)},s$._arrayBufferSlice=function(sd,sL){var sl=new Uint8Array(this,sd,sL-sd),sZ=new Uint8Array(sl.length);return sZ.set(sl),sZ.buffer},s$._runScript=function(sd){return si.window[s$._evcode](sd)},s$.stage=null,s$.timer=null,s$.scaleTimer=null,s$.loader=null,s$.version="1.8.6",s$.render=null,s$._currentStage=null,s$._isinit=!1,s$.isDebug=!1,s$.MiniAdpter={init:function(){sN.navigator&&sN.navigator.userAgent&&-1<sN.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},su(s$,["conchMarket",function(){return this.conchMarket=sN.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=sN.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function sd(){}return sr(sd,"Config"),sd.WebGLTextCacheCount=500,sd.atlasEnable=!1,sd.showCanvasMark=!1,sd.animationInterval=50,sd.isAntialias=!1,sd.isAlpha=!1,sd.premultipliedAlpha=!0,sd.isStencil=!0,sd.preserveDrawingBuffer=!1,sd}()),sx=function(){function sx(){this._events=null}sr(sx,"laya.events.EventDispatcher");var sd=sx.prototype;return sd.hasListener=function(sd){return!!(this._events&&this._events[sd])},sd.event=function(sd,sL){if(!this._events||!this._events[sd])return!1;var sl=this._events[sd];if(sl.lock)sl.queue||(sl.queue=[]),sl.queue.push(sL);else{var sZ;for(sl.lock=!0,sl.cursor=sl.head;sl.cursor;)sZ=sl.cursor,sl.cursor=sZ.next,sZ.once&&sx.delNode(sl,sZ),null!=sL?sZ.args?sZ.method.apply(sZ.caller,sZ.args.concat(sL)):sL instanceof Array?sZ.method.apply(sZ.caller,sL):sZ.method.call(sZ.caller,sL):sZ.method.apply(sZ.caller,sZ.args),sZ.once&&sx.recoverHandler(sZ);sl.lock=!1,!sl.head&&this._events&&this._events[sd]==sl&&delete this._events[sd],sl.queue&&sl.queue.length&&this.event(sd,sl.queue.shift())}return!0},sd.on=function(sd,sL,sl,sZ){return this._createListener(sd,sL,sl,sZ,!1)},sd.once=function(sd,sL,sl,sZ){return this._createListener(sd,sL,sl,sZ,!0)},sd._createListener=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=!0),s_&&this.off(sd,sL,sl,sh);var sN=sx.createHandler(sL||this,sl,sZ,sh);this._events||(this._events={});var sm=this._events,su=sm[sd];return su?su.tail?(sN.prev=su.tail,su.tail.next=sN,su.tail=sN):su.head=su.tail=sN:sm[sd]={head:sN,tail:sN,cursor:null,lock:!1},this},sd.off=function(sd,sL,sl,sZ){if(void 0===sZ&&(sZ=!1),!this._events||!this._events[sd])return this;for(var sh=this._events[sd],s_=sh.head;s_;){if((!sL||s_.caller===sL)&&s_.method===sl&&(!sZ||s_.once)){sx.delNode(sh,s_),sh.cursor==s_&&(sh.cursor=s_.next),sx.recoverHandler(s_);break}s_=s_.next}return this},sd.offAll=function(sd){var sL=this._events;if(!sL)return this;if(sd)this._recoverHandlers(sL[sd]),delete sL[sd];else{for(var sl in sL)this._recoverHandlers(sL[sl]);this._events=null}return this},sd._recoverHandlers=function(sd){if(sd){for(var sL=sd.head;sL;){sx.delNode(sd,sL);var sl=sL.next;sx.recoverHandler(sL),sL=sl}sd.cursor=null}},sd.isMouseEvent=function(sd){return sx.MOUSE_EVENTS[sd]},sx.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},sx.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},sx.delNode=function(sd,sL){sL.prev?sL.prev.next=sL.next:sd.head=sL.next,sL.next?sL.next.prev=sL.prev:sd.tail=sL.prev},sx.createHandler=function(sd,sL,sl,sZ){var sh=sx._freeHandler;return sh?(sx._freeCount--,sx._freeHandler=sh.next,sh.caller=sd,sh.method=sL,sh.args=sl,sh.once=sZ):sh={caller:sd,method:sL,args:sl,once:sZ},sh.prev=sh.next=null,sh},sx.recoverHandler=function(sd){sd.caller=sd.method=sd.args=sd.prev=null,sd.next=sx._freeHandler,sx._freeHandler=sd,sx._freeCount++},sx._freeHandler=null,sx._freeCount=0,sx}(),se=function(){function sh(sd,sL,sl,sZ){this.once=!1,void(this._id=0)===sZ&&(sZ=!1),this.setTo(sd,sL,sl,sZ)}sr(sh,"laya.utils.Handler");var sd=sh.prototype;return sd.setTo=function(sd,sL,sl,sZ){return this._id=sh._gid++,this.caller=sd,this.method=sL,this.args=sl,this.once=sZ,this},sd.run=function(){if(null==this.method)return null;var sd=this._id,sL=this.method.apply(this.caller,this.args);return this._id===sd&&this.once&&this.recover(),sL},sd.runWith=function(sd){if(null==this.method)return null;var sL=this._id;if(null==sd)var sl=this.method.apply(this.caller,this.args);else sl=this.args||sd.unshift?this.args?this.method.apply(this.caller,this.args.concat(sd)):this.method.apply(this.caller,sd):this.method.call(this.caller,sd);return this._id===sL&&this.once&&this.recover(),sl},sd.clear=function(){return this.caller=null,this.method=null,this.args=null,this},sd.recover=function(){0<this._id&&(this._id=0,this.clear())},sh.create=function(sd,sL,sl,sZ){return void 0===sZ&&(sZ=!0),new sh(sd,sL,sl,sZ)},sh._gid=1,sh}(),sQ=function(){function sd(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}sr(sd,"laya.display.BitmapFont");var sL=sd.prototype;return sL.loadFont=function(sd,sL){this._path=sd,this._complete=sL,s$.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],se.create(this,this.onLoaded))},sL.onLoaded=function(){this.parseFont(smd.getRes(this._path),smd.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},sL.parseFont=function(sd,sL){if(null!=sd&&null!=sL){this._texture=sL;var sl=sd.getElementsByTagName("info");if(!sl[0].getAttributeNode)return this.parseFont2(sd,sL);this.fontSize=parseInt(sl[0].getAttributeNode("size").nodeValue);var sZ,sh=sl[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(sh[0]),parseInt(sh[1]),parseInt(sh[2]),parseInt(sh[3])],sZ=sd.getElementsByTagName("char");var s_=0;for(s_=0;s_<sZ.length;s_++){var sN=sZ[s_],sm=parseInt(sN.getAttributeNode("id").nodeValue),su=parseInt(sN.getAttributeNode("xoffset").nodeValue)/1,sx=parseInt(sN.getAttributeNode("yoffset").nodeValue)/1,st=parseInt(sN.getAttributeNode("xadvance").nodeValue)/1,sb=new sn;sb.x=parseInt(sN.getAttributeNode("x").nodeValue),sb.y=parseInt(sN.getAttributeNode("y").nodeValue),sb.width=parseInt(sN.getAttributeNode("width").nodeValue),sb.height=parseInt(sN.getAttributeNode("height").nodeValue);var sq=std.create(sL,sb.x,sb.y,sb.width,sb.height,su,sx);this._maxWidth=Math.max(this._maxWidth,st+this.letterSpacing),this._fontCharDic[sm]=sq,this._fontWidthMap[sm]=st}}},sL.parseFont2=function(sd,sL){if(null!=sd&&null!=sL){this._texture=sL;var sl=sd.getElementsByTagName("info");this.fontSize=parseInt(sl[0].attributes.size.nodeValue);var sZ=sl[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(sZ[0]),parseInt(sZ[1]),parseInt(sZ[2]),parseInt(sZ[3])];var sh=sd.getElementsByTagName("char"),s_=0;for(s_=0;s_<sh.length;s_++){var sN=sh[s_].attributes,sm=parseInt(sN.id.nodeValue),su=parseInt(sN.xoffset.nodeValue)/1,sx=parseInt(sN.yoffset.nodeValue)/1,st=parseInt(sN.xadvance.nodeValue)/1,sb=new sn;sb.x=parseInt(sN.x.nodeValue),sb.y=parseInt(sN.y.nodeValue),sb.width=parseInt(sN.width.nodeValue),sb.height=parseInt(sN.height.nodeValue);var sq=std.create(sL,sb.x,sb.y,sb.width,sb.height,su,sx);this._maxWidth=Math.max(this._maxWidth,st+this.letterSpacing),this._fontCharDic[sm]=sq,this._fontWidthMap[sm]=st}}},sL.getCharTexture=function(sd){return this._fontCharDic[sd.charCodeAt(0)]},sL.destroy=function(){if(this._texture){for(var sd in this._fontCharDic){var sL=this._fontCharDic[sd];sL&&sL.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},sL.setSpaceWidth=function(sd){this._spaceWidth=sd},sL.getCharWidth=function(sd){var sL=sd.charCodeAt(0);return this._fontWidthMap[sL]?this._fontWidthMap[sL]+this.letterSpacing:" "==sd?this._spaceWidth+this.letterSpacing:0},sL.getTextWidth=function(sd){for(var sL=0,sl=0,sZ=sd.length;sl<sZ;sl++)sL+=this.getCharWidth(sd.charAt(sl));return sL},sL.getMaxWidth=function(){return this._maxWidth},sL.getMaxHeight=function(){return this.fontSize},sL.drawText=function(sd,sL,sl,sZ,sh,s_){var sN,sm=this.getTextWidth(sd),su=0;"center"===sh&&(su=(s_-sm)/2),"right"===sh&&(su=s_-sm);for(var sx=0,st=0,sb=sd.length;st<sb;st++)(sN=this.getCharTexture(sd.charAt(st)))&&(sL.graphics.drawTexture(sN,sl+sx+su,sZ),sx+=this.getCharWidth(sd.charAt(st)))},sd}(),sm=function(){function sl(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=sl._TF_EMPTY}sr(sl,"laya.display.css.Style");var sd=sl.prototype;return sd.getTransform=function(){return this._tf},sd.setTransform=function(sd){this._tf="none"!==sd&&sd?sd:sl._TF_EMPTY},sd.setTranslateX=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.translateX=sd},sd.setTranslateY=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.translateY=sd},sd.setScaleX=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.scaleX=sd},sd.setScale=function(sd,sL){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.scaleX=sd,this._tf.scaleY=sL},sd.setScaleY=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.scaleY=sd},sd.setRotate=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.rotate=sd},sd.setSkewX=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.skewX=sd},sd.setSkewY=function(sd){this._tf===sl._TF_EMPTY&&(this._tf=new sh),this._tf.skewY=sd},sd.destroy=function(){this.scrollRect=null},sd.render=function(sd,sL,sl,sZ){},sd.getCSSStyle=function(){return sLd.EMPTY},sd._enableLayout=function(){return!1},st(0,sd,"scaleX",function(){return this._tf.scaleX},function(sd){this.setScaleX(sd)}),st(0,sd,"transform",function(){return this.getTransform()},function(sd){this.setTransform(sd)}),st(0,sd,"translateX",function(){return this._tf.translateX},function(sd){this.setTranslateX(sd)}),st(0,sd,"translateY",function(){return this._tf.translateY},function(sd){this.setTranslateY(sd)}),st(0,sd,"scaleY",function(){return this._tf.scaleY},function(sd){this.setScaleY(sd)}),st(0,sd,"block",function(){return 0!=(1&this._type)}),st(0,sd,"skewY",function(){return this._tf.skewY},function(sd){this.setSkewY(sd)}),st(0,sd,"rotate",function(){return this._tf.rotate},function(sd){this.setRotate(sd)}),st(0,sd,"skewX",function(){return this._tf.skewX},function(sd){this.setSkewX(sd)}),st(0,sd,"paddingLeft",function(){return 0}),st(0,sd,"paddingTop",function(){return 0}),st(0,sd,"absolute",function(){return!0}),sl.__init__=function(){sl._TF_EMPTY=new sh,sl.EMPTY=new sl},sl.EMPTY=null,sl._TF_EMPTY=null,sl}(),sY=function(){function sL(sd){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=sP.create(sL.defaultColor),this.family=sL.defaultFamily,this.stroke=sL._STROKE,this.size=sL.defaultSize,sd&&sd!==sL.EMPTY&&sd.copyTo(this)}sr(sL,"laya.display.css.Font");var sd=sL.prototype;return sd.set=function(sd){this._text=null;for(var sL=sd.split(" "),sl=0,sZ=sL.length;sl<sZ;sl++){var sh=sL[sl];switch(sh){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<sh.indexOf("px")&&(this.size=parseInt(sh),this.family=sL[sl+1],sl++)}},sd.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},sd.copyTo=function(sd){sd._type=this._type,sd._text=this._text,sd._weight=this._weight,sd._color=this._color,sd.family=this.family,sd.stroke=this.stroke!=sL._STROKE?this.stroke.slice():sL._STROKE,sd.indent=this.indent,sd.size=this.size},st(0,sd,"password",function(){return 0!=(1024&this._type)},function(sd){sd?this._type|=1024:this._type&=-1025}),st(0,sd,"color",function(){return this._color.strColor},function(sd){this._color=sP.create(sd)}),st(0,sd,"italic",function(){return 0!=(512&this._type)},function(sd){sd?this._type|=512:this._type&=-513}),st(0,sd,"bold",function(){return 0!=(2048&this._type)},function(sd){sd?this._type|=2048:this._type&=-2049}),st(0,sd,"weight",function(){return""+this._weight},function(sd){var sL=0;switch(sd){case"normal":break;case"bold":this.bold=!0,sL=700;break;case"bolder":sL=800;break;case"lighter":sL=100;break;default:sL=parseInt(sd)}this._weight=sL,this._text=null}),st(0,sd,"decoration",function(){return this._decoration?this._decoration.value:null},function(sd){var sL=sd.split(" ");switch(this._decoration||(this._decoration={}),sL[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=sL[0]}sL[1]&&(this._decoration.color=sP.create(sL)),this._decoration.value=sd}),sL.__init__=function(){sL.EMPTY=new sL(null)},sL.EMPTY=null,sL.defaultColor="#000000",sL.defaultSize=12,sL.defaultFamily="Arial",sL.defaultFont="12px Arial",sL._STROKE=[0,"#000000"],sL._ITALIC=512,sL._PASSWORD=1024,sL._BOLD=2048,sL}(),sh=function(){function sd(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return sr(sd,"laya.display.css.TransformInfo"),sd}(),sq=function(){function sb(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,sH.isConchNode){this._nativeObj=new sN._conchGraphics,this.id=this._nativeObj.conchID}}sr(sb,"laya.display.Graphics");var sd=sb.prototype;return sd.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},sd.clear=function(sd){void 0===sd&&(sd=!1);var sL=0,sl=0;if(sd){var sZ=this._one;if(this._cmds){for(sl=this._cmds.length,sL=0;sL<sl;sL++)!(sZ=this._cmds[sL])||sZ.callee!==sH._context._drawTexture&&sZ.callee!==sH._context._drawTextureWithTransform||(sZ[0]=null,sb._cache.push(sZ));this._cmds.length=0}else sZ&&(!sZ||sZ.callee!==sH._context._drawTexture&&sZ.callee!==sH._context._drawTextureWithTransform||(sZ[0]=null,sb._cache.push(sZ)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(sL=0,sl=this._vectorgraphArray.length;sL<sl;sL++)sU.getInstance().deleteShape(this._vectorgraphArray[sL]);this._vectorgraphArray.length=0}},sd._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},sd._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new sl,this._graphicBounds._graphics=this)},sd._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},sd._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},sd.getBounds=function(sd){return void 0===sd&&(sd=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(sd)},sd.getBoundPoints=function(sd){return void 0===sd&&(sd=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(sd)},sd._addCmd=function(sd){this._cmds=this._cmds||[],sd.callee=sd.shift(),this._cmds.push(sd)},sd.setFilters=function(sd){this._saveToCmd(sH._context._setFilters,sd)},sd.drawTexture=function(sd,sL,sl,sZ,sh,s_,sN){if(void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===sN&&(sN=1),!sd||sN<.01)return null;sZ||(sZ=sd.sourceWidth),sh||(sh=sd.sourceHeight),sN=sN<0?0:1<sN?1:sN;var sm,su=!sH.isWebGL&&(si.onFirefox||si.onEdge||si.onIE||si.onSafari)?.5:0,sx=sZ/sd.sourceWidth,st=sh/sd.sourceHeight;return sZ=sd.width*sx,sh=sd.height*st,sd.loaded&&(sZ<=0||sh<=0)?null:(sL+=sd.offsetX*sx,sl+=sd.offsetY*st,this._sp&&(this._sp._renderType|=512),sL-=su,sl-=su,sZ+=2*su,sh+=2*su,sb._cache.length?((sm=sb._cache.pop())[0]=sd,sm[1]=sL,sm[2]=sl,sm[3]=sZ,sm[4]=sh,sm[5]=s_,sm[6]=sN):sm=[sd,sL,sl,sZ,sh,s_,sN],sm.callee=s_||1!=sN?sH._context._drawTextureWithTransform:sH._context._drawTexture,null!=this._one||s_||1!=sN?this._saveToCmd(sm.callee,sm):(this._one=sm,this._render=this._renderOneImg),sd.loaded||sd.once("loaded",this,this._textureLoaded,[sd,sm]),this._repaint(),sm)},sd.cleanByTexture=function(sd,sL,sl,sZ,sh){if(void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),!sd)return this.clear();if(this._one&&this._render===this._renderOneImg){sZ||(sZ=sd.sourceWidth),sh||(sh=sd.sourceHeight);var s_=sZ/sd.sourceWidth,sN=sh/sd.sourceHeight;sZ=sd.width*s_,sh=sd.height*sN,sL+=sd.offsetX*s_,sl+=sd.offsetY*sN,this._one[0]=sd,this._one[1]=sL,this._one[2]=sl,this._one[3]=sZ,this._one[4]=sh,this._repaint()}else this.clear(),sd&&this.drawTexture(sd,sL,sl,sZ,sh)},sd.drawTextures=function(sd,sL){sd&&this._saveToCmd(sH._context._drawTextures,[sd,sL])},sd.fillTexture=function(sd,sL,sl,sZ,sh,s_,sN){if(void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===s_&&(s_="repeat"),sd){var sm=[sd,sL,sl,sZ,sh,s_,sN||sO.EMPTY,{}];sd.loaded||sd.once("loaded",this,this._textureLoaded,[sd,sm]),this._saveToCmd(sH._context._fillTexture,sm)}},sd._textureLoaded=function(sd,sL){sL[3]=sL[3]||sd.width,sL[4]=sL[4]||sd.height,this._repaint()},sd.fillCircle=function(sd,sL,sl,sZ,sh,s_,sN){sl.bitmap.enableMerageInAtlas=!1;var sm=new Float32Array(2*(sN+1)),su=new Float32Array(2*(sN+1)),sx=new Uint16Array(3*sN),st=2*Math.PI/sN,sb=0;sm[0]=sZ,sm[1]=sh,su[0]=sZ/sl.width,su[1]=sh/sl.height;for(var sq=2,sY=0;sY<sN;sY++){var sc=s_*Math.cos(sb)+sZ,sr=s_*Math.sin(sb)+sh;sm[sq]=sc,sm[sq+1]=sr,su[sq]=sc/sl.width,su[sq+1]=sr/sl.height,sb+=st,sq+=2}for(sY=sq=0;sY<sN;sY++)sx[sq++]=0,sx[sq++]=sY+1,sx[sq++]=sN+1<=sY+2?1:sY+2;this.drawTriangles(sl,sd,sL,sm,su,sx)},sd.drawTriangles=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){void 0===sm&&(sm=1),this._saveToCmd(sH._context.drawTriangles,[sd,sL,sl,sZ,sh,s_,sN,sm,su,sx])},sd._saveToCmd=function(sd,sL){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=sL,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(sL)),sL.callee=sd,this._repaint(),sL},sd.clipRect=function(sd,sL,sl,sZ){this._saveToCmd(sH._context._clipRect,[sd,sL,sl,sZ])},sd.fillText=function(sd,sL,sl,sZ,sh,s_,sN){void 0===sN&&(sN=0),this._saveToCmd(sH._context._fillText,[sd,sL,sl,sZ||sY.defaultFont,sh,s_])},sd.fillBorderText=function(sd,sL,sl,sZ,sh,s_,sN,sm){this._saveToCmd(sH._context._fillBorderText,[sd,sL,sl,sZ||sY.defaultFont,sh,s_,sN,sm])},sd.strokeText=function(sd,sL,sl,sZ,sh,s_,sN){this._saveToCmd(sH._context._strokeText,[sd,sL,sl,sZ||sY.defaultFont,sh,s_,sN])},sd.alpha=function(sd){sd=sd<0?0:1<sd?1:sd,this._saveToCmd(sH._context._alpha,[sd])},sd.setAlpha=function(sd){sd=sd<0?0:1<sd?1:sd,this._saveToCmd(sH._context._setAlpha,[sd])},sd.transform=function(sd,sL,sl){void 0===sL&&(sL=0),void 0===sl&&(sl=0),this._saveToCmd(sH._context._transform,[sd,sL,sl])},sd.rotate=function(sd,sL,sl){void 0===sL&&(sL=0),void 0===sl&&(sl=0),this._saveToCmd(sH._context._rotate,[sd,sL,sl])},sd.scale=function(sd,sL,sl,sZ){void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),this._saveToCmd(sH._context._scale,[sd,sL,sl,sZ])},sd.translate=function(sd,sL){this._saveToCmd(sH._context._translate,[sd,sL])},sd.save=function(){this._saveToCmd(sH._context._save,[])},sd.restore=function(){this._saveToCmd(sH._context._restore,[])},sd.replaceText=function(sd){this._repaint();var sL=this._cmds;if(sL){for(var sl=sL.length-1;-1<sl;sl--)if(this._isTextCmd(sL[sl].callee))return sL[sl][0].toUpperCase?sL[sl][0]=sd:sL[sl][0].setText(sd),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=sd:this._one[0].setText(sd),!0;return!1},sd._isTextCmd=function(sd){return sd===sH._context._fillText||sd===sH._context._fillBorderText||sd===sH._context._strokeText},sd.replaceTextColor=function(sd){this._repaint();var sL=this._cmds;if(sL)for(var sl=sL.length-1;-1<sl;sl--)this._isTextCmd(sL[sl].callee)&&(sL[sl][4]=sd,sL[sl][0].toUpperCase||(sL[sl][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=sd,this._one[0].toUpperCase||(this._one[0].changed=!0))},sd.loadImage=function(sd,sL,sl,sZ,sh,s_){var sN=this;void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0);var sm=smd.getRes(sd);function su(sd){sd&&(sN.drawTexture(sd,sL,sl,sZ,sh),null!=s_&&s_.call(sN._sp,sd))}sm?su(sm):s$.loader.load(sd,se.create(null,su),null,"image")},sd._renderEmpty=function(sd,sL,sl,sZ){},sd._renderAll=function(sd,sL,sl,sZ){for(var sh,s_=this._cmds,sN=0,sm=s_.length;sN<sm;sN++)(sh=s_[sN]).callee.call(sL,sl,sZ,sh)},sd._renderOne=function(sd,sL,sl,sZ){this._one.callee.call(sL,sl,sZ,this._one)},sd._renderOneImg=function(sd,sL,sl,sZ){this._one.callee.call(sL,sl,sZ,this._one),2305!==sd._renderType&&(sd._renderType|=1)},sd.drawLine=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=1);var sN=0;sH.isWebGL&&(sN=sU.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(sN));var sm=s_%2==0?0:.5,su=[sd+sm,sL+sm,sl+sm,sZ+sm,sh,s_,sN];this._saveToCmd(sH._context._drawLine,su)},sd.drawLines=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=1);var s_=0;if(sl&&!(sl.length<4)){sH.isWebGL&&(s_=sU.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s_));var sN=sh%2==0?0:.5,sm=[sd+sN,sL+sN,sl,sZ,sh,s_];this._saveToCmd(sH._context._drawLines,sm)}},sd.drawCurves=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=1);var s_=[sd,sL,sl,sZ,sh];this._saveToCmd(sH._context._drawCurves,s_)},sd.drawRect=function(sd,sL,sl,sZ,sh,s_,sN){void 0===sN&&(sN=1);var sm=s_?sN/2:0,su=s_?sN:0,sx=[sd+sm,sL+sm,sl-su,sZ-su,sh,s_,sN];this._saveToCmd(sH._context._drawRect,sx)},sd.drawCircle=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=1);var sN=sh?s_/2:0,sm=0;sH.isWebGL&&(sm=sU.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(sm));var su=[sd,sL,sl-sN,sZ,sh,s_,sm];this._saveToCmd(sH._context._drawCircle,su)},sd.drawPie=function(sd,sL,sl,sZ,sh,s_,sN,sm){void 0===sm&&(sm=1);var su=sN?sm/2:0,sx=sN?sm:0,st=0;sH.isWebGL&&(st=sU.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(st));var sb=[sd+su,sL+su,sl-sx,sZ,sh,s_,sN,sm,st];sb[3]=sf.toRadian(sZ),sb[4]=sf.toRadian(sh),this._saveToCmd(sH._context._drawPie,sb)},sd.drawPoly=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=1);var sN=0,sm=!1;sH.isWebGL&&(sN=sU.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(sN),sm=!(6<sl.length));var su=sh?s_%2==0?0:.5:0,sx=[sd+su,sL+su,sl,sZ,sh,s_,sN,sm];this._saveToCmd(sH._context._drawPoly,sx)},sd.drawPath=function(sd,sL,sl,sZ,sh){var s_=[sd,sL,sl,sZ,sh];this._saveToCmd(sH._context._drawPath,s_)},st(0,sd,"cmds",function(){return this._cmds},function(sd){this._sp&&(this._sp._renderType|=512),this._cmds=sd,this._render=this._renderAll,this._repaint()}),sb.__init__=function(){if(sH.isConchNode){for(var sd=laya.display.Graphics.prototype,sL=si.window.ConchGraphics.prototype,sl=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],sZ=0,sh=sl.length;sZ<=sh;sZ++){var s_=sl[sZ];sd[s_]=sL[s_]}sd._saveToCmd=null,sL.drawImageS&&(sd.drawTextures=function(sd,sL){if(sd&&sd.loaded&&sd.bitmap&&sd.source){var sl=sd.uv,sZ=sd.bitmap.width,sh=sd.bitmap.height;this.drawImageS(sd.bitmap.source,sl[0]*sZ,sl[1]*sh,(sl[2]-sl[0])*sZ,(sl[5]-sl[3])*sh,sd.offsetX,sd.offsetY,sd.width,sd.height,sL)}}),sd.drawTexture=function(sd,sL,sl,sZ,sh,s_,sN){if(void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===sN&&(sN=1),sd)if(sd.loaded){if(sd.loaded&&sd.bitmap&&sd.source&&(sZ||(sZ=sd.sourceWidth),sh||(sh=sd.sourceHeight),sN=sN<0?0:1<sN?1:sN,sZ=sZ-sd.sourceWidth+sd.width,sh=sh-sd.sourceHeight+sd.height,!(sZ<=0||sh<=0))){sL+=sd.offsetX,sl+=sd.offsetY;var sm=sd.uv,su=sd.bitmap.width,sx=sd.bitmap.height;sm[4]<sm[0]&&sm[5]<sm[1]?this.drawImageM(sd.bitmap.source,sm[4]*su,sm[5]*sx,(sm[0]-sm[4])*su,(sm[1]-sm[5])*sx,sL,sl,sZ,sh,s_,sN):this.drawImageM(sd.bitmap.source,sm[0]*su,sm[1]*sx,(sm[2]-sm[0])*su,(sm[5]-sm[3])*sx,sL,sl,sZ,sh,s_,sN),this._repaint()}}else sd.once("loaded",this,function(){this.drawTexture(sd,sL,sl,sZ,sh,s_)})},sd.fillTexture=function(sd,sL,sl,sZ,sh,s_,sN){if(void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===s_&&(s_="repeat"),sd&&sd.loaded){var sm,su=sH._context.ctx,sx=sd.bitmap.width,st=sd.bitmap.height,sb=sd.uv;sm=sd.uv!=std.DEF_UV?su.createPattern(sd.bitmap.source,s_,sb[0]*sx,sb[1]*st,(sb[2]-sb[0])*sx,(sb[5]-sb[3])*st):su.createPattern(sd.bitmap.source,s_);var sq=0,sY=0;sN&&(sL+=sN.x%sd.width,sl+=sN.y%sd.height,sq-=sN.x%sd.width,sY-=sN.y%sd.height),this._fillImage(sm,sL,sl,sq,sY,sZ,sh)}}}},sb._cache=[],sb}(),sl=function(){function sw(){this._cacheBoundsType=!1}sr(sw,"laya.display.GraphicsBounds");var sd=sw.prototype;return sd.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},sd.reset=function(){this._temp&&(this._temp.length=0)},sd.getBounds=function(sd){return void 0===sd&&(sd=!1),(!this._bounds||!this._temp||this._temp.length<1||sd!=this._cacheBoundsType)&&(this._bounds=sn._getWrapRec(this.getBoundPoints(sd),this._bounds)),this._cacheBoundsType=sd,this._bounds},sd.getBoundPoints=function(sd){return void 0===sd&&(sd=!1),(!this._temp||this._temp.length<1||sd!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(sd)),this._cacheBoundsType=sd,this._rstBoundPoints=sf.copyArray(this._rstBoundPoints,this._temp)},sd._getCmdPoints=function(sd){void 0===sd&&(sd=!1);var sL,sl,sZ=sH._context,sh=this._graphics.cmds;if((sL=this._temp||(this._temp=[])).length=0,sh||null==this._graphics._one||(sw._tempCmds.length=0,sw._tempCmds.push(this._graphics._one),sh=sw._tempCmds),!sh)return sL;(sl=sw._tempMatrixArrays).length=0;var s_=sw._initMatrix;s_.identity();for(var sN,sm,su=sw._tempMatrix,sx=NaN,st=NaN,sb=NaN,sq=NaN,sY=NaN,sc=NaN,sr=0,sa=sh.length;sr<sa;sr++)if((sN=sh[sr]).callee)switch(sN.callee){case sZ._save:case 7:sl.push(s_),s_=s_.clone();break;case sZ._restore:case 8:s_=sl.pop();break;case sZ._scale:case 5:su.identity(),su.translate(-sN[2],-sN[3]),su.scale(sN[0],sN[1]),su.translate(sN[2],sN[3]),this._switchMatrix(s_,su);break;case sZ._rotate:case 3:su.identity(),su.translate(-sN[1],-sN[2]),su.rotate(sN[0]),su.translate(sN[1],sN[2]),this._switchMatrix(s_,su);break;case sZ._translate:case 6:su.identity(),su.translate(sN[0],sN[1]),this._switchMatrix(s_,su);break;case sZ._transform:case 4:su.identity(),su.translate(-sN[1],-sN[2]),su.concat(sN[0]),su.translate(sN[1],sN[2]),this._switchMatrix(s_,su);break;case 16:case 24:sw._addPointArrToRst(sL,sn._getBoundPointS(sN[0],sN[1],sN[2],sN[3]),s_);break;case 17:s_.copyTo(su),su.concat(sN[4]),sw._addPointArrToRst(sL,sn._getBoundPointS(sN[0],sN[1],sN[2],sN[3]),su);break;case sZ._drawTexture:sm=sN[0],sd?sN[3]&&sN[4]?sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1],sN[2],sN[3],sN[4]),s_):(sm=sN[0],sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1],sN[2],sm.width,sm.height),s_)):(sx=(sN[3]||sm.sourceWidth)/sm.width,st=(sN[4]||sm.sourceHeight)/sm.height,sb=sx*sm.sourceWidth,sq=st*sm.sourceHeight,sY=0<sm.offsetX?sm.offsetX:0,sc=0<sm.offsetY?sm.offsetY:0,sY*=sx,sc*=st,sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1]-sY,sN[2]-sc,sb,sq),s_));break;case sZ._fillTexture:sN[3]&&sN[4]?sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1],sN[2],sN[3],sN[4]),s_):(sm=sN[0],sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1],sN[2],sm.width,sm.height),s_));break;case sZ._drawTextureWithTransform:var sk;sk=sN[5]?(s_.copyTo(su),su.concat(sN[5]),su):s_,sd?sN[3]&&sN[4]?sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1],sN[2],sN[3],sN[4]),sk):(sm=sN[0],sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1],sN[2],sm.width,sm.height),sk)):(sm=sN[0],sx=(sN[3]||sm.sourceWidth)/sm.width,st=(sN[4]||sm.sourceHeight)/sm.height,sb=sx*sm.sourceWidth,sq=st*sm.sourceHeight,sY=0<sm.offsetX?sm.offsetX:0,sc=0<sm.offsetY?sm.offsetY:0,sY*=sx,sc*=st,sw._addPointArrToRst(sL,sn._getBoundPointS(sN[1]-sY,sN[2]-sc,sb,sq),sk));break;case sZ._drawRect:case 13:sw._addPointArrToRst(sL,sn._getBoundPointS(sN[0],sN[1],sN[2],sN[3]),s_);break;case sZ._drawCircle:case sZ._fillCircle:case 14:sw._addPointArrToRst(sL,sn._getBoundPointS(sN[0]-sN[2],sN[1]-sN[2],sN[2]+sN[2],sN[2]+sN[2]),s_);break;case sZ._drawLine:case 20:sw._tempPoints.length=0;var se;se=.5*sN[5],sN[0]==sN[2]?sw._tempPoints.push(sN[0]+se,sN[1],sN[2]+se,sN[3],sN[0]-se,sN[1],sN[2]-se,sN[3]):sN[1]==sN[3]?sw._tempPoints.push(sN[0],sN[1]+se,sN[2],sN[3]+se,sN[0],sN[1]-se,sN[2],sN[3]-se):sw._tempPoints.push(sN[0],sN[1],sN[2],sN[3]),sw._addPointArrToRst(sL,sw._tempPoints,s_);break;case sZ._drawCurves:case 22:sw._addPointArrToRst(sL,ss.I.getBezierPoints(sN[2]),s_,sN[0],sN[1]);break;case sZ._drawPoly:case sZ._drawLines:case 18:sw._addPointArrToRst(sL,sN[2],s_,sN[0],sN[1]);break;case sZ._drawPath:case 19:sw._addPointArrToRst(sL,this._getPathPoints(sN[2]),s_,sN[0],sN[1]);break;case sZ._drawPie:case 15:sw._addPointArrToRst(sL,this._getPiePoints(sN[0],sN[1],sN[2],sN[3],sN[4]),s_)}return 200<sL.length?sL=sf.copyArray(sL,sn._getWrapRec(sL)._getBoundPoints()):8<sL.length&&(sL=sA.scanPList(sL)),sL},sd._switchMatrix=function(sd,sL){sL.concat(sd),sL.copyTo(sd)},sd._getPiePoints=function(sd,sL,sl,sZ,sh){var s_=sw._tempPoints;sw._tempPoints.length=0,s_.push(sd,sL);var sN=(sh-sZ)%(2*Math.PI)/10,sm=NaN,su=sZ;for(sm=0;sm<=10;sm++)s_.push(sd+sl*Math.cos(su),sL+sl*Math.sin(su)),su+=sN;return s_},sd._getPathPoints=function(sd){var sL,sl,sZ=0,sh=sw._tempPoints;for(sh.length=0,sL=sd.length,sZ=0;sZ<sL;sZ++)1<(sl=sd[sZ]).length&&(sh.push(sl[1],sl[2]),3<sl.length&&sh.push(sl[3],sl[4]));return sh},sw._addPointArrToRst=function(sd,sL,sl,sZ,sh){void 0===sZ&&(sZ=0),void 0===sh&&(sh=0);var s_,sN=0;for(s_=sL.length,sN=0;sN<s_;sN+=2)sw._addPointToRst(sd,sL[sN]+sZ,sL[sN+1]+sh,sl)},sw._addPointToRst=function(sd,sL,sl,sZ){var sh=sO.TEMP;sh.setTo(sL||0,sl||0),sZ.transformPoint(sh),sd.push(sh.x,sh.y)},sw._tempPoints=[],sw._tempMatrixArrays=[],sw._tempCmds=[],su(sw,["_tempMatrix",function(){return this._tempMatrix=new sE},"_initMatrix",function(){return this._initMatrix=new sE}]),sw}(),s_=function(){function sd(){}sr(sd,"laya.events.Event");var sL=sd.prototype;return sL.setTo=function(sd,sL,sl){return this.type=sd,this.currentTarget=sL,this.target=sl,this},sL.stopPropagation=function(){this._stoped=!0},st(0,sL,"stageY",function(){return s$.stage.mouseY}),st(0,sL,"charCode",function(){return this.nativeEvent.charCode}),st(0,sL,"touches",function(){var sd=this.nativeEvent.touches;if(sd)for(var sL=s$.stage,sl=0,sZ=sd.length;sl<sZ;sl++){var sh=sd[sl],s_=sO.TEMP;s_.setTo(sh.clientX,sh.clientY),sL._canvasTransform.invertTransformPoint(s_),sL.transform.invertTransformPoint(s_),sh.stageX=s_.x,sh.stageY=s_.y}return sd}),st(0,sL,"keyLocation",function(){return this.nativeEvent.keyLocation}),st(0,sL,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),st(0,sL,"altKey",function(){return this.nativeEvent.altKey}),st(0,sL,"shiftKey",function(){return this.nativeEvent.shiftKey}),st(0,sL,"stageX",function(){return s$.stage.mouseX}),sd.EMPTY=new sd,sd.MOUSE_DOWN="mousedown",sd.MOUSE_UP="mouseup",sd.CLICK="click",sd.RIGHT_MOUSE_DOWN="rightmousedown",sd.RIGHT_MOUSE_UP="rightmouseup",sd.RIGHT_CLICK="rightclick",sd.MOUSE_MOVE="mousemove",sd.MOUSE_OVER="mouseover",sd.MOUSE_OUT="mouseout",sd.MOUSE_WHEEL="mousewheel",sd.ROLL_OVER="mouseover",sd.ROLL_OUT="mouseout",sd.DOUBLE_CLICK="doubleclick",sd.CHANGE="change",sd.CHANGED="changed",sd.RESIZE="resize",sd.ADDED="added",sd.REMOVED="removed",sd.DISPLAY="display",sd.UNDISPLAY="undisplay",sd.ERROR="error",sd.COMPLETE="complete",sd.LOADED="loaded",sd.INITED="inited",sd.PROGRESS="progress",sd.INPUT="input",sd.RENDER="render",sd.OPEN="open",sd.MESSAGE="message",sd.CLOSE="close",sd.KEY_DOWN="keydown",sd.KEY_PRESS="keypress",sd.KEY_UP="keyup",sd.FRAME="enterframe",sd.DRAG_START="dragstart",sd.DRAG_MOVE="dragmove",sd.DRAG_END="dragend",sd.ENTER="enter",sd.SELECT="select",sd.BLUR="blur",sd.FOCUS="focus",sd.VISIBILITY_CHANGE="visibilitychange",sd.FOCUS_CHANGE="focuschange",sd.PLAYED="played",sd.PAUSED="paused",sd.STOPPED="stopped",sd.START="start",sd.END="end",sd.ENABLE_CHANGED="enablechanged",sd.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",sd.COMPONENT_ADDED="componentadded",sd.COMPONENT_REMOVED="componentremoved",sd.LAYER_CHANGED="layerchanged",sd.HIERARCHY_LOADED="hierarchyloaded",sd.RECOVERED="recovered",sd.RELEASED="released",sd.LINK="link",sd.LABEL="label",sd.FULL_SCREEN_CHANGE="fullscreenchange",sd.DEVICE_LOST="devicelost",sd.MESH_CHANGED="meshchanged",sd.MATERIAL_CHANGED="materialchanged",sd.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",sd.ANIMATION_CHANGED="animationchanged",sd.TRIGGER_ENTER="triggerenter",sd.TRIGGER_STAY="triggerstay",sd.TRIGGER_EXIT="triggerexit",sd.TRAIL_FILTER_CHANGE="trailfilterchange",sd.DOMINO_FILTER_CHANGE="dominofilterchange",sd}(),sb=(function(){function sd(){}sr(sd,"laya.events.Keyboard"),sd.NUMBER_0=48,sd.NUMBER_1=49,sd.NUMBER_2=50,sd.NUMBER_3=51,sd.NUMBER_4=52,sd.NUMBER_5=53,sd.NUMBER_6=54,sd.NUMBER_7=55,sd.NUMBER_8=56,sd.NUMBER_9=57,sd.A=65,sd.B=66,sd.C=67,sd.D=68,sd.E=69,sd.F=70,sd.G=71,sd.H=72,sd.I=73,sd.J=74,sd.K=75,sd.L=76,sd.M=77,sd.N=78,sd.O=79,sd.P=80,sd.Q=81,sd.R=82,sd.S=83,sd.T=84,sd.U=85,sd.V=86,sd.W=87,sd.X=88,sd.Y=89,sd.Z=90,sd.F1=112,sd.F2=113,sd.F3=114,sd.F4=115,sd.F5=116,sd.F6=117,sd.F7=118,sd.F8=119,sd.F9=120,sd.F10=121,sd.F11=122,sd.F12=123,sd.F13=124,sd.F14=125,sd.F15=126,sd.NUMPAD=21,sd.NUMPAD_0=96,sd.NUMPAD_1=97,sd.NUMPAD_2=98,sd.NUMPAD_3=99,sd.NUMPAD_4=100,sd.NUMPAD_5=101,sd.NUMPAD_6=102,sd.NUMPAD_7=103,sd.NUMPAD_8=104,sd.NUMPAD_9=105,sd.NUMPAD_ADD=107,sd.NUMPAD_DECIMAL=110,sd.NUMPAD_DIVIDE=111,sd.NUMPAD_ENTER=108,sd.NUMPAD_MULTIPLY=106,sd.NUMPAD_SUBTRACT=109,sd.SEMICOLON=186,sd.EQUAL=187,sd.COMMA=188,sd.MINUS=189,sd.PERIOD=190,sd.SLASH=191,sd.BACKQUOTE=192,sd.LEFTBRACKET=219,sd.BACKSLASH=220,sd.RIGHTBRACKET=221,sd.QUOTE=222,sd.ALTERNATE=18,sd.BACKSPACE=8,sd.CAPS_LOCK=20,sd.COMMAND=15,sd.CONTROL=17,sd.DELETE=46,sd.ENTER=13,sd.ESCAPE=27,sd.PAGE_UP=33,sd.PAGE_DOWN=34,sd.END=35,sd.HOME=36,sd.LEFT=37,sd.UP=38,sd.RIGHT=39,sd.DOWN=40,sd.SHIFT=16,sd.SPACE=32,sd.TAB=9,sd.INSERT=45}(),function(){function sh(){}return sr(sh,"laya.events.KeyBoardManager"),sh.__init__=function(){sh._addEvent("keydown"),sh._addEvent("keypress"),sh._addEvent("keyup")},sh._addEvent=function(sL){si.document.addEventListener(sL,function(sd){laya.events.KeyBoardManager._dispatch(sd,sL)},!0)},sh._dispatch=function(sd,sL){if(sh.enabled){sh._event._stoped=!1,sh._event.nativeEvent=sd,sh._event.keyCode=sd.keyCode||sd.which||sd.charCode,"keydown"===sL?sh._pressKeys[sh._event.keyCode]=!0:"keyup"===sL&&(sh._pressKeys[sh._event.keyCode]=null);for(var sl=s$.stage.focus&&null!=s$.stage.focus.event&&s$.stage.focus.displayedInStage?s$.stage.focus:s$.stage,sZ=sl;sZ;)sZ.event(sL,sh._event.setTo(sL,sZ,sl)),sZ=sZ.parent}},sh.hasKeyDown=function(sd){return sh._pressKeys[sd]},sh._pressKeys={},sh.enabled=!0,su(sh,["_event",function(){return this._event=new s_}]),sh}()),sc=(function(){function sd(){}sr(sd,"laya.events.KeyLocation"),sd.STANDARD=0,sd.LEFT=1,sd.RIGHT=2,sd.NUM_PAD=3}(),function(){function st(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=si.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new s_,this._matrix=new sE,this._point=new sO,this._rect=new sn,this._prePoint=new sO,this._curTouchID=NaN}sr(st,"laya.events.MouseManager");var sd=st.prototype;return sd.__init__=function(sd,sL){var sl=this;this._stage=sd;var sZ=this,sh=this._eventList;sL.oncontextmenu=function(sd){if(st.enabled)return!1},sL.addEventListener("mousedown",function(sd){st.enabled&&(si.onIE||sd.preventDefault(),sh.push(sd),sZ.mouseDownTime=si.now())}),sL.addEventListener("mouseup",function(sd){st.enabled&&(sd.preventDefault(),sh.push(sd),sZ.mouseDownTime=-si.now())},!0),sL.addEventListener("mousemove",function(sd){if(st.enabled){sd.preventDefault();var sL=si.now();if(sL-sZ._lastMoveTimer<10)return;sZ._lastMoveTimer=sL,sh.push(sd)}},!0),sL.addEventListener("mouseout",function(sd){st.enabled&&sh.push(sd)}),sL.addEventListener("mouseover",function(sd){st.enabled&&sh.push(sd)}),sL.addEventListener("touchstart",function(sd){st.enabled&&(sh.push(sd),st._isFirstTouch||sAd.isInputting||sd.preventDefault(),sZ.mouseDownTime=si.now())}),sL.addEventListener("touchend",function(sd){st.enabled?(st._isFirstTouch||sAd.isInputting||sd.preventDefault(),st._isFirstTouch=!1,sh.push(sd),sZ.mouseDownTime=-si.now()):sl._curTouchID=NaN},!0),sL.addEventListener("touchmove",function(sd){st.enabled&&(sd.preventDefault(),sh.push(sd))},!0),sL.addEventListener("touchcancel",function(sd){st.enabled?(sd.preventDefault(),sh.push(sd)):sl._curTouchID=NaN},!0),sL.addEventListener("mousewheel",function(sd){st.enabled&&sh.push(sd)}),sL.addEventListener("DOMMouseScroll",function(sd){st.enabled&&sh.push(sd)})},sd.initEvent=function(sd,sL){var sl;this._event._stoped=!1,this._event.nativeEvent=sL||sd,this._target=null,this._point.setTo(sd.pageX||sd.clientX,sd.pageY||sd.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=sd.identifier||0,this._tTouchID=this._event.touchId,(sl=sa.I._event)._stoped=!1,sl.nativeEvent=this._event.nativeEvent,sl.touchId=this._event.touchId},sd.checkMouseWheel=function(sd){this._event.delta=sd.wheelDelta?.025*sd.wheelDelta:-sd.detail;for(var sL=sa.I.getLastOvers(),sl=0,sZ=sL.length;sl<sZ;sl++){var sh=sL[sl];sh.event("mousewheel",this._event.setTo("mousewheel",sh,this._target))}},sd.onMouseMove=function(sd){sa.I.onMouseMove(sd,this._tTouchID)},sd.onMouseDown=function(sd){if(sAd.isInputting&&s$.stage.focus&&s$.stage.focus.focus&&!s$.stage.focus.contains(this._target)){var sL=s$.stage.focus._tf||s$.stage.focus,sl=sd._tf||sd;sl instanceof laya.display.Input&&sl.multiline==sL.multiline?sL._focusOut():sL.focus=!1}sa.I.onMouseDown(sd,this._tTouchID,this._isLeftMouse)},sd.onMouseUp=function(sd){sa.I.onMouseUp(sd,this._tTouchID,this._isLeftMouse)},sd.check=function(sd,sL,sl,sZ){this._point.setTo(sL,sl),sd.fromParentPoint(this._point),sL=this._point.x,sl=this._point.y;var sh=sd.scrollRect;if(sh&&(this._rect.setTo(sh.x,sh.y,sh.width,sh.height),!this._rect.contains(sL,sl)))return!1;if(!this.disableMouseEvent){if(sd.hitTestPrior&&!sd.mouseThrough&&!this.hitTest(sd,sL,sl))return!1;for(var s_=sd._childs.length-1;-1<s_;s_--){var sN=sd._childs[s_];if(!sN.destroyed&&sN.mouseEnabled&&sN.visible&&this.check(sN,sL,sl,sZ))return!0}}var sm=!(!sd.hitTestPrior||sd.mouseThrough||this.disableMouseEvent)||this.hitTest(sd,sL,sl);return sm?(this._target=sd,sZ.call(this,sd)):sZ===this.onMouseUp&&sd===this._stage&&(this._target=this._stage,sZ.call(this,this._target)),sm},sd.hitTest=function(sd,sL,sl){var sZ=!1;if(sd.scrollRect&&(sL-=sd.scrollRect.x,sl-=sd.scrollRect.y),sd.hitArea instanceof laya.utils.HitArea)return sd.hitArea.isHit(sL,sl);if(0<sd.width&&0<sd.height||sd.mouseThrough||sd.hitArea)if(sd.mouseThrough)sZ=sd.getGraphicBounds().contains(sL,sl);else{var sh=this._rect;sd.hitArea?sh=sd.hitArea:sh.setTo(0,0,sd.width,sd.height),sZ=sh.contains(sL,sl)}return sZ},sd.runEvent=function(){var sd=this._eventList.length;if(sd){var sL=this;sL.mouseEventTime=si.now();var sl,sZ=0,sh=0,s_=0;try{for(;sZ<sd;){var sN=this._eventList[sZ];switch("mousemove"!==sN.type&&(this._prePoint.x=this._prePoint.y=-1e6),sN.type){case"mousedown":this._touchIDs[0]=this._id++,st._isTouchRespond?st._isTouchRespond=!1:(sL._isLeftMouse=0===sN.button,sL.initEvent(sN),sL.check(sL._stage,sL.mouseX,sL.mouseY,sL.onMouseDown));break;case"mouseup":sL._isLeftMouse=0===sN.button,sL.initEvent(sN),sL.check(sL._stage,sL.mouseX,sL.mouseY,sL.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-sN.clientX)+Math.abs(this._prePoint.y-sN.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=sN.clientX,this._prePoint.y=sN.clientY,sL.initEvent(sN),sL.check(sL._stage,sL.mouseX,sL.mouseY,sL.onMouseMove));break;case"touchstart":st._isTouchRespond=!0,sL._isLeftMouse=!0;var sm=sN.changedTouches;for(sh=0,s_=sm.length;sh<s_;sh++)sl=sm[sh],(st.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=sl.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[sl.identifier]=this._id++,sL.initEvent(sl,sN),sL.check(sL._stage,sL.mouseX,sL.mouseY,sL.onMouseDown));break;case"touchend":case"touchcancel":st._isTouchRespond=!0,sL._isLeftMouse=!0;var su=sN.changedTouches;for(sh=0,s_=su.length;sh<s_;sh++)if(sl=su[sh],st.multiTouchEnabled||sl.identifier==this._curTouchID){this._curTouchID=NaN,sL.initEvent(sl,sN);sL.check(sL._stage,sL.mouseX,sL.mouseY,sL.onMouseUp)||sL.onMouseUp(null)}break;case"touchmove":var sx=sN.changedTouches;for(sh=0,s_=sx.length;sh<s_;sh++)sl=sx[sh],(st.multiTouchEnabled||sl.identifier==this._curTouchID)&&(sL.initEvent(sl,sN),sL.check(sL._stage,sL.mouseX,sL.mouseY,sL.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":sL.checkMouseWheel(sN);break;case"mouseout":sa.I.stageMouseOut();break;case"mouseover":sL._stage.event("mouseover",sL._event.setTo("mouseover",sL._stage,sL._stage))}sZ++}}catch(sd){throw this._eventList.length=0,sd}this._eventList.length=0}},st.enabled=!0,st.multiTouchEnabled=!0,st._isTouchRespond=!1,st._isFirstTouch=!0,su(st,["instance",function(){return this.instance=new st}]),st}()),sa=function(){function sc(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new s_}sr(sc,"laya.events.TouchManager");var sd=sc.prototype;return sd._clearTempArrs=function(){sc._oldArr.length=0,sc._newArr.length=0,sc._tEleArr.length=0},sd.getTouchFromArr=function(sd,sL){var sl,sZ,sh=0;for(sl=sL.length,sh=0;sh<sl;sh++)if((sZ=sL[sh]).id==sd)return sZ;return null},sd.removeTouchFromArr=function(sd,sL){var sl=0;for(sl=sL.length-1;0<=sl;sl--)sL[sl].id==sd&&sL.splice(sl,1)},sd.createTouchO=function(sd,sL){var sl;return(sl=sG.getItem("TouchData")||{}).id=sL,sl.tar=sd,sl},sd.onMouseDown=function(sd,sL,sl){var sZ,sh,s_,sN;(void 0===sl&&(sl=!1),this.enable)&&(sZ=this.getTouchFromArr(sL,this.preOvers),s_=this.getEles(sd,null,sc._tEleArr),sZ?sZ.tar=sd:(sh=this.createTouchO(sd,sL),this.preOvers.push(sh)),si.onMobile&&this.sendEvents(s_,"mouseover",sL),sN=sl?this.preDowns:this.preRightDowns,(sZ=this.getTouchFromArr(sL,sN))?sZ.tar=sd:(sh=this.createTouchO(sd,sL),sN.push(sh)),this.sendEvents(s_,sl?"mousedown":"rightmousedown",sL),this._clearTempArrs())},sd.sendEvents=function(sd,sL,sl){void 0===sl&&(sl=0);var sZ,sh,s_,sN=0;for(sZ=sd.length,this._event._stoped=!1,sh=sd[0],sN=0;sN<sZ;sN++){if((s_=sd[sN]).destroyed)return;if(s_.event(sL,this._event.setTo(sL,s_,sh)),this._event._stoped)break}},sd.getEles=function(sd,sL,sl){for(sl?sl.length=0:sl=[];sd&&sd!=sL;)sl.push(sd),sd=sd.parent;return sl},sd.checkMouseOutAndOverOfMove=function(sd,sL,sl){if(void 0===sl&&(sl=0),sL!=sd){var sZ,sh,s_=0,sN=0;if(sL.contains(sd))sh=this.getEles(sd,sL,sc._tEleArr),this.sendEvents(sh,"mouseover",sl);else if(sd.contains(sL))sh=this.getEles(sL,sd,sc._tEleArr),this.sendEvents(sh,"mouseout",sl);else{var sm,su;(sh=sc._tEleArr).length=0,sm=this.getEles(sL,null,sc._oldArr),su=this.getEles(sd,null,sc._newArr),sN=sm.length;var sx=0;for(s_=0;s_<sN;s_++){if(sZ=sm[s_],0<=(sx=su.indexOf(sZ))){su.splice(sx,su.length-sx);break}sh.push(sZ)}0<sh.length&&this.sendEvents(sh,"mouseout",sl),0<su.length&&this.sendEvents(su,"mouseover",sl)}}},sd.onMouseMove=function(sd,sL){var sl,sZ;this.enable&&((sl=this.getTouchFromArr(sL,this.preOvers))?(this.checkMouseOutAndOverOfMove(sd,sl.tar),sl.tar=sd,sZ=this.getEles(sd,null,sc._tEleArr)):(sZ=this.getEles(sd,null,sc._tEleArr),this.sendEvents(sZ,"mouseover",sL),this.preOvers.push(this.createTouchO(sd,sL))),this.sendEvents(sZ,"mousemove",sL),this._clearTempArrs())},sd.getLastOvers=function(){return(sc._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,sc._tEleArr):(sc._tEleArr.push(s$.stage),sc._tEleArr)},sd.stageMouseOut=function(){var sd;sd=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(sd,"mouseout",0)},sd.onMouseUp=function(sd,sL,sl){if(void 0===sl&&(sl=!1),this.enable){var sZ,sh,s_,sN,sm,su,sx=0,st=0,sb=si.onMobile;if(sh=this.getEles(sd,null,sc._tEleArr),this.sendEvents(sh,sl?"mouseup":"rightmouseup",sL),su=sl?this.preDowns:this.preRightDowns,sZ=this.getTouchFromArr(sL,su)){var sq,sY=si.now();if(sq=sY-this._lastClickTime<300,this._lastClickTime=sY,sd==sZ.tar)sm=sh;else for(s_=this.getEles(sZ.tar,null,sc._oldArr),(sm=sc._newArr).length=0,st=s_.length,sx=0;sx<st;sx++)sN=s_[sx],0<=sh.indexOf(sN)&&sm.push(sN);0<sm.length&&this.sendEvents(sm,sl?"click":"rightclick",sL),sl&&sq&&this.sendEvents(sm,"doubleclick",sL),this.removeTouchFromArr(sL,su),sZ.tar=null,sG.recover("TouchData",sZ)}else;(sZ=this.getTouchFromArr(sL,this.preOvers))&&sb&&((sm=this.getEles(sZ.tar,null,sm))&&0<sm.length&&this.sendEvents(sm,"mouseout",sL),this.removeTouchFromArr(sL,this.preOvers),sZ.tar=null,sG.recover("TouchData",sZ)),this._clearTempArrs()}},sc._oldArr=[],sc._newArr=[],sc._tEleArr=[],su(sc,["I",function(){return this.I=new sc}]),sc}(),sk=function(){function sd(){this._action=null}sr(sd,"laya.filters.Filter");var sL=sd.prototype;return s$.imps(sL,{"laya.filters.IFilter":!0}),sL.callNative=function(sd){},st(0,sL,"type",function(){return-1}),st(0,sL,"action",function(){return this._action}),sd.BLUR=16,sd.COLOR=32,sd.GLOW=8,sd._filterStart=null,sd._filterEnd=null,sd._EndTarget=null,sd._recycleScope=null,sd._filter=null,sd._useSrc=null,sd._endSrc=null,sd._useOut=null,sd._endOut=null,sd}(),sw=function(){function sd(){this.data=null}sr(sd,"laya.filters.ColorFilterAction");var sL=sd.prototype;return s$.imps(sL,{"laya.filters.IFilterAction":!0}),sL.apply=function(sd){var sL=sd.ctx.ctx,sl=sd.ctx.ctx.canvas;if(0==sl.width||0==sl.height)return sl;for(var sZ,sh=sL.getImageData(0,0,sl.width,sl.height),s_=sh.data,sN=0,sm=s_.length;sN<sm;sN+=4)sZ=this.getColor(s_[sN],s_[sN+1],s_[sN+2],s_[sN+3]),0!=s_[sN+3]&&(s_[sN]=sZ[0],s_[sN+1]=sZ[1],s_[sN+2]=sZ[2],s_[sN+3]=sZ[3]);return sL.putImageData(sh,0,0),sd},sL.getColor=function(sd,sL,sl,sZ){var sh=[];if(this.data._mat&&this.data._alpha){var s_=this.data._mat,sN=this.data._alpha;sh[0]=s_[0]*sd+s_[1]*sL+s_[2]*sl+s_[3]*sZ+sN[0],sh[1]=s_[4]*sd+s_[5]*sL+s_[6]*sl+s_[7]*sZ+sN[1],sh[2]=s_[8]*sd+s_[9]*sL+s_[10]*sl+s_[11]*sZ+sN[2],sh[3]=s_[12]*sd+s_[13]*sL+s_[14]*sl+s_[15]*sZ+sN[3]}return sh},sd}(),ss=(function(){function sd(){}sr(sd,"laya.maths.Arith"),sd.formatR=function(sd){return sd>Math.PI&&(sd-=2*Math.PI),sd<-Math.PI&&(sd+=2*Math.PI),sd},sd.isPOT=function(sd,sL){return 0<sd&&0==(sd&sd-1)&&0<sL&&0==(sL&sL-1)},sd.setMatToArray=function(sd,sL){sd.a,sd.b,sd.c,sd.d,sd.tx,sd.ty,sL[0]=sd.a,sL[1]=sd.b,sL[4]=sd.c,sL[5]=sd.d,sL[12]=sd.tx,sL[13]=sd.ty}}(),function(){function sd(){this._controlPoints=[new sO,new sO,new sO],this._calFun=this.getPoint2}sr(sd,"laya.maths.Bezier");var sL=sd.prototype;return sL._switchPoint=function(sd,sL){var sl=this._controlPoints.shift();sl.setTo(sd,sL),this._controlPoints.push(sl)},sL.getPoint2=function(sd,sL){var sl=this._controlPoints[0],sZ=this._controlPoints[1],sh=this._controlPoints[2],s_=Math.pow(1-sd,2)*sl.x+2*sd*(1-sd)*sZ.x+Math.pow(sd,2)*sh.x,sN=Math.pow(1-sd,2)*sl.y+2*sd*(1-sd)*sZ.y+Math.pow(sd,2)*sh.y;sL.push(s_,sN)},sL.getPoint3=function(sd,sL){var sl=this._controlPoints[0],sZ=this._controlPoints[1],sh=this._controlPoints[2],s_=this._controlPoints[3],sN=Math.pow(1-sd,3)*sl.x+3*sZ.x*sd*(1-sd)*(1-sd)+3*sh.x*sd*sd*(1-sd)+s_.x*Math.pow(sd,3),sm=Math.pow(1-sd,3)*sl.y+3*sZ.y*sd*(1-sd)*(1-sd)+3*sh.y*sd*sd*(1-sd)+s_.y*Math.pow(sd,3);sL.push(sN,sm)},sL.insertPoints=function(sd,sL){var sl,sZ=NaN;for(sl=1/(sd=0<sd?sd:5),sZ=0;sZ<=1;sZ+=sl)this._calFun(sZ,sL)},sL.getBezierPoints=function(sd,sL,sl){void 0===sL&&(sL=5),void 0===sl&&(sl=2);var sZ,sh,s_=0;if((sZ=sd.length)<2*(sl+1))return[];switch(sh=[],sl){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=sl;)this._controlPoints.push(new sO);for(s_=0;s_<2*sl;s_+=2)this._switchPoint(sd[s_],sd[s_+1]);for(s_=2*sl;s_<sZ;s_+=2)this._switchPoint(sd[s_],sd[s_+1]),s_/2%sl==0&&this.insertPoints(sL,sh);return sh},su(sd,["I",function(){return this.I=new sd}]),sd}()),sA=function(){function sx(){}return sr(sx,"laya.maths.GrahamScan"),sx.multiply=function(sd,sL,sl){return(sd.x-sl.x)*(sL.y-sl.y)-(sL.x-sl.x)*(sd.y-sl.y)},sx.dis=function(sd,sL){return(sd.x-sL.x)*(sd.x-sL.x)+(sd.y-sL.y)*(sd.y-sL.y)},sx._getPoints=function(sd,sL,sl){for(void 0===sL&&(sL=!1),sx._mPointList||(sx._mPointList=[]);sx._mPointList.length<sd;)sx._mPointList.push(new sO);return sl||(sl=[]),sl.length=0,sL?sx.getFrom(sl,sx._mPointList,sd):sx.getFromR(sl,sx._mPointList,sd),sl},sx.getFrom=function(sd,sL,sl){var sZ=0;for(sZ=0;sZ<sl;sZ++)sd.push(sL[sZ]);return sd},sx.getFromR=function(sd,sL,sl){var sZ=0;for(sZ=0;sZ<sl;sZ++)sd.push(sL.pop());return sd},sx.pListToPointList=function(sd,sL){void 0===sL&&(sL=!1);var sl=0,sZ=sd.length/2,sh=sx._getPoints(sZ,sL,sx._tempPointList);for(sl=0;sl<sZ;sl++)sh[sl].setTo(sd[sl+sl],sd[sl+sl+1]);return sh},sx.pointListToPlist=function(sd){var sL,sl=0,sZ=sd.length,sh=sx._temPList;for(sl=sh.length=0;sl<sZ;sl++)sL=sd[sl],sh.push(sL.x,sL.y);return sh},sx.scanPList=function(sd){return sf.copyArray(sd,sx.pointListToPlist(sx.scan(sx.pListToPointList(sd,!0))))},sx.scan=function(sd){var sL,sl,sZ,sh=0,s_=0,sN=0,sm=sd.length,su={};for((sl=sx._temArr).length=0,sh=(sm=sd.length)-1;0<=sh;sh--)sZ=(sL=sd[sh]).x+"_"+sL.y,su.hasOwnProperty(sZ)||(su[sZ]=!0,sl.push(sL));for(sm=sl.length,sf.copyArray(sd,sl),sh=1;sh<sm;sh++)(sd[sh].y<sd[sN].y||sd[sh].y==sd[sN].y&&sd[sh].x<sd[sN].x)&&(sN=sh);for(sL=sd[0],sd[0]=sd[sN],sd[sN]=sL,sh=1;sh<sm-1;sh++){for(s_=(sN=sh)+1;s_<sm;s_++)(0<sx.multiply(sd[s_],sd[sN],sd[0])||0==sx.multiply(sd[s_],sd[sN],sd[0])&&sx.dis(sd[0],sd[s_])<sx.dis(sd[0],sd[sN]))&&(sN=s_);sL=sd[sh],sd[sh]=sd[sN],sd[sN]=sL}if((sl=sx._temArr).length=0,sd.length<3)return sf.copyArray(sl,sd);for(sl.push(sd[0],sd[1],sd[2]),sh=3;sh<sm;sh++){for(;2<=sl.length&&0<=sx.multiply(sd[sh],sl[sl.length-1],sl[sl.length-2]);)sl.pop();sd[sh]&&sl.push(sd[sh])}return sl},sx._mPointList=null,sx._tempPointList=[],sx._temPList=[],sx._temArr=[],sx}(),sy=function(){function sh(){}return sr(sh,"laya.maths.MathUtil"),sh.subtractVector3=function(sd,sL,sl){sl[0]=sd[0]-sL[0],sl[1]=sd[1]-sL[1],sl[2]=sd[2]-sL[2]},sh.lerp=function(sd,sL,sl){return sd*(1-sl)+sL*sl},sh.scaleVector3=function(sd,sL,sl){sl[0]=sd[0]*sL,sl[1]=sd[1]*sL,sl[2]=sd[2]*sL},sh.lerpVector3=function(sd,sL,sl,sZ){var sh=sd[0],s_=sd[1],sN=sd[2];sZ[0]=sh+sl*(sL[0]-sh),sZ[1]=s_+sl*(sL[1]-s_),sZ[2]=sN+sl*(sL[2]-sN)},sh.lerpVector4=function(sd,sL,sl,sZ){var sh=sd[0],s_=sd[1],sN=sd[2],sm=sd[3];sZ[0]=sh+sl*(sL[0]-sh),sZ[1]=s_+sl*(sL[1]-s_),sZ[2]=sN+sl*(sL[2]-sN),sZ[3]=sm+sl*(sL[3]-sm)},sh.slerpQuaternionArray=function(sd,sL,sl,sZ,sh,s_,sN){var sm,su,sx,st,sb,sq=sd[sL+0],sY=sd[sL+1],sc=sd[sL+2],sr=sd[sL+3],sa=sl[sZ+0],sk=sl[sZ+1],se=sl[sZ+2],sw=sl[sZ+3];return(su=sq*sa+sY*sk+sc*se+sr*sw)<0&&(su=-su,sa=-sa,sk=-sk,se=-se,sw=-sw),sb=1e-6<1-su?(sm=Math.acos(su),sx=Math.sin(sm),st=Math.sin((1-sh)*sm)/sx,Math.sin(sh*sm)/sx):(st=1-sh,sh),s_[sN+0]=st*sq+sb*sa,s_[sN+1]=st*sY+sb*sk,s_[sN+2]=st*sc+sb*se,s_[sN+3]=st*sr+sb*sw,s_},sh.getRotation=function(sd,sL,sl,sZ){return Math.atan2(sZ-sL,sl-sd)/Math.PI*180},sh.sortBigFirst=function(sd,sL){return sd==sL?0:sd<sL?1:-1},sh.sortSmallFirst=function(sd,sL){return sd==sL?0:sd<sL?-1:1},sh.sortNumBigFirst=function(sd,sL){return parseFloat(sL)-parseFloat(sd)},sh.sortNumSmallFirst=function(sd,sL){return parseFloat(sd)-parseFloat(sL)},sh.sortByKey=function(sl,sd,sL){var sZ;return void 0===sd&&(sd=!1),void 0===sL&&(sL=!0),sZ=sd?sL?sh.sortNumBigFirst:sh.sortBigFirst:sL?sh.sortNumSmallFirst:sh.sortSmallFirst,function(sd,sL){return sZ(sd[sl],sL[sl])}},sh}(),sE=function(){function sl(sd,sL,sl,sZ,sh,s_){this.inPool=!1,this.bTransform=!1,void 0===sd&&(sd=1),void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=1),void 0===sh&&(sh=0),void 0===s_&&(s_=0),this.a=sd,this.b=sL,this.c=sl,this.d=sZ,this.tx=sh,this.ty=s_,this._checkTransform()}sr(sl,"laya.maths.Matrix");var sd=sl.prototype;return sd.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},sd._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},sd.setTranslate=function(sd,sL){return this.tx=sd,this.ty=sL,this},sd.translate=function(sd,sL){return this.tx+=sd,this.ty+=sL,this},sd.scale=function(sd,sL){this.a*=sd,this.d*=sL,this.c*=sd,this.b*=sL,this.tx*=sd,this.ty*=sL,this.bTransform=!0},sd.rotate=function(sd){var sL=Math.cos(sd),sl=Math.sin(sd),sZ=this.a,sh=this.c,s_=this.tx;this.a=sZ*sL-this.b*sl,this.b=sZ*sl+this.b*sL,this.c=sh*sL-this.d*sl,this.d=sh*sl+this.d*sL,this.tx=s_*sL-this.ty*sl,this.ty=s_*sl+this.ty*sL,this.bTransform=!0},sd.skew=function(sd,sL){var sl=Math.tan(sd),sZ=Math.tan(sL),sh=this.a,s_=this.b;return this.a+=sZ*this.c,this.b+=sZ*this.d,this.c+=sl*sh,this.d+=sl*s_,this},sd.invertTransformPoint=function(sd){var sL=this.a,sl=this.b,sZ=this.c,sh=this.d,s_=this.tx,sN=sL*sh-sl*sZ,sm=sh/sN,su=-sl/sN,sx=-sZ/sN,st=sL/sN,sb=(sZ*this.ty-sh*s_)/sN,sq=-(sL*this.ty-sl*s_)/sN;return sd.setTo(sm*sd.x+sx*sd.y+sb,su*sd.x+st*sd.y+sq)},sd.transformPoint=function(sd){return sd.setTo(this.a*sd.x+this.c*sd.y+this.tx,this.b*sd.x+this.d*sd.y+this.ty)},sd.transformPointN=function(sd){return sd.setTo(this.a*sd.x+this.c*sd.y,this.b*sd.x+this.d*sd.y)},sd.transformPointArray=function(sd,sL){for(var sl=sd.length,sZ=0;sZ<sl;sZ+=2){var sh=sd[sZ],s_=sd[sZ+1];sL[sZ]=this.a*sh+this.c*s_+this.tx,sL[sZ+1]=this.b*sh+this.d*s_+this.ty}return sL},sd.transformPointArrayScale=function(sd,sL){for(var sl=sd.length,sZ=0;sZ<sl;sZ+=2){var sh=sd[sZ],s_=sd[sZ+1];sL[sZ]=this.a*sh+this.c*s_,sL[sZ+1]=this.b*sh+this.d*s_}return sL},sd.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},sd.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},sd.invert=function(){var sd=this.a,sL=this.b,sl=this.c,sZ=this.d,sh=this.tx,s_=sd*sZ-sL*sl;return this.a=sZ/s_,this.b=-sL/s_,this.c=-sl/s_,this.d=sd/s_,this.tx=(sl*this.ty-sZ*sh)/s_,this.ty=-(sd*this.ty-sL*sh)/s_,this},sd.setTo=function(sd,sL,sl,sZ,sh,s_){return this.a=sd,this.b=sL,this.c=sl,this.d=sZ,this.tx=sh,this.ty=s_,this},sd.concat=function(sd){var sL=this.a,sl=this.c,sZ=this.tx;return this.a=sL*sd.a+this.b*sd.c,this.b=sL*sd.b+this.b*sd.d,this.c=sl*sd.a+this.d*sd.c,this.d=sl*sd.b+this.d*sd.d,this.tx=sZ*sd.a+this.ty*sd.c+sd.tx,this.ty=sZ*sd.b+this.ty*sd.d+sd.ty,this},sd.scaleEx=function(sd,sL){var sl=this.a,sZ=this.b,sh=this.c,s_=this.d;0!==sZ||0!==sh?(this.a=sd*sl,this.b=sd*sZ,this.c=sL*sh):(this.a=sd*sl,this.b=0*s_,this.c=0*sl),this.d=sL*s_,this.bTransform=!0},sd.rotateEx=function(sd){var sL=Math.cos(sd),sl=Math.sin(sd),sZ=this.a,sh=this.b,s_=this.c,sN=this.d;0!==sh||0!==s_?(this.a=sL*sZ+sl*s_,this.b=sL*sh+sl*sN,this.c=-sl*sZ+sL*s_,this.d=-sl*sh+sL*sN):(this.a=sL*sZ,this.b=sl*sN,this.c=-sl*sZ,this.d=sL*sN),this.bTransform=!0},sd.clone=function(){var sd=sl.create();return sd.a=this.a,sd.b=this.b,sd.c=this.c,sd.d=this.d,sd.tx=this.tx,sd.ty=this.ty,sd.bTransform=this.bTransform,sd},sd.copyTo=function(sd){return sd.a=this.a,sd.b=this.b,sd.c=this.c,sd.d=this.d,sd.tx=this.tx,sd.ty=this.ty,sd.bTransform=this.bTransform,sd},sd.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},sd.destroy=function(){if(!this.inPool){var sd=sl._cache;this.inPool=!0,sd._length||(sd._length=0),(sd[sd._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},sl.mul=function(sd,sL,sl){var sZ=sd.a,sh=sd.b,s_=sd.c,sN=sd.d,sm=sd.tx,su=sd.ty,sx=sL.a,st=sL.b,sb=sL.c,sq=sL.d,sY=sL.tx,sc=sL.ty;return 0!==st||0!==sb?(sl.a=sZ*sx+sh*sb,sl.b=sZ*st+sh*sq,sl.c=s_*sx+sN*sb,sl.d=s_*st+sN*sq,sl.tx=sx*sm+sb*su+sY,sl.ty=st*sm+sq*su+sc):(sl.a=sZ*sx,sl.b=sh*sq,sl.c=s_*sx,sl.d=sN*sq,sl.tx=sx*sm+sY,sl.ty=sq*su+sc),sl},sl.mul16=function(sd,sL,sl){var sZ=sd.a,sh=sd.b,s_=sd.c,sN=sd.d,sm=sd.tx,su=sd.ty,sx=sL.a,st=sL.b,sb=sL.c,sq=sL.d,sY=sL.tx,sc=sL.ty;return 0!==st||0!==sb?(sl[0]=sZ*sx+sh*sb,sl[1]=sZ*st+sh*sq,sl[4]=s_*sx+sN*sb,sl[5]=s_*st+sN*sq,sl[12]=sx*sm+sb*su+sY,sl[13]=st*sm+sq*su+sc):(sl[0]=sZ*sx,sl[1]=sh*sq,sl[4]=s_*sx,sl[5]=sN*sq,sl[12]=sx*sm+sY,sl[13]=sq*su+sc),sl},sl.mulPre=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=sd.a,sx=sd.b,st=sd.c,sb=sd.d,sq=sd.tx,sY=sd.ty;return 0!==sl||0!==sZ?(sm.a=su*sL+sx*sZ,sm.b=su*sl+sx*sh,sm.c=st*sL+sb*sZ,sm.d=st*sl+sb*sh,sm.tx=sL*sq+sZ*sY+s_,sm.ty=sl*sq+sh*sY+sN):(sm.a=su*sL,sm.b=sx*sh,sm.c=st*sL,sm.d=sb*sh,sm.tx=sL*sq+s_,sm.ty=sh*sY+sN),sm},sl.mulPos=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=sd.a,sx=sd.b,st=sd.c,sb=sd.d,sq=sd.tx,sY=sd.ty;return 0!==sx||0!==st?(sm.a=sL*su+sl*st,sm.b=sL*sx+sl*sb,sm.c=sZ*su+sh*st,sm.d=sZ*sx+sh*sb,sm.tx=su*s_+st*sN+sq,sm.ty=sx*s_+sb*sN+sY):(sm.a=sL*su,sm.b=sl*sb,sm.c=sZ*su,sm.d=sh*sb,sm.tx=su*s_+sq,sm.ty=sb*sN+sY),sm},sl.preMul=function(sd,sL,sl){var sZ=sd.a,sh=sd.b,s_=sd.c,sN=sd.d,sm=sL.a,su=sL.b,sx=sL.c,st=sL.d,sb=sL.tx,sq=sL.ty;return sl.a=sm*sZ,sl.b=sl.c=0,sl.d=st*sN,sl.tx=sb*sZ+sd.tx,sl.ty=sq*sN+sd.ty,0===su&&0===sx&&0===sh&&0===s_||(sl.a+=su*s_,sl.d+=sx*sh,sl.b+=sm*sh+su*sN,sl.c+=sx*sZ+st*s_,sl.tx+=sq*s_,sl.ty+=sb*sh),sl},sl.preMulXY=function(sd,sL,sl,sZ){var sh=sd.a,s_=sd.b,sN=sd.c,sm=sd.d;return sZ.a=sh,sZ.b=s_,sZ.c=sN,sZ.d=sm,sZ.tx=sL*sh+sd.tx+sl*sN,sZ.ty=sl*sm+sd.ty+sL*s_,sZ},sl.create=function(){var sd=sl._cache,sL=sd._length?sd[--sd._length]:new sl;return sL.inPool=!1,sL},sl.EMPTY=new sl,sl.TEMP=new sl,sl._cache=[],sl}(),sO=function(){function sd(sd,sL){void 0===sd&&(sd=0),void 0===sL&&(sL=0),this.x=sd,this.y=sL}sr(sd,"laya.maths.Point");var sL=sd.prototype;return sL.setTo=function(sd,sL){return this.x=sd,this.y=sL,this},sL.distance=function(sd,sL){return Math.sqrt((this.x-sd)*(this.x-sd)+(this.y-sL)*(this.y-sL))},sL.toString=function(){return this.x+","+this.y},sL.normalize=function(){var sd=Math.sqrt(this.x*this.x+this.y*this.y);if(0<sd){var sL=1/sd;this.x*=sL,this.y*=sL}},sd.TEMP=new sd,sd.EMPTY=new sd,sd}(),sn=function(){function sx(sd,sL,sl,sZ){void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),this.x=sd,this.y=sL,this.width=sl,this.height=sZ}sr(sx,"laya.maths.Rectangle");var sd=sx.prototype;return sd.setTo=function(sd,sL,sl,sZ){return this.x=sd,this.y=sL,this.width=sl,this.height=sZ,this},sd.copyFrom=function(sd){return this.x=sd.x,this.y=sd.y,this.width=sd.width,this.height=sd.height,this},sd.contains=function(sd,sL){return!(this.width<=0||this.height<=0)&&(sd>=this.x&&sd<this.right&&sL>=this.y&&sL<this.bottom)},sd.intersects=function(sd){return!(sd.x>this.x+this.width||sd.x+sd.width<this.x||sd.y>this.y+this.height||sd.y+sd.height<this.y)},sd.intersection=function(sd,sL){return this.intersects(sd)?(sL||(sL=new sx),sL.x=Math.max(this.x,sd.x),sL.y=Math.max(this.y,sd.y),sL.width=Math.min(this.right,sd.right)-sL.x,sL.height=Math.min(this.bottom,sd.bottom)-sL.y,sL):null},sd.union=function(sd,sL){return sL||(sL=new sx),this.clone(sL),sd.width<=0||sd.height<=0?sL:(sL.addPoint(sd.x,sd.y),sL.addPoint(sd.right,sd.bottom),this)},sd.clone=function(sd){return sd||(sd=new sx),sd.x=this.x,sd.y=this.y,sd.width=this.width,sd.height=this.height,sd},sd.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},sd.equals=function(sd){return!(!sd||sd.x!==this.x||sd.y!==this.y||sd.width!==this.width||sd.height!==this.height)},sd.addPoint=function(sd,sL){return this.x>sd&&(this.width+=this.x-sd,this.x=sd),this.y>sL&&(this.height+=this.y-sL,this.y=sL),this.width<sd-this.x&&(this.width=sd-this.x),this.height<sL-this.y&&(this.height=sL-this.y),this},sd._getBoundPoints=function(){var sd=sx._temB;return(sd.length=0)==this.width||0==this.height||sd.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),sd},sd.isEmpty=function(){return this.width<=0||this.height<=0},st(0,sd,"right",function(){return this.x+this.width}),st(0,sd,"bottom",function(){return this.y+this.height}),sx._getBoundPointS=function(sd,sL,sl,sZ){var sh=sx._temA;return(sh.length=0)==sl||0==sZ||sh.push(sd,sL,sd+sl,sL,sd,sL+sZ,sd+sl,sL+sZ),sh},sx._getWrapRec=function(sd,sL){if(!sd||sd.length<1)return sL?sL.setTo(0,0,0,0):sx.TEMP.setTo(0,0,0,0);sL=sL||new sx;var sl,sZ,sh,s_,sN,sm=sd.length,su=sO.TEMP;for(sh=sN=-(sZ=s_=99999),sl=0;sl<sm;sl+=2)su.x=sd[sl],su.y=sd[sl+1],sZ=sZ<su.x?sZ:su.x,s_=s_<su.y?s_:su.y,sh=sh>su.x?sh:su.x,sN=sN>su.y?sN:su.y;return sL.setTo(sZ,s_,sh-sZ,sN-s_)},sx.EMPTY=new sx,sx.TEMP=new sx,sx._temB=[],sx._temA=[],sx}(),sg=function(){function su(){}return sr(su,"laya.media.SoundManager"),st(1,su,"useAudioMusic",function(){return su._useAudioMusic},function(sd){su._useAudioMusic=sd,su._musicClass=sd?sld:null}),st(1,su,"autoStopMusic",function(){return su._autoStopMusic},function(sd){s$.stage.off("blur",null,su._stageOnBlur),s$.stage.off("focus",null,su._stageOnFocus),s$.stage.off("visibilitychange",null,su._visibilityChange),(su._autoStopMusic=sd)&&(s$.stage.on("blur",null,su._stageOnBlur),s$.stage.on("focus",null,su._stageOnFocus),s$.stage.on("visibilitychange",null,su._visibilityChange))}),st(1,su,"muted",function(){return su._muted},function(sd){sd!=su._muted&&(sd&&su.stopAllSound(),su.musicMuted=sd,su._muted=sd)}),st(1,su,"musicMuted",function(){return su._musicMuted},function(sd){sd!=su._musicMuted&&(sd?(su._tMusic&&su._musicChannel&&!su._musicChannel.isStopped?su._musicChannel.pause():su._musicChannel=null,su._musicMuted=sd):(su._musicMuted=sd,su._tMusic&&su._musicChannel&&su._musicChannel.resume()))}),st(1,su,"soundMuted",function(){return su._soundMuted},function(sd){su._soundMuted=sd}),su.addChannel=function(sd){0<=su._channels.indexOf(sd)||(su._channels.push(sd),su.autoReleaseSound&&0!=su._notUsedCount&&su._notUsedUrls[sd.url]&&(delete su._notUsedUrls[sd.url],0==--su._notUsedCount&&s$.timer.clear(su,su.disposeSoundIfNotUsed)))},su.removeChannel=function(sd){var sL=su._channels,sl=sL.indexOf(sd);if(-1!=sl&&(sL.splice(sl,1),su.autoReleaseSound)){var sZ=sd.url,sh=su.defaultIntervals[sZ]||2e4;if(0<sh){var s_=!0;for(sl=sL.length-1;0<=sl;sl--)if(sL[sl].url==sZ){s_=!1;break}s_&&(su._notUsedUrls[sZ]=Date.now()+sh,0==su._notUsedCount++&&s$.timer.loop(1e4,su,su.disposeSoundIfNotUsed))}}},su.disposeSoundIfNotUsed=function(){var sd=su._notUsedUrls;if(0!=su._notUsedCount){var sL=Date.now();for(var sl in sd)sL>=sd[sl]&&(delete sd[sl],--su._notUsedCount,su.destroySound(sl));if(0!=su._notUsedCount)return}s$.timer.clear(su,su.disposeSoundIfNotUsed)},su._visibilityChange=function(){s$.stage.isVisibility?su._stageOnFocus():su._stageOnBlur()},su._stageOnBlur=function(){su._isActive=!1,su._musicChannel&&(su._musicChannel.isStopped||(su._blurPaused=!0,su._musicChannel.pause())),su.stopAllSound(),s$.stage.once("mousedown",null,su._stageOnFocus)},su._recoverWebAudio=function(){s_d.ctx&&"running"!=s_d.ctx.state&&s_d.ctx.resume&&s_d.ctx.resume()},su._stageOnFocus=function(){if(su._isActive=!0,su._recoverWebAudio(),s$.stage.off("mousedown",null,su._stageOnFocus),su._blurPaused){var sd=su._musicChannel;sd&&su._music&&sd.isStopped&&(su._blurPaused=!1,su._music._disposed?su.playMusic(sd.url,sd.loops,sd.startHandler,sd.completeHandler,sd.startTime):sd.audioBuffer?sd.resume():su._music.play(sd.startTime,sd.loops,sd.startHandler,sd))}},su.playSound=function(sd,sL,sl,sZ,sh,s_){if(void 0===sL&&(sL=1),void 0===s_&&(s_=0),!sd)return null;if(su._muted)return null;if(su._recoverWebAudio(),sd==su._tMusic){if(su._musicMuted)return null}else{if(!su._isActive)return null;if(su._soundMuted)return null}var sN,sm=su._pool[sd];return sh||(sh=su._soundClass),sm||((sm=new sh).load(sd),su._pool[sd]=sm),(sN=sm.play(s_,sL,sl))?(sd==su._tMusic&&(su._music=sm,su._isActive||(su._blurPaused=!0,sN.pause())),sN.url=sd,sN.volume=sd==su._tMusic?su.musicVolume:su.soundVolume,sN.completeHandler=sZ,sN):null},su.destroySound=function(sd){var sL=su._pool[sd];sL&&(delete su._pool[sd],sL.dispose())},su.playMusic=function(sd,sL,sl,sZ,sh){return void 0===sL&&(sL=0),void 0===sh&&(sh=0),su._tMusic=sd,su._musicChannel&&su._musicChannel.stop(),su._musicChannel=su.playSound(sd,sL,sl,sZ,null,sh)},su.stopSound=function(sd){for(var sL,sl=su._channels.length-1;0<=sl;sl--)(sL=su._channels[sl]).url==sd&&sL.stop()},su.stopAll=function(){su._tMusic=null;var sd=0;for(sd=su._channels.length-1;0<=sd;sd--)su._channels[sd].stop()},su.stopAllSound=function(){var sd,sL=0;for(sL=su._channels.length-1;0<=sL;sL--)(sd=su._channels[sL]).url!=su._tMusic&&sd.stop()},su.stopMusic=function(){su._musicChannel&&su._musicChannel.stop(),su._tMusic=null},su.setSoundVolume=function(sd,sL){if(sL)su._setVolume(sL,sd);else{su.soundVolume=sd;var sl,sZ=0;for(sZ=su._channels.length-1;0<=sZ;sZ--)(sl=su._channels[sZ]).url!=su._tMusic&&(sl.volume=sd)}},su.setMusicVolume=function(sd){su.musicVolume=sd,su._setVolume(su._tMusic,sd)},su._setVolume=function(sd,sL){for(var sl,sZ=su._channels.length-1;0<=sZ;sZ--)(sl=su._channels[sZ]).url==sd&&(sl.volume=sL)},su.musicVolume=1,su.soundVolume=1,su.playbackRate=1,su._useAudioMusic=!0,su._muted=!1,su._soundMuted=!1,su._musicMuted=!1,su._tMusic=null,su._musicChannel=null,su._music=null,su._channels=[],su._autoStopMusic=!1,su._blurPaused=!1,su._isActive=!0,su._soundClass=null,su._musicClass=null,su.autoReleaseSound=!0,su._pool={},su.defaultIntervals={},su._notUsedUrls={},su._notUsedCount=0,su}(),sV=function(){var sd;function sl(){}return sr(sl,"laya.net.LocalStorage"),sl.__init__=function(){sl._baseClass||(sl._baseClass=sd).init(),sl.items=sl._baseClass.items,sl.support=sl._baseClass.support},sl.setItem=function(sd,sL){sl._baseClass.setItem(sd,sL)},sl.getItem=function(sd){return sl._baseClass.getItem(sd)},sl.setJSON=function(sd,sL){sl._baseClass.setJSON(sd,sL)},sl.getJSON=function(sd){return sl._baseClass.getJSON(sd)},sl.removeItem=function(sd){sl._baseClass.removeItem(sd)},sl.clear=function(){sl._baseClass.clear()},sl._baseClass=null,sl.items=null,sl.support=!1,sl.__init$=function(){sd=function(){function sl(){}return sr(sl,""),sl.init=function(){try{sl.support=!0,sl.items=sN.localStorage,sl.setItem("laya","1"),sl.removeItem("laya")}catch(sd){sl.support=!1}sl.support||console.log("LocalStorage is not supprot or browser is private mode.")},sl.setItem=function(sd,sL){try{sl.support&&sl.items.setItem(sd,sL)}catch(sd){console.warn("set localStorage failed",sd)}},sl.getItem=function(sd){return sl.support?sl.items.getItem(sd):null},sl.setJSON=function(sd,sL){try{sl.support&&sl.items.setItem(sd,JSON.stringify(sL))}catch(sd){console.warn("set localStorage failed",sd)}},sl.getJSON=function(sd){return JSON.parse(sl.support?sl.items.getItem(sd):null)},sl.removeItem=function(sd){sl.support&&sl.items.removeItem(sd)},sl.clear=function(){sl.support&&sl.items.clear()},sl.items=null,sl.support=!1,sl}()},sl}(),sI=(function(){function sZ(){}sr(sZ,"laya.net.ResourceVersion"),sZ.enable=function(sd,sL,sl){void 0===sl&&(sl=2),laya.net.ResourceVersion.type=sl,s$.loader.load(sd,se.create(null,sZ.onManifestLoaded,[sL]),null,"json"),sp.customFormat=sZ.addVersionPrefix},sZ.onManifestLoaded=function(sd,sL){sZ.manifest=sL,sd.run(),sL||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},sZ.addVersionPrefix=function(sd){return sZ.manifest&&sZ.manifest[sd]?2==sZ.type?sZ.manifest[sd]:sZ.manifest[sd]+"/"+sd:sd},sZ.FOLDER_VERSION=1,sZ.FILENAME_VERSION=2,sZ.manifest=null,sZ.type=1}(),function(){function sd(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}sr(sd,"laya.net.TTFLoader");var sL=sd.prototype;return sL.load=function(sd){var sL=(this._url=sd).split(".ttf")[0].split("/");this.fontName=sL[sL.length-1],si.window.conch?this._loadConch():si.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},sL._loadConch=function(){this._http=new sNd,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},sL._onHttpLoaded=function(sd){si.window.conch.setFontFaceFromBuffer(this.fontName,sd),this._clearHttp(),this._complete()},sL._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},sL._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},sL._complete=function(){s$.timer.clear(this,this._complete),s$.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},sL._checkComplete=function(){sF.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},sL._loadWithFontFace=function(){var sd=new si.window.FontFace(this.fontName,"url('"+this._url+"')");si.window.document.fonts.add(sd);var sL=this;sd.loaded.then(function(){sL._complete()}),sd.load()},sL._createDiv=function(){this._div=si.createElement("div"),this._div.innerHTML="laya";var sd=this._div.style;sd.fontFamily=this.fontName,sd.position="absolute",sd.left="-100px",sd.top="-100px",si.document.body.appendChild(this._div)},sL._loadWithCSS=function(){var sd=this,sL=si.createElement("style");sL.type="text/css",si.document.body.appendChild(sL),sL.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=sF.measureText("LayaTTFFont",this._fontTxt).width;var sl=this;sL.onload=function(){s$.timer.once(1e4,sl,sd._complete)},s$.timer.loop(20,this,this._checkComplete),this._createDiv()},sd._testString="LayaTTFFont",sd}()),sp=function(){function sZ(sd){this._url=null,this._path=null,this._url=sZ.formatURL(sd),this._path=sZ.getPath(sd)}sr(sZ,"laya.net.URL");var sd=sZ.prototype;return st(0,sd,"path",function(){return this._path}),st(0,sd,"url",function(){return this._url}),sZ.formatURL=function(sd,sL){if(!sd)return"null path";if(0<sd.indexOf(":"))return sd;null!=sZ.customFormat&&(sd=sZ.customFormat(sd,sL));var sl=sd.charAt(0);if("."===sl)return sZ.formatRelativePath((sL||sZ.basePath)+sd);if("~"===sl)return sZ.rootPath+sd.substring(1);if("d"===sl){if(0===sd.indexOf("data:image"))return sd}else if("/"===sl)return sd;return(sL||sZ.basePath)+sd},sZ.formatRelativePath=function(sd){for(var sL=sd.split("/"),sl=0,sZ=sL.length;sl<sZ;sl++)".."==sL[sl]&&(sL.splice(sl-1,2),sl-=2);return sL.join("/")},sZ.isAbsolute=function(sd){return 0<sd.indexOf(":")||"/"==sd.charAt(0)},sZ.getPath=function(sd){var sL=sd.lastIndexOf("/");return 0<sL?sd.substr(0,sL+1):""},sZ.getFileName=function(sd){var sL=sd.lastIndexOf("/");return 0<sL?sd.substr(sL+1):sd},sZ.version={},sZ.basePath="",sZ.rootPath="",sZ.customFormat=function(sd){var sL=sZ.version[sd];return!sH.isConchApp&&sL&&(sd+="?v="+sL),sd},sZ}(),sH=function(){function sh(sd,sL){this._timeId=0;var sl=sh._mainCanvas.source.style;sl.position="absolute",sl.top=sl.left="0px",sl.background="#000000",sh._mainCanvas.source.id="layaCanvas";var sZ=laya.renders.Render.isWebGL;sh._mainCanvas.source.width=sd,sh._mainCanvas.source.height=sL,sZ&&sh.WebGL.init(sh._mainCanvas,sd,sL),si.container.appendChild(sh._mainCanvas.source),(sh._context=new sX(sd,sL,sZ?null:sh._mainCanvas)).ctx.setIsMainContext(),si.window.requestAnimationFrame(function sd(sL){si.window.requestAnimationFrame(sd);s$.stage._loop()}),s$.stage.on("visibilitychange",this,this._onVisibilitychange)}sr(sh,"laya.renders.Render");var sd=sh.prototype;return sd._onVisibilitychange=function(){s$.stage.isVisibility?0!=this._timeId&&si.window.clearInterval(this._timeId):this._timeId=si.window.setInterval(this._enterFrame,1e3)},sd._enterFrame=function(sd){s$.stage._loop()},st(1,sh,"context",function(){return sh._context}),st(1,sh,"canvas",function(){return sh._mainCanvas.source}),sh._context=null,sh._mainCanvas=null,sh.WebGL=null,sh.isConchNode=!1,sh.isConchApp=!1,sh.isConchWebGL=!1,sh.isWebGL=!1,sh.is3DMode=!1,sh.optimizeTextureMemory=function(sd,sL){return!0},sh.__init$=function(){sN.ConchRenderType=sN.ConchRenderType||1,sN.ConchRenderType|=sN.conch?4:0,sh.isConchNode=5==(5&sN.ConchRenderType),sh.isConchApp=4==(4&sN.ConchRenderType),sh.isConchWebGL=6==sN.ConchRenderType},sh}(),sX=function(){function sN(sd,sL,sl){this.x=0,this.y=0,this._drawTexture=function(sd,sL,sl){sl[0].loaded&&this.ctx.drawTexture(sl[0],sl[1],sl[2],sl[3],sl[4],sd,sL)},this._fillTexture=function(sd,sL,sl){sl[0].loaded&&this.ctx.fillTexture(sl[0],sl[1]+sd,sl[2]+sL,sl[3],sl[4],sl[5],sl[6],sl[7])},this._drawTextureWithTransform=function(sd,sL,sl){sl[0].loaded&&this.ctx.drawTextureWithTransform(sl[0],sl[1],sl[2],sl[3],sl[4],sl[5],sd,sL,sl[6])},this._fillQuadrangle=function(sd,sL,sl){this.ctx.fillQuadrangle(sl[0],sl[1],sl[2],sl[3],sl[4])},this._drawRect=function(sd,sL,sl){var sZ=this.ctx;null!=sl[4]&&(sZ.fillStyle=sl[4],sZ.fillRect(sd+sl[0],sL+sl[1],sl[2],sl[3],null)),null!=sl[5]&&(sZ.strokeStyle=sl[5],sZ.lineWidth=sl[6],sZ.strokeRect(sd+sl[0],sL+sl[1],sl[2],sl[3],sl[6]))},this._drawPie=function(sd,sL,sl){var sZ=this.ctx;sH.isWebGL&&sZ.setPathId(sl[8]),sZ.beginPath(),sH.isWebGL?(sZ.movePath(sl[0]+sd,sl[1]+sL),sZ.moveTo(0,0)):sZ.moveTo(sd+sl[0],sL+sl[1]),sZ.arc(sd+sl[0],sL+sl[1],sl[2],sl[3],sl[4]),sZ.closePath(),this._fillAndStroke(sl[5],sl[6],sl[7],!0)},this._clipRect=function(sd,sL,sl){this.ctx.clipRect(sd+sl[0],sL+sl[1],sl[2],sl[3])},this._fillRect=function(sd,sL,sl){this.ctx.fillRect(sd+sl[0],sL+sl[1],sl[2],sl[3],sl[4])},this._drawCircle=function(sd,sL,sl){var sZ=this.ctx;sH.isWebGL&&sZ.setPathId(sl[6]),sK.drawCall++,sZ.beginPath(),sH.isWebGL&&sZ.movePath(sl[0]+sd,sl[1]+sL),sZ.arc(sl[0]+sd,sl[1]+sL,sl[2],0,sN.PI2),sZ.closePath(),this._fillAndStroke(sl[3],sl[4],sl[5],!0)},this._fillCircle=function(sd,sL,sl){sK.drawCall++;var sZ=this.ctx;sZ.beginPath(),sZ.fillStyle=sl[3],sZ.arc(sl[0]+sd,sl[1]+sL,sl[2],0,sN.PI2),sZ.fill()},this._setShader=function(sd,sL,sl){this.ctx.setShader(sl[0])},this._drawLine=function(sd,sL,sl){var sZ=this.ctx;sH.isWebGL&&sZ.setPathId(sl[6]),sZ.beginPath(),sZ.strokeStyle=sl[4],sZ.lineWidth=sl[5],sH.isWebGL?(sZ.movePath(sd,sL),sZ.moveTo(sl[0],sl[1]),sZ.lineTo(sl[2],sl[3])):(sZ.moveTo(sd+sl[0],sL+sl[1]),sZ.lineTo(sd+sl[2],sL+sl[3])),sZ.stroke()},this._drawLines=function(sd,sL,sl){var sZ=this.ctx;sH.isWebGL&&sZ.setPathId(sl[5]),sZ.beginPath(),sd+=sl[0],sL+=sl[1],sH.isWebGL&&sZ.movePath(sd,sL),sZ.strokeStyle=sl[3],sZ.lineWidth=sl[4];var sh=sl[2],s_=2,sN=sh.length;if(sH.isWebGL)for(sZ.moveTo(sh[0],sh[1]);s_<sN;)sZ.lineTo(sh[s_++],sh[s_++]);else for(sZ.moveTo(sd+sh[0],sL+sh[1]);s_<sN;)sZ.lineTo(sd+sh[s_++],sL+sh[s_++]);sZ.stroke()},this._drawLinesWebGL=function(sd,sL,sl){this.ctx.drawLines(sd+this.x+sl[0],sL+this.y+sl[1],sl[2],sl[3],sl[4])},this._drawCurves=function(sd,sL,sl){this.ctx.drawCurves(sd,sL,sl)},this._draw=function(sd,sL,sl){sl[0].call(null,this,sd,sL)},this._transformByMatrix=function(sd,sL,sl){this.ctx.transformByMatrix(sl[0])},this._setTransform=function(sd,sL,sl){this.ctx.setTransform(sl[0],sl[1],sl[2],sl[3],sl[4],sl[5])},this._setTransformByMatrix=function(sd,sL,sl){this.ctx.setTransformByMatrix(sl[0])},this._save=function(sd,sL,sl){this.ctx.save()},this._restore=function(sd,sL,sl){this.ctx.restore()},this._translate=function(sd,sL,sl){this.ctx.translate(sl[0],sl[1])},this._transform=function(sd,sL,sl){this.ctx.translate(sl[1]+sd,sl[2]+sL);var sZ=sl[0];this.ctx.transform(sZ.a,sZ.b,sZ.c,sZ.d,sZ.tx,sZ.ty),this.ctx.translate(-sd-sl[1],-sL-sl[2])},this._rotate=function(sd,sL,sl){this.ctx.translate(sl[1]+sd,sl[2]+sL),this.ctx.rotate(sl[0]),this.ctx.translate(-sd-sl[1],-sL-sl[2])},this._scale=function(sd,sL,sl){this.ctx.translate(sl[2]+sd,sl[3]+sL),this.ctx.scale(sl[0],sl[1]),this.ctx.translate(-sd-sl[2],-sL-sl[3])},this._alpha=function(sd,sL,sl){this.ctx.globalAlpha*=sl[0]},this._setAlpha=function(sd,sL,sl){this.ctx.globalAlpha=sl[0]},this._fillText=function(sd,sL,sl){this.ctx.fillText(sl[0],sl[1]+sd,sl[2]+sL,sl[3],sl[4],sl[5])},this._strokeText=function(sd,sL,sl){this.ctx.strokeText(sl[0],sl[1]+sd,sl[2]+sL,sl[3],sl[4],sl[5],sl[6])},this._fillBorderText=function(sd,sL,sl){this.ctx.fillBorderText(sl[0],sl[1]+sd,sl[2]+sL,sl[3],sl[4],sl[5],sl[6],sl[7])},this._blendMode=function(sd,sL,sl){this.ctx.globalCompositeOperation=sl[0]},this._beginClip=function(sd,sL,sl){this.ctx.beginClip&&this.ctx.beginClip(sd+sl[0],sL+sl[1],sl[2],sl[3])},this._setIBVB=function(sd,sL,sl){this.ctx.setIBVB(sl[0]+sd,sl[1]+sL,sl[2],sl[3],sl[4],sl[5],sl[6],sl[7])},this._fillTrangles=function(sd,sL,sl){this.ctx.fillTrangles(sl[0],sl[1]+sd,sl[2]+sL,sl[3],sl[4])},this._drawPath=function(sd,sL,sl){var sZ=this.ctx;sH.isWebGL&&sZ.setPathId(-1),sZ.beginPath(),sd+=sl[0],sL+=sl[1],sH.isWebGL&&sZ.movePath(sd,sL);for(var sh=sl[2],s_=0,sN=sh.length;s_<sN;s_++){var sm=sh[s_];switch(sm[0]){case"moveTo":sH.isWebGL?sZ.moveTo(sm[1],sm[2]):sZ.moveTo(sd+sm[1],sL+sm[2]);break;case"lineTo":sH.isWebGL?sZ.lineTo(sm[1],sm[2]):sZ.lineTo(sd+sm[1],sL+sm[2]);break;case"arcTo":sH.isWebGL?sZ.arcTo(sm[1],sm[2],sm[3],sm[4],sm[5]):sZ.arcTo(sd+sm[1],sL+sm[2],sd+sm[3],sL+sm[4],sm[5]);break;case"closePath":sZ.closePath()}}var su=sl[3];null!=su&&(sZ.fillStyle=su.fillStyle,sZ.fill());var sx=sl[4];null!=sx&&(sZ.strokeStyle=sx.strokeStyle,sZ.lineWidth=sx.lineWidth||1,sZ.lineJoin=sx.lineJoin,sZ.lineCap=sx.lineCap,sZ.miterLimit=sx.miterLimit,sZ.stroke())},this.drawPoly=function(sd,sL,sl){this.ctx.drawPoly(sd+this.x+sl[0],sL+this.y+sl[1],sl[2],sl[3],sl[4],sl[5],sl[6])},this._drawPoly=function(sd,sL,sl){var sZ=this.ctx,sh=sl[2],s_=2,sN=sh.length;if(sH.isWebGL)for(sZ.setPathId(sl[6]),sZ.beginPath(),sd+=sl[0],sL+=sl[1],sZ.movePath(sd,sL),sZ.moveTo(sh[0],sh[1]);s_<sN;)sZ.lineTo(sh[s_++],sh[s_++]);else for(sZ.beginPath(),sd+=sl[0],sL+=sl[1],sZ.moveTo(sd+sh[0],sL+sh[1]);s_<sN;)sZ.lineTo(sd+sh[s_++],sL+sh[s_++]);sZ.closePath(),this._fillAndStroke(sl[3],sl[4],sl[5],sl[7])},this._drawSkin=function(sd,sL,sl){var sZ=sl[0];if(sZ){var sh=this.ctx;sZ.render(sh,sd,sL)}},this._drawParticle=function(sd,sL,sl){this.ctx.drawParticle(sd+this.x,sL+this.y,sl[0])},this._setFilters=function(sd,sL,sl){this.ctx.setFilters(sl)},sl?this.ctx=sl.getContext("2d"):(sl=swd.create("3D"),this.ctx=sF.createWebGLContext2D(sl),sl._setContext(this.ctx)),sl.size(sd,sL),this.canvas=sl}sr(sN,"laya.renders.RenderContext");var sd=sN.prototype;return sd.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},sd.drawTexture=function(sd,sL,sl,sZ,sh){sd.loaded&&this.ctx.drawTexture(sd,sL,sl,sZ,sh,this.x,this.y)},sd._drawTextures=function(sd,sL,sl){sl[0].loaded&&this.ctx.drawTextures(sl[0],sl[1],sd+this.x,sL+this.y)},sd.drawTextureWithTransform=function(sd,sL,sl,sZ,sh,s_,sN){sd.loaded&&this.ctx.drawTextureWithTransform(sd,sL,sl,sZ,sh,s_,this.x,this.y,sN)},sd.fillQuadrangle=function(sd,sL,sl,sZ,sh){this.ctx.fillQuadrangle(sd,sL,sl,sZ,sh)},sd.drawCanvas=function(sd,sL,sl,sZ,sh){this.ctx.drawCanvas(sd,sL+this.x,sl+this.y,sZ,sh)},sd.drawRect=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=1);var sN=this.ctx;sN.strokeStyle=sh,sN.lineWidth=s_,sN.strokeRect(sd+this.x,sL+this.y,sl,sZ,s_)},sd._fillAndStroke=function(sd,sL,sl,sZ){void 0===sZ&&(sZ=!1);var sh=this.ctx;null!=sd&&(sh.fillStyle=sd,sH.isWebGL?sh.fill(sZ):sh.fill()),null!=sL&&0<sl&&(sh.strokeStyle=sL,sh.lineWidth=sl,sh.stroke())},sd.clipRect=function(sd,sL,sl,sZ){this.ctx.clipRect(sd+this.x,sL+this.y,sl,sZ)},sd.fillRect=function(sd,sL,sl,sZ,sh){this.ctx.fillRect(sd+this.x,sL+this.y,sl,sZ,sh)},sd.drawCircle=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=1),sK.drawCall++;var s_=this.ctx;s_.beginPath(),s_.strokeStyle=sZ,s_.lineWidth=sh,s_.arc(sd+this.x,sL+this.y,sl,0,sN.PI2),s_.stroke()},sd.drawTriangles=function(sd,sL,sl){if(sH.isWebGL)this.ctx.drawTriangles(sl[0],sd+sl[1],sL+sl[2],sl[3],sl[4],sl[5],sl[6],sl[7],sl[8],sl[9]);else{var sZ=sl[5],sh=0,s_=sZ.length,sN=this.ctx;for(sh=0;sh<s_;sh+=3){var sm=2*sZ[sh],su=2*sZ[sh+1],sx=2*sZ[sh+2];sN.drawTriangle(sl[0],sl[3],sl[4],sm,su,sx,sl[6],!0)}}},sd.fillCircle=function(sd,sL,sl,sZ){sK.drawCall++;var sh=this.ctx;sh.beginPath(),sh.fillStyle=sZ,sh.arc(sd+this.x,sL+this.y,sl,0,sN.PI2),sh.fill()},sd.setShader=function(sd){this.ctx.setShader(sd)},sd.drawLine=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=1);var sN=this.ctx;sN.beginPath(),sN.strokeStyle=sh,sN.lineWidth=s_,sN.moveTo(this.x+sd,this.y+sL),sN.lineTo(this.x+sl,this.y+sZ),sN.stroke()},sd.clear=function(){this.ctx.clear()},sd.transformByMatrix=function(sd){this.ctx.transformByMatrix(sd)},sd.setTransform=function(sd,sL,sl,sZ,sh,s_){this.ctx.setTransform(sd,sL,sl,sZ,sh,s_)},sd.setTransformByMatrix=function(sd){this.ctx.setTransformByMatrix(sd)},sd.save=function(){this.ctx.save()},sd.restore=function(){this.ctx.restore()},sd.translate=function(sd,sL){this.ctx.translate(sd,sL)},sd.transform=function(sd,sL,sl,sZ,sh,s_){this.ctx.transform(sd,sL,sl,sZ,sh,s_)},sd.rotate=function(sd){this.ctx.rotate(sd)},sd.scale=function(sd,sL){this.ctx.scale(sd,sL)},sd.alpha=function(sd){this.ctx.globalAlpha*=sd},sd.setAlpha=function(sd){this.ctx.globalAlpha=sd},sd.fillWords=function(sd,sL,sl,sZ,sh,s_){void 0===s_&&(s_=0),this.ctx.fillWords(sd,sL,sl,sZ,sh,s_)},sd.fillBorderWords=function(sd,sL,sl,sZ,sh,s_,sN){this.ctx.fillBorderWords(sd,sL,sl,sZ,sh,s_,sN)},sd.fillText=function(sd,sL,sl,sZ,sh,s_){this.ctx.fillText(sd,sL+this.x,sl+this.y,sZ,sh,s_)},sd.strokeText=function(sd,sL,sl,sZ,sh,s_,sN){this.ctx.strokeText(sd,sL+this.x,sl+this.y,sZ,sh,s_,sN)},sd.blendMode=function(sd){this.ctx.globalCompositeOperation=sd},sd.flush=function(){this.ctx.flush&&this.ctx.flush()},sd.addRenderObject=function(sd){this.ctx.addRenderObject(sd)},sd.beginClip=function(sd,sL,sl,sZ){this.ctx.beginClip&&this.ctx.beginClip(sd,sL,sl,sZ)},sd.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},sd.fillTrangles=function(sd,sL,sl){this.ctx.fillTrangles(sl[0],sl[1],sl[2],sl[3],4<sl.length?sl[4]:null)},sN.PI2=2*Math.PI,sN}(),sj=function(){function sN(sd,sL){switch(this._next=sL||sN.NORENDER,sd){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=sk._filter);case 69905:return void(this._fun=sN._initRenderFun)}this.onCreate(sd)}sr(sN,"laya.renders.RenderSprite");var sd=sN.prototype;return sd.onCreate=function(sd){},sd._style=function(sd,sL,sl,sZ){sd._style.render(sd,sL,sl,sZ);var sh=this._next;sh._fun.call(sh,sd,sL,sl,sZ)},sd._no=function(sd,sL,sl,sZ){},sd._custom=function(sd,sL,sl,sZ){sd.customRender(sL,sl,sZ);var sh=sd._style._tf;this._next._fun.call(this._next,sd,sL,sl-sh.translateX,sZ-sh.translateY)},sd._clip=function(sd,sL,sl,sZ){var sh=this._next;if(sh!=sN.NORENDER){var s_=sd._style.scrollRect;sL.ctx.save(),sL.ctx.clipRect(sl,sZ,s_.width,s_.height),sh._fun.call(sh,sd,sL,sl-s_.x,sZ-s_.y),sL.ctx.restore()}},sd._blend=function(sd,sL,sl,sZ){var sh=sd._style;sh.blendMode&&(sL.ctx.globalCompositeOperation=sh.blendMode);var s_=this._next;s_._fun.call(s_,sd,sL,sl,sZ),sL.ctx.globalCompositeOperation="source-over"},sd._mask=function(sd,sL,sl,sZ){var sh=this._next;sh._fun.call(sh,sd,sL,sl,sZ);var s_=sd.mask;s_&&(sL.ctx.globalCompositeOperation="destination-in",(0<s_.numChildren||!s_.graphics._isOnlyOne())&&(s_.cacheAsBitmap=!0),s_.render(sL,sl-sd.pivotX,sZ-sd.pivotY)),sL.ctx.globalCompositeOperation="source-over"},sd._graphics=function(sd,sL,sl,sZ){var sh=sd._style._tf;sd._graphics&&sd._graphics._render(sd,sL,sl-sh.translateX,sZ-sh.translateY);var s_=this._next;s_._fun.call(s_,sd,sL,sl,sZ)},sd._image=function(sd,sL,sl,sZ){var sh=sd._style;sL.ctx.drawTexture2(sl,sZ,sh._tf.translateX,sh._tf.translateY,sd.transform,sh.alpha,sh.blendMode,sd._graphics._one)},sd._image2=function(sd,sL,sl,sZ){var sh=sd._style._tf;sL.ctx.drawTexture2(sl,sZ,sh.translateX,sh.translateY,sd.transform,1,null,sd._graphics._one)},sd._alpha=function(sd,sL,sl,sZ){var sh;if(.01<(sh=sd._style.alpha)||sd._needRepaint()){var s_=sL.ctx.globalAlpha;sL.ctx.globalAlpha*=sh;var sN=this._next;sN._fun.call(sN,sd,sL,sl,sZ),sL.ctx.globalAlpha=s_}},sd._transform=function(sd,sL,sl,sZ){var sh=sd.transform,s_=this._next;sh&&s_!=sN.NORENDER?(sL.save(),sL.transform(sh.a,sh.b,sh.c,sh.d,sh.tx+sl,sh.ty+sZ),s_._fun.call(s_,sd,sL,0,0),sL.restore()):s_._fun.call(s_,sd,sL,sl,sZ)},sd._childs=function(sd,sL,sl,sZ){var sh=sd._style,s_=sh._tf;if(sl=sl-s_.translateX+sh.paddingLeft,sZ=sZ-s_.translateY+sh.paddingTop,sh._calculation){var sN=sd._getWords();if(sN){var sm=sh;sm&&(sm.stroke?sL.fillBorderWords(sN,sl,sZ,sm.font,sm.color,sm.strokeColor,sm.stroke):sL.fillWords(sN,sl,sZ,sm.font,sm.color,"none"!=sm.textDecoration&&sm.underLine?1:0))}}var su,sx=sd._childs,st=sx.length;if(sd.viewport||sd.optimizeScrollRect&&sd._style.scrollRect){var sb=sd.viewport||sd._style.scrollRect,sq=sb.x,sY=sb.y,sc=sb.right,sr=sb.bottom,sa=NaN,sk=NaN;for(se=0;se<st;++se)(su=sx[se]).visible&&(sa=su._x)<sc&&sa+su.width>sq&&(sk=su._y)<sr&&sk+su.height>sY&&su.render(sL,sl,sZ)}else for(var se=0;se<st;++se)(su=sx[se])._style.visible&&su.render(sL,sl,sZ)},sd._canvas=function(sd,sL,sl,sZ){var sh=sd._$P.cacheCanvas;if(sh){"bitmap"===sh.type?sK.canvasBitmap++:sK.canvasNormal++;var s_=sh.ctx;if(sd._needRepaint()||!s_)this._canvas_repaint(sd,sL,sl,sZ);else{var sN=sh._cacheRec;sL.drawCanvas(s_.canvas,sl+sN.x,sZ+sN.y,sN.width,sN.height)}}else this._next._fun.call(this._next,sd,sL,sl,sZ)},sd._canvas_repaint=function(sd,sL,sl,sZ){var sh=sd._$P.cacheCanvas,s_=this._next;if(sh){var sN,sm,su,sx,st=sh.ctx,sb=sd._needRepaint()||!st,sq=sh.type;if("bitmap"===sq?sK.canvasBitmap++:sK.canvasNormal++,sb){var sY,sc;sh._cacheRec||(sh._cacheRec=new sn),sH.isWebGL&&"bitmap"!==sq?sh._cacheRec.setTo(-sd.pivotX,-sd.pivotY,1,1):((sx=sd.getSelfBounds()).x=sx.x-sd.pivotX,sx.y=sx.y-sd.pivotY,sx.x=sx.x-16,sx.y=sx.y-16,sx.width=sx.width+32,sx.height=sx.height+32,sx.x=Math.floor(sx.x+sl)-sl,sx.y=Math.floor(sx.y+sZ)-sZ,sx.width=Math.floor(sx.width),sx.height=Math.floor(sx.height),sh._cacheRec.copyFrom(sx)),sx=sh._cacheRec;var sr,sa=sH.isWebGL?1:si.pixelRatio*s$.stage.clientScaleX,sk=sH.isWebGL?1:si.pixelRatio*s$.stage.clientScaleY;if(!sH.isWebGL){var se,sw=1,ss=1;for(se=sd;se&&se!=s$.stage;)sw*=se.scaleX,ss*=se.scaleY,se=se.parent;sH.isWebGL?(sw<1&&(sa*=sw),ss<1&&(sk*=ss)):(1<sw&&(sa*=sw),1<ss&&(sk*=ss))}if(sd.scrollRect){var sA=sd.scrollRect;sx.x-=sA.x,sx.y-=sA.y}if(sY=sx.width*sa,sc=sx.height*sk,sm=sx.x,su=sx.y,sH.isWebGL&&"bitmap"===sq&&(2048<sY||2048<sc))return console.warn("cache bitmap size larger than 2048,cache ignored"),sh.ctx&&(sG.recover("RenderContext",sh.ctx),sh.ctx.canvas.size(0,0),sh.ctx=null),void s_._fun.call(s_,sd,sL,sl,sZ);if(st||(st=sh.ctx=sG.getItem("RenderContext")||new sX(sY,sc,swd.create("AUTO"))),st.ctx.sprite=sd,(sN=st.canvas).clear(),(sN.width!=sY||sN.height!=sc)&&sN.size(sY,sc),"bitmap"===sq?sN.context.asBitmap=!0:"normal"===sq&&(sN.context.asBitmap=!1),1!=sa||1!=sk){var sy=st.ctx;sy.save(),sy.scale(sa,sk),!sH.isConchWebGL&&sH.isConchApp&&(sr=sd._$P.cf)&&sy.setFilterMatrix&&sy.setFilterMatrix(sr._mat,sr._alpha),s_._fun.call(s_,sd,st,-sm,-su),sy.restore(),sH.isConchApp&&!sH.isConchWebGL||sd._applyFilters()}else sy=st.ctx,!sH.isConchWebGL&&sH.isConchApp&&(sr=sd._$P.cf)&&sy.setFilterMatrix&&sy.setFilterMatrix(sr._mat,sr._alpha),s_._fun.call(s_,sd,st,-sm,-su),sH.isConchApp&&!sH.isConchWebGL||sd._applyFilters();sd._$P.staticCache&&(sh.reCache=!1),sK.canvasReCache++}else sm=(sx=sh._cacheRec).x,su=sx.y,sN=st.canvas;sL.drawCanvas(sN,sl+sm,sZ+su,sx.width,sx.height)}else s_._fun.call(s_,sd,st,sl,sZ)},sN.__init__=function(){var sd,sL,sl=0;for(sL=sF.createRenderSprite(69905,null),sd=sN.renders.length=4096,sl=0;sl<sd;sl++)sN.renders[sl]=sL;sN.renders[0]=sF.createRenderSprite(0,null),function(sd,sL){for(var sl=0,sZ=0;sZ<sd.length;sZ++)sl|=sd[sZ],sN.renders[sl]=sL}([1,512,4,2],new sN(1,null)),sN.renders[513]=sF.createRenderSprite(513,null),sN.renders[517]=new sN(517,null)},sN._initRenderFun=function(sd,sL,sl,sZ){var sh=sd._renderType;(sN.renders[sh]=sN._getTypeRender(sh))._fun(sd,sL,sl,sZ)},sN._getTypeRender=function(sd){for(var sL=null,sl=2048;1<sl;)sl&sd&&(sL=sF.createRenderSprite(sl,sL)),sl>>=1;return sL},sN.IMAGE=1,sN.ALPHA=2,sN.TRANSFORM=4,sN.BLEND=8,sN.CANVAS=16,sN.FILTERS=32,sN.MASK=64,sN.CLIP=128,sN.STYLE=256,sN.GRAPHICS=512,sN.CUSTOM=1024,sN.CHILDS=2048,sN.INIT=69905,sN.renders=[],sN.NORENDER=new sN(0,null),sN}(),sR=function(){function sm(){this._repaint=!1}sr(sm,"laya.resource.Context");var sd=sm.prototype;return sd.replaceReset=function(){var sd,sL,sl=0;for(sd=sm.replaceKeys.length,sl=0;sl<sd;sl++)sL=sm.replaceKeys[sl],this[sm.newKeys[sl]]=this[sL]},sd.replaceResotre=function(){this.__restore(),this.__reset()},sd.setIsMainContext=function(){},sd.drawTextures=function(sd,sL,sl,sZ){sK.drawCall+=sL.length/2;for(var sh=sd.width,s_=sd.height,sN=0,sm=sL.length;sN<sm;sN+=2)this.drawTexture(sd,sL[sN],sL[sN+1],sh,s_,sl,sZ)},sd.drawCanvas=function(sd,sL,sl,sZ,sh){sK.drawCall++,this.drawImage(sd.source,sL,sl,sZ,sh)},sd.fillRect=function(sd,sL,sl,sZ,sh){sK.drawCall++,sh&&(this.fillStyle=sh),this.__fillRect(sd,sL,sl,sZ)},sd.fillText=function(sd,sL,sl,sZ,sh,s_){sK.drawCall++,3<arguments.length&&null!=sZ&&(this.font=sZ,this.fillStyle=sh,this.textAlign=s_,this.textBaseline="top"),this.__fillText(sd,sL,sl)},sd.fillBorderText=function(sd,sL,sl,sZ,sh,s_,sN,sm){sK.drawCall++,this.font=sZ,this.fillStyle=sh,this.textBaseline="top",this.strokeStyle=s_,this.lineWidth=sN,this.textAlign=sm,this.__strokeText(sd,sL,sl),this.__fillText(sd,sL,sl)},sd.strokeText=function(sd,sL,sl,sZ,sh,s_,sN){sK.drawCall++,3<arguments.length&&null!=sZ&&(this.font=sZ,this.strokeStyle=sh,this.lineWidth=s_,this.textAlign=sN,this.textBaseline="top"),this.__strokeText(sd,sL,sl)},sd.transformByMatrix=function(sd){this.transform(sd.a,sd.b,sd.c,sd.d,sd.tx,sd.ty)},sd.setTransformByMatrix=function(sd){this.setTransform(sd.a,sd.b,sd.c,sd.d,sd.tx,sd.ty)},sd.clipRect=function(sd,sL,sl,sZ){sK.drawCall++,this.beginPath(),this.rect(sd,sL,sl,sZ),this.clip()},sd.drawTexture=function(sd,sL,sl,sZ,sh,s_,sN){sK.drawCall++;var sm=sd.uv,su=sd.bitmap.width,sx=sd.bitmap.height;this.drawImage(sd.source,sm[0]*su,sm[1]*sx,(sm[2]-sm[0])*su,(sm[5]-sm[3])*sx,sL+s_,sl+sN,sZ,sh)},sd.drawTextureWithTransform=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){sK.drawCall++;var sx=sd.uv,st=sd.bitmap.width,sb=sd.bitmap.height;this.save(),1!=su&&(this.globalAlpha*=su),s_?(this.transform(s_.a,s_.b,s_.c,s_.d,s_.tx+sN,s_.ty+sm),this.drawImage(sd.source,sx[0]*st,sx[1]*sb,(sx[2]-sx[0])*st,(sx[5]-sx[3])*sb,sL,sl,sZ,sh)):this.drawImage(sd.source,sx[0]*st,sx[1]*sb,(sx[2]-sx[0])*st,(sx[5]-sx[3])*sb,sL+sN,sl+sm,sZ,sh),this.restore()},sd.drawTexture2=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=sm[0];if(su.loaded&&su.bitmap&&su.source){sK.drawCall++;var sx=1!==s_;if(sx){var st=this.globalAlpha;this.globalAlpha*=s_}var sb=su.uv,sq=su.bitmap.width,sY=su.bitmap.height;sh?(this.save(),this.transform(sh.a,sh.b,sh.c,sh.d,sh.tx+sd,sh.ty+sL),this.drawImage(su.source,sb[0]*sq,sb[1]*sY,(sb[2]-sb[0])*sq,(sb[5]-sb[3])*sY,sm[1]-sl,sm[2]-sZ,sm[3],sm[4]),this.restore()):this.drawImage(su.source,sb[0]*sq,sb[1]*sY,(sb[2]-sb[0])*sq,(sb[5]-sb[3])*sY,sm[1]-sl+sd,sm[2]-sZ+sL,sm[3],sm[4]),sx&&(this.globalAlpha=st)}},sd.fillTexture=function(sd,sL,sl,sZ,sh,s_,sN,sm){if(!sm.pat){if(sd.uv!=std.DEF_UV){var su=new swd("2D");su.getContext("2d"),su.size(sd.width,sd.height),su.context.drawTexture(sd,0,0,sd.width,sd.height,0,0),sd=new std(su)}sm.pat=this.createPattern(sd.bitmap.source,s_)}var sx=sL,st=sl,sb=0,sq=0;sN&&(sx+=sN.x%sd.width,st+=sN.y%sd.height,sb-=sN.x%sd.width,sq-=sN.y%sd.height),this.translate(sx,st),this.fillRect(sb,sq,sZ,sh,sm.pat),this.translate(-sx,-st)},sd.drawTriangle=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=sd.bitmap,sx=su.source,st=sd.width,sb=sd.height,sq=su.width,sY=su.height,sc=sl[sZ]*sq,sr=sl[sh]*sq,sa=sl[s_]*sq,sk=sl[sZ+1]*sY,se=sl[sh+1]*sY,sw=sl[s_+1]*sY,ss=sL[sZ],sA=sL[sh],sy=sL[s_],s$=sL[sZ+1],sO=sL[sh+1],sn=sL[s_+1];if(sm){var sV=(ss+sA+sy)/3,sQ=(s$+sO+sn)/3,sg=ss-sV,sF=s$-sQ,sE=Math.sqrt(sg*sg+sF*sF);ss=sV+sg/sE*(sE+1),s$=sQ+sF/sE*(sE+1),sF=sO-sQ,sA=sV+(sg=sA-sV)/(sE=Math.sqrt(sg*sg+sF*sF))*(sE+1),sO=sQ+sF/sE*(sE+1),sF=sn-sQ,sy=sV+(sg=sy-sV)/(sE=Math.sqrt(sg*sg+sF*sF))*(sE+1),sn=sQ+sF/sE*(sE+1)}this.save(),sN&&this.transform(sN.a,sN.b,sN.c,sN.d,sN.tx,sN.ty),this.beginPath(),this.moveTo(ss,s$),this.lineTo(sA,sO),this.lineTo(sy,sn),this.closePath(),this.clip();var sI=1/(sc*se+sk*sa+sr*sw-se*sa-sk*sr-sc*sw),sp=ss*se+sk*sy+sA*sw-se*sy-sk*sA-ss*sw,sH=sc*sA+ss*sa+sr*sy-sA*sa-ss*sr-sc*sy,sX=sc*se*sy+sk*sA*sa+ss*sr*sw-ss*se*sa-sk*sr*sy-sc*sA*sw,sj=s$*se+sk*sn+sO*sw-se*sn-sk*sO-s$*sw,sR=sc*sO+s$*sa+sr*sn-sO*sa-s$*sr-sc*sn,so=sc*se*sn+sk*sO*sa+s$*sr*sw-s$*se*sa-sk*sr*sn-sc*sO*sw;this.transform(sp*sI,sj*sI,sH*sI,sR*sI,sX*sI,so*sI),this.drawImage(sx,sd.uv[0]*sq,sd.uv[1]*sY,st,sb,sd.uv[0]*sq,sd.uv[1]*sY,st,sb),this.restore()},sd.flush=function(){return 0},sd.fillWords=function(sd,sL,sl,sZ,sh,s_){sZ&&(this.font=sZ),sh&&(this.fillStyle=sh);this.textBaseline="top",this.textAlign="left";for(var sN=0,sm=sd.length;sN<sm;sN++){var su=sd[sN];if(this.__fillText(su.char,su.x+sL,su.y+sl),1===s_){var sx=su.height,st=.5*su.style.letterSpacing;st||(st=0),this.beginPath(),this.strokeStyle=sh,this.lineWidth=1,this.moveTo(sL+su.x-st+.5,sl+su.y+sx+.5),this.lineTo(sL+su.x+su.width+st+.5,sl+su.y+sx+.5),this.stroke()}}},sd.fillBorderWords=function(sd,sL,sl,sZ,sh,s_,sN){sZ&&(this.font=sZ),sh&&(this.fillStyle=sh),this.textBaseline="top",this.lineWidth=sN,this.textAlign="left",this.strokeStyle=s_;for(var sm=0,su=sd.length;sm<su;sm++){var sx=sd[sm];this.__strokeText(sx.char,sx.x+sL,sx.y+sl),this.__fillText(sx.char,sx.x+sL,sx.y+sl)}},sd.destroy=function(){this.canvas.width=this.canvas.height=0},sd.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},sd.drawCurves=function(sd,sL,sl){this.beginPath(),this.strokeStyle=sl[3],this.lineWidth=sl[4];var sZ=sl[2];sd+=sl[0],sL+=sl[1],this.moveTo(sd+sZ[0],sL+sZ[1]);for(var sh=2,s_=sZ.length;sh<s_;)this.quadraticCurveTo(sd+sZ[sh++],sL+sZ[sh++],sd+sZ[sh++],sL+sZ[sh++]);this.stroke()},sm.__init__=function(sL){var sl=laya.resource.Context.prototype;if(!(sL=sL||CanvasRenderingContext2D.prototype).inited){sL.inited=!0,sL.__fillText=sL.fillText,sL.__fillRect=sL.fillRect,sL.__strokeText=sL.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(sd){sL[sd]=sl[sd]})}},sm.replaceCanvasGetSet=function(sd,sL){var sl=Object.getOwnPropertyDescriptor(sd,sL);if(!sl||!sl.configurable)return!1;var sZ,sh={};for(sZ in sl)"set"!=sZ&&(sh[sZ]=sl[sZ]);var s_=sl.set;return sh.set=function(sd){s_.call(this,sd);var sL=this.getContext("2d");sL&&"__reset"in sL&&sL.__reset()},Object.defineProperty(sd,sL,sh),!0},sm.replaceGetSet=function(sd,sL){var sl=Object.getOwnPropertyDescriptor(sd,sL);if(!sl||!sl.configurable)return!1;var sZ,sh={};for(sZ in sl)"set"!=sZ&&(sh[sZ]=sl[sZ]);var s_=sl.set,sN="___"+sL+"__";return sm.newKeys.push(sN),sh.set=function(sd){sd!=this[sN]&&(this[sN]=sd,s_.call(this,sd))},Object.defineProperty(sd,sL,sh),!0},sm._default=new sm,sm.newKeys=[],su(sm,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),sm}(),so=function(){function s_(sd){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++s_._uniqueIDCounter,this._name=sd||"Content Manager",s_._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,s_._resourceManagers.push(this),this._resources=[],this._records={}}sr(s_,"laya.resource.ResourceManager");var sd=s_.prototype;return s$.imps(sd,{"laya.resource.IDispose":!0}),sd.getResourceByIndex=function(sd){return this._resources[sd]},sd.getResourcesLength=function(){return this._resources.length},sd.addResource=function(sd){return sd.resourceManager&&sd.resourceManager.removeResource(sd),-1===this._resources.indexOf(sd)&&((sd._resourceManager=this)._resources.push(sd),this.addRecord(sd.uri,sd.__className,sd.memorySize),this.addSize(sd.memorySize),!0)},sd.removeResource=function(sd){var sL=this._resources.indexOf(sd);return-1!==sL&&(this._resources.splice(sL,1),sd._resourceManager=null,this._memorySize-=sd.memorySize,this.addRecord(sd.uri,sd.__className,-sd.memorySize),!0)},sd.unload=function(){for(var sd=this._resources.slice(0,this._resources.length),sL=0;sL<sd.length;sL++){sd[sL].destroy()}sd.length=0},sd.dispose=function(){if(this===s_._systemResourceManager)throw new Error("systemResourceManager不能被释放！");s_._resourceManagers.splice(s_._resourceManagers.indexOf(this),1),s_._isResourceManagersSorted=!1;for(var sd=this._resources.slice(0,this._resources.length),sL=0;sL<sd.length;sL++){var sl=sd[sL];sl.resourceManager.removeResource(sl),sl.destroy()}sd.length=0},sd.addSize=function(sd){sd&&(this.autoRelease&&0<sd&&this._memorySize+sd>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=sd)},sd.addRecord=function(sd,sL,sl){DEBUG&&sl&&!sd&&console.error(sd,sL,sl),sd&&(this._records.hasOwnProperty(sL+"|"+sd)||(this._records[sL+"|"+sd]=0),this._records[sL+"|"+sd]+=sl,DEBUG&&this._records[sL+"|"+sd]<0&&console.error(sd,sL,this._records[sL+"|"+sd]))},sd.garbageCollection=function(sd){var sL=this._resources;(sL=sL.slice()).sort(function(sd,sL){if(!sd||!sL)throw new Error("a或b不能为空！");return sd.released&&sL.released?0:sd.released?1:sL.released?-1:sd._lastUseFrameCount-sL._lastUseFrameCount});for(var sl=sK.loopCount,sZ=0,sh=sL.length;sZ<sh;sZ++){var s_=sL[sZ];if(!(1<sl-s_._lastUseFrameCount))return void(this._memorySize>=sd&&(this._isOverflow=!0));if(s_.releaseResource(),this._memorySize<sd)return void(this._isOverflow=!1)}},st(0,sd,"id",function(){return this._id}),st(0,sd,"name",function(){return this._name},function(sd){!sd&&""===sd||this._name===sd||(this._name=sd,s_._isResourceManagersSorted=!1)}),st(0,sd,"memorySize",function(){return this._memorySize}),st(0,sd,"records",function(){return this._records}),st(1,s_,"systemResourceManager",function(){return s_._systemResourceManager}),s_.__init__=function(){s_.currentResourceManager=s_.systemResourceManager},s_.getLoadedResourceManagerByIndex=function(sd){return s_._resourceManagers[sd]},s_.getLoadedResourceManagersCount=function(){return s_._resourceManagers.length},s_.recreateContentManagers=function(sd){void 0===sd&&(sd=!1);for(var sL=s_.currentResourceManager,sl=0;sl<s_._resourceManagers.length;sl++){s_.currentResourceManager=s_._resourceManagers[sl];for(var sZ=0;sZ<s_.currentResourceManager._resources.length;sZ++)s_.currentResourceManager._resources[sZ].releaseResource(sd),s_.currentResourceManager._resources[sZ].activeResource(sd)}s_.currentResourceManager=sL},s_.releaseContentManagers=function(sd){void 0===sd&&(sd=!1);for(var sL=s_.currentResourceManager,sl=0;sl<s_._resourceManagers.length;sl++){s_.currentResourceManager=s_._resourceManagers[sl];for(var sZ=0;sZ<s_.currentResourceManager._resources.length;sZ++){var sh=s_.currentResourceManager._resources[sZ];!sh.released&&sh.releaseResource(sd)}}s_.currentResourceManager=sL},s_._uniqueIDCounter=0,s_._isResourceManagersSorted=!1,s_._resourceManagers=[],su(s_,["_systemResourceManager",function(){return this._systemResourceManager=new s_("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=s_._systemResourceManager}]),s_}(),si=(function(){function sd(){}sr(sd,"laya.system.System"),sd.changeDefinition=function(sd,sL){s$[sd]=sL;var sl=sd+"=classObj";s$._runScript(sl)},sd.__init__=function(){sH.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function sl(){}return sr(sl,"laya.utils.Browser"),st(1,sl,"pixelRatio",function(){return sl.__init__(),-1<sl.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:sF.getPixelRatio()}),st(1,sl,"height",function(){return sl.__init__(),(s$.stage&&s$.stage.canvasRotation?sl.clientWidth:sl.clientHeight)*sl.pixelRatio}),st(1,sl,"clientWidth",function(){return sl.__init__(),sl.window.innerWidth||sl.document.body.clientWidth}),st(1,sl,"window",function(){return sl.__init__(),sl._window}),st(1,sl,"clientHeight",function(){return sl.__init__(),sl.window.innerHeight||sl.document.body.clientHeight||sl.document.documentElement.clientHeight}),st(1,sl,"width",function(){return sl.__init__(),(s$.stage&&s$.stage.canvasRotation?sl.clientHeight:sl.clientWidth)*sl.pixelRatio}),st(1,sl,"container",function(){return sl.__init__(),sl._container||((sl._container=sl.createElement("div")).id="layaContainer",sl.document.body.appendChild(sl._container)),sl._container},function(sd){sl._container=sd}),st(1,sl,"document",function(){return sl.__init__(),sl._document}),sl.__init__=function(){if(!sl._window){sl._window=sF.getWindow(),sl._document=sl.window.document,sl._window.addEventListener("message",function(sd){laya.utils.Browser._onMessage(sd)},!1),sl.document.__createElement=sl.document.createElement,sN.requestAnimationFrame=sN.requestAnimationFrame||sN.webkitRequestAnimationFrame||sN.mozRequestAnimationFrame||sN.oRequestAnimationFrame||sN.msRequestAnimationFrame||function(sd){return sN.setTimeout(sd,1e3/60)};var sd=sN.document.body.style;sd["-webkit-user-select"]="none",sd["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",sl.userAgent=sl.window.navigator.userAgent,sl.onIOS=!!(sl.u=sl.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),sl.onMobile=-1<sl.u.indexOf("Mobile"),sl.onIPhone=-1<sl.u.indexOf("iPhone"),sl.onMac=-1<sl.u.indexOf("Mac OS X"),sl.onIPad=-1<sl.u.indexOf("iPad"),sl.onAndroid=-1<sl.u.indexOf("Android")||-1<sl.u.indexOf("Adr"),sl.onWP=-1<sl.u.indexOf("Windows Phone"),sl.onQQBrowser=-1<sl.u.indexOf("QQBrowser"),sl.onMQQBrowser=-1<sl.u.indexOf("MQQBrowser")||-1<sl.u.indexOf("Mobile")&&-1<sl.u.indexOf("QQ"),sl.onIE=!!sl.window.ActiveXObject||"ActiveXObject"in sl.window,sl.onWeiXin=-1<sl.u.indexOf("MicroMessenger"),sl.onPC=!sl.onMobile,sl.onSafari=-1<sl.u.indexOf("Safari"),sl.onFirefox=-1<sl.u.indexOf("Firefox"),sl.onEdge=-1<sl.u.indexOf("Edge"),sl.onMiniGame=-1<sl.u.indexOf("MiniGame"),sl.onLimixiu=-1<sl.u.indexOf("limixiu"),sl.httpProtocol="http:"==sl.window.location.protocol,sl.onMiniGame&&null==sl.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),sl.webAudioEnabled=!!(sl.window.AudioContext||sl.window.webkitAudioContext||sl.window.mozAudioContext),sl.soundType=sl.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",shd=sl.webAudioEnabled?s_d:sld,sl.webAudioEnabled&&s_d.initWebAudio(),sld._initMusicAudio(),sl.enableTouch="ontouchstart"in sN||sN.DocumentTouch&&sL instanceof DocumentTouch,sN.focus(),sg._soundClass=shd,sg._musicClass=sld,sH._mainCanvas=sH._mainCanvas||swd.create("2D"),sl.canvas||(sl.canvas=swd.create("2D"),sl.context=sl.canvas.getContext("2d"))}},sl._onMessage=function(sd){if(sd.data&&"size"==sd.data.name){if(sl.window.innerWidth=sd.data.width,sl.window.innerHeight=sd.data.height,sl.window.__innerHeight=sd.data.clientHeight,!sl.document.createEvent)return void console.warn("no document.createEvent");var sL=sl.document.createEvent("HTMLEvents");return sL.initEvent("resize",!1,!1),void sl.window.dispatchEvent(sL)}},sl.createElement=function(sd){return sl.__init__(),sl.document.__createElement(sd)},sl.getElementById=function(sd){return sl.__init__(),sl.document.getElementById(sd)},sl.removeElement=function(sd){sd&&sd.parentNode&&sd.parentNode.removeChild(sd)},sl.now=function(){return sF.now()},sl._window=null,sl._document=null,sl._container=null,sl.userAgent=null,sl.u=null,sl.onIOS=!1,sl.onMac=!1,sl.onMobile=!1,sl.onIPhone=!1,sl.onIPad=!1,sl.onAndroid=!1,sl.onWP=!1,sl.onQQBrowser=!1,sl.onMQQBrowser=!1,sl.onSafari=!1,sl.onFirefox=!1,sl.onEdge=!1,sl.onIE=!1,sl.onWeiXin=!1,sl.onMiniGame=!1,sl.onLimixiu=!1,sl.onPC=!1,sl.httpProtocol=!1,sl.webAudioEnabled=!1,sl.soundType=null,sl.enableTouch=!1,sl.canvas=null,sl.context=null,sl.__init$=function(){},sl}()),sS=function(){function sL(sd){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,sd?(this._u8d_=new Uint8Array(sd),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}sr(sL,"laya.utils.Byte");var sd=sL.prototype;return sd.___resizeBuffer=function(sL){try{var sd=new Uint8Array(sL);null!=this._u8d_&&(this._u8d_.length<=sL?sd.set(this._u8d_):sd.set(this._u8d_.subarray(0,sL))),this._u8d_=sd,this._d_=new DataView(sd.buffer)}catch(sd){throw"___resizeBuffer err:"+sL}},sd.getString=function(){return this.rUTF(this.getUint16())},sd.getFloat32Array=function(sd,sL){var sl=sd+sL;sl=sl>this._length?this._length:sl;var sZ=new Float32Array(this._d_.buffer.slice(sd,sl));return this._pos_=sl,sZ},sd.getUint8Array=function(sd,sL){var sl=sd+sL;sl=sl>this._length?this._length:sl;var sZ=new Uint8Array(this._d_.buffer.slice(sd,sl));return this._pos_=sl,sZ},sd.getInt16Array=function(sd,sL){var sl=sd+sL;sl=sl>this._length?this._length:sl;var sZ=new Int16Array(this._d_.buffer.slice(sd,sl));return this._pos_=sl,sZ},sd.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var sd=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,sd},sd.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var sd=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,sd},sd.writeFloat32=function(sd){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,sd,this._xd_),this._pos_+=4},sd.writeFloat64=function(sd){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,sd,this._xd_),this._pos_+=8},sd.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var sd=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,sd},sd.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var sd=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,sd},sd.writeInt32=function(sd){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,sd,this._xd_),this._pos_+=4},sd.writeUint32=function(sd){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,sd,this._xd_),this._pos_+=4},sd.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var sd=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,sd},sd.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var sd=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,sd},sd.writeUint16=function(sd){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,sd,this._xd_),this._pos_+=2},sd.writeInt16=function(sd){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,sd,this._xd_),this._pos_+=2},sd.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},sd.writeUint8=function(sd){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,sd),this._pos_++},sd._getUInt8=function(sd){return this._d_.getUint8(sd)},sd._getUint16=function(sd){return this._d_.getUint16(sd,this._xd_)},sd._getMatrix=function(){return new sE(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},sd.rUTF=function(sd){for(var sL=[],sl=this._pos_+sd,sZ=0,sh=0,s_=0,sN=String.fromCharCode,sm=this._u8d_;this._pos_<sl;)(sZ=sm[this._pos_++])<128?0!=sZ&&sL.push(sN(sZ)):sZ<224?sL.push(sN((63&sZ)<<6|127&sm[this._pos_++])):sZ<240?(sh=sm[this._pos_++],sL.push(sN((31&sZ)<<12|(127&sh)<<6|127&sm[this._pos_++]))):(sh=sm[this._pos_++],s_=sm[this._pos_++],sL.push(sN((15&sZ)<<18|(127&sh)<<12|s_<<6&127|127&sm[this._pos_++]))),0;return sL.join("")},sd.getCustomString=function(sd){for(var sL=[],sl=0,sZ=0,sh=0,s_=String.fromCharCode,sN=this._u8d_;0<sd;)if((sZ=sN[this._pos_])<128)sL.push(s_(sZ)),this._pos_++,sd--;else for(sl=sZ-128,this._pos_++,sd-=sl;0<sl;)sZ=sN[this._pos_++],sh=sN[this._pos_++],sL.push(s_(sh<<8|sZ)),sl--;return sL.join("")},sd.clear=function(){this._pos_=0,this.length=0},sd.__getBuffer=function(){return this._d_.buffer},sd.writeUTFBytes=function(sd){for(var sL=0,sl=(sd+="").length;sL<sl;sL++){var sZ=sd.charCodeAt(sL);sZ<=127?this.writeByte(sZ):sZ<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|sZ>>6,128|63&sZ],this._pos_),this._pos_+=2):sZ<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|sZ>>12,128|sZ>>6&63,128|63&sZ],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|sZ>>18,128|sZ>>12&63,128|sZ>>6&63,128|63&sZ],this._pos_),this._pos_+=4)}},sd.writeUTFString=function(sd){var sL=this.pos;this.writeUint16(1),this.writeUTFBytes(sd);var sl=this.pos-sL-2;if(65536<=sl)throw"writeUTFString byte len more than 65536";this._d_.setUint16(sL,sl,this._xd_)},sd.readUTFString=function(){return this.readUTFBytes(this.getUint16())},sd.getUTFString=function(){return this.readUTFString()},sd.readUTFBytes=function(sd){if(void 0===sd&&(sd=-1),0==sd)return"";var sL=this.bytesAvailable;if(sL<sd)throw"readUTFBytes error - Out of bounds";return sd=0<sd?sd:sL,this.rUTF(sd)},sd.getUTFBytes=function(sd){return void 0===sd&&(sd=-1),this.readUTFBytes(sd)},sd.writeByte=function(sd){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,sd),this._pos_+=1},sd.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},sd.getByte=function(){return this.readByte()},sd.ensureWrite=function(sd){this._length<sd&&(this._length=sd),this._allocated_<sd&&(this.length=sd)},sd.writeArrayBuffer=function(sd,sL,sl){if(void 0===sL&&(sL=0),void 0===sl&&(sl=0),sL<0||sl<0)throw"writeArrayBuffer error - Out of bounds";0==sl&&(sl=sd.byteLength-sL),this.ensureWrite(this._pos_+sl);var sZ=new Uint8Array(sd);this._u8d_.set(sZ.subarray(sL,sL+sl),this._pos_),this._pos_+=sl},st(0,sd,"buffer",function(){var sd=this._d_.buffer;return sd.byteLength==this.length?sd:sd.slice(0,this.length)}),st(0,sd,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(sd){this._xd_="littleEndian"==sd}),st(0,sd,"length",function(){return this._length},function(sd){this._allocated_<sd?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(sd,2*this._allocated_))):this._allocated_>sd&&this.___resizeBuffer(this._allocated_=sd),this._length=sd}),st(0,sd,"pos",function(){return this._pos_},function(sd){this._pos_=sd}),st(0,sd,"bytesAvailable",function(){return this._length-this._pos_}),sL.getSystemEndian=function(){if(!sL._sysEndian){var sd=new ArrayBuffer(2);new DataView(sd).setInt16(0,256,!0),sL._sysEndian=256===new Int16Array(sd)[0]?"littleEndian":"bigEndian"}return sL._sysEndian},sL.BIG_ENDIAN="bigEndian",sL.LITTLE_ENDIAN="littleEndian",sL._sysEndian=null,sL}(),sB=function(){function sh(){}return sr(sh,"laya.utils.CacheManager"),sh.regCacheByFunction=function(sd,sL){var sl;sh.unRegCacheByFunction(sd,sL),sl={tryDispose:sd,getCacheList:sL},sh._cacheList.push(sl)},sh.unRegCacheByFunction=function(sd,sL){var sl,sZ=0;for(sl=sh._cacheList.length,sZ=0;sZ<sl;sZ++)if(sh._cacheList[sZ].tryDispose==sd&&sh._cacheList[sZ].getCacheList==sL)return void sh._cacheList.splice(sZ,1)},sh.forceDispose=function(){var sd=0,sL=sh._cacheList.length;for(sd=0;sd<sL;sd++)sh._cacheList[sd].tryDispose(!0)},sh.beginCheck=function(sd){void 0===sd&&(sd=15e3),s$.timer.loop(sd,null,sh._checkLoop)},sh.stopCheck=function(){s$.timer.clear(null,sh._checkLoop)},sh._checkLoop=function(){var sd=sh._cacheList;if(!(sd.length<1)){var sL,sl=si.now(),sZ=0;for(sL=sZ=sd.length;0<sZ&&(sd[sh._index=++sh._index%sL].tryDispose(!1),!(si.now()-sl>sh.loopTimeLimit));)sZ--}},sh.loopTimeLimit=2,sh._cacheList=[],sh._index=0,sh}(),sC=function(){function sY(){}return sr(sY,"laya.utils.ClassUtils"),sY.regClass=function(sd,sL){sY._classMap[sd]=sL},sY.getRegClass=function(sd){return sY._classMap[sd]},sY.getInstance=function(sd){var sL=sY.getClass(sd);return sL?new sL:(console.warn("[error] Undefined class:",sd),null)},sY.createByJson=function(sd,sL,sl,sZ,sh){"string"==typeof sd&&(sd=JSON.parse(sd));var s_=sd.props;if(!sL&&!(sL=sh?sh.runWith(sd):sY.getInstance(s_.runtime||sd.type)))return null;var sN=sd.child;if(sN)for(var sm=0,su=sN.length;sm<su;sm++){var sx=sN[sm];if("render"!==sx.props.name&&"render"!==sx.props.renderType||!sL._$set_itemRender)if("Graphic"==sx.type)sY.addGraphicsToSprite(sx,sL);else if(sY.isDrawType(sx.type))sY.addGraphicToSprite(sx,sL,!0);else{var st=sY.createByJson(sx,null,sl,sZ,sh);"Script"==sx.type?st.hasOwnProperty("owner")?st.owner=sL:st.hasOwnProperty("target")&&(st.target=sL):"mask"==sx.props.renderType?sL.mask=st:sL.addChild(st)}else sL.itemRender=sx}if(s_)for(var sb in s_){var sq=s_[sb];"var"===sb&&sl?sl[sq]=sL:sq instanceof Array&&"function"==typeof sL[sb]?sL[sb].apply(sL,sq):sL[sb]=sq}return sZ&&sd.customProps&&sZ.runWith([sL,sd]),sL.created&&sL.created(),sL},sY.addGraphicsToSprite=function(sd,sL){var sl;if((sl=sd.child)&&!(sl.length<1)){var sZ;sZ=sY._getGraphicsFromSprite(sd,sL);var sh=0,s_=0;sd.props&&(sh=sY._getObjVar(sd.props,"x",0),s_=sY._getObjVar(sd.props,"y",0)),0!=sh&&0!=s_&&sZ.translate(sh,s_);var sN,sm=0;for(sN=sl.length,sm=0;sm<sN;sm++)sY._addGraphicToGraphics(sl[sm],sZ);0!=sh&&0!=s_&&sZ.translate(-sh,-s_)}},sY.addGraphicToSprite=function(sd,sL,sl){var sZ;void 0===sl&&(sl=!1),sZ=sl?sY._getGraphicsFromSprite(sd,sL):sL.graphics,sY._addGraphicToGraphics(sd,sZ)},sY._getGraphicsFromSprite=function(sd,sL){var sl,sZ;if(!sd||!sd.props)return sL.graphics;switch(sZ=sd.props.renderType){case"hit":case"unHit":var sh;sL.hitArea||(sL.hitArea=new sD),(sh=sL.hitArea)[sZ]||(sh[sZ]=new sq),sl=sh[sZ]}return sl||(sl=sL.graphics),sl},sY._getTransformData=function(sd){var sL;(sd.hasOwnProperty("pivotX")||sd.hasOwnProperty("pivotY"))&&(sL=sL||new sE).translate(-sY._getObjVar(sd,"pivotX",0),-sY._getObjVar(sd,"pivotY",0));var sl=sY._getObjVar(sd,"scaleX",1),sZ=sY._getObjVar(sd,"scaleY",1),sh=sY._getObjVar(sd,"rotation",0);sY._getObjVar(sd,"skewX",0),sY._getObjVar(sd,"skewY",0);return 1==sl&&1==sZ&&0==sh||((sL=sL||new sE).scale(sl,sZ),sL.rotate(.0174532922222222*sh)),sL},sY._addGraphicToGraphics=function(sd,sL){var sl,sZ;if((sl=sd.props)&&(sZ=sY.DrawTypeDic[sd.type])){var sh,s_;sh=sL;var sN=sY._getParams(sl,sZ[1],sZ[2],sZ[3]);((s_=sY._tM)||1!=sY._alpha)&&(sh.save(),s_&&sh.transform(s_),1!=sY._alpha&&sh.alpha(sY._alpha)),sh[sZ[0]].apply(sh,sN),(s_||1!=sY._alpha)&&sh.restore()}},sY._adptLineData=function(sd){return sd[2]=parseFloat(sd[0])+parseFloat(sd[2]),sd[3]=parseFloat(sd[1])+parseFloat(sd[3]),sd},sY._adptTextureData=function(sd){return sd[0]=smd.getRes(sd[0]),sd},sY._adptLinesData=function(sd){return sd[2]=sY._getPointListByStr(sd[2]),sd},sY.isDrawType=function(sd){return"Image"!=sd&&sY.DrawTypeDic.hasOwnProperty(sd)},sY._getParams=function(sd,sL,sl,sZ){var sh;void 0===sl&&(sl=0),(sh=sY._temParam).length=sL.length;var s_,sN,sm=0;for(s_=sL.length,sm=0;sm<s_;sm++)sh[sm]=sY._getObjVar(sd,sL[sm][0],sL[sm][1]);return sY._alpha=sY._getObjVar(sd,"alpha",1),sN=sY._getTransformData(sd),sY._tM=sN?(sl||(sl=0),sN.translate(sh[sl],sh[sl+1]),sh[sl]=sh[sl+1]=0,sN):null,sZ&&sY[sZ]&&(sh=sY[sZ](sh)),sh},sY._getPointListByStr=function(sd){var sL,sl,sZ=0;for(sl=(sL=sd.split(",")).length,sZ=0;sZ<sl;sZ++)sL[sZ]=parseFloat(sL[sZ]);return sL},sY._getObjVar=function(sd,sL,sl){return sd.hasOwnProperty(sL)?sd[sL]:sl},sY._temParam=[],sY._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},sY.getClass=function(sd){var sL=sY._classMap[sd]||sd;return"string"==typeof sL?s$.__classmap[sL]:sL},sY._tM=null,sY._alpha=NaN,su(sY,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),sY}(),sP=function(){function s_(sd){if(this._color=[],"string"==typeof sd){null===(this.strColor=sd)&&(sd="#000000"),"#"==sd.charAt(0)&&(sd=sd.substr(1));var sL=sd.length;if(3==sL||4==sL){for(var sl="",sZ=0;sZ<sL;sZ++)sl+=sd[sZ]+sd[sZ];sd=sl}var sh=this.numColor=parseInt(sd,16);if(8==sd.length)return void(this._color=[parseInt(sd.substr(0,2),16)/255,((16711680&sh)>>16)/255,((65280&sh)>>8)/255,(255&sh)/255])}else sh=this.numColor=sd,this.strColor=sf.toHexColor(sh);this._color=[((16711680&sh)>>16)/255,((65280&sh)>>8)/255,(255&sh)/255,1],this._color.__id=++s_._COLODID}return sr(s_,"laya.utils.Color"),s_._initDefault=function(){for(var sd in s_._DEFAULT={},s_._COLOR_MAP)s_._SAVE[sd]=s_._DEFAULT[sd]=new s_(s_._COLOR_MAP[sd]);return s_._DEFAULT},s_._initSaveMap=function(){for(var sd in s_._SAVE_SIZE=0,s_._SAVE={},s_._DEFAULT)s_._SAVE[sd]=s_._DEFAULT[sd]},s_.create=function(sd){var sL=s_._SAVE[sd+""];return null!=sL?sL:(s_._SAVE_SIZE<1e3||s_._initSaveMap(),s_._SAVE[sd+""]=new s_(sd))},s_._SAVE={},s_._SAVE_SIZE=0,s_._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},s_._DEFAULT=s_._initDefault(),s_._COLODID=1,s_}(),sT=(function(){function sd(){this._values=[],this._keys=[]}sr(sd,"laya.utils.Dictionary");var sL=sd.prototype;sL.set=function(sd,sL){var sl=this.indexOf(sd);0<=sl?this._values[sl]=sL:(this._keys.push(sd),this._values.push(sL))},sL.indexOf=function(sd){var sL=this._keys.indexOf(sd);return 0<=sL?sL:(sd="string"==typeof sd?Number(sd):"number"==typeof sd?sd.toString():sd,this._keys.indexOf(sd))},sL.get=function(sd){var sL=this.indexOf(sd);return sL<0?null:this._values[sL]},sL.remove=function(sd){var sL=this.indexOf(sd);return 0<=sL&&(this._keys.splice(sL,1),this._values.splice(sL,1),!0)},sL.clear=function(){this._values.length=0,this._keys.length=0},st(0,sL,"values",function(){return this._values}),st(0,sL,"keys",function(){return this._keys})}(),function(){function sd(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}sr(sd,"laya.utils.Dragging");var sL=sd.prototype;return sL.start=function(sd,sL,sl,sZ,sh,s_,sN,sm){void 0===sm&&(sm=.92),this.clearTimer(),this.target=sd,this.area=sL,this.hasInertia=sl,this.elasticDistance=sL?sZ:0,this.elasticBackTime=sh,this.data=s_,this._disableMouseEvent=sN,this.ratio=sm,1!=sd.globalScaleX||1!=sd.globalScaleY?this._parent=sd.parent:this._parent=s$.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,s$.stage.on("mouseup",this,this.onStageMouseUp),s$.stage.on("mouseout",this,this.onStageMouseUp),s$.timer.frameLoop(1,this,this.loop)},sL.clearTimer=function(){s$.timer.clear(this,this.loop),s$.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},sL.stop=function(){this._dragging&&(sc.instance.disableMouseEvent=!1,s$.stage.off("mouseup",this,this.onStageMouseUp),s$.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},sL.loop=function(){var sd=this._parent.getMousePoint(),sL=sd.x,sl=sd.y,sZ=sL-this._lastX,sh=sl-this._lastY;if(this._clickOnly){if(!(1<Math.abs(sZ*s$.stage._canvasTransform.getScaleX())||1<Math.abs(sh*s$.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),sc.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(sZ,sh);0==sZ&&0==sh||(this._lastX=sL,this._lastY=sl,this.target.x+=sZ*this._elasticRateX,this.target.y+=sh*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},sL.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var sd=this.area.x-this.target.x;else sd=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-sd/this.elasticDistance),this.target.y<this.area.y)var sL=this.area.y-this.target.y;else sL=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-sL/this.elasticDistance)}},sL.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},sL.onStageMouseUp=function(sd){if(sc.instance.disableMouseEvent=!1,s$.stage.off("mouseup",this,this.onStageMouseUp),s$.stage.off("mouseout",this,this.onStageMouseUp),s$.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var sL=this._offsets.length,sl=Math.min(sL,6),sZ=this._offsets.length-sl,sh=sL-1;sZ<sh;sh--)this._offsetY+=this._offsets[sh--],this._offsetX+=this._offsets[sh];this._offsetX=this._offsetX/sl*2,this._offsetY=this._offsetY/sl*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),s$.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},sL.checkElastic=function(){var sd=NaN,sL=NaN;if(this.target.x<this.area.x?sd=this.area.x:this.target.x>this.area.x+this.area.width&&(sd=this.area.x+this.area.width),this.target.y<this.area.y?sL=this.area.y:this.target.y>this.area.y+this.area.height&&(sL=this.area.y+this.area.height),isNaN(sd)&&isNaN(sL))this.clear();else{var sl={};isNaN(sd)||(sl.x=sd),isNaN(sL)||(sl.y=sL),this._tween=sJ.to(this.target,sl,this.elasticBackTime,sz.sineOut,se.create(this,this.clear),0,!1,!1)}},sL.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(s$.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},sL.clear=function(){if(this.target){this.clearTimer();var sd=this.target;this.target=null,this._parent=null,sd.event("dragend",this.data)}},sd}()),sz=function(){function sm(){}return sr(sm,"laya.utils.Ease"),sm.linearNone=function(sd,sL,sl,sZ){return sl*sd/sZ+sL},sm.linearIn=function(sd,sL,sl,sZ){return sl*sd/sZ+sL},sm.linearInOut=function(sd,sL,sl,sZ){return sl*sd/sZ+sL},sm.linearOut=function(sd,sL,sl,sZ){return sl*sd/sZ+sL},sm.bounceIn=function(sd,sL,sl,sZ){return sl-sm.bounceOut(sZ-sd,0,sl,sZ)+sL},sm.bounceInOut=function(sd,sL,sl,sZ){return sd<.5*sZ?.5*sm.bounceIn(2*sd,0,sl,sZ)+sL:.5*sm.bounceOut(2*sd-sZ,0,sl,sZ)+.5*sl+sL},sm.bounceOut=function(sd,sL,sl,sZ){return(sd/=sZ)<1/2.75?sl*(7.5625*sd*sd)+sL:sd<2/2.75?sl*(7.5625*(sd-=1.5/2.75)*sd+.75)+sL:sd<2.5/2.75?sl*(7.5625*(sd-=2.25/2.75)*sd+.9375)+sL:sl*(7.5625*(sd-=2.625/2.75)*sd+.984375)+sL},sm.backIn=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=1.70158),sl*(sd/=sZ)*sd*((sh+1)*sd-sh)+sL},sm.backInOut=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=1.70158),(sd/=.5*sZ)<1?.5*sl*(sd*sd*((1+(sh*=1.525))*sd-sh))+sL:sl/2*((sd-=2)*sd*((1+(sh*=1.525))*sd+sh)+2)+sL},sm.backOut=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=1.70158),sl*((sd=sd/sZ-1)*sd*((sh+1)*sd+sh)+1)+sL},sm.elasticIn=function(sd,sL,sl,sZ,sh,s_){var sN;return void 0===sh&&(sh=0),void 0===s_&&(s_=0),0==sd?sL:1==(sd/=sZ)?sL+sl:(s_||(s_=.3*sZ),sN=!sh||0<sl&&sh<sl||sl<0&&sh<-sl?(sh=sl,s_/4):s_/sm.PI2*Math.asin(sl/sh),-sh*Math.pow(2,10*(sd-=1))*Math.sin((sd*sZ-sN)*sm.PI2/s_)+sL)},sm.elasticInOut=function(sd,sL,sl,sZ,sh,s_){var sN;return void 0===sh&&(sh=0),void 0===s_&&(s_=0),0==sd?sL:2==(sd/=.5*sZ)?sL+sl:(s_||(s_=sZ*(.3*1.5)),sN=!sh||0<sl&&sh<sl||sl<0&&sh<-sl?(sh=sl,s_/4):s_/sm.PI2*Math.asin(sl/sh),sd<1?sh*Math.pow(2,10*(sd-=1))*Math.sin((sd*sZ-sN)*sm.PI2/s_)*-.5+sL:sh*Math.pow(2,-10*(sd-=1))*Math.sin((sd*sZ-sN)*sm.PI2/s_)*.5+sl+sL)},sm.elasticOut=function(sd,sL,sl,sZ,sh,s_){var sN;return void 0===sh&&(sh=0),void 0===s_&&(s_=0),0==sd?sL:1==(sd/=sZ)?sL+sl:(s_||(s_=.3*sZ),sN=!sh||0<sl&&sh<sl||sl<0&&sh<-sl?(sh=sl,s_/4):s_/sm.PI2*Math.asin(sl/sh),sh*Math.pow(2,-10*sd)*Math.sin((sd*sZ-sN)*sm.PI2/s_)+sl+sL)},sm.strongIn=function(sd,sL,sl,sZ){return sl*(sd/=sZ)*sd*sd*sd*sd+sL},sm.strongInOut=function(sd,sL,sl,sZ){return(sd/=.5*sZ)<1?.5*sl*sd*sd*sd*sd*sd+sL:.5*sl*((sd-=2)*sd*sd*sd*sd+2)+sL},sm.strongOut=function(sd,sL,sl,sZ){return sl*((sd=sd/sZ-1)*sd*sd*sd*sd+1)+sL},sm.sineInOut=function(sd,sL,sl,sZ){return.5*-sl*(Math.cos(Math.PI*sd/sZ)-1)+sL},sm.sineIn=function(sd,sL,sl,sZ){return-sl*Math.cos(sd/sZ*sm.HALF_PI)+sl+sL},sm.sineOut=function(sd,sL,sl,sZ){return sl*Math.sin(sd/sZ*sm.HALF_PI)+sL},sm.quintIn=function(sd,sL,sl,sZ){return sl*(sd/=sZ)*sd*sd*sd*sd+sL},sm.quintInOut=function(sd,sL,sl,sZ){return(sd/=.5*sZ)<1?.5*sl*sd*sd*sd*sd*sd+sL:.5*sl*((sd-=2)*sd*sd*sd*sd+2)+sL},sm.quintOut=function(sd,sL,sl,sZ){return sl*((sd=sd/sZ-1)*sd*sd*sd*sd+1)+sL},sm.quartIn=function(sd,sL,sl,sZ){return sl*(sd/=sZ)*sd*sd*sd+sL},sm.quartInOut=function(sd,sL,sl,sZ){return(sd/=.5*sZ)<1?.5*sl*sd*sd*sd*sd+sL:.5*-sl*((sd-=2)*sd*sd*sd-2)+sL},sm.quartOut=function(sd,sL,sl,sZ){return-sl*((sd=sd/sZ-1)*sd*sd*sd-1)+sL},sm.cubicIn=function(sd,sL,sl,sZ){return sl*(sd/=sZ)*sd*sd+sL},sm.cubicInOut=function(sd,sL,sl,sZ){return(sd/=.5*sZ)<1?.5*sl*sd*sd*sd+sL:.5*sl*((sd-=2)*sd*sd+2)+sL},sm.cubicOut=function(sd,sL,sl,sZ){return sl*((sd=sd/sZ-1)*sd*sd+1)+sL},sm.quadIn=function(sd,sL,sl,sZ){return sl*(sd/=sZ)*sd+sL},sm.quadInOut=function(sd,sL,sl,sZ){return(sd/=.5*sZ)<1?.5*sl*sd*sd+sL:.5*-sl*(--sd*(sd-2)-1)+sL},sm.quadOut=function(sd,sL,sl,sZ){return-sl*(sd/=sZ)*(sd-2)+sL},sm.expoIn=function(sd,sL,sl,sZ){return 0==sd?sL:sl*Math.pow(2,10*(sd/sZ-1))+sL-.001*sl},sm.expoInOut=function(sd,sL,sl,sZ){return 0==sd?sL:sd==sZ?sL+sl:(sd/=.5*sZ)<1?.5*sl*Math.pow(2,10*(sd-1))+sL:.5*sl*(2-Math.pow(2,-10*--sd))+sL},sm.expoOut=function(sd,sL,sl,sZ){return sd==sZ?sL+sl:sl*(1-Math.pow(2,-10*sd/sZ))+sL},sm.circIn=function(sd,sL,sl,sZ){return-sl*(Math.sqrt(1-(sd/=sZ)*sd)-1)+sL},sm.circInOut=function(sd,sL,sl,sZ){return(sd/=.5*sZ)<1?.5*-sl*(Math.sqrt(1-sd*sd)-1)+sL:.5*sl*(Math.sqrt(1-(sd-=2)*sd)+1)+sL},sm.circOut=function(sd,sL,sl,sZ){return sl*Math.sqrt(1-(sd=sd/sZ-1)*sd)+sL},sm.HALF_PI=.5*Math.PI,sm.PI2=2*Math.PI,sm}(),sD=function(){function sb(){this._hit=null,this._unHit=null}sr(sb,"laya.utils.HitArea");var sd=sb.prototype;return sd.isHit=function(sd,sL){return!!sb.isHitGraphic(sd,sL,this.hit)&&!sb.isHitGraphic(sd,sL,this.unHit)},sd.contains=function(sd,sL){return this.isHit(sd,sL)},st(0,sd,"hit",function(){return this._hit||(this._hit=new sq),this._hit},function(sd){this._hit=sd}),st(0,sd,"unHit",function(){return this._unHit||(this._unHit=new sq),this._unHit},function(sd){this._unHit=sd}),sb.isHitGraphic=function(sd,sL,sl){if(!sl)return!1;var sZ;if(!(sZ=sl.cmds)&&sl._one&&((sZ=sb._cmds).length=1,sZ[0]=sl._one),!sZ)return!1;var sh,s_,sN=0;for(sh=sZ.length,sN=0;sN<sh;sN++)if(s_=sZ[sN]){var sm=sH._context;switch(s_.callee){case sm._translate:case 6:sd-=s_[0],sL-=s_[1]}if(sb.isHitCmd(sd,sL,s_))return!0}return!1},sb.isHitCmd=function(sd,sL,sl){if(!sl)return!1;var sZ=sH._context,sh=!1;switch(sl.callee){case sZ._drawRect:case 13:sb._rec.setTo(sl[0],sl[1],sl[2],sl[3]),sh=sb._rec.contains(sd,sL);break;case sZ._drawCircle:case sZ._fillCircle:case 14:sh=(sd-=sl[0])*sd+(sL-=sl[1])*sL<sl[2]*sl[2];break;case sZ._drawPoly:case 18:sd-=sl[0],sL-=sl[1],sh=sb.ptInPolygon(sd,sL,sl[2])}return sh},sb.ptInPolygon=function(sd,sL,sl){var sZ;(sZ=sb._ptPoint).setTo(sd,sL);var sh,s_=0,sN=NaN,sm=NaN,su=NaN,sx=NaN;sh=sl.length;for(var st=0;st<sh;st+=2){if(sN=sl[st],sm=sl[st+1],su=sl[(st+2)%sh],sm!=(sx=sl[(st+3)%sh]))if(!(sZ.y<Math.min(sm,sx)))if(!(sZ.y>=Math.max(sm,sx)))(sZ.y-sm)*(su-sN)/(sx-sm)+sN>sZ.x&&s_++}return s_%2==1},sb._cmds=[],su(sb,["_rec",function(){return this._rec=new sn},"_ptPoint",function(){return this._ptPoint=new sO}]),sb}(),sG=(function(){function sh(sd,sL,sl,sZ){this.char=sd,this.charNum=sd.charCodeAt(0),this._x=this._y=0,this.width=sL,this.height=sl,this.style=sZ,this.isWord=!sh._isWordRegExp.test(sd)}sr(sh,"laya.utils.HTMLChar");var sd=sh.prototype;s$.imps(sd,{"laya.display.ILayout":!0}),sd.setSprite=function(sd){this._sprite=sd},sd.getSprite=function(){return this._sprite},sd._isChar=function(){return!0},sd._getCSSStyle=function(){return this.style},st(0,sd,"width",function(){return this._w},function(sd){this._w=sd}),st(0,sd,"x",function(){return this._x},function(sd){this._sprite&&(this._sprite.x=sd),this._x=sd}),st(0,sd,"y",function(){return this._y},function(sd){this._sprite&&(this._sprite.y=sd),this._y=sd}),st(0,sd,"height",function(){return this._h},function(sd){this._h=sd}),sh._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function sL(){}sr(sL,"laya.utils.Log"),sL.enable=function(){sL._logdiv||(sL._logdiv=si.window.document.createElement("div"),si.window.document.body.appendChild(sL._logdiv),sL._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},sL.toggle=function(){var sd=sL._logdiv.style;"1px"==sd.width?sd.width=sd.height="50%":sd.width=sd.height="1px"},sL.print=function(sd){sL._logdiv&&(sL.maxCount<=sL._count&&sL.clear(),sL._count++,sL._logdiv.innerText+=sd+"\n",sL._logdiv.scrollTop=sL._logdiv.scrollHeight)},sL.clear=function(){sL._logdiv.innerText="",sL._count=0},sL._logdiv=null,sL._count=0,sL.maxCount=20}(),function(){function sL(){}sr(sL,"laya.utils.Mouse"),st(1,sL,"cursor",function(){return sL._style.cursor},function(sd){sL._style.cursor=sd}),sL.hide=function(){"none"!=sL.cursor&&(sL._preCursor=sL.cursor,sL.cursor="none")},sL.show=function(){"none"==sL.cursor&&(sL.cursor=sL._preCursor?sL._preCursor:"auto")},sL._preCursor=null,su(sL,["_style",function(){return this._style=si.document.body.style}])}(),function(){function s_(){}return sr(s_,"laya.utils.Pool"),s_.getPoolBySign=function(sd){return s_._poolDic[sd]||(s_._poolDic[sd]=[])},s_.clearBySign=function(sd){s_._poolDic[sd]&&(s_._poolDic[sd].length=0)},s_.recover=function(sd,sL){sL.__InPool||(sL.__InPool=!0,s_.getPoolBySign(sd).push(sL))},s_.getItemByClass=function(sd,sL){var sl=s_.getPoolBySign(sd),sZ=sl.length?sl.pop():new sL;return sZ.__InPool=!1,sZ},s_.getItemByCreateFun=function(sd,sL,sl){var sZ=s_.getPoolBySign(sd),sh=sZ.length?sZ.pop():sL.call(sl);return sh.__InPool=!1,sh},s_.getItem=function(sd){var sL=s_.getPoolBySign(sd),sl=sL.length?sL.pop():null;return sl&&(sl.__InPool=!1),sl},s_._poolDic={},s_.InPoolSign="__InPool",s_}()),sK=function(){function su(){}return sr(su,"laya.utils.Stat"),st(1,su,"onclick",null,function(sd){su._sp&&su._sp.on("click",su._sp,sd),su._canvas&&(su._canvas.source.onclick=sd,su._canvas.source.style.pointerEvents="")}),su.show=function(sd,sL,sl){if(void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),!sH.isConchApp||sH.isConchWebGL){if(sH.isConchWebGL||si.onMiniGame||si.onLimixiu||(su._useCanvas=!0),su._show=!0,su._fpsData.length=60,su._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},su._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},su._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},su._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},sH.isWebGL)if(su._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},sH.is3DMode){if(su._view[0].title="FPS(3D)",su._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},su._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},su._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==sl){var sZ=8;su._view[sZ++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},su._view[sZ++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},su._view[sZ++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==sl){sZ=8;su._view[sZ++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},su._view[sZ++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},su._view[sZ++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},su._view[sZ++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},su._view[sZ++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},su._view[sZ++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},su._view[sZ++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else su._view[0].title="FPS(WebGL)",su._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else su._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};su._useCanvas?su.createUIPre(sd,sL):su.createUI(sd,sL),su.enable()}else si.window.conch.showFPS&&si.window.conch.showFPS(sd,sL)},su.createUIPre=function(sd,sL){var sl=si.pixelRatio;su._width=170*sl,su._vx=75*sl,su._height=sl*(12*su._view.length+3*sl)+4,su._fontSize=12*sl;for(var sZ=0;sZ<su._view.length;sZ++)su._view[sZ].x=4,su._view[sZ].y=sZ*su._fontSize+2*sl;su._canvas||((su._canvas=new swd("2D")).size(su._width,su._height),(su._ctx=su._canvas.getContext("2d")).textBaseline="top",su._ctx.font=su._fontSize+"px Sans-serif",su._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+sd+"px;top:"+sL+"px;width:"+su._width/sl+"px;height:"+su._height/sl+"px;"),su._first=!0,su.loop(),su._first=!1,si.container.appendChild(su._canvas.source)},su.createUI=function(sd,sL){var sl=su._sp,sZ=si.pixelRatio;sl||(sl=new sbd,(su._leftText=new sad).pos(5,5),su._leftText.color="#ffffff",sl.addChild(su._leftText),(su._txt=new sad).pos(80*sZ,5),su._txt.color="#ffffff",sl.addChild(su._txt),su._sp=sl),sl.pos(sd,sL);for(var sh="",s_=0;s_<su._view.length;s_++){sh+=su._view[s_].title+"\n"}su._leftText.text=sh;var sN=170*sZ,sm=sZ*(12*su._view.length+3*sZ)+4;su._txt.fontSize=su._fontSize*sZ,su._leftText.fontSize=su._fontSize*sZ,sl.size(sN,sm),sl.graphics.clear(),sl.graphics.setAlpha(.5),sl.graphics.drawRect(0,0,sN,sm,"#999999"),sl.graphics.setAlpha(1),su.loop()},su.enable=function(){s$.timer.frameLoop(1,su,su.loop)},su.hide=function(){su._show=!1,s$.timer.clear(su,su.loop),su._canvas&&si.removeElement(su._canvas.source)},su.clear=function(){su.trianglesFaces=su.drawCall=su.shaderCall=su.spriteCount=su.spriteRenderUseCacheCount=su.treeNodeCollision=su.treeSpriteCollision=su.canvasNormal=su.canvasBitmap=su.canvasReCache=0},su.loop=function(){su._count++;var sd=si.now();if(!(sd-su._timer<1e3)){var sL=su._count;if(su.FPS=Math.round(1e3*sL/(sd-su._timer)),su._show){su.trianglesFaces=Math.round(su.trianglesFaces/sL),su.spriteCount=su._useCanvas?(su.drawCall=Math.round(su.drawCall/sL)-2,su.shaderCall=Math.round(su.shaderCall/sL),Math.round(su.spriteCount/sL)-1):(su.drawCall=Math.round(su.drawCall/sL)-2,su.shaderCall=Math.round(su.shaderCall/sL)-4,Math.round(su.spriteCount/sL)-4),su.spriteRenderUseCacheCount=Math.round(su.spriteRenderUseCacheCount/sL),su.canvasNormal=Math.round(su.canvasNormal/sL),su.canvasBitmap=Math.round(su.canvasBitmap/sL),su.canvasReCache=Math.ceil(su.canvasReCache/sL),su.treeNodeCollision=Math.round(su.treeNodeCollision/sL),su.treeSpriteCollision=Math.round(su.treeSpriteCollision/sL);var sl=0<su.FPS?Math.floor(1e3/su.FPS).toString():" ";su._fpsStr=su.FPS+(su.renderSlow?" slow":"")+" "+sl,su._spriteStr=su.spriteCount+(su.spriteRenderUseCacheCount?"/"+su.spriteRenderUseCacheCount:""),su._canvasStr=su.canvasReCache+"/"+su.canvasNormal+"/"+su.canvasBitmap,su.currentMemorySize=so.systemResourceManager.memorySize,su._useCanvas?su.renderInfoPre():su.renderInfo(),su.clear()}su._count=0,su._timer=sd}},su.renderInfoPre=function(){if(su._canvas){var sd=su._ctx;sd.clearRect(su._first?0:su._vx,0,su._width,su._height);for(var sL=sH.WebGL.mainContext,sl=0;sl<su._view.length;sl++){var sZ=su._view[sl];su._first&&(sd.fillStyle="white",sd.fillText(sZ.title,sZ.x,sZ.y,null,null,null)),sd.fillStyle=sZ.color;var sh=-1;if((sZ=su._view[sl]).varying){if(sL)switch(sZ.varying){case 1:sh=sL.getParameter(sL[sZ.value]);break;case 2:sh=sL.getExtension(sZ.value)}}else sh=su[sZ.value];"M"==sZ.units&&(sh=Math.floor(sh/1048576*100)/100+" M"),"K"==sZ.units&&(sh=Math.floor(sh/1024*100)/100+" K"),"string"==sZ.units&&(sh=sh.match(/\d+\.?\d/i)),sd.fillText(sh+"",sZ.x+su._vx,sZ.y,null,null,null)}}},su.renderInfo=function(){for(var sd="",sL=sH.WebGL.mainContext,sl=0;sl<su._view.length;sl++){var sZ=su._view[sl],sh=-1;if(sZ.varying){if(sL)switch(sZ.varying){case 1:sh=sL.getParameter(sL[sZ.value]);break;case 2:sh=sL.getExtension(sZ.value)}}else sh=su[sZ.value];"M"==sZ.units&&(sh=Math.floor(sh/1048576*100)/100+" M"),"K"==sZ.units&&(sh=Math.floor(sh/1024*100)/100+" K"),"string"==sZ.units&&(sh=sh.match(/\d+\.?\d/i)),sd+=sh+"\n"}su._txt.text=sd},su.FPS=0,su.loopCount=0,su.shaderCall=0,su.drawCall=0,su.trianglesFaces=0,su.spriteCount=0,su.spriteRenderUseCacheCount=0,su.treeNodeCollision=0,su.treeSpriteCollision=0,su.canvasNormal=0,su.canvasBitmap=0,su.canvasReCache=0,su.renderSlow=!1,su.currentMemorySize=0,su._fpsStr=null,su._canvasStr=null,su._spriteStr=null,su._fpsData=[],su._timer=0,su._count=0,su._view=[],su._fontSize=12,su._txt=null,su._leftText=null,su._sp=null,su._show=!1,su._useCanvas=!1,su._canvas=null,su._ctx=null,su._first=!1,su._vx=NaN,su._width=0,su._height=100,su}(),sv=(function(){function sd(){this._strsToID={},this._idToStrs=[],this._length=0}sr(sd,"laya.utils.StringKey");var sL=sd.prototype;sL.add=function(sd){var sL=this._strsToID[sd];return null!=sL?sL:(this._idToStrs[this._length]=sd,this._strsToID[sd]=this._length++)},sL.getID=function(sd){var sL=this._strsToID[sd];return null==sL?-1:sL},sL.getName=function(sd){var sL=this._idToStrs[sd];return null==sL?void 0:sL}}(),function(){var sx;function sd(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}sr(sd,"laya.utils.Timer");var sL=sd.prototype;return sL._init=function(){s$.timer&&s$.timer.frameLoop(1,this,this._update)},sL._now=function(){return Date.now()},sL._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var sd=this.currFrame=this.currFrame+this.scale,sL=this._now();this._delta=(sL-this._lastTimer)*this.scale;var sl=this.currTimer=this.currTimer+this._delta;s$.isDebug&&6e4<Math.abs(sL-this._lastTimer)&&console.error("系统时间错误！"+(sL-this._lastTimer)),this._lastTimer=sL;var sZ=this._handlers;for(sN=this._count=0,sm=sZ.length;sN<sm;sN++)if(null!==(su=sZ[sN]).method){var sh=su.userFrame?sd:sl;if(sh>=su.exeTime)if(su.repeat)if(su.jumpFrame)for(;sh>=su.exeTime;)su.exeTime+=su.delay,su.run(!1);else su.exeTime+=su.delay,su.run(!1),sh>su.exeTime&&(su.exeTime+=Math.ceil((sh-su.exeTime)/su.delay)*su.delay);else su.run(!0)}else this._count++;(30<this._count||sd%200==0)&&this._clearHandlers();for(var s_=this._laters,sN=0,sm=s_.length-1;sN<=sm;sN++){var su=s_[sN];this._isIgnoreRecover(su)||(null!==su.method&&(delete this._map[su.key],su.run(!1)),this._recoverHandler(su)),sN===sm&&(sm=s_.length-1)}s_.length=0}},sL._clearHandlers=function(){for(var sd=this._handlers,sL=0,sl=sd.length;sL<sl;sL++){var sZ=sd[sL];null!==sZ.method?this._temp.push(sZ):this._isIgnoreRecover(sZ)?this._temp.push(sZ):this._recoverHandler(sZ)}this._handlers=this._temp,this._temp=sd,this._temp.length=0},sL._recoverHandler=function(sd){this._map[sd.key]==sd&&delete this._map[sd.key],sd.recover()},sL._create=function(sd,sL,sl,sZ,sh,s_,sN,sm){if(!sl)return sh.apply(sZ,s_),null;if(sN){var su=this._getHandler(sZ,sh);if(su)return su.repeat=sL,su.userFrame=sd,su.delay=sl,su.ignoreRecover=sm,su.caller=sZ,su.method=sh,su.args=s_,su.exeTime=sl+(sd?this.currFrame:this.currTimer+this._now()-this._lastTimer),su}return(su=sx.create()).repeat=sL,su.userFrame=sd,su.delay=sl,su.ignoreRecover=sm,su.caller=sZ,su.method=sh,su.args=s_,su.exeTime=sl+(sd?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(su),this._handlers.push(su),su},sL._indexHandler=function(sd){var sL=sd.caller,sl=sd.method,sZ=sL?sL.$_GID||(sL.$_GID=sf.getGID()):0,sh=sl.$_TID||(sl.$_TID=this._mid++);sd.key=sZ+"_"+sh,this._map[sd.key]=sd},sL.once=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=!0),this._create(!1,!1,sd,sL,sl,sZ,sh,!1)},sL.loop=function(sd,sL,sl,sZ,sh,s_,sN){void 0===sh&&(sh=!0),void 0===s_&&(s_=!1),void 0===sN&&(sN=!1);var sm=this._create(!1,!0,sd,sL,sl,sZ,sh,sN);sm&&(sm.jumpFrame=s_)},sL.frameOnce=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=!0),this._create(!0,!1,sd,sL,sl,sZ,sh,!1)},sL.frameLoop=function(sd,sL,sl,sZ,sh,s_){void 0===sh&&(sh=!0),void 0===s_&&(s_=!1),this._create(!0,!0,sd,sL,sl,sZ,sh,s_)},sL.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+sx._freeCount},sL.clear=function(sd,sL){var sl=this._getHandler(sd,sL);return!(!sl||this._isIgnoreRecover(sl))&&(delete this._map[sl.key],sl.key=null,sl.clear(),!0)},sL.clearAll=function(sd){if(sd)for(var sL=0,sl=this._handlers.length;sL<sl;sL++){var sZ=this._handlers[sL];sZ.caller===sd&&(this._isIgnoreRecover(sZ)||(delete this._map[sZ.key],sZ.key=null,sZ.clear()))}},sL._getHandler=function(sd,sL){var sl=sd?sd.$_GID||(sd.$_GID=sf.getGID()):0,sZ=sL.$_TID||(sL.$_TID=this._mid++);return this._map[sl+"_"+sZ]},sL._isIgnoreRecover=function(sd){if(sd.ignoreRecover||sd.caller&&"IgnoreRecover"==sd.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var sL="";try{arguments.propertyIsEnumerable.caller}catch(sd){sL=sd.stack}s$.recordError("报错：核心定时器销毁忽略  "+sL)}return!0}return!1},sL.hasHandler=function(sd,sL){return this._map[sd.$_GID+"_"+sL.$_TID]},sL.callLater=function(sd,sL,sl){if(null==this._getHandler(sd,sL)){var sZ=sx.create();sZ.caller=sd,sZ.method=sL,sZ.args=sl,this._indexHandler(sZ),this._laters.push(sZ)}},sL.runCallLater=function(sd,sL){var sl=this._getHandler(sd,sL);sl&&null!=sl.method&&(this._isIgnoreRecover(sl)||(delete this._map[sl.key],sl.run(!0)))},sL.runTimer=function(sd,sL){this.runCallLater(sd,sL)},st(0,sL,"delta",function(){return this._delta}),sd.__init$=function(){sx=function(){function sL(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}sr(sL,"");var sd=sL.prototype;return sd.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},sd.recover=function(){this.clear(),this.args=sL._freeHandler,sL._freeHandler=this,sL._freeCount++},sd.run=function(sd){var sL=this.caller;if(sL&&sL.destroyed)return this.clear();var sl=this.method,sZ=this.args;sd&&this.clear(),null!=sl&&(sZ?sl.apply(sL,sZ):sl.call(sL))},sL._freeHandler=null,sL._freeCount=0,sL.create=function(){var sd=sL._freeHandler;return sd?(sL._freeHandler=sd.args,--sL._freeCount,sd.args=null,sd):new sL},sL}()},sd}()),sJ=function(){function sb(){this.gid=0}sr(sb,"laya.utils.Tween");var sd=sb.prototype;return sd.to=function(sd,sL,sl,sZ,sh,s_,sN){return void 0===s_&&(s_=0),void 0===sN&&(sN=!1),this._create(sd,sL,sl,sZ,sh,s_,sN,!0,!1,!0)},sd.from=function(sd,sL,sl,sZ,sh,s_,sN){return void 0===s_&&(s_=0),void 0===sN&&(sN=!1),this._create(sd,sL,sl,sZ,sh,s_,sN,!1,!1,!0)},sd._create=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){if(!sd)throw new Error("Tween:target is null");this._target=sd,this._duration=sl,this._ease=sZ||sL.ease||sb.easeNone,this._complete=sh||sL.complete,this._delay=s_,this._props=[],this._usedTimer=0,this._startTimer=si.now(),this._usedPool=su,this._delayParam=null,this.update=sL.update;var st=sd.$_GID||(sd.$_GID=sf.getGID());return sb.tweenMap[st]?(sN&&sb.clearTween(sd),sb.tweenMap[st].push(this)):sb.tweenMap[st]=[this],sx?s_<=0?this.firstStart(sd,sL,sm):(this._delayParam=[sd,sL,sm],s$.scaleTimer.once(s_,this,this.firstStart,this._delayParam)):this._initProps(sd,sL,sm),this},sd.firstStart=function(sd,sL,sl){this._delayParam=null,sd.destroyed?this.clear():(this._initProps(sd,sL,sl),this._beginLoop())},sd._initProps=function(sd,sL,sl){for(var sZ in sL)if("number"==typeof sd[sZ]){var sh=sl?sd[sZ]:sL[sZ],s_=sl?sL[sZ]:sd[sZ];this._props.push([sZ,sh,s_-sh]),sl||(sd[sZ]=sh)}},sd._beginLoop=function(){s$.scaleTimer.frameLoop(1,this,this._doEase)},sd._doEase=function(){this._updateEase(si.now())},sd._updateEase=function(sd){var sL=this._target;if(sL){if(sL.destroyed)return sb.clearTween(sL);var sl=this._usedTimer=sd-this._startTimer-this._delay;if(!(sl<0)){if(sl>=this._duration)return this.complete();for(var sZ=0<sl?this._ease(sl,0,1,this._duration):0,sh=this._props,s_=0,sN=sh.length;s_<sN;s_++){var sm=sh[s_];sL[sm[0]]=sm[1]+sZ*sm[2]}this.update&&this.update.run()}}},sd.complete=function(){if(this._target){s$.scaleTimer.runTimer(this,this.firstStart);for(var sd=this._target,sL=this._props,sl=this._complete,sZ=0,sh=sL.length;sZ<sh;sZ++){var s_=sL[sZ];sd[s_[0]]=s_[1]+s_[2]}this.update&&this.update.run(),this.clear(),sl&&sl.run()}},sd.pause=function(){s$.scaleTimer.clear(this,this._beginLoop),s$.scaleTimer.clear(this,this._doEase),s$.scaleTimer.clear(this,this.firstStart);var sd;(sd=si.now()-this._startTimer-this._delay)<0&&(this._usedTimer=sd)},sd.setStartTime=function(sd){this._startTimer=sd},sd.clear=function(){this._target&&(this._remove(),this._clear())},sd._clear=function(){this.pause(),s$.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,sG.recover("tween",this))},sd.recover=function(){this._usedPool=!0,this._clear()},sd._remove=function(){var sd=sb.tweenMap[this._target.$_GID];if(sd)for(var sL=0,sl=sd.length;sL<sl;sL++)if(sd[sL]===this){sd.splice(sL,1);break}},sd.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=si.now(),this._delayParam)s$.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var sd=this._props,sL=0,sl=sd.length;sL<sl;sL++){var sZ=sd[sL];this._target[sZ[0]]=sZ[1]}s$.scaleTimer.once(this._delay,this,this._beginLoop)}},sd.resume=function(){this._usedTimer>=this._duration||(this._startTimer=si.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?s$.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},st(0,sd,"progress",null,function(sd){var sL=sd*this._duration;this._startTimer=si.now()-this._delay-sL}),sb.to=function(sd,sL,sl,sZ,sh,s_,sN,sm){return void 0===s_&&(s_=0),void 0===sN&&(sN=!1),void 0===sm&&(sm=!0),sG.getItemByClass("tween",sb)._create(sd,sL,sl,sZ,sh,s_,sN,!0,sm,!0)},sb.from=function(sd,sL,sl,sZ,sh,s_,sN,sm){return void 0===s_&&(s_=0),void 0===sN&&(sN=!1),void 0===sm&&(sm=!0),sG.getItemByClass("tween",sb)._create(sd,sL,sl,sZ,sh,s_,sN,!1,sm,!0)},sb.clearAll=function(sd){if(sd&&sd.$_GID){var sL=sb.tweenMap[sd.$_GID];if(sL){for(var sl=0,sZ=sL.length;sl<sZ;sl++)sL[sl]._clear();sL.length=0}}},sb.clear=function(sd){sd.clear()},sb.clearTween=function(sd){sb.clearAll(sd)},sb.easeNone=function(sd,sL,sl,sZ){return sl*sd/sZ+sL},sb.tweenMap={},sb}(),sf=function(){function sm(){}return sr(sm,"laya.utils.Utils"),sm.toRadian=function(sd){return sd*sm._pi2},sm.toAngle=function(sd){return sd*sm._pi},sm.toHexColor=function(sd){if(sd<0||isNaN(sd))return null;for(var sL=sd.toString(16);sL.length<6;)sL="0"+sL;return"#"+sL},sm.getGID=function(){return sm._gid++},sm.concatArray=function(sd,sL){if(!sL)return sd;if(!sd)return sL;var sl=0,sZ=sL.length;for(sl=0;sl<sZ;sl++)sd.push(sL[sl]);return sd},sm.clearArray=function(sd){return sd&&(sd.length=0),sd},sm.copyArray=function(sd,sL){if(sd||(sd=[]),!sL)return sd;sd.length=sL.length;var sl=0,sZ=sL.length;for(sl=0;sl<sZ;sl++)sd[sl]=sL[sl];return sd},sm.getGlobalRecByPoints=function(sd,sL,sl,sZ,sh){var s_,sN;return s_=new sO(sL,sl),s_=sd.localToGlobal(s_),sN=new sO(sZ,sh),sN=sd.localToGlobal(sN),sn._getWrapRec([s_.x,s_.y,sN.x,sN.y])},sm.getGlobalPosAndScale=function(sd){return sm.getGlobalRecByPoints(sd,0,0,1,1)},sm.bind=function(sd,sL){return sd.bind(sL)},sm.measureText=function(sd,sL){return sF.measureText(sd,sL)},sm.updateOrder=function(sd){if(!sd||sd.length<2)return!1;for(var sL,sl=1,sZ=0,sh=sd.length,s_=NaN;sl<sh;){for(sL=sd[sZ=sl],s_=sd[sZ]._zOrder;-1<--sZ&&sd[sZ]._zOrder>s_;)sd[sZ+1]=sd[sZ];sd[sZ+1]=sL,sl++}var sN=sL.parent.conchModel;if(sN)if(null!=sN.updateZOrder)sN.updateZOrder();else{for(sl=0;sl<sh;sl++)sN.removeChild(sd[sl].conchModel);for(sl=0;sl<sh;sl++)sN.addChildAt(sd[sl].conchModel,sl)}return!0},sm.transPointList=function(sd,sL,sl){var sZ=0,sh=sd.length;for(sZ=0;sZ<sh;sZ+=2)sd[sZ]+=sL,sd[sZ+1]+=sl},sm.parseInt=function(sd,sL){void 0===sL&&(sL=0);var sl=si.window.parseInt(sd,sL);return isNaN(sl)?0:sl},sm.getFileExtension=function(sd){sm._extReg.lastIndex=sd.lastIndexOf(".");var sL=sm._extReg.exec(sd);return sL&&1<sL.length?sL[1].toLowerCase():null},sm.getTransformRelativeToWindow=function(sd,sL,sl){var sZ=s$.stage,sh=laya.utils.Utils.getGlobalPosAndScale(sd),s_=sZ._canvasTransform.clone(),sN=s_.tx,sm=s_.ty;s_.rotate(-Math.PI/180*s$.stage.canvasDegree),s_.scale(s$.stage.clientScaleX,s$.stage.clientScaleY);var su=s$.stage.canvasDegree%180!=0,sx=NaN,st=NaN;su?(sx=sl+sh.y,st=sL+sh.x,sx*=s_.d,st*=s_.a,90==s$.stage.canvasDegree?(sx=sN-sx,st+=sm):(sx+=sN,st=sm-st)):(sx=sL+sh.x,st=sl+sh.y,sx*=s_.a,st*=s_.d,sx+=sN,st+=sm);var sb=NaN,sq=NaN;return sq=su?(sb=s_.d*sh.height,s_.a*sh.width):(sb=s_.a*sh.width,s_.d*sh.height),{x:sx,y:st,scaleX:sb,scaleY:sq}},sm.fitDOMElementInArea=function(sd,sL,sl,sZ,sh,s_){sd._fitLayaAirInitialized||(sd._fitLayaAirInitialized=!0,sd.style.transformOrigin=sd.style.webKittransformOrigin="left top",sd.style.position="absolute");var sN=sm.getTransformRelativeToWindow(sL,sl,sZ);sd.style.transform=sd.style.webkitTransform="scale("+sN.scaleX+","+sN.scaleY+") rotate("+s$.stage.canvasDegree+"deg)",sd.style.width=sh+"px",sd.style.height=s_+"px",sd.style.left=sN.x+"px",sd.style.top=sN.y+"px"},sm.isOkTextureList=function(sd){if(!sd)return!1;var sL,sl=0,sZ=sd.length;for(sl=0;sl<sZ;sl++)if(!(sL=sd[sl])||!sL.source)return!1;return!0},sm.isOKCmdList=function(sd){if(!sd)return!1;var sL,sl,sZ=0,sh=sd.length,s_=sH._context;for(sZ=0;sZ<sh;sZ++)switch((sL=sd[sZ]).callee){case s_._drawTexture:case s_._fillTexture:case s_._drawTextureWithTransform:if(!(sl=sL[0])||!sl.source)return!1}return!0},sm._gid=1,sm._pi=180/Math.PI,sm._pi2=Math.PI/180,sm._extReg=/\.(\w+)\??/g,sm.parseXMLFromString=function(sd){var sL;if(sd=sd.replace(/>\s+</g,"><"),-1<(sL=(new DOMParser).parseFromString(sd,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(sL.firstChild.firstChild.textContent);return sL},sm}(),sU=function(){function sd(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],sH.isWebGL&&sB.regCacheByFunction(sf.bind(this.startDispose,this),sf.bind(this.getCacheList,this))}sr(sd,"laya.utils.VectorGraphManager");var sL=sd.prototype;return sL.getId=function(){return this._id++},sL.addShape=function(sd,sL){this.shapeDic[sd]=sL,this.useDic[sd]||(this.useDic[sd]=!0)},sL.addLine=function(sd,sL){this.shapeLineDic[sd]=sL,this.shapeLineDic[sd]||(this.shapeLineDic[sd]=!0)},sL.getShape=function(sd){this._checkKey&&null!=this.useDic[sd]&&(this.useDic[sd]=!0)},sL.deleteShape=function(sd){this.shapeDic[sd]&&(this.shapeDic[sd]=null,delete this.shapeDic[sd]),this.shapeLineDic[sd]&&(this.shapeLineDic[sd]=null,delete this.shapeLineDic[sd]),null!=this.useDic[sd]&&delete this.useDic[sd]},sL.getCacheList=function(){var sd,sL=[];for(sd in this.shapeDic)sL.push(this.shapeDic[sd]);for(sd in this.shapeLineDic)sL.push(this.shapeLineDic[sd]);return sL},sL.startDispose=function(sd){var sL;for(sL in this.useDic)this.useDic[sL]=!1;this._checkKey=!0},sL.endDispose=function(){if(this._checkKey){var sd;for(sd in this.useDic)this.useDic[sd]||this.deleteShape(sd);this._checkKey=!1}},sd.getInstance=function(){return sd.instance=sd.instance||new sd},sd.instance=null,sd}(),sW=function(){function sZ(){this._obj=null,this._obj=sZ.supportWeakMap?new si.window.WeakMap:{},sZ.supportWeakMap||sZ._maps.push(this)}sr(sZ,"laya.utils.WeakObject");var sd=sZ.prototype;return sd.set=function(sd,sL){if(null!=sd)if(sZ.supportWeakMap){var sl=sd;"string"!=typeof sd&&"number"!=typeof sd||(sl=sZ._keys[sd])||(sl=sZ._keys[sd]={k:sd}),this._obj.set(sl,sL)}else"string"==typeof sd||"number"==typeof sd?this._obj[sd]=sL:(sd.$_GID||(sd.$_GID=sf.getGID()),this._obj[sd.$_GID]=sL)},sd.get=function(sd){if(null==sd)return null;if(sZ.supportWeakMap){var sL="string"==typeof sd||"number"==typeof sd?sZ._keys[sd]:sd;return sL?this._obj.get(sL):null}return"string"==typeof sd||"number"==typeof sd?this._obj[sd]:this._obj[sd.$_GID]},sd.del=function(sd){if(null!=sd)if(sZ.supportWeakMap){var sL="string"==typeof sd||"number"==typeof sd?sZ._keys[sd]:sd;if(!sL)return;this._obj.delete(sL)}else"string"==typeof sd||"number"==typeof sd?delete this._obj[sd]:delete this._obj[this._obj.$_GID]},sd.has=function(sd){if(null==sd)return!1;if(sZ.supportWeakMap){var sL="string"==typeof sd||"number"==typeof sd?sZ._keys[sd]:sd;return this._obj.has(sL)}return"string"==typeof sd||"number"==typeof sd?null!=this._obj[sd]:null!=this._obj[this._obj.$_GID]},sZ.__init__=function(){(sZ.supportWeakMap=null!=si.window.WeakMap)||s$.timer.loop(sZ.delInterval,null,sZ.clearCache)},sZ.clearCache=function(){for(var sd=0,sL=sZ._maps.length;sd<sL;sd++){sZ._maps[sd]._obj={}}},sZ.supportWeakMap=!1,sZ.delInterval=3e5,sZ._keys={},sZ._maps=[],su(sZ,["I",function(){return this.I=new sZ}]),sZ}(),sM=function(){function sd(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}sr(sd,"laya.utils.WordText");var sL=sd.prototype;return sL.setText=function(sd){this.changed=!0,this._text=sd},sL.toString=function(){return this._text},sL.charCodeAt=function(sd){return this._text?this._text.charCodeAt(sd):NaN},sL.charAt=function(sd){return this._text?this._text.charAt(sd):null},st(0,sL,"length",function(){return this._text?this._text.length:0}),sd}(),sdd=function(sd){function sN(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,sN.__super.call(this),this._childs=sN.ARRAY_EMPTY,this._$P=sN.PROP_EMPTY,this.timer=s$.scaleTimer,this.conchModel=sH.isConchNode?this.createConchModel():null}sr(sN,"laya.display.Node",sx);var sL=sN.prototype;return sL._setBit=function(sd,sL){1==sd&&(this._getBit(sd)!=sL&&this._updateDisplayedInstage());sL?this._bits|=sd:this._bits&=~sd},sL._getBit=function(sd){return 0!=(this._bits&sd)},sL._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},sL._setUpNoticeType=function(sd){var sL=this;for(sL._setBit(sd,!0),sL=sL.parent;sL;){if(sL._getBit(sd))return;sL._setBit(sd,!0),sL=sL.parent}},sL.on=function(sd,sL,sl,sZ){return"display"!==sd&&"undisplay"!==sd||this._getBit(1)||this._setUpNoticeType(1),this._createListener(sd,sL,sl,sZ,!1)},sL.once=function(sd,sL,sl,sZ){return"display"!==sd&&"undisplay"!==sd||this._getBit(1)||this._setUpNoticeType(1),this._createListener(sd,sL,sl,sZ,!0)},sL.createConchModel=function(){return null},sL.destroy=function(sd){void 0===sd&&(sd=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(sd?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},sL.destroyChildren=function(){if(this._childs)for(var sd=this._childs.length-1;-1<sd;sd--)this._childs[sd].destroy(!0)},sL.addChild=function(sd){if(!sd||this.destroyed||sd===this)return sd;if(sd.zOrder&&this._set$P("hasZorder",!0),sd._parent===this){var sL=this.getChildIndex(sd);sL!==this._childs.length-1&&(this._childs.splice(sL,1),this._childs.push(sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,this._childs.length-1)),this._childChanged())}else sd.parent&&sd.parent.removeChild(sd),this._childs===sN.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(sd),this.conchModel&&this.conchModel.addChildAt(sd.conchModel,this._childs.length-1),(sd.parent=this)._childChanged();return sd},sL.addChildren=function(sd){for(var sL=arguments,sl=0,sZ=sL.length;sl<sZ;)this.addChild(sL[sl++])},sL.addChildAt=function(sd,sL){if(!sd||this.destroyed||sd===this)return sd;if(sd.zOrder&&this._set$P("hasZorder",!0),0<=sL&&sL<=this._childs.length){if(sd._parent===this){var sl=this.getChildIndex(sd);this._childs.splice(sl,1),this._childs.splice(sL,0,sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,sL)),this._childChanged()}else sd.parent&&sd.parent.removeChild(sd),this._childs===sN.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(sL,0,sd),this.conchModel&&this.conchModel.addChildAt(sd.conchModel,sL),sd.parent=this;return sd}throw new Error("appendChildAt:The index is out of bounds")},sL.getChildIndex=function(sd){return this._childs.indexOf(sd)},sL.getChildByName=function(sd){var sL=this._childs;if(sL)for(var sl=0,sZ=sL.length;sl<sZ;sl++){var sh=sL[sl];if(sh.name===sd)return sh}return null},sL._get$P=function(sd){return this._$P[sd]},sL._set$P=function(sd,sL){return this.destroyed||(this._$P===sN.PROP_EMPTY&&(this._$P={}),this._$P[sd]=sL),sL},sL.getChildAt=function(sd){return this._childs[sd]},sL.setChildIndex=function(sd,sL){var sl=this._childs;if(sL<0||sL>=sl.length)throw new Error("setChildIndex:The index is out of bounds.");var sZ=this.getChildIndex(sd);if(sZ<0)throw new Error("setChildIndex:node is must child of this object.");return sl.splice(sZ,1),sl.splice(sL,0,sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,sL)),this._childChanged(),sd},sL._childChanged=function(sd){},sL.removeChild=function(sd){if(!this._childs)return sd;var sL=this._childs.indexOf(sd);return this.removeChildAt(sL)},sL.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},sL.removeChildByName=function(sd){var sL=this.getChildByName(sd);return sL&&this.removeChild(sL),sL},sL.removeChildAt=function(sd){var sL=this.getChildAt(sd);if(sL){for(var sl=this._childs.length-1,sZ=sd;sZ<sl;++sZ)this._childs[sZ]=this._childs[sZ+1];this._childs.length=sl,this.conchModel&&this.conchModel.removeChild(sL.conchModel),sL.parent=null}return sL},sL.removeChildren=function(sd,sL){if(void 0===sd&&(sd=0),void 0===sL&&(sL=2147483647),this._childs&&0<this._childs.length){var sl=this._childs;if(0===sd&&s_<=sL){var sZ=sl;this._childs=sN.ARRAY_EMPTY}else sZ=sl.splice(sd,sL-sd);for(var sh=0,s_=sZ.length;sh<s_;sh++)sZ[sh].parent=null,this.conchModel&&this.conchModel.removeChild(sZ[sh].conchModel)}return this},sL.replaceChild=function(sd,sL){var sl=this._childs.indexOf(sL);return-1<sl?(this._childs.splice(sl,1,sd),this.conchModel&&(this.conchModel.removeChild(sL.conchModel),this.conchModel.addChildAt(sd.conchModel,sl)),sL.parent=null,sd.parent=this,sd):null},sL._updateDisplayedInstage=function(){var sd;sd=this;var sL=s$.stage;for(this._displayedInStage=!1;sd;){if(sd._getBit(1)){this._displayedInStage=sd._displayedInStage;break}if(sd==sL||sd._displayedInStage){this._displayedInStage=!0;break}sd=sd.parent}},sL._setDisplay=function(sd){this._displayedInStage!==sd&&((this._displayedInStage=sd)?this.event("display"):this.event("undisplay"))},sL._displayChild=function(sd,sL){var sl=sd._childs;if(sl)for(var sZ=0;sZ<sl.length;sZ++){var sh=sl[sZ];sh&&sh._getBit(1)&&(0<sh._childs.length?this._displayChild(sh,sL):sh._setDisplay(sL))}sd._setDisplay(sL)},sL.contains=function(sd){if(sd===this)return!0;for(;sd;){if(sd.parent===this)return!0;sd=sd.parent}return!1},sL.timerLoop=function(sd,sL,sl,sZ,sh,s_){void 0===sh&&(sh=!0),void 0===s_&&(s_=!1),this.timer.loop(sd,sL,sl,sZ,sh,s_)},sL.timerOnce=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=!0),this.timer._create(!1,!1,sd,sL,sl,sZ,sh)},sL.frameLoop=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=!0),this.timer._create(!0,!0,sd,sL,sl,sZ,sh)},sL.frameOnce=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=!0),this.timer._create(!0,!1,sd,sL,sl,sZ,sh)},sL.clearTimer=function(sd,sL){this.timer.clear(sd,sL)},st(0,sL,"numChildren",function(){return this._childs.length}),st(0,sL,"destroyed",function(){return this._destroyed}),st(0,sL,"parent",function(){return this._parent},function(sd){this._parent!==sd&&(sd?(this._parent=sd,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),sd.displayedInStage&&this._displayChild(this,!0)),sd._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=sd))}),st(0,sL,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),sN.ARRAY_EMPTY=[],sN.PROP_EMPTY={},sN.NOTICE_DISPLAY=1,sN.MOUSEENABLE=2,sN}(),sLd=function(sd){function sq(sd){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,sq.__super.call(this),this._padding=sq._PADDING,this._spacing=sq._SPACING,this._aligns=sq._ALIGNS,this._font=sY.EMPTY,this._ower=sd}sr(sq,"laya.display.css.CSSStyle",sd);var sL=sq.prototype;return sL.destroy=function(){this._ower=null,this._font=null,this._rect=null},sL.inherit=function(sd){this._font=sd._font,this._spacing=sd._spacing===sq._SPACING?sq._SPACING:sd._spacing.slice(),this.lineHeight=sd.lineHeight},sL._widthAuto=function(){return 0!=(262144&this._type)},sL.widthed=function(sd){return 0!=(8&this._type)},sL._calculation=function(sd,sL){if(sL.indexOf("%")<0)return!1;var sZ=this._ower,sh=sZ.parent,s_=this._rect;function sN(sd,sL,sl){return sd*sl[0]+sL*sl[1]+sl[2]}function sl(sd){var sL=sh.width,sl=sZ.width;s_.width&&(sZ.width=sN(sL,sl,s_.width)),s_.height&&(sZ.height=sN(sL,sl,s_.height)),s_.left&&(sZ.x=sN(sL,sl,s_.left)),s_.top&&(sZ.y=sN(sL,sl,s_.top))}null===s_&&(sh._getCSSStyle()._type|=524288,sh.on("resize",this,sl),this._rect=s_={input:{}});var sm=sL.split(" ");return sm[0]=parseFloat(sm[0])/100,1==sm.length?sm[1]=sm[2]=0:(sm[1]=parseFloat(sm[1])/100,sm[2]=parseFloat(sm[2])),s_[sd]=sm,s_.input[sd]=sL,sl(),!0},sL.heighted=function(sd){return 0!=(8192&this._type)},sL.size=function(sd,sL){var sl=this._ower,sZ=!1;-1!==sd&&sd!=this._ower.width&&(this._type|=8,this._ower.width=sd,sZ=!0),-1!==sL&&sL!=this._ower.height&&(this._type|=8192,this._ower.height=sL,sZ=!0),sZ&&(sl._layoutLater(),524288&this._type&&sl.event("resize",this))},sL._getAlign=function(){return this._aligns[0]},sL._getValign=function(){return this._aligns[1]},sL._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},sL._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new sY(this._font))},sL.render=function(sd,sL,sl,sZ){var sh=sd.width,s_=sd.height;sl-=sd.pivotX,sZ-=sd.pivotY,this._bgground&&null!=this._bgground.color&&sL.ctx.fillRect(sl,sZ,sh,s_,this._bgground.color),this._border&&this._border.color&&sL.drawRect(sl,sZ,sh,s_,this._border.color.strColor,this._border.size)},sL.getCSSStyle=function(){return this},sL.cssText=function(sd){this.attrs(sq.parseOneCSS(sd,";"))},sL.attrs=function(sd){if(sd)for(var sL=0,sl=sd.length;sL<sl;sL++){var sZ=sd[sL];this[sZ[0]]=sZ[1]}},sL.setTransform=function(sd){"none"===sd?this._tf=sm._TF_EMPTY:this.attrs(sq.parseOneCSS(sd,","))},sL.translate=function(sd,sL){this._tf===sm._TF_EMPTY&&(this._tf=new sh),this._tf.translateX=sd,this._tf.translateY=sL},sL.scale=function(sd,sL){this._tf===sm._TF_EMPTY&&(this._tf=new sh),this._tf.scaleX=sd,this._tf.scaleY=sL},sL._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},st(0,sL,"block",sd.prototype._$get_block,function(sd){sd?this._type|=1:this._type&=-2}),st(0,sL,"valign",function(){return sq._valigndef[this._aligns[1]]},function(sd){this._aligns===sq._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=sq._valigndef[sd]}),st(0,sL,"height",null,function(sd){if(this._type|=8192,"string"==typeof sd){if(this._calculation("height",sd))return;sd=parseInt(sd)}this.size(-1,sd)}),st(0,sL,"width",null,function(sd){if(this._type|=8,"string"==typeof sd){var sL=sd.indexOf("auto");if(0<=sL&&(this._type|=262144,sd=sd.substr(0,sL)),this._calculation("width",sd))return;sd=parseInt(sd)}this.size(sd,-1)}),st(0,sL,"fontWeight",function(){return this._font.weight},function(sd){this._createFont().weight=sd}),st(0,sL,"left",null,function(sd){var sL=this._ower;if("string"==typeof sd){if("center"===sd?sd="50% -50% 0":"right"===sd&&(sd="100% -100% 0"),this._calculation("left",sd))return;sd=parseInt(sd)}sL.x=sd}),st(0,sL,"_translate",null,function(sd){this.translate(sd[0],sd[1])}),st(0,sL,"absolute",function(){return 0!=(4&this._type)}),st(0,sL,"top",null,function(sd){var sL=this._ower;if("string"==typeof sd){if("middle"===sd?sd="50% -50% 0":"bottom"===sd&&(sd="100% -100% 0"),this._calculation("top",sd))return;sd=parseInt(sd)}sL.y=sd}),st(0,sL,"align",function(){return sq._aligndef[this._aligns[0]]},function(sd){this._aligns===sq._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=sq._aligndef[sd]}),st(0,sL,"bold",function(){return this._font.bold},function(sd){this._createFont().bold=sd}),st(0,sL,"padding",function(){return this._padding},function(sd){this._padding=sd}),st(0,sL,"leading",function(){return this._spacing[1]},function(sd){"string"==typeof sd&&(sd=parseInt(sd+"")),this._spacing===sq._SPACING&&(this._spacing=[0,0]),this._spacing[1]=sd}),st(0,sL,"lineElement",function(){return 0!=(65536&this._type)},function(sd){sd?this._type|=65536:this._type&=-65537}),st(0,sL,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(sd){this.lineElement=!1,"right"===sd?this._type|=32768:this._type&=-32769}),st(0,sL,"textDecoration",function(){return this._font.decoration},function(sd){this._createFont().decoration=sd}),st(0,sL,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(sd){"nowrap"===sd&&(this._type|=131072),"none"===sd&&(this._type&=-131073)}),st(0,sL,"background",null,function(sd){sd?(this._bgground||(this._bgground={}),this._bgground.color=sd,this._ower.conchModel&&this._ower.conchModel.bgColor(sd),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),st(0,sL,"wordWrap",function(){return 0==(131072&this._type)},function(sd){sd?this._type&=-131073:this._type|=131072}),st(0,sL,"color",function(){return this._font.color},function(sd){this._createFont().color=sd}),st(0,sL,"password",function(){return this._font.password},function(sd){this._createFont().password=sd}),st(0,sL,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(sd){"none"===sd?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=sd),this._ower.conchModel&&this._ower.conchModel.bgColor(sd),this._ower._renderType|=256}),st(0,sL,"font",function(){return this._font.toString()},function(sd){this._createFont().set(sd)}),st(0,sL,"weight",null,function(sd){this._createFont().weight=sd}),st(0,sL,"letterSpacing",function(){return this._spacing[0]},function(sd){"string"==typeof sd&&(sd=parseInt(sd+"")),this._spacing===sq._SPACING&&(this._spacing=[0,0]),this._spacing[0]=sd}),st(0,sL,"fontSize",function(){return this._font.size},function(sd){this._createFont().size=sd}),st(0,sL,"italic",function(){return this._font.italic},function(sd){this._createFont().italic=sd}),st(0,sL,"fontFamily",function(){return this._font.family},function(sd){this._createFont().family=sd}),st(0,sL,"stroke",function(){return this._font.stroke[0]},function(sd){this._createFont().stroke===sY._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=sd}),st(0,sL,"strokeColor",function(){return this._font.stroke[1]},function(sd){this._createFont().stroke===sY._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=sd}),st(0,sL,"border",function(){return this._border?this._border.value:""},function(sd){if("none"!=sd){this._border||(this._border={});var sL=(this._border.value=sd).split(" ");if(this._border.color=sP.create(sL[sL.length-1]),1==sL.length)return this._border.size=1,void(this._border.type="solid");var sl=0;0<sL[0].indexOf("px")?(this._border.size=parseInt(sL[0]),sl++):this._border.size=1,this._border.type=sL[sl],this._ower._renderType|=256}else this._border=null}),st(0,sL,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(sd){sd?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==sd?null:sP.create(sd),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),st(0,sL,"position",function(){return 4&this._type?"absolute":""},function(sd){"absolute"==sd?this._type|=4:this._type&=-5}),st(0,sL,"display",null,function(sd){switch(sd){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),st(0,sL,"paddingLeft",function(){return this.padding[3]}),st(0,sL,"paddingTop",function(){return this.padding[0]}),st(0,sL,"_scale",null,function(sd){this._ower.scale(sd[0],sd[1])}),st(0,sL,"_rotate",null,function(sd){this._ower.rotation=sd}),sq.parseOneCSS=function(sd,sL){for(var sl,sZ=[],sh=sd.split(sL),s_=0,sN=sh.length;s_<sN;s_++){var sm=sh[s_],su=sm.indexOf(":"),sx=sm.substr(0,su).replace(/^\s+|\s+$/g,"");if(0!=sx.length){var st=sm.substr(su+1).replace(/^\s+|\s+$/g,""),sb=[sx,st];switch(sx){case"italic":case"bold":sb[1]="true"==st;break;case"line-height":sb[0]="lineHeight",sb[1]=parseInt(st);break;case"font-size":sb[0]="fontSize",sb[1]=parseInt(st);break;case"padding":1<(sl=st.split(" ")).length||(sl[1]=sl[2]=sl[3]=sl[0]),sb[1]=[parseInt(sl[0]),parseInt(sl[1]),parseInt(sl[2]),parseInt(sl[3])];break;case"rotate":sb[0]="_rotate",sb[1]=parseFloat(st);break;case"scale":sl=st.split(" "),sb[0]="_scale",sb[1]=[parseFloat(sl[0]),parseFloat(sl[1])];break;case"translate":sl=st.split(" "),sb[0]="_translate",sb[1]=[parseInt(sl[0]),parseInt(sl[1])];break;default:(sb[0]=sq._CSSTOVALUE[sx])||(sb[0]=sx)}sZ.push(sb)}}return sZ},sq.parseCSS=function(sd,sL){for(var sl;null!=(sl=sq._parseCSSRegExp.exec(sd));)sq.styleSheets[sl[1]]=sq.parseOneCSS(sl[2],";")},sq.EMPTY=new sq(null),sq._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},sq._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),sq._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},sq._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},sq.styleSheets={},sq.ALIGN_CENTER=1,sq.ALIGN_RIGHT=2,sq.VALIGN_MIDDLE=1,sq.VALIGN_BOTTOM=2,sq._CSS_BLOCK=1,sq._DISPLAY_NONE=2,sq._ABSOLUTE=4,sq._WIDTH_SET=8,sq._PADDING=[0,0,0,0],sq._RECT=[-1,-1,-1,-1],sq._SPACING=[0,0],sq._ALIGNS=[0,0,0],sq.ADDLAYOUTED=512,sq._NEWFONT=4096,sq._HEIGHT_SET=8192,sq._BACKGROUND_SET=16384,sq._FLOAT_RIGHT=32768,sq._LINE_ELEMENT=65536,sq._NOWARP=131072,sq._WIDTHAUTO=262144,sq._LISTERRESZIE=524288,sq}(sm),sld=function(sd){function sN(){this.url=null,this.audio=null,this.loaded=!1,sN.__super.call(this)}sr(sN,"laya.media.h5audio.AudioSound",sx);var sL=sN.prototype;return sL.dispose=function(){var sd=sN._audioCache[this.url];sd&&(sd.src="",delete sN._audioCache[this.url])},sL.load=function(sd){var sL;if(sd=sp.formatURL(sd),(this.url=sd)==sg._tMusic?(sN._initMusicAudio(),(sL=sN._musicAudio).src!=sd&&(sN._audioCache[sL.src]=null,sL=null)):sL=sN._audioCache[sd],sL&&2<=sL.readyState)this.event("complete");else{sL||(sL=sd==sg._tMusic?(sN._initMusicAudio(),sN._musicAudio):si.createElement("audio"),(sN._audioCache[sd]=sL).src=sd),sL.addEventListener("canplaythrough",sZ),sL.addEventListener("error",sh);var sl=this;(this.audio=sL).load?sL.load():sh()}function sZ(){s_(),sl.loaded=!0,sl.event("complete")}function sh(){sL.load=null,s_(),sl.event("error")}function s_(){sL.removeEventListener("canplaythrough",sZ),sL.removeEventListener("error",sh)}},sL.play=function(sd,sL,sl){if(void 0===sd&&(sd=0),void 0===sL&&(sL=0),!this.url)return null;var sZ,sh;if(!(sZ=this.url==sg._tMusic?sN._musicAudio:sN._audioCache[this.url]))return null;sh=sG.getItem("audio:"+this.url),sH.isConchApp?sh||((sh=si.createElement("audio")).src=this.url):this.url==sg._tMusic?(sN._initMusicAudio(),(sh=sN._musicAudio).src=this.url):sh=sh||sZ.cloneNode(!0);var s_=new sqd(sh);return s_.url=this.url,s_.loops=sL,s_.startTime=sd,s_.startHandler=sl,s_.play(!1),sg.addChannel(s_),s_},st(0,sL,"duration",function(){var sd;return(sd=sN._audioCache[this.url])?sd.duration:0}),sN._initMusicAudio=function(){sN._musicAudio||(sN._musicAudio||(sN._musicAudio=si.createElement("audio")),sH.isConchApp||si.document.addEventListener("mousedown",sN._makeMusicOK))},sN._makeMusicOK=function(){si.document.removeEventListener("mousedown",sN._makeMusicOK),sN._musicAudio.src?sN._musicAudio.play():(sN._musicAudio.src="",sN._musicAudio.load())},sN._audioCache={},sN._musicAudio=null,sN}(),sZd=function(sd){function sL(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,sL.__super.call(this)}sr(sL,"laya.media.SoundChannel",sx);var sl=sL.prototype;return sl.play=function(){},sl.stop=function(){},sl.pause=function(){},sl.resume=function(){},sl.__runComplete=function(sd){sd&&sd.run()},st(0,sl,"volume",function(){return 1},function(sd){}),st(0,sl,"position",function(){return 0}),st(0,sl,"duration",function(){return 0}),sL}(),shd=function(sd){function sL(){sL.__super.call(this)}sr(sL,"laya.media.Sound",sx);var sl=sL.prototype;return sl.load=function(sd){},sl.play=function(sd,sL,sl){return void 0===sd&&(sd=0),void 0===sL&&(sL=0),null},sl.dispose=function(){},st(0,sl,"duration",function(){return 0}),sL}(),s_d=function(sd){function sh(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,sh.__super.call(this)}sr(sh,"laya.media.webaudio.WebAudioSound",sx);var sL=sh.prototype;return sL.load=function(sd){this.url=sd,this.audioBuffer=sh._dataCache[sd],this.audioBuffer?this._loaded(this.audioBuffer):(sh.e.on("loaded:"+sd,this,this._loaded),sh.e.on("err:"+sd,this,this._err),sh.__loadingSound[sd]||(sh.__loadingSound[sd]=!0,s$.loader.load(sd,se.create(this,this.onloaded),null,smd.BUFFER,4,!1,null,!0)))},sL.onloaded=function(sd){sd||this._err(),this._disposed?this._removeLoadEvents():(this.data=sd,sh.buffs.push({buffer:this.data,url:this.url}),sh.decode())},sL._err=function(){if(this._removeLoadEvents(),sh.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var sd,sL,sl,sZ=0;for(sd=(sL=this.__toPlays).length,sZ=0;sZ<sd;sZ++)(sl=sL[sZ])[3]&&!sl[3].isStopped&&sl[3].event("error");this.__toPlays.length=0}},sL._loaded=function(sd){this._removeLoadEvents(),this._disposed||(this.audioBuffer=sd,this.loaded=!0,this.event("complete"))},sL._removeLoadEvents=function(){sh.e.off("loaded:"+this.url,this,this._loaded),sh.e.off("err:"+this.url,this,this._err)},sL.__playAfterLoaded=function(){if(this.__toPlays){var sd,sL,sl,sZ=0;for(sd=(sL=this.__toPlays).length,sZ=0;sZ<sd;sZ++)(sl=sL[sZ])[3]&&!sl[3].isStopped&&this.play(sl[0],sl[1],sl[2],sl[3]);this.__toPlays.length=0}},sL.play=function(sd,sL,sl,sZ){return void 0===sd&&(sd=0),void 0===sL&&(sL=0),sZ=sZ||new sYd,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([sd,sL,sl,sZ]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),sZ.url=this.url,sZ.loops=sL,sZ.audioBuffer=this.audioBuffer,sZ.startTime=sd,sZ.startHandler=sl,sZ.play(!1),sg.addChannel(sZ),sZ},sL.dispose=function(){this._disposed=!0,delete sh._dataCache[this.url],delete sh.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},st(0,sL,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),sh.decode=function(){if(!(sh.buffs.length<=0||sh.isDecoding))if(sh.isDecoding=!0,(sh.tInfo=sh.buffs.shift())&&sh.tInfo.buffer&&sh.tInfo.buffer.byteLength)try{sh.ctx.decodeAudioData(sh.tInfo.buffer,sh._done,sh._fail)}catch(sd){console.error("decodeAudioData error  byteLength:"+sh.tInfo.buffer.byteLength+"  url:"+sh.tInfo.url)}else sh._fail()},sh._done=function(sd){sh.e.event("loaded:"+sh.tInfo.url,sd),sh._dataCache[sh.tInfo.url]=sd,sh.isDecoding=!1,sh.decode()},sh._fail=function(){sh.e.event("err:"+sh.tInfo.url,null),sh.isDecoding=!1,sh.decode()},sh._playEmptySound=function(){if(null!=sh.ctx){if(sh._emptySource&&(sh._emptySource.stop(),sh._emptySource.disconnect(0),!sYd._tryCleanFailed))try{sh._emptySource.buffer=null}catch(sd){sYd._tryCleanFailed=!0}var sd=sh.ctx.createBufferSource();sd.buffer=sh._miniBuffer,sd.connect(sh.ctx.destination),sd.start(0,0,0),sh._emptySource=sd}},sh._unlock=function(){sh._unlocked||(sh._playEmptySound(),"running"==sh.ctx.state?(si.document.removeEventListener("mousedown",sh._unlock,!0),si.document.removeEventListener("touchend",sh._unlock,!0),si.document.removeEventListener("touchstart",sh._unlock,!0),sh._unlocked=!0):"suspended"==sh.ctx.state&&sg._recoverWebAudio())},sh.initWebAudio=function(){"running"!=sh.ctx.state&&(sh._unlock(),si.document.addEventListener("mousedown",sh._unlock,!0),si.document.addEventListener("touchend",sh._unlock,!0),si.document.addEventListener("touchstart",sh._unlock,!0))},sh._emptySource=null,sh._dataCache={},sh.buffs=[],sh.isDecoding=!1,sh._unlocked=!1,sh.tInfo=null,sh.__loadingSound={},su(sh,["window",function(){return this.window=si.window},"webAudioEnabled",function(){return this.webAudioEnabled=sh.window.AudioContext||sh.window.webkitAudioContext||sh.window.mozAudioContext},"ctx",function(){return this.ctx=sh.webAudioEnabled?new(sh.window.AudioContext||sh.window.webkitAudioContext||sh.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=sh.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new sx}]),sh}(),sNd=function(sd){function sL(){this._responseType=null,this._data=null,sL.__super.call(this),this._http=new si.window.XMLHttpRequest}sr(sL,"laya.net.HttpRequest",sx);var sl=sL.prototype;return sl.send=function(sd,sL,sl,sZ,sh){void 0===sl&&(sl="get"),void 0===sZ&&(sZ="text"),this._responseType=sZ,this._data=null;var s_=this,sN=this._http;if(sN.open(sl,sd,!0),sh)for(var sm=0;sm<sh.length;sm++)sN.setRequestHeader(sh[sm++],sh[sm]);else sH.isConchApp||(sL&&"string"!=typeof sL?sN.setRequestHeader("Content-Type","application/json"):sN.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));sN.responseType="arraybuffer"!==sZ?"text":"arraybuffer",sN.onerror=function(sd){s_._onError(sd)},sN.onabort=function(sd){s_._onAbort(sd)},sN.onprogress=function(sd){s_._onProgress(sd)},sN.onload=function(sd){s_._onLoad(sd)},sN.send(sL)},sl._onProgress=function(sd){sd&&sd.lengthComputable&&this.event("progress",sd.loaded/sd.total)},sl._onAbort=function(sd){this.error("Request was aborted by user")},sl._onError=function(sd){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},sl._onLoad=function(sd){var sL=this._http,sl=void 0!==sL.status?sL.status:200;200===sl||204===sl||0===sl?this.complete():this.error("["+sL.status+"]"+sL.statusText+":"+sL.responseURL)},sl.error=function(sd){this.clear(),this.event("error",sd)},sl.complete=function(){this.clear();var sL=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=sf.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(sd){sL=!1,this.error(sd.message)}sL&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},sl.clear=function(){var sd=this._http;sd.onerror=sd.onabort=sd.onprogress=sd.onload=null},st(0,sl,"url",function(){return this._http.responseURL}),st(0,sl,"http",function(){return this._http}),st(0,sl,"data",function(){return this._data}),sL}(),smd=function(sd){function sV(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,sV.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}sr(sV,"laya.net.Loader",sx);var sL=sV.prototype;return sL.load=function(sd,sL,sl,sZ,sh){if(sd&&""!=sd||console.error("Loader 加载的url不合法 "+sd),void 0===sl&&(sl=!0),void 0===sh&&(sh=!1),0===(this._url=sd).indexOf("data:image")?this._type=sL="image":this._type=sL||(sL=this.getTypeFromUrl(sd)),this._cache=sl,this._data=null,!sh&&sV.loadedMap[sd])return this._data=sV.loadedMap[sd],this.event("progress",1),void this.event("complete",this._data);if(sZ&&sV.setGroup(sd,sZ),null!=sV.parserMap[sL])return this._customParse=!0,void(sV.parserMap[sL]instanceof laya.utils.Handler?sV.parserMap[sL].runWith(this):sV.parserMap[sL].call(null,this));if("image"===sL||"htmlimage"===sL||"nativeimage"===sL)return this._loadImage(sd);if("ttf"===sL)return this._loadTTF(sd);switch(sL){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:sL}sV.preLoadedMap[sd]?this.onLoaded(sV.preLoadedMap[sd]):sN.resMgrLoad(sd,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},sL.getTypeFromUrl=function(sd){var sL=sf.getFileExtension(sd);return sL?sV.typeMap[sL]:(console.warn("Not recognize the resources suffix",sd),"text")},sL._loadTTF=function(sd){sd=sp.formatURL(sd);var sL=new sI;sL.complete=se.create(this,this.onLoaded),sL.load(sd)},sL._loadImage=function(sd){sN.imgMgrLoad(sd,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},sL._loadImageComplete=function(sd,sL,sl){if(null!=sl)if(sl instanceof ArrayBuffer){var sZ=new DataView(sl),sh=new laya.webgl.resource.WebGLImage(new Uint8Array(sl,8),sd,0,!1,sZ.getUint32(0),sZ.getUint32(4));this.onLoaded(sh)}else if(sl instanceof std)sV.imgMgrSet[sd]=sL,sN.imgMgrLock(sd,sV.imgMgrSet[sd]),this._url=sd,this.complete(sl);else{var s_=-1!=sd.indexOf(".png",sd.length-4)?6408:6407;sh=new laya.webgl.resource.WebGLImage(sl,sd,s_,!1,sl.width,sl.height);this.onLoaded(sh)}else this.event("error","Load image failed")},sL._loadSound=function(sd){var sL=new sg._soundClass,sl=this;function sZ(){sL.offAll()}sL.on("complete",this,function(){sZ(),sl.onLoaded(sL)}),sL.on("error",this,function(){sZ(),sL.dispose(),sl.event("error","Load sound failed")}),sL.load(sd)},sL.onProgress=function(sd){"atlas"===this._type?this.event("progress",.3*sd):this.event("progress",sd)},sL.onError=function(sd){this.event("error",sd)},sL._loadedComplete=function(sd,sL,sl){if(null!=sl)switch(this._type){case"atlas":case"plf":case"json":var sZ=new sS(sl);this.onLoaded(JSON.parse(sZ.readUTFBytes()));break;case"font":sZ=new sS(sl);this.onLoaded(sf.parseXMLFromString(sZ.readUTFBytes()));break;default:this.onLoaded(sl)}else this.event("error",sd)},sL.onLoaded=function(sd){var sL=this._type;if("plf"==sL)this.parsePLFData(sd),this.complete(sd);else if("image"===sL){var sl=new std(sd);sl.url=this._url,this.complete(sl)}else if("sound"===sL||"htmlimage"===sL||"nativeimage"===sL)this.complete(sd);else if("atlas"===sL){if(!sd.src&&!sd._setContext){if(!this._data){if((this._data=sd).meta&&sd.meta.image)for(var sZ=sd.meta.image.split(","),sh=0<=this._url.indexOf("/")?"/":"\\",s_=this._url.lastIndexOf(sh),sN=0<=s_?this._url.substr(0,s_+1):"",sm=0,su=sZ.length;sm<su;sm++)sZ[sm]=sN+sZ[sm];else sZ=[this._url.replace(".json",".png")];sZ.reverse(),sd.toLoads=sZ,sd.pics=[]}return this.event("progress",.3+1/sZ.length*.6),this._loadImage(sZ.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(sd),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var sx=this._data.frames,st=this._url.split("?")[0],sb=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:st.substring(0,st.lastIndexOf("."))+"/",sq=this._data.pics,sY=sp.formatURL(this._url),sc=sV.atlasMap[sY]||(sV.atlasMap[sY]=[]);sc.dir=sb;var sr=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var sa in sr=parseFloat(this._data.meta.scale),sx){var sk,se=sx[sa],sw=sq[se.frame.idx?se.frame.idx:0],ss=sp.formatURL(sb+sa);sw.scaleRate=sr,sk=std.create(sw,se.frame.x,se.frame.y,se.frame.w,se.frame.h,se.spriteSourceSize.x,se.spriteSourceSize.y,se.sourceSize.w,se.sourceSize.h),sV.cacheRes(ss,sk),sV.keepCache(this._url,sb+sa),sk.url=ss,sc.push(ss)}else for(sa in sx)sw=sq[(se=sx[sa]).frame.idx?se.frame.idx:0],ss=sp.formatURL(sb+sa),sV.cacheRes(ss,std.create(sw,se.frame.x,se.frame.y,se.frame.w,se.frame.h,se.spriteSourceSize.x,se.spriteSourceSize.y,se.sourceSize.w,se.sourceSize.h)),sV.loadedMap[ss].url=ss,sV.keepCache(this._url,sb+sa),sc.push(ss);delete this._data.pics,this.complete(this._data)}else if("font"==sL){if(!sd.src)return this._data=sd,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var sA=new sQ;sA.parseFont(this._data,sd);var sy=this._url.split(".fnt")[0].split("/"),s$=sy[sy.length-1];sad.registerBitmapFont(s$,sA),this._data=sA,this.complete(this._data)}else if("pkm"==sL){var sO=syd.create(sd,this._url),sn=new std(sO);sn.url=this._url,this.complete(sn)}else this.complete(sd)},sL.parsePLFData=function(sd){var sL,sl,sZ;for(sL in sd)switch(sZ=sd[sL],sL){case"json":case"text":for(sl in sZ)sV.preLoadedMap[sp.formatURL(sl)]=sZ[sl];break;default:for(sl in sZ)sV.preLoadedMap[sp.formatURL(sl)]=sZ[sl]}},sL.complete=function(sd){this._data=sd,this._customParse?this.event("loaded",sd instanceof Array?[sd]:sd):(sV._loaders.push(this),sV._isWorking||sV.checkNext())},sL.endLoad=function(sd){sd&&(this._data=sd),this._cache&&sV.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},st(0,sL,"url",function(){return this._url}),st(0,sL,"data",function(){return this._data}),st(0,sL,"cache",function(){return this._cache}),st(0,sL,"type",function(){return this._type}),sV.checkNext=function(){sV._isWorking=!0;for(var sd=si.now();sV._startIndex<sV._loaders.length;)if(si.now(),sV._loaders[sV._startIndex].endLoad(),sV._startIndex++,si.now()-sd>sV.maxTimeOut)return console.warn("loader callback cost a long time:"+(si.now()-sd)+" url="+sV._loaders[sV._startIndex-1].url),void s$.timer.frameOnce(1,null,sV.checkNext);sV._loaders.length=0,sV._startIndex=0,sV._isWorking=!1},sV.clearRes=function(sd,sL){if(null!=sd){void 0===sL&&(sL=!1),sd=sp.formatURL(sd);var sl=sV.getAtlas(sd);if(sl){for(var sZ=0,sh=sl.length;sZ<sh;sZ++){var s_=sl[sZ],sN=sV.getRes(s_);delete sV.loadedMap[s_],sV.clearCache(sd.substring(sp.basePath.length),s_.substring(sp.basePath.length)),sN&&sN.destroy(sL)}sl.length=0,delete sV.atlasMap[sd],delete sV.loadedMap[sd]}else{var sm=sV.loadedMap[sd];sm&&(delete sV.loadedMap[sd],sm instanceof laya.resource.Texture&&sm.bitmap&&sm.destroy(sL))}}},sV.clearTextureRes=function(sd){sd=sp.formatURL(sd);var sL=laya.net.Loader.getAtlas(sd),sl=sL&&0<sL.length?laya.net.Loader.getRes(sL[0]):laya.net.Loader.getRes(sd);sl&&sl.bitmap&&(sH.isConchApp&&!sH.isConchWebGL?sl.bitmap.source.releaseTexture&&sl.bitmap.source.releaseTexture():null==sl.bitmap._atlaser&&sl.bitmap.releaseResource(!0))},sV.getRes=function(sd){return sV.loadedMap[sp.formatURL(sd)]},sV.getAtlas=function(sd){return sV.atlasMap[sp.formatURL(sd)]},sV.cacheRes=function(sd,sL){sd=sp.formatURL(sd),null!=sV.loadedMap[sd]?console.warn("Resources already exist,is repeated loading:",sd):sV.loadedMap[sd]=sL},sV.setGroup=function(sd,sL){sV.groupMap[sL]||(sV.groupMap[sL]=[]),sV.groupMap[sL].push(sd)},sV.clearResByGroup=function(sd){if(sV.groupMap[sd]){var sL=sV.groupMap[sd],sl=0,sZ=sL.length;for(sl=0;sl<sZ;sl++)sV.clearRes(sL[sl]);sL.length=0}},sV.keepCache=function(sd,sL){if(sd&&sL){var sl=sV.cacheSet[sL];sl?-1==sl.indexOf(sd)&&sl.push(sd):sV.cacheSet[sL]=[sd]}},sV.clearCache=function(sd,sL){if(sd&&sL){var sl=sV.cacheSet[sL];if(sl){var sZ=sl.indexOf(sd);if(-1!==sZ){var sh=sl.length-1;0==sh?(delete sV.cacheSet[sL],0<sV.imgMgrSet[sL]?sN.imgMgrFree(sL,sV.imgMgrSet[sL]):sV.clearRes(sL,!0)):(sl[sZ]=sl[sh],sl.length=sh)}}}},sV.saveObject=function(sd,sL,sl){if(sL&&sd){var sZ=sV.objectSet[sd];sZ?(console.warn("Loader.saveObject: "+sd),sZ[0]=sL,sZ[1]=sl):sV.objectSet[sd]=[sL,sl,[]]}},sV.findObject=function(sd){if(sd){var sL=sV.objectSet[sd];if(sL)return sL[0]}return null},sV.keepObject=function(sd,sL){if(sd&&sL){var sl=sV.objectSet[sL];sl&&-1===sl[2].indexOf(sd)&&sl[2].push(sd)}},sV.clearObject=function(sd,sL){if(sd&&sL){var sl=sV.objectSet[sL];if(sl){var sZ=sl[2],sh=sZ.indexOf(sd);if(-1!==sh){var s_=sZ.length-1;0==s_?(delete sV.objectSet[sL],sl[1]&&sl[1].call(null,sl[0])):(sZ[sh]=sZ[s_],sZ.length=s_)}}}},sV.TEXT="text",sV.JSON="json",sV.XML="xml",sV.BUFFER="arraybuffer",sV.IMAGE="image",sV.SOUND="sound",sV.ATLAS="atlas",sV.FONT="font",sV.TTF="ttf",sV.PLF="plf",sV.PKM="pkm",sV.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},sV.parserMap={},sV.groupMap={},sV.maxTimeOut=100,sV.loadedMap={},sV.preLoadedMap={},sV.atlasMap={},sV._loaders=[],sV._isWorking=!1,sV._startIndex=0,sV.imgCache={},sV.cacheSet={},sV.objectSet={},sV.imgMgrSet={},sV}(),sud=function(sd){var sq;function sY(){this.retryNum=3,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},sY.__super.call(this);for(var sd=0;sd<this._maxPriority;sd++)this._resInfos[sd]=[]}sr(sY,"laya.net.LoaderManager",sx);var sL=sY.prototype;return sL.create=function(sd,sl,sL,sZ,sh,s_,sN,sm){if(null==s_&&(s_=2),null==sN&&(sN=!0),sd instanceof Array){var su=sd,sx=su.length,st=0;if(sL)var sb=se.create(sL.caller,sL.method,sL.args,!1);for(var sq=0;sq<sx;sq++){var sY=su[sq];"string"==typeof sY&&(sY=su[sq]={url:sY}),sY.progress=0}for(sq=0;sq<sx;sq++){sY=su[sq];var sc=sL?se.create(null,sk,[sY],!1):null,sr=sL||sl?se.create(null,sa,[sY]):null;this._create(sY.url,sr,sc,sY.clas||sZ,sY.params||sh,null!=sY.priority&&0<=sY.priority?sY.priority:s_,sN,sY.group||sm)}function sa(sd,sL){st++,sd.progress=1,st===sx&&sl&&sl.run()}function sk(sd,sL){sd.progress=sL;for(var sl=0,sZ=0;sZ<sx;sZ++){sl+=su[sZ].progress}var sh=sl/sx;sb.runWith(sh)}return!0}return this._create(sd,sl,sL,sZ,sh,s_,sN,sm)},sL._create=function(sL,sl,sd,sZ,sh,s_,sN,sm){sL&&""!=sL||console.error("加载的url不合法 "+sL),null==s_&&(s_=2),null==sN&&(sN=!0);var su=sp.formatURL(sL),sx=this.getRes(su);if(sx)!sx.hasOwnProperty("loaded")||sx.loaded?(sd&&sd.runWith(1),sl&&sl.run()):sl&&s$.loader._createListener(sL,sl.caller,sl.method,sl.args,!0,!1);else{var st=sf.getFileExtension(sL),sb=sY.createMap[st];if(!sb)throw new Error("LoaderManager:unknown file("+sL+") extension with: "+st+".");sZ||(sZ=sb[0]);var sq=sb[1];if("atlas"==st)this.load(sL,sl,sd,sq,s_,sN);else{sZ===std&&(sq="htmlimage"),(sx=sZ?new sZ:null).hasOwnProperty("_loaded")&&(sx._loaded=!1),sx._setUrl(sL),sm&&sx._setGroup(sm),this._createLoad(sx,sL,se.create(null,function(sd){sx&&!sx.destroyed&&sd&&sx.onAsynLoaded.call(sx,sL,sd,sh),sl&&sl.run();s$.loader.event(sL)}),sd,sq,s_,!1,sm,!0),sN&&this.cacheRes(su,sx)}}return sx},sL.load=function(sd,sL,sl,sZ,sh,s_,sN,sm){sd&&""!=sd||console.error("加载的url不合法 "+sd);var su=this;if(null==sh&&(sh=2),null==s_&&(s_=!0),void 0===sm&&(sm=!1),sd instanceof Array)return this._loadAssets(sd,sL,sl,sZ,sh,s_,sN);var sx=smd.getRes(sd);if(null!=sx)s$.timer.frameOnce(1,null,function(){sl&&sl.runWith(1),sL&&sL.runWith(sx),su._loaderCount||su.event("complete")});else{var st=sY._resMap[sd];st?(sL&&st._createListener("complete",sL.caller,sL.method,sL.args,!1,!1),sl&&st._createListener("progress",sl.caller,sl.method,sl.args,!1,!1)):((st=this._infoPool.length?this._infoPool.pop():new sq).url=sd,st.type=sZ,st.cache=s_,st.group=sN,st.ignoreCache=sm,st.priority=sh,sL&&st.on("complete",sL.caller,sL.method,sL.args),sl&&st.on("progress",sl.caller,sl.method,sl.args),sY._resMap[sd]=st,sh=sh<this._maxPriority?0<=sh?sh:0:this._maxPriority-1,this._resInfos[sh].push(st),this._next())}return this},sL._createLoad=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){var sx=this;if(null==s_&&(s_=2),null==sN&&(sN=!0),void 0===su&&(su=!1),sL instanceof Array)return this._loadAssets(sL,sl,sZ,sh,s_,sN,sm);var st=smd.getRes(sL);if(null!=st)s$.timer.frameOnce(1,null,function(){sZ&&sZ.runWith(1),sl&&sl.runWith(st),sx._loaderCount||sx.event("complete")});else{var sb=sY._resMap[sL];sb?(sl&&sb._createListener("complete",sl.caller,sl.method,sl.args,!1,!1),sZ&&sb._createListener("progress",sZ.caller,sZ.method,sZ.args,!1,!1)):((sb=this._infoPool.length?this._infoPool.pop():new sq).url=sL,sb.clas=sd,sb.type=sh,sb.cache=sN,sb.group=sm,sb.ignoreCache=su,sb.priority=s_,sl&&sb.on("complete",sl.caller,sl.method,sl.args),sZ&&sb.on("progress",sZ.caller,sZ.method,sZ.args),sY._resMap[sL]=sb,s_=s_<this._maxPriority?0<=s_?s_:0:this._maxPriority-1,this._resInfos[s_].push(sb),this._next())}return this},sL._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var sd=0;sd<this._maxPriority;sd++)for(var sL=this._resInfos[sd];0<sL.length;){var sl=sL.shift();if(sl)return this._doLoad(sl)}this._loaderCount||this.event("complete")}},sL._doLoad=function(sL){this._loaderCount++;var sl=this._loaders.length?this._loaders.pop():new smd;sl.on("complete",null,sh),sl.on("progress",null,function(sd){sL.event("progress",sd)}),sl.on("error",null,function(sd){sh(null)});var sZ=this;function sh(sd){sl.offAll(),sl._data=null,sl._customParse=!1,sZ._loaders.push(sl),sZ._endLoad(sL,sd instanceof Array?[sd]:sd),sZ._loaderCount--,sZ._next()}sl._class=sL.clas,1<=sL.priority?(sl.priority=sL.priority,sl.realTime=!1):(sl.priority=0,sl.realTime=!0),sl.load(sL.url,sL.type,sL.cache,sL.group,sL.ignoreCache)},sL._endLoad=function(sd,sL){var sl=sd.url;if(null==sL){var sZ=this._failRes[sl]||0;if(sZ<this.retryNum)return console.warn("[warn]Retry to load:",sl),this._failRes[sl]=sZ+1,void s$.timer.once(this.retryDelay,this,this._addReTry,[sd],!1);console.warn("[error]Failed to load:",sl),this.event("error",sl)}this._failRes[sl]&&(this._failRes[sl]=0),delete sY._resMap[sl],sd.event("complete",sL),sd.offAll(),this._infoPool.push(sd)},sL._addReTry=function(sd){this._resInfos[this._maxPriority-1].push(sd),this._next()},sL.clearRes=function(sd,sL){void 0===sL&&(sL=!1),smd.clearRes(sd,sL)},sL.getRes=function(sd){return smd.getRes(sd)},sL.cacheRes=function(sd,sL){smd.cacheRes(sd,sL)},sL.clearTextureRes=function(sd){smd.clearTextureRes(sd)},sL.setGroup=function(sd,sL){smd.setGroup(sd,sL)},sL.clearResByGroup=function(sd){smd.clearResByGroup(sd)},sL.clearUnLoaded=function(){for(var sd=0;sd<this._maxPriority;sd++){for(var sL=this._resInfos[sd],sl=sL.length-1;-1<sl;sl--){var sZ=sL[sl];sZ&&(sZ.offAll(),this._infoPool.push(sZ))}sL.length=0}this._loaderCount=0,sY._resMap={}},sL.cancelLoadByUrls=function(sd){if(sd)for(var sL=0,sl=sd.length;sL<sl;sL++)this.cancelLoadByUrl(sd[sL])},sL.cancelLoadByUrl=function(sd){for(var sL=0;sL<this._maxPriority;sL++)for(var sl=this._resInfos[sL],sZ=sl.length-1;-1<sZ;sZ--){var sh=sl[sZ];sh&&sh.url===sd&&(sl[sZ]=null,sh.offAll(),this._infoPool.push(sh))}sY._resMap[sd]&&delete sY._resMap[sd]},sL._loadAssets=function(sd,sl,sN,sL,sZ,sh,s_){null==sZ&&(sZ=2),null==sh&&(sh=!0);for(var sm=sd.length,su=0,sx=0,st=[],sb=!0,sq=0;sq<sm;sq++){var sY=sd[sq];if(!sY)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+sd);"string"==typeof sY&&(sY={url:sY,type:sL,size:1,priority:sZ}),sY.size||(sY.size=1),sY.progress=0,sx+=sY.size,st.push(sY);var sc=sN?se.create(null,sk,[sY],!1):null,sr=sl||sN?se.create(null,sa,[sY]):null;this.load(sY.url,sr,sc,sY.type,null!=sY.priority&&0<=sY.priority?sY.priority:2,sh,sY.group||s_)}function sa(sd,sL){su++,sd.progress=1,sL||(sb=!1),su===sm&&sl&&sl.runWith(sb)}function sk(sd,sL){if(null!=sN){sd.progress=sL;for(var sl=0,sZ=0;sZ<st.length;sZ++){var sh=st[sZ];sl+=sh.size*sh.progress}var s_=sl/sx;sN.runWith(s_)}}return this},sY.cacheRes=function(sd,sL){smd.cacheRes(sd,sL)},sY._resMap={},su(sY,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),sY.__init$=function(){sq=function(sd){function sL(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.priority=-1,sL.__super.call(this)}return sr(sL,"",sx),sL}()},sY}(),sxd=(function(sd){function sh(sd){sh.__super.call(this),sd||(sd=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var sL=0,sl=0,sZ=0;sZ<20;sZ++)sZ%5!=4?this._mat[sL++]=sd[sZ]:this._alpha[sl++]=sd[sZ];this._action=sF.createFilterAction(32),this._action.data=this}sr(sh,"laya.filters.ColorFilter",sk);var sL=sh.prototype;s$.imps(sL,{"laya.filters.IFilter":!0}),sL.callNative=function(sd){sd._$P.cf=this;sd.conchModel&&sd.conchModel.setFilterMatrix&&sd.conchModel.setFilterMatrix(this._mat,this._alpha)},st(0,sL,"type",function(){return 32}),st(0,sL,"action",function(){return this._action})}(),function(sd){function sZ(sd,sL,sl){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===sL&&(sL=0),sZ.__super.call(this),this._byteClass=sl||sS,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,sd&&0<sL&&sL<65535&&this.connect(sd,sL)}sr(sZ,"laya.net.Socket",sx);var sL=sZ.prototype;sL.connect=function(sd,sL){var sl="ws://"+sd+":"+sL;sl="https:"==si.window.location.protocol?"wss://"+sd+":"+sL:"ws://"+sd+":"+sL,this.connectByUrl(sl)},sL.connectByUrl=function(sd){var sL=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new si.window.WebSocket(sd,this.protocols):this._socket=new si.window.WebSocket(sd),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(sd){sL._onOpen(sd)},this._socket.onmessage=function(sd){sL._onMessage(sd)},this._socket.onclose=function(sd){sL._onClose(sd)},this._socket.onerror=function(sd){sL._onError(sd)}},sL.cleanSocket=function(){try{this._socket.close()}catch(sd){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},sL.close=function(){if(null!=this._socket)try{this._socket.close()}catch(sd){}},sL._onOpen=function(sd){this._connected=!0,this.event("open",sd)},sL._onMessage=function(sd){if(sd&&sd.data){var sL=sd.data;if(this.disableInput&&sL)this.event("message",sL);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var sl=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,sL&&("string"==typeof sL?this._input.writeUTFBytes(sL):this._input.writeArrayBuffer(sL),this._addInputPosition=this._input.pos,this._input.pos=sl),this.event("message",sL)}}},sL._onClose=function(sd){this._connected=!1,this.event("close",sd)},sL._onError=function(sd){this.event("error",sd)},sL.send=function(sd){this._socket.send(sd)},sL.flush=function(){if(this._output&&0<this._output.length){var sL;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(sd){sL=sd}this._output.endian=this.endian,this._output.clear(),sL&&this.event("error",sL)}},st(0,sL,"input",function(){return this._input}),st(0,sL,"output",function(){return this._output}),st(0,sL,"connected",function(){return this._connected}),st(0,sL,"endian",function(){return this._endian},function(sd){this._endian=sd,null!=this._input&&(this._input.endian=sd),null!=this._output&&(this._output.endian=sd)}),sZ.LITTLE_ENDIAN="littleEndian",sZ.BIG_ENDIAN="bigEndian"}(),function(sd){function sm(){sm.__super.call(this),this._$1__id=++sm._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(sm._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,so.currentResourceManager&&so.currentResourceManager.addResource(this)}sr(sm,"laya.resource.Resource",sx);var sL=sm.prototype;return s$.imps(sL,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),sL._setUrl=function(sd){var sL;this._url!==sd&&(this._url&&((sL=sm._urlResourcesMap[this._url]).splice(sL.indexOf(this),1),0===sL.length&&delete sm._urlResourcesMap[this._url]),sd&&((sL=sm._urlResourcesMap[sd])||(sm._urlResourcesMap[sd]=sL=[]),sL.push(this)),this._url=sd)},sL._getGroup=function(){return this._group},sL._setGroup=function(sd){var sL;this._group!==sd&&(this._group&&((sL=sm._groupResourcesMap[this._group]).splice(sL.indexOf(this),1),0===sL.length&&delete sm._groupResourcesMap[this._group]),sd&&((sL=sm._groupResourcesMap[sd])||(sm._groupResourcesMap[sd]=sL=[]),sL.push(this)),this._group=sd)},sL._addReference=function(){this._referenceCount++},sL._removeReference=function(){this._referenceCount--},sL._clearReference=function(){this._referenceCount=0},sL._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},sL.recreateResource=function(){this.completeCreate()},sL.disposeResource=function(){},sL.activeResource=function(sd){void 0===sd&&(sd=!1),this._lastUseFrameCount=sK.loopCount,!this._destroyed&&this.__loaded&&(this._released||sd)&&this.recreateResource()},sL.releaseResource=function(sd){return void 0===sd&&(sd=!0),!(!sd&&this.lock)&&(!(this._released&&!sd)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},sL.onAsynLoaded=function(sd,sL,sl){throw new Error("Resource: must override this function!")},sL.destroy=function(){var sd;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete sm._idResourcesMap[this.id],this._url&&((sd=sm._urlResourcesMap[this._url])&&(sd.splice(sd.indexOf(this),1),0===sd.length&&delete sm._urlResourcesMap[this.url]),smd.clearRes(this._url),this.__loaded||sF.cancelLoadByUrl(this._url)),this._group&&((sd=sm._groupResourcesMap[this._group]).splice(sd.indexOf(this),1),0===sd.length&&delete sm._groupResourcesMap[this.url]))},sL.completeCreate=function(){this._released=!1,this.event("recovered",this)},sL.dispose=function(){this.destroy()},st(0,sL,"memorySize",function(){return this._memorySize},function(sd){var sL=sd-this._memorySize;this._memorySize=sd,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,sL),this.resourceManager&&this.resourceManager.addSize(sL)}),st(0,sL,"_loaded",null,function(sd){this.__loaded=sd}),st(0,sL,"loaded",function(){return this.__loaded}),st(0,sL,"id",function(){return this._$1__id}),st(0,sL,"destroyed",function(){return this._destroyed}),st(0,sL,"group",function(){return this._getGroup()},function(sd){this._setGroup(sd)}),st(0,sL,"resourceManager",function(){return this._resourceManager}),st(0,sL,"url",function(){return this._url}),st(0,sL,"released",function(){return this._released}),st(0,sL,"referenceCount",function(){return this._referenceCount}),sm.getResourceByID=function(sd){return sm._idResourcesMap[sd]},sm.getResourceByURL=function(sd,sL){return void 0===sL&&(sL=0),null==sm._urlResourcesMap[sd]?null:sm._urlResourcesMap[sd][sL]},sm.getResourceCountByURL=function(sd){return sm._urlResourcesMap[sd].length},sm.destroyUnusedResources=function(sd){var sL;if(sd){var sl=sm._groupResourcesMap[sd];if(sl)for(var sZ=sl.slice(),sh=0,s_=sZ.length;sh<s_;sh++)(sL=sZ[sh]).lock||0!==sL._referenceCount||sL.destroy()}else for(var sN in sm._idResourcesMap)(sL=sm._idResourcesMap[sN]).lock||0!==sL._referenceCount||sL.destroy()},sm._uniqueIDCounter=0,sm._idResourcesMap={},sm._urlResourcesMap={},sm._groupResourcesMap={},sm}()),std=function(sd){function sV(sd,sL){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,sV.__super.call(this),sd&&null!=sd._addReference&&sd._addReference(),this.setTo(sd,sL)}sr(sV,"laya.resource.Texture",sx);var sL=sV.prototype;return sL._setUrl=function(sd){this.url=sd},sL.setTo=function(sd,sL){if(sd instanceof sN.HTMLElement){var sl=swd.create("2D",sd);this.bitmap=sl}else this.bitmap=sd;if(this.uv=sL||sV.DEF_UV,sd){this._w=sd.width,this._h=sd.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var sZ=this;if(this._loaded)sF.addToAtlas&&sF.addToAtlas(sZ);else{var sh=sd;sh instanceof laya.resource.HTMLImage&&sh.image&&sh.image.addEventListener("load",function(sd){sF.addToAtlas&&sF.addToAtlas(sZ)},!1)}}},sL.active=function(){this.bitmap&&this.bitmap.activeResource()},sL.destroy=function(sd){if(void 0===sd&&(sd=!1),this.alphaTexture&&(this.alphaTexture.destroy(sd),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var sL=this.bitmap;sd?(sH.isConchApp&&sL.source&&sL.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,sL.dispose(),sL._clearReference()):(sL._removeReference(),0==sL.referenceCount&&(sH.isConchApp&&sL.source&&sL.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,sL.dispose())),this.url&&this===s$.loader.getRes(this.url)&&s$.loader.clearRes(this.url,sd),this._loaded=!1}},sL.load=function(sd){var sL=this;this._loaded=!1,sd=sp.customFormat(sd);var sl=this.bitmap||(this.bitmap=syd.create(sd));sl.uri=sd,sl&&sl._addReference();var sZ=this;sl.onload=function(){sl.onload=null,sZ._loaded=!0,sL.sourceWidth=sL._w=sl.width,sL.sourceHeight=sL._h=sl.height,sZ.event("loaded",this),sF.addToAtlas&&sF.addToAtlas(sZ)}},sL.addTextureToAtlas=function(sd){sF.addTextureToAtlas(this)},sL.getPixels=function(sd,sL,sl,sZ){if(sH.isConchApp){var sh=this.bitmap;if(sh.source&&sh.source.getImageData){var s_=sh.source.getImageData(sd,sL,sl,sZ),sN=new Uint8Array(s_);return Array.from(sN)}return null}return sH.isWebGL?sF.getTexturePixels(this,sd,sL,sl,sZ):(si.canvas.size(sl,sZ),si.canvas.clear(),si.context.drawTexture(this,-sd,-sL,this.width,this.height,0,0),si.context.getImageData(0,0,sl,sZ).data)},sL.onAsynLoaded=function(sd,sL){if(sL){if("function"!=typeof sL._addReference)throw new Error("bitmap._addReference is not a function. "+sL.className+" "+typeof sL._addReference+" "+sL.constructor);sL._addReference()}this.setTo(sL,this.uv),this._loaded&&this.event("loaded",this)},st(0,sL,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),st(0,sL,"loaded",function(){return this._loaded}),st(0,sL,"released",function(){return!this.bitmap||this.bitmap.released}),st(0,sL,"width",function(){return this._w?this._w:this.uv&&this.uv!==sV.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(sd){this._w=sd,this.sourceWidth||(this.sourceWidth=sd)}),st(0,sL,"repeat",function(){return!sH.isWebGL||!this.bitmap||this.bitmap.repeat},function(sd){sd&&sH.isWebGL&&this.bitmap&&(this.bitmap.repeat=sd)&&(this.bitmap.enableMerageInAtlas=!1)}),st(0,sL,"height",function(){return this._h?this._h:this.uv&&this.uv!==sV.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(sd){this._h=sd,this.sourceHeight||(this.sourceHeight=sd)}),st(0,sL,"isLinearSampling",function(){return!sH.isWebGL||9728!=this.bitmap.minFifter},function(sd){!sd&&sH.isWebGL&&(sd||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),sV.moveUV=function(sd,sL,sl){for(var sZ=0;sZ<8;sZ+=2)sl[sZ]+=sd,sl[sZ+1]+=sL;return sl},sV.create=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){void 0===s_&&(s_=0),void 0===sN&&(sN=0),void 0===sm&&(sm=0),void 0===su&&(su=0);var sx=sd instanceof laya.resource.Texture,st=sx?sd.uv:sV.DEF_UV,sb=sx?sd.bitmap:sd,sq=sF.isAtlas(sb);if(sq){var sY=sb._atlaser,sc=sd._atlasID;if(-1==sc)throw new Error("create texture error");sb=sY._inAtlasTextureBitmapValue[sc],st=sY._inAtlasTextureOriUVValue[sc]}var sr=new sV(sb,null);sb.width&&sL+sZ>sb.width&&(sZ=sb.width-sL),sb.height&&sl+sh>sb.height&&(sh=sb.height-sl),sr.width=sZ,sr.height=sh,sr.offsetX=s_,sr.offsetY=sN,sr.sourceWidth=sm||sZ,sr.sourceHeight=su||sh;var sa=1/sb.width,sk=1/sb.height;sL*=sa,sl*=sk,sZ*=sa,sh*=sk;var se=sr.uv[0],sw=sr.uv[1],ss=sr.uv[4],sA=sr.uv[5],sy=ss-se,s$=sA-sw,sO=sV.moveUV(st[0],st[1],[sL,sl,sL+sZ,sl,sL+sZ,sl+sh,sL,sl+sh]);sr.uv=[se+sO[0]*sy,sw+sO[1]*s$,ss-(1-sO[2])*sy,sw+sO[3]*s$,ss-(1-sO[4])*sy,sA-(1-sO[5])*s$,se+sO[6]*sy,sA-(1-sO[7])*s$],sq&&sr.addTextureToAtlas();var sn=sb.scaleRate;return sn&&1!=sn?(sr.sourceWidth/=sn,sr.sourceHeight/=sn,sr.width/=sn,sr.height/=sn,sr.scaleRate=sn,sr.offsetX/=sn,sr.offsetY/=sn):sr.scaleRate=1,sr},sV.createFromTexture=function(sd,sL,sl,sZ,sh){var s_=sd.scaleRate;1!=s_&&(sL*=s_,sl*=s_,sZ*=s_,sh*=s_);var sN=sn.TEMP.setTo(sL-sd.offsetX,sl-sd.offsetY,sZ,sh),sm=sN.intersection(sV._rect1.setTo(0,0,sd.width,sd.height),sV._rect2);if(!sm)return null;var su=sV.create(sd,sm.x,sm.y,sm.width,sm.height,sm.x-sN.x,sm.y-sN.y,sZ,sh);if(su.bitmap&&su.bitmap._removeReference)return su.bitmap._removeReference(),su;var sx="bitmap:"+(su.bitmap?su.bitmap.constructor?su.bitmap.constructor.name:su.bitmap.__className:"")+", url:"+(sd.url+" | "+(su.bitmap?su.bitmap.url:sd.url))+", x="+sL+",y="+sl+",width="+sZ+",height="+sh+", result="+(sm?sm.x+","+sm.y+","+sm.width+","+sm.height:"null")+", rect="+sN.x+","+sN.y+","+sN.width+","+sN.height;throw new Error("报错：bitmap._removeReference is not a function  "+sx)},sV.DEF_UV=[0,0,1,0,1,1,0,1],sV.INV_UV=[0,1,1,1,1,0,0,0],sV._rect1=new sn,sV._rect2=new sn,sV}(),sd=function(sd){var sm;function s_(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,s_.__super.call(this)}sr(s_,"laya.utils.TimeLine",sx);var sL=s_.prototype;return sL.to=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=0),this._create(sd,sL,sl,sZ,sh,!0)},sL.from=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=0),this._create(sd,sL,sl,sZ,sh,!1)},sL._create=function(sd,sL,sl,sZ,sh,s_){var sN=sG.getItemByClass("tweenData",sm);return sN.isTo=s_,sN.type=0,sN.target=sd,sN.duration=sl,sN.data=sL,sN.startTime=this._startTime+sh,sN.endTime=sN.startTime+sN.duration,sN.ease=sZ,this._startTime=Math.max(sN.endTime,this._startTime),this._tweenDataList.push(sN),this._startTimeSort=!0,this._endTimeSort=!0,this},sL.addLabel=function(sd,sL){var sl=sG.getItemByClass("tweenData",sm);return sl.type=1,sl.data=sd,sl.endTime=sl.startTime=this._startTime+sL,this._labelDic||(this._labelDic={}),this._labelDic[sd]=sl,this._tweenDataList.push(sl),this},sL.removeLabel=function(sd){if(this._labelDic&&this._labelDic[sd]){var sL=this._labelDic[sd];if(sL){var sl=this._tweenDataList.indexOf(sL);-1<sl&&this._tweenDataList.splice(sl,1)}delete this._labelDic[sd]}},sL.gotoTime=function(sd){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var sL,sl,sZ,sh;for(var s_ in this._firstTweenDic)if(sl=this._firstTweenDic[s_])for(var sN in sl)sl.diyTarget.hasOwnProperty(sN)&&(sl.diyTarget[sN]=sl[sN]);for(s_ in this._tweenDic)(sL=this._tweenDic[s_]).clear(),delete this._tweenDic[s_];if(this._index=0,this._gidIndex=0,this._currTime=sd,this._lastTime=si.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=sZ=this._tweenDataList.concat(),sZ.sort(function(sd,sL){return sd.endTime>sL.endTime?1:sd.endTime<sL.endTime?-1:0})}else sZ=this._endTweenDataList;for(var sm=0,su=sZ.length;sm<su;sm++)if(0==(sh=sZ[sm]).type){if(!(sd>=sh.endTime))break;this._index=Math.max(this._index,sm+1);var sx=sh.data;if(sh.isTo)for(var st in sx)sh.target[st]=sx[st]}for(sm=0,su=this._tweenDataList.length;sm<su;sm++)0==(sh=this._tweenDataList[sm]).type&&sd>=sh.startTime&&sd<sh.endTime&&(this._index=Math.max(this._index,sm+1),this._gidIndex++,(sL=sG.getItemByClass("tween",sJ))._create(sh.target,sh.data,sh.duration,sh.ease,se.create(this,this._animComplete,[this._gidIndex]),0,!1,sh.isTo,!0,!1),sL.setStartTime(this._currTime-(sd-sh.startTime)),sL._updateEase(this._currTime),sL.gid=this._gidIndex,this._tweenDic[this._gidIndex]=sL)}},sL.gotoLabel=function(sd){if(null!=this._labelDic){var sL=this._labelDic[sd];sL&&this.gotoTime(sL.startTime)}},sL.pause=function(){s$.timer.clear(this,this._update)},sL.resume=function(){this.play(this._currTime,this._loopKey)},sL.play=function(sd,sL){if(void 0===sd&&(sd=0),void 0===sL&&(sL=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(sd,sL){return sd.startTime>sL.startTime?1:sd.startTime<sL.startTime?-1:0});for(var sl=0,sZ=this._tweenDataList.length;sl<sZ;sl++){var sh=this._tweenDataList[sl];if(null!=sh&&0==sh.type){var s_=sh.target,sN=s_.$_GID||(s_.$_GID=sf.getGID()),sm=null;for(var su in null==this._firstTweenDic[sN]?((sm={}).diyTarget=s_,this._firstTweenDic[sN]=sm):sm=this._firstTweenDic[sN],sh.data)null==sm[su]&&(sm[su]=s_[su])}}}"string"==typeof sd?this.gotoLabel(sd):this.gotoTime(sd),this._loopKey=sL,this._lastTime=si.now(),s$.timer.frameLoop(1,this,this._update)}},sL._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var sd in this._tweenDic)(sL=this._tweenDic[sd]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var sL,sl=si.now(),sZ=sl-this._lastTime,sh=this._currTime+=sZ*this.scale;for(sd in this._lastTime=sl,this._tweenDic)(sL=this._tweenDic[sd])._updateEase(sh);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var s_=this._tweenDataList[this._index];sh>=s_.startTime&&(this._index++,0==s_.type?(this._gidIndex++,(sL=sG.getItemByClass("tween",sJ))._create(s_.target,s_.data,s_.duration,s_.ease,se.create(this,this._animComplete,[this._gidIndex]),0,!1,s_.isTo,!0,!1),sL.setStartTime(sh),sL.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=sL)._updateEase(sh)):this.event("label",s_.data))}},sL._animComplete=function(sd){this._tweenDic[sd]&&delete this._tweenDic[sd]},sL._complete=function(){this.event("complete")},sL.reset=function(){var sd;if(this._labelDic)for(sd in this._labelDic)delete this._labelDic[sd];for(sd in this._tweenDic)this._tweenDic[sd].clear(),delete this._tweenDic[sd];for(sd in this._firstTweenDic)delete this._firstTweenDic[sd];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var sL,sl=0;for(sL=this._tweenDataList.length,sl=0;sl<sL;sl++)this._tweenDataList[sl]&&this._tweenDataList[sl].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,s$.timer.clear(this,this._update)},sL.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},st(0,sL,"index",function(){return this._frameIndex},function(sd){this._frameIndex=sd,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),st(0,sL,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),s_.to=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=0),(new s_).to(sd,sL,sl,sZ,sh)},s_.from=function(sd,sL,sl,sZ,sh){return void 0===sh&&(sh=0),(new s_).from(sd,sL,sl,sZ,sh)},s_.__init$=function(){sm=function(){function sd(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return sr(sd,""),sd.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,sG.recover("tweenData",this)},sd}()},s_}(),sbd=function(sh){function sl(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,sl.__super.call(this),this._style=sm.EMPTY}sr(sl,"laya.display.Sprite",sh);var sd=sl.prototype;return s$.imps(sd,{"laya.display.ILayout":!0}),sd.createConchModel=function(){return new ConchNode},sd.destroy=function(sd){if(void 0===sd&&(sd=!0),this._releaseMem(),!this._destroyed){this.filters=null;var sL=this.mask;sL&&(this.mask=null,sL.destroy(sd))}sh.prototype.destroy.call(this,sd),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},sd.updateZOrder=function(){sf.updateOrder(this._childs)&&this.repaint()},sd.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},sd.setBounds=function(sd){this._set$P("uBounds",sd)},sd.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new sn),sn._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},sd.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new sn),sn._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},sd._boundPointsToParent=function(sd){void 0===sd&&(sd=!1);var sL=0,sl=0;this._style&&(sL=this._style._tf.translateX,sl=this._style._tf.translateY,sd=sd||0!==this._style._tf.rotate,this._style.scrollRect&&(sL+=this._style.scrollRect.x,sl+=this._style.scrollRect.y));var sZ=this._getBoundPointsM(sd);if(!sZ||sZ.length<1)return sZ;if(8!=sZ.length&&(sZ=sd?sA.scanPList(sZ):sn._getWrapRec(sZ,sn.TEMP)._getBoundPoints()),!this.transform)return sf.transPointList(sZ,this._x-sL,this._y-sl),sZ;var sh=sO.TEMP,s_=0,sN=sZ.length;for(s_=0;s_<sN;s_+=2)sh.x=sZ[s_],sh.y=sZ[s_+1],this.toParentPoint(sh),sZ[s_]=sh.x,sZ[s_+1]=sh.y;return sZ},sd.getGraphicBounds=function(sd){return void 0===sd&&(sd=!1),this._graphics?this._graphics.getBounds(sd):sn.TEMP.setTo(0,0,0,0)},sd._getBoundPointsM=function(sd){if(void 0===sd&&(sd=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var sL=sf.clearArray(this._$P.temBM),sl=sn.TEMP;return sl.copyFrom(this.scrollRect),sf.concatArray(sL,sl._getBoundPoints()),sL}for(var sZ,sh,s_,sN=this._graphics?this._graphics.getBoundPoints():sf.clearArray(this._$P.temBM),sm=0,su=(s_=this._childs).length;sm<su;sm++)(sZ=s_[sm])instanceof laya.display.Sprite&&1==sZ.visible&&(sh=sZ._boundPointsToParent(sd))&&(sN=sN?sf.concatArray(sN,sh):sh);return sN},sd.getStyle=function(){return this._style===sm.EMPTY&&(this._style=new sm),this._style},sd.setStyle=function(sd){this._style=sd},sd._adjustTransform=function(){this._tfChanged=!1;var sd,sL=this._style._tf,sl=sL.scaleX,sZ=sL.scaleY;if(sL.rotate||1!==sl||1!==sZ||sL.skewX||sL.skewY){(sd=this._transform||(this._transform=sE.create())).bTransform=!0;var sh=.0174532922222222*(sL.rotate-sL.skewX),s_=.0174532922222222*(sL.rotate+sL.skewY),sN=Math.cos(s_),sm=Math.sin(s_),su=Math.sin(sh),sx=Math.cos(sh);return sd.a=sl*sN,sd.b=sl*sm,sd.c=-sZ*su,sd.d=sZ*sx,sd.tx=sd.ty=0,sd}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,sd},sd.pos=function(sd,sL,sl){if(void 0===sl&&(sl=!1),this._x!==sd||this._y!==sL){if(this.destroyed)return this;if(sl){this._x=sd,this._y=sL,this.conchModel&&this.conchModel.pos(this._x,this._y);var sZ=this._parent;sZ&&0===sZ._repaint&&(sZ._repaint=1,sZ.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=sd,this.y=sL}return this},sd.pivot=function(sd,sL){return this.pivotX=sd,this.pivotY=sL,this},sd.size=function(sd,sL){return this.width=sd,this.height=sL,this},sd.scale=function(sd,sL,sl){void 0===sl&&(sl=!1);var sZ=this.getStyle(),sh=sZ._tf;if(sh.scaleX!=sd||sh.scaleY!=sL){if(this.destroyed)return this;if(sl){sZ.setScale(sd,sL),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(sd,sL),this._renderType|=4;var s_=this._parent;s_&&0===s_._repaint&&(s_._repaint=1,s_.parentRepaint())}else this.scaleX=sd,this.scaleY=sL}return this},sd.skew=function(sd,sL){return this.skewX=sd,this.skewY=sL,this},sd.render=function(sd,sL,sl){sK.spriteCount++,sj.renders[this._renderType]._fun(this,sd,sL+this._x,sl+this._y),this._repaint=0},sd.drawToCanvas=function(sd,sL,sl,sZ){if(sH.isConchNode){var sh=swd.create("2D");return new sX(sd,sL,sh).ctx.setCanvasType(1),this.conchModel.drawToCanvas(sh.source,sl,sZ),sh}return sF.drawToCanvas(this,this._renderType,sd,sL,sl,sZ)},sd.customRender=function(sd,sL,sl){this._renderType|=1024},sd._applyFilters=function(){var sd;if(!sH.isWebGL&&((sd=this._$P.filters)&&!(sd.length<1)))for(var sL=0,sl=sd.length;sL<sl;sL++)sd[sL].action.apply(this._$P.cacheCanvas)},sd._isHaveGlowFilter=function(){var sd,sL=0;if(this.filters)for(sL=0;sL<this.filters.length;sL++)if(8==this.filters[sL].type)return!0;for(sL=0,sd=this._childs.length;sL<sd;sL++)if(this._childs[sL]._isHaveGlowFilter())return!0;return!1},sd.localToGlobal=function(sd,sL){void 0===sL&&(sL=!1),!0===sL&&(sd=new sO(sd.x,sd.y));for(var sl=this;sl&&sl!=s$.stage;)sd=sl.toParentPoint(sd),sl=sl.parent;return sd},sd.globalToLocal=function(sd,sL){void 0===sL&&(sL=!1),sL&&(sd=new sO(sd.x,sd.y));for(var sl=this,sZ=[];sl&&sl!=s$.stage;)sZ.push(sl),sl=sl.parent;for(var sh=sZ.length-1;0<=sh;)sd=(sl=sZ[sh]).fromParentPoint(sd),sh--;return sd},sd.toParentPoint=function(sd){if(!sd)return sd;sd.x-=this.pivotX,sd.y-=this.pivotY,this.transform&&this._transform.transformPoint(sd),sd.x+=this._x,sd.y+=this._y;var sL=this._style.scrollRect;return sL&&(sd.x-=sL.x,sd.y-=sL.y),sd},sd.fromParentPoint=function(sd){if(!sd)return sd;sd.x-=this._x,sd.y-=this._y;var sL=this._style.scrollRect;return sL&&(sd.x+=sL.x,sd.y+=sL.y),this.transform&&this._transform.invertTransformPoint(sd),sd.x+=this.pivotX,sd.y+=this.pivotY,sd},sd.on=function(sd,sL,sl,sZ){return 1!==this._mouseEnableState&&this.isMouseEvent(sd)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(sd,sL,sl,sZ,!1)):sh.prototype.on.call(this,sd,sL,sl,sZ)},sd.once=function(sd,sL,sl,sZ){return 1!==this._mouseEnableState&&this.isMouseEvent(sd)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(sd,sL,sl,sZ,!0)):sh.prototype.once.call(this,sd,sL,sl,sZ)},sd._$2__onDisplay=function(){if(1!==this._mouseEnableState){var sd=this;for(sd=sd.parent;sd&&1!==sd._mouseEnableState&&!sd._getBit(2);)sd.mouseEnabled=!0,sd._setBit(2,!0),sd=sd.parent}},sd.loadImage=function(sd,sL,sl,sZ,sh,s_){var sN=this;return void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),this.graphics.loadImage(sd,sL,sl,sZ,sh,function(sd){sN.destroyed||(sN.size(sL+(sZ||sd.width),sl+(sh||sd.height)),sN.repaint(),s_&&s_.runWith(sd))}),this},sd.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},sd._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},sd._childChanged=function(sd){this._childs.length?this._renderType|=2048:this._renderType&=-2049,sd&&this._get$P("hasZorder")&&s$.timer.callLater(this,this.updateZOrder),this.repaint()},sd.parentRepaint=function(){var sd=this._parent;sd&&0===sd._repaint&&(sd._repaint=1,sd.parentRepaint())},sd.startDrag=function(sd,sL,sl,sZ,sh,s_,sN){void 0===sL&&(sL=!1),void 0===sl&&(sl=0),void 0===sZ&&(sZ=300),void 0===s_&&(s_=!1),void 0===sN&&(sN=.92),this._$P.dragging||this._set$P("dragging",new sT),this._$P.dragging.start(this,sd,sL,sl,sZ,sh,s_,sN)},sd.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},sd._releaseMem=function(){if(this._$P){var sd=this._$P.cacheCanvas;sd&&sd.ctx&&(sG.recover("RenderContext",sd.ctx),sd.ctx.canvas.size(0,0),sd.ctx=null);var sL=this._$P._filterCache;sL&&(sL.destroy(),sL.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},sd._setDisplay=function(sd){sd||this._releaseMem(),sh.prototype._setDisplay.call(this,sd)},sd.hitTestPoint=function(sd,sL){var sl=this.globalToLocal(sO.TEMP.setTo(sd,sL));return sd=sl.x,sL=sl.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?sn.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(sd,sL)},sd.getMousePoint=function(){return this.globalToLocal(sO.TEMP.setTo(s$.stage.mouseX,s$.stage.mouseY))},sd._getWords=function(){return null},sd._addChildsToLayout=function(sd){var sL=this._getWords();if(null==sL&&0==this._childs.length)return!1;if(sL)for(var sl=0,sZ=sL.length;sl<sZ;sl++)sd.push(sL[sl]);sl=0;for(var sh=this._childs.length;sl<sh;++sl){var s_=this._childs[sl];s_._style._enableLayout()&&s_._addToLayout(sd)}return!0},sd._addToLayout=function(sd){this._style.absolute||(this._style.block?sd.push(this):this._addChildsToLayout(sd)&&(this.x=this.y=0))},sd._isChar=function(){return!1},sd._getCSSStyle=function(){return this._style.getCSSStyle()},sd._setAttributes=function(sd,sL){switch(sd){case"x":this.x=parseFloat(sL);break;case"y":this.y=parseFloat(sL);break;case"width":this.width=parseFloat(sL);break;case"height":this.height=parseFloat(sL);break;default:this[sd]=sL}},sd._layoutLater=function(){this.parent&&this.parent._layoutLater()},st(0,sd,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(sd){this._optimizeScrollRect!=sd&&(this._optimizeScrollRect=sd,this.conchModel&&this.conchModel.optimizeScrollRect(sd))}),st(0,sd,"customRenderEnable",null,function(sd){if(sd&&(this._renderType|=1024,sH.isConchNode)){sl.CustomList.push(this);var sL=new swd("2d");sL._setContext(new CanvasRenderingContext2D),this.customContext=new sX(0,0,sL),sL.context.setCanvasType&&sL.context.setCanvasType(2),this.conchModel.custom(sL.context)}}),st(0,sd,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(sd){this.cacheAs=sd?this._$P.hasFilter?"none":"normal":"none"}),st(0,sd,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(sd){var sL=this._$P.cacheCanvas;if(sd!==(sL?sL.type:"none")){if("none"!==sd)this._getBit(1)||this._setUpNoticeType(1),sL||(sL=this._set$P("cacheCanvas",sG.getItemByClass("cacheCanvas",Object))),sL.type=sd,sL.reCache=!0,this._renderType|=16,"bitmap"==sd&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(sL){var sl=sL;sl&&sl.ctx&&(sG.recover("RenderContext",sl.ctx),sl.ctx.canvas.size(0,0),sl.ctx=null),sG.recover("cacheCanvas",sL)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),st(0,sd,"zOrder",function(){return this._zOrder},function(sd){this._zOrder!=sd&&(this._zOrder=sd,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(sd),this._parent&&(sd&&this._parent._set$P("hasZorder",!0),s$.timer.callLater(this._parent,this.updateZOrder)))}),st(0,sd,"rotation",function(){return this._style._tf.rotate},function(sd){var sL=this.getStyle();if(sL._tf.rotate!==sd){sL.setRotate(sd),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(sd),this._renderType|=4;var sl=this._parent;sl&&0===sl._repaint&&(sl._repaint=1,sl.parentRepaint())}}),st(0,sd,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(sd){this._width!==sd&&(this._width=sd,this.conchModel&&this.conchModel.size(sd,this._height),this.repaint())}),st(0,sd,"x",function(){return this._x},function(sd){if(this._x!==sd){if(this.destroyed)return;this._x=sd,this.conchModel&&this.conchModel.pos(sd,this._y);var sL=this._parent;sL&&0===sL._repaint&&(sL._repaint=1,sL.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),st(0,sd,"globalScaleY",function(){for(var sd=1,sL=this;sL&&sL!==s$.stage;)sd*=sL.scaleY,sL=sL.parent;return sd}),st(0,sd,"hitArea",function(){return this._$P.hitArea},function(sd){this._set$P("hitArea",sd)}),st(0,sd,"staticCache",function(){return this._$P.staticCache},function(sd){this._set$P("staticCache",sd),sd||this.reCache()}),st(0,sd,"texture",function(){return this._texture},function(sd){this._texture!=sd&&(this._texture=sd,this.graphics.cleanByTexture(sd,0,0))}),st(0,sd,"y",function(){return this._y},function(sd){if(this._y!==sd){if(this.destroyed)return;this._y=sd,this.conchModel&&this.conchModel.pos(this._x,sd);var sL=this._parent;sL&&0===sL._repaint&&(sL._repaint=1,sL.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),st(0,sd,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(sd){this._height!==sd&&(this._height=sd,this.conchModel&&this.conchModel.size(this._width,sd),this.repaint())}),st(0,sd,"blendMode",function(){return this._style.blendMode},function(sd){this.getStyle().blendMode=sd,this.conchModel&&this.conchModel.blendMode(sd),sd&&"source-over"!=sd?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),st(0,sd,"scaleX",function(){return this._style._tf.scaleX},function(sd){var sL=this.getStyle();if(sL._tf.scaleX!==sd){sL.setScaleX(sd),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(sd,sL._tf.scaleY),this._renderType|=4;var sl=this._parent;sl&&0===sl._repaint&&(sl._repaint=1,sl.parentRepaint())}}),st(0,sd,"scaleY",function(){return this._style._tf.scaleY},function(sd){var sL=this.getStyle();if(sL._tf.scaleY!==sd){sL.setScaleY(sd),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(sL._tf.scaleX,sd),this._renderType|=4;var sl=this._parent;sl&&0===sl._repaint&&(sl._repaint=1,sl.parentRepaint())}}),st(0,sd,"stage",function(){return s$.stage}),st(0,sd,"skewX",function(){return this._style._tf.skewX},function(sd){var sL=this.getStyle();if(sL._tf.skewX!==sd){sL.setSkewX(sd),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(sd,sL._tf.skewY),this._renderType|=4;var sl=this._parent;sl&&0===sl._repaint&&(sl._repaint=1,sl.parentRepaint())}}),st(0,sd,"scrollRect",function(){return this._style.scrollRect},function(sd){this.getStyle().scrollRect=sd,this.repaint(),sd?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(sd.x,sd.y,sd.width,sd.height)):(this._renderType&=-129,this.conchModel&&(sl.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),st(0,sd,"skewY",function(){return this._style._tf.skewY},function(sd){var sL=this.getStyle();if(sL._tf.skewY!==sd){sL.setSkewY(sd),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(sL._tf.skewX,sd),this._renderType|=4;var sl=this._parent;sl&&0===sl._repaint&&(sl._repaint=1,sl.parentRepaint())}}),st(0,sd,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(sd){this._tfChanged=!1,(this._transform=sd)&&(this._x=sd.tx,this._y=sd.ty,sd.tx=sd.ty=0,this.conchModel&&this.conchModel.transform(sd.a,sd.b,sd.c,sd.d,this._x,this._y)),sd?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),st(0,sd,"pivotX",function(){return this._style._tf.translateX},function(sd){this.getStyle().setTranslateX(sd),this.conchModel&&this.conchModel.pivot(sd,this._style._tf.translateY),this.repaint()}),st(0,sd,"pivotY",function(){return this._style._tf.translateY},function(sd){this.getStyle().setTranslateY(sd),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,sd),this.repaint()}),st(0,sd,"alpha",function(){return this._style.alpha},function(sd){this._style&&this._style.alpha!==sd&&(sd=sd<0?0:1<sd?1:sd,this.getStyle().alpha=sd,this.conchModel&&this.conchModel.alpha(sd),1!==sd?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),st(0,sd,"visible",function(){return this._style.visible},function(sd){this._style&&this._style.visible!==sd&&(this.getStyle().visible=sd,this.conchModel&&this.conchModel.visible(sd),this.parentRepaint())}),st(0,sd,"graphics",function(){return this._graphics||(this.graphics=sF.createGraphics())},function(sd){this._graphics&&(this._graphics._sp=null),(this._graphics=sd)?(this._renderType&=-2,this._renderType|=512,(sd._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(sl.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),st(0,sd,"filters",function(){return this._$P.filters},function(sd){sd&&0===sd.length&&(sd=null),this._$P.filters!=sd&&(this._set$P("filters",sd?sd.slice():null),sH.isConchApp&&(this.conchModel&&(sl.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),sH.isWebGL&&(sd&&sd.length?this._renderType|=32:this._renderType&=-33),sd&&0<sd.length?(this._getBit(1)||this._setUpNoticeType(1),sH.isWebGL&&1==sd.length&&sd[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(sH.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),st(0,sd,"parent",sh.prototype._$get_parent,function(sd){s$.superSet(sdd,this,"parent",sd),sd&&this._getBit(2)&&this._$2__onDisplay()}),st(0,sd,"mask",function(){return this._$P._mask},function(sd){sd&&this.mask&&this.mask._$P.maskParent||(sd?(this.cacheAs="bitmap",this._set$P("_mask",sd),sd._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",sd),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(sd?sd.conchModel:null),this._renderType|=64,this.parentRepaint())}),st(0,sd,"mouseEnabled",function(){return 1<this._mouseEnableState},function(sd){this._mouseEnableState=sd?2:1}),st(0,sd,"globalScaleX",function(){for(var sd=1,sL=this;sL&&sL!==s$.stage;)sd*=sL.scaleX,sL=sL.parent;return sd}),st(0,sd,"mouseX",function(){return this.getMousePoint().x}),st(0,sd,"mouseY",function(){return this.getMousePoint().y}),sl.fromImage=function(sd){return(new sl).loadImage(sd)},sl._cachePool=[],sl.CustomList=[],su(sl,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=sN.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),sl}(sdd),sqd=function(sd){function sL(sd){this._audio=null,this._onEnd=null,this._resumePlay=null,sL.__super.call(this),this._onEnd=sf.bind(this.__onEnd,this),this._resumePlay=sf.bind(this.__resumePlay,this),sd.addEventListener("ended",this._onEnd),this._audio=sd}sr(sL,"laya.media.h5audio.AudioSoundChannel",sZd);var sl=sL.prototype;return sl.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(s$.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},sl.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,si.container.appendChild(this._audio),this._audio.play()}catch(sd){this.event("error")}},sl.play=function(sd){this.isStopped=!1;try{this._audio.playbackRate=sg.playbackRate,this._audio.currentTime=this.startTime}catch(sd){return void this._audio.addEventListener("canplay",this._resumePlay)}sg.addChannel(this),si.container.appendChild(this._audio),!sd&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},sl.stop=function(){this.isStopped=!0,sg.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&sH.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),si.onIE||this._audio!=sld._musicAudio&&sG.recover("audio:"+this.url,this._audio),si.removeElement(this._audio),this._audio=null)},sl.pause=function(){this.isStopped=!0,sg.removeChannel(this),"pause"in this._audio&&this._audio.pause()},sl.resume=function(){this._audio&&(this.isStopped=!1,sg.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},st(0,sl,"position",function(){return this._audio?this._audio.currentTime:0}),st(0,sl,"duration",function(){return this._audio?this._audio.duration:0}),st(0,sl,"volume",function(){return this._audio?this._audio.volume:1},function(sd){this._audio&&(this._audio.volume=sd)}),sL}(),sYd=function(sd){function sL(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=s_d.ctx,sL.__super.call(this),this._onPlayEnd=sf.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}sr(sL,"laya.media.webaudio.WebAudioSoundChannel",sZd);var sl=sL.prototype;return sl.play=function(sd){if(sg.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var sL=this.context,sl=this.gain,sZ=sL.createBufferSource();(this.bufferSource=sZ).buffer=this.audioBuffer,sZ.connect(sl),sl&&sl.disconnect(),sl.connect(sL.destination),sZ.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=si.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(sZ.loop=!0),sZ.playbackRate.setTargetAtTime?sZ.playbackRate.setTargetAtTime(sg.playbackRate,this.context.currentTime,.1):sZ.playbackRate.value=sg.playbackRate,sZ.start(0,this.startTime),!sd&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},sl.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(s$.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},sl._clearBufferSource=function(){if(this.bufferSource){var sd=this.bufferSource;sd.stop?sd.stop(0):sd.noteOff(0),sd.disconnect(0),sd.onended=null,sL._tryCleanFailed||this._tryClearBuffer(sd),this.bufferSource=null}},sl._tryClearBuffer=function(sd){try{sd.buffer=null}catch(sd){sL._tryCleanFailed=!0}},sl.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,sg.removeChannel(this),this.startHandler=null,this.completeHandler=null},sl.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,sg.removeChannel(this)},sl.resume=function(){this.startTime=this._pauseTime,this.play(!1)},st(0,sl,"position",function(){return this.bufferSource?(si.now()-this._startTime)/1e3+this.startTime:0}),st(0,sl,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),st(0,sl,"volume",function(){return this._volume},function(sd){this.isStopped||(this._volume=sd,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(sd,this.context.currentTime,.1):this.gain.gain.value=sd)}),sL._tryCleanFailed=!1,sL}(),scd=function(sd){function sL(){sL.__super.call(this),this._w=0,this._h=0}sr(sL,"laya.resource.Bitmap",sxd);var sl=sL.prototype;return st(0,sl,"width",function(){return this._w}),st(0,sl,"height",function(){return this._h}),st(0,sl,"source",function(){return this._source}),sL}(),srd=function(sL){function sd(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,sd.__super.call(this),this._interval=sZ.animationInterval,this._setUpNoticeType(1)}sr(sd,"laya.display.AnimationPlayerBase",sL);var sl=sd.prototype;return sl.play=function(sd,sL,sl,sZ){void 0===sd&&(sd=0),void 0===sL&&(sL=!0),void 0===sl&&(sl=""),void 0===sZ&&(sZ=!0),this._isPlaying=!0,this.index="string"==typeof sd?this._getFrameByLabel(sd):sd,this.loop=sL,this._actionName=sl,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},sl._getFrameByLabel=function(sd){var sL=0;for(sL=0;sL<this._count;sL++)if(this._labels[sL]&&0<=this._labels[sL].indexOf(sd))return sL;return 0},sl._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},sl._setControlNode=function(sd){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=sd)&&sd!=this&&(sd.on("display",this,this._checkResumePlaying),sd.on("undisplay",this,this._checkResumePlaying))},sl._setDisplay=function(sd){sL.prototype._setDisplay.call(this,sd),this._checkResumePlaying()},sl._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},sl.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},sl.addLabel=function(sd,sL){this._labels||(this._labels={}),this._labels[sL]||(this._labels[sL]=[]),this._labels[sL].push(sd)},sl.removeLabel=function(sd){if(sd){if(this._labels)for(var sL in this._labels)this._removeLabelFromLabelList(this._labels[sL],sd)}else this._labels=null},sl._removeLabelFromLabelList=function(sd,sL){if(sd)for(var sl=sd.length-1;0<=sl;sl--)sd[sl]==sL&&sd.splice(sl,1)},sl.gotoAndStop=function(sd){this.index="string"==typeof sd?this._getFrameByLabel(sd):sd,this.stop()},sl._displayToIndex=function(sd){},sl.clear=function(){this.stop(),this._labels=null},st(0,sl,"interval",function(){return this._interval},function(sd){this._interval!=sd&&(this._frameRateChanged=!0,this._interval=sd,this._isPlaying&&0<sd&&this.timerLoop(sd,this,this._frameLoop,null,!0,!0))}),st(0,sl,"isPlaying",function(){return this._isPlaying}),st(0,sl,"index",function(){return this._index},function(sd){if(this._index=sd,this._displayToIndex(sd),this._labels&&this._labels[sd])for(var sL=this._labels[sd],sl=0,sZ=sL.length;sl<sZ;sl++)this.event("label",sL[sl])}),st(0,sl,"count",function(){return this._count}),sd.WRAP_POSITIVE=0,sd.WRAP_REVERSE=1,sd.WRAP_PINGPONG=2,sd}(sbd),sad=function(sL){function sY(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,sY.__super.call(this),this.overflow=sY.VISIBLE,this._style=new sLd(this),this._style.wordWrap=!1}sr(sY,"laya.display.Text",sL);var sd=sY.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._lines=null,this._words&&(this._words.length=0,this._words=null)},sd._getBoundPointsM=function(sd){void 0===sd&&(sd=!1);var sL=sn.TEMP;return sL.setTo(0,0,this.width,this.height),sL._getBoundPoints()},sd.getGraphicBounds=function(sd){void 0===sd&&(sd=!1);var sL=sn.TEMP;return sL.setTo(0,0,this.width,this.height),sL},sd._getCSSStyle=function(){return this._style},sd.lang=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st){if(sd=sY.langPacks&&sY.langPacks[sd]?sY.langPacks[sd]:sd,arguments.length<2)this._text=sd;else{for(var sb=0,sq=arguments.length;sb<sq;sb++)sd=sd.replace("{"+sb+"}",arguments[sb+1]);this._text=sd}},sd._isPassWordMode=function(){var sd=this._style.password;return"prompt"in this&&this.prompt==this._text&&(sd=!1),sd},sd._getPassWordTxt=function(sd){var sL;sL="";for(var sl=sd.length;0<sl;sl--)sL+="●";return sL},sd.renderText=function(sd,sL){var sl=this.graphics;sl.clear(!0);var sZ=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(si.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);si.context.font=sZ;var sh=this.padding,s_=sh[3],sN="left",sm=this._lines,su=this.leading+this._charSize.height,sx=this._currBitmapFont;sx&&(su=this.leading+sx.getMaxHeight());var st=sh[0];if(!sx&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(sN="right",s_=this._width-sh[1]):"center"==this.align&&(sN="center",s_=.5*this._width+sh[3]-sh[1])),0<this._height){var sb=this._textHeight>this._height?"top":this.valign;"middle"===sb?st=.5*(this._height-sL*su)+sh[0]-sh[2]:"bottom"===sb&&(st=this._height-sL*su-sh[2])}var sq=this._style;if(sx&&sx.autoScaleSize)var sY=sx.fontSize/this.fontSize;if(this._clipPoint)if(sl.save(),sx&&sx.autoScaleSize){var sc=0,sr=0;sc=this._width?this._width-sh[3]-sh[1]:this._textWidth,sr=this._height?this._height-sh[0]-sh[2]:this._textHeight,sc*=sY,sr*=sY,sl.clipRect(sh[3],sh[0],sc,sr)}else sl.clipRect(sh[3],sh[0],this._width?this._width-sh[3]-sh[1]:this._textWidth,this._height?this._height-sh[0]-sh[2]:this._textHeight);var sa=sq.password;"prompt"in this&&this.prompt==this._text&&(sa=!1);for(var sk=0,se=0,sw=Math.min(this._lines.length,sL+sd)||1,ss=sd;ss<sw;ss++){var sA,sy=sm[ss];if(sa){var s$=sy.length;sy="";for(var sO=s$;0<sO;sO--)sy+="●"}if(sk=s_-(this._clipPoint?this._clipPoint.x:0),se=st+su*ss-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(sN,sk,se,ss),sx){var sn=this.width;sx.autoScaleSize&&(sn=this.width*sY),sx.drawText(sy,this,sk,se,this.align,sn)}else sH.isWebGL?(this._words||(this._words=[]),(sA=this._words.length>ss-sd?this._words[ss-sd]:new sM).setText(sy)):sA=sy,sq.stroke?sl.fillBorderText(sA,sk,se,sZ,this.color,sq.strokeColor,sq.stroke,sN):sl.fillText(sA,sk,se,sZ,this.color,sN)}if(sx&&sx.autoScaleSize){var sV=1/sY;this.scale(sV,sV)}this._clipPoint&&sl.restore(),this._startX=s_,this._startY=st},sd.drawUnderline=function(sd,sL,sl,sZ){var sh=this._lineWidths[sZ];switch(sd){case"center":sL-=sh/2;break;case"right":sL-=sh}sl+=this._charSize.height,this._graphics.drawLine(sL,sl,sL+sh,sl,this.underlineColor||this.color,1)},sd.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);si.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new sO(0,0)):this._clipPoint=null;var sd=this._lines.length;if(this.overflow!=sY.VISIBLE){var sL=this.overflow==sY.HIDDEN?Math.floor:Math.ceil;sd=Math.min(sd,sL((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var sl=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(sl,sd),this.repaint()},sd.evalTextSize=function(){var sd,sL=NaN;sd=Math.max.apply(this,this._lineWidths),sL=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],sd==this._textWidth&&sL==this._textHeight||(this._textWidth=sd,this._textHeight=sL,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},sd.checkEnabledViewportOrNot=function(){return this.overflow==sY.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},sd.changeText=function(sd){this._text!==sd&&(this.lang(sd+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},sd.parseLines=function(sd){var sL=this.wordWrap||this.overflow==sY.HIDDEN;if(sL)var sl=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var sZ=si.context.measureText(sY._testWord);sH.isConchApp&&0===sZ.width&&0===sZ.height&&(sZ=si.context.measureText("W")),this._charSize.width=sZ.width,this._charSize.height=sZ.height||this.fontSize}for(var sh=sd.replace(/\r\n/g,"\n").split("\n"),s_=0,sN=sh.length;s_<sN;s_++){var sm=sh[s_];sL?this.parseLine(sm,sl):(this._lineWidths.push(this.getTextWidth(sm)),this._lines.push(sm))}},sd.parseLine=function(sd,sL){si.context;var sl,sZ=this._lines,sh=0,s_=NaN,sN=NaN,sm=0;if((s_=this.getTextWidth(sd))<=sL)return sZ.push(sd),void this._lineWidths.push(s_);s_=this._charSize.width,0==(sh=Math.floor(sL/s_))&&(sh=1),sN=s_=this.getTextWidth(sd.substring(0,sh));for(var su=sh,sx=sd.length;su<sx;su++)if(sL<(sN+=s_=this.getTextWidth(sd.charAt(su))))if(this.wordWrap){var st=sd.substring(sm,su);if(st.charCodeAt(st.length-1)<255?(sl=/(?:\w|-)+$/.exec(st))&&(su=sl.index+sm,0==sl.index?su+=st.length:st=sd.substring(sm,su)):sY.RightToLeft&&(sl=/([\u0600-\u06FF])+$/.exec(st))&&(su=sl.index+sm,0==sl.index?su+=st.length:st=sd.substring(sm,su)),sZ.push(st),this._lineWidths.push(sN-s_),!((sm=su)+sh<sx)){sZ.push(sd.substring(sm,sx)),this._lineWidths.push(this.getTextWidth(sZ[sZ.length-1])),sm=-1;break}su+=sh,sN=s_=this.getTextWidth(sd.substring(sm,su)),su--}else if(this.overflow==sY.HIDDEN)return sZ.push(sd.substring(0,su)),void this._lineWidths.push(this.getTextWidth(sZ[sZ.length-1]));this.wordWrap&&-1!=sm&&(sZ.push(sd.substring(sm,sx)),this._lineWidths.push(this.getTextWidth(sZ[sZ.length-1])))},sd.getTextWidth=function(sd){return this._currBitmapFont?this._currBitmapFont.getTextWidth(sd):si.context.measureText(sd).width},sd.getWordWrapWidth=function(){var sd=this.padding,sL=NaN;return(sL=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(sL=this.wordWrap?100:si.width),sL<=0&&(sL=100),sL-sd[3]-sd[1]},sd.getCharPoint=function(sd,sL){this._isChanged&&s$.timer.runCallLater(this,this.typeset);for(var sl=0,sZ=this._lines,sh=0,s_=0,sN=sZ.length;s_<sN;s_++){if(sd<(sl+=sZ[s_].length)){var sm=s_;break}sh=sl}var su=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;si.context.font=su;var sx=this.getTextWidth(this._text.substring(sh,sd));return(sL||new sO).setTo(this._startX+sx-(this._clipPoint?this._clipPoint.x:0),this._startY+sm*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},st(0,sd,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(sd){sd!=this._width&&(s$.superSet(sbd,this,"width",sd),this.isChanged=!0)}),st(0,sd,"textWidth",function(){return this._isChanged&&s$.timer.runCallLater(this,this.typeset),this._textWidth}),st(0,sd,"height",function(){return this._height?this._height:this.textHeight},function(sd){sd!=this._height&&(s$.superSet(sbd,this,"height",sd),this.isChanged=!0)}),st(0,sd,"textHeight",function(){return this._isChanged&&s$.timer.runCallLater(this,this.typeset),this._textHeight}),st(0,sd,"padding",function(){return this._getCSSStyle().padding},function(sd){this._getCSSStyle().padding=sd,this.isChanged=!0}),st(0,sd,"bold",function(){return this._getCSSStyle().bold},function(sd){this._getCSSStyle().bold=sd,this.isChanged=!0}),st(0,sd,"text",function(){return this._text||""},function(sd){this._text!==sd&&(this.lang(sd+""),this.isChanged=!0,this.event("change"))}),st(0,sd,"color",function(){return this._getCSSStyle().color},function(sd){this._getCSSStyle().color!=sd&&(this._getCSSStyle().color=sd,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),st(0,sd,"font",function(){return this._getCSSStyle().fontFamily},function(sd){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),sY._bitmapFonts&&sY._bitmapFonts[sd]&&(this._currBitmapFont=sY._bitmapFonts[sd]),this._getCSSStyle().fontFamily=sd,this.isChanged=!0}),st(0,sd,"fontSize",function(){return this._getCSSStyle().fontSize},function(sd){this._getCSSStyle().fontSize=sd,this.isChanged=!0}),st(0,sd,"italic",function(){return this._getCSSStyle().italic},function(sd){this._getCSSStyle().italic=sd,this.isChanged=!0}),st(0,sd,"align",function(){return this._getCSSStyle().align},function(sd){this._getCSSStyle().align=sd,this.isChanged=!0}),st(0,sd,"valign",function(){return this._getCSSStyle().valign},function(sd){this._getCSSStyle().valign=sd,this.isChanged=!0}),st(0,sd,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(sd){this._getCSSStyle().wordWrap=sd,this.isChanged=!0}),st(0,sd,"leading",function(){return this._getCSSStyle().leading},function(sd){this._getCSSStyle().leading=sd,this.isChanged=!0}),st(0,sd,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(sd){this._getCSSStyle().backgroundColor=sd,this.isChanged=!0}),st(0,sd,"borderColor",function(){return this._getCSSStyle().borderColor},function(sd){this._getCSSStyle().borderColor=sd,this.isChanged=!0}),st(0,sd,"stroke",function(){return this._getCSSStyle().stroke},function(sd){this._getCSSStyle().stroke=sd,this.isChanged=!0}),st(0,sd,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(sd){this._getCSSStyle().strokeColor=sd,this.isChanged=!0}),st(0,sd,"isChanged",null,function(sd){this._isChanged!==sd&&(this._isChanged=sd)&&s$.timer.callLater(this,this.typeset)}),st(0,sd,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(sd){if(!(this.overflow!=sY.SCROLL||this.textWidth<this._width)&&this._clipPoint){sd=sd<this.padding[3]?this.padding[3]:sd;var sL=this._textWidth-this._width;sd=sL<sd?sL:sd;var sl=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=sd,this.renderText(this._lastVisibleLineIndex,sl)}}),st(0,sd,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(sd){if(!(this.overflow!=sY.SCROLL||this.textHeight<this._height)&&this._clipPoint){sd=sd<this.padding[0]?this.padding[0]:sd;var sL=this._textHeight-this._height,sl=(sd=sL<sd?sL:sd)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=sl;var sZ=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=sd,this.renderText(sl,sZ)}}),st(0,sd,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),st(0,sd,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),st(0,sd,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),st(0,sd,"underlineColor",function(){return this._underlineColor},function(sd){this._underlineColor=sd,this._isChanged=!0,this.typeset()}),sY.registerBitmapFont=function(sd,sL){sY._bitmapFonts||(sY._bitmapFonts={}),sY._bitmapFonts[sd]=sL},sY.unregisterBitmapFont=function(sd,sL){if(void 0===sL&&(sL=!0),sY._bitmapFonts&&sY._bitmapFonts[sd]){var sl=sY._bitmapFonts[sd];sL&&sl.destroy(),delete sY._bitmapFonts[sd]}},sY.setTextRightToLeft=function(){var sd;(sd=si.canvas.source.style).display="none",sd.position="absolute",sd.direction="rtl",sH._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,si.document.body.appendChild(si.canvas.source)},sY.supportFont=function(sd){si.context.font="10px sans-serif";var sL=si.context.measureText("abcji").width;si.context.font="10px "+sd;var sl=si.context.measureText("abcji").width;return console.log(sL,sl),sL!==sl},sY._testWord="游",sY.langPacks=null,sY.VISIBLE="visible",sY.SCROLL="scroll",sY.HIDDEN="hidden",sY.CharacterCache=!0,sY.RightToLeft=!1,sY._bitmapFonts=null,su(sY,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),sY}(sbd),skd=function(sb){function sN(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",sN.__super.call(this),this.offset=new sO,this._canvasTransform=new sE,this._previousOrientation=si.window.orientation;var sL=this;this.transform=sE.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var sd=si.window,sl=this;sd.addEventListener("focus",function(){sL._isFocused=!0,sl.event("focus"),sl.event("focuschange")}),sd.addEventListener("blur",function(){sL._isFocused=!1,sl.event("blur"),sl.event("focuschange"),sl._isInputting()&&(sAd.inputElement.target.focus=!1)});var sZ="visibilityState",sh="visibilitychange",s_=sd.document;void 0!==s_.hidden?(sh="visibilitychange",sZ="visibilityState"):void 0!==s_.mozHidden?(sh="mozvisibilitychange",sZ="mozVisibilityState"):void 0!==s_.msHidden?(sh="msvisibilitychange",sZ="msVisibilityState"):void 0!==s_.webkitHidden&&(sh="webkitvisibilitychange",sZ="webkitVisibilityState"),sd.document.addEventListener(sh,function(){"hidden"==si.document[sZ]?sl._setStageVisible(!1):sl._setStageVisible(!0)}),sd.document.addEventListener("qbrowserVisibilityChange",function(sd){sl._setStageVisible(!sd.hidden)}),sd.addEventListener("resize",function(){var sd=si.window.orientation;null!=sd&&sd!=sL._previousOrientation&&sl._isInputting()&&(sAd.inputElement.target.focus=!1),sL._previousOrientation=sd,sl._isInputting()||sl._resetCanvas()}),sd.addEventListener("orientationchange",function(sd){sl._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),si.onMobile&&this.on("mousedown",this,this._onmouseMove)}sr(sN,"laya.display.Stage",sb);var sd=sN.prototype;return sd._setStageVisible=function(sd){this._isVisibility!=sd&&(this._isVisibility=sd,this._isVisibility||this._isInputting()&&(sAd.inputElement.target.focus=!1),this.event("visibilitychange"))},sd._isInputting=function(){return si.onMobile&&sAd.isInputting},sd._changeCanvasSize=function(){this.setScreenSize(si.clientWidth*si.pixelRatio,si.clientHeight*si.pixelRatio)},sd._resetCanvas=function(){if(this.screenAdaptationEnabled){var sd=sH._mainCanvas;sd.source.style;sd.size(1,1),s$.timer.once(100,this,this._changeCanvasSize)}},sd.setScreenSize=function(sd,sL){var sl=!1;if("none"!==this._screenMode&&(sl=(sd/sL<1?"vertical":"horizontal")!==this._screenMode)){var sZ=sL;sL=sd,sd=sZ}this.canvasRotation=sl;var sh=sH._mainCanvas,s_=sh.source.style,sN=this._canvasTransform.identity(),sm=this._scaleMode,su=sd/this.designWidth,sx=sL/this.designHeight,st=this.designWidth,sb=this.designHeight,sq=sd,sY=sL,sc=si.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,sm){case"noscale":su=sx=1,sq=this.designWidth,sY=this.designHeight;break;case"showall":su=sx=Math.min(su,sx),st=sq=Math.round(this.designWidth*su),sb=sY=Math.round(this.designHeight*sx);break;case"noborder":su=sx=Math.max(su,sx),sq=Math.round(this.designWidth*su),sY=Math.round(this.designHeight*sx);break;case"full":su=sx=1,this._width=st=sd,this._height=sb=sL;break;case"fixedwidth":sx=su,this._height=sb=Math.round(sL/su);break;case"fixedheight":su=sx,this._width=st=Math.round(sd/sx);break;case"fixedauto":sd/sL<this.designWidth/this.designHeight?(sx=su,this._height=sb=Math.round(sL/su)):(su=sx,this._width=st=Math.round(sd/sx))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,st=st+1&2147483646,sb=sb+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),su*=this.scaleX,sx*=this.scaleY,1===su&&1===sx?this.transform.identity():(this.transform.a=this._formatData(su/(sq/st)),this.transform.d=this._formatData(sx/(sY/sb)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),sh.size(st,sb),sF.changeWebGLSize(st,sb),sN.scale(sq/st/sc,sY/sb/sc),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(sd-sq)/sc:this.offset.x=.5*(sd-sq)/sc,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(sL-sY)/sc:this.offset.y=.5*(sL-sY)/sc,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),sN.translate(this.offset.x,this.offset.y),this.canvasDegree=0,sl&&("horizontal"===this._screenMode?(sN.rotate(Math.PI/2),sN.translate(sL/sc,0),this.canvasDegree=90):(sN.rotate(-Math.PI/2),sN.translate(0,sd/sc),this.canvasDegree=-90)),sN.a=this._formatData(sN.a),sN.d=this._formatData(sN.d),sN.tx=this._formatData(sN.tx),sN.ty=this._formatData(sN.ty),s_.transformOrigin=s_.webkitTransformOrigin=s_.msTransformOrigin=s_.mozTransformOrigin=s_.oTransformOrigin="0px 0px 0px",s_.transform=s_.webkitTransform=s_.msTransform=s_.mozTransform=s_.oTransform="matrix("+sN.toString()+")",sN.translate(parseInt(s_.left)||0,parseInt(s_.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},sd._formatData=function(sd){return Math.abs(sd)<1e-6?0:Math.abs(1-sd)<.001?0<sd?1:-1:sd},sd.getMousePoint=function(){return sO.TEMP.setTo(this.mouseX,this.mouseY)},sd.repaint=function(){this._repaint=1},sd.parentRepaint=function(){},sd._loop=function(){return this.render(sH.context,0,0),!0},sd._onmouseMove=function(sd){this._mouseMoveTime=si.now()},sd.getTimeFromFrameStart=function(){return si.now()-this._frameStartTime},sd.render=function(sd,sL,sl){if("sleep"===this._frameRate&&!sH.isConchApp){var sZ=si.now();if(!(1e3<=sZ-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(sK.loopCount++,sc.instance.runEvent(),s$.timer._update()));this._frameStartTime=sZ}if(this._renderCount++,sH.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=si.now();var sh="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),s_=this._renderCount%2==0;if(sK.renderSlow=!sh,sh||s_||sH.isConchApp){var sN;sK.loopCount++,sc.instance.runEvent(),s$.timer._update(),sF.update3DLoop();var sm=0,su=0;if(sH.isConchNode)for(sm=0,su=this._scenes.length;sm<su;sm++)(sN=this._scenes[sm])&&sN._updateSceneConch();else for(sm=0,su=this._scenes.length;sm<su;sm++)(sN=this._scenes[sm])&&sN._updateScene();if(sH.isConchNode){var sx=sbd.CustomList;for(sm=0,su=sx.length;sm<su;sm++){var st=sx[sm];st.customRender(st.customContext,0,0)}return}}sH.isConchNode||this.renderingEnabled&&(sh||!s_||sH.isConchWebGL)&&(sH.isWebGL?sH.WebGL.mainContext&&!sH.WebGL.mainContext.isContextLost()&&(sd.clear(),sb.prototype.render.call(this,sd,sL,sl),sK._show&&sK._sp&&sK._sp.render(sd,sL,sl),sF.clear(this._bgColor),sF.beginFlush(),sd.flush(),sF.endFinish(),sU.instance&&sU.getInstance().endDispose()):(sF.clear(this._bgColor),sb.prototype.render.call(this,sd,sL,sl),sK._show&&sK._sp&&sK._sp.render(sd,sL,sl)))}else this._renderCount%5==0&&(sK.loopCount++,sc.instance.runEvent(),s$.timer._update())},sd._requestFullscreen=function(){var sd=si.document.documentElement;sd.requestFullscreen?sd.requestFullscreen():sd.mozRequestFullScreen?sd.mozRequestFullScreen():sd.webkitRequestFullscreen?sd.webkitRequestFullscreen():sd.msRequestFullscreen&&sd.msRequestFullscreen()},sd._fullScreenChanged=function(){s$.stage.event("fullscreenchange")},sd.exitFullscreen=function(){var sd=si.document;sd.exitFullscreen?sd.exitFullscreen():sd.mozCancelFullScreen?sd.mozCancelFullScreen():sd.webkitExitFullscreen&&sd.webkitExitFullscreen()},st(0,sd,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),st(0,sd,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),st(0,sd,"frameRate",function(){return this._frameRate},function(sd){if(this._frameRate=sd,sH.isConchApp)switch(this._frameRate){case"slow":si.window.conch&&si.window.conchConfig.setSlowFrame&&si.window.conchConfig.setSlowFrame(!0);break;case"fast":si.window.conch&&si.window.conchConfig.setSlowFrame&&si.window.conchConfig.setSlowFrame(!1);break;case"mouse":si.window.conch&&si.window.conchConfig.setMouseFrame&&si.window.conchConfig.setMouseFrame(2e3);break;case"sleep":si.window.conch&&si.window.conchConfig.setLimitFPS&&si.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),st(0,sd,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),st(0,sd,"width",sb.prototype._$get_width,function(sd){this.designWidth=sd,s$.superSet(sbd,this,"width",sd),s$.timer.callLater(this,this._changeCanvasSize)}),st(0,sd,"alignH",function(){return this._alignH},function(sd){this._alignH=sd,s$.timer.callLater(this,this._changeCanvasSize)}),st(0,sd,"isFocused",function(){return this._isFocused}),st(0,sd,"height",sb.prototype._$get_height,function(sd){this.designHeight=sd,s$.superSet(sbd,this,"height",sd),s$.timer.callLater(this,this._changeCanvasSize)}),st(0,sd,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||sE.create()},sb.prototype._$set_transform),st(0,sd,"isVisibility",function(){return this._isVisibility}),st(0,sd,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),st(0,sd,"scaleMode",function(){return this._scaleMode},function(sd){this._scaleMode=sd,s$.timer.callLater(this,this._changeCanvasSize)}),st(0,sd,"alignV",function(){return this._alignV},function(sd){this._alignV=sd,s$.timer.callLater(this,this._changeCanvasSize)}),st(0,sd,"bgColor",function(){return this._bgColor},function(sd){this._bgColor=sd,this.conchModel&&this.conchModel.bgColor(sd),sH.isWebGL&&(sd?sN._wgColor=sP.create(sd)._color:si.onMiniGame||(sN._wgColor=null)),si.onLimixiu?sN._wgColor=sP.create(sd)._color:sH.canvas.style.background=sd||"none"}),st(0,sd,"mouseX",function(){return Math.round(sc.instance.mouseX/this.clientScaleX)}),st(0,sd,"mouseY",function(){return Math.round(sc.instance.mouseY/this.clientScaleY)}),st(0,sd,"screenMode",function(){return this._screenMode},function(sd){this._screenMode=sd}),st(0,sd,"visible",sb.prototype._$get_visible,function(sd){this.visible!==sd&&(s$.superSet(sbd,this,"visible",sd),sH._mainCanvas.source.style.visibility=sd?"visible":"hidden")}),st(0,sd,"fullScreenEnabled",null,function(sd){var sL=si.document,sl=sH.canvas;sd?(sl.addEventListener("mousedown",this._requestFullscreen),sl.addEventListener("touchstart",this._requestFullscreen),sL.addEventListener("fullscreenchange",this._fullScreenChanged),sL.addEventListener("mozfullscreenchange",this._fullScreenChanged),sL.addEventListener("webkitfullscreenchange",this._fullScreenChanged),sL.addEventListener("msfullscreenchange",this._fullScreenChanged)):(sl.removeEventListener("mousedown",this._requestFullscreen),sl.removeEventListener("touchstart",this._requestFullscreen),sL.removeEventListener("fullscreenchange",this._fullScreenChanged),sL.removeEventListener("mozfullscreenchange",this._fullScreenChanged),sL.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),sL.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),sN.SCALE_NOSCALE="noscale",sN.SCALE_EXACTFIT="exactfit",sN.SCALE_SHOWALL="showall",sN.SCALE_NOBORDER="noborder",sN.SCALE_FULL="full",sN.SCALE_FIXED_WIDTH="fixedwidth",sN.SCALE_FIXED_HEIGHT="fixedheight",sN.SCALE_FIXED_AUTO="fixedauto",sN.ALIGN_LEFT="left",sN.ALIGN_RIGHT="right",sN.ALIGN_CENTER="center",sN.ALIGN_TOP="top",sN.ALIGN_MIDDLE="middle",sN.ALIGN_BOTTOM="bottom",sN.SCREEN_NONE="none",sN.SCREEN_HORIZONTAL="horizontal",sN.SCREEN_VERTICAL="vertical",sN.FRAME_FAST="fast",sN.FRAME_SLOW="slow",sN.FRAME_MOUSE="mouse",sN.FRAME_SLEEP="sleep",sN.FRAME_MOUSE_THREDHOLD=2e3,su(sN,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),sN}(sbd),sed=(function(sd){function sL(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,sL.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}sr(sL,"laya.media.SoundNode",sbd);var sl=sL.prototype;sl._onParentChange=function(){this.target=this.parent},sl.play=function(sd,sL){void 0===sd&&(sd=1),isNaN(sd)&&(sd=1),this.url&&(this.stop(),this._channel=sg.playSound(this.url,sd,null,sL))},sl.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},sl._setPlayAction=function(sd,sL,sl,sZ){void 0===sZ&&(sZ=!0),this[sl]&&sd&&(sZ?sd.on(sL,this,this[sl]):sd.off(sL,this,this[sl]))},sl._setPlayActions=function(sd,sL,sl,sZ){if(void 0===sZ&&(sZ=!0),sd&&sL){var sh,s_=sL.split(","),sN=0;for(sh=s_.length,sN=0;sN<sh;sN++)this._setPlayAction(sd,s_[sN],sl,sZ)}},st(0,sl,"playEvent",null,function(sd){(this._playEvents=sd)&&this._tar&&this._setPlayActions(this._tar,sd,"play")}),st(0,sl,"target",null,function(sd){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=sd,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),st(0,sl,"stopEvent",null,function(sd){(this._stopEvents=sd)&&this._tar&&this._setPlayActions(this._tar,sd,"stop")})}(),function(sd){function sL(){this._src=null,this._onload=null,this._onerror=null,sL.__super.call(this)}sr(sL,"laya.resource.FileBitmap",scd);var sl=sL.prototype;return st(0,sl,"src",function(){return this._src},function(sd){this._src=sd}),st(0,sl,"onload",null,function(sd){}),st(0,sl,"onerror",null,function(sd){}),sL}()),swd=function(sd){function sl(sd,sL){this._is2D=!1,sl.__super.call(this);var sZ=this;if(this._source=this,"2D"===sd||"AUTO"===sd&&!sH.isWebGL){this._is2D=!0,this._source=sL||si.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var sh=this;sh.getContext=function(sd,sL){if(sZ._ctx)return sZ._ctx;var sl=sZ._ctx=sZ._source.getContext(sd,sL);return sl&&(sl._canvas=sh,sH.isFlash||si.onLimixiu||(sl.size=function(sd,sL){})),sl}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}sr(sl,"laya.resource.HTMLCanvas",scd);var sL=sl.prototype;return sL.clear=function(){this._ctx&&this._ctx.clear()},sL.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},sL.release=function(){},sL._setContext=function(sd){this._ctx=sd},sL.getContext=function(sd,sL){return this._ctx?this._ctx:this._ctx=sl._createContext(this)},sL.getMemSize=function(){return 0},sL.size=function(sd,sL){(this._w!=sd||this._h!=sL||this._source&&(this._source.width!=sd||this._source.height!=sL))&&(this._w=sd,this._h=sL,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(sd,sL),this._source&&(this._source.height=sL,this._source.width=sd))},sL.getCanvas=function(){return this._source},sL.toBase64=function(sd,sL,sl){if(this._source)if(sH.isConchApp&&this._source.toBase64)this._source.toBase64(sd,sL,sl);else{var sZ=this._source.toDataURL(sd,sL);sl.call(this,sZ)}},st(0,sL,"context",function(){return this._ctx}),st(0,sL,"asBitmap",null,function(sd){}),sl.create=function(sd,sL){return new sl(sd,sL)},sl.TYPE2D="2D",sl.TYPE3D="3D",sl.TYPEAUTO="AUTO",sl._createContext=null,sl}(),ssd=(function(sd){function su(sd,sL,sl,sZ,sh,s_,sN,sm){throw su.__super.call(this),new Error("不允许new！")}sr(su,"laya.resource.HTMLSubImage",scd),su.create=function(sd,sL,sl,sZ,sh,s_,sN,sm){return void 0===sm&&(sm=!1),new su(sd,sL,sl,sZ,sh,s_,sN,sm)}}(),function(sd){function sb(){this._frames=null,this._url=null,sb.__super.call(this),this._setControlNode(this)}sr(sb,"laya.display.Animation",sd);var sL=sb.prototype;sL.destroy=function(sd){void 0===sd&&(sd=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,sd),this._frames=null,this._labels=null},sL.play=function(sd,sL,sl,sZ){void 0===sd&&(sd=0),void 0===sL&&(sL=!0),void 0===sl&&(sl=""),void 0===sZ&&(sZ=!0),sl&&this._setFramesFromCache(sl,sZ),this._isPlaying=!0,this.index="string"==typeof sd?this._getFrameByLabel(sd):sd,this.loop=sL,this._actionName=sl,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},sL._setFramesFromCache=function(sd,sL){var sl;return void 0===sL&&(sL=!1),this._url&&(sd=this._url+"#"+sd),sd&&sb.framesMap[sd]?((sl=sb.framesMap[sd])instanceof Array?(this._frames=sb.framesMap[sd],this._count=this._frames.length):(sl.nodeRoot&&(sb.framesMap[sd]=this._parseGraphicAnimationByData(sl),sl=sb.framesMap[sd]),this._frames=sl.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=sl.interval),this._labels=this._copyLabels(sl.labels)),!0):(sL&&console.log("ani not found:",sd),!1)},sL._copyLabels=function(sd){if(!sd)return null;var sL,sl;for(sl in sL={},sd)sL[sl]=sf.copyArray([],sd[sl]);return sL},sL._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&sd.prototype._frameLoop.call(this)},sL._displayToIndex=function(sd){this._frames&&(this.graphics=this._frames[sd])},sL.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},sL.loadImages=function(sd,sL){return void 0===sL&&(sL=""),this._url="",this._setFramesFromCache(sL)||(this.frames=sb.framesMap[sL]?sb.framesMap[sL]:sb.createFrames(sd,sL)),this},sL.loadAtlas=function(sL,sl,sZ){void 0===sZ&&(sZ=""),this._url="";var sh=this;function sd(sd){sL===sd&&(sh.frames=sb.framesMap[sZ]?sb.framesMap[sZ]:sb.createFrames(sL,sZ),sl&&sl.run())}return sh._setFramesFromCache(sZ)||(smd.getAtlas(sL)?sd(sL):s$.loader.load(sL,se.create(null,sd,[sL]),null,"atlas")),this},sL.loadAnimation=function(sd,sL,sl){this._url=sd;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,sL&&sL.run()):!sl||smd.getAtlas(sl)?this._loadAnimationData(sd,sL,sl):s$.loader.load(sl,se.create(this,this._loadAnimationData,[sd,sL,sl]),null,"atlas"),this},sL._loadAnimationData=function(sm,su,sd){var sx=this;if(!sd||smd.getAtlas(sd)){var st=this;smd.getRes(sm)?sL(sm):s$.loader.load(sm,se.create(null,sL,[sm]),null,"json"),smd.clearRes(sm)}else console.warn("atlas load fail:"+sd);function sL(sd){if(smd.getRes(sd)&&sm===sd){var sL;if(sb.framesMap[sm+"#"])st._setFramesFromCache(sx._actionName,!0),sx.index=0,sx._checkResumePlaying();else{var sl=st._parseGraphicAnimation(smd.getRes(sm));if(!sl)return;var sZ,sh=sl.animationList,s_=0,sN=sh.length;for(s_=0;s_<sN;s_++)sL=sh[s_],sb.framesMap[sm+"#"+sL.name]=sL,sZ||(sZ=sL);sZ&&(sb.framesMap[sm+"#"]=sZ,st._setFramesFromCache(sx._actionName,!0),sx.index=0),sx._checkResumePlaying()}su&&su.run()}}},sL._parseGraphicAnimation=function(sd){return s$d.parseAnimationData(sd)},sL._parseGraphicAnimationByData=function(sd){return s$d.parseAnimationByData(sd)},st(0,sL,"frames",function(){return this._frames},function(sd){(this._frames=sd)&&(this._count=sd.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),st(0,sL,"autoPlay",null,function(sd){sd?this.play():this.stop()}),st(0,sL,"source",null,function(sd){-1<sd.indexOf(".ani")?this.loadAnimation(sd):-1<sd.indexOf(".json")||-1<sd.indexOf("als")||-1<sd.indexOf("atlas")?this.loadAtlas(sd):this.loadImages(sd.split(","))}),st(0,sL,"autoAnimation",null,function(sd){this.play(0,!0,sd,!1)}),sb.createFrames=function(sd,sL){var sl,sZ,sh=0,s_=0;if("string"==typeof sd){var sN=smd.getAtlas(sd);if(sN&&sN.length)for(sl=[],sh=0,s_=sN.length;sh<s_;sh++)(sZ=new sF.createGraphics).drawTexture(smd.getRes(sN[sh]),0,0),sl.push(sZ)}else if(sd instanceof Array)for(sl=[],sh=0,s_=sd.length;sh<s_;sh++)(sZ=new sF.createGraphics).loadImage(sd[sh],0,0),sl.push(sZ);return sL&&(sb.framesMap[sL]=sl),sl},sb.clearCache=function(sd){var sL,sl=sb.framesMap,sZ=sd+"#";for(sL in sl)sL!==sd&&0!=sL.indexOf(sZ)||delete sb.framesMap[sL]},sb.framesMap={}}(srd),function(sd){function s_(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,s_.__super.call(this),null==s_._sortIndexFun&&(s_._sortIndexFun=sy.sortByKey("index",!1,!0))}sr(s_,"laya.display.FrameAnimation",sd);var sL=s_.prototype;return sL._setUp=function(sd,sL){this._labels=null,this._animationNewFrames=null,this._targetDic=sd,this._animationData=sL,this.interval=1e3/sL.frameRate,sL.parsed?(this._count=sL.count,this._labels=sL.labels,this._animationNewFrames=sL.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),sL.parsed=!0,sL.labels=this._labels,sL.count=this._count,sL.animationNewFrames=this._animationNewFrames},sL.clear=function(){sd.prototype.clear.call(this),this._targetDic=null,this._animationData=null},sL._displayToIndex=function(sd){if(this._animationData){sd<0&&(sd=0),sd>this._count&&(sd=this._count);var sL=this._animationData.nodes,sl=0,sZ=sL.length;for(sl=0;sl<sZ;sl++)this._displayNodeToFrame(sL[sl],sd)}},sL._displayNodeToFrame=function(sd,sL,sl){sl||(sl=this._targetDic);var sZ=sl[sd.target];if(sZ){var sh,s_,sN,sm=sd.frames,su=sd.keys,sx=0,st=su.length;for(sx=0;sx<st;sx++)sN=(s_=sm[sh=su[sx]]).length>sL?s_[sL]:s_[s_.length-1],sZ[sh]=sN}},sL._calculateDatas=function(){if(this._animationData){var sd,sL=this._animationData.nodes,sl=0,sZ=sL.length;for(sl=this._count=0;sl<sZ;sl++)sd=sL[sl],this._calculateNodeKeyFrames(sd);this._count+=1}},sL._calculateNodeKeyFrames=function(sd){var sL,sl,sZ=sd.keyframes,sh=sd.target;for(sL in sd.frames||(sd.frames={}),sd.keys?sd.keys.length=0:sd.keys=[],sd.initValues||(sd.initValues={}),sZ)sl=sZ[sL],sd.frames[sL]||(sd.frames[sL]=[]),this._targetDic&&this._targetDic[sh]&&(sd.initValues[sL]=this._targetDic[sh][sL]),sl.sort(s_._sortIndexFun),sd.keys.push(sL),this._calculateNodePropFrames(sl,sd.frames[sL],sL,sh)},sL.resetToInitState=function(){if(this._targetDic&&this._animationData){var sd,sL,sl=this._animationData.nodes,sZ=0,sh=sl.length;for(sZ=0;sZ<sh;sZ++)if(sL=(sd=sl[sZ]).initValues){var s_,sN=this._targetDic[sd.target];if(sN)for(s_ in sL)sN[s_]=sL[s_]}}},sL._calculateNodePropFrames=function(sd,sL,sl,sZ){var sh=0,s_=sd.length-1;if(0<s_){for(sL.length=sd[s_].index+1,sh=0;sh<s_;sh++)this._dealKeyFrame(sd[sh]),this._calculateFrameValues(sd[sh],sd[sh+1],sL);this._dealKeyFrame(sd[sh])}0==s_&&(sL[sd[0].index]=sd[0].value,this._animationNewFrames&&(this._animationNewFrames[sd[0].index]=!0))},sL._dealKeyFrame=function(sd){sd.label&&""!=sd.label&&this.addLabel(sd.label,sd.index)},sL._calculateFrameValues=function(sd,sL,sl){var sZ,sh=0,s_=sd.index,sN=sL.index,sm=sd.value,su=sL.value-sd.value,sx=sN-s_;if(sN>this._count&&(this._count=sN),sd.tween)for(null==(sZ=sz[sd.tweenMethod])&&(sZ=sz.linearNone),sh=s_;sh<sN;sh++)sl[sh]=sZ(sh-s_,sm,su,sx),this._animationNewFrames&&(this._animationNewFrames[sh]=!0);else for(sh=s_;sh<sN;sh++)sl[sh]=sm;this._animationNewFrames&&(this._animationNewFrames[sd.index]=!0,this._animationNewFrames[sL.index]=!0),sl[sL.index]=sL.value},s_._sortIndexFun=null,s_}(srd)),sAd=function(sL){function sh(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",sh.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=sad.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}sr(sh,"laya.display.Input",sL);var sd=sh.prototype;return sd.setSelection=function(sd,sL){this.focus=!0,laya.display.Input.inputElement.selectionStart=sd,laya.display.Input.inputElement.selectionEnd=sL},sd._onUnDisplay=function(sd){this.focus=!1},sd._onMouseDown=function(sd){this.focus=!0},sd._syncInputTransform=function(){var sd=this.nativeInput,sL=sf.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),sl=this._width-this.padding[1]-this.padding[3],sZ=this._height-this.padding[0]-this.padding[2];sH.isConchApp?(sd.setScale(sL.scaleX,sL.scaleY),sd.setSize(sl,sZ),sd.setPos(sL.x,sL.y)):(sh.inputContainer.style.transform=sh.inputContainer.style.webkitTransform="scale("+sL.scaleX+","+sL.scaleY+") rotate("+s$.stage.canvasDegree+"deg)",sd.style.width=sl+"px",sd.style.height=sZ+"px",sh.inputContainer.style.left=sL.x+"px",sh.inputContainer.style.top=sL.y+"px")},sd.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},sd._setInputMethod=function(){sh.input.parentElement&&sh.inputContainer.removeChild(sh.input),sh.area.parentElement&&sh.inputContainer.removeChild(sh.area),sh.inputElement=this._multiline?sh.area:sh.input,sh.inputContainer.appendChild(sh.inputElement),sad.RightToLeft&&(sh.inputElement.style.direction="rtl")},sd._focusIn=function(){laya.display.Input.isInputting=!0;var sd=this.nativeInput;this._focus=!0;var sL=sd.style;sL.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),sd.readOnly=!this._editable,sH.isConchApp&&(sd.setType(this._type),sd.setForbidEdit(!this._editable)),sd.maxLength=this._maxChars;this.padding;if(sd.type=this._type,sd.value=this._content,sd.placeholder=this._prompt,s$.stage.off("keydown",this,this._onKeyDown),s$.stage.on("keydown",this,this._onKeyDown),(s$.stage.focus=this).event("focus"),si.onPC&&sd.focus(),!si.onMiniGame){this._text;this._text=null}this.typeset(),sd.setColor(this._originColor),sd.setFontSize(this.fontSize),sd.setFontFace(si.onIPhone&&sad._fontFamilyMap[this.font]||this.font),sH.isConchApp&&sd.setMultiAble&&sd.setMultiAble(this._multiline),sL.lineHeight=this.leading+this.fontSize+"px",sL.fontStyle=this.italic?"italic":"normal",sL.fontWeight=this.bold?"bold":"normal",sL.textAlign=this.align,sL.padding="0 0",this._syncInputTransform(),!sH.isConchApp&&si.onPC&&s$.timer.frameLoop(1,this,this._syncInputTransform)},sd._setPromptColor=function(){(sh.promptStyleDOM=si.getElementById("promptStyle"))||((sh.promptStyleDOM=si.createElement("style")).setAttribute("id","promptStyle"),si.document.head.appendChild(sh.promptStyleDOM)),sh.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},sd._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(s$.superSet(sad,this,"text",this._content),s$.superSet(sad,this,"color",this._originColor)):(s$.superSet(sad,this,"text",this._prompt),s$.superSet(sad,this,"color",this._promptColor)),s$.stage.off("keydown",this,this._onKeyDown),s$.stage.focus=null,this.event("blur"),sH.isConchApp&&this.nativeInput.blur(),si.onPC&&s$.timer.clear(this,this._syncInputTransform)},sd._onKeyDown=function(sd){13===sd.keyCode&&(si.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},sd.changeText=function(sd){this._content=sd,this._focus?(this.nativeInput.value=sd||"",this.event("change")):sL.prototype.changeText.call(this,sd)},st(0,sd,"color",sL.prototype._$get_color,function(sd){this._focus&&this.nativeInput.setColor(sd),s$.superSet(sad,this,"color",this._content?sd:this._promptColor),this._originColor=sd}),st(0,sd,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(sd){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),st(0,sd,"multiline",function(){return this._multiline},function(sd){this._multiline=sd,this.valign=sd?"top":"middle"}),st(0,sd,"maxChars",function(){return this._maxChars},function(sd){sd<=0&&(sd=1e5),this._maxChars=sd}),st(0,sd,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(sd){s$.superSet(sad,this,"color",this._originColor),sd+="",this._focus?(this.nativeInput.value=sd||"",this.event("change")):(this._multiline||(sd=sd.replace(/\r?\n/g,"")),(this._content=sd)?s$.superSet(sad,this,"text",sd):(s$.superSet(sad,this,"text",this._prompt),s$.superSet(sad,this,"color",this.promptColor)))}),st(0,sd,"nativeInput",function(){return this._multiline?sh.area:sh.input}),st(0,sd,"prompt",function(){return this._prompt},function(sd){!this._text&&sd&&s$.superSet(sad,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?s$.superSet(sad,this,"text",this._text==this._prompt?sd:this._text):s$.superSet(sad,this,"text",sd),this._prompt=sad.langPacks&&sad.langPacks[sd]?sad.langPacks[sd]:sd}),st(0,sd,"focus",function(){return this._focus},function(sd){var sL=this.nativeInput;this._focus!==sd&&(sd?(sL.target?sL.target._focusOut():this._setInputMethod(),(sL.target=this)._focusIn()):(sL.target=null,this._focusOut(),si.document.body.scrollTop=0,sL.blur(),sH.isConchApp?sL.setPos(-1e4,-1e4):sh.inputContainer.contains(sL)&&sh.inputContainer.removeChild(sL)))}),st(0,sd,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(sd){sd?(-1<(sd="[^"+sd+"]").indexOf("^^")&&(sd=sd.replace("^^","")),this._restrictPattern=new RegExp(sd,"g")):this._restrictPattern=null}),st(0,sd,"editable",function(){return this._editable},function(sd){this._editable=sd,sH.isConchApp&&sh.input.setForbidEdit(!sd)}),st(0,sd,"promptColor",function(){return this._promptColor},function(sd){this._promptColor=sd,this._content||s$.superSet(sad,this,"color",sd)}),st(0,sd,"type",function(){return this._type},function(sd){this._getCSSStyle().password="password"==sd,this._type=sd,sH.isConchApp&&this.nativeInput.setType(sd)}),st(0,sd,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(sd){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),st(0,sd,"asPassword",function(){return this._getCSSStyle().password},function(sd){this._getCSSStyle().password=sd,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),sh.__init__=function(){sh._createInputElement(),si.onMobile&&sH.canvas.addEventListener(sh.IOS_IFRAME?si.onMiniGame?"touchend":"click":"touchend",sh._popupInputMethod)},sh._popupInputMethod=function(sd){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},sh._createInputElement=function(){sh._initInput(sh.area=si.createElement("textarea")),sh._initInput(sh.input=si.createElement("input")),(sh.inputContainer=si.createElement("div")).style.position="absolute",sh.inputContainer.style.zIndex=1e5,si.container.appendChild(sh.inputContainer),sh.inputContainer.setPos=function(sd,sL){sh.inputContainer.style.left=sd+"px",sh.inputContainer.style.top=sL+"px"}},sh._initInput=function(sL){var sd=sL.style;sd.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",sd.resize="none",sd.backgroundColor="transparent",sd.border="none",sd.outline="none",sd.zIndex=1,sL.addEventListener("input",sh._processInputting),sL.addEventListener("mousemove",sh._stopEvent),sL.addEventListener("mousedown",sh._stopEvent),sL.addEventListener("touchmove",sh._stopEvent),sL.setFontFace=function(sd){sL.style.fontFamily=sd},sH.isConchApp||(sL.setColor=function(sd){sL.style.color=sd},sL.setFontSize=function(sd){sL.style.fontSize=sd+"px"})},sh._processInputting=function(sd){var sL=laya.display.Input.inputElement.target;if(sL){var sl=laya.display.Input.inputElement.value;sL._restrictPattern&&(sl=sl.replace(/\u2006|\x27/g,""),sL._restrictPattern.test(sl)&&(sl=sl.replace(sL._restrictPattern,""),laya.display.Input.inputElement.value=sl)),sL._text=sl,sL.event("input")}},sh._stopEvent=function(sd){"touchmove"==sd.type&&sd.preventDefault(),sd.stopPropagation&&sd.stopPropagation()},sh.TYPE_TEXT="text",sh.TYPE_PASSWORD="password",sh.TYPE_EMAIL="email",sh.TYPE_URL="url",sh.TYPE_NUMBER="number",sh.TYPE_RANGE="range",sh.TYPE_DATE="date",sh.TYPE_MONTH="month",sh.TYPE_WEEK="week",sh.TYPE_TIME="time",sh.TYPE_DATE_TIME="datetime",sh.TYPE_DATE_TIME_LOCAL="datetime-local",sh.TYPE_SEARCH="search",sh.input=null,sh.area=null,sh.inputElement=null,sh.inputContainer=null,sh.confirmButton=null,sh.promptStyleDOM=null,sh.inputHeight=45,sh.isInputting=!1,sh.stageMatrix=null,su(sh,["IOS_IFRAME",function(){return this.IOS_IFRAME=si.onIOS&&si.window.top!=si.window.self}]),sh}(sad),syd=function(sd){function sl(sd,sL){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,sl.__super.call(this),sd&&this._init_(sd,sL)}sr(sl,"laya.resource.HTMLImage",sed);var sL=sl.prototype;return sL._init_=function(sd,sL){this._src=sd,this._source=new si.window.Image,sL&&(sL.onload&&(this.onload=sL.onload),sL.onerror&&(this.onerror=sL.onerror),sL.onCreate&&sL.onCreate(this)),0!=sd.indexOf("data:image")&&(this._source.crossOrigin=""),sd&&(this._source.src=sd)},sL.recreateResource=function(){var sd=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var sL=this;this._source=new si.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(sL._needReleaseAgain)return sL._needReleaseAgain=!1,sL._source.onload=null,void(sL._source=null);sL._source.onload=null,sL.memorySize=sd._w*sd._h*4,sL._recreateLock=!1,sL.completeCreate()},this._source.src=this._src}},sL.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},sL.onresize=function(){this._w=this._source.width,this._h=this._source.height},st(0,sL,"onload",null,function(sd){var sL=this;this._onload=sd,this._source&&(this._source.onload=null!=this._onload?function(){sL.onresize(),sL._onload()}:null)}),st(0,sL,"onerror",null,function(sd){var sL=this;this._onerror=sd,this._source&&(this._source.onerror=null!=this._onerror?function(){sL._onerror()}:null)}),st(0,sL,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(sd){this._enableMerageInAtlas=sd,sH.isConchApp&&this._source&&(this._source.enableMerageInAtlas=sd)}),sl.create=function(sd,sL){return new sl(sd,sL)},sl}(),s$d=(function(s_){function sd(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,sd.__super.call(this)}sr(sd,"laya.display.EffectAnimation",s_);var sL=sd.prototype;sL._onOtherBegin=function(sd){sd!=this&&this.stop()},sL.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},sL._onPlayAction=function(){this.play(0,!1)},sL.play=function(sd,sL,sl,sZ){void 0===sd&&(sd=0),void 0===sL&&(sL=!0),void 0===sl&&(sl=""),void 0===sZ&&(sZ=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,sd,sL,sl,sZ))},sL._recordInitData=function(){if(this._aniKeys){var sd,sL,sl=0;for(sd=this._aniKeys.length,sl=0;sl<sd;sl++)sL=this._aniKeys[sl],this._initData[sL]=this._target[sL]}},sL._displayToIndex=function(sd){if(this._animationData){sd<0&&(sd=0),sd>this._count&&(sd=this._count);var sL=this._animationData.nodes,sl=0,sZ=sL.length;for(sZ=1<sZ?1:sZ,sl=0;sl<sZ;sl++)this._displayNodeToFrame(sL[sl],sd)}},sL._displayNodeToFrame=function(sd,sL,sl){if(this._target){var sZ;sZ=this._target;var sh,s_,sN,sm,su=sd.frames,sx=sd.keys,st=0,sb=sx.length;sm=sd.secondFrames;var sq,sY,sc,sr,sa=0;for(st=0;st<sb;st++)s_=su[sh=sx[st]],sN=-1==(sa=sm[sh])?this._initData[sh]:sL<sa?(sc=(sY=sd.keyframes[sh])[0]).tween?(null==(sq=sz[sc.tweenMethod])&&(sq=sz.linearNone),sr=sY[1],sq(sL,this._initData[sh],sr.value-this._initData[sh],sr.index)):this._initData[sh]:s_.length>sL?s_[sL]:s_[s_.length-1],sZ[sh]=sN}},sL._calculateNodeKeyFrames=function(sd){s_.prototype._calculateNodeKeyFrames.call(this,sd);var sL,sl,sZ,sh=sd.keyframes;sd.target;for(sL in sZ={},sd.secondFrames=sZ,sh)(sl=sh[sL]).length<=1?sZ[sL]=-1:sZ[sL]=sl[1].index},st(0,sL,"target",function(){return this._target},function(sd){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=sd,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),st(0,sL,"playEvent",null,function(sd){(this._playEvents=sd)&&this.addEvent()}),st(0,sL,"effectData",null,function(sd){var sL;sd&&((sL=sd.animations)&&sL[0]&&(this._setUp({},sL[0]),sL[0].nodes&&sL[0].nodes[0]&&(this._aniKeys=sL[0].nodes[0].keys)))}),st(0,sL,"effectClass",null,function(sd){var sL,sl;(this._effectClass=sC.getClass(sd),this._effectClass)&&((sL=this._effectClass.uiView)&&(sl=sL.animations)&&sl[0]&&(this._setUp({},sl[0]),sl[0].nodes&&sl[0].nodes[0]&&(this._aniKeys=sl[0].nodes[0].keys)))}),sd.EffectAnimationBegin="effectanimationbegin"}(ssd),function(sL){var sQ;function sg(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,sg.__super.call(this)}sr(sg,"laya.utils.GraphicAnimation",sL);var sd=sg.prototype;return sd._parseNodeList=function(sd){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[sd.compId]=sd.props,sd.compId&&this._nodeList.push(sd.compId);var sL=sd.child;if(sL){var sl=0,sZ=sL.length;for(sl=0;sl<sZ;sl++)this._parseNodeList(sL[sl])}},sd._calGraphicData=function(sd){var sL;if(this._setUp(null,sd),this._createGraphicData(),this._nodeIDAniDic)for(sL in this._nodeIDAniDic)this._nodeIDAniDic[sL]=null},sd._createGraphicData=function(){var sd,sL=[],sl=0,sZ=this.count,sh=this._animationNewFrames;for(sh||(sh=[]),sl=0;sl<sZ;sl++)!sh[sl]&&sd||(sd=this._createFrameGraphic(sl)),sL.push(sd);this._gList=sL},sd._createFrameGraphic=function(sd){var sL=sF.createGraphics();return sg._rootMatrix||(sg._rootMatrix=new sE),this._updateNodeGraphic(this._rootNode,sd,sg._rootMatrix,sL),sL},sd._updateNodeGraphic=function(sd,sL,sl,sZ,sh){var s_;void 0===sh&&(sh=1);var sN,sm,su,sx=(s_=this._nodeGDic[sd.compId]=this._getNodeGraphicData(sd.compId,sL,this._nodeGDic[sd.compId])).alpha*sh;if(!(sx<.01)&&(s_.resultTransform||(s_.resultTransform=sE.create()),sN=s_.resultTransform,sE.mul(s_.transform,sl,sN),s_.skin&&(sm=this._getTextureByUrl(s_.skin))&&(sN._checkTransform()?(sZ.drawTexture(sm,0,0,s_.width,s_.height,sN,sx),s_.resultTransform=null):sZ.drawTexture(sm,sN.tx,sN.ty,s_.width,s_.height,null,sx)),su=sd.child)){var st,sb=0;for(st=su.length,sb=0;sb<st;sb++)this._updateNodeGraphic(su[sb],sL,sN,sZ,sx)}},sd._updateNoChilds=function(sd,sL){if(sd.skin){var sl=this._getTextureByUrl(sd.skin);if(sl){var sZ=sd.transform;sZ._checkTransform();!sZ.bTransform?sL.drawTexture(sl,sZ.tx,sZ.ty,sd.width,sd.height,null,sd.alpha):sL.drawTexture(sl,0,0,sd.width,sd.height,sZ.clone(),sd.alpha)}}},sd._updateNodeGraphic2=function(sd,sL,sl){var sZ;if(sZ=this._nodeGDic[sd.compId]=this._getNodeGraphicData(sd.compId,sL,this._nodeGDic[sd.compId]),sd.child){var sh=sZ.transform;sh._checkTransform();var s_,sN;sN=(s_=!sh.bTransform)&&(0!=sh.tx||0!=sh.ty);var sm,su,sx;if((sm=sh.bTransform||1!=sZ.alpha)&&sl.save(),1!=sZ.alpha&&sl.alpha(sZ.alpha),s_?sN&&sl.translate(sh.tx,sh.ty):sl.transform(sh.clone()),su=sd.child,sZ.skin&&(sx=this._getTextureByUrl(sZ.skin))&&sl.drawTexture(sx,0,0,sZ.width,sZ.height),su){var st,sb=0;for(st=su.length,sb=0;sb<st;sb++)this._updateNodeGraphic2(su[sb],sL,sl)}sm?sl.restore():s_?sN&&sl.translate(-sh.tx,-sh.ty):sl.transform(sh.clone().invert())}else this._updateNoChilds(sZ,sl)},sd._calculateNodeKeyFrames=function(sd){sL.prototype._calculateNodeKeyFrames.call(this,sd),this._nodeIDAniDic[sd.target]=sd},sd.getNodeDataByID=function(sd){return this._nodeIDAniDic[sd]},sd._getParams=function(sd,sL,sl,sZ){var sh=sg._temParam;sh.length=sL.length;var s_=0,sN=sL.length;for(s_=0;s_<sN;s_++)sh[s_]=this._getObjVar(sd,sL[s_][0],sl,sL[s_][1],sZ);return sh},sd._getObjVar=function(sd,sL,sl,sZ,sh){if(sd.hasOwnProperty(sL)){var s_=sd[sL];if(sl>=s_.length&&(sl=s_.length-1),null!=sd[sL][sl])return sd[sL][sl]}return sh.hasOwnProperty(sL)?sh[sL]:sZ},sd._getNodeGraphicData=function(sd,sL,sl){sl||(sl=sQ.create()),sl.transform?sl.transform.identity():sl.transform=sE.create();var sZ=this.getNodeDataByID(sd);if(!sZ)return sl;var sh,s_,sN=sZ.frames,sm=this._getParams(sN,sg._drawTextureCmd,sL,this._nodeDefaultProps[sd]),su=sm[0],sx=NaN,st=NaN,sb=sm[5],sq=sm[6],sY=sm[13],sc=sm[14],sr=sm[7],sa=sm[8],sk=sm[9],se=sm[11],sw=sm[12];sx=sm[3],st=sm[4],0!=sx&&0!=st||(su=null),-1==sx&&(sx=0),-1==st&&(st=0),sl.skin=su,sl.width=sx,sl.height=st,su&&((sh=this._getTextureByUrl(su))?(sx||(sx=sh.sourceWidth),st||(st=sh.sourceHeight)):console.warn("lost skin:",su,",you may load pics first")),sl.alpha=sm[10],s_=sl.transform,0!=sY&&(sb=sY*sx),0!=sc&&(sq=sc*st),0==sb&&0==sq||s_.translate(-sb,-sq);var ss=null;if(sk||1!==sr||1!==sa||se||sw){(ss=sg._tempMt).identity(),ss.bTransform=!0;var sA=.0174532922222222*(sk-se),sy=.0174532922222222*(sk+sw),s$=Math.cos(sy),sO=Math.sin(sy),sn=Math.sin(sA),sV=Math.cos(sA);ss.a=sr*s$,ss.b=sr*sO,ss.c=-sa*sn,ss.d=sa*sV,ss.tx=ss.ty=0}return ss&&(s_=sE.mul(s_,ss,s_)),s_.translate(sm[1],sm[2]),sl},sd._getTextureByUrl=function(sd){return smd.getRes(sd)},sd.setAniData=function(sd,sL){if(sd.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=sd,this._parseNodeList(sd);var sl,sZ={},sh=[],s_=sd.animations,sN=0,sm=s_.length;for(sN=0;sN<sm;sN++)if(sl=s_[sN],this._labels=null,(!sL||sL==sl.name)&&sl){try{this._calGraphicData(sl)}catch(sd){console.warn("parse animation fail:"+sl.name+",empty animation created"),this._gList=[]}var su={};su.interval=1e3/sl.frameRate,su.frames=this._gList,su.labels=this._labels,su.name=sl.name,sh.push(su),sZ[sl.name]=su}this.animationList=sh,this.animationDic=sZ}sg._temParam.length=0},sd.parseByData=function(sd){var sL,sl;sL=sd.nodeRoot,sl=sd.aniO,delete sd.nodeRoot,delete sd.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=sL,this._parseNodeList(sL),this._labels=null;try{this._calGraphicData(sl)}catch(sd){console.warn("parse animation fail:"+sl.name+",empty animation created"),this._gList=[]}var sZ=sd;return sZ.interval=1e3/sl.frameRate,sZ.frames=this._gList,sZ.labels=this._labels,sZ.name=sl.name,sZ},sd.setUpAniData=function(sd){if(sd.animations){var sL,sl={},sZ=[],sh=sd.animations,s_=0,sN=sh.length;for(s_=0;s_<sN;s_++)if(sL=sh[s_]){var sm={};sm.name=sL.name,sm.aniO=sL,sm.nodeRoot=sd,sZ.push(sm),sl[sL.name]=sm}this.animationList=sZ,this.animationDic=sl}},sd._clear=function(){var sd,sL;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(sd in this._nodeGDic)(sL=this._nodeGDic[sd])&&sL.recover();this._nodeGDic=null},sg.parseAnimationByData=function(sd){var sL;return sg._I||(sg._I=new sg),sL=sg._I.parseByData(sd),sg._I._clear(),sL},sg.parseAnimationData=function(sd){var sL;return sg._I||(sg._I=new sg),sg._I.setUpAniData(sd),(sL={}).animationList=sg._I.animationList,sL.animationDic=sg._I.animationDic,sg._I._clear(),sL},sg._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],sg._temParam=[],sg._I=null,sg._rootMatrix=null,su(sg,["_tempMt",function(){return this._tempMt=new sE}]),sg.__init$=function(){sQ=function(){function sd(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return sr(sd,""),sd.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),sG.recover("GraphicNode",this)},sd.create=function(){return sG.getItemByClass("GraphicNode",sd)},sd}()},sg}(ssd));s$.__init([sx,sud,sH,si,sv,sV,sd,s$d])}(window,document,Laya),function(sd,sL,sl){sl.un,sl.uns,sl.static;var sZ=sl.class;sl.getset,sl.__newvec;new(function(){function sd(){}return sZ(sd,"LayaMain"),sd}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(sd,sL){"use strict";for(var sl in Object.defineProperty(sL,"__esModule",{value:!0}),Laya){var sZ=Laya[sl];sZ&&sZ.__isclass&&(sL[sl]=sZ)}}),function(sd,sL,sy){sy.un,sy.uns;var sN=sy.static,sq=sy.class,sZ=sy.getset,s_=sy.__newvec,st=laya.maths.Arith,sb=laya.maths.Bezier,sl=laya.resource.Bitmap,sY=laya.utils.Browser,su=laya.utils.Byte,sc=laya.utils.Color,s$=(laya.filters.ColorFilter,sy.Config),sh=laya.resource.Context,sO=(laya.events.Event,laya.filters.Filter),sm=laya.display.Graphics,sx=laya.resource.HTMLCanvas,sr=(laya.utils.HTMLChar,laya.resource.HTMLImage),sa=laya.resource.HTMLSubImage,sn=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),sV=laya.maths.Point,sQ=laya.maths.Rectangle,sk=laya.renders.Render,se=(laya.renders.RenderContext,laya.renders.RenderSprite),sw=laya.resource.Resource,ss=laya.resource.ResourceManager,sA=laya.utils.RunDriver,sg=laya.display.Sprite,sF=laya.display.Stage,sE=laya.utils.Stat,sI=laya.utils.StringKey,sp=(laya.display.css.Style,laya.system.System),sH=laya.display.Text,sX=laya.resource.Texture,sj=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),sR=laya.utils.VectorGraphManager;laya.utils.WordText;sy.interface("laya.webgl.shapes.IShape"),sy.interface("laya.webgl.submit.ISubmit"),sy.interface("laya.webgl.text.ICharSegment"),sy.interface("laya.webgl.canvas.save.ISaveData"),sy.interface("laya.webgl.resource.IMergeAtlasBitmap"),sy.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var so=function(){function sd(){}sq(sd,"laya.filters.webgl.FilterActionGL");var sL=sd.prototype;return sy.imps(sL,{"laya.filters.IFilterActionGL":!0}),sL.setValue=function(sd){},sL.setValueMix=function(sd){},sL.apply3d=function(sd,sL,sl,sZ,sh){return null},sL.apply=function(sd){return null},sZ(0,sL,"typeMix",function(){return 0}),sd}(),si=function(){function sd(){}return sq(sd,"laya.webgl.shader.ShaderValue"),sd}(),sS=function(){var sZ,sh;function sd(sd,sL,sl){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new sh,void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),this._cells=null,this._rowInfo=null,this._init(sd,sL),this._atlasID=sl}sq(sd,"laya.webgl.atlas.AtlasGrid");var sL=sd.prototype;return sL.getAltasID=function(){return this._atlasID},sL.setAltasID=function(sd){0<=sd&&(this._atlasID=sd)},sL.addTex=function(sd,sL,sl){var sZ=this._get(sL,sl);return 0==sZ.ret||(this._fill(sZ.x,sZ.y,sL,sl,sd),this._texCount++),sZ},sL._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},sL._init=function(sd,sL){if(this._width=sd,this._height=sL,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=s_(this._height);for(var sl=0;sl<this._height;sl++)this._rowInfo[sl]=new sZ;return this._clear(),!0},sL._get=function(sd,sL){var sl=new sC;if(sd>=this._failSize.width&&sL>=this._failSize.height)return sl;for(var sZ=-1,sh=-1,s_=this._width,sN=this._height,sm=this._cells,su=0;su<sN;su++)if(!(this._rowInfo[su].spaceCount<sd))for(var sx=0;sx<s_;){var st=3*(su*s_+sx);if(0!=sm[st]||sm[1+st]<sd||sm[2+st]<sL)sx+=sm[1+st];else{sZ=sx,sh=su;for(var sb=0;sb<sd;sb++)if(sm[3*sb+st+2]<sL){sZ=-1;break}if(!(sZ<0))return sl.ret=!0,sl.x=sZ,sl.y=sh,sl;sx+=sm[1+st]}}return sl},sL._fill=function(sd,sL,sl,sZ,sh){var s_=this._width,sN=this._height;this._check(sd+sl<=s_&&sL+sZ<=sN);for(var sm=sL;sm<sZ+sL;++sm){this._check(this._rowInfo[sm].spaceCount>=sl),this._rowInfo[sm].spaceCount-=sl;for(var su=0;su<sl;su++){var sx=3*(sd+sm*s_+su);this._check(0==this._cells[sx]),this._cells[sx]=sh,this._cells[1+sx]=sl,this._cells[2+sx]=sZ}}if(0<sd)for(sm=0;sm<sZ;++sm){var st=0;for(su=sd-1;0<=su&&0==this._cells[3*((sL+sm)*s_+su)];--su,++st);for(su=st;0<su;--su)this._cells[3*((sL+sm)*s_+sd-su)+1]=su,this._check(0<su)}if(0<sL)for(su=sd;su<sd+sl;++su){for(st=0,sm=sL-1;0<=sm&&0==this._cells[3*(su+sm*s_)];--sm,st++);for(sm=st;0<sm;--sm)this._cells[3*(su+(sL-sm)*s_)+2]=sm,this._check(0<sm)}},sL._check=function(sd){0==sd&&console.log("xtexMerger 错误啦")},sL._clear=function(){for(var sd=this._texCount=0;sd<this._height;sd++)this._rowInfo[sd].spaceCount=this._width;for(var sL=0;sL<this._height;sL++)for(var sl=0;sl<this._width;sl++){var sZ=3*(sL*this._width+sl);this._cells[sZ]=0,this._cells[1+sZ]=this._width-sl,this._cells[2+sZ]=this._width-sL}this._failSize.width=this._width+1,this._failSize.height=this._height+1},sd.__init$=function(){sZ=function(){function sd(){this.spaceCount=0}return sq(sd,""),sd}(),sh=function(){function sd(){this.width=0,this.height=0}return sq(sd,""),sd}()},sd}(),sB=function(){function sk(sd,sL,sl,sZ){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=sd,this._height=sL,this._gridSize=sl,this._maxAtlaserCount=sZ,this._gridNumX=sd/sl,this._gridNumY=sL/sl,this._curAtlasIndex=0,this._atlaserArray=[]}sq(sk,"laya.webgl.atlas.AtlasResourceManager");var sd=sk.prototype;return sd.setAtlasParam=function(sd,sL,sl,sZ){if(1==this._setAtlasParam)return sk._sid_=0,this._width=sd,this._height=sL,this._gridSize=sl,this._maxAtlaserCount=sZ,this._gridNumX=sd/sl,this._gridNumY=sL/sl,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},sd.pushData=function(sd){var sL,sl=sd.bitmap,sZ=-1,sh=null,s_=0,sN=0;for(s_=0,sL=this._atlaserArray.length;s_<sL&&(sN=(this._curAtlasIndex+s_)%sL,-1==(sZ=(sh=this._atlaserArray[sN]).findBitmapIsExist(sl)));s_++);if(-1!=sZ){var sm=sh.InAtlasWebGLImagesOffsetValue[sZ];return sc=sm[0],sr=sm[1],sh.addToAtlas(sd,sc,sr),!0}this._setAtlasParam=!1;for(var su=Math.ceil((sd.bitmap.width+2)/this._gridSize),sx=Math.ceil((sd.bitmap.height+2)/this._gridSize),st=!1,sb=0;sb<2;sb++){var sq=this._maxAtlaserCount;for(s_=0;s_<sq;s_++){sN=(this._curAtlasIndex+s_)%sq,this._atlaserArray.length-1>=sN||this._atlaserArray.push(new sQd(this._gridNumX,this._gridNumY,this._width,this._height,sk._sid_++));var sY=this._atlaserArray[sN],sc=0,sr=0,sa=sY.addTex(1,su,sx);if(sa.ret){sc=sa.x*this._gridSize+1,sr=sa.y*this._gridSize+1,sl.lock=!0,sY.addToAtlasTexture(sl,sc,sr),sY.addToAtlas(sd,sc,sr),st=!0,this._curAtlasIndex=sN;break}}if(st)break;this._atlaserArray.push(new sQd(this._gridNumX,this._gridNumY,this._width,this._height,sk._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return st||console.log(">>>AtlasManager pushData error"),st},sd.addToAtlas=function(sd){laya.webgl.atlas.AtlasResourceManager.instance.pushData(sd)},sd.garbageCollection=function(){if(!0===this._needGC){for(var sd=this._atlaserArray.length-this._maxAtlaserCount,sL=0;sL<sd;sL++)this._atlaserArray[sL].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+sd),this._atlaserArray.splice(0,sd),this._needGC=!1}return!0},sd.freeAll=function(){for(var sd=0,sL=this._atlaserArray.length;sd<sL;sd++)this._atlaserArray[sd].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},sd.getAtlaserCount=function(){return this._atlaserArray.length},sd.getAtlaserByIndex=function(sd){return this._atlaserArray[sd]},sZ(1,sk,"instance",function(){return sk._Instance||(sk._Instance=new sk(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),sk._Instance}),sZ(1,sk,"enabled",function(){return s$.atlasEnable}),sZ(1,sk,"atlasLimitWidth",function(){return sk._atlasLimitWidth},function(sd){sk._atlasLimitWidth=sd}),sZ(1,sk,"atlasLimitHeight",function(){return sk._atlasLimitHeight},function(sd){sk._atlasLimitHeight=sd}),sk._enable=function(){s$.atlasEnable=!0},sk._disable=function(){s$.atlasEnable=!1},sk.__init__=function(){sk.atlasTextureWidth=2048,sk.atlasTextureHeight=2048,sk.maxTextureCount=6,sk.atlasLimitWidth=512,sk.atlasLimitHeight=512},sk._atlasLimitWidth=0,sk._atlasLimitHeight=0,sk.gridSize=16,sk.atlasTextureWidth=0,sk.atlasTextureHeight=0,sk.maxTextureCount=0,sk._atlasRestore=0,sk.BOARDER_TYPE_NO=0,sk.BOARDER_TYPE_RIGHT=1,sk.BOARDER_TYPE_LEFT=2,sk.BOARDER_TYPE_BOTTOM=4,sk.BOARDER_TYPE_TOP=8,sk.BOARDER_TYPE_ALL=15,sk._sid_=0,sk._Instance=null,sk}(),sC=function(){function sd(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return sq(sd,"laya.webgl.atlas.MergeFillInfo"),sd}(),sP=function(){function sL(){}return sq(sL,"laya.webgl.canvas.BlendMode"),sL._init_=function(sd){sL.fns=[sL.BlendNormal,sL.BlendAdd,sL.BlendMultiply,sL.BlendScreen,sL.BlendOverlay,sL.BlendLight,sL.BlendMask,sL.BlendDestinationOut],sL.targetFns=[sL.BlendNormalTarget,sL.BlendAddTarget,sL.BlendMultiplyTarget,sL.BlendScreenTarget,sL.BlendOverlayTarget,sL.BlendLightTarget,sL.BlendMask,sL.BlendDestinationOut]},sL.BlendNormal=function(sd){sd.blendFunc(1,771)},sL.BlendAdd=function(sd){sd.blendFunc(1,772)},sL.BlendMultiply=function(sd){sd.blendFunc(774,771)},sL.BlendScreen=function(sd){sd.blendFunc(1,1)},sL.BlendOverlay=function(sd){sd.blendFunc(1,769)},sL.BlendLight=function(sd){sd.blendFunc(1,1)},sL.BlendNormalTarget=function(sd){sd.blendFunc(1,771)},sL.BlendAddTarget=function(sd){sd.blendFunc(1,772)},sL.BlendMultiplyTarget=function(sd){sd.blendFunc(774,771)},sL.BlendScreenTarget=function(sd){sd.blendFunc(1,1)},sL.BlendOverlayTarget=function(sd){sd.blendFunc(1,769)},sL.BlendLightTarget=function(sd){sd.blendFunc(1,1)},sL.BlendMask=function(sd){sd.blendFunc(0,770)},sL.BlendDestinationOut=function(sd){sd.blendFunc(0,0)},sL.activeBlendFunction=null,sL.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],sL.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},sL.NORMAL="normal",sL.ADD="add",sL.MULTIPLY="multiply",sL.SCREEN="screen",sL.LIGHT="light",sL.OVERLAY="overlay",sL.DESTINATIONOUT="destination-out",sL.fns=[],sL.targetFns=[],sL}(),sT=function(){function sl(sd){this._color=sc.create("black"),this.setValue(sd)}sq(sl,"laya.webgl.canvas.DrawStyle");var sd=sl.prototype;return sd.setValue=function(sd){if(sd){if("string"==typeof sd)return void(this._color=sc.create(sd));if(sd instanceof laya.utils.Color)return void(this._color=sd)}},sd.reset=function(){this._color=sc.create("black")},sd.equal=function(sd){return"string"==typeof sd?this._color.strColor===sd:sd instanceof laya.utils.Color&&this._color.numColor===sd.numColor},sd.toColorStr=function(){return this._color.strColor},sl.create=function(sd){var sL;if(sd&&("string"==typeof sd?sL=sc.create(sd):sd instanceof laya.utils.Color&&(sL=sd),sL))return sL._drawStyle||(sL._drawStyle=new sl(sd));return laya.webgl.canvas.DrawStyle.DEFAULT},sN(sl,["DEFAULT",function(){return this.DEFAULT=new sl("#000000")}]),sl}(),sz=function(){function sd(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];ssd.mainContext;this.ib=sWd.create(35048),this.vb=sMd.create(5)}sq(sd,"laya.webgl.canvas.Path");var sL=sd.prototype;return sL.addPoint=function(sd,sL){this.tempArray.push(sd,sL)},sL.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},sL.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},sL.polygon=function(sd,sL,sl,sZ,sh,s_){var sN;return this.geomatrys.push(this._curGeomatry=sN=new sId(sd,sL,sl,sZ,sh,s_)),sZ||(sN.fill=!1),null==s_&&(sN.borderWidth=0),sN},sL.setGeomtry=function(sd){this.geomatrys.push(this._curGeomatry=sd)},sL.drawLine=function(sd,sL,sl,sZ,sh){var s_;return this.closePath?this.geomatrys.push(this._curGeomatry=s_=new sEd(sd,sL,sl,sZ,sh)):this.geomatrys.push(this._curGeomatry=s_=new sFd(sd,sL,sl,sZ,sh)),s_.fill=!1,s_},sL.update=function(){var sd=this.ib._byteLength,sL=this.geomatrys.length;this.offset=sd;for(var sl=this.geoStart;sl<sL;sl++)this.geomatrys[sl].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=sL,this.count=(this.ib._byteLength-sd)/srd.BYTES_PIDX},sL.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},sL.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},sd}(),sD=function(){function sm(){}sq(sm,"laya.webgl.canvas.save.SaveBase");var sd=sm.prototype;return sy.imps(sd,{"laya.webgl.canvas.save.ISaveData":!0}),sd.isSaveMark=function(){return!1},sd.restore=function(sd){this._dataObj[this._valueName]=this._value,(sm._cache[sm._cache._length++]=this)._newSubmit&&(sd._curSubmit=s_d.RENDERBASE,sd._renderKey=0)},sm._createArray=function(){var sd=[];return sd._length=0,sd},sm._init=function(){var sd=sm._namemap={};return sd[1]="ALPHA",sd[2]="fillStyle",sd[8]="font",sd[256]="lineWidth",sd[512]="strokeStyle",sd[8192]="_mergeID",sd[1024]=sd[2048]=sd[4096]=[],sd[16384]="textBaseline",sd[32768]="textAlign",sd[65536]="_nBlendType",sd[1048576]="shader",sd[2097152]="filters",sd},sm.save=function(sd,sL,sl,sZ){if((sd._saveMark._saveuse&sL)!==sL){sd._saveMark._saveuse|=sL;var sh=sm._cache,s_=0<sh._length?sh[--sh._length]:new sm;s_._value=sl[s_._valueName=sm._namemap[sL]],s_._dataObj=sl,s_._newSubmit=sZ;var sN=sd._save;sN[sN._length++]=s_}},sm._cache=laya.webgl.canvas.save.SaveBase._createArray(),sm._namemap=sm._init(),sm}(),sG=function(){function s_(){this._clipRect=new sQ}sq(s_,"laya.webgl.canvas.save.SaveClipRect");var sd=s_.prototype;return sy.imps(sd,{"laya.webgl.canvas.save.ISaveData":!0}),sd.isSaveMark=function(){return!1},sd.restore=function(sd){sd._clipRect=this._clipSaveRect,(s_._cache[s_._cache._length++]=this)._submitScissor.submitLength=sd._submits._length-this._submitScissor.submitIndex,sd._curSubmit=s_d.RENDERBASE,sd._renderKey=0},s_.save=function(sd,sL){if(131072!=(131072&sd._saveMark._saveuse)){sd._saveMark._saveuse|=131072;var sl=s_._cache,sZ=0<sl._length?sl[--sl._length]:new s_;sZ._clipSaveRect=sd._clipRect,sd._clipRect=sZ._clipRect.copyFrom(sd._clipRect),sZ._submitScissor=sL;var sh=sd._save;sh[sh._length++]=sZ}},sN(s_,["_cache",function(){return this._cache=sD._createArray()}]),s_}(),sK=function(){function sY(){this._contextX=0,this._contextY=0,this._clipRect=new sQ,this._rect=new sQ,this._matrix=new sn}sq(sY,"laya.webgl.canvas.save.SaveClipRectStencil");var sd=sY.prototype;return sy.imps(sd,{"laya.webgl.canvas.save.ISaveData":!0}),sd.isSaveMark=function(){return!1},sd.restore=function(sd){std.restore(sd,this._rect,this._saveMatrix,this._contextX,this._contextY),sd._clipRect=this._clipSaveRect,sd._curMat=this._saveMatrix,sd._x=this._contextX,sd._y=this._contextY,sY._cache[sY._cache._length++]=this,sd._curSubmit=s_d.RENDERBASE},sY.save=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){if(262144!=(262144&sd._saveMark._saveuse)){sd._saveMark._saveuse|=262144;var st=sY._cache,sb=0<st._length?st[--st._length]:new sY;sb._clipSaveRect=sd._clipRect,sb._clipRect.setTo(sN,sm,su,sx),sd._clipRect=sb._clipRect,sb._rect.x=sl,sb._rect.y=sZ,sb._rect.width=sh,sb._rect.height=s_,sb._contextX=sd._x,sb._contextY=sd._y,sb._saveMatrix=sd._curMat,sd._curMat.copyTo(sb._matrix),sd._curMat=sb._matrix,sb._submitStencil=sL;var sq=sd._save;sq[sq._length++]=sb}},sN(sY,["_cache",function(){return this._cache=sD._createArray()}]),sY}(),sv=function(){function sZ(){this._saveuse=0}sq(sZ,"laya.webgl.canvas.save.SaveMark");var sd=sZ.prototype;return sy.imps(sd,{"laya.webgl.canvas.save.ISaveData":!0}),sd.isSaveMark=function(){return!0},sd.restore=function(sd){sd._saveMark=this._preSaveMark,sZ._no[sZ._no._length++]=this},sZ.Create=function(sd){var sL=sZ._no,sl=0<sL._length?sL[--sL._length]:new sZ;return sl._saveuse=0,sl._preSaveMark=sd._saveMark,sd._saveMark=sl},sN(sZ,["_no",function(){return this._no=sD._createArray()}]),sZ}(),sJ=function(){function s_(){this._matrix=new sn}sq(s_,"laya.webgl.canvas.save.SaveTransform");var sd=s_.prototype;return sy.imps(sd,{"laya.webgl.canvas.save.ISaveData":!0}),sd.isSaveMark=function(){return!1},sd.restore=function(sd){sd._curMat=this._savematrix,s_._no[s_._no._length++]=this},s_.save=function(sd){var sL=sd._saveMark;if(2048!=(2048&sL._saveuse)){sL._saveuse|=2048;var sl=s_._no,sZ=0<sl._length?sl[--sl._length]:new s_;sZ._savematrix=sd._curMat,sd._curMat=sd._curMat.copyTo(sZ._matrix);var sh=sd._save;sh[sh._length++]=sZ}},sN(s_,["_no",function(){return this._no=sD._createArray()}]),s_}(),sf=function(){function sh(){}sq(sh,"laya.webgl.canvas.save.SaveTranslate");var sd=sh.prototype;return sy.imps(sd,{"laya.webgl.canvas.save.ISaveData":!0}),sd.isSaveMark=function(){return!1},sd.restore=function(sd){sd._curMat;sd._x=this._x,sd._y=this._y,sh._no[sh._no._length++]=this},sh.save=function(sd){var sL=sh._no,sl=0<sL._length?sL[--sL._length]:new sh;sl._x=sd._x,sl._y=sd._y;var sZ=sd._save;sZ[sZ._length++]=sl},sN(sh,["_no",function(){return this._no=sD._createArray()}]),sh}(),sU=function(){function sd(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new sQ}sq(sd,"laya.webgl.resource.RenderTargetMAX");var sL=sd.prototype;return sL.setSP=function(sd){this._sp=sd},sL.size=function(sd,sL){var sl=this;this._width!==sd||this._height!==sL?(this.repaint=!0,this._width=sd,this._height=sL,this.target?this.target.size(sd,sL):this.target=sRd.create(sd,sL),this.target.hasListener("recovered")||this.target.on("recovered",this,function(sd){sy.timer.callLater(sl._sp,sl._sp.repaint)})):this.target.size(sd,sL)},sL._flushToTarget=function(sd,sL){if(!sL._destroy){var sl=sed.worldScissorTest,sZ=sed.worldClipRect;sed.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,sed.worldScissorTest=!1,ssd.mainContext.disable(3089);var sh=sed.worldAlpha,s_=sed.worldMatrix4,sN=sed.worldMatrix,sm=sed.worldFilters,su=sed.worldShaderDefines;if(sed.worldMatrix=sn.EMPTY,sed.restoreTempArray(),sed.worldMatrix4=sed.TEMPMAT4_ARRAY,sed.worldAlpha=1,sed.worldFilters=null,sed.worldShaderDefines=null,sjd.activeShader=null,sL.start(),s$.showCanvasMark?sL.clear(0,1,0,.3):sL.clear(0,0,0,0),sd.flush(),sL.end(),sjd.activeShader=null,sed.worldAlpha=sh,sed.worldMatrix4=s_,sed.worldMatrix=sN,sed.worldFilters=sm,sed.worldShaderDefines=su,sed.worldScissorTest=sl){var sx=sed.height-sZ.y-sZ.height;ssd.mainContext.scissor(sZ.x,sx,sZ.width,sZ.height),ssd.mainContext.enable(3089)}sed.worldClipRect=sZ}},sL.flush=function(sd){this.repaint&&(this._flushToTarget(sd,this.target),this.repaint=!1)},sL.drawTo=function(sd,sL,sl,sZ,sh){sd.drawTexture(this.target.getTexture(),sL,sl,sZ,sh,0,0)},sL.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},sd}(),sW=function(){function sd(){this.ALPHA=1,this.shaderType=0,this.defines=new sgd}return sq(sd,"laya.webgl.shader.d2.Shader2D"),sd.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},sd.__init__=function(){var sd,sL;svd.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),svd.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),svd.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),svd.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),svd.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),svd.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),svd.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),svd.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),sd="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",sL='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',svd.preCompile2D(0,1,sd,sL,null),sd="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",sL='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',svd.preCompile2D(0,2,sd,sL,null),sd="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",sL="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",svd.preCompile2D(0,4,sd,sL,null),sd="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",sL='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',svd.preCompile2D(0,256,sd,sL,null),sd="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",sL="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",svd.preCompile2D(0,512,sd,sL,null)},sd}(),sM=function(){function sL(sd,sL,sl){this._value=0,this._name2int=sd,this._int2name=sL,this._int2nameMap=sl}sq(sL,"laya.webgl.shader.ShaderDefines");var sd=sL.prototype;return sd.add=function(sd){return"string"==typeof sd&&(sd=this._name2int[sd]),this._value|=sd,this._value},sd.addInt=function(sd){return this._value|=sd,this._value},sd.remove=function(sd){return"string"==typeof sd&&(sd=this._name2int[sd]),this._value&=~sd,this._value},sd.isDefine=function(sd){return(this._value&sd)===sd},sd.getValue=function(){return this._value},sd.setValue=function(sd){this._value=sd},sd.toNameDic=function(){var sd=this._int2nameMap[this._value];return sd||sL._toText(this._value,this._int2name,this._int2nameMap)},sL._reg=function(sd,sL,sl,sZ){sZ[sl[sd]=sL]=sd},sL._toText=function(sd,sL,sl){var sZ=sl[sd];if(sZ)return sZ;for(var sh={},s_=1,sN=0;sN<32&&!(sd<(s_=1<<sN));sN++)if(sd&s_){var sm=sL[s_];sm&&(sh[sm]="")}return sl[sd]=sh},sL._toInt=function(sd,sL){for(var sl=sd.split("."),sZ=0,sh=0,s_=sl.length;sh<s_;sh++){var sN=sL[sl[sh]];if(!sN)throw new Error("Defines to int err:"+sd+"/"+sl[sh]);sZ|=sN}return sZ},sL}(),sdd=function(){function sN(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new sn}sq(sN,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var sd=sN.prototype;return sd.init=function(sd,sL,sl){if(sL)this._vs=sL;else{this._vs=[];var sZ=sd.width,sh=sd.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(sZ,0,1,0,1,1,1,1),this._vs.push(sZ,sh,1,1,1,1,1,1),this._vs.push(0,sh,0,1,1,1,1,1)}sl?this._ps=sl:(sN._defaultPS||(sN._defaultPS=[]).push(0,1,3,3,1,2),this._ps=sN._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=sd},sd.init2=function(sd,sL,sl,sZ,sh){this.transform&&(this.transform=null),sl?this._ps=sl:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=sZ,this._uvs=sh,this.mEleNum=this._ps.length,this.mTexture=sd,(sk.isConchNode||sk.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},sd._initMyData=function(){var sd=0,sL=0,sl=4*this._verticles.length;this._vs=sN._tempVS;var sZ=!1;if(sk.isConchNode||sk.isConchApp?(this._vs.length=sl,sZ=!0):this._vs.length<sl&&(this._vs.length=sl,sZ=!0),sN._tVSLen=sl,sZ)for(;sd<sl;)this._vs[sd]=this._verticles[sL],this._vs[sd+1]=this._verticles[sL+1],this._vs[sd+2]=this._uvs[sL],this._vs[sd+3]=this._uvs[sL+1],this._vs[sd+4]=1,this._vs[sd+5]=1,this._vs[sd+6]=1,this._vs[sd+7]=1,sd+=8,sL+=2;else for(;sd<sl;)this._vs[sd]=this._verticles[sL],this._vs[sd+1]=this._verticles[sL+1],this._vs[sd+2]=this._uvs[sL],this._vs[sd+3]=this._uvs[sL+1],sd+=8,sL+=2},sd.getData2=function(sd,sL,sl){var sZ;this.mVBBuffer=sd,this.mIBBuffer=sL,this._initMyData(),sd.appendEx2(this._vs,Float32Array,sN._tVSLen,4),this._indexStart=sL._byteLength,(sZ=sN._tempIB).length<this._ps.length&&(sZ.length=this._ps.length);for(var sh=0,s_=this._ps.length;sh<s_;sh++)sZ[sh]=this._ps[sh]+sl;sL.appendEx2(sZ,Uint16Array,this._ps.length,2)},sd.getData=function(sd,sL,sl){if(this.mVBBuffer=sd,this.mIBBuffer=sL,sd.append(this.mVBData),this._indexStart=sL._byteLength,this.mIBData.start!=sl){for(var sZ=0,sh=this._ps.length;sZ<sh;sZ++)this.mIBData[sZ]=this._ps[sZ]+sl;this.mIBData.start=sl}sL.append(this.mIBData)},sd.render=function(sd,sL,sl){if(sk.isWebGL&&this.mTexture){sd._renderKey=0,sd._shader2D.glTexture=null,sLd.getInstance().addSkinMesh(this);var sZ=s_d.createShape(sd,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,sOd.create(512,0));this.transform||(this.transform=sn.EMPTY),this.transform.translate(sL,sl),sn.mul(this.transform,sd._curMat,this._tempMatrix),this.transform.translate(-sL,-sl);var sh=sZ.shaderValue,s_=sh.u_mmat2||sed.getMatrArray();sed.mat2MatArray(this._tempMatrix,s_),sh.textureHost=this.mTexture,sh.offsetX=0,sh.offsetY=0,sh.u_mmat2=s_,sh.ALPHA=sd._shader2D.ALPHA,sd._submits[sd._submits._length++]=sZ}else sk.isConchApp&&this.mTexture&&(this.transform||(this.transform=sn.EMPTY),sd.setSkinMesh&&sd.setSkinMesh(sL,sl,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},sN._tempVS=[],sN._tempIB=[],sN._defaultPS=null,sN._tVSLen=0,sN}(),sLd=function(){function sd(){this.ib=null,this.vb=null;ssd.mainContext;this.ib=sWd.create(35048),this.vb=sMd.create(8)}sq(sd,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var sL=sd.prototype;return sL.addSkinMesh=function(sd){sd.getData2(this.vb,this.ib,this.vb._byteLength/32)},sL.reset=function(){this.vb.clear(),this.ib.clear()},sd.getInstance=function(){return sd.instance=sd.instance||new sd},sd.instance=null,sd}(),sld=function(){function sd(sd,sL,sl,sZ,sh,s_,sN,sm,su){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===su&&(su=0),this.x=sd,this.y=sL,this.width=sl,this.height=sZ,this.edges=sh,this.color=s_,this.borderWidth=sN,this.borderColor=sm}sq(sd,"laya.webgl.shapes.BasePoly");var sL=sd.prototype;return sy.imps(sL,{"laya.webgl.shapes.IShape":!0}),sL.getData=function(sd,sL,sl){},sL.rebuild=function(sd){},sL.setMatrix=function(sd){},sL.needUpdate=function(sd){return!0},sL.sector=function(sd,sL,sl){var sZ=this.x,sh=this.y,s_=this.edges,sN=(this.r1-this.r0)/s_,sm=this.width,su=this.height,sx=this.color,st=(sx>>16&255)/255,sb=(sx>>8&255)/255,sq=(255&sx)/255;sd.push(sZ,sh,st,sb,sq);for(var sY=0;sY<s_+1;sY++)sd.push(sZ+Math.sin(sN*sY+this.r0)*sm,sh+Math.cos(sN*sY+this.r0)*su),sd.push(st,sb,sq);for(sY=0;sY<s_;sY++)sL.push(sl,sl+sY+1,sl+sY+2)},sL.createLine2=function(sd,sL,sl,sZ,sh,s_){var sN,sm,su,sx,st,sb,sq,sY,sc,sr,sa,sk,se,sw,ss,sA,sy,s$,sO,sn,sV=sd.concat(),sQ=sh,sg=this.borderColor,sF=(sg>>16&255)/255,sE=(sg>>8&255)/255,sI=(255&sg)/255,sp=sV.length/2,sH=sZ,sX=sl/2;su=sV[0],sx=sV[1],sr=su-(st=sV[2]),sc=(sc=-(sx-(sb=sV[3])))/(sn=Math.sqrt(sc*sc+sr*sr))*sX,sr=sr/sn*sX,sQ.push(su-sc+this.x,sx-sr+this.y,sF,sE,sI,su+sc+this.x,sx+sr+this.y,sF,sE,sI);for(var sj=1;sj<sp-1;sj++)su=sV[2*(sj-1)],sx=sV[2*(sj-1)+1],st=sV[2*sj],sb=sV[2*sj+1],sq=sV[2*(sj+1)],sY=sV[2*(sj+1)+1],sr=su-st,sk=st-sq,ss=(-(sc=(sc=-(sx-sb))/(sn=Math.sqrt(sc*sc+sr*sr))*sX)+su)*(-(sr=sr/sn*sX)+sb)-(-sc+st)*(-sr+sx),s$=(-(sa=(sa=-(sb-sY))/(sn=Math.sqrt(sa*sa+sk*sk))*sX)+sq)*(-(sk=sk/sn*sX)+sb)-(-sa+st)*(-sk+sY),sO=(se=-sr+sx-(-sr+sb))*(sy=-sa+st-(-sa+sq))-(sA=-sk+sY-(-sk+sb))*(sw=-sc+st-(-sc+su)),Math.abs(sO)<.1?(sO+=10.1,sQ.push(st-sc+this.x,sb-sr+this.y,sF,sE,sI,st+sc+this.x,sb+sr+this.y,sF,sE,sI)):(((sN=(sw*s$-sy*ss)/sO)-st)*(sN-st)+((sm=(sA*ss-se*s$)/sO)-sb)+(sm-sb),sQ.push(sN+this.x,sm+this.y,sF,sE,sI,st-(sN-st)+this.x,sb-(sm-sb)+this.y,sF,sE,sI));su=sV[sV.length-4],sx=sV[sV.length-3],sr=su-(st=sV[sV.length-2]),sc=(sc=-(sx-(sb=sV[sV.length-1])))/(sn=Math.sqrt(sc*sc+sr*sr))*sX,sr=sr/sn*sX,sQ.push(st-sc+this.x,sb-sr+this.y,sF,sE,sI,st+sc+this.x,sb+sr+this.y,sF,sE,sI);var sR=s_;for(sj=1;sj<sR;sj++)sL.push(sH+2*(sj-1),sH+2*(sj-1)+1,sH+2*sj+1,sH+2*sj+1,sH+2*sj,sH+2*(sj-1));return sQ},sL.createLine=function(sd,sL,sl,sZ){var sh=sd.concat(),s_=sd,sN=this.borderColor,sm=(sN>>16&255)/255,su=(sN>>8&255)/255,sx=(255&sN)/255;sh.splice(0,5);var st,sb,sq,sY,sc,sr,sa,sk,se,sw,ss,sA,sy,s$,sO,sn,sV,sQ,sg,sF,sE=sh.length/5,sI=sZ,sp=sl/2;sq=sh[0],sY=sh[1],sw=sq-(sc=sh[5]),se=(se=-(sY-(sr=sh[6])))/(sF=Math.sqrt(se*se+sw*sw))*sp,sw=sw/sF*sp,s_.push(sq-se,sY-sw,sm,su,sx,sq+se,sY+sw,sm,su,sx);for(var sH=1;sH<sE-1;sH++)sq=sh[5*(sH-1)],sY=sh[5*(sH-1)+1],sc=sh[5*sH],sr=sh[5*sH+1],sa=sh[5*(sH+1)],sk=sh[5*(sH+1)+1],sw=sq-sc,sA=sc-sa,sO=(-(se=(se=-(sY-sr))/(sF=Math.sqrt(se*se+sw*sw))*sp)+sq)*(-(sw=sw/sF*sp)+sr)-(-se+sc)*(-sw+sY),sQ=(-(ss=(ss=-(sr-sk))/(sF=Math.sqrt(ss*ss+sA*sA))*sp)+sa)*(-(sA=sA/sF*sp)+sr)-(-ss+sc)*(-sA+sk),sg=(sy=-sw+sY-(-sw+sr))*(sV=-ss+sc-(-ss+sa))-(sn=-sA+sk-(-sA+sr))*(s$=-se+sc-(-se+sq)),Math.abs(sg)<.1?(sg+=10.1,s_.push(sc-se,sr-sw,sm,su,sx,sc+se,sr+sw,sm,su,sx)):(((st=(s$*sQ-sV*sO)/sg)-sc)*(st-sc)+((sb=(sn*sO-sy*sQ)/sg)-sr)+(sb-sr),s_.push(st,sb,sm,su,sx,sc-(st-sc),sr-(sb-sr),sm,su,sx));sq=sh[sh.length-10],sY=sh[sh.length-9],sw=sq-(sc=sh[sh.length-5]),se=(se=-(sY-(sr=sh[sh.length-4])))/(sF=Math.sqrt(se*se+sw*sw))*sp,sw=sw/sF*sp,s_.push(sc-se,sr-sw,sm,su,sx,sc+se,sr+sw,sm,su,sx);var sX=this.edges+1;for(sH=1;sH<sX;sH++)sL.push(sI+2*(sH-1),sI+2*(sH-1)+1,sI+2*sH+1,sI+2*sH+1,sI+2*sH,sI+2*(sH-1));return s_},sL.createLoopLine=function(sd,sL,sl,sZ,sh,s_){var sN=sd.concat(),sm=sh||sd,su=this.borderColor,sx=(su>>16&255)/255,st=(su>>8&255)/255,sb=(255&su)/255;sN.splice(0,5);var sq=[sN[0],sN[1]],sY=[sN[sN.length-5],sN[sN.length-4]],sc=sY[0]+.5*(sq[0]-sY[0]),sr=sY[1]+.5*(sq[1]-sY[1]);sN.unshift(sc,sr,0,0,0),sN.push(sc,sr,0,0,0);var sa,sk,se,sw,ss,sA,sy,s$,sO,sn,sV,sQ,sg,sF,sE,sI,sp,sH,sX,sj,sR=sN.length/5,so=sZ,si=sl/2;se=sN[0],sw=sN[1],sn=se-(ss=sN[5]),sO=(sO=-(sw-(sA=sN[6])))/(sj=Math.sqrt(sO*sO+sn*sn))*si,sn=sn/sj*si,sm.push(se-sO,sw-sn,sx,st,sb,se+sO,sw+sn,sx,st,sb);for(var sS=1;sS<sR-1;sS++)se=sN[5*(sS-1)],sw=sN[5*(sS-1)+1],ss=sN[5*sS],sA=sN[5*sS+1],sy=sN[5*(sS+1)],s$=sN[5*(sS+1)+1],sn=se-ss,sQ=ss-sy,sE=(-(sO=(sO=-(sw-sA))/(sj=Math.sqrt(sO*sO+sn*sn))*si)+se)*(-(sn=sn/sj*si)+sA)-(-sO+ss)*(-sn+sw),sH=(-(sV=(sV=-(sA-s$))/(sj=Math.sqrt(sV*sV+sQ*sQ))*si)+sy)*(-(sQ=sQ/sj*si)+sA)-(-sV+ss)*(-sQ+s$),sX=(sg=-sn+sw-(-sn+sA))*(sp=-sV+ss-(-sV+sy))-(sI=-sQ+s$-(-sQ+sA))*(sF=-sO+ss-(-sO+se)),Math.abs(sX)<.1?(sX+=10.1,sm.push(ss-sO,sA-sn,sx,st,sb,ss+sO,sA+sn,sx,st,sb)):(((sa=(sF*sH-sp*sE)/sX)-ss)*(sa-ss)+((sk=(sI*sE-sg*sH)/sX)-sA)+(sk-sA),sm.push(sa,sk,sx,st,sb,ss-(sa-ss),sA-(sk-sA),sx,st,sb));s_&&(sL=s_);var sB=this.edges+1;for(sS=1;sS<sB;sS++)sL.push(so+2*(sS-1),so+2*(sS-1)+1,so+2*sS+1,so+2*sS+1,so+2*sS,so+2*(sS-1));return sL.push(so+2*(sS-1),so+2*(sS-1)+1,so+1,so+1,so,so+2*(sS-1)),sm},sd}(),sZd=function(){function sr(){}return sq(sr,"laya.webgl.shapes.Earcut"),sr.earcut=function(sd,sL,sl){sl=sl||2;var sZ,sh,s_,sN,sm,su,sx,st=sL&&sL.length,sb=st?sL[0]*sl:sd.length,sq=sr.linkedList(sd,0,sb,sl,!0),sY=[];if(!sq)return sY;if(st&&(sq=sr.eliminateHoles(sd,sL,sq,sl)),sd.length>80*sl){sZ=s_=sd[0],sh=sN=sd[1];for(var sc=sl;sc<sb;sc+=sl)(sm=sd[sc])<sZ&&(sZ=sm),(su=sd[sc+1])<sh&&(sh=su),s_<sm&&(s_=sm),sN<su&&(sN=su);sx=0!==(sx=Math.max(s_-sZ,sN-sh))?1/sx:0}return sr.earcutLinked(sq,sY,sl,sZ,sh,sx),sY},sr.linkedList=function(sd,sL,sl,sZ,sh){var s_,sN;if(sh===0<sr.signedArea(sd,sL,sl,sZ))for(s_=sL;s_<sl;s_+=sZ)sN=sr.insertNode(s_,sd[s_],sd[s_+1],sN);else for(s_=sl-sZ;sL<=s_;s_-=sZ)sN=sr.insertNode(s_,sd[s_],sd[s_+1],sN);return sN&&sr.equals(sN,sN.next)&&(sr.removeNode(sN),sN=sN.next),sN},sr.filterPoints=function(sd,sL){if(!sd)return sd;sL||(sL=sd);var sl,sZ=sd;do{if(sl=!1,sZ.steiner||!sr.equals(sZ,sZ.next)&&0!==sr.area(sZ.prev,sZ,sZ.next))sZ=sZ.next;else{if(sr.removeNode(sZ),(sZ=sL=sZ.prev)===sZ.next)break;sl=!0}}while(sl||sZ!==sL);return sL},sr.earcutLinked=function(sd,sL,sl,sZ,sh,s_,sN){if(sd){!sN&&s_&&sr.indexCurve(sd,sZ,sh,s_);for(var sm,su,sx=sd;sd.prev!==sd.next;)if(sm=sd.prev,su=sd.next,s_?sr.isEarHashed(sd,sZ,sh,s_):sr.isEar(sd))sL.push(sm.i/sl),sL.push(sd.i/sl),sL.push(su.i/sl),sr.removeNode(sd),sd=su.next,sx=su.next;else if((sd=su)===sx){sN?1===sN?(sd=sr.cureLocalIntersections(sd,sL,sl),sr.earcutLinked(sd,sL,sl,sZ,sh,s_,2)):2===sN&&sr.splitEarcut(sd,sL,sl,sZ,sh,s_):sr.earcutLinked(sr.filterPoints(sd,null),sL,sl,sZ,sh,s_,1);break}}},sr.isEar=function(sd){var sL=sd.prev,sl=sd,sZ=sd.next;if(0<=sr.area(sL,sl,sZ))return!1;for(var sh=sd.next.next;sh!==sd.prev;){if(sr.pointInTriangle(sL.x,sL.y,sl.x,sl.y,sZ.x,sZ.y,sh.x,sh.y)&&0<=sr.area(sh.prev,sh,sh.next))return!1;sh=sh.next}return!0},sr.isEarHashed=function(sd,sL,sl,sZ){var sh=sd.prev,s_=sd,sN=sd.next;if(0<=sr.area(sh,s_,sN))return!1;for(var sm=sh.x<s_.x?sh.x<sN.x?sh.x:sN.x:s_.x<sN.x?s_.x:sN.x,su=sh.y<s_.y?sh.y<sN.y?sh.y:sN.y:s_.y<sN.y?s_.y:sN.y,sx=sh.x>s_.x?sh.x>sN.x?sh.x:sN.x:s_.x>sN.x?s_.x:sN.x,st=sh.y>s_.y?sh.y>sN.y?sh.y:sN.y:s_.y>sN.y?s_.y:sN.y,sb=sr.zOrder(sm,su,sL,sl,sZ),sq=sr.zOrder(sx,st,sL,sl,sZ),sY=sd.nextZ;sY&&sY.z<=sq;){if(sY!==sd.prev&&sY!==sd.next&&sr.pointInTriangle(sh.x,sh.y,s_.x,s_.y,sN.x,sN.y,sY.x,sY.y)&&0<=sr.area(sY.prev,sY,sY.next))return!1;sY=sY.nextZ}for(sY=sd.prevZ;sY&&sY.z>=sb;){if(sY!==sd.prev&&sY!==sd.next&&sr.pointInTriangle(sh.x,sh.y,s_.x,s_.y,sN.x,sN.y,sY.x,sY.y)&&0<=sr.area(sY.prev,sY,sY.next))return!1;sY=sY.prevZ}return!0},sr.cureLocalIntersections=function(sd,sL,sl){var sZ=sd;do{var sh=sZ.prev,s_=sZ.next.next;!sr.equals(sh,s_)&&sr.intersects(sh,sZ,sZ.next,s_)&&sr.locallyInside(sh,s_)&&sr.locallyInside(s_,sh)&&(sL.push(sh.i/sl),sL.push(sZ.i/sl),sL.push(s_.i/sl),sr.removeNode(sZ),sr.removeNode(sZ.next),sZ=sd=s_),sZ=sZ.next}while(sZ!==sd);return sZ},sr.splitEarcut=function(sd,sL,sl,sZ,sh,s_){var sN=sd;do{for(var sm=sN.next.next;sm!==sN.prev;){if(sN.i!==sm.i&&sr.isValidDiagonal(sN,sm)){var su=sr.splitPolygon(sN,sm);return sN=sr.filterPoints(sN,sN.next),su=sr.filterPoints(su,su.next),sr.earcutLinked(sN,sL,sl,sZ,sh,s_),void sr.earcutLinked(su,sL,sl,sZ,sh,s_)}sm=sm.next}sN=sN.next}while(sN!==sd)},sr.eliminateHoles=function(sd,sL,sl,sZ){var sh,s_,sN,sm,su,sx=[];for(sh=0,s_=sL.length;sh<s_;sh++)sN=sL[sh]*sZ,sm=sh<s_-1?sL[sh+1]*sZ:sd.length,(su=sr.linkedList(sd,sN,sm,sZ,!1))===su.next&&(su.steiner=!0),sx.push(sr.getLeftmost(su));for(sx.sort(sr.compareX),sh=0;sh<sx.length;sh++)sr.eliminateHole(sx[sh],sl),sl=sr.filterPoints(sl,sl.next);return sl},sr.compareX=function(sd,sL){return sd.x-sL.x},sr.eliminateHole=function(sd,sL){if(sL=sr.findHoleBridge(sd,sL)){var sl=sr.splitPolygon(sL,sd);sr.filterPoints(sl,sl.next)}},sr.findHoleBridge=function(sd,sL){var sl,sZ=sL,sh=sd.x,s_=sd.y,sN=-1/0;do{if(s_<=sZ.y&&s_>=sZ.next.y&&sZ.next.y!==sZ.y){var sm=sZ.x+(s_-sZ.y)*(sZ.next.x-sZ.x)/(sZ.next.y-sZ.y);if(sm<=sh&&sN<sm){if((sN=sm)===sh){if(s_===sZ.y)return sZ;if(s_===sZ.next.y)return sZ.next}sl=sZ.x<sZ.next.x?sZ:sZ.next}}sZ=sZ.next}while(sZ!==sL);if(!sl)return null;if(sh===sN)return sl.prev;var su,sx=sl,st=sl.x,sb=sl.y,sq=1/0;for(sZ=sl.next;sZ!==sx;)sh>=sZ.x&&sZ.x>=st&&sh!==sZ.x&&sr.pointInTriangle(s_<sb?sh:sN,s_,st,sb,s_<sb?sN:sh,s_,sZ.x,sZ.y)&&((su=Math.abs(s_-sZ.y)/(sh-sZ.x))<sq||su===sq&&sZ.x>sl.x)&&sr.locallyInside(sZ,sd)&&(sl=sZ,sq=su),sZ=sZ.next;return sl},sr.indexCurve=function(sd,sL,sl,sZ){for(var sh=sd;null===sh.z&&(sh.z=sr.zOrder(sh.x,sh.y,sL,sl,sZ)),sh.prevZ=sh.prev,sh.nextZ=sh.next,(sh=sh.next)!==sd;);sh.prevZ.nextZ=null,sh.prevZ=null,sr.sortLinked(sh)},sr.sortLinked=function(sd){var sL,sl,sZ,sh,s_,sN,sm,su,sx=1;do{for(sl=sd,s_=sd=null,sN=0;sl;){for(sN++,sZ=sl,sL=sm=0;sL<sx&&(sm++,sZ=sZ.nextZ);sL++);for(su=sx;0<sm||0<su&&sZ;)0!==sm&&(0===su||!sZ||sl.z<=sZ.z)?(sl=(sh=sl).nextZ,sm--):(sZ=(sh=sZ).nextZ,su--),s_?s_.nextZ=sh:sd=sh,sh.prevZ=s_,s_=sh;sl=sZ}s_.nextZ=null,sx*=2}while(1<sN);return sd},sr.zOrder=function(sd,sL,sl,sZ,sh){return(sd=1431655765&((sd=858993459&((sd=252645135&((sd=16711935&((sd=32767*(sd-sl)*sh)|sd<<8))|sd<<4))|sd<<2))|sd<<1))|(sL=1431655765&((sL=858993459&((sL=252645135&((sL=16711935&((sL=32767*(sL-sZ)*sh)|sL<<8))|sL<<4))|sL<<2))|sL<<1))<<1},sr.getLeftmost=function(sd){for(var sL=sd,sl=sd;sL.x<sl.x&&(sl=sL),(sL=sL.next)!==sd;);return sl},sr.pointInTriangle=function(sd,sL,sl,sZ,sh,s_,sN,sm){return 0<=(sh-sN)*(sL-sm)-(sd-sN)*(s_-sm)&&0<=(sd-sN)*(sZ-sm)-(sl-sN)*(sL-sm)&&0<=(sl-sN)*(s_-sm)-(sh-sN)*(sZ-sm)},sr.isValidDiagonal=function(sd,sL){return sd.next.i!==sL.i&&sd.prev.i!==sL.i&&!sr.intersectsPolygon(sd,sL)&&sr.locallyInside(sd,sL)&&sr.locallyInside(sL,sd)&&sr.middleInside(sd,sL)},sr.area=function(sd,sL,sl){return(sL.y-sd.y)*(sl.x-sL.x)-(sL.x-sd.x)*(sl.y-sL.y)},sr.equals=function(sd,sL){return sd.x===sL.x&&sd.y===sL.y},sr.intersects=function(sd,sL,sl,sZ){return!!(sr.equals(sd,sL)&&sr.equals(sl,sZ)||sr.equals(sd,sZ)&&sr.equals(sl,sL))||0<sr.area(sd,sL,sl)!=0<sr.area(sd,sL,sZ)&&0<sr.area(sl,sZ,sd)!=0<sr.area(sl,sZ,sL)},sr.intersectsPolygon=function(sd,sL){var sl=sd;do{if(sl.i!==sd.i&&sl.next.i!==sd.i&&sl.i!==sL.i&&sl.next.i!==sL.i&&sr.intersects(sl,sl.next,sd,sL))return!0;sl=sl.next}while(sl!==sd);return!1},sr.locallyInside=function(sd,sL){return sr.area(sd.prev,sd,sd.next)<0?0<=sr.area(sd,sL,sd.next)&&0<=sr.area(sd,sd.prev,sL):sr.area(sd,sL,sd.prev)<0||sr.area(sd,sd.next,sL)<0},sr.middleInside=function(sd,sL){for(var sl=sd,sZ=!1,sh=(sd.x+sL.x)/2,s_=(sd.y+sL.y)/2;sl.y>s_!=sl.next.y>s_&&sl.next.y!==sl.y&&sh<(sl.next.x-sl.x)*(s_-sl.y)/(sl.next.y-sl.y)+sl.x&&(sZ=!sZ),(sl=sl.next)!==sd;);return sZ},sr.splitPolygon=function(sd,sL){var sl=new shd(sd.i,sd.x,sd.y),sZ=new shd(sL.i,sL.x,sL.y),sh=sd.next,s_=sL.prev;return(sd.next=sL).prev=sd,(sl.next=sh).prev=sl,(sZ.next=sl).prev=sZ,(s_.next=sZ).prev=s_,sZ},sr.insertNode=function(sd,sL,sl,sZ){var sh=new shd(sd,sL,sl);return sZ?(sh.next=sZ.next,(sh.prev=sZ).next.prev=sh,sZ.next=sh):(sh.prev=sh).next=sh,sh},sr.removeNode=function(sd){sd.next.prev=sd.prev,sd.prev.next=sd.next,sd.prevZ&&(sd.prevZ.nextZ=sd.nextZ),sd.nextZ&&(sd.nextZ.prevZ=sd.prevZ)},sr.signedArea=function(sd,sL,sl,sZ){for(var sh=0,s_=sL,sN=sl-sZ;s_<sl;s_+=sZ)sh+=(sd[sN]-sd[s_])*(sd[s_+1]+sd[sN+1]),sN=s_;return sh},sr}(),shd=function(){function sd(sd,sL,sl){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=sd,this.x=sL,this.y=sl,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return sq(sd,"laya.webgl.shapes.EarcutNode"),sd}(),s_d=(function(){function sd(sd,sL,sl,sZ,sh,s_,sN){this.lineWidth=sd,this.lineColor=sL,this.lineAlpha=sl,this.fillColor=sZ,this.fillAlpha=sh,this.shape=sN,this.fill=s_}sq(sd,"laya.webgl.shapes.GeometryData");var sL=sd.prototype;sL.clone=function(){return new sd(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},sL.getIndexData=function(){return null},sL.getVertexData=function(){return null},sL.destroy=function(){this.shape=null}}(),function(){function sd(sd){if(sd instanceof Float32Array)this.points=sd;else if(sd instanceof Array){sd.length;this.points=new Float32Array(sd)}}sq(sd,"laya.webgl.shapes.Vertex");var sL=sd.prototype;sy.imps(sL,{"laya.webgl.shapes.IShape":!0}),sL.getData=function(sd,sL,sl){},sL.needUpdate=function(sd){return!1},sL.rebuild=function(sd){},sL.setMatrix=function(sd){}}(),function(){function su(sd){void 0===sd&&(sd=1e4),this._renderType=sd}sq(su,"laya.webgl.submit.Submit");var sd=su.prototype;return sy.imps(sd,{"laya.webgl.submit.ISubmit":!0}),sd.releaseRender=function(){var sd=su._cache;(sd[sd._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},sd.getRenderType=function(){return this._renderType},sd.renderSubmit=function(){if(0===this._numEle)return 1;var sd=this.shaderValue.textureHost;if(sd){var sL=sd.source;if(!sd.bitmap||!sL)return 1;this.shaderValue.texture=sL,sd.alphaTexture&&sd.alphaTexture.source&&(this.shaderValue.texture1=sd.alphaTexture.source)}this._vb.bind_upload(this._ib);var sl=ssd.mainContext;return this.shaderValue.upload(),sP.activeBlendFunction!==this._blendFn&&(sl.enable(3042),this._blendFn(sl),sP.activeBlendFunction=this._blendFn),sE.drawCall++,sE.trianglesFaces+=this._numEle/3,sl.drawElements(4,this._numEle,5123,this._startIdx),1},su.__init__=function(){var sd=su.RENDERBASE=new su(-1);sd.shaderValue=new sOd(0,0),sd.shaderValue.ALPHA=-1234},su.createSubmit=function(sd,sL,sl,sZ,sh){var s_=su._cache._length?su._cache[--su._cache._length]:new su;null==sl&&((sl=s_._selfVb||(s_._selfVb=sMd.create(-1))).clear(),sZ=0),s_._ib=sL,s_._vb=sl,s_._startIdx=sZ*srd.BYTES_PIDX,s_._numEle=0;var sN=sd._nBlendType;s_._blendFn=sd._targets?sP.targetFns[sN]:sP.fns[sN],s_.shaderValue=sh,s_.shaderValue.setValue(sd._shader2D);var sm=sd._shader2D.filters;return sm&&s_.shaderValue.setFilters(sm),s_},su.createShape=function(sd,sL,sl,sZ,sh,s_){var sN=su._cache._length?su._cache[--su._cache._length]:new su;sN._ib=sL,sN._vb=sl,sN._numEle=sZ,sN._startIdx=sh,sN.shaderValue=s_,sN.shaderValue.setValue(sd._shader2D);var sm=sd._nBlendType;return sN._blendFn=sd._targets?sP.targetFns[sm]:sP.fns[sm],sN},su.TYPE_2D=1e4,su.TYPE_CANVAS=10003,su.TYPE_CMDSETRT=10004,su.TYPE_CUSTOM=10005,su.TYPE_BLURRT=10006,su.TYPE_CMDDESTORYPRERT=10007,su.TYPE_DISABLESTENCIL=10008,su.TYPE_OTHERIBVB=10009,su.TYPE_PRIMITIVE=10010,su.TYPE_RT=10011,su.TYPE_BLUR_RT=10012,su.TYPE_TARGET=10013,su.TYPE_CHANGE_VALUE=10014,su.TYPE_SHAPE=10015,su.TYPE_TEXTURE=10016,su.TYPE_FILLTEXTURE=10017,su.RENDERBASE=null,su._cache=((su._cache=[])._length=0,su._cache),su}()),sNd=function(){function sZ(){this.fun=null,this.args=null}sq(sZ,"laya.webgl.submit.SubmitCMD");var sd=sZ.prototype;return sy.imps(sd,{"laya.webgl.submit.ISubmit":!0}),sd.renderSubmit=function(){return this.fun.apply(null,this.args),1},sd.getRenderType=function(){return 0},sd.releaseRender=function(){var sd=sZ._cache;sd[sd._length++]=this},sZ.create=function(sd,sL){var sl=sZ._cache._length?sZ._cache[--sZ._cache._length]:new sZ;return sl.fun=sL,sl.args=sd,sl},sZ._cache=((sZ._cache=[])._length=0,sZ._cache),sZ}(),smd=function(){function sL(){this.variables={}}sq(sL,"laya.webgl.submit.SubmitCMDScope");var sd=sL.prototype;return sd.getValue=function(sd){return this.variables[sd]},sd.addValue=function(sd,sL){return this.variables[sd]=sL},sd.setValue=function(sd,sL){return this.variables.hasOwnProperty(sd)?this.variables[sd]=sL:null},sd.clear=function(){for(var sd in this.variables)delete this.variables[sd]},sd.recycle=function(){this.clear(),sL.POOL.push(this)},sL.create=function(){var sd=sL.POOL.pop();return sd||(sd=new sL),sd},sL.POOL=[],sL}(),sud=function(){function sb(){this.offset=0,this.startIndex=0,this._mat=sn.create()}sq(sb,"laya.webgl.submit.SubmitOtherIBVB");var sd=sb.prototype;return sy.imps(sd,{"laya.webgl.submit.ISubmit":!0}),sd.releaseRender=function(){var sd=sb._cache;(sd[sd._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},sd.getRenderType=function(){return 10009},sd.renderSubmit=function(){var sd=this._shaderValue.textureHost;if(sd){var sL=sd.source;if(!sd.bitmap||!sL)return 1;this._shaderValue.texture=sL}this._vb.bind_upload(this._ib);var sl=sed.worldMatrix4,sZ=sn.TEMP;sn.mulPre(this._mat,sl[0],sl[1],sl[4],sl[5],sl[12],sl[13],sZ);var sh=sed.worldMatrix4=sb.tempMatrix4;sh[0]=sZ.a,sh[1]=sZ.b,sh[4]=sZ.c,sh[5]=sZ.d,sh[12]=sZ.tx,sh[13]=sZ.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var s_=ssd.mainContext;return sP.activeBlendFunction!==this._blendFn&&(s_.enable(3042),this._blendFn(s_),sP.activeBlendFunction=this._blendFn),sE.drawCall++,sE.trianglesFaces+=this._numEle/3,s_.drawElements(4,this._numEle,5123,this.startIndex),sed.worldMatrix4=sl,sjd.activeShader=null,1},sb.create=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){void 0===su&&(su=0);var sx=sb._cache._length?sb._cache[--sb._cache._length]:new sb;sx._ib=sl,sx._vb=sL,sx._numEle=sZ,sx._shader=sh,sx._shaderValue=s_;var st=sd._nBlendType;switch(sx._blendFn=sd._targets?sP.targetFns[st]:sP.fns[st],su){case 0:sx.offset=0,sx.startIndex=sm/(srd.BYTES_PE*sL.vertexStride)*1.5,sx.startIndex*=srd.BYTES_PIDX;break;case 1:sx.startIndex=sN,sx.offset=sm}return sx},sb._cache=((sb._cache=[])._length=0,sb._cache),sb.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sb}(),sxd=function(){function sl(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new sQ,this.screenRect=new sQ}sq(sl,"laya.webgl.submit.SubmitScissor");var sd=sl.prototype;return sy.imps(sd,{"laya.webgl.submit.ISubmit":!0}),sd._scissor=function(sd,sL,sl,sZ){var sh=sed.worldMatrix4,s_=sh[0],sN=sh[5],sm=sh[12],su=sh[13];if(sZ*=sN,(sl*=s_)<1||sZ<1)return!1;var sx=(sd=sd*s_+sm)+sl,st=(sL=sL*sN+su)+sZ;sd<0&&(sl=sx-(sd=0)),sL<0&&(sZ=st-(sL=0));var sb=sed.worldClipRect;if(sd=Math.max(sd,sb.x),sL=Math.max(sL,sb.y),sl=Math.min(sx,sb.right)-sd,sZ=Math.min(st,sb.bottom)-sL,sl<1||sZ<1)return!1;var sq=sed.worldScissorTest;return this.screenRect.copyFrom(sb),sb.x=sd,sb.y=sL,sb.width=sl,sb.height=sZ,sed.worldScissorTest=!0,sL=sed.height-sL-sZ,ssd.mainContext.scissor(sd,sL,sl,sZ),ssd.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),sq?(sL=sed.height-this.screenRect.y-this.screenRect.height,ssd.mainContext.scissor(this.screenRect.x,sL,this.screenRect.width,this.screenRect.height),ssd.mainContext.enable(3089)):(ssd.mainContext.disable(3089),sed.worldScissorTest=!1),sb.copyFrom(this.screenRect),!0},sd._scissorWithTagart=function(sd,sL,sl,sZ){if(sl<1||sZ<1)return!1;var sh=sd+sl,s_=sL+sZ;sd<0&&(sl=sh-(sd=0)),sL<0&&(sZ=s_-(sL=0));var sN=sed.worldClipRect;if(sd=Math.max(sd,sN.x),sL=Math.max(sL,sN.y),sl=Math.min(sh,sN.right)-sd,sZ=Math.min(s_,sN.bottom)-sL,sl<1||sZ<1)return!1;var sm=sed.worldScissorTest;return this.screenRect.copyFrom(sN),sed.worldScissorTest=!0,sN.x=sd,sN.y=sL,sN.width=sl,sN.height=sZ,sL=sed.height-sL-sZ,ssd.mainContext.scissor(sd,sL,sl,sZ),ssd.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),sm?(sL=sed.height-this.screenRect.y-this.screenRect.height,ssd.mainContext.scissor(this.screenRect.x,sL,this.screenRect.width,this.screenRect.height),ssd.mainContext.enable(3089)):(ssd.mainContext.disable(3089),sed.worldScissorTest=!1),sN.copyFrom(this.screenRect),!0},sd.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},sd.getRenderType=function(){return 0},sd.releaseRender=function(){var sd=sl._cache;(sd[sd._length++]=this).context=null},sl.create=function(sd){var sL=sl._cache._length?sl._cache[--sl._cache._length]:new sl;return sL.context=sd,sL},sl._cache=((sl._cache=[])._length=0,sl._cache),sl}(),std=function(){function su(){this.step=0,this.blendMode=null,this.level=0}sq(su,"laya.webgl.submit.SubmitStencil");var sd=su.prototype;return sy.imps(sd,{"laya.webgl.submit.ISubmit":!0}),sd.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},sd.getRenderType=function(){return 0},sd.releaseRender=function(){var sd=su._cache;sd[sd._length++]=this},sd.do1=function(){var sd=ssd.mainContext;sd.enable(2960),sd.clear(1024),sd.colorMask(!1,!1,!1,!1),sd.stencilFunc(514,this.level,255),sd.stencilOp(7680,7680,7682)},sd.do2=function(){var sd=ssd.mainContext;sd.stencilFunc(514,this.level+1,255),sd.colorMask(!0,!0,!0,!0),sd.stencilOp(7680,7680,7680)},sd.do3=function(){var sd=ssd.mainContext;sd.colorMask(!0,!0,!0,!0),sd.stencilOp(7680,7680,7680),sd.clear(1024),sd.disable(2960)},sd.do4=function(){var sd=ssd.mainContext;0==this.level&&(sd.enable(2960),sd.clear(1024)),sd.colorMask(!1,!1,!1,!1),sd.stencilFunc(519,0,255),sd.stencilOp(7680,7680,7682)},sd.do5=function(){var sd=ssd.mainContext;sd.stencilFunc(514,this.level,255),sd.colorMask(!0,!0,!0,!0),sd.stencilOp(7680,7680,7680)},sd.do6=function(){var sd=ssd.mainContext;sP.targetFns[sP.TOINT[this.blendMode]](sd)},sd.do7=function(){var sd=ssd.mainContext;sd.colorMask(!1,!1,!1,!1),sd.stencilOp(7680,7680,7683)},sd.do8=function(){var sd=ssd.mainContext;sd.colorMask(!0,!0,!0,!0),sd.stencilFunc(514,this.level,255),sd.stencilOp(7680,7680,7680)},su.restore=function(sd,sL,sl,sZ,sh){var s_;if((sd._renderKey=0)<su._mask&&su._mask--,0==su._mask)s_=laya.webgl.submit.SubmitStencil.create(3),sd.addRenderObject(s_),sd._curSubmit=s_d.RENDERBASE;else{s_=laya.webgl.submit.SubmitStencil.create(7),sd.addRenderObject(s_);var sN=sd._vb;sN._byteLength;if(sad.fillRectImgVb(sN,null,sL.x,sL.y,sL.width,sL.height,sX.DEF_UV,sl,sZ,sh,0,0)){sd._shader2D.glTexture=null;var sm=sd._curSubmit=s_d.createSubmit(sd,sd._ib,sN,(sN._byteLength-64)/32*3,sOd.create(2,0));sm.shaderValue.ALPHA=1,sd._submits[sd._submits._length++]=sm,sd._curSubmit._numEle+=6,sd._curSubmit=s_d.RENDERBASE}else alert("clipRect calc stencil rect error");s_=laya.webgl.submit.SubmitStencil.create(8),sd.addRenderObject(s_)}},su.restore2=function(sd,sL){var sl;(sd._renderKey=0)<su._mask&&su._mask--,0==su._mask?(sl=laya.webgl.submit.SubmitStencil.create(3),sd.addRenderObject(sl),sd._curSubmit=s_d.RENDERBASE):(sl=laya.webgl.submit.SubmitStencil.create(7),sd.addRenderObject(sl),sd._submits[sd._submits._length++]=sL,sl=laya.webgl.submit.SubmitStencil.create(8),sd.addRenderObject(sl))},su.create=function(sd){var sL=su._cache._length?su._cache[--su._cache._length]:new su;return 5==(sL.step=sd)&&++su._mask,sL.level=su._mask,sL},su._cache=((su._cache=[])._length=0,su._cache),su._mask=0,su}(),sbd=function(){function sm(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}sq(sm,"laya.webgl.submit.SubmitTarget");var sd=sm.prototype;return sy.imps(sd,{"laya.webgl.submit.ISubmit":!0}),sd.renderSubmit=function(){this._vb.bind_upload(this._ib);var sd=this.scope.getValue(this.proName);return sd&&(this.shaderValue.texture=sd.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[sd.width,sd.height]),this.shaderValue.upload(),this.blend(),sE.drawCall++,sE.trianglesFaces+=this._numEle/3,ssd.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},sd.blend=function(){if(sP.activeBlendFunction!==sP.fns[this.blendType]){var sd=ssd.mainContext;sd.enable(3042),sP.fns[this.blendType](sd),sP.activeBlendFunction=sP.fns[this.blendType]}},sd.getRenderType=function(){return 0},sd.releaseRender=function(){var sd=sm._cache;(sd[sd._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},sm.create=function(sd,sL,sl,sZ,sh,s_){var sN=sm._cache._length?sm._cache[--sm._cache._length]:new sm;return sN._ib=sL,sN._vb=sl,sN.proName=s_,sN._startIdx=sZ*srd.BYTES_PIDX,sN._numEle=0,sN.blendType=sd._nBlendType,sN.shaderValue=sh,sN.shaderValue.setValue(sd._shader2D),sN},sm._cache=((sm._cache=[])._length=0,sm._cache),sm}(),sqd=function(){function sd(){this._sourceStr=null}sq(sd,"laya.webgl.text.CharSegment");var sL=sd.prototype;return sy.imps(sL,{"laya.webgl.text.ICharSegment":!0}),sL.textToSpit=function(sd){this._sourceStr=sd},sL.getChar=function(sd){return this._sourceStr.charAt(sd)},sL.getCharCode=function(sd){return this._sourceStr.charCodeAt(sd)},sL.length=function(){return this._sourceStr.length},sd}(),sYd=function(){var sd;function sE(){}return sq(sE,"laya.webgl.text.DrawText"),sE.__init__=function(){sE._charsTemp=new Array,sE._drawValue=new sd,sE._charSeg=new sqd},sE.customCharSeg=function(sd){sE._charSeg=sd},sE.getChar=function(sd,sL,sl){var sZ=sDd.createOneChar(sd,sl);return-1!=sL&&(sE._charsCache[sL]=sZ),sZ},sE._drawSlow=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb,sq,sY,sc){var sr,sa,sk=sE._drawValue.value(s_,sm,su,sx,sq,sY,sc),se=0,sw=0,ss=sE._charsTemp,sA=0,sy=NaN;if(sZ)for(ss.length=sZ.length,se=0,sw=sZ.length;se<sw;se++)(sa=sZ[se])&&(sy=sa.charNum+sk.txtID,ss[se]=sr=sE._charsCache[sy]||sE.getChar(sa.char,sy,sk),sr.active());else{var s$=sl instanceof laya.utils.WordText?sl.toString():sl;if(sH.CharacterCache){sE._charSeg.textToSpit(s$);var sO=sE._charSeg.length();for(se=0,sw=ss.length=sO;se<sw;se++)sy=sE._charSeg.getCharCode(se)+sk.txtID,ss[se]=sr=sE._charsCache[sy]||sE.getChar(sE._charSeg.getChar(se),sy,sk),sr.active(),sA+=sr.cw}else ss.length=0,(sr=sE.getChar(s$,-1,sk)).active(),sA+=sr.cw,ss[0]=sr}var sn=0;null!==sN&&"left"!==sN&&(sn=-("center"==sN?sA/2:sA));var sV,sQ,sg=NaN,sF=0;if(sZ)for(se=0,sw=ss.length;se<sw;se++)sr=ss[se],sa=sZ[se],sr&&sa&&!sr.isSpace&&(sg=sr.borderSize,sV=sr.texture,sL._drawText(sV,st+sn+sa.x*sq-sg,sb+sa.y*sY-sg,sV.width,sV.height,sh,0,0,0,0));else{for(se=0,sw=ss.length;se<sw;se++)(sr=ss[se])&&!sr.isSpace&&(sg=sr.borderSize,sV=sr.texture,sL._drawText(sV,st+sn-sg,sb-sg,sV.width,sV.height,sh,0,0,0,0),sd&&((sQ=sd[sF++])||(sQ=sd[sF-1]=[]),sQ[0]=sV,sQ[1]=sn-sg,sQ[2]=-sg)),sn+=sr.cw;sd&&(sd.length=sF)}},sE._drawFast=function(sd,sL,sl,sZ,sh){for(var s_,sN,sm=0,su=sd.length;sm<su;sm++)(s_=(sN=sd[sm])[0]).active(),sL._drawText(s_,sZ+sN[1],sh+sN[2],s_.width,s_.height,sl,0,0,0,0)},sE.drawText=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb){if(void 0===sb&&(sb=0),!(sL&&0===sL.length||sl&&0===sl.length)){var sq=sZ.a,sY=sZ.d;(0!==sZ.b||0!==sZ.c)&&(sq=sY=1);var sc=1!==sq||1!==sY;if(sc&&sy.stage.transform){var sr=sy.stage.transform;sc=sr.a===sq&&sr.d===sY}else sc=!1;if(sc){var sa=(sZ=sZ.copyTo(s$d._tmpMatrix)).tx,sk=sZ.ty;sZ.scale(1/sq,1/sY),sZ._checkTransform(),sx*=sq,st*=sY,sx+=sa-sZ.tx,st+=sk-sZ.ty}else sq=sY=1;if(sl)sE._drawSlow(null,sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sq,sY,sb);else{if(null===sL.toUpperCase){var se=sq+1e5*sY,sw=sL;return void(sw.changed||sw.id!==se?(sw.id=se,sw.changed=!1,sE._drawSlow(sw.save,sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sq,sY,sb)):sE._drawFast(sw.save,sd,sZ,sx,st))}var ss=sL+sh.toString()+sN+sm+su+sq+sY+s_,sA=sE._textsCache[ss];sH.CharacterCache?sA?sE._drawFast(sA,sd,sZ,sx,st):(sE._textsCache.__length||(sE._textsCache.__length=0),sE._textsCache.__length>s$.WebGLTextCacheCount&&((sE._textsCache={}).__length=0,sE._curPoolIndex=0),sE._textCachesPool[sE._curPoolIndex]?(sA=sE._textsCache[ss]=sE._textCachesPool[sE._curPoolIndex]).length=0:sE._textCachesPool[sE._curPoolIndex]=sA=sE._textsCache[ss]=[],sE._textsCache.__length++,sE._curPoolIndex++,sE._drawSlow(sA,sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sq,sY,sb)):sE._drawSlow(sA,sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sq,sY,sb)}}},sE._charsTemp=null,sE._textCachesPool=[],sE._curPoolIndex=0,sE._charsCache={},sE._textsCache={},sE._drawValue=null,sE.d=[],sE._charSeg=null,sE.__init$=function(){sd=function(){function su(){}return sq(su,""),su.prototype.value=function(sd,sL,sl,sZ,sh,s_,sN){this.font=sd,this.fillColor=sL,this.borderColor=sl,this.lineWidth=sZ,this.scaleX=sh,this.scaleY=s_,this.underLine=sN;var sm=sd.toString()+sh+s_+sZ+(sL?sL.toLowerCase():" ")+(sl?sl.toLowerCase():" ")+sN;return this.txtID=su._keymap[sm],this.txtID||(this.txtID=1e-7*++su._keymapCount,su._keymap[sm]=this.txtID),this},su.clear=function(){su._keymap={},su._keymapCount=1},su._keymap={},su._keymapCount=1,su}()},sE}(),scd=function(){function sh(sd){this._index=0,this._size=14,this._italic=-2,sh._cache2=sh._cache2||[],this.setFont(sd||"14px Arial")}sq(sh,"laya.webgl.text.FontInContext");var sd=sh.prototype;return sd.setFont=function(sd){var sL=sh._cache2[sd];if(sL)this._words=sL[0],this._size=sL[1];else{this._words=sd.split(" ");for(var sl=0,sZ=this._words.length;sl<sZ;sl++)if(0<this._words[sl].indexOf("px")){this._index=sl;break}this._size=parseInt(this._words[this._index]),sh._cache2[sd]=[this._words,this._size]}this._text=null,this._italic=-2},sd.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},sd.hasType=function(sd){for(var sL=0,sl=this._words.length;sL<sl;sL++)if(this._words[sL]===sd)return sL;return-1},sd.removeType=function(sd){for(var sL=0,sl=this._words.length;sL<sl;sL++)if(this._words[sL]===sd){this._words.splice(sL,1),this._index>sL&&this._index--;break}this._text=null,this._italic=-2},sd.copyTo=function(sd){return sd._text=this._text,sd._size=this._size,sd._index=this._index,sd._words=this._words.slice(),sd._italic=-2,sd},sd.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},sZ(0,sd,"size",function(){return this._size},function(sd){this._size=sd,this._words[this._index]=sd+"px",this._text=null}),sh.create=function(sd){var sL=sh._cache[sd];return sL||(sL=sh._cache[sd]=new sh(sd))},sh.EMPTY=new sh,sh._cache={},sh._cache2=null,sh}(),srd=function(){function sd(){}return sq(sd,"laya.webgl.utils.CONST3D2D"),sd.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sd.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],sd.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],sd._TMPARRAY=[],sd._OFFSETX=0,sd._OFFSETY=0,sN(sd,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),sd}(),sad=function(){function sc(){}return sq(sc,"laya.webgl.utils.GlUtils"),sc.make2DProjection=function(sd,sL,sl){return[2/sd,0,0,0,0,-2/sL,0,0,0,0,2/sl,0,-1,1,0,1]},sc.fillIBQuadrangle=function(sd,sL){if(65535/4<sL)throw Error("IBQuadrangle count:"+sL+" must<:"+Math.floor(65535/4));sL=Math.floor(sL),sd._resizeBuffer(6*(sL+1)*2,!1),sd.byteLength=sd.bufferLength;for(var sl=sd.getUint16Array(),sZ=0,sh=0;sh<sL;sh++)sl[sZ++]=4*sh,sl[sZ++]=4*sh+2,sl[sZ++]=4*sh+1,sl[sZ++]=4*sh,sl[sZ++]=4*sh+3,sl[sZ++]=4*sh+2;return sd.setNeedUpload(),!0},sc.expandIBQuadrangle=function(sd,sL){sd.bufferLength>=6*sL*2||sc.fillIBQuadrangle(sd,sL)},sc.mathCeilPowerOfTwo=function(sd){return sd--,sd|=sd>>1,sd|=sd>>2,sd|=sd>>4,sd|=sd>>8,sd|=sd>>16,++sd},sc.fillQuadrangleImgVb=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=16+(sd._byteLength>>2);sd.byteLength=su<<2;var sx=sd.getFloat32Array();sx[(su-=16)+2]=sh[0],sx[su+3]=sh[1],sx[su+6]=sh[2],sx[su+7]=sh[3],sx[su+10]=sh[4],sx[su+11]=sh[5],sx[su+14]=sh[6],sx[su+15]=sh[7];var st=s_.a,sb=s_.b,sq=s_.c,sY=s_.d;if(1!==st||0!==sb||0!==sq||1!==sY){s_.bTransform=!0;var sc=s_.tx+sN,sr=s_.ty+sm;sx[su]=(sZ[0]+sL)*st+(sZ[1]+sl)*sq+sc,sx[su+1]=(sZ[0]+sL)*sb+(sZ[1]+sl)*sY+sr,sx[su+4]=(sZ[2]+sL)*st+(sZ[3]+sl)*sq+sc,sx[su+5]=(sZ[2]+sL)*sb+(sZ[3]+sl)*sY+sr,sx[su+8]=(sZ[4]+sL)*st+(sZ[5]+sl)*sq+sc,sx[su+9]=(sZ[4]+sL)*sb+(sZ[5]+sl)*sY+sr,sx[su+12]=(sZ[6]+sL)*st+(sZ[7]+sl)*sq+sc,sx[su+13]=(sZ[6]+sL)*sb+(sZ[7]+sl)*sY+sr}else s_.bTransform=!1,sL+=s_.tx+sN,sl+=s_.ty+sm,sx[su]=sL+sZ[0],sx[su+1]=sl+sZ[1],sx[su+4]=sL+sZ[2],sx[su+5]=sl+sZ[3],sx[su+8]=sL+sZ[4],sx[su+9]=sl+sZ[5],sx[su+12]=sL+sZ[6],sx[su+13]=sl+sZ[7];return sd._upload=!0},sc.fillTranglesVB=function(sd,sL,sl,sZ,sh,s_,sN){var sm=(sd._byteLength>>2)+sZ.length;sd.byteLength=sm<<2;var su=sd.getFloat32Array();sm-=sZ.length;for(var sx=sZ.length,st=sh.a,sb=sh.b,sq=sh.c,sY=sh.d,sc=0;sc<sx;sc+=4)if(su[sm+sc+2]=sZ[sc+2],su[sm+sc+3]=sZ[sc+3],1!==st||0!==sb||0!==sq||1!==sY){sh.bTransform=!0;var sr=sh.tx+s_,sa=sh.ty+sN;su[sm+sc]=(sZ[sc]+sL)*st+(sZ[sc+1]+sl)*sq+sr,su[sm+sc+1]=(sZ[sc]+sL)*sb+(sZ[sc+1]+sl)*sY+sa}else sh.bTransform=!1,sL+=sh.tx+s_,sl+=sh.ty+sN,su[sm+sc]=sL+sZ[sc],su[sm+sc+1]=sl+sZ[sc+1];return sd._upload=!0},sc.copyPreImgVb=function(sd,sL,sl){var sZ=sd._byteLength>>2;sd.byteLength=sZ+16<<2;for(var sh=sd.getFloat32Array(),s_=0,sN=sZ-16;s_<4;s_++)sh[sZ]=sh[sN]+sL,++sN,sh[++sZ]=sh[sN]+sl,++sN,sh[++sZ]=sh[sN],++sN,sh[++sZ]=sh[sN],++sZ,++sN;sd._upload=!0},sc.fillRectImgVb=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb,sq){void 0===sq&&(sq=!1);var sY,sc,sr,sa,sk,se,sw,ss,sA,sy,s$,sO,sn,sV,sQ,sg,sF=1,sE=sm.a,sI=sm.b,sp=sm.c,sH=sm.d,sX=sL&&sL.width<99999999;if(1!==sE||0!==sI||0!==sp||1!==sH?(sm.bTransform=!0,0===sI&&0===sp&&(sF=23,sA=sh+sl,sy=s_+sZ,sY=sE*sl+(s$=sm.tx+su),sr=sE*sA+s$,sc=sH*sZ+(sO=sm.ty+sx),sa=sH*sy+sO)):(sF=23,sm.bTransform=!1,sr=(sY=sl+sm.tx+su)+sh,sa=(sc=sZ+sm.ty+sx)+s_),sX&&(sk=sL.x,se=sL.y,sw=sL.width+sk,ss=sL.height+se),1!==sF){if(Math.min(sY,sr)>=sw)return!1;if(Math.min(sc,sa)>=ss)return!1;if(Math.max(sr,sY)<=sk)return!1;if(Math.max(sa,sc)<=se)return!1}var sj=sd._byteLength>>2;sd.byteLength=16+sj<<2;var sR=sd.getFloat32Array();switch(sR[2+sj]=sN[0],sR[3+sj]=sN[1],sR[6+sj]=sN[2],sR[7+sj]=sN[3],sR[10+sj]=sN[4],sR[11+sj]=sN[5],sR[14+sj]=sN[6],sR[15+sj]=sN[7],sF){case 1:s$=sm.tx+su,sO=sm.ty+sx;var so=sE*sl,si=sp*sZ,sS=sH*sZ,sB=sI*sl,sC=sE*(sA=sh+sl),sP=sp*(sy=s_+sZ),sT=sH*sy,sz=sI*sA;sq?(sn=so+si+s$,sQ=Math.round(sn)-sn,sV=sS+sB+sO,sg=Math.round(sV)-sV,sR[sj]=sn+sQ,sR[1+sj]=sV+sg,sR[4+sj]=sC+si+s$+sQ,sR[5+sj]=sS+sz+sO+sg,sR[8+sj]=sC+sP+s$+sQ,sR[9+sj]=sT+sz+sO+sg,sR[12+sj]=so+sP+s$+sQ,sR[13+sj]=sT+sB+sO+sg):(sR[sj]=so+si+s$,sR[1+sj]=sS+sB+sO,sR[4+sj]=sC+si+s$,sR[5+sj]=sS+sz+sO,sR[8+sj]=sC+sP+s$,sR[9+sj]=sT+sz+sO,sR[12+sj]=so+sP+s$,sR[13+sj]=sT+sB+sO);break;case 23:sq?(sn=sY+st,sQ=Math.round(sn)-sn,sV=sc,sg=Math.round(sV)-sV,sR[sj]=sn+sQ,sR[1+sj]=sV+sg,sR[4+sj]=sr+st+sQ,sR[5+sj]=sc+sg,sR[8+sj]=sr+sQ,sR[9+sj]=sa+sg,sR[12+sj]=sY+sQ,sR[13+sj]=sa+sg):(sR[sj]=sY+st,sR[1+sj]=sc,sR[4+sj]=sr+st,sR[5+sj]=sc,sR[8+sj]=sr,sR[9+sj]=sa,sR[12+sj]=sY,sR[13+sj]=sa)}return sd._upload=!0},sc.fillLineVb=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=.5*sN,sx=sc._fillLineArray,st=-(sZ-s_),sb=sl-sh,sq=Math.sqrt(st*st+sb*sb);st/=sq,sb/=sq,st*=su,sb*=su,sx[0]=sl-st,sx[1]=sZ-sb,sx[4]=sl+st,sx[5]=sZ+sb,sx[8]=sh+st,sx[9]=s_+sb,sx[12]=sh-st,sx[13]=s_-sb,sm&&sm.transformPointArray(sx,sx);var sY=16+(sd._byteLength>>2);return sd.byteLength=sY<<2,sd.insertData(sx,sY-16),!0},sc._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],sc}(),skd=(function(){function su(){}sq(su,"laya.webgl.utils.MatirxArray"),su.ArrayMul=function(sd,sL,sl){if(sd)if(sL)for(var sZ=NaN,sh=NaN,s_=NaN,sN=NaN,sm=0;sm<4;sm++)sZ=sd[sm],sh=sd[sm+4],s_=sd[sm+8],sN=sd[sm+12],sl[sm]=sZ*sL[0]+sh*sL[1]+s_*sL[2]+sN*sL[3],sl[sm+4]=sZ*sL[4]+sh*sL[5]+s_*sL[6]+sN*sL[7],sl[sm+8]=sZ*sL[8]+sh*sL[9]+s_*sL[10]+sN*sL[11],sl[sm+12]=sZ*sL[12]+sh*sL[13]+s_*sL[14]+sN*sL[15];else su.copyArray(sd,sl);else su.copyArray(sL,sl)},su.copyArray=function(sd,sL){if(sd&&sL)for(var sl=0;sl<sd.length;sl++)sL[sl]=sd[sl]}}(),function(){function sL(sd,sL,sl){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=sd,this._vb=new sMd(sd,35048),sL&&this._vb._resizeBuffer(sL,!1),this._ib=new sWd,sl&&this._ib._resizeBuffer(sl,!1)}sq(sL,"laya.webgl.utils.Mesh2D");var sd=sL.prototype;return sd.cloneWithNewVB=function(){var sd=new sL(this._stride,0,0);return sd._ib=this._ib,sd._quadNum=this._quadNum,sd._attribInfo=this._attribInfo,sd},sd.cloneWithNewVBIB=function(){var sd=new sL(this._stride,0,0);return sd._attribInfo=this._attribInfo,sd},sd.getVBW=function(){return this._vb.setNeedUpload(),this._vb},sd.getVBR=function(){return this._vb},sd.getIBR=function(){return this._ib},sd.getIBW=function(){return this._ib.setNeedUpload(),this._ib},sd.createQuadIB=function(sd){this._quadNum=sd,this._ib._resizeBuffer(6*sd*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var sL=this._ib.getUint16Array(),sl=0,sZ=0,sh=0;sh<sd;sh++)sL[sl++]=sZ,sL[sl++]=sZ+2,sL[sl++]=sZ+1,sL[sl++]=sZ,sL[sl++]=sZ+3,sL[sl++]=sZ+2,sZ+=4;this._ib.setNeedUpload()},sd.setAttributes=function(sd){if(this._attribInfo=sd,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},sd.getEleNum=function(){return this._ib.getBuffer().byteLength/2},sd.releaseMesh=function(){},sd.destroy=function(){},sd.clearVB=function(){this._vb.clear()},sL._gvaoid=0,sL}()),sed=function(){function sh(){}return sq(sh,"laya.webgl.utils.RenderState2D"),sh.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},sh.mat2MatArray=function(sd,sL){var sl=sd,sZ=sL;return sZ[0]=sl.a,sZ[1]=sl.b,sZ[2]=sh.EMPTYMAT4_ARRAY[2],sZ[3]=sh.EMPTYMAT4_ARRAY[3],sZ[4]=sl.c,sZ[5]=sl.d,sZ[6]=sh.EMPTYMAT4_ARRAY[6],sZ[7]=sh.EMPTYMAT4_ARRAY[7],sZ[8]=sh.EMPTYMAT4_ARRAY[8],sZ[9]=sh.EMPTYMAT4_ARRAY[9],sZ[10]=sh.EMPTYMAT4_ARRAY[10],sZ[11]=sh.EMPTYMAT4_ARRAY[11],sZ[12]=sl.tx,sZ[13]=sl.ty,sZ[14]=sh.EMPTYMAT4_ARRAY[14],sZ[15]=sh.EMPTYMAT4_ARRAY[15],sL},sh.restoreTempArray=function(){sh.TEMPMAT4_ARRAY[0]=1,sh.TEMPMAT4_ARRAY[1]=0,sh.TEMPMAT4_ARRAY[4]=0,sh.TEMPMAT4_ARRAY[5]=1,sh.TEMPMAT4_ARRAY[12]=0,sh.TEMPMAT4_ARRAY[13]=0},sh.clear=function(){sh.worldScissorTest=!1,sh.worldShaderDefines=null,sh.worldFilters=null,sh.worldAlpha=1,sh.worldClipRect.x=sh.worldClipRect.y=0,sh.worldClipRect.width=sh.width,sh.worldClipRect.height=sh.height,sh.curRenderTarget=null},sh._MAXSIZE=99999999,sh.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sh.worldMatrix4=sh.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sh.worldAlpha=1,sh.worldScissorTest=!1,sh.worldFilters=null,sh.worldShaderDefines=null,sh.curRenderTarget=null,sh.width=0,sh.height=0,sN(sh,["worldMatrix",function(){return this.worldMatrix=new sn},"worldClipRect",function(){return this.worldClipRect=new sQ(0,0,99999999,99999999)}]),sh}(),swd=function(){var se,sl;function sw(sd,sL,sl,sZ,sh){var s_=this;function sN(sd){var sL=[],sl=new se(sL);return s_._compileToTree(sl,sd.split("\n"),0,sL,sh),sl}var sm=sY.now();this._VS=sN(sL),this._PS=sN(sl),this._nameMap=sZ,2<sY.now()-sm&&console.log("ShaderCompile use time:"+(sY.now()-sm)+"  size:"+sL.length+"/"+sl.length)}sq(sw,"laya.webgl.utils.ShaderCompile");var sd=sw.prototype;return sd._compileToTree=function(sd,sL,sl,sZ,sh){var s_,sN,sm,su,sx,st,sb,sq=0,sY=0,sc=0,sr=0;for(sY=sl;sY<sL.length;sY++)if(!((sm=sL[sY]).length<1)&&0!==(sq=sm.indexOf("//"))){if(0<=sq&&(sm=sm.substr(0,sq)),s_=sb||new se(sZ),sb=null,s_.text=sm,s_.noCompile=!0,0<=(sq=sm.indexOf("#"))){for(su="#",sr=sq+1,sc=sm.length;sr<sc;sr++){var sa=sm.charAt(sr);if(" "===sa||"\t"===sa||"\r"===sa||"\n"===sa||"?"===sa)break;su+=sa}switch(s_.name=su){case"#ifdef":case"#ifndef":if(s_.src=sm,s_.noCompile=null!=sm.match(/[!&|()=<>]/),s_.noCompile?console.log("function():Boolean{return "+sm.substr(sq+s_.name.length)+"}"):(st=sm.replace(/^\s*/,"").split(/\s+/),s_.setCondition(st[1],"#ifdef"===su?1:2),s_.text="//"+s_.text),s_.setParent(sd),sd=s_,sh)for(st=sm.substr(sr).split(sw._splitToWordExps3),sr=0;sr<st.length;sr++)(sm=st[sr]).length&&(sh[sm]=!0);continue;case"#if":if(s_.src=sm,s_.noCompile=!0,s_.setParent(sd),sd=s_,sh)for(st=sm.substr(sr).split(sw._splitToWordExps3),sr=0;sr<st.length;sr++)(sm=st[sr]).length&&"defined"!=sm&&(sh[sm]=!0);continue;case"#else":s_.src=sm,sN=(sd=sd.parent).childs[sd.childs.length-1],s_.noCompile=sN.noCompile,s_.noCompile||(s_.condition=sN.condition,s_.conditionType=1==sN.conditionType?2:1,s_.text="//"+s_.text+" "+sN.text+" "+s_.conditionType),s_.setParent(sd),sd=s_;continue;case"#endif":sN=(sd=sd.parent).childs[sd.childs.length-1],s_.noCompile=sN.noCompile,s_.noCompile||(s_.text="//"+s_.text),s_.setParent(sd);continue;case"#include":st=sw.splitToWords(sm,null);var sk=sw.includes[st[1]];if(!sk)throw"ShaderCompile error no this include file:"+st[1];if((sq=st[0].indexOf("?"))<0){s_.setParent(sd),sm=sk.getWith("with"==st[2]?st[3]:null),this._compileToTree(s_,sm.split("\n"),0,sZ,sh),s_.text="";continue}s_.setCondition(st[0].substr(sq+1),1),s_.text=sk.getWith("with"==st[2]?st[3]:null);break;case"#import":sx=(st=sw.splitToWords(sm,null))[1],sZ.push({node:s_,file:sw.includes[sx],ofs:s_.text.length});continue}}else{if((sN=sd.childs[sd.childs.length-1])&&!sN.name){0<sZ.length&&sw.splitToWords(sm,sN),sb=s_,sN.text+="\n"+sm;continue}0<sZ.length&&sw.splitToWords(sm,s_)}s_.setParent(sd)}},sd.createShader=function(sd,sL,sl){var sZ={},sh="";if(sd)for(var s_ in sd)sh+="#define "+s_+"\n",sZ[s_]=!0;var sN=this._VS.toscript(sZ,[]),sm=this._PS.toscript(sZ,[]);return(sl||svd.create)(sh+sN.join("\n"),sh+sm.join("\n"),sL,this._nameMap)},sw._parseOne=function(sd,sL,sl,sZ,sh,s_){var sN={type:sw.shaderParamsMap[sl[sZ+1]],name:sl[sZ+2],size:isNaN(parseInt(sl[sZ+3]))?1:parseInt(sl[sZ+3])};return s_&&("attribute"==sh?sd.push(sN):sL.push(sN)),":"==sl[sZ+3]&&(sN.type=sl[sZ+4],sZ+=2),sZ+=2},sw.addInclude=function(sd,sL){if(!sL||0===sL.length)throw new Error("add shader include file err:"+sd);if(sw.includes[sd])throw new Error("add shader include file err, has add:"+sd);sw.includes[sd]=new sl(sL)},sw.preGetParams=function(sd,sL){var sl=[sd,sL],sZ={},sh=[],s_=[],sN={},sm=[];sZ.attributes=sh,sZ.uniforms=s_,sZ.defines=sN;for(var su=0,sx=0,st=0;st<2;st++){sl[st]=sl[st].replace(sw._removeAnnotation,"");var sb,sq=sl[st].match(sw._reg);for(su=0,sx=sq.length;su<sx;su++){var sY=sq[su];if("attribute"==sY||"uniform"==sY)su=sw._parseOne(sh,s_,sq,su,sY,!0);else{if("#define"==sY){sm[sY=sq[++su]]=1;continue}if("#ifdef"==sY){sN[sb=sq[++su]]=sN[sb]||[];for(su++;su<sx;su++)if("attribute"==(sY=sq[su])||"uniform"==sY)su=sw._parseOne(sh,s_,sq,su,sY,sm[sb]);else if("#else"==sY)for(su++;su<sx;su++)if("attribute"==(sY=sq[su])||"uniform"==sY)su=sw._parseOne(sh,s_,sq,su,sY,!sm[sb]);else if("#endif"==sY)break}}}}return sZ},sw.splitToWords=function(sd,sL){for(var sl,sZ,sh=[],s_=-1,sN=0,sm=sd.length;sN<sm;sN++)if(sl=sd.charAt(sN),0<=" \t=+-*/&%!<>()'\",;".indexOf(sl)){if(0<=s_&&1<sN-s_&&(sZ=sd.substr(s_,sN-s_),sh.push(sZ)),'"'==sl||"'"==sl){var su=sd.indexOf(sl,sN+1);if(su<0)throw"Sharder err:"+sd;sh.push(sd.substr(sN+1,su-sN-1)),sN=su,s_=-1;continue}"("==sl&&sL&&0<sh.length&&(sZ=sh[sh.length-1]+";","vec4;main;".indexOf(sZ)<0&&(sL.useFuns+=sZ)),s_=-1}else s_<0&&(s_=sN);return s_<sm&&1<sm-s_&&(sZ=sd.substr(s_,sm-s_),sh.push(sZ)),sh},sw.IFDEF_NO=0,sw.IFDEF_YES=1,sw.IFDEF_ELSE=2,sw.IFDEF_PARENT=3,sw._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),sw._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),sw._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),sw.includes={},sN(sw,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),sw.__init$=function(){se=function(){function sl(sd){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=sd}sq(sl,"");var sd=sl.prototype;return sd.setParent=function(sd){sd.childs.push(this),this.z=sd.z+1,this.parent=sd},sd.setCondition=function(sd,sL){sd&&(this.conditionType=sL,sd=sd.replace(/(\s*$)/g,""),this.condition=function(){return this[sd]},this.condition.__condition=sd)},sd.toscript=function(sd,sL){return this._toscript(sd,sL,++sl.__id)},sd._toscript=function(sZ,sh,s_){if(this.childs.length<1&&!this.text)return sh;sh.length;if(this.condition){var sd=!!this.condition.call(sZ);if(2===this.conditionType&&(sd=!sd),!sd)return sh}if(this.text&&sh.push(this.text),0<this.childs.length&&this.childs.forEach(function(sd,sL,sl){sd._toscript(sZ,sh,s_)}),0<this.includefiles.length&&0<this.useFuns.length)for(var sL,sl=0,sN=this.includefiles.length;sl<sN;sl++)this.includefiles[sl].curUseID!=s_&&0<(sL=this.includefiles[sl].file.getFunsScript(this.useFuns)).length&&(this.includefiles[sl].curUseID=s_,sh[0]=sL+sh[0]);return sh},sl.__id=1,sl}(),sl=function(){function sd(sd){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=sd;for(var sL=0,sl=0,sZ=0;!((sL=sd.indexOf("#begin",sL))<0);){for(sZ=sL+5;!((sZ=sd.indexOf("#end",sZ))<0)&&"i"===sd.charAt(sZ+4);)sZ+=5;if(sZ<0)throw"add include err,no #end:"+sd;sl=sd.indexOf("\n",sL);var sh=sw.splitToWords(sd.substr(sL,sl-sL),null);"code"==sh[1]?this.codes[sh[2]]=sd.substr(sl+1,sZ-sl-1):"function"==sh[1]&&(sl=sd.indexOf("function",sL),sl+="function".length,this.funs[sh[3]]=sd.substr(sl+1,sZ-sl-1),this.funnames+=sh[3]+";"),sL=sZ+1}}sq(sd,"");var sL=sd.prototype;return sL.getWith=function(sd){var sL=sd?this.codes[sd]:this.script;if(!sL)throw"get with error:"+sd;return sL},sL.getFunsScript=function(sd){var sL="";for(var sl in this.funs)0<=sd.indexOf(sl+";")&&(sL+=this.funs[sl]);return sL},sd}()},sw}(),ssd=function(){function sN(){}return sq(sN,"laya.webgl.WebGL"),sN._uint8ArraySlice=function(){for(var sd=this.length,sL=new Uint8Array(this.length),sl=0;sl<sd;sl++)sL[sl]=this[sl];return sL},sN._float32ArraySlice=function(){for(var sd=this.length,sL=new Float32Array(this.length),sl=0;sl<sd;sl++)sL[sl]=this[sl];return sL},sN._uint16ArraySlice=function(sd){var sL,sl=arguments,sZ=0,sh=0;if(0===sl.length)for(sZ=this.length,sL=new Uint16Array(sZ),sh=0;sh<sZ;sh++)sL[sh]=this[sh];else if(2===sl.length){var s_=sl[0],sN=sl[1];if(s_<sN)for(sZ=sN-s_,sL=new Uint16Array(sZ),sh=s_;sh<sN;sh++)sL[sh-s_]=this[sh];else sL=new Uint16Array(0)}return sL},sN.expandContext=function(){var sd=sh.prototype,sL=CanvasRenderingContext2D.prototype;sL.fillTrangles=sd.fillTrangles,sJd.__int__(null),sL.setIBVB=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){void 0===su&&(su=0),void 0===sx&&(sx=0),null===sl&&(this._ib=this._ib||sWd.QuadrangleIB,sl=this._ib,sad.expandIBQuadrangle(sl,sZ._byteLength/64+8)),this._setIBVB(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx)},sL.fillTrangles=function(sd,sL,sl,sZ,sh){this._curMat=this._curMat||sn.create(),this._vb=this._vb||sMd.create(),this._ib||(this._ib=sWd.create(),sad.fillIBQuadrangle(this._ib,sN/4));var s_=this._vb,sN=sZ.length>>4;sad.fillTranglesVB(s_,sL,sl,sZ,sh||this._curMat,0,0),sad.expandIBQuadrangle(this._ib,s_._byteLength/64+8);var sm=new sOd(1,0);sm.textureHost=sd;var su=new sUd("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");s_._vertType=3,this._setIBVB(sL,sl,this._ib,s_,6*sN,sh,su,sm,0,0)}},sN.enable=function(){if(sY.__init__(),sk.isConchApp&&!sk.isConchWebGL)return sA.skinAniSprite=function(){return new sdd},sN.expandContext(),!1;if(sA.getWebGLContext=function(sd){for(var sL,sl=["webgl","experimental-webgl","webkit-3d","moz-webgl"],sZ=0;sZ<sl.length;sZ++){try{sL=sd.getContext(sl[sZ],{stencil:s$.isStencil,alpha:s$.isAlpha,antialias:s$.isAntialias,premultipliedAlpha:s$.premultipliedAlpha,preserveDrawingBuffer:s$.preserveDrawingBuffer})}catch(sd){}if(sL)return sL}return null},null==(sN.mainContext=sA.getWebGLContext(sk._mainCanvas)))return!1;if(sk.isWebGL)return!0;sr.create=function(sd,sL){return new sdL(sd,sL)},sa.create=function(sd,sL,sl,sZ,sh,s_,sN){return new sKd(sd,sL,sl,sZ,sh,s_,sN)},sk.WebGL=sN,sk.isWebGL=!0,sYd.__init__(),sA.createRenderSprite=function(sd,sL){return new snd(sd,sL)},sA.createWebGLContext2D=function(sd){return new s$d(sd)},sA.changeWebGLSize=function(sd,sL){laya.webgl.WebGL.onStageResize(sd,sL)},sA.createGraphics=function(){return new syd};var sd=sA.createFilterAction;return sA.createFilterAction=sd||function(sd){return new sVd},sA.clear=function(sd){sed.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var sL=sk.context.ctx,sl=0==sL._submits._length||s$.preserveDrawingBuffer?sc.create(sd)._color:sF._wgColor;sl&&sL.clearBG(sl[0],sl[1],sl[2],sl[3]),sed.clear()},sA.addToAtlas=function(sd,sL){void 0===sL&&(sL=!1);var sl=sd.bitmap;sk.optimizeTextureMemory(sd.url,sd)?sy.__typeof(sl,"laya.webgl.resource.IMergeAtlasBitmap")&&sl.allowMerageInAtlas&&sl.on("recovered",sd,sd.addTextureToAtlas):sl.enableMerageInAtlas=!1},sA.isAtlas=function(sd){return sd instanceof laya.webgl.atlas.AtlasWebGLCanvas},sB._enable(),sA.beginFlush=function(){for(var sd=sB.instance,sL=sd.getAtlaserCount(),sl=0;sl<sL;sl++){var sZ=sd.getAtlaserByIndex(sl).texture;sZ._flashCacheImageNeedFlush&&sA.flashFlushImage(sZ)}},sA.drawToCanvas=function(sd,sL,sl,sZ,sh,s_){(sl<=0||sZ<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),sl|=0,sZ|=0,sh|=0,s_|=0;var sN=sRd.create(sl,sZ,6408,5121,0,!1);sN.start(),sN.clear(0,0,0,0),sk.context.clear(),se.renders[sL]._fun(sd,sk.context,sh,sed.height-sZ+s_),sk.context.flush(),sN.end();var sm=sN.getData(0,0,sl,sZ);if(sN.recycle(),sm.byteLength==sl*sZ*4){var su=new szd;su._canvas=sY.createElement("canvas"),su.size(sl,sZ);var sx=su._canvas.getContext("2d");sY.canvas.size(sl,sZ);var st=sY.context,sb=st.createImageData(sl,sZ);return sb.data.set(new Uint8ClampedArray(sm.buffer)),su._imgData=sb,st.putImageData(sb,0,0),sx.save(),sx.translate(0,sZ),sx.scale(1,-1),sx.drawImage(sY.canvas.source,0,0),sx.restore(),su}console.log("drawToCanvas error: w:"+sl+",h:"+sZ+",datalen:"+sm.byteLength)},sA.createFilterAction=function(sd){var sL;switch(sd){case 32:sL=new sVd}return sL},sA.addTextureToAtlas=function(sd){sd._uvID++,sB._atlasRestore++,sd.bitmap.enableMerageInAtlas&&sB.instance.addToAtlas(sd)},sA.getTexturePixels=function(sd,sL,sl,sZ,sh){sk.context.ctx.clear();var s_=new sg;s_.graphics.drawTexture(sd,-sL,-sl);var sN=sRd.create(sZ,sh);sN.start(),sN.clear(0,0,0,0),s_.render(sk.context,0,0),sk.context.ctx.flush(),sN.end();for(var sm=sN.getData(0,0,sZ,sh),su=[],sx=0,st=sh-1;0<=st;st--)for(var sb=0;sb<sZ;sb++)sx=4*(st*sZ+sb),su.push(sm[sx]),su.push(sm[sx+1]),su.push(sm[sx+2]),su.push(sm[sx+3]);return su},sA.skinAniSprite=function(){return new sdd},sx.create=function(sd,sL){var sl=new szd;return sl._imgData=sL,sl.flipY=!1,sl},sO._filterStart=function(sd,sL,sl,sZ,sh){var s_=sd.getValue("bounds"),sN=sRd.create(s_.width,s_.height);if(sN.start(),sN.clear(0,0,0,0),sd.addValue("src",sN),sd.addValue("ScissorTest",sed.worldScissorTest),sed.worldScissorTest){var sm=new sQ;sm.copyFrom(sl.ctx._clipRect),sd.addValue("clipRect",sm),sed.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},sO._filterEnd=function(sd,sL,sl,sZ,sh){var s_=sd.getValue("bounds");sd.getValue("src").end();var sN=sRd.create(s_.width,s_.height);sN.start(),sN.clear(0,0,0,0),sd.addValue("out",sN),sL._set$P("_filterCache",sN),sL._set$P("_isHaveGlowFilter",sd.getValue("_isHaveGlowFilter"))},sO._EndTarget=function(sd,sL){if(sd.getValue("src").recycle(),sd.getValue("out").end(),sd.getValue("ScissorTest")){sed.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),sL.ctx.save();var sl=sd.getValue("clipRect");sL.ctx.clipRect(sl.x,sl.y,sl.width,sl.height)}},sO._useSrc=function(sd){var sL=sd.getValue("out");sL.end(),(sL=sd.getValue("src")).start(),sL.clear(0,0,0,0)},sO._endSrc=function(sd){sd.getValue("src").end()},sO._useOut=function(sd){var sL=sd.getValue("src");sL.end(),(sL=sd.getValue("out")).start(),sL.clear(0,0,0,0)},sO._endOut=function(sd){sd.getValue("out").end()},sO._recycleScope=function(sd){sd.recycle()},sO._filter=function(sd,sL,sl,sZ){var sh=this._next;if(sh){var s_,sN,sm=sd.filters,su=sm.length;if(1==su&&32==sm[0].type)return sL.ctx.save(),sL.ctx.setFilters([sm[0]]),sh._fun.call(sh,sd,sL,sl,sZ),void sL.ctx.restore();var sx=smd.create(),st=sV.TEMP,sb=sL.ctx._getTransformMatrix(),sq=sn.create();sb.copyTo(sq);var sY=0,sc=0,sr=!1,sa=sd._$P._filterCache?sd._$P._filterCache:null;if(!sa||sd._repaint){sr=sd._isHaveGlowFilter(),sx.addValue("_isHaveGlowFilter",sr),sr&&(sY=50,sc=25),(sN=new sQ).copyFrom(sd.getSelfBounds()),sN.x+=sd.x,sN.y+=sd.y,sN.x-=sd.pivotX+4,sN.y-=sd.pivotY+4;var sk=sN.x,se=sN.y;if(sN.width+=sY+8,sN.height+=sY+8,st.x=sN.x*sq.a+sN.y*sq.c,st.y=sN.y*sq.d+sN.x*sq.b,sN.x=st.x,sN.y=st.y,st.x=sN.width*sq.a+sN.height*sq.c,st.y=sN.height*sq.d+sN.width*sq.b,sN.width=st.x,sN.height=st.y,sN.width<=0||sN.height<=0)return;sa&&sa.recycle(),sx.addValue("bounds",sN);var sw=sNd.create([sx,sd,sL,0,0],sO._filterStart);sL.addRenderObject(sw),sL.ctx._renderKey=0,sL.ctx._shader2D.glTexture=null;var ss=sd.x-sk+sc,sA=sd.y-se+sc;sh._fun.call(sh,sd,sL,ss,sA),sw=sNd.create([sx,sd,sL,0,0],sO._filterEnd),sL.addRenderObject(sw);for(var sy=0;sy<su;sy++){0!=sy&&(sw=sNd.create([sx],sO._useSrc),sL.addRenderObject(sw),s_=sOd.create(1,0),sn.TEMP.identity(),sL.ctx.drawTarget(sx,0,0,sN.width,sN.height,sn.TEMP,"out",s_,null,sP.TOINT.overlay),sw=sNd.create([sx],sO._useOut),sL.addRenderObject(sw)),sm[sy].action.apply3d(sx,sd,sL,0,0)}sw=sNd.create([sx,sL],sO._EndTarget),sL.addRenderObject(sw)}else{if((sr=!!sd._$P._isHaveGlowFilter&&sd._$P._isHaveGlowFilter)&&(sY=50,sc=25),(sN=sd.getBounds()).width<=0||sN.height<=0)return;sN.width+=sY,sN.height+=sY,st.x=sN.x*sq.a+sN.y*sq.c,st.y=sN.y*sq.d+sN.x*sq.b,sN.x=st.x,sN.y=st.y,st.x=sN.width*sq.a+sN.height*sq.c,st.y=sN.height*sq.d+sN.width*sq.b,sN.width=st.x,sN.height=st.y,sx.addValue("out",sa)}sl=sl-sc-sd.x,sZ=sZ-sc-sd.y,st.setTo(sl,sZ),sq.transformPoint(st),sl=st.x+sN.x,sZ=st.y+sN.y,s_=sOd.create(1,0),sn.TEMP.identity(),sL.ctx.drawTarget(sx,sl,sZ,sN.width,sN.height,sn.TEMP,"out",s_,null,sP.TOINT.overlay),sw=sNd.create([sx],sO._recycleScope),sL.addRenderObject(sw),sq.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=sN._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=sN._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=sN._uint8ArraySlice),!0},sN.onStageResize=function(sd,sL){null!=sN.mainContext&&(sN.mainContext.viewport(0,0,sd,sL),sed.width=sd,sed.height=sL)},sN.onInvalidGLRes=function(){sB.instance.freeAll(),ss.releaseContentManagers(!0),sN.doNodeRepaint(sy.stage),sN.mainContext.viewport(0,0,sed.width,sed.height),sy.stage.event("devicelost")},sN.doNodeRepaint=function(sd){0==sd.numChildren&&sd.repaint();for(var sL=0;sL<sd.numChildren;sL++)sN.doNodeRepaint(sd.getChildAt(sL))},sN.init=function(sd,sL,sl){sN.mainCanvas=sd,sx._createContext=function(sd){return new s$d(sd)},szd._createContext=function(sd){return new s$d(sd)};var sZ=laya.webgl.WebGL.mainContext;if(null!=sZ.getShaderPrecisionFormat){var sh=sZ.getShaderPrecisionFormat(35633,36338),s_=sZ.getShaderPrecisionFormat(35632,36338);sN.shaderHighPrecision=!(!sh.precision||!s_.precision)}else sN.shaderHighPrecision=!1;if(sZ.deleteTexture1=sZ.deleteTexture,sZ.deleteTexture=function(sd){sd==sAd.curBindTexValue&&(sAd.curBindTexValue=null),sZ.deleteTexture1(sd)},sN.onStageResize(sL,sl),null==sN.mainContext)throw new Error("webGL getContext err!");sp.__init__(),sB.__init__(),sgd.__init__(),s_d.__init__(),s$d.__init__(),sOd.__init__(),sW.__init__(),sJd.__int__(sZ),sP._init_(sZ),sk.isConchApp&&conch.setOnInvalidGLRes(sN.onInvalidGLRes)},sN.mainCanvas=null,sN.mainContext=null,sN.antialias=!0,sN.shaderHighPrecision=!1,sN._bg_null=[0,0,0,0],sN}(),sAd=function(){function sZ(){}return sq(sZ,"laya.webgl.WebGLContext"),sZ.UseProgram=function(sd){return sZ._useProgram!==sd&&(ssd.mainContext.useProgram(sd),sZ._useProgram=sd,!0)},sZ.setDepthTest=function(sd,sL){sL!==sZ._depthTest&&((sZ._depthTest=sL)?sd.enable(2929):sd.disable(2929))},sZ.setDepthMask=function(sd,sL){sL!==sZ._depthMask&&(sZ._depthMask=sL,sd.depthMask(sL))},sZ.setDepthFunc=function(sd,sL){sL!==sZ._depthFunc&&(sZ._depthFunc=sL,sd.depthFunc(sL))},sZ.setBlend=function(sd,sL){sL!==sZ._blend&&((sZ._blend=sL)?sd.enable(3042):sd.disable(3042))},sZ.setBlendFunc=function(sd,sL,sl){(sL!==sZ._sFactor||sl!==sZ._dFactor)&&(sZ._sFactor=sL,sZ._dFactor=sl,sd.blendFunc(sL,sl))},sZ.setCullFace=function(sd,sL){sL!==sZ._cullFace&&((sZ._cullFace=sL)?sd.enable(2884):sd.disable(2884))},sZ.setFrontFace=function(sd,sL){sL!==sZ._frontFace&&(sZ._frontFace=sL,sd.frontFace(sL))},sZ.bindTexture=function(sd,sL,sl){sd.bindTexture(sL,sl),sZ.curBindTexTarget=sL,sZ.curBindTexValue=sl},sZ.DEPTH_BUFFER_BIT=256,sZ.STENCIL_BUFFER_BIT=1024,sZ.COLOR_BUFFER_BIT=16384,sZ.POINTS=0,sZ.LINES=1,sZ.LINE_LOOP=2,sZ.LINE_STRIP=3,sZ.TRIANGLES=4,sZ.TRIANGLE_STRIP=5,sZ.TRIANGLE_FAN=6,sZ.ZERO=0,sZ.ONE=1,sZ.SRC_COLOR=768,sZ.ONE_MINUS_SRC_COLOR=769,sZ.SRC_ALPHA=770,sZ.ONE_MINUS_SRC_ALPHA=771,sZ.DST_ALPHA=772,sZ.ONE_MINUS_DST_ALPHA=773,sZ.DST_COLOR=774,sZ.ONE_MINUS_DST_COLOR=775,sZ.SRC_ALPHA_SATURATE=776,sZ.FUNC_ADD=32774,sZ.BLEND_EQUATION=32777,sZ.BLEND_EQUATION_RGB=32777,sZ.BLEND_EQUATION_ALPHA=34877,sZ.FUNC_SUBTRACT=32778,sZ.FUNC_REVERSE_SUBTRACT=32779,sZ.BLEND_DST_RGB=32968,sZ.BLEND_SRC_RGB=32969,sZ.BLEND_DST_ALPHA=32970,sZ.BLEND_SRC_ALPHA=32971,sZ.CONSTANT_COLOR=32769,sZ.ONE_MINUS_CONSTANT_COLOR=32770,sZ.CONSTANT_ALPHA=32771,sZ.ONE_MINUS_CONSTANT_ALPHA=32772,sZ.BLEND_COLOR=32773,sZ.ARRAY_BUFFER=34962,sZ.ELEMENT_ARRAY_BUFFER=34963,sZ.ARRAY_BUFFER_BINDING=34964,sZ.ELEMENT_ARRAY_BUFFER_BINDING=34965,sZ.STREAM_DRAW=35040,sZ.STATIC_DRAW=35044,sZ.DYNAMIC_DRAW=35048,sZ.BUFFER_SIZE=34660,sZ.BUFFER_USAGE=34661,sZ.CURRENT_VERTEX_ATTRIB=34342,sZ.FRONT=1028,sZ.BACK=1029,sZ.CULL_FACE=2884,sZ.FRONT_AND_BACK=1032,sZ.BLEND=3042,sZ.DITHER=3024,sZ.STENCIL_TEST=2960,sZ.DEPTH_TEST=2929,sZ.SCISSOR_TEST=3089,sZ.POLYGON_OFFSET_FILL=32823,sZ.SAMPLE_ALPHA_TO_COVERAGE=32926,sZ.SAMPLE_COVERAGE=32928,sZ.NO_ERROR=0,sZ.INVALID_ENUM=1280,sZ.INVALID_VALUE=1281,sZ.INVALID_OPERATION=1282,sZ.OUT_OF_MEMORY=1285,sZ.CW=2304,sZ.CCW=2305,sZ.LINE_WIDTH=2849,sZ.ALIASED_POINT_SIZE_RANGE=33901,sZ.ALIASED_LINE_WIDTH_RANGE=33902,sZ.CULL_FACE_MODE=2885,sZ.FRONT_FACE=2886,sZ.DEPTH_RANGE=2928,sZ.DEPTH_WRITEMASK=2930,sZ.DEPTH_CLEAR_VALUE=2931,sZ.DEPTH_FUNC=2932,sZ.STENCIL_CLEAR_VALUE=2961,sZ.STENCIL_FUNC=2962,sZ.STENCIL_FAIL=2964,sZ.STENCIL_PASS_DEPTH_FAIL=2965,sZ.STENCIL_PASS_DEPTH_PASS=2966,sZ.STENCIL_REF=2967,sZ.STENCIL_VALUE_MASK=2963,sZ.STENCIL_WRITEMASK=2968,sZ.STENCIL_BACK_FUNC=34816,sZ.STENCIL_BACK_FAIL=34817,sZ.STENCIL_BACK_PASS_DEPTH_FAIL=34818,sZ.STENCIL_BACK_PASS_DEPTH_PASS=34819,sZ.STENCIL_BACK_REF=36003,sZ.STENCIL_BACK_VALUE_MASK=36004,sZ.STENCIL_BACK_WRITEMASK=36005,sZ.VIEWPORT=2978,sZ.SCISSOR_BOX=3088,sZ.COLOR_CLEAR_VALUE=3106,sZ.COLOR_WRITEMASK=3107,sZ.UNPACK_ALIGNMENT=3317,sZ.PACK_ALIGNMENT=3333,sZ.MAX_TEXTURE_SIZE=3379,sZ.MAX_VIEWPORT_DIMS=3386,sZ.SUBPIXEL_BITS=3408,sZ.RED_BITS=3410,sZ.GREEN_BITS=3411,sZ.BLUE_BITS=3412,sZ.ALPHA_BITS=3413,sZ.DEPTH_BITS=3414,sZ.STENCIL_BITS=3415,sZ.POLYGON_OFFSET_UNITS=10752,sZ.POLYGON_OFFSET_FACTOR=32824,sZ.TEXTURE_BINDING_2D=32873,sZ.SAMPLE_BUFFERS=32936,sZ.SAMPLES=32937,sZ.SAMPLE_COVERAGE_VALUE=32938,sZ.SAMPLE_COVERAGE_INVERT=32939,sZ.NUM_COMPRESSED_TEXTURE_FORMATS=34466,sZ.COMPRESSED_TEXTURE_FORMATS=34467,sZ.DONT_CARE=4352,sZ.FASTEST=4353,sZ.NICEST=4354,sZ.GENERATE_MIPMAP_HINT=33170,sZ.BYTE=5120,sZ.UNSIGNED_BYTE=5121,sZ.SHORT=5122,sZ.UNSIGNED_SHORT=5123,sZ.INT=5124,sZ.UNSIGNED_INT=5125,sZ.FLOAT=5126,sZ.DEPTH_COMPONENT=6402,sZ.ALPHA=6406,sZ.RGB=6407,sZ.RGBA=6408,sZ.LUMINANCE=6409,sZ.LUMINANCE_ALPHA=6410,sZ.UNSIGNED_SHORT_4_4_4_4=32819,sZ.UNSIGNED_SHORT_5_5_5_1=32820,sZ.UNSIGNED_SHORT_5_6_5=33635,sZ.FRAGMENT_SHADER=35632,sZ.VERTEX_SHADER=35633,sZ.MAX_VERTEX_ATTRIBS=34921,sZ.MAX_VERTEX_UNIFORM_VECTORS=36347,sZ.MAX_VARYING_VECTORS=36348,sZ.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,sZ.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,sZ.MAX_TEXTURE_IMAGE_UNITS=34930,sZ.MAX_FRAGMENT_UNIFORM_VECTORS=36349,sZ.SHADER_TYPE=35663,sZ.DELETE_STATUS=35712,sZ.LINK_STATUS=35714,sZ.VALIDATE_STATUS=35715,sZ.ATTACHED_SHADERS=35717,sZ.ACTIVE_UNIFORMS=35718,sZ.ACTIVE_ATTRIBUTES=35721,sZ.SHADING_LANGUAGE_VERSION=35724,sZ.CURRENT_PROGRAM=35725,sZ.NEVER=512,sZ.LESS=513,sZ.EQUAL=514,sZ.LEQUAL=515,sZ.GREATER=516,sZ.NOTEQUAL=517,sZ.GEQUAL=518,sZ.ALWAYS=519,sZ.KEEP=7680,sZ.REPLACE=7681,sZ.INCR=7682,sZ.DECR=7683,sZ.INVERT=5386,sZ.INCR_WRAP=34055,sZ.DECR_WRAP=34056,sZ.VENDOR=7936,sZ.RENDERER=7937,sZ.VERSION=7938,sZ.NEAREST=9728,sZ.LINEAR=9729,sZ.NEAREST_MIPMAP_NEAREST=9984,sZ.LINEAR_MIPMAP_NEAREST=9985,sZ.NEAREST_MIPMAP_LINEAR=9986,sZ.LINEAR_MIPMAP_LINEAR=9987,sZ.TEXTURE_MAG_FILTER=10240,sZ.TEXTURE_MIN_FILTER=10241,sZ.TEXTURE_WRAP_S=10242,sZ.TEXTURE_WRAP_T=10243,sZ.TEXTURE_2D=3553,sZ.TEXTURE=5890,sZ.TEXTURE_CUBE_MAP=34067,sZ.TEXTURE_BINDING_CUBE_MAP=34068,sZ.TEXTURE_CUBE_MAP_POSITIVE_X=34069,sZ.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,sZ.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,sZ.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,sZ.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,sZ.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,sZ.MAX_CUBE_MAP_TEXTURE_SIZE=34076,sZ.TEXTURE0=33984,sZ.TEXTURE1=33985,sZ.TEXTURE2=33986,sZ.TEXTURE3=33987,sZ.TEXTURE4=33988,sZ.TEXTURE5=33989,sZ.TEXTURE6=33990,sZ.TEXTURE7=33991,sZ.TEXTURE8=33992,sZ.TEXTURE9=33993,sZ.TEXTURE10=33994,sZ.TEXTURE11=33995,sZ.TEXTURE12=33996,sZ.TEXTURE13=33997,sZ.TEXTURE14=33998,sZ.TEXTURE15=33999,sZ.TEXTURE16=34e3,sZ.TEXTURE17=34001,sZ.TEXTURE18=34002,sZ.TEXTURE19=34003,sZ.TEXTURE20=34004,sZ.TEXTURE21=34005,sZ.TEXTURE22=34006,sZ.TEXTURE23=34007,sZ.TEXTURE24=34008,sZ.TEXTURE25=34009,sZ.TEXTURE26=34010,sZ.TEXTURE27=34011,sZ.TEXTURE28=34012,sZ.TEXTURE29=34013,sZ.TEXTURE30=34014,sZ.TEXTURE31=34015,sZ.ACTIVE_TEXTURE=34016,sZ.REPEAT=10497,sZ.CLAMP_TO_EDGE=33071,sZ.MIRRORED_REPEAT=33648,sZ.FLOAT_VEC2=35664,sZ.FLOAT_VEC3=35665,sZ.FLOAT_VEC4=35666,sZ.INT_VEC2=35667,sZ.INT_VEC3=35668,sZ.INT_VEC4=35669,sZ.BOOL=35670,sZ.BOOL_VEC2=35671,sZ.BOOL_VEC3=35672,sZ.BOOL_VEC4=35673,sZ.FLOAT_MAT2=35674,sZ.FLOAT_MAT3=35675,sZ.FLOAT_MAT4=35676,sZ.SAMPLER_2D=35678,sZ.SAMPLER_CUBE=35680,sZ.VERTEX_ATTRIB_ARRAY_ENABLED=34338,sZ.VERTEX_ATTRIB_ARRAY_SIZE=34339,sZ.VERTEX_ATTRIB_ARRAY_STRIDE=34340,sZ.VERTEX_ATTRIB_ARRAY_TYPE=34341,sZ.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,sZ.VERTEX_ATTRIB_ARRAY_POINTER=34373,sZ.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,sZ.COMPILE_STATUS=35713,sZ.LOW_FLOAT=36336,sZ.MEDIUM_FLOAT=36337,sZ.HIGH_FLOAT=36338,sZ.LOW_INT=36339,sZ.MEDIUM_INT=36340,sZ.HIGH_INT=36341,sZ.FRAMEBUFFER=36160,sZ.RENDERBUFFER=36161,sZ.RGBA4=32854,sZ.RGB5_A1=32855,sZ.RGB565=36194,sZ.DEPTH_COMPONENT16=33189,sZ.STENCIL_INDEX=6401,sZ.STENCIL_INDEX8=36168,sZ.DEPTH_STENCIL=34041,sZ.RENDERBUFFER_WIDTH=36162,sZ.RENDERBUFFER_HEIGHT=36163,sZ.RENDERBUFFER_INTERNAL_FORMAT=36164,sZ.RENDERBUFFER_RED_SIZE=36176,sZ.RENDERBUFFER_GREEN_SIZE=36177,sZ.RENDERBUFFER_BLUE_SIZE=36178,sZ.RENDERBUFFER_ALPHA_SIZE=36179,sZ.RENDERBUFFER_DEPTH_SIZE=36180,sZ.RENDERBUFFER_STENCIL_SIZE=36181,sZ.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,sZ.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,sZ.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,sZ.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,sZ.COLOR_ATTACHMENT0=36064,sZ.DEPTH_ATTACHMENT=36096,sZ.STENCIL_ATTACHMENT=36128,sZ.DEPTH_STENCIL_ATTACHMENT=33306,sZ.NONE=0,sZ.FRAMEBUFFER_COMPLETE=36053,sZ.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,sZ.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,sZ.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,sZ.FRAMEBUFFER_UNSUPPORTED=36061,sZ.FRAMEBUFFER_BINDING=36006,sZ.RENDERBUFFER_BINDING=36007,sZ.MAX_RENDERBUFFER_SIZE=34024,sZ.INVALID_FRAMEBUFFER_OPERATION=1286,sZ.UNPACK_FLIP_Y_WEBGL=37440,sZ.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,sZ.CONTEXT_LOST_WEBGL=37442,sZ.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,sZ.BROWSER_DEFAULT_WEBGL=37444,sZ._useProgram=null,sZ._depthTest=!0,sZ._depthMask=!0,sZ._blend=!1,sZ._cullFace=!1,sZ.curBindTexTarget=null,sZ.curBindTexValue=null,sN(sZ,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),sZ}(),syd=function(sd){function sL(){sL.__super.call(this)}sq(sL,"laya.webgl.display.GraphicsGL",sm);var sl=sL.prototype;return sl.setShader=function(sd){this._saveToCmd(sk.context._setShader,[sd])},sl.setIBVB=function(sd,sL,sl,sZ,sh,s_){this._saveToCmd(sk.context._setIBVB,[sd,sL,sl,sZ,sh,s_])},sl.drawParticle=function(sd,sL,sl){var sZ=sA.createParticleTemplate2D(sl);sZ.x=sd,sZ.y=sL,this._saveToCmd(sk.context._drawParticle,[sZ])},sL}(),s$d=function(sd){var sl;function sS(sd){this._x=0,this._y=0,this._id=++sS._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,sS.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=sS.MAXCLIPRECT,this.mOutPoint,this._canvas=sd,this._canvas._addReference(),sS._contextcount++,sk.isFlash?(this._ib=sWd.create(35044),sad.fillIBQuadrangle(this._ib,16)):this._ib=sWd.QuadrangleIB,this.clear()}sq(sS,"laya.webgl.canvas.WebGLContext2D",sh);var sL=sS.prototype;return sL.setIsMainContext=function(){this._isMain=!0},sL.clearBG=function(sd,sL,sl,sZ){var sh=ssd.mainContext;sh.clearColor(sd,sL,sl,sZ),sh.clear(16384)},sL._getSubmits=function(){return this._submits},sL._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var sd=0,sL=this._submits._length;sd<sL;sd++)this._submits[sd].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},sL.destroy=function(){--sS._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=sWd.QuadrangleIB&&this._ib.releaseResource()},sL.clear=function(){this._submits||(this._other=sl.DEFAULT,this._curMat=sn.create(),this._vb=sMd.create(-1),this._submits=[],this._save=[sv.Create(this)],this._save.length=10,this._shader2D=new sW,this._triangleMesh=sXd.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=sl.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=sS.MAXCLIPRECT,this._curSubmit=s_d.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=sT.DEFAULT;for(var sd=0,sL=this._submits._length;sd<sL;sd++)this._submits[sd].releaseRender(),this._submits[sd]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},sL.size=function(sd,sL){if(this._width!=sd||this._height!=sL)if(0==sd||0==sL){0!=this._vb._byteLength&&(this._width=sd,this._height=sL,this._vb.clear(),this._vb.upload());for(var sl=0,sZ=this._submits._length;sl<sZ;sl++)this._submits[sl].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=sd,this._height=sL,this._targets&&this._targets.size(sd,sL),this._canvas.memorySize-=this._canvas.memorySize;0===sd&&0===sL&&this._releaseMem()},sL._getTransformMatrix=function(){return this._curMat},sL.translate=function(sd,sL){0===sd&&0===sL||(sf.save(this),this._curMat.bTransform&&(sJ.save(this),this._curMat.transformPointN(sV.TEMP.setTo(sd,sL)),sd=sV.TEMP.x,sL=sV.TEMP.y),this._x+=sd,this._y+=sL)},sL.save=function(){this._save[this._save._length++]=sv.Create(this)},sL.restore=function(){var sd=this._save._length;if(!(sd<1))for(var sL=sd-1;0<=sL;sL--){var sl=this._save[sL];if(sl.restore(this),sl.isSaveMark())return void(this._save._length=sL)}},sL._fillText=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){void 0===sx&&(sx=0);var st=this._shader2D,sb=this._curSubmit.shaderValue,sq=sh?scd.create(sh):this._other.font;if(sB.enabled)st.ALPHA!==sb.ALPHA&&(st.glTexture=null),sYd.drawText(this,sd,sL,this._curMat,sq,su||this._other.textAlign,s_,sN,sm,sl,sZ,sx);else{this._shader2D.defines.getValue();var sY=s_?sc.create(s_)._color:st.colorAdd;st.ALPHA===sb.ALPHA&&sY===st.colorAdd&&sb.colorAdd===st.colorAdd||(st.glTexture=null,st.colorAdd=sY),sYd.drawText(this,sd,sL,this._curMat,sq,su||this._other.textAlign,s_,sN,sm,sl,sZ,sx)}},sL.fillWords=function(sd,sL,sl,sZ,sh,s_){this._fillText(null,sd,sL,sl,sZ,sh,null,-1,null,s_)},sL.fillBorderWords=function(sd,sL,sl,sZ,sh,s_,sN){this._fillBorderText(null,sd,sL,sl,sZ,sh,s_,sN,null)},sL.fillText=function(sd,sL,sl,sZ,sh,s_){this._fillText(sd,null,sL,sl,sZ,sh,null,-1,s_)},sL.strokeText=function(sd,sL,sl,sZ,sh,s_,sN){this._fillText(sd,null,sL,sl,sZ,null,sh,s_||1,sN)},sL.fillBorderText=function(sd,sL,sl,sZ,sh,s_,sN,sm){this._fillBorderText(sd,null,sL,sl,sZ,sh,s_,sN,sm)},sL._fillBorderText=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){if(!sB.enabled)return this._fillText(sd,sL,sl,sZ,sh,null,sN,sm||1,su),void this._fillText(sd,sL,sl,sZ,sh,s_,null,-1,su);var sx=this._shader2D,st=this._curSubmit.shaderValue;sx.ALPHA!==st.ALPHA&&(sx.glTexture=null);var sb=sh?(sS._fontTemp.setFont(sh),sS._fontTemp):this._other.font;sYd.drawText(this,sd,sL,this._curMat,sb,su||this._other.textAlign,s_,sN,sm||1,sl,sZ,0)},sL.fillRect=function(sd,sL,sl,sZ,sh){var s_=this._vb;if(sad.fillRectImgVb(s_,this._clipRect,sd,sL,sl,sZ,sX.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var sN=this._shader2D.fillStyle;sh&&(this._shader2D.fillStyle=sT.create(sh));var sm=this._shader2D,su=this._curSubmit.shaderValue;if(sm.fillStyle!==su.fillStyle||sm.ALPHA!==su.ALPHA){sm.glTexture=null;var sx=this._curSubmit=s_d.createSubmit(this,this._ib,s_,(s_._byteLength-64)/32*3,sOd.create(2,0));sx.shaderValue.color=sm.fillStyle._color._color,sx.shaderValue.ALPHA=sm.ALPHA,this._submits[this._submits._length++]=sx}this._curSubmit._numEle+=6,this._shader2D.fillStyle=sN}},sL.fillTexture=function(sd,sL,sl,sZ,sh,s_,sN,sm){if(sd.loaded&&sd.bitmap&&sd.source){var su=this._vb,sx=sd.bitmap.width,st=sd.bitmap.height,sb=sd.uv,sq=sN.x%sd.width,sY=sN.y%sd.height;if(sx!=sm.w||st!=sm.h){if(!sm.w&&!sm.h)switch(sm.oy=sm.ox=0,s_){case"repeat":sm.width=sZ,sm.height=sh;break;case"repeat-x":sm.width=sZ,sY<0?sd.height+sY>sh?sm.height=sh:sm.height=sd.height+sY:(sm.oy=sY,sd.height+sY>sh?sm.height=sh-sY:sm.height=sd.height);break;case"repeat-y":sq<0?sd.width+sq>sZ?sm.width=sZ:sm.width=sd.width+sq:(sm.ox=sq,sd.width+sq>sZ?sm.width=sZ-sq:sm.width=sd.width),sm.height=sh;break;case"no-repeat":sq<0?sd.width+sq>sZ?sm.width=sZ:sm.width=sd.width+sq:(sm.ox=sq,sd.width+sq>sZ?sm.width=sZ-sq:sm.width=sd.width),sY<0?sd.height+sY>sh?sm.height=sh:sm.height=sd.height+sY:(sm.oy=sY,sd.height+sY>sh?sm.height=sh-sY:sm.height=sd.height);break;default:sm.width=sZ,sm.height=sh}sm.w=sx,sm.h=st,sm.uv=[0,0,sm.width/sx,0,sm.width/sx,sm.height/st,0,sm.height/st]}if(sL+=sm.ox,sl+=sm.oy,sq-=sm.ox,sY-=sm.oy,sad.fillRectImgVb(su,this._clipRect,sL,sl,sm.width,sm.height,sm.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var sc=sHd.create(this,this._ib,su,(su._byteLength-64)/32*3,sOd.create(256,0)),sr=(this._submits[this._submits._length++]=sc).shaderValue;sr.textureHost=sd;var sa=sb[0]*sx,sk=sb[1]*st,se=(sb[2]-sb[0])*sx,sw=(sb[5]-sb[3])*st,ss=-sq/sx,sA=-sY/st;sr.u_TexRange[0]=sa/sx,sr.u_TexRange[1]=se/sx,sr.u_TexRange[2]=sk/st,sr.u_TexRange[3]=sw/st,sr.u_offset[0]=ss,sr.u_offset[1]=sA,sB.enabled&&!this._isMain&&sc.addTexture(sd,(su._byteLength>>2)-16),(this._curSubmit=sc)._renderType=10017,sc._numEle+=6}}else this.sprite&&sy.timer.callLater(this,this._repaintSprite)},sL.setShader=function(sd){sD.save(this,1048576,this._shader2D,!0),this._shader2D.shader=sd},sL.setFilters=function(sd){sD.save(this,2097152,this._shader2D,!0),this._shader2D.filters=sd,this._curSubmit=s_d.RENDERBASE,this._renderKey=0,this._drawCount++},sL.drawTexture=function(sd,sL,sl,sZ,sh,s_,sN){this._drawTextureM(sd,sL,sl,sZ,sh,s_,sN,null,1)},sL.addTextureVb=function(sd,sL,sl){var sZ=this._curSubmit._vb||this._vb,sh=sZ._byteLength>>2;sZ.byteLength=sh+16<<2;for(var s_=sZ.getFloat32Array(),sN=0;sN<16;sN+=4)s_[sh++]=sd[sN]+sL,s_[sh++]=sd[sN+1]+sl,s_[sh++]=sd[sN+2],s_[sh++]=sd[sN+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),sZ._upload=!0},sL.willDrawTexture=function(sd,sL){if(!(sd.loaded&&sd.bitmap&&sd.source))return this.sprite&&sy.timer.callLater(this,this._repaintSprite),0;var sl=sd.bitmap,sZ=sl.id+this._shader2D.ALPHA*sL+10016;if(sZ==this._renderKey)return sZ;var sh=this._shader2D,s_=sh.ALPHA,sN=this._curSubmit.shaderValue;sh.ALPHA*=sL,this._renderKey=sZ,this._drawCount++,sh.glTexture=sl;var sm=this._vb,su=null,sx=sm._byteLength/32*3,st=sN.textureHost&&sN.textureHost==sd&&sN.textureHost.alphaTexture==sd.alphaTexture;return su=sHd.create(this,this._ib,sm,sx,sOd.create(1,0)),(this._submits[this._submits._length++]=su).shaderValue.textureHost=sd,su._renderType=10016,su._preIsSameTextureShader=10016===this._curSubmit._renderType&&sh.ALPHA===sN.ALPHA&&st,this._curSubmit=su,sh.ALPHA=s_,sZ},sL.drawTextures=function(sd,sL,sl,sZ){if(sd.loaded&&sd.bitmap&&sd.source){var sh=this._clipRect;if(this._clipRect=sS.MAXCLIPRECT,this._drawTextureM(sd,sL[0],sL[1],sd.width,sd.height,sl,sZ,null,1)){if(this._clipRect=sh,sE.drawCall++,!(sL.length<4)){for(var s_=this._curSubmit._vb||this._vb,sN=this._curMat.a,sm=this._curMat.d,su=2,sx=sL.length;su<sx;su+=2)sad.copyPreImgVb(s_,(sL[su]-sL[su-2])*sN,(sL[su+1]-sL[su-1])*sm),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&sy.timer.callLater(this,this._repaintSprite)},sL._drawTextureM=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){if(!sd.loaded||!sd.source)return this.sprite&&sy.timer.callLater(this,this._repaintSprite),!1;var sx=this._curSubmit._vb||this._vb,st=sd.bitmap;sL+=s_,sl+=sN,this._drawCount++;var sb=st.id+this._shader2D.ALPHA*su+10016;if(sb!=this._renderKey){this._renderKey=sb;var sq=this._curSubmit.shaderValue,sY=this._shader2D,sc=sY.ALPHA;sY.ALPHA*=su,sY.glTexture=st;var sr=this._vb,sa=null,sk=sr._byteLength/32*3,se=sq.textureHost&&sq.textureHost==sd&&sq.textureHost.alphaTexture==sd.alphaTexture;sa=sHd.create(this,this._ib,sr,sk,sOd.create(1,0)),(this._submits[this._submits._length++]=sa).shaderValue.textureHost=sd,sa._renderType=10016,sa._preIsSameTextureShader=10016===this._curSubmit._renderType&&sY.ALPHA===sq.ALPHA&&se,this._curSubmit=sa,sx=this._curSubmit._vb||this._vb,sY.ALPHA=sc}return!!sad.fillRectImgVb(sx,this._clipRect,sL,sl,sZ||sd.width,sh||sd.height,sd.uv,sm||this._curMat,this._x,this._y,0,0)&&(sB.enabled&&!this._isMain&&this._curSubmit.addTexture(sd,(sx._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},sL._repaintSprite=function(){this.sprite&&this.sprite.repaint()},sL._drawText=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){var st=sd.bitmap;this._drawCount++;var sb=st.id+this._shader2D.ALPHA+10016;if(sb!=this._renderKey){this._renderKey=sb;var sq=this._curSubmit.shaderValue,sY=this._shader2D;sY.glTexture=st;var sc=this._vb,sr=null,sa=sc._byteLength/32*3,sk=sq.textureHost&&sq.textureHost==sd&&sq.textureHost.alphaTexture==sd.alphaTexture;(sr=sB.enabled?sHd.create(this,this._ib,sc,sa,sOd.create(1,0)):sHd.create(this,this._ib,sc,sa,sfd.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&sY.ALPHA===sq.ALPHA&&sk,(this._submits[this._submits._length++]=sr).shaderValue.textureHost=sd,sr._renderType=10016,this._curSubmit=sr}sd.active();var se=this._curSubmit._vb||this._vb;sad.fillRectImgVb(se,this._clipRect,sL+sN,sl+sm,sZ||sd.width,sh||sd.height,sd.uv,s_||this._curMat,this._x,this._y,su,sx,!0)&&(sB.enabled&&!this._isMain&&this._curSubmit.addTexture(sd,(se._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},sL.drawTextureWithTransform=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){if(s_){var sx=this._curMat,st=this._x,sb=this._y;(0!==sN||0!==sm)&&(this._x=sN*sx.a+sm*sx.c,this._y=sm*sx.d+sN*sx.b),s_&&sx.bTransform?(sn.mul(s_,sx,sS._tmpMatrix),(s_=sS._tmpMatrix)._checkTransform()):(this._x+=sx.tx,this._y+=sx.ty),this._drawTextureM(sd,sL,sl,sZ,sh,0,0,s_,su),this._x=st,this._y=sb}else this._drawTextureM(sd,sL,sl,sZ,sh,sN,sm,null,su)},sL.fillQuadrangle=function(sd,sL,sl,sZ,sh){var s_=this._curSubmit,sN=this._vb,sm=this._shader2D,su=s_.shaderValue;if(this._renderKey=0,sd.bitmap){var sx=sd.bitmap;sm.glTexture==sx&&sm.ALPHA===su.ALPHA||(sm.glTexture=sx,(s_=this._curSubmit=s_d.createSubmit(this,this._ib,sN,sN._byteLength/32*3,sOd.create(1,0))).shaderValue.glTexture=sx,this._submits[this._submits._length++]=s_),sad.fillQuadrangleImgVb(sN,sL,sl,sZ,sd.uv,sh||this._curMat,this._x,this._y)}else s_.shaderValue.fillStyle&&s_.shaderValue.fillStyle.equal(sd)&&sm.ALPHA===su.ALPHA||(sm.glTexture=null,(s_=this._curSubmit=s_d.createSubmit(this,this._ib,sN,sN._byteLength/32*3,sOd.create(2,0))).shaderValue.defines.add(2),s_.shaderValue.fillStyle=sT.create(sd),this._submits[this._submits._length++]=s_),sad.fillQuadrangleImgVb(sN,sL,sl,sZ,sX.DEF_UV,sh||this._curMat,this._x,this._y);s_._numEle+=6},sL.drawTexture2=function(sd,sL,sl,sZ,sh,s_,sN,sm){if(0!=s_){var su=this._curMat;if(this._x=sd*su.a+sL*su.c,this._y=sL*su.d+sd*su.b,sh&&(sh=su.bTransform||sh.bTransform?(sn.mul(sh,su,sS._tmpMatrix),sS._tmpMatrix):(this._x+=sh.tx+su.tx,this._y+=sh.ty+su.ty,sn.EMPTY)),1!==s_||sN){var sx=this._shader2D.ALPHA,st=this._nBlendType;this._shader2D.ALPHA=s_,sN&&(this._nBlendType=sP.TOINT(sN)),this._drawTextureM(sm[0],sm[1]-sl,sm[2]-sZ,sm[3],sm[4],0,0,sh,1),this._shader2D.ALPHA=sx,this._nBlendType=st}else this._drawTextureM(sm[0],sm[1]-sl,sm[2]-sZ,sm[3],sm[4],0,0,sh,1);this._x=this._y=0}},sL.drawCanvas=function(sd,sL,sl,sZ,sh){var s_=sd.context;if(this._renderKey=0,s_._targets)this._submits[this._submits._length++]=spd.create(s_,0,null),this._curSubmit=s_d.RENDERBASE,s_._targets.drawTo(this,sL,sl,sZ,sh);else{var sN=this._submits[this._submits._length++]=spd.create(s_,this._shader2D.ALPHA,this._shader2D.filters),sm=sZ/sd.width,su=sh/sd.height,sx=sN._matrix;this._curMat.copyTo(sx),1!=sm&&1!=su&&sx.scale(sm,su);var st=sx.tx,sb=sx.ty;sx.tx=sx.ty=0,sx.transformPoint(sV.TEMP.setTo(sL,sl)),sx.translate(sV.TEMP.x+st,sV.TEMP.y+sb),this._curSubmit=s_d.RENDERBASE}s$.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=s_._targets?"yellow":"green",this.strokeRect(sL-1,sl-1,sZ+2,sh+2,1),this.strokeRect(sL,sl,sZ,sh,1),this.restore())},sL.drawTarget=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){void 0===sx&&(sx=-1);var st=this._vb;if(sad.fillRectImgVb(st,this._clipRect,sL,sl,sZ,sh,su||sX.DEF_UV,s_||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var sb=this._curSubmit=sbd.create(this,this._ib,st,(st._byteLength-64)/32*3,sm,sN);sb.blendType=-1==sx?this._nBlendType:sx,sb.scope=sd,this._submits[this._submits._length++]=sb,this._curSubmit._numEle+=6}},sL.mixRGBandAlpha=function(sd){return this._mixRGBandAlpha(sd,this._shader2D.ALPHA)},sL._mixRGBandAlpha=function(sd,sL){var sl=(4278190080&sd)>>>24;return 0!=sl?sl*=sL:sl=255*sL,16777215&sd|sl<<24},sL.drawTriangles=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){if(!sd.loaded||!sd.source)return this.sprite&&sy.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;sd.bitmap;var st=this._mixRGBandAlpha(4294967295,sm),sb=(sZ.length,s_.length);this._renderKey=-1;var sq=this._curSubmit=sHd.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,sOd.create(1,0));return sq.shaderValue.textureHost=sd,sq._renderType=10016,this._submits[this._submits._length++]=sq,sN?(sS._tmpMatrix.a=sN.a,sS._tmpMatrix.b=sN.b,sS._tmpMatrix.c=sN.c,sS._tmpMatrix.d=sN.d,sS._tmpMatrix.tx=sN.tx+sL,sS._tmpMatrix.ty=sN.ty+sl,sn.mul(sS._tmpMatrix,this._curMat,sS._tmpMatrix)):(sS._tmpMatrix.a=this._curMat.a,sS._tmpMatrix.b=this._curMat.b,sS._tmpMatrix.c=this._curMat.c,sS._tmpMatrix.d=this._curMat.d,sS._tmpMatrix.tx=this._curMat.tx+sL,sS._tmpMatrix.ty=this._curMat.ty+sl),this._triangleMesh.addData(sZ,sh,s_,sS._tmpMatrix,st,this),this._curSubmit._numEle+=sb,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},sL.transform=function(sd,sL,sl,sZ,sh,s_){sJ.save(this),sn.mul(sn.TEMP.setTo(sd,sL,sl,sZ,sh,s_),this._curMat,this._curMat),this._curMat._checkTransform()},sL.setTransformByMatrix=function(sd){sd.copyTo(this._curMat)},sL.transformByMatrix=function(sd){sJ.save(this),sn.mul(sd,this._curMat,this._curMat),this._curMat._checkTransform()},sL.rotate=function(sd){sJ.save(this),this._curMat.rotateEx(sd)},sL.scale=function(sd,sL){sJ.save(this),this._curMat.scaleEx(sd,sL)},sL.clipRect=function(sd,sL,sl,sZ){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var sh=std.create(4);this.addRenderObject(sh);var s_=this._vb,sN=s_._byteLength>>2;if(sad.fillRectImgVb(s_,null,sd,sL,sl,sZ,sX.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var sm=this._curSubmit=s_d.createSubmit(this,this._ib,s_,(s_._byteLength-64)/32*3,sOd.create(2,0));sm.shaderValue.ALPHA=1,this._submits[this._submits._length++]=sm,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var su=std.create(5);this.addRenderObject(su);var sx=s_.getFloat32Array(),st=Math.min(Math.min(Math.min(sx[0+sN],sx[4+sN]),sx[8+sN]),sx[12+sN]),sb=Math.max(Math.max(Math.max(sx[0+sN],sx[4+sN]),sx[8+sN]),sx[12+sN]),sq=Math.min(Math.min(Math.min(sx[1+sN],sx[5+sN]),sx[9+sN]),sx[13+sN]),sY=Math.max(Math.max(Math.max(sx[1+sN],sx[5+sN]),sx[9+sN]),sx[13+sN]);sK.save(this,su,sd,sL,sl,sZ,st,sq,sb-st,sY-sq),this._curSubmit=s_d.RENDERBASE}else{sl*=this._curMat.a,sZ*=this._curMat.d;var sc=sV.TEMP;this._curMat.transformPoint(sc.setTo(sd,sL)),sl<0&&(sc.x=sc.x+sl,sl=-sl),sZ<0&&(sc.y=sc.y+sZ,sZ=-sZ),this._renderKey=0;var sr=this._curSubmit=sxd.create(this);(this._submits[this._submits._length++]=sr).submitIndex=this._submits._length,sr.submitLength=9999999,sG.save(this,sr);var sa=this._clipRect,sk=sa.x,se=sa.y,sw=sc.x+sl,ss=sc.y+sZ;sk<sc.x&&(sa.x=sc.x),se<sc.y&&(sa.y=sc.y),sa.width=Math.min(sw,sk+sa.width)-sa.x,sa.height=Math.min(ss,se+sa.height)-sa.y,this._shader2D.glTexture=null,sr.clipRect.copyFrom(sa),this._curSubmit=s_d.RENDERBASE}},sL.setIBVB=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st){if(void 0===su&&(su=0),void 0===sx&&(sx=0),void 0===st&&(st=0),null===sl){if(sk.isFlash){var sb=sZ;sb._selfIB||(sb._selfIB=sWd.create(35044)),sb._selfIB.clear(),sl=sb._selfIB}else sl=this._ib;sad.expandIBQuadrangle(sl,sZ._byteLength/(4*sZ.vertexStride*4))}if(!sm||!sN)throw Error("setIBVB must input:shader shaderValues");var sq=sud.create(this,sZ,sl,sh,sN,sm,su,sx,st);s_||(s_=sn.EMPTY),s_.translate(sd,sL),sn.mul(s_,this._curMat,sq._mat),s_.translate(-sd,-sL),this._submits[this._submits._length++]=sq,this._curSubmit=s_d.RENDERBASE,this._renderKey=0},sL.addRenderObject=function(sd){this._submits[this._submits._length++]=sd},sL.fillTrangles=function(sd,sL,sl,sZ,sh){var s_=this._curSubmit,sN=this._vb,sm=this._shader2D,su=s_.shaderValue,sx=sZ.length>>4,st=sd.bitmap;this._renderKey=0,sm.glTexture==st&&sm.ALPHA===su.ALPHA||((s_=this._curSubmit=s_d.createSubmit(this,this._ib,sN,sN._byteLength/32*3,sOd.create(1,0))).shaderValue.textureHost=sd,this._submits[this._submits._length++]=s_),sad.fillTranglesVB(sN,sL,sl,sZ,sh||this._curMat,this._x,this._y),s_._numEle+=6*sx},sL.submitElement=function(sd,sL){var sl=this._submits;for(sL<0&&(sL=sl._length);sd<sL;)sd+=sl[sd].renderSubmit()},sL.finish=function(){ssd.mainContext.finish()},sL.flush=function(){var sd=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(sd>this._ib.bufferLength/12&&sad.expandIBQuadrangle(this._ib,sd),!this._isMain&&sB.enabled&&sB._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=sB._atlasRestore;for(var sL=this._submits,sl=0,sZ=sL._length;sl<sZ;sl++){var sh=sL[sl];10016===sh.getRenderType()&&sh.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),sLd.instance&&sLd.getInstance().reset();var s_;for(sl=0,s_=this.meshlist.length;sl<s_;sl++){var sN=this.meshlist[sl];sN.canReuse?sN.releaseMesh():sN.destroy()}return this.meshlist.length=0,this._curSubmit=s_d.RENDERBASE,this._renderKey=0,this._triangleMesh=sXd.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},sL.setPathId=function(sd){if(this.mId=sd,-1!=this.mId){this.mHaveKey=!1;var sL=sR.getInstance();sL.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,sL.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},sL.movePath=function(sd,sL){var sl=sd,sZ=sL;sd=this._curMat.a*sl+this._curMat.c*sZ+this._curMat.tx,sL=this._curMat.b*sl+this._curMat.d*sZ+this._curMat.ty,this.mX+=sd,this.mY+=sL},sL.beginPath=function(){var sd=this._getPath();sd.tempArray.length=0,sd.closePath=!1,this.mX=0,this.mY=0},sL.closePath=function(){this._path.closePath=!0},sL.fill=function(sd){void 0===sd&&(sd=!1);var sL=this._getPath();this.drawPoly(0,0,sL.tempArray,this.fillStyle._color.numColor,0,0,sd)},sL.stroke=function(){var sd=this._getPath();if(0<this.lineWidth){if(-1==this.mId)sd.drawLine(0,0,sd.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var sL=sR.getInstance().shapeLineDic[this.mId];sL.rebuild(sd.tempArray),sd.setGeomtry(sL)}else sR.getInstance().addLine(this.mId,sd.drawLine(0,0,sd.tempArray,this.lineWidth,this.strokeStyle._color.numColor));sd.update();var sl=[this.mX,this.mY],sZ=s_d.createShape(this,sd.ib,sd.vb,sd.count,sd.offset,sOd.create(4,0));sZ.shaderValue.ALPHA=this._shader2D.ALPHA,sZ.shaderValue.u_pos=sl,sZ.shaderValue.u_mmat2=sed.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=sZ,this._renderKey=-1}},sL.line=function(sd,sL,sl,sZ,sh,s_){var sN=this._curSubmit,sm=this._vb;if(sad.fillLineVb(sm,this._clipRect,sd,sL,sl,sZ,sh,s_)){this._renderKey=0;var su=this._shader2D,sx=sN.shaderValue;su.strokeStyle===sx.strokeStyle&&su.ALPHA===sx.ALPHA||(su.glTexture=null,(sN=this._curSubmit=s_d.createSubmit(this,this._ib,sm,(sm._byteLength-64)/32*3,sOd.create(2,0))).shaderValue.strokeStyle=su.strokeStyle,sN.shaderValue.mainID=2,sN.shaderValue.ALPHA=su.ALPHA,this._submits[this._submits._length++]=sN),sN._numEle+=6}},sL.moveTo=function(sd,sL,sl){void 0===sl&&(sl=!0);var sZ=this._getPath();if(sl){var sh=sd,s_=sL;sd=this._curMat.a*sh+this._curMat.c*s_,sL=this._curMat.b*sh+this._curMat.d*s_}sZ.addPoint(sd,sL)},sL.lineTo=function(sd,sL,sl){void 0===sl&&(sl=!0);var sZ=this._getPath();if(sl){var sh=sd,s_=sL;sd=this._curMat.a*sh+this._curMat.c*s_,sL=this._curMat.b*sh+this._curMat.d*s_}sZ.addPoint(sd,sL)},sL.drawCurves=function(sd,sL,sl){this.setPathId(-1),this.beginPath(),this.strokeStyle=sl[3],this.lineWidth=sl[4];var sZ=sl[2];sd+=sl[0],sL+=sl[1],this.movePath(sd,sL),this.moveTo(sZ[0],sZ[1]);for(var sh=2,s_=sZ.length;sh<s_;)this.quadraticCurveTo(sZ[sh++],sZ[sh++],sZ[sh++],sZ[sh++]);this.stroke()},sL.arcTo=function(sd,sL,sl,sZ,sh){if(-1==this.mId||!this.mHaveKey){var s_=0,sN=0,sm=0,su=this._getPath();this._curMat.copyTo(sS._tmpMatrix),sS._tmpMatrix.tx=sS._tmpMatrix.ty=0,sS._tempPoint.setTo(su.getEndPointX(),su.getEndPointY()),sS._tmpMatrix.invertTransformPoint(sS._tempPoint);var sx=sS._tempPoint.x-sd,st=sS._tempPoint.y-sL,sb=Math.sqrt(sx*sx+st*st);if(!(sb<=1e-6)){var sq=sx/sb,sY=st/sb,sc=sl-sd,sr=sZ-sL,sa=sc*sc+sr*sr,sk=Math.sqrt(sa);if(!(sk<=1e-6)){var se=sc/sk,sw=sr/sk,ss=sq+se,sA=sY+sw,sy=Math.sqrt(ss*ss+sA*sA);if(!(sy<=1e-6)){var s$=ss/sy,sO=sA/sy,sn=Math.acos(s$*sq+sO*sY),sV=Math.PI/2-sn,sQ=(sb=sh/Math.tan(sV))*sq+sd,sg=sb*sY+sL,sF=Math.sqrt(sb*sb+sh*sh),sE=sd+s$*sF,sI=sL+sO*sF,sp=0,sH=0;if(0<=sq*sw-sY*se){var sX=2*sV/sS.SEGNUM;sp=Math.sin(sX),sH=Math.cos(sX)}else sX=2*-sV/sS.SEGNUM,sp=Math.sin(sX),sH=Math.cos(sX);sN=this._curMat.a*sQ+this._curMat.c*sg,sm=this._curMat.b*sQ+this._curMat.d*sg,sN==this._path.getEndPointX()&&sm==this._path.getEndPointY()||su.addPoint(sN,sm);var sj=sQ-sE,sR=sg-sI;for(s_=0;s_<sS.SEGNUM;s_++){var so=sj*sH+sR*sp,si=-sj*sp+sR*sH;sN=so+sE,sm=si+sI,sd=this._curMat.a*sN+this._curMat.c*sm,sm=sL=this._curMat.b*sN+this._curMat.d*sm,(sN=sd)==this._path.getEndPointX()&&sm==this._path.getEndPointY()||su.addPoint(sN,sm),sj=so,sR=si}}}}}},sL.arc=function(sd,sL,sl,sZ,sh,s_,sN){if(void 0===s_&&(s_=!1),void 0===sN&&(sN=!0),-1!=this.mId){var sm=sR.getInstance().shapeDic[this.mId];if(sm&&this.mHaveKey&&!sm.needUpdate(this._curMat))return;sL=sd=0}var su,sx=0,st=0,sb=0,sq=0,sY=0,sc=0,sr=0;if(st=sh-sZ,s_)if(Math.abs(st)>=2*Math.PI)st=2*-Math.PI;else for(;0<st;)st-=2*Math.PI;else if(Math.abs(st)>=2*Math.PI)st=2*Math.PI;else for(;st<0;)st+=2*Math.PI;su=st/(sr=sl<101?Math.max(10,st*sl/5):sl<201?Math.max(10,st*sl/20):Math.max(10,st*sl/40))/2,sb=Math.abs(4/3*(1-Math.cos(su))/Math.sin(su)),s_&&(sb=-sb);var sa=this._getPath(),sk=NaN,se=NaN;for(sc=0;sc<=sr;sc++)sx=sZ+st*(sc/sr),sq=sd+Math.cos(sx)*sl,sY=sL+Math.sin(sx)*sl,sN&&(sk=sq,se=sY,sq=this._curMat.a*sk+this._curMat.c*se,sY=this._curMat.b*sk+this._curMat.d*se),sq==this._path.getEndPointX()&&sY==this._path.getEndPointY()||sa.addPoint(sq,sY);sq=sd+Math.cos(sh)*sl,sY=sL+Math.sin(sh)*sl,sN&&(sk=sq,se=sY,sq=this._curMat.a*sk+this._curMat.c*se,sY=this._curMat.b*sk+this._curMat.d*se),sq==this._path.getEndPointX()&&sY==this._path.getEndPointY()||sa.addPoint(sq,sY)},sL.quadraticCurveTo=function(sd,sL,sl,sZ){var sh=sb.I,s_=sl,sN=sZ;sl=this._curMat.a*s_+this._curMat.c*sN,sZ=this._curMat.b*s_+this._curMat.d*sN,s_=sd,sN=sL,sd=this._curMat.a*s_+this._curMat.c*sN,sL=this._curMat.b*s_+this._curMat.d*sN;for(var sm=sh.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),sd,sL,sl,sZ],30,2),su=0,sx=sm.length/2;su<sx;su++)this.lineTo(sm[2*su],sm[2*su+1],!1);this.lineTo(sl,sZ,!1)},sL.rect=function(sd,sL,sl,sZ){this._other=this._other.make(),this._other.path||(this._other.path=new sz),this._other.path.rect(sd,sL,sl,sZ)},sL.strokeRect=function(sd,sL,sl,sZ,sh){var s_=.5*sh;this.line(sd-s_,sL,sd+sl+s_,sL,sh,this._curMat),this.line(sd+sl,sL,sd+sl,sL+sZ,sh,this._curMat),this.line(sd,sL,sd,sL+sZ,sh,this._curMat),this.line(sd-s_,sL+sZ,sd+sl+s_,sL+sZ,sh,this._curMat)},sL.clip=function(){},sL.drawPoly=function(sd,sL,sl,sZ,sh,s_,sN){void 0===sN&&(sN=!1),this._renderKey=0,this._shader2D.glTexture=null;var sm=this._getPath();if(-1==this.mId)sm.polygon(sd,sL,sl,sZ,sh||1,s_);else if(this.mHaveKey){var su=sR.getInstance().shapeDic[this.mId];su.setMatrix(this._curMat),su.rebuild(sm.tempArray),sm.setGeomtry(su)}else{var sx=sm.polygon(sd,sL,sl,sZ,sh||1,s_);sR.getInstance().addShape(this.mId,sx),sx.setMatrix(this._curMat)}sm.update();var st,sb=[this.mX,this.mY];if((st=s_d.createShape(this,sm.ib,sm.vb,sm.count,sm.offset,sOd.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,st.shaderValue.u_pos=sb,st.shaderValue.u_mmat2=sed.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=st,0<sh){if(this.mHaveLineKey){var sq=sR.getInstance().shapeLineDic[this.mId];sq.rebuild(sm.tempArray),sm.setGeomtry(sq)}else sR.getInstance().addShape(this.mId,sm.drawLine(sd,sL,sl,sh,s_));sm.update(),(st=s_d.createShape(this,sm.ib,sm.vb,sm.count,sm.offset,sOd.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,st.shaderValue.u_mmat2=sed.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=st}},sL.drawParticle=function(sd,sL,sl){sl.x=sd,sl.y=sL,this._submits[this._submits._length++]=sl},sL._getPath=function(){return this._path||(this._path=new sz)},sZ(0,sL,"globalCompositeOperation",function(){return sP.NAMES[this._nBlendType]},function(sd){var sL=sP.TOINT[sd];null==sL||this._nBlendType===sL||(sD.save(this,65536,this,!0),this._curSubmit=s_d.RENDERBASE,this._renderKey=0,this._nBlendType=sL)}),sZ(0,sL,"strokeStyle",function(){return this._shader2D.strokeStyle},function(sd){this._shader2D.strokeStyle.equal(sd)||(sD.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=sT.create(sd))}),sZ(0,sL,"globalAlpha",function(){return this._shader2D.ALPHA},function(sd){(sd=Math.floor(1e3*sd)/1e3)!=this._shader2D.ALPHA&&(sD.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=sd)}),sZ(0,sL,"asBitmap",null,function(sd){if(sd){if(this._targets||(this._targets=new sU),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),sZ(0,sL,"fillStyle",function(){return this._shader2D.fillStyle},function(sd){this._shader2D.fillStyle.equal(sd)||(sD.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=sT.create(sd))}),sZ(0,sL,"textAlign",function(){return this._other.textAlign},function(sd){this._other.textAlign===sd||(this._other=this._other.make(),sD.save(this,32768,this._other,!1),this._other.textAlign=sd)}),sZ(0,sL,"lineWidth",function(){return this._other.lineWidth},function(sd){this._other.lineWidth===sd||(this._other=this._other.make(),sD.save(this,256,this._other,!1),this._other.lineWidth=sd)}),sZ(0,sL,"textBaseline",function(){return this._other.textBaseline},function(sd){this._other.textBaseline===sd||(this._other=this._other.make(),sD.save(this,16384,this._other,!1),this._other.textBaseline=sd)}),sZ(0,sL,"font",null,function(sd){sd!=this._other.font.toString()&&(this._other=this._other.make(),sD.save(this,8,this._other,!1),this._other.font===scd.EMPTY?this._other.font=new scd(sd):this._other.font.setFont(sd))}),sS.__init__=function(){sl.DEFAULT=new sl},sS._tempPoint=new sV,sS._SUBMITVBSIZE=32e3,sS._MAXSIZE=99999999,sS._RECTVBSIZE=16,sS.MAXCLIPRECT=new sQ(0,0,99999999,99999999),sS._COUNT=0,sS._tmpMatrix=new sn,sS.SEGNUM=32,sS._contextcount=0,sN(sS,["_fontTemp",function(){return this._fontTemp=new scd},"_drawStyleTemp",function(){return this._drawStyleTemp=new sT(null)}]),sS.__init$=function(){sl=function(){function sd(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=scd.EMPTY}sq(sd,"");var sL=sd.prototype;return sL.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=scd.EMPTY},sL.make=function(){return this===sd.DEFAULT?new sd:this},sd.DEFAULT=null,sd}()},sS}(),sOd=function(sd){function sZ(sd,sL){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,sZ.__super.call(this),this.defines=new sgd,this.position=sZ._POSITION,this.mainID=sd,this.subID=sL,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=sd|sL,this._inClassCache=sZ._cache[this._cacheID],0<sd&&!this._inClassCache&&(this._inClassCache=sZ._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}sq(sZ,"laya.webgl.shader.d2.value.Value2D",si);var sL=sZ.prototype;return sL.setValue=function(sd){},sL.refresh=function(){var sd=this.size;return sd[0]=sed.width,sd[1]=sed.height,this.alpha=this.ALPHA*sed.worldAlpha,this.mmat=sed.worldMatrix4,this},sL._ShaderWithCompile=function(){return svd.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,sUd.create)},sL._withWorldShaderDefines=function(){var sd=sed.worldShaderDefines,sL=svd.sharders[this.mainID|this.defines._value|sd.getValue()];if(!sL){var sl,sZ={};for(sl in this.defines.toNameDic())sZ[sl]="";for(sl in sd.toNameDic())sZ[sl]="";sL=svd.withCompile2D(0,this.mainID,sZ,this.mainID|this.defines._value|sd.getValue(),sUd.create)}var sh=sed.worldFilters;if(!sh)return sL;for(var s_,sN=sh.length,sm=0;sm<sN;sm++)(s_=sh[sm])&&s_.action.setValue(this);return sL},sL.upload=function(){var sd=sed;this.alpha=this.ALPHA*sd.worldAlpha,sed.worldMatrix4!==sed.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),ssd.shaderHighPrecision&&this.defines.add(1024);var sL,sl=sd.worldShaderDefines?this._withWorldShaderDefines():svd.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=sd.width,this.size[1]=sd.height,this.mmat=sd.worldMatrix4,sjd.activeShader!==sl?sl._shaderValueWidth!==sd.width||sl._shaderValueHeight!==sd.height?(sl._shaderValueWidth=sd.width,sl._shaderValueHeight=sd.height):sL=sl._params2dQuick2||sl._make2dQuick2():sl._shaderValueWidth!==sd.width||sl._shaderValueHeight!==sd.height?(sl._shaderValueWidth=sd.width,sl._shaderValueHeight=sd.height):sL=sl._params2dQuick1||sl._make2dQuick1(),sl.upload(this,sL)},sL.setFilters=function(sd){if(this.filters=sd)for(var sL,sl=sd.length,sZ=0;sZ<sl;sZ++)(sL=sd[sZ])&&(this.defines.add(sL.type),sL.action.setValue(this))},sL.clear=function(){this.defines.setValue(this.subID)},sL.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},sZ._initone=function(sd,sL){sZ._typeClass[sd]=sL,sZ._cache[sd]=[],sZ._cache[sd]._length=0},sZ.__init__=function(){sZ._POSITION=[2,5126,!1,4*srd.BYTES_PE,0],sZ._TEXCOORD=[2,5126,!1,4*srd.BYTES_PE,2*srd.BYTES_PE],sZ._initone(2,sSd),sZ._initone(4,sPd),sZ._initone(256,sBd),sZ._initone(512,sid),sZ._initone(1,sCd),sZ._initone(65,sfd),sZ._initone(9,sCd)},sZ.create=function(sd,sL){var sl=sZ._cache[sd|sL];return sl._length?sl[--sl._length]:new sZ._typeClass[sd|sL](sL)},sZ._POSITION=null,sZ._TEXCOORD=null,sZ._cache=[],sZ._typeClass=[],sZ.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sZ}(),snd=function(sd){function sa(sd,sL){sa.__super.call(this,sd,sL)}sq(sa,"laya.webgl.utils.RenderSprite3D",se);var sL=sa.prototype;return sL.onCreate=function(sd){switch(sd){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},sL._mask=function(sd,sL,sl,sZ){var sh,s_,sN=this._next,sm=sd.mask;if(sm){sL.ctx.save();var su=sL.ctx.globalCompositeOperation,sx=new sQ;if(sx.copyFrom(sm.getBounds()),sx.width=Math.round(sx.width),sx.height=Math.round(sx.height),sx.x=Math.round(sx.x),sx.y=Math.round(sx.y),0<sx.width&&0<sx.height){var st=sd._style._tf,sb=smd.create();sb.addValue("bounds",sx),sh=sNd.create([sb,sL],laya.webgl.utils.RenderSprite3D.tmpTarget),sL.addRenderObject(sh),sm.render(sL,-sx.x,-sx.y),sh=sNd.create([sb],laya.webgl.utils.RenderSprite3D.endTmpTarget),sL.addRenderObject(sh),sL.ctx.save(),sL.clipRect(sl-st.translateX+sx.x,sZ-st.translateY+sx.y,sx.width,sx.height),sN._fun.call(sN,sd,sL,sl,sZ),sL.ctx.restore(),s_=std.create(6),su=sL.ctx.globalCompositeOperation,s_.blendMode="mask",sL.addRenderObject(s_),sn.TEMP.identity();var sq=sOd.create(1,0),sY=sX.INV_UV,sc=sx.width,sr=sx.height;(sx.width<32||sx.height<32)&&((sY=sa.tempUV)[0]=0,sY[1]=0,sY[2]=32<=sx.width?1:sx.width/32,sY[3]=0,sY[4]=32<=sx.width?1:sx.width/32,sY[5]=32<=sx.height?1:sx.height/32,sY[6]=0,sY[7]=32<=sx.height?1:sx.height/32,sx.width=32<=sx.width?sx.width:32,sx.height=32<=sx.height?sx.height:32,sY[1]*=-1,sY[3]*=-1,sY[5]*=-1,sY[7]*=-1,sY[1]+=1,sY[3]+=1,sY[5]+=1,sY[7]+=1),sL.ctx.drawTarget(sb,sl+sx.x-st.translateX,sZ+sx.y-st.translateY,sc,sr,sn.TEMP,"tmpTarget",sq,sY,6),sh=sNd.create([sb],laya.webgl.utils.RenderSprite3D.recycleTarget),sL.addRenderObject(sh),(s_=std.create(6)).blendMode=su,sL.addRenderObject(s_)}sL.ctx.restore()}else sN._fun.call(sN,sd,sL,sl,sZ)},sL._blend=function(sd,sL,sl,sZ){var sh=sd._style,s_=this._next;sh.blendMode?(sL.ctx.save(),sL.ctx.globalCompositeOperation=sh.blendMode,s_._fun.call(s_,sd,sL,sl,sZ),sL.ctx.restore()):s_._fun.call(s_,sd,sL,sl,sZ)},sL._transform=function(sd,sL,sl,sZ){var sh=sd.transform,s_=this._next;if(sh&&s_!=se.NORENDER){var sN=sL.ctx;sd._style;sh.tx=sl,sh.ty=sZ;var sm=sN._getTransformMatrix(),su=sm.clone();sn.mul(sh,sm,sm),sm._checkTransform(),sh.tx=sh.ty=0,s_._fun.call(s_,sd,sL,0,0),su.copyTo(sm),su.destroy()}else s_._fun.call(s_,sd,sL,sl,sZ)},sa.tmpTarget=function(sd,sL){var sl=sd.getValue("bounds"),sZ=sRd.create(sl.width,sl.height);sZ.start(),sZ.clear(0,0,0,0),sd.addValue("tmpTarget",sZ)},sa.endTmpTarget=function(sd){sd.getValue("tmpTarget").end()},sa.recycleTarget=function(sd){sd.getValue("tmpTarget").recycle(),sd.recycle()},sN(sa,["tempUV",function(){return this.tempUV=new Array(8)}]),sa}(),sVd=function(sd){function sL(){this.data=null,sL.__super.call(this)}sq(sL,"laya.filters.webgl.ColorFilterActionGL",so);var sl=sL.prototype;return sy.imps(sl,{"laya.filters.IFilterActionGL":!0}),sl.setValue=function(sd){sd.colorMat=this.data._mat,sd.colorAlpha=this.data._alpha},sl.apply3d=function(sd,sL,sl,sZ,sh){var s_=sd.getValue("bounds"),sN=sOd.create(1,0);sN.setFilters([this.data]);var sm=sn.TEMP;sm.identity(),sl.ctx.drawTarget(sd,0,0,s_.width,s_.height,sm,"src",sN)},sL}(),sQd=function(sd){function s_(sd,sL,sl,sZ,sh){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,s_.__super.call(this,sd,sL,sh),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new sTd,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=sl,this._atlasCanvas.height=sZ,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}sq(s_,"laya.webgl.atlas.Atlaser",sS);var sL=s_.prototype;return sL.computeUVinAtlasTexture=function(sd,sL,sl,sZ){var sh=sB.atlasTextureWidth,s_=sB.atlasTextureHeight,sN=sl/sh,sm=sZ/s_,su=(sl+sd.bitmap.width)/sh,sx=(sZ+sd.bitmap.height)/s_,st=sd.bitmap.width/sh,sb=sd.bitmap.height/s_;sd.uv=[sN+sL[0]*st,sm+sL[1]*sb,su-(1-sL[2])*st,sm+sL[3]*sb,su-(1-sL[4])*st,sx-(1-sL[5])*sb,sN+sL[6]*st,sx-(1-sL[7])*sb]},sL.findBitmapIsExist=function(sd){if(sd instanceof laya.webgl.resource.WebGLImage){var sL=sd,sl=sL.url,sZ=this._InAtlasWebGLImagesKey[sl||sL.id];if(sZ)return sZ.offsetInfoID}return-1},sL.addToAtlasTexture=function(sd,sL,sl){if(sd instanceof laya.webgl.resource.WebGLImage){var sZ=sd,sh=sZ.url;this._InAtlasWebGLImagesKey[sh||sZ.id]={bitmap:sd,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([sL,sl])}this._atlasCanvas.texSubImage2D(sL,sl,sd.atlasSource),sd.clearAtlasSource()},sL.addToAtlas=function(sd,sL,sl){sd._atlasID=this._inAtlasTextureKey.length;var sZ=sd.uv.slice(),sh=sd.bitmap;this._inAtlasTextureKey.push(sd),this._inAtlasTextureOriUVValue.push(sZ),this._inAtlasTextureBitmapValue.push(sh),this.computeUVinAtlasTexture(sd,sZ,sL,sl),sd.bitmap=this._atlasCanvas},sL.clear=function(){for(var sd=0,sL=this._inAtlasTextureKey.length;sd<sL;sd++)this._inAtlasTextureKey[sd].bitmap=this._inAtlasTextureBitmapValue[sd],this._inAtlasTextureKey[sd].uv=this._inAtlasTextureOriUVValue[sd],this._inAtlasTextureKey[sd]._atlasID=-1,this._inAtlasTextureKey[sd].bitmap.lock=!1,this._inAtlasTextureKey[sd].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},sL.dispose=function(){this.clear(),this._atlasCanvas.destroy()},sZ(0,sL,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),sZ(0,sL,"texture",function(){return this._atlasCanvas}),sZ(0,sL,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),s_}(),sgd=function(sd){function sl(){sl.__super.call(this,sl.__name2int,sl.__int2name,sl.__int2nameMap)}return sq(sl,"laya.webgl.shader.d2.ShaderDefines2D",sM),sl.__init__=function(){sl.reg("TEXTURE2D",1),sl.reg("COLOR2D",2),sl.reg("PRIMITIVE",4),sl.reg("GLOW_FILTER",8),sl.reg("BLUR_FILTER",16),sl.reg("COLOR_FILTER",32),sl.reg("COLOR_ADD",64),sl.reg("WORLDMAT",128),sl.reg("FILLTEXTURE",256),sl.reg("FSHIGHPRECISION",1024),sl.reg("TXTALPHA",2048),sl.reg("TXTCOMPRESS",4096)},sl.reg=function(sd,sL){sM._reg(sd,sL,sl.__name2int,sl.__int2name)},sl.toText=function(sd,sL,sl){return sM._toText(sd,sL,sl)},sl.toInt=function(sd){return sM._toInt(sd,sl.__name2int)},sl.TEXTURE2D=1,sl.COLOR2D=2,sl.PRIMITIVE=4,sl.FILTERGLOW=8,sl.FILTERBLUR=16,sl.FILTERCOLOR=32,sl.COLORADD=64,sl.WORLDMAT=128,sl.FILLTEXTURE=256,sl.SKINMESH=512,sl.SHADERDEFINE_FSHIGHPRECISION=1024,sl.TXTALPHA=2048,sl.TXTCOMPRESS=4096,sl.__name2int={},sl.__int2name=[],sl.__int2nameMap=[],sl}(),sFd=(function(sd){function sm(sd,sL,sl,sZ,sh,s_,sN){sm.__super.call(this,sd,sL,sl,sZ,40,sh,s_,sN)}sq(sm,"laya.webgl.shapes.Ellipse",sld)}(),function(sd){function s_(sd,sL,sl,sZ,sh){this._points=[],this.rebuild(sl),s_.__super.call(this,sd,sL,0,0,0,sh,sZ,sh,0)}sq(s_,"laya.webgl.shapes.Line",sld);var sL=s_.prototype;return sL.rebuild=function(sd){var sL=sd.length;sL!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(sL/2-1)),this.mFloat32Array=new Float32Array(5*sL)),this._points.length=0;for(var sl=NaN,sZ=NaN,sh=-1,s_=-1,sN=sd.length/2,sm=0;sm<sN;sm++)sl=sd[2*sm],sZ=sd[2*sm+1],(.01<Math.abs(sh-sl)||.01<Math.abs(s_-sZ))&&this._points.push(sl,sZ),sh=sl,s_=sZ},sL.getData=function(sd,sL,sl){var sZ=[],sh=[];0<this.borderWidth&&this.createLine2(this._points,sZ,this.borderWidth,sl,sh,this._points.length/2),this.mUint16Array.set(sZ,0),this.mFloat32Array.set(sh,0),sd.append(this.mUint16Array),sL.append(this.mFloat32Array)},s_}()),sEd=function(sd){function sb(sd,sL,sl,sZ,sh){this._points=[];for(var s_=NaN,sN=NaN,sm=-1,su=-1,sx=sl.length/2-1,st=0;st<sx;st++)s_=sl[2*st],sN=sl[2*st+1],(.01<Math.abs(sm-s_)||.01<Math.abs(su-sN))&&this._points.push(s_,sN),sm=s_,su=sN;s_=sl[2*sx],sN=sl[2*sx+1],sm=this._points[0],su=this._points[1],(.01<Math.abs(sm-s_)||.01<Math.abs(su-sN))&&this._points.push(s_,sN),sb.__super.call(this,sd,sL,0,0,this._points.length/2,0,sZ,sh)}sq(sb,"laya.webgl.shapes.LoopLine",sld);var sL=sb.prototype;return sL.getData=function(sd,sL,sl){if(0<this.borderWidth){for(var sZ=this.color,sh=(sZ>>16&255)/255,s_=(sZ>>8&255)/255,sN=(255&sZ)/255,sm=[],su=0,sx=0,st=[],sb=Math.floor(this._points.length/2),sq=0;sq<sb;sq++)su=this._points[2*sq],sx=this._points[2*sq+1],sm.push(this.x+su,this.y+sx,sh,s_,sN);this.createLoopLine(sm,st,this.borderWidth,sl+sm.length/5),sd.append(new Uint16Array(st)),sL.append(new Float32Array(sm))}},sL.createLoopLine=function(sd,sL,sl,sZ,sh,s_){sd.length;var sN=sd.concat(),sm=sh||sd,su=this.borderColor,sx=(su>>16&255)/255,st=(su>>8&255)/255,sb=(255&su)/255,sq=[sN[0],sN[1]],sY=[sN[sN.length-5],sN[sN.length-4]],sc=sY[0]+.5*(sq[0]-sY[0]),sr=sY[1]+.5*(sq[1]-sY[1]);sN.unshift(sc,sr,0,0,0),sN.push(sc,sr,0,0,0);var sa,sk,se,sw,ss,sA,sy,s$,sO,sn,sV,sQ,sg,sF,sE,sI,sp,sH,sX,sj,sR=sN.length/5,so=sZ,si=sl/2;se=sN[0],sw=sN[1],sn=se-(ss=sN[5]),sO=(sO=-(sw-(sA=sN[6])))/(sj=Math.sqrt(sO*sO+sn*sn))*si,sn=sn/sj*si,sm.push(se-sO,sw-sn,sx,st,sb,se+sO,sw+sn,sx,st,sb);for(var sS=1;sS<sR-1;sS++)se=sN[5*(sS-1)],sw=sN[5*(sS-1)+1],ss=sN[5*sS],sA=sN[5*sS+1],sy=sN[5*(sS+1)],s$=sN[5*(sS+1)+1],sn=se-ss,sQ=ss-sy,sE=(-(sO=(sO=-(sw-sA))/(sj=Math.sqrt(sO*sO+sn*sn))*si)+se)*(-(sn=sn/sj*si)+sA)-(-sO+ss)*(-sn+sw),sH=(-(sV=(sV=-(sA-s$))/(sj=Math.sqrt(sV*sV+sQ*sQ))*si)+sy)*(-(sQ=sQ/sj*si)+sA)-(-sV+ss)*(-sQ+s$),sX=(sg=-sn+sw-(-sn+sA))*(sp=-sV+ss-(-sV+sy))-(sI=-sQ+s$-(-sQ+sA))*(sF=-sO+ss-(-sO+se)),Math.abs(sX)<.1?(sX+=10.1,sm.push(ss-sO,sA-sn,sx,st,sb,ss+sO,sA+sn,sx,st,sb)):(((sa=(sF*sH-sp*sE)/sX)-ss)*(sa-ss)+((sk=(sI*sE-sg*sH)/sX)-sA)+(sk-sA),sm.push(sa,sk,sx,st,sb,ss-(sa-ss),sA-(sk-sA),sx,st,sb));s_&&(sL=s_);var sB=this.edges+1;for(sS=1;sS<sB;sS++)sL.push(so+2*(sS-1),so+2*(sS-1)+1,so+2*sS+1,so+2*sS+1,so+2*sS,so+2*(sS-1));return sL.push(so+2*(sS-1),so+2*(sS-1)+1,so+1,so+1,so,so+2*(sS-1)),sm},sb}(),sId=function(sd){function sN(sd,sL,sl,sZ,sh,s_){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=sn.create(),this._points=sl.slice(0,sl.length),sN.__super.call(this,sd,sL,0,0,this._points.length/2,sZ,sh,s_)}sq(sN,"laya.webgl.shapes.Polygon",sld);var sL=sN.prototype;return sL.rebuild=function(sd){this._repaint||(this._points.length=0,this._points=this._points.concat(sd))},sL.setMatrix=function(sd){sd.copyTo(this._mat)},sL.needUpdate=function(sd){return this._repaint=this._mat.a==sd.a&&this._mat.b==sd.b&&this._mat.c==sd.c&&this._mat.d==sd.d&&this._mat.tx==sd.tx&&this._mat.ty==sd.ty,!this._repaint},sL.getData=function(sd,sL,sl){var sZ,sh=0,s_=this._points,sN=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=sl){for(this._start=sl,sZ=[],sN=this.earcutTriangles.length,sh=0;sh<sN;sh++)sZ.push(this.earcutTriangles[sh]+sl);this.mUint16Array=new Uint16Array(sZ)}}else{this._start=sl,sZ=[];var sm=[],su=[],sx=this.color,st=(sx>>16&255)/255,sb=(sx>>8&255)/255,sq=(255&sx)/255;for(sN=Math.floor(s_.length/2),sh=0;sh<sN;sh++)sm.push(this.x+s_[2*sh],this.y+s_[2*sh+1],st,sb,sq),su.push(this.x+s_[2*sh],this.y+s_[2*sh+1]);for(this.earcutTriangles=sZd.earcut(su,null,2),sN=this.earcutTriangles.length,sh=0;sh<sN;sh++)sZ.push(this.earcutTriangles[sh]+sl);this.mUint16Array=new Uint16Array(sZ),this.mFloat32Array=new Float32Array(sm)}sd.append(this.mUint16Array),sL.append(this.mFloat32Array)},sN}(),spd=function(sd){function s_(){this._matrix=new sn,this._matrix4=srd.defaultMatrix4.concat(),s_.__super.call(this,1e4),this.shaderValue=new sOd(0,0)}sq(s_,"laya.webgl.submit.SubmitCanvas",s_d);var sL=s_.prototype;return sL.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var sd=sed.worldAlpha,sL=sed.worldMatrix4,sl=sed.worldMatrix,sZ=sed.worldFilters,sh=sed.worldShaderDefines,s_=this.shaderValue,sN=this._matrix,sm=this._matrix4,su=sn.TEMP;return sn.mul(sN,sl,su),sm[0]=su.a,sm[1]=su.b,sm[4]=su.c,sm[5]=su.d,sm[12]=su.tx,sm[13]=su.ty,sed.worldMatrix=su.clone(),sed.worldMatrix4=sm,sed.worldAlpha=sed.worldAlpha*s_.alpha,s_.filters&&s_.filters.length&&(sed.worldFilters=s_.filters,sed.worldShaderDefines=s_.defines),this._ctx_src.flush(),sed.worldAlpha=sd,sed.worldMatrix4=sL,sed.worldMatrix.destroy(),sed.worldMatrix=sl,sed.worldFilters=sZ,sed.worldShaderDefines=sh,1},sL.releaseRender=function(){var sd=s_._cache;this._ctx_src=null,sd[sd._length++]=this},sL.getRenderType=function(){return 10003},s_.create=function(sd,sL,sl){var sZ=s_._cache._length?s_._cache[--s_._cache._length]:new s_;sZ._ctx_src=sd;var sh=sZ.shaderValue;return sh.alpha=sL,sh.defines.setValue(0),sl&&sl.length&&sh.setFilters(sl),sZ},s_._cache=((s_._cache=[])._length=0,s_._cache),s_}(),sHd=function(sd){function sx(sd){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===sd&&(sd=1e4),sx.__super.call(this,sd)}sq(sx,"laya.webgl.submit.SubmitTexture",s_d);var sL=sx.prototype;return sL.releaseRender=function(){var sd=sx._cache;(sd[sd._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},sL.addTexture=function(sd,sL){this._texsID[this._texs.length]=sd._uvID,this._texs.push(sd),this._vbPos.push(sL)},sL.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var sd=this.shaderValue.textureHost.bitmap;if(null!==sd)for(var sL=this._vb.getFloat32Array(),sl=0,sZ=this._texs.length;sl<sZ;sl++){var sh=this._texs[sl];sh.active();var s_=sh.uv;if(this._texsID[sl]!==sh._uvID){this._texsID[sl]=sh._uvID;var sN=this._vbPos[sl];sL[sN+2]=s_[0],sL[sN+3]=s_[1],sL[sN+6]=s_[2],sL[sN+7]=s_[3],sL[sN+10]=s_[4],sL[sN+11]=s_[5],sL[sN+14]=s_[6],sL[sN+15]=s_[7],this._vb.setNeedUpload()}sh.bitmap!==sd&&(this._isSameTexture=!1)}}},sL.renderSubmit=function(){if(0===this._numEle)return sx._shaderSet=!1,1;var sd=this.shaderValue.textureHost;if(sd){var sL=sd.source;if(!sd.bitmap||!sL)return sx._shaderSet=!1,1;this.shaderValue.texture=sL,sd.alphaTexture&&sd.alphaTexture.source&&(this.shaderValue.texture1=sd.alphaTexture.source)}this._vb.bind_upload(this._ib);var sl=ssd.mainContext;if(sP.activeBlendFunction!==this._blendFn&&(sl.enable(3042),this._blendFn(sl),sP.activeBlendFunction=this._blendFn),sE.drawCall++,sE.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&sjd.activeShader&&sx._shaderSet?(sjd.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&sjd.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),sx._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var sZ=sd.bitmap,sh=0,s_=sjd.activeShader,sN=0,sm=this._texs.length;sN<sm;sN++){var su=this._texs[sN];su.bitmap===sZ&&sN+1!==sm||(s_.uploadTexture2D(su.source),sl.drawElements(4,6*(sN-sh+1),5123,this._startIdx+6*sh*srd.BYTES_PIDX),sZ=su.bitmap,sh=sN)}else sl.drawElements(4,this._numEle,5123,this._startIdx);return 1},sx.create=function(sd,sL,sl,sZ,sh){var s_=sx._cache._length?sx._cache[--sx._cache._length]:new sx;null==sl&&((sl=s_._selfVb||(s_._selfVb=sMd.create(-1))).clear(),sZ=0),s_._ib=sL,s_._vb=sl,s_._startIdx=sZ*srd.BYTES_PIDX,s_._numEle=0;var sN=sd._nBlendType;s_._blendFn=sd._targets?sP.targetFns[sN]:sP.fns[sN],s_.shaderValue=sh,s_.shaderValue.setValue(sd._shader2D);var sm=sd._shader2D.filters;return sm&&s_.shaderValue.setFilters(sm),s_},sx._cache=((sx._cache=[])._length=0,sx._cache),sx._shaderSet=!0,sx}(),sXd=function(sd){function sk(){sk.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}sq(sk,"laya.webgl.utils.MeshTexture",skd);var sL=sk.prototype;return sL.addData=function(sd,sL,sl,sZ,sh,s_){for(var sN=sd.length/2,sm=this._vb.needSize(sN*sk.const_stride)>>2,su=this._vb.getFloat32Array(),sx=0,st=0;st<sN;st++){var sb=sd[sx],sq=sd[sx+1],sY=sb*sZ.a+sq*sZ.c+sZ.tx,sc=sb*sZ.b+sq*sZ.d+sZ.ty;su[sm++]=sY,su[sm++]=sc,su[sm++]=sL[sx],su[sm++]=sL[sx+1],sx+=2}this._vb.setNeedUpload();var sr=this.vertNum;if(0<sr){(sN=sl.length)>sk.tmpIdx.length&&(sk.tmpIdx=new Uint16Array(sN));for(var sa=0;sa<sN;sa++)sk.tmpIdx[sa]=sl[sa]+sr;this._ib.appendU16Array(sk.tmpIdx,sl.length)}else this._ib.append(sl);this._ib.setNeedUpload(),this.vertNum+=sN,this.indexNum+=sl.length},sL.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},sL.destroy=function(){this._ib.destroy(),this._vb.destroy()},sk.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new sk},sk.const_stride=16,sk._POOL=[],sN(sk,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),sk}(),sjd=function(sd){function sL(){sL.__super.call(this),this.lock=!0}return sq(sL,"laya.webgl.shader.BaseShader",sw),sL.activeShader=null,sL.bindShader=null,sL}(),sRd=function(sL){function st(sd,sL,sl,sZ,sh,s_,sN,sm,su){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===sl&&(sl=6408),void 0===sZ&&(sZ=5121),void 0===sh&&(sh=34041),void 0===s_&&(s_=!1),void 0===sN&&(sN=!1),void 0===sm&&(sm=-1),void 0===su&&(su=-1),this._type=1,this._w=sd,this._h=sL,this._surfaceFormat=sl,this._surfaceType=sZ,this._depthStencilFormat=sh,sk.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=s_,this._repeat=sN,this._minFifter=sm,this._magFifter=su,this._createWebGLRenderTarget(),this.bitmap.lock=!0,st.__super.call(this,this.bitmap,sX.INV_UV)}sq(st,"laya.webgl.resource.RenderTarget2D",sL);var sd=st.prototype;return sy.imps(sd,{"laya.resource.IDispose":!0}),sd.getType=function(){return this._type},sd.getTexture=function(){return this},sd.size=function(sd,sL){this._w==sd&&this._h==sL||(this._w=sd,this._h=sL,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},sd.release=function(){this.destroy()},sd.recycle=function(){st.POOL.push(this)},sd.start=function(){var sd=ssd.mainContext;return this._preRenderTarget=sed.curRenderTarget,sed.curRenderTarget=this,sd.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(sd.viewport(0,0,this._w,this._h),this._svWidth=sed.width,this._svHeight=sed.height,sed.width=this._w,sed.height=this._h,sjd.activeShader=null),this},sd.clear=function(sd,sL,sl,sZ){void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=1);var sh=ssd.mainContext;sh.clearColor(sd,sL,sl,sZ);var s_=16384;switch(this._depthStencilFormat){case 33189:s_|=256;break;case 36168:s_|=1024;break;case 34041:s_|=256,s_|=1024}sh.clear(s_)},sd.end=function(){var sd=ssd.mainContext;sd.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,sed.curRenderTarget=this._preRenderTarget,1==this._type?(sd.viewport(0,0,this._svWidth,this._svHeight),sed.width=this._svWidth,sed.height=this._svHeight,sjd.activeShader=null):sd.viewport(0,0,sy.stage.width,sy.stage.height)},sd.getData=function(sd,sL,sl,sZ){var sh=ssd.mainContext;if(sh.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===sh.checkFramebufferStatus(36160)))return sh.bindFramebuffer(36160,null),null;var s_=new Uint8Array(this._w*this._h*4);return sh.readPixels(sd,sL,sl,sZ,this._surfaceFormat,this._surfaceType,s_),sh.bindFramebuffer(36160,null),s_},sd.destroy=function(sd){void 0===sd&&(sd=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,sL.prototype.destroy.call(this))},sd.dispose=function(){},sd._createWebGLRenderTarget=function(){this.bitmap=new sGd(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(sd){this.event("recovered")})},sZ(0,sd,"surfaceFormat",function(){return this._surfaceFormat}),sZ(0,sd,"magFifter",function(){return this._magFifter}),sZ(0,sd,"surfaceType",function(){return this._surfaceType}),sZ(0,sd,"mipMap",function(){return this._mipMap}),sZ(0,sd,"depthStencilFormat",function(){return this._depthStencilFormat}),sZ(0,sd,"minFifter",function(){return this._minFifter}),sZ(0,sd,"source",function(){return this._alreadyResolved?sy.superGet(sX,this,"source"):null}),st.create=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){void 0===sl&&(sl=6408),void 0===sZ&&(sZ=5121),void 0===sh&&(sh=34041),void 0===s_&&(s_=!1),void 0===sN&&(sN=!1),void 0===sm&&(sm=-1),void 0===su&&(su=-1);var sx=st.POOL.pop();return sx||(sx=new st(sd,sL)),sx.bitmap&&sx._w==sd&&sx._h==sL&&sx._surfaceFormat==sl&&sx._surfaceType==sZ&&sx._depthStencilFormat==sh&&sx._mipMap==s_&&sx._repeat==sN&&sx._minFifter==sm&&sx._magFifter==su||(sx._w=sd,sx._h=sL,sx._surfaceFormat=sl,sx._surfaceType=sZ,sx._depthStencilFormat=sh,sk.isConchWebGL&&34041===sx._depthStencilFormat&&(sx._depthStencilFormat=33189),sx._mipMap=s_,sx._repeat=sN,sx._minFifter=sm,sx._magFifter=su,sx.release(),sx._createWebGLRenderTarget()),sx},st.TYPE2D=1,st.TYPE3D=2,st.POOL=[],st}(sX),sod=function(sd){function sL(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,sL.__super.call(this),sL._gl=ssd.mainContext}sq(sL,"laya.webgl.utils.Buffer",sw);var sl=sL.prototype;return sl._bind=function(){this.activeResource(),sL._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(sL._bindVertexBuffer=this._glBuffer),sL._gl.bindBuffer(this._bufferType,sL._bindActive[this._bufferType]=this._glBuffer),sjd.activeShader=null)},sl.recreateResource=function(){this._glBuffer||(this._glBuffer=sL._gl.createBuffer()),this.completeCreate()},sl.disposeResource=function(){this._glBuffer&&(ssd.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},sZ(0,sl,"bufferUsage",function(){return this._bufferUsage}),sL._gl=null,sL._bindActive={},sL._bindVertexBuffer=null,sL._enableAtributes=[],sL}(),sid=function(sd){function sl(sd){this.texcoord=null,this.offsetX=300,this.offsetY=0,sl.__super.call(this,512,0);var sL=8*srd.BYTES_PE;this.position=[2,5126,!1,sL,0],this.texcoord=[2,5126,!1,sL,2*srd.BYTES_PE],this.color=[4,5126,!1,sL,4*srd.BYTES_PE]}return sq(sl,"laya.webgl.shader.d2.skinAnishader.SkinSV",sOd),sl}(),sSd=function(sd){function sL(sd){sL.__super.call(this,2,0),this.color=[]}return sq(sL,"laya.webgl.shader.d2.value.Color2dSV",sOd),sL.prototype.setValue=function(sd){sd.fillStyle&&(this.color=sd.fillStyle._color._color),sd.strokeStyle&&(this.color=sd.strokeStyle._color._color)},sL}(),sBd=function(sd){function sL(sd){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=sOd._TEXCOORD,sL.__super.call(this,256,0)}sq(sL,"laya.webgl.shader.d2.value.FillTextureSV",sOd);var sl=sL.prototype;return sl.setValue=function(sd){this.ALPHA=sd.ALPHA,sd.filters&&this.setFilters(sd.filters)},sl.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},sL}(),sCd=function(sd){function sL(sd){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=sOd._TEXCOORD,void 0===sd&&(sd=0),sL.__super.call(this,1,sd)}sq(sL,"laya.webgl.shader.d2.value.TextureSV",sOd);var sl=sL.prototype;return sl.setValue=function(sd){this.ALPHA=sd.ALPHA,sd.filters&&this.setFilters(sd.filters)},sl.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},sL}(),sPd=function(sd){function sL(sd){this.a_color=null,this.u_pos=[0,0],sL.__super.call(this,4,0),this.position=[2,5126,!1,5*srd.BYTES_PE,0],this.a_color=[3,5126,!1,5*srd.BYTES_PE,2*srd.BYTES_PE]}return sq(sL,"laya.webgl.shader.d2.value.PrimitiveSV",sOd),sL}(),sTd=function(sd){function sL(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,sL.__super.call(this)}sq(sL,"laya.webgl.atlas.AtlasWebGLCanvas",sd);var sl=sL.prototype;return sl.recreateResource=function(){var sd=ssd.mainContext,sL=this._source=sd.createTexture(),sl=sAd.curBindTexTarget,sZ=sAd.curBindTexValue;sAd.bindTexture(sd,3553,sL),sd.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),sd.texParameteri(3553,10241,9729),sd.texParameteri(3553,10240,9729),sd.texParameteri(3553,10242,33071),sd.texParameteri(3553,10243,33071),sl&&sZ&&sAd.bindTexture(sd,sl,sZ),this.memorySize=this._w*this._h*4,this.completeCreate()},sl.disposeResource=function(){this._source&&(ssd.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},sl.texSubImage2D=function(sd,sL,sl){if(sk.isFlash){this._flashCacheImage||(this._flashCacheImage=sr.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var sZ=sl.bitmapdata;this._flashCacheImage._image.copyPixels(sZ,0,0,sZ.width,sZ.height,sd,sL),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var sh=ssd.mainContext,s_=sAd.curBindTexTarget,sN=sAd.curBindTexValue;sAd.bindTexture(sh,3553,this._source),sh.pixelStorei(37441,!0),0<=sd-1&&sh.texSubImage2D(3553,0,sd-1,sL,6408,5121,sl),sd+1<=this._w&&sh.texSubImage2D(3553,0,sd+1,sL,6408,5121,sl),0<=sL-1&&sh.texSubImage2D(3553,0,sd,sL-1,6408,5121,sl),sL+1<=this._h&&sh.texSubImage2D(3553,0,sd,sL+1,6408,5121,sl),sh.texSubImage2D(3553,0,sd,sL,6408,5121,sl),sh.pixelStorei(37441,!1),s_&&sN&&sAd.bindTexture(sh,s_,sN)}},sl.texSubImage2DPixel=function(sd,sL,sl,sZ,sh){var s_=ssd.mainContext,sN=sAd.curBindTexTarget,sm=sAd.curBindTexValue;sAd.bindTexture(s_,3553,this._source);var su=new Uint8Array(sh.data);s_.pixelStorei(37441,!0),s_.texSubImage2D(3553,0,sd,sL,sl,sZ,6408,5121,su),s_.pixelStorei(37441,!1),sN&&sm&&sAd.bindTexture(s_,sN,sm)},sZ(0,sl,"width",sd.prototype._$get_width,function(sd){this._w=sd}),sZ(0,sl,"height",sd.prototype._$get_height,function(sd){this._h=sd}),sL}(sl),szd=function(sd){function sh(){this.flipY=!0,this.alwaysChange=!1,sh.__super.call(this)}sq(sh,"laya.webgl.resource.WebGLCanvas",sl);var sL=sh.prototype;return sL.getCanvas=function(){return this._canvas},sL.clear=function(){this._ctx&&this._ctx.clear()},sL.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},sL._setContext=function(sd){this._ctx=sd},sL.getContext=function(sd,sL){return this._ctx?this._ctx:this._ctx=sh._createContext(this)},sL.size=function(sd,sL){this._w==sd&&this._h==sL||(this._w=sd,this._h=sL,this._ctx&&this._ctx.size(sd,sL),this._canvas&&(this._canvas.height=sL,this._canvas.width=sd))},sL.activeResource=function(sd){void 0===sd&&(sd=!1),this._source||this.recreateResource()},sL.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},sL.disposeResource=function(){this._source&&!this.iscpuSource&&(ssd.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},sL.createWebGlTexture=function(){var sd=ssd.mainContext;this._canvas;var sL=this._source=sd.createTexture();this.iscpuSource=!1;var sl=sAd.curBindTexTarget,sZ=sAd.curBindTexValue;sAd.bindTexture(sd,3553,sL),sd.pixelStorei(37440,this.flipY?1:0),sh.premulAlpha&&sd.pixelStorei(37441,!0),sd.texImage2D(3553,0,6408,6408,5121,this._imgData),sh.premulAlpha&&sd.pixelStorei(37441,!1),sd.texParameteri(3553,10240,9729),sd.texParameteri(3553,10241,9729),sd.texParameteri(3553,10242,33071),sd.texParameteri(3553,10243,33071),sd.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,sl&&sZ&&sAd.bindTexture(sd,sl,sZ)},sL.reloadCanvasData=function(){var sd=ssd.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var sL=sAd.curBindTexTarget,sl=sAd.curBindTexValue;sAd.bindTexture(sd,3553,this._source),sh.premulAlpha&&sd.pixelStorei(37441,!0),sd.texImage2D(3553,0,6408,6408,5121,this._imgData),sh.premulAlpha&&sd.pixelStorei(37441,!1),sd.pixelStorei(37440,0),sL&&sl&&sAd.bindTexture(sd,sL,sl)},sL.texSubImage2D=function(sd,sL,sl){var sZ=ssd.mainContext,sh=sAd.curBindTexTarget,s_=sAd.curBindTexValue;sAd.bindTexture(sZ,3553,this._source),sZ.pixelStorei(37441,!0),sZ.texSubImage2D(3553,0,sL,sl,6408,5121,sd._source),sZ.pixelStorei(37441,!1),sh&&s_&&sAd.bindTexture(sZ,sh,s_)},sL.toBase64=function(sd,sL,sl){var sZ=null;this._canvas&&(sZ=this._canvas.toDataURL(sd,sL)),sl.call(this,sZ)},sZ(0,sL,"context",function(){return this._ctx}),sZ(0,sL,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),sZ(0,sL,"asBitmap",null,function(sd){this._ctx&&(this._ctx.asBitmap=sd)}),sh._createContext=null,sh.premulAlpha=!1,sh}(),sDd=function(sd){function s_(sd,sL){this.CborderSize=12,s_.__super.call(this),this.char=sd,this.isSpace=" "===sd,this.xs=sL.scaleX,this.ys=sL.scaleY,this.font=sL.font.toString(),this.fontSize=sL.font.size,this.fillColor=sL.fillColor,this.borderColor=sL.borderColor,this.lineWidth=sL.lineWidth,this.underLine=sL.underLine;var sl,sZ=sk.isConchApp;sZ?((sl=ConchTextCanvas)._source=ConchTextCanvas,sl._source.canvas=ConchTextCanvas):sl=sY.canvas.source,this.canvas=sl,this._enableMerageInAtlas=!0,this._ctx=sZ?sl:this.canvas.getContext("2d",void 0);var sh=sj.measureText(this.char,this.font);this.cw=sh.width*this.xs,this.ch=(sh.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new sX(this)}sq(s_,"laya.webgl.resource.WebGLCharImage",sl);var sL=s_.prototype;return sy.imps(sL,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),sL.active=function(){this.texture.active()},sL.recreateResource=function(){var sd=sk.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),sd){var sL=this.fontSize;1==this.xs&&1==this.ys||(sL=parseInt(sL*(this.xs>this.ys?this.xs:this.ys)+""));var sl="normal 100 "+this.font;sl=sl.replace(s_._fontSizeReg,sL),this.borderColor&&(sl+=" 1 "+this.borderColor),this._ctx.font=sl,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,sH.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var sZ=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(sZ,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},sL.onresize=function(sd,sL){this._w=sd,this._h=sL,this._allowMerageInAtlas=!0},sL.clearAtlasSource=function(){},sZ(0,sL,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),sZ(0,sL,"atlasSource",function(){return this.canvas}),sZ(0,sL,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(sd){this._enableMerageInAtlas=sd}),s_.createOneChar=function(sd,sL){return new s_(sd,sL)},s_._fontSizeReg=new RegExp("\\d+(?=px)","g"),s_}(),sGd=function(sd){function sx(sd,sL,sl,sZ,sh,s_,sN,sm,su){void 0===sl&&(sl=6408),void 0===sZ&&(sZ=5121),void 0===sh&&(sh=34041),void 0===s_&&(s_=!1),void 0===sN&&(sN=!1),void 0===sm&&(sm=-1),void 0===su&&(su=1),sx.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=sd,this._h=sL,this._surfaceFormat=sl,this._surfaceType=sZ,this._depthStencilFormat=sh,this._mipMap=s_,this._repeat=sN,this._minFifter=sm,this._magFifter=su}sq(sx,"laya.webgl.resource.WebGLRenderTarget",sl);var sL=sx.prototype;return sL.recreateResource=function(){var sd=ssd.mainContext;this._frameBuffer||(this._frameBuffer=sd.createFramebuffer()),this._source||(this._source=sd.createTexture());var sL=sAd.curBindTexTarget,sl=sAd.curBindTexValue;sAd.bindTexture(sd,3553,this._source),sd.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var sZ=this._minFifter,sh=this._magFifter,s_=this._repeat?10497:33071,sN=st.isPOT(this._w,this._h);if(sN?(this._mipMap?-1!==sZ||(sZ=9987):-1!==sZ||(sZ=9729),-1!==sh||(sh=9729),sd.texParameteri(3553,10241,sZ),sd.texParameteri(3553,10240,sh),sd.texParameteri(3553,10242,s_),sd.texParameteri(3553,10243,s_),this._mipMap&&sd.generateMipmap(3553)):(-1!==sZ||(sZ=9729),-1!==sh||(sh=9729),sd.texParameteri(3553,10241,sZ),sd.texParameteri(3553,10240,sh),sd.texParameteri(3553,10242,33071),sd.texParameteri(3553,10243,33071)),sd.bindFramebuffer(36160,this._frameBuffer),sd.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=sd.createRenderbuffer()),sd.bindRenderbuffer(36161,this._depthStencilBuffer),sd.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:sd.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:sd.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:sd.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}sd.bindFramebuffer(36160,null),sL&&sl&&sAd.bindTexture(sd,sL,sl),sd.bindRenderbuffer(36161,null),sN&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},sL.disposeResource=function(){this._frameBuffer&&(ssd.mainContext.deleteTexture(this._source),ssd.mainContext.deleteFramebuffer(this._frameBuffer),ssd.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},sZ(0,sL,"depthStencilBuffer",function(){return this._depthStencilBuffer}),sZ(0,sL,"frameBuffer",function(){return this._frameBuffer}),sx}(),sKd=function(sd){function sm(sd,sL,sl,sZ,sh,s_,sN){this.offsetX=0,this.offsetY=0,sm.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=s_,this.canvas=sd,this._ctx=sd.getContext("2d",void 0),this._w=sZ,this._h=sh,this.offsetX=sL,this.offsetY=sl,this.src=sN,this._enableMerageInAtlas=!0,sB.enabled&&this._w<sB.atlasLimitWidth&&this._h<sB.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}sq(sm,"laya.webgl.resource.WebGLSubImage",sl);var sL=sm.prototype;return sy.imps(sL,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),sL.size=function(sd,sL){this._w=sd,this._h=sL,this._ctx&&this._ctx.size(sd,sL),this.canvas&&(this.canvas.height=sL,this.canvas.width=sd)},sL.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},sL.createWebGlTexture=function(){var sd=ssd.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var sL=this._source=sd.createTexture(),sl=sAd.curBindTexTarget,sZ=sAd.curBindTexValue;sAd.bindTexture(sd,3553,sL),sd.pixelStorei(37441,!0),sd.texImage2D(3553,0,6408,6408,5121,this.canvas),sd.pixelStorei(37441,!1);var sh=this.minFifter,s_=this.magFifter,sN=this.repeat?10497:33071,sm=st.isPOT(this.width,this.height);sm?(this.mipmap?-1!==sh||(sh=9987):-1!==sh||(sh=9729),-1!==s_||(s_=9729),sd.texParameteri(3553,10240,s_),sd.texParameteri(3553,10241,sh),sd.texParameteri(3553,10242,sN),sd.texParameteri(3553,10243,sN),this.mipmap&&sd.generateMipmap(3553)):(-1!==sh||(sh=9729),-1!==s_||(s_=9729),sd.texParameteri(3553,10241,sh),sd.texParameteri(3553,10240,s_),sd.texParameteri(3553,10242,33071),sd.texParameteri(3553,10243,33071)),sl&&sZ&&sAd.bindTexture(sd,sl,sZ),this.canvas=null,sm&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},sL.disposeResource=function(){sB.enabled&&this._allowMerageInAtlas||!this._source||(ssd.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},sL.clearAtlasSource=function(){},sZ(0,sL,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),sZ(0,sL,"atlasSource",function(){return this.canvas}),sZ(0,sL,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(sd){this._allowMerageInAtlas=sd}),sm}(),svd=function(sd){function sx(sd,sL,sl,sZ){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,sx.__super.call(this),!sd||!sL)throw"Shader Error";this._id=++sx._count,this._vs=sd,this._ps=sL,this._nameMap=sZ||{},null!=sl&&(sx.sharders[sl]=this)}sq(sx,"laya.webgl.shader.Shader",sjd);var sL=sx.prototype;return sL.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},sL.disposeResource=function(){ssd.mainContext.deleteShader(this._vshader),ssd.mainContext.deleteShader(this._pshader),ssd.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},sL._compile=function(){if(!ssd.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var sd=[this._vs,this._ps],sL=ssd.mainContext;if(this._program=sL.createProgram(),this._vshader=sx._createShader(sL,sd[0],35633),this._pshader=sx._createShader(sL,sd[1],35632),sL.attachShader(this._program,this._vshader),sL.attachShader(this._program,this._pshader),sL.linkProgram(this._program),!sk.isConchApp&&!sL.getProgramParameter(this._program,35714))throw sL.getProgramInfoLog(this._program);var sl,sZ,sh=0,s_=0;for(s_=sk.isConchApp?sL.getProgramParameterEx(this._vs,this._ps,"",35721):sL.getProgramParameter(this._program,35721),sh=0;sh<s_;sh++){var sN=null;sl={vartype:"attribute",glfun:null,ivartype:0,attrib:sN=sk.isConchApp?sL.getActiveAttribEx(this._vs,this._ps,"",sh):sL.getActiveAttrib(this._program,sh),location:sL.getAttribLocation(this._program,sN.name),name:sN.name,type:sN.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(sl)}var sm=0;for(sm=sk.isConchApp?sL.getProgramParameterEx(this._vs,this._ps,"",35718):sL.getProgramParameter(this._program,35718),sh=0;sh<sm;sh++){var su=null;su=sk.isConchApp?sL.getActiveUniformEx(this._vs,this._ps,"",sh):sL.getActiveUniform(this._program,sh),0<(sl={vartype:"uniform",glfun:null,ivartype:1,attrib:sN,location:sL.getUniformLocation(this._program,su.name),name:su.name,type:su.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(sl.name=sl.name.substr(0,sl.name.length-3),sl.isArray=!0,sl.location=sL.getUniformLocation(this._program,sl.name)),this._params.push(sl)}for(sh=0,sZ=this._params.length;sh<sZ;sh++)if((sl=this._params[sh]).indexOfParams=sh,sl.index=1,sl.value=[sl.location,null],sl.codename=sl.name,sl.name=this._nameMap[sl.codename]?this._nameMap[sl.codename]:sl.codename,(this._paramsMap[sl.name]=sl)._this=this,sl.uploadedValue=[],"attribute"!==sl.vartype)switch(sl.type){case 5124:sl.fun=sl.isArray?this._uniform1iv:this._uniform1i;break;case 5126:sl.fun=sl.isArray?this._uniform1fv:this._uniform1f;break;case 35664:sl.fun=sl.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:sl.fun=sl.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:sl.fun=sl.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:sl.fun=this._uniform_sampler2D;break;case 35680:sl.fun=this._uniform_samplerCube;break;case 35676:sl.glfun=sL.uniformMatrix4fv,sl.fun=this._uniformMatrix4fv;break;case 35670:sl.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else sl.fun=this._attribute}},sL.getUniform=function(sd){return this._paramsMap[sd]},sL._attribute=function(sd,sL){var sl=ssd.mainContext,sZ=sod._enableAtributes,sh=sd.location;return sZ[sh]||sl.enableVertexAttribArray(sh),sl.vertexAttribPointer(sh,sL[0],sL[1],sL[2],sL[3],sL[4]+this._offset),sZ[sh]=sod._bindVertexBuffer,1},sL._uniform1f=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL?(ssd.mainContext.uniform1f(sd.location,sl[0]=sL),1):0},sL._uniform1fv=function(sd,sL){if(sL.length<4){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(ssd.mainContext.uniform1fv(sd.location,sL),sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3],1):0}return ssd.mainContext.uniform1fv(sd.location,sL),1},sL._uniform_vec2=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]?(ssd.mainContext.uniform2f(sd.location,sl[0]=sL[0],sl[1]=sL[1]),1):0},sL._uniform_vec2v=function(sd,sL){if(sL.length<2){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(ssd.mainContext.uniform2fv(sd.location,sL),sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3],1):0}return ssd.mainContext.uniform2fv(sd.location,sL),1},sL._uniform_vec3=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]?(ssd.mainContext.uniform3f(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2]),1):0},sL._uniform_vec3v=function(sd,sL){return ssd.mainContext.uniform3fv(sd.location,sL),1},sL._uniform_vec4=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(ssd.mainContext.uniform4f(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3]),1):0},sL._uniform_vec4v=function(sd,sL){return ssd.mainContext.uniform4fv(sd.location,sL),1},sL._uniformMatrix2fv=function(sd,sL){return ssd.mainContext.uniformMatrix2fv(sd.location,!1,sL),1},sL._uniformMatrix3fv=function(sd,sL){return ssd.mainContext.uniformMatrix3fv(sd.location,!1,sL),1},sL._uniformMatrix4fv=function(sd,sL){return ssd.mainContext.uniformMatrix4fv(sd.location,!1,sL),1},sL._uniform1i=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL?(ssd.mainContext.uniform1i(sd.location,sl[0]=sL),1):0},sL._uniform1iv=function(sd,sL){return ssd.mainContext.uniform1iv(sd.location,sL),1},sL._uniform_ivec2=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]?(ssd.mainContext.uniform2i(sd.location,sl[0]=sL[0],sl[1]=sL[1]),1):0},sL._uniform_ivec2v=function(sd,sL){return ssd.mainContext.uniform2iv(sd.location,sL),1},sL._uniform_vec3i=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]?(ssd.mainContext.uniform3i(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2]),1):0},sL._uniform_vec3vi=function(sd,sL){return ssd.mainContext.uniform3iv(sd.location,sL),1},sL._uniform_vec4i=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(ssd.mainContext.uniform4i(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3]),1):0},sL._uniform_vec4vi=function(sd,sL){return ssd.mainContext.uniform4iv(sd.location,sL),1},sL._uniform_sampler2D=function(sd,sL){var sl=ssd.mainContext,sZ=sd.uploadedValue;return null==sZ[0]?(sZ[0]=this._curActTexIndex,sl.uniform1i(sd.location,this._curActTexIndex),sl.activeTexture(sx._TEXTURES[this._curActTexIndex]),sAd.bindTexture(sl,3553,sL),this._curActTexIndex++,1):(sl.activeTexture(sx._TEXTURES[sZ[0]]),sAd.bindTexture(sl,3553,sL),0)},sL._uniform_samplerCube=function(sd,sL){var sl=ssd.mainContext,sZ=sd.uploadedValue;return null==sZ[0]?(sZ[0]=this._curActTexIndex,sl.uniform1i(sd.location,this._curActTexIndex),sl.activeTexture(sx._TEXTURES[this._curActTexIndex]),sAd.bindTexture(sl,34067,sL),this._curActTexIndex++,1):(sl.activeTexture(sx._TEXTURES[sZ[0]]),sAd.bindTexture(sl,34067,sL),0)},sL._noSetValue=function(sd){console.log("no....:"+sd.name)},sL.uploadOne=function(sd,sL){this.activeResource(),sAd.UseProgram(this._program);var sl=this._paramsMap[sd];sl.fun.call(this,sl,sL)},sL.uploadTexture2D=function(sd){sE.shaderCall++;var sL=ssd.mainContext;sL.activeTexture(33984),sAd.bindTexture(sL,3553,sd)},sL.uploadTexture2D1=function(sd){sE.shaderCall++;var sL=ssd.mainContext;sL.activeTexture(33985),sAd.bindTexture(sL,3553,sd)},sL.upload=function(sd,sL){sjd.activeShader=sjd.bindShader=this,this._lastUseFrameCount===sE.loopCount||this.activeResource(),sAd.UseProgram(this._program),this._reCompile?(sL=this._params,this._reCompile=!1):sL=sL||this._params;ssd.mainContext;for(var sl,sZ,sh=sL.length,s_=0,sN=0;sN<sh;sN++)null!==(sZ=sd[(sl=sL[sN]).name])&&(s_+=sl.fun.call(this,sl,sZ));sE.shaderCall+=s_},sL.uploadArray=function(sd,sL,sl){sjd.activeShader=this,(sjd.bindShader=this).activeResource(),sAd.UseProgram(this._program);this._params;for(var sZ,sh,s_=0,sN=sL-2;0<=sN;sN-=2)(sh=this._paramsMap[sd[sN]])&&null!=(sZ=sd[sN+1])&&(sl&&sl[sh.name]&&sl[sh.name].bind(),s_+=sh.fun.call(this,sh,sZ));sE.shaderCall+=s_},sL.getParams=function(){return this._params},sx.getShader=function(sd){return sx.sharders[sd]},sx.create=function(sd,sL,sl,sZ){return new sx(sd,sL,sl,sZ)},sx.withCompile=function(sd,sL,sl,sZ){if(sl&&sx.sharders[sl])return sx.sharders[sl];var sh=sx._preCompileShader[2e-4*sd];if(!sh)throw new Error("withCompile shader err!"+sd);return sh.createShader(sL,sl,sZ)},sx.withCompile2D=function(sd,sL,sl,sZ,sh){if(sZ&&sx.sharders[sZ])return sx.sharders[sZ];var s_=sx._preCompileShader[2e-4*sd+sL];if(!s_)throw new Error("withCompile shader err!"+sd+" "+sL);return s_.createShader(sl,sZ,sh)},sx.addInclude=function(sd,sL){swd.addInclude(sd,sL)},sx.preCompile=function(sd,sL,sl,sZ){var sh=2e-4*sd;sx._preCompileShader[sh]=new swd(sh,sL,sl,sZ)},sx.preCompile2D=function(sd,sL,sl,sZ,sh){var s_=2e-4*sd+sL;sx._preCompileShader[s_]=new swd(s_,sl,sZ,sh)},sx._createShader=function(sd,sL,sl){var sZ=sd.createShader(sl);return sd.shaderSource(sZ,sL),sd.compileShader(sZ),sZ},sx._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],sx._count=0,sx._preCompileShader={},sx.SHADERNAME2ID=2e-4,sx.sharders=((sx.sharders=[]).length=32,sx.sharders),sN(sx,["nameKey",function(){return this.nameKey=new sI}]),sx}(),sJd=function(sd){function sL(){this._maxsize=0,this._upload=!0,this._uploadSize=0,sL.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}sq(sL,"laya.webgl.utils.Buffer2D",sd);var sl=sL.prototype;return sl.needSize=function(sd){var sL=this._byteLength;if(sd){var sl=this._byteLength+sd;sl<=this._buffer.byteLength||this._resizeBuffer(sl<<1,!0),this._byteLength=sl}return sL},sl._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),sE.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,sod._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),sod._gl.bufferSubData(this._bufferType,0,this._buffer)},sl._bufferSubData=function(sd,sL,sl){if(void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),this._maxsize=Math.max(this._maxsize,this._byteLength),sE.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,sod._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),sL||sl){var sZ=this._buffer.slice(sL,sl);sod._gl.bufferSubData(this._bufferType,sd,sZ)}else sod._gl.bufferSubData(this._bufferType,sd,this._buffer)},sl._checkArrayUse=function(){},sl._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},sl._bind_subUpload=function(sd,sL,sl){return void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(sd,sL,sl),!0)},sl._resizeBuffer=function(sd,sL){if(sd<this._buffer.byteLength)return this;if(this.memorySize=sd,sL&&this._buffer&&0<this._buffer.byteLength){var sl=new ArrayBuffer(sd);new Uint8Array(sl).set(new Uint8Array(this._buffer),0),this._buffer=sl}else this._buffer=new ArrayBuffer(sd);return this._checkArrayUse(),this._upload=!0,this},sl.append=function(sd){this._upload=!0;var sL,sl;sL=sd.byteLength,sd instanceof Uint8Array?(this._resizeBuffer(this._byteLength+sL,!0),sl=new Uint8Array(this._buffer,this._byteLength)):sd instanceof Uint16Array?(this._resizeBuffer(this._byteLength+sL,!0),sl=new Uint16Array(this._buffer,this._byteLength)):sd instanceof Float32Array&&(this._resizeBuffer(this._byteLength+sL,!0),sl=new Float32Array(this._buffer,this._byteLength)),sl.set(sd,0),this._byteLength+=sL,this._checkArrayUse()},sl.appendU16Array=function(sd,sL){this._resizeBuffer(this._byteLength+2*sL,!0);for(var sl=new Uint16Array(this._buffer,this._byteLength,sL),sZ=0;sZ<sL;sZ++)sl[sZ]=sd[sZ];this._byteLength+=2*sL,this._checkArrayUse()},sl.appendEx=function(sd,sL){this._upload=!0;var sl;sl=sd.byteLength,this._resizeBuffer(this._byteLength+sl,!0),new sL(this._buffer,this._byteLength).set(sd,0),this._byteLength+=sl,this._checkArrayUse()},sl.appendEx2=function(sd,sL,sl,sZ){void 0===sZ&&(sZ=1),this._upload=!0;var sh,s_;sh=sl*sZ,this._resizeBuffer(this._byteLength+sh,!0),s_=new sL(this._buffer,this._byteLength);var sN=0;for(sN=0;sN<sl;sN++)s_[sN]=sd[sN];this._byteLength+=sh,this._checkArrayUse()},sl.getBuffer=function(){return this._buffer},sl.setNeedUpload=function(){this._upload=!0},sl.getNeedUpload=function(){return this._upload},sl.upload=function(){var sd=this._bind_upload();return sod._gl.bindBuffer(this._bufferType,null),sod._bindActive[this._bufferType]=null,sjd.activeShader=null,sd},sl.subUpload=function(sd,sL,sl){void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0);var sZ=this._bind_subUpload();return sod._gl.bindBuffer(this._bufferType,null),sod._bindActive[this._bufferType]=null,sjd.activeShader=null,sZ},sl.disposeResource=function(){sd.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},sl.clear=function(){this._byteLength=0,this._upload=!0},sZ(0,sl,"bufferLength",function(){return this._buffer.byteLength}),sZ(0,sl,"byteLength",null,function(sd){this._byteLength!==sd&&(sd<=this._buffer.byteLength||this._resizeBuffer(2*sd+256,!0),this._byteLength=sd)}),sL.__int__=function(sd){sWd.QuadrangleIB=sWd.create(35044),sad.fillIBQuadrangle(sWd.QuadrangleIB,16)},sL.FLOAT32=4,sL.SHORT=2,sL}(sod),sfd=(function(sL){function sl(sd){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,sl.__super.call(this,9)}sq(sl,"laya.webgl.shader.d2.value.GlowSV",sL);var sd=sl.prototype;sd.setValue=function(sd){sL.prototype.setValue.call(this,sd)},sd.clear=function(){sL.prototype.clear.call(this)}}(sCd),function(sd){function sL(sd){sL.__super.call(this,64),this.defines.add(64)}sq(sL,"laya.webgl.shader.d2.value.TextSV",sd);var sl=sL.prototype;return sl.release=function(){(sL.pool[sL._length++]=this).clear()},sl.clear=function(){sd.prototype.clear.call(this)},sL.create=function(){return sL._length?sL.pool[--sL._length]:new sL(null)},sL.pool=[],sL._length=0,sL}(sCd)),sUd=function(sd){function sh(sd,sL,sl,sZ){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,sh.__super.call(this,sd,sL,sl,sZ)}sq(sh,"laya.webgl.shader.d2.Shader2X",sd);var sL=sh.prototype;return sL.upload2dQuick1=function(sd){this.upload(sd,this._params2dQuick1||this._make2dQuick1())},sL._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var sd,sL=this._params,sl=0,sZ=sL.length;sl<sZ;sl++)sd=sL[sl],(sk.isFlash||"size"!==sd.name&&"position"!==sd.name&&"texcoord"!==sd.name)&&this._params2dQuick1.push(sd)}return this._params2dQuick1},sL.disposeResource=function(){sd.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},sL.upload2dQuick2=function(sd){this.upload(sd,this._params2dQuick2||this._make2dQuick2())},sL._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var sd,sL=this._params,sl=0,sZ=sL.length;sl<sZ;sl++)sd=sL[sl],(sk.isFlash||"size"!==sd.name)&&this._params2dQuick2.push(sd)}return this._params2dQuick2},sh.create=function(sd,sL,sl,sZ){return new sh(sd,sL,sl,sZ)},sh}(svd),sWd=function(sd){function sL(sd){this._uint8Array=null,this._uint16Array=null,void 0===sd&&(sd=35044),sL.__super.call(this),this._bufferUsage=sd,this._bufferType=34963,sk.isFlash||(this._buffer=new ArrayBuffer(8))}sq(sL,"laya.webgl.utils.IndexBuffer2D",sJd);var sl=sL.prototype;return sl._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},sl.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},sl.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},sl.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},sL.QuadrangleIB=null,sL.create=function(sd){return void 0===sd&&(sd=35044),new sL(sd)},sL}(),sMd=function(sd){function sl(sd,sL){this._floatArray32=null,this._vertexStride=0,sl.__super.call(this),this._vertexStride=sd,this._bufferUsage=sL,this._bufferType=34962,sk.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}sq(sl,"laya.webgl.utils.VertexBuffer2D",sd);var sL=sl.prototype;return sL.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},sL.bind=function(sd){sd&&sd._bind(),this._bind()},sL.insertData=function(sd,sL){this.getFloat32Array().set(sd,sL),this._upload=!0},sL.bind_upload=function(sd){sd._bind_upload()||sd._bind(),this._bind_upload()||this._bind()},sL._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},sL.disposeResource=function(){sd.prototype.disposeResource.call(this)},sL.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},sZ(0,sL,"vertexStride",function(){return this._vertexStride}),sl.create=function(sd,sL){return void 0===sL&&(sL=35048),new sl(sd,sL)},sl}(sJd),sdL=function(sd){function sm(sd,sL,sl,sZ,sh,s_){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===sl&&(sl=6408),void 0===sZ&&(sZ=!0),sm.__super.call(this,sd,sL),sd){if(this._format=sl,this._mipmap=sZ,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof sd)this._url=sd,this._src=sd,this._image=new sY.window.Image,sL&&(sL.onload&&(this.onload=sL.onload),sL.onerror&&(this.onerror=sL.onerror),sL.onCreate&&sL.onCreate(this)),this._image.crossOrigin=sd&&0==sd.indexOf("data:")?null:"",sd&&(this._image.src=sd);else if(sd instanceof ArrayBuffer){this._src=sL,this._url=this._src;var sN=new su(sd);sN.readUTFBytes(4),sN.readUTFBytes(2),sN.getInt16();sN.endian="bigEndian",this._w=sN.getInt16(),this._h=sN.getInt16();sN.getInt16(),sN.getInt16();this._image=new Uint8Array(sd,sN.pos),this._format=ssd.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,sB.enabled&&this._w<sB.atlasLimitWidth&&this._h<sB.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(sd instanceof Uint8Array))return this._src=sL,this._url=this._src,this._image=sd.source||sd,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=sL,this._url=this._src,this._w=sh,this._h=s_,this._image=sd,this._format=0===sl?sd.byteLength/(sh*s_)==4?6408:6407:sl}this._$5__enableMerageInAtlas=!0}}sq(sm,"laya.webgl.resource.WebGLImage",sr);var sL=sm.prototype;return sy.imps(sL,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),sL._init_=function(sd,sL){},sL._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var sd=ssd.mainContext,sL=this._source=sd.createTexture(),sl=sAd.curBindTexTarget,sZ=sAd.curBindTexValue;sAd.bindTexture(sd,3553,sL);var sh=this.minFifter,s_=this.magFifter,sN=this.repeat?10497:33071,sm=st.isPOT(this._w,this._h),su=!1;switch(sm?(this.mipmap?-1!==sh||(sh=9987):-1!==sh||(sh=9729),-1!==s_||(s_=9729),sd.texParameteri(3553,10241,sh),sd.texParameteri(3553,10240,s_),sd.texParameteri(3553,10242,sN),sd.texParameteri(3553,10243,sN),this.mipmap&&sd.generateMipmap(3553)):(-1!==sh||(sh=9729),-1!==s_||(s_=9729),sd.texParameteri(3553,10241,sh),sd.texParameteri(3553,10240,s_),sd.texParameteri(3553,10242,33071),sd.texParameteri(3553,10243,33071)),sd.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&sd.pixelStorei(sd.UNPACK_ALIGNMENT,1),sd.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&sd.pixelStorei(sd.UNPACK_ALIGNMENT,1),sd.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:su=!0,sd.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case ssd.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:su=!0,sd.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}sd.pixelStorei(37441,!1),sl&&sZ&&sAd.bindTexture(sd,sl,sZ),this.uri||(this.uri=this._url),su?this.memorySize=this._image.length:sm&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},sL.recreateResource=function(){var sd=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var sL=this;this._image=new sY.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(sL._needReleaseAgain)return sL._needReleaseAgain=!1,sL._image.onload=null,void(sL._image=null);sL._allowMerageInAtlas&&sL._enableMerageInAtlas?(sd.memorySize=0,sd._recreateLock=!1):sL._createWebGlTexture(),sL.completeCreate()},this._image.src=this._src}},sL.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&ssd.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},sL.onresize=function(){this._w=this._image.width,this._h=this._image.height,sB.enabled&&this._w<sB.atlasLimitWidth&&this._h<sB.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},sL.clearAtlasSource=function(){this._image=null},sZ(0,sL,"format",function(){return this._format}),sZ(0,sL,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(sd){this._$5__enableMerageInAtlas=sd}),sZ(0,sL,"mipmap",function(){return this._mipmap}),sZ(0,sL,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),sZ(0,sL,"atlasSource",function(){return this._image}),sZ(0,sL,"onload",null,function(sd){var sL=this;this._onload=sd,this._image&&(this._image.onload=null!=this._onload?function(){sL.onresize(),sL._onload()}:null)}),sZ(0,sL,"onerror",null,function(sd){var sL=this;this._onerror=sd,this._image&&(this._image.onerror=null!=this._onerror?function(){sL._onerror()}:null)}),sm}();sy.__init([sYd,sS,s$d,swd])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(sd,sL){"use strict";for(var sl in Object.defineProperty(sL,"__esModule",{value:!0}),Laya){var sZ=Laya[sl];sZ&&sZ.__isclass&&(sL[sl]=sZ)}}),function(s_,sd,sZ){sZ.un,sZ.uns;var sh=sZ.static,sN=sZ.class,sm=sZ.getset,su=(sZ.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),sc=laya.utils.ClassUtils,sb=(laya.events.Event,laya.utils.HTMLChar),sx=laya.net.Loader,st=(laya.display.Node,laya.maths.Rectangle),sq=laya.renders.Render,sY=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),sr=laya.utils.Stat,sj=laya.display.Text,sa=laya.resource.Texture,sk=laya.net.URL,se=laya.utils.Utils,sw=function(){function sY(){}return sN(sY,"laya.html.utils.HTMLParse"),sY.parse=function(sd,sL,sl){sL=(sL="<root>"+(sL=sL.replace(/<br>/g,"<br/>"))+"</root>").replace(sY.spacePattern,sY.char255);var sZ=se.parseXMLFromString(sL);sY._parseXML(sd,sZ.childNodes[0].childNodes,sl)},sY._parseXML=function(sd,sL,sl,sZ){var sh=0,s_=0;if(sL.join||sL.item)for(sh=0,s_=sL.length;sh<s_;++sh)sY._parseXML(sd,sL[sh],sl,sZ);else{var sN,sm,su;if(3==sL.nodeType)return void(sd instanceof laya.html.dom.HTMLDivElement?(null==sL.nodeName&&(sL.nodeName="#text"),sm=sL.nodeName.toLowerCase(),0<(su=sL.textContent.replace(/^\s+|\s+$/g,"")).length&&(sN=sc.getInstance(sm))&&(sd.addChild(sN),sN.innerTEXT=su.replace(sY.char255AndOneSpacePattern," "))):0<(su=sL.textContent.replace(/^\s+|\s+$/g,"")).length&&(sd.innerTEXT=su.replace(sY.char255AndOneSpacePattern," ")));if("#comment"==(sm=sL.nodeName.toLowerCase()))return;if(sN=sc.getInstance(sm)){(sN=sd.addChild(sN)).URI=sl,sN.href=sZ;var sx=sL.attributes;if(sx&&0<sx.length)for(sh=0,s_=sx.length;sh<s_;++sh){var st=sx[sh],sb=st.nodeName,sq=st.value;sN._setAttributes(sb,sq)}sY._parseXML(sN,sL.childNodes,sl,sN.href)}else sY._parseXML(sd,sL.childNodes,sl,sZ)}},sY.char255=String.fromCharCode(255),sY.spacePattern=/&nbsp;|&#160;/g,sY.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),sY}(),ss=function(){function sX(){}return sN(sX,"laya.html.utils.Layout"),sX.later=function(sd){null==sX._will&&(sX._will=[],sZ.stage.frameLoop(1,null,function(){if(!(sX._will.length<1)){for(var sd=0;sd<sX._will.length;sd++)laya.html.utils.Layout.layout(sX._will[sd]);sX._will.length=0}})),sX._will.push(sd)},sX.layout=function(sd){if(!sd||!sd._style)return null;if(0==(512&sd._style._type))return null;sd.getStyle()._type&=-513;var sL=sX._multiLineLayout(sd);return sq.isConchApp&&sd.layaoutCallNative&&sd.layaoutCallNative(),sL},sX._multiLineLayout=function(sd){if(sj.RightToLeft)return sX._multiLineLayout2(sd);var sL=new Array;sd._addChildsToLayout(sL);var sl,sZ,sh,s_,sN,sm=0,su=sL.length,sx=sd._getCSSStyle(),st=sx.letterSpacing,sb=sx.leading,sq=sx.lineHeight,sY=sx._widthAuto()||!sx.wordWrap,sc=sY?999999:sd.width,sr=(sd.height,0),sa=sx.italic?sx.fontSize/3:0,sk=sx._getAlign(),se=sx._getValign(),sw=0!==se||0!==sk||0!=sq,ss=0,sA=0,sy=0,s$=0,sO=new Array,sn=sO[0]=new sR,sV=!1,sQ=!1;sn.h=0,sx.italic&&(sc-=sx.fontSize/3);var sg=0,sF=!0;function sE(){sn.y=sA,sA+=sn.h+sb,0==sn.h&&(sA+=sq),sn.mWidth=sg,sg=0,sn=new sR,sO.push(sn),sn.h=0,sV=!(sF=!(ss=0))}for(sm=0;sm<su;sm++)if(null!=(sl=sL[sm]))if(sF=!1,sl instanceof laya.html.dom.HTMLBrElement)sE(),sn.y=sA;else{if(sl._isChar()){if((s_=sl).isWord)sV=sQ||"\n"===s_.char,sn.wordStartIndex=sn.elements.length;else{if(sy=s_.width+s_.style.letterSpacin,0<sO.length&&sc<ss+sy&&0<sn.wordStartIndex){var sI;sI=sn.elements.length-sn.wordStartIndex+1,sn.elements.length=sn.wordStartIndex,sm-=sI,sE();continue}sV=!1,sg+=s_.width}sy=s_.width+st,s$=s_.height,sQ=!1,(sV=sV||sc<ss+sy)&&sE(),sn.minTextHeight=Math.min(sn.minTextHeight,sl.height)}else sZ=sl._getCSSStyle(),sN=sl,sh=sZ.padding,0===sZ._getCssFloat()||(sw=!0),sV=sQ||sZ.lineElement,sy=sN.width*sN._style._tf.scaleX+sh[1]+sh[3]+st,s$=sN.height*sN._style._tf.scaleY+sh[0]+sh[2],sQ=sZ.lineElement,(sV=sV||sc<ss+sy&&sZ.wordWrap)&&sE();sn.elements.push(sl),sn.h=Math.max(sn.h,s$),sl.x=ss,sl.y=sA,ss+=sy,sn.w=ss-st,sn.y=sA,sr=Math.max(ss+sa,sr)}else sF||(ss+=sX.DIV_ELEMENT_PADDING),sn.wordStartIndex=sn.elements.length;if(sA=sn.y+sn.h,sw){var sp=0,sH=sc;for(sY&&0<sd.width&&(sH=sd.width),sm=0,su=sO.length;sm<su;sm++)sO[sm].updatePos(0,sH,sm,sp,sk,se,sq),sp+=Math.max(sq,sO[sm].h+sb);sA=sp}return sY&&(sd.width=sr),sA>sd.height&&(sd.height=sA),[sr,sA]},sX._multiLineLayout2=function(sd){var sL=new Array;sd._addChildsToLayout(sL);var sl,sZ,sh,s_,sN,sm=0,su=sL.length,sx=sd._getCSSStyle(),st=sx.letterSpacing,sb=sx.leading,sq=sx.lineHeight,sY=sx._widthAuto()||!sx.wordWrap,sc=sY?999999:sd.width,sr=(sd.height,0),sa=sx.italic?sx.fontSize/3:0,sk=2-sx._getAlign(),se=sx._getValign(),sw=0!==se||0!=sk||0!=sq,ss=0,sA=0,sy=0,s$=0,sO=new Array,sn=sO[0]=new sR,sV=!1,sQ=!1;sn.h=0,sx.italic&&(sc-=sx.fontSize/3);var sg=0,sF=!0;function sE(){sn.y=sA,sA+=sn.h+sb,0==sn.h&&(sA+=sq),sn.mWidth=sg,sg=0,sn=new sR,sO.push(sn),sn.h=0,sV=!(sF=!(ss=0))}for(sm=0;sm<su;sm++)if(null!=(sl=sL[sm]))if(sF=!1,sl instanceof laya.html.dom.HTMLBrElement)sE(),sn.y=sA;else{if(sl._isChar()){if((s_=sl).isWord)sV=sQ||"\n"===s_.char,sn.wordStartIndex=sn.elements.length;else{if(0<sO.length&&sc<ss+sy&&0<sn.wordStartIndex){var sI;sI=sn.elements.length-sn.wordStartIndex+1,sn.elements.length=sn.wordStartIndex,sm-=sI,sE();continue}sV=!1,sg+=s_.width}sy=s_.width+st,s$=s_.height,sQ=!1,(sV=sV||sc<ss+sy)&&sE(),sn.minTextHeight=Math.min(sn.minTextHeight,sl.height)}else sZ=sl._getCSSStyle(),sN=sl,sh=sZ.padding,0===sZ._getCssFloat()||(sw=!0),sV=sQ||sZ.lineElement,sy=sN.width*sN._style._tf.scaleX+sh[1]+sh[3]+st,s$=sN.height*sN._style._tf.scaleY+sh[0]+sh[2],sQ=sZ.lineElement,(sV=sV||sc<ss+sy&&sZ.wordWrap)&&sE();sn.elements.push(sl),sn.h=Math.max(sn.h,s$),sl.x=ss,sl.y=sA,ss+=sy,sn.w=ss-st,sn.y=sA,sr=Math.max(ss+sa,sr)}else sF||(ss+=sX.DIV_ELEMENT_PADDING),sn.wordStartIndex=sn.elements.length;if(sA=sn.y+sn.h,sw){var sp=0,sH=sc;for(sm=0,su=sO.length;sm<su;sm++)sO[sm].updatePos(0,sH,sm,sp,sk,se,sq),sp+=Math.max(sq,sO[sm].h+sb);sA=sp}for(sY&&(sd.width=sr),sA>sd.height&&(sd.height=sA),sm=0,su=sO.length;sm<su;sm++)sO[sm].revertOrder(sc);return[sr,sA]},sX._will=null,sX.DIV_ELEMENT_PADDING=0,sX}(),sR=function(){function sd(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}sN(sd,"laya.html.utils.LayoutLine");var sL=sd.prototype;return sL.updatePos=function(sd,sL,sl,sZ,sh,s_,sN){var sm,su=0;0<this.elements.length&&(su=(sm=this.elements[this.elements.length-1]).x+sm.width-this.elements[0].x);var sx=0,st=NaN;1===sh&&(sx=(sL-su)/2),2===sh&&(sx=sL-su),0===sN||0!=s_||(s_=1);for(var sb=0,sq=this.elements.length;sb<sq;sb++){var sY=(sm=this.elements[sb])._getCSSStyle();switch(0!==sx&&(sm.x+=sx),sY._getValign()){case 0:sm.y=sZ;break;case 1:var sc=0;99999!=this.minTextHeight&&(sc=this.minTextHeight);var sr=(sc+sN)/2;sr=Math.max(sr,this.h),st=(laya.html.dom.HTMLImageElement,sZ+sr-sm.height),sm.y=st;break;case 2:sm.y=sZ+(sN-sm.height)}}},sL.revertOrder=function(sd){var sL;if(0<this.elements.length){var sl,sZ=0;for(sl=this.elements.length,sZ=0;sZ<sl;sZ++)(sL=this.elements[sZ]).x=sd-sL.x-sL.width}},sd}(),sA=function(sl){function sL(){this.URI=null,this._href=null,sL.__super.call(this),this._text=sL._EMPTYTEXT,this.setStyle(new su(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}sN(sL,"laya.html.dom.HTMLElement",sl);var sd=sL.prototype;return sd.layaoutCallNative=function(){var sd=0;if(this._childs&&0<(sd=this._childs.length))for(var sL=0;sL<sd;sL++)this._childs[sL].layaoutCallNative&&this._childs[sL].layaoutCallNative();var sl=this._getWords();sl?laya.html.dom.HTMLElement.fillWords(this,sl,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},sd.appendChild=function(sd){return this.addChild(sd)},sd._getWords2=function(){var sd=this._text.text;if(!sd||0===sd.length)return null;var sL,sl,sZ=0,sh=0;if(this._text.drawWords)sl=this._text.drawWords;else{for(sh=(sL=sd.split(" ")).length-1,sl=[],sZ=0;sZ<sh;sZ++)sl.push(sL[sZ]," ");0<=sh&&sl.push(sL[sh]),this._text.drawWords=sl}var s_,sN=this._text.words;if(sN&&sN.length===sl.length)return sN;null===sN&&(this._text.words=sN=[]),sN.length=sl.length;var sm=this.style,su=sm.font;for(sZ=0,sh=sl.length;sZ<sh;sZ++){s_=se.measureText(sl[sZ],su);var sx=sN[sZ]=new sb(sl[sZ],s_.width,s_.height||sm.fontSize,sm);if(1<sx.char.length&&(sx.charNum=sx.char),this.href){var st=new sY;this.addChild(st),sx.setSprite(st)}}return sN},sd._getWords=function(){if(!sj.CharacterCache)return this._getWords2();var sd=this._text.text;if(!sd||0===sd.length)return null;var sL,sl=this._text.words;if(sl&&sl.length===sd.length)return sl;null===sl&&(this._text.words=sl=[]),sl.length=sd.length;for(var sZ=this.style,sh=sZ.font,s_=0,sN=sd.length;s_<sN;s_++)if(sL=se.measureText(sd.charAt(s_),sh)){var sm=sl[s_]=new sb(sd.charAt(s_),sL.width,sL.height||sZ.fontSize,sZ);if(this.href){var su=new sY;this.addChild(su),sm.setSprite(su)}}else console.warn("_getWords size is null"+sd.charAt(s_),sh);return sl},sd.showLinkSprite=function(){var sd=this._text.words;if(sd)for(var sL,sl,sZ=[],sh=0;sh<sd.length;sh++)sl=sd[sh],(sL=new sY).graphics.drawRect(0,0,sl.width,sl.height,"#ff0000"),sL.width=sl.width,sL.height=sl.height,this.addChild(sL),sZ.push(sL)},sd._layoutLater=function(){var sd=this.style;512&sd._type||(sd.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&sd.block?(ss.later(this),sd._type|=512):this.parent&&this.parent._layoutLater())},sd._setAttributes=function(sd,sL){switch(sd){case"style":return void this.style.cssText(sL);case"class":return void(this.className=sL)}sl.prototype._setAttributes.call(this,sd,sL)},sd.updateHref=function(){if(null!=this._href){var sd=this._getWords();if(sd)for(var sL,sl,sZ=0;sZ<sd.length;sZ++)(sl=(sL=sd[sZ]).getSprite())&&(sl.size(sL.width,sL.height),sl.on("click",this,this.onLinkHandler))}},sd.onLinkHandler=function(sd){switch(sd.type){case"click":for(var sL=this;sL;)sL.event("link",[this.href]),sL=sL.parent}},sd.formatURL=function(sd){return this.URI?sk.formatURL(sd,this.URI?this.URI.path:null):sd},sm(0,sd,"href",function(){return this._href},function(sd){null!=(this._href=sd)&&(this._getCSSStyle().underLine=1,this.updateHref())}),sm(0,sd,"color",null,function(sd){this.style.color=sd}),sm(0,sd,"onClick",null,function(sd){sZ._runScript("fn=function(event){"+sd+";}"),this.on("click",this,void 0)}),sm(0,sd,"id",null,function(sd){sy.document.setElementById(sd,this)}),sm(0,sd,"innerTEXT",function(){return this._text.text},function(sd){this.text=sd}),sm(0,sd,"style",function(){return this._style}),sm(0,sd,"text",function(){return this._text.text},function(sd){this._text==sL._EMPTYTEXT?this._text={text:sd,words:null}:(this._text.text=sd,this._text.words&&(this._text.words.length=0)),sq.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),sm(0,sd,"parent",sl.prototype._$get_parent,function(sd){if(sd instanceof laya.html.dom.HTMLElement){var sL=sd;this.URI||(this.URI=sL.URI),this.style.inherit(sL.style)}sZ.superSet(sY,this,"parent",sd)}),sm(0,sd,"className",null,function(sd){this.style.attrs(sy.document.styleSheets["."+sd])}),sL.fillWords=function(sd,sL,sl,sZ,sh,s_,sN){sd.graphics.clear();for(var sm=0,su=sL.length;sm<su;sm++){var sx=sL[sm];sd.graphics.fillText(sx.char,sx.x+sl,sx.y+sZ,sh,s_,"left",sN)}},sL._EMPTYTEXT={text:null,words:null},sL}(sY),sL=(function(sd){function sL(){sL.__super.call(this),this.style.lineElement=!0,this.style.block=!0}sN(sL,"laya.html.dom.HTMLBrElement",sA)}(),function(sd){function sL(){this.contextHeight=NaN,this.contextWidth=NaN,sL.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}sN(sL,"laya.html.dom.HTMLDivElement",sd);var sl=sL.prototype;return sl.appendHTML=function(sd){sw.parse(this,sd,this.URI),this.layout()},sl._addChildsToLayout=function(sL){var sd=this._getWords();if(null==sd&&0==this._childs.length)return!1;sd&&sd.forEach(function(sd){sL.push(sd)});for(var sl=!0,sZ=0,sh=this._childs.length;sZ<sh;sZ++){var s_=this._childs[sZ];sl?sl=!1:sL.push(null),s_._addToLayout(sL)}return!0},sl._addToLayout=function(sd){this.layout()},sl.layout=function(){if(this.style){this.style._type|=512;var sd=ss.layout(this);if(sd){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new st);var sL=this._$P.mHtmlBounds;sL.x=sL.y=0,sL.width=this.contextWidth=sd[0],sL.height=this.contextHeight=sd[1],this.setBounds(sL)}}},sm(0,sl,"height",function(){return this._height?this._height:this.contextHeight},sd.prototype._$set_height),sm(0,sl,"innerHTML",null,function(sd){this.destroyChildren(),this.appendHTML(sd)}),sm(0,sl,"width",function(){return this._width?this._width:this.contextWidth},function(sd){var sL=!1;sL=0===sd?sd!=this._width:sd!=this.width,sZ.superSet(sA,this,"width",sd),sL&&this.layout()}),sL}(sA)),sy=function(sd){function sL(){this.all=new Array,this.styleSheets=su.styleSheets,sL.__super.call(this)}sN(sL,"laya.html.dom.HTMLDocument",sA);var sl=sL.prototype;return sl.getElementById=function(sd){return this.all[sd]},sl.setElementById=function(sd,sL){this.all[sd]=sL},sh(sL,["document",function(){return this.document=new sL}]),sL}();(function(sd){function sL(){this._tex=null,this._url=null,this._renderArgs=[],sL.__super.call(this),this.style.block=!0}sN(sL,"laya.html.dom.HTMLImageElement",sA);var sl=sL.prototype;sl._addToLayout=function(sd){!this._style.absolute&&sd.push(this)},sl.render=function(sd,sL,sl){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(sr.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,sd.ctx.drawTexture2(sL,sl,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},sl.layaoutCallNative=function(){var sd=0;if(this._childs&&0<(sd=this._childs.length))for(var sL=0;sL<sd;sL++)this._childs[sL].layaoutCallNative&&this._childs[sL].layaoutCallNative()},sm(0,sl,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(sd){this._width!==sd&&(this._width=sd,this._style.width=sd,this.repaint())}),sm(0,sl,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(sd){this._height!==sd&&(this._height=sd,this._style.height=sd,this.repaint())}),sl.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),sx.clearCache(this,this._url),this._tex=null),sA.prototype.destroy.call(this)},sl.onloaded=function(){var sd=this._style;sd&&!sd.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),sd&&!sd.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),sq.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},sl._loadImageComplete=function(sd,sL,sl){if(!this._destroyed)if(null!=sl)if(sl instanceof ArrayBuffer){var sZ=new DataView(sl);new laya.webgl.resource.WebGLImage(new Uint8Array(sl,8),sd,0,!1,sZ.getUint32(0),sZ.getUint32(4));this.onloaded()}else if(sl instanceof sa)sx.imgMgrSet[sd]=sL,s_.imgMgrLock(sd,sx.imgMgrSet[sd]),this._url=sd,this._tex=sl,sx.keepCache(this,sd),sx.cacheRes(sd,this._tex),this.onloaded();else{var sh=-1!=sd.indexOf(".png",sd.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(sl,sd,sh,!1,sl.width,sl.height);this.onloaded()}else this.event("error","Load image failed")},sm(0,sl,"src",null,function(sd){(sd=this.formatURL(sd),this._url!=sd)&&(null!=this._tex&&(sx.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=sd,(this._tex=sx.getRes(sd))?(sx.keepCache(this,sd),this.onloaded()):s_.imgMgrLoad(sd,this._loadImageComplete.bind(this),2,!1))})})(),function(sd){function sL(){this.type=null,sL.__super.call(this),this.visible=!1}sN(sL,"laya.html.dom.HTMLLinkElement",sd);var sl=sL.prototype;sl._onload=function(sd){switch(this.type){case"text/css":su.parseCSS(sd,this.URI)}},sm(0,sl,"href",sd.prototype._$get_href,function(sd){var sL=this;sd=this.formatURL(sd),this.URI=new sk(sd);var sl=new sx;sl.once("complete",null,function(sd){sL._onload(sd)}),sl.load(sd,"text")}),sL._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(sA),function(sd){function sL(){sL.__super.call(this),this.visible=!1}sN(sL,"laya.html.dom.HTMLStyleElement",sd),sm(0,sL.prototype,"text",sd.prototype._$get_text,function(sd){su.parseCSS(sd,null)})}(sA),function(sd){function sL(){sL.__super.call(this),this._getCSSStyle().valign="middle"}sN(sL,"laya.html.dom.HTMLIframeElement",sd),sm(0,sL.prototype,"href",sd.prototype._$get_href,function(sl){var sZ=this;sl=this.formatURL(sl);var sd=new sx;sd.once("complete",null,function(sd){var sL=sZ.URI;sZ.URI=new sk(sl),sZ.innerHTML=sd,!sL||(sZ.URI=sL)}),sd.load(sl,"text")})}(sL)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(sd,sL){"use strict";for(var sl in Object.defineProperty(sL,"__esModule",{value:!0}),Laya){var sZ=Laya[sl];sZ&&sZ.__isclass&&(sL[sl]=sZ)}}),function(sd,sL,sr){sr.un,sr.uns;var sZ=sr.static,s_=sr.class,sh=sr.getset,sl=(sr.__newvec,laya.display.Animation),sa=(laya.utils.Browser,laya.utils.ClassUtils),sN=laya.filters.ColorFilter,sm=laya.utils.Ease,su=laya.events.Event,sx=(laya.events.EventDispatcher,laya.display.css.Font),st=laya.display.FrameAnimation,sb=laya.display.Graphics,sq=laya.utils.Handler,sY=laya.display.Input,se=laya.net.Loader,sc=(laya.display.Node,laya.maths.Point),sk=laya.maths.Rectangle,sw=laya.renders.Render,ss=laya.display.Sprite,sA=laya.display.Text,sy=laya.resource.Texture,s$=laya.utils.Tween,sO=laya.utils.Utils,sn=laya.utils.WeakObject;sr.interface("laya.ui.IItem"),sr.interface("laya.ui.ISelect"),sr.interface("laya.ui.IRender"),sr.interface("laya.ui.IComponent"),sr.interface("laya.ui.IBox","IComponent");var sV=function(){function sd(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return s_(sd,"laya.ui.LayoutStyle"),sZ(sd,["EMPTY",function(){return this.EMPTY=new sd}]),sd}(),sQ=function(){function sd(){}return s_(sd,"laya.ui.Styles"),sd.labelColor="#000000",sd.buttonStateNum=3,sd.scrollBarMinNum=15,sd.scrollBarDelayTime=500,sZ(sd,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),sd}(),sg=function(){function sh(){}return s_(sh,"laya.ui.UIUtils"),sh.fillArray=function(sd,sL,sl){var sZ=sd.concat();if(sL)for(var sh=sL.split(","),s_=0,sN=Math.min(sZ.length,sh.length);s_<sN;s_++){var sm=sh[s_];sZ[s_]="true"==sm||"false"!=sm&&sm,null!=sl&&(sZ[s_]=sl(sm))}return sZ},sh.toColor=function(sd){return sO.toHexColor(sd)},sh.gray=function(sd,sL){void 0===sL&&(sL=!0),sL?sh.addFilter(sd,sh.grayFilter):sh.clearFilter(sd,sN)},sh.addFilter=function(sd,sL){var sl=sd.filters||[];sl.push(sL),sd.filters=sl},sh.clearFilter=function(sd,sL){var sl=sd.filters;if(null!=sl&&0<sl.length){for(var sZ=sl.length-1;-1<sZ;sZ--){var sh=sl[sZ];sr.__typeof(sh,sL)&&sl.splice(sZ,1)}sd.filters=sl}},sh._getReplaceStr=function(sd){return sh.escapeSequence[sd]},sh.adptString=function(sd){return sd.replace(/\\(\w)/g,sh._getReplaceStr)},sh.getBindFun=function(sd){var sL=sh._funMap.get(sd);if(null==sL){var sl='"'+sd+'"',sZ="(function(data){if(data==null)return;with(data){try{\nreturn "+(sl=sl.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";sL=sr._runScript(sZ),sh._funMap.set(sd,sL)}return sL},sZ(sh,["grayFilter",function(){return this.grayFilter=new sN([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new sn}]),sh}(),sF=function(){function sd(){}return s_(sd,"UIConfig"),sd.touchScrollEnable=!0,sd.mouseWheelEnable=!0,sd.showButtons=!0,sd.popupBgColor="#000000",sd.popupBgAlpha=.5,sd.closeDialogOnSide=!0,sd}(),sE=function(sl){function sk(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,sk.__super.call(this),this._weakKeys=[]}s_(sk,"laya.ui.AutoBitmap",sl);var sd=sk.prototype;return sd.destroy=function(){if(se.clearObject(this,this._weakKey),this._weakKeys){for(var sd=0,sL=this._weakKeys.length;sd<sL;++sd)se.clearObject(this,this._weakKeys[sd]);this._weakKeys=null}sl.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},sd._setChanged=function(){this._isChanged||(this._isChanged=!0,sr.timer.callLater(this,this.changeSource))},sd.changeSource=function(){this._isChanged=!1;var sd=this._source;if(sd&&sd.bitmap){var sL=this.width,sl=this.height,sZ=this._sizeGrid,sh=sd.sourceWidth,s_=sd.sourceHeight;if(!sZ||sh===sL&&s_===sl)this.cleanByTexture(sd,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,sL,sl);else{se.clearObject(this,this._weakKey),sd.$_GID||(sd.$_GID=sO.getGID());var sN=sd.$_GID+"."+sL+"."+sl+"."+sZ.join("."),sm=se.findObject(sN);if(sO.isOKCmdList(sm))return this._weakKey=sN,se.keepObject(this,this._weakKey),void(this.cmds=sm);this.clear();var su,sx,st=sZ[0],sb=sZ[1],sq=sZ[2],sY=sZ[3],sc=sZ[4],sr=!1;if(sL==sh&&(sY=sb=0),sl==s_&&(st=sq=0),sL<sY+sb){var sa=sL;sr=!0,sL=sY+sb,this.save(),this.clipRect(0,0,sa,sl)}sY&&st&&(su=sk.getTexture(sd,0,0,sY,st),sx=this._weakKeys[0],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[0]=su.weakKey),this.drawTexture(su,0,0,sY,st)):(se.clearObject(this,sx),this._weakKeys[0]="")),sb&&st&&(su=sk.getTexture(sd,sh-sb,0,sb,st),sx=this._weakKeys[1],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[1]=su.weakKey),this.drawTexture(su,sL-sb,0,sb,st)):(se.clearObject(this,sx),this._weakKeys[1]="")),sY&&sq&&(su=sk.getTexture(sd,0,s_-sq,sY,sq),sx=this._weakKeys[2],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[2]=su.weakKey),this.drawTexture(su,0,sl-sq,sY,sq)):(se.clearObject(this,sx),this._weakKeys[2]="")),sb&&sq&&(su=sk.getTexture(sd,sh-sb,s_-sq,sb,sq),sx=this._weakKeys[3],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[3]=su.weakKey),this.drawTexture(su,sL-sb,sl-sq,sb,sq)):(se.clearObject(this,sx),this._weakKeys[3]="")),st&&(su=sk.getTexture(sd,sY,0,sh-sY-sb,st),sx=this._weakKeys[4],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[4]=su.weakKey),this.drawBitmap(sc,su,sY,0,sL-sY-sb,st)):(se.clearObject(this,sx),this._weakKeys[4]="")),sq&&(su=sk.getTexture(sd,sY,s_-sq,sh-sY-sb,sq),sx=this._weakKeys[5],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[5]=su.weakKey),this.drawBitmap(sc,su,sY,sl-sq,sL-sY-sb,sq)):(se.clearObject(this,sx),this._weakKeys[5]="")),sY&&(su=sk.getTexture(sd,0,st,sY,s_-st-sq),sx=this._weakKeys[6],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[6]=su.weakKey),this.drawBitmap(sc,su,0,st,sY,sl-st-sq)):(se.clearObject(this,sx),this._weakKeys[6]="")),sb&&(su=sk.getTexture(sd,sh-sb,st,sb,s_-st-sq),sx=this._weakKeys[7],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[7]=su.weakKey),this.drawBitmap(sc,su,sL-sb,st,sb,sl-st-sq)):(se.clearObject(this,sx),this._weakKeys[7]="")),su=sk.getTexture(sd,sY,st,sh-sY-sb,s_-st-sq),sx=this._weakKeys[8],su?(sx!=su.weakKey&&(se.clearObject(this,sx),se.keepObject(this,su.weakKey),this._weakKeys[8]=su.weakKey),this.drawBitmap(sc,su,sY,st,sL-sY-sb,sl-st-sq)):(se.clearObject(this,sx),this._weakKeys[8]=""),sr&&this.restore(),this.autoCacheCmd&&!sw.isConchApp&&(se.saveObject(sN,this.cmds,null),this._weakKey=sN,se.keepObject(this,this._weakKey))}this._repaint()}},sd.drawBitmap=function(sd,sL,sl,sZ,sh,s_){void 0===sh&&(sh=0),void 0===s_&&(s_=0),sh<.1||s_<.1||(!sd||sL.width==sh&&sL.height==s_?this.drawTexture(sL,sl,sZ,sh,s_):this.fillTexture(sL,sl,sZ,sh,s_))},sd.clear=function(sd){void 0===sd&&(sd=!0),sl.prototype.clear.call(this,!1)},sh(0,sd,"sizeGrid",function(){return this._sizeGrid},function(sd){this._sizeGrid=sd,this._setChanged()}),sh(0,sd,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(sd){this._width!=sd&&(this._width=sd,this._setChanged())}),sh(0,sd,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(sd){this._height!=sd&&(this._height=sd,this._setChanged())}),sh(0,sd,"source",function(){return this._source},function(sd){sd?(this._source=sd,this._setChanged()):(this._source=null,this.clear())}),sk.getTexture=function(sd,sL,sl,sZ,sh){sZ<=0&&(sZ=1),sh<=0&&(sh=1),sd.$_GID||(sd.$_GID=sO.getGID());var s_=sd.$_GID+"."+sL+"."+sl+"."+sZ+"."+sh,sN=se.findObject(s_);if((!sN||!sN.source)&&(sN=sy.createFromTexture(sd,sL,sl,sZ,sh))){if(sd.alphaTexture){var sm=sd.width/sd.alphaTexture.width;sN.alphaTexture=sy.createFromTexture(sd.alphaTexture,sL/sm,sl/sm,sZ/sm,sh/sm)}se.saveObject(s_,sN),sN.weakKey=s_}return sN},sk}(sb),sI=(function(sd){function sL(){sL.__super.call(this)}s_(sL,"laya.ui.UIEvent",su),sL.SHOW_TIP="showtip",sL.HIDE_TIP="hidetip"}(),function(sL){function sd(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,sd.__super.call(this),this._layout=sV.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}s_(sd,"laya.ui.Component",sL);var sl=sd.prototype;return sr.imps(sl,{"laya.ui.IComponent":!0}),sl.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},sl.preinitialize=function(){},sl.createChildren=function(){},sl.initialize=function(){},sl.callLater=function(sd,sL){sr.timer.callLater(this,sd,sL)},sl.runCallLater=function(sd){sr.timer.runCallLater(this,sd)},sl.commitMeasure=function(){},sl.changeSize=function(){this.event("resize")},sl.getLayout=function(){return this._layout===sV.EMPTY&&(this._layout=new sV),this._layout},sl._setLayoutEnabled=function(sd){this._layout&&this._layout.enable!=sd&&(this._layout.enable=sd,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},sl.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},sl.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},sl.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},sl.resetLayoutX=function(){var sd=this._layout;if(isNaN(sd.anchorX)||(this.pivotX=sd.anchorX*this.width),this.layoutEnabled){var sL=this.parent;sL&&(isNaN(sd.centerX)?isNaN(sd.left)?isNaN(sd.right)||(this.x=Math.round(sL.width-this.displayWidth-sd.right+this.pivotX*this.scaleX)):(this.x=Math.round(sd.left+this.pivotX*this.scaleX),isNaN(sd.right)||(this.width=(sL._width-sd.left-sd.right)/(this.scaleX||.01))):this.x=Math.round(.5*(sL.width-this.displayWidth)+sd.centerX+this.pivotX*this.scaleX))}},sl.resetLayoutY=function(){var sd=this._layout;if(isNaN(sd.anchorY)||(this.pivotY=sd.anchorY*this.height),this.layoutEnabled){var sL=this.parent;sL&&(isNaN(sd.centerY)?isNaN(sd.top)?isNaN(sd.bottom)||(this.y=Math.round(sL.height-this.displayHeight-sd.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(sd.top+this.pivotY*this.scaleY),isNaN(sd.bottom)||(this.height=(sL._height-sd.top-sd.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(sL.height-this.displayHeight)+sd.centerY+this.pivotY*this.scaleY))}},sl.onMouseOver=function(sd){sr.stage.event("showtip",this._toolTip)},sl.onMouseOut=function(sd){sr.stage.event("hidetip",this._toolTip)},sh(0,sl,"displayWidth",function(){return this.width*this.scaleX}),sh(0,sl,"width",function(){return this._width?this._width:this.measureWidth},function(sd){this._width!=sd&&(this._width=sd,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),sh(0,sl,"measureWidth",function(){var sd=0;this.commitMeasure();for(var sL=this.numChildren-1;-1<sL;sL--){var sl=this.getChildAt(sL);sl.visible&&(sd=Math.max(sl.x+sl.width*sl.scaleX,sd))}return sd}),sh(0,sl,"displayHeight",function(){return this.height*this.scaleY}),sh(0,sl,"height",function(){return this._height?this._height:this.measureHeight},function(sd){this._height!=sd&&(this._height=sd,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),sh(0,sl,"dataSource",function(){return this._dataSource},function(sd){for(var sL in this._dataSource=sd,this._dataSource)this.hasOwnProperty(sL)&&"function"!=typeof this[sL]&&(this[sL]=this._dataSource[sL])}),sh(0,sl,"scaleY",sL.prototype._$get_scaleY,function(sd){sr.superGet(ss,this,"scaleY")!=sd&&(sr.superSet(ss,this,"scaleY",sd),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),sh(0,sl,"measureHeight",function(){var sd=0;this.commitMeasure();for(var sL=this.numChildren-1;-1<sL;sL--){var sl=this.getChildAt(sL);sl.visible&&(sd=Math.max(sl.y+sl.height*sl.scaleY,sd))}return sd}),sh(0,sl,"scaleX",sL.prototype._$get_scaleX,function(sd){sr.superGet(ss,this,"scaleX")!=sd&&(sr.superSet(ss,this,"scaleX",sd),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),sh(0,sl,"top",function(){return this._layout.top},function(sd){sd!=this._layout.top&&(this.getLayout().top=sd,this._setLayoutEnabled(!0)),this.resetLayoutY()}),sh(0,sl,"bottom",function(){return this._layout.bottom},function(sd){sd!=this._layout.bottom&&(this.getLayout().bottom=sd,this._setLayoutEnabled(!0)),this.resetLayoutY()}),sh(0,sl,"left",function(){return this._layout.left},function(sd){sd!=this._layout.left&&(this.getLayout().left=sd,this._setLayoutEnabled(!0)),this.resetLayoutX()}),sh(0,sl,"right",function(){return this._layout.right},function(sd){sd!=this._layout.right&&(this.getLayout().right=sd,this._setLayoutEnabled(!0)),this.resetLayoutX()}),sh(0,sl,"centerX",function(){return this._layout.centerX},function(sd){sd!=this._layout.centerX&&(this.getLayout().centerX=sd,this._setLayoutEnabled(!0)),this.resetLayoutX()}),sh(0,sl,"centerY",function(){return this._layout.centerY},function(sd){sd!=this._layout.centerY&&(this.getLayout().centerY=sd,this._setLayoutEnabled(!0)),this.resetLayoutY()}),sh(0,sl,"anchorX",function(){return this._layout.anchorX},function(sd){sd!=this._layout.anchorX&&(this.getLayout().anchorX=sd,this._setLayoutEnabled(!0)),this.resetLayoutX()}),sh(0,sl,"anchorY",function(){return this._layout.anchorY},function(sd){sd!=this._layout.anchorY&&(this.getLayout().anchorY=sd,this._setLayoutEnabled(!0)),this.resetLayoutY()}),sh(0,sl,"tag",function(){return this._tag},function(sd){this._tag=sd}),sh(0,sl,"toolTip",function(){return this._toolTip},function(sd){this._toolTip!=sd&&(null!=(this._toolTip=sd)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),sh(0,sl,"comXml",function(){return this._comXml},function(sd){this._comXml=sd}),sh(0,sl,"gray",function(){return this._gray},function(sd){sd!==this._gray&&(this._gray=sd,sg.gray(this,sd))}),sh(0,sl,"disabled",function(){return this._disabled},function(sd){sd!==this._disabled&&(this.gray=this._disabled=sd,this.mouseEnabled=!sd)}),sd}(ss)),sp=function(sd){function sL(){this.lockLayer=null,this.popupEffect=function(sd){sd.scale(1,1),s$.from(sd,{x:sr.stage.width/2,y:sr.stage.height/2,scaleX:0,scaleY:0},300,sm.backOut,sq.create(this,this.doOpen,[sd]))},this.closeEffect=function(sd,sL){s$.to(sd,{x:sr.stage.width/2,y:sr.stage.height/2,scaleX:0,scaleY:0},300,sm.strongOut,sq.create(this,this.doClose,[sd,sL]))},sL.__super.call(this),this.maskLayer=new ss,this.popupEffectHandler=sq.create(this,this.popupEffect,null,!1),this.closeEffectHandler=sq.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,sr.stage.addChild(this),sr.stage.on("resize",this,this._onResize),sF.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}s_(sL,"laya.ui.DialogManager",ss);var sl=sL.prototype;return sl._closeOnSide=function(){var sd=this.getChildAt(this.numChildren-1);sd instanceof laya.ui.Dialog&&sd.close("side")},sl.setLockView=function(sd){this.lockLayer||(this.lockLayer=new sH,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(sr.stage.width,sr.stage.height)),this.lockLayer.removeChildren(),sd&&(sd.centerX=sd.centerY=0,this.lockLayer.addChild(sd))},sl._onResize=function(sd){var sL=this.maskLayer.width=sr.stage.width,sl=this.maskLayer.height=sr.stage.height;this.lockLayer&&this.lockLayer.size(sL,sl),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,sL,sl,sF.popupBgColor),this.maskLayer.alpha=sF.popupBgAlpha;for(var sZ=this.numChildren-1;-1<sZ;sZ--){var sh=this.getChildAt(sZ);sh.popupCenter&&this._centerDialog(sh)}},sl._centerDialog=function(sd){sd.x=Math.round((sr.stage.width-sd.width>>1)+sd.pivotX),sd.y=Math.round((sr.stage.height-sd.height>>1)+sd.pivotY)},sl.open=function(sd,sL,sl){void 0===sL&&(sL=!1),void 0===sl&&(sl=!1),sL&&this._closeAll(),sd.popupCenter&&this._centerDialog(sd),this.addChild(sd),(sd.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),sl&&null!=sd.popupEffect?sd.popupEffect.runWith(sd):this.doOpen(sd),this.event("open")},sl.doOpen=function(sd){sd.onOpened()},sl.lock=function(sd){this.lockLayer&&(sd?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},sl.close=function(sd,sL,sl){void 0===sl&&(sl=!1),sl&&null!=sd.closeEffect?sd.closeEffect.runWith([sd,sL]):this.doClose(sd,sL),this.event("close")},sl.doClose=function(sd,sL){sd.removeSelf(),sd.isModal&&this._checkMask(),sd.closeHandler&&sd.closeHandler.runWith(sL),sd.onClosed(sL)},sl.closeAll=function(){this._closeAll(),this.event("close")},sl._closeAll=function(){for(var sd=this.numChildren-1;-1<sd;sd--){var sL=this.getChildAt(sd);sL&&null!=sL.close&&this.doClose(sL)}},sl.getDialogsByGroup=function(sd){for(var sL=[],sl=this.numChildren-1;-1<sl;sl--){var sZ=this.getChildAt(sl);sZ&&sZ.group===sd&&sL.push(sZ)}return sL},sl.closeByGroup=function(sd){for(var sL=[],sl=this.numChildren-1;-1<sl;sl--){var sZ=this.getChildAt(sl);sZ&&sZ.group===sd&&(sZ.close(),sL.push(sZ))}return sL},sl._checkMask=function(){this.maskLayer.removeSelf();for(var sd=this.numChildren-1;-1<sd;sd--){var sL=this.getChildAt(sd);if(sL&&sL.isModal)return void this.addChildAt(this.maskLayer,sd)}},sL}(),sH=function(sd){function sL(){sL.__super.call(this)}s_(sL,"laya.ui.Box",sd);var sl=sL.prototype;return sr.imps(sl,{"laya.ui.IBox":!0}),sh(0,sl,"dataSource",sd.prototype._$get_dataSource,function(sd){for(var sL in this._dataSource=sd){var sl=this.getChildByName(sL);sl?sl.dataSource=sd[sL]:this.hasOwnProperty(sL)&&"function"!=typeof this[sL]&&(this[sL]=sd[sL])}}),sL}(sI),sX=function(sL){function sl(sd,sL){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,sl.__super.call(this),this._labelColors=sQ.buttonLabelColors,this._stateNum=sQ.buttonStateNum,void 0===sL&&(sL=""),this.skin=sd,this.label=sL}s_(sl,"laya.ui.Button",sL);var sd=sl.prototype;return sr.imps(sd,{"laya.ui.ISelect":!0}),sd.destroy=function(sd){se.clearCache(this,this._skin),se.clearObject(this,this._weakKey),void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(sd),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},sd.createChildren=function(){this.graphics=this._bitmap=new sE},sd.createText=function(){this._text||(this._text=new sA,this._text.overflow=sA.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},sd.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},sd.onMouse=function(sd){if(!1!==this.toggle||!this._selected)return"click"===sd.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=sl.stateMap[sd.type]))},sd.changeClips=function(){var sd=se.getRes(this._skin);if(sd&&this._skin&&""!=this._skin){se.clearObject(this,this._weakKey);var sL=sd.sourceWidth,sl=sd.sourceHeight/this._stateNum;sd.$_GID||(sd.$_GID=sO.getGID());var sZ=sd.$_GID+"-"+this._stateNum,sh=se.findObject(sZ);if(sO.isOkTextureList(sh)||(sh=null),sh)this._weakKey=sZ,se.keepObject(this,this._weakKey),this._sources=sh;else{if(this._sources=[],1===this._stateNum)this._sources.push(sd);else for(var s_=0;s_<this._stateNum;s_++){var sN=sy.createFromTexture(sd,0,sl*s_,sL,sl);if(sd.alphaTexture){var sm=sd.width/sd.alphaTexture.width;sN.alphaTexture=sy.createFromTexture(sd.alphaTexture,0/sm,sl*s_/sm,sL/sm,sl/sm)}this._sources.push(sN)}se.saveObject(sZ,this._sources),this._weakKey=sZ,se.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||sL,this._bitmap.height=this._height||sl,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=sL)}else console.warn("lose skin ",this._skin,this.name,this.__className)},sd.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var sd=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[sd]),this.label&&(this._text.color=this._labelColors[sd],this._strokeColors&&(this._text.strokeColor=this._strokeColors[sd]))},sd._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},sh(0,sd,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(sd){this.createText(),this._text.strokeColor=sd}),sh(0,sd,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),sh(0,sd,"skin",function(){return this._skin},function(sd){this._skin!=sd&&(se.clearCache(this,this._skin),this._skin=sd,se.keepCache(this,this._skin),this.callLater(this.changeClips),this._setStateChanged())}),sh(0,sd,"state",function(){return this._state},function(sd){this._state!=sd&&(this._state=sd,this._setStateChanged())}),sh(0,sd,"text",function(){return this.createText(),this._text}),sh(0,sd,"stateNum",function(){return this._stateNum},function(sd){"string"==typeof sd&&(sd=parseInt(sd)),this._stateNum!=sd&&(this._stateNum=sd<1?1:3<sd?3:sd,this.callLater(this.changeClips))}),sh(0,sd,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(sd){this._strokeColors=sg.fillArray(sQ.buttonLabelColors,sd,String),this._setStateChanged()}),sh(0,sd,"labelColors",function(){return this._labelColors.join(",")},function(sd){this._labelColors=sg.fillArray(sQ.buttonLabelColors,sd,String),this._setStateChanged()}),sh(0,sd,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),sh(0,sd,"label",function(){return this._text?this._text.text:null},function(sd){(this._text||sd)&&(this.createText(),this._text.text!=sd&&(sd&&!this._text.parent&&this.addChild(this._text),this._text.text=(sd+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),sh(0,sd,"selected",function(){return this._selected},function(sd){this._selected!=sd&&(this._selected=sd,this.state=this._selected?2:0,this.event("change"))}),sh(0,sd,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(sd){this.createText(),this._text.padding=sg.fillArray(sQ.labelPadding,sd,Number)}),sh(0,sd,"labelSize",function(){return this.createText(),this._text.fontSize},function(sd){this.createText(),this._text.fontSize=sd}),sh(0,sd,"labelStroke",function(){return this.createText(),this._text.stroke},function(sd){this.createText(),this._text.stroke=sd}),sh(0,sd,"labelBold",function(){return this.createText(),this._text.bold},function(sd){this.createText(),this._text.bold=sd}),sh(0,sd,"labelFont",function(){return this.createText(),this._text.font},function(sd){this.createText(),this._text.font=sd}),sh(0,sd,"labelAlign",function(){return this.createText(),this._text.align},function(sd){this.createText(),this._text.align=sd}),sh(0,sd,"clickHandler",function(){return this._clickHandler},function(sd){this._clickHandler=sd}),sh(0,sd,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(sd){this._bitmap.sizeGrid=sg.fillArray(sQ.defaultSizeGrid,sd,Number)}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sI,this,"width",sd),this._autoSize&&(this._bitmap.width=sd,this._text&&(this._text.width=sd))}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sI,this,"height",sd),this._autoSize&&(this._bitmap.height=sd,this._text&&(this._text.height=sd))}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)||"string"==typeof sd?this.label=sd+"":sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(sd){this._bitmap._offset=sd?sg.fillArray([1,1],sd,Number):[]}),sZ(sl,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),sl}(sI),sj=function(sL){function sZ(sd,sL,sl){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,sZ.__super.call(this),void 0===sL&&(sL=1),void 0===sl&&(sl=1),this._clipX=sL,this._clipY=sl,this.skin=sd}s_(sZ,"laya.ui.Clip",sL);var sd=sZ.prototype;return sd.destroy=function(sd){se.clearCache(this,this._skin),se.clearObject(this,this._weakKey),void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},sd.dispose=function(){this.destroy(!0),sr.loader.clearRes(this._skin)},sd.createChildren=function(){this.graphics=this._bitmap=new sE},sd._onDisplay=function(sd){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},sd.changeClip=function(){if(this._clipChanged=!1,this._skin){var sd=se.getRes(this._skin);sd?this.loadComplete(this._skin,sd):sr.loader.load(this._skin,sq.create(this,this.loadComplete,[this._skin]))}},sd.loadComplete=function(sd,sL){if(sd===this._skin&&sL){se.clearObject(this,this._weakKey);var sl=this._clipWidth||Math.ceil(sL.sourceWidth/this._clipX),sZ=this._clipHeight||Math.ceil(sL.sourceHeight/this._clipY),sh=this._skin+sl+sZ,s_=se.findObject(sh);if(sO.isOkTextureList(s_)||(s_=null),s_)this._weakKey=sh,se.keepObject(this,this._weakKey),this._sources=s_;else{this._sources=[];for(var sN=0;sN<this._clipY;sN++)for(var sm=0;sm<this._clipX;sm++){var su=sy.createFromTexture(sL,sl*sm,sZ*sN,sl,sZ);if(sL.alphaTexture){var sx=sL.width/sL.alphaTexture.width;su.alphaTexture=sy.createFromTexture(sL.alphaTexture,sl*sm/sx,sZ*sN/sx,sl/sx,sZ/sx)}this._sources.push(su)}se.saveObject(sh,this._sources),this._weakKey=sh,se.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},sd.play=function(sd,sL){void 0===sd&&(sd=0),void 0===sL&&(sL=-1),this._isPlaying=!0,this.index=sd,this._toIndex=sL,this._index++,sr.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},sd._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},sd.stop=function(){this._isPlaying=!1,sr.timer.clear(this,this._loop),this.event("complete")},sd._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},sh(0,sd,"interval",function(){return this._interval},function(sd){this._interval!=sd&&(this._interval=sd,this._isPlaying&&this.play())}),sh(0,sd,"skin",function(){return this._skin},function(sd){this._skin!=sd&&(se.clearCache(this,this._skin),(this._skin=sd)?(se.keepCache(this,this._skin),this._setClipChanged()):this._bitmap.source=null)}),sh(0,sd,"sources",function(){return this._sources},function(sd){this._sources=sd,this.index=this._index,this.event("loaded")}),sh(0,sd,"clipX",function(){return this._clipX},function(sd){this._clipX=sd||1,this._setClipChanged()}),sh(0,sd,"clipY",function(){return this._clipY},function(sd){this._clipY=sd||1,this._setClipChanged()}),sh(0,sd,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),sh(0,sd,"clipWidth",function(){return this._clipWidth},function(sd){this._clipWidth=sd,this._setClipChanged()}),sh(0,sd,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(sd){this._bitmap.sizeGrid=sg.fillArray(sQ.defaultSizeGrid,sd,Number)}),sh(0,sd,"group",function(){return this._group},function(sd){sd&&this._skin&&se.setGroup(this._skin,sd),this._group=sd}),sh(0,sd,"clipHeight",function(){return this._clipHeight},function(sd){this._clipHeight=sd,this._setClipChanged()}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sI,this,"width",sd),this._bitmap.width=sd}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sI,this,"height",sd),this._bitmap.height=sd}),sh(0,sd,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),sh(0,sd,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),sh(0,sd,"index",function(){return this._index},function(sd){this._index=sd,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[sd]),this.event("change")}),sh(0,sd,"autoPlay",function(){return this._autoPlay},function(sd){this._autoPlay!=sd&&((this._autoPlay=sd)?this.play():this.stop())}),sh(0,sd,"isPlaying",function(){return this._isPlaying},function(sd){this._isPlaying=sd}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)&&Math.floor(sd)==sd||"string"==typeof sd?this.index=parseInt(sd):sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"bitmap",function(){return this._bitmap}),sZ}(sI),sR=function(sL){function sd(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,sd.__super.call(this)}s_(sd,"laya.ui.ColorPicker",sL);var sl=sd.prototype;return sl.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._colorPanel&&this._colorPanel.destroy(sd),this._colorButton&&this._colorButton.destroy(sd),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},sl.createChildren=function(){this.addChild(this._colorButton=new sX),this._colorPanel=new sH,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new ss),this._colorPanel.addChild(this._colorBlock=new ss),this._colorPanel.addChild(this._colorInput=new sY)},sl.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},sl.onPanelMouseDown=function(sd){sd.stopPropagation()},sl.changePanel=function(){this._panelChanged=!1;var sd=this._colorPanel.graphics;sd.clear(),sd.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(sd=this._colorTiles.graphics).clear();for(var sL=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],sl=0;sl<12;sl++)for(var sZ=0;sZ<20;sZ++){var sh=0;sh=0===sZ?sL[sl]:1===sZ?0:51*(((3*sl+sZ/6)%3<<0)+3*(sl/6<<0))<<16|sZ%6*51<<8|(sl<<0)%6*51;var s_=sg.toColor(sh);this._colors.push(s_);var sN=sZ*this._gridSize,sm=sl*this._gridSize;sd.drawRect(sN,sm,this._gridSize,this._gridSize,s_,"#000000")}},sl.onColorButtonClick=function(sd){this._colorPanel.parent?this.close():this.open()},sl.open=function(){var sd=this.localToGlobal(new sc),sL=sd.x+this._colorPanel.width<=sr.stage.width?sd.x:sr.stage.width-this._colorPanel.width,sl=sd.y+this._colorButton.height;sl=sl+this._colorPanel.height<=sr.stage.height?sl:sd.y-this._colorPanel.height,this._colorPanel.pos(sL,sl),this._colorPanel.zOrder=1001,sr._currentStage.addChild(this._colorPanel),sr.stage.on("mousedown",this,this.removeColorBox)},sl.close=function(){sr.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},sl.removeColorBox=function(sd){this.close()},sl.onColorFieldKeyDown=function(sd){13==sd.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),sd.stopPropagation())},sl.onColorInputChange=function(sd){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},sl.onColorTilesClick=function(sd){this.selectedColor=this.getColorByMouse(),this.close()},sl.onColorTilesMouseMove=function(sd){this._colorInput.focus=!1;var sL=this.getColorByMouse();this._colorInput.text=sL,this.drawBlock(sL)},sl.getColorByMouse=function(){var sd=this._colorTiles.getMousePoint(),sL=Math.floor(sd.x/this._gridSize),sl=Math.floor(sd.y/this._gridSize);return this._colors[20*sl+sL]},sl.drawBlock=function(sd){var sL=this._colorBlock.graphics;sL.clear();var sl=sd||"#ffffff";sL.drawRect(0,0,50,20,sl,this._borderColor),sd||sL.drawLine(0,0,50,20,"#ff0000")},sl.changeColor=function(){var sd=this.graphics;sd.clear();var sL=this._selectedColor||"#000000";sd.drawRect(0,0,this._colorButton.width,this._colorButton.height,sL)},sl._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},sh(0,sl,"inputBgColor",function(){return this._inputBgColor},function(sd){this._inputBgColor=sd,this._setPanelChanged()}),sh(0,sl,"selectedColor",function(){return this._selectedColor},function(sd){this._selectedColor!=sd&&(this._selectedColor=this._colorInput.text=sd,this.drawBlock(sd),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",su.EMPTY.setTo("change",this,this)))}),sh(0,sl,"skin",function(){return this._colorButton.skin},function(sd){this._colorButton.skin=sd,this.changeColor()}),sh(0,sl,"bgColor",function(){return this._bgColor},function(sd){this._bgColor=sd,this._setPanelChanged()}),sh(0,sl,"borderColor",function(){return this._borderColor},function(sd){this._borderColor=sd,this._setPanelChanged()}),sh(0,sl,"inputColor",function(){return this._inputColor},function(sd){this._inputColor=sd,this._setPanelChanged()}),sd}(sI),so=function(sL){function sl(sd,sL){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,sl.__super.call(this),this._itemColors=sQ.comboBoxItemColors,this.skin=sd,this.labels=sL}s_(sl,"laya.ui.ComboBox",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._button&&this._button.destroy(sd),this._list&&this._list.destroy(sd),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},sd.createChildren=function(){this.addChild(this._button=new sX),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},sd._createList=function(){this._list=new sK,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},sd._setListEvent=function(sd){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=sq.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},sd.onListDown=function(sd){sd.stopPropagation()},sd.onScrollBarDown=function(sd){sd.stopPropagation()},sd.onButtonMouseDown=function(sd){this.callLater(this.switchTo,[!this._isOpen])},sd.changeList=function(){this._listChanged=!1;var sd=this.width-2,sL=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:sd,height:this._itemHeight,fontSize:this._itemSize,color:sL}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},sd.onlistItemMouse=function(sd,sL){var sl=sd.type;if("mouseover"===sl||"mouseout"===sl){if(this._isCustomList)return;var sZ=this._list.getCell(sL);if(!sZ)return;var sh=sZ.getChildByName("label");sh&&("mouseover"===sl?(sh.bgColor=this._itemColors[0],sh.color=this._itemColors[1]):(sh.bgColor=null,sh.color=this._itemColors[2]))}else"click"===sl&&(this.selectedIndex=sL,this.isOpen=!1)},sd.switchTo=function(sd){this.isOpen=sd},sd.changeOpen=function(){this.isOpen=!this._isOpen},sd.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var sd=this._list.graphics;sd.clear(),sd.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var sL=this._list.array||[],sl=sL.length=0,sZ=this._labels.length;sl<sZ;sl++)sL.push({label:this._labels[sl]});this._list.height=this._listHeight,this._list.array=sL},sd.changeSelected=function(){this._button.label=this.selectedLabel},sd._onStageMouseWheel=function(sd){this._list&&!this._list.contains(sd.target)&&this.removeList(null)},sd.removeList=function(sd){sr.stage.off("mousedown",this,this.removeList),sr.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},sh(0,sd,"selectedIndex",function(){return this._selectedIndex},function(sd){this._selectedIndex!=sd&&(this._selectedIndex=sd,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[su.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),sh(0,sd,"measureHeight",function(){return this._button.height}),sh(0,sd,"skin",function(){return this._button.skin},function(sd){this._button.skin!=sd&&(this._button.skin=sd,this._listChanged=!0)}),sh(0,sd,"measureWidth",function(){return this._button.width}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sI,this,"width",sd),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),sh(0,sd,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(sd){this.selectedIndex=this._labels.indexOf(sd)}),sh(0,sd,"labels",function(){return this._labels.join(",")},function(sd){0<this._labels.length&&(this.selectedIndex=-1),sd?this._labels=sd.split(","):this._labels.length=0,this._itemChanged=!0}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sI,this,"height",sd),this._button.height=this._height}),sh(0,sd,"selectHandler",function(){return this._selectHandler},function(sd){this._selectHandler=sd}),sh(0,sd,"visibleNum",function(){return this._visibleNum},function(sd){this._visibleNum=sd,this._listChanged=!0}),sh(0,sd,"labelBold",function(){return this._button.text.bold},function(sd){this._button.text.bold=sd}),sh(0,sd,"itemColors",function(){return String(this._itemColors)},function(sd){this._itemColors=sg.fillArray(this._itemColors,sd,String),this._listChanged=!0}),sh(0,sd,"itemSize",function(){return this._itemSize},function(sd){this._itemSize=sd,this._listChanged=!0}),sh(0,sd,"scrollBar",function(){return this.list.scrollBar}),sh(0,sd,"isOpen",function(){return this._isOpen},function(sd){if(this._isOpen!=sd)if(this._isOpen=sd,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var sL=this.localToGlobal(sc.TEMP.setTo(0,0)),sl=sL.y+this._button.height;sl=sl+this._listHeight<=sr.stage.height?sl:sL.y-this._listHeight,this._list.pos(sL.x,sl),this._list.zOrder=1001,sr._currentStage.addChild(this._list),sr.stage.once("mousedown",this,this.removeList),sr.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),sh(0,sd,"scrollBarSkin",function(){return this._scrollBarSkin},function(sd){this._scrollBarSkin=sd}),sh(0,sd,"sizeGrid",function(){return this._button.sizeGrid},function(sd){this._button.sizeGrid=sd}),sh(0,sd,"button",function(){return this._button}),sh(0,sd,"list",function(){return this._list||this._createList(),this._list},function(sd){sd&&(sd.removeSelf(),this._isCustomList=!0,this._list=sd,this._setListEvent(sd),this._itemHeight=sd.getCell(0).height+sd.spaceY)}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)&&Math.floor(sd)==sd||"string"==typeof sd?this.selectedIndex=parseInt(sd):sd instanceof Array?this.labels=sd.join(","):sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"labelColors",function(){return this._button.labelColors},function(sd){this._button.labelColors!=sd&&(this._button.labelColors=sd)}),sh(0,sd,"labelPadding",function(){return this._button.text.padding.join(",")},function(sd){this._button.text.padding=sg.fillArray(sQ.labelPadding,sd,Number)}),sh(0,sd,"labelSize",function(){return this._button.text.fontSize},function(sd){this._button.text.fontSize=sd}),sh(0,sd,"labelFont",function(){return this._button.text.font},function(sd){this._button.text.font=sd}),sh(0,sd,"stateNum",function(){return this._button.stateNum},function(sd){this._button.stateNum=sd}),sl}(sI),si=function(sL){function sl(sd){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,sl.__super.call(this),this._showButtons=sF.showButtons,this._touchScrollEnable=sF.touchScrollEnable,this._mouseWheelEnable=sF.mouseWheelEnable,this.skin=sd,this.max=1}s_(sl,"laya.ui.ScrollBar",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),this.stopScroll(),this.target=null,sL.prototype.destroy.call(this,sd),this.upButton&&this.upButton.destroy(sd),this.downButton&&this.downButton.destroy(sd),this.slider&&this.slider.destroy(sd),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},sd.createChildren=function(){this.addChild(this.slider=new sS),this.addChild(this.upButton=new sX),this.addChild(this.downButton=new sX)},sd.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},sd.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},sd.onButtonMouseDown=function(sd){var sL=sd.currentTarget===this.upButton;this.slide(sL),sr.timer.once(sQ.scrollBarDelayTime,this,this.startLoop,[sL]),sr.stage.once("mouseup",this,this.onStageMouseUp)},sd.startLoop=function(sd){sr.timer.frameLoop(1,this,this.slide,[sd])},sd.slide=function(sd){sd?this.value-=this._scrollSize:this.value+=this._scrollSize},sd.onStageMouseUp=function(sd){sr.timer.clear(this,this.startLoop),sr.timer.clear(this,this.slide)},sd.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},sd.changeSize=function(){sL.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},sd.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},sd.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},sd.setScroll=function(sd,sL,sl){this.runCallLater(this.changeSize),this.slider.setSlider(sd,sL,sl),this.slider.bar.visible=0<sL,!this._hide&&this.autoHide&&(this.visible=!1)},sd.onTargetMouseWheel=function(sd){this.value-=sd.delta*this._scrollSize,this.target=this._target},sd.onTargetMouseDown=function(sd){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new sc),this._lastPoint.setTo(sr.stage.mouseX,sr.stage.mouseY),sr.timer.clear(this,this.tweenMove),s$.clearTween(this),sr.stage.once("mouseup",this,this.onStageMouseUp2),sr.stage.once("mouseout",this,this.onStageMouseUp2),sr.timer.frameLoop(1,this,this.loop)},sd.loop=function(){var sd=sr.stage.mouseY,sL=sr.stage.mouseX;if(this._lastOffset=this.isVertical?sd-this._lastPoint.y:sL-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?sr.stage._canvasTransform.getScaleY():sr.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=sL,this._lastPoint.y=sd,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},sd.onStageMouseUp2=function(sd){if(sr.stage.off("mouseup",this,this.onStageMouseUp2),sr.stage.off("mouseout",this,this.onStageMouseUp2),sr.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?s$.to(this,{value:this.min},this.elasticBackTime,sm.sineOut,sq.create(this,this.elasticOver)):this._value>this.max&&s$.to(this,{value:this.max},this.elasticBackTime,sm.sineOut,sq.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?sr.stage.mouseY-this._lastPoint.y:sr.stage.mouseX-this._lastPoint.x);for(var sL=0,sl=Math.min(this._offsets.length,3),sZ=0;sZ<sl;sZ++)sL+=this._offsets[this._offsets.length-1-sZ];if(this._lastOffset=sL/sl,(sL=Math.abs(this._lastOffset))<2)return void this.event("end");60<sL&&(this._lastOffset=0<this._lastOffset?60:-60);var sh=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));sr.timer.frameLoop(1,this,this.tweenMove,[sh])}},sd.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&s$.to(this,{alpha:0},500),this.event("end")},sd.tweenMove=function(sd){this._lastOffset*=this.rollRatio;var sL=NaN;if(0<sd&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,sL=.5*-(this.min-sd-this.value),this._lastOffset>sL&&(this._lastOffset=sL)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,sL=.5*-(this.max+sd-this.value),this._lastOffset<sL&&(this._lastOffset=sL))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(sr.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?s$.to(this,{value:this.min},this.elasticBackTime,sm.sineOut,sq.create(this,this.elasticOver)):this._value>this.max?s$.to(this,{value:this.max},this.elasticBackTime,sm.sineOut,sq.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&s$.to(this,{alpha:0},500)}},sd.stopScroll=function(){this.onStageMouseUp2(null),sr.timer.clear(this,this.tweenMove),s$.clearTween(this)},sh(0,sd,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),sh(0,sd,"skin",function(){return this._skin},function(sd){this._skin!=sd&&(this._skin=sd,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),sh(0,sd,"max",function(){return this.slider.max},function(sd){this.slider.max=sd}),sh(0,sd,"showButtons",function(){return this._showButtons},function(sd){this._showButtons=sd,this.callLater(this.changeScrollBar)}),sh(0,sd,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),sh(0,sd,"min",function(){return this.slider.min},function(sd){this.slider.min=sd}),sh(0,sd,"value",function(){return this._value},function(sd){sd!==this._value&&(this._value=sd,this._isElastic||(this.slider._value!=sd&&(this.slider._value=sd,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),sh(0,sd,"isVertical",function(){return this.slider.isVertical},function(sd){this.slider.isVertical=sd}),sh(0,sd,"sizeGrid",function(){return this.slider.sizeGrid},function(sd){this.slider.sizeGrid=sd}),sh(0,sd,"scrollSize",function(){return this._scrollSize},function(sd){this._scrollSize=sd}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)||"string"==typeof sd?this.value=Number(sd):sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"thumbPercent",function(){return this._thumbPercent},function(sd){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),sd=1<=sd?.99:sd,this._thumbPercent=sd,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*sd,sQ.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*sd,sQ.scrollBarMinNum))}),sh(0,sd,"target",function(){return this._target},function(sd){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=sd)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),sh(0,sd,"hide",function(){return this._hide},function(sd){this._hide=sd,this.visible=!sd}),sh(0,sd,"touchScrollEnable",function(){return this._touchScrollEnable},function(sd){this._touchScrollEnable=sd,this.target=this._target}),sh(0,sd,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(sd){this._mouseWheelEnable=sd,this.target=this._target}),sh(0,sd,"tick",function(){return this.slider.tick},function(sd){this.slider.tick=sd}),sl}(sI),sS=function(sL){function sl(sd){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,sl.__super.call(this),this.skin=sd}s_(sl,"laya.ui.Slider",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._bg&&this._bg.destroy(sd),this._bar&&this._bar.destroy(sd),this._progress&&this._progress.destroy(sd),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},sd.createChildren=function(){this.addChild(this._bg=new sB),this.addChild(this._bar=new sX)},sd.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},sd.onBarMouseDown=function(sd){this._globalSacle||(this._globalSacle=new sc),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=sr.stage.mouseX,this._ty=sr.stage.mouseY,sr.stage.on("mousemove",this,this.mouseMove),sr.stage.once("mouseup",this,this.mouseUp),sr.stage.once("mouseout",this,this.mouseUp),this.showValueText()},sd.showValueText=function(){if(this.showLabel){var sd=laya.ui.Slider.label;this.addChild(sd),sd.textField.changeText(this._value+""),this.isVertical?(sd.x=this._bar.x+20,sd.y=.5*(this._bar.height-sd.height)+this._bar.y):(sd.y=this._bar.y-20,sd.x=.5*(this._bar.width-sd.width)+this._bar.x)}},sd.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},sd.mouseUp=function(sd){sr.stage.off("mousemove",this,this.mouseMove),sr.stage.off("mouseup",this,this.mouseUp),sr.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},sd.mouseMove=function(sd){var sL=this._value;this.isVertical?(this._bar.y+=(sr.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(sr.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=sr.stage.mouseX,this._ty=sr.stage.mouseY;var sl=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*sl)/sl,this._value!=sL&&this.sendChangeEvent(),this.showValueText()},sd.sendChangeEvent=function(sd){void 0===sd&&(sd="change"),this.event(sd),this.changeHandler&&this.changeHandler.runWith(this._value)},sd.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},sd.changeSize=function(){sL.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},sd.setSlider=function(sd,sL,sl){this._value=-1,this._min=sd,this._max=sd<sL?sL:sd,this.value=sl<sd?sd:sL<sl?sL:sl},sd.changeValue=function(){var sd=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*sd)/sd,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var sL=this._max-this._min;0===sL&&(sL=1),this.isVertical?(this._bar.y=(this._value-this._min)/sL*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/sL*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},sd.onBgMouseDown=function(sd){var sL=this._bg.getMousePoint();this.isVertical?this.value=sL.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=sL.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},sh(0,sd,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),sh(0,sd,"skin",function(){return this._skin},function(sd){if(this._skin!=sd){this._skin=sd,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var sL=this._skin.replace(".png","$progress.png");se.getRes(sL)&&(this._progress||(this.addChild(this._progress=new sB),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=sL),this.setBarPoint(),this.callLater(this.changeValue)}}),sh(0,sd,"allowClickBack",function(){return this._allowClickBack},function(sd){this._allowClickBack!=sd&&((this._allowClickBack=sd)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),sh(0,sd,"max",function(){return this._max},function(sd){this._max!=sd&&(this._max=sd,this.callLater(this.changeValue))}),sh(0,sd,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),sh(0,sd,"tick",function(){return this._tick},function(sd){this._tick!=sd&&(this._tick=sd,this.callLater(this.changeValue))}),sh(0,sd,"sizeGrid",function(){return this._bg.sizeGrid},function(sd){this._bg.sizeGrid=sd,this._bar.sizeGrid=sd,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),sh(0,sd,"min",function(){return this._min},function(sd){this._min!=sd&&(this._min=sd,this.callLater(this.changeValue))}),sh(0,sd,"value",function(){return this._value},function(sd){if(this._value!=sd){var sL=this._value;this._value=sd,this.changeValue(),this._value!=sL&&this.sendChangeEvent()}}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)||"string"==typeof sd?this.value=Number(sd):sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"bar",function(){return this._bar}),sZ(sl,["label",function(){return this.label=new sC}]),sl}(sI),sB=function(sL){function sl(sd){this._bitmap=null,this._skin=null,this._group=null,sl.__super.call(this),this.skin=sd}s_(sl,"laya.ui.Image",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,se.clearCache(this,this._skin)},sd.dispose=function(){this.destroy(!0),se.clearCache(this,this._skin)},sd.createChildren=function(){this.graphics=this._bitmap=new sE},sd.setSource=function(sd,sL){sd===this._skin&&sL&&(this.source=sL,this.onCompResize())},sh(0,sd,"source",function(){return this._bitmap.source},function(sd){this._bitmap&&(this._bitmap.source=sd,this.event("loaded"),this.repaint())}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"string"==typeof(this._dataSource=sd)?this.skin=sd:sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"measureHeight",function(){return this._bitmap.height}),sh(0,sd,"skin",function(){return this._skin},function(sd){if(this._skin!=sd)if(se.clearCache(this,this._skin),this._skin=sd){se.keepCache(this,this._skin);var sL=se.getRes(sd);sL?(this.source=sL,this.onCompResize()):sr.loader.load(this._skin,sq.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),sh(0,sd,"group",function(){return this._group},function(sd){sd&&this._skin&&se.setGroup(this._skin,sd),this._group=sd}),sh(0,sd,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(sd){this._bitmap.sizeGrid=sg.fillArray(sQ.defaultSizeGrid,sd,Number)}),sh(0,sd,"measureWidth",function(){return this._bitmap.width}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sI,this,"width",sd),this._bitmap.width=0==sd?1e-7:sd}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sI,this,"height",sd),this._bitmap.height=0==sd?1e-7:sd}),sl}(sI),sC=function(sL){function sl(sd){this._tf=null,sl.__super.call(this),void 0===sd&&(sd=""),sx.defaultColor=sQ.labelColor,this.text=sd}s_(sl,"laya.ui.Label",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._tf=null},sd.createChildren=function(){this.addChild(this._tf=new sA)},sd.changeText=function(sd){this._tf.changeText(sd)},sh(0,sd,"padding",function(){return this._tf.padding.join(",")},function(sd){this._tf.padding=sg.fillArray(sQ.labelPadding,sd,Number)}),sh(0,sd,"bold",function(){return this._tf.bold},function(sd){this._tf.bold=sd}),sh(0,sd,"align",function(){return this._tf.align},function(sd){this._tf.align=sd}),sh(0,sd,"text",function(){return this._tf.text},function(sd){this._tf.text!=sd&&(sd&&(sd=sg.adptString(sd+"")),this._tf.text=sd,this.event("change"),this._width&&this._height||this.onCompResize())}),sh(0,sd,"italic",function(){return this._tf.italic},function(sd){this._tf.italic=sd}),sh(0,sd,"wordWrap",function(){return this._tf.wordWrap},function(sd){this._tf.wordWrap=sd}),sh(0,sd,"font",function(){return this._tf.font},function(sd){this._tf.font=sd}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)||"string"==typeof sd?this.text=sd+"":sr.superSet(sI,this,"dataSource",sd)}),sh(0,sd,"color",function(){return this._tf.color},function(sd){this._tf.color=sd}),sh(0,sd,"valign",function(){return this._tf.valign},function(sd){this._tf.valign=sd}),sh(0,sd,"leading",function(){return this._tf.leading},function(sd){this._tf.leading=sd}),sh(0,sd,"fontSize",function(){return this._tf.fontSize},function(sd){this._tf.fontSize=sd}),sh(0,sd,"bgColor",function(){return this._tf.bgColor},function(sd){this._tf.bgColor=sd}),sh(0,sd,"borderColor",function(){return this._tf.borderColor},function(sd){this._tf.borderColor=sd}),sh(0,sd,"stroke",function(){return this._tf.stroke},function(sd){this._tf.stroke=sd}),sh(0,sd,"strokeColor",function(){return this._tf.strokeColor},function(sd){this._tf.strokeColor=sd}),sh(0,sd,"textField",function(){return this._tf}),sh(0,sd,"measureWidth",function(){return this._tf.width}),sh(0,sd,"measureHeight",function(){return this._tf.height}),sh(0,sd,"width",function(){return this._width||this._tf.text?sr.superGet(sI,this,"width"):0},function(sd){sr.superSet(sI,this,"width",sd),this._tf.width=sd}),sh(0,sd,"height",function(){return this._height||this._tf.text?sr.superGet(sI,this,"height"):0},function(sd){sr.superSet(sI,this,"height",sd),this._tf.height=sd}),sh(0,sd,"overflow",function(){return this._tf.overflow},function(sd){this._tf.overflow=sd}),sh(0,sd,"underline",function(){return this._tf.underline},function(sd){this._tf.underline=sd}),sh(0,sd,"underlineColor",function(){return this._tf.underlineColor},function(sd){this._tf.underlineColor=sd}),sl}(sI),sP=function(sL){function sl(sd){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,sl.__super.call(this),this.skin=sd}s_(sl,"laya.ui.ProgressBar",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._bg&&this._bg.destroy(sd),this._bar&&this._bar.destroy(sd),this._bg=this._bar=null,this.changeHandler=null},sd.createChildren=function(){this.addChild(this._bg=new sB),this.addChild(this._bar=new sB)},sd.changeValue=function(){if(this.sizeGrid){var sd=this.sizeGrid.split(","),sL=Number(sd[3]),sl=Number(sd[1]),sZ=(this.width-sL-sl)*this._value;this._bar.width=sL+sl+sZ,this._bar.visible=this._bar.width>sL+sl}else this._bar.width=this.width*this._value},sh(0,sd,"measureHeight",function(){return this._bg.height}),sh(0,sd,"skin",function(){return this._skin},function(sd){this._skin!=sd&&(this._skin=sd,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),sh(0,sd,"measureWidth",function(){return this._bg.width}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sI,this,"height",sd),this._bg.height=this._height,this._bar.height=this._height}),sh(0,sd,"bar",function(){return this._bar}),sh(0,sd,"value",function(){return this._value},function(sd){this._value!=sd&&(sd=1<sd?1:sd<0?0:sd,this._value=sd,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(sd))}),sh(0,sd,"bg",function(){return this._bg}),sh(0,sd,"sizeGrid",function(){return this._bg.sizeGrid},function(sd){this._bg.sizeGrid=this._bar.sizeGrid=sd}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sI,this,"width",sd),this._bg.width=this._width,this.callLater(this.changeValue)}),sh(0,sd,"dataSource",sL.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)||"string"==typeof sd?this.value=Number(sd):sr.superSet(sI,this,"dataSource",sd)}),sl}(sI),sT=(function(sd){function sl(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,sl.__super.call(this),this._tipBox=new sI,this._tipBox.addChild(this._tipText=new sA),this._tipText.x=this._tipText.y=5,this._tipText.color=sl.tipTextColor,this._defaultTipHandler=this._showDefaultTip,sr.stage.on("showtip",this,this._onStageShowTip),sr.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}s_(sl,"laya.ui.TipManager",sI);var sL=sl.prototype;sL._onStageHideTip=function(sd){sr.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},sL._onStageShowTip=function(sd){sr.timer.once(sl.tipDelay,this,this._showTip,[sd],!0)},sL._showTip=function(sd){if("string"==typeof sd){var sL=String(sd);Boolean(sL)&&this._defaultTipHandler(sL)}else sd instanceof laya.utils.Handler?sd.run():"function"==typeof sd&&sd.apply();sr.stage.on("mousemove",this,this._onStageMouseMove),sr.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},sL._onStageMouseDown=function(sd){this.closeAll()},sL._onStageMouseMove=function(sd){this._showToStage(this,sl.offsetX,sl.offsetY)},sL._showToStage=function(sd,sL,sl){void 0===sL&&(sL=0),void 0===sl&&(sl=0);var sZ=sd.getBounds();sd.x=sr.stage.mouseX+sL,sd.y=sr.stage.mouseY+sl,sd.x+sZ.width>sr.stage.width&&(sd.x-=sZ.width+sL),sd.y+sZ.height>sr.stage.height&&(sd.y-=sZ.height+sl)},sL.closeAll=function(){sr.timer.clear(this,this._showTip),sr.stage.off("mousemove",this,this._onStageMouseMove),sr.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},sL.showDislayTip=function(sd){this.addChild(sd),this._showToStage(this),sr._currentStage.addChild(this)},sL._showDefaultTip=function(sd){this._tipText.text=sd;var sL=this._tipBox.graphics;sL.clear(),sL.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,sl.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),sr._currentStage.addChild(this)},sh(0,sL,"defaultTipHandler",function(){return this._defaultTipHandler},function(sd){this._defaultTipHandler=sd}),sl.offsetX=10,sl.offsetY=15,sl.tipTextColor="#ffffff",sl.tipBackColor="#111111",sl.tipDelay=200}(),function(sd){var sY;function sc(){this._idMap=null,this._aniList=null,this._watchMap={},sc.__super.call(this)}s_(sc,"laya.ui.View",sH);var sL=sc.prototype;return sL.createView=function(sd){if(sd.animations&&!this._idMap&&(this._idMap={}),sc.createComp(sd,this,this),sd.animations){var sL,sl,sZ=[],sh=sd.animations,s_=0,sN=sh.length;for(s_=0;s_<sN;s_++){switch(sL=new st,sl=sh[s_],sL._setUp(this._idMap,sl),(this[sl.name]=sL)._setControlNode(this),sl.action){case 1:sL.play(0,!1);break;case 2:sL.play(0,!0)}sZ.push(sL)}this._aniList=sZ}0<this._width&&null==sd.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},sL.onEvent=function(sd,sL){},sL.loadUI=function(sd){var sL=sc.uiMap[sd];sL&&this.createView(sL)},sL.destroy=function(sd){void 0===sd&&(sd=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,sd)},sL.changeData=function(sd){var sL=this._watchMap[sd];if(sL){console.log("change",sd);for(var sl=0,sZ=sL.length;sl<sZ;sl++){sL[sl].exe(this)}}},sc._regs=function(){for(var sd in sc.uiClassMap)sa.regClass(sd,sc.uiClassMap[sd])},sc.createComp=function(sd,sL,sl,sZ){if(!(sL=sL||sc.getCompInstance(sd)))return console.warn("can not create:"+sd.type),null;var sh=sd.child;if(sh)for(var s_=sL instanceof laya.ui.List,sN=0,sm=sh.length;sN<sm;sN++){var su=sh[sN];if(!sL.hasOwnProperty("itemRender")||"render"!=su.props.name&&"render"!==su.props.renderType)if("Graphic"==su.type)sa.addGraphicsToSprite(su,sL);else if(sa.isDrawType(su.type))sa.addGraphicToSprite(su,sL,!0);else{if(s_){var sx=[],st=sc.createComp(su,null,sl,sx);sx.length&&(st._$bindData=sx)}else st=sc.createComp(su,null,sl,sZ);"Script"==su.type?"owner"in st?st.owner=sL:"target"in st&&(st.target=sL):"mask"==su.props.renderType||"mask"==su.props.name?sL.mask=st:st instanceof laya.display.Sprite&&sL.addChild(st)}else sL.itemRender=su}var sb=sd.props;for(var sq in sb){var sY=sb[sq];sc.eventDic[sq]?sY&&sl&&sL.on(sq,sl,sl.onEvent,[sY]):sc.setCompValue(sL,sq,sY,sl,sZ)}return sr.__typeof(sL,"laya.ui.IItem")&&sL.initItems(),sd.compId&&sl&&sl._idMap&&(sl._idMap[sd.compId]=sL),sL},sc.setCompValue=function(sd,sL,sl,sZ,sh){if("string"==typeof sl&&-1<sl.indexOf("${")){if(sc._sheet||(sc._sheet=sa.getClass("laya.data.Table")),!sc._sheet)return void console.warn("Can not find class Sheet");if(sh)sh.push(sd,sL,sl);else if(sZ){-1==sl.indexOf("].")&&(sl=sl.replace(".","[0]."));var s_,sN,sm=new sY(sd,sL,sl);sm.exe(sZ);for(var su=sl.replace(/\[.*?\]\./g,".");null!=(s_=sc._parseWatchData.exec(su));){for(var sx=s_[1];null!=(sN=sc._parseKeyWord.exec(sx));){var st=sN[0],sb=sZ._watchMap[st]||(sZ._watchMap[st]=[]);sb.push(sm),sc._sheet.I.notifer.on(st,sZ,sZ.changeData,[st])}(sb=sZ._watchMap[sx]||(sZ._watchMap[sx]=[])).push(sm),sc._sheet.I.notifer.on(sx,sZ,sZ.changeData,[sx])}}}else if("var"===sL&&sZ)sZ[sl]=sd;else if("onClick"==sL){var sq=sr._runScript("(function(){"+sl+"})");sd.on("click",sZ,sq)}else sd[sL]="true"===sl||"false"!==sl&&sl},sc.getCompInstance=function(sd){var sL,sl=sd.props?sd.props.runtime:null;return sL=sl?sc.viewClassMap[sl]||sc.uiClassMap[sl]||sr.__classmap[sl]:sc.uiClassMap[sd.type],sd.props&&sd.props.hasOwnProperty("renderType")&&"instance"==sd.props.renderType?sL.instance:sL?new sL:null},sc.regComponent=function(sd,sL){sc.uiClassMap[sd]=sL,sa.regClass(sd,sL)},sc.regViewRuntime=function(sd,sL){sc.viewClassMap[sd]=sL},sc.uiMap={},sc.viewClassMap={},sc._sheet=null,sZ(sc,["uiClassMap",function(){return this.uiClassMap={ViewStack:sdd,LinkButton:sX,TextArea:sxd,ColorPicker:sR,Box:sH,Button:sX,CheckBox:sz,Clip:sj,ComboBox:so,Component:sI,HScrollBar:sv,HSlider:sf,Image:sB,Label:sC,List:sK,Panel:sJ,ProgressBar:sP,Radio:sW,RadioGroup:smd,ScrollBar:si,Slider:sS,Tab:sud,TextInput:sld,View:sc,VScrollBar:sLd,VSlider:sZd,Tree:sM,HBox:s_d,VBox:sNd,Sprite:ss,Animation:sl,Text:sA,FontClip:sG}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),sc.__init$=function(){sc._regs(),sY=function(){function sd(sd,sL,sl){this.comp=null,this.prop=null,this.value=null,this.comp=sd,this.prop=sL,this.value=sl}return s_(sd,""),sd.prototype.exe=function(sd){var sL=sg.getBindFun(this.value);this.comp[this.prop]=sL.call(this,sd)},sd}()},sc}()),sz=function(sd){function sl(sd,sL){void 0===sL&&(sL=""),sl.__super.call(this,sd,sL)}s_(sl,"laya.ui.CheckBox",sd);var sL=sl.prototype;return sL.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},sL.initialize=function(){sd.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},sh(0,sL,"dataSource",sd.prototype._$get_dataSource,function(sd){"boolean"==typeof(this._dataSource=sd)?this.selected=sd:"string"==typeof sd?this.selected="true"===sd:sr.superSet(sX,this,"dataSource",sd)}),sl}(sX),sD=function(sd){function sL(){this._space=0,this._align="none",this._itemChanged=!1,sL.__super.call(this)}s_(sL,"laya.ui.LayoutBox",sH);var sl=sL.prototype;return sl.addChild=function(sd){return sd.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,sd)},sl.onResize=function(sd){this._setItemChanged()},sl.addChildAt=function(sd,sL){return sd.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,sd,sL)},sl.removeChild=function(sd){return sd.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,sd)},sl.removeChildAt=function(sd){return this.getChildAt(sd).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,sd)},sl.refresh=function(){this._setItemChanged()},sl.changeItems=function(){this._itemChanged=!1},sl.sortItem=function(sd){sd&&sd.sort(function(sd,sL){return sd.y-sL.y})},sl._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},sh(0,sl,"space",function(){return this._space},function(sd){this._space=sd,this._setItemChanged()}),sh(0,sl,"align",function(){return this._align},function(sd){this._align=sd,this._setItemChanged()}),sL}(),sG=function(sL){function sl(sd,sL){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,sl.__super.call(this),sd&&(this.skin=sd),sL&&(this.sheet=sL)}s_(sl,"laya.ui.FontClip",sL);var sd=sl.prototype;return sd.createChildren=function(){this._bitmap=new sE,this.on("loaded",this,this._onClipLoaded)},sd._onClipLoaded=function(){this.callLater(this.changeValue)},sd.changeValue=function(){var sd;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),sd=this._sources[0]))){var sL="horizontal"===this._direction;sL?(this._wordsW=this._valueArr.length*(sd.sourceWidth+this.spaceX),this._wordsH=sd.sourceHeight):(this._wordsW=sd.sourceWidth,this._wordsH=(sd.sourceHeight+this.spaceY)*this._valueArr.length);var sl=0;if(this._width)switch(this._align){case"center":sl=.5*(this._width-this._wordsW);break;case"right":sl=this._width-this._wordsW;break;default:sl=0}for(var sZ=0,sh=this._valueArr.length;sZ<sh;sZ++){var s_=this._indexMap[this._valueArr.charAt(sZ)];this.sources[s_]&&(sd=this.sources[s_],sL?this.graphics.drawTexture(sd,sl+sZ*(sd.sourceWidth+this.spaceX),0,sd.sourceWidth,sd.sourceHeight):this.graphics.drawTexture(sd,0+sl,sZ*(sd.sourceHeight+this.spaceY),sd.sourceWidth,sd.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},sd.destroy=function(sd){void 0===sd&&(sd=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),sL.prototype.destroy.call(this,sd)},sh(0,sd,"sheet",function(){return this._sheet},function(sd){sd+="";var sL=(this._sheet=sd).split(" ");this._clipX=String(sL[0]).length,this.clipY=sL.length,this._indexMap={};for(var sl=0;sl<this._clipY;sl++)for(var sZ=sL[sl].split(""),sh=0,s_=sZ.length;sh<s_;sh++)this._indexMap[sZ[sh]]=sl*this._clipX+sh}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sj,this,"height",sd),this.callLater(this.changeValue)}),sh(0,sd,"direction",function(){return this._direction},function(sd){this._direction=sd,this.callLater(this.changeValue)}),sh(0,sd,"value",function(){return this._valueArr?this._valueArr:""},function(sd){sd+="",this._valueArr=sd,this.callLater(this.changeValue)}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sj,this,"width",sd),this.callLater(this.changeValue)}),sh(0,sd,"spaceX",function(){return this._spaceX},function(sd){this._spaceX=sd,"horizontal"===this._direction&&this.callLater(this.changeValue)}),sh(0,sd,"spaceY",function(){return this._spaceY},function(sd){this._spaceY=sd,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),sh(0,sd,"align",function(){return this._align},function(sd){this._align=sd,this.callLater(this.changeValue)}),sh(0,sd,"measureWidth",function(){return this._wordsW}),sh(0,sd,"measureHeight",function(){return this._wordsH}),sl}(sj),sK=function(sd){function sL(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new sc,sL.__super.call(this)}s_(sL,"laya.ui.List",sd);var sl=sL.prototype;return sr.imps(sl,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),sl.destroy=function(sd){void 0===sd&&(sd=!0),this._content&&this._content.destroy(sd),this._scrollBar&&this._scrollBar.destroy(sd),laya.ui.Component.prototype.destroy.call(this,sd),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},sl.createChildren=function(){this.addChild(this._content=new sH)},sl.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=sr.superGet(sH,this,"cacheAs")),sr.superSet(sH,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},sl.onScrollEnd=function(){sr.superSet(sH,this,"cacheAs",this._$P.cacheAs)},sl._removePreScrollBar=function(){var sd=this.removeChildByName("scrollBar");sd&&sd.destroy(!0)},sl.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var sd=this._getOneCell(),sL=sd.width+this._spaceX||1,sl=sd.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/sL):Math.ceil(this._width/sL)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/sl):Math.round(this._height/sl));var sZ=this._width?this._width:sL*this.repeatX-this._spaceX,sh=this._height?this._height:sl*this.repeatY-this._spaceY;this._cellSize=this._isVertical?sl:sL,this._cellOffset=this._isVertical?sl*Math.max(this._repeatY2,this._repeatY)-sh-this._spaceY:sL*Math.max(this._repeatX2,this._repeatX)-sZ-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=sh:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=sZ),this.setContentSize(sZ,sh);var s_=this._isVertical?this.repeatX:this.repeatY,sN=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,s_,sN),this._createdLine=sN,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},sl._getOneCell=function(){if(0===this._cells.length){var sd=this.createItem();if(this._offset.setTo(sd.x,sd.y),this.cacheContent)return sd;this._cells.push(sd)}return this._cells[0]},sl._createItems=function(sd,sL,sl){var sZ=this._content,sh=this._getOneCell(),s_=sh.width+this._spaceX,sN=sh.height+this._spaceY;if(this.cacheContent){var sm=new sH;sm.cacheAsBitmap=!0,sm.pos((this._isVertical?0:sd)*s_,(this._isVertical?sd:0)*sN),this._content.addChild(sm),this._content.optimizeScrollRect=!0,sZ=sm}else{for(var su=[],sx=this._cells.length-1;-1<sx;sx--){var st=this._cells[sx];st.removeSelf(),su.push(st)}this._cells.length=0}for(var sb=sd;sb<sl;sb++)for(var sq=0;sq<sL;sq++)(sh=su&&su.length?su.pop():this.createItem()).x=(this._isVertical?sq:sb)*s_-sZ.x,sh.y=(this._isVertical?sb:sq)*sN-sZ.y,sh.name="item"+(sb*sL+sq),sZ.addChild(sh),this.addCell(sh)},sl.createItem=function(){var sd=[];if("function"==typeof this._itemRender)var sL=new this._itemRender;else sL=sT.createComp(this._itemRender,null,null,sd);if(0==sd.length&&sL._watchMap){var sl=sL._watchMap;for(var sZ in sl)for(var sh=sl[sZ],s_=0;s_<sh.length;s_++){var sN=sh[s_];sd.push(sN.comp,sN.prop,sN.value)}}return sd.length&&(sL._$bindData=sd),sL},sl.addCell=function(sd){sd.on("click",this,this.onCellMouse),sd.on("rightclick",this,this.onCellMouse),sd.on("mouseover",this,this.onCellMouse),sd.on("mouseout",this,this.onCellMouse),sd.on("mousedown",this,this.onCellMouse),sd.on("mouseup",this,this.onCellMouse),this._cells.push(sd)},sl.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var sd=0,sL=sd=0;sL<1e4;sL++){var sl=this.getChildByName("item"+sL);if(!sl)break;this.addCell(sl),sd++}this.repeatY=sd}},sl.setContentSize=function(sd,sL){this._content.width=sd,this._content.height=sL,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new sk),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,sd,sL),this._content.scrollRect=this._content.scrollRect),this.event("resize")},sl.onCellMouse=function(sd){"mousedown"===sd.type&&(this._isMoved=!1);var sL=sd.currentTarget,sl=this._startIndex+this._cells.indexOf(sL);sl<0||("click"===sd.type||"rightclick"===sd.type?this.selectEnable&&!this._isMoved?this.selectedIndex=sl:this.changeCellState(sL,!0,0):"mouseover"!==sd.type&&"mouseout"!==sd.type||this._selectedIndex===sl||this.changeCellState(sL,"mouseover"===sd.type,0),this.mouseHandler&&this.mouseHandler.runWith([sd,sl]))},sl.changeCellState=function(sd,sL,sl){var sZ=sd.getChildByName("selectBox");sZ&&(this.selectEnable=!0,sZ.visible=sL,sZ.index=sl)},sl.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},sl.onScrollBarChange=function(sd){this.runCallLater(this.changeCells);var sL=this._scrollBar.value,sl=this._isVertical?this.repeatX:this.repeatY,sZ=this._isVertical?this.repeatY:this.repeatX,sh=Math.floor(sL/this._cellSize);if(this.cacheContent)sN=sZ+1,this._createdLine-sh<sN&&(this._createItems(this._createdLine,sl,this._createdLine+sN),this.renderItems(this._createdLine*sl,0),this._createdLine+=sN);else{var s_=sh*sl,sN=0;if(s_>this._startIndex){sN=s_-this._startIndex;var sm=!0,su=this._startIndex+sl*(sZ+1);this._isMoved=!0}else s_<this._startIndex&&(sN=this._startIndex-s_,sm=!1,su=this._startIndex-1,this._isMoved=!0);for(var sx=0;sx<sN;sx++){if(sm){var st=this._cells.shift();this._cells[this._cells.length]=st;var sb=su+sx}else st=this._cells.pop(),this._cells.unshift(st),sb=su-sx;var sq=Math.floor(sb/sl)*this._cellSize;this._isVertical?st.y=sq:st.x=sq,this.renderItem(st,sb)}this._startIndex=s_,this.changeSelectStatus()}var sY=this._content.scrollRect;this._isVertical?(sY.y=sL-this._offset.y,sY.x=-this._offset.x):(sY.y=-this._offset.y,sY.x=sL-this._offset.x),this._content.scrollRect=sY},sl.posCell=function(sd,sL){if(this._scrollBar){var sl=this._isVertical?this.repeatX:this.repeatY,sZ=(this._isVertical?this.repeatY:this.repeatX,Math.floor(sL/sl)*this._cellSize);this._isVertical?sd.y=sZ:sd.x=sZ}},sl.changeSelectStatus=function(){for(var sd=0,sL=this._cells.length;sd<sL;sd++)this.changeCellState(this._cells[sd],this._selectedIndex===this._startIndex+sd,1)},sl.renderItems=function(sd,sL){void 0===sd&&(sd=0),void 0===sL&&(sL=0);for(var sl=sd,sZ=sL||this._cells.length;sl<sZ;sl++)this.renderItem(this._cells[sl],this._startIndex+sl);this.changeSelectStatus()},sl.renderItem=function(sd,sL){this._array&&0<=sL&&sL<this._array.length?(sd.visible=!0,sd._$bindData?(sd._dataSource=this._array[sL],this._bindData(sd,this._array[sL])):sd.dataSource=this._array[sL],this.cacheContent||this.posCell(sd,sL),this.hasListener("render")&&this.event("render",[sd,sL]),this.renderHandler&&this.renderHandler.runWith([sd,sL])):(sd.visible=!1,sd.dataSource=null)},sl._bindData=function(sd,sL){for(var sl=sd._$bindData,sZ=0,sh=sl.length;sZ<sh;sZ++){var s_=sl[sZ++],sN=sl[sZ++],sm=sl[sZ],su=sg.getBindFun(sm);s_[sN]=su.call(this,sL)}},sl.refresh=function(){this.array=this._array},sl.getItem=function(sd){return-1<sd&&sd<this._array.length?this._array[sd]:null},sl.changeItem=function(sd,sL){-1<sd&&sd<this._array.length&&(this._array[sd]=sL,sd>=this._startIndex&&sd<this._startIndex+this._cells.length&&this.renderItem(this.getCell(sd),sd))},sl.setItem=function(sd,sL){this.changeItem(sd,sL)},sl.addItem=function(sd){this._array.push(sd),this.array=this._array},sl.addItemAt=function(sd,sL){this._array.splice(sL,0,sd),this.array=this._array},sl.deleteItem=function(sd){this._array.splice(sd,1),this.array=this._array},sl.getCell=function(sd){return this.runCallLater(this.changeCells),-1<sd&&this._cells?this._cells[(sd-this._startIndex)%this._cells.length]:null},sl.scrollTo=function(sd){if(this._scrollBar){var sL=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(sd/sL)*this._cellSize}else this.startIndex=sd},sl.tweenTo=function(sd,sL,sl){if(void 0===sL&&(sL=200),this._scrollBar){var sZ=this._isVertical?this.repeatX:this.repeatY;s$.to(this._scrollBar,{value:Math.floor(sd/sZ)*this._cellSize},sL,null,sl,0,!0)}else this.startIndex=sd,sl&&sl.run()},sl._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},sl.commitMeasure=function(){this.runCallLater(this.changeCells)},sh(0,sl,"cacheAs",sd.prototype._$get_cacheAs,function(sd){sr.superSet(sH,this,"cacheAs",sd),this._scrollBar&&(this._$P.cacheAs=null,"none"!==sd?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),sh(0,sl,"content",function(){return this._content}),sh(0,sl,"height",sd.prototype._$get_height,function(sd){sd!=this._height&&(sr.superSet(sH,this,"height",sd),this._setCellChanged())}),sh(0,sl,"itemRender",function(){return this._itemRender},function(sd){if(this._itemRender!=sd){this._itemRender=sd;for(var sL=this._cells.length-1;-1<sL;sL--)this._cells[sL].destroy();this._cells.length=0,this._setCellChanged()}}),sh(0,sl,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(sd){this._removePreScrollBar();var sL=new sLd;sL.name="scrollBar",sL.right=0,sd&&" "!=sd&&(sL.skin=sd),this.scrollBar=sL,this.addChild(sL),this._setCellChanged()}),sh(0,sl,"page",function(){return this._page},function(sd){this._page=sd,this._array&&(this._page=0<sd?sd:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),sh(0,sl,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(sd){this._removePreScrollBar();var sL=new sv;sL.name="scrollBar",sL.bottom=0,sd&&" "!=sd&&(sL.skin=sd),this.scrollBar=sL,this.addChild(sL),this._setCellChanged()}),sh(0,sl,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(sd){this._repeatX=sd,this._setCellChanged()}),sh(0,sl,"scrollBar",function(){return this._scrollBar},function(sd){this._scrollBar!=sd&&(this._scrollBar=sd)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),sh(0,sl,"width",sd.prototype._$get_width,function(sd){sd!=this._width&&(sr.superSet(sH,this,"width",sd),this._setCellChanged())}),sh(0,sl,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(sd){this._repeatY=sd,this._setCellChanged()}),sh(0,sl,"spaceX",function(){return this._spaceX},function(sd){this._spaceX=sd,this._setCellChanged()}),sh(0,sl,"spaceY",function(){return this._spaceY},function(sd){this._spaceY=sd,this._setCellChanged()}),sh(0,sl,"selectedIndex",function(){return this._selectedIndex},function(sd){this._selectedIndex!=sd&&(this._selectedIndex=sd,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(sd),this.startIndex=this._startIndex)}),sh(0,sl,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(sd){this.selectedIndex=this._array.indexOf(sd)}),sh(0,sl,"length",function(){return this._array?this._array.length:0}),sh(0,sl,"selection",function(){return this.getCell(this._selectedIndex)},function(sd){this.selectedIndex=this._startIndex+this._cells.indexOf(sd)}),sh(0,sl,"startIndex",function(){return this._startIndex},function(sd){this._startIndex=0<sd?sd:0,this.callLater(this.renderItems)}),sh(0,sl,"array",function(){return this._array},function(sd){this.runCallLater(this.changeCells),this._array=sd||[];var sL=this._array.length;if(this.totalPage=Math.ceil(sL/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<sL?this._selectedIndex:sL-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var sl=this._isVertical?this.repeatX:this.repeatY,sZ=this._isVertical?this.repeatY:this.repeatX,sh=Math.ceil(sL/sl);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=sZ/sh,this._scrollBar.setScroll(0,(sh-sZ)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),sh(0,sl,"dataSource",sd.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)&&Math.floor(sd)==sd||"string"==typeof sd?this.selectedIndex=parseInt(sd):sd instanceof Array?this.array=sd:sr.superSet(sH,this,"dataSource",sd)}),sh(0,sl,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),sL}(sH),sv=function(sd){function sL(){sL.__super.call(this)}return s_(sL,"laya.ui.HScrollBar",sd),sL.prototype.initialize=function(){sd.prototype.initialize.call(this),this.slider.isVertical=!1},sL}(si),sJ=function(sd){function sL(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,sL.__super.call(this),this.width=this.height=100}s_(sL,"laya.ui.Panel",sd);var sl=sL.prototype;return sl.destroy=function(sd){void 0===sd&&(sd=!0),laya.ui.Component.prototype.destroy.call(this,sd),this._content&&this._content.destroy(sd),this._vScrollBar&&this._vScrollBar.destroy(sd),this._hScrollBar&&this._hScrollBar.destroy(sd),this._vScrollBar=null,this._hScrollBar=null,this._content=null},sl.destroyChildren=function(){this._content.destroyChildren()},sl.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new sH)},sl.addChild=function(sd){return sd.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(sd)},sl.onResize=function(){this._setScrollChanged()},sl.addChildAt=function(sd,sL){return sd.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(sd,sL)},sl.removeChild=function(sd){return sd.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(sd)},sl.removeChildAt=function(sd){return this.getChildAt(sd).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(sd)},sl.removeChildren=function(sd,sL){return void 0===sd&&(sd=0),void 0===sL&&(sL=2147483647),this._content.removeChildren(sd,sL),this._setScrollChanged(),this},sl.getChildAt=function(sd){return this._content.getChildAt(sd)},sl.getChildByName=function(sd){return this._content.getChildByName(sd)},sl.getChildIndex=function(sd){return this._content.getChildIndex(sd)},sl.changeScroll=function(){this._scrollChanged=!1;var sd=this.contentWidth||1,sL=this.contentHeight||1,sl=this._vScrollBar,sZ=this._hScrollBar,sh=sl&&sL>this._height,s_=sZ&&sd>this._width,sN=sh?this._width-sl.width:this._width,sm=s_?this._height-sZ.height:this._height;sl&&(sl.x=this._width-sl.width,sl.y=0,sl.height=this._height-(s_?sZ.height:0),sl.scrollSize=Math.max(.033*this._height,1),sl.thumbPercent=sm/sL,sl.setScroll(0,sL-sm,sl.value)),sZ&&(sZ.x=0,sZ.y=this._height-sZ.height,sZ.width=this._width-(sh?sl.width:0),sZ.scrollSize=Math.max(.033*this._width,1),sZ.thumbPercent=sN/sd,sZ.setScroll(0,sd-sN,sZ.value))},sl.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},sl.setContentSize=function(sd,sL){var sl=this._content;sl.width=sd,sl.height=sL,sl.scrollRect||(sl.scrollRect=new sk),sl.scrollRect.setTo(0,0,sd,sL),sl.scrollRect=sl.scrollRect},sl.onScrollBarChange=function(sd){var sL=this._content.scrollRect;if(sL){var sl=Math.round(sd.value);sd.isVertical?sL.y=sl:sL.x=sl,this._content.scrollRect=sL}},sl.scrollTo=function(sd,sL){void 0===sd&&(sd=0),void 0===sL&&(sL=0),this.vScrollBar&&(this.vScrollBar.value=sL),this.hScrollBar&&(this.hScrollBar.value=sd)},sl.refresh=function(){this.changeScroll()},sl.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=sr.superGet(sH,this,"cacheAs")),sr.superSet(sH,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},sl.onScrollEnd=function(){sr.superSet(sH,this,"cacheAs",this._$P.cacheAs)},sl._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},sh(0,sl,"numChildren",function(){return this._content.numChildren}),sh(0,sl,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(sd){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new sv),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=sd}),sh(0,sl,"contentWidth",function(){for(var sd=0,sL=this._content.numChildren-1;-1<sL;sL--){var sl=this._content.getChildAt(sL);sd=Math.max(sl.x+sl.width*sl.scaleX,sd)}return sd}),sh(0,sl,"contentHeight",function(){for(var sd=0,sL=this._content.numChildren-1;-1<sL;sL--){var sl=this._content.getChildAt(sL);sd=Math.max(sl.y+sl.height*sl.scaleY,sd)}return sd}),sh(0,sl,"width",sd.prototype._$get_width,function(sd){sr.superSet(sH,this,"width",sd),this._setScrollChanged()}),sh(0,sl,"hScrollBar",function(){return this._hScrollBar}),sh(0,sl,"content",function(){return this._content}),sh(0,sl,"height",sd.prototype._$get_height,function(sd){sr.superSet(sH,this,"height",sd),this._setScrollChanged()}),sh(0,sl,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(sd){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new sLd),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=sd}),sh(0,sl,"vScrollBar",function(){return this._vScrollBar}),sh(0,sl,"cacheAs",sd.prototype._$get_cacheAs,function(sd){sr.superSet(sH,this,"cacheAs",sd),this._$P.cacheAs=null,"none"!==sd?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),sL}(sH),sf=function(sd){function sL(sd){sL.__super.call(this,sd),this.isVertical=!1}return s_(sL,"laya.ui.HSlider",sS),sL}(),sU=function(sd){function sl(sd,sL){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,sl.__super.call(this),this.skin=sL,this.labels=sd}s_(sl,"laya.ui.UIGroup",sd);var sL=sl.prototype;return sr.imps(sL,{"laya.ui.IItem":!0}),sL.preinitialize=function(){this.mouseEnabled=!0},sL.destroy=function(sd){void 0===sd&&(sd=!0),laya.ui.Component.prototype.destroy.call(this,sd),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},sL.addItem=function(sd,sL){void 0===sL&&(sL=!0);var sl=sd,sZ=this._items.length;if(sl.name="item"+sZ,this.addChild(sl),this.initItems(),sL&&0<sZ){var sh=this._items[sZ-1];"horizontal"==this._direction?sl.x=sh.x+sh.width+this._space:sl.y=sh.y+sh.height+this._space}else sL&&(sl.x=0,sl.y=0);return sZ},sL.delItem=function(sd,sL){void 0===sL&&(sL=!0);var sl=this._items.indexOf(sd);if(-1!=sl){var sZ=sd;this.removeChild(sZ);for(var sh=sl+1,s_=this._items.length;sh<s_;sh++){var sN=this._items[sh];sN.name="item"+(sh-1),sL&&("horizontal"==this._direction?sN.x-=sZ.width+this._space:sN.y-=sZ.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var sm;sm=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=sm}}},sL.initItems=function(){this._items||(this._items=[]);for(var sd=this._items.length=0;sd<1e4;sd++){var sL=this.getChildByName("item"+sd);if(null==sL)break;this._items.push(sL),sL.selected=sd===this._selectedIndex,sL.clickHandler=sq.create(this,this.itemClick,[sd],!1)}},sL.itemClick=function(sd){this.selectedIndex=sd},sL.setSelect=function(sd,sL){this._items&&-1<sd&&sd<this._items.length&&(this._items[sd].selected=sL)},sL.createItem=function(sd,sL){return null},sL.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var sd=0,sL=0,sl=this._items.length;sL<sl;sL++){var sZ=this._items[sL];this._skin&&(sZ.skin=this._skin),this._labelColors&&(sZ.labelColors=this._labelColors),this._labelSize&&(sZ.labelSize=this._labelSize),this._labelStroke&&(sZ.labelStroke=this._labelStroke),this._labelStrokeColor&&(sZ.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(sZ.strokeColors=this._strokeColors),this._labelBold&&(sZ.labelBold=this._labelBold),this._labelPadding&&(sZ.labelPadding=this._labelPadding),this._labelAlign&&(sZ.labelAlign=this._labelAlign),this._stateNum&&(sZ.stateNum=this._stateNum),this._labelFont&&(sZ.labelFont=this._labelFont),"horizontal"===this._direction?(sZ.y=0,sZ.x=sd,sd+=sZ.width+this._space):(sZ.x=0,sZ.y=sd,sd+=sZ.height+this._space)}this.changeSize()},sL.commitMeasure=function(){this.runCallLater(this.changeLabels)},sL._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},sh(0,sL,"labelStrokeColor",function(){return this._labelStrokeColor},function(sd){this._labelStrokeColor!=sd&&(this._labelStrokeColor=sd,this._setLabelChanged())}),sh(0,sL,"skin",function(){return this._skin},function(sd){this._skin!=sd&&(this._skin=sd,this._setLabelChanged())}),sh(0,sL,"selectedIndex",function(){return this._selectedIndex},function(sd){this._selectedIndex!=sd&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=sd,this.setSelect(sd,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),sh(0,sL,"labels",function(){return this._labels},function(sd){if(this._labels!=sd){if(this._labels=sd,this.removeChildren(),this._setLabelChanged(),this._labels)for(var sL=this._labels.split(","),sl=0,sZ=sL.length;sl<sZ;sl++){var sh=this.createItem(this._skin,sL[sl]);sh.name="item"+sl,this.addChild(sh)}this.initItems()}}),sh(0,sL,"strokeColors",function(){return this._strokeColors},function(sd){this._strokeColors!=sd&&(this._strokeColors=sd,this._setLabelChanged())}),sh(0,sL,"labelColors",function(){return this._labelColors},function(sd){this._labelColors!=sd&&(this._labelColors=sd,this._setLabelChanged())}),sh(0,sL,"labelStroke",function(){return this._labelStroke},function(sd){this._labelStroke!=sd&&(this._labelStroke=sd,this._setLabelChanged())}),sh(0,sL,"labelSize",function(){return this._labelSize},function(sd){this._labelSize!=sd&&(this._labelSize=sd,this._setLabelChanged())}),sh(0,sL,"stateNum",function(){return this._stateNum},function(sd){this._stateNum!=sd&&(this._stateNum=sd,this._setLabelChanged())}),sh(0,sL,"labelBold",function(){return this._labelBold},function(sd){this._labelBold!=sd&&(this._labelBold=sd,this._setLabelChanged())}),sh(0,sL,"labelFont",function(){return this._labelFont},function(sd){this._labelFont!=sd&&(this._labelFont=sd,this._setLabelChanged())}),sh(0,sL,"labelPadding",function(){return this._labelPadding},function(sd){this._labelPadding!=sd&&(this._labelPadding=sd,this._setLabelChanged())}),sh(0,sL,"direction",function(){return this._direction},function(sd){this._direction=sd,this._setLabelChanged()}),sh(0,sL,"space",function(){return this._space},function(sd){this._space=sd,this._setLabelChanged()}),sh(0,sL,"items",function(){return this._items}),sh(0,sL,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(sd){this.selectedIndex=this._items.indexOf(sd)}),sh(0,sL,"dataSource",sd.prototype._$get_dataSource,function(sd){"number"==typeof(this._dataSource=sd)&&Math.floor(sd)==sd||"string"==typeof sd?this.selectedIndex=parseInt(sd):sd instanceof Array?this.labels=sd.join(","):sr.superSet(sH,this,"dataSource",sd)}),sl}(sH),sW=function(sL){function sl(sd,sL){this._value=null,void 0===sL&&(sL=""),sl.__super.call(this,sd,sL)}s_(sl,"laya.ui.Radio",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._value=null},sd.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},sd.initialize=function(){sL.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},sd.onClick=function(sd){this.selected=!0},sh(0,sd,"value",function(){return null!=this._value?this._value:this.label},function(sd){this._value=sd}),sl}(sX),sM=function(sd){function sL(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,sL.__super.call(this),this.width=this.height=200}s_(sL,"laya.ui.Tree",sd);var sl=sL.prototype;return sr.imps(sl,{"laya.ui.IRender":!0}),sl.destroy=function(sd){void 0===sd&&(sd=!0),laya.ui.Component.prototype.destroy.call(this,sd),this._list&&this._list.destroy(sd),this._list=null,this._source=null,this._renderHandler=null},sl.createChildren=function(){this.addChild(this._list=new sK),this._list.renderHandler=sq.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},sl.onListChange=function(sd){this.event("change")},sl.getArray=function(){var sd,sL=[];for(var sl in this._source)sd=this._source[sl],this.getParentOpenStatus(sd)&&(sd.x=this._spaceLeft*this.getDepth(sd),sL.push(sd));return sL},sl.getDepth=function(sd,sL){return void 0===sL&&(sL=0),null==sd.nodeParent?sL:this.getDepth(sd.nodeParent,sL+1)},sl.getParentOpenStatus=function(sd){var sL=sd.nodeParent;return null==sL||!!sL.isOpen&&(null==sL.nodeParent||this.getParentOpenStatus(sL))},sl.renderItem=function(sd,sL){var sl=sd.dataSource;if(sl){sd.left=sl.x;var sZ=sd.getChildByName("arrow");sZ&&(sl.hasChild?(sZ.visible=!0,sZ.index=sl.isOpen?1:0,sZ.tag=sL,sZ.off("click",this,this.onArrowClick),sZ.on("click",this,this.onArrowClick)):sZ.visible=!1);var sh=sd.getChildByName("folder");sh&&(2==sh.clipY?sh.index=sl.isDirectory?0:1:sh.index=sl.isDirectory?sl.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([sd,sL])}},sl.onArrowClick=function(sd){var sL=sd.currentTarget.tag;this._list.array[sL].isOpen=!this._list.array[sL].isOpen,this.event("open"),this._list.array=this.getArray()},sl.setItemState=function(sd,sL){this._list.array[sd]&&(this._list.array[sd].isOpen=sL,this._list.array=this.getArray())},sl.fresh=function(){this._list.array=this.getArray(),this.repaint()},sl.parseXml=function(sd,sL,sl,sZ){var sh,s_=sd.childNodes,sN=s_.length;if(!sZ){sh={};var sm,su=sd.attributes;for(var sx in su){var st=(sm=su[sx]).nodeName,sb=sm.nodeValue;sh[st]="true"==sb||"false"!=sb&&sb}sh.nodeParent=sl,0<sN&&(sh.isDirectory=!0),sh.hasChild=0<sN,sL.push(sh)}for(var sq=0;sq<sN;sq++){var sY=s_[sq];this.parseXml(sY,sL,sh,!1)}},sl.parseOpenStatus=function(sd,sL){for(var sl=0,sZ=sL.length;sl<sZ;sl++){var sh=sL[sl];if(sh.isDirectory)for(var s_=0,sN=sd.length;s_<sN;s_++){var sm=sd[s_];if(sm.isDirectory&&this.isSameParent(sm,sh)&&sh.label==sm.label){sh.isOpen=sm.isOpen;break}}}},sl.isSameParent=function(sd,sL){return null==sd.nodeParent&&null==sL.nodeParent||null!=sd.nodeParent&&null!=sL.nodeParent&&(sd.nodeParent.label==sL.nodeParent.label&&this.isSameParent(sd.nodeParent,sL.nodeParent))},sl.filter=function(sd){if(Boolean(sd)){var sL=[];this.getFilterSource(this._source,sL,sd),this._list.array=sL}else this._list.array=this.getArray()},sl.getFilterSource=function(sd,sL,sl){var sZ;for(var sh in sl=sl.toLocaleLowerCase(),sd)!(sZ=sd[sh]).isDirectory&&-1<String(sZ.label).toLowerCase().indexOf(sl)&&(sZ.x=0,sL.push(sZ)),sZ.child&&0<sZ.child.length&&this.getFilterSource(sZ.child,sL,sl)},sh(0,sl,"spaceBottom",function(){return this._list.spaceY},function(sd){this._list.spaceY=sd}),sh(0,sl,"keepStatus",function(){return this._keepStatus},function(sd){this._keepStatus=sd}),sh(0,sl,"itemRender",function(){return this._list.itemRender},function(sd){this._list.itemRender=sd}),sh(0,sl,"array",function(){return this._list.array},function(sd){this._keepStatus&&this._list.array&&sd&&this.parseOpenStatus(this._list.array,sd),this._source=sd,this._list.array=this.getArray()}),sh(0,sl,"mouseHandler",function(){return this._list.mouseHandler},function(sd){this._list.mouseHandler=sd}),sh(0,sl,"dataSource",sd.prototype._$get_dataSource,function(sd){this._dataSource=sd,sr.superSet(sH,this,"dataSource",sd)}),sh(0,sl,"source",function(){return this._source}),sh(0,sl,"scrollBar",function(){return this._list.scrollBar}),sh(0,sl,"list",function(){return this._list}),sh(0,sl,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(sd){this._list.vScrollBarSkin=sd}),sh(0,sl,"renderHandler",function(){return this._renderHandler},function(sd){this._renderHandler=sd}),sh(0,sl,"selectedIndex",function(){return this._list.selectedIndex},function(sd){this._list.selectedIndex=sd}),sh(0,sl,"spaceLeft",function(){return this._spaceLeft},function(sd){this._spaceLeft=sd}),sh(0,sl,"selectedItem",function(){return this._list.selectedItem},function(sd){this._list.selectedItem=sd}),sh(0,sl,"width",sd.prototype._$get_width,function(sd){sr.superSet(sH,this,"width",sd),this._list.width=sd}),sh(0,sl,"height",sd.prototype._$get_height,function(sd){sr.superSet(sH,this,"height",sd),this._list.height=sd}),sh(0,sl,"xml",null,function(sd){var sL=[];this.parseXml(sd.childNodes[0],sL,null,!0),this.array=sL}),sh(0,sl,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),sL}(sH),sdd=function(sd){function sL(){this._items=null,this._selectedIndex=0,sL.__super.call(this),this._setIndexHandler=sq.create(this,this.setIndex,null,!1)}s_(sL,"laya.ui.ViewStack",sd);var sl=sL.prototype;return sr.imps(sl,{"laya.ui.IItem":!0}),sl.setItems=function(sd){this.removeChildren();for(var sL=0,sl=0,sZ=sd.length;sl<sZ;sl++){var sh=sd[sl];sh&&(sh.name="item"+sL,this.addChild(sh),sL++)}this.initItems()},sl.addItem=function(sd){sd.name="item"+this._items.length,this.addChild(sd),this.initItems()},sl.initItems=function(){this._items=[];for(var sd=0;sd<1e4;sd++){var sL=this.getChildByName("item"+sd);if(null==sL)break;this._items.push(sL),sL.visible=sd==this._selectedIndex}},sl.setSelect=function(sd,sL){this._items&&-1<sd&&sd<this._items.length&&(this._items[sd].visible=sL)},sl.setIndex=function(sd){this.selectedIndex=sd},sh(0,sl,"dataSource",sd.prototype._$get_dataSource,function(sd){if("number"==typeof(this._dataSource=sd)&&Math.floor(sd)==sd||"string"==typeof sd)this.selectedIndex=parseInt(sd);else for(var sL in this._dataSource)this.hasOwnProperty(sL)&&(this[sL]=this._dataSource[sL])}),sh(0,sl,"selectedIndex",function(){return this._selectedIndex},function(sd){this._selectedIndex!=sd&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=sd,this.setSelect(this._selectedIndex,!0))}),sh(0,sl,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(sd){this.selectedIndex=this._items.indexOf(sd)}),sh(0,sl,"items",function(){return this._items}),sh(0,sl,"setIndexHandler",function(){return this._setIndexHandler},function(sd){this._setIndexHandler=sd}),sL}(sH),sLd=function(sd){function sL(){sL.__super.call(this)}return s_(sL,"laya.ui.VScrollBar",si),sL}(),sld=function(sL){function sl(sd){this._bg=null,this._skin=null,sl.__super.call(this),void 0===sd&&(sd=""),this.text=sd,this.skin=this.skin}s_(sl,"laya.ui.TextInput",sL);var sd=sl.prototype;return sd.preinitialize=function(){this.mouseEnabled=!0},sd.destroy=function(sd){se.clearCache(this,this._skin),void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._bg&&this._bg.destroy(),this._bg=null},sd.createChildren=function(){this.addChild(this._tf=new sY),this._tf.padding=sQ.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},sd._onFocus=function(){this.event("focus",this)},sd._onBlur=function(){this.event("blur",this)},sd._onInput=function(){this.event("input",this)},sd._onEnter=function(){this.event("enter",this)},sd.initialize=function(){this.width=128,this.height=22},sd.select=function(){this._tf.select()},sd.setSelection=function(sd,sL){this._tf.setSelection(sd,sL)},sh(0,sd,"text",sL.prototype._$get_text,function(sd){this._tf.text!=sd&&(sd+="",this._tf.text=sd,this.event("change"))}),sh(0,sd,"bg",function(){return this._bg},function(sd){this.graphics=this._bg=sd}),sh(0,sd,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(sd){this._tf.inputElementYAdjuster=sd}),sh(0,sd,"multiline",function(){return this._tf.multiline},function(sd){this._tf.multiline=sd}),sh(0,sd,"skin",function(){return this._skin},function(sd){this._skin!=sd&&(se.clearCache(this,this._skin),this._skin=sd,this._bg||(this.graphics=this._bg=new sE),se.keepCache(this,this._skin),this._bg.source=se.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),sh(0,sd,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(sd){this._bg||(this.graphics=this._bg=new sE),this._bg.sizeGrid=sg.fillArray(sQ.defaultSizeGrid,sd,Number)}),sh(0,sd,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(sd){this._tf.inputElementXAdjuster=sd}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sC,this,"width",sd),this._bg&&(this._bg.width=sd)}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sC,this,"height",sd),this._bg&&(this._bg.height=sd)}),sh(0,sd,"editable",function(){return this._tf.editable},function(sd){this._tf.editable=sd}),sh(0,sd,"restrict",function(){return this._tf.restrict},function(sd){this._tf.restrict=sd}),sh(0,sd,"prompt",function(){return this._tf.prompt},function(sd){this._tf.prompt=sd}),sh(0,sd,"promptColor",function(){return this._tf.promptColor},function(sd){this._tf.promptColor=sd}),sh(0,sd,"maxChars",function(){return this._tf.maxChars},function(sd){this._tf.maxChars=sd}),sh(0,sd,"focus",function(){return this._tf.focus},function(sd){this._tf.focus=sd}),sh(0,sd,"type",function(){return this._tf.type},function(sd){this._tf.type=sd}),sh(0,sd,"asPassword",function(){return this._tf.asPassword},function(sd){this._tf.asPassword=sd}),sl}(sC),sZd=function(sd){function sL(){sL.__super.call(this)}return s_(sL,"laya.ui.VSlider",sS),sL}(),shd=function(sd){function sZ(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,sZ.__super.call(this)}s_(sZ,"laya.ui.Dialog",sd);var sL=sZ.prototype;return sL.initialize=function(){this.popupEffect=sZ.manager.popupEffectHandler,this.closeEffect=sZ.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},sL._dealDragArea=function(){var sd=this.getChildByName("drag");sd&&(this.dragArea=sd.x+","+sd.y+","+sd.width+","+sd.height,sd.removeSelf())},sL._onClick=function(sd){var sL=sd.target;if(sL)switch(sL.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(sL.name)}},sL.show=function(sd,sL){void 0===sd&&(sd=!1),void 0===sL&&(sL=!0),this._open(!1,sd,sL)},sL.popup=function(sd,sL){void 0===sd&&(sd=!1),void 0===sL&&(sL=!0),this._open(!0,sd,sL)},sL._open=function(sd,sL,sl){sZ.manager.lock(!1),this.isModal=sd,sZ.manager.open(this,sL,sl)},sL.onOpened=function(){},sL.close=function(sd,sL){void 0===sL&&(sL=!0),sZ.manager.close(this,sd,sL)},sL.onClosed=function(sd){},sL._onMouseDown=function(sd){var sL=this.getMousePoint();this._dragArea.contains(sL.x,sL.y)?this.startDrag():this.stopDrag()},sh(0,sL,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(sd){if(sd){var sL=sg.fillArray([0,0,0,0],sd,Number);this._dragArea=new sk(sL[0],sL[1],sL[2],sL[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),sh(0,sL,"isPopup",function(){return null!=this.parent}),sh(0,sL,"zOrder",sd.prototype._$get_zOrder,function(sd){sr.superSet(sT,this,"zOrder",sd),sZ.manager._checkMask()}),sh(1,sZ,"manager",function(){return sZ._manager=sZ._manager||new sp},function(sd){sZ._manager=sd}),sZ.setLockView=function(sd){sZ.manager.setLockView(sd)},sZ.lock=function(sd){sZ.manager.lock(sd)},sZ.closeAll=function(){sZ.manager.closeAll()},sZ.getDialogsByGroup=function(sd){return sZ.manager.getDialogsByGroup(sd)},sZ.closeByGroup=function(sd){return sZ.manager.closeByGroup(sd)},sZ.CLOSE="close",sZ.CANCEL="cancel",sZ.SURE="sure",sZ.NO="no",sZ.OK="ok",sZ.YES="yes",sZ._manager=null,sZ}(sT),s_d=function(sd){function sL(){sL.__super.call(this)}s_(sL,"laya.ui.HBox",sd);var sl=sL.prototype;return sl.sortItem=function(sd){sd&&sd.sort(function(sd,sL){return sd.x-sL.x})},sl.changeItems=function(){this._itemChanged=!1;for(var sd=[],sL=0,sl=0,sZ=this.numChildren;sl<sZ;sl++){var sh=this.getChildAt(sl);sh&&sh.layoutEnabled&&(sd.push(sh),sL=this._height?this._height:Math.max(sL,sh.height*sh.scaleY))}this.sortItem(sd);var s_=0;for(sl=0,sZ=sd.length;sl<sZ;sl++)(sh=sd[sl]).x=s_,s_+=sh.width*sh.scaleX+this._space,"top"==this._align?sh.y=0:"middle"==this._align?sh.y=.5*(sL-sh.height*sh.scaleY):"bottom"==this._align&&(sh.y=sL-sh.height*sh.scaleY);this.changeSize()},sh(0,sl,"height",sd.prototype._$get_height,function(sd){this._height!=sd&&(sr.superSet(sD,this,"height",sd),this.callLater(this.changeItems))}),sL.NONE="none",sL.TOP="top",sL.MIDDLE="middle",sL.BOTTOM="bottom",sL}(sD),sNd=function(sd){function sL(){sL.__super.call(this)}s_(sL,"laya.ui.VBox",sd);var sl=sL.prototype;return sl.changeItems=function(){this._itemChanged=!1;for(var sd=[],sL=0,sl=0,sZ=this.numChildren;sl<sZ;sl++){var sh=this.getChildAt(sl);sh&&sh.layoutEnabled&&(sd.push(sh),sL=this._width?this._width:Math.max(sL,sh.width*sh.scaleX))}this.sortItem(sd);var s_=0;for(sl=0,sZ=sd.length;sl<sZ;sl++)(sh=sd[sl]).y=s_,s_+=sh.height*sh.scaleY+this._space,"left"==this._align?sh.x=0:"center"==this._align?sh.x=.5*(sL-sh.width*sh.scaleX):"right"==this._align&&(sh.x=sL-sh.width*sh.scaleX);this.changeSize()},sh(0,sl,"width",sd.prototype._$get_width,function(sd){this._width!=sd&&(sr.superSet(sD,this,"width",sd),this.callLater(this.changeItems))}),sL.NONE="none",sL.LEFT="left",sL.CENTER="center",sL.RIGHT="right",sL}(sD),smd=function(sd){function sL(){sL.__super.call(this)}return s_(sL,"laya.ui.RadioGroup",sU),sL.prototype.createItem=function(sd,sL){return new sW(sd,sL)},sL}(),sud=function(sd){function sL(){sL.__super.call(this)}return s_(sL,"laya.ui.Tab",sU),sL.prototype.createItem=function(sd,sL){return new sX(sd,sL)},sL}(),sxd=function(sL){function sl(sd){this._vScrollBar=null,this._hScrollBar=null,void 0===sd&&(sd=""),sl.__super.call(this,sd)}s_(sl,"laya.ui.TextArea",sL);var sd=sl.prototype;return sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},sd.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},sd.onVBarChanged=function(sd){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},sd.onHBarChanged=function(sd){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},sd.changeScroll=function(){var sd=this._vScrollBar&&0<this._tf.maxScrollY,sL=this._hScrollBar&&0<this._tf.maxScrollX,sl=sd?this._width-this._vScrollBar.width:this._width,sZ=sL?this._height-this._hScrollBar.height:this._height,sh=this._tf.padding||sQ.labelPadding;this._tf.width=sl,this._tf.height=sZ,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-sh[2],this._vScrollBar.y=sh[1],this._vScrollBar.height=this._height-(sL?this._hScrollBar.height:0)-sh[1]-sh[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=sZ/Math.max(this._tf.textHeight,sZ),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=sd),this._hScrollBar&&(this._hScrollBar.x=sh[0],this._hScrollBar.y=this._height-this._hScrollBar.height-sh[3],this._hScrollBar.width=this._width-(sd?this._vScrollBar.width:0)-sh[0]-sh[2],this._hScrollBar.scrollSize=Math.max(.033*sl,1),this._hScrollBar.thumbPercent=sl/Math.max(this._tf.textWidth,sl),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=sL)},sd.scrollTo=function(sd){this.commitMeasure(),this._tf.scrollY=sd},sh(0,sd,"scrollY",function(){return this._tf.scrollY}),sh(0,sd,"width",sL.prototype._$get_width,function(sd){sr.superSet(sld,this,"width",sd),this.callLater(this.changeScroll)}),sh(0,sd,"hScrollBar",function(){return this._hScrollBar}),sh(0,sd,"height",sL.prototype._$get_height,function(sd){sr.superSet(sld,this,"height",sd),this.callLater(this.changeScroll)}),sh(0,sd,"maxScrollX",function(){return this._tf.maxScrollX}),sh(0,sd,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(sd){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new sLd),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=sd}),sh(0,sd,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(sd){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new sv),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=sd}),sh(0,sd,"vScrollBar",function(){return this._vScrollBar}),sh(0,sd,"maxScrollY",function(){return this._tf.maxScrollY}),sh(0,sd,"scrollX",function(){return this._tf.scrollX}),sl}(sld);!function(sd){function sL(){this._uiView=null,this.isCloseOther=!1,sL.__super.call(this)}s_(sL,"laya.ui.AsynDialog",shd);var sl=sL.prototype;sl.createView=function(sd){this._uiView=sd},sl._open=function(sd,sL,sl){this.isModal=sd,this.isCloseOther=sL,shd.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},sl.onCreated=function(){this.createUI(),this.onOpen()},sl.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},sl.onOpen=function(){shd.manager.open(this,this.isCloseOther),shd.manager.lock(!1)},sl.close=function(sd,sL){void 0===sL&&(sL=!0),shd.manager.close(this),this.onClose()},sl.onClose=function(){},sl.destroy=function(sd){void 0===sd&&(sd=!0),laya.ui.View.prototype.destroy.call(this,sd),this._uiView=null,this.onDestroy()},sl.onDestroy=function(){}}();sr.__init([sT])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(sd,sL){"use strict";for(var sl in Object.defineProperty(sL,"__esModule",{value:!0}),Laya){var sZ=Laya[sl];sZ&&sZ.__isclass&&(sL[sl]=sZ)}}),function(sq,sd,sA){sA.un,sA.uns;var sb=sA.static,sY=sA.class,sc=sA.getset,sZ=sA.__newvec,ss=laya.maths.Arith,sN=laya.webgl.atlas.AtlasResourceManager,sl=laya.webgl.shader.BaseShader,sI=laya.utils.Browser,sm=laya.webgl.utils.Buffer,sy=laya.utils.Byte,sh=laya.utils.ClassUtils,su=sA.Config,s_=(laya.events.Event,laya.events.EventDispatcher),sQ=laya.utils.Handler,sk=laya.net.Loader,sL=laya.net.LoaderManager,sx=(laya.maths.MathUtil,laya.display.Node),sr=laya.renders.Render,st=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),sa=laya.resource.Resource,se=laya.utils.RunDriver,sw=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),s$=laya.display.Sprite,sO=laya.utils.Stat,sn=laya.utils.StringKey,sg=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),sV=laya.utils.Utils,sF=laya.webgl.WebGL,sE=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;sA.interface("laya.d3.core.IClone"),sA.interface("laya.d3.graphics.IVertex"),sA.interface("laya.d3.core.render.IUpdate"),sA.interface("laya.d3.core.scene.ITreeNode"),sA.interface("laya.d3.core.render.IRenderable");(function(){function sX(){}sY(sX,"laya.d3.animation.AnimationClipParser01"),sX.READ_DATA=function(){sX._DATA.offset=sX._reader.getUint32(),sX._DATA.size=sX._reader.getUint32()},sX.READ_BLOCK=function(){for(var sd=sX._BLOCK.count=sX._reader.getUint16(),sL=sX._BLOCK.blockStarts=[],sl=sX._BLOCK.blockLengths=[],sZ=0;sZ<sd;sZ++)sL.push(sX._reader.getUint32()),sl.push(sX._reader.getUint32())},sX.READ_STRINGS=function(){var sd=sX._reader.getUint32(),sL=sX._reader.getUint16(),sl=sX._reader.pos;sX._reader.pos=sd+sX._DATA.offset;for(var sZ=0;sZ<sL;sZ++)sX._strings[sZ]=sX._reader.readUTFString();sX._reader.pos=sl},sX.parse=function(sd,sL){sX._animationClip=sd;(sX._reader=sL).__getBuffer();sX.READ_DATA(),sX.READ_BLOCK(),sX.READ_STRINGS();for(var sl=0,sZ=sX._BLOCK.count;sl<sZ;sl++){var sh=sL.getUint16(),s_=sX._strings[sh],sN=sX["READ_"+s_];if(null==sN)throw new Error("model file err,no this function:"+sh+" "+s_);sN.call()}},sX.READ_ANIMATIONS=function(){var sd,sL=0,sl=0,sZ=sX._reader,sh=sZ.__getBuffer(),s_=[],sN=sZ.getUint8();for(s_.length=sN,sL=0;sL<sN;sL++)s_[sL]=sZ.getUint16();var sm=[],su=sZ.getUint16();for(sm.length=su,sL=0;sL<su;sL++)sm[sL]=sZ.getFloat32();var sx=sX._animationClip;sx.name=sX._strings[sZ.getUint16()];var st=sx._duration=sZ.getFloat32();sx.islooping=!!sZ.getByte(),sx._frameRate=sZ.getInt16();var sb=sZ.getInt16(),sq=sx._nodes=new Array;sq.length=sb,(sx._publicClipDatas=[]).length=sb;var sY=sx._nodesMap={},sc=0,sr=0;for(sL=0;sL<sb;sL++){sd=sq[sL]=new sP;var sa=sZ.getUint16(),sk=sd.path=[];for(sk.length=sa,sl=0;sl<sa;sl++)sk[sl]=sX._strings[sZ.getUint16()];var se=sk.join("/"),sw=sY[se];sw||(sY[se]=sw=[]),sw.push(sd);var ss=sZ.getInt16();-1!==ss&&(sd.componentType=sX._strings[ss]);var sA=sB._propertyIndexDic[sX._strings[sZ.getUint16()]];if(null==sA)throw new Error("AnimationClipParser01:unknown property name.");var sy=sA<4,s$=!sy||sy&&""===sk[0];(sd._cacheProperty=s$)?sc++:sr++,sd.propertyNameID=sA;var sO=s_[sZ.getUint8()];sd.keyFrameWidth=sO/4;var sn=sd.keyFrames=[],sV=sn.length=sZ.getUint16(),sQ=null,sg=NaN;for(sl=0;sl<sV;sl++){var sF=sn[sl]=new sC;sg=sF.startTime=sm[sZ.getUint16()];var sE=sZ.pos;sF.inTangent=new Float32Array(sh.slice(sE,sE+sO)),sZ.pos+=sO,sE=sZ.pos,sF.outTangent=new Float32Array(sh.slice(sE,sE+sO)),sZ.pos+=sO,sE=sZ.pos,sF.data=new Float32Array(sh.slice(sE,sE+sO)),sZ.pos+=sO,sQ&&(sQ.next=sF,sQ.duration=sg-sQ.startTime),sQ=sF}sF.next=null,sF.duration=st-sg}var sI=sx._nodeToCachePropertyMap=new Int32Array(sb),sp=sx._cachePropertyMap=new Int32Array(sc),sH=sx._unCachePropertyMap=new Int32Array(sr);for(sc=sr=0,sL=0;sL<sb;sL++)(sd=sq[sL])._cacheProperty?(sI[sL]=sc,sp[sc++]=sL):sH[sr++]=sL},sX._animationClip=null,sX._reader=null,sX._strings=[],sb(sX,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function si(){}sY(si,"laya.d3.animation.AnimationClipParser02"),si.READ_DATA=function(){si._DATA.offset=si._reader.getUint32(),si._DATA.size=si._reader.getUint32()},si.READ_BLOCK=function(){for(var sd=si._BLOCK.count=si._reader.getUint16(),sL=si._BLOCK.blockStarts=[],sl=si._BLOCK.blockLengths=[],sZ=0;sZ<sd;sZ++)sL.push(si._reader.getUint32()),sl.push(si._reader.getUint32())},si.READ_STRINGS=function(){var sd=si._reader.getUint32(),sL=si._reader.getUint16(),sl=si._reader.pos;si._reader.pos=sd+si._DATA.offset;for(var sZ=0;sZ<sL;sZ++)si._strings[sZ]=si._reader.readUTFString();si._reader.pos=sl},si.parse=function(sd,sL){si._animationClip=sd;(si._reader=sL).__getBuffer();si.READ_DATA(),si.READ_BLOCK(),si.READ_STRINGS();for(var sl=0,sZ=si._BLOCK.count;sl<sZ;sl++){var sh=sL.getUint16(),s_=si._strings[sh],sN=si["READ_"+s_];if(null==sN)throw new Error("model file err,no this function:"+sh+" "+s_);sN.call()}},si.READ_ANIMATIONS=function(){var sd,sL=0,sl=0,sZ=si._reader,sh=sZ.__getBuffer(),s_=[],sN=sZ.getUint8();for(s_.length=sN,sL=0;sL<sN;sL++)s_[sL]=sZ.getUint16();var sm=[],su=sZ.getUint16();for(sm.length=su,sL=0;sL<su;sL++)sm[sL]=sZ.getFloat32();var sx=si._animationClip;sx.name=si._strings[sZ.getUint16()];var st=sx._duration=sZ.getFloat32();sx.islooping=!!sZ.getByte(),sx._frameRate=sZ.getInt16();var sb=sZ.getInt16(),sq=sx._nodes=new Array;sq.length=sb,(sx._publicClipDatas=[]).length=sb;var sY=sx._nodesMap={},sc=0,sr=0;for(sL=0;sL<sb;sL++){sd=sq[sL]=new sP;var sa=sZ.getUint16(),sk=sd.path=[];for(sk.length=sa,sl=0;sl<sa;sl++)sk[sl]=si._strings[sZ.getUint16()];var se=sk.join("/"),sw=sY[se];sw||(sY[se]=sw=[]),sw.push(sd);var ss=sZ.getInt16();-1!==ss&&(sd.componentType=si._strings[ss]);var sA=sB._propertyIndexDic[si._strings[sZ.getUint16()]];if(null==sA)throw new Error("AnimationClipParser02:unknown property name.");var sy=sA<4,s$=!sy||sy&&""===sk[0];(sd._cacheProperty=s$)?sc++:sr++,sd.propertyNameID=sA;var sO=s_[sZ.getUint8()];sd.keyFrameWidth=sO/4;var sn=sd.keyFrames=[],sV=sn.length=sZ.getUint16(),sQ=null,sg=NaN;for(sl=0;sl<sV;sl++){var sF=sn[sl]=new sC;sg=sF.startTime=sm[sZ.getUint16()];var sE=sZ.pos;sF.inTangent=new Float32Array(sh.slice(sE,sE+sO)),sZ.pos+=sO,sE=sZ.pos,sF.outTangent=new Float32Array(sh.slice(sE,sE+sO)),sZ.pos+=sO,sE=sZ.pos,sF.data=new Float32Array(sh.slice(sE,sE+sO)),sZ.pos+=sO,sQ&&(sQ.next=sF,sQ.duration=sg-sQ.startTime),sQ=sF}sF.next=null,sF.duration=st-sg}var sI=sZ.getUint16();for(sL=0;sL<sI;sL++){var sp,sH=new sS;sH.time=sZ.getFloat32(),sH.eventName=si._strings[sZ.getUint16()];var sX=sZ.getUint16();for(0<sX&&(sH.params=sp=[]),sl=0;sl<sX;sl++){switch(sZ.getByte()){case 0:sp.push(!!sZ.getByte());break;case 1:sp.push(sZ.getInt32());break;case 2:sp.push(sZ.getFloat32());break;case 3:sp.push(si._strings[sZ.getUint16()]);break;default:throw new Error("unknown type.")}}sx.addEvent(sH)}var sj=sx._nodeToCachePropertyMap=new Int32Array(sb),sR=sx._cachePropertyMap=new Int32Array(sc),so=sx._unCachePropertyMap=new Int32Array(sr);for(sc=sr=0,sL=0;sL<sb;sL++)(sd=sq[sL])._cacheProperty?(sj[sL]=sc,sR[sc++]=sL):so[sr++]=sL},si._animationClip=null,si._reader=null,si._strings=[],sb(si,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var sS=function(){function sd(){this.time=NaN,this.eventName=null,this.params=null}return sY(sd,"laya.d3.animation.AnimationEvent"),sd}(),sB=function(){function sZ(){this._childs=[],this.transform=new seL(this)}sY(sZ,"laya.d3.animation.AnimationNode");var sd=sZ.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.addChild=function(sd){sd._parent=this,sd.transform.setParent(this.transform),this._childs.push(sd)},sd.removeChild=function(sd){var sL=this._childs.indexOf(sd);-1!==sL&&this._childs.splice(sL,1)},sd.getChildByName=function(sd){for(var sL=0,sl=this._childs.length;sL<sl;sL++){var sZ=this._childs[sL];if(sZ.name===sd)return sZ}return null},sd.getChildByIndex=function(sd){return this._childs[sd]},sd.getChildCount=function(){return this._childs.length},sd.cloneTo=function(sd){var sL=sd;sL.name=this.name;for(var sl=0,sZ=this._childs.length;sl<sZ;sl++){var sh=this._childs[sl],s_=sh.clone();sL.addChild(s_);var sN=sh.transform,sm=s_.transform;sm.setLocalPosition(sN.getLocalPosition()),sm.setLocalRotation(sN.getLocalRotation()),sm.setLocalScale(sN.getLocalScale()),sm._localRotationEuler=sN._localRotationEuler,sm._setWorldMatrixIgnoreUpdate(sN.getWorldMatrix())}},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sZ.__init__=function(){sZ.registerAnimationNodeProperty("localPosition",sZ._getLocalPosition,sZ._setLocalPosition),sZ.registerAnimationNodeProperty("localRotation",sZ._getLocalRotation,sZ._setLocalRotation),sZ.registerAnimationNodeProperty("localScale",sZ._getLocalScale,sZ._setLocalScale),sZ.registerAnimationNodeProperty("localRotationEuler",sZ._getLocalRotationEuler,sZ._setLocalRotationEuler),sZ.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",sZ._getParticleRenderSharedMaterialTintColor,sZ._setParticleRenderSharedMaterialTintColor),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",sZ._getMeshRenderSharedMaterialTilingOffset,sZ._setMeshRenderSharedMaterialTilingOffset),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",sZ._getMeshRenderSharedMaterialAlbedo,sZ._setMeshRenderSharedMaterialAlbedo),sZ.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",sZ._getSkinnedMeshRenderSharedMaterialTilingOffset,sZ._setSkinnedMeshRenderSharedMaterialTilingOffset),sZ.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",sZ._getSkinnedMeshRenderSharedMaterialAlbedo,sZ._setSkinnedMeshRenderSharedMaterialAlbedo),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",sZ._getMeshRenderSharedMaterialAlbedo,sZ._setMeshRenderSharedMaterialAlbedo),sZ.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",sZ._getSkinnedMeshRenderSharedMaterialAlbedo,sZ._setSkinnedMeshRenderSharedMaterialAlbedo),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",sZ._getMeshRenderSharedMaterialIntensity,sZ._setMeshRenderSharedMaterialIntensity),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",sZ._getMeshRenderSharedMaterialAlpha,sZ._setMeshRenderSharedMaterialAlpha),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",sZ._getMeshRenderSharedMaterialAlphaColor,sZ._setMeshRenderSharedMaterialAlphaColor),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",sZ._getMeshRenderSharedMaterialBaseColor,sZ._setMeshRenderSharedMaterialBaseColor),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",sZ._getMeshRenderSharedMaterialDissolve,sZ._setMeshRenderSharedMaterialDissolve),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",sZ._getMeshRenderSharedMaterialDissolveSpeed,sZ._setMeshRenderSharedMaterialDissolveSpeed),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",sZ._getMeshRenderSharedMaterialMMultiplier,sZ._setMeshRenderSharedMaterialMMultiplier),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",sZ._getMeshRenderSharedMaterialBaseScrollSpeedX,sZ._setMeshRenderSharedMaterialBaseScrollSpeedX),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",sZ._getMeshRenderSharedMaterialBaseScrollSpeedY,sZ._setMeshRenderSharedMaterialBaseScrollSpeedY),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",sZ._getMeshRenderSharedMaterialSecondScrollSpeedX,sZ._setMeshRenderSharedMaterialSecondScrollSpeedX),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",sZ._getMeshRenderSharedMaterialSecondScrollSpeedY,sZ._setMeshRenderSharedMaterialSecondScrollSpeedY),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",sZ._getMeshRenderSharedMaterialDetailTilingOffset,sZ._setMeshRenderSharedMaterialDetailTilingOffset),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",sZ._getMeshRenderSharedMaterialDissolveTilingOffset,sZ._setMeshRenderSharedMaterialDissolveTilingOffset),sZ.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",sZ._getMeshRenderSharedMaterialMaskTilingOffset,sZ._setMeshRenderSharedMaterialMaskTilingOffset)},sZ.registerAnimationNodeProperty=function(sd,sL,sl){if(sZ._propertyIndexDic[sd])throw new Error("AnimationNode: this propertyName has registered.");sZ._propertyIndexDic[sd]=sZ._propertyIDCounter,sZ._propertyGetFuncs[sZ._propertyIDCounter]=sL,sZ._propertySetFuncs[sZ._propertyIDCounter]=sl,sZ._propertyIDCounter++},sZ._getLocalPosition=function(sd,sL){return sd?sd.transform.getLocalPosition():sL._transform.localPosition.elements},sZ._setLocalPosition=function(sd,sL,sl){if(sd)sd.transform.setLocalPosition(sl);else{var sZ=sL._transform,sh=sZ.localPosition;sh.elements=sl,sZ.localPosition=sh}},sZ._getLocalRotation=function(sd,sL){return sd?sd.transform.getLocalRotation():sL._transform.localRotation.elements},sZ._setLocalRotation=function(sd,sL,sl){if(sd)sd.transform.setLocalRotation(sl);else{var sZ=sL._transform,sh=sZ.localRotation;sh.elements=sl,sZ.localRotation=sh}},sZ._getLocalScale=function(sd,sL){return sd?sd.transform.getLocalScale():sL._transform.localScale.elements},sZ._setLocalScale=function(sd,sL,sl){if(sd)sd.transform.setLocalScale(sl);else{var sZ=sL._transform,sh=sZ.localScale;sh.elements=sl,sZ.localScale=sh}},sZ._getLocalRotationEuler=function(sd,sL){return sd?sd.transform.getLocalRotationEuler():sL._transform.localRotationEuler.elements},sZ._setLocalRotationEuler=function(sd,sL,sl){if(sd)sd.transform.setLocalRotationEuler(sl);else{var sZ=sL._transform,sh=sZ.localRotationEuler;sh.elements=sl,sZ.localRotationEuler=sh}},sZ._getMeshRenderSharedMaterialTilingOffset=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return sL.meshRender.sharedMaterial.tilingOffset.elements},sZ._setMeshRenderSharedMaterialTilingOffset=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).tilingOffset).elements=sl,sZ.tilingOffset=sh)}else(sh=(sZ=sL.meshRender.material).tilingOffset).elements=sl,sZ.tilingOffset=sh},sZ._getMeshRenderSharedMaterialAlbedo=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.albedoColor.elements:null}return sL.meshRender.sharedMaterial.albedoColor.elements},sZ._setMeshRenderSharedMaterialAlbedo=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).albedoColor).elements=sl,sZ.albedoColor=sh)}else(sh=(sZ=sL.meshRender.material).albedoColor).elements=sl,sZ.albedoColor=sh},sZ._getSkinnedMeshRenderSharedMaterialTilingOffset=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return sL.skinnedMeshRender.sharedMaterial.tilingOffset.elements},sZ._setSkinnedMeshRenderSharedMaterialTilingOffset=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.skinnedMeshRender.material).tilingOffset).elements=sl,sZ.tilingOffset=sh)}else(sh=(sZ=sL.skinnedMeshRender.material).tilingOffset).elements=sl,sZ.tilingOffset=sh},sZ._getSkinnedMeshRenderSharedMaterialAlbedo=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return sL.skinnedMeshRender.sharedMaterial.albedoColor.elements},sZ._setSkinnedMeshRenderSharedMaterialAlbedo=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.skinnedMeshRender.material).albedoColor).elements=sl,sZ.albedoColor=sh)}else(sh=(sZ=sL.skinnedMeshRender.material).albedoColor).elements=sl,sZ.albedoColor=sh},sZ._getParticleRenderSharedMaterialTintColor=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.particleRender.sharedMaterial.tintColor.elements:null}return sL.particleRender.sharedMaterial.tintColor.elements},sZ._setParticleRenderSharedMaterialTintColor=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.particleRender.material).tintColor).elements=sl,sZ.tintColor=sh)}else(sh=(sZ=sL.particleRender.material).tintColor).elements=sl,sZ.tintColor=sh},sZ._getMeshRenderSharedMaterialAlphaColor=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.alphaColor.elements:null}return sL.meshRender.sharedMaterial.alphaColor.elements},sZ._setMeshRenderSharedMaterialAlphaColor=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).alphaColor).elements=sl,sZ.alphaColor=sh)}else(sh=(sZ=sL.meshRender.material).alphaColor).elements=sl,sZ.alphaColor=sh},sZ._getMeshRenderSharedMaterialBaseColor=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.baseColor.elements:null}return sL.meshRender.sharedMaterial.baseColor.elements},sZ._setMeshRenderSharedMaterialBaseColor=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).baseColor).elements=sl,sZ.baseColor=sh)}else(sh=(sZ=sL.meshRender.material).baseColor).elements=sl,sZ.baseColor=sh},sZ._getMeshRenderSharedMaterialDissolve=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.dissolve:0}return sL.meshRender.sharedMaterial.dissolve},sZ._setMeshRenderSharedMaterialDissolve=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.dissolve=sl[0])}else sL.meshRender.material.dissolve=sl[0]},sZ._getMeshRenderSharedMaterialDissolveSpeed=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.dissolveSpeed:0}return sL.meshRender.sharedMaterial.dissolveSpeed},sZ._setMeshRenderSharedMaterialDissolveSpeed=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.dissolveSpeed=sl[0])}else sL.meshRender.material.dissolveSpeed=sl[0]},sZ._getMeshRenderSharedMaterialMMultiplier=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.mMultiplier:0}return sL.meshRender.sharedMaterial.mMultiplier},sZ._setMeshRenderSharedMaterialMMultiplier=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.mMultiplier=sl[0])}else sL.meshRender.material.mMultiplier=sl[0]},sZ._getMeshRenderSharedMaterialBaseScrollSpeedX=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return sL.meshRender.sharedMaterial.baseScrollSpeedX},sZ._setMeshRenderSharedMaterialBaseScrollSpeedX=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.baseScrollSpeedX=sl[0])}else sL.meshRender.material.baseScrollSpeedX=sl[0]},sZ._getMeshRenderSharedMaterialBaseScrollSpeedY=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return sL.meshRender.sharedMaterial.baseScrollSpeedY},sZ._setMeshRenderSharedMaterialBaseScrollSpeedY=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.baseScrollSpeedY=sl[0])}else sL.meshRender.material.baseScrollSpeedY=sl[0]},sZ._getMeshRenderSharedMaterialSecondScrollSpeedX=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return sL.meshRender.sharedMaterial.secondScrollSpeedX},sZ._setMeshRenderSharedMaterialSecondScrollSpeedX=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.secondScrollSpeedX=sl[0])}else sL.meshRender.material.secondScrollSpeedX=sl[0]},sZ._getMeshRenderSharedMaterialSecondScrollSpeedY=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return sL.meshRender.sharedMaterial.secondScrollSpeedY},sZ._setMeshRenderSharedMaterialSecondScrollSpeedY=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.secondScrollSpeedY=sl[0])}else sL.meshRender.material.secondScrollSpeedY=sl[0]},sZ._getMeshRenderSharedMaterialAlpha=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.alpha:0}return sL.meshRender.sharedMaterial.alpha},sZ._setMeshRenderSharedMaterialAlpha=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.alpha=sl[0])}else sL.meshRender.material.alpha=sl[0]},sZ._getMeshRenderSharedMaterialIntensity=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.intensity:0}return sL.meshRender.sharedMaterial.intensity},sZ._setMeshRenderSharedMaterialIntensity=function(sd,sL,sl){if(sd){var sZ=sd.transform._entity;sZ&&(sZ.owner.meshRender.material.intensity=sl[0])}else sL.meshRender.material.intensity=sl[0]},sZ._getMeshRenderSharedMaterialDetailTilingOffset=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return sL.meshRender.sharedMaterial.detailTilingOffset.elements},sZ._setMeshRenderSharedMaterialDetailTilingOffset=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).detailTilingOffset).elements=sl,sZ.detailTilingOffset=sh)}else(sh=(sZ=sL.meshRender.material).detailTilingOffset).elements=sl,sZ.detailTilingOffset=sh},sZ._getMeshRenderSharedMaterialDissolveTilingOffset=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return sL.meshRender.sharedMaterial.dissolveTilingOffset.elements},sZ._setMeshRenderSharedMaterialDissolveTilingOffset=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).dissolveTilingOffset).elements=sl,sZ.dissolveTilingOffset=sh)}else(sh=(sZ=sL.meshRender.material).dissolveTilingOffset).elements=sl,sZ.dissolveTilingOffset=sh},sZ._getMeshRenderSharedMaterialMaskTilingOffset=function(sd,sL){if(sd){var sl=sd.transform._entity;return sl?sl.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return sL.meshRender.sharedMaterial.maskTilingOffset.elements},sZ._setMeshRenderSharedMaterialMaskTilingOffset=function(sd,sL,sl){var sZ,sh;if(sd){var s_=sd.transform._entity;s_&&((sh=(sZ=s_.owner.meshRender.material).maskTilingOffset).elements=sl,sZ.maskTilingOffset=sh)}else(sh=(sZ=sL.meshRender.material).maskTilingOffset).elements=sl,sZ.maskTilingOffset=sh},sZ._propertyIDCounter=0,sZ._propertyIndexDic={},sZ._propertySetFuncs=[],sZ._propertyGetFuncs=[],sZ}(),sC=function(){function sd(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return sY(sd,"laya.d3.animation.Keyframe"),sd}(),sP=function(){function sd(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return sY(sd,"laya.d3.animation.KeyframeNode"),sd}(),sp=(function(){function sd(){this._tempVector30=new sNL,this._tempVector31=new sNL,this._tempVector32=new sNL,this._a=new sNL,this._b=new sNL,this._c=new sNL,this._d=new sNL}sY(sd,"laya.d3.core.glitter.SplineCurvePositionVelocity");var sL=sd.prototype;sL.Init=function(sd,sL,sl,sZ){sd.cloneTo(this._d),sL.cloneTo(this._c),sNL.scale(sd,2,this._a),sNL.scale(sl,2,this._tempVector30),sNL.subtract(this._a,this._tempVector30,this._a),sNL.add(this._a,sL,this._a),sNL.add(this._a,sZ,this._a),sNL.scale(sl,3,this._b),sNL.scale(sd,3,this._tempVector30),sNL.subtract(this._b,this._tempVector30,this._b),sNL.subtract(this._b,sZ,this._b),sNL.scale(sL,2,this._tempVector30),sNL.subtract(this._b,this._tempVector30,this._b)},sL.Slerp=function(sd,sL){sNL.scale(this._a,sd*sd*sd,this._tempVector30),sNL.scale(this._b,sd*sd,this._tempVector31),sNL.scale(this._c,sd,this._tempVector32),sNL.add(this._tempVector30,this._tempVector31,sL),sNL.add(sL,this._tempVector32,sL),sNL.add(sL,this._d,sL)}}(),function(){function sR(sd,sL,sl,sZ){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=sd,this._h=sL,this._minHeight=sl,this._maxHeight=sZ}sY(sR,"laya.d3.core.HeightMap");var sd=sR.prototype;sd._inBounds=function(sd,sL){return 0<=sd&&sd<this._h&&0<=sL&&sL<this._w},sd.getHeight=function(sd,sL){return this._inBounds(sd,sL)?this._datas[sd][sL]:NaN},sc(0,sd,"width",function(){return this._w}),sc(0,sd,"height",function(){return this._h}),sc(0,sd,"maxHeight",function(){return this._maxHeight}),sc(0,sd,"minHeight",function(){return this._minHeight}),sR.creatFromMesh=function(sd,sL,sl,sZ){for(var sh=[],s_=[],sN=sd.getSubMeshCount(),sm=0;sm<sN;sm++){for(var su=sd.getSubMesh(sm),sx=su._getVertexBuffer(),st=sx.getData(),sb=[],sq=0;sq<st.length;sq+=sx.vertexDeclaration.vertexStride/4){var sY=new sNL(st[sq+0],st[sq+1],st[sq+2]);sb.push(sY)}sh.push(sb);var sc=su._getIndexBuffer();s_.push(sc.getData())}var sr=sd.boundingBox,sa=sr.min.x,sk=sr.min.z,se=sr.max.x,sw=sr.max.z,ss=sr.min.y,sA=sr.max.y,sy=se-sa,s$=sw-sk,sO=sZ.elements[0]=sy/(sL-1),sn=sZ.elements[1]=s$/(sl-1),sV=new sR(sL,sl,ss,sA),sQ=sR._tempRay,sg=sQ.direction.elements;sg[0]=0,sg[1]=-1,sg[2]=0;var sF=sA+.1;sQ.origin.elements[1]=sF;for(var sE=0;sE<sl;sE++){var sI=sk+sE*sn;sV._datas[sE]=[];for(var sp=0;sp<sL;sp++){var sH=sa+sp*sO,sX=sQ.origin.elements;sX[0]=sH,sX[2]=sI;var sj=sR._getPosition(sQ,sh,s_);sV._datas[sE][sp]=sj===Number.MAX_VALUE?NaN:sF-sj}}return sV},sR.createFromImage=function(sd,sL,sl){for(var sZ=sd.width,sh=sd.height,s_=new sR(sZ,sh,sL,sl),sN=(sl-sL)/254,sm=sd.getPixels(),su=0,sx=0;sx<sh;sx++)for(var st=s_._datas[sx]=[],sb=0;sb<sZ;sb++){var sq=sm[su++],sY=sm[su++],sc=sm[su++],sr=sm[su++];st[sb]=255==sq&&255==sY&&255==sc&&255==sr?NaN:(sq+sY+sc)/3*sN+sL}return s_},sR._getPosition=function(sd,sL,sl){for(var sZ=Number.MAX_VALUE,sh=0;sh<sL.length;sh++)for(var s_=sL[sh],sN=sl[sh],sm=0;sm<sN.length;sm+=3){var su=s_[sN[sm+0]],sx=s_[sN[sm+1]],st=s_[sN[sm+2]],sb=scL.rayIntersectsTriangle(sd,su,sx,st);!isNaN(sb)&&sb<sZ&&(sZ=sb)}return sZ},sb(sR,["_tempRay",function(){return this._tempRay=new shL(new sNL,new sNL)}])}(),function(){function sh(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}sY(sh,"laya.d3.core.Layer");var sd=sh.prototype;return sd._binarySearchIndex=function(){for(var sd=0,sL=sh._collsionTestList.length-1,sl=0;sd<=sL;){sl=Math.floor((sd+sL)/2);var sZ=sh._collsionTestList[sl];if(sZ==this._number)return sl;sZ>this._number?sL=sl-1:sd=sl+1}return sd},sd._addCollider=function(sd){0===this._colliders.length&&sh._collsionTestList.splice(this._binarySearchIndex(),0,this._number),sd._isRigidbody?(this._colliders.unshift(sd),this._nonRigidbodyOffset++):this._colliders.push(sd)},sd._removeCollider=function(sd){var sL=this._colliders.indexOf(sd);sL<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(sL,1),0===this._colliders.length&&sh._collsionTestList.splice(sh._collsionTestList.indexOf(this._number),1)},sc(0,sd,"number",function(){return this._number}),sc(0,sd,"visible",function(){return this._visible},function(sd){this._visible=sd,sh._visibleLayers=sd?sh._visibleLayers|this.mask:sh._visibleLayers&~this.mask}),sc(0,sd,"mask",function(){return this._mask}),sc(1,sh,"visibleLayers",function(){return sh._visibleLayers},function(sd){sh._visibleLayers=sd;for(var sL=0,sl=sh._layerList.length;sL<sl;sL++){var sZ=sh._layerList[sL];sZ._visible=0!=(sZ._mask&sh._visibleLayers)}}),sh.__init__=function(){sh._layerList.length=31;for(var sd=0;sd<31;sd++){var sL=new sh;sh._layerList[sd]=sL,0===sd?(sL.name="Default Layer",sL.visible=!0):(sL.name="Layer-"+sd,sL.visible=!1),sL._number=sd,sL._mask=Math.pow(2,sd)}sh.currentCreationLayer=sh._layerList[0]},sh.getLayerByNumber=function(sd){if(sd<0||30<sd)throw new Error("无法返回指定Layer，该number超出范围！");return sh._layerList[sd]},sh.getLayerByName=function(sd){for(var sL=0;sL<31;sL++)if(sh._layerList[sL].name===sd)return sh._layerList[sL];throw new Error("无法返回指定Layer,该name不存在")},sh.isVisible=function(sd){return 0!=(sd&sh._currentCameraCullingMask&sh._visibleLayers)},sh._layerList=[],sh._visibleLayers=2147483647,sh._collsionTestList=[],sh._currentCameraCullingMask=2147483647,sh.maxCount=31,sh.currentCreationLayer=null,sh}()),sH=(function(){function sd(sd,sL,sl){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=sd,this._minCount=sL,this._maxCount=sl}sY(sd,"laya.d3.core.particleShuriKen.module.Burst");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.cloneTo=function(sd){var sL=sd;sL._time=this._time,sL._minCount=this._minCount,sL._maxCount=this._maxCount},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"time",function(){return this._time}),sc(0,sL,"minCount",function(){return this._minCount}),sc(0,sL,"maxCount",function(){return this._maxCount})}(),function(){function sd(sd){this._color=null,this.enbale=!1,this._color=sd}sY(sd,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var sL=sd.prototype;sL.cloneTo=function(sd){var sL=sd;this._color.cloneTo(sL._color),sL.enbale=this.enbale},sL.clone=function(){var sd;switch(this._color.type){case 0:sd=sj.createByConstant(this._color.constant.clone());break;case 1:sd=sj.createByGradient(this._color.gradient.clone());break;case 2:sd=sj.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:sd=sj.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var sL=new this.constructor(sd);return sL.enbale=this.enbale,sL},sc(0,sL,"color",function(){return this._color})}(),function(){function sd(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}sY(sd,"laya.d3.core.particleShuriKen.module.Emission");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),sL._destroy=function(){this._bursts=null,this._destroyed=!0},sL.getBurstsCount=function(){return this._bursts.length},sL.getBurstByIndex=function(sd){return this._bursts[sd]},sL.addBurst=function(sd){var sL=this._bursts.length;if(0<sL)for(var sl=0;sl<sL;sl++)this._bursts[sl].time>sd.time&&this._bursts.splice(sl,0,sd);this._bursts.push(sd)},sL.removeBurst=function(sd){var sL=this._bursts.indexOf(sd);-1!==sL&&this._bursts.splice(sL,1)},sL.removeBurstByIndex=function(sd){this._bursts.splice(sd,1)},sL.clearBurst=function(){this._bursts.length=0},sL.cloneTo=function(sd){var sL=sd,sl=sL._bursts;sl.length=this._bursts.length;for(var sZ=0,sh=this._bursts.length;sZ<sh;sZ++){var s_=sl[sZ];s_?this._bursts[sZ].cloneTo(s_):sl[sZ]=this._bursts[sZ].clone()}sL._emissionRate=this._emissionRate,sL.enbale=this.enbale},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"destroyed",function(){return this._destroyed}),sc(0,sL,"emissionRate",function(){return this._emissionRate},function(sd){if(sd<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=sd})}(),function(){function sZ(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}sY(sZ,"laya.d3.core.particleShuriKen.module.FrameOverTime");var sd=sZ.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.cloneTo=function(sd){var sL=sd;sL._type=this._type,sL._constant=this._constant,this._overTime.cloneTo(sL._overTime),sL._constantMin=this._constantMin,sL._constantMax=this._constantMax,this._overTimeMin.cloneTo(sL._overTimeMin),this._overTimeMax.cloneTo(sL._overTimeMax)},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sd,"frameOverTimeData",function(){return this._overTime}),sc(0,sd,"constant",function(){return this._constant}),sc(0,sd,"type",function(){return this._type}),sc(0,sd,"frameOverTimeDataMin",function(){return this._overTimeMin}),sc(0,sd,"constantMin",function(){return this._constantMin}),sc(0,sd,"frameOverTimeDataMax",function(){return this._overTimeMax}),sc(0,sd,"constantMax",function(){return this._constantMax}),sZ.createByConstant=function(sd){var sL=new sZ;return sL._type=0,sL._constant=sd,sL},sZ.createByOverTime=function(sd){var sL=new sZ;return sL._type=1,sL._overTime=sd,sL},sZ.createByRandomTwoConstant=function(sd,sL){var sl=new sZ;return sl._type=2,sl._constantMin=sd,sl._constantMax=sL,sl},sZ.createByRandomTwoOverTime=function(sd,sL){var sl=new sZ;return sl._type=3,sl._overTimeMin=sd,sl._overTimeMax=sL,sl},sZ}()),sX=function(){function sx(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}sY(sx,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var sd=sx.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.cloneTo=function(sd){var sL=sd;sL._type=this._type,sL._separateAxes=this._separateAxes,sL._constant=this._constant,this._constantSeparate.cloneTo(sL._constantSeparate),this._gradient.cloneTo(sL._gradient),this._gradientX.cloneTo(sL._gradientX),this._gradientY.cloneTo(sL._gradientY),this._gradientZ.cloneTo(sL._gradientZ),sL._constantMin=this._constantMin,sL._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(sL._constantMinSeparate),this._constantMaxSeparate.cloneTo(sL._constantMaxSeparate),this._gradientMin.cloneTo(sL._gradientMin),this._gradientMax.cloneTo(sL._gradientMax),this._gradientXMin.cloneTo(sL._gradientXMin),this._gradientXMax.cloneTo(sL._gradientXMax),this._gradientYMin.cloneTo(sL._gradientYMin),this._gradientYMax.cloneTo(sL._gradientYMax),this._gradientZMin.cloneTo(sL._gradientZMin),this._gradientZMax.cloneTo(sL._gradientZMax)},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sd,"gradientZ",function(){return this._gradientZ}),sc(0,sd,"constant",function(){return this._constant}),sc(0,sd,"gradient",function(){return this._gradient}),sc(0,sd,"separateAxes",function(){return this._separateAxes}),sc(0,sd,"type",function(){return this._type}),sc(0,sd,"constantSeparate",function(){return this._constantSeparate}),sc(0,sd,"gradientX",function(){return this._gradientX}),sc(0,sd,"gradientY",function(){return this._gradientY}),sc(0,sd,"gradientW",function(){return this._gradientW}),sc(0,sd,"gradientMin",function(){return this._gradientMin}),sc(0,sd,"constantMin",function(){return this._constantMin}),sc(0,sd,"gradientMax",function(){return this._gradientMax}),sc(0,sd,"constantMax",function(){return this._constantMax}),sc(0,sd,"gradientWMin",function(){return this._gradientWMin}),sc(0,sd,"constantMinSeparate",function(){return this._constantMinSeparate}),sc(0,sd,"constantMaxSeparate",function(){return this._constantMaxSeparate}),sc(0,sd,"gradientXMin",function(){return this._gradientXMin}),sc(0,sd,"gradientXMax",function(){return this._gradientXMax}),sc(0,sd,"gradientWMax",function(){return this._gradientWMax}),sc(0,sd,"gradientYMin",function(){return this._gradientYMin}),sc(0,sd,"gradientYMax",function(){return this._gradientYMax}),sc(0,sd,"gradientZMin",function(){return this._gradientZMin}),sc(0,sd,"gradientZMax",function(){return this._gradientZMax}),sx.createByConstant=function(sd){var sL=new sx;return sL._type=0,sL._separateAxes=!1,sL._constant=sd,sL},sx.createByConstantSeparate=function(sd){var sL=new sx;return sL._type=0,sL._separateAxes=!0,sL._constantSeparate=sd,sL},sx.createByGradient=function(sd){var sL=new sx;return sL._type=1,sL._separateAxes=!1,sL._gradient=sd,sL},sx.createByGradientSeparate=function(sd,sL,sl,sZ){var sh=new sx;return sh._type=1,sh._separateAxes=!0,sh._gradientX=sd,sh._gradientY=sL,sh._gradientZ=sl,sh._gradientW=sZ,sh},sx.createByRandomTwoConstant=function(sd,sL){var sl=new sx;return sl._type=2,sl._separateAxes=!1,sl._constantMin=sd,sl._constantMax=sL,sl},sx.createByRandomTwoConstantSeparate=function(sd,sL){var sl=new sx;return sl._type=2,sl._separateAxes=!0,sl._constantMinSeparate=sd,sl._constantMaxSeparate=sL,sl},sx.createByRandomTwoGradient=function(sd,sL){var sl=new sx;return sl._type=3,sl._separateAxes=!1,sl._gradientMin=sd,sl._gradientMax=sL,sl},sx.createByRandomTwoGradientSeparate=function(sd,sL,sl,sZ,sh,s_,sN,sm){var su=new sx;return su._type=3,su._separateAxes=!0,su._gradientXMin=sd,su._gradientXMax=sL,su._gradientYMin=sl,su._gradientYMax=sZ,su._gradientZMin=sh,su._gradientZMax=s_,su._gradientWMin=sN,su._gradientWMax=sm,su},sx}(),sj=function(){function sZ(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}sY(sZ,"laya.d3.core.particleShuriKen.module.GradientColor");var sd=sZ.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.cloneTo=function(sd){var sL=sd;sL._type=this._type,this._constant.cloneTo(sL._constant),this._constantMin.cloneTo(sL._constantMin),this._constantMax.cloneTo(sL._constantMax),this._gradient.cloneTo(sL._gradient),this._gradientMin.cloneTo(sL._gradientMin),this._gradientMax.cloneTo(sL._gradientMax)},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sd,"gradient",function(){return this._gradient}),sc(0,sd,"constant",function(){return this._constant}),sc(0,sd,"type",function(){return this._type}),sc(0,sd,"gradientMin",function(){return this._gradientMin}),sc(0,sd,"constantMin",function(){return this._constantMin}),sc(0,sd,"gradientMax",function(){return this._gradientMax}),sc(0,sd,"constantMax",function(){return this._constantMax}),sZ.createByConstant=function(sd){var sL=new sZ;return sL._type=0,sL._constant=sd,sL},sZ.createByGradient=function(sd){var sL=new sZ;return sL._type=1,sL._gradient=sd,sL},sZ.createByRandomTwoConstant=function(sd,sL){var sl=new sZ;return sl._type=2,sl._constantMin=sd,sl._constantMax=sL,sl},sZ.createByRandomTwoGradient=function(sd,sL){var sl=new sZ;return sl._type=3,sl._gradientMin=sd,sl._gradientMax=sL,sl},sZ}(),sR=(function(){function sd(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}sY(sd,"laya.d3.core.particleShuriKen.module.GradientDataColor");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.addAlpha=function(sd,sL){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==sd&&(sd=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=sd,this._alphaElements[this._alphaCurrentLength++]=sL):DEBUG},sL.addRGB=function(sd,sL){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==sd&&(sd=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=sd,this._rgbElements[this._rgbCurrentLength++]=sL.x,this._rgbElements[this._rgbCurrentLength++]=sL.y,this._rgbElements[this._rgbCurrentLength++]=sL.z):DEBUG},sL.cloneTo=function(sd){var sL=sd,sl=0,sZ=0;sL._alphaCurrentLength=this._alphaCurrentLength;var sh=sL._alphaElements;for(sh.length=this._alphaElements.length,sl=0,sZ=this._alphaElements.length;sl<sZ;sl++)sh[sl]=this._alphaElements[sl];sL._rgbCurrentLength=this._rgbCurrentLength;var s_=sL._rgbElements;for(s_.length=this._rgbElements.length,sl=0,sZ=this._rgbElements.length;sl<sZ;sl++)s_[sl]=this._rgbElements[sl]},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),sc(0,sL,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function sd(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}sY(sd,"laya.d3.core.particleShuriKen.module.GradientDataInt");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.add=function(sd,sL){this._currentLength<8?(6===this._currentLength&&1!==sd&&(sd=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=sd,this._elements[this._currentLength++]=sL):console.log("Warning:data count must lessEqual than 4")},sL.cloneTo=function(sd){var sL=sd;sL._currentLength=this._currentLength;var sl=sL._elements;sl.length=this._elements.length;for(var sZ=0,sh=this._elements.length;sZ<sh;sZ++)sl[sZ]=this._elements[sZ]},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"gradientCount",function(){return this._currentLength/2})}(),function(){function sd(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}sY(sd,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.add=function(sd,sL){this._currentLength<8?(6===this._currentLength&&1!==sd&&(sd=1,DEBUG),this._elements[this._currentLength++]=sd,this._elements[this._currentLength++]=sL):DEBUG},sL.getKeyByIndex=function(sd){return this._elements[2*sd]},sL.getValueByIndex=function(sd){return this._elements[2*sd+1]},sL.getAverageValue=function(){for(var sd=0,sL=this._currentLength-2;sd<sL;sd+=2){this._elements[sd+1];this._elements[sd+3],this._elements[sd+2]-this._elements[sd]}return 0},sL.cloneTo=function(sd){var sL=sd;sL._currentLength=this._currentLength;var sl=sL._elements;sl.length=this._elements.length;for(var sZ=0,sh=this._elements.length;sZ<sh;sZ++)sl[sZ]=this._elements[sZ]},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"gradientCount",function(){return this._currentLength/2})}(),function(){function sd(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}sY(sd,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.add=function(sd,sL){this._currentLength<8?(6===this._currentLength&&1!==sd&&(sd=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=sd,this._elements[this._currentLength++]=sL.x,this._elements[this._currentLength++]=sL.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},sL.cloneTo=function(sd){var sL=sd;sL._currentLength=this._currentLength;var sl=sL._elements;sl.length=this._elements.length;for(var sZ=0,sh=this._elements.length;sZ<sh;sZ++)sl[sZ]=this._elements[sZ]},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"gradientCount",function(){return this._currentLength/3})}(),function(){function sm(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}sY(sm,"laya.d3.core.particleShuriKen.module.GradientSize");var sd=sm.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.getMaxSizeInGradient=function(){var sd=0,sL=0,sl=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(sd=0,sL=this._gradientX.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientX.getValueByIndex(sd));for(sd=0,sL=this._gradientY.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientY.getValueByIndex(sd))}else for(sd=0,sL=this._gradient.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradient.getValueByIndex(sd));break;case 1:sl=this._separateAxes?(sl=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),sl=Math.max(sl,this._constantMinSeparate.y),Math.max(sl,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(sd=0,sL=this._gradientXMin.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientXMin.getValueByIndex(sd));for(sd=0,sL=this._gradientXMax.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientXMax.getValueByIndex(sd));for(sd=0,sL=this._gradientYMin.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientYMin.getValueByIndex(sd));for(sd=0,sL=this._gradientZMax.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientZMax.getValueByIndex(sd))}else{for(sd=0,sL=this._gradientMin.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientMin.getValueByIndex(sd));for(sd=0,sL=this._gradientMax.gradientCount;sd<sL;sd++)sl=Math.max(sl,this._gradientMax.getValueByIndex(sd))}}return sl},sd.cloneTo=function(sd){var sL=sd;sL._type=this._type,sL._separateAxes=this._separateAxes,this._gradient.cloneTo(sL._gradient),this._gradientX.cloneTo(sL._gradientX),this._gradientY.cloneTo(sL._gradientY),this._gradientZ.cloneTo(sL._gradientZ),sL._constantMin=this._constantMin,sL._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(sL._constantMinSeparate),this._constantMaxSeparate.cloneTo(sL._constantMaxSeparate),this._gradientMin.cloneTo(sL._gradientMin),this._gradientMax.cloneTo(sL._gradientMax),this._gradientXMin.cloneTo(sL._gradientXMin),this._gradientXMax.cloneTo(sL._gradientXMax),this._gradientYMin.cloneTo(sL._gradientYMin),this._gradientYMax.cloneTo(sL._gradientYMax),this._gradientZMin.cloneTo(sL._gradientZMin),this._gradientZMax.cloneTo(sL._gradientZMax)},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sd,"gradientZ",function(){return this._gradientZ}),sc(0,sd,"gradient",function(){return this._gradient}),sc(0,sd,"separateAxes",function(){return this._separateAxes}),sc(0,sd,"type",function(){return this._type}),sc(0,sd,"gradientMin",function(){return this._gradientMin}),sc(0,sd,"constantMin",function(){return this._constantMin}),sc(0,sd,"gradientX",function(){return this._gradientX}),sc(0,sd,"gradientY",function(){return this._gradientY}),sc(0,sd,"gradientMax",function(){return this._gradientMax}),sc(0,sd,"constantMax",function(){return this._constantMax}),sc(0,sd,"constantMinSeparate",function(){return this._constantMinSeparate}),sc(0,sd,"constantMaxSeparate",function(){return this._constantMaxSeparate}),sc(0,sd,"gradientXMin",function(){return this._gradientXMin}),sc(0,sd,"gradientXMax",function(){return this._gradientXMax}),sc(0,sd,"gradientYMin",function(){return this._gradientYMin}),sc(0,sd,"gradientYMax",function(){return this._gradientYMax}),sc(0,sd,"gradientZMin",function(){return this._gradientZMin}),sc(0,sd,"gradientZMax",function(){return this._gradientZMax}),sm.createByGradient=function(sd){var sL=new sm;return sL._type=0,sL._separateAxes=!1,sL._gradient=sd,sL},sm.createByGradientSeparate=function(sd,sL,sl){var sZ=new sm;return sZ._type=0,sZ._separateAxes=!0,sZ._gradientX=sd,sZ._gradientY=sL,sZ._gradientZ=sl,sZ},sm.createByRandomTwoConstant=function(sd,sL){var sl=new sm;return sl._type=1,sl._separateAxes=!1,sl._constantMin=sd,sl._constantMax=sL,sl},sm.createByRandomTwoConstantSeparate=function(sd,sL){var sl=new sm;return sl._type=1,sl._separateAxes=!0,sl._constantMinSeparate=sd,sl._constantMaxSeparate=sL,sl},sm.createByRandomTwoGradient=function(sd,sL){var sl=new sm;return sl._type=2,sl._separateAxes=!1,sl._gradientMin=sd,sl._gradientMax=sL,sl},sm.createByRandomTwoGradientSeparate=function(sd,sL,sl,sZ,sh,s_){var sN=new sm;return sN._type=2,sN._separateAxes=!0,sN._gradientXMin=sd,sN._gradientXMax=sL,sN._gradientYMin=sl,sN._gradientYMax=sZ,sN._gradientZMin=sh,sN._gradientZMax=s_,sN},sm}()),so=function(){function sm(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}sY(sm,"laya.d3.core.particleShuriKen.module.GradientVelocity");var sd=sm.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.cloneTo=function(sd){var sL=sd;sL._type=this._type,this._constant.cloneTo(sL._constant),this._gradientX.cloneTo(sL._gradientX),this._gradientY.cloneTo(sL._gradientY),this._gradientZ.cloneTo(sL._gradientZ),this._constantMin.cloneTo(sL._constantMin),this._constantMax.cloneTo(sL._constantMax),this._gradientXMin.cloneTo(sL._gradientXMin),this._gradientXMax.cloneTo(sL._gradientXMax),this._gradientYMin.cloneTo(sL._gradientYMin),this._gradientYMax.cloneTo(sL._gradientYMax),this._gradientZMin.cloneTo(sL._gradientZMin),this._gradientZMax.cloneTo(sL._gradientZMax)},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sd,"gradientZ",function(){return this._gradientZ}),sc(0,sd,"constant",function(){return this._constant}),sc(0,sd,"type",function(){return this._type}),sc(0,sd,"gradientXMax",function(){return this._gradientXMax}),sc(0,sd,"constantMin",function(){return this._constantMin}),sc(0,sd,"gradientX",function(){return this._gradientX}),sc(0,sd,"gradientY",function(){return this._gradientY}),sc(0,sd,"gradientXMin",function(){return this._gradientXMin}),sc(0,sd,"constantMax",function(){return this._constantMax}),sc(0,sd,"gradientYMin",function(){return this._gradientYMin}),sc(0,sd,"gradientYMax",function(){return this._gradientYMax}),sc(0,sd,"gradientZMin",function(){return this._gradientZMin}),sc(0,sd,"gradientZMax",function(){return this._gradientZMax}),sm.createByConstant=function(sd){var sL=new sm;return sL._type=0,sL._constant=sd,sL},sm.createByGradient=function(sd,sL,sl){var sZ=new sm;return sZ._type=1,sZ._gradientX=sd,sZ._gradientY=sL,sZ._gradientZ=sl,sZ},sm.createByRandomTwoConstant=function(sd,sL){var sl=new sm;return sl._type=2,sl._constantMin=sd,sl._constantMax=sL,sl},sm.createByRandomTwoGradient=function(sd,sL,sl,sZ,sh,s_){var sN=new sm;return sN._type=3,sN._gradientXMin=sd,sN._gradientXMax=sL,sN._gradientYMin=sl,sN._gradientYMax=sZ,sN._gradientZMin=sh,sN._gradientZMax=s_,sN},sm}(),si=(function(){function sd(sd){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=sd}sY(sd,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.cloneTo=function(sd){var sL=sd;this._angularVelocity.cloneTo(sL._angularVelocity),sL.enbale=this.enbale},sL.clone=function(){var sd;switch(this._angularVelocity.type){case 0:sd=this._angularVelocity.separateAxes?sX.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):sX.createByConstant(this._angularVelocity.constant);break;case 1:sd=this._angularVelocity.separateAxes?sX.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):sX.createByGradient(this._angularVelocity.gradient.clone());break;case 2:sd=this._angularVelocity.separateAxes?sX.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):sX.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:sd=this._angularVelocity.separateAxes?sX.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):sX.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var sL=new this.constructor(sd);return sL.enbale=this.enbale,sL},sc(0,sL,"angularVelocity",function(){return this._angularVelocity})}(),function(){function sd(){this.enable=!1,this.randomDirection=!1}sY(sd,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.core.IClone":!0}),sL._getShapeBoundBox=function(sd){throw new Error("BaseShape: must override it.")},sL._getSpeedBoundBox=function(sd){throw new Error("BaseShape: must override it.")},sL.generatePositionAndDirection=function(sd,sL,sl,sZ){throw new Error("BaseShape: must override it.")},sL._calculateProceduralBounds=function(sd,sL,sl){this._getShapeBoundBox(sd);var sZ=sd.min,sh=sd.max;sNL.multiply(sZ,sL,sZ),sNL.multiply(sh,sL,sh);var s_=new sJd(new sNL,new sNL);this.randomDirection?(s_.min=new sNL(-1,-1,-1),s_.max=new sNL(1,1,1)):this._getSpeedBoundBox(s_);var sN=new sJd(new sNL,new sNL),sm=sN.min,su=sN.max;sNL.scale(s_.min,sl.y,sm),sNL.scale(s_.max,sl.y,su),sNL.add(sd.min,sm,sm),sNL.add(sd.max,su,su),sNL.min(sd.min,sm,sd.min),sNL.max(sd.max,sm,sd.max);var sx=new sJd(new sNL,new sNL),st=sx.min,sb=sx.max;sNL.scale(s_.min,sl.x,st),sNL.scale(s_.max,sl.x,sb),sNL.min(sx.min,sb,sm),sNL.max(sx.min,sb,su),sNL.min(sd.min,sm,sd.min),sNL.max(sd.max,sm,sd.max)},sL.cloneTo=function(sd){sd.enable=this.enable},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sd}()),sT=function(){function s_(){}return sY(s_,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),s_._randomPointUnitArcCircle=function(sd,sL,sl){var sZ=sL.elements,sh=NaN;sh=sl?sl.getFloat()*sd:Math.random()*sd,sZ[0]=Math.cos(sh),sZ[1]=Math.sin(sh)},s_._randomPointInsideUnitArcCircle=function(sd,sL,sl){var sZ=sL.elements;s_._randomPointUnitArcCircle(sd,sL,sl);var sh=NaN;sh=sl?Math.pow(sl.getFloat(),.5):Math.pow(Math.random(),.5),sZ[0]=sZ[0]*sh,sZ[1]=sZ[1]*sh},s_._randomPointUnitCircle=function(sd,sL){var sl=sd.elements,sZ=NaN;sZ=sL?sL.getFloat()*Math.PI*2:Math.random()*Math.PI*2,sl[0]=Math.cos(sZ),sl[1]=Math.sin(sZ)},s_._randomPointInsideUnitCircle=function(sd,sL){var sl=sd.elements;s_._randomPointUnitCircle(sd);var sZ=NaN;sZ=sL?Math.pow(sL.getFloat(),.5):Math.pow(Math.random(),.5),sl[0]=sl[0]*sZ,sl[1]=sl[1]*sZ},s_._randomPointUnitSphere=function(sd,sL){var sl=sd.elements,sZ=NaN,sh=NaN;sh=sL?(sZ=sl[2]=2*sL.getFloat()-1,sL.getFloat()*Math.PI*2):(sZ=sl[2]=2*Math.random()-1,Math.random()*Math.PI*2);var s_=Math.sqrt(1-sZ*sZ);sl[0]=s_*Math.cos(sh),sl[1]=s_*Math.sin(sh)},s_._randomPointInsideUnitSphere=function(sd,sL){var sl=sd.elements;s_._randomPointUnitSphere(sd);var sZ=NaN;sZ=sL?Math.pow(sL.getFloat(),1/3):Math.pow(Math.random(),1/3),sl[0]=sl[0]*sZ,sl[1]=sl[1]*sZ,sl[2]=sl[2]*sZ},s_._randomPointInsideHalfUnitBox=function(sd,sL){var sl=sd.elements;sL?(sl[0]=sL.getFloat()-.5,sl[1]=sL.getFloat()-.5,sl[2]=sL.getFloat()-.5):(sl[0]=Math.random()-.5,sl[1]=Math.random()-.5,sl[2]=Math.random()-.5)},s_}(),sz=(function(){function sd(sd){this._size=null,this.enbale=!1,this._size=sd}sY(sd,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.cloneTo=function(sd){var sL=sd;this._size.cloneTo(sL._size),sL.enbale=this.enbale},sL.clone=function(){var sd;switch(this._size.type){case 0:sd=this._size.separateAxes?sR.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):sR.createByGradient(this._size.gradient.clone());break;case 1:sd=this._size.separateAxes?sR.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):sR.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:sd=this._size.separateAxes?sR.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):sR.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var sL=new this.constructor(sd);return sL.enbale=this.enbale,sL},sc(0,sL,"size",function(){return this._size})}(),function(){function sZ(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}sY(sZ,"laya.d3.core.particleShuriKen.module.StartFrame");var sd=sZ.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.cloneTo=function(sd){var sL=sd;sL._type=this._type,sL._constant=this._constant,sL._constantMin=this._constantMin,sL._constantMax=this._constantMax},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sd,"constant",function(){return this._constant}),sc(0,sd,"type",function(){return this._type}),sc(0,sd,"constantMin",function(){return this._constantMin}),sc(0,sd,"constantMax",function(){return this._constantMax}),sZ.createByConstant=function(sd){var sL=new sZ;return sL._type=0,sL._constant=sd,sL},sZ.createByRandomTwoConstant=function(sd,sL){var sl=new sZ;return sl._type=1,sl._constantMin=sd,sl._constantMax=sL,sl},sZ}()),sD=(function(){function sd(sd,sL){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new s_L(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=sd,this._startFrame=sL}sY(sd,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.cloneTo=function(sd){var sL=sd;this.tiles.cloneTo(sL.tiles),sL.type=this.type,sL.randomRow=this.randomRow,this._frame.cloneTo(sL._frame),this._startFrame.cloneTo(sL._startFrame),sL.cycles=this.cycles,sL.enableUVChannels=this.enableUVChannels,sL.enable=this.enable},sL.clone=function(){var sd,sL;switch(this._frame.type){case 0:sd=sH.createByConstant(this._frame.constant);break;case 1:sd=sH.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:sd=sH.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:sd=sH.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:sL=sz.createByConstant(this._startFrame.constant);break;case 1:sL=sz.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var sl=new this.constructor(sd,sL);return this.tiles.cloneTo(sl.tiles),sl.type=this.type,sl.randomRow=this.randomRow,sl.cycles=this.cycles,sl.enableUVChannels=this.enableUVChannels,sl.enable=this.enable,sl},sc(0,sL,"frame",function(){return this._frame}),sc(0,sL,"startFrame",function(){return this._startFrame})}(),function(){function sd(sd){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=sd}sY(sd,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var sL=sd.prototype;sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.cloneTo=function(sd){var sL=sd;this._velocity.cloneTo(sL._velocity),sL.enbale=this.enbale,sL.space=this.space},sL.clone=function(){var sd;switch(this._velocity.type){case 0:sd=so.createByConstant(this._velocity.constant.clone());break;case 1:sd=so.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:sd=so.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:sd=so.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var sL=new this.constructor(sd);return sL.enbale=this.enbale,sL.space=this.space,sL},sc(0,sL,"velocity",function(){return this._velocity})}(),function(){function sd(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new sqL,this._vb=siL.create(sd._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=soL.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=sjL.nameKey.getID("LINE"),this._shaderCompile=sOL._preCompileShader[this._sharderNameID]}sY(sd,"laya.d3.core.PhasorSpriter3D");var sL=sd.prototype;return sL.line=function(sd,sL,sl,sZ){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(sd.x,sd.y,sd.z,sL.x,sL.y,sL.z,sL.w),this.addVertex(sl.x,sl.y,sl.z,sZ.x,sZ.y,sZ.z,sZ.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},sL.circle=function(sd,sL,sl,sZ,sh,s_){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*sL,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/sL,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*sd,Math.cos(this._tempNumver0)*sd,0,sl,sZ,sh,s_),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},sL.plane=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=sZ/2,this._tempNumver1=sh/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(sd-this._tempNumver0,sL+this._tempNumver1,sl,s_,sN,sm,su),this.addVertex(sd+this._tempNumver0,sL+this._tempNumver1,sl,s_,sN,sm,su),this.addVertex(sd-this._tempNumver0,sL-this._tempNumver1,sl,s_,sN,sm,su),this.addVertex(sd+this._tempNumver0,sL-this._tempNumver1,sl,s_,sN,sm,su),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},sL.box=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=sZ/2,this._tempNumver1=sh/2,this._tempNumver2=s_/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(sd-this._tempNumver0,sL+this._tempNumver1,sl+this._tempNumver2,sN,sm,su,sx),this.addVertex(sd+this._tempNumver0,sL+this._tempNumver1,sl+this._tempNumver2,sN,sm,su,sx),this.addVertex(sd-this._tempNumver0,sL-this._tempNumver1,sl+this._tempNumver2,sN,sm,su,sx),this.addVertex(sd+this._tempNumver0,sL-this._tempNumver1,sl+this._tempNumver2,sN,sm,su,sx),this.addVertex(sd+this._tempNumver0,sL+this._tempNumver1,sl-this._tempNumver2,sN,sm,su,sx),this.addVertex(sd-this._tempNumver0,sL+this._tempNumver1,sl-this._tempNumver2,sN,sm,su,sx),this.addVertex(sd+this._tempNumver0,sL-this._tempNumver1,sl-this._tempNumver2,sN,sm,su,sx),this.addVertex(sd-this._tempNumver0,sL-this._tempNumver1,sl-this._tempNumver2,sN,sm,su,sx),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},sL.cone=function(sd,sL,sl,sZ,sh,s_,sN){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*sl+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*sl>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/sl,this.addVertexIndex(0,sL,0,sZ,sh,s_,sN,this._tempUint0),this.addVertexIndex(0,0,0,sZ,sh,s_,sN,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<sl;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(sd*this._tempNumver2,0,sd*this._tempNumver3,sZ,sh,s_,sN,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==sl-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(sd*this._tempNumver2,0,sd*this._tempNumver3,sZ,sh,s_,sN,this._tempUint0+(this._tempInt0+sl)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==sl-1?this.addIndexes(this._tempUint1+sl+2):this.addIndexes(this._tempUint1+this._tempInt0+sl+1),this.addIndexes(this._tempUint1+this._tempInt0+sl),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},sL.boundingBoxLine=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(sd,sh,s_,sN,sm,su,sx),this.addVertex(sZ,sh,s_,sN,sm,su,sx),this.addVertex(sd,sL,s_,sN,sm,su,sx),this.addVertex(sZ,sL,s_,sN,sm,su,sx),this.addVertex(sZ,sh,sl,sN,sm,su,sx),this.addVertex(sd,sh,sl,sN,sm,su,sx),this.addVertex(sZ,sL,sl,sN,sm,su,sx),this.addVertex(sd,sL,sl,sN,sm,su,sx),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},sL.addVertex=function(sd,sL,sl,sZ,sh,s_,sN){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=sd,this._vbData[this._posInVBData+1]=sL,this._vbData[this._posInVBData+2]=sl,this._vbData[this._posInVBData+3]=sZ,this._vbData[this._posInVBData+4]=sh,this._vbData[this._posInVBData+5]=s_,this._vbData[this._posInVBData+6]=sN,this._posInVBData+=this._floatSizePerVer,this},sL.addVertexIndex=function(sd,sL,sl,sZ,sh,s_,sN,sm){return this._hasBegun||this.addVertexIndexException(),this._vbData[sm]=sd,this._vbData[sm+1]=sL,this._vbData[sm+2]=sl,this._vbData[sm+3]=sZ,this._vbData[sm+4]=sh,this._vbData[sm+5]=s_,this._vbData[sm+6]=sN,(sm+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=sm),this},sL.addIndexes=function(sd){var sL=arguments;this._hasBegun||this.addVertexIndexException();for(var sl=0;sl<sL.length;sl++)this._ibData[this._posInIBData]=sL[sl],this._posInIBData++;return this},sL.begin=function(sd,sL){return this._hasBegun&&this.beginException0(),1!==sd&&4!==sd&&this.beginException1(),this._primitiveType=sd,this._camera=sL,this._hasBegun=!0,this},sL.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},sL.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(sd._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),sO.drawCall++,sF.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},sL.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},sL.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},sL.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},sL.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},sL.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},sL.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(28,[new sNd(0,"vector3",0),new sNd(12,"vector4",1)])}]),sd}()),sG=function(){function sd(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++sd._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new sqL}sY(sd,"laya.d3.core.render.RenderElement");var sL=sd.prototype;return sL.getDynamicBatchBakedVertexs=function(sd){for(var sL=this._renderObj._getVertexBuffer(sd),sl=sL.getData().slice(),sZ=sL.vertexDeclaration,sh=sZ.getVertexElementByUsage(0).offset/4,s_=sZ.getVertexElementByUsage(3).offset/4,sN=this._sprite3D.transform,sm=sN.worldMatrix,su=sN.rotation,sx=sZ.vertexStride/4,st=0,sb=sl.length;st<sb;st+=sx){var sq=st+sh,sY=st+s_;saL.transformVector3ArrayToVector3ArrayCoordinate(sl,sq,sm,sl,sq),saL.transformVector3ArrayByQuat(sl,sY,su,sl,sY)}return sl},sL.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},sL._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},sc(0,sL,"id",function(){return this._id}),sc(0,sL,"renderObj",function(){return this._renderObj},function(sd){this._renderObj!==sd&&(this._renderObj=sd)}),sd._uniqueIDCounter=0,sd}(),sK=function(){function sL(sd){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++sL._uniqueIDCounter,this._needSort=!1,this._scene=sd,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}sY(sL,"laya.d3.core.render.RenderQueue");var sd=sL.prototype;return sd._sortOpaqueFunc=function(sd,sL){if(sd._render&&sL._render){var sl=sd._material.renderQueue-sL._material.renderQueue;return 0==sl?sd._render._distanceForSort-sL._render._distanceForSort:sl}return 0},sd._sortAlphaFunc=function(sd,sL){if(sd._render&&sL._render){var sl=sd._material.renderQueue-sL._material.renderQueue;return 0==sl?sL._render._distanceForSort-sd._render._distanceForSort:sl}return 0},sd._begainRenderElement=function(sd,sL,sl){return!!sL._beforeRender(sd)},sd._sortAlpha=function(sd){sL._cameraPosition=sd,this._finalElements.sort(this._sortAlphaFunc)},sd._sortOpaque=function(sd){sL._cameraPosition=sd,this._finalElements.sort(this._sortOpaqueFunc)},sd._preRender=function(sd){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},sd._render=function(sd,sL){for(var sl,sZ,sh,s_,sN,sm,su=sO.loopCount,sx=this._scene,st=sd.camera,sb=(st.id,!1),sq=0,sY=this._finalElements.length;sq<sY;sq++){var sc,sr,sa,sk=this._finalElements[sq];if(null!=sk._onPreRenderFunction&&sk._onPreRenderFunction.call(sk._sprite3D,sd),0===sk._type){if(sd.owner=sa=sk._sprite3D,sd.renderElement=sk,sa._preRenderUpdateComponents(sd),sc=sk.renderObj,sr=sk._material,this._begainRenderElement(sd,sc,sr)){if(sl=sc._getVertexBuffers(),!(sh=(sZ=sc._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[sZ.id]){this._errorRecord[sZ.id]=1;var se="vertexBuffer:"+("("+sZ._destroyed+","+sZ._released+","+sZ._referenceCount+","+sZ._buffer+")")+", material:"+(sr?sr.__className+"("+sr._destroyed+","+sr._released+")":"null")+", owner:"+(sa?sa.__className+"("+sa._destroyed+","+sa._activeInHierarchy+","+sa._displayedInStage+")":"null")+", renderObj:"+(sc?sc.__className+"("+sc._destroyed+","+sc._released+","+sc._referenceCount+")":"")+", parent:, url:"+(sa?sa.url:"")+", disposeStack:"+sZ.disposeStack;sA.recordError("报错：unknown vertexDeclaration  "+se)}continue}if(sb=(s_=sd._shader=sr._getShader(sx._shaderDefineValue,sh.shaderDefineValue,sa._shaderDefineValue)).bind()||su!==s_._uploadLoopCount,sl){if(s_._uploadVertexBuffer!==sl||sb){for(var sw=0;sw<sl.length;sw++){var ss=sl[sw];s_.uploadAttributesX(ss.vertexDeclaration.shaderValues.data,ss)}s_._uploadVertexBuffer=sl}}else(s_._uploadVertexBuffer!==sZ||sb)&&(s_.uploadAttributes(sh.shaderValues.data,null),s_._uploadVertexBuffer=sZ);(s_._uploadScene!==sx||sb)&&(s_.uploadSceneUniforms(sx._shaderValues.data),s_._uploadScene=sx),(st!==s_._uploadCamera||s_._uploadSprite3D!==sa||sb)&&(s_.uploadSpriteUniforms(sa._shaderValues.data),s_._uploadSprite3D=sa),(st!==s_._uploadCamera||sb)&&(s_.uploadCameraUniforms(st._shaderValues.data),s_._uploadCamera=st),(s_._uploadMaterial!==sr||sb)&&(sr._upload(),s_._uploadMaterial=sr),sN!==sr?(sr._setRenderStateBlendDepth(),sr._setRenderStateFrontFace(sL,sa.transform),sN=sr,sm=sa):sm!==sa&&(sr._setRenderStateFrontFace(sL,sa.transform),sm=sa),sc._render(sd),s_._uploadLoopCount=su}sa._postRenderUpdateComponents(sd)}else if(2===sk._type){sk.renderObj;sd.owner=sa=sk._sprite3D,sd.renderElement=sk,sd._batchIndexStart=sk._tempBatchIndexStart,sd._batchIndexEnd=sk._tempBatchIndexEnd,sc=sk.renderObj,sr=sk._material,this._begainRenderElement(sd,sc,sr)&&(sh=(sZ=sc._getVertexBuffer(0)).vertexDeclaration,sb=(s_=sd._shader=sr._getShader(sx._shaderDefineValue,sh.shaderDefineValue,sa._shaderDefineValue)).bind()||su!==s_._uploadLoopCount,(s_._uploadVertexBuffer!==sZ||sb)&&(s_.uploadAttributes(sh.shaderValues.data,null),s_._uploadVertexBuffer=sZ),(s_._uploadScene!==sx||sb)&&(s_.uploadSceneUniforms(sx._shaderValues.data),s_._uploadScene=sx),(st!==s_._uploadCamera||s_._uploadSprite3D!==sa||sb)&&(s_.uploadSpriteUniforms(sa._shaderValues.data),s_._uploadSprite3D=sa),(st!==s_._uploadCamera||sb)&&(s_.uploadCameraUniforms(st._shaderValues.data),s_._uploadCamera=st),(s_._uploadMaterial!==sr||sb)&&(sr._upload(),s_._uploadMaterial=sr),sN!==sr?(sr._setRenderStateBlendDepth(),sr._setRenderStateFrontFace(sL,sa.transform),sN=sr,sm=sa):sm!==sa&&(sr._setRenderStateFrontFace(sL,sa.transform),sm=sa),sc._render(sd),s_._uploadLoopCount=su)}}},sd._renderShadow=function(sd,sL){for(var sl,sZ,sh,s_,sN,sm=sO.loopCount,su=this._scene,sx=sd.camera,st=!1,sb=0,sq=this._finalElements.length;sb<sq;sb++){var sY,sc,sr,sa=this._finalElements[sb];0===sa._type&&(sd.owner=sr=sa._sprite3D,sL||sr._projectionViewWorldUpdateCamera===sx&&sr._projectionViewWorldUpdateLoopCount===sO.loopCount||(sr._render._renderUpdate(sd._projectionViewMatrix),sr._projectionViewWorldUpdateLoopCount=sO.loopCount,sr._projectionViewWorldUpdateCamera=sx),sd.renderElement=sa,sr._preRenderUpdateComponents(sd),sY=sa.renderObj,sc=sa._material,this._begainRenderElement(sd,sY,null)&&(sZ=(sl=sY._getVertexBuffer(0)).vertexDeclaration,st=(sh=sd._shader=sc._getShader(su._shaderDefineValue,sZ.shaderDefineValue,sr._shaderDefineValue)).bind()||sm!==sh._uploadLoopCount,(sh._uploadVertexBuffer!==sl||st)&&(sh.uploadAttributes(sZ.shaderValues.data,null),sh._uploadVertexBuffer=sl),(sx!==sh._uploadCamera||sh._uploadSprite3D!==sr||st)&&(sh.uploadSpriteUniforms(sr._shaderValues.data),sh._uploadSprite3D=sr),(sx!==sh._uploadCamera||st)&&(sh.uploadCameraUniforms(sx._shaderValues.data),sh._uploadCamera=sx),(sh._uploadMaterial!==sc||st)&&(sc._upload(),sh._uploadMaterial=sc),sh._uploadRenderElement,s_!==sc?(sc._setRenderStateFrontFace(!1,sr.transform),s_=sc,sN=sr):sN!==sr&&(sc._setRenderStateFrontFace(!1,sr.transform),sN=sr),sY._render(sd),sh._uploadLoopCount=sm),sr._postRenderUpdateComponents(sd))}},sd._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},sd._addRenderElement=function(sd){this._renderElements.push(sd),this._needSort=!0},sd._addDynamicBatchElement=function(sd){this._dynamicBatchCombineRenderElements.push(sd)},sc(0,sd,"id",function(){return this._id}),sL._uniqueIDCounter=0,sL._cameraPosition=null,sL}(),sv=function(){function sd(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return sY(sd,"laya.d3.core.render.RenderState"),sd.clientWidth=0,sd.clientHeight=0,sd}(),sJ=function(){function sN(sd,sL){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new sUd(new sNL,0),this._corners=[new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL],this._boundingBoxCenter=new sNL,this._children=sZ(8),this._objects=[],this._tempBoundBoxCorners=[new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL],this._scene=sd,this._currentDepth=sL}sY(sN,"laya.d3.core.scene.OctreeNode");var sd=sN.prototype;return sA.imps(sd,{"laya.d3.core.scene.ITreeNode":!0}),sd.init=function(sd,sL){var sl=new sNL,sZ=new sNL;sNL.scale(sL,-.5,sl),sNL.scale(sL,.5,sZ),sNL.add(sl,sd,sl),sNL.add(sZ,sd,sZ),this.exactBox=new sJd(sl,sZ),this.relaxBox=new sJd(sl,sZ)},sd.addTreeNode=function(sd){1===Collision.boxContainsBox(this._relaxBox,sd.boundingBox)?this.addNodeDown(sd,0):this.addObject(sd)},sd.addChild=function(sd){var sL=this._children[sd];if(null==sL){sL=new sN(this._scene,this._currentDepth+1),(this._children[sd]=sL)._parent=this,sNL.subtract(this._exactBox.max,this._exactBox.min,sN.tempSize),sNL.multiply(sN.tempSize,sN._octreeSplit[sd],sN.tempCenter),sNL.add(this._exactBox.min,sN.tempCenter,sN.tempCenter),sNL.scale(sN.tempSize,.25,sN.tempSize);var sl=new sNL,sZ=new sNL;sNL.subtract(sN.tempCenter,sN.tempSize,sl),sNL.add(sN.tempCenter,sN.tempSize,sZ),sL.exactBox=new sJd(sl,sZ),sNL.scale(sN.tempSize,sN.relax,sN.tempSize);var sh=new sNL,s_=new sNL;sNL.subtract(sN.tempCenter,sN.tempSize,sh),sNL.add(sN.tempCenter,sN.tempSize,s_),sL.relaxBox=new sJd(sh,s_)}return sL},sd.addObject=function(sd){(sd._treeNode=this)._objects.push(sd)},sd.removeObject=function(sd){if(sd._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var sL=this._objects.indexOf(sd);return-1!==sL&&(this._objects.splice(sL,1),!0)},sd.clearObject=function(){this._objects.length=0},sd.addNodeUp=function(sd,sL){this._parent&&1!==Collision.boxContainsBox(this._exactBox,sd.boundingBox)?this._parent.addNodeUp(sd,sL-1):this.addNodeDown(sd,sL)},sd.addNodeDown=function(sd,sL){if(sL<this._scene.treeLevel){var sl=this.inChildIndex(sd.boundingBoxCenter),sZ=this.addChild(sl);1===Collision.boxContainsBox(sZ._relaxBox,sd.boundingBox)?sZ.addNodeDown(sd,++sL):this.addObject(sd)}else this.addObject(sd)},sd.inChildIndex=function(sd){return 4*(sd.z<this._boundingBoxCenter.z?0:1)+2*(sd.y<this._boundingBoxCenter.y?0:1)+(sd.x<this._boundingBoxCenter.x?0:1)},sd.updateObject=function(sd){1===Collision.boxContainsBox(this._relaxBox,sd.boundingBox)?(this.removeObject(sd),sd._treeNode=null,this.addNodeDown(sd,this._currentDepth)):this._parent&&(this.removeObject(sd),sd._treeNode=null,this._parent.addNodeUp(sd,this._currentDepth-1))},sd.cullingObjects=function(sd,sL,sl,sZ,sh){var s_,sN=0,sm=0,su=0,sx=this._scene._dynamicBatchManager;for(sN=0,s_=this._objects.length;sN<s_;sN++){var st=this._objects[sN];if(sp.isVisible(st._owner.layer.mask)&&st.enable){if(sL&&(sO.treeSpriteCollision+=1,0===sd.containsBoundSphere(st.boundingSphere)))continue;st._renderUpdate(sh),st._distanceForSort=sNL.distance(st.boundingSphere.center,sZ)+st.sortingFudge;var sb=st._renderElements;for(sm=0,su=sb.length;sm<su;sm++){var sq=sb[sm],sY=sq._staticBatch;if(sY&&sY._material===sq._material)sY._addBatchRenderElement(sq);else{var sc=sq.renderObj;sc.triangleCount<10&&1===sc._vertexBufferCount&&sc._getIndexBuffer()&&sq._material.renderQueue<2&&sq._canDynamicBatch&&!st._owner.isStatic?sx._addPrepareRenderElement(sq):this._scene.getRenderQueue(sq._material.renderQueue)._addRenderElement(sq)}}}}for(sN=0;sN<8;sN++){var sr=this._children[sN];if(null!=sr){var sa=sL;if(sL){var sk=sd.containsBoundBox(sr._relaxBox);if(sO.treeNodeCollision+=1,0===sk)continue;sa=2===sk}sr.cullingObjects(sd,sa,sl,sZ,sh)}}},sd.cullingShadowObjects=function(sd,sL,sl,sZ,sh){var s_,sN=0,sm=0,su=0;this._scene._dynamicBatchManager;for(sN=0,s_=this._objects.length;sN<s_;sN++){var sx=this._objects[sN];if(sx.castShadow&&sp.isVisible(sx._owner.layer.mask)&&sx.enable){if(sl&&0===sd[0].containsBoundSphere(sx.boundingSphere))continue;for(var st=1,sb=sd.length;st<sb;st++){var sq=sL[st-1];if(0!==sd[st].containsBoundSphere(sx.boundingSphere)){var sY=sx._renderElements;for(sm=0,su=sY.length;sm<su;sm++)sq._addRenderElement(sY[sm])}}}}for(sN=0;sN<8;sN++){var sc=this._children[sN];if(null!=sc){var sr=sl;if(sl){var sa=sd[0].containsBoundBox(sc._relaxBox);if(0===sa)continue;sr=2===sa}sc.cullingShadowObjects(sd,sL,sr,sZ,sh)}}},sd.cullingShadowObjectsOnePSSM=function(sd,sL,sl,sZ,sh,s_){var sN,sm=sL[0],su=0,sx=0,st=0;for(su=0,sN=this._objects.length;su<sN;su++){var sb=this._objects[su];if(sb.castShadow&&sp.isVisible(sb._owner.layer.mask)&&sb.enable){if(sZ&&0===sd.containsBoundSphere(sb.boundingSphere))continue;sb._renderUpdate(sl);var sq=sb._renderElements;for(sx=0,st=sq.length;sx<st;sx++)sm._addRenderElement(sq[sx])}}for(su=0;su<8;su++){var sY=this._children[su];if(null!=sY){var sc=sZ;if(sZ){var sr=sd.containsBoundBox(sY._relaxBox);if(0===sr)continue;sc=2===sr}sY.cullingShadowObjectsOnePSSM(sd,sL,sl,sc,sh,s_)}}},sd.renderBoudingBox=function(sd){this._renderBoudingBox(sd);for(var sL=0;sL<8;++sL){var sl=this._children[sL];sl&&sl.renderBoudingBox(sd)}},sd.buildAllChild=function(sd){if(sd<this._scene.treeLevel)for(var sL=0;sL<8;sL++){this.addChild(sL).buildAllChild(sd+1)}},sd._renderBoudingBox=function(sd){},sc(0,sd,"exactBox",function(){return this._exactBox},function(sd){this._exactBox=sd,sNL.add(sd.min,sd.max,this._boundingBoxCenter),sNL.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),sc(0,sd,"relaxBox",function(){return this._relaxBox},function(sd){(this._relaxBox=sd).getCorners(this._corners),sUd.createfromPoints(this._corners,this._boundingSphere)}),sN.debugMode=!1,sN.relax=1.15,sN.CHILDNUM=8,sb(sN,["tempVector0",function(){return this.tempVector0=new sNL},"tempSize",function(){return this.tempSize=new sNL},"tempCenter",function(){return this.tempCenter=new sNL},"_octreeSplit",function(){return this._octreeSplit=[new sNL(.25,.25,.25),new sNL(.75,.25,.25),new sNL(.25,.75,.25),new sNL(.75,.75,.25),new sNL(.25,.25,.75),new sNL(.75,.25,.75),new sNL(.25,.75,.75),new sNL(.75,.75,.75)]}]),sN}(),sf=(function(){function sd(){}sY(sd,"laya.d3.core.scene.SceneManager")}(),function(){function sd(sd,sL,sl,sZ){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===sd&&(sd=1),void 0===sL&&(sL=1),void 0===sl&&(sl=1),void 0===sZ&&(sZ=1),this._r=sd,this._g=sL,this._b=sl,this._a=sZ}return sY(sd,"laya.d3.core.trail.module.Color",null,"Color$1"),sd.prototype.cloneTo=function(sd){sd._r=this._r,sd._g=this._g,sd._b=this._b,sd._a=this._a},sb(sd,["RED",function(){return this.RED=new sd(1,0,0,1)},"GREEN",function(){return this.GREEN=new sd(0,1,0,1)},"BLUE",function(){return this.BLUE=new sd(0,0,1,1)},"CYAN",function(){return this.CYAN=new sd(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new sd(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new sd(1,0,1,1)},"GRAY",function(){return this.GRAY=new sd(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new sd(1,1,1,1)},"BLACK",function(){return this.BLACK=new sd(0,0,0,1)}]),sd}()),sU=(function(){function sd(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}sY(sd,"laya.d3.core.trail.module.Gradient");var sL=sd.prototype;sL.setKeys=function(sd,sL){var sl,sZ;this._colorKeys=sd;for(var sh=this.index=0;sh<sd.length;sh++){var s_=(sl=sd[sh]).color;this._colorKeyData[this.index++]=s_._r,this._colorKeyData[this.index++]=s_._g,this._colorKeyData[this.index++]=s_._b,this._colorKeyData[this.index++]=sl.time}this._alphaKeys=sL;for(var sN=this.index=0;sN<sL.length;sN++)sZ=sL[sN],this._alphaKeyData[this.index++]=sZ.alpha,this._alphaKeyData[this.index++]=sZ.time},sL.cloneTo=function(sd){var sL=0,sl=0,sZ=this.colorKeys,sh=[];for(sL=0,sl=sZ.length;sL<sl;sL++){var s_=new sW;sZ[sL].cloneTo(s_),sh.push(s_)}var sN=this.alphaKeys,sm=[];for(sL=0,sl=sN.length;sL<sl;sL++){var su=new sU;sN[sL].cloneTo(su),sm.push(su)}sd.setKeys(sh,sm)},sc(0,sL,"mode",function(){return this._mode},function(sd){this._mode=sd}),sc(0,sL,"colorKeys",function(){return this._colorKeys},function(sd){this._colorKeys=sd;for(var sL=this.index=0;sL<sd.length;sL++){var sl=sd[sL],sZ=sl.color;this._colorKeyData[this.index++]=sZ._r,this._colorKeyData[this.index++]=sZ._g,this._colorKeyData[this.index++]=sZ._b,this._colorKeyData[this.index++]=sl.time}}),sc(0,sL,"alphaKeys",function(){return this._alphaKeys},function(sd){this._alphaKeys=sd;for(var sL=this.index=0;sL<sd.length;sL++){var sl=sd[sL];this._alphaKeyData[this.index++]=sl.alpha,this._alphaKeyData[this.index++]=sl.time}})}(),function(){function sd(sd,sL){this._alpha=NaN,this._time=NaN,void 0===sd&&(sd=0),void 0===sL&&(sL=0),this._alpha=sd,this._time=sL}sY(sd,"laya.d3.core.trail.module.GradientAlphaKey");var sL=sd.prototype;return sL.cloneTo=function(sd){sd.alpha=this.alpha,sd.time=this.time},sc(0,sL,"alpha",function(){return this._alpha},function(sd){this._alpha=sd}),sc(0,sL,"time",function(){return this._time},function(sd){this._time=sd}),sd}()),sW=function(){function sd(sd,sL){this._color=null,this._time=NaN,void 0===sL&&(sL=0),this._color=sd||new sf,this._time=sL}sY(sd,"laya.d3.core.trail.module.GradientColorKey");var sL=sd.prototype;return sL.cloneTo=function(sd){this.color.cloneTo(sd.color),sd.time=this.time},sc(0,sL,"color",function(){return this._color},function(sd){this._color=sd}),sc(0,sL,"time",function(){return this._time},function(sd){this._time=sd}),sd}(),sM=(function(){function sd(){}sY(sd,"laya.d3.core.trail.module.GradientMode"),sd.Blend=0,sd.Fixed=1}(),function(){function sd(){}sY(sd,"laya.d3.core.trail.module.TextureMode"),sd.Stretch=0,sd.Tile=1}(),function(){function sd(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}sY(sd,"laya.d3.core.trail.module.TrailKeyFrame"),sd.prototype.cloneTo=function(sd){sd.time=this.time,sd.inTangent=this.inTangent,sd.outTangent=this.outTangent,sd.value=this.value}}(),function(){function sL(sd){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new sNL,this._curPosition=new sNL,this._delVector3=new sNL,this._lastFixedVertexPosition=new sNL,this._pointAtoBVector3=new sNL,this._pointA=new sNL,this._pointB=new sNL,this._owner=sd,this._id=sL.renderElementCount++,0==this._id?sd._owner.transform.position.cloneTo(this._lastPosition):sd._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new siL(sM.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new siL(sM.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}sY(sL,"laya.d3.core.trail.TrailRenderElement");var sd=sL.prototype;sA.imps(sd,{"laya.d3.core.render.IRenderable":!0}),sd._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},sd._addTrailByFirstPosition=function(sd,sL){sNL.subtract(sL,sd,this._delVector3),sNL.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),sNL.normalize(this._pointAtoBVector3,this._pointAtoBVector3),sNL.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(sd),sd.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},sd._addTrailByNextPosition=function(sd){sNL.subtract(sd,this._lastFixedVertexPosition,this._delVector3),sNL.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),sNL.normalize(this._pointAtoBVector3,this._pointAtoBVector3),sNL.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=sNL.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=sWd.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(sd),sd.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(sd),this._virtualVerticesCount=2)},sd._updateVerticesByPosition=function(sd){this._pointe=sd.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},sd._updateVertexBuffer2=function(){var sd,sL=0,sl=0,sZ=0;for(sZ=0,sd=(this._verticesCount+this._virtualVerticesCount)/2;sZ<sd;sZ++)sl=0==this._owner.textureMode?(this._VerticesToTailLength[sZ]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[sZ],this._vertices2[sL++]=1-sl,this._vertices2[sL++]=1-sl;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},sd._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},sd._updateDisappear=function(){var sd,sL=0;for(sL=this._curDisappearIndex,sd=(this._verticesCount+this._virtualVerticesCount)/2;sL<sd;sL++)this._owner._curtime-this._everyGroupVertexBirthTime[sL]>=this._owner.time+sWd.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},sd._beforeRender=function(sd){return this._camera=sd.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),sNL.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},sd._render=function(sd){this._isDead||(sF.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),sO.drawCall++,sO.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},sd._getVertexBuffer=function(sd){return void 0===sd&&(sd=0),0===sd?this._vertexBuffer1:1===sd?this._vertexBuffer2:null},sd._getVertexBuffers=function(){return this._vertexBuffers},sd._getIndexBuffer=function(){return null},sd.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},sd._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},sc(0,sd,"_vertexBufferCount",function(){return this._vertexBuffers.length}),sc(0,sd,"triangleCount",function(){return 0}),sL.renderElementCount=0}(),function(){function sd(){}sY(sd,"laya.d3.core.trail.VertexTrail");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration1}),sc(1,sd,"vertexDeclaration1",function(){return sd._vertexDeclaration1}),sc(1,sd,"vertexDeclaration2",function(){return sd._vertexDeclaration2}),sb(sd,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new s_d(32,[new sNd(0,"vector3",0),new sNd(12,"vector3",41),new sNd(24,"single",33),new sNd(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new s_d(4,[new sNd(0,"single",38)])}]),sd}()),sdd=function(){function ss(sd){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=sd}sY(ss,"laya.d3.graphics.DynamicBatch");var sd=ss.prototype;return sA.imps(sd,{"laya.d3.core.render.IRenderable":!0}),sd._getVertexBuffer=function(sd){return void 0===sd&&(sd=0),0===sd?this._vertexBuffer:null},sd._getIndexBuffer=function(){return this._indexBuffer},sd._getCombineRenderElementFromPool=function(sd,sL,sl){var sZ=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return sZ||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=sZ=new sG,sZ._sprite3D=new sKL),sZ._sprite3D._render._renderUpdate(sl),sZ},sd._getRenderElement=function(sd,sL,sl){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*ss.maxVertexCount),this._indexDatas=new Uint16Array(ss.maxIndexCount),this._vertexBuffer=siL.create(this._vertexDeclaration,ss.maxVertexCount,35048),this._indexBuffer=soL.create("ushort",ss.maxIndexCount,35048));for(var sZ=this._merageElements.length=0,sh=0,s_=0,sN=this._combineRenderElements.length;s_<sN;s_++){var sm=this._combineRenderElements[s_],su=sm.getDynamicBatchBakedVertexs(0),sx=sm.getBakedIndices(),st=sm._sprite3D.transform._isFrontFaceInvert,sb=sZ/(this._vertexDeclaration.vertexStride/4),sq=sh,sY=sq+sx.length;sm._tempBatchIndexStart=sq,sm._tempBatchIndexEnd=sY,this._indexDatas.set(sx,sh);var sc=0;if(st)for(sc=sq;sc<sY;sc+=3){this._indexDatas[sc]=sb+this._indexDatas[sc];var sr=this._indexDatas[sc+1],sa=this._indexDatas[sc+2];this._indexDatas[sc+1]=sb+sa,this._indexDatas[sc+2]=sb+sr}else for(sc=sq;sc<sY;sc+=3)this._indexDatas[sc]=sb+this._indexDatas[sc],this._indexDatas[sc+1]=sb+this._indexDatas[sc+1],this._indexDatas[sc+2]=sb+this._indexDatas[sc+2];sh+=sx.length,this._vertexDatas.set(su,sZ),sZ+=su.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),s_=this._combineRenderElementPoolIndex=0,sN=this._materials.length;s_<sN;s_++){var sk=this._getCombineRenderElementFromPool(sd,sL,sl);sk._type=2,sk._staticBatch=null;var se=(sk.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[s_]]._tempBatchIndexStart,sw=s_+1===this._materialToRenderElementsOffsets.length?sh:this._combineRenderElements[this._materialToRenderElementsOffsets[s_+1]]._tempBatchIndexStart;sk._tempBatchIndexStart=se,sk._tempBatchIndexEnd=sw,sk._material=this._materials[s_],this._merageElements.push(sk)}},sd._addCombineRenderObjTest=function(sd){var sL=sd.renderObj,sl=this._currentCombineIndexCount+sL._getIndexBuffer().indexCount,sZ=this._currentCombineVertexCount+sL._getVertexBuffer().vertexCount;return!(ss.maxVertexCount<sZ||ss.maxIndexCount<sl)},sd._addCombineRenderObj=function(sd){var sL=sd.renderObj;this._combineRenderElements.push(sd),this._currentCombineIndexCount=this._currentCombineIndexCount+sL._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+sL._getVertexBuffer().vertexCount},sd._addCombineMaterial=function(sd){this._materials.push(sd)},sd._addMaterialToRenderElementOffset=function(sd){this._materialToRenderElementsOffsets.push(sd)},sd._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},sd._addToRenderQueue=function(sd,sL,sl,sZ){this._getRenderElement(sL,sl,sZ);for(var sh=0,s_=this._materials.length;sh<s_;sh++)sd.getRenderQueue(this._materials[sh].renderQueue)._addDynamicBatchElement(this._merageElements[sh])},sd._beforeRender=function(sd){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},sd._render=function(sd){var sL=sd._batchIndexEnd-sd._batchIndexStart;sF.mainContext.drawElements(4,sL,5123,2*sd._batchIndexStart),sO.drawCall++,sO.trianglesFaces+=sL/3},sd._getVertexBuffers=function(){return null},sc(0,sd,"_vertexBufferCount",function(){return 1}),sc(0,sd,"triangleCount",function(){return this._indexBuffer.indexCount/3}),sc(0,sd,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),ss.maxVertexCount=2e4,ss.maxIndexCount=4e4,ss.maxCombineTriangleCount=10,ss}(),sLd=function(){function ss(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}sY(ss,"laya.d3.graphics.DynamicBatchManager");var sd=ss.prototype;return sd.getDynamicBatch=function(sd,sL){var sl,sZ=sd.id.toString()+sL;return this._dynamicBatches[sZ]?sl=this._dynamicBatches[sZ]:this._dynamicBatches[sZ]=sl=new sdd(sd),sl},sd._garbageCollection=function(){for(var sd in this._dynamicBatches)0===this._dynamicBatches[sd].combineRenderElementsCount&&delete this._dynamicBatches[sd]},sd._addPrepareRenderElement=function(sd){this._prepareDynamicBatchCombineElements.push(sd)},sd._finishCombineDynamicBatch=function(sd){var sL,sl,sZ;this._prepareDynamicBatchCombineElements.sort(ss._sortPrepareDynamicBatch);for(var sh,s_,sN,sm,su,sx=-1,st=!0,sb=0,sq=-1,sY=0,sc=this._prepareDynamicBatchCombineElements.length;sY<sc;sY++){var sr=(s_=this._prepareDynamicBatchCombineElements[sY]).renderObj._getVertexBuffer(0).vertexDeclaration,sa=sl!==sr;sa&&(sb=0,sl=sr);var sk=sb!==sx;if(sk&&(sx=sb),(sa||sk)&&(sN=this.getDynamicBatch(sr,sb),sL=null),st)if(sN._addCombineRenderObjTest(s_)){if(sL!==(sh=s_._material))sm&&(sd.getRenderQueue(su._material.renderQueue)._addRenderElement(su),su=sm=null,sq=-1),sm=sh,sq=sN.combineRenderElementsCount,su=s_,sL=sh;else if(sm){var se=su.renderObj,sw=s_.renderObj;se._getVertexBuffer().vertexCount+sw._getVertexBuffer().vertexCount>sdd.maxVertexCount||se._getIndexBuffer().indexCount+sw._getIndexBuffer().indexCount>sdd.maxIndexCount?(sd.getRenderQueue(su._material.renderQueue)._addRenderElement(su),sm=sh,sq=sN.combineRenderElementsCount,su=s_):(sN._addCombineMaterial(sm),sN._addMaterialToRenderElementOffset(sq),sN._addCombineRenderObj(su),su=sm=null,sq=-1,sN._addCombineRenderObj(s_))}else sN._addCombineRenderObj(s_);st=!0}else sm&&(sd.getRenderQueue(su._material.renderQueue)._addRenderElement(su),su=sm=null,sq=-1),sb++,st=!1;else sZ=this._prepareDynamicBatchCombineElements[sY-1],sN._addMaterialToRenderElementOffset(sN.combineRenderElementsCount),sL=sZ._material,sN._addCombineMaterial(sL),sN._addCombineRenderObj(sZ),st=!0,sL!==(sh=s_._material)?(sm=sh,sq=sN.combineRenderElementsCount,su=s_):sN._addCombineRenderObj(s_),sL=sh}sm&&(sd.getRenderQueue(su._material.renderQueue)._addRenderElement(su),su=sm=null,sq=-1),this._prepareDynamicBatchCombineElements.length=0},sd._clearRenderElements=function(){for(var sd in this._dynamicBatches)this._dynamicBatches[sd]._clearRenderElements()},sd._addToRenderQueue=function(sd,sL,sl,sZ){for(var sh in this._dynamicBatches){var s_=this._dynamicBatches[sh];0<s_.combineRenderElementsCount&&s_._addToRenderQueue(sd,sL,sl,sZ)}},sd.dispose=function(){this._dynamicBatches=null},ss._sortPrepareDynamicBatch=function(sd,sL){return sd._mainSortID-sL._mainSortID},ss}(),sld=function(){function sd(){}return sY(sd,"laya.d3.graphics.FrustumCulling"),sd.renderShadowObjectCulling=function(sd,sL,sl,sZ,sh){var s_=0,sN=0,sm=0,su=0;for(s_=0,sm=sl.length;s_<sm;s_++){var sx=sl[s_];sx&&sx._clearRenderElements()}var st,sb,sq,sY=sd._cullingRenders;if(1<sh){for(s_=0,sm=sd._cullingRendersLength;s_<sm;s_++)if((st=sY[s_]).castShadow&&sp.isVisible(st._owner.layer.mask)&&st.enable)for(var sc=1,sr=sL.length;sc<sr;sc++)if(sb=sl[sc-1],0!==sL[sc].containsBoundSphere(st.boundingSphere))for(sN=0,su=(sq=st._renderElements).length;sN<su;sN++)sb._addRenderElement(sq[sN])}else for(s_=0,sm=sd._cullingRendersLength;s_<sm;s_++)if((st=sY[s_]).castShadow&&sp.isVisible(st._owner.layer.mask)&&st.enable&&0!==sL[0].containsBoundSphere(st.boundingSphere))for(st._renderUpdate(sZ),sb=sl[0],sN=0,su=(sq=st._renderElements).length;sN<su;sN++)sb._addRenderElement(sq[sN])},sd.renderShadowObjectCullingOctree=function(sd,sL,sl,sZ,sh){for(var s_=0,sN=sl.length;s_<sN;s_++){var sm=sl[s_];sm&&sm._clearRenderElements()}1<sh?sd.treeRoot.cullingShadowObjects(sL,sl,!0,0,sd):sd.treeRoot.cullingShadowObjectsOnePSSM(sL[0],sl,sZ,!0,0,sd)},sd.renderObjectCulling=function(sd,sL,sl,sZ,sh,s_){var sN=0,sm=0,su=0,sx=0,st=sL._quenes,sb=sL._dynamicBatchManager,sq=sL._cullingRenders;for(sN=0,sm=st.length;sN<sm;sN++){var sY=st[sN];sY&&sY._clearRenderElements()}var sc=sZd._staticBatchManagers;for(sN=0,sm=sc.length;sN<sm;sN++)sc[sN]._clearRenderElements();sb._clearRenderElements();var sr=sl.transform.position;for(sN=0,sm=sL._cullingRendersLength;sN<sm;sN++){var sa=sq[sN];if(sp.isVisible(sa._owner.layer.mask)&&sa.enable&&0!==sd.containsBoundSphere(sa.boundingSphere)&&sa._renderUpdate(s_)){sa._distanceForSort=sNL.distance(sa.boundingSphere.center,sr)+sa.sortingFudge;var sk=sa._renderElements;for(su=0,sx=sk.length;su<sx;su++){var se=sk[su],sw=se._staticBatch;if(sw&&sw._material===se._material)sw._addBatchRenderElement(se);else{var ss=se.renderObj;ss.triangleCount<10&&1===ss._vertexBufferCount&&ss._getIndexBuffer()&&se._material.renderQueue<2&&se._canDynamicBatch&&!sa._owner.isStatic?sb._addPrepareRenderElement(se):sL.getRenderQueue(se._material.renderQueue)._addRenderElement(se)}}}}for(sN=0,sm=sc.length;sN<sm;sN++)sc[sN]._addToRenderQueue(sL,sZ,sh,s_);sb._finishCombineDynamicBatch(sL),sb._addToRenderQueue(sL,sZ,sh,s_)},sd.renderObjectCullingOctree=function(sd,sL,sl,sZ,sh,s_){var sN=0,sm=0,su=sL._quenes,sx=sL._dynamicBatchManager;for(sN=0,sm=su.length;sN<sm;sN++){var st=su[sN];st&&st._clearRenderElements()}var sb=sZd._staticBatchManagers;for(sN=0,sm=sb.length;sN<sm;sN++)sb[sN]._clearRenderElements();for(sx._clearRenderElements(),sL._cullingRenders.length=0,sL.treeRoot.cullingObjects(sd,!0,0,sl.transform.position,s_),sN=0,sm=sb.length;sN<sm;sN++)sb[sN]._addToRenderQueue(sL,sZ,sh,s_);sx._finishCombineDynamicBatch(sL),sx._addToRenderQueue(sL,sZ,sh,s_)},sd.renderObjectCullingNoBoundFrustum=function(sd,sL,sl,sZ,sh){var s_=0,sN=0,sm=0,su=0,sx=sd._quenes,st=sd._dynamicBatchManager,sb=sd._cullingRenders;for(s_=0,sN=sx.length;s_<sN;s_++){var sq=sx[s_];sq&&sq._clearRenderElements()}var sY=sZd._staticBatchManagers;for(s_=0,sN=sY.length;s_<sN;s_++)sY[s_]._clearRenderElements();st._clearRenderElements();var sc=sL.transform.position;for(s_=0,sN=sd._cullingRendersLength;s_<sN;s_++){var sr=sb[s_];if(sp.isVisible(sr._owner.layer.mask)&&sr.enable){sr._renderUpdate(sh),sr._distanceForSort=sNL.distance(sr.boundingSphere.center,sc)+sr.sortingFudge;var sa=sr._renderElements;for(sm=0,su=sa.length;sm<su;sm++){var sk=sa[sm],se=sk._staticBatch;if(se&&se._material===sk._material)se._addBatchRenderElement(sk);else{var sw=sk.renderObj;sw.triangleCount<10&&1===sw._vertexBufferCount&&sw._getIndexBuffer()&&sk._material.renderQueue<2&&sk._canDynamicBatch&&!sr._owner.isStatic?st._addPrepareRenderElement(sk):sd.getRenderQueue(sk._material.renderQueue)._addRenderElement(sk)}}}}for(s_=0,sN=sY.length;s_<sN;s_++)sY[s_]._addToRenderQueue(sd,sl,sZ,sh);st._finishCombineDynamicBatch(sd),st._addToRenderQueue(sd,sl,sZ,sh)},sd}(),sZd=function(){function s_(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}sY(s_,"laya.d3.graphics.StaticBatchManager");var sd=s_.prototype;return sd._finishInit=function(){for(var sd in this._staticBatches)this._staticBatches[sd]._finishInit();this._initBatchRenderElements.length=0},sd._initStaticBatchs=function(sd){throw new Error("StaticBatchManager:must override this function.")},sd._addInitBatchSprite=function(sd){for(var sL=sd._render._renderElements,sl=0,sZ=sL.length;sl<sZ;sl++)this._initBatchRenderElements.push(sL[sl])},sd._clearRenderElements=function(){for(var sd in this._staticBatches)this._staticBatches[sd]._clearRenderElements()},sd._garbageCollection=function(sd){var sL=sd._staticBatch,sl=sL._initBatchRenderElements,sZ=sl.indexOf(sd);sl.splice(sZ,1),0===sl.length&&(sL.dispose(),delete this._staticBatches[sL._key])},sd._addToRenderQueue=function(sd,sL,sl,sZ){for(var sh in this._staticBatches){var s_=this._staticBatches[sh];0<s_._batchRenderElements.length&&s_._updateToRenderQueue(sd,sZ)}},sd.dispose=function(){this._staticBatches=null},s_._addToStaticBatchQueue=function(sd){sd instanceof laya.d3.core.RenderableSprite3D&&sd._addToInitStaticBatchManager();for(var sL=0,sl=sd.numChildren;sL<sl;sL++)s_._addToStaticBatchQueue(sd._childs[sL])},s_.combine=function(sd,sL){var sl,sZ=0,sh=0;if(sL)for(sZ=0,sh=sL.length;sZ<sh;sZ++){sL[sZ]._addToInitStaticBatchManager()}else sd&&s_._addToStaticBatchQueue(sd);for(sZ=0,sh=s_._staticBatchManagers.length;sZ<sh;sZ++)(sl=s_._staticBatchManagers[sZ])._initStaticBatchs(sd),sl._finishInit()},s_._staticBatchManagers=[],s_}(),shd=function(){function sd(sd,sL,sl){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=sd,this._manager=sL,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=sl}sY(sd,"laya.d3.graphics.StaticBatch");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),sL._binarySearch=function(sd){for(var sL=0,sl=this._batchRenderElements.length-1,sZ=0;sL<=sl;)sZ=Math.floor((sL+sl)/2),this._compareBatchRenderElement(this._batchRenderElements[sZ],sd)?sl=sZ-1:sL=sZ+1;return sL},sL._compareBatchRenderElement=function(sd,sL){throw new Error("StaticBatch:must override this function.")},sL._getVertexDecLightMap=function(sd){return sd===sod.vertexDeclaration?spd.vertexDeclaration:sd===sRd.vertexDeclaration?sId.vertexDeclaration:sd===snd.vertexDeclaration?ssd.vertexDeclaration:sd===sCd.vertexDeclaration?null:sd===srd.vertexDeclaration?sad.vertexDeclaration:sd===sSd.vertexDeclaration?sXd.vertexDeclaration:sd===sFd.vertexDeclaration?sEd.vertexDeclaration:sd===sid.vertexDeclaration?sHd.vertexDeclaration:sd===sRd.vertexDeclaration?sId.vertexDeclaration:sd===sVd.vertexDeclaration?sAd.vertexDeclaration:sd===sCd.vertexDeclaration?null:sd===srd.vertexDeclaration?sad.vertexDeclaration:sd===sBd.vertexDeclaration?sjd.vertexDeclaration:sd===sFd.vertexDeclaration?sEd.vertexDeclaration:sd},sL._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},sL._addBatchRenderElement=function(sd){this._batchRenderElements.splice(this._binarySearch(sd),0,sd)},sL._updateToRenderQueue=function(sd,sL){this._combineRenderElementPoolIndex=0,this._getRenderElement(sd.getRenderQueue(this._material.renderQueue)._renderElements,sd,sL)},sL._getRenderElement=function(sd,sL,sl){throw new Error("StaticBatch:must override this function.")},sL._finishInit=function(){throw new Error("StaticBatch:must override this function.")},sL._clearRenderElements=function(){this._batchRenderElements.length=0},sL.dispose=function(){},sL._getVertexBuffer=function(sd){return void 0===sd&&(sd=0),null},sL._getIndexBuffer=function(){return null},sL._beforeRender=function(sd){return!0},sL._render=function(sd){},sL._getVertexBuffers=function(){return null},sc(0,sL,"_vertexBufferCount",function(){return 1}),sc(0,sL,"triangleCount",function(){return 0}),sd.combine=function(sd){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),sZd.combine(sd)},sd.maxBatchVertexCount=65535,sd}(),s_d=function(){function sN(sd,sL){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++sN._uniqueIDCounter,this._id>sN.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",sN.maxVertexDeclaration);this._shaderValues=new sqL,this._vertexElementsDic={},this._vertexStride=sd,this._vertexElements=sL;for(var sl=0;sl<sL.length;sl++){var sZ=sL[sl],sh=sZ.elementUsage;this._vertexElementsDic[sh]=sZ;var s_=[sN._getTypeSize(sZ.elementFormat)/4,5126,!1,this._vertexStride,sZ.offset];switch(this._shaderValues.setValue(sh,s_),sh){case 1:this._addShaderDefine(sOL.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(sOL.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(sOL.SHADERDEFINE_UV1)}}}sY(sN,"laya.d3.graphics.VertexDeclaration");var sd=sN.prototype;return sd._addShaderDefine=function(sd){this._shaderDefineValue|=sd},sd._removeShaderDefine=function(sd){this._shaderDefineValue&=~sd},sd.getVertexElements=function(){return this._vertexElements.slice()},sd.getVertexElementByUsage=function(sd){return this._vertexElementsDic[sd]},sd.unBinding=function(){},sc(0,sd,"shaderDefineValue",function(){return this._shaderDefineValue}),sc(0,sd,"id",function(){return this._id}),sc(0,sd,"vertexStride",function(){return this._vertexStride}),sc(0,sd,"shaderValues",function(){return this._shaderValues}),sN._getTypeSize=function(sd){switch(sd){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},sN.getVertexStride=function(sd){for(var sL=0,sl=0;sl<sd.Length;sl++){var sZ=sd[sl],sh=sZ.offset+sN._getTypeSize(sZ.elementFormat);sL<sh&&(sL=sh)}return sL},sN._maxVertexDeclarationBit=1e3,sN._uniqueIDCounter=1,sb(sN,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),sN}(),sNd=function(){function sd(sd,sL,sl){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=sd,this.elementFormat=sL,this.elementUsage=sl}return sY(sd,"laya.d3.graphics.VertexElement"),sd}(),smd=(function(){function sd(){}sY(sd,"laya.d3.graphics.VertexElementFormat"),sd.Single="single",sd.Vector2="vector2",sd.Vector3="vector3",sd.Vector4="vector4",sd.Color="color",sd.Byte4="byte4",sd.Short2="short2",sd.Short4="short4",sd.NormalizedShort2="normalizedshort2",sd.NormalizedShort4="normalizedshort4",sd.HalfVector2="halfvector2",sd.HalfVector4="halfvector4"}(),function(){function sd(){}sY(sd,"laya.d3.graphics.VertexElementUsage"),sd.POSITION0=0,sd.COLOR0=1,sd.TEXTURECOORDINATE0=2,sd.NORMAL0=3,sd.BINORMAL0=4,sd.TANGENT0=5,sd.BLENDINDICES0=6,sd.BLENDWEIGHT0=7,sd.DEPTH0=8,sd.FOG0=9,sd.POINTSIZE0=10,sd.SAMPLE0=11,sd.TESSELLATEFACTOR0=12,sd.COLOR1=13,sd.NEXTTEXTURECOORDINATE0=14,sd.TEXTURECOORDINATE1=15,sd.NEXTTEXTURECOORDINATE1=16,sd.CORNERTEXTURECOORDINATE0=17,sd.VELOCITY0=18,sd.STARTCOLOR0=19,sd.STARTSIZE=20,sd.AGEADDSCALE0=21,sd.STARTROTATION=22,sd.ENDCOLOR0=23,sd.STARTLIFETIME=24,sd.TIME0=33,sd.SHAPEPOSITIONSTARTLIFETIME=30,sd.DIRECTIONTIME=32,sd.SIZEROTATION0=27,sd.RADIUS0=28,sd.RADIAN0=29,sd.STARTSPEED=31,sd.RANDOM0=34,sd.RANDOM1=35,sd.SIMULATIONWORLDPOSTION=36,sd.SIMULATIONWORLDROTATION=37,sd.TEXTURECOORDINATE0X=38,sd.TEXTURECOORDINATE0X1=39,sd.TEXTURECOORDINATE0Y=40,sd.OFFSETVECTOR=41}(),function(){function sd(sd,sL,sl){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=sd,this._textureCoordinate0=sL,this._time=sl}sY(sd,"laya.d3.graphics.VertexGlitter");var sL=sd.prototype;sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate0}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"time",function(){return this._time}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(24,[new sNd(0,"vector3",0),new sNd(12,"vector2",2),new sNd(20,"single",33)])}])}(),function(){function sd(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=sd,this._position=sL,this._velocity=sl,this._startColor=sZ,this._endColor=sh,this._sizeRotation=s_,this._radius=sN,this._radian=sm,this._ageAddScale=su,this._time=sx}sY(sd,"laya.d3.graphics.VertexParticle");var sL=sd.prototype;sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"endColor",function(){return this._endColor}),sc(0,sL,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),sc(0,sL,"sizeRotation",function(){return this._sizeRotation}),sc(0,sL,"velocity",function(){return this._velocity}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"startColor",function(){return this._startColor}),sc(0,sL,"radius",function(){return this._radius}),sc(0,sL,"radian",function(){return this._radian}),sc(0,sL,"ageAddScale",function(){return this._ageAddScale}),sc(0,sL,"time",function(){return this._time}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(116,[new sNd(0,"vector4",17),new sNd(16,"vector3",0),new sNd(28,"vector3",18),new sNd(40,"vector4",19),new sNd(56,"vector4",23),new sNd(72,"vector3",27),new sNd(84,"vector2",28),new sNd(92,"vector4",29),new sNd(108,"single",24),new sNd(112,"single",33)])}])}(),function(){function sd(sd){this._position=null,this._position=sd}sY(sd,"laya.d3.graphics.VertexPosition");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(12,[new sNd(0,"vector3",0)])}]),sd}()),sud=function(){function sd(sd,sL){this._position=null,this._normal=null,this._position=sd,this._normal=sL}sY(sd,"laya.d3.graphics.VertexPositionNormal");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(24,[new sNd(0,"vector3",0),new sNd(12,"vector3",3)])}]),sd}(),sxd=function(){function sd(sd,sL,sl){this._position=null,this._normal=null,this._color=null,this._position=sd,this._normal=sL,this._color=sl}sY(sd,"laya.d3.graphics.VertexPositionNormalColor");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(40,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1)])}]),sd}(),std=function(){function sd(sd,sL,sl,sZ,sh){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=sd,this._normal=sL,this._color=sl,this._blendIndex=sZ,this._blendWeight=sh}sY(sd,"laya.d3.graphics.VertexPositionNormalColorSkin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(72,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector4",7),new sNd(56,"vector4",6)])}]),sd}(),sbd=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._tangent=sZ,this._blendIndex=sh,this._blendWeight=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(88,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector4",7),new sNd(56,"vector4",6),new sNd(72,"vector4",5)])}]),sd}(),sqd=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._tangent=sZ,this._blendIndex=sh,this._blendWeight=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(84,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector4",7),new sNd(56,"vector4",6),new sNd(72,"vector3",5)])}]),sd}(),sYd=function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._tangent=sZ}sY(sd,"laya.d3.graphics.VertexPositionNormalColorSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(56,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector4",5)])}]),sd}(),scd=function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._tangent=sZ}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(52,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector3",5)])}]),sd}(),srd=function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate=sZ}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(48,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2)])}]),sd}(),sad=function(){function sd(sd,sL,sl,sZ,sh){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate0=sZ,this._textureCoordinate1=sh}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(56,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector2",15)])}]),sd}(),skd=function(){function sd(sd,sL,sl,sZ,sh,s_,sN){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate0=sZ,this._textureCoordinate1=sh,this._blendIndex=s_,this._blendWeight=sN}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(88,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector2",15),new sNd(56,"vector4",7),new sNd(72,"vector4",6)])}]),sd}(),sed=function(){function sd(sd,sL,sl,sZ,sh,s_,sN,sm){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate0=sZ,this._textureCoordinate1=sh,this._tangent=s_,this._blendIndex=sN,this._blendWeight=sm}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(104,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector2",15),new sNd(56,"vector4",7),new sNd(72,"vector4",6),new sNd(88,"vector4",5)])}]),sd}(),swd=function(){function sd(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sL.VertexPositionNormalColorTexture0SkinTangent=function(sd,sL,sl,sZ,sh,s_,sN,sm){this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate0=sZ,this._textureCoordinate1=sh,this._tangent=s_,this._blendIndex=sN,this._blendWeight=sm},sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(100,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector2",15),new sNd(56,"vector4",7),new sNd(72,"vector4",6),new sNd(88,"vector3",5)])}]),sd}(),ssd=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate0=sZ,this._textureCoordinate1=sh,this._tangent=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(72,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector2",15),new sNd(56,"vector4",5)])}]),sd}(),sAd=function(){function sd(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sL.VertexPositionNormalColorTexture0Tangent=function(sd,sL,sl,sZ,sh,s_){this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate0=sZ,this._textureCoordinate1=sh,this._tangent=s_},sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(68,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector2",15),new sNd(56,"vector3",5)])}]),sd}(),syd=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate=sZ,this._blendIndex=sh,this._blendWeight=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(80,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector4",7),new sNd(64,"vector4",6)])}]),sd}(),s$d=function(){function sd(sd,sL,sl,sZ,sh,s_,sN){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate=sZ,this._tangent=sh,this._blendIndex=s_,this._blendWeight=sN}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(96,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector4",7),new sNd(64,"vector4",6),new sNd(80,"vector4",5)])}]),sd}(),sOd=function(){function sd(sd,sL,sl,sZ,sh,s_,sN){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate=sZ,this._tangent=sh,this._blendIndex=s_,this._blendWeight=sN}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(92,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector4",7),new sNd(64,"vector4",6),new sNd(80,"vector3",5)])}]),sd}(),snd=function(){function sd(sd,sL,sl,sZ,sh){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate=sZ,this._tangent=sh}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(64,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector4",5)])}]),sd}(),sVd=function(){function sd(sd,sL,sl,sZ,sh){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=sd,this._normal=sL,this._color=sl,this._textureCoordinate=sZ,this._tangent=sh}sY(sd,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"color",function(){return this._color}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(60,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",1),new sNd(40,"vector2",2),new sNd(48,"vector3",5)])}]),sd}(),sQd=function(){function sd(sd,sL,sl){this._position=null,this._normal=null,this._tangent=null,this._position=sd,this._normal=sL,this._tangent=sl}sY(sd,"laya.d3.graphics.VertexPositionNormalSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(40,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector4",5)])}]),sd}(),sgd=function(){function sd(sd,sL,sl){this._position=null,this._normal=null,this._tangent=null,this._position=sd,this._normal=sL,this._tangent=sl}sY(sd,"laya.d3.graphics.VertexPositionNormalTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(36,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector3",5)])}]),sd}(),sFd=function(){function sd(sd,sL,sl){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(32,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2)])}]),sd}(),sEd=function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=sd,this._normal=sL,this._textureCoordinate0=sl,this._textureCoordinate1=sZ}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(40,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15)])}]),sd}(),sId=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=sd,this._normal=sL,this._textureCoordinate0=sl,this._textureCoordinate1=sZ,this._blendIndex=sh,this._blendWeight=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(72,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15),new sNd(40,"vector4",7),new sNd(56,"vector4",6)])}]),sd}(),spd=function(){function sd(sd,sL,sl,sZ,sh,s_,sN){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._textureCoordinate0=sl,this._textureCoordinate1=sZ,this._tangent=sh,this._blendIndex=s_,this._blendWeight=sN}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(88,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15),new sNd(40,"vector4",7),new sNd(56,"vector4",6),new sNd(72,"vector4",5)])}]),sd}(),sHd=function(){function sd(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sL.VertexPositionNormalTexture0SkinTangent=function(sd,sL,sl,sZ,sh,s_,sN){this._position=sd,this._normal=sL,this._textureCoordinate0=sl,this._textureCoordinate1=sZ,this._tangent=sh,this._blendIndex=s_,this._blendWeight=sN},sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(84,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15),new sNd(40,"vector4",7),new sNd(56,"vector4",6),new sNd(72,"vector3",5)])}]),sd}(),sXd=function(){function sd(sd,sL,sl,sZ,sh){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=sd,this._normal=sL,this._textureCoordinate0=sl,this._textureCoordinate1=sZ,this._tangent=sh}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(56,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15),new sNd(40,"vector4",5)])}]),sd}(),sjd=function(){function sd(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}sY(sd,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sL.VertexPositionNormalTexture0Tangent=function(sd,sL,sl,sZ,sh){this._position=sd,this._normal=sL,this._textureCoordinate0=sl,this._textureCoordinate1=sZ,this._tangent=sh},sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(52,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15),new sNd(40,"vector3",5)])}]),sd}(),sRd=function(){function sd(sd,sL,sl,sZ,sh){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl,this._blendIndex=sZ,this._blendWeight=sh}sY(sd,"laya.d3.graphics.VertexPositionNormalTextureSkin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(64,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector4",7),new sNd(48,"vector4",6)])}]),sd}(),sod=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl,this._tangent=sZ,this._blendIndex=sh,this._blendWeight=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(80,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector4",7),new sNd(48,"vector4",6),new sNd(64,"vector4",5)])}]),sd}(),sid=function(){function sd(sd,sL,sl,sZ,sh,s_){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl,this._tangent=sZ,this._blendIndex=sh,this._blendWeight=s_}sY(sd,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(76,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector4",7),new sNd(48,"vector4",6),new sNd(64,"vector3",5)])}]),sd}(),sSd=function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl,this._tangent=sZ}sY(sd,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(48,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector4",5)])}]),sd}(),sBd=function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl,this._tangent=sZ}sY(sd,"laya.d3.graphics.VertexPositionNormalTextureTangent");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(44,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector3",5)])}]),sd}(),sCd=function(){function sd(sd,sL,sl){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl}sY(sd,"laya.d3.graphics.VertexPositionNTBTexture");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(56,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector3",5),new sNd(36,"vector3",4),new sNd(48,"vector2",2)])}]),sd}(),sPd=function(){function sd(sd,sL,sl,sZ,sh,s_,sN,sm){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=sd,this._normal=sL,this._textureCoordinate0=sZ,this._textureCoordinate1=sh,this._tangent=s_,sl=sl,this._blendIndex=sN,this._blendWeight=sm}sY(sd,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"tangent",function(){return this._tangent}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(0,sL,"textureCoordinate1",function(){return this._textureCoordinate1}),sc(0,sL,"blendIndex",function(){return this._blendIndex}),sc(0,sL,"blendWeight",function(){return this._blendWeight}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(96,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector3",5),new sNd(36,"vector3",4),new sNd(48,"vector2",2),new sNd(56,"vector2",15),new sNd(64,"vector4",7),new sNd(80,"vector4",6)])}]),sd}(),sTd=function(){function sd(sd,sL,sl){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=sd,this._normal=sL,this._textureCoordinate=sl}sY(sd,"laya.d3.graphics.VertexPositionNTBTextureSkin");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"textureCoordinate",function(){return this._textureCoordinate}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(88,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector3",5),new sNd(36,"vector3",4),new sNd(48,"vector2",2),new sNd(56,"vector4",7),new sNd(72,"vector4",6)])}]),sd}(),szd=(function(){function sd(sd,sL,sl,sZ){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=sd,this._normal=sL,this._textureCoord0=sl,this._textureCoord1=sZ}sY(sd,"laya.d3.graphics.VertexPositionTerrain");var sL=sd.prototype;sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"normal",function(){return this._normal}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoord0",function(){return this._textureCoord0}),sc(0,sL,"textureCoord1",function(){return this._textureCoord1}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(40,[new sNd(0,"vector3",0),new sNd(12,"vector3",3),new sNd(24,"vector2",2),new sNd(32,"vector2",15)])}])}(),function(){function sd(sd,sL){this._position=null,this._textureCoordinate0=null,this._position=sd,this._textureCoordinate0=sL}sY(sd,"laya.d3.graphics.VertexPositionTexture0");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"position",function(){return this._position}),sc(0,sL,"textureCoordinate0",function(){return this._textureCoordinate0}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(20,[new sNd(0,"vector3",0),new sNd(12,"vector2",2)])}]),sd}()),sDd=(function(){function sd(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb,sq,sY){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=sd,this._positionStartLifeTime=sL,this._velocity=sl,this._startColor=sZ,this._startSize=sh,this._startRotation0=s_,this._startRotation1=sN,this._startRotation2=sm,this._startLifeTime=su,this._time=sx,this._startSpeed=st,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=sY}sY(sd,"laya.d3.graphics.VertexShurikenParticleBillboard");var sL=sd.prototype;sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),sc(0,sL,"random1",function(){return this._randoms1}),sc(0,sL,"startRotation2",function(){return this._startRotation2}),sc(0,sL,"positionStartLifeTime",function(){return this._positionStartLifeTime}),sc(0,sL,"velocity",function(){return this._velocity}),sc(0,sL,"random0",function(){return this._randoms0}),sc(0,sL,"startSize",function(){return this._startSize}),sc(0,sL,"startColor",function(){return this._startColor}),sc(0,sL,"startRotation0",function(){return this._startRotation0}),sc(0,sL,"startRotation1",function(){return this._startRotation1}),sc(0,sL,"startLifeTime",function(){return this._startLifeTime}),sc(0,sL,"time",function(){return this._time}),sc(0,sL,"startSpeed",function(){return this._startSpeed}),sc(0,sL,"simulationWorldPostion",function(){return this._simulationWorldPostion}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(152,[new sNd(0,"vector4",17),new sNd(16,"vector4",30),new sNd(32,"vector4",32),new sNd(48,"vector4",19),new sNd(64,"vector3",20),new sNd(76,"vector3",22),new sNd(88,"single",31),new sNd(92,"vector4",34),new sNd(108,"vector4",35),new sNd(124,"vector3",36),new sNd(136,"vector4",37)])}])}(),function(){function sd(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb,sq,sY){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=sd,this._positionStartLifeTime=sL,this._velocity=sl,this._startColor=sZ,this._startSize=sh,this._startRotation0=s_,this._startRotation1=sN,this._startRotation2=sm,this._startLifeTime=su,this._time=sx,this._startSpeed=st,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=sY}sY(sd,"laya.d3.graphics.VertexShurikenParticleMesh");var sL=sd.prototype;sA.imps(sL,{"laya.d3.graphics.IVertex":!0}),sc(0,sL,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),sc(0,sL,"velocity",function(){return this._velocity}),sc(0,sL,"position",function(){return this._positionStartLifeTime}),sc(0,sL,"random0",function(){return this._randoms0}),sc(0,sL,"startSize",function(){return this._startSize}),sc(0,sL,"startColor",function(){return this._startColor}),sc(0,sL,"startRotation0",function(){return this._startRotation0}),sc(0,sL,"startRotation1",function(){return this._startRotation1}),sc(0,sL,"random1",function(){return this._randoms1}),sc(0,sL,"startRotation2",function(){return this._startRotation2}),sc(0,sL,"startLifeTime",function(){return this._startLifeTime}),sc(0,sL,"time",function(){return this._time}),sc(0,sL,"startSpeed",function(){return this._startSpeed}),sc(0,sL,"simulationWorldPostion",function(){return this._simulationWorldPostion}),sc(0,sL,"vertexDeclaration",function(){return sd._vertexDeclaration}),sc(1,sd,"vertexDeclaration",function(){return sd._vertexDeclaration}),sb(sd,["_vertexDeclaration",function(){return this._vertexDeclaration=new s_d(172,[new sNd(0,"vector3",0),new sNd(12,"vector4",1),new sNd(28,"vector2",2),new sNd(36,"vector4",30),new sNd(52,"vector4",32),new sNd(68,"vector4",19),new sNd(84,"vector3",20),new sNd(96,"vector3",22),new sNd(108,"single",31),new sNd(112,"vector4",34),new sNd(128,"vector4",35),new sNd(144,"vector3",36),new sNd(156,"vector4",37)])}])}(),function(){function sw(sd,sL,sl,sZ,sh,s_){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=sl,this._materials=sZ,this._subMeshes=sh,this._materialMap=s_,this._version=sL,this._onLoaded(sd)}sY(sw,"laya.d3.loaders.LoadModelV01");var sd=sw.prototype;return sd._onLoaded=function(sd){this._readData=sd,this.READ_BLOCK();for(var sL=0;sL<this._BLOCK.count;sL++){var sl=this._readData.getUint16(),sZ=this._strings[sl],sh=this["READ_"+sZ];if(null==sh)throw new Error("model file err,no this function:"+sl+" "+sZ);if(!sh.call(this))break}return this._mesh},sd.onError=function(){},sd._readString=function(){return this._strings[this._readData.getUint16()]},sd.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},sd.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},sd.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var sd=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var sL=0;sL<this._STRINGS.size;sL++)this._strings[sL]=this._readData.readUTFString();return this._readData.pos=sd,!0},sd.READ_MATERIAL=function(){var sd=this._readData.getUint16(),sL=(this._readString(),this._readString());return this._materials[sd]="null"!==sL?sk.getRes(this._materialMap[sL]):new sgL,!0},sd.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var sd,sL=this._readData.__getBuffer(),sl=0,sZ=this._readData.getUint32(),sh=this._readData.getUint32(),s_=(new Float32Array(sL.slice(sZ+this._DATA.offset,sZ+this._DATA.offset+sh)),this._readData.getUint32()),sN=this._readData.getUint32(),sm=new Float32Array(sL.slice(s_+this._DATA.offset,s_+this._DATA.offset+sN));for(this.mesh._inverseBindPoses=[],sl=0,sd=sm.length;sl<sd;sl+=16){var su=new sdL(sm[sl+0],sm[sl+1],sm[sl+2],sm[sl+3],sm[sl+4],sm[sl+5],sm[sl+6],sm[sl+7],sm[sl+8],sm[sl+9],sm[sl+10],sm[sl+11],sm[sl+12],sm[sl+13],sm[sl+14],sm[sl+15]);this.mesh._inverseBindPoses.push(su)}break;default:throw new Error("LoadModel:unknown version.")}return!0},sd.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var sd=this._readString();this._shaderAttributes=sd.match(sw._attrReg);var sL=this._readData.getUint32(),sl=this._readData.getUint32(),sZ=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),sh=this._readData.getUint32(),s_=this._readData.getUint32(),sN=this._readData.getUint32(),sm=this._readData.__getBuffer(),su=new sxL(this._mesh),sx=this._getVertexDeclaration(),st=siL.create(sx,sh/sx.vertexStride,35044,!0),sb=sZ+this._DATA.offset,sq=sm.slice(sb,sb+sh);st.setData(new Float32Array(sq));for(var sY=(su._vertexBuffer=st).vertexDeclaration.getVertexElements(),sc=0;sc<sY.length;sc++)su._bufferUsage[sY[sc].elementUsage]=st;var sr=soL.create("ushort",sl/2,35044,!0),sa=sL+this._DATA.offset,sk=sm.slice(sa,sa+sl);sr.setData(new Uint16Array(sk)),su._indexBuffer=sr;var se=sm.slice(s_+this._DATA.offset,s_+this._DATA.offset+sN);return su._boneIndicesList[0]=new Uint8Array(se),this._subMeshes.push(su),!0},sd.READ_DATAAREA=function(){return!1},sd._getVertexDeclaration=function(){for(var sd,sL=!1,sl=!1,sZ=!1,sh=!1,s_=!1,sN=!1,sm=!1,su=!1,sx=!1,st=0;st<this._shaderAttributes.length;st+=8)switch(this._shaderAttributes[st]){case"POSITION":sL=!0;break;case"NORMAL":sl=!0;break;case"COLOR":sZ=!0;break;case"UV":sh=!0;break;case"UV1":s_=!0;break;case"BLENDWEIGHT":sm=!0;break;case"BLENDINDICES":su=!0;break;case"TANGENT":sN=!0;break;case"BINORMAL":sx=!0}return sL&&sl&&sZ&&sh&&s_&&sm&&su&&sN?sd=swd.vertexDeclaration:sL&&sl&&sZ&&sh&&s_&&sm&&su?sd=skd.vertexDeclaration:sL&&sl&&sh&&s_&&sm&&su&&sN?sd=sHd.vertexDeclaration:sL&&sl&&sh&&s_&&sm&&su?sd=sId.vertexDeclaration:sL&&sl&&sZ&&sh&&sm&&su&&sN?sd=sOd.vertexDeclaration:sL&&sl&&sZ&&sh&&sm&&su?sd=syd.vertexDeclaration:sL&&sl&&sN&&sx&&sh&&sm&&su?sd=sTd.vertexDeclaration:sL&&sl&&sh&&sm&&su&&sN?sd=sid.vertexDeclaration:sL&&sl&&sh&&sm&&su?sd=sRd.vertexDeclaration:sL&&sl&&sZ&&sm&&su&&sN?sd=sqd.vertexDeclaration:sL&&sl&&sZ&&sm&&su?sd=std.vertexDeclaration:sL&&sl&&sZ&&sh&&s_&&sN?sd=sAd.vertexDeclaration:sL&&sl&&sZ&&sh&&s_?sd=sad.vertexDeclaration:sL&&sl&&sh&&s_&&sN?sd=sjd.vertexDeclaration:sL&&sl&&sh&&s_?sd=sEd.vertexDeclaration:sL&&sl&&sZ&&sh&&sN?sd=sVd.vertexDeclaration:sL&&sl&&sh&&sN&&sx?sd=sCd.vertexDeclaration:sL&&sl&&sZ&&sh?sd=srd.vertexDeclaration:sL&&sl&&sh&&sN?sd=sBd.vertexDeclaration:sL&&sl&&sh?sd=sFd.vertexDeclaration:sL&&sl&&sZ&&sN?sd=scd.vertexDeclaration:sL&&sl&&sZ&&(sd=sxd.vertexDeclaration),sd},sc(0,sd,"mesh",function(){return this._mesh}),sw._attrReg=new RegExp("(\\w+)|([:,;])","g"),sw}()),sGd=function(){function s$(){}return sY(s$,"laya.d3.loaders.LoadModelV02"),s$.parse=function(sd,sL,sl,sZ,sh,s_){s$._mesh=sl,s$._materials=sZ,s$._subMeshes=sh,s$._materialMap=s_,s$._version=sL,s$._readData=sd,s$.READ_DATA(),s$.READ_BLOCK(),s$.READ_STRINGS();for(var sN=0,sm=s$._BLOCK.count;sN<sm;sN++){s$._readData.pos=s$._BLOCK.blockStarts[sN];var su=s$._readData.getUint16(),sx=s$._strings[su],st=s$["READ_"+sx];if(null==st)throw new Error("model file err,no this function:"+su+" "+sx);st.call()}s$._strings.length=0,s$._readData=null,s$._version=null,s$._mesh=null,s$._materials=null,s$._subMeshes=null,s$._materialMap=null},s$._readString=function(){return s$._strings[s$._readData.getUint16()]},s$.READ_DATA=function(){s$._DATA.offset=s$._readData.getUint32(),s$._DATA.size=s$._readData.getUint32()},s$.READ_BLOCK=function(){for(var sd=s$._BLOCK.count=s$._readData.getUint16(),sL=s$._BLOCK.blockStarts=[],sl=s$._BLOCK.blockLengths=[],sZ=0;sZ<sd;sZ++)sL.push(s$._readData.getUint32()),sl.push(s$._readData.getUint32())},s$.READ_STRINGS=function(){var sd=s$._readData.getUint32(),sL=s$._readData.getUint16(),sl=s$._readData.pos;s$._readData.pos=sd+s$._DATA.offset;for(var sZ=0;sZ<sL;sZ++)s$._strings[sZ]=s$._readData.readUTFString();s$._readData.pos=sl},s$.READ_MATERIAL=function(){s$._readString(),s$._readString();var sd=s$._readString();return""!==sd&&s$._materials.push(sk.getRes(s$._materialMap[sd])),!0},s$.READ_MESH=function(){s$._readString();var sd,sL=s$._readData.__getBuffer(),sl=0,sZ=s$._readData.getInt16(),sh=s$._DATA.offset;for(sl=0;sl<sZ;sl++){var s_=sh+s$._readData.getUint32(),sN=s$._readData.getUint32(),sm=new Float32Array(sL.slice(s_,s_+sN)),su=s$._readString().match(s$._attrReg),sx=s$._getVertexDeclaration(su),st=siL.create(sx,4*sm.length/sx.vertexStride,35044,!0);st.setData(sm),s$._mesh._vertexBuffers.push(st)}var sb=sh+s$._readData.getUint32(),sq=s$._readData.getUint32(),sY=new Uint16Array(sL.slice(sb,sb+sq)),sc=soL.create("ushort",sq/2,35044,!0);sc.setData(sY),s$._mesh._indexBuffer=sc;var sr=s$._mesh._boneNames=[],sa=s$._readData.getUint16();for(sr.length=sa,sl=0;sl<sa;sl++)sr[sl]=s$._strings[s$._readData.getUint16()];var sk=s$._readData.getUint32(),se=s$._readData.getUint32(),sw=(new Float32Array(sL.slice(sh+sk,sh+sk+se)),s$._readData.getUint32()),ss=s$._readData.getUint32(),sA=new Float32Array(sL.slice(sh+sw,sh+sw+ss));for(s$._mesh._inverseBindPoses=[],sl=0,sd=sA.length;sl<sd;sl+=16){var sy=new sdL(sA[sl+0],sA[sl+1],sA[sl+2],sA[sl+3],sA[sl+4],sA[sl+5],sA[sl+6],sA[sl+7],sA[sl+8],sA[sl+9],sA[sl+10],sA[sl+11],sA[sl+12],sA[sl+13],sA[sl+14],sA[sl+15]);s$._mesh._inverseBindPoses.push(sy)}return s$._mesh._skinnedDatas=new Float32Array(16*sA.length),!0},s$.READ_SUBMESH=function(){var sd=s$._readData.__getBuffer(),sL=new sxL(s$._mesh),sl=s$._readData.getInt16(),sZ=s$._readData.getUint32(),sh=s$._readData.getUint32();sL._vertexBuffer=s$._mesh._vertexBuffers[sl],sL._vertexStart=sZ,sL._vertexCount=sh;var s_=s$._readData.getUint32(),sN=s$._readData.getUint32(),sm=s$._mesh._indexBuffer;sL._indexBuffer=sm,sL._indexStart=s_,sL._indexCount=sN,sL._indices=new Uint16Array(sm.getData().buffer,2*s_,sN);var su=s$._DATA.offset,sx=sL._subIndexBufferStart,st=sL._subIndexBufferCount,sb=sL._boneIndicesList,sq=s$._readData.getUint16();sx.length=sq,st.length=sq,sb.length=sq;for(var sY=0;sY<sq;sY++){sx[sY]=s$._readData.getUint32(),st[sY]=s$._readData.getUint32();var sc=s$._readData.getUint32(),sr=s$._readData.getUint32();sL._boneIndicesList[sY]=new Uint8Array(sd.slice(su+sc,su+sc+sr))}return s$._subMeshes.push(sL),!0},s$._getVertexDeclaration=function(sd){for(var sL,sl=!1,sZ=!1,sh=!1,s_=!1,sN=!1,sm=!1,su=!1,sx=!1,st=!1,sb=0;sb<sd.length;sb++)switch(sd[sb]){case"POSITION":sl=!0;break;case"NORMAL":sZ=!0;break;case"COLOR":sh=!0;break;case"UV":s_=!0;break;case"UV1":sN=!0;break;case"BLENDWEIGHT":su=!0;break;case"BLENDINDICES":sx=!0;break;case"TANGENT":sm=!0;break;case"BINORMAL":st=!0}return sl&&sZ&&sh&&s_&&sN&&su&&sx&&sm?sL=swd.vertexDeclaration:sl&&sZ&&sh&&s_&&sN&&su&&sx?sL=skd.vertexDeclaration:sl&&sZ&&s_&&sN&&su&&sx&&sm?sL=sHd.vertexDeclaration:sl&&sZ&&s_&&sN&&su&&sx?sL=sId.vertexDeclaration:sl&&sZ&&sh&&s_&&su&&sx&&sm?sL=sOd.vertexDeclaration:sl&&sZ&&sh&&s_&&su&&sx?sL=syd.vertexDeclaration:sl&&sZ&&s_&&su&&sx&&sm?sL=sid.vertexDeclaration:sl&&sZ&&s_&&su&&sx?sL=sRd.vertexDeclaration:sl&&sZ&&sh&&su&&sx&&sm?sL=sqd.vertexDeclaration:sl&&sZ&&sh&&su&&sx?sL=std.vertexDeclaration:sl&&sZ&&sh&&s_&&sN&&sm?sL=sAd.vertexDeclaration:sl&&sZ&&sh&&s_&&sN?sL=sad.vertexDeclaration:sl&&sZ&&s_&&sN&&sm?sL=sjd.vertexDeclaration:sl&&sZ&&s_&&sN?sL=sEd.vertexDeclaration:sl&&sZ&&sh&&s_&&sm?sL=sVd.vertexDeclaration:sl&&sZ&&s_&&sm&&st?sL=sCd.vertexDeclaration:sl&&sZ&&sh&&s_?sL=srd.vertexDeclaration:sl&&sZ&&s_&&sm?sL=sBd.vertexDeclaration:sl&&sZ&&s_?sL=sFd.vertexDeclaration:sl&&sZ&&sh&&sm?sL=scd.vertexDeclaration:sl&&sZ&&sh&&(sL=sxd.vertexDeclaration),sL},s$._attrReg=new RegExp("(\\w+)|([:,;])","g"),s$._strings=[],s$._readData=null,s$._version=null,s$._mesh=null,s$._materials=null,s$._subMeshes=null,s$._materialMap=null,sb(s$,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),s$}(),sKd=function(){function sy(){}return sY(sy,"laya.d3.loaders.LoadModelV03"),sy.parse=function(sd,sL,sl,sZ,sh){sy._mesh=sl,sy._subMeshes=sZ,sy._materialMap=sh,sy._version=sL,sy._readData=sd,sy.READ_DATA(),sy.READ_BLOCK(),sy.READ_STRINGS();for(var s_=0,sN=sy._BLOCK.count;s_<sN;s_++){sy._readData.pos=sy._BLOCK.blockStarts[s_];var sm=sy._readData.getUint16(),su=sy._strings[sm],sx=sy["READ_"+su];if(null==sx)throw new Error("model file err,no this function:"+sm+" "+su);sx.call()}sy._strings.length=0,sy._readData=null,sy._version=null,sy._mesh=null,sy._subMeshes=null,sy._materialMap=null},sy._readString=function(){return sy._strings[sy._readData.getUint16()]},sy.READ_DATA=function(){sy._DATA.offset=sy._readData.getUint32(),sy._DATA.size=sy._readData.getUint32()},sy.READ_BLOCK=function(){for(var sd=sy._BLOCK.count=sy._readData.getUint16(),sL=sy._BLOCK.blockStarts=[],sl=sy._BLOCK.blockLengths=[],sZ=0;sZ<sd;sZ++)sL.push(sy._readData.getUint32()),sl.push(sy._readData.getUint32())},sy.READ_STRINGS=function(){var sd=sy._readData.getUint32(),sL=sy._readData.getUint16(),sl=sy._readData.pos;sy._readData.pos=sd+sy._DATA.offset;for(var sZ=0;sZ<sL;sZ++)sy._strings[sZ]=sy._readData.readUTFString();sy._readData.pos=sl},sy.READ_MESH=function(){var sd,sL=sy._readString(),sl=sy._readData.__getBuffer(),sZ=0,sh=sy._readData.getInt16(),s_=sy._DATA.offset;for(sZ=0;sZ<sh;sZ++){var sN,sm=s_+sy._readData.getUint32(),su=sy._readData.getUint32(),sx=new Float32Array(sl.slice(sm,sm+su)),st=sy._readString();switch(sy._version){case"LAYAMODEL:03":sN=sy._vertexDeclarationMap_Discard[st];break;case"LAYAMODEL:0301":sN=sy._vertexDeclarationMap[st];break;default:throw new Error("LoadModelV03: unknown version.")}if(!sN)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+sy._version+"  bufferAttribute="+st+"  name="+sL+"  url="+(sy._mesh?sy._mesh.url:"null"));var sb=siL.create(sN,4*sx.length/sN.vertexStride,35044,!0,sy._mesh._url+"_"+sZ);sb.setData(sx),sy._mesh._vertexBuffers.push(sb)}var sq=s_+sy._readData.getUint32(),sY=sy._readData.getUint32(),sc=new Uint16Array(sl.slice(sq,sq+sY)),sr=soL.create("ushort",sY/2,35044,!0,sy._mesh._url);sr.setData(sc),sy._mesh._indexBuffer=sr;var sa=sy._mesh._boneNames=[],sk=sy._readData.getUint16();for(sa.length=sk,sZ=0;sZ<sk;sZ++)sa[sZ]=sy._strings[sy._readData.getUint16()];sy._readData.pos+=8;var se=sy._readData.getUint32(),sw=sy._readData.getUint32(),ss=new Float32Array(sl.slice(s_+se,s_+se+sw));for(sy._mesh._inverseBindPoses=[],sZ=0,sd=ss.length;sZ<sd;sZ+=16){var sA=new sdL(ss[sZ+0],ss[sZ+1],ss[sZ+2],ss[sZ+3],ss[sZ+4],ss[sZ+5],ss[sZ+6],ss[sZ+7],ss[sZ+8],ss[sZ+9],ss[sZ+10],ss[sZ+11],ss[sZ+12],ss[sZ+13],ss[sZ+14],ss[sZ+15]);sy._mesh._inverseBindPoses.push(sA)}return sy._mesh._skinnedDatas=new Float32Array(16*ss.length),!0},sy.READ_SUBMESH=function(){var sd=sy._readData.__getBuffer(),sL=new sxL(sy._mesh),sl=sy._readData.getInt16(),sZ=sy._readData.getUint32(),sh=sy._readData.getUint32();sL._vertexBuffer=sy._mesh._vertexBuffers[sl],sL._vertexStart=sZ,sL._vertexCount=sh;var s_=sy._readData.getUint32(),sN=sy._readData.getUint32(),sm=sy._mesh._indexBuffer;sL._indexBuffer=sm,sL._indexStart=s_,sL._indexCount=sN,sL._indices=new Uint16Array(sm.getData().buffer,2*s_,sN);var su=sy._DATA.offset,sx=sL._subIndexBufferStart,st=sL._subIndexBufferCount,sb=sL._boneIndicesList,sq=sy._readData.getUint16();sx.length=sq,st.length=sq,sb.length=sq;for(var sY=0;sY<sq;sY++){sx[sY]=sy._readData.getUint32(),st[sY]=sy._readData.getUint32();var sc=sy._readData.getUint32(),sr=sy._readData.getUint32();sb[sY]=new Uint8Array(sd.slice(su+sc,su+sc+sr))}return sy._subMeshes.push(sL),!0},sy._strings=[],sy._readData=null,sy._version=null,sy._mesh=null,sy._subMeshes=null,sy._materialMap=null,sb(sy,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":swd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":skd.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":sPd.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":sHd.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":sId.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":sOd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":syd.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":sid.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":sRd.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":sqd.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":std.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":sAd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":sad.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":sjd.vertexDeclaration,"POSITION,NORMAL,UV,UV1":sEd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":sVd.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":sCd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":srd.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":sBd.vertexDeclaration,"POSITION,NORMAL,UV":sFd.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":scd.vertexDeclaration,"POSITION,NORMAL,COLOR":sxd.vertexDeclaration,"POSITION,NORMAL,TANGENT":sgd.vertexDeclaration,"POSITION,NORMAL":sud.vertexDeclaration,"POSITION,UV":szd.vertexDeclaration,POSITION:smd.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":sed.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":skd.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":sPd.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":spd.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":sId.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":s$d.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":syd.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":sod.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":sRd.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":sbd.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":std.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":ssd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":sad.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":sXd.vertexDeclaration,"POSITION,NORMAL,UV,UV1":sEd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":snd.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":sCd.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":srd.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":sSd.vertexDeclaration,"POSITION,NORMAL,UV":sFd.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":sYd.vertexDeclaration,"POSITION,NORMAL,COLOR":sxd.vertexDeclaration,"POSITION,NORMAL,TANGENT":sQd.vertexDeclaration,"POSITION,NORMAL":sud.vertexDeclaration,"POSITION,UV":szd.vertexDeclaration,POSITION:smd.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),sy}(),svd=function(){function sm(){}return sY(sm,"laya.d3.loaders.MeshReader"),sm.read=function(sd,sL,sl,sZ,sh){var s_=new sy(sd);s_.pos=0;var sN=s_.readUTFString();switch(sN){case"LAYAMODEL:01":case"LAYASKINANI:01":sm._readVersion01(s_,sN,sL,sl,sZ,sh);break;case"LAYAMODEL:02":sGd.parse(s_,sN,sL,sl,sZ,sh);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":sKd.parse(s_,sN,sL,sZ,sh);break;default:throw new Error("MeshReader: unknown mesh version.")}sL._setSubMeshes(sZ)},sm._readVersion01=function(sd,sL,sl,sZ,sh,s_){new sDd(sd,sL,sl,sZ,sh,s_)},sm}(),sJd=function(){function sd(sd,sL){this.min=null,this.max=null,this.min=sd,this.max=sL}sY(sd,"laya.d3.math.BoundBox");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.getCorners=function(sd){sd.length=8;var sL=this.min.elements,sl=this.max.elements,sZ=sL[0],sh=sL[1],s_=sL[2],sN=sl[0],sm=sl[1],su=sl[2];sd[0]=new sNL(sZ,sm,su),sd[1]=new sNL(sN,sm,su),sd[2]=new sNL(sN,sh,su),sd[3]=new sNL(sZ,sh,su),sd[4]=new sNL(sZ,sm,s_),sd[5]=new sNL(sN,sm,s_),sd[6]=new sNL(sN,sh,s_),sd[7]=new sNL(sZ,sh,s_)},sL.toDefault=function(){this.min.toDefault(),this.max.toDefault()},sL.cloneTo=function(sd){var sL=sd;this.min.cloneTo(sL.min),this.max.cloneTo(sL.max)},sL.clone=function(){var sd=new this.constructor(new sNL,new sNL);return this.cloneTo(sd),sd},sd.createfromPoints=function(sd,sL){if(null==sd)throw new Error("points");var sl=sL.min,sZ=sL.max,sh=sl.elements;sh[0]=Number.MAX_VALUE,sh[1]=Number.MAX_VALUE,sh[2]=Number.MAX_VALUE;var s_=sZ.elements;s_[0]=-Number.MAX_VALUE,s_[1]=-Number.MAX_VALUE,s_[2]=-Number.MAX_VALUE;for(var sN=0,sm=sd.length;sN<sm;++sN)sNL.min(sl,sd[sN],sl),sNL.max(sZ,sd[sN],sZ)},sd.merge=function(sd,sL,sl){sNL.min(sd.min,sL.min,sl.min),sNL.max(sd.max,sL.max,sl.max)},sd}(),sfd=function(){function sx(sd){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=sd,this._near=new sLL(new sNL),this._far=new sLL(new sNL),this._left=new sLL(new sNL),this._right=new sLL(new sNL),this._top=new sLL(new sNL),this._bottom=new sLL(new sNL),sx._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}sY(sx,"laya.d3.math.BoundFrustum");var sd=sx.prototype;return sd.equalsBoundFrustum=function(sd){return this._matrix.equalsOtherMatrix(sd.matrix)},sd.equalsObj=function(sd){if(sd instanceof laya.d3.math.BoundFrustum){var sL=sd;return this.equalsBoundFrustum(sL)}return!1},sd.getPlane=function(sd){switch(sd){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},sd.getCorners=function(sd){sx._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(sd[0]),sx._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(sd[1]),sx._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(sd[2]),sx._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(sd[3]),sx._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(sd[4]),sx._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(sd[5]),sx._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(sd[6]),sx._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(sd[7])},sd.containsPoint=function(sd){for(var sL=sLL.PlaneIntersectionType_Front,sl=sLL.PlaneIntersectionType_Front,sZ=0;sZ<6;sZ++){switch(sZ){case 0:sl=Collision.intersectsPlaneAndPoint(this._near,sd);break;case 1:sl=Collision.intersectsPlaneAndPoint(this._far,sd);break;case 2:sl=Collision.intersectsPlaneAndPoint(this._left,sd);break;case 3:sl=Collision.intersectsPlaneAndPoint(this._right,sd);break;case 4:sl=Collision.intersectsPlaneAndPoint(this._top,sd);break;case 5:sl=Collision.intersectsPlaneAndPoint(this._bottom,sd)}switch(sl){case sLL.PlaneIntersectionType_Back:return 0;case sLL.PlaneIntersectionType_Intersecting:sL=sLL.PlaneIntersectionType_Intersecting}}switch(sL){case sLL.PlaneIntersectionType_Intersecting:return 2;default:return 1}},sd.containsBoundBox=function(sd){for(var sL,sl=sx._tempV30,sZ=sx._tempV31,sh=1,s_=0;s_<6;s_++){if(sL=this.getPlane(s_),this._getBoxToPlanePVertexNVertex(sd,sL.normal,sl,sZ),Collision.intersectsPlaneAndPoint(sL,sl)===sLL.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(sL,sZ)===sLL.PlaneIntersectionType_Back&&(sh=2)}return sh},sd.containsBoundSphere=function(sd){for(var sL=sLL.PlaneIntersectionType_Front,sl=sLL.PlaneIntersectionType_Front,sZ=0;sZ<6;sZ++){switch(sZ){case 0:sl=Collision.intersectsPlaneAndSphere(this._near,sd);break;case 1:sl=Collision.intersectsPlaneAndSphere(this._far,sd);break;case 2:sl=Collision.intersectsPlaneAndSphere(this._left,sd);break;case 3:sl=Collision.intersectsPlaneAndSphere(this._right,sd);break;case 4:sl=Collision.intersectsPlaneAndSphere(this._top,sd);break;case 5:sl=Collision.intersectsPlaneAndSphere(this._bottom,sd)}switch(sl){case sLL.PlaneIntersectionType_Back:return 0;case sLL.PlaneIntersectionType_Intersecting:sL=sLL.PlaneIntersectionType_Intersecting}}switch(sL){case sLL.PlaneIntersectionType_Intersecting:return 2;default:return 1}},sd._getBoxToPlanePVertexNVertex=function(sd,sL,sl,sZ){var sh=sd.min,s_=sh.elements,sN=sd.max,sm=sN.elements,su=sL.elements,sx=su[0],st=su[1],sb=su[2];sh.cloneTo(sl);var sq=sl.elements;0<=sx&&(sq[0]=sm[0]),0<=st&&(sq[1]=sm[1]),0<=sb&&(sq[2]=sm[2]),sN.cloneTo(sZ);var sY=sZ.elements;0<=sx&&(sY[0]=s_[0]),0<=st&&(sY[1]=s_[1]),0<=sb&&(sY[2]=s_[2])},sc(0,sd,"top",function(){return this._top}),sc(0,sd,"matrix",function(){return this._matrix},function(sd){this._matrix=sd,sx._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),sc(0,sd,"near",function(){return this._near}),sc(0,sd,"far",function(){return this._far}),sc(0,sd,"left",function(){return this._left}),sc(0,sd,"right",function(){return this._right}),sc(0,sd,"bottom",function(){return this._bottom}),sx._getPlanesFromMatrix=function(sd,sL,sl,sZ,sh,s_,sN){var sm=sd.elements,su=sm[0],sx=sm[1],st=sm[2],sb=sm[3],sq=sm[4],sY=sm[5],sc=sm[6],sr=sm[7],sa=sm[8],sk=sm[9],se=sm[10],sw=sm[11],ss=sm[12],sA=sm[13],sy=sm[14],s$=sm[15],sO=sL.normal.elements;sO[0]=sb+st,sO[1]=sr+sc,sO[2]=sw+se,sL.distance=s$+sy,sL.normalize();var sn=sl.normal.elements;sn[0]=sb-st,sn[1]=sr-sc,sn[2]=sw-se,sl.distance=s$-sy,sl.normalize();var sV=sZ.normal.elements;sV[0]=sb+su,sV[1]=sr+sq,sV[2]=sw+sa,sZ.distance=s$+ss,sZ.normalize();var sQ=sh.normal.elements;sQ[0]=sb-su,sQ[1]=sr-sq,sQ[2]=sw-sa,sh.distance=s$-ss,sh.normalize();var sg=s_.normal.elements;sg[0]=sb-sx,sg[1]=sr-sY,sg[2]=sw-sk,s_.distance=s$-sA,s_.normalize();var sF=sN.normal.elements;sF[0]=sb+sx,sF[1]=sr+sY,sF[2]=sw+sk,sN.distance=s$+sA,sN.normalize()},sx._get3PlaneInterPoint=function(sd,sL,sl){var sZ=sd.normal,sh=sL.normal,s_=sl.normal;sNL.cross(sh,s_,sx._tempV30),sNL.cross(s_,sZ,sx._tempV31),sNL.cross(sZ,sh,sx._tempV32);var sN=sNL.dot(sZ,sx._tempV30),sm=sNL.dot(sh,sx._tempV31),su=sNL.dot(s_,sx._tempV32);return sNL.scale(sx._tempV30,-sd.distance/sN,sx._tempV33),sNL.scale(sx._tempV31,-sL.distance/sm,sx._tempV34),sNL.scale(sx._tempV32,-sl.distance/su,sx._tempV35),sNL.add(sx._tempV33,sx._tempV34,sx._tempV36),sNL.add(sx._tempV35,sx._tempV36,sx._tempV37),sx._tempV37},sb(sx,["_tempV30",function(){return this._tempV30=new sNL},"_tempV31",function(){return this._tempV31=new sNL},"_tempV32",function(){return this._tempV32=new sNL},"_tempV33",function(){return this._tempV33=new sNL},"_tempV34",function(){return this._tempV34=new sNL},"_tempV35",function(){return this._tempV35=new sNL},"_tempV36",function(){return this._tempV36=new sNL},"_tempV37",function(){return this._tempV37=new sNL}]),sx}(),sUd=function(){function st(sd,sL){this.center=null,this.radius=NaN,this.center=sd,this.radius=sL}sY(st,"laya.d3.math.BoundSphere");var sd=st.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.toDefault=function(){this.center.toDefault(),this.radius=0},sd.intersectsRayDistance=function(sd){return Collision.intersectsRayAndSphereRD(sd,this)},sd.intersectsRayPoint=function(sd,sL){return Collision.intersectsRayAndSphereRP(sd,this,sL)},sd.cloneTo=function(sd){var sL=sd;this.center.cloneTo(sL.center),sL.radius=this.radius},sd.clone=function(){var sd=new this.constructor(new sNL,new sNL);return this.cloneTo(sd),sd},st.createFromSubPoints=function(sd,sL,sl,sZ){if(null==sd)throw new Error("points");if(sL<0||sL>=sd.length)throw new Error("start"+sL+"Must be in the range [0, "+(sd.length-1)+"]");if(sl<0||sL+sl>sd.length)throw new Error("count"+sl+"Must be in the range <= "+sd.length+"}");var sh=sL+sl,s_=st._tempVector3;s_.elements[0]=0,s_.elements[1]=0,s_.elements[2]=0;for(var sN=sL;sN<sh;++sN)sNL.add(sd[sN],s_,s_);var sm=sZ.center;sNL.scale(s_,1/sl,sm);var su=0;for(sN=sL;sN<sh;++sN){var sx=sNL.distanceSquared(sm,sd[sN]);su<sx&&(su=sx)}sZ.radius=Math.sqrt(su)},st.createfromPoints=function(sd,sL){if(null==sd)throw new Error("points");st.createFromSubPoints(sd,0,sd.length,sL)},sb(st,["_tempVector3",function(){return this._tempVector3=new sNL}]),st}(),sWd=(function(){function sd(){}sY(sd,"laya.d3.math.ContainmentType"),sd.Disjoint=0,sd.Contains=1,sd.Intersects=2}(),function(){function sl(){}return sY(sl,"laya.d3.math.MathUtils3D"),sl.isZero=function(sd){return Math.abs(sd)<sl.zeroTolerance},sl.nearEqual=function(sd,sL){return!!sl.isZero(sd-sL)},sl.fastInvSqrt=function(sd){return sl.isZero(sd)?sd:1/Math.sqrt(sd)},sb(sl,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),sl}()),sMd=function(){function su(){var sd=this.elements=new Float32Array(9);sd[0]=1,sd[1]=0,sd[2]=0,sd[3]=0,sd[4]=1,sd[5]=0,sd[6]=0,sd[7]=0,sd[8]=1}sY(su,"laya.d3.math.Matrix3x3");var sd=su.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.determinant=function(){var sd=this.elements,sL=sd[0],sl=sd[1],sZ=sd[2],sh=sd[3],s_=sd[4],sN=sd[5],sm=sd[6],su=sd[7],sx=sd[8];return sL*(sx*s_-sN*su)+sl*(-sx*sh+sN*sm)+sZ*(su*sh-s_*sm)},sd.translate=function(sd,sL){var sl=sL.elements,sZ=this.elements,sh=sd.elements,s_=sZ[0],sN=sZ[1],sm=sZ[2],su=sZ[3],sx=sZ[4],st=sZ[5],sb=sZ[6],sq=sZ[7],sY=sZ[8],sc=sh[0],sr=sh[1];sl[0]=s_,sl[1]=sN,sl[2]=sm,sl[3]=su,sl[4]=sx,sl[5]=st,sl[6]=sc*s_+sr*su+sb,sl[7]=sc*sN+sr*sx+sq,sl[8]=sc*sm+sr*st+sY},sd.rotate=function(sd,sL){var sl=sL.elements,sZ=this.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sZ[3],su=sZ[4],sx=sZ[5],st=sZ[6],sb=sZ[7],sq=sZ[8],sY=Math.sin(sd),sc=Math.cos(sd);sl[0]=sc*sh+sY*sm,sl[1]=sc*s_+sY*su,sl[2]=sc*sN+sY*sx,sl[3]=sc*sm-sY*sh,sl[4]=sc*su-sY*s_,sl[5]=sc*sx-sY*sN,sl[6]=st,sl[7]=sb,sl[8]=sq},sd.scale=function(sd,sL){var sl=sL.elements,sZ=this.elements,sh=sd.elements,s_=sh[0],sN=sh[1];sl[0]=s_*sZ[0],sl[1]=s_*sZ[1],sl[2]=s_*sZ[2],sl[3]=sN*sZ[3],sl[4]=sN*sZ[4],sl[5]=sN*sZ[5],sl[6]=sZ[6],sl[7]=sZ[7],sl[8]=sZ[8]},sd.invert=function(sd){var sL=sd.elements,sl=this.elements,sZ=sl[0],sh=sl[1],s_=sl[2],sN=sl[3],sm=sl[4],su=sl[5],sx=sl[6],st=sl[7],sb=sl[8],sq=sb*sm-su*st,sY=-sb*sN+su*sx,sc=st*sN-sm*sx,sr=sZ*sq+sh*sY+s_*sc;sr||(sd=null),sr=1/sr,sL[0]=sq*sr,sL[1]=(-sb*sh+s_*st)*sr,sL[2]=(su*sh-s_*sm)*sr,sL[3]=sY*sr,sL[4]=(sb*sZ-s_*sx)*sr,sL[5]=(-su*sZ+s_*sN)*sr,sL[6]=sc*sr,sL[7]=(-st*sZ+sh*sx)*sr,sL[8]=(sm*sZ-sh*sN)*sr},sd.transpose=function(sd){var sL=sd.elements,sl=this.elements;if(sd===this){var sZ=sl[1],sh=sl[2],s_=sl[5];sL[1]=sl[3],sL[2]=sl[6],sL[3]=sZ,sL[5]=sl[7],sL[6]=sh,sL[7]=s_}else sL[0]=sl[0],sL[1]=sl[3],sL[2]=sl[6],sL[3]=sl[1],sL[4]=sl[4],sL[5]=sl[7],sL[6]=sl[2],sL[7]=sl[5],sL[8]=sl[8]},sd.identity=function(){var sd=this.elements;sd[0]=1,sd[1]=0,sd[2]=0,sd[3]=0,sd[4]=1,sd[5]=0,sd[6]=0,sd[7]=0,sd[8]=1},sd.cloneTo=function(sd){var sL,sl,sZ;if((sl=this.elements)!==(sZ=sd.elements))for(sL=0;sL<9;++sL)sZ[sL]=sl[sL]},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},su.createFromTranslation=function(sd,sL){sL.elements;var sl=sd.elements;sL[0]=1,sL[1]=0,sL[2]=0,sL[3]=0,sL[4]=1,sL[5]=0,sL[6]=sl[0],sL[7]=sl[1],sL[8]=1},su.createFromRotation=function(sd,sL){var sl=sL.elements,sZ=Math.sin(sd),sh=Math.cos(sd);sl[0]=sh,sl[1]=sZ,sl[2]=0,sl[3]=-sZ,sl[4]=sh,sl[5]=0,sl[6]=0,sl[7]=0,sl[8]=1},su.createFromScaling=function(sd,sL){var sl=sL.elements,sZ=sd.elements;sl[0]=sZ[0],sl[1]=0,sl[2]=0,sl[3]=0,sl[4]=sZ[1],sl[5]=0,sl[6]=0,sl[7]=0,sl[8]=1},su.createFromMatrix4x4=function(sd,sL){sL[0]=sd[0],sL[1]=sd[1],sL[2]=sd[2],sL[3]=sd[4],sL[4]=sd[5],sL[5]=sd[6],sL[6]=sd[8],sL[7]=sd[9],sL[8]=sd[10]},su.multiply=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements,sN=sh[0],sm=sh[1],su=sh[2],sx=sh[3],st=sh[4],sb=sh[5],sq=sh[6],sY=sh[7],sc=sh[8],sr=s_[0],sa=s_[1],sk=s_[2],se=s_[3],sw=s_[4],ss=s_[5],sA=s_[6],sy=s_[7],s$=s_[8];sZ[0]=sr*sN+sa*sx+sk*sq,sZ[1]=sr*sm+sa*st+sk*sY,sZ[2]=sr*su+sa*sb+sk*sc,sZ[3]=se*sN+sw*sx+ss*sq,sZ[4]=se*sm+sw*st+ss*sY,sZ[5]=se*su+sw*sb+ss*sc,sZ[6]=sA*sN+sy*sx+s$*sq,sZ[7]=sA*sm+sy*st+s$*sY,sZ[8]=sA*su+sy*sb+s$*sc},su.lookAt=function(sd,sL,sl,sZ){sNL.subtract(sd,sL,su._tempV30),sNL.normalize(su._tempV30,su._tempV30),sNL.cross(sl,su._tempV30,su._tempV31),sNL.normalize(su._tempV31,su._tempV31),sNL.cross(su._tempV30,su._tempV31,su._tempV32);var sh=su._tempV30.elements,s_=su._tempV31.elements,sN=su._tempV32.elements,sm=sZ.elements;sm[0]=s_[0],sm[3]=s_[1],sm[6]=s_[2],sm[1]=sN[0],sm[4]=sN[1],sm[7]=sN[2],sm[2]=sh[0],sm[5]=sh[1],sm[8]=sh[2]},su.DEFAULT=new su,sb(su,["_tempV30",function(){return this._tempV30=new sNL},"_tempV31",function(){return this._tempV31=new sNL},"_tempV32",function(){return this._tempV32=new sNL}]),su}(),sdL=function(){function sn(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb,sq,sY,sc,sr){void 0===sd&&(sd=1),void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===s_&&(s_=1),void 0===sN&&(sN=0),void 0===sm&&(sm=0),void 0===su&&(su=0),void 0===sx&&(sx=0),void 0===st&&(st=1),void 0===sb&&(sb=0),void 0===sq&&(sq=0),void 0===sY&&(sY=0),void 0===sc&&(sc=0),void 0===sr&&(sr=1);var sa=this.elements=new Float32Array(16);sa[0]=sd,sa[1]=sL,sa[2]=sl,sa[3]=sZ,sa[4]=sh,sa[5]=s_,sa[6]=sN,sa[7]=sm,sa[8]=su,sa[9]=sx,sa[10]=st,sa[11]=sb,sa[12]=sq,sa[13]=sY,sa[14]=sc,sa[15]=sr}sY(sn,"laya.d3.math.Matrix4x4");var sd=sn.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.getElementByRowColumn=function(sd,sL){if(sd<0||3<sd)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(sL<0||3<sL)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*sd+sL]},sd.setElementByRowColumn=function(sd,sL,sl){if(sd<0||3<sd)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(sL<0||3<sL)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*sd+sL]=sl},sd.equalsOtherMatrix=function(sd){var sL=this.elements,sl=sd.elements;return sWd.nearEqual(sL[0],sl[0])&&sWd.nearEqual(sL[1],sl[1])&&sWd.nearEqual(sL[2],sl[2])&&sWd.nearEqual(sL[3],sl[3])&&sWd.nearEqual(sL[4],sl[4])&&sWd.nearEqual(sL[5],sl[5])&&sWd.nearEqual(sL[6],sl[6])&&sWd.nearEqual(sL[7],sl[7])&&sWd.nearEqual(sL[8],sl[8])&&sWd.nearEqual(sL[9],sl[9])&&sWd.nearEqual(sL[10],sl[10])&&sWd.nearEqual(sL[11],sl[11])&&sWd.nearEqual(sL[12],sl[12])&&sWd.nearEqual(sL[13],sl[13])&&sWd.nearEqual(sL[14],sl[14])&&sWd.nearEqual(sL[15],sl[15])},sd.decomposeTransRotScale=function(sd,sL,sl){var sZ=sn._tempMatrix4x4;return this.decomposeTransRotMatScale(sd,sZ,sl)?(slL.createFromMatrix4x4(sZ,sL),!0):(sL.identity(),!1)},sd.decomposeTransRotMatScale=function(sd,sL,sl){var sZ=this.elements,sh=sd.elements,s_=sL.elements,sN=sl.elements;sh[0]=sZ[12],sh[1]=sZ[13],sh[2]=sZ[14];var sm=sZ[0],su=sZ[1],sx=sZ[2],st=sZ[4],sb=sZ[5],sq=sZ[6],sY=sZ[8],sc=sZ[9],sr=sZ[10],sa=sN[0]=Math.sqrt(sm*sm+su*su+sx*sx),sk=sN[1]=Math.sqrt(st*st+sb*sb+sq*sq),se=sN[2]=Math.sqrt(sY*sY+sc*sc+sr*sr);if(sWd.isZero(sa)||sWd.isZero(sk)||sWd.isZero(se))return s_[1]=s_[2]=s_[3]=s_[4]=s_[6]=s_[7]=s_[8]=s_[9]=s_[11]=s_[12]=s_[13]=s_[14]=0,s_[0]=s_[5]=s_[10]=s_[15]=1,!1;var sw=sn._tempVector0,ss=sw.elements;ss[0]=sY/se,ss[1]=sc/se,ss[2]=sr/se;var sA=sn._tempVector1,sy=sA.elements;sy[0]=sm/sa,sy[1]=su/sa,sy[2]=sx/sa;var s$=sn._tempVector2;sNL.cross(sw,sA,s$);var sO=sn._tempVector1;return sNL.cross(s$,sw,sO),s_[3]=s_[7]=s_[11]=s_[12]=s_[13]=s_[14]=0,s_[15]=1,s_[0]=sO.x,s_[1]=sO.y,s_[2]=sO.z,s_[4]=s$.x,s_[5]=s$.y,s_[6]=s$.z,s_[8]=sw.x,s_[9]=sw.y,s_[10]=sw.z,s_[0]*sm+s_[1]*su+s_[2]*sx<0&&(sN[0]=-sa),s_[4]*st+s_[5]*sb+s_[6]*sq<0&&(sN[1]=-sk),s_[8]*sY+s_[9]*sc+s_[10]*sr<0&&(sN[2]=-se),!0},sd.decomposeYawPitchRoll=function(sd){var sL=sd.elements,sl=Math.asin(-this.elements[9]);sL[1]=sl,Math.cos(sl)>sWd.zeroTolerance?(sL[2]=Math.atan2(this.elements[1],this.elements[5]),sL[0]=Math.atan2(this.elements[8],this.elements[10])):(sL[2]=Math.atan2(-this.elements[4],this.elements[0]),sL[0]=0)},sd.normalize=function(){var sd=this.elements,sL=sd[0],sl=sd[1],sZ=sd[2],sh=Math.sqrt(sL*sL+sl*sl+sZ*sZ);if(!sh)return sd[0]=0,sd[1]=0,void(sd[2]=0);1!=sh&&(sh=1/sh,sd[0]=sL*sh,sd[1]=sl*sh,sd[2]=sZ*sh)},sd.transpose=function(){var sd,sL;return sL=(sd=this.elements)[1],sd[1]=sd[4],sd[4]=sL,sL=sd[2],sd[2]=sd[8],sd[8]=sL,sL=sd[3],sd[3]=sd[12],sd[12]=sL,sL=sd[6],sd[6]=sd[9],sd[9]=sL,sL=sd[7],sd[7]=sd[13],sd[13]=sL,sL=sd[11],sd[11]=sd[14],sd[14]=sL,this},sd.invert=function(sd){var sL=this.elements,sl=sd.elements,sZ=sL[0],sh=sL[1],s_=sL[2],sN=sL[3],sm=sL[4],su=sL[5],sx=sL[6],st=sL[7],sb=sL[8],sq=sL[9],sY=sL[10],sc=sL[11],sr=sL[12],sa=sL[13],sk=sL[14],se=sL[15],sw=sZ*su-sh*sm,ss=sZ*sx-s_*sm,sA=sZ*st-sN*sm,sy=sh*sx-s_*su,s$=sh*st-sN*su,sO=s_*st-sN*sx,sn=sb*sa-sq*sr,sV=sb*sk-sY*sr,sQ=sb*se-sc*sr,sg=sq*sk-sY*sa,sF=sq*se-sc*sa,sE=sY*se-sc*sk,sI=sw*sE-ss*sF+sA*sg+sy*sQ-s$*sV+sO*sn;0!==Math.abs(sI)&&(sI=1/sI,sl[0]=(su*sE-sx*sF+st*sg)*sI,sl[1]=(s_*sF-sh*sE-sN*sg)*sI,sl[2]=(sa*sO-sk*s$+se*sy)*sI,sl[3]=(sY*s$-sq*sO-sc*sy)*sI,sl[4]=(sx*sQ-sm*sE-st*sV)*sI,sl[5]=(sZ*sE-s_*sQ+sN*sV)*sI,sl[6]=(sk*sA-sr*sO-se*ss)*sI,sl[7]=(sb*sO-sY*sA+sc*ss)*sI,sl[8]=(sm*sF-su*sQ+st*sn)*sI,sl[9]=(sh*sQ-sZ*sF-sN*sn)*sI,sl[10]=(sr*s$-sa*sA+se*sw)*sI,sl[11]=(sq*sA-sb*s$-sc*sw)*sI,sl[12]=(su*sV-sm*sg-sx*sn)*sI,sl[13]=(sZ*sg-sh*sV+s_*sn)*sI,sl[14]=(sa*ss-sr*sy-sk*sw)*sI,sl[15]=(sb*sy-sq*ss+sY*sw)*sI)},sd.identity=function(){var sd=this.elements;sd[1]=sd[2]=sd[3]=sd[4]=sd[6]=sd[7]=sd[8]=sd[9]=sd[11]=sd[12]=sd[13]=sd[14]=0,sd[0]=sd[5]=sd[10]=sd[15]=1},sd.cloneTo=function(sd){var sL,sl,sZ;if((sl=this.elements)!==(sZ=sd.elements))for(sL=0;sL<16;++sL)sZ[sL]=sl[sL]},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sd.getTranslationVector=function(sd){var sL=this.elements,sl=sd.elements;sl[0]=sL[12],sl[1]=sL[13],sl[2]=sL[14]},sd.setTranslationVector=function(sd){var sL=this.elements,sl=sd.elements;sL[12]=sl[0],sL[13]=sl[1],sL[14]=sl[2]},sd.getForward=function(sd){var sL=this.elements,sl=sd.elements;sl[0]=-sL[8],sl[1]=-sL[9],sl[2]=-sL[10]},sd.setForward=function(sd){var sL=this.elements,sl=sd.elements;sL[8]=-sl[0],sL[9]=-sl[1],sL[10]=-sl[2]},sn.createRotationX=function(sd,sL){var sl=sL.elements,sZ=Math.sin(sd),sh=Math.cos(sd);sl[1]=sl[2]=sl[3]=sl[4]=sl[7]=sl[8]=sl[11]=sl[12]=sl[13]=sl[14]=0,sl[0]=sl[15]=1,sl[5]=sl[10]=sh,sl[6]=sZ,sl[9]=-sZ},sn.createRotationY=function(sd,sL){var sl=sL.elements,sZ=Math.sin(sd),sh=Math.cos(sd);sl[1]=sl[3]=sl[4]=sl[6]=sl[7]=sl[9]=sl[11]=sl[12]=sl[13]=sl[14]=0,sl[5]=sl[15]=1,sl[0]=sl[10]=sh,sl[2]=-sZ,sl[8]=sZ},sn.createRotationZ=function(sd,sL){var sl=sL.elements,sZ=Math.sin(sd),sh=Math.cos(sd);sl[2]=sl[3]=sl[6]=sl[7]=sl[8]=sl[9]=sl[11]=sl[12]=sl[13]=sl[14]=0,sl[10]=sl[15]=1,sl[0]=sl[5]=sh,sl[1]=sZ,sl[4]=-sZ},sn.createRotationYawPitchRoll=function(sd,sL,sl,sZ){slL.createFromYawPitchRoll(sd,sL,sl,sn._tempQuaternion),sn.createRotationQuaternion(sn._tempQuaternion,sZ)},sn.createRotationAxis=function(sd,sL,sl){var sZ=sd.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=Math.cos(sL),su=Math.sin(sL),sx=sh*sh,st=s_*s_,sb=sN*sN,sq=sh*s_,sY=sh*sN,sc=s_*sN,sr=sl.elements;sr[3]=sr[7]=sr[11]=sr[12]=sr[13]=sr[14]=0,sr[15]=1,sr[0]=sx+sm*(1-sx),sr[1]=sq-sm*sq+su*sN,sr[2]=sY-sm*sY-su*s_,sr[4]=sq-sm*sq-su*sN,sr[5]=st+sm*(1-st),sr[6]=sc-sm*sc+su*sh,sr[8]=sY-sm*sY+su*s_,sr[9]=sc-sm*sc-su*sh,sr[10]=sb+sm*(1-sb)},sn.createRotationQuaternion=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sl[0],s_=sl[1],sN=sl[2],sm=sl[3],su=sh*sh,sx=s_*s_,st=sN*sN,sb=sh*s_,sq=sN*sm,sY=sN*sh,sc=s_*sm,sr=s_*sN,sa=sh*sm;sZ[3]=sZ[7]=sZ[11]=sZ[12]=sZ[13]=sZ[14]=0,sZ[15]=1,sZ[0]=1-2*(sx+st),sZ[1]=2*(sb+sq),sZ[2]=2*(sY-sc),sZ[4]=2*(sb-sq),sZ[5]=1-2*(st+su),sZ[6]=2*(sr+sa),sZ[8]=2*(sY+sc),sZ[9]=2*(sr-sa),sZ[10]=1-2*(sx+su)},sn.createTranslate=function(sd,sL){var sl=sd.elements,sZ=sL.elements;sZ[4]=sZ[8]=sZ[1]=sZ[9]=sZ[2]=sZ[6]=sZ[3]=sZ[7]=sZ[11]=0,sZ[0]=sZ[5]=sZ[10]=sZ[15]=1,sZ[12]=sl[0],sZ[13]=sl[1],sZ[14]=sl[2]},sn.createScaling=function(sd,sL){var sl=sd.elements,sZ=sL.elements;sZ[0]=sl[0],sZ[5]=sl[1],sZ[10]=sl[2],sZ[1]=sZ[4]=sZ[8]=sZ[12]=sZ[9]=sZ[13]=sZ[2]=sZ[6]=sZ[14]=sZ[3]=sZ[7]=sZ[11]=0,sZ[15]=1},sn.multiply=function(sd,sL,sl){var sZ,sh,s_,sN,sm,su,sx,st;for(sh=sl.elements,s_=sd.elements,sh===(sN=sL.elements)&&(sN=sN.slice()),sZ=0;sZ<4;sZ++)sm=s_[sZ],su=s_[sZ+4],sx=s_[sZ+8],st=s_[sZ+12],sh[sZ]=sm*sN[0]+su*sN[1]+sx*sN[2]+st*sN[3],sh[sZ+4]=sm*sN[4]+su*sN[5]+sx*sN[6]+st*sN[7],sh[sZ+8]=sm*sN[8]+su*sN[9]+sx*sN[10]+st*sN[11],sh[sZ+12]=sm*sN[12]+su*sN[13]+sx*sN[14]+st*sN[15]},sn.createFromQuaternion=function(sd,sL){var sl=sL.elements,sZ=sd.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sZ[3],su=sh+sh,sx=s_+s_,st=sN+sN,sb=sh*su,sq=s_*su,sY=s_*sx,sc=sN*su,sr=sN*sx,sa=sN*st,sk=sm*su,se=sm*sx,sw=sm*st;sl[0]=1-sY-sa,sl[1]=sq+sw,sl[2]=sc-se,sl[3]=0,sl[4]=sq-sw,sl[5]=1-sb-sa,sl[6]=sr+sk,sl[7]=0,sl[8]=sc+se,sl[9]=sr-sk,sl[10]=1-sb-sY,sl[11]=0,sl[12]=0,sl[13]=0,sl[14]=0,sl[15]=1},sn.createAffineTransformation=function(sd,sL,sl,sZ){var sh=sd.elements,s_=sL.elements,sN=sl.elements,sm=sZ.elements,su=s_[0],sx=s_[1],st=s_[2],sb=s_[3],sq=su+su,sY=sx+sx,sc=st+st,sr=su*sq,sa=su*sY,sk=su*sc,se=sx*sY,sw=sx*sc,ss=st*sc,sA=sb*sq,sy=sb*sY,s$=sb*sc,sO=sN[0],sn=sN[1],sV=sN[2];sm[0]=(1-(se+ss))*sO,sm[1]=(sa+s$)*sO,sm[2]=(sk-sy)*sO,sm[3]=0,sm[4]=(sa-s$)*sn,sm[5]=(1-(sr+ss))*sn,sm[6]=(sw+sA)*sn,sm[7]=0,sm[8]=(sk+sy)*sV,sm[9]=(sw-sA)*sV,sm[10]=(1-(sr+se))*sV,sm[11]=0,sm[12]=sh[0],sm[13]=sh[1],sm[14]=sh[2],sm[15]=1},sn.createLookAt=function(sd,sL,sl,sZ){var sh=sZ.elements,s_=sn._tempVector0,sN=sn._tempVector1,sm=sn._tempVector2;sNL.subtract(sd,sL,sm),sNL.normalize(sm,sm),sNL.cross(sl,sm,s_),sNL.normalize(s_,s_),sNL.cross(sm,s_,sN),sZ.identity(),sh[0]=s_.x,sh[4]=s_.y,sh[8]=s_.z,sh[1]=sN.x,sh[5]=sN.y,sh[9]=sN.z,sh[2]=sm.x,sh[6]=sm.y,sh[10]=sm.z,sh[12]=-sNL.dot(s_,sd),sh[13]=-sNL.dot(sN,sd),sh[14]=-sNL.dot(sm,sd)},sn.createPerspective=function(sd,sL,sl,sZ,sh){var s_=sh.elements,sN=1/Math.tan(sd/2),sm=1/(sl-sZ);s_[0]=sN/sL,s_[5]=sN,s_[10]=(sZ+sl)*sm,s_[11]=-1,s_[14]=2*sZ*sl*sm,s_[1]=s_[2]=s_[3]=s_[4]=s_[6]=s_[7]=s_[8]=s_[9]=s_[12]=s_[13]=s_[15]=0},sn.createOrthoOffCenterRH=function(sd,sL,sl,sZ,sh,s_,sN){var sm=sN.elements,su=1/(sd-sL),sx=1/(sl-sZ),st=1/(sh-s_);sm[1]=sm[2]=sm[3]=sm[4]=sm[6]=sm[7]=sm[8]=sm[9]=sm[11]=0,sm[15]=1,sm[0]=-2*su,sm[5]=-2*sx,sm[10]=2*st,sm[12]=(sd+sL)*su,sm[13]=(sZ+sl)*sx,sm[14]=(s_+sh)*st},sn.translation=function(sd,sL){var sl=sd.elements,sZ=sL.elements;sZ[0]=sZ[5]=sZ[10]=sZ[15]=1,sZ[12]=sl[0],sZ[13]=sl[1],sZ[14]=sl[2]},sb(sn,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new sn},"_tempVector0",function(){return this._tempVector0=new sNL},"_tempVector1",function(){return this._tempVector1=new sNL},"_tempVector2",function(){return this._tempVector2=new sNL},"_tempQuaternion",function(){return this._tempQuaternion=new slL},"DEFAULT",function(){return this.DEFAULT=new sn},"ZERO",function(){return this.ZERO=new sn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),sn}(),sLL=(function(){function sw(sd,sL){this.extents=null,this.transformation=null,this.extents=sd,this.transformation=sL}sY(sw,"laya.d3.math.OrientedBoundBox");var sd=sw.prototype;sd.getCorners=function(sd){var sL=sw._tempV30.elements,sl=sw._tempV31.elements,sZ=sw._tempV32.elements,sh=this.extents.elements;sL[0]=sh[0],sL[1]=sL[2]=0,sl[1]=sh[1],sl[0]=sl[2]=0,sZ[2]=sh[2],sZ[0]=sZ[1]=0,sNL.TransformNormal(sw._tempV30,this.transformation,sw._tempV30),sNL.TransformNormal(sw._tempV31,this.transformation,sw._tempV31),sNL.TransformNormal(sw._tempV32,this.transformation,sw._tempV32);var s_=sw._tempV33;this.transformation.getTranslationVector(s_),sd.length=8,sNL.add(s_,sw._tempV30,sw._tempV34),sNL.add(sw._tempV34,sw._tempV31,sw._tempV34),sNL.add(sw._tempV34,sw._tempV32,sd[0]),sNL.add(s_,sw._tempV30,sw._tempV34),sNL.add(sw._tempV34,sw._tempV31,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV32,sd[1]),sNL.subtract(s_,sw._tempV30,sw._tempV34),sNL.add(sw._tempV34,sw._tempV31,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV32,sd[2]),sNL.subtract(s_,sw._tempV30,sw._tempV34),sNL.add(sw._tempV34,sw._tempV31,sw._tempV34),sNL.add(sw._tempV34,sw._tempV32,sd[3]),sNL.add(s_,sw._tempV30,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV31,sw._tempV34),sNL.add(sw._tempV34,sw._tempV32,sd[4]),sNL.add(s_,sw._tempV30,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV31,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV32,sd[5]),sNL.subtract(s_,sw._tempV30,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV31,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV32,sd[6]),sNL.subtract(s_,sw._tempV30,sw._tempV34),sNL.subtract(sw._tempV34,sw._tempV31,sw._tempV34),sNL.add(sw._tempV34,sw._tempV32,sd[7])},sd.transform=function(sd){sdL.multiply(this.transformation,sd,this.transformation)},sd.scale=function(sd){sNL.multiply(this.extents,sd,this.extents)},sd.translate=function(sd){this.transformation.getTranslationVector(sw._tempV30),sNL.add(sw._tempV30,sd,sw._tempV31),this.transformation.setTranslationVector(sw._tempV31)},sd.Size=function(sd){sNL.scale(this.extents,2,sd)},sd.getSize=function(sd){var sL=this.extents.elements;sw._tempV30.x=sL[0],sw._tempV31.y=sL[1],sw._tempV32.z=sL[2],sNL.TransformNormal(sw._tempV30,this.transformation,sw._tempV30),sNL.TransformNormal(sw._tempV31,this.transformation,sw._tempV31),sNL.TransformNormal(sw._tempV31,this.transformation,sw._tempV32);var sl=sd.elements;sl[0]=sNL.scalarLength(sw._tempV30),sl[1]=sNL.scalarLength(sw._tempV31),sl[2]=sNL.scalarLength(sw._tempV32)},sd.getSizeSquared=function(sd){var sL=this.extents.elements;sw._tempV30.x=sL[0],sw._tempV31.y=sL[1],sw._tempV32.z=sL[2],sNL.TransformNormal(sw._tempV30,this.transformation,sw._tempV30),sNL.TransformNormal(sw._tempV31,this.transformation,sw._tempV31),sNL.TransformNormal(sw._tempV31,this.transformation,sw._tempV32);var sl=sd.elements;sl[0]=sNL.scalarLengthSquared(sw._tempV30),sl[1]=sNL.scalarLengthSquared(sw._tempV31),sl[2]=sNL.scalarLengthSquared(sw._tempV32)},sd.getCenter=function(sd){this.transformation.getTranslationVector(sd)},sd.containsPoint=function(sd){var sL=this.extents.elements,sl=sL[0],sZ=sL[1],sh=sL[2];this.transformation.invert(sw._tempM0),sNL.transformCoordinate(sd,sw._tempM0,sw._tempV30);var s_=sw._tempV30.elements,sN=Math.abs(s_[0]),sm=Math.abs(s_[1]),su=Math.abs(s_[2]);return sWd.nearEqual(sN,sl)&&sWd.nearEqual(sm,sZ)&&sWd.nearEqual(su,sh)?2:sN<sl&&sm<sZ&&su<sh?1:0},sd.containsPoints=function(sd){var sL=this.extents.elements,sl=sL[0],sZ=sL[1],sh=sL[2];this.transformation.invert(sw._tempM0);for(var s_=!0,sN=!1,sm=0;sm<sd.length;sm++){sNL.transformCoordinate(sd[sm],sw._tempM0,sw._tempV30);var su=sw._tempV30.elements,sx=Math.abs(su[0]),st=Math.abs(su[1]),sb=Math.abs(su[2]);sWd.nearEqual(sx,sl)&&sWd.nearEqual(st,sZ)&&sWd.nearEqual(sb,sh)&&(sN=!0),sx<sl&&st<sZ&&sb<sh?sN=!0:s_=!1}return s_?1:sN?2:0},sd.containsSphere=function(sd,sL){void 0===sL&&(sL=!1);var sl=this.extents.elements,sZ=sl[0],sh=sl[1],s_=sl[2],sN=sd.radius;this.transformation.invert(sw._tempM0),sNL.transformCoordinate(sd.center,sw._tempM0,sw._tempV30);var sm=NaN;if(sm=sL?sN:(sNL.scale(sNL.UnitX,sN,sw._tempV31),sNL.TransformNormal(sw._tempV31,sw._tempM0,sw._tempV31),sNL.scalarLength(sw._tempV31)),sNL.scale(this.extents,-1,sw._tempV32),sNL.Clamp(sw._tempV30,sw._tempV32,this.extents,sw._tempV33),sm*sm<sNL.distanceSquared(sw._tempV30,sw._tempV33))return 0;var su=sw._tempV30.elements,sx=su[0],st=su[1],sb=su[2],sq=sw._tempV32.elements,sY=sq[0],sc=sq[1],sr=sq[2];return sY+sm<=sx&&sx<=sZ-sm&&sm<sZ-sY&&sc+sm<=st&&st<=sh-sm&&sm<sh-sc&&sr+sm<=sb&&sb<=s_-sm&&sm<s_-sr?1:2},sd.containsOrientedBoundBox=function(sd){var sL=0,sl=0;sd.getCorners(sw._corners);var sZ=this.containsPoints(sw._corners);if(0!=sZ)return sZ;var sh=this.extents.elements;sd.extents.cloneTo(sw._tempV35);var s_=sw._tempV35.elements;sw._getRows(this.transformation,sw._rows1),sw._getRows(sd.transformation,sw._rows2);var sN=NaN;for(sL=0;sL<4;sL++)for(sl=0;sl<4;sl++)3==sL||3==sl?(sw._tempM0.setElementByRowColumn(sL,sl,0),sw._tempM1.setElementByRowColumn(sL,sl,0)):(sN=sNL.dot(sw._rows1[sL],sw._rows2[sl]),sw._tempM0.setElementByRowColumn(sL,sl,sN),sw._tempM1.setElementByRowColumn(sL,sl,Math.abs(sN)));sd.getCenter(sw._tempV34),this.getCenter(sw._tempV36),sNL.subtract(sw._tempV34,sw._tempV36,sw._tempV30);var sm=sw._tempV31.elements;sm[0]=sNL.dot(sw._tempV30,sw._rows1[0]),sm[1]=sNL.dot(sw._tempV30,sw._rows1[1]),sm[2]=sNL.dot(sw._tempV30,sw._rows1[2]);var su=sw._tempV32.elements,sx=sw._tempV33.elements;for(sL=0;sL<3;sL++)if(su[0]=sw._tempM1.getElementByRowColumn(sL,0),su[1]=sw._tempM1.getElementByRowColumn(sL,1),su[2]=sw._tempM1.getElementByRowColumn(sL,2),sh[sL]+sNL.dot(sw._tempV35,sw._tempV32)<Math.abs(sm[sL]))return 0;for(sl=0;sl<3;sl++)if(su[0]=sw._tempM1.getElementByRowColumn(0,sl),su[1]=sw._tempM1.getElementByRowColumn(1,sl),su[2]=sw._tempM1.getElementByRowColumn(2,sl),sx[0]=sw._tempM0.getElementByRowColumn(0,sl),sx[1]=sw._tempM0.getElementByRowColumn(1,sl),sx[2]=sw._tempM0.getElementByRowColumn(2,sl),sNL.dot(this.extents,sw._tempV32)+s_[sl]<Math.abs(sNL.dot(sw._tempV31,sw._tempV33)))return 0;for(sL=0;sL<3;sL++)for(sl=0;sl<3;sl++){var st=(sL+1)%3,sb=(sL+2)%3,sq=(sl+1)%3,sY=(sl+2)%3;if(sh[st]*sw._tempM1.getElementByRowColumn(sb,sl)+sh[sb]*sw._tempM1.getElementByRowColumn(st,sl)+(s_[sq]*sw._tempM1.getElementByRowColumn(sL,sY)+s_[sY]*sw._tempM1.getElementByRowColumn(sL,sq))<Math.abs(sm[sb]*sw._tempM0.getElementByRowColumn(st,sl)-sm[st]*sw._tempM0.getElementByRowColumn(sb,sl)))return 0}return 2},sd.containsLine=function(sd,sL){sw._corners[0]=sd,sw._corners[1]=sL;var sl=this.containsPoints(sw._corners);if(0!=sl)return sl;var sZ=this.extents.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2];this.transformation.invert(sw._tempM0),sNL.transformCoordinate(sd,sw._tempM0,sw._tempV30),sNL.transformCoordinate(sL,sw._tempM0,sw._tempV31),sNL.add(sw._tempV30,sw._tempV31,sw._tempV32),sNL.scale(sw._tempV32,.5,sw._tempV32),sNL.subtract(sw._tempV30,sw._tempV32,sw._tempV33);var sm=sw._tempV33.elements,su=sm[0],sx=sm[1],st=sm[2],sb=sw._tempV34.elements,sq=sb[0]=Math.abs(sm[0]),sY=sb[1]=Math.abs(sm[1]),sc=sb[2]=Math.abs(sm[2]),sr=sw._tempV32.elements,sa=sr[0],sk=sr[1],se=sr[2];return Math.abs(sa)>sh+sq?0:Math.abs(sk)>s_+sY?0:Math.abs(se)>sN+sc?0:Math.abs(sk*st-se*sx)>s_*sc+sN*sY?0:Math.abs(sa*st-se*su)>sh*sc+sN*sq?0:Math.abs(sa*sx-sk*su)>sh*sY+s_*sq?0:2},sd.containsBoundBox=function(sd){var sL=0,sl=0,sZ=sd.min,sh=sd.max;sd.getCorners(sw._corners);var s_=this.containsPoints(sw._corners);if(0!=s_)return s_;sNL.subtract(sh,sZ,sw._tempV30),sNL.scale(sw._tempV30,.5,sw._tempV30),sNL.add(sZ,sw._tempV30,sw._tempV30),sNL.subtract(sh,sw._tempV30,sw._tempV31);var sN=this.extents.elements,sm=sw._tempV31.elements;sw._getRows(this.transformation,sw._rows1),this.transformation.invert(sw._tempM0);for(sL=0;sL<3;sL++)for(sl=0;sl<3;sl++)sw._tempM1.setElementByRowColumn(sL,sl,Math.abs(sw._tempM0.getElementByRowColumn(sL,sl)));this.getCenter(sw._tempV35),sNL.subtract(sw._tempV30,sw._tempV35,sw._tempV32);var su=sw._tempV31.elements;su[0]=sNL.dot(sw._tempV32,sw._rows1[0]),su[1]=sNL.dot(sw._tempV32,sw._rows1[1]),su[2]=sNL.dot(sw._tempV32,sw._rows1[2]);var sx=sw._tempV33.elements,st=sw._tempV34.elements;for(sL=0;sL<3;sL++)if(sx[0]=sw._tempM1.getElementByRowColumn(sL,0),sx[1]=sw._tempM1.getElementByRowColumn(sL,1),sx[2]=sw._tempM1.getElementByRowColumn(sL,2),sN[sL]+sNL.dot(sw._tempV31,sw._tempV33)<Math.abs(su[sL]))return 0;for(sl=0;sl<3;sl++)if(sx[0]=sw._tempM1.getElementByRowColumn(0,sl),sx[1]=sw._tempM1.getElementByRowColumn(1,sl),sx[2]=sw._tempM1.getElementByRowColumn(2,sl),st[0]=sw._tempM0.getElementByRowColumn(0,sl),st[1]=sw._tempM0.getElementByRowColumn(1,sl),st[2]=sw._tempM0.getElementByRowColumn(2,sl),sNL.dot(this.extents,sw._tempV33)+sm[sl]<Math.abs(sNL.dot(sw._tempV31,sw._tempV34)))return 0;for(sL=0;sL<3;sL++)for(sl=0;sl<3;sl++){var sb=(sL+1)%3,sq=(sL+2)%3,sY=(sl+1)%3,sc=(sl+2)%3;if(sN[sb]*sw._tempM1.getElementByRowColumn(sq,sl)+sN[sq]*sw._tempM1.getElementByRowColumn(sb,sl)+(sm[sY]*sw._tempM1.getElementByRowColumn(sL,sc)+sm[sc]*sw._tempM1.getElementByRowColumn(sL,sY))<Math.abs(su[sq]*sw._tempM0.getElementByRowColumn(sb,sl)-su[sb]*sw._tempM0.getElementByRowColumn(sq,sl)))return 0}return 2},sd.intersectsRay=function(sd,sL){sNL.scale(this.extents,-1,sw._tempV30),this.transformation.invert(sw._tempM0),sNL.TransformNormal(sd.direction,sw._tempM0,sw._ray.direction),sNL.transformCoordinate(sd.origin,sw._tempM0,sw._ray.origin),sw._boxBound1.min=sw._tempV30,sw._boxBound1.max=this.extents;var sl=Collision.intersectsRayAndBoxRP(sw._ray,sw._boxBound1,sL);return-1!==sl&&sNL.transformCoordinate(sL,this.transformation,sL),sl},sd._getLocalCorners=function(sd){sd.length=8;var sL=this.extents.elements;sw._tempV30.x=sL[0],sw._tempV31.y=sL[1],sw._tempV32.z=sL[2],sNL.add(sw._tempV30,sw._tempV31,sw._tempV33),sNL.add(sw._tempV33,sw._tempV32,sd[0]),sNL.add(sw._tempV30,sw._tempV31,sw._tempV33),sNL.subtract(sw._tempV33,sw._tempV32,sd[1]),sNL.subtract(sw._tempV31,sw._tempV30,sw._tempV33),sNL.subtract(sw._tempV33,sw._tempV30,sd[2]),sNL.subtract(sw._tempV31,sw._tempV30,sw._tempV33),sNL.add(sw._tempV33,sw._tempV32,sd[3]),sNL.subtract(sw._tempV30,sw._tempV31,sw._tempV33),sNL.add(sw._tempV33,sw._tempV32,sd[4]),sNL.subtract(sw._tempV30,sw._tempV31,sw._tempV33),sNL.subtract(sw._tempV33,sw._tempV32,sd[5]),sNL.scale(sd[0],-1,sd[6]),sNL.subtract(sw._tempV32,sw._tempV30,sw._tempV33),sNL.subtract(sw._tempV33,sw._tempV31,sd[7])},sd.equals=function(sd){return this.extents==sd.extents&&this.transformation==sd.transformation},sd.cloneTo=function(sd){var sL=sd;this.extents.cloneTo(sL.extents),this.transformation.cloneTo(sL.transformation)},sw.createByBoundBox=function(sd,sL){var sl=sd.min,sZ=sd.max;sNL.subtract(sZ,sl,sw._tempV30),sNL.scale(sw._tempV30,.5,sw._tempV30),sNL.add(sl,sw._tempV30,sw._tempV31),sNL.subtract(sZ,sw._tempV31,sw._tempV32),sdL.translation(sw._tempV31,sw._tempM0);var sh=sw._tempV32.clone(),s_=sw._tempM0.clone();sL.extents=sh,sL.transformation=s_},sw.createByMinAndMaxVertex=function(sd,sL){return sNL.subtract(sL,sd,sw._tempV30),sNL.scale(sw._tempV30,.5,sw._tempV30),sNL.add(sd,sw._tempV30,sw._tempV31),sNL.subtract(sL,sw._tempV31,sw._tempV32),sdL.translation(sw._tempV31,sw._tempM0),new sw(sw._tempV32,sw._tempM0)},sw._getRows=function(sd,sL){sL.length=3;var sl=sd.elements,sZ=sL[0].elements;sZ[0]=sl[0],sZ[1]=sl[1],sZ[2]=sl[2];var sh=sL[1].elements;sh[0]=sl[4],sh[1]=sl[5],sh[2]=sl[6];var s_=sL[2].elements;s_[0]=sl[8],s_[1]=sl[9],s_[2]=sl[10]},sw.getObbtoObbMatrix4x4=function(sd,sL,sl,sZ){var sh=sd.transformation,s_=sL.transformation;if(sl){sw._getRows(sh,sw._rows1),sw._getRows(s_,sw._rows2);for(var sN=0;sN<3;sN++)for(var sm=0;sm<3;sm++)sZ.setElementByRowColumn(sN,sm,sNL.dot(sw._rows2[sN],sw._rows1[sm]));sL.getCenter(sw._tempV30),sd.getCenter(sw._tempV31),sNL.subtract(sw._tempV30,sw._tempV31,sw._tempV32);var su=sZ.elements;su[12]=sNL.dot(sw._tempV32,sw._rows1[0]),su[13]=sNL.dot(sw._tempV32,sw._rows1[1]),su[14]=sNL.dot(sw._tempV32,sw._rows1[2]),su[15]=1}else sh.invert(sw._tempM0),sdL.multiply(s_,sw._tempM0,sZ)},sw.merge=function(sd,sL,sl){var sZ=sd.extents,sh=sd.transformation;sw.getObbtoObbMatrix4x4(sd,sL,sl,sw._tempM0),sL._getLocalCorners(sw._corners),sNL.transformCoordinate(sw._corners[0],sw._tempM0,sw._corners[0]),sNL.transformCoordinate(sw._corners[1],sw._tempM0,sw._corners[1]),sNL.transformCoordinate(sw._corners[2],sw._tempM0,sw._corners[2]),sNL.transformCoordinate(sw._corners[3],sw._tempM0,sw._corners[3]),sNL.transformCoordinate(sw._corners[4],sw._tempM0,sw._corners[4]),sNL.transformCoordinate(sw._corners[5],sw._tempM0,sw._corners[5]),sNL.transformCoordinate(sw._corners[6],sw._tempM0,sw._corners[6]),sNL.transformCoordinate(sw._corners[7],sw._tempM0,sw._corners[7]),sNL.scale(sZ,-1,sw._boxBound1.min),sZ.cloneTo(sw._boxBound1.max),sJd.createfromPoints(sw._corners,sw._boxBound2),sJd.merge(sw._boxBound2,sw._boxBound1,sw._boxBound3);var s_=sw._boxBound3.min,sN=sw._boxBound3.max;sNL.subtract(sN,s_,sw._tempV30),sNL.scale(sw._tempV30,.5,sw._tempV30),sNL.add(s_,sw._tempV30,sw._tempV32),sNL.subtract(sN,sw._tempV32,sZ),sNL.transformCoordinate(sw._tempV32,sh,sw._tempV33)},sb(sw,["_tempV30",function(){return this._tempV30=new sNL},"_tempV31",function(){return this._tempV31=new sNL},"_tempV32",function(){return this._tempV32=new sNL},"_tempV33",function(){return this._tempV33=new sNL},"_tempV34",function(){return this._tempV34=new sNL},"_tempV35",function(){return this._tempV35=new sNL},"_tempV36",function(){return this._tempV36=new sNL},"_tempM0",function(){return this._tempM0=new sdL},"_tempM1",function(){return this._tempM1=new sdL},"_corners",function(){return this._corners=[new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL]},"_rows1",function(){return this._rows1=[new sNL,new sNL,new sNL]},"_rows2",function(){return this._rows2=[new sNL,new sNL,new sNL]},"_ray",function(){return this._ray=new shL(new sNL,new sNL)},"_boxBound1",function(){return this._boxBound1=new sJd(new sNL,new sNL)},"_boxBound2",function(){return this._boxBound2=new sJd(new sNL,new sNL)},"_boxBound3",function(){return this._boxBound3=new sJd(new sNL,new sNL)}])}(),function(){function sA(sd,sL){this.normal=null,this.distance=NaN,void 0===sL&&(sL=0),this.normal=sd,this.distance=sL}return sY(sA,"laya.d3.math.Plane"),sA.prototype.normalize=function(){var sd=this.normal.elements,sL=sd[0],sl=sd[1],sZ=sd[2],sh=1/Math.sqrt(sL*sL+sl*sl+sZ*sZ);sd[0]=sL*sh,sd[1]=sl*sh,sd[2]=sZ*sh,this.distance*=sh},sA.createPlaneBy3P=function(sd,sL,sl){var sZ=sd.elements,sh=sL.elements,s_=sl.elements,sN=sh[0]-sZ[0],sm=sh[1]-sZ[1],su=sh[2]-sZ[2],sx=s_[0]-sZ[0],st=s_[1]-sZ[1],sb=s_[2]-sZ[2],sq=sm*sb-su*st,sY=su*sx-sN*sb,sc=sN*st-sm*sx,sr=1/Math.sqrt(sq*sq+sY*sY+sc*sc),sa=sq*sr,sk=sY*sr,se=sc*sr,sw=sA._TEMPVec3.elements;sw[0]=sa,sw[1]=sk,sw[2]=se;var ss=-(sa*sZ[0]+sk*sZ[1]+se*sZ[2]);return new sA(sA._TEMPVec3,ss)},sA.PlaneIntersectionType_Back=0,sA.PlaneIntersectionType_Front=1,sA.PlaneIntersectionType_Intersecting=2,sb(sA,["_TEMPVec3",function(){return this._TEMPVec3=new sNL}]),sA}()),slL=function(){function sh(sd,sL,sl,sZ){this.elements=new Float32Array(4),void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=1),this.elements[0]=sd,this.elements[1]=sL,this.elements[2]=sl,this.elements[3]=sZ}sY(sh,"laya.d3.math.Quaternion");var sd=sh.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.scaling=function(sd,sL){var sl=sL.elements,sZ=this.elements;sl[0]=sZ[0]*sd,sl[1]=sZ[1]*sd,sl[2]=sZ[2]*sd,sl[3]=sZ[3]*sd},sd.normalize=function(sd){var sL=sd.elements,sl=this.elements,sZ=sl[0],sh=sl[1],s_=sl[2],sN=sl[3],sm=sZ*sZ+sh*sh+s_*s_+sN*sN;0<sm&&(sm=1/Math.sqrt(sm),sL[0]=sZ*sm,sL[1]=sh*sm,sL[2]=s_*sm,sL[3]=sN*sm)},sd.length=function(){var sd=this.elements,sL=sd[0],sl=sd[1],sZ=sd[2],sh=sd[3];return Math.sqrt(sL*sL+sl*sl+sZ*sZ+sh*sh)},sd.rotateX=function(sd,sL){var sl=sL.elements,sZ=this.elements;sd*=.5;var sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sZ[3],su=Math.sin(sd),sx=Math.cos(sd);sl[0]=sh*sx+sm*su,sl[1]=s_*sx+sN*su,sl[2]=sN*sx-s_*su,sl[3]=sm*sx-sh*su},sd.rotateY=function(sd,sL){var sl=sL.elements,sZ=this.elements;sd*=.5;var sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sZ[3],su=Math.sin(sd),sx=Math.cos(sd);sl[0]=sh*sx-sN*su,sl[1]=s_*sx+sm*su,sl[2]=sN*sx+sh*su,sl[3]=sm*sx-s_*su},sd.rotateZ=function(sd,sL){var sl=sL.elements,sZ=this.elements;sd*=.5;var sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sZ[3],su=Math.sin(sd),sx=Math.cos(sd);sl[0]=sh*sx+s_*su,sl[1]=s_*sx-sh*su,sl[2]=sN*sx+sm*su,sl[3]=sm*sx-sN*su},sd.getYawPitchRoll=function(sd){sNL.transformQuat(sNL.ForwardRH,this,sh.TEMPVector31),sNL.transformQuat(sNL.Up,this,sh.TEMPVector32);var sL=sh.TEMPVector32.elements;sh.angleTo(sNL.ZERO,sh.TEMPVector31,sh.TEMPVector33);var sl=sh.TEMPVector33.elements;sl[0]==Math.PI/2?(sl[1]=sh.arcTanAngle(sL[2],sL[0]),sl[2]=0):sl[0]==-Math.PI/2?(sl[1]=sh.arcTanAngle(-sL[2],-sL[0]),sl[2]=0):(sdL.createRotationY(-sl[1],sh.TEMPMatrix0),sdL.createRotationX(-sl[0],sh.TEMPMatrix1),sNL.transformCoordinate(sh.TEMPVector32,sh.TEMPMatrix0,sh.TEMPVector32),sNL.transformCoordinate(sh.TEMPVector32,sh.TEMPMatrix1,sh.TEMPVector32),sl[2]=sh.arcTanAngle(sL[1],-sL[0])),sl[1]<=-Math.PI&&(sl[1]=Math.PI),sl[2]<=-Math.PI&&(sl[2]=Math.PI),sl[1]>=Math.PI&&sl[2]>=Math.PI&&(sl[1]=0,sl[2]=0,sl[0]=Math.PI-sl[0]);var sZ=sd.elements;sZ[0]=sl[1],sZ[1]=sl[0],sZ[2]=sl[2]},sd.invert=function(sd){var sL=sd.elements,sl=this.elements,sZ=sl[0],sh=sl[1],s_=sl[2],sN=sl[3],sm=sZ*sZ+sh*sh+s_*s_+sN*sN,su=sm?1/sm:0;sL[0]=-sZ*su,sL[1]=-sh*su,sL[2]=-s_*su,sL[3]=sN*su},sd.identity=function(){var sd=this.elements;sd[0]=0,sd[1]=0,sd[2]=0,sd[3]=1},sd.fromArray=function(sd,sL){void 0===sL&&(sL=0),this.elements[0]=sd[sL+0],this.elements[1]=sd[sL+1],this.elements[2]=sd[sL+2],this.elements[3]=sd[sL+3]},sd.cloneTo=function(sd){var sL,sl,sZ;if((sl=this.elements)!==(sZ=sd.elements))for(sL=0;sL<4;++sL)sZ[sL]=sl[sL]},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sd.equals=function(sd){var sL=this.elements,sl=sd.elements;return sWd.nearEqual(sL[0],sl[0])&&sWd.nearEqual(sL[1],sl[1])&&sWd.nearEqual(sL[2],sl[2])&&sWd.nearEqual(sL[3],sl[3])},sd.lengthSquared=function(){var sd=this.elements[0],sL=this.elements[1],sl=this.elements[2],sZ=this.elements[3];return sd*sd+sL*sL+sl*sl+sZ*sZ},sc(0,sd,"x",function(){return this.elements[0]}),sc(0,sd,"y",function(){return this.elements[1]}),sc(0,sd,"z",function(){return this.elements[2]}),sc(0,sd,"w",function(){return this.elements[3]}),sh.createFromYawPitchRoll=function(sd,sL,sl,sZ){var sh=.5*sl,s_=.5*sL,sN=.5*sd,sm=Math.sin(sh),su=Math.cos(sh),sx=Math.sin(s_),st=Math.cos(s_),sb=Math.sin(sN),sq=Math.cos(sN),sY=sZ.elements;sY[0]=sq*sx*su+sb*st*sm,sY[1]=sb*st*su-sq*sx*sm,sY[2]=sq*st*sm-sb*sx*su,sY[3]=sq*st*su+sb*sx*sm},sh.multiply=function(sd,sL,sl){var sZ=sd.elements,sh=sL.elements,s_=sl.elements,sN=sZ[0],sm=sZ[1],su=sZ[2],sx=sZ[3],st=sh[0],sb=sh[1],sq=sh[2],sY=sh[3],sc=sm*sq-su*sb,sr=su*st-sN*sq,sa=sN*sb-sm*st,sk=sN*st+sm*sb+su*sq;s_[0]=sN*sY+st*sx+sc,s_[1]=sm*sY+sb*sx+sr,s_[2]=su*sY+sq*sx+sa,s_[3]=sx*sY-sk},sh.arcTanAngle=function(sd,sL){return 0==sd?1==sL?Math.PI/2:-Math.PI/2:0<sd?Math.atan(sL/sd):sd<0?0<sL?Math.atan(sL/sd)+Math.PI:Math.atan(sL/sd)-Math.PI:0},sh.angleTo=function(sd,sL,sl){sNL.subtract(sL,sd,sh.TEMPVector30),sNL.normalize(sh.TEMPVector30,sh.TEMPVector30),sl.elements[0]=Math.asin(sh.TEMPVector30.y),sl.elements[1]=sh.arcTanAngle(-sh.TEMPVector30.z,-sh.TEMPVector30.x)},sh.createFromAxisAngle=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements;sL*=.5;var s_=Math.sin(sL);sZ[0]=s_*sh[0],sZ[1]=s_*sh[1],sZ[2]=s_*sh[2],sZ[3]=Math.cos(sL)},sh.createFromMatrix3x3=function(sd,sL){var sl,sZ=sL.elements,sh=sd.elements,s_=sh[0]+sh[4]+sh[8];if(0<s_)sl=Math.sqrt(s_+1),sZ[3]=.5*sl,sl=.5/sl,sZ[0]=(sh[5]-sh[7])*sl,sZ[1]=(sh[6]-sh[2])*sl,sZ[2]=(sh[1]-sh[3])*sl;else{var sN=0;sh[4]>sh[0]&&(sN=1),sh[8]>sh[3*sN+sN]&&(sN=2);var sm=(sN+1)%3,su=(sN+2)%3;sl=Math.sqrt(sh[3*sN+sN]-sh[3*sm+sm]-sh[3*su+su]+1),sZ[sN]=.5*sl,sl=.5/sl,sZ[3]=(sh[3*sm+su]-sh[3*su+sm])*sl,sZ[sm]=(sh[3*sm+sN]+sh[3*sN+sm])*sl,sZ[su]=(sh[3*su+sN]+sh[3*sN+su])*sl}},sh.createFromMatrix4x4=function(sd,sL){var sl,sZ,sh=sd.elements,s_=sL.elements,sN=sh[0]+sh[5]+sh[10];0<sN?(sl=Math.sqrt(sN+1),s_[3]=.5*sl,sl=.5/sl,s_[0]=(sh[6]-sh[9])*sl,s_[1]=(sh[8]-sh[2])*sl,s_[2]=(sh[1]-sh[4])*sl):sh[0]>=sh[5]&&sh[0]>=sh[10]?(sZ=.5/(sl=Math.sqrt(1+sh[0]-sh[5]-sh[10])),s_[0]=.5*sl,s_[1]=(sh[1]+sh[4])*sZ,s_[2]=(sh[2]+sh[8])*sZ,s_[3]=(sh[6]-sh[9])*sZ):sh[5]>sh[10]?(sZ=.5/(sl=Math.sqrt(1+sh[5]-sh[0]-sh[10])),s_[0]=(sh[4]+sh[1])*sZ,s_[1]=.5*sl,s_[2]=(sh[9]+sh[6])*sZ,s_[3]=(sh[8]-sh[2])*sZ):(sZ=.5/(sl=Math.sqrt(1+sh[10]-sh[0]-sh[5])),s_[0]=(sh[8]+sh[2])*sZ,s_[1]=(sh[9]+sh[6])*sZ,s_[2]=.5*sl,s_[3]=(sh[1]-sh[4])*sZ)},sh.slerp=function(sd,sL,sl,sZ){var sh,s_,sN,sm,su,sx=sd.elements,st=sL.elements,sb=sZ.elements,sq=sx[0],sY=sx[1],sc=sx[2],sr=sx[3],sa=st[0],sk=st[1],se=st[2],sw=st[3];return(s_=sq*sa+sY*sk+sc*se+sr*sw)<0&&(s_=-s_,sa=-sa,sk=-sk,se=-se,sw=-sw),su=1e-6<1-s_?(sh=Math.acos(s_),sN=Math.sin(sh),sm=Math.sin((1-sl)*sh)/sN,Math.sin(sl*sh)/sN):(sm=1-sl,sl),sb[0]=sm*sq+su*sa,sb[1]=sm*sY+su*sk,sb[2]=sm*sc+su*se,sb[3]=sm*sr+su*sw,sb},sh.lerp=function(sd,sL,sl,sZ){var sh=sZ.elements,s_=sd.elements,sN=sL.elements,sm=s_[0],su=s_[1],sx=s_[2],st=s_[3];sh[0]=sm+sl*(sN[0]-sm),sh[1]=su+sl*(sN[1]-su),sh[2]=sx+sl*(sN[2]-sx),sh[3]=st+sl*(sN[3]-st)},sh.add=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]+s_[0],sZ[1]=sh[1]+s_[1],sZ[2]=sh[2]+s_[2],sZ[3]=sh[3]+s_[3]},sh.dot=function(sd,sL){var sl=sd.elements,sZ=sL.elements;return sl[0]*sZ[0]+sl[1]*sZ[1]+sl[2]*sZ[2]+sl[3]*sZ[3]},sh.rotationLookAt=function(sd,sL,sl){sh.lookAt(sNL.ZERO,sd,sL,sl)},sh.lookAt=function(sd,sL,sl,sZ){sMd.lookAt(sd,sL,sl,sh._tempMatrix3x3),sh.rotationMatrix(sh._tempMatrix3x3,sZ)},sh.invert=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sd.lengthSquared();sWd.isZero(sh)||(sh=1/sh,sZ[0]=-sl[0]*sh,sZ[1]=-sl[1]*sh,sZ[2]=-sl[2]*sh,sZ[3]=sl[3]*sh)},sh.rotationMatrix=function(sd,sL){var sl=sd.elements,sZ=sl[0],sh=sl[1],s_=sl[2],sN=sl[3],sm=sl[4],su=sl[5],sx=sl[6],st=sl[7],sb=sl[8],sq=sL.elements,sY=NaN,sc=NaN,sr=sZ+sm+sb;0<sr?(sY=Math.sqrt(sr+1),sq[3]=.5*sY,sY=.5/sY,sq[0]=(su-st)*sY,sq[1]=(sx-s_)*sY,sq[2]=(sh-sN)*sY):sm<=sZ&&sb<=sZ?(sc=.5/(sY=Math.sqrt(1+sZ-sm-sb)),sq[0]=.5*sY,sq[1]=(sh+sN)*sc,sq[2]=(s_+sx)*sc,sq[3]=(su-st)*sc):sb<sm?(sc=.5/(sY=Math.sqrt(1+sm-sZ-sb)),sq[0]=(sN+sh)*sc,sq[1]=.5*sY,sq[2]=(st+su)*sc,sq[3]=(sx-s_)*sc):(sc=.5/(sY=Math.sqrt(1+sb-sZ-sm)),sq[0]=(sx+s_)*sc,sq[1]=(st+su)*sc,sq[2]=.5*sY,sq[3]=(sh-sN)*sc)},sh.DEFAULT=new sh,sb(sh,["TEMPVector30",function(){return this.TEMPVector30=new sNL},"TEMPVector31",function(){return this.TEMPVector31=new sNL},"TEMPVector32",function(){return this.TEMPVector32=new sNL},"TEMPVector33",function(){return this.TEMPVector33=new sNL},"TEMPMatrix0",function(){return this.TEMPMatrix0=new sdL},"TEMPMatrix1",function(){return this.TEMPMatrix1=new sdL},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new sMd},"NAN",function(){return this.NAN=new sh(NaN,NaN,NaN,NaN)}]),sh}(),sZL=function(){function sd(sd){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=sd,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}sY(sd,"laya.d3.math.Rand");var sL=sd.prototype;return sL.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},sL.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},sL.getSignedFloat=function(){return 2*this.getFloat()-1},sc(0,sL,"seed",function(){return this.seeds[0]},function(sd){this.seeds[0]=sd,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),sd.getFloatFromInt=function(sd){return 1/8388607*(8388607&sd)},sd.getByteFromInt=function(sd){return(8388607&sd)>>>15},sd}(),shL=(function(){function sh(sd){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(sd instanceof Array)||4!==sd.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|sd[0],this._state0L=0|sd[1],this._state1U=0|sd[2],this._state1L=0|sd[3]}sY(sh,"laya.d3.math.RandX");var sd=sh.prototype;sd.randomint=function(){var sd=this._state0U,sL=this._state0L,sl=this._state1U,sZ=this._state1L,sh=(sZ>>>0)+(sL>>>0),s_=sl+sd+(sh/2>>>31)>>>0,sN=sh>>>0,sm=0,su=0;sm=(sd^=sm=sd<<23|(-512&sL)>>>9)^(this._state0U=sl),su=(sL^=su=sL<<23)^(this._state0L=sZ);sm^=sd>>>18,su^=sL>>>18|(262143&sd)<<14;return sm^=sl>>>5,su^=sZ>>>5|(31&sl)<<27,this._state1U=sm,this._state1L=su,[s_,sN]},sd.random=function(){var sd=this.randomint(),sL=sd[0],sl=1023<<20|sL>>>12,sZ=0|(sd[1]>>>12|(4095&sL)<<20);return sh._CONVERTION_BUFFER.setUint32(0,sl,!1),sh._CONVERTION_BUFFER.setUint32(4,sZ,!1),sZL._CONVERTION_BUFFER.getFloat64(0,!1)-1},sb(sh,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new sZL([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function sd(sd,sL){this.origin=null,this.direction=null,this.origin=sd,this.direction=sL}return sY(sd,"laya.d3.math.Ray"),sd}()),s_L=function(){function sd(sd,sL){this.elements=new Float32Array(2),void 0===sd&&(sd=0),void 0===sL&&(sL=0);var sl=this.elements;sl[0]=sd,sl[1]=sL}sY(sd,"laya.d3.math.Vector2");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.fromArray=function(sd,sL){void 0===sL&&(sL=0),this.elements[0]=sd[sL+0],this.elements[1]=sd[sL+1]},sL.cloneTo=function(sd){var sL=sd.elements,sl=this.elements;sL[0]=sl[0],sL[1]=sl[1]},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"x",function(){return this.elements[0]},function(sd){this.elements[0]=sd}),sc(0,sL,"y",function(){return this.elements[1]},function(sd){this.elements[1]=sd}),sd.scale=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements;sZ[0]=sh[0]*sL,sZ[1]=sh[1]*sL},sb(sd,["ZERO",function(){return this.ZERO=new sd(0,0)},"ONE",function(){return this.ONE=new sd(1,1)}]),sd}(),sNL=function(){function st(sd,sL,sl){this.elements=new Float32Array(3),void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0);var sZ=this.elements;sZ[0]=sd,sZ[1]=sL,sZ[2]=sl}sY(st,"laya.d3.math.Vector3");var sd=st.prototype;return sA.imps(sd,{"laya.d3.core.IClone":!0}),sd.fromArray=function(sd,sL){void 0===sL&&(sL=0),this.elements[0]=sd[sL+0],this.elements[1]=sd[sL+1],this.elements[2]=sd[sL+2]},sd.cloneTo=function(sd){var sL=sd.elements,sl=this.elements;sL[0]=sl[0],sL[1]=sl[1],sL[2]=sl[2]},sd.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sd.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},sd.reset=function(sd,sL,sl){this.elements[0]=sd,this.elements[1]=sL,this.elements[2]=sl},sc(0,sd,"x",function(){return this.elements[0]},function(sd){this.elements[0]=sd}),sc(0,sd,"y",function(){return this.elements[1]},function(sd){this.elements[1]=sd}),sc(0,sd,"z",function(){return this.elements[2]},function(sd){this.elements[2]=sd}),st.distanceSquared=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sl[0]-sZ[0],s_=sl[1]-sZ[1],sN=sl[2]-sZ[2];return sh*sh+s_*s_+sN*sN},st.distance=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sl[0]-sZ[0],s_=sl[1]-sZ[1],sN=sl[2]-sZ[2];return Math.sqrt(sh*sh+s_*s_+sN*sN)},st.min=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=Math.min(sh[0],s_[0]),sZ[1]=Math.min(sh[1],s_[1]),sZ[2]=Math.min(sh[2],s_[2])},st.max=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=Math.max(sh[0],s_[0]),sZ[1]=Math.max(sh[1],s_[1]),sZ[2]=Math.max(sh[2],s_[2])},st.transformQuat=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements,sN=sh[0],sm=sh[1],su=sh[2],sx=s_[0],st=s_[1],sb=s_[2],sq=s_[3],sY=sq*sN+st*su-sb*sm,sc=sq*sm+sb*sN-sx*su,sr=sq*su+sx*sm-st*sN,sa=-sx*sN-st*sm-sb*su;sZ[0]=sY*sq+sa*-sx+sc*-sb-sr*-st,sZ[1]=sc*sq+sa*-st+sr*-sx-sY*-sb,sZ[2]=sr*sq+sa*-sb+sY*-st-sc*-sx},st.scalarLength=function(sd){var sL=sd.elements,sl=sL[0],sZ=sL[1],sh=sL[2];return Math.sqrt(sl*sl+sZ*sZ+sh*sh)},st.scalarLengthSquared=function(sd){var sL=sd.elements,sl=sL[0],sZ=sL[1],sh=sL[2];return sl*sl+sZ*sZ+sh*sh},st.normalize=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sl[0],s_=sl[1],sN=sl[2],sm=sh*sh+s_*s_+sN*sN;0<sm&&(sm=1/Math.sqrt(sm),sZ[0]=sl[0]*sm,sZ[1]=sl[1]*sm,sZ[2]=sl[2]*sm)},st.multiply=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]*s_[0],sZ[1]=sh[1]*s_[1],sZ[2]=sh[2]*s_[2]},st.scale=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements;sZ[0]=sh[0]*sL,sZ[1]=sh[1]*sL,sZ[2]=sh[2]*sL},st.lerp=function(sd,sL,sl,sZ){var sh=sZ.elements,s_=sd.elements,sN=sL.elements,sm=s_[0],su=s_[1],sx=s_[2];sh[0]=sm+sl*(sN[0]-sm),sh[1]=su+sl*(sN[1]-su),sh[2]=sx+sl*(sN[2]-sx)},st.transformV3ToV3=function(sd,sL,sl){var sZ=st._tempVector4;st.transformV3ToV4(sd,sL,sZ);var sh=sZ.elements,s_=sl.elements;s_[0]=sh[0],s_[1]=sh[1],s_[2]=sh[2]},st.transformV3ToV4=function(sd,sL,sl){var sZ=sd.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sL.elements,su=sl.elements;su[0]=sh*sm[0]+s_*sm[4]+sN*sm[8]+sm[12],su[1]=sh*sm[1]+s_*sm[5]+sN*sm[9]+sm[13],su[2]=sh*sm[2]+s_*sm[6]+sN*sm[10]+sm[14],su[3]=sh*sm[3]+s_*sm[7]+sN*sm[11]+sm[15]},st.TransformNormal=function(sd,sL,sl){var sZ=sd.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sL.elements,su=sl.elements;su[0]=sh*sm[0]+s_*sm[4]+sN*sm[8],su[1]=sh*sm[1]+s_*sm[5]+sN*sm[9],su[2]=sh*sm[2]+s_*sm[6]+sN*sm[10]},st.transformCoordinate=function(sd,sL,sl){var sZ=st._tempVector4.elements,sh=sd.elements,s_=sh[0],sN=sh[1],sm=sh[2],su=sL.elements;sZ[0]=s_*su[0]+sN*su[4]+sm*su[8]+su[12],sZ[1]=s_*su[1]+sN*su[5]+sm*su[9]+su[13],sZ[2]=s_*su[2]+sN*su[6]+sm*su[10]+su[14],sZ[3]=1/(s_*su[3]+sN*su[7]+sm*su[11]+su[15]);var sx=sl.elements;sx[0]=sZ[0]*sZ[3],sx[1]=sZ[1]*sZ[3],sx[2]=sZ[2]*sZ[3]},st.Clamp=function(sd,sL,sl,sZ){var sh=sd.elements,s_=sh[0],sN=sh[1],sm=sh[2],su=sL.elements,sx=su[0],st=su[1],sb=su[2],sq=sl.elements,sY=sq[0],sc=sq[1],sr=sq[2],sa=sZ.elements;s_=(s_=sY<s_?sY:s_)<sx?sx:s_,sN=(sN=sc<sN?sc:sN)<st?st:sN,sm=(sm=sr<sm?sr:sm)<sb?sb:sm,sa[0]=s_,sa[1]=sN,sa[2]=sm},st.add=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]+s_[0],sZ[1]=sh[1]+s_[1],sZ[2]=sh[2]+s_[2]},st.subtract=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]-s_[0],sZ[1]=sh[1]-s_[1],sZ[2]=sh[2]-s_[2]},st.cross=function(sd,sL,sl){var sZ=sd.elements,sh=sL.elements,s_=sl.elements,sN=sZ[0],sm=sZ[1],su=sZ[2],sx=sh[0],st=sh[1],sb=sh[2];s_[0]=sm*sb-su*st,s_[1]=su*sx-sN*sb,s_[2]=sN*st-sm*sx},st.dot=function(sd,sL){var sl=sd.elements,sZ=sL.elements;return sl[0]*sZ[0]+sl[1]*sZ[1]+sl[2]*sZ[2]},st.equals=function(sd,sL){var sl=sd.elements,sZ=sL.elements;return sWd.nearEqual(Math.abs(sl[0]),Math.abs(sZ[0]))&&sWd.nearEqual(Math.abs(sl[1]),Math.abs(sZ[1]))&&sWd.nearEqual(Math.abs(sl[2]),Math.abs(sZ[2]))},st.ZERO=new st(0,0,0),st.ONE=new st(1,1,1),st.NegativeUnitX=new st(-1,0,0),st.UnitX=new st(1,0,0),st.UnitY=new st(0,1,0),st.UnitZ=new st(0,0,1),st.ForwardRH=new st(0,0,-1),st.ForwardLH=new st(0,0,1),st.Up=new st(0,1,0),st.NAN=new st(NaN,NaN,NaN),sb(st,["_tempVector4",function(){return this._tempVector4=new smL}]),st}(),smL=function(){function sd(sd,sL,sl,sZ){this.elements=new Float32Array(4),void 0===sd&&(sd=0),void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=0);var sh=this.elements;sh[0]=sd,sh[1]=sL,sh[2]=sl,sh[3]=sZ}sY(sd,"laya.d3.math.Vector4");var sL=sd.prototype;return sA.imps(sL,{"laya.d3.core.IClone":!0}),sL.fromArray=function(sd,sL){void 0===sL&&(sL=0),this.elements[0]=sd[sL+0],this.elements[1]=sd[sL+1],this.elements[2]=sd[sL+2],this.elements[3]=sd[sL+3]},sL.cloneTo=function(sd){var sL=sd.elements,sl=this.elements;sL[0]=sl[0],sL[1]=sl[1],sL[2]=sl[2],sL[3]=sl[3]},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sL.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},sL.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},sc(0,sL,"x",function(){return this.elements[0]},function(sd){this.elements[0]=sd}),sc(0,sL,"y",function(){return this.elements[1]},function(sd){this.elements[1]=sd}),sc(0,sL,"z",function(){return this.elements[2]},function(sd){this.elements[2]=sd}),sc(0,sL,"w",function(){return this.elements[3]},function(sd){this.elements[3]=sd}),sd.lerp=function(sd,sL,sl,sZ){var sh=sZ.elements,s_=sd.elements,sN=sL.elements,sm=s_[0],su=s_[1],sx=s_[2],st=s_[3];sh[0]=sm+sl*(sN[0]-sm),sh[1]=su+sl*(sN[1]-su),sh[2]=sx+sl*(sN[2]-sx),sh[3]=st+sl*(sN[3]-st)},sd.transformByM4x4=function(sd,sL,sl){var sZ=sd.elements,sh=sZ[0],s_=sZ[1],sN=sZ[2],sm=sZ[3],su=sL.elements,sx=sl.elements;sx[0]=sh*su[0]+s_*su[4]+sN*su[8]+sm*su[12],sx[1]=sh*su[1]+s_*su[5]+sN*su[9]+sm*su[13],sx[2]=sh*su[2]+s_*su[6]+sN*su[10]+sm*su[14],sx[3]=sh*su[3]+s_*su[7]+sN*su[11]+sm*su[15]},sd.equals=function(sd,sL){var sl=sd.elements,sZ=sL.elements;return sWd.nearEqual(Math.abs(sl[0]),Math.abs(sZ[0]))&&sWd.nearEqual(Math.abs(sl[1]),Math.abs(sZ[1]))&&sWd.nearEqual(Math.abs(sl[2]),Math.abs(sZ[2]))&&sWd.nearEqual(Math.abs(sl[3]),Math.abs(sZ[3]))},sd.normalize=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sd.length();0<sh&&(sZ[0]=sl[0]*sh,sZ[1]=sl[1]*sh,sZ[2]=sl[2]*sh,sZ[3]=sl[3]*sh)},sd.add=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]+s_[0],sZ[1]=sh[1]+s_[1],sZ[2]=sh[2]+s_[2],sZ[3]=sh[3]+s_[3]},sd.subtract=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]-s_[0],sZ[1]=sh[1]-s_[1],sZ[2]=sh[2]-s_[2],sZ[3]=sh[3]-s_[3]},sd.multiply=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=sh[0]*s_[0],sZ[1]=sh[1]*s_[1],sZ[2]=sh[2]*s_[2],sZ[3]=sh[3]*s_[3]},sd.scale=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements;sZ[0]=sh[0]*sL,sZ[1]=sh[1]*sL,sZ[2]=sh[2]*sL,sZ[3]=sh[3]*sL},sd.Clamp=function(sd,sL,sl,sZ){var sh=sd.elements,s_=sh[0],sN=sh[1],sm=sh[2],su=sh[3],sx=sL.elements,st=sx[0],sb=sx[1],sq=sx[2],sY=sx[3],sc=sl.elements,sr=sc[0],sa=sc[1],sk=sc[2],se=sc[3],sw=sZ.elements;s_=(s_=sr<s_?sr:s_)<st?st:s_,sN=(sN=sa<sN?sa:sN)<sb?sb:sN,sm=(sm=sk<sm?sk:sm)<sq?sq:sm,su=(su=se<su?se:su)<sY?sY:su,sw[0]=s_,sw[1]=sN,sw[2]=sm,sw[3]=su},sd.distanceSquared=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sl[0]-sZ[0],s_=sl[1]-sZ[1],sN=sl[2]-sZ[2],sm=sl[3]-sZ[3];return sh*sh+s_*s_+sN*sN+sm*sm},sd.distance=function(sd,sL){var sl=sd.elements,sZ=sL.elements,sh=sl[0]-sZ[0],s_=sl[1]-sZ[1],sN=sl[2]-sZ[2],sm=sl[3]-sZ[3];return Math.sqrt(sh*sh+s_*s_+sN*sN+sm*sm)},sd.dot=function(sd,sL){var sl=sd.elements,sZ=sL.elements;return sl[0]*sZ[0]+sl[1]*sZ[1]+sl[2]*sZ[2]+sl[3]*sZ[3]},sd.min=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=Math.min(sh[0],s_[0]),sZ[1]=Math.min(sh[1],s_[1]),sZ[2]=Math.min(sh[2],s_[2]),sZ[3]=Math.min(sh[3],s_[3])},sd.max=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL.elements;sZ[0]=Math.max(sh[0],s_[0]),sZ[1]=Math.max(sh[1],s_[1]),sZ[2]=Math.max(sh[2],s_[2]),sZ[3]=Math.max(sh[3],s_[3])},sb(sd,["ZERO",function(){return this.ZERO=new sd},"ONE",function(){return this.ONE=new sd(1,1,1,1)},"UnitX",function(){return this.UnitX=new sd(1,0,0,0)},"UnitY",function(){return this.UnitY=new sd(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new sd(0,0,1,0)},"UnitW",function(){return this.UnitW=new sd(0,0,0,1)}]),sd}(),suL=function(){function s_(sd,sL,sl,sZ){this.minDepth=0,this.maxDepth=1,this.x=sd,this.y=sL,this.width=sl,this.height=sZ}sY(s_,"laya.d3.math.Viewport");var sd=s_.prototype;return sd.project=function(sd,sL,sl){sNL.transformV3ToV3(sd,sL,sl);var sZ=sd.elements,sh=sL.elements,s_=sl.elements,sN=sZ[0]*sh[3]+sZ[1]*sh[7]+sZ[2]*sh[11]+sh[15];1!==sN&&(s_[0]=s_[0]/sN,s_[1]=s_[1]/sN,s_[2]=s_[2]/sN),s_[0]=.5*(s_[0]+1)*this.width+this.x,s_[1]=.5*(1-s_[1])*this.height+this.y,s_[2]=s_[2]*(this.maxDepth-this.minDepth)+this.minDepth},sd.unprojectFromMat=function(sd,sL,sl){var sZ=sd.elements,sh=sL.elements,s_=sl.elements;s_[0]=(sZ[0]-this.x)/this.width*2-1,s_[1]=-((sZ[1]-this.y)/this.height*2-1);var sN=(this.maxDepth-this.minDepth)/2;s_[2]=(sZ[2]-this.minDepth-sN)/sN;var sm=s_[0]*sh[3]+s_[1]*sh[7]+s_[2]*sh[11]+sh[15];sNL.transformV3ToV3(sl,sL,sl),1!==sm&&(s_[0]=s_[0]/sm,s_[1]=s_[1]/sm,s_[2]=s_[2]/sm)},sd.unprojectFromWVP=function(sd,sL,sl,sZ,sh){sdL.multiply(sL,sl,s_._tempMatrix4x4),sZ&&sdL.multiply(s_._tempMatrix4x4,sZ,s_._tempMatrix4x4),s_._tempMatrix4x4.invert(s_._tempMatrix4x4),this.unprojectFromMat(sd,s_._tempMatrix4x4,sh)},sb(s_,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new sdL}]),s_}(),sxL=function(){function sg(sd){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=sd,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}sY(sg,"laya.d3.resource.models.SubMesh");var sd=sg.prototype;return sA.imps(sd,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),sd._getVertexBuffer=function(sd){return void 0===sd&&(sd=0),0===sd?this._vertexBuffer:null},sd._getIndexBuffer=function(){return this._indexBuffer},sd._getStaticBatchBakedVertexs=function(sd,sL){var sl,sZ,sh=this._vertexBuffer,s_=sh.vertexDeclaration,sN=s_.getVertexElementByUsage(0).offset/4,sm=s_.getVertexElementByUsage(3).offset/4,su=sL.meshRender.lightmapScaleOffset,sx=0,st=0,sb=0,sq=0,sY=0,sc=0;if(su)if(sZ=s_.getVertexElementByUsage(15))sb=s_.vertexStride/4,sl=0<this._vertexCount?sh.getData().slice(this._vertexStart*sb,(this._vertexStart+this._vertexCount)*sb):sh.getData().slice(),sq=sZ.offset/4;else{sb=(sc=s_.vertexStride/4)+2,sl=this._vertexCount?new Float32Array(this._vertexCount*(sh.vertexDeclaration.vertexStride/4+2)):new Float32Array(sh.vertexCount*(sh.vertexDeclaration.vertexStride/4+2)),sq=(sY=s_.getVertexElementByUsage(2).offset/4)+2;var sr=sh.getData();for(sx=0,st=sr.length/sc;sx<st;sx++){var sa=0;sa=0<this._vertexCount?(this._vertexStart+sx)*sc:sx*sc;var sk=sx*sb,se=0;for(se=0;se<sq;se++)sl[sk+se]=sr[sa+se];for(se=sq;se<sc;se++)sl[sk+se+2]=sr[sa+se]}}else sb=s_.vertexStride/4,sl=this._vertexCount?sh.getData().slice(this._vertexStart*sb,(this._vertexStart+this._vertexCount)*sb):sh.getData().slice();if(sd){var sw=sd.worldMatrix,ss=sg._tempMatrix4x40;sw.invert(ss);var sA=sg._tempMatrix4x41,sy=sL.transform.worldMatrix;sdL.multiply(ss,sy,sA)}else sA=sL.transform.worldMatrix;var s$=sg._tempQuaternion0;for(sA.decomposeTransRotScale(sg._tempVector30,s$,sg._tempVector31),sx=0,st=sl.length/sb;sx<st;sx++){var sO=sx*sb+sN,sn=sx*sb+sm;if(saL.transformVector3ArrayToVector3ArrayCoordinate(sl,sO,sA,sl,sO),saL.transformVector3ArrayByQuat(sl,sn,s$,sl,sn),su){var sV=sx*sb+sq;if(sZ)saL.transformLightingMapTexcoordByUV1Array(sl,sV,su,sl,sV);else{var sQ=sx*sc+sY;saL.transformLightingMapTexcoordByUV0Array(sr,sQ,su,sl,sV)}}}return sl},sd._getVertexBuffers=function(){return null},sd._beforeRender=function(sd){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},sd._render=function(sd){var sL,sl=0,sZ=sd.renderElement;if(1<this._indexCount){var sh=this._boneIndicesList.length;if(1<sh){for(var s_=0;s_<sh;s_++)(sL=sZ._skinAnimationDatas||this._skinAnimationDatas)&&(sZ._shaderValue.setValue(0,sL[s_]),sd._shader.uploadRenderElementUniforms(sZ._shaderValue.data)),sF.mainContext.drawElements(4,this._subIndexBufferCount[s_],5123,2*this._subIndexBufferStart[s_]);sO.drawCall+=sh}else(sL=sZ._skinAnimationDatas||this._skinAnimationDatas)&&(sZ._shaderValue.setValue(0,sL[0]),sd._shader.uploadRenderElementUniforms(sZ._shaderValue.data)),sF.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),sO.drawCall++;sl=this._indexCount}else sl=this._indexBuffer.indexCount,(sL=sZ._skinAnimationDatas||this._skinAnimationDatas)&&(sZ._shaderValue.setValue(0,sL[0]),sd._shader.uploadRenderElementUniforms(sZ._shaderValue.data)),sF.mainContext.drawElements(4,sl,5123,0),sO.drawCall++;sO.trianglesFaces+=sl/3},sd.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},sd.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},sc(0,sd,"_vertexBufferCount",function(){return 1}),sc(0,sd,"triangleCount",function(){return this._indexBuffer.indexCount/3}),sb(sg,["_tempVector30",function(){return this._tempVector30=new sNL},"_tempVector31",function(){return this._tempVector31=new sNL},"_tempQuaternion0",function(){return this._tempQuaternion0=new slL},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new sdL},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new sdL}]),sg}(),stL=function(){function sd(sd){this.defineCounter=0,this.defines=null,sd?(this.defineCounter=sd.defineCounter,this.defines=sd.defines.slice()):(this.defineCounter=0,this.defines=[])}return sY(sd,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),sd.prototype.registerDefine=function(sd){var sL=Math.pow(2,this.defineCounter++);return this.defines[sL]=sd,sL},sd}(),sbL=function(){function sd(){}return sY(sd,"laya.d3.shader.ShaderInit3D"),sd.__init__=function(){var sd,sL;sOL._globalRegDefine("HIGHPRECISION",sOL.SHADERDEFINE_HIGHPRECISION),sOL._globalRegDefine("FOG",sOL.SHADERDEFINE_FOG),sOL._globalRegDefine("DIRECTIONLIGHT",sOL.SHADERDEFINE_DIRECTIONLIGHT),sOL._globalRegDefine("POINTLIGHT",sOL.SHADERDEFINE_POINTLIGHT),sOL._globalRegDefine("SPOTLIGHT",sOL.SHADERDEFINE_SPOTLIGHT),sOL._globalRegDefine("UV",sOL.SHADERDEFINE_UV0),sOL._globalRegDefine("COLOR",sOL.SHADERDEFINE_COLOR),sOL._globalRegDefine("UV1",sOL.SHADERDEFINE_UV1),sOL._globalRegDefine("CASTSHADOW",sYL.SHADERDEFINE_CAST_SHADOW),sOL._globalRegDefine("SHADOWMAP_PSSM1",sYL.SHADERDEFINE_SHADOW_PSSM1),sOL._globalRegDefine("SHADOWMAP_PSSM2",sYL.SHADERDEFINE_SHADOW_PSSM2),sOL._globalRegDefine("SHADOWMAP_PSSM3",sYL.SHADERDEFINE_SHADOW_PSSM3),sOL._globalRegDefine("SHADOWMAP_PCF_NO",sYL.SHADERDEFINE_SHADOW_PCF_NO),sOL._globalRegDefine("SHADOWMAP_PCF1",sYL.SHADERDEFINE_SHADOW_PCF1),sOL._globalRegDefine("SHADOWMAP_PCF2",sYL.SHADERDEFINE_SHADOW_PCF2),sOL._globalRegDefine("SHADOWMAP_PCF3",sYL.SHADERDEFINE_SHADOW_PCF3),sOL._globalRegDefine("DEPTHFOG",sOL.SAHDERDEFINE_DEPTHFOG),sjL.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),sjL.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),sd={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},sL={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var sl=sjL.nameKey.add("SIMPLE");shaderCompile=sOL.add(sl,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',sd,sL),sRL.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),sRL.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),sRL.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),sRL.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),sRL.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),sRL.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),sRL.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),sRL.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),sRL.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},sd}(),sqL=function(){function sd(){this._data=null,this._data=[]}sY(sd,"laya.d3.shader.ValusArray");var sL=sd.prototype;return sL.setValue=function(sd,sL){this._data[sd]=sL},sc(0,sL,"data",function(){return this._data}),sd}(),sYL=function(){function sd(){}return sd.SHADERDEFINE_RECEIVE_SHADOW=1,sd.SHADERDEFINE_CAST_SHADOW=512,sd.SHADERDEFINE_SHADOW_PSSM1=1024,sd.SHADERDEFINE_SHADOW_PSSM2=2048,sd.SHADERDEFINE_SHADOW_PSSM3=4096,sd.SHADERDEFINE_SHADOW_PCF_NO=8192,sd.SHADERDEFINE_SHADOW_PCF1=16384,sd.SHADERDEFINE_SHADOW_PCF2=32768,sd.SHADERDEFINE_SHADOW_PCF3=65536,sd.MAX_PSSM_COUNT=3,sd}(),scL=function(){function sK(){}return sY(sK,"laya.d3.utils.Picker"),sK.calculateCursorRay=function(sd,sL,sl,sZ,sh,s_){var sN=sd.elements[0],sm=sd.elements[1],su=sK._tempVector30,sx=su.elements;sx[0]=sN,sx[1]=sm,sx[2]=sL.minDepth;var st=sK._tempVector31,sb=st.elements;sb[0]=sN,sb[1]=sm,sb[2]=sL.maxDepth;var sq=s_.origin,sY=sK._tempVector32;sL.unprojectFromWVP(su,sl,sZ,sh,sq),sL.unprojectFromWVP(st,sl,sZ,sh,sY);var sc=s_.direction.elements;sc[0]=sY.x-sq.x,sc[1]=sY.y-sq.y,sc[2]=sY.z-sq.z,sNL.normalize(s_.direction,s_.direction)},sK.rayIntersectsPositionsAndIndices=function(sd,sL,sl,sZ,sh){for(var s_=sl.vertexStride/4,sN=sl.getVertexElementByUsage(0).offset/4,sm=Number.MAX_VALUE,su=-1,sx=-1,st=-1,sb=0;sb<sZ.length;sb+=3){var sq=sK._tempVector35,sY=sq.elements,sc=sZ[sb]*s_,sr=sc+sN;sY[0]=sL[sr],sY[1]=sL[1+sr],sY[2]=sL[2+sr];var sa=sK._tempVector36,sk=sa.elements,se=sZ[sb+1]*s_,sw=se+sN;sk[0]=sL[sw],sk[1]=sL[1+sw],sk[2]=sL[2+sw];var ss=sK._tempVector37,sA=ss.elements,sy=sZ[sb+2]*s_,s$=sy+sN;sA[0]=sL[s$],sA[1]=sL[1+s$],sA[2]=sL[2+s$];var sO=laya.d3.utils.Picker.rayIntersectsTriangle(sd,sq,sa,ss);!isNaN(sO)&&sO<sm&&(sm=sO,su=sc,sx=se,st=sy)}if(sm===Number.MAX_VALUE)return sh.position.toDefault(),sh.distance=Number.MAX_VALUE,sh.trianglePositions[0].toDefault(),sh.trianglePositions[1].toDefault(),sh.trianglePositions[2].toDefault(),sh.triangleNormals[0].toDefault(),sh.triangleNormals[1].toDefault(),sh.triangleNormals[2].toDefault(),!1;sh.distance=sm,sNL.scale(sd.direction,sm,sh.position),sNL.add(sd.origin,sh.position,sh.position);var sn=sh.trianglePositions,sV=sn[0],sQ=sn[1],sg=sn[2],sF=sV.elements,sE=sQ.elements,sI=sg.elements,sp=su+sN;sF[0]=sL[sp],sF[1]=sL[sp+1],sF[2]=sL[sp+2];var sH=sx+sN;sE[0]=sL[sH],sE[1]=sL[sH+1],sE[2]=sL[sH+2];var sX=st+sN;sI[0]=sL[sX],sI[1]=sL[sX+1],sI[2]=sL[sX+2];var sj=sl.getVertexElementByUsage(3);if(sj){var sR=sj.offset/4,so=sh.triangleNormals,si=so[0],sS=so[1],sB=so[2],sC=si.elements,sP=sS.elements,sT=sB.elements,sz=su+sR;sC[0]=sL[sz],sC[1]=sL[sz+1],sC[2]=sL[sz+2];var sD=sx+sR;sP[0]=sL[sD],sP[1]=sL[sD+1],sP[2]=sL[sD+2];var sG=st+sR;sT[0]=sL[sG],sT[1]=sL[sG+1],sT[2]=sL[sG+2]}return!0},sK.rayIntersectsTriangle=function(sd,sL,sl,sZ){var sh=sK._tempVector30,s_=sK._tempVector31;sNL.subtract(sl,sL,sh),sNL.subtract(sZ,sL,s_);var sN,sm=sK._tempVector32;if(sNL.cross(sd.direction,s_,sm),(sN=sNL.dot(sh,sm))>-Number.MIN_VALUE&&sN<Number.MIN_VALUE)return Number.NaN;var su,sx=1/sN,st=sK._tempVector33;if(sNL.subtract(sd.origin,sL,st),su=sNL.dot(st,sm),(su*=sx)<0||1<su)return Number.NaN;var sb,sq,sY=sK._tempVector34;return sNL.cross(st,sh,sY),sb=sNL.dot(sd.direction,sY),(sb*=sx)<0||1<su+sb?Number.NaN:(sq=sNL.dot(s_,sY),(sq*=sx)<0?Number.NaN:sq)},sb(sK,["_tempVector30",function(){return this._tempVector30=new sNL},"_tempVector31",function(){return this._tempVector31=new sNL},"_tempVector32",function(){return this._tempVector32=new sNL},"_tempVector33",function(){return this._tempVector33=new sNL},"_tempVector34",function(){return this._tempVector34=new sNL},"_tempVector35",function(){return this._tempVector35=new sNL},"_tempVector36",function(){return this._tempVector36=new sNL},"_tempVector37",function(){return this._tempVector37=new sNL}]),sK}(),srL=(function(){function sd(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new sNL,new sNL,new sNL],this.trianglePositions.length=3,this.triangleNormals=[new sNL,new sNL,new sNL],this.triangleNormals.length=3,this.position=new sNL}sY(sd,"laya.d3.utils.RaycastHit"),sd.prototype.cloneTo=function(sd){sd.distance=this.distance,this.trianglePositions[0].cloneTo(sd.trianglePositions[0]),this.trianglePositions[1].cloneTo(sd.trianglePositions[1]),this.trianglePositions[2].cloneTo(sd.trianglePositions[2]),this.triangleNormals[0].cloneTo(sd.triangleNormals[0]),this.triangleNormals[1].cloneTo(sd.triangleNormals[1]),this.triangleNormals[2].cloneTo(sd.triangleNormals[2]),this.position.cloneTo(sd.position),sd.sprite3D=this.sprite3D}}(),function(){function sd(sd,sL){this._width=0,this._height=0,this._width=sd,this._height=sL}sY(sd,"laya.d3.utils.Size");var sL=sd.prototype;return sc(0,sL,"width",function(){return-1===this._width?sv.clientWidth:this._width}),sc(0,sL,"height",function(){return-1===this._height?sv.clientHeight:this._height}),sc(1,sd,"fullScreen",function(){return new sd(-1,-1)}),sd}()),saL=function(){function sp(){}return sY(sp,"laya.d3.utils.Utils3D"),sp._rotationTransformScaleSkinAnimation=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb){var sq,sY,sc,sr,sa,sk=sp._tempArray16_0,se=sp._tempArray16_1,sw=sp._tempArray16_2,ss=sZ+sZ,sA=sh+sh,sy=s_+s_,s$=sZ*ss,sO=sh*ss,sn=sh*sA,sV=s_*ss,sQ=s_*sA,sg=s_*sy,sF=sN*ss,sE=sN*sA,sI=sN*sy;for(sk[15]=1,sk[0]=1-sn-sg,sk[1]=sO+sI,sk[2]=sV-sE,sk[4]=sO-sI,sk[5]=1-s$-sg,sk[6]=sQ+sF,sk[8]=sV+sE,sk[9]=sQ-sF,sk[10]=1-s$-sn,se[15]=1,se[0]=sm,se[5]=su,se[10]=sx,sq=0;sq<4;sq++)sY=sk[sq],sc=sk[sq+4],sr=sk[sq+8],sa=sk[sq+12],sw[sq]=sY,sw[sq+4]=sc,sw[sq+8]=sr,sw[sq+12]=sY*sd+sc*sL+sr*sl+sa;for(sq=0;sq<4;sq++)sY=sw[sq],sc=sw[sq+4],sr=sw[sq+8],sa=sw[sq+12],st[sq+sb]=sY*se[0]+sc*se[1]+sr*se[2]+sa*se[3],st[sq+sb+4]=sY*se[4]+sc*se[5]+sr*se[6]+sa*se[7],st[sq+sb+8]=sY*se[8]+sc*se[9]+sr*se[10]+sa*se[11],st[sq+sb+12]=sY*se[12]+sc*se[13]+sr*se[14]+sa*se[15]},sp._createNodeByJson=function(sd,sL,sl,sZ){if(!sl)switch(sL.type){case"Sprite3D":sl=new sXL;break;case"MeshSprite3D":sl=new sKL;break;case"SkinnedMeshSprite3D":sl=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":sl=new ShuriKenParticle3D;break;case"TrailSprite3D":sl=new TrailSprite3D;break;case"Terrain":sl=new Terrain;break;case"Camera":sl=new sGL;break;case"DirectionLight":sl=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var sh=sL.props;if(sh)for(var s_ in sh)sl[s_]=sh[s_];var sN=sL.customProps;sN&&(sl instanceof laya.d3.core.Sprite3D?(sl._parseBaseCustomProps(sN),sl._parseCustomProps(sd,sZ,sN,sL),sl._parseCustomComponent(sd,sZ,sL.components)):sl._parseCustomProps(sd,sZ,sN,sL));var sm=sL.child;if(sm)for(var su=0,sx=sm.length;su<sx;su++){var st=sp._createNodeByJson(sd,sm[su],null,sZ);sl.addChild(st)}return sl},sp._computeBoneAndAnimationDatasByBindPoseMatrxix=function(sd,sL,sl,sZ,sh,s_){var sN,sm,su=0,sx=0,st=sd.length;for(sN=0;sN<st;su+=sd[sN].keyframeWidth,sx+=16,sN++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(sL[su+0],sL[su+1],sL[su+2],sL[su+3],sL[su+4],sL[su+5],sL[su+6],sL[su+7],sL[su+8],sL[su+9],sZ,sx),0!=sN&&(sm=16*sd[sN].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(sZ,sm,sZ,sx,sZ,sx));var sb=sl.length;for(sN=0;sN<sb;sN++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(sZ,16*s_[sN],sl[sN],sh,16*sN)},sp._computeAnimationDatasByArrayAndMatrixFast=function(sd,sL,sl,sZ){for(var sh=0,s_=sd.length;sh<s_;sh++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(sL,16*sZ[sh],sd[sh],sl,16*sh)},sp._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(sd,sL,sl,sZ,sh){var s_,sN,sm=0,su=0,sx=sd.length;for(s_=0;s_<sx;sm+=sd[s_].keyframeWidth,su+=16,s_++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(sL[sm+7],sL[sm+8],sL[sm+9],sL[sm+3],sL[sm+4],sL[sm+5],sL[sm+6],sL[sm+0],sL[sm+1],sL[sm+2],sZ,su),0!=s_&&(sN=16*sd[s_].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(sZ,sN,sZ,su,sZ,su));var st=sl.length;for(s_=0;s_<st;s_++){var sb=16*s_;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(sZ,sb,sl[s_],sh,sb)}},sp._computeAnimationDatasByArrayAndMatrixFastOld=function(sd,sL,sl){for(var sZ=sd.length,sh=0;sh<sZ;sh++){var s_=16*sh;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(sL,s_,sd[sh],sl,s_)}},sp._computeRootAnimationData=function(sd,sL,sl){for(var sZ=0,sh=0,s_=0,sN=sd.length;sZ<sN;sh+=sd[sZ].keyframeWidth,s_+=16,sZ++)laya.d3.utils.Utils3D.createAffineTransformationArray(sL[sh+0],sL[sh+1],sL[sh+2],sL[sh+3],sL[sh+4],sL[sh+5],sL[sh+6],sL[sh+7],sL[sh+8],sL[sh+9],sl,s_)},sp.transformVector3ArrayByQuat=function(sd,sL,sl,sZ,sh){var s_=sl.elements,sN=sd[sL],sm=sd[sL+1],su=sd[sL+2],sx=s_[0],st=s_[1],sb=s_[2],sq=s_[3],sY=sq*sN+st*su-sb*sm,sc=sq*sm+sb*sN-sx*su,sr=sq*su+sx*sm-st*sN,sa=-sx*sN-st*sm-sb*su;sZ[sh]=sY*sq+sa*-sx+sc*-sb-sr*-st,sZ[sh+1]=sc*sq+sa*-st+sr*-sx-sY*-sb,sZ[sh+2]=sr*sq+sa*-sb+sY*-st-sc*-sx},sp.mulMatrixByArray=function(sd,sL,sl,sZ,sh,s_){var sN,sm,su,sx,st;if(sh===sl){for(sl=sp._tempArray16_3,sN=0;sN<16;++sN)sl[sN]=sh[s_+sN];sZ=0}for(sN=0;sN<4;sN++)sm=sd[sL+sN],su=sd[sL+sN+4],sx=sd[sL+sN+8],st=sd[sL+sN+12],sh[s_+sN]=sm*sl[sZ+0]+su*sl[sZ+1]+sx*sl[sZ+2]+st*sl[sZ+3],sh[s_+sN+4]=sm*sl[sZ+4]+su*sl[sZ+5]+sx*sl[sZ+6]+st*sl[sZ+7],sh[s_+sN+8]=sm*sl[sZ+8]+su*sl[sZ+9]+sx*sl[sZ+10]+st*sl[sZ+11],sh[s_+sN+12]=sm*sl[sZ+12]+su*sl[sZ+13]+sx*sl[sZ+14]+st*sl[sZ+15]},sp.mulMatrixByArrayFast=function(sd,sL,sl,sZ,sh,s_){var sN,sm,su,sx,st;for(sN=0;sN<4;sN++)sm=sd[sL+sN],su=sd[sL+sN+4],sx=sd[sL+sN+8],st=sd[sL+sN+12],sh[s_+sN]=sm*sl[sZ+0]+su*sl[sZ+1]+sx*sl[sZ+2]+st*sl[sZ+3],sh[s_+sN+4]=sm*sl[sZ+4]+su*sl[sZ+5]+sx*sl[sZ+6]+st*sl[sZ+7],sh[s_+sN+8]=sm*sl[sZ+8]+su*sl[sZ+9]+sx*sl[sZ+10]+st*sl[sZ+11],sh[s_+sN+12]=sm*sl[sZ+12]+su*sl[sZ+13]+sx*sl[sZ+14]+st*sl[sZ+15]},sp.mulMatrixByArrayAndMatrixFast=function(sd,sL,sl,sZ,sh){var s_,sN,sm,su,sx,st=sl.elements,sb=st[0],sq=st[1],sY=st[2],sc=st[3],sr=st[4],sa=st[5],sk=st[6],se=st[7],sw=st[8],ss=st[9],sA=st[10],sy=st[11],s$=st[12],sO=st[13],sn=st[14],sV=st[15],sQ=sL,sg=sL+4,sF=sL+8,sE=sL+12,sI=sh,sp=sh+4,sH=sh+8,sX=sh+12;for(s_=0;s_<4;s_++)sN=sd[sQ+s_],sm=sd[sg+s_],su=sd[sF+s_],sx=sd[sE+s_],sZ[sI+s_]=sN*sb+sm*sq+su*sY+sx*sc,sZ[sp+s_]=sN*sr+sm*sa+su*sk+sx*se,sZ[sH+s_]=sN*sw+sm*ss+su*sA+sx*sy,sZ[sX+s_]=sN*s$+sm*sO+su*sn+sx*sV},sp.createAffineTransformationArray=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb){var sq=sZ+sZ,sY=sh+sh,sc=s_+s_,sr=sZ*sq,sa=sZ*sY,sk=sZ*sc,se=sh*sY,sw=sh*sc,ss=s_*sc,sA=sN*sq,sy=sN*sY,s$=sN*sc;st[sb+0]=(1-(se+ss))*sm,st[sb+1]=(sa+s$)*sm,st[sb+2]=(sk-sy)*sm,st[sb+3]=0,st[sb+4]=(sa-s$)*su,st[sb+5]=(1-(sr+ss))*su,st[sb+6]=(sw+sA)*su,st[sb+7]=0,st[sb+8]=(sk+sy)*sx,st[sb+9]=(sw-sA)*sx,st[sb+10]=(1-(sr+se))*sx,st[sb+11]=0,st[sb+12]=sd,st[sb+13]=sL,st[sb+14]=sl,st[sb+15]=1},sp.transformVector3ArrayToVector3ArrayCoordinate=function(sd,sL,sl,sZ,sh){var s_=sp._tempArray4_0,sN=sd[sL+0],sm=sd[sL+1],su=sd[sL+2],sx=sl.elements;s_[0]=sN*sx[0]+sm*sx[4]+su*sx[8]+sx[12],s_[1]=sN*sx[1]+sm*sx[5]+su*sx[9]+sx[13],s_[2]=sN*sx[2]+sm*sx[6]+su*sx[10]+sx[14],s_[3]=1/(sN*sx[3]+sm*sx[7]+su*sx[11]+sx[15]),sZ[sh+0]=s_[0]*s_[3],sZ[sh+1]=s_[1]*s_[3],sZ[sh+2]=s_[2]*s_[3]},sp.transformLightingMapTexcoordByUV0Array=function(sd,sL,sl,sZ,sh){var s_=sl.elements;sZ[sh+0]=sd[sL+0]*s_[0]+s_[2],sZ[sh+1]=(sd[sL+1]-1)*s_[1]+s_[3]},sp.transformLightingMapTexcoordByUV1Array=function(sd,sL,sl,sZ,sh){var s_=sl.elements;sZ[sh+0]=sd[sL+0]*s_[0]+s_[2],sZ[sh+1]=1+sd[sL+1]*s_[1]+s_[3]},sp.getURLVerion=function(sd){var sL=sd.indexOf("?");return 0<=sL?sd.substr(sL):null},sp._quaternionCreateFromYawPitchRollArray=function(sd,sL,sl,sZ){var sh=.5*sl,s_=.5*sL,sN=.5*sd,sm=Math.sin(sh),su=Math.cos(sh),sx=Math.sin(s_),st=Math.cos(s_),sb=Math.sin(sN),sq=Math.cos(sN);sZ[0]=sq*sx*su+sb*st*sm,sZ[1]=sb*st*su-sq*sx*sm,sZ[2]=sq*st*sm-sb*sx*su,sZ[3]=sq*st*su+sb*sx*sm},sp._createAffineTransformationArray=function(sd,sL,sl,sZ){var sh=sL[0],s_=sL[1],sN=sL[2],sm=sL[3],su=sh+sh,sx=s_+s_,st=sN+sN,sb=sh*su,sq=sh*sx,sY=sh*st,sc=s_*sx,sr=s_*st,sa=sN*st,sk=sm*su,se=sm*sx,sw=sm*st,ss=sl[0],sA=sl[1],sy=sl[2];sZ[0]=(1-(sc+sa))*ss,sZ[1]=(sq+sw)*ss,sZ[2]=(sY-se)*ss,sZ[3]=0,sZ[4]=(sq-sw)*sA,sZ[5]=(1-(sb+sa))*sA,sZ[6]=(sr+sk)*sA,sZ[7]=0,sZ[8]=(sY+se)*sy,sZ[9]=(sr-sk)*sy,sZ[10]=(1-(sb+sc))*sy,sZ[11]=0,sZ[12]=sd[0],sZ[13]=sd[1],sZ[14]=sd[2],sZ[15]=1},sp._mulMatrixArray=function(sd,sL,sl,sZ){var sh,s_,sN,sm,su,sx=sL.elements,st=sx[0],sb=sx[1],sq=sx[2],sY=sx[3],sc=sx[4],sr=sx[5],sa=sx[6],sk=sx[7],se=sx[8],sw=sx[9],ss=sx[10],sA=sx[11],sy=sx[12],s$=sx[13],sO=sx[14],sn=sx[15],sV=sZ,sQ=sZ+4,sg=sZ+8,sF=sZ+12;for(sh=0;sh<4;sh++)s_=sd[sh],sN=sd[sh+4],sm=sd[sh+8],su=sd[sh+12],sl[sV+sh]=s_*st+sN*sb+sm*sq+su*sY,sl[sQ+sh]=s_*sc+sN*sr+sm*sa+su*sk,sl[sg+sh]=s_*se+sN*sw+sm*ss+su*sA,sl[sF+sh]=s_*sy+sN*s$+sm*sO+su*sn},sp.getYawPitchRoll=function(sd,sL){sp.transformQuat(sNL.ForwardRH,sd,slL.TEMPVector31),sp.transformQuat(sNL.Up,sd,slL.TEMPVector32);var sl=slL.TEMPVector32.elements;sp.angleTo(sNL.ZERO,slL.TEMPVector31,slL.TEMPVector33);var sZ=slL.TEMPVector33.elements;sZ[0]==Math.PI/2?(sZ[1]=sp.arcTanAngle(sl[2],sl[0]),sZ[2]=0):sZ[0]==-Math.PI/2?(sZ[1]=sp.arcTanAngle(-sl[2],-sl[0]),sZ[2]=0):(sdL.createRotationY(-sZ[1],slL.TEMPMatrix0),sdL.createRotationX(-sZ[0],slL.TEMPMatrix1),sNL.transformCoordinate(slL.TEMPVector32,slL.TEMPMatrix0,slL.TEMPVector32),sNL.transformCoordinate(slL.TEMPVector32,slL.TEMPMatrix1,slL.TEMPVector32),sZ[2]=sp.arcTanAngle(sl[1],-sl[0])),sZ[1]<=-Math.PI&&(sZ[1]=Math.PI),sZ[2]<=-Math.PI&&(sZ[2]=Math.PI),sZ[1]>=Math.PI&&sZ[2]>=Math.PI&&(sZ[1]=0,sZ[2]=0,sZ[0]=Math.PI-sZ[0]),sL[0]=sZ[1],sL[1]=sZ[0],sL[2]=sZ[2]},sp.arcTanAngle=function(sd,sL){return 0==sd?1==sL?Math.PI/2:-Math.PI/2:0<sd?Math.atan(sL/sd):sd<0?0<sL?Math.atan(sL/sd)+Math.PI:Math.atan(sL/sd)-Math.PI:0},sp.angleTo=function(sd,sL,sl){sNL.subtract(sL,sd,slL.TEMPVector30),sNL.normalize(slL.TEMPVector30,slL.TEMPVector30),sl.elements[0]=Math.asin(slL.TEMPVector30.y),sl.elements[1]=sp.arcTanAngle(-slL.TEMPVector30.z,-slL.TEMPVector30.x)},sp.transformQuat=function(sd,sL,sl){var sZ=sl.elements,sh=sd.elements,s_=sL,sN=sh[0],sm=sh[1],su=sh[2],sx=s_[0],st=s_[1],sb=s_[2],sq=s_[3],sY=sq*sN+st*su-sb*sm,sc=sq*sm+sb*sN-sx*su,sr=sq*su+sx*sm-st*sN,sa=-sx*sN-st*sm-sb*su;sZ[0]=sY*sq+sa*-sx+sc*-sb-sr*-st,sZ[1]=sc*sq+sa*-st+sr*-sx-sY*-sb,sZ[2]=sr*sq+sa*-sb+sY*-st-sc*-sx},sp.quaterionNormalize=function(sd,sL){var sl=sd[0],sZ=sd[1],sh=sd[2],s_=sd[3],sN=sl*sl+sZ*sZ+sh*sh+s_*s_;0<sN&&(sN=1/Math.sqrt(sN),sL[0]=sl*sN,sL[1]=sZ*sN,sL[2]=sh*sN,sL[3]=s_*sN)},sp.matrix4x4MultiplyFFF=function(sd,sL,sl){var sZ,sh,s_,sN,sm;if(sl===sL)for(sL=new Float32Array(16),sZ=0;sZ<16;++sZ)sL[sZ]=sl[sZ];for(sZ=0;sZ<4;sZ++)sh=sd[sZ],s_=sd[sZ+4],sN=sd[sZ+8],sm=sd[sZ+12],sl[sZ]=sh*sL[0]+s_*sL[1]+sN*sL[2]+sm*sL[3],sl[sZ+4]=sh*sL[4]+s_*sL[5]+sN*sL[6]+sm*sL[7],sl[sZ+8]=sh*sL[8]+s_*sL[9]+sN*sL[10]+sm*sL[11],sl[sZ+12]=sh*sL[12]+s_*sL[13]+sN*sL[14]+sm*sL[15]},sp.matrix4x4MultiplyMFM=function(sd,sL,sl){sp.matrix4x4MultiplyFFF(sd.elements,sL,sl.elements)},sb(sp,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new sNL},"_tempVector3_1",function(){return this._tempVector3_1=new sNL},"_tempVector3_2",function(){return this._tempVector3_2=new sNL},"_tempVector3_3",function(){return this._tempVector3_3=new sNL},"_tempVector3_4",function(){return this._tempVector3_4=new sNL},"_tempVector3_5",function(){return this._tempVector3_5=new sNL},"_tempVector3_6",function(){return this._tempVector3_6=new sNL},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),sp}(),skL=function(){function sE(){}return sY(sE,"Laya3D"),sE._cancelLoadByUrl=function(sd){sA.loader.cancelLoadByUrl(sd),sE._innerFirstLevelLoaderManager.cancelLoadByUrl(sd),sE._innerSecondLevelLoaderManager.cancelLoadByUrl(sd),sE._innerThirdLevelLoaderManager.cancelLoadByUrl(sd),sE._innerFourthLevelLoaderManager.cancelLoadByUrl(sd)},sE._changeWebGLSize=function(sd,sL){sF.onStageResize(sd,sL),sv.clientWidth=sd,sv.clientHeight=sL},sE.__init__=function(){var sd=sL.createMap;sd.lh=[sXL,"SPRITE3DHIERARCHY"],sd.ls=[sHL,"SPRITE3DHIERARCHY"],sd.lm=[sCL,"MESH"],sd.lmat=[sRL,"MATERIAL"],sd.jpg=[sTL,"nativeimage"],sd.jpeg=[sTL,"nativeimage"],sd.png=[sTL,"nativeimage"],sd.pkm=[sTL,"arraybuffer"],sd.raw=[sSL,"arraybuffer"],sd.mipmaps=[sSL,"arraybuffer"],sk.parserMap.SPRITE3DHIERARCHY=sE._loadHierarchy,sk.parserMap.MESH=sE._loadMesh,sk.parserMap.MATERIAL=sE._loadMaterial,sk.parserMap.TEXTURECUBE=sE._loadTextureCube,sk.parserMap.TERRAIN=sE._loadTerrain,sE._innerFirstLevelLoaderManager.on("error",null,sE._eventLoadManagerError),sE._innerSecondLevelLoaderManager.on("error",null,sE._eventLoadManagerError),sE._innerThirdLevelLoaderManager.on("error",null,sE._eventLoadManagerError),sE._innerFourthLevelLoaderManager.on("error",null,sE._eventLoadManagerError)},sE.READ_BLOCK=function(){return sE._readData.pos+=4,!0},sE.READ_DATA=function(){return sE._DATA.offset=sE._readData.getUint32(),sE._DATA.size=sE._readData.getUint32(),!0},sE.READ_STRINGS=function(){var sd=[],sL={offset:0,size:0};sL.offset=sE._readData.getUint16(),sL.size=sE._readData.getUint16();sE._readData.pos;sE._readData.pos=sL.offset+sE._DATA.offset;for(var sl=0;sl<sL.size;sl++){var sZ=sE._readData.readUTFString();-1===sZ.lastIndexOf(".lmat")&&-1===sZ.lastIndexOf(".lpbr")||sd.push(sZ)}return sd},sE.formatRelativePath=function(sd,sL){var sl;if("."===sL.charAt(0)){for(var sZ=(sd+sL).split("/"),sh=0,s_=sZ.length;sh<s_;sh++)if(".."==sZ[sh]){var sN=sh-1;0<sN&&".."!==sZ[sN]&&(sZ.splice(sN,2),sh-=2)}sl=sZ.join("/")}else sl=sd+sL;return null!=sg.customFormat&&(sl=sg.customFormat(sl,null)),sl},sE._eventLoadManagerError=function(sd){sA.loader.event("error",sd)},sE._addHierarchyInnerUrls=function(sd,sL,sl,sZ,sh,s_){var sN=sE.formatRelativePath(sZ,sh);sl&&(sN+=sl),sd.push({url:sN,clas:s_}),sL[sh]=sN},sE._getSprite3DHierarchyInnerUrls=function(sd,sL,sl,sZ,sh,s_,sN){var sm,su=0,sx=0;switch(sd.type){case"Scene":var st=sd.customProps.lightmaps;for(su=0,sx=st.length;su<sx;su++){var sb=st[su].replace(".exr",".png");sE._addHierarchyInnerUrls(sZ,sh,s_,sN,sb,sTL)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var sq;if(sd.instanceParams)(sq=sd.instanceParams.loadPath)&&sE._addHierarchyInnerUrls(sL,sh,s_,sN,sq,sCL);else{(sq=(sm=sd.customProps).meshPath)&&sE._addHierarchyInnerUrls(sL,sh,s_,sN,sq,sCL);var sY=sm.materials;if(sY)for(su=0,sx=sY.length;su<sx;su++){for(var sc=sY[su],sr=sc.type.split("."),sa=sI.window,sk=0,se=sr.length;sk<se;++sk){sa=sa[this.clasPaths[sk]]}if("function"!=typeof sa)throw"_getSprite3DHierarchyInnerUrls 错误: "+sc.type+" 不是类";sE._addHierarchyInnerUrls(sl,sh,s_,sN,sc.path,sa)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var sw=(sm=sd.customProps).meshPath;sw&&sE._addHierarchyInnerUrls(sL,sh,s_,sN,sw,sCL);var ss=sm.material;if(ss){sr=ss.type.split("."),sa=sI.window;for(sk=0,se=sr.length;sk<se;++sk){sa=sa[this.clasPaths[sk]]}sE._addHierarchyInnerUrls(sl,sh,s_,sN,ss.path,sa)}else{var sA=sm.materialPath;if(sA)sE._addHierarchyInnerUrls(sl,sh,s_,sN,sA,ShurikenParticleMaterial);else{var sy=sm.texturePath;sy&&sE._addHierarchyInnerUrls(sZ,sh,s_,sN,sy,sTL)}}break;case"Terrain":sE._addHierarchyInnerUrls(sZ,sh,s_,sN,sd.customProps.dataPath,TerrainRes)}var s$=sd.components;for(var sO in s$){var sn=s$[sO];switch(sO){case"Animator":var sV=sn.avatarPath;if(sV)sE._addHierarchyInnerUrls(sZ,sh,s_,sN,sV,Avatar);else{var sQ=sn.avatar;sQ&&sE._addHierarchyInnerUrls(sZ,sh,s_,sN,sQ.path,Avatar)}var sg=sn.clipPaths;for(su=0,sx=sg.length;su<sx;su++)sE._addHierarchyInnerUrls(sZ,sh,s_,sN,sg[su],AnimationClip)}}var sF=sd.child;for(su=0,sx=sF.length;su<sx;su++)sE._getSprite3DHierarchyInnerUrls(sF[su],sL,sl,sZ,sh,s_,sN)},sE._loadHierarchy=function(sd){sd.on("loaded",null,sE._onHierarchylhLoaded,[sd,sd._class._getGroup()]),sd.load(sd.url,"json",!1,null,!0)},sE._onHierarchylhLoaded=function(sd,sL,sl){if(sd._class.destroyed)sd.endLoad();else{var sZ=sd.url,sh=saL.getURLVerion(sZ),s_=sg.getPath(sZ),sN=[],sm=[],su=[],sx={};sE._getSprite3DHierarchyInnerUrls(sl,sN,sm,su,sx,sh,s_);var st=sN.length+sm.length+su.length,sb=st+1,sq=1/sb;if(sE._onProcessChange(sd,0,sq,1),0<su.length){var sY=st/sb,sc=sQ.create(null,sE._onProcessChange,[sd,sq,sY],!1);sE._innerFourthLevelLoaderManager.create(su,sQ.create(null,sE._onHierarchyInnerForthLevResouLoaded,[sd,sL,sc,sl,sx,sN,sm,sq+sY*su.length,sY]),sc,null,null,1,!0,sL)}else sE._onHierarchyInnerForthLevResouLoaded(sd,sL,null,sl,sx,sN,sm,sq,sY)}},sE._onHierarchyInnerForthLevResouLoaded=function(sd,sL,sl,sZ,sh,s_,sN,sm,su){if(sd._class.destroyed)sd.endLoad();else if(sl&&sl.recover(),0<sN.length){var sx=sQ.create(null,sE._onProcessChange,[sd,sm,su],!1);sE._innerSecondLevelLoaderManager.create(sN,sQ.create(null,sE._onHierarchyInnerSecondLevResouLoaded,[sd,sL,sx,sZ,sh,s_,sm+su*sN.length,su]),sl,null,null,1,!0,sL)}else sE._onHierarchyInnerSecondLevResouLoaded(sd,sL,null,sZ,sh,s_,sm,su)},sE._onHierarchyInnerSecondLevResouLoaded=function(sd,sL,sl,sZ,sh,s_,sN,sm){if(sd._class.destroyed)sd.endLoad();else if(sl&&sl.recover(),0<s_.length){var su=sQ.create(null,sE._onProcessChange,[sd,sN,sm],!1);sE._innerFirstLevelLoaderManager.create(s_,sQ.create(null,sE._onHierarchyInnerFirstLevResouLoaded,[sd,su,sZ,sh]),sl,null,null,1,!0,sL)}else sE._onHierarchyInnerFirstLevResouLoaded(sd,null,sZ,sh)},sE._onHierarchyInnerFirstLevResouLoaded=function(sd,sL,sl,sZ){sL&&sL.recover(),sd.endLoad([sl,sZ])},sE._loadTerrain=function(sd){sd.on("loaded",null,sE._onTerrainLtLoaded,[sd,sd._class._getGroup()]),sd.load(sd.url,"json",!1,null,!0)},sE._onTerrainLtLoaded=function(sd,sL,sl){if(sd._class.destroyed)sd.endLoad();else{var sZ,sh,s_=sd.url,sN=saL.getURLVerion(s_),sm=sg.getPath(s_),su=[],sx={},st=0,sb=0,sq=sl.heightData;sZ=sq.url,sh=sE.formatRelativePath(sm,sZ),sN&&(sh+=sN),sZ=sx[sZ]=sh;var sY=sl.detailTexture;for(st=0,sb=sY.length;st<sb;st++)su.push({url:sY[st].diffuse});var sc=sl.normalMap;for(st=0,sb=sc.length;st<sb;st++)su.push({url:sc[st]});var sr=sl.alphaMap;for(st=0,sb=sr.length;st<sb;st++)su.push({url:sr[st],params:[!1,!1,6408,!0]});for(st=0,sb=su.length;st<sb;st++){var sa=su[st].url;sh=sE.formatRelativePath(sm,sa),sN&&(sh+=sN),su[st].url=sh,sx[sa]=sh}var sk=su.length,se=sk+2,sw=1/se;sE._onProcessChange(sd,0,sw,1);var ss={heightMapLoaded:!1,texturesLoaded:!1},sA=sQ.create(null,sE._onProcessChange,[sd,sw,sw],!1);sE._innerFourthLevelLoaderManager.create(sZ,sQ.create(null,sE._onTerrainHeightMapLoaded,[sd,sA,sl,sx,ss]),sA,null,[sq.numX,sq.numZ,sq.bitType,sq.value],1,!0,sL);var sy=sQ.create(null,sE._onProcessChange,[sd,2*sw,sk/se],!1);sE._innerFourthLevelLoaderManager.create(su,sQ.create(null,sE._onTerrainTexturesLoaded,[sd,sy,sl,sx,ss]),sy,null,null,1,!0,sL)}},sE._onTerrainHeightMapLoaded=function(sd,sL,sl,sZ,sh){sh.heightMapLoaded=!0,sh.texturesLoaded&&(sd.endLoad([sl,sZ]),sL.recover())},sE._onTerrainTexturesLoaded=function(sd,sL,sl,sZ,sh){sh.texturesLoaded=!0,sh.heightMapLoaded&&(sd.endLoad([sl,sZ]),sL.recover())},sE._loadMesh=function(sd){sd.on("loaded",null,sE._onMeshLmLoaded,[sd,sd._class._getGroup()]),sd.load(sd.url,"arraybuffer",!1,null,!0)},sE._onMeshLmLoaded=function(sd,sL,sl){if(sd._class.destroyed)sd.endLoad();else{var sZ,sh,s_,sN=sd.url,sm=saL.getURLVerion(sN),su=sg.getPath(sN),sx={},st=0,sb=0;switch((sE._readData=new sy(sl)).pos=0,sE._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var sq=sE._readData.getUint32();sE._readData.pos=sE._readData.pos+4,sb=sE._readData.getUint16(),sE._readData.pos=sE._readData.pos+8*sb;var sY=sE._readData.getUint32();for(sb=sE._readData.getUint16(),sE._readData.pos=sq+sY,sZ=[],st=0;st<sb;st++){var sc=sE._readData.readUTFString();-1!==sc.lastIndexOf(".lmat")&&sZ.push(sc)}break;default:for(sE.READ_BLOCK(),st=0;st<2;st++){var sr=sE._readData.getUint16(),sa=sE._strings[sr],sk=sE["READ_"+sa];if(null==sk)throw new Error("model file err,no this function:"+sr+" "+sa);1===st?sZ=sk.call():sk.call()}}for(st=0,s_=sZ.length;st<s_;st++){var se=sZ[st];sh=sE.formatRelativePath(su,se),sm&&(sh+=sm),sZ[st]=sh,sx[se]=sh}if(0<sZ.length){sE._onProcessChange(sd,0,.5,1);var sw=sQ.create(null,sE._onProcessChange,[sd,.5,.5],!1);sE._innerSecondLevelLoaderManager.create(sZ,sQ.create(null,sE._onMeshMateialLoaded,[sd,sw,sl,sx]),sw,null,null,1,!0,sL)}else sd.endLoad([sl,sx])}},sE._onMeshMateialLoaded=function(sd,sL,sl,sZ){sd.endLoad([sl,sZ]),sL.recover()},sE._getMaterialTexturePath=function(sd,sL,sl){var sZ=sd.length-4;return sd.indexOf(".dds")!=sZ&&sd.indexOf(".tga")!=sZ&&sd.indexOf(".exr")!=sZ&&sd.indexOf(".DDS")!=sZ&&sd.indexOf(".TGA")!=sZ&&sd.indexOf(".EXR")!=sZ||(sd=sd.substr(0,sZ)+".png"),sd=sE.formatRelativePath(sl,sd),sL&&(sd+=sL),sd},sE._loadMaterial=function(sd){sd.on("loaded",null,sE._onMaterilLmatLoaded,[sd,sd._class._getGroup()]),sd.load(sd.url,"json",!1,null,!0)},sE._onMaterilLmatLoaded=function(sd,sL,sl){if(sd._class.destroyed)sd.endLoad();else{var sZ,sh=sd.url,s_=saL.getURLVerion(sh),sN=sg.getPath(sh),sm=[],su={},sx=sl.customProps,st=sl.version;if(st)switch(st){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var sb=sl.props.textures,sq=0,sY=sb.length;sq<sY;sq++){var sc=sb[sq],sr=sc.path;if(sr){var sa=sr.length-4;sr.indexOf(".exr")!=sa&&sr.indexOf(".EXR")!=sa||(sr=sr.substr(0,sa)+".png"),sZ=sE.formatRelativePath(sN,sr),s_&&(sZ+=s_),sm.push({url:sZ,params:sc.params}),su[sr]=sZ}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var sk=sx.diffuseTexture.texture2D;if(sk&&(sZ=sE._getMaterialTexturePath(sk,s_,sN),sm.push(sZ),su[sk]=sZ),sx.normalTexture){var se=sx.normalTexture.texture2D;se&&(sZ=sE._getMaterialTexturePath(se,s_,sN),sm.push(sZ),su[se]=sZ)}if(sx.specularTexture){var sw=sx.specularTexture.texture2D;sw&&(sZ=sE._getMaterialTexturePath(sw,s_,sN),sm.push(sZ),su[sw]=sZ)}if(sx.emissiveTexture){var ss=sx.emissiveTexture.texture2D;ss&&(sZ=sE._getMaterialTexturePath(ss,s_,sN),sm.push(sZ),su[ss]=sZ)}if(sx.ambientTexture){var sA=sx.ambientTexture.texture2D;sA&&(sZ=sE._getMaterialTexturePath(sA,s_,sN),sm.push(sZ),su[sA]=sZ)}if(sx.reflectTexture){var sy=sx.reflectTexture.texture2D;sy&&(sZ=sE._getMaterialTexturePath(sy,s_,sN),sm.push(sZ),su[sy]=sZ)}}var s$=sm.length,sO=s$+1,sn=1/sO;if(sE._onProcessChange(sd,0,sn,1),0<s$){var sV=sQ.create(null,sE._onProcessChange,[sd,sn,s$/sO],!1);sE._innerFourthLevelLoaderManager.create(sm,sQ.create(null,sE._onMateialTexturesLoaded,[sd,sV,sl,su]),sV,sTL,null,1,!0,sL)}else sE._onMateialTexturesLoaded(sd,null,sl,null)}},sE._onMateialTexturesLoaded=function(sd,sL,sl,sZ){sd.endLoad([sl,sZ]),sL&&sL.recover()},sE._loadTextureCube=function(sd){sd.on("loaded",null,sE._onTextureCubeLtcLoaded,[sd]),sd.load(sd.url,"json",!1,null,!0)},sE._onTextureCubeLtcLoaded=function(sd,sL){if(sd._class.destroyed)sd.endLoad();else{var sl=sg.getPath(sd.url),sZ=[sE.formatRelativePath(sl,sL.px),sE.formatRelativePath(sl,sL.nx),sE.formatRelativePath(sl,sL.py),sE.formatRelativePath(sl,sL.ny),sE.formatRelativePath(sl,sL.pz),sE.formatRelativePath(sl,sL.nz)];sE._onProcessChange(sd,0,1/7,1);var sh=sQ.create(null,sE._onProcessChange,[sd,1/7,6/7],!1);sE._innerFourthLevelLoaderManager.load(sZ,sQ.create(null,sE._onTextureCubeImagesLoaded,[sd,sZ,sh]),sh,"nativeimage")}},sE._onTextureCubeImagesLoaded=function(sd,sL,sl){var sZ=[];sZ.length=6;for(var sh=0;sh<6;sh++){var s_=sL[sh];sZ[sh]=sk.getRes(s_),sk.clearRes(s_)}sd.endLoad(sZ),sl.recover()},sE._onProcessChange=function(sd,sL,sl,sZ){(sZ=sL+sZ*sl)<1&&sd.event("progress",sZ)},sE.init=function(sd,sL,sl,sZ,sh,s_){if(void 0===sl&&(sl=!1),void 0===sZ&&(sZ=!1),void 0===sh&&(sh=!0),void 0===s_&&(s_=!0),se.update3DLoop=function(){},se.cancelLoadByUrl=function(sd){sE._cancelLoadByUrl(sd)},su.isAntialias=sl,su.isAlpha=sZ,su.premultipliedAlpha=sh,su.isStencil=s_,!sF.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");se.changeWebGLSize=sE._changeWebGLSize,sr.is3DMode=!0,sA.init(sd,sL),sp.__init__(),sbL.__init__(),sKL.__init__(),sB.__init__(),sE.__init__(),sN.maxTextureCount=2,(sE.debugMode||sJ.debugMode)&&(sE._debugPhasorSprite=new sD)},sE.HIERARCHY="SPRITE3DHIERARCHY",sE.MESH="MESH",sE.MATERIAL="MATERIAL",sE.PBRMATERIAL="PBRMTL",sE.TEXTURECUBE="TEXTURECUBE",sE.TERRAIN="TERRAIN",sE._readData=null,sE._debugPhasorSprite=null,sE.debugMode=!1,sb(sE,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new sL},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new sL},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new sL},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new sL}]),sE}(),seL=function(sd){function sh(sd){sh.__super.call(this),this._owner=sd,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}sY(sh,"laya.d3.animation.AnimationTransform3D",s_);var sL=sh.prototype;return sL._getlocalMatrix=function(){return this._localUpdate&&(saL._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},sL._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldTransform()}},sL._setWorldMatrixAndUpdate=function(sd){if(this._worldMatrix=sd,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var sL=this._getlocalMatrix(),sl=0;sl<16;++sl)this._worldMatrix[sl]=sL[sl];else saL.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},sL._setWorldMatrixNoUpdate=function(sd){this._worldMatrix=sd},sL._setWorldMatrixIgnoreUpdate=function(sd){this._worldMatrix=sd,this._worldUpdate=!1},sL.getLocalPosition=function(){return this._localPosition},sL.setLocalPosition=function(sd){if(this._parent)this._localPosition=sd,this._localUpdate=!0,this._onWorldTransform();else{var sL=this._entity.owner._transform,sl=this._entity.localPosition,sZ=sl.elements;sZ[0]=sd[0],sZ[1]=sd[1],sZ[2]=sd[2],sL.localPosition=sl}},sL.getLocalRotation=function(){if(this._localQuaternionUpdate){var sd=this._localRotationEuler;saL._quaternionCreateFromYawPitchRollArray(sd[1]/sh._angleToRandin,sd[0]/sh._angleToRandin,sd[2]/sh._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},sL.setLocalRotation=function(sd){if(this._parent)this._localRotation=sd,saL.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var sL=this._entity.owner._transform,sl=this._entity.localRotation,sZ=sl.elements;sZ[0]=sd[0],sZ[1]=sd[1],sZ[2]=sd[2],sZ[3]=sd[3],sL.localRotation=sl}},sL.getLocalScale=function(){return this._localScale},sL.setLocalScale=function(sd){if(this._parent)this._localScale=sd,this._localUpdate=!0,this._onWorldTransform();else{var sL=this._entity.owner._transform,sl=this._entity.localScale,sZ=sl.elements;sZ[0]=sd[0],sZ[1]=sd[1],sZ[2]=sd[2],sL.localScale=sl}},sL.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){saL.getYawPitchRoll(this._localRotation,sh._tempVector3);var sd=sh._tempVector3,sL=this._localRotationEuler;sL[0]=sd[1]*sh._angleToRandin,sL[1]=sd[0]*sh._angleToRandin,sL[2]=sd[2]*sh._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},sL.setLocalRotationEuler=function(sd){if(this._parent)saL._quaternionCreateFromYawPitchRollArray(sd[1]/sh._angleToRandin,sd[0]/sh._angleToRandin,sd[2]/sh._angleToRandin,this._localRotation),this._localRotationEuler=sd,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var sL=this._entity.owner._transform,sl=this._entity.localRotationEuler,sZ=sl.elements;sZ[0]=sd[0],sZ[1]=sd[1],sZ[2]=sd[2],sL.localRotationEuler=sl}},sL.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)saL.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var sd=this._getlocalMatrix(),sL=0;sL<16;++sL)this._worldMatrix[sL]=sd[sL];this._worldUpdate=!1}return this._worldMatrix},sL.setParent=function(sd){if(this._parent!==sd){if(this._parent){var sL=this._parent._childs,sl=sL.indexOf(this);sL.splice(sl,1)}sd&&(sd._childs.push(this),sd&&this._onWorldTransform()),this._parent=sd}},sb(sh,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),sh}(),swL=function(sd){function sL(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,sL.__super.call(this),this._destroyed=!1,this._id=sL._uniqueIDCounter,sL._uniqueIDCounter++}sY(sL,"laya.d3.component.Component3D",s_);var sl=sL.prototype;return sA.imps(sl,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),sl._initialize=function(sd){this._owner=sd,this._enable=!0,this.started=!1,this._load(sd)},sl._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},sl._load=function(sd){},sl._start=function(sd){},sl._update=function(sd){},sl._lateUpdate=function(sd){},sl._preRenderUpdate=function(sd){},sl._postRenderUpdate=function(sd){},sl._unload=function(sd){this.offAll()},sl._cloneTo=function(sd){},sc(0,sl,"id",function(){return this._id}),sc(0,sl,"destroyed",function(){return this._destroyed}),sc(0,sl,"owner",function(){return this._owner}),sc(0,sl,"enable",function(){return this._enable},function(sd){this._enable!==sd&&(this._enable=sd,this.event("enablechanged",this._enable))}),sc(0,sl,"isSingleton",function(){return sL._isSingleton}),sL._isSingleton=!0,sL._uniqueIDCounter=1,sL}(),ssL=function(sd){function sL(){this._destroyed=!1,sL.__super.call(this),this._destroyed=!1}sY(sL,"laya.d3.core.GeometryFilter",s_);var sl=sL.prototype;return sA.imps(sl,{"laya.resource.IDestroy":!0}),sl._destroy=function(){this.offAll(),this._destroyed=!0},sc(0,sl,"_isAsyncLoaded",function(){return!0}),sc(0,sl,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),sc(0,sl,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),sc(0,sl,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),sc(0,sl,"destroyed",function(){return this._destroyed}),sL}(),sAL=function(sd){function sZ(sd){sZ.__super.call(this),this._id=++sZ._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new sJd(new sNL,new sNL),this._boundingBoxCenter=new sNL,this._boundingSphere=new sUd(new sNL,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=sd,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}sY(sZ,"laya.d3.core.render.BaseRender",s_);var sL=sZ.prototype;return sA.imps(sL,{"laya.resource.IDestroy":!0}),sL._changeMaterialReference=function(sd,sL){sd&&sd._removeReference(),sL._addReference()},sL._getInstanceMaterial=function(sd,sL){var sl=new sd.constructor;return sd.cloneTo(sl),sl.name=sl.name+"(Instance)",this._materialsInstance[sL]=!0,this._changeMaterialReference(this._materials[sL],sl),this._materials[sL]=sl},sL._setShaderValuelightMap=function(sd){this._setShaderValueTexture(3,sd)},sL._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},sL._renderRenderableBoundBox=function(){var sd=skL._debugPhasorSprite,sL=this.boundingBox,sl=sZ._tempBoundBoxCorners;sL.getCorners(sl),sd.line(sl[0],sZ._greenColor,sl[1],sZ._greenColor),sd.line(sl[2],sZ._greenColor,sl[3],sZ._greenColor),sd.line(sl[4],sZ._greenColor,sl[5],sZ._greenColor),sd.line(sl[6],sZ._greenColor,sl[7],sZ._greenColor),sd.line(sl[0],sZ._greenColor,sl[3],sZ._greenColor),sd.line(sl[1],sZ._greenColor,sl[2],sZ._greenColor),sd.line(sl[2],sZ._greenColor,sl[6],sZ._greenColor),sd.line(sl[3],sZ._greenColor,sl[7],sZ._greenColor),sd.line(sl[0],sZ._greenColor,sl[4],sZ._greenColor),sd.line(sl[1],sZ._greenColor,sl[5],sZ._greenColor),sd.line(sl[4],sZ._greenColor,sl[7],sZ._greenColor),sd.line(sl[5],sZ._greenColor,sl[6],sZ._greenColor)},sL._calculateBoundingSphere=function(){throw"BaseRender: must override it."},sL._calculateBoundingBox=function(){throw"BaseRender: must override it."},sL._setShaderValueTexture=function(sd,sL){this._owner._shaderValues.setValue(sd,sL)},sL._setShaderValueMatrix4x4=function(sd,sL){this._owner._shaderValues.setValue(sd,sL?sL.elements:null)},sL._setShaderValueColor=function(sd,sL){this._owner._shaderValues.setValue(sd,sL?sL.elements:null)},sL._setShaderValueBuffer=function(sd,sL){this._owner._shaderValues.setValue(sd,sL)},sL._setShaderValueInt=function(sd,sL){this._owner._shaderValues.setValue(sd,sL)},sL._setShaderValueBool=function(sd,sL){this._owner._shaderValues.setValue(sd,sL)},sL._setShaderValueNumber=function(sd,sL){this._owner._shaderValues.setValue(sd,sL)},sL._setShaderValueVector2=function(sd,sL){this._owner._shaderValues.setValue(sd,sL?sL.elements:null)},sL._addShaderDefine=function(sd){this._owner._shaderDefineValue|=sd},sL._removeShaderDefine=function(sd){this._owner._shaderDefineValue&=~sd},sL._renderUpdate=function(sd){return!0},sL._applyLightMapParams=function(){if(0<=this._lightmapIndex){var sd=this._owner.scene;if(sd){var sL=sd.getlightmaps()[this._lightmapIndex];sL?(this._addShaderDefine(sDL.SAHDERDEFINE_LIGHTMAP),sL.loaded?this._setShaderValuelightMap(sL):sL.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(sDL.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(sDL.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(sDL.SAHDERDEFINE_LIGHTMAP)},sL._updateOctreeNode=function(){var sd=this._treeNode;sd&&this._octreeNodeNeedChange&&(sd.updateObject(this),this._octreeNodeNeedChange=!1)},sL._destroy=function(){this.offAll();var sd=0,sL=0;for(sd=0,sL=this._renderElements.length;sd<sL;sd++)this._renderElements[sd]._destroy();for(sd=0,sL=this._materials.length;sd<sL;sd++)this._materials[sd]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},sc(0,sL,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),sc(0,sL,"id",function(){return this._id}),sc(0,sL,"material",function(){var sd=this._materials[0];if(sd&&!this._materialsInstance[0]){var sL=this._getInstanceMaterial(sd,0);this.event("materialchanged",[this,0,sL])}return this._materials[0]},function(sd){this.sharedMaterial=sd}),sc(0,sL,"sharedMaterial",function(){return this._materials[0]},function(sd){var sL=this._materials[0];sL!==sd&&(this._materials[0]=sd,this._materialsInstance[0]=!1,this._changeMaterialReference(sL,sd),this.event("materialchanged",[this,0,sd]))}),sc(0,sL,"lightmapIndex",function(){return this._lightmapIndex},function(sd){this._lightmapIndex=sd,this._applyLightMapParams()}),sc(0,sL,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(sd){this._lightmapScaleOffset=sd,this._setShaderValueColor(2,sd),this._addShaderDefine(sDL.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),sc(0,sL,"enable",function(){return this._enable},function(sd){this._enable=sd,this.event("enablechanged",[this,sd])}),sc(0,sL,"materials",function(){for(var sd=0,sL=this._materials.length;sd<sL;sd++)if(!this._materialsInstance[sd]){var sl=this._getInstanceMaterial(this._materials[sd],sd);this.event("materialchanged",[this,sd,sl])}return this._materials.slice()},function(sd){this.sharedMaterials=sd}),sc(0,sL,"sharedMaterials",function(){return this._materials.slice()},function(sd){if(!sd)throw new Error("MeshRender: shadredMaterials value can't be null.");var sL=sd.length;this._materialsInstance.length=sL;for(var sl=0;sl<sL;sl++){var sZ=this._materials[sl];sZ!==sd[sl]&&(this._materialsInstance[sl]=!1,this._changeMaterialReference(sZ,sd[sl]),this.event("materialchanged",[this,sl,sd[sl]]))}this._materials=sd}),sc(0,sL,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),sc(0,sL,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var sd=this.boundingBox;sNL.add(sd.min,sd.max,this._boundingBoxCenter),sNL.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),sc(0,sL,"receiveShadow",function(){return this._receiveShadow},function(sd){this._receiveShadow!==sd&&((this._receiveShadow=sd)?this._addShaderDefine(sYL.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(sYL.SHADERDEFINE_RECEIVE_SHADOW))}),sc(0,sL,"destroyed",function(){return this._destroyed}),sZ._uniqueIDCounter=0,sb(sZ,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL,new sNL]},"_greenColor",function(){return this._greenColor=new smL(0,1,0,1)}]),sZ}(),syL=function(sd){function sm(sd){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,sm.__super.call(this),this._localPosition=new sNL,this._localRotation=new slL(0,0,0,1),this._localScale=new sNL(1,1,1),this._localRotationEuler=new sNL,this._localMatrix=new sdL,this._position=new sNL,this._rotation=new slL(0,0,0,1),this._scale=new sNL(1,1,1),this._worldMatrix=new sdL,this._forward=new sNL,this._up=new sNL,this._right=new sNL,this._owner=sd,this._childs=[]}sY(sm,"laya.d3.core.Transform3D",s_);var sL=sm.prototype;return sL._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)sdL.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var sd=sm._tempVector30;sNL.multiply(this.pivot,this._localScale,sd);var sL=sm._tempVector31;sNL.subtract(sd,this.pivot,sL);var sl=sm._tempVector32,sZ=this.localRotation;sNL.transformQuat(sd,sZ,sl),sNL.subtract(sl,sd,sl);var sh=sm._tempVector33;sNL.subtract(this._localPosition,sL,sh),sNL.subtract(sh,sl,sh),sdL.createAffineTransformation(sh,sZ,this._localScale,this._localMatrix)}},sL._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldPositionRotationTransform()}},sL._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldPositionScaleTransform()}},sL._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldPositionTransform()}},sL._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldPositionRotationTransform()}},sL._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldPositionScaleTransform()}},sL._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._onWorldTransform()}},sL.translate=function(sd,sL){void 0===sL&&(sL=!0),sL?(sdL.createFromQuaternion(this.localRotation,sm._tempMatrix0),sNL.transformCoordinate(sd,sm._tempMatrix0,sm._tempVector30),sNL.add(this.localPosition,sm._tempVector30,this._localPosition),this.localPosition=this._localPosition):(sNL.add(this.position,sd,this._position),this.position=this._position)},sL.rotate=function(sd,sL,sl){var sZ;void 0===sL&&(sL=!0),void 0===sl&&(sl=!0),sZ=sl?sd:(sNL.scale(sd,Math.PI/180,sm._tempVector30),sm._tempVector30),slL.createFromYawPitchRoll(sZ.y,sZ.x,sZ.z,sm._tempQuaternion0),sL?(slL.multiply(this._localRotation,sm._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(slL.multiply(sm._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},sL.lookAt=function(sd,sL,sl){void 0===sl&&(sl=!1);var sZ,sh=sd.elements;if(sl){if(sZ=this._localPosition.elements,Math.abs(sZ[0]-sh[0])<sWd.zeroTolerance&&Math.abs(sZ[1]-sh[1])<sWd.zeroTolerance&&Math.abs(sZ[2]-sh[2])<sWd.zeroTolerance)return;slL.lookAt(this._localPosition,sd,sL,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var s_=this.position;if(sZ=s_.elements,Math.abs(sZ[0]-sh[0])<sWd.zeroTolerance&&Math.abs(sZ[1]-sh[1])<sWd.zeroTolerance&&Math.abs(sZ[2]-sh[2])<sWd.zeroTolerance)return;slL.lookAt(s_,sd,sL,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},sc(0,sL,"_isFrontFaceInvert",function(){var sd=this.scale,sL=sd.x<0;return sd.y<0&&(sL=!sL),sd.z<0&&(sL=!sL),sL}),sc(0,sL,"owner",function(){return this._owner}),sc(0,sL,"localRotation",function(){if(this._localQuaternionUpdate){var sd=this._localRotationEuler.elements;slL.createFromYawPitchRoll(sd[1]/sm._angleToRandin,sd[0]/sm._angleToRandin,sd[2]/sm._angleToRandin,this._localRotation)}return this._localRotation},function(sd){this._localRotation=sd,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),sc(0,sL,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?sdL.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(sd){null===this._parent?sd.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),sdL.multiply(this._localMatrix,sd,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=sd,this._worldUpdate=!1}),sc(0,sL,"worldNeedUpdate",function(){return this._worldUpdate}),sc(0,sL,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(sd){this._localMatrix=sd,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),sc(0,sL,"dummy",function(){return this._dummy},function(sd){this._dummy!==sd&&(this._dummy&&(this._dummy._entity=null),sd&&(sd._entity=this),this._dummy=sd)}),sc(0,sL,"localPosition",function(){return this._localPosition},function(sd){this._localPosition=sd,this._localUpdate=!0,this._onWorldPositionTransform()}),sc(0,sL,"position",function(){if(this._positionUpdate){if(null!=this._parent){var sd=this._parent.position;sNL.multiply(this._localPosition,this._parent.scale,sm._tempVector30),sNL.transformQuat(sm._tempVector30,this._parent.rotation,sm._tempVector30),sNL.add(sd,sm._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(sd){if(null!=this._parent){sNL.subtract(sd,this._parent.position,this._localPosition);var sL=this._parent.scale.elements,sl=sL[0],sZ=sL[1],sh=sL[2];if(1!==sl||1!==sZ||1!==sh){var s_=sm._tempVector30,sN=s_.elements;sN[0]=1/sl,sN[1]=1/sZ,sN[2]=1/sh,sNL.multiply(this._localPosition,s_,this._localPosition)}this._parent.rotation.invert(sm._tempQuaternion0),sNL.transformQuat(this._localPosition,sm._tempQuaternion0,this._localPosition)}else sd.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=sd,this._positionUpdate=!1}),sc(0,sL,"localScale",function(){return this._localScale},function(sd){this._localScale=sd,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),sc(0,sL,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(sm._tempVector30);var sd=sm._tempVector30.elements,sL=this._localRotationEuler.elements;sL[0]=sd[1]*sm._angleToRandin,sL[1]=sd[0]*sm._angleToRandin,sL[2]=sd[2]*sm._angleToRandin}return this._localRotationEuler},function(sd){this._localRotationEuler=sd,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),sc(0,sL,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?slL.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(sd){null!=this._parent?(this._parent.rotation.invert(sm._tempQuaternion0),slL.multiply(sd,sm._tempQuaternion0,this._localRotation)):sd.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=sd,this._rotationUpdate=!1}),sc(0,sL,"scale",function(){return this._scaleUpdate&&(null!==this._parent?sNL.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(sd){if(null!==this._parent){var sL=this._parent.scale.elements,sl=sm._tempVector30.elements;sl[0]=1/sL[0],sl[1]=1/sL[1],sl[2]=1/sL[2],sNL.multiply(sd,sm._tempVector30,this._localScale)}else sd.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=sd,this._scaleUpdate=!1}),sc(0,sL,"rotationEuler",null,function(sd){slL.createFromYawPitchRoll(sd.y,sd.x,sd.z,this._rotation),this.rotation=this._rotation}),sc(0,sL,"forward",function(){var sd=this.worldMatrix.elements;return this._forward.elements[0]=-sd[8],this._forward.elements[1]=-sd[9],this._forward.elements[2]=-sd[10],this._forward}),sc(0,sL,"up",function(){var sd=this.worldMatrix.elements;return this._up.elements[0]=sd[4],this._up.elements[1]=sd[5],this._up.elements[2]=sd[6],this._up}),sc(0,sL,"right",function(){var sd=this.worldMatrix.elements;return this._right.elements[0]=sd[0],this._right.elements[1]=sd[1],this._right.elements[2]=sd[2],this._right}),sc(0,sL,"parent",function(){return this._parent},function(sd){if(this._parent!==sd){if(this._parent){var sL=this._parent._childs,sl=sL.indexOf(this);sL.splice(sl,1)}sd&&(sd._childs.push(this),sd&&this._onWorldTransform()),this._parent=sd}}),sb(sm,["_tempVector30",function(){return this._tempVector30=new sNL},"_tempVector31",function(){return this._tempVector31=new sNL},"_tempVector32",function(){return this._tempVector32=new sNL},"_tempVector33",function(){return this._tempVector33=new sNL},"_tempQuaternion0",function(){return this._tempQuaternion0=new slL},"_tempMatrix0",function(){return this._tempMatrix0=new sdL},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),sm}(),s$L=(function(sd){function sL(){this._rotation=0,this._matNeedUpdte=!1,sL.__super.call(this),this._matrix=new sdL,this._offset=new s_L,this._tiling=new s_L(1,1)}sY(sL,"laya.d3.core.TransformUV",s_);var sl=sL.prototype;sA.imps(sl,{"laya.d3.core.IClone":!0}),sl._updateMatrix=function(){sL._tempOffsetV3.elements[0]=this._offset.x,sL._tempOffsetV3.elements[1]=this._offset.y,slL.createFromYawPitchRoll(0,0,this._rotation,sL._tempRotationQua),sL._tempTitlingV3.elements[0]=this._tiling.x,sL._tempTitlingV3.elements[1]=this._tiling.y,sdL.createAffineTransformation(sL._tempOffsetV3,sL._tempRotationQua,sL._tempTitlingV3,this._matrix)},sl.cloneTo=function(sd){sd._matrix=this._matrix.clone(),sd._offset=this._offset.clone(),sd._rotation=this._rotation,sd._tiling=this._tiling.clone()},sl.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sl,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),sc(0,sl,"tiling",function(){return this._tiling},function(sd){this._tiling=sd,this._matNeedUpdte=!0}),sc(0,sl,"offset",function(){return this._offset},function(sd){this._offset=sd,this._matNeedUpdte=!0}),sc(0,sl,"rotation",function(){return this._rotation},function(sd){this._rotation=sd,this._matNeedUpdte=!0}),sb(sL,["_tempOffsetV3",function(){return this._tempOffsetV3=new sNL(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new slL},"_tempTitlingV3",function(){return this._tempTitlingV3=new sNL(1,1,1)}])}(),function(sl){function sd(){this.x=NaN,this.y=NaN,this.z=NaN,sd.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}sY(sd,"laya.d3.core.particleShuriKen.module.shape.BoxShape",sl);var sL=sd.prototype;sL._getShapeBoundBox=function(sd){var sL=sd.min.elements;sL[0]=.5*-this.x,sL[1]=.5*-this.y,sL[2]=.5*-this.z;var sl=sd.max.elements;sl[0]=.5*this.x,sl[1]=.5*this.y,sl[2]=.5*this.z},sL._getSpeedBoundBox=function(sd){var sL=sd.min.elements;sL[0]=0,sL[1]=0,sL[2]=0;var sl=sd.max.elements;sl[0]=0,sl[1]=1,sl[2]=0},sL.generatePositionAndDirection=function(sd,sL,sl,sZ){var sh=sd.elements,s_=sL.elements;sl?(sl.seed=sZ[16],sT._randomPointInsideHalfUnitBox(sd,sl),sZ[16]=sl.seed):sT._randomPointInsideHalfUnitBox(sd),sh[0]=this.x*sh[0],sh[1]=this.y*sh[1],sh[2]=this.z*sh[2],this.randomDirection?sl?(sl.seed=sZ[17],sT._randomPointUnitSphere(sL,sl),sZ[17]=sl.seed):sT._randomPointUnitSphere(sL):(s_[0]=0,s_[1]=0,s_[2]=1)},sL.cloneTo=function(sd){sl.prototype.cloneTo.call(this,sd);var sL=sd;sL.x=this.x,sL.y=this.y,sL.z=this.z,sL.randomDirection=this.randomDirection}}(si),function(sl){function sN(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,sN.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}sY(sN,"laya.d3.core.particleShuriKen.module.shape.CircleShape",sl);var sd=sN.prototype;sd._getShapeBoundBox=function(sd){var sL=sd.min.elements;sL[0]=sL[2]=-this.radius,sL[1]=0;var sl=sd.max.elements;sl[0]=sl[2]=this.radius,sl[1]=0},sd._getSpeedBoundBox=function(sd){var sL=sd.min.elements;sL[0]=sL[1]=-1,sL[2]=0;var sl=sd.max.elements;sl[0]=sl[1]=1,sl[2]=0},sd.generatePositionAndDirection=function(sd,sL,sl,sZ){var sh=sd.elements,s_=sN._tempPositionPoint.elements;sl?(sl.seed=sZ[16],this.emitFromEdge?sT._randomPointUnitArcCircle(this.arc,sN._tempPositionPoint,sl):sT._randomPointInsideUnitArcCircle(this.arc,sN._tempPositionPoint,sl),sZ[16]=sl.seed):this.emitFromEdge?sT._randomPointUnitArcCircle(this.arc,sN._tempPositionPoint):sT._randomPointInsideUnitArcCircle(this.arc,sN._tempPositionPoint),sh[0]=-s_[0],sh[1]=s_[1],sh[2]=0,sNL.scale(sd,this.radius,sd),this.randomDirection?sl?(sl.seed=sZ[17],sT._randomPointUnitSphere(sL,sl),sZ[17]=sl.seed):sT._randomPointUnitSphere(sL):sd.cloneTo(sL)},sd.cloneTo=function(sd){sl.prototype.cloneTo.call(this,sd);var sL=sd;sL.radius=this.radius,sL.arc=this.arc,sL.emitFromEdge=this.emitFromEdge,sL.randomDirection=this.randomDirection},sb(sN,["_tempPositionPoint",function(){return this._tempPositionPoint=new s_L}])}(si),function(sl){function sq(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,sq.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}sY(sq,"laya.d3.core.particleShuriKen.module.shape.ConeShape",sl);var sd=sq.prototype;sd._getShapeBoundBox=function(sd){var sL=this.radius+this.length*Math.sin(this.angle),sl=this.length*Math.cos(this.angle),sZ=sd.min.elements;sZ[0]=sZ[1]=-sL,sZ[2]=0;var sh=sd.max.elements;sh[0]=sh[1]=sL,sh[2]=sl},sd._getSpeedBoundBox=function(sd){var sL=Math.sin(this.angle),sl=sd.min.elements;sl[0]=sl[1]=-sL,sl[2]=0;var sZ=sd.max.elements;sZ[0]=sl[1]=sL,sZ[2]=1},sd.generatePositionAndDirection=function(sd,sL,sl,sZ){var sh,s_=sd.elements,sN=sL.elements,sm=sq._tempPositionPoint.elements,su=NaN,sx=NaN,st=Math.cos(this.angle),sb=Math.sin(this.angle);switch(this.emitType){case 0:sl?(sl.seed=sZ[16],sT._randomPointInsideUnitCircle(sq._tempPositionPoint,sl),sZ[16]=sl.seed):sT._randomPointInsideUnitCircle(sq._tempPositionPoint),su=sm[0],sx=sm[1],s_[0]=su*this.radius,s_[1]=sx*this.radius,s_[2]=0,this.randomDirection?(sl?(sl.seed=sZ[17],sT._randomPointInsideUnitCircle(sq._tempDirectionPoint,sl),sZ[17]=sl.seed):sT._randomPointInsideUnitCircle(sq._tempDirectionPoint),sh=sq._tempDirectionPoint.elements,sN[0]=sh[0]*sb,sN[1]=sh[1]*sb):(sN[0]=su*sb,sN[1]=sx*sb),sN[2]=st;break;case 1:sl?(sl.seed=sZ[16],sT._randomPointUnitCircle(sq._tempPositionPoint,sl),sZ[16]=sl.seed):sT._randomPointUnitCircle(sq._tempPositionPoint),su=sm[0],sx=sm[1],s_[0]=su*this.radius,s_[1]=sx*this.radius,s_[2]=0,this.randomDirection?(sl?(sl.seed=sZ[17],sT._randomPointInsideUnitCircle(sq._tempDirectionPoint,sl),sZ[17]=sl.seed):sT._randomPointInsideUnitCircle(sq._tempDirectionPoint),sh=sq._tempDirectionPoint.elements,sN[0]=sh[0]*sb,sN[1]=sh[1]*sb):(sN[0]=su*sb,sN[1]=sx*sb),sN[2]=st;break;case 2:sl?(sl.seed=sZ[16],sT._randomPointInsideUnitCircle(sq._tempPositionPoint,sl)):sT._randomPointInsideUnitCircle(sq._tempPositionPoint),su=sm[0],sx=sm[1],s_[0]=su*this.radius,s_[1]=sx*this.radius,sN[s_[2]=0]=su*sb,sN[1]=sx*sb,sN[2]=st,sNL.normalize(sL,sL),sl?(sNL.scale(sL,this.length*sl.getFloat(),sL),sZ[16]=sl.seed):sNL.scale(sL,this.length*Math.random(),sL),sNL.add(sd,sL,sd),this.randomDirection&&(sl?(sl.seed=sZ[17],sT._randomPointUnitSphere(sL,sl),sZ[17]=sl.seed):sT._randomPointUnitSphere(sL));break;case 3:sl?(sl.seed=sZ[16],sT._randomPointUnitCircle(sq._tempPositionPoint,sl)):sT._randomPointUnitCircle(sq._tempPositionPoint),su=sm[0],sx=sm[1],s_[0]=su*this.radius,s_[1]=sx*this.radius,sN[s_[2]=0]=su*sb,sN[1]=sx*sb,sN[2]=st,sNL.normalize(sL,sL),sl?(sNL.scale(sL,this.length*sl.getFloat(),sL),sZ[16]=sl.seed):sNL.scale(sL,this.length*Math.random(),sL),sNL.add(sd,sL,sd),this.randomDirection&&(sl?(sl.seed=sZ[17],sT._randomPointUnitSphere(sL,sl),sZ[17]=sl.seed):sT._randomPointUnitSphere(sL));break;default:throw new Error("ConeShape:emitType is invalid.")}},sd.cloneTo=function(sd){sl.prototype.cloneTo.call(this,sd);var sL=sd;sL.angle=this.angle,sL.radius=this.radius,sL.length=this.length,sL.emitType=this.emitType,sL.randomDirection=this.randomDirection},sb(sq,["_tempPositionPoint",function(){return this._tempPositionPoint=new s_L},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new s_L}])}(si),function(sl){function sd(){this.radius=NaN,this.emitFromShell=!1,sd.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}sY(sd,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",sl);var sL=sd.prototype;sL._getShapeBoundBox=function(sd){var sL=sd.min.elements;sL[0]=sL[1]=sL[2]=-this.radius;var sl=sd.max.elements;sl[0]=sl[1]=this.radius,sl[2]=0},sL._getSpeedBoundBox=function(sd){var sL=sd.min.elements;sL[0]=sL[1]=-1,sL[2]=0;var sl=sd.max.elements;sl[0]=sl[1]=sl[2]=1},sL.generatePositionAndDirection=function(sd,sL,sl,sZ){var sh=sd.elements;sl?(sl.seed=sZ[16],this.emitFromShell?sT._randomPointUnitSphere(sd,sl):sT._randomPointInsideUnitSphere(sd,sl),sZ[16]=sl.seed):this.emitFromShell?sT._randomPointUnitSphere(sd):sT._randomPointInsideUnitSphere(sd),sNL.scale(sd,this.radius,sd);var s_=sh[2];s_<0&&(sh[2]=-1*s_),this.randomDirection?sl?(sl.seed=sZ[17],sT._randomPointUnitSphere(sL,sl),sZ[17]=sl.seed):sT._randomPointUnitSphere(sL):sd.cloneTo(sL)},sL.cloneTo=function(sd){sl.prototype.cloneTo.call(this,sd);var sL=sd;sL.radius=this.radius,sL.emitFromShell=this.emitFromShell,sL.randomDirection=this.randomDirection}}(si),function(sl){function sd(){this.radius=NaN,this.emitFromShell=!1,sd.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}sY(sd,"laya.d3.core.particleShuriKen.module.shape.SphereShape",sl);var sL=sd.prototype;sL._getShapeBoundBox=function(sd){var sL=sd.min.elements;sL[0]=sL[1]=sL[2]=-this.radius;var sl=sd.max.elements;sl[0]=sl[1]=sl[2]=this.radius},sL._getSpeedBoundBox=function(sd){var sL=sd.min.elements;sL[0]=sL[1]=sL[2]=-1;var sl=sd.max.elements;sl[0]=sl[1]=sl[2]=1},sL.generatePositionAndDirection=function(sd,sL,sl,sZ){sl?(sl.seed=sZ[16],this.emitFromShell?sT._randomPointUnitSphere(sd,sl):sT._randomPointInsideUnitSphere(sd,sl),sZ[16]=sl.seed):this.emitFromShell?sT._randomPointUnitSphere(sd):sT._randomPointInsideUnitSphere(sd),sNL.scale(sd,this.radius,sd),this.randomDirection?sl?(sl.seed=sZ[17],sT._randomPointUnitSphere(sL,sl),sZ[17]=sl.seed):sT._randomPointUnitSphere(sL):sd.cloneTo(sL)},sL.cloneTo=function(sd){sl.prototype.cloneTo.call(this,sd);var sL=sd;sL.radius=this.radius,sL.emitFromShell=this.emitFromShell,sL.randomDirection=this.randomDirection}}(si),function(sd){function sL(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,sL.__super.call(this)}return sY(sL,"laya.d3.core.render.SubMeshRenderElement",sG),sL}()),sOL=function(sd){function sa(sd,sL,sl,sZ,sh,s_){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=sd,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[sYL.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[sDL.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[sDL.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[sgL.SHADERDEFINE_ALPHATEST]="ALPHATEST";sa.__super.call(this,sd,sL,sl,null,{}),this._attributeMap=sZ;var sN;for(sN in sh){var sm=sh[sN];switch(sm[1]){case 0:this._renderElementUniformMap[sN]=sm[0];break;case 1:this._materialUniformMap[sN]=sm[0];break;case 2:this._spriteUniformMap[sN]=sm[0];break;case 3:this._cameraUniformMap[sN]=sm[0];break;case 4:this._sceneUniformMap[sN]=sm[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}sY(sa,"laya.d3.shader.ShaderCompile3D",sw);var sL=sa.prototype;return sL._definesToNameDic=function(sd,sL){for(var sl={},sZ=1,sh=0;sh<32&&!(sd<(sZ=1<<sh));sh++)if(sd&sZ){var s_=sL[sZ];s_&&(sl[s_]="")}return sl},sL.withCompile=function(sd,sL,sl,sZ){var sh,s_,sN;if(s_=this.sharders[sd])if(sN=s_[sL]){if(sh=sN[sl])return sh}else sN=s_[sL]=[];else sN=(s_=this.sharders[sd]=[])[sL]=[];var sm,su=this._definesToNameDic(sd,sa._globalInt2name),sx=this._definesToNameDic(sL,this._spriteInt2name),st=this._definesToNameDic(sl,this._materialInt2name),sb={},sq="";if(su)for(sm in su)sq+="#define "+sm+"\n",sb[sm]=!0;if(sx)for(sm in sx)sq+="#define "+sm+"\n",sb[sm]=!0;if(st)for(sm in st)sq+="#define "+sm+"\n",sb[sm]=!0;var sY=sjL.nameKey.getName(this._name)+" compile ("+sd+","+sL+","+sl+")",sc=this._VS.toscript(sb,[]),sr=this._PS.toscript(sb,[]);sI.now();if(sh=sjL.create(sq+sc.join("\n"),sq+sr.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,sZ,sY),sN[sl]=sh,laya.d3.shader.ShaderCompile3D.debugMode)sI.now();return sh},sL.precompileShaderWithShaderDefine=function(sd,sL,sl){this.withCompile(sd,sL,sl,!0)},sL.addMaterialDefines=function(sd){var sL=sd.defines;for(var sl in sL){var sZ=sL[sl],sh=parseInt(sl);this._materialInt2name[sh]=sZ,this._materialName2Int[sZ]=sh}},sL.addSpriteDefines=function(sd){var sL=sd.defines;for(var sl in sL){var sZ=sL[sl],sh=parseInt(sl);this._spriteInt2name[sh]=sZ,this._spriteName2Int[sZ]=sh}},sL.getMaterialDefineByName=function(sd){return this._materialName2Int[sd]},sL.registerMaterialDefine=function(sd){var sL=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[sL]=sd,this._materialName2Int[sd]=sL},sL.registerSpriteDefine=function(sd){var sL=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[sL]=sd,this._spriteName2Int[sd]=sL},sa._globalRegDefine=function(sd,sL){sa._globalInt2name[sL]=sd},sa.add=function(sd,sL,sl,sZ,sh){return laya.d3.shader.ShaderCompile3D._preCompileShader[sd]=new sa(sd,sL,sl,sZ,sh,sw.includes)},sa.get=function(sd){return laya.d3.shader.ShaderCompile3D._preCompileShader[sjL.nameKey.getID(sd)]},sa._preCompileShader={},sa._globalInt2name=[],sa.debugMode=!1,sa.SHADERDEFINE_HIGHPRECISION=1,sa.SHADERDEFINE_FOG=4,sa.SHADERDEFINE_DIRECTIONLIGHT=8,sa.SHADERDEFINE_POINTLIGHT=16,sa.SHADERDEFINE_SPOTLIGHT=32,sa.SHADERDEFINE_UV0=64,sa.SHADERDEFINE_COLOR=128,sa.SHADERDEFINE_UV1=256,sa.SAHDERDEFINE_DEPTHFOG=131072,sa}(),snL=function(sd){function sc(){sc.__super.call(this)}sY(sc,"laya.d3.graphics.MeshSprite3DStaticBatchManager",sZd);var sL=sc.prototype;return sL._getStaticBatch=function(sd,sL,sl,sZ){var sh,s_;return s_=sd?sd.id.toString()+sl.id.toString()+sL.id.toString()+sZ.toString():sl.id.toString()+sL.id.toString()+sZ.toString(),this._staticBatches[s_]?sh=this._staticBatches[s_]:this._staticBatches[s_]=sh=new sVL(s_,this,sd,sL,sl),sh},sL._initStaticBatchs=function(sd){var sL,sl;this._initBatchRenderElements.sort(sc._sortPrepareStaticBatch);for(var sZ,sh=!1,s_=0,sN=0,sm=this._initBatchRenderElements.length;sN<sm;sN++){var su,sx=this._initBatchRenderElements[sN],st=sx.renderObj._getVertexBuffer(0);sx._sprite3D;if(sl===st.vertexDeclaration&&sL===sx._material)if(sh)sZ._addCombineBatchRenderObjTest(sx)?(su=sx._staticBatch)!==sZ&&(su&&su._deleteCombineBatchRenderObj(sx),sZ._addCombineBatchRenderObj(sx)):(sh=!1,s_++);else{var sb=this._initBatchRenderElements[sN-1],sq=sb.renderObj,sY=sx.renderObj;sh=!(65535<sq._getVertexBuffer().vertexCount+sY._getVertexBuffer().vertexCount)&&(sZ=this._getStaticBatch(sd,sl,sL,s_),(su=sb._staticBatch)!==sZ&&(su&&su._deleteCombineBatchRenderObj(sb),sZ._addCombineBatchRenderObj(sb)),(su=sx._staticBatch)!==sZ&&(su&&su._deleteCombineBatchRenderObj(sx),sZ._addCombineBatchRenderObj(sx)),!0)}else sh=!1,s_=0;sL=sx._material,sl=st.vertexDeclaration}},sc._sortPrepareStaticBatch=function(sd,sL){var sl=sd._render,sZ=sL._render,sh=sl.lightmapIndex-sZ.lightmapIndex;if(0!=sh)return sh;var s_=sl.receiveShadow-sZ.receiveShadow;if(0!=s_)return s_;var sN=sd._mainSortID-sL._mainSortID;return 0==sN?sd.renderObj.triangleCount-sL.renderObj.triangleCount:sN},sc}(),sVL=function(sd){function s_(sd,sL,sl,sZ,sh){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,s_.__super.call(this,sd,sL,sl),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=sZ,this._material=sh}sY(s_,"laya.d3.graphics.SubMeshStaticBatch",shd);var sL=s_.prototype;return sL._compareBatchRenderElement=function(sd,sL){return sd._batchIndexStart>sL._batchIndexStart},sL._addCombineBatchRenderObjTest=function(sd){var sL=sd.renderObj._vertexCount;return!(65535<(0<sL?this._currentCombineVertexCount+sL:this._currentCombineVertexCount+sd.renderObj._getVertexBuffer().vertexCount))},sL._addCombineBatchRenderObj=function(sd){var sL=sd.renderObj,sl=sL._vertexCount;this._initBatchRenderElements.push(sd),sd._staticBatch=this,0<sl?(this._currentCombineIndexCount+=sL._indexCount,this._currentCombineVertexCount+=sl):(this._currentCombineIndexCount=this._currentCombineIndexCount+sL._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+sL._getVertexBuffer().vertexCount),this._needFinishCombine=!0},sL._deleteCombineBatchRenderObj=function(sd){var sL=sd.renderObj,sl=this._initBatchRenderElements.indexOf(sd);if(-1!==sl){this._initBatchRenderElements.splice(sl,1),sd._staticBatch=null;var sZ=sL._vertexCount;0<sZ?(this._currentCombineIndexCount=this._currentCombineIndexCount-sL._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-sZ):(this._currentCombineIndexCount=this._currentCombineIndexCount-sL._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-sL._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},sL._finishInit=function(){if(this._needFinishCombine){var sd=0,sL=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var sl=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),sZ=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=siL.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=soL.create("ushort",this._currentCombineIndexCount,35044);for(var sh=0,s_=this._initBatchRenderElements.length;sh<s_;sh++){var sN=this._initBatchRenderElements[sh],sm=sN.renderObj,su=sm._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,sN._sprite3D),sx=sm.getIndices(),st=sN._sprite3D.transform._isFrontFaceInvert,sb=sd/(this._vertexDeclaration.vertexStride/4)-sm._vertexStart,sq=sL,sY=sq+sx.length;sN._batchIndexStart=sq,sN._batchIndexEnd=sY,sZ.set(sx,sL);var sc=0;if(st)for(sc=sq;sc<sY;sc+=3){sZ[sc]=sb+sZ[sc];var sr=sZ[sc+1],sa=sZ[sc+2];sZ[sc+1]=sb+sa,sZ[sc+2]=sb+sr}else for(sc=sq;sc<sY;sc+=3)sZ[sc]=sb+sZ[sc],sZ[sc+1]=sb+sZ[sc+1],sZ[sc+2]=sb+sZ[sc+2];sL+=sx.length,sl.set(su,sd),sd+=su.length}this._vertexBuffer.setData(sl),this._indexBuffer.setData(sZ),this._needFinishCombine=!1}},sL._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new s$L)},sL._getRenderElement=function(sd,sL,sl){for(var sZ,sh,s_=this._batchRenderElements.length,sN=!0,sm=0;sm<s_;sm++){var su,sx,st=(sh=this._batchRenderElements[sm])._sprite3D._render;if(0!==sm&&(sN=(su=(sZ=this._batchRenderElements[sm-1])._sprite3D._render).lightmapIndex!==st.lightmapIndex||su.receiveShadow!==st.receiveShadow||sZ._batchIndexEnd!==sh._batchIndexStart),sN){(sx=this._getCombineRenderElementFromPool()).renderObj=this,sx._material=this._material,sx._batchIndexStart=sh._batchIndexStart,sx._batchIndexEnd=sh._batchIndexEnd;var sb=st.lightmapIndex,sq=sb+1,sY=this._batchOwnerIndices[sq];sY||(sY=this._batchOwnerIndices[sq]=[]);var sc,sr=sY[sh._render.receiveShadow?1:0];void 0===sr?(sY[st.receiveShadow?1:0]=this._batchOwners.length,(sc=new sKL(null,"StaticBatchMeshSprite3D"))._scene=sL,sc._transform=this._rootOwner?this._rootOwner._transform:null,sc._render.lightmapIndex=sb,sc._render.receiveShadow=sh._render.receiveShadow,this._batchOwners.push(sc)):sc=this._batchOwners[sr],sc._render._renderUpdate(sl),sx._sprite3D=sc,sd.push(sx)}else sx._batchIndexEnd=sh._batchIndexEnd}},sL._beforeRender=function(sd){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},sL._render=function(sd){var sL=sd.renderElement,sl=sL._batchIndexStart,sZ=sL._batchIndexEnd-sl;sF.mainContext.drawElements(4,sZ,5123,2*sl),sO.drawCall++,sO.trianglesFaces+=sZ/3},sL.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},sL._getVertexBuffer=function(sd){return void 0===sd&&(sd=0),this._vertexBuffer},s_}(),sQL=function(sd){function sL(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,sL.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}sY(sL,"laya.d3.core.ComponentNode",sx);var sl=sL.prototype;return sl.addComponent=function(sd){var sL,sl=this._componentsMap.indexOf(sd);if(-1===sl)sL=[],this._componentsMap.push(sd),this._typeComponentsIndices.push(sL);else if(sL=this._typeComponentsIndices[sl],this._components[sL[0]].isSingleton)throw new Error("无法单实例创建"+sd+"组件，"+sd+"组件已存在！");var sZ=sh.getInstance(sd);return sL.push(this._components.length),this._components.push(sZ),sZ instanceof laya.d3.component.Script&&this._scripts.push(sZ),sZ._initialize(this),sZ},sl._removeComponent=function(sd,sL){var sl=this._typeComponentsIndices[sd],sZ=sl[sL],sh=this._components[sZ];this._components.splice(sZ,1),sh instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(sh),1),sl.splice(sL,1),0===sl.length&&(this._typeComponentsIndices.splice(sd,1),this._componentsMap.splice(sd,1));for(var s_=0,sN=this._componentsMap.length;s_<sN;s_++)for(var sm=(sl=this._typeComponentsIndices[s_]).length-1;0<=sm;sm--){var su=sl[sm];if(!(sZ<su))break;sl[sm]=--su}sh._destroy()},sl.getComponentByType=function(sd,sL){void 0===sL&&(sL=0);var sl=this._componentsMap.indexOf(sd);return-1===sl?null:this._components[this._typeComponentsIndices[sl][sL]]},sl.getComponentsByType=function(sd,sL){var sl=this._componentsMap.indexOf(sd);if(-1!==sl){var sZ=this._typeComponentsIndices[sl],sh=sZ.length;sL.length=sh;for(var s_=0;s_<sh;s_++)sL[s_]=this._components[sZ[s_]]}else sL.length=0},sl.getComponentByIndex=function(sd){return this._components[sd]},sl.removeComponentByType=function(sd,sL){void 0===sL&&(sL=0);var sl=this._componentsMap.indexOf(sd);-1!==sl&&this._removeComponent(sl,sL)},sl.removeComponentsByType=function(sd){var sL=this._componentsMap.indexOf(sd);if(-1!==sL)for(var sl=this._typeComponentsIndices[sL],sZ=0,sh=sl.length;sZ<sh;sl.length<sh?sh--:sZ++)this._removeComponent(sL,sZ)},sl.removeAllComponent=function(){for(var sd=0,sL=this._componentsMap.length;sd<sL;this._componentsMap.length<sL?sL--:sd++)this.removeComponentsByType(this._componentsMap[sd])},sl._updateComponents=function(sd){for(var sL=0,sl=this._components.length;sL<sl;sL++){var sZ=this._components[sL];!sZ.started&&(sZ._start(sd),sZ.started=!0),sZ.enable&&sZ._update(sd)}},sl._lateUpdateComponents=function(sd){for(var sL=0;sL<this._components.length;sL++){var sl=this._components[sL];!sl.started&&(sl._start(sd),sl.started=!0),sl.enable&&sl._lateUpdate(sd)}},sl._preRenderUpdateComponents=function(sd){for(var sL=0;sL<this._components.length;sL++){var sl=this._components[sL];!sl.started&&(sl._start(sd),sl.started=!0),sl.enable&&sl._preRenderUpdate(sd)}},sl._postRenderUpdateComponents=function(sd){for(var sL=0;sL<this._components.length;sL++){var sl=this._components[sL];!sl.started&&(sl._start(sd),sl.started=!0),sl.enable&&sl._postRenderUpdate(sd)}},sL}(),sgL=function(sZ){function sd(){sd.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new sqL,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new smL(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}sY(sd,"laya.d3.core.material.BaseMaterial",sZ);var sL=sd.prototype;return sA.imps(sL,{"laya.d3.core.IClone":!0}),sL._addShaderDefine=function(sd){this._shaderDefineValue|=sd},sL._removeShaderDefine=function(sd){this._shaderDefineValue&=~sd},sL._addDisablePublicShaderDefine=function(sd){this._disablePublicShaderDefine|=sd},sL._removeDisablePublicShaderDefine=function(sd){this._disablePublicShaderDefine&=~sd},sL._setBuffer=function(sd,sL){this._shaderValues.setValue(sd,sL),this._values[sd]=sL},sL._getBuffer=function(sd){return this._values[sd]},sL._setMatrix4x4=function(sd,sL){this._shaderValues.setValue(sd,sL?sL.elements:null),this._values[sd]=sL},sL._getMatrix4x4=function(sd){return this._values[sd]},sL._setInt=function(sd,sL){this._shaderValues.setValue(sd,sL),this._values[sd]=sL},sL._getInt=function(sd){return this._values[sd]},sL._setNumber=function(sd,sL){this._shaderValues.setValue(sd,sL),this._values[sd]=sL},sL._getNumber=function(sd){return this._values[sd]},sL._setBool=function(sd,sL){this._shaderValues.setValue(sd,sL),this._values[sd]=sL},sL._getBool=function(sd){return this._values[sd]},sL._setVector2=function(sd,sL){this._shaderValues.setValue(sd,sL?sL.elements:null),this._values[sd]=sL},sL._getVector2=function(sd){return this._values[sd]},sL._setColor=function(sd,sL){this._shaderValues.setValue(sd,sL?sL.elements:null),this._values[sd]=sL},sL._getColor=function(sd){return this._values[sd]},sL._setTexture=function(sd,sL){var sl=this._values[sd];this._values[sd]=sL,this._shaderValues.setValue(sd,sL),0<this.referenceCount&&(sl&&sl._removeReference(),sL&&sL._addReference())},sL._getTexture=function(sd){return this._values[sd]},sL._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},sL._getShader=function(sd,sL,sl){var sZ=(sd|sL)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(sZ,sl,this._shaderDefineValue),this._shader},sL._setRenderStateBlendDepth=function(){var sd=sF.mainContext;switch(sE.setDepthMask(sd,this.depthWrite),0===this.depthTest?sE.setDepthTest(sd,!1):(sE.setDepthTest(sd,!0),sE.setDepthFunc(sd,this.depthTest)),this.blend){case 0:sE.setBlend(sd,!1);break;case 1:sE.setBlend(sd,!0),sE.setBlendFunc(sd,this.srcBlend,this.dstBlend);break;case 2:sE.setBlend(sd,!0)}},sL._setRenderStateFrontFace=function(sd,sL){var sl=sF.mainContext,sZ=0;switch(this.cull){case 0:sE.setCullFace(sl,!1);break;case 1:sE.setCullFace(sl,!0),sZ=sd?sL&&sL._isFrontFaceInvert?2305:2304:sL&&sL._isFrontFaceInvert?2304:2305,sE.setFrontFace(sl,sZ);break;case 2:sE.setCullFace(sl,!0),sZ=sd?sL&&sL._isFrontFaceInvert?2304:2305:sL&&sL._isFrontFaceInvert?2305:2304,sE.setFrontFace(sl,sZ)}},sL.onAsynLoaded=function(sd,sL,sl){var sZ=sL[0],sh=sL[1];switch(sZ.version){case"LAYAMATERIAL:01":var s_=0,sN=0,sm=sZ.props;for(var su in sm)switch(su){case"vectors":var sx=sm[su];for(s_=0,sN=sx.length;s_<sN;s_++){var st=sx[s_],sb=st.value;switch(sb.length){case 2:this[st.name]=new s_L(sb[0],sb[1]);break;case 3:this[st.name]=new sNL(sb[0],sb[1],sb[2]);break;case 4:this[st.name]=new smL(sb[0],sb[1],sb[2],sb[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var sq=sm[su];for(s_=0,sN=sq.length;s_<sN;s_++){var sY=sq[s_],sc=sY.path;sc&&(this[sY.name]=sk.getRes(sh[sc]))}break;case"defines":var sr=sm[su];for(s_=0,sN=sr.length;s_<sN;s_++){var sa=this._shaderCompile.getMaterialDefineByName(sr[s_]);this._addShaderDefine(sa)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[su]=sm[su];break;case"renderQueue":switch(sm[su]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[su]=sm[su]}break;case"LAYAMATERIAL:02":for(su in sm=sZ.props)switch(su){case"vectors":for(s_=0,sN=(sx=sm[su]).length;s_<sN;s_++)switch((sb=(st=sx[s_]).value).length){case 2:this[st.name]=new s_L(sb[0],sb[1]);break;case 3:this[st.name]=new sNL(sb[0],sb[1],sb[2]);break;case 4:this[st.name]=new smL(sb[0],sb[1],sb[2],sb[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(s_=0,sN=(sq=sm[su]).length;s_<sN;s_++)(sc=(sY=sq[s_]).path)&&(this[sY.name]=sk.getRes(sh[sc]));break;case"defines":for(s_=0,sN=(sr=sm[su]).length;s_<sN;s_++)sa=this._shaderCompile.getMaterialDefineByName(sr[s_]),this._addShaderDefine(sa);break;default:this[su]=sm[su]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},sL._addReference=function(){sZ.prototype._addReference.call(this);for(var sd=0,sL=this._values.length;sd<sL;sd++){var sl=this._values[sd];sl&&sl instanceof laya.d3.resource.BaseTexture&&sl._addReference()}},sL._removeReference=function(){sZ.prototype._removeReference.call(this);for(var sd=0,sL=this._values.length;sd<sL;sd++){var sl=this._values[sd];sl&&sl instanceof laya.d3.resource.BaseTexture&&sl._removeReference()}},sL.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},sL.setShaderName=function(sd){var sL=sjL.nameKey.getID(sd);if(-1===sL)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=sOL._preCompileShader[sL]},sL.cloneTo=function(sd){var sL=sd;sL.name=this.name,sL.cull=this.cull,sL.blend=this.blend,sL.srcBlend=this.srcBlend,sL.dstBlend=this.dstBlend,sL.srcBlendRGB=this.srcBlendRGB,sL.dstBlendRGB=this.dstBlendRGB,sL.srcBlendAlpha=this.srcBlendAlpha,sL.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(sL.blendConstColor),sL.blendEquation=this.blendEquation,sL.blendEquationRGB=this.blendEquationRGB,sL.blendEquationAlpha=this.blendEquationAlpha,sL.depthTest=this.depthTest,sL.depthWrite=this.depthWrite,sL.renderQueue=this.renderQueue,sL._shader=this._shader,sL._disablePublicShaderDefine=this._disablePublicShaderDefine,sL._shaderDefineValue=this._shaderDefineValue;var sl,sZ=0,sh=sL._shaderValues;sL._shaderValues.data.length=this._shaderValues.data.length;var s_=this._values.length,sN=sL._values;for(sZ=0,sl=sN.length=s_;sZ<sl;sZ++){var sm=this._values[sZ];if(sm)if("number"==typeof sm)sN[sZ]=sm,sh.data[sZ]=sm;else if("number"==typeof sm&&Math.floor(sm)==sm)sN[sZ]=sm,sh.data[sZ]=sm;else if("boolean"==typeof sm)sN[sZ]=sm,sh.data[sZ]=sm;else if(sm instanceof laya.d3.math.Vector2){var su=sN[sZ]||(sN[sZ]=new s_L);sm.cloneTo(su),sh.data[sZ]=su.elements}else if(sm instanceof laya.d3.math.Vector3){var sx=sN[sZ]||(sN[sZ]=new sNL);sm.cloneTo(sx),sh.data[sZ]=sx.elements}else if(sm instanceof laya.d3.math.Vector4){var st=sN[sZ]||(sN[sZ]=new smL);sm.cloneTo(st),sh.data[sZ]=st.elements}else if(sm instanceof laya.d3.math.Matrix4x4){var sb=sN[sZ]||(sN[sZ]=new sdL);sm.cloneTo(sb),sh.data[sZ]=sb.elements}else sm instanceof laya.d3.resource.BaseTexture&&(sN[sZ]=sm,sh.data[sZ]=sm)}},sL.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sc(0,sL,"alphaTestValue",function(){return this._getNumber(0)},function(sd){this._setNumber(0,sd)}),sc(0,sL,"alphaTest",function(){return this._alphaTest},function(sd){(this._alphaTest=sd)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),sd.__init__=function(){sd.SHADERDEFINE_ALPHATEST=sd.shaderDefines.registerDefine("ALPHATEST")},sd.RENDERQUEUE_OPAQUE=2e3,sd.RENDERQUEUE_ALPHATEST=2450,sd.RENDERQUEUE_TRANSPARENT=3e3,sd.CULL_NONE=0,sd.CULL_FRONT=1,sd.CULL_BACK=2,sd.BLEND_DISABLE=0,sd.BLEND_ENABLE_ALL=1,sd.BLEND_ENABLE_SEPERATE=2,sd.BLENDPARAM_ZERO=0,sd.BLENDPARAM_ONE=1,sd.BLENDPARAM_SRC_COLOR=768,sd.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,sd.BLENDPARAM_DST_COLOR=774,sd.BLENDPARAM_ONE_MINUS_DST_COLOR=775,sd.BLENDPARAM_SRC_ALPHA=770,sd.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,sd.BLENDPARAM_DST_ALPHA=772,sd.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,sd.BLENDPARAM_SRC_ALPHA_SATURATE=776,sd.BLENDEQUATION_ADD=0,sd.BLENDEQUATION_SUBTRACT=1,sd.BLENDEQUATION_REVERSE_SUBTRACT=2,sd.DEPTHTEST_OFF=0,sd.DEPTHTEST_NEVER=512,sd.DEPTHTEST_LESS=513,sd.DEPTHTEST_EQUAL=514,sd.DEPTHTEST_LEQUAL=515,sd.DEPTHTEST_GREATER=516,sd.DEPTHTEST_NOTEQUAL=517,sd.DEPTHTEST_GEQUAL=518,sd.DEPTHTEST_ALWAYS=519,sd.SHADERDEFINE_ALPHATEST=1,sd.ALPHATESTVALUE=0,sb(sd,["shaderDefines",function(){return this.shaderDefines=new stL}]),sd}(sa),sFL=function(sd){function sL(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,sL.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}sY(sL,"laya.d3.resource.BaseTexture",sa);var sl=sL.prototype;return sc(0,sl,"width",function(){return this._width}),sc(0,sl,"repeat",function(){return this._repeat},function(sd){if(this._repeat!==sd&&(this._repeat=sd,this._source)){var sL=sF.mainContext;sE.bindTexture(sL,this._type,this._source),ss.isPOT(this._width,this._height)&&this._repeat?(sL.texParameteri(this._type,10242,10497),sL.texParameteri(this._type,10243,10497)):(sL.texParameteri(this._type,10242,33071),sL.texParameteri(this._type,10243,33071))}}),sc(0,sl,"height",function(){return this._height}),sc(0,sl,"magFifter",function(){return this._magFifter},function(sd){(this._magFifter=sd)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(sd)}),sc(0,sl,"wrapModeV",function(){return this._wrapModeV}),sc(0,sl,"size",function(){return this._size}),sc(0,sl,"wrapModeU",function(){return this._wrapModeU}),sc(0,sl,"mipmap",function(){return this._mipmap},function(sd){this._mipmap=sd,this._mipmap!=sd&&this._conchTexture&&this._conchTexture.setMipMap(sd)}),sc(0,sl,"minFifter",function(){return this._minFifter},function(sd){this._minFifter=sd,this._minFifter!=sd&&this._conchTexture&&this._conchTexture.setMinFifter(sd)}),sc(0,sl,"format",function(){return this._format}),sc(0,sl,"source",function(){return this.activeResource(),this._source}),sc(0,sl,"defaulteTexture",function(){return sPL.grayTexture}),sL.WARPMODE_REPEAT=0,sL.WARPMODE_CLAMP=1,sL}(),sEL=function(sd){function sL(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,sL.__super.call(this),this._boundingBoxCorners=sZ(8,null)}sY(sL,"laya.d3.resource.models.BaseMesh",sa);var sl=sL.prototype;return sl._getPositions=function(){throw new Error("未Override,请重载该属性！")},sl._generateBoundingObject=function(){this._boundingSphere=new sUd(new sNL,0),sUd.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new sJd(new sNL,new sNL),sJd.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},sl.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},sl.getRenderElement=function(sd){throw new Error("未Override,请重载该属性！")},sc(0,sl,"subMeshCount",function(){return this._subMeshCount}),sc(0,sl,"boundingBox",function(){return this._boundingBox}),sc(0,sl,"boundingBoxCorners",function(){return this._boundingBoxCorners}),sc(0,sl,"boundingSphere",function(){return this._boundingSphere}),sL}(),sIL=(function(sd){function sL(){sL.__super.call(this)}sY(sL,"laya.d3.component.Script",swL);var sl=sL.prototype;sl.onTriggerEnter=function(sd){},sl.onTriggerExit=function(sd){},sl.onTriggerStay=function(sd){},sc(0,sl,"isSingleton",function(){return sL._isSingleton}),sL._isSingleton=!1}(),function(sd){function sL(sd){this._owner=null,this._sharedMesh=null,sL.__super.call(this),this._owner=sd}sY(sL,"laya.d3.core.MeshFilter",sd);var sl=sL.prototype;return sl._sharedMeshLoaded=function(){this.event("loaded")},sl._destroy=function(){sd.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},sc(0,sl,"sharedMesh",function(){return this._sharedMesh},function(sd){var sL=this._sharedMesh;sL&&sL._removeReference(),(this._sharedMesh=sd)._addReference(),this.event("meshchanged",[this,sL,sd]),sd.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),sc(0,sl,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),sc(0,sl,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),sc(0,sl,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),sc(0,sl,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),sL}(ssL)),spL=function(sd){function sL(sd){sL.__super.call(this,sd),sd.meshFilter.on("meshchanged",this,this._onMeshChanged)}sY(sL,"laya.d3.core.MeshRender",sAL);var sl=sL.prototype;return sl._onMeshChanged=function(sd,sL,sl){sl.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:sl.once("loaded",this,this._onMeshLoaed)},sl._onMeshLoaed=function(sd,sL){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},sl._calculateBoundingSphereByInitSphere=function(sd){var sL=NaN,sl=this._owner.transform,sZ=sl.scale.elements,sh=Math.abs(sZ[0]),s_=Math.abs(sZ[1]),sN=Math.abs(sZ[2]);sL=s_<=sh&&sN<=sh?sh:sN<=s_?s_:sN,sNL.transformCoordinate(sd.center,sl.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=sd.radius*sL},sl._calculateBoundBoxByInitCorners=function(sd){for(var sL=this._owner.transform.worldMatrix,sl=0;sl<8;sl++)sNL.transformCoordinate(sd[sl],sL,sAL._tempBoundBoxCorners[sl]);sJd.createfromPoints(sAL._tempBoundBoxCorners,this._boundingBox)},sl._calculateBoundingSphere=function(){var sd=this._owner.meshFilter.sharedMesh;null==sd||null==sd.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(sd.boundingSphere)},sl._calculateBoundingBox=function(){var sd=this._owner.meshFilter.sharedMesh;null==sd||null==sd.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(sd.boundingBoxCorners)},sl._renderUpdate=function(sd){var sL=this._owner.transform;if(sL){this._setShaderValueMatrix4x4(0,sL.worldMatrix);var sl=this._owner.getProjectionViewWorldMatrix(sd);this._setShaderValueMatrix4x4(1,sl)}else this._setShaderValueMatrix4x4(0,sdL.DEFAULT),this._setShaderValueMatrix4x4(1,sd);return skL.debugMode&&this._renderRenderableBoundBox(),!0},sL}(),sHL=function(sL){function sZ(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,sZ.__super.call(this),this._renderState=new sv,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new sqL,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new sLd,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new sNL(.7,.7,.7),this.ambientColor=new sNL(.212,.227,.259),sF.shaderHighPrecision&&this.addShaderDefine(sOL.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}sY(sZ,"laya.d3.core.scene.Scene",sL);var sd=sZ.prototype;return sA.imps(sd,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),sd._setUrl=function(sd){this._url=sd},sd._getGroup=function(){return this._group},sd._setGroup=function(sd){this._group=sd},sd._display=function(){sA.stage._scenes.push(this),sA.stage._scenes.sort(sZ._sortScenes);for(var sd=0,sL=this._childs.length;sd<sL;sd++){var sl=this._childs[sd];sl.active&&sl._activeHierarchy()}},sd._unDisplay=function(){var sd=sA.stage._scenes;sd.splice(sd.indexOf(this),1);for(var sL=0,sl=this._childs.length;sL<sl;sL++){var sZ=this._childs[sL];sZ.active&&sZ._inActiveHierarchy()}},sd._addChild3D=function(sd){sd.transform._onWorldTransform(),sd._setBelongScene(this),this.displayedInStage&&sd.active&&sd._activeHierarchy()},sd._removeChild3D=function(sd){sd.transform.parent=null,this.displayedInStage&&sd.active&&sd._inActiveHierarchy(),sd._setUnBelongScene()},sd.initOctree=function(sd,sL,sl,sZ,sh){void 0===sh&&(sh=6),this.treeSize=new sNL(sd,sL,sl),this.treeLevel=sh,this.treeRoot=new sJ(this,0),this.treeRoot.init(sZ,this.treeSize)},sd._prepareUpdateToRenderState=function(sd,sL){sL.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,sL.scene=this},sd._prepareSceneToRender=function(sd){var sL=this._lights.length;if(0<sL)for(var sl=0,sZ=0;sZ<sL&&!(this._lights[sZ]._prepareToScene(sd)&&++sl>=this._enableLightCount);sZ++);},sd._updateChilds=function(sd){for(var sL=0,sl=this._childs.length;sL<sl;++sL)this._childs[sL]._update(sd)},sd._preRenderScene=function(sd,sL,sl){var sZ,sh=sL._viewMatrix,s_=sL._projectionMatrix,sN=sL._projectionViewMatrix,sm=0,su=sL.camera;for(su.useOcclusionCulling?this.treeRoot?sld.renderObjectCullingOctree(sl,this,su,sh,s_,sN):sld.renderObjectCulling(sl,this,su,sh,s_,sN):sld.renderObjectCullingNoBoundFrustum(this,su,sh,s_,sN),sm=0,sZ=this._quenes.length;sm<sZ;sm++)this._quenes[sm]&&this._quenes[sm]._preRender(sL)},sd._clear=function(sd,sL){var sl=sL._viewport,sZ=sL.camera,sh=sl.x,s_=sZ.renderTargetSize.height-sl.y-sl.height,sN=sl.width,sm=sl.height;sd.viewport(sh,s_,sN,sm);var su=256,sx=sZ.renderTarget;switch(sZ.clearFlag){case 0:var st=sZ.clearColor;if(st){sd.enable(3089),sd.scissor(sh,s_,sN,sm);var sb=st.elements;sd.clearColor(sb[0],sb[1],sb[2],sb[3]),su|=16384}if(sx)switch(st||(su=16384),sx.depthStencilFormat){case 33189:su|=256;break;case 36168:su|=1024;break;case 34041:su|=256,su|=1024}sd.clear(su),st&&sd.disable(3089);break;case 1:case 2:if(sx)switch(su=16384,sx.depthStencilFormat){case 33189:su|=256;break;case 36168:su|=1024;break;case 34041:su|=256,su|=1024}sd.clear(su);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},sd._renderScene=function(sd,sL){var sl,sZ,sh=sL.camera,s_=0;for(s_=0;s_<2;s_++)(sZ=this._quenes[s_])&&(sh.renderTarget?sZ._render(sL,!0):sZ._render(sL,!1));if(1===sh.clearFlag){var sN=sh.sky;sN&&(sE.setCullFace(sd,!1),sE.setDepthFunc(sd,515),sE.setDepthMask(sd,!1),sN._render(sL),sE.setDepthFunc(sd,513),sE.setDepthMask(sd,!0))}for(s_=2,sl=this._quenes.length;s_<sl;s_++)(sZ=this._quenes[s_])&&(sZ._sortAlpha(sL.camera.transform.position),sh.renderTarget?sZ._render(sL,!0):sZ._render(sL,!1))},sd._set3DRenderConfig=function(sd){sd.disable(3042),sE._blend=!1,sd.blendFunc(770,771),sE._sFactor=770,sE._dFactor=771,sd.disable(2929),sE._depthTest=!1,sd.enable(2884),sE._cullFace=!0,sd.depthMask(1),sE._depthMask=!0,sd.frontFace(2304),sE._frontFace=2304},sd._set2DRenderConfig=function(sd){sE.setBlend(sd,!0),sE.setBlendFunc(sd,1,771),sE.setDepthTest(sd,!1),sE.setCullFace(sd,!1),sE.setDepthMask(sd,!0),sE.setFrontFace(sd,2305),sd.viewport(0,0,st.width,st.height)},sd._parseCustomProps=function(sd,sL,sl,sZ){var sh=sZ.customProps.lightmaps,s_=sh.length,sN=this._lightmaps;sN.length=s_;for(var sm=0;sm<s_;sm++)sN[sm]=sk.getRes(sL[sh[sm].replace(".exr",".png")]);this.setlightmaps(sN);var su=sZ.customProps.ambientColor;su&&(this.ambientColor=new sNL(su[0],su[1],su[2]));var sx=sZ.customProps.fogColor;sx&&(this.fogColor=new sNL(sx[0],sx[1],sx[2]))},sd._addLight=function(sd){this._lights.indexOf(sd)<0&&this._lights.push(sd)},sd._removeLight=function(sd){var sL=this._lights.indexOf(sd);0<=sL&&this._lights.splice(sL,1)},sd._updateScene=function(){var sd=this._renderState;this._prepareUpdateToRenderState(sF.mainContext,sd),this._updateComponents(sd),this._updateChilds(sd),this._lateUpdateComponents(sd),this._time+=sd.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},sd._updateSceneConch=function(){var sd=this._renderState;this._prepareUpdateToRenderState(sF.mainContext,sd),this._updateComponents(sd),this._lateUpdateComponents(sd),this._prepareSceneToRender(sd);for(var sL=0,sl=this._cameraPool.length;sL<sl;sL++){var sZ=this._cameraPool[sL];(sd.camera=sZ)._prepareCameraToRender()}},sd._preRenderShadow=function(sd,sL,sl,sZ,sh){this.treeRoot?sld.renderShadowObjectCullingOctree(this,sL,sl,sZ,sh):sld.renderShadowObjectCulling(this,sL,sl,sZ,sh);for(var s_=0,sN=sl.length;s_<sN;s_++)sl[s_]&&sl[s_]._preRender(sd)},sd._renderShadowMap=function(sd,sL,sl){var sZ=this.parallelSplitShadowMaps[0];sZ._calcAllLightCameraInfo(sl);var sh,s_,sN,sm=sZ.PSSMNum;if(this._preRenderShadow(sL,sZ._lightCulling,sZ._shadowQuenes,sZ._lightVPMatrix[0],sm),this.addShaderDefine(sYL.SHADERDEFINE_CAST_SHADOW),1<sm)for(var su=0;su<sm;su++)sh=sZ.getRenderTarget(su+1),sZ.beginRenderTarget(su+1),sd.clearColor(1,1,1,1),sd.clear(16640),sd.viewport(0,0,sh.width,sh.height),sL.camera=sN=sZ.getLightCamera(su),sN._prepareCameraToRender(),sN._prepareCameraViewProject(sN.viewMatrix,sN.projectionMatrix),sL._projectionViewMatrix=sZ._lightVPMatrix[su+1],(s_=sZ._shadowQuenes[su])._preRender(sL),s_._renderShadow(sL,!1),sZ.endRenderTarget(su+1);else sh=sZ.getRenderTarget(1),sZ.beginRenderTarget(1),sd.clearColor(1,1,1,1),sd.clear(16640),sd.viewport(0,0,sh.width,sh.height),sL.camera=sN=sZ.getLightCamera(0),sN._prepareCameraToRender(),sN._prepareCameraViewProject(sN.viewMatrix,sN.projectionMatrix),sL._projectionViewMatrix=sZ._lightVPMatrix[0],(s_=sZ._shadowQuenes[0])._preRender(sL),s_._renderShadow(sL,!0),sZ.endRenderTarget(1);this.removeShaderDefine(sYL.SHADERDEFINE_CAST_SHADOW)},sd.addTreeNode=function(sd){this.treeRoot.addTreeNode(sd)},sd.removeTreeNode=function(sd){this.treeSize&&sd._treeNode&&sd._treeNode.removeObject(sd)},sd.setlightmaps=function(sd){this._lightmaps=sd;for(var sL=0,sl=this._renderableSprite3Ds.length;sL<sl;sL++)this._renderableSprite3Ds[sL]._render._applyLightMapParams()},sd.getlightmaps=function(){return this._lightmaps},sd.addChildAt=function(sd,sL){if(!(sd instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(sd&&sd.__className));if(!sd||this.destroyed||sd===this)return sd;if(sd.zOrder&&this._set$P("hasZorder",!0),0<=sL&&sL<=this._childs.length){if(sd._parent===this){var sl=this.getChildIndex(sd);this._childs.splice(sl,1),this._childs.splice(sL,0,sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,sL)),this._childChanged()}else sd.parent&&sd.parent.removeChild(sd),this._childs===sx.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(sL,0,sd),this.conchModel&&this.conchModel.addChildAt(sd.conchModel,sL),(sd.parent=this)._addChild3D(sd);return sd}throw new Error("appendChildAt:The index is out of bounds")},sd.addChild=function(sd){if(!(sd instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!sd||this.destroyed||sd===this)return sd;if(sd.zOrder&&this._set$P("hasZorder",!0),sd._parent===this){var sL=this.getChildIndex(sd);sL!==this._childs.length-1&&(this._childs.splice(sL,1),this._childs.push(sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,this._childs.length-1)),this._childChanged())}else sd.parent&&sd.parent.removeChild(sd),this._childs===sx.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(sd),this.conchModel&&this.conchModel.addChildAt(sd.conchModel,this._childs.length-1),(sd.parent=this)._childChanged(),this._addChild3D(sd);return sd},sd.removeChildAt=function(sd){var sL=this.getChildAt(sd);return sL&&(this._removeChild3D(sL),this._childs.splice(sd,1),this.conchModel&&this.conchModel.removeChild(sL.conchModel),sL.parent=null),sL},sd.removeChildren=function(sd,sL){if(void 0===sd&&(sd=0),void 0===sL&&(sL=2147483647),this._childs&&0<this._childs.length){var sl=this._childs;if(0===sd&&s_<=sL){var sZ=sl;this._childs=sx.ARRAY_EMPTY}else sZ=sl.splice(sd,sL-sd);for(var sh=0,s_=sZ.length;sh<s_;sh++)this._removeChild3D(sZ[sh]),sZ[sh].parent=null,this.conchModel&&this.conchModel.removeChild(sZ[sh].conchModel)}return this},sd.addFrustumCullingObject=function(sd){this.treeRoot?this.addTreeNode(sd):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(sd):this._cullingRenders[this._cullingRendersLength]=sd,sd._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},sd.removeFrustumCullingObject=function(sd){if(this.treeRoot)this.removeTreeNode(sd);else{this._cullingRendersLength--;var sL=sd._indexInSceneFrustumCullingObjects;if(sL!==this._cullingRendersLength){var sl=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[sL]=sl)._indexInSceneFrustumCullingObjects=sL,sd._indexInSceneFrustumCullingObjects=-1}}},sd.getRenderQueue=function(sd){return sd<3e3?this._quenes[1]||(this._quenes[1]=new sK(this)):this._quenes[2]||(this._quenes[2]=new sK(this))},sd.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new sK(this)},sd.addShaderDefine=function(sd){this._shaderDefineValue|=sd},sd.removeShaderDefine=function(sd){this._shaderDefineValue&=~sd},sd.addScript=function(sd){return this._addComponent(sd)},sd.getScriptByType=function(sd,sL){return void 0===sL&&(sL=0),this._getComponentByType(sd,sL)},sd.getScriptsByType=function(sd,sL){this._getComponentsByType(sd,sL)},sd.getScriptByIndex=function(sd){return this._getComponentByIndex(sd)},sd.removeScriptByType=function(sd,sL){void 0===sL&&(sL=0),this._removeComponentByType(sd,sL)},sd.removeScriptsByType=function(sd){this._removeComponentByType(sd)},sd.removeAllScript=function(){this._removeAllComponent()},sd.render=function(sd,sL,sl){(sr._context.ctx._renderKey=0)<this._childs.length&&sd.addRenderObject(this)},sd.renderSubmit=function(){var sd=sF.mainContext,sL=this._renderState;this._set3DRenderConfig(sd),this._prepareSceneToRender(this._renderState);var sl,sZ=0,sh=0;if(skL.debugMode||sJ.debugMode)for(sZ=0,sh=this._cameraPool.length;sZ<sh;sZ++)sl=this._cameraPool[sZ],skL._debugPhasorSprite.begin(1,sl),sl.activeInHierarchy&&sl._renderCamera(sd,sL,this),skL._debugPhasorSprite.end();else for(sZ=0,sh=this._cameraPool.length;sZ<sh;sZ++)(sl=this._cameraPool[sZ]).activeInHierarchy&&sl._renderCamera(sd,sL,this);return this._set2DRenderConfig(sd),1},sd.onAsynLoaded=function(sd,sL,sl){var sZ=sL[0];if("Scene"!==sZ.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var sh=sL[1];saL._createNodeByJson(this,sZ,this,sh),this.event("hierarchyloaded",[this]),this.__loaded=!0},sd.destroy=function(sd){void 0===sd&&(sd=!0),this.destroyed||(sL.prototype.destroy.call(this,sd),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,sk.clearRes(this.url),this.loaded||skL._cancelLoadByUrl(this.url))},sd.getRenderType=function(){return 0},sd.releaseRender=function(){},sd._addComponent=function(sd){var sL,sl=this._componentsMap.indexOf(sd);if(-1===sl)sL=[],this._componentsMap.push(sd),this._typeComponentsIndices.push(sL);else if(sL=this._typeComponentsIndices[sl],this._components[sL[0]].isSingleton)throw new Error("无法单实例创建"+sd+"组件，"+sd+"组件已存在！");var sZ=sh.getInstance(sd);sL.push(this._components.length),this._components.push(sZ);return sZ._initialize(this),sZ},sd._removeComponent=function(sd,sL){var sl=this._typeComponentsIndices[sd],sZ=sl[sL],sh=this._components[sZ];this._components.splice(sZ,1),sl.splice(sL,1),0===sl.length&&(this._typeComponentsIndices.splice(sd,1),this._componentsMap.splice(sd,1));for(var s_=0,sN=this._componentsMap.length;s_<sN;s_++)for(var sm=(sl=this._typeComponentsIndices[s_]).length-1;0<=sm;sm--){var su=sl[sm];if(!(sZ<su))break;sl[sm]=--su}sh._destroy()},sd._getComponentByType=function(sd,sL){void 0===sL&&(sL=0);var sl=this._componentsMap.indexOf(sd);return-1===sl?null:this._components[this._typeComponentsIndices[sl][sL]]},sd._getComponentsByType=function(sd,sL){var sl=this._componentsMap.indexOf(sd);if(-1!==sl){var sZ=this._typeComponentsIndices[sl],sh=sZ.length;sL.length=sh;for(var s_=0;s_<sh;s_++)sL[s_]=this._components[sZ[s_]]}else sL.length=0},sd._getComponentByIndex=function(sd){return this._components[sd]},sd._removeComponentByType=function(sd,sL){void 0===sL&&(sL=0);var sl=this._componentsMap.indexOf(sd);-1!==sl&&this._removeComponent(sl,sL)},sd._removeComponentsByType=function(sd){var sL=this._componentsMap.indexOf(sd);if(-1!==sL)for(var sl=this._typeComponentsIndices[sL],sZ=0,sh=sl.length;sZ<sh;sl.length<sh?sh--:sZ++)this._removeComponent(sL,sZ)},sd._removeAllComponent=function(){for(var sd=0,sL=this._componentsMap.length;sd<sL;this._componentsMap.length<sL?sL--:sd++)this._removeComponentsByType(this._componentsMap[sd])},sd._updateComponents=function(sd){for(var sL=0,sl=this._components.length;sL<sl;sL++){var sZ=this._components[sL];!sZ.started&&(sZ._start(sd),sZ.started=!0),sZ.enable&&sZ._update(sd)}},sd._lateUpdateComponents=function(sd){for(var sL=0;sL<this._components.length;sL++){var sl=this._components[sL];!sl.started&&(sl._start(sd),sl.started=!0),sl.enable&&sl._lateUpdate(sd)}},sd._preRenderUpdateComponents=function(sd){for(var sL=0;sL<this._components.length;sL++){var sl=this._components[sL];!sl.started&&(sl._start(sd),sl.started=!0),sl.enable&&sl._preRenderUpdate(sd)}},sd._postRenderUpdateComponents=function(sd){for(var sL=0;sL<this._components.length;sL++){var sl=this._components[sL];!sl.started&&(sl._start(sd),sl.started=!0),sl.enable&&sl._postRenderUpdate(sd)}},sc(0,sd,"_loaded",null,function(sd){this.__loaded=sd}),sc(0,sd,"fogColor",function(){return this._fogColor},function(sd){this._fogColor=sd,this._shaderValues.setValue(0,sd.elements)}),sc(0,sd,"enableFog",function(){return this._enableFog},function(sd){this._enableFog!==sd&&((this._enableFog=sd)?(this.addShaderDefine(sOL.SHADERDEFINE_FOG),this.removeShaderDefine(sOL.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(sOL.SHADERDEFINE_FOG))}),sc(0,sd,"url",function(){return this._url}),sc(0,sd,"loaded",function(){return this.__loaded}),sc(0,sd,"enableDepthFog",function(){return this._enableDepthFog},function(sd){this._enableDepthFog!=sd&&((this._enableDepthFog=sd)?(this.addShaderDefine(sOL.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(sOL.SHADERDEFINE_FOG)):this.removeShaderDefine(sOL.SAHDERDEFINE_DEPTHFOG))}),sc(0,sd,"fogStart",function(){return this._fogStart},function(sd){this._fogStart=sd,this._shaderValues.setValue(1,sd)}),sc(0,sd,"fogRange",function(){return this._fogRange},function(sd){this._fogRange=sd,this._shaderValues.setValue(2,sd)}),sc(0,sd,"ambientColor",function(){return this._ambientColor},function(sd){this._ambientColor=sd,this._shaderValues.setValue(21,sd.elements)}),sc(0,sd,"scene",function(){return this}),sc(0,sd,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),sZ._sortScenes=function(sd,sL){if(sd.parent!==sA.stage||sL.parent!==sA.stage)return sd.parent!==sA.stage&&sL.parent!==sA.stage?sZ._sortScenes(sd.parent,sL.parent):sd.parent===sA.stage?-1:1;var sl=sA.stage._childs;return sl.indexOf(sd)-sl.indexOf(sL)},sZ.load=function(sd){return sA.loader.create(sd,null,null,sZ)},sZ.FOGCOLOR=0,sZ.FOGSTART=1,sZ.FOGRANGE=2,sZ.LIGHTDIRECTION=3,sZ.LIGHTDIRCOLOR=4,sZ.POINTLIGHTPOS=5,sZ.POINTLIGHTRANGE=6,sZ.POINTLIGHTATTENUATION=7,sZ.POINTLIGHTCOLOR=8,sZ.SPOTLIGHTPOS=9,sZ.SPOTLIGHTDIRECTION=10,sZ.SPOTLIGHTSPOT=11,sZ.SPOTLIGHTRANGE=12,sZ.SPOTLIGHTATTENUATION=13,sZ.SPOTLIGHTCOLOR=14,sZ.SHADOWDISTANCE=15,sZ.SHADOWLIGHTVIEWPROJECT=16,sZ.SHADOWMAPPCFOFFSET=17,sZ.SHADOWMAPTEXTURE1=18,sZ.SHADOWMAPTEXTURE2=19,sZ.SHADOWMAPTEXTURE3=20,sZ.AMBIENTCOLOR=21,sZ.TIME=22,sZ}(s$),sXL=function(sd){function sL(sd){sL.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new sdL,this._shaderValues=new sqL,this._colliders=[],this._id=++sL._uniqueIDCounter,this._transform=new syL(this),this.name=sd||"Sprite3D-"+sL._nameNumberCounter++,this.layer=sp.currentCreationLayer,this.active=!0}sY(sL,"laya.d3.core.Sprite3D",sQL);var sl=sL.prototype;return sA.imps(sl,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),sl._setUrl=function(sd){this._url=sd},sl._getGroup=function(){return this._group},sl._setGroup=function(sd){this._group=sd},sl._addChild3D=function(sd){sd.transform.parent=this.transform,this._hierarchyAnimator&&(!sd._hierarchyAnimator&&sd._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(sd,!0,[sd.name])),this._scene&&(sd._setBelongScene(this._scene),this._activeInHierarchy&&sd._active&&sd._activeHierarchy())},sl._removeChild3D=function(sd){sd.transform.parent=null,this._scene&&(this._activeInHierarchy&&sd._active&&sd._inActiveHierarchy(),sd._setUnBelongScene()),this._hierarchyAnimator&&(sd._hierarchyAnimator==this._hierarchyAnimator&&sd._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(sd,!1,[sd.name]))},sl._parseBaseCustomProps=function(sd){var sL=this.transform.localPosition;sd.translate?(sL.fromArray(sd.translate),sL.x*=100,sL.y*=100,sL.z*=100):sL.elements.fill(0),this.transform.localPosition=sL;var sl=this.transform.localRotation;sd.rotation?sl.fromArray(sd.rotation):sl.fromArray([0,0,0,-1]),this.transform.localRotation=sl;var sZ=this.transform.localScale;sd.scale?sZ.fromArray(sd.scale):sZ.elements.fill(1),this.transform.localScale=sZ;var sh=sd.layer;null!=sh&&(this.layer=sp.getLayerByNumber(sh))},sl._parseCustomComponent=function(sd,sL,sl){for(var sZ in sl){var sh=sl[sZ];switch(sZ){case"Animator":var s_=this.addComponent(Animator);if(sh.avatarPath)s_.avatar=sk.getRes(sL[sh.avatarPath]);else{var sN=sh.avatar;if(sN){s_.avatar=sk.getRes(sL[sN.path]);var sm=sN.linkSprites;sm&&sd.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[s_,sm])}}for(var su=sh.clipPaths,sx=su.length,st=0;st<sx;st++)s_.addClip(sk.getRes(sL[su[st]]));s_.clip=sk.getRes(sL[su[0]]);var sb=sh.playOnWake;void 0!==sb&&(s_.playOnWake=sb);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var sq=this.addComponent(SphereCollider);sq.isTrigger=sh.isTrigger;var sY=sq.center;sY.fromArray(sh.center),sq.center=sY,sq.radius=sh.radius;break;case"BoxCollider":var sc=this.addComponent(BoxCollider);sc.isTrigger=sh.isTrigger,sc.center.fromArray(sh.center);var sr=sc.size;sr.fromArray(sh.size),sc.size=sr;break;case"MeshCollider":this.addComponent(MeshCollider)}}},sl._onRootNodeHierarchyLoaded=function(sd,sL){for(var sl in sL){for(var sZ=this,sh=sL[sl],s_=0,sN=sh.length;s_<sN;s_++){var sm=sh[s_];if(""===sm)break;if(!(sZ=sZ.getChildByName(sm)))break}sZ&&sd.linkSprite3DToAvatarNode(sl,sZ)}},sl._setHierarchyAnimator=function(sd,sL){this._changeHierarchyAnimator(sd);for(var sl=0,sZ=this._childs.length;sl<sZ;sl++){var sh=this._childs[sl];sh._hierarchyAnimator==sL&&sh._setHierarchyAnimator(sd,sL)}},sl._clearHierarchyAnimator=function(sd,sL){this._changeHierarchyAnimator(sL);for(var sl=0,sZ=this._childs.length;sl<sZ;sl++){var sh=this._childs[sl];sh._hierarchyAnimator==sd&&sh._clearHierarchyAnimator(sd,sL)}},sl._getAnimatorToLinkSprite3D=function(sd,sL,sl){var sZ=this.getComponentByType(Animator);if(sZ&&(sZ.avatar?sZ.avatar._version||sd._setAnimatorToLinkAvatar(sZ,sL):sd._setAnimatorToLinkSprite3DNoAvatar(sZ,sL,sl)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){sl.unshift(this._parent.name);var sh=this._parent;sh._hierarchyAnimator&&sh._getAnimatorToLinkSprite3D(sd,sL,sl)}},sl._setAnimatorToLinkSprite3DNoAvatar=function(sd,sL,sl){var sZ=0,sh=0;for(sZ=0,sh=sd.getClipCount();sZ<sh;sZ++)sd._handleSpriteOwnersBySprite(sZ,sL,sl,this);for(sZ=0,sh=this._childs.length;sZ<sh;sZ++){var s_=this._childs[sZ],sN=sl.length;sl.push(s_.name),s_._setAnimatorToLinkSprite3DNoAvatar(sd,sL,sl),sl.splice(sN,1)}},sl._changeHierarchyAnimator=function(sd){this._hierarchyAnimator=sd},sl._isLinkSpriteToAnimationNode=function(sd,sL,sl){var sZ=sd._avatarNodes.indexOf(sL),sh=sd._cacheSpriteToNodesMap;if(sl)this._transform.dummy=sL.transform,sd._cacheNodesToSpriteMap[sZ]=sh.length,sh.push(sZ);else{this._transform.dummy=null;var s_=sd._cacheNodesToSpriteMap[sZ];sd._cacheNodesToSpriteMap[sZ]=null,sh.splice(s_,1)}},sl._setBelongScene=function(sd){this._scene=sd;for(var sL=0,sl=this._childs.length;sL<sl;sL++)this._childs[sL]._setBelongScene(sd)},sl._setUnBelongScene=function(){this._scene=null;for(var sd=0,sL=this._childs.length;sd<sL;sd++)this._childs[sd]._setUnBelongScene()},sl._activeHierarchy=function(){var sd=0,sL=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),sd=0,sL=this._colliders.length;sd<sL;sd++)this._layer._addCollider(this._colliders[sd]);for(this.event("activeinhierarchychanged",!0),sd=0,sL=this._childs.length;sd<sL;sd++){var sl=this._childs[sd];sl._active&&sl._activeHierarchy()}},sl._inActiveHierarchy=function(){var sd=0,sL=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),sd=0,sL=this._colliders.length;sd<sL;sd++){var sl=this._colliders[sd];sl._clearCollsionMap(),this._layer._removeCollider(sl)}for(this.event("activeinhierarchychanged",!1),sd=0,sL=this._childs.length;sd<sL;sd++){var sZ=this._childs[sd];sZ._active&&sZ._inActiveHierarchy()}},sl.addComponent=function(sd){var sL,sl=this._componentsMap.indexOf(sd);if(-1===sl)sL=[],this._componentsMap.push(sd),this._typeComponentsIndices.push(sL);else if(sL=this._typeComponentsIndices[sl],this._components[sL[0]].isSingleton)throw new Error("无法单实例创建"+sd+"组件，"+sd+"组件已存在！");var sZ=sh.getInstance(sd);return sL.push(this._components.length),this._components.push(sZ),sZ instanceof laya.d3.component.Script&&this._scripts.push(sZ),sZ._initialize(this),sZ},sl._removeComponent=function(sd,sL){var sl,sZ=0,sh=this._typeComponentsIndices[sd],s_=sh[sL],sN=this._components[s_];for(sN instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(sN),1),sh.splice(sL,1),0===sh.length&&(this._typeComponentsIndices.splice(sd,1),this._componentsMap.splice(sd,1)),sZ=0,sl=this._componentsMap.length;sZ<sl;sZ++)for(var sm=(sh=this._typeComponentsIndices[sZ]).length-1;0<=sm;sm--){var su=sh[sm];if(!(s_<su))break;sh[sm]=--su}sN._destroy()},sl._clearSelfRenderObjects=function(){},sl._addSelfRenderObjects=function(){},sl._parseCustomProps=function(sd,sL,sl,sZ){},sl._updateChilds=function(sd){var sL=this._childs.length;if(0!==sL)for(var sl=0;sl<sL;++sl)this._childs[sl]._update(sd)},sl._getSortID=function(sd,sL){return 1e3*sL.id+sd._getVertexBuffer().vertexDeclaration.id},sl._update=function(sd){(sd.owner=this)._activeInHierarchy&&(this._updateComponents(sd),this._lateUpdateComponents(sd),sO.spriteCount++,this._childs.length&&this._updateChilds(sd))},sl.getProjectionViewWorldMatrix=function(sd){return sdL.multiply(sd,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},sl.loadHierarchy=function(sd){this.addChild(laya.d3.core.Sprite3D.load(sd))},sl.addChildAt=function(sd,sL){if(!(sd instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!sd||this.destroyed||sd===this)return sd;if(sd.zOrder&&this._set$P("hasZorder",!0),0<=sL&&sL<=this._childs.length){if(sd._parent===this){var sl=this.getChildIndex(sd);this._childs.splice(sl,1),this._childs.splice(sL,0,sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,sL)),this._childChanged()}else sd.parent&&sd.parent.removeChild(sd),this._childs===sx.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(sL,0,sd),this.conchModel&&this.conchModel.addChildAt(sd.conchModel,sL),(sd.parent=this)._addChild3D(sd);return sd}throw new Error("appendChildAt:The index is out of bounds")},sl.addChild=function(sd){if(!(sd instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!sd||this.destroyed||sd===this)return sd;if(sd.zOrder&&this._set$P("hasZorder",!0),sd._parent===this){var sL=this.getChildIndex(sd);sL!==this._childs.length-1&&(this._childs.splice(sL,1),this._childs.push(sd),this.conchModel&&(this.conchModel.removeChild(sd.conchModel),this.conchModel.addChildAt(sd.conchModel,this._childs.length-1)),this._childChanged())}else sd.parent&&sd.parent.removeChild(sd),this._childs===sx.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(sd),this.conchModel&&this.conchModel.addChildAt(sd.conchModel,this._childs.length-1),(sd.parent=this)._childChanged(),this._addChild3D(sd);return sd},sl.removeChildAt=function(sd){var sL=this.getChildAt(sd);return sL&&(this._removeChild3D(sL),this._childs.splice(sd,1),this.conchModel&&this.conchModel.removeChild(sL.conchModel),sL.parent=null),sL},sl.removeChildren=function(sd,sL){if(void 0===sd&&(sd=0),void 0===sL&&(sL=2147483647),this._childs&&0<this._childs.length){var sl=this._childs;if(0===sd&&s_<=sL){var sZ=sl;this._childs=sx.ARRAY_EMPTY}else sZ=sl.splice(sd,sL-sd);for(var sh=0,s_=sZ.length;sh<s_;sh++)this._removeChild3D(sZ[sh]),sZ[sh].parent=null,this.conchModel&&this.conchModel.removeChild(sZ[sh].conchModel)}return this},sl.onAsynLoaded=function(sd,sL,sl){var sZ=sL[0];if("Sprite3D"!==sZ.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var sh=sL[1];saL._createNodeByJson(this,sZ,this,sh),this.event("hierarchyloaded",[this]),this.__loaded=!0},sl.cloneTo=function(sd){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var sL=sd;sL.name=this.name,sL._destroyed=this._destroyed,sL.timer=this.timer,sL._$P=this._$P,sL.active=this._active;var sl=sL.transform.localPosition;this.transform.localPosition.cloneTo(sl),sL.transform.localPosition=sl;var sZ=sL.transform.localRotation;this.transform.localRotation.cloneTo(sZ),sL.transform.localRotation=sZ;var sh=sL.transform.localScale;this.transform.localScale.cloneTo(sh),sL.transform.localScale=sh,sL.isStatic=this.isStatic;var s_=0,sN=0;for(s_=0,sN=this._componentsMap.length;s_<sN;s_++){var sm=sL.addComponent(this._componentsMap[s_]);this._components[s_]._cloneTo(sm)}for(s_=0,sN=this._childs.length;s_<sN;s_++)sL.addChild(this._childs[s_].clone());var su=sL.getComponentByType(Animator);if(su){var sx=su._linkSpritesData;if(sx)for(var st in sx){for(var sb=sx[st],sq=sL,sY=0,sc=sb.length;sY<sc&&(sq=sq.getChildByName(sb[sY]));sY++);if(sq){var sr=su._avatarNodeMap[st];sq._isLinkSpriteToAnimationNode(su,sr,!0)}}}},sl.clone=function(){var sd=new this.constructor;return this.cloneTo(sd),sd},sl.destroy=function(sd){if(void 0===sd&&(sd=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,sd);var sL,sl=0;for(sl=0,sL=this._components.length;sl<sL;sl++)this._components[sl]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,sk.clearRes(this.url),this.loaded||skL._cancelLoadByUrl(this.url)}},sl._handleSpriteToAvatar=function(sd,sL){sd._avatarNodes;var sl=sd._avatarNodeMap[this.name];sl&&sl.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(sd,sl,sL)},sl._setAnimatorToLinkAvatar=function(sd,sL){this._handleSpriteToAvatar(sd,sL);for(var sl=0,sZ=this._childs.length;sl<sZ;sl++){this._childs[sl]._setAnimatorToLinkAvatar(sd,sL)}},sc(0,sl,"activeInHierarchy",function(){return this._activeInHierarchy}),sc(0,sl,"_loaded",null,function(sd){this.__loaded=sd}),sc(0,sl,"active",function(){return this._active},function(sd){this._active!==sd&&(this._active=sd,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(sd?this._activeHierarchy():this._inActiveHierarchy()))}),sc(0,sl,"componentsCount",function(){return this._components.length}),sc(0,sl,"loaded",function(){return this.__loaded}),sc(0,sl,"id",function(){return this._id}),sc(0,sl,"url",function(){return this._url}),sc(0,sl,"layer",function(){return this._layer},function(sd){if(this._layer!==sd){if(!sd)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var sL=0,sl=this._colliders.length;if(this._layer)for(sL=0;sL<sl;sL++)this._layer._removeCollider(this._colliders[sL]);for(sL=0;sL<sl;sL++)sd._addCollider(this._colliders[sL])}this._layer=sd,this.event("layerchanged",sd)}}),sc(0,sl,"scene",function(){return this._scene}),sc(0,sl,"transform",function(){return this._transform}),sL.instantiate=function(sd,sL,sl,sZ,sh){void 0===sl&&(sl=!0);var s_=sd.clone();sL&&sL.addChild(s_);var sN=s_.transform;if(sl){var sm=sN.worldMatrix;sd.transform.worldMatrix.cloneTo(sm),sN.worldMatrix=sm}else sZ&&(sN.position=sZ),sh&&(sN.rotation=sh);return s_},sL.load=function(sd){return sA.loader.create(sd,null,null,sL)},sL.WORLDMATRIX=0,sL.MVPMATRIX=1,sL._uniqueIDCounter=0,sL._nameNumberCounter=0,sL}(),sjL=function(sd){function st(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],st.__super.call(this),!sd||!sL)throw"Shader Error";this._id=++st._count,this._vs=sd,this._ps=sL,this._attributeMap=sl,this._sceneUniformMap=sZ,this._cameraUniformMap=sh,this._spriteUniformMap=s_,this._materialUniformMap=sN,this._renderElementUniformMap=sm,this._precompile=su,this._define=sx,this._precompile&&st.extCompileObj&&st.extCompileFunc?st.extCompileFunc.call(st.extCompileObj,sd,sL,sx):this.recreateResource()}sY(st,"laya.d3.shader.Shader3D",sl);var sL=st.prototype;return sL.recreateResource=function(){sI.now();this._compile(),this.completeCreate(),this.memorySize=0},sL.disposeResource=function(){sF.mainContext.deleteShader(this._vshader),sF.mainContext.deleteShader(this._pshader),sF.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},sL._compile=function(){if(!sF.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var sd=[this._vs,this._ps],sL=sF.mainContext;if(this._program=sL.createProgram(),this._vshader=st._createShader(sL,sd[0],35633),this._pshader=st._createShader(sL,sd[1],35632),sL.attachShader(this._program,this._vshader),sL.attachShader(this._program,this._pshader),sL.linkProgram(this._program),!sr.isConchApp&&sOL.debugMode&&!sL.getProgramParameter(this._program,35714))throw sL.getProgramInfoLog(this._program);var sl,sZ=0,sh=0,s_=0;for(s_=sr.isConchApp?sL.getProgramParameterEx(this._vs,this._ps,"",35721):sL.getProgramParameter(this._program,35721),sZ=0;sZ<s_;sZ++){var sN=null;sl={vartype:"attribute",ivartype:0,attrib:sN=sr.isConchApp?sL.getActiveAttribEx(this._vs,this._ps,"",sZ):sL.getActiveAttrib(this._program,sZ),location:sL.getAttribLocation(this._program,sN.name),name:sN.name,type:sN.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(sl)}var sm=0;for(sm=sr.isConchApp?sL.getProgramParameterEx(this._vs,this._ps,"",35718):sL.getProgramParameter(this._program,35718),sZ=0;sZ<sm;sZ++){var su=null;su=sr.isConchApp?sL.getActiveUniformEx(this._vs,this._ps,"",sZ):sL.getActiveUniform(this._program,sZ),0<(sl={vartype:"uniform",ivartype:1,attrib:sN,location:sL.getUniformLocation(this._program,su.name),name:su.name,type:su.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(sl.name=sl.name.substr(0,sl.name.length-3),sl.isArray=!0,sl.location=sL.getUniformLocation(this._program,sl.name)),this._uniformParams.push(sl)}for(sZ=0,sh=this._attributeParams.length;sZ<sh;sZ++)(sl=this._attributeParams[sZ]).indexOfParams=sZ,sl.index=1,sl.value=[sl.location,null],sl.codename=sl.name,sl.name=null!=this._attributeMap[sl.codename]?this._attributeMap[sl.codename]:sl.codename,this._attributeParamsMap.push(sl.name),this._attributeParamsMap.push(sl),sl._this=this,sl.uploadedValue=[],sl.fun=this._attribute;for(sZ=0,sh=this._uniformParams.length;sZ<sh;sZ++)switch((sl=this._uniformParams[sZ]).indexOfParams=sZ,sl.index=1,sl.value=[sl.location,null],sl.codename=sl.name,null!=this._sceneUniformMap[sl.codename]?(sl.name=this._sceneUniformMap[sl.codename],this._sceneUniformParamsMap.push(sl.name),this._sceneUniformParamsMap.push(sl)):null!=this._cameraUniformMap[sl.codename]?(sl.name=this._cameraUniformMap[sl.codename],this._cameraUniformParamsMap.push(sl.name),this._cameraUniformParamsMap.push(sl)):null!=this._spriteUniformMap[sl.codename]?(sl.name=this._spriteUniformMap[sl.codename],this._spriteUniformParamsMap.push(sl.name),this._spriteUniformParamsMap.push(sl)):null!=this._materialUniformMap[sl.codename]?(sl.name=this._materialUniformMap[sl.codename],this._materialUniformParamsMap.push(sl.name),this._materialUniformParamsMap.push(sl)):null!=this._renderElementUniformMap[sl.codename]?(sl.name=this._renderElementUniformMap[sl.codename],this._renderElementUniformParamsMap.push(sl.name),this._renderElementUniformParamsMap.push(sl)):console.log("Shader:can't find uinform name:"+sl.codename+" in shader file."),sl._this=this,sl.uploadedValue=[],sl.type){case 5124:sl.fun=sl.isArray?this._uniform1iv:this._uniform1i;break;case 5126:sl.fun=sl.isArray?this._uniform1fv:this._uniform1f;break;case 35664:sl.fun=sl.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:sl.fun=sl.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:sl.fun=sl.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:sl.fun=this._uniform_sampler2D;break;case 35680:sl.fun=this._uniform_samplerCube;break;case 35676:sl.fun=this._uniformMatrix4fv;break;case 35670:sl.fun=this._uniform1i;break;case 35674:sl.fun=this._uinformMatrix2fv;break;case 35675:sl.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},sL._attribute=function(sd,sL){var sl=sF.mainContext,sZ=sm._enableAtributes,sh=sd.location;return sZ[sh]||sl.enableVertexAttribArray(sh),sl.vertexAttribPointer(sh,sL[0],sL[1],sL[2],sL[3],sL[4]),sZ[sh]=sm._bindVertexBuffer,1},sL._uniform1f=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL?(sF.mainContext.uniform1f(sd.location,sl[0]=sL),1):0},sL._uniform1fv=function(sd,sL){if(sL.length<4){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(sF.mainContext.uniform1fv(sd.location,sL),sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3],1):0}return sF.mainContext.uniform1fv(sd.location,sL),1},sL._uniform_vec2=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]?(sF.mainContext.uniform2f(sd.location,sl[0]=sL[0],sl[1]=sL[1]),1):0},sL._uniform_vec2v=function(sd,sL){if(sL.length<2){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(sF.mainContext.uniform2fv(sd.location,sL),sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3],1):0}return sF.mainContext.uniform2fv(sd.location,sL),1},sL._uniform_vec3=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]?(sF.mainContext.uniform3f(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2]),1):0},sL._uniform_vec3v=function(sd,sL){return sF.mainContext.uniform3fv(sd.location,sL),1},sL._uniform_vec4=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(sF.mainContext.uniform4f(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3]),1):0},sL._uniform_vec4v=function(sd,sL){return sF.mainContext.uniform4fv(sd.location,sL),1},sL._uniformMatrix2fv=function(sd,sL){return sF.mainContext.uniformMatrix2fv(sd.location,!1,sL),1},sL._uniformMatrix3fv=function(sd,sL){return sF.mainContext.uniformMatrix3fv(sd.location,!1,sL),1},sL._uniformMatrix4fv=function(sd,sL){return sF.mainContext.uniformMatrix4fv(sd.location,!1,sL),1},sL._uinformMatrix2fv=function(sd,sL){return sF.mainContext.uniformMatrix2fv(sd.location,!1,sL),1},sL._uinformMatrix3fv=function(sd,sL){return sF.mainContext.uniformMatrix3fv(sd.location,!1,sL),1},sL._uniform1i=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL?(sF.mainContext.uniform1i(sd.location,sl[0]=sL),1):0},sL._uniform1iv=function(sd,sL){return sF.mainContext.uniform1iv(sd.location,sL),1},sL._uniform_ivec2=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]?(sF.mainContext.uniform2i(sd.location,sl[0]=sL[0],sl[1]=sL[1]),1):0},sL._uniform_ivec2v=function(sd,sL){return sF.mainContext.uniform2iv(sd.location,sL),1},sL._uniform_vec3i=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]?(sF.mainContext.uniform3i(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2]),1):0},sL._uniform_vec3vi=function(sd,sL){return sF.mainContext.uniform3iv(sd.location,sL),1},sL._uniform_vec4i=function(sd,sL){var sl=sd.uploadedValue;return sl[0]!==sL[0]||sl[1]!==sL[1]||sl[2]!==sL[2]||sl[3]!==sL[3]?(sF.mainContext.uniform4i(sd.location,sl[0]=sL[0],sl[1]=sL[1],sl[2]=sL[2],sl[3]=sL[3]),1):0},sL._uniform_vec4vi=function(sd,sL){return sF.mainContext.uniform4iv(sd.location,sL),1},sL._uniform_sampler2D=function(sd,sL){var sl=sL.source||sL.defaulteTexture.source,sZ=sF.mainContext,sh=sd.uploadedValue;if(null!=sh[0])return sZ.activeTexture(st._TEXTURES[sh[0]]),sl&&sE.bindTexture(sZ,3553,sl),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return sh[0]=this._curActTexIndex,sZ.uniform1i(sd.location,this._curActTexIndex),sZ.activeTexture(st._TEXTURES[this._curActTexIndex]),sl&&sE.bindTexture(sZ,3553,sl),this._curActTexIndex++,1},sL._uniform_samplerCube=function(sd,sL){var sl=sL.source||sL.defaulteTexture.source,sZ=sF.mainContext,sh=sd.uploadedValue;if(null!=sh[0])return sZ.activeTexture(st._TEXTURES[sh[0]]),sl?sE.bindTexture(sZ,34067,sl):sE.bindTexture(sZ,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return sh[0]=this._curActTexIndex,sZ.uniform1i(sd.location,this._curActTexIndex),sZ.activeTexture(st._TEXTURES[this._curActTexIndex]),sl?sE.bindTexture(sZ,34067,sl):sE.bindTexture(sZ,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},sL._noSetValue=function(sd){console.log("no....:"+sd.name)},sL.bind=function(){return sl.activeShader=this,(sl.bindShader=this).activeResource(),sE.UseProgram(this._program)},sL.uploadAttributes=function(sd,sL){for(var sl,sZ,sh=0,s_=0,sN=this._attributeParamsMap.length;s_<sN;s_+=2)sZ=this._attributeParamsMap[s_+1],null!=(sl=sd[this._attributeParamsMap[s_]])&&(sL&&sL[sZ.name]&&sL[sZ.name].bind(),sh+=sZ.fun.call(this,sZ,sl));sO.shaderCall+=sh},sL.uploadAttributesX=function(sd,sL){for(var sl,sZ,sh=0,s_=0,sN=this._attributeParamsMap.length;s_<sN;s_+=2)sZ=this._attributeParamsMap[s_+1],null!=(sl=sd[this._attributeParamsMap[s_]])&&(sL._bind(),sh+=sZ.fun.call(this,sZ,sl));sO.shaderCall+=sh},sL.uploadSceneUniforms=function(sd){for(var sL,sl,sZ=0,sh=0,s_=this._sceneUniformParamsMap.length;sh<s_;sh+=2)sl=this._sceneUniformParamsMap[sh+1],null!=(sL=sd[this._sceneUniformParamsMap[sh]])&&(sZ+=sl.fun.call(this,sl,sL));sO.shaderCall+=sZ},sL.uploadCameraUniforms=function(sd){for(var sL,sl,sZ=0,sh=0,s_=this._cameraUniformParamsMap.length;sh<s_;sh+=2)sl=this._cameraUniformParamsMap[sh+1],null!=(sL=sd[this._cameraUniformParamsMap[sh]])&&(sZ+=sl.fun.call(this,sl,sL));sO.shaderCall+=sZ},sL.uploadSpriteUniforms=function(sd){for(var sL,sl,sZ=0,sh=0,s_=this._spriteUniformParamsMap.length;sh<s_;sh+=2)sl=this._spriteUniformParamsMap[sh+1],null!=(sL=sd[this._spriteUniformParamsMap[sh]])&&(sZ+=sl.fun.call(this,sl,sL));sO.shaderCall+=sZ},sL.uploadMaterialUniforms=function(sd){for(var sL,sl,sZ=0,sh=0,s_=this._materialUniformParamsMap.length;sh<s_;sh+=2)sl=this._materialUniformParamsMap[sh+1],null!=(sL=sd[this._materialUniformParamsMap[sh]])&&(sZ+=sl.fun.call(this,sl,sL));sO.shaderCall+=sZ},sL.uploadRenderElementUniforms=function(sd){for(var sL,sl,sZ=0,sh=0,s_=this._renderElementUniformParamsMap.length;sh<s_;sh+=2)sl=this._renderElementUniformParamsMap[sh+1],null!=(sL=sd[this._renderElementUniformParamsMap[sh]])&&(sZ+=sl.fun.call(this,sl,sL));sO.shaderCall+=sZ},st.create=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){return new st(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx)},st.addInclude=function(sd,sL){sw.addInclude(sd,sL)},st._createShader=function(sd,sL,sl){var sZ=sd.createShader(sl);if(sd.shaderSource(sZ,sL),sd.compileShader(sZ),sOL.debugMode&&!sd.getShaderParameter(sZ,35713))throw sd.getShaderInfoLog(sZ);return sZ},st.PERIOD_RENDERELEMENT=0,st.PERIOD_MATERIAL=1,st.PERIOD_SPRITE=2,st.PERIOD_CAMERA=3,st.PERIOD_SCENE=4,st._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],st._count=0,st._preCompile=!1,st.extCompileFunc=null,st.extCompileObj=null,sb(st,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new sn}]),st}(),sRL=function(sm){function su(){this._transformUV=null,su.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new sNL(.6,.6,.6)),this._setColor(10,new sNL(1,1,1)),this._setColor(11,new smL(1,1,1,8)),this._setColor(12,new sNL(1,1,1)),this._setColor(7,new smL(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new smL(1,1,0,0)),this.renderMode=1}sY(su,"laya.d3.core.material.StandardMaterial",sm);var sd=su.prototype;return sd.disableLight=function(){this._addDisablePublicShaderDefine(sOL.SHADERDEFINE_POINTLIGHT|sOL.SHADERDEFINE_SPOTLIGHT|sOL.SHADERDEFINE_DIRECTIONLIGHT)},sd.disableFog=function(){this._addDisablePublicShaderDefine(sOL.SHADERDEFINE_FOG)},sd.onAsynLoaded=function(sd,sL,sl){var sZ=sL[0];if(sZ.version)sm.prototype.onAsynLoaded.call(this,sd,sL,sl);else{var sh=sL[1],s_=sZ.props;for(var sN in s_)this[sN]=s_[sN];su._parseStandardMaterial(sh,this,sZ),this._endLoaded()}},sd.cloneTo=function(sd){sm.prototype.cloneTo.call(this,sd);var sL=sd;this._transformUV&&(sL._transformUV=this._transformUV.clone())},sc(0,sd,"ambientColor",function(){return this._getColor(9)},function(sd){this._setColor(9,sd)}),sc(0,sd,"ambientTexture",function(){return this._getTexture(5)},function(sd){sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,sd)}),sc(0,sd,"renderMode",null,function(sd){switch(sd){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(su.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(sd)}),sc(0,sd,"reflectColor",function(){return this._getColor(12)},function(sd){this._setColor(12,sd)}),sc(0,sd,"tilingOffset",function(){return this._getColor(15)},function(sd){if(sd){var sL=sd.elements;1!=sL[0]||1!=sL[1]||0!=sL[2]||0!=sL[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,sd)}),sc(0,sd,"albedo",function(){return this._getColor(7)},function(sd){this._setColor(7,sd)}),sc(0,sd,"diffuseColor",function(){return this._getColor(10)},function(sd){this._setColor(10,sd)}),sc(0,sd,"albedoColor",function(){return this._getColor(7)},function(sd){this._setColor(7,sd)}),sc(0,sd,"specularColor",function(){return this._getColor(11)},function(sd){this._setColor(11,sd)}),sc(0,sd,"diffuseTexture",function(){return this._getTexture(1)},function(sd){sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,sd)}),sc(0,sd,"normalTexture",function(){return this._getTexture(2)},function(sd){sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,sd)}),sc(0,sd,"specularTexture",function(){return this._getTexture(3)},function(sd){sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,sd)}),sc(0,sd,"emissiveTexture",function(){return this._getTexture(4)},function(sd){sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,sd)}),sc(0,sd,"reflectTexture",function(){return this._getTexture(6)},function(sd){sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,sd)}),sc(0,sd,"transformUV",function(){return this._transformUV},function(sd){this._transformUV=sd,this._setMatrix4x4(13,sd.matrix),sd?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,sd.matrix.elements,0)}),su.__init__=function(){su.SHADERDEFINE_DIFFUSEMAP=su.shaderDefines.registerDefine("DIFFUSEMAP"),su.SHADERDEFINE_NORMALMAP=su.shaderDefines.registerDefine("NORMALMAP"),su.SHADERDEFINE_SPECULARMAP=su.shaderDefines.registerDefine("SPECULARMAP"),su.SHADERDEFINE_EMISSIVEMAP=su.shaderDefines.registerDefine("EMISSIVEMAP"),su.SHADERDEFINE_AMBIENTMAP=su.shaderDefines.registerDefine("AMBIENTMAP"),su.SHADERDEFINE_REFLECTMAP=su.shaderDefines.registerDefine("REFLECTMAP"),su.SHADERDEFINE_UVTRANSFORM=su.shaderDefines.registerDefine("UVTRANSFORM"),su.SHADERDEFINE_TILINGOFFSET=su.shaderDefines.registerDefine("TILINGOFFSET"),su.SHADERDEFINE_ADDTIVEFOG=su.shaderDefines.registerDefine("ADDTIVEFOG")},su.load=function(sd){return sA.loader.create(sd,null,null,su)},su._parseStandardMaterial=function(sd,sL,sl){var sZ=sl.customProps,sh=sZ.ambientColor;sL.ambientColor=new sNL(sh[0],sh[1],sh[2]);var s_=sZ.diffuseColor;sL.diffuseColor=new sNL(s_[0],s_[1],s_[2]);var sN=sZ.specularColor;sL.specularColor=new smL(sN[0],sN[1],sN[2],sN[3]);var sm=sZ.reflectColor;sL.reflectColor=new sNL(sm[0],sm[1],sm[2]);var su=sZ.albedoColor;su&&(sL.albedo=new smL(su[0],su[1],su[2],su[3]));var sx=sZ.diffuseTexture.texture2D;sx&&(sL.diffuseTexture=sk.getRes(sd[sx]));var st=sZ.normalTexture.texture2D;st&&(sL.normalTexture=sk.getRes(sd[st]));var sb=sZ.specularTexture.texture2D;sb&&(sL.specularTexture=sk.getRes(sd[sb]));var sq=sZ.emissiveTexture.texture2D;sq&&(sL.emissiveTexture=sk.getRes(sd[sq]));var sY=sZ.ambientTexture.texture2D;sY&&(sL.ambientTexture=sk.getRes(sd[sY]));var sc=sZ.reflectTexture.texture2D;sc&&(sL.reflectTexture=sk.getRes(sd[sc]))},su.RENDERMODE_OPAQUE=1,su.RENDERMODE_OPAQUEDOUBLEFACE=2,su.RENDERMODE_CUTOUT=3,su.RENDERMODE_CUTOUTDOUBLEFACE=4,su.RENDERMODE_TRANSPARENT=13,su.RENDERMODE_TRANSPARENTDOUBLEFACE=14,su.RENDERMODE_ADDTIVE=15,su.RENDERMODE_ADDTIVEDOUBLEFACE=16,su.RENDERMODE_DEPTHREAD_TRANSPARENT=5,su.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,su.RENDERMODE_DEPTHREAD_ADDTIVE=7,su.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,su.RENDERMODE_NONDEPTH_TRANSPARENT=9,su.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,su.RENDERMODE_NONDEPTH_ADDTIVE=11,su.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,su.SHADERDEFINE_DIFFUSEMAP=0,su.SHADERDEFINE_NORMALMAP=0,su.SHADERDEFINE_SPECULARMAP=0,su.SHADERDEFINE_EMISSIVEMAP=0,su.SHADERDEFINE_AMBIENTMAP=0,su.SHADERDEFINE_REFLECTMAP=0,su.SHADERDEFINE_UVTRANSFORM=0,su.SHADERDEFINE_TILINGOFFSET=0,su.SHADERDEFINE_ADDTIVEFOG=0,su.DIFFUSETEXTURE=1,su.NORMALTEXTURE=2,su.SPECULARTEXTURE=3,su.EMISSIVETEXTURE=4,su.AMBIENTTEXTURE=5,su.REFLECTTEXTURE=6,su.ALBEDO=7,su.UVANIAGE=8,su.MATERIALAMBIENT=9,su.MATERIALDIFFUSE=10,su.MATERIALSPECULAR=11,su.MATERIALREFLECT=12,su.UVMATRIX=13,su.UVAGE=14,su.TILINGOFFSET=15,sb(su,["defaultMaterial",function(){var sd=new su;return sd.lock=!0,this.defaultMaterial=sd},"shaderDefines",function(){return this.shaderDefines=new stL(sgL.shaderDefines)}]),su}(sgL),soL=function(sd){function sN(sd,sL,sl,sZ,sh){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===sl&&(sl=35044),void 0===sZ&&(sZ=!1),sN.__super.call(this),this._indexType=sd,this._indexCount=sL,this._bufferUsage=sl,this._bufferType=34963,this._canRead=sZ;var s_;if("ushort"==sd)this._indexTypeByteCount=2;else{if("ubyte"!=sd)throw new Error("unidentification index type.");this._indexTypeByteCount=1}s_=this._indexTypeByteCount*sL,this._byteLength=s_,this._bind(),sm._gl.bufferData(this._bufferType,s_,this._bufferUsage),this.uri=sh,sZ?("ushort"==sd?this._buffer=new Uint16Array(sL):"ubyte"==sd&&(this._buffer=new Uint8Array(sL)),this.memorySize=2*s_):this.memorySize=s_}sY(sN,"laya.d3.graphics.IndexBuffer3D",sd);var sL=sN.prototype;return sL.setData=function(sd,sL,sl,sZ){void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=4294967295);var sh=0;if("ushort"==this._indexType?(sh=2,0===sl&&4294967295===sZ||(sd=new Uint16Array(sd.buffer,sl*sh,sZ))):"ubyte"==this._indexType&&(sh=1,0===sl&&4294967295===sZ||(sd=new Uint8Array(sd.buffer,sl*sh,sZ))),this._bind(),sm._gl.bufferSubData(this._bufferType,sL*sh,sd),this._canRead)if(0!==sL||0!==sl||4294967295!==sZ){var s_=this._buffer.length-sL;s_<sZ&&(sZ=s_);for(var sN=0;sN<sZ;sN++)this._buffer[sL+sN]=sd[sN]}else this._buffer=sd},sL.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},sL.disposeResource=function(){sd.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},sc(0,sL,"indexType",function(){return this._indexType}),sc(0,sL,"indexTypeByteCount",function(){return this._indexTypeByteCount}),sc(0,sL,"indexCount",function(){return this._indexCount}),sc(0,sL,"canRead",function(){return this._canRead}),sN.INDEXTYPE_UBYTE="ubyte",sN.INDEXTYPE_USHORT="ushort",sN.create=function(sd,sL,sl,sZ,sh){return void 0===sl&&(sl=35044),void 0===sZ&&(sZ=!1),new sN(sd,sL,sl,sZ,sh)},sN}(sm),siL=function(s_){function sN(sd,sL,sl,sZ,sh){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===sZ&&(sZ=!1),sN.__super.call(this),this._vertexDeclaration=sd,this._vertexCount=sL,this._bufferUsage=sl,this._bufferType=34962,this._canRead=sZ,this.uri=sh,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*sL,this._bind(),sm._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),sZ&&(this._buffer=new Float32Array(this._byteLength/4))}sY(sN,"laya.d3.graphics.VertexBuffer3D",s_);var sd=sN.prototype;return sd.bindWithIndexBuffer=function(sd){sd&&sd._bind(),this._bind()},sd.setData=function(sd,sL,sl,sZ){if(void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=4294967295),0===sl&&4294967295===sZ||(sd=new Float32Array(sd.buffer,4*sl,sZ)),this._bind(),sm._gl.bufferSubData(this._bufferType,4*sL,sd),this._canRead)if(0!==sL||0!==sl||4294967295!==sZ){var sh=this._buffer.length-sL;sh<sZ&&(sZ=sh);for(var s_=0;s_<sZ;s_++)this._buffer[sL+s_]=sd[s_]}else this._buffer=sd},sd.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},sd.disposeResource=function(){for(var sd=sF.mainContext,sL=this._vertexDeclaration.getVertexElements(),sl=sm._enableAtributes,sZ=0,sh=sL.length;sZ<sh;sZ++)sl[sZ]===this._glBuffer&&(sd.disableVertexAttribArray(sZ),sl[sZ]=null);s_.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},sc(0,sd,"vertexDeclaration",function(){return this._vertexDeclaration}),sc(0,sd,"vertexCount",function(){return this._vertexCount}),sc(0,sd,"canRead",function(){return this._canRead}),sN.create=function(sd,sL,sl,sZ,sh){return void 0===sl&&(sl=35044),void 0===sZ&&(sZ=!1),new sN(sd,sL,sl,sZ,sh)},sN}(sm),sSL=function(sd){function sw(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,sw.__super.call(this),this._type=3553}sY(sw,"laya.d3.resource.DataTexture2D",sFL);var sL=sw.prototype;return sL.genDebugMipmaps=function(){var sd=[];return sd.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),sd.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),sd.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),sd.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),sd.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),sd.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),sd.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),sd.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),sd.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),sd.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),sd},sL._onTextureLoaded=function(sd){},sL._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var sd=sF.mainContext,sL=this._source=sd.createTexture(),sl=this._width,sZ=this._height,sh=sE.curBindTexTarget,s_=sE.curBindTexValue,sN=!1;if(sE.bindTexture(sd,this._type,sL),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var sm=0;sd.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var su=0;su<this._mipmaps.length;su++){if(this._mipmaps[su].byteLength!=sx*st*4)throw"mipmap size error  level:"+su;sd.texSubImage2D(this._type,0,sw.simLodRect[sm++],sw.simLodRect[sm++],sw.simLodRect[sm++],sw.simLodRect[sm++],6408,5121,new Uint8Array(this._mipmaps[su]))}this.minFifter=9729,this.magFifter=9729}else{var sx=this._width,st=this._height;for(sm=0,sd.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),su=0;su<this._mipmaps.length;su++){if(this._mipmaps[su].byteLength!=sx*st*4)throw"mipmap size error  level:"+su;sd.texImage2D(this._type,su,6408,sx,st,0,6408,5121,new Uint8Array(this._mipmaps[su])),(sx/=2)<1&&(sx=1),(st/=2)<1&&(st=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&sd.pixelStorei(sd.UNPACK_ALIGNMENT,1),sd.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var sb=0,sq=!1,sY=!1;this._buffer.byteLength==4*sl*sZ?(sb=6408,sq=!0):this._buffer.byteLength==3*sl*sZ?(sb=6407,sY=!0):sb=this._format,sq||sY?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),sY&&sd.pixelStorei(sd.UNPACK_ALIGNMENT,1),sd.texImage2D(this._type,0,sb,sl,sZ,0,sb,5121,this._buffer)):sd&&sb==sd.ALPHA?(sd.texImage2D(3553,0,sb,sl,sZ,0,sb,sd.UNSIGNED_BYTE,this._buffer),sN=!0):0!=sb&&(sd.compressedTexImage2D(3553,0,sb,sl,sZ,0,this._buffer),sN=!0)}var sc=this._minFifter,sr=this._magFifter,sa=0==this._wrapModeU?10497:33071,sk=0==this._wrapModeV?10497:33071,se=ss.isPOT(sl,sZ);se?(this._mipmap||this._mipmaps?-1!==sc||(sc=9987):-1!==sc||(sc=9729),-1!==sr||(sr=9729),sd.texParameteri(this._type,10241,sc),sd.texParameteri(this._type,10240,sr),sd.texParameteri(this._type,10242,sa),sd.texParameteri(this._type,10243,sk),this._mipmap&&sd.generateMipmap(this._type)):(-1!==sc||(sc=9729),-1!==sr||(sr=9729),sd.texParameteri(this._type,10241,sc),sd.texParameteri(this._type,10240,sr),sd.texParameteri(this._type,10242,33071),sd.texParameteri(this._type,10243,33071)),sh&&s_&&sE.bindTexture(sd,sh,s_),this.memorySize=sN?this._buffer.length:se?sl*sZ*4*(1+1/3):sl*sZ*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},sL.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},sL.onAsynLoaded=function(sd,sL,sl){var sZ;sl&&(sZ=sl[0].call(this,sL)),sZ&&(this._width=sZ.width,this._height=sZ.height,this._buffer=sZ.data),this._src=sd,this._size=new srL(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},sL.getPixels=function(){return new Uint8Array(this._buffer)},sL.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(sF.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},sc(0,sL,"src",function(){return this._src}),sw.create=function(sd,sL,sl,sZ,sh,s_,sN){if(void 0===sZ&&(sZ=9729),void 0===sh&&(sh=9729),void 0===s_&&(s_=!0),!sd||sd.byteLength<sL*sl*4)throw"DataTexture2D create error";var sm=new sw;return sm.uri=sN,sm._buffer=sd,sm._width=sL,sm._height=sl,sm._mipmap=s_,sm._magFifter=sZ,sm._minFifter=sh,sm._size=new srL(sm._width,sm._height),sm._conchTexture?alert("怎么给runtime传递datatexture数据"):sm.activeResource(),sm},sw.load=function(sd,sL,sl,sZ,sh){if(void 0===sL&&(sL=0),void 0===sl&&(sl=0),void 0===sZ&&(sZ=9729),void 0===sh&&(sh=9729),"mipmaps"===sV.getFileExtension(sd)){var s_=sA.loader.create(sd,null,null,sw,[function(sd){this._mipmaps=[];var sL=new Uint32Array(sd);this._width=sL[0];var sl=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,sl=1024),this._width!=sl)throw"现在只支持512x256的环境贴图。当前的是"+sL[0];this._height=sL[1];for(var sZ=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,sh=this._height,s_=8;;){var sN=sZ*sh*4;if(s_+sN>sd.byteLength)throw"load mipmaps data size error ";var sm=new Uint8Array(sd,s_,sN);if(this._mipmaps.push(sm),s_+=sN,1==sZ&&1==sh)break;(sZ/=2)<1&&(sZ=1),(sh/=2)<1&&(sh=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){s_.simLodInfo=new Float32Array(40);for(var sN=0;sN<s_.simLodInfo.length;)s_.simLodInfo[sN]=(sw.simLodRect[sN]+.5)/1024,sN++,s_.simLodInfo[sN]=(sw.simLodRect[sN]+.5)/256,sN++,s_.simLodInfo[sN]=Math.max(sw.simLodRect[sN]-1,.1)/1024,sN++,s_.simLodInfo[sN]=Math.max(sw.simLodRect[sN]-1.5,.1)/256,sN++}return s_}if("number"==typeof sL)return sA.loader.create(sd,null,null,sw,[function(sd){return this._width=sL,this._height=sl,this._buffer=sd,null}]);if("function"==typeof sL)return sA.loader.create(sd,null,null,sw,[sL]);throw new Error("unknown params.")},sw.lodasatlas=!1,sb(sw,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),sw}(),sBL=function(sd){function sL(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,sL.__super.call(this)}sY(sL,"laya.d3.resource.models.PrimitiveMesh",sEL);var sl=sL.prototype;return sA.imps(sl,{"laya.d3.core.render.IRenderable":!0}),sl._getVertexBuffer=function(sd){return void 0===sd&&(sd=0),0===sd?this._vertexBuffer:null},sl._getVertexBuffers=function(){return null},sl._getIndexBuffer=function(){return this._indexBuffer},sl._getPositions=function(){var sd,sL=[],sl=this._vertexBuffer.vertexDeclaration.getVertexElements(),sZ=0;for(sZ=0;sZ<sl.length;sZ++){var sh=sl[sZ];if("vector3"===sh.elementFormat&&0===sh.elementUsage){sd=sh;break}}var s_=this._vertexBuffer.getData();for(sZ=0;sZ<s_.length;sZ+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var sN=sZ+sd.offset/4,sm=new sNL(s_[sN+0],s_[sN+1],s_[sN+2]);sL.push(sm)}return sL},sl.getRenderElement=function(sd){return this},sl.getRenderElementsCount=function(){return 1},sl.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},sl._beforeRender=function(sd){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},sl._render=function(sd){sF.mainContext.drawElements(4,this._numberIndices,5123,0),sO.drawCall++,sO.trianglesFaces+=this._numberIndices/3},sc(0,sl,"_vertexBufferCount",function(){return 1}),sc(0,sl,"triangleCount",function(){return this._indexBuffer.indexCount/3}),sL}(),sCL=function(sd){function sL(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,sL.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}sY(sL,"laya.d3.resource.models.Mesh",sEL);var sl=sL.prototype;return sl._getPositions=function(){var sd,sL,sl,sZ,sh,s_=[],sN=0,sm=0,su=0;if(0!==this._vertexBuffers.length){var sx=this._vertexBuffers.length;for(sN=0;sN<sx;sN++){for(sl=(sd=this._vertexBuffers[sN]).vertexDeclaration.getVertexElements(),sm=0;sm<sl.length;sm++)if("vector3"===(sZ=sl[sm]).elementFormat&&0===sZ.elementUsage){sL=sZ;break}for(sh=sd.getData(),sm=0;sm<sh.length;sm+=sd.vertexDeclaration.vertexStride/4)su=sm+sL.offset/4,s_.push(new sNL(sh[su+0],sh[su+1],sh[su+2]))}}else{var st=this._subMeshes.length;for(sN=0;sN<st;sN++){for(sl=(sd=this._subMeshes[sN]._getVertexBuffer()).vertexDeclaration.getVertexElements(),sm=0;sm<sl.length;sm++)if("vector3"===(sZ=sl[sm]).elementFormat&&0===sZ.elementUsage){sL=sZ;break}for(sh=sd.getData(),sm=0;sm<sh.length;sm+=sd.vertexDeclaration.vertexStride/4)su=sm+sL.offset/4,s_.push(new sNL(sh[su+0],sh[su+1],sh[su+2]))}}return s_},sl._setSubMeshes=function(sd){this._subMeshes=sd,this._subMeshCount=sd.length;for(var sL=0;sL<this._subMeshCount;sL++)sd[sL]._indexInMesh=sL;this._positions=this._getPositions(),this._generateBoundingObject()},sl.onAsynLoaded=function(sd,sL,sl){var sZ=sL[0],sh=sL[1];svd.read(sZ,this,this._materials,this._subMeshes,sh),this.completeCreate(),this._endLoaded()},sl.getSubMesh=function(sd){return this._subMeshes[sd]},sl.getSubMeshCount=function(){return this._subMeshes.length},sl.getRenderElementsCount=function(){return this._subMeshes.length},sl.getRenderElement=function(sd){return this._subMeshes[sd]},sl.disposeResource=function(){for(var sd=0;sd<this._subMeshes.length;sd++)this._subMeshes[sd].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},sc(0,sl,"materials",function(){return this._materials.slice()}),sc(0,sl,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),sL.load=function(sd){return sA.loader.create(sd,null,null,sL)},sL}(),sPL=(function(sd){function sx(sd,sL,sl,sZ,sh,s_,sN,sm,su){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===sl&&(sl=6408),void 0===sZ&&(sZ=5121),void 0===sh&&(sh=33189),void 0===s_&&(s_=!1),void 0===sN&&(sN=!1),void 0===sm&&(sm=-1),void 0===su&&(su=-1),sx.__super.call(this),this._type=3553,this._width=sd,this._height=sL,this._size=new srL(sd,sL),this._surfaceFormat=sl,this._surfaceType=sZ,this._depthStencilFormat=sh,sr.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=s_,this._repeat=sN,this._minFifter=sm,this._magFifter=su,this.activeResource(),this._alreadyResolved=!0}sY(sx,"laya.d3.resource.RenderTexture",sFL);var sL=sx.prototype;sL.recreateResource=function(){var sd=sF.mainContext;this._frameBuffer=sd.createFramebuffer(),this._source=sd.createTexture();var sL=sE.curBindTexTarget,sl=sE.curBindTexValue;sE.bindTexture(sd,this._type,this._source),sd.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var sZ=this._minFifter,sh=this._magFifter,s_=this._repeat?10497:33071;if(ss.isPOT(this._width,this._height)?(this._mipmap?-1!==sZ||(sZ=9987):-1!==sZ||(sZ=9729),-1!==sh||(sh=9729),sd.texParameteri(this._type,10241,sZ),sd.texParameteri(this._type,10240,sh),sd.texParameteri(this._type,10242,s_),sd.texParameteri(this._type,10243,s_),this._mipmap&&sd.generateMipmap(this._type)):(-1!==sZ||(sZ=9729),-1!==sh||(sh=9729),sd.texParameteri(this._type,10241,sZ),sd.texParameteri(this._type,10240,sh),sd.texParameteri(this._type,10242,33071),sd.texParameteri(this._type,10243,33071)),sL&&sl&&sE.bindTexture(sd,sL,sl),sd.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=sd.createRenderbuffer(),sd.bindRenderbuffer(36161,this._depthStencilBuffer),sd.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),sd.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:sd.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:sd.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:sd.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}sd.framebufferTexture2D(36160,36064,3553,this._source,0),sd.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},sL.start=function(){sF.mainContext.bindFramebuffer(36160,this.frameBuffer),(sx._currentRenderTarget=this)._alreadyResolved=!1},sL.end=function(){sF.mainContext.bindFramebuffer(36160,null),sx._currentRenderTarget=null,this._alreadyResolved=!0},sL.getData=function(sd,sL,sl,sZ){var sh=sF.mainContext;if(sh.bindFramebuffer(36160,this._frameBuffer),!(36053===sh.checkFramebufferStatus(36160)))return sh.bindFramebuffer(36160,null),null;var s_=new Uint8Array(this._width*this._height*4);return sh.readPixels(sd,sL,sl,sZ,this._surfaceFormat,this._surfaceType,s_),sh.bindFramebuffer(36160,null),s_},sL.disposeResource=function(){if(this._frameBuffer){var sd=sF.mainContext;sd.deleteTexture(this._source),sd.deleteFramebuffer(this._frameBuffer),sd.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},sc(0,sL,"surfaceFormat",function(){return this._surfaceFormat}),sc(0,sL,"surfaceType",function(){return this._surfaceType}),sc(0,sL,"depthStencilFormat",function(){return this._depthStencilFormat}),sc(0,sL,"source",function(){return this._alreadyResolved?sA.superGet(sFL,this,"source"):null}),sc(0,sL,"depthStencilBuffer",function(){return this._depthStencilBuffer}),sc(0,sL,"frameBuffer",function(){return this._frameBuffer}),sx._currentRenderTarget=null}(),function(sd){function sL(sd){this._color=null,this._pixels=null,sL.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new srL(this.width,this.height),this._color=sd,this._pixels=new Uint8Array([255*sd.x,255*sd.y,255*sd.z,255*sd.w]),this.uri="SolidColorTexture2D_"+this.id}sY(sL,"laya.d3.resource.SolidColorTexture2D",sFL);var sl=sL.prototype;return sl._createWebGlTexture=function(){var sd=sF.mainContext,sL=this._source=sd.createTexture(),sl=this._width,sZ=this._height,sh=sE.curBindTexTarget,s_=sE.curBindTexValue;sE.bindTexture(sd,this._type,sL),sd.texImage2D(this._type,0,6408,sl,sZ,0,6408,5121,this._pixels);var sN=this._minFifter,sm=this._magFifter,su=this._repeat?10497:33071,sx=ss.isPOT(sl,sZ);sx?(this._mipmap?-1!==sN||(sN=9987):-1!==sN||(sN=9729),-1!==sm||(sm=9729),sd.texParameteri(this._type,10241,sN),sd.texParameteri(this._type,10240,sm),sd.texParameteri(this._type,10242,su),sd.texParameteri(this._type,10243,su),this._mipmap&&sd.generateMipmap(this._type)):(-1!==sN||(sN=9729),-1!==sm||(sm=9729),sd.texParameteri(this._type,10241,sN),sd.texParameteri(this._type,10240,sm),sd.texParameteri(this._type,10242,33071),sd.texParameteri(this._type,10243,33071)),sh&&s_&&sE.bindTexture(sd,sh,s_),this.memorySize=sx?sl*sZ*4*(1+1/3):sl*sZ*4},sl.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},sl.disposeResource=function(){this._source&&(sF.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},sb(sL,["magentaTexture",function(){var sd=new sL(new smL(1,0,1,1));return sd.lock=!0,this.magentaTexture=sd},"grayTexture",function(){var sd=new sL(new smL(.5,.5,.5,1));return sd.lock=!0,this.grayTexture=sd}]),sL}()),sTL=function(sd){function sh(sd,sL,sl,sZ){this._canRead=!1,this._image=null,this._pixels=null,void 0===sd&&(sd=!1),void 0===sL&&(sL=!0),void 0===sl&&(sl=6408),void 0===sZ&&(sZ=!0),sh.__super.call(this),this._type=3553,this._repeat=sL,this._canRead=sd,this._format=sl,this._mipmap=sZ}sY(sh,"laya.d3.resource.Texture2D",sFL);var sL=sh.prototype;return sL._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var sd=sF.mainContext,sL=this._source=sd.createTexture(),sl=this._width,sZ=this._height,sh=sE.curBindTexTarget,s_=sE.curBindTexValue;switch(sE.bindTexture(sd,this._type,sL),this._format){case 6407:case 6408:this._canRead?sd.texImage2D(this._type,0,this._format,sl,sZ,0,this._format,5121,this._pixels):this._image instanceof laya.webgl.resource.WebGLImage?sd.texImage2D(this._type,0,this._image._format,sl,sZ,0,this._image._format,5121,this._image.atlasSource):sd.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case sF.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:sd.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var sN=this._minFifter,sm=this._magFifter,su=this._repeat?10497:33071,sx=0==this._wrapModeU?10497:33071,st=0==this._wrapModeV?10497:33071,sb=ss.isPOT(sl,sZ);sb?(this._mipmap?-1!==sN||(sN=9987):-1!==sN||(sN=9729),-1!==sm||(sm=9729),sd.texParameteri(this._type,10241,sN),sd.texParameteri(this._type,10240,sm),sd.texParameteri(this._type,10242,su),sd.texParameteri(this._type,10243,su),sd.texParameteri(this._type,10242,sx),sd.texParameteri(this._type,10243,st),this._mipmap&&sd.generateMipmap(this._type)):(-1!==sN||(sN=9729),-1!==sm||(sm=9729),sd.texParameteri(this._type,10241,sN),sd.texParameteri(this._type,10240,sm),sd.texParameteri(this._type,10242,33071),sd.texParameteri(this._type,10243,33071)),sh&&s_&&sE.bindTexture(sd,sh,s_),this._image.onload=null,this._image=null,this.memorySize=sb?sl*sZ*4*(1+1/3):sl*sZ*4},sL.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},sL.onAsynLoaded=function(sd,sL,sl){if(sl){var sZ=sl[0];void 0!==sZ&&(this._canRead=sZ);var sh=sl[1];void 0!==sh&&(this._repeat=sh);var s_=sl[2];void 0!==s_&&(this._format=s_);var sN=sl[3];void 0!==sN&&(this._mipmap=sN);var sm=sl.wrapModeU;void 0!==sm&&(this._wrapModeU=sm);var su=sl.wrapModeV;void 0!==su&&(this._wrapModeV=su)}switch(this._format){case 6407:case 6408:var sx=(this._image=sL).width,st=sL.height;this._width=sx,this._height=st,this._size=new srL(sx,st),this._canRead&&(sr.isConchApp?sL instanceof sq.HTMLElement&&(this._pixels=new Uint8Array(sL.getImageData(0,0,sx,st))):(sI.canvas.size(sx,st),sI.canvas.clear(),sI.context.drawImage(sL,0,0,sx,st),this._pixels=new Uint8Array(sI.context.getImageData(0,0,sx,st).data.buffer)));break;case sF.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var sb=new sy(sL);sb.readUTFBytes(4),sb.readUTFBytes(2),sb.getInt16();sb.endian="bigEndian",this._width=sb.getInt16(),this._height=sb.getInt16(),this._size=new srL(this._width,this._height);sb.getInt16(),sb.getInt16();this._image=new Uint8Array(sL,sb.pos)}this.recreateResource(),this._endLoaded()},sL.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},sL.disposeResource=function(){this._source&&(sF.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},sc(0,sL,"_src",function(){return this.url}),sc(0,sL,"src",function(){return this.url}),sh.load=function(sd){return sA.loader.create(sd,null,null,sh)},sh}(),szL=function(sL){function sl(sd,sL){sl.__super.call(this),void 0===sd&&(sd=.3),void 0===sL&&(sL=1e3),this._tempVector3=new sNL,this._position=new sNL,this._up=new sNL,this._forward=new sNL,this._right=new sNL,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=srL.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=sd,this._farPlane=sL,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),sA.stage.on("resize",this,this._onScreenSizeChanged)}sY(sl,"laya.d3.core.BaseCamera",sL);var sd=sl.prototype;return sd._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var sd=this.scene._cameraPool,sL=sd.length-1,sl=0;sl<sL;sl++)if(sd[sl].renderingOrder>sd[sL].renderingOrder){var sZ=sd[sl];sd[sl]=sd[sL],sd[sL]=sZ}},sd._calculateProjectionMatrix=function(){},sd._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},sd._prepareCameraToRender=function(){sp._currentCameraCullingMask=this.cullingMask;var sd=this._shaderValues;sd.setValue(0,this.transform.position.elements),sd.setValue(5,this.forward.elements),sd.setValue(6,this.up.elements)},sd._prepareCameraViewProject=function(sd,sL){var sl=this._shaderValues;sl.setValue(1,sd.elements),sl.setValue(2,sL.elements)},sd._renderCamera=function(sd,sL,sl){},sd.addLayer=function(sd){29!==sd.number&&30!=sd.number&&(this.cullingMask=this.cullingMask|sd.mask)},sd.removeLayer=function(sd){29!==sd.number&&30!=sd.number&&(this.cullingMask=this.cullingMask&~sd.mask)},sd.addAllLayers=function(){this.cullingMask=2147483647},sd.removeAllLayers=function(){this.cullingMask=0|sp.getLayerByNumber(29).mask|sp.getLayerByNumber(30).mask},sd.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},sd.moveForward=function(sd){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=sd,this.transform.translate(this._tempVector3)},sd.moveRight=function(sd){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=sd,this.transform.translate(this._tempVector3)},sd.moveVertical=function(sd){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=sd,this.transform.translate(this._tempVector3,!1)},sd._addSelfRenderObjects=function(){var sd=this.scene._cameraPool,sL=sd.length;if(0<sL){for(var sl=sL-1;0<=sl;sl--)if(this.renderingOrder<=sd[sl].renderingOrder){sd.splice(sl+1,0,this);break}}else sd.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},sd._clearSelfRenderObjects=function(){var sd=this.scene._cameraPool;sd.splice(sd.indexOf(this),1)},sd.destroy=function(sd){void 0===sd&&(sd=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,sA.stage.off("resize",this,this._onScreenSizeChanged),sL.prototype.destroy.call(this,sd)},sc(0,sd,"sky",function(){return this._sky},function(sd){(this._sky=sd)._ownerCamera=this}),sc(0,sd,"forward",function(){var sd=this.transform.worldMatrix.elements,sL=this._forward.elements;return sL[0]=-sd[8],sL[1]=-sd[9],sL[2]=-sd[10],this._forward}),sc(0,sd,"position",function(){var sd=this.transform.worldMatrix.elements,sL=this._position.elements;return sL[0]=sd[12],sL[1]=sd[13],sL[2]=sd[14],this._position}),sc(0,sd,"renderTarget",function(){return this._renderTarget},function(sd){null!=(this._renderTarget=sd)&&(this._renderTargetSize=sd.size)}),sc(0,sd,"up",function(){var sd=this.transform.worldMatrix.elements,sL=this._up.elements;return sL[0]=sd[4],sL[1]=sd[5],sL[2]=sd[6],this._up}),sc(0,sd,"right",function(){var sd=this.transform.worldMatrix.elements,sL=this._right.elements;return sL[0]=sd[0],sL[1]=sd[1],sL[2]=sd[2],this._right}),sc(0,sd,"renderTargetSize",function(){return this._renderTargetSize},function(sd){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=sd,this._calculateProjectionMatrix()}),sc(0,sd,"fieldOfView",function(){return this._fieldOfView},function(sd){this._fieldOfView=sd,this._calculateProjectionMatrix()}),sc(0,sd,"nearPlane",function(){return this._nearPlane},function(sd){this._nearPlane=sd,this._calculateProjectionMatrix()}),sc(0,sd,"farPlane",function(){return this._farPlane},function(sd){this._farPlane=sd,this._calculateProjectionMatrix()}),sc(0,sd,"orthographic",function(){return this._orthographic},function(sd){this._orthographic=sd,this._calculateProjectionMatrix()}),sc(0,sd,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(sd){this._orthographicVerticalSize=sd,this._calculateProjectionMatrix()}),sc(0,sd,"renderingOrder",function(){return this._renderingOrder},function(sd){this._renderingOrder=sd,this._sortCamerasByRenderingOrder()}),sl.CAMERAPOS=0,sl.VIEWMATRIX=1,sl.PROJECTMATRIX=2,sl.VPMATRIX=3,sl.VPMATRIX_NO_TRANSLATE=4,sl.CAMERADIRECTION=5,sl.CAMERAUP=6,sl.ENVIRONMENTDIFFUSE=7,sl.ENVIRONMENTSPECULAR=8,sl.SIMLODINFO=9,sl.DIFFUSEIRRADMATR=10,sl.DIFFUSEIRRADMATG=11,sl.DIFFUSEIRRADMATB=12,sl.HDREXPOSURE=13,sl.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",sl.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",sl.CLEARFLAG_SOLIDCOLOR=0,sl.CLEARFLAG_SKY=1,sl.CLEARFLAG_DEPTHONLY=2,sl.CLEARFLAG_NONE=3,sb(sl,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new sdL(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new sdL},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new sdL}]),sl}(sXL),sDL=function(sl){function sL(sd){this._render=null,this._geometryFilter=null,sL.__super.call(this,sd)}sY(sL,"laya.d3.core.RenderableSprite3D",sl);var sd=sL.prototype;return sd._addToInitStaticBatchManager=function(){},sd._setBelongScene=function(sd){sl.prototype._setBelongScene.call(this,sd),sd._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},sd._setUnBelongScene=function(){var sd=this._scene._renderableSprite3Ds,sL=sd.indexOf(this);sd.splice(sL,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),sl.prototype._setUnBelongScene.call(this)},sd._update=function(sd){(sd.owner=this)._activeInHierarchy&&(this._updateComponents(sd),this._render._updateOctreeNode(),this._lateUpdateComponents(sd),sO.spriteCount++,this._childs.length&&this._updateChilds(sd))},sd.destroy=function(sd){void 0===sd&&(sd=!0),sl.prototype.destroy.call(this,sd),this._render._destroy(),this._render=null},sL.__init__=function(){sL.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=sL.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),sL.SAHDERDEFINE_LIGHTMAP=sL.shaderDefines.registerDefine("LIGHTMAP")},sL.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,sL.SAHDERDEFINE_LIGHTMAP=4,sL.LIGHTMAPSCALEOFFSET=2,sL.LIGHTMAP=3,sb(sL,["shaderDefines",function(){return this.shaderDefines=new stL}]),sL}(sXL),sGL=(function(sd){function sZ(sd,sL,sl){this._long=NaN,this._width=NaN,this._height=NaN,void 0===sd&&(sd=1),void 0===sL&&(sL=1),void 0===sl&&(sl=1),sZ.__super.call(this),this._long=sd,this._width=sL,this._height=sl,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}sY(sZ,"laya.d3.resource.models.BoxMesh",sBL);var sL=sZ.prototype;sL.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var sd=sFd.vertexDeclaration,sL=(sd.vertexStride,this._long/2),sl=this._height/2,sZ=this._width/2,sh=new Float32Array([-sL,sl,-sZ,0,1,0,0,0,sL,sl,-sZ,0,1,0,1,0,sL,sl,sZ,0,1,0,1,1,-sL,sl,sZ,0,1,0,0,1,-sL,-sl,-sZ,0,-1,0,0,1,sL,-sl,-sZ,0,-1,0,1,1,sL,-sl,sZ,0,-1,0,1,0,-sL,-sl,sZ,0,-1,0,0,0,-sL,sl,-sZ,-1,0,0,0,0,-sL,sl,sZ,-1,0,0,1,0,-sL,-sl,sZ,-1,0,0,1,1,-sL,-sl,-sZ,-1,0,0,0,1,sL,sl,-sZ,1,0,0,1,0,sL,sl,sZ,1,0,0,0,0,sL,-sl,sZ,1,0,0,0,1,sL,-sl,-sZ,1,0,0,1,1,-sL,sl,sZ,0,0,1,0,0,sL,sl,sZ,0,0,1,1,0,sL,-sl,sZ,0,0,1,1,1,-sL,-sl,sZ,0,0,1,0,1,-sL,sl,-sZ,0,0,-1,1,0,sL,sl,-sZ,0,0,-1,0,0,sL,-sl,-sZ,0,0,-1,0,1,-sL,-sl,-sZ,0,0,-1,1,1]),s_=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new siL(sd,this._numberVertices,35044,!0),this._indexBuffer=new soL("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(sh),this._indexBuffer.setData(s_),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},sc(0,sL,"long",function(){return this._long},function(sd){this._long!==sd&&(this._long=sd,this.releaseResource(),this.activeResource())}),sc(0,sL,"width",function(){return this._width},function(sd){this._width!==sd&&(this._width=sd,this.releaseResource(),this.activeResource())}),sc(0,sL,"height",function(){return this._height},function(sd){this._height!==sd&&(this._height=sd,this.releaseResource(),this.activeResource())})}(),function(sd){function sN(sd,sL,sl){void 0===sd&&(sd=0),void 0===sL&&(sL=.3),void 0===sl&&(sl=1e3),this._viewMatrix=new sdL,this._projectionMatrix=new sdL,this._projectionViewMatrix=new sdL,this._viewport=new suL(0,0,0,0),this._normalizedViewport=new suL(0,0,1,1),this._aspectRatio=sd,this._boundFrustumUpdate=!0,this._boundFrustum=new sfd(sdL.DEFAULT),sN.__super.call(this,sL,sl),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}sY(sN,"laya.d3.core.Camera",szL);var sL=sN.prototype;return sL._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},sL._parseCustomProps=function(sd,sL,sl,sZ){var sh=sl.clearColor;this.clearColor=new smL(sh[0],sh[1],sh[2],sh[3]);var s_=sl.viewport;this.normalizedViewport=new suL(s_[0],s_[1],s_[2],s_[3])},sL._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var sd=this.orthographicVerticalSize*this.aspectRatio*.5,sL=.5*this.orthographicVerticalSize;sdL.createOrthoOffCenterRH(-sd,sd,-sL,sL,this.nearPlane,this.farPlane,this._projectionMatrix)}else sdL.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},sL._update=function(sd){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,sd)},sL._renderCamera=function(sd,sL,sl){var sZ,sh;sl.parallelSplitShadowMaps[0]&&sl._renderShadowMap(sd,sL,this),(sL.camera=this)._prepareCameraToRender(),sl._preRenderUpdateComponents(sL),sZ=sL._viewMatrix=this.viewMatrix;var s_=this._renderTarget;s_?(s_.start(),sdL.multiply(szL._invertYScaleMatrix,this._projectionMatrix,szL._invertYProjectionMatrix),sdL.multiply(szL._invertYScaleMatrix,this.projectionViewMatrix,szL._invertYProjectionViewMatrix),sh=sL._projectionMatrix=szL._invertYProjectionMatrix,sL._projectionViewMatrix=szL._invertYProjectionViewMatrix):(sh=sL._projectionMatrix=this._projectionMatrix,sL._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(sZ,sh),sL._viewport=this.viewport,sl._preRenderScene(sd,sL,this.boundFrustum),sl._clear(sd,sL),sl._renderScene(sd,sL),sl._postRenderUpdateComponents(sL),s_&&s_.end()},sL.viewportPointToRay=function(sd,sL){scL.calculateCursorRay(sd,this.viewport,this._projectionMatrix,this.viewMatrix,null,sL)},sL.normalizedViewportPointToRay=function(sd,sL){var sl=sN._tempVector20,sZ=this.viewport,sh=sd.elements,s_=sl.elements;s_[0]=sh[0]*sZ.width,s_[1]=sh[1]*sZ.height,scL.calculateCursorRay(sl,this.viewport,this._projectionMatrix,this.viewMatrix,null,sL)},sL.worldToViewportPoint=function(sd,sL){sdL.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(sd,this._projectionViewMatrix,sL);var sl=sL.elements;sl[0]=sl[0]/sA.stage.clientScaleX,sl[1]=sl[1]/sA.stage.clientScaleY},sL.worldToNormalizedViewportPoint=function(sd,sL){sdL.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(sd,this._projectionViewMatrix,sL);var sl=sL.elements;sl[0]=sl[0]/sA.stage.clientScaleX,sl[1]=sl[1]/sA.stage.clientScaleY},sL.convertScreenCoordToOrthographicCoord=function(sd,sL){if(this._orthographic){var sl=sv.clientWidth,sZ=sv.clientHeight,sh=this.orthographicVerticalSize*this.aspectRatio/sl,s_=this.orthographicVerticalSize/sZ,sN=sd.elements,sm=sL.elements;return sm[0]=(-sl/2+sN[0])*sh,sm[1]=(sZ/2-sN[1])*s_,sm[2]=(this.nearPlane-this.farPlane)*(sN[2]+1)/2-this.nearPlane,sNL.transformCoordinate(sL,this.transform.worldMatrix,sL),!0}return!1},sc(0,sL,"projectionViewMatrix",function(){return sdL.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),sc(0,sL,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var sd=this.viewport;return sd.width/sd.height},function(sd){if(sd<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=sd,this._calculateProjectionMatrix()}),sc(0,sL,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),sc(0,sL,"needViewport",function(){var sd=this.normalizedViewport;return 0===sd.x&&0===sd.y&&1===sd.width&&1===sd.height}),sc(0,sL,"viewport",function(){if(this._viewportExpressedInClipSpace){var sd=this._normalizedViewport,sL=this.renderTargetSize,sl=sL.width,sZ=sL.height;this._viewport.x=sd.x*sl,this._viewport.y=sd.y*sZ,this._viewport.width=sd.width*sl,this._viewport.height=sd.height*sZ}return this._viewport},function(sd){if(null!=this.renderTarget&&(sd.x<0||sd.y<0||0==sd.width||0==sd.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=sd,this._calculateProjectionMatrix()}),sc(0,sL,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var sd=this._viewport,sL=this.renderTargetSize,sl=sL.width,sZ=sL.height;this._normalizedViewport.x=sd.x/sl,this._normalizedViewport.y=sd.y/sZ,this._normalizedViewport.width=sd.width/sl,this._normalizedViewport.height=sd.height/sZ}return this._normalizedViewport},function(sd){sd.x<0&&(sd.x=0,console.warn("Camera: viewport.x must large than 0.0.")),sd.y<0&&(sd.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<sd.x+sd.width&&(sd.width=1-sd.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<sd.y+sd.height&&(sd.height=1-sd.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=sd,this._calculateProjectionMatrix()}),sc(0,sL,"projectionMatrix",function(){return this._projectionMatrix},function(sd){this._projectionMatrix=sd,this._useUserProjectionMatrix=!0}),sc(0,sL,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),sb(sN,["_tempVector20",function(){return this._tempVector20=new s_L}]),sN}()),sKL=function(sl){function sZ(sd,sL){sZ.__super.call(this,sL),this._geometryFilter=new sIL(this),this._render=new spL(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),sd&&(this._geometryFilter.sharedMesh=sd)instanceof laya.d3.resource.models.Mesh&&(sd.loaded?this._render.sharedMaterials=sd.materials:sd.once("loaded",this,this._applyMeshMaterials))}sY(sZ,"laya.d3.core.MeshSprite3D",sl);var sd=sZ.prototype;return sd._changeRenderObjectByMesh=function(sd){var sL=this._render._renderElements,sl=sL[sd];sl||(sl=sL[sd]=new s$L),sl._render=this._render;var sZ=this._render.sharedMaterials[sd];sZ||(sZ=sRL.defaultMaterial);var sh=this._geometryFilter.sharedMesh.getRenderElement(sd);return sl._mainSortID=this._getSortID(sh,sZ),sl._sprite3D=this,sl.renderObj=sh,sl._material=sZ,sl},sd._changeRenderObjectByMaterial=function(sd,sL){var sl=this._render._renderElements[sd];sL||(sL=sRL.defaultMaterial);var sZ=this._geometryFilter.sharedMesh.getRenderElement(sd);return sl._mainSortID=this._getSortID(sZ,sL),sl._sprite3D=this,sl.renderObj=sZ,sl._material=sL,sl},sd._changeRenderObjectsByMesh=function(){var sd=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=sd;for(var sL=0;sL<sd;sL++)this._changeRenderObjectByMesh(sL)},sd._onMeshChanged=function(sd){var sL=sd.sharedMesh;sL.loaded?this._changeRenderObjectsByMesh():sL.once("loaded",this,this._onMeshLoaded)},sd._onMeshLoaded=function(sd){sd===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},sd._onMaterialChanged=function(sd,sL,sl){sL<this._render._renderElements.length&&this._changeRenderObjectByMaterial(sL,sl)},sd._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},sd._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},sd._parseCustomProps=function(sd,sL,sl,sZ){var sh=this.meshRender,s_=sl.lightmapIndex;null!=s_&&(sh.lightmapIndex=s_);var sN,sm,su=sl.lightmapScaleOffset;if(su&&(sh.lightmapScaleOffset=new smL(su[0],su[1],su[2],su[3])),sZ.instanceParams)(sN=sZ.instanceParams.loadPath)&&(sm=sk.getRes(sL[sN]),(this.meshFilter.sharedMesh=sm).loaded?sh.sharedMaterials=sm.materials:sm.once("loaded",this,this._applyMeshMaterials));else{(sN=sl.meshPath)&&(sm=sk.getRes(sL[sN]),this.meshFilter.sharedMesh=sm);var sx=sl.materials;if(sx){var st=sh.sharedMaterials,sb=sx.length;st.length=sb;for(var sq=0;sq<sb;sq++)st[sq]=sk.getRes(sL[sx[sq].path]);sh.sharedMaterials=st}}},sd._applyMeshMaterials=function(sd){for(var sL=this._render.sharedMaterials,sl=sd.materials,sZ=0,sh=sl.length;sZ<sh;sZ++)sL[sZ]||(sL[sZ]=sl[sZ]);this._render.sharedMaterials=sL},sd._addToInitStaticBatchManager=function(){sZ._staticBatchManager._addInitBatchSprite(this)},sd.cloneTo=function(sd){var sL=sd;sL._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var sl=this._render,sZ=sL._render;sZ.enable=sl.enable,sZ.sharedMaterials=sl.sharedMaterials,sZ.castShadow=sl.castShadow;var sh=sl.lightmapScaleOffset;sh&&(sZ.lightmapScaleOffset=sh.clone()),sZ.lightmapIndex=sl.lightmapIndex,sZ.receiveShadow=sl.receiveShadow,sZ.sortingFudge=sl.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,sd)},sd.destroy=function(sd){if(void 0===sd&&(sd=!0),!this.destroyed){var sL=this.meshFilter.sharedMesh;null!=sL&&(sL.loaded||sL.off("loaded",this,this._applyMeshMaterials)),sl.prototype.destroy.call(this,sd),this._geometryFilter._destroy()}},sc(0,sd,"meshFilter",function(){return this._geometryFilter}),sc(0,sd,"meshRender",function(){return this._render}),sZ.__init__=function(){sZd._staticBatchManagers.push(sZ._staticBatchManager)},sZ.load=function(sd){return sA.loader.create(sd,null,null,sZ)},sb(sZ,["_staticBatchManager",function(){return this._staticBatchManager=new snL}]),sZ}(sDL)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(sd,sL){"use strict";for(var sl in Object.defineProperty(sL,"__esModule",{value:!0}),Laya){var sZ=Laya[sl];sZ&&sZ.__isclass&&(sL[sl]=sZ)}}),function(sd,sL,shd){shd.un,shd.uns;var sl=shd.static,sZ=shd.class,s_=shd.getset,sr=shd.__newvec,sm=laya.maths.Bezier,sb=laya.utils.Browser,sFd=laya.utils.Byte,sh=(laya.events.Event,laya.events.EventDispatcher),sN=laya.display.Graphics,su=(laya.resource.HTMLCanvas,laya.utils.Handler),sx=laya.net.Loader,sq=laya.maths.MathUtil,sEd=laya.maths.Matrix,sa=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),st=(laya.renders.RenderContext,laya.resource.Resource),sY=laya.utils.RunDriver,s_d=laya.display.Sprite,sc=laya.utils.Stat,sId=laya.resource.Texture,sk=(laya.net.URL,laya.utils.Utils),sE=function(){function sd(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return sZ(sd,"laya.ani.AnimationContent"),sd}(),sI=function(){function sd(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return sZ(sd,"laya.ani.AnimationNodeContent"),sd}(),sw=function(){function sd(){}return sZ(sd,"laya.ani.AnimationParser01"),sd.parse=function(sd,sL){var sl=sL.__getBuffer(),sZ=0,sh=0,s_=0,sN=0,sm=0,su=0,sx=0,st=sL.readUTFString();sd._aniClassName=st;var sb,sq=sL.readUTFString().split("\n"),sY=sL.getUint8(),sc=sL.getUint32(),sr=sL.getUint32();0<sc&&(sb=sl.slice(sc,sr));var sa=new sFd(sb);for(0<sr&&(sd._publicExtData=sl.slice(sr,sl.byteLength)),sd._useParent=!!sL.getUint8(),sd._anis.length=sY,sZ=0;sZ<sY;sZ++){var sk=sd._anis[sZ]=new sE;sk.nodes=new Array;var se=sk.name=sq[sL.getUint16()];sd._aniMap[se]=sZ,sk.bone3DMap={},sk.playTime=sL.getFloat32(),sk.playTime<=0&&console.error("播放时间不能为0  url="+sd.url+" name="+sk.name);var sw=sk.nodes.length=sL.getUint8();for(sh=sk.totalKeyframeDatasLength=0;sh<sw;sh++){var ss=sk.nodes[sh]=new sI;ss.childs=[];var sA=sL.getInt16();0<=sA&&(ss.name=sq[sA],sk.bone3DMap[ss.name]=sh),ss.keyFrame=new Array,ss.parentIndex=sL.getInt16(),-1==ss.parentIndex?ss.parent=null:ss.parent=sk.nodes[ss.parentIndex],ss.lerpType=sL.getUint8();var sy=sL.getUint32();sa.pos=sy;var s$=ss.keyframeWidth=sa.getUint16();if(sk.totalKeyframeDatasLength+=s$,0===ss.lerpType||1===ss.lerpType)for(ss.interpolationMethod=[],ss.interpolationMethod.length=s$,s_=0;s_<s$;s_++)ss.interpolationMethod[s_]=sX.interpolation[sa.getUint8()];null!=ss.parent&&ss.parent.childs.push(ss);var sO=sL.getUint16();0<sO&&(ss.extenData=sl.slice(sL.pos,sL.pos+sO),sL.pos+=sO);var sn,sV=sL.getUint16(),sQ=0;for(s_=0,sN=ss.keyFrame.length=sV;s_<sN;s_++){if((sn=ss.keyFrame[s_]=new sp).duration=sL.getFloat32(),sn.startTime=sQ,2===ss.lerpType){sn.interpolationData=[];var sg,sF=sL.getUint8();switch(sg=sL.getFloat32()){case 254:for(sn.interpolationData.length=s$,sx=0;sx<s$;sx++)sn.interpolationData[sx]=0;break;case 255:for(sn.interpolationData.length=s$,sx=0;sx<s$;sx++)sn.interpolationData[sx]=5;break;default:for(sn.interpolationData.push(sg),su=1;su<sF;su++)sn.interpolationData.push(sL.getFloat32())}}for(sn.data=new Float32Array(s$),sm=0;sm<s$;sm++)sn.data[sm]=sL.getFloat32(),-1e-8<sn.data[sm]&&sn.data[sm]<1e-8&&(sn.data[sm]=0);sQ+=sn.duration}sn.startTime=sk.playTime,ss.playTime=sk.playTime,sd._calculateKeyFrame(ss,sV,s$)}}},sd}(),ss=function(){function sA(){}return sZ(sA,"laya.ani.AnimationParser02"),sA.READ_DATA=function(){sA._DATA.offset=sA._reader.getUint32(),sA._DATA.size=sA._reader.getUint32()},sA.READ_BLOCK=function(){for(var sd=sA._BLOCK.count=sA._reader.getUint16(),sL=sA._BLOCK.blockStarts=[],sl=sA._BLOCK.blockLengths=[],sZ=0;sZ<sd;sZ++)sL.push(sA._reader.getUint32()),sl.push(sA._reader.getUint32())},sA.READ_STRINGS=function(){var sd=sA._reader.getUint32(),sL=sA._reader.getUint16(),sl=sA._reader.pos;sA._reader.pos=sd+sA._DATA.offset;for(var sZ=0;sZ<sL;sZ++)sA._strings[sZ]=sA._reader.readUTFString();sA._reader.pos=sl},sA.parse=function(sd,sL){sA._templet=sd;(sA._reader=sL).__getBuffer();sA.READ_DATA(),sA.READ_BLOCK(),sA.READ_STRINGS();for(var sl=0,sZ=sA._BLOCK.count;sl<sZ;sl++){var sh=sL.getUint16(),s_=sA._strings[sh],sN=sA["READ_"+s_];if(null==sN)throw new Error("model file err,no this function:"+sh+" "+s_);sN.call()}},sA.READ_ANIMATIONS=function(){var sd=sA._reader,sL=sd.__getBuffer(),sl=0,sZ=0,sh=0,s_=0,sN=sd.getUint16(),sm=[];for(sm.length=sN,sl=0;sl<sN;sl++)sm[sl]=sX.interpolation[sd.getByte()];var su=sd.getUint8();for(sA._templet._anis.length=su,sl=0;sl<su;sl++){var sx=sA._templet._anis[sl]={};sx.nodes=new Array;var st=sx.name=sA._strings[sd.getUint16()];sA._templet._aniMap[st]=sl,sx.bone3DMap={},sx.playTime=sd.getFloat32();var sb=sx.nodes.length=sd.getInt16();for(sZ=sx.totalKeyframeDatasLength=0;sZ<sb;sZ++){var sq=sx.nodes[sZ]={};sq.keyframeWidth=sN,sq.childs=[];var sY=sd.getUint16();0<=sY&&(sq.name=sA._strings[sY],sx.bone3DMap[sq.name]=sZ),sq.keyFrame=new Array,sq.parentIndex=sd.getInt16(),-1==sq.parentIndex?sq.parent=null:sq.parent=sx.nodes[sq.parentIndex],sx.totalKeyframeDatasLength+=sN,sq.interpolationMethod=sm,null!=sq.parent&&sq.parent.childs.push(sq);var sc=sd.getUint16(),sr=null,sa=null;for(sh=0,s_=sq.keyFrame.length=sc;sh<s_;sh++){(sr=sq.keyFrame[sh]={}).startTime=sd.getFloat32(),sa&&(sa.duration=sr.startTime-sa.startTime);var sk=sA._DATA.offset,se=sd.getUint32(),sw=4*sN,ss=sL.slice(sk+se,sk+se+sw);sr.data=new Float32Array(ss),sa=sr}sr.duration=0,sq.playTime=sx.playTime,sA._templet._calculateKeyFrame(sq,sc,sN)}}},sA._templet=null,sA._reader=null,sA._strings=[],sl(sA,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),sA}(),spd=(function(){function sd(){}sZ(sd,"laya.ani.AnimationState"),sd.stopped=0,sd.paused=1,sd.playing=2}(),function(){function sh(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new sDd,this.resultMatrix=new sEd,this._children=[]}sZ(sh,"laya.ani.bone.Bone");var sd=sh.prototype;return sd.setTempMatrix=function(sd){this._tempMatrix=sd;var sL,sl=0;for(sl=0,sL=this._children.length;sl<sL;sl++)this._children[sl].setTempMatrix(this._tempMatrix)},sd.update=function(sd){var sL;if(this.rotation=this.transform.skX,sd)sL=this.resultTransform.getMatrix(),sEd.mul(sL,sd,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)sL=this.resultTransform.getMatrix(),sEd.mul(sL,this.parentBone.resultMatrix,this.resultMatrix);else{var sl=this.parentBone,sZ=NaN,sh=NaN,s_=NaN,sN=this.parentBone.resultMatrix;sL=this.resultTransform.getMatrix();var sm=sN.a*sL.tx+sN.c*sL.ty+sN.tx,su=sN.b*sL.tx+sN.d*sL.ty+sN.ty,sx=new sEd;this.inheritRotation?(sZ=Math.atan2(sl.resultMatrix.b,sl.resultMatrix.a),sh=Math.cos(sZ),s_=Math.sin(sZ),sx.setTo(sh,s_,-s_,sh,0,0),sEd.mul(this._tempMatrix,sx,sEd.TEMP),sEd.TEMP.copyTo(sx),sL=this.resultTransform.getMatrix(),sEd.mul(sL,sx,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,sL=this.resultTransform.getMatrix(),sEd.TEMP.identity(),sEd.TEMP.d=this.d,sEd.mul(sL,sEd.TEMP,this.resultMatrix)),this.resultMatrix.tx=sm,this.resultMatrix.ty=su}else(sL=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var st,sb=0;for(sb=0,st=this._children.length;sb<st;sb++)this._children[sb].update()},sd.updateChild=function(){var sd,sL=0;for(sL=0,sd=this._children.length;sL<sd;sL++)this._children[sL].update()},sd.setRotation=function(sd){this._sprite&&(this._sprite.rotation=180*sd/Math.PI)},sd.updateDraw=function(sd,sL){sh.ShowBones&&!sh.ShowBones[this.name]||(this._sprite||(this._sprite=new s_d,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),shd.stage.addChild(this._sprite)),this._sprite.x=sd+this.resultMatrix.tx,this._sprite.y=sL+this.resultMatrix.ty);var sl,sZ=0;for(sZ=0,sl=this._children.length;sZ<sl;sZ++)this._children[sZ].updateDraw(sd,sL)},sd.addChild=function(sd){this._children.push(sd),sd.parentBone=this},sd.findBone=function(sd){if(this.name==sd)return this;var sL,sl,sZ=0;for(sZ=0,sL=this._children.length;sZ<sL;sZ++)if(sl=this._children[sZ].findBone(sd))return sl;return null},sd.localToWorld=function(sd){var sL=sd[0],sl=sd[1];sd[0]=sL*this.resultMatrix.a+sl*this.resultMatrix.c+this.resultMatrix.tx,sd[1]=sL*this.resultMatrix.b+sl*this.resultMatrix.d+this.resultMatrix.ty},sh.ShowBones={},sh}()),sHd=function(){function sr(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}sZ(sr,"laya.ani.bone.BoneSlot");var sd=sr.prototype;return sd.showSlotData=function(sd,sL){void 0===sL&&(sL=!0),this.currSlotData=sd,sL&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},sd.showDisplayByName=function(sd){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(sd))},sd.replaceDisplayByName=function(sd,sL){if(this.currSlotData){var sl;sl=this.currSlotData.getDisplayByName(sd);var sZ;sZ=this.currSlotData.getDisplayByName(sL),this.replaceDisplayByIndex(sl,sZ)}},sd.replaceDisplayByIndex=function(sd,sL){this.currSlotData&&(this._replaceDic[sd]=sL,this.displayIndex==sd&&this.showDisplayByIndex(sd))},sd.showDisplayByIndex=function(sd){if(null!=this._replaceDic[sd]&&(sd=this._replaceDic[sd]),this.currSlotData&&-1<sd&&sd<this.currSlotData.displayArr.length){if(this.displayIndex=sd,this.currDisplayData=this.currSlotData.displayArr[sd],this.currDisplayData){var sL=this.currDisplayData.name;this.currTexture=this.templet.getTexture(sL),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!sa.isConchApp||sa.isConchApp&&"0.9.15"<s_d.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},sd.replaceSkin=function(sd){this._diyTexture=sd,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},sd.setParentMatrix=function(sd){this._parentMatrix=sd},sd.draw=function(sd,sL,sl,sZ){if(void 0===sl&&(sl=!1),void 0===sZ&&(sZ=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var sh,s_=this.currTexture;switch(this._diyTexture&&(s_=this._diyTexture),this.currDisplayData.type){case 0:if(sd){var sN=this.getDisplayMatrix();if(this._parentMatrix){var sm=!1;if(sN){var su;if(sEd.mul(sN,this._parentMatrix,sEd.TEMP),su=sl?(null==this._resultMatrix&&(this._resultMatrix=new sEd),this._resultMatrix):new sEd,!sa.isWebGL&&this.currDisplayData.uvs||sa.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var sx=sr._tempMatrix;sx.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(sx.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(sm=!0,sx.rotate(-Math.PI/2)),sEd.mul(sx,sEd.TEMP,su)}else sEd.TEMP.copyTo(su);sm?sd.drawTexture(s_,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,su):sd.drawTexture(s_,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,su)}}}break;case 1:if(null==(sh=sl?(null==this._skinSprite&&(this._skinSprite=sr.createSkinMesh()),this._skinSprite):sr.createSkinMesh()))return;var st;if(null==this.currDisplayData.bones){var sb,sq=this.currDisplayData.weights;this.deformData&&(sq=this.deformData),sb=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=s$.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=s$.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=sq;this.currDisplayData.triangles.length;st=this.currDisplayData.triangles,sh.init2(s_,null,st,this._mVerticleArr,sb);var sY,sc=this.getDisplayMatrix();if(this._parentMatrix)if(sc)sEd.mul(sc,this._parentMatrix,sEd.TEMP),sY=sl?(null==this._resultMatrix&&(this._resultMatrix=new sEd),this._resultMatrix):new sEd,sEd.TEMP.copyTo(sY),sh.transform=sY}else this.skinMesh(sL,sh,sZ);sd.drawSkin(sh);break;case 2:if(null==(sh=sl?(null==this._skinSprite&&(this._skinSprite=sr.createSkinMesh()),this._skinSprite):sr.createSkinMesh()))return;this.skinMesh(sL,sh,sZ),sd.drawSkin(sh)}}},sd.skinMesh=function(sd,sL,sl){var sZ,sh=this.currTexture,s_=this.currDisplayData.bones;sZ=this._diyTexture?(sh=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=s$.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=s$.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var sN,sm,su=this.currDisplayData.weights,sx=this.currDisplayData.triangles,st=0,sb=0,sq=0,sY=NaN,sc=NaN,sr=0,sa=0,sk=[],se=0,sw=0;if(this.deformData&&0<this.deformData.length){var ss=0;for(se=0,sw=s_.length;se<sw;){for(sq=s_[se++]+se,sb=st=0;se<sq;se++)sm=sd[s_[se]],sY=su[sr]+this.deformData[ss++],sc=su[sr+1]+this.deformData[ss++],sa=su[sr+2],st+=(sY*sm.a+sc*sm.c+sm.tx)*sa,sb+=(sY*sm.b+sc*sm.d+sm.ty)*sa,sr+=3;sk.push(st,sb)}}else for(se=0,sw=s_.length;se<sw;){for(sq=s_[se++]+se,sb=st=0;se<sq;se++)sm=sd[s_[se]],sY=su[sr],sc=su[sr+1],sa=su[sr+2],st+=(sY*sm.a+sc*sm.c+sm.tx)*sa,sb+=(sY*sm.b+sc*sm.d+sm.ty)*sa,sr+=3;sk.push(st,sb)}this._mVerticleArr=sk,sN=sx,sL.init2(sh,null,sN,this._mVerticleArr,sZ)},sd.drawBonePoint=function(sd){sd&&this._parentMatrix&&sd.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},sd.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},sd.getMatrix=function(){return this._resultMatrix},sd.copy=function(){var sd=new sr;return sd.type="copy",sd.name=this.name,sd.attachmentName=this.attachmentName,sd.srcDisplayIndex=this.srcDisplayIndex,sd.parent=this.parent,sd.displayIndex=this.displayIndex,sd.templet=this.templet,sd.currSlotData=this.currSlotData,sd.currTexture=this.currTexture,sd.currDisplayData=this.currDisplayData,sd},sr.createSkinMesh=function(){return sa.isWebGL||sa.isConchApp?sY.skinAniSprite():(sa.isWebGL,null)},sl(sr,["_tempMatrix",function(){return this._tempMatrix=new sEd}]),sr}(),sXd=function(){function sd(){this.skinName=null,this.deformSlotDataList=[]}return sZ(sd,"laya.ani.bone.DeformAniData"),sd}(),sjd=function(){function sd(){this.deformSlotDisplayList=[]}return sZ(sd,"laya.ani.bone.DeformSlotData"),sd}(),sRd=function(){function sd(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}sZ(sd,"laya.ani.bone.DeformSlotDisplayData");var sL=sd.prototype;return sL.binarySearch1=function(sd,sL){var sl=0,sZ=sd.length-2;if(0==sZ)return 1;for(var sh=sZ>>>1;;){if(sd[Math.floor(sh+1)]<=sL?sl=sh+1:sZ=sh,sl==sZ)return sl+1;sh=sl+sZ>>>1}return 0},sL.apply=function(sd,sL,sl){if(void 0===sl&&(sl=1),sd+=.05,!(this.timeList.length<=0)){var sZ=0;if(!(sd<this.timeList[0])){var sh=this.vectices[0].length,s_=[],sN=this.binarySearch1(this.timeList,sd);if(this.frameIndex=sN,sd>=this.timeList[this.timeList.length-1]){var sm=this.vectices[this.vectices.length-1];if(sl<1)for(sZ=0;sZ<sh;sZ++)s_[sZ]+=(sm[sZ]-s_[sZ])*sl;else for(sZ=0;sZ<sh;sZ++)s_[sZ]=sm[sZ];this.deformData=s_}else{this.tweenKeyList[this.frameIndex];var su=this.vectices[this.frameIndex-1],sx=this.vectices[this.frameIndex],st=this.timeList[this.frameIndex-1],sb=this.timeList[this.frameIndex];sl=this.tweenKeyList[sN-1]?(sd-st)/(sb-st):0;var sq=NaN;for(sZ=0;sZ<sh;sZ++)sq=su[sZ],s_[sZ]=sq+(sx[sZ]-sq)*sl;this.deformData=s_}}}},sd}(),sod=function(){function sd(){this.time=NaN,this.drawOrder=[]}return sZ(sd,"laya.ani.bone.DrawOrderData"),sd}(),sid=function(){function sd(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return sZ(sd,"laya.ani.bone.EventData"),sd}(),se=function(){function sZd(sd,sL){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=sd,this._targetBone=sL[sd.targetBoneIndex],this.isSpine=sd.isSpine,null==this._bones&&(this._bones=[]);for(var sl=this._bones.length=0,sZ=sd.boneIndexs.length;sl<sZ;sl++)this._bones.push(sL[sd.boneIndexs[sl]]);this.name=sd.name,this.mix=sd.mix,this.bendDirection=sd.bendDirection}sZ(sZd,"laya.ani.bone.IkConstraint");var sd=sZd.prototype;return sd.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},sd._applyIk1=function(sd,sL,sl,sZ){var sh=sd.parentBone,s_=1/(sh.resultMatrix.a*sh.resultMatrix.d-sh.resultMatrix.b*sh.resultMatrix.c),sN=sL-sh.resultMatrix.tx,sm=sl-sh.resultMatrix.ty,su=(sN*sh.resultMatrix.d-sm*sh.resultMatrix.c)*s_-sd.transform.x,sx=(sm*sh.resultMatrix.a-sN*sh.resultMatrix.b)*s_-sd.transform.y,st=Math.atan2(sx,su)*sZd.radDeg-0-sd.transform.skX;sd.transform.scX<0&&(st+=180),180<st?st-=360:st<-180&&(st+=360),sd.transform.skX=sd.transform.skY=sd.transform.skX+st*sZ,sd.update()},sd.updatePos=function(sd,sL){this._sp&&this._sp.pos(sd,sL)},sd._applyIk2=function(sd,sL,sl,sZ,sh,s_){if(0!=s_){var sN=sd.resultTransform.x,sm=sd.resultTransform.y,su=sd.transform.scX,sx=sd.transform.scY,st=sL.transform.scX,sb=0,sq=0,sY=0;sY=su<0?(su=-su,sb=180,-1):(sb=0,1),sx<0&&(sx=-sx,sY=-sY),sq=st<0?(st=-st,180):0;var sc=sL.resultTransform.x,sr=NaN,sa=NaN,sk=NaN,se=sd.resultMatrix.a,sw=sd.resultMatrix.c,ss=sd.resultMatrix.b,sA=sd.resultMatrix.d,sy=Math.abs(su-sx)<=1e-4;sk=sy?(sa=se*sc+sw*(sr=sL.resultTransform.y)+sd.resultMatrix.tx,ss*sc+sA*sr+sd.resultMatrix.ty):(sr=0,sa=se*sc+sd.resultMatrix.tx,ss*sc+sd.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new s_d,shd.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(sl,sZ,15,"#ffff00"),this._sp.graphics.drawCircle(sa,sk,15,"#ff00ff")),sd.setRotation(Math.atan2(sk-sd.resultMatrix.ty,sa-sd.resultMatrix.tx));var s$=sd.parentBone;se=s$.resultMatrix.a,sw=s$.resultMatrix.c,ss=s$.resultMatrix.b;var sO=1/(se*(sA=s$.resultMatrix.d)-sw*ss),sn=sl-s$.resultMatrix.tx,sV=sZ-s$.resultMatrix.ty,sQ=(sn*sA-sV*sw)*sO-sN,sg=(sV*se-sn*ss)*sO-sm,sF=((sn=sa-s$.resultMatrix.tx)*sA-(sV=sk-s$.resultMatrix.ty)*sw)*sO-sN,sE=(sV*se-sn*ss)*sO-sm,sI=Math.sqrt(sF*sF+sE*sE),sp=sL.length*st,sH=NaN,sX=NaN;if(sy){var sj=(sQ*sQ+sg*sg-sI*sI-(sp*=su)*sp)/(2*sI*sp);sj<-1?sj=-1:1<sj&&(sj=1),sX=Math.acos(sj)*sh,se=sI+sp*sj,sw=sp*Math.sin(sX),sH=Math.atan2(sg*se-sQ*sw,sQ*se+sg*sw)}else{var sR=(se=su*sp)*se,so=(sw=sx*sp)*sw,si=sQ*sQ+sg*sg,sS=Math.atan2(sg,sQ),sB=-2*so*sI,sC=so-sR;if(0<(sA=sB*sB-4*sC*(ss=so*sI*sI+sR*si-sR*so))){var sP=Math.sqrt(sA);sB<0&&(sP=-sP);var sT=(sP=-(sB+sP)/2)/sC,sz=ss/sP,sD=Math.abs(sT)<Math.abs(sz)?sT:sz;sD*sD<=si&&(sV=Math.sqrt(si-sD*sD)*sh,sH=sS-Math.atan2(sV,sD),sX=Math.atan2(sV/sx,(sD-sI)/su))}var sG=0,sK=Number.MAX_VALUE,sv=0,sJ=0,sf=0,sU=0,sW=0,sM=0;sU<(sA=(sn=sI+se)*sn)&&(sf=0,sU=sA,sW=sn),(sA=(sn=sI-se)*sn)<sK&&(sG=Math.PI,sK=sA,sv=sn);var sdd=Math.acos(-se*sI/(sR-so));(sA=(sn=se*Math.cos(sdd)+sI)*sn+(sV=sw*Math.sin(sdd))*sV)<sK&&(sG=sdd,sK=sA,sv=sn,sJ=sV),sU<sA&&(sf=sdd,sU=sA,sW=sn,sM=sV),sX=si<=(sK+sU)/2?(sH=sS-Math.atan2(sJ*sh,sv),sG*sh):(sH=sS-Math.atan2(sM*sh,sW),sf*sh)}var sLd=Math.atan2(sr,sc)*sY,sld=sd.resultTransform.skX;180<(sH=(sH-sLd)*sZd.radDeg+sb-sld)?sH-=360:sH<-180&&(sH+=360),sd.resultTransform.x=sN,sd.resultTransform.y=sm,sd.resultTransform.skX=sd.resultTransform.skY=sld+sH*s_,sld=sL.resultTransform.skX,180<(sX=((sX+sLd)*sZd.radDeg-0)*sY+sq-(sld%=360))?sX-=360:sX<-180&&(sX+=360),sL.resultTransform.x=sc,sL.resultTransform.y=sr,sL.resultTransform.skX=sL.resultTransform.skY=sL.resultTransform.skY+sX*s_,sd.update()}},sd._applyIk3=function(sd,sL,sl,sZ,sh,s_){if(0!=s_){var sN,sm,su=sL.resultMatrix.a*sL.length,sx=sL.resultMatrix.b*sL.length,st=su*su+sx*sx,sb=Math.sqrt(st),sq=sd.resultMatrix.tx,sY=sd.resultMatrix.ty,sc=sL.resultMatrix.tx,sr=sL.resultMatrix.ty,sa=sc-sq,sk=sr-sY,se=sa*sa+sk*sk,sw=Math.sqrt(se),ss=(sa=sl-sd.resultMatrix.tx)*sa+(sk=sZ-sd.resultMatrix.ty)*sk,sA=Math.sqrt(ss);if(sb+sw<=sA||sA+sb<=sw||sA+sw<=sb){var sy=NaN;sc=sq+(sy=sb+sw<=sA?1:-1)*(sl-sq)*sw/sA,sr=sY+sy*(sZ-sY)*sw/sA}else{var s$=(se-st+ss)/(2*ss),sO=Math.sqrt(se-s$*s$*ss)/sA,sn=sq+sa*s$,sV=sY+sk*s$,sQ=-sk*sO,sg=sa*sO;sr=0<sh?(sc=sn-sQ,sV-sg):(sc=sn+sQ,sV+sg)}sN=sc,sm=sr,this.isDebug&&(this._sp||(this._sp=new s_d,shd.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(sq,sY,15,"#ff00ff"),this._sp.graphics.drawCircle(sl,sZ,15,"#ffff00"),this._sp.graphics.drawCircle(sN,sm,15,"#ff00ff"));var sF,sE;sF=Math.atan2(sm-sd.resultMatrix.ty,sN-sd.resultMatrix.tx),sd.setRotation(sF),(sE=sZd._tempMatrix).identity(),sE.rotate(sF),sE.scale(sd.resultMatrix.getScaleX(),sd.resultMatrix.getScaleY()),sE.translate(sd.resultMatrix.tx,sd.resultMatrix.ty),sE.copyTo(sd.resultMatrix),sd.updateChild();var sI,sp;sI=Math.atan2(sZ-sm,sl-sN),sL.setRotation(sI),(sp=sZd._tempMatrix).identity(),sp.rotate(sI),sp.scale(sL.resultMatrix.getScaleX(),sL.resultMatrix.getScaleY()),sp.translate(sN,sm),sE.copyTo(sL.resultMatrix),sL.updateChild()}},sl(sZd,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new sEd}]),sZd}(),sSd=function(){function sd(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return sZ(sd,"laya.ani.bone.IkConstraintData"),sd}(),sA=function(){function sp(sd,sL){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=sd,this.position=sd.position,this.spacing=sd.spacing,this.rotateMix=sd.rotateMix,this.translateMix=sd.translateMix,this.bones=[];for(var sl=this.data.bones,sZ=0,sh=sl.length;sZ<sh;sZ++)this.bones.push(sL[sl[sZ]])}sZ(sp,"laya.ani.bone.PathConstraint");var sd=sp.prototype;return sd.apply=function(sd,sL){if(this.target){var sl=this.translateMix,sZ=this.translateMix,sh=0<sZ,s_=this.data.spacingMode,sN="length"==s_,sm=this.data.rotateMode,su="tangent"==sm,sx="chainScale"==sm,st=[],sb=this.bones.length,sq=su?sb:sb+1,sY=[];(this._spaces=sY)[0]=this.position;var sc=this.spacing;if(sx||sN)for(var sr=0,sa=sq-1;sr<sa;){var sk=this.bones[sr],se=sk.length,sw=se*sk.resultMatrix.a,ss=se*sk.resultMatrix.b;se=Math.sqrt(sw*sw+ss*ss),sx&&(st[sr]=se),sY[++sr]=sN?Math.max(0,se+sc):sc}else for(sr=1;sr<sq;sr++)sY[sr]=sc;var sA=this.computeWorldPositions(this.target,sd,sL,sq,su,"percent"==this.data.positionMode,"percent"==s_);if(this._debugKey){for(sr=0;sr<sA.length;sr++)sL.drawCircle(sA[sr++],sA[sr++],5,"#00ff00");var sy=[];for(sr=0;sr<sA.length;sr++)sy.push(sA[sr++],sA[sr++]);sL.drawLines(0,0,sy,"#ff0000")}var s$=sA[0],sO=sA[1],sn=this.data.offsetRotation,sV="chain"==sm&&0==sn,sQ=NaN;for(sr=0,sQ=3;sr<sb;sr++,sQ+=3){(sk=this.bones[sr]).resultMatrix.tx+=(s$-sk.resultMatrix.tx)*sl,sk.resultMatrix.ty+=(sO-sk.resultMatrix.ty)*sl;var sg=(sw=sA[sQ])-s$,sF=(ss=sA[sQ+1])-sO;if(sx&&0!=(se=st[sr])){var sE=(Math.sqrt(sg*sg+sF*sF)/se-1)*sZ+1;sk.resultMatrix.a*=sE,sk.resultMatrix.c*=sE}if(s$=sw,sO=ss,sh){var sI=sk.resultMatrix.a,sp=sk.resultMatrix.c,sH=sk.resultMatrix.b,sX=sk.resultMatrix.d,sj=NaN,sR=NaN,so=NaN;sj=su?sA[sQ-1]:0==sY[sr+1]?sA[sQ+2]:Math.atan2(sF,sg),sj-=Math.atan2(sH,sI)-sn/180*Math.PI,sV&&(sR=Math.cos(sj),so=Math.sin(sj),s$+=((se=sk.length)*(sR*sI-so*sH)-sg)*sZ,sO+=(se*(so*sI+sR*sH)-sF)*sZ),sj>Math.PI?sj-=2*Math.PI:sj<-Math.PI&&(sj+=2*Math.PI),sj*=sZ,sR=Math.cos(sj),so=Math.sin(sj),sk.resultMatrix.a=sR*sI-so*sH,sk.resultMatrix.c=sR*sp-so*sX,sk.resultMatrix.b=so*sI+sR*sH,sk.resultMatrix.d=so*sp+sR*sX}}}},sd.computeWorldVertices2=function(sd,sL,sl,sZ,sh,s_){var sN,sm,su=sd.currDisplayData.bones,sx=sd.currDisplayData.weights,st=sd.currDisplayData.triangles,sb=0,sq=0,sY=0,sc=0,sr=0,sa=0,sk=0,se=0,sw=0,ss=0,sA=0;if(null!=su){for(sb=0;sb<sl;sb+=2)sq+=(sc=su[sq])+1,sY+=sc;var sy=sL;for(sr=s_,sa=3*sY;sr<sZ;sr+=2){for(se=sk=0,sc=su[sq++],sc+=sq;sq<sc;sq++,sa+=3){sN=sy[su[sq]].resultMatrix,sw=sx[sa],ss=sx[sa+1];var s$=sx[sa+2];sk+=(sw*sN.a+ss*sN.c+sN.tx)*s$,se+=(sw*sN.b+ss*sN.d+sN.ty)*s$}sh[sr]=sk,sh[sr+1]=se}}else{var sO,sn;if(st||(st=sx),sd.deformData&&(st=sd.deformData),sO=sd.parent,sL)for(sA=sL.length,sb=0;sb<sA;sb++)if(sL[sb].name==sO){sm=sL[sb];break}sm&&(sn=sm.resultMatrix),sn||(sn=sp._tempMt);var sV=sn.tx,sQ=sn.ty,sg=sn.a,sF=sn.b,sE=sn.c,sI=sn.d;for(sm&&(sI*=sm.d),sq=sl,sr=s_;sr<sZ;sq+=2,sr+=2)sw=st[sq],ss=st[sq+1],sh[sr]=sw*sg+ss*sF+sV,sh[sr+1]=-(sw*sE+ss*sI+sQ)}},sd.computeWorldPositions=function(sd,sL,sl,sZ,sh,s_,sN){sd.currDisplayData.bones,sd.currDisplayData.weights,sd.currDisplayData.triangles;var sm=[],su=0,sx=sd.currDisplayData.verLen,st=this.position,sb=this._spaces,sq=[],sY=[],sc=sx/6,sr=-1,sa=NaN,sk=0,se=0,sw=NaN,ss=NaN,sA=NaN,sy=NaN;if(sc--,sx-=4,this.computeWorldVertices2(sd,sL,2,sx,sm,0),this._debugKey)for(su=0;su<sm.length;)sl.drawCircle(sm[su++],sm[su++],10,"#ff0000");sq=sm,this._curves.length=sc;var s$=this._curves,sO=sq[sa=0],sn=sq[1],sV=0,sQ=0,sg=0,sF=0,sE=0,sI=0,sp=NaN,sH=NaN,sX=NaN,sj=NaN,sR=NaN,so=NaN,si=NaN,sS=NaN,sB=0;for(su=0,sB=2;su<sc;su++,sB+=6)sV=sq[sB],sQ=sq[sB+1],sg=sq[sB+2],sF=sq[sB+3],sR=2*(sp=.1875*(sO-2*sV+sg))+(sX=.09375*(3*(sV-sg)-sO+(sE=sq[sB+4]))),so=2*(sH=.1875*(sn-2*sQ+sF))+(sj=.09375*(3*(sQ-sF)-sn+(sI=sq[sB+5]))),si=.75*(sV-sO)+sp+.16666667*sX,sS=.75*(sQ-sn)+sH+.16666667*sj,sa+=Math.sqrt(si*si+sS*sS),si+=sR,sS+=so,sR+=sX,so+=sj,sa+=Math.sqrt(si*si+sS*sS),si+=sR,sS+=so,sa+=Math.sqrt(si*si+sS*sS),si+=sR+sX,sS+=so+sj,sa+=Math.sqrt(si*si+sS*sS),s$[su]=sa,sO=sE,sn=sI;if(s_&&(st*=sa),sN)for(su=0;su<sZ;su++)sb[su]*=sa;var sC=this._segments,sP=0,sT=0;for(sT=se=sk=su=0;su<sZ;su++,sk+=3)if((sw=st+=ss=sb[su])<0)this.addBeforePosition(sw,sq,0,sY,sk);else if(sa<sw)this.addAfterPosition(sw-sa,sq,sx-4,sY,sk);else{for(;;se++)if(!((sy=s$[se])<sw)){0==se?sw/=sy:sw=(sw-(sA=s$[se-1]))/(sy-sA);break}if(se!=sr){var sz=6*(sr=se);for(sO=sq[sz],sn=sq[sz+1],sV=sq[sz+2],sQ=sq[sz+3],sg=sq[sz+4],sF=sq[sz+5],sR=2*(sp=.03*(sO-2*sV+sg))+(sX=.006*(3*(sV-sg)-sO+(sE=sq[sz+6]))),so=2*(sH=.03*(sn-2*sQ+sF))+(sj=.006*(3*(sQ-sF)-sn+(sI=sq[sz+7]))),si=.3*(sV-sO)+sp+.16666667*sX,sS=.3*(sQ-sn)+sH+.16666667*sj,sP=Math.sqrt(si*si+sS*sS),sC[0]=sP,sz=1;sz<8;sz++)si+=sR,sS+=so,sR+=sX,so+=sj,sP+=Math.sqrt(si*si+sS*sS),sC[sz]=sP;si+=sR,sS+=so,sP+=Math.sqrt(si*si+sS*sS),sC[8]=sP,si+=sR+sX,sS+=so+sj,sP+=Math.sqrt(si*si+sS*sS),sC[9]=sP,sT=0}for(sw*=sP;;sT++)if(!((sy=sC[sT])<sw)){0==sT?sw/=sy:sw=sT+(sw-(sA=sC[sT-1]))/(sy-sA);break}this.addCurvePosition(.1*sw,sO,sn,sV,sQ,sg,sF,sE,sI,sY,sk,sh||0<su&&0==ss)}return sY},sd.addBeforePosition=function(sd,sL,sl,sZ,sh){var s_=sL[sl],sN=sL[sl+1],sm=sL[sl+2]-s_,su=sL[sl+3]-sN,sx=Math.atan2(su,sm);sZ[sh]=s_+sd*Math.cos(sx),sZ[sh+1]=sN+sd*Math.sin(sx),sZ[sh+2]=sx},sd.addAfterPosition=function(sd,sL,sl,sZ,sh){var s_=sL[sl+2],sN=sL[sl+3],sm=s_-sL[sl],su=sN-sL[sl+1],sx=Math.atan2(su,sm);sZ[sh]=s_+sd*Math.cos(sx),sZ[sh+1]=sN+sd*Math.sin(sx),sZ[sh+2]=sx},sd.addCurvePosition=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st,sb){0==sd&&(sd=1e-4);var sq=sd*sd,sY=sq*sd,sc=1-sd,sr=sc*sc,sa=sr*sc,sk=sc*sd,se=3*sk,sw=sc*se,ss=se*sd,sA=sL*sa+sZ*sw+s_*ss+sm*sY,sy=sl*sa+sh*sw+sN*ss+su*sY;sx[st]=sA,sx[st+1]=sy,sx[st+2]=sb?Math.atan2(sy-(sl*sr+sh*sk*2+sN*sq),sA-(sL*sr+sZ*sk*2+s_*sq)):0},sp.NONE=-1,sp.BEFORE=-2,sp.AFTER=-3,sl(sp,["_tempMt",function(){return this._tempMt=new sEd}]),sp}(),sBd=function(){function sd(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return sZ(sd,"laya.ani.bone.PathConstraintData"),sd}(),sCd=function(){function sd(){this.name=null,this.slotArr=[]}return sZ(sd,"laya.ani.bone.SkinData"),sd}(),sPd=function(){function sd(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}sZ(sd,"laya.ani.bone.SkinSlotDisplayData");var sL=sd.prototype;return sL.createTexture=function(sd){return this.texture||(this.texture=new sId(sd.bitmap,this.uvs),sd.bitmap.alphaTexture&&(this.texture.alphaTexture=new sId(sd.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=sd.height,this.texture.height=sd.width,this.texture.offsetX=-sd.offsetX,this.texture.offsetY=-sd.offsetY,this.texture.sourceWidth=sd.sourceHeight,this.texture.sourceHeight=sd.sourceWidth):(this.texture.width=sd.width,this.texture.height=sd.height,this.texture.offsetX=-sd.offsetX,this.texture.offsetY=-sd.offsetY,this.texture.sourceWidth=sd.sourceWidth,this.texture.sourceHeight=sd.sourceHeight),sa.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},sL.destory=function(){this.texture&&this.texture.destroy()},sd}(),sTd=function(){function sd(){this.name=null,this.displayArr=[]}return sZ(sd,"laya.ani.bone.SlotData"),sd.prototype.getDisplayByName=function(sd){for(var sL=0,sl=this.displayArr.length;sL<sl;sL++)if(this.displayArr[sL].attachmentName==sd)return sL;return-1},sd}(),sy=function(){function sd(sd,sL){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=sr(2,0),this._data=sd,null==this._bones&&(this._bones=[]),this.target=sL[sd.targetIndex];var sl,sZ=0;for(sZ=0,sl=sd.boneIndexs.length;sZ<sl;sZ++)this._bones.push(sL[sd.boneIndexs[sZ]]);this.rotateMix=sd.rotateMix,this.translateMix=sd.translateMix,this.scaleMix=sd.scaleMix,this.shearMix=sd.shearMix}return sZ(sd,"laya.ani.bone.TfConstraint"),sd.prototype.apply=function(){for(var sd,sL=this.target.resultMatrix.a,sl=this.target.resultMatrix.b,sZ=this.target.resultMatrix.c,sh=this.target.resultMatrix.d,s_=0,sN=this._bones.length;s_<sN;s_++){if(sd=this._bones[s_],0<this.rotateMix){var sm=sd.resultMatrix.a,su=sd.resultMatrix.b,sx=sd.resultMatrix.c,st=sd.resultMatrix.d,sb=Math.atan2(sZ,sL)-Math.atan2(sx,sm)+this._data.offsetRotation*Math.PI/180;sb>Math.PI?sb-=2*Math.PI:sb<-Math.PI&&(sb+=2*Math.PI),sb*=this.rotateMix;var sq=Math.cos(sb),sY=Math.sin(sb);sd.resultMatrix.a=sq*sm-sY*sx,sd.resultMatrix.b=sq*su-sY*st,sd.resultMatrix.c=sY*sm+sq*sx,sd.resultMatrix.d=sY*su+sq*st}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),sd.resultMatrix.tx+=(this._temp[0]-sd.resultMatrix.tx)*this.translateMix,sd.resultMatrix.ty+=(this._temp[1]-sd.resultMatrix.ty)*this.translateMix,sd.updateChild()),0<this.scaleMix){var sc=Math.sqrt(sd.resultMatrix.a*sd.resultMatrix.a+sd.resultMatrix.c*sd.resultMatrix.c),sr=Math.sqrt(sL*sL+sZ*sZ),sa=1e-5<sc?(sc+(sr-sc+this._data.offsetScaleX)*this.scaleMix)/sc:0;sd.resultMatrix.a*=sa,sd.resultMatrix.c*=sa,sc=Math.sqrt(sd.resultMatrix.b*sd.resultMatrix.b+sd.resultMatrix.d*sd.resultMatrix.d),sr=Math.sqrt(sl*sl+sh*sh),sa=1e-5<sc?(sc+(sr-sc+this._data.offsetScaleY)*this.scaleMix)/sc:0,sd.resultMatrix.b*=sa,sd.resultMatrix.d*=sa}if(0<this.shearMix){su=sd.resultMatrix.b,st=sd.resultMatrix.d;var sk=Math.atan2(st,su);(sb=Math.atan2(sh,sl)-Math.atan2(sZ,sL)-(sk-Math.atan2(sd.resultMatrix.c,sd.resultMatrix.a)))>Math.PI?sb-=2*Math.PI:sb<-Math.PI&&(sb+=2*Math.PI),sb=sk+(sb+this._data.offsetShearY*Math.PI/180)*this.shearMix,sa=Math.sqrt(su*su+st*st),sd.resultMatrix.b=Math.cos(sb)*sa,sd.resultMatrix.d=Math.sin(sb)*sa}}},sd}(),szd=function(){function sd(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return sZ(sd,"laya.ani.bone.TfConstraintData"),sd}(),sDd=function(){function sd(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}sZ(sd,"laya.ani.bone.Transform");var sL=sd.prototype;return sL.initData=function(sd){null!=sd.x&&(this.x=sd.x),null!=sd.y&&(this.y=sd.y),null!=sd.skX&&(this.skX=sd.skX),null!=sd.skY&&(this.skY=sd.skY),null!=sd.scX&&(this.scX=sd.scX),null!=sd.scY&&(this.scY=sd.scY)},sL.getMatrix=function(){var sd;return(sd=this.mMatrix?this.mMatrix:this.mMatrix=new sEd).identity(),sd.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(sd,this.skewX*Math.PI/180,this.skewY*Math.PI/180),sd.rotate(this.skX*Math.PI/180),sd.translate(this.x,this.y),sd},sL.skew=function(sd,sL,sl){var sZ=Math.sin(sl),sh=Math.cos(sl),s_=Math.sin(sL),sN=Math.cos(sL);return sd.setTo(sd.a*sN-sd.b*sZ,sd.a*s_+sd.b*sh,sd.c*sN-sd.d*sZ,sd.c*s_+sd.d*sh,sd.tx*sN-sd.ty*sZ,sd.tx*s_+sd.ty*sh),sd},sd}(),s$=function(){function sd(){}return sZ(sd,"laya.ani.bone.UVTools"),sd.getRelativeUV=function(sd,sL,sl){var sZ=sd[0],sh=sd[2]-sd[0],s_=sd[1],sN=sd[5]-sd[1];sl||(sl=[]),sl.length=sL.length;var sm,su=0;sm=sl.length;var sx=1/sh,st=1/sN;for(su=0;su<sm;su+=2)sl[su]=(sL[su]-sZ)*sx,sl[su+1]=(sL[su+1]-s_)*st;return sl},sd.getAbsoluteUV=function(sd,sL,sl){if(0==sd[0]&&0==sd[1]&&1==sd[4]&&1==sd[5])return sl?(sk.copyArray(sl,sL),sl):sL;var sZ=sd[0],sh=sd[2]-sd[0],s_=sd[1],sN=sd[5]-sd[1];sl||(sl=[]),sl.length=sL.length;var sm,su=0;for(sm=sl.length,su=0;su<sm;su+=2)sl[su]=sL[su]*sh+sZ,sl[su+1]=sL[su+1]*sN+s_;return sl},sd}(),sp=function(){function sd(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return sZ(sd,"laya.ani.KeyFramesContent"),sd}(),sO=function(){function st(){}return sZ(st,"laya.ani.math.BezierLerp"),st.getBezierRate=function(sd,sL,sl,sZ,sh){var s_=st._getBezierParamKey(sL,sl,sZ,sh),sN=100*s_+sd;if(st._bezierResultCache[sN])return st._bezierResultCache[sN];var sm,su=st._getBezierPoints(sL,sl,sZ,sh,s_),sx=0;for(sm=su.length,sx=0;sx<sm;sx+=2)if(sd<=su[sx])return st._bezierResultCache[sN]=su[sx+1],su[sx+1];return st._bezierResultCache[sN]=1},st._getBezierParamKey=function(sd,sL,sl,sZ){return 100*(100*(100*(100*sd+sL)+sl)+sZ)},st._getBezierPoints=function(sd,sL,sl,sZ,sh){return st._bezierPointsCache[sh]?st._bezierPointsCache[sh]:(s_=[0,0,sd,sL,sl,sZ,1,1],sN=(new sm).getBezierPoints(s_,100,3),st._bezierPointsCache[sh]=sN);var s_,sN},st._bezierResultCache={},st._bezierPointsCache={},st}(),sn=function(sd){function sL(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,sL.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}sZ(sL,"laya.ani.AnimationPlayer",sh);var sl=sL.prototype;return shd.imps(sl,{"laya.resource.IDestroy":!0}),sl._onTempletLoadedComputeFullKeyframeIndices=function(sd,sL,sl){this._templet===sl&&this._cachePlayRate===sd&&this._cacheFrameRate===sL&&this._computeFullKeyframeIndices()},sl._computeFullKeyframeIndices=function(){for(var sd=this._fullFrames=[],sL=this._templet,sl=this._cacheFrameRateInterval*this._cachePlayRate,sZ=0,sh=sL.getAnimationCount();sZ<sh;sZ++){for(var s_=[],sN=0,sm=sL.getAnimation(sZ).nodes.length;sN<sm;sN++){for(var su=sL.getAnimation(sZ).nodes[sN],sx=Math.floor(su.playTime/sl+.01),st=new Uint16Array(sx+1),sb=-1,sq=0,sY=su.keyFrame.length;sq<sY;sq++){var sc=su.keyFrame[sq],sr=sc.startTime,sa=sr+sc.duration+sl;do{for(var sk=Math.floor(sr/sl+.5),se=sb+1;se<sk;se++)st[se]=sq;st[sb=sk]=sq,sr+=sl}while(sr<=sa)}s_.push(st)}sd.push(s_)}},sl._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},sl._calculatePlayDuration=function(){if(0!==this.state){var sd=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=sd),this._playEnd>sd&&(this._playEnd=sd),this._playDuration=this._playEnd-this._playStart}},sl._setPlayParams=function(sd,sL){this._currentTime=sd,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/sL+.01),0),this._currentFrameTime=this._currentKeyframeIndex*sL},sl._setPlayParamsWhenStop=function(sd,sL){this._currentTime=sd,this._currentKeyframeIndex=Math.max(Math.floor(sd/sL+.01),0),this._currentFrameTime=this._currentKeyframeIndex*sL,this._currentAnimationClipIndex=-1},sl._update=function(sd){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var sL=this._cacheFrameRateInterval*this._cachePlayRate,sl=0;this._startUpdateLoopCount!==sc.loopCount&&(sl=sd*this.playbackRate,this._elapsedPlaybackTime+=sl);var sZ=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=sZ)return this._setPlayParamsWhenStop(sZ,sL),void this.event("stopped");if(sl+=this._currentTime,0<sZ)if(sZ<=sl)do{if(sl-=sZ,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(sZ,sL),this._stopWhenCircleFinish=!1,void this.event("stopped");sl<sZ&&(this._setPlayParams(sl,sL),this.event("complete"))}while(sZ<=sl);else this._setPlayParams(sl,sL);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(sZ,sL),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},sl._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},sl.play=function(sd,sL,sl,sZ,sh){if(void 0===sd&&(sd=0),void 0===sL&&(sL=1),void 0===sl&&(sl=2147483647),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(sl<0||sZ<0||sh<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==sh&&sh<sZ)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=sL,this._overallDuration=sl,this._playStart=sZ,this._playEnd=sh,this._paused=!1,this._currentAnimationClipIndex=sd,this._currentKeyframeIndex=0,this._startUpdateLoopCount=sc.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},sl.playByFrame=function(sd,sL,sl,sZ,sh,s_){void 0===sd&&(sd=0),void 0===sL&&(sL=1),void 0===sl&&(sl=2147483647),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===s_&&(s_=30);var sN=1e3/s_;this.play(sd,sL,sl,sZ*sN,sh*sN)},sl.stop=function(sd){void 0===sd&&(sd=!0),sd?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},s_(0,sl,"playEnd",function(){return this._playEnd}),s_(0,sl,"templet",function(){return this._templet},function(sd){0===!this.state&&this.stop(!0),this._templet!==sd&&((this._templet=sd).loaded?this._computeFullKeyframeIndices():sd.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),s_(0,sl,"playStart",function(){return this._playStart}),s_(0,sl,"playDuration",function(){return this._playDuration}),s_(0,sl,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),s_(0,sl,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),s_(0,sl,"overallDuration",function(){return this._overallDuration}),s_(0,sl,"currentFrameTime",function(){return this._currentFrameTime}),s_(0,sl,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),s_(0,sl,"currentPlayTime",function(){return this._currentTime+this._playStart}),s_(0,sl,"cachePlayRate",function(){return this._cachePlayRate},function(sd){this._cachePlayRate!==sd&&(this._cachePlayRate=sd,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[sd,this._cacheFrameRate])))}),s_(0,sl,"cacheFrameRate",function(){return this._cacheFrameRate},function(sd){this._cacheFrameRate!==sd&&(this._cacheFrameRate=sd,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,sd])))}),s_(0,sl,"currentTime",null,function(sd){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(sd<this._playStart||sd>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=sc.loopCount;var sL=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=sd,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/sL),0),this._currentFrameTime=this._currentKeyframeIndex*sL}}),s_(0,sl,"paused",function(){return this._paused},function(sd){(this._paused=sd)&&this.event("paused")}),s_(0,sl,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),s_(0,sl,"destroyed",function(){return this._destroyed}),sL}(),sH=function(sd){function sL(){sL.__super.call(this),sa.isConchNode&&(this.drawSkin=function(sd){sd.transform||(sd.transform=sEd.EMPTY),this._addCmd([sd]),this.setSkinMesh&&this.setSkinMesh(sd._ps,sd.mVBData,sd.mEleNum,0,sd.mTexture,sd.transform)})}return sZ(sL,"laya.ani.GraphicsAni",sN),sL.prototype.drawSkin=function(sd){var sL=[sd];this._saveToCmd(sa._context._drawSkin,sL)},sL.create=function(){return sL._caches.pop()||new sL},sL.recycle=function(sd){sd.clear(),sL._caches.push(sd)},sL._caches=[],sL}(),sX=function(sd){function se(){this._aniMap={},this.unfixedLastAniIndex=-1,se.__super.call(this),this._anis=new Array}sZ(se,"laya.ani.AnimationTemplet",st);var sL=se.prototype;return sL.parse=function(sd){var sL=new sFd(sd);this._aniVersion=sL.readUTFString(),sw.parse(this,sL)},sL._calculateKeyFrame=function(sd,sL,sl){var sZ=sd.keyFrame;sZ[sL]=sZ[0];for(var sh=0;sh<sL;sh++){var s_=sZ[sh];s_.nextData=0===s_.duration?s_.data:sZ[sh+1].data}sZ.length--},sL.onAsynLoaded=function(sd,sL,sl){var sZ=new sFd(sL);switch(this._aniVersion=sZ.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":ss.parse(this,sZ);break;default:sw.parse(this,sZ)}this._endLoaded()},sL.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},sL.getAnimationCount=function(){return this._anis.length},sL.getAnimation=function(sd){return this._anis[sd]},sL.getAniDuration=function(sd){return this._anis[sd].playTime},sL.getNodes=function(sd){return this._anis[sd].nodes},sL.getNodeIndexWithName=function(sd,sL){return this._anis[sd].bone3DMap[sL]},sL.getNodeCount=function(sd){return this._anis[sd].nodes.length},sL.getTotalkeyframesLength=function(sd){return this._anis[sd].totalKeyframeDatasLength},sL.getPublicExtData=function(){return this._publicExtData},sL.getAnimationDataWithCache=function(sd,sL,sl,sZ){var sh=sL[sl];if(sh){var s_=sh[sd];return s_?s_[sZ]:null}return null},sL.setAnimationDataWithCache=function(sd,sL,sl,sZ,sh){var s_=sL[sl]||(sL[sl]={});(s_[sd]||(s_[sd]=[]))[sZ]=sh},sL.getOriginalData=function(sd,sL,sl,sZ,sh){for(var s_=this._anis[sd].nodes,sN=0,sm=0,su=s_.length,sx=0;sm<su;sm++){var st,sb=s_[sm];st=sb.keyFrame[sl[sm][sZ]],sb.dataOffset=sx;var sq=sh-st.startTime,sY=sb.lerpType;if(sY)switch(sY){case 0:case 1:for(sN=0;sN<sb.keyframeWidth;)sN+=sb.interpolationMethod[sN](sb,sN,sL,sx+sN,st.data,sq,null,st.duration,st.nextData);break;case 2:var sc=st.interpolationData,sr=sc.length,sa=0;for(sN=0;sN<sr;){var sk=sc[sN];switch(sk){case 6:case 7:sN+=se.interpolation[sk](sb,sa,sL,sx+sa,st.data,sq,null,st.duration,st.nextData,sc,sN+1);break;default:sN+=se.interpolation[sk](sb,sa,sL,sx+sa,st.data,sq,null,st.duration,st.nextData)}sa++}}else for(sN=0;sN<sb.keyframeWidth;)sN+=sb.interpolationMethod[sN](sb,sN,sL,sx+sN,st.data,sq,null,st.duration,st.nextData);sx+=sb.keyframeWidth}},sL.getNodesCurrentFrameIndex=function(sd,sL){var sl=this._anis[sd].nodes;sd!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(sl.length),this.unfixedCurrentTimes=new Float32Array(sl.length),this.unfixedLastAniIndex=sd);for(var sZ=0,sh=sl.length;sZ<sh;sZ++){var s_=sl[sZ];for(sL<this.unfixedCurrentTimes[sZ]&&(this.unfixedCurrentFrameIndexes[sZ]=0),this.unfixedCurrentTimes[sZ]=sL;this.unfixedCurrentFrameIndexes[sZ]<s_.keyFrame.length&&!(s_.keyFrame[this.unfixedCurrentFrameIndexes[sZ]].startTime>this.unfixedCurrentTimes[sZ]);)this.unfixedCurrentFrameIndexes[sZ]++;this.unfixedCurrentFrameIndexes[sZ]--}return this.unfixedCurrentFrameIndexes},sL.getOriginalDataUnfixedRate=function(sd,sL,sl){var sZ=this._anis[sd].nodes;sd!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(sZ.length),this.unfixedCurrentTimes=new Float32Array(sZ.length),this.unfixedKeyframes=sr(sZ.length),this.unfixedLastAniIndex=sd);for(var sh=0,s_=0,sN=sZ.length,sm=0;s_<sN;s_++){var su=sZ[s_];for(sl<this.unfixedCurrentTimes[s_]&&(this.unfixedCurrentFrameIndexes[s_]=0),this.unfixedCurrentTimes[s_]=sl;this.unfixedCurrentFrameIndexes[s_]<su.keyFrame.length&&!(su.keyFrame[this.unfixedCurrentFrameIndexes[s_]].startTime>this.unfixedCurrentTimes[s_]);)this.unfixedKeyframes[s_]=su.keyFrame[this.unfixedCurrentFrameIndexes[s_]],this.unfixedCurrentFrameIndexes[s_]++;var sx=this.unfixedKeyframes[s_];su.dataOffset=sm;var st=sl-sx.startTime;if(su.lerpType)switch(su.lerpType){case 0:case 1:for(sh=0;sh<su.keyframeWidth;)sh+=su.interpolationMethod[sh](su,sh,sL,sm+sh,sx.data,st,null,sx.duration,sx.nextData);break;case 2:var sb=sx.interpolationData,sq=sb.length,sY=0;for(sh=0;sh<sq;){var sc=sb[sh];switch(sc){case 6:case 7:sh+=se.interpolation[sc](su,sY,sL,sm+sY,sx.data,st,null,sx.duration,sx.nextData,sb,sh+1);break;default:sh+=se.interpolation[sc](su,sY,sL,sm+sY,sx.data,st,null,sx.duration,sx.nextData)}sY++}}else for(sh=0;sh<su.keyframeWidth;)sh+=su.interpolationMethod[sh](su,sh,sL,sm+sh,sx.data,st,null,sx.duration,sx.nextData);sm+=su.keyframeWidth}},se._LinearInterpolation_0=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){var st=0===sm?0:s_/sm;return sl[sZ]=(1-st)*sh[sL]+st*su[sL],1},se._QuaternionInterpolation_1=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){var st=0===sm?0:s_/sm;return sq.slerpQuaternionArray(sh,sL,su,sL,st,sl,sZ),4},se._AngleInterpolation_2=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){return 0},se._RadiansInterpolation_3=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){return 0},se._Matrix4x4Interpolation_4=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){for(var st=0;st<16;st++,sL++)sl[sZ+st]=sh[sL]+s_*sN[sL];return 16},se._NoInterpolation_5=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx){return sl[sZ]=sh[sL],1},se._BezierInterpolation_6=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st){return void 0===st&&(st=0),sl[sZ]=sh[sL]+(su[sL]-sh[sL])*sO.getBezierRate(s_/sm,sx[st],sx[st+1],sx[st+2],sx[st+3]),5},se._BezierInterpolation_7=function(sd,sL,sl,sZ,sh,s_,sN,sm,su,sx,st){return void 0===st&&(st=0),sl[sZ]=sx[st+4]+sx[st+5]*sO.getBezierRate((.001*s_+sx[st+6])/sx[st+7],sx[st],sx[st+1],sx[st+2],sx[st+3]),9},se.load=function(sd){return shd.loader.create(sd,null,null,se)},se.interpolation=[se._LinearInterpolation_0,se._QuaternionInterpolation_1,se._AngleInterpolation_2,se._RadiansInterpolation_3,se._Matrix4x4Interpolation_4,se._NoInterpolation_5,se._BezierInterpolation_6,se._BezierInterpolation_7],se}(),sV=function(sL){function sl(sd,sL){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,sl.__super.call(this),void 0===sL&&(sL=0),sd&&this.init(sd,sL)}sZ(sl,"laya.ani.bone.Skeleton",sL);var sd=sl.prototype;return sd.init=function(sd,sL){void 0===sL&&(sL=0);var sl,sZ,sh,s_=0,sN=0;if(1==sL)for(this._graphicsCache=[],s_=0,sN=sd.getAnimationCount();s_<sN;s_++)this._graphicsCache.push([]);if(this._yReverseMatrix=sd.yReverseMatrix,this._aniMode=sL,this._templet=sd,this._player=new sn,this._player.cacheFrameRate=sd.rate,this._player.templet=sd,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=sd.mBoneArr,this._rootBone=sd.mRootBone,this._aniSectionDic=sd.aniSectionDic,0<sd.ikArr.length)for(this._ikArr=[],s_=0,sN=sd.ikArr.length;s_<sN;s_++)this._ikArr.push(new se(sd.ikArr[s_],this._boneList));if(0<sd.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),s_=0,sN=sd.pathArr.length;s_<sN;s_++)sl=sd.pathArr[s_],sZ=new sA(sl,this._boneList),(sh=this._boneSlotDic[sl.name])&&((sZ=new sA(sl,this._boneList)).target=sh),this._pathDic[sl.name]=sZ;if(0<sd.tfArr.length)for(this._tfArr=[],s_=0,sN=sd.tfArr.length;s_<sN;s_++)this._tfArr.push(new sy(sd.tfArr[s_],this._boneList));if(0<sd.skinDataArray.length){var sm=this._templet.skinDataArray[this._skinIndex];this._skinName=sm.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},sd.load=function(sd,sL,sl){},sd._onLoaded=function(){},sd._parseComplete=function(){var sd=sQ.TEMPLET_DICTIONARY[this._aniPath];sd&&(this.init(sd,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},sd._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},sd._onPlay=function(){this.event("played")},sd._onStop=function(){var sd,sL=this._templet.eventAniArr[this._aniClipIndex];if(sL&&this._eventIndex<sL.length)for(;this._eventIndex<sL.length;this._eventIndex++)(sd=sL[this._eventIndex]).time>=this._player.playStart&&sd.time<=this._player.playEnd&&this.event("label",sd);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},sd._onPause=function(){this.event("paused")},sd._parseSrcBoneMatrix=function(){var sd=0,sL=0;for(sL=this._templet.srcBoneMatrixArr.length,sd=0;sd<sL;sd++)this._boneMatrixArray.push(new sEd);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var sl,sZ,sh=this._templet.boneSlotArray;for(sd=0,sL=sh.length;sd<sL;sd++)sl=sh[sd],null==(sZ=this._bindBoneBoneSlotDic[sl.parent])&&(this._bindBoneBoneSlotDic[sl.parent]=sZ=[]),this._boneSlotDic[sl.name]=sl=sl.copy(),sZ.push(sl),this._boneSlotArray.push(sl)}},sd._emitMissedEvents=function(sd,sL,sl){void 0===sl&&(sl=0);var sZ=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(sZ){var sh,s_,sN=0;for(sh=sZ.length,sN=sl;sN<sh;sN++)(s_=sZ[sN]).time>=this._player.playStart&&s_.time<=this._player.playEnd&&this.event("label",s_)}},sd._update=function(sd){if(void 0===sd&&(sd=!0),!(this._pause||sd&&this._indexControl)){var sL=this.timer.currTimer,sl=this._player.currentKeyframeIndex,sZ=sL-this._lastTime;if(sd?this._player._update(sZ):sl=-1,this._lastTime=sL,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<sZ&&this._clipIndex==sl&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var sh;this._lastUpdateAniClipIndex=this._aniClipIndex,sl>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var s_,sN=this._templet.eventAniArr[this._aniClipIndex];if(sN&&this._eventIndex<sN.length&&((sh=sN[this._eventIndex]).time>=this._player.playStart&&sh.time<=this._player.playEnd?this._player.currentPlayTime>=sh.time&&(this.event("label",sh),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(s_=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=s_&&(this.graphics=s_));var sm=0,su=0;for(su=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,su-1)&&0<su;)su--;if(su<this._clipIndex)for(sm=su;sm<this._clipIndex;sm++)this._createGraphics(sm)}else if(1==this._aniMode){if(s_=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=s_&&(this.graphics=s_));for(su=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,su-1)&&0<su;)su--;if(su<this._clipIndex)for(sm=su;sm<this._clipIndex;sm++)this._createGraphics(sm)}this._createGraphics()}}},sd._createGraphics=function(sd){void 0===sd&&(sd=-1),-1==sd&&(sd=this._clipIndex);var sL,sl,sZ=sd*this._player.cacheFrameRateInterval,sh=this._templet.drawOrderAniArr[this._aniClipIndex];if(sh&&0<sh.length)for(this._drawOrderIndex=0,sL=sh[this._drawOrderIndex];sZ>=sL.time&&(this._drawOrder=sL.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=sh.length));)sL=sh[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=sH.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=sH.create(),sl=this.graphics;var s_=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],sd,sZ);var sN,sm,su,sx,st=this._aniSectionDic[this._aniClipIndex],sb=0,sq=0,sY=0,sc=0,sr=0,sa=this._templet.srcBoneMatrixArr.length;for(sr=st[sq=0];sq<sa;sq++)sx=this._boneList[sq],su=this._templet.srcBoneMatrixArr[sq],sx.resultTransform.scX=su.scX*this._curOriginalData[sb++],sx.resultTransform.skX=su.skX+this._curOriginalData[sb++],sx.resultTransform.skY=su.skY+this._curOriginalData[sb++],sx.resultTransform.scY=su.scY*this._curOriginalData[sb++],sx.resultTransform.x=su.x+this._curOriginalData[sb++],sx.resultTransform.y=su.y+this._curOriginalData[sb++],8===this._templet.tMatrixDataLen&&(sx.resultTransform.skewX=su.skewX+this._curOriginalData[sb++],sx.resultTransform.skewY=su.skewY+this._curOriginalData[sb++]);var sk,se={},sw={};for(sr+=st[1];sq<sr;sq++)se[(sk=s_[sq]).name]=this._curOriginalData[sb++],sw[sk.name]=this._curOriginalData[sb++],this._curOriginalData[sb++],this._curOriginalData[sb++],this._curOriginalData[sb++],this._curOriginalData[sb++];var ss,sA,sy={},s$={};for(sr+=st[2];sq<sr;sq++)sy[(sk=s_[sq]).name]=this._curOriginalData[sb++],s$[sk.name]=this._curOriginalData[sb++],this._curOriginalData[sb++],this._curOriginalData[sb++],this._curOriginalData[sb++],this._curOriginalData[sb++];if(this._pathDic)for(sr+=st[3];sq<sr;sq++){if(sk=s_[sq],ss=this._pathDic[sk.name])switch(new sFd(sk.extenData).getByte()){case 1:ss.position=this._curOriginalData[sb++];break;case 2:ss.spacing=this._curOriginalData[sb++];break;case 3:ss.rotateMix=this._curOriginalData[sb++],ss.translateMix=this._curOriginalData[sb++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(sEd.TEMP.identity()),this._ikArr)for(sq=0,sr=this._ikArr.length;sq<sr;sq++)sA=this._ikArr[sq],sy.hasOwnProperty(sA.name)&&(sA.bendDirection=sy[sA.name]),s$.hasOwnProperty(sA.name)&&(sA.mix=s$[sA.name]),sA.apply();if(this._pathDic)for(var sO in this._pathDic)(ss=this._pathDic[sO]).apply(this._boneList,sl);if(this._tfArr)for(sq=0,sc=this._tfArr.length;sq<sc;sq++)this._tfArr[sq].apply();for(sq=0,sc=this._boneList.length;sq<sc;sq++)if(sx=this._boneList[sq],sm=this._bindBoneBoneSlotDic[sx.name],sx.resultMatrix.copyTo(this._boneMatrixArray[sq]),sm)for(sY=0,sr=sm.length;sY<sr;sY++)(sN=sm[sY])&&sN.setParentMatrix(sx.resultMatrix);var sn,sV,sQ,sg,sF={},sE=this._templet.deformAniArr;if(sE&&0<sE.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,sq=0,sr=this._boneSlotArray.length;sq<sr;sq++)(sN=this._boneSlotArray[sq]).deformData=null;var sI,sp=sE[this._aniClipIndex];for(sI in sn=sp.default,this._setDeform(sn,sF,this._boneSlotArray,sZ),sp)"default"!=sI&&sI!=this._skinName&&(sn=sp[sI],this._setDeform(sn,sF,this._boneSlotArray,sZ));sn=sp[this._skinName],this._setDeform(sn,sF,this._boneSlotArray,sZ)}if(this._drawOrder)for(sq=0,sr=this._drawOrder.length;sq<sr;sq++)sV=se[(sN=this._boneSlotArray[this._drawOrder[sq]]).name],sQ=sw[sN.name],isNaN(sQ)||(sl.save(),sl.alpha(sQ)),isNaN(sV)||-2==sV||(this._templet.attachmentNames?sN.showDisplayByName(this._templet.attachmentNames[sV]):sN.showDisplayByIndex(sV)),sF[this._drawOrder[sq]]?(sg=sF[this._drawOrder[sq]],sN.currDisplayData&&sg[sN.currDisplayData.attachmentName]?sN.deformData=sg[sN.currDisplayData.attachmentName]:sN.deformData=null):sN.deformData=null,isNaN(sQ)?sN.draw(sl,this._boneMatrixArray,2==this._aniMode):sN.draw(sl,this._boneMatrixArray,2==this._aniMode,sQ),isNaN(sQ)||sl.restore();else for(sq=0,sr=this._boneSlotArray.length;sq<sr;sq++)sV=se[(sN=this._boneSlotArray[sq]).name],sQ=sw[sN.name],isNaN(sQ)||(sl.save(),sl.alpha(sQ)),isNaN(sV)||-2==sV||(this._templet.attachmentNames?sN.showDisplayByName(this._templet.attachmentNames[sV]):sN.showDisplayByIndex(sV)),sF[sq]?(sg=sF[sq],sN.currDisplayData&&sg[sN.currDisplayData.attachmentName]?sN.deformData=sg[sN.currDisplayData.attachmentName]:sN.deformData=null):sN.deformData=null,isNaN(sQ)?sN.draw(sl,this._boneMatrixArray,2==this._aniMode):sN.draw(sl,this._boneMatrixArray,2==this._aniMode,sQ),isNaN(sQ)||sl.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,sd,sl):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,sd,sl)},sd._setDeform=function(sd,sL,sl,sZ){if(sd){var sh,s_,sN,sm=0,su=0,sx=0;if(sd)for(sm=0,su=sd.deformSlotDataList.length;sm<su;sm++)for(sh=sd.deformSlotDataList[sm],sx=0;sx<sh.deformSlotDisplayList.length;sx++)sN=sl[(s_=sh.deformSlotDisplayList[sx]).slotIndex],s_.apply(sZ,sN),sL[s_.slotIndex]||(sL[s_.slotIndex]={}),sL[s_.slotIndex][s_.attachment]=s_.deformData}},sd.getAnimNum=function(){return this._templet.getAnimationCount()},sd.getAniNameByIndex=function(sd){return this._templet.getAniNameByIndex(sd)},sd.getSlotByName=function(sd){return this._boneSlotDic[sd]},sd.showSkinByName=function(sd,sL){void 0===sL&&(sL=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(sd),sL)},sd.showSkinByIndex=function(sd,sL){void 0===sL&&(sL=!0);for(var sl=0;sl<this._boneSlotArray.length;sl++)this._boneSlotArray[sl].showSlotData(null,sL);if(this._templet.showSkinByIndex(this._boneSlotDic,sd,sL)){var sZ=this._templet.skinDataArray[sd];this._skinIndex=sd,this._skinName=sZ.name}this._clearCache()},sd.showSlotSkinByIndex=function(sd,sL){if(0!=this._aniMode){var sl=this.getSlotByName(sd);sl&&sl.showDisplayByIndex(sL),this._clearCache()}},sd.showSlotSkinByName=function(sd,sL){if(0!=this._aniMode){var sl=this.getSlotByName(sd);sl&&sl.showDisplayByName(sL),this._clearCache()}},sd.replaceSlotSkinName=function(sd,sL,sl){if(0!=this._aniMode){var sZ=this.getSlotByName(sd);sZ&&sZ.replaceDisplayByName(sL,sl),this._clearCache()}},sd.replaceSlotSkinByIndex=function(sd,sL,sl){if(0!=this._aniMode){var sZ=this.getSlotByName(sd);sZ&&sZ.replaceDisplayByIndex(sL,sl),this._clearCache()}},sd.setSlotSkin=function(sd,sL){if(0!=this._aniMode){var sl=this.getSlotByName(sd);sl&&sl.replaceSkin(sL),this._clearCache()}},sd._clearCache=function(){if(1==this._aniMode)for(var sd=0,sL=this._graphicsCache.length;sd<sL;sd++){for(var sl=0,sZ=this._graphicsCache[sd].length;sl<sZ;sl++){var sh=this._graphicsCache[sd][sl];sh!=this.graphics&&sH.recycle(sh)}this._graphicsCache[sd].length=0}},sd.play=function(sd,sL,sl,sZ,sh,s_){void 0===sl&&(sl=!0),void 0===sZ&&(sZ=0),void 0===sh&&(sh=0),void 0===s_&&(s_=!0),this._indexControl=!1;var sN=-1,sm=NaN;if(sm=sL?2147483647:0,"string"==typeof sd)for(var su=0,sx=this._templet.getAnimationCount();su<sx;su++){var st=this._templet.getAnimation(su);if(st&&sd==st.name){sN=su;break}}else sN=sd;-1<sN&&sN<this.getAnimNum()&&(this._aniClipIndex=sN,(sl||this._pause||this._currAniIndex!=sN)&&(this._currAniIndex=sN,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(sN)),this._drawOrder=null,this._eventIndex=0,this._player.play(sN,this._player.playbackRate,sm,sZ,sh),s_&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=sb.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},sd.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},sd.playbackRate=function(sd){this._player&&(this._player.playbackRate=sd)},sd.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},sd.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=sb.now(),this.timer.frameLoop(1,this,this._update,null,!0))},sd._getGrahicsDataWithCache=function(sd,sL){return this._graphicsCache[sd][sL]},sd._setGrahicsDataWithCache=function(sd,sL,sl){this._graphicsCache[sd][sL]=sl},sd.destroy=function(sd){void 0===sd&&(sd=!0),sL.prototype.destroy.call(this,sd),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},s_(0,sd,"url",function(){return this._aniPath},function(sd){this.load(sd)}),s_(0,sd,"index",function(){return this._index},function(sd){this.player&&(this._index=sd,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),s_(0,sd,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),s_(0,sd,"templet",function(){return this._templet}),s_(0,sd,"player",function(){return this._player}),sl.useSimpleMeshInCanvas=!1,sl}(s_d),sQ=function(sL){function sh(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,sh.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}sZ(sh,"laya.ani.bone.Templet",sL);var sd=sh.prototype;return sd.getLoadList=function(){return this._loadList},sd.loadAni=function(sd){this._skBufferUrl=sd,shd.loader.load(sd,su.create(this,this.onComplete),null,"arraybuffer")},sd.onComplete=function(sd){if(this._isDestroyed)this.destroy();else{var sL=sx.getRes(this._skBufferUrl);sL?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,sL)):this.event("error","load failed:"+this._skBufferUrl)}},sd.parseData=function(sd,sL,sl){void 0===sl&&(sl=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=sd,this._mainTexture&&sa.isWebGL&&sd.bitmap&&(sd.bitmap.enableMerageInAtlas=!1),this._rate=sl,this.parse(sL)},sd.buildArmature=function(sd){return void 0===sd&&(sd=0),new sV(this,sd)},sd.parse=function(sd){sL.prototype.parse.call(this,sd),this._endLoaded(),this._aniVersion!=sh.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+sh.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},sd._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var sd=0;this._loadList=[];var sL,sl=new sFd(this.getPublicExtData()),sZ=0,sh=0,s_=0,sN=sl.getInt32(),sm=sl.readUTFString(),su=sm.split("\n");for(sd=0;sd<sN;sd++)sL=this._path+su[2*sd],sm=su[2*sd+1],sl.getFloat32(),sl.getFloat32(),sZ=sl.getFloat32(),sh=sl.getFloat32(),s_=sl.getFloat32(),isNaN(s_)?0:s_,s_=sl.getFloat32(),isNaN(s_)?0:s_,s_=sl.getFloat32(),isNaN(s_)?sZ:s_,s_=sl.getFloat32(),isNaN(s_)?sh:s_,-1==this._loadList.indexOf(sL)&&this._loadList.push(sL);this.event("inited",this)}},sd._textureComplete=function(){for(var sd,sL,sl=0,sZ=this._loadList.length;sl<sZ;sl++)sL=this._loadList[sl],sd=this._textureDic[sL]=sx.getRes(sL),sa.isWebGL&&sd&&sd.bitmap&&(sd.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},sd._parsePublicExtData=function(){var sd=0,sL=0,sl=0,sZ=0,sh=0;for(sd=0,sh=this.getAnimationCount();sd<sh;sd++)this._graphicsCache.push([]);var s_;s_="Dragon"!=this._aniClassName;var sN,sm,su=new sFd(this.getPublicExtData()),sx=0,st=0,sb=0,sq=0,sY=0,sc=0,sr=0,sa=0,sk=0,se=su.getInt32(),sw=su.readUTFString(),ss=sw.split("\n");for(sd=0;sd<se;sd++){if(sN=this._mainTexture,sm=this._path+ss[2*sd],sw=ss[2*sd+1],null==this._mainTexture&&(sN=this._textureDic[sm]),!sN)return this.event("error",this),void(this.isParseFail=!0);sx=su.getFloat32(),st=su.getFloat32(),sb=su.getFloat32(),sq=su.getFloat32(),sk=su.getFloat32(),sY=isNaN(sk)?0:sk,sk=su.getFloat32(),sc=isNaN(sk)?0:sk,sk=su.getFloat32(),sr=isNaN(sk)?sb:sk,sk=su.getFloat32(),sa=isNaN(sk)?sq:sk,this.subTextureDic[sw]=sId.create(sN,sx,st,sb,sq,-sY,-sc,sr,sa),sN.alphaTexture&&(this.subTextureDic[sw].alphaTexture=sId.create(sN.alphaTexture,sx,st,sb,sq,-sY,-sc,sr,sa))}this._mainTexture=sN;var sA,sy,s$,sO,sn,sV=su.getUint16();for(sd=0;sd<sV;sd++)(sA=[]).push(su.getUint16()),sA.push(su.getUint16()),sA.push(su.getUint16()),sA.push(su.getUint16()),this.aniSectionDic[sd]=sA;var sQ,sg=su.getInt16(),sF={};for(sd=0;sd<sg;sd++)sy=new spd,0==sd?sQ=sy:sy.root=sQ,sy.d=s_?-1:1,sO=su.readUTFString(),sn=su.readUTFString(),sy.length=su.getFloat32(),1==su.getByte()&&(sy.inheritRotation=!1),1==su.getByte()&&(sy.inheritScale=!1),sy.name=sO,sn&&((s$=sF[sn])?s$.addChild(sy):this.mRootBone=sy),sF[sO]=sy,this.mBoneArr.push(sy);this.tMatrixDataLen=su.getUint16();var sE,sI,sp=su.getUint16(),sH=Math.floor(sp/this.tMatrixDataLen),sX=this.srcBoneMatrixArr;for(sd=0;sd<sH;sd++)(sE=new sDd).scX=su.getFloat32(),sE.skX=su.getFloat32(),sE.skY=su.getFloat32(),sE.scY=su.getFloat32(),sE.x=su.getFloat32(),sE.y=su.getFloat32(),8===this.tMatrixDataLen&&(sE.skewX=su.getFloat32(),sE.skewY=su.getFloat32()),sX.push(sE),(sy=this.mBoneArr[sd]).transform=sE;var sj,sR=su.getUint16(),so=0;for(sd=0;sd<sR;sd++){for(sI=new sSd,so=su.getUint16(),sL=0;sL<so;sL++)sI.boneNames.push(su.readUTFString()),sI.boneIndexs.push(su.getInt16());sI.name=su.readUTFString(),sI.targetBoneName=su.readUTFString(),sI.targetBoneIndex=su.getInt16(),sI.bendDirection=su.getFloat32(),sI.mix=su.getFloat32(),sI.isSpine=s_,this.ikArr.push(sI)}var si,sS=su.getUint16(),sB=0;for(sd=0;sd<sS;sd++){for(sj=new szd,sB=su.getUint16(),sL=0;sL<sB;sL++)sj.boneIndexs.push(su.getInt16());sj.name=su.getUTFString(),sj.targetIndex=su.getInt16(),sj.rotateMix=su.getFloat32(),sj.translateMix=su.getFloat32(),sj.scaleMix=su.getFloat32(),sj.shearMix=su.getFloat32(),sj.offsetRotation=su.getFloat32(),sj.offsetX=su.getFloat32(),sj.offsetY=su.getFloat32(),sj.offsetScaleX=su.getFloat32(),sj.offsetScaleY=su.getFloat32(),sj.offsetShearY=su.getFloat32(),this.tfArr.push(sj)}var sC=su.getUint16(),sP=0;for(sd=0;sd<sC;sd++){for((si=new sBd).name=su.readUTFString(),sP=su.getUint16(),sL=0;sL<sP;sL++)si.bones.push(su.getInt16());si.target=su.readUTFString(),si.positionMode=su.readUTFString(),si.spacingMode=su.readUTFString(),si.rotateMode=su.readUTFString(),si.offsetRotation=su.getFloat32(),si.position=su.getFloat32(),si.spacing=su.getFloat32(),si.rotateMix=su.getFloat32(),si.translateMix=su.getFloat32(),this.pathArr.push(si)}var sT,sz,sD,sG,sK,sv=0,sJ=0,sf=0,sU=NaN,sW=0,sM=su.getInt16();for(sd=0;sd<sM;sd++){var sdd=su.getUint8(),sLd={};this.deformAniArr.push(sLd);for(var sld=0;sld<sdd;sld++)for((sT=new sXd).skinName=su.getUTFString(),sLd[sT.skinName]=sT,sv=su.getInt16(),sL=0;sL<sv;sL++)for(sz=new sjd,sT.deformSlotDataList.push(sz),sJ=su.getInt16(),sl=0;sl<sJ;sl++)for(sD=new sRd,sz.deformSlotDisplayList.push(sD),sD.slotIndex=su.getInt16(),sD.attachment=su.getUTFString(),sf=su.getInt16(),sZ=0;sZ<sf;sZ++)for(1==su.getByte()?sD.tweenKeyList.push(!0):sD.tweenKeyList.push(!1),sU=su.getFloat32(),sD.timeList.push(sU),sG=[],sD.vectices.push(sG),sW=su.getInt16(),sh=0;sh<sW;sh++)sG.push(su.getFloat32())}var sZd,shd,s_d=su.getInt16(),sNd=0,smd=0;for(sd=0;sd<s_d;sd++){for(sNd=su.getInt16(),sK=[],sL=0;sL<sNd;sL++){for((sZd=new sod).time=su.getFloat32(),smd=su.getInt16(),sl=0;sl<smd;sl++)sZd.drawOrder.push(su.getInt16());sK.push(sZd)}this.drawOrderAniArr.push(sK)}var sud,sxd=su.getInt16(),std=0;for(sd=0;sd<sxd;sd++){for(std=su.getInt16(),shd=[],sL=0;sL<std;sL++)(sud=new sid).name=su.getUTFString(),sud.intValue=su.getInt32(),sud.floatValue=su.getFloat32(),sud.stringValue=su.getUTFString(),sud.time=su.getFloat32(),shd.push(sud);this.eventAniArr.push(shd)}var sbd=su.getInt16();if(0<sbd)for(this.attachmentNames=[],sd=0;sd<sbd;sd++)this.attachmentNames.push(su.getUTFString());var sqd,sYd,scd=su.getInt16();for(sd=0;sd<scd;sd++)(sqd=new sHd).name=su.readUTFString(),sqd.parent=su.readUTFString(),sqd.attachmentName=su.readUTFString(),sqd.srcDisplayIndex=sqd.displayIndex=su.getInt16(),(sqd.templet=this).boneSlotDic[sqd.name]=sqd,null==(sYd=this.bindBoneBoneSlotDic[sqd.parent])&&(this.bindBoneBoneSlotDic[sqd.parent]=sYd=[]),sYd.push(sqd),this.boneSlotArray.push(sqd);var srd,sad,skd,sed=su.readUTFString().split("\n"),swd=0,ssd=su.getUint8(),sAd=0,syd=0,s$d=0,sOd=0,snd=0,sVd=0,sQd=0;for(sd=0;sd<ssd;sd++){for((srd=new sCd).name=sed[swd++],sAd=su.getUint8(),sL=0;sL<sAd;sL++){for((sad=new sTd).name=sed[swd++],sqd=this.boneSlotDic[sad.name],syd=su.getUint8(),sl=0;sl<syd;sl++){if(skd=new sPd,this.skinSlotDisplayDataArr.push(skd),skd.name=sed[swd++],skd.attachmentName=sed[swd++],skd.transform=new sDd,skd.transform.scX=su.getFloat32(),skd.transform.skX=su.getFloat32(),skd.transform.skY=su.getFloat32(),skd.transform.scY=su.getFloat32(),skd.transform.x=su.getFloat32(),skd.transform.y=su.getFloat32(),sad.displayArr.push(skd),skd.width=su.getFloat32(),skd.height=su.getFloat32(),skd.type=su.getUint8(),skd.verLen=su.getUint16(),0<(sg=su.getUint16()))for(skd.bones=[],sZ=0;sZ<sg;sZ++){var sgd=su.getUint16();skd.bones.push(sgd)}if(0<(s$d=su.getUint16()))for(skd.uvs=[],sZ=0;sZ<s$d;sZ++)skd.uvs.push(su.getFloat32());if(0<(sOd=su.getUint16()))for(skd.weights=[],sZ=0;sZ<sOd;sZ++)skd.weights.push(su.getFloat32());if(0<(snd=su.getUint16()))for(skd.triangles=[],sZ=0;sZ<snd;sZ++)skd.triangles.push(su.getUint16());if(0<(sVd=su.getUint16()))for(skd.vertices=[],sZ=0;sZ<sVd;sZ++)skd.vertices.push(su.getFloat32());if(0<(sQd=su.getUint16()))for(skd.lengths=[],sZ=0;sZ<sQd;sZ++)skd.lengths.push(su.getFloat32())}srd.slotArr.push(sad)}this.skinDic[srd.name]=srd,this.skinDataArray.push(srd)}1==su.getUint8()?(this.yReverseMatrix=new sEd(1,0,0,-1,0,0),sQ&&sQ.setTempMatrix(this.yReverseMatrix)):sQ&&sQ.setTempMatrix(new sEd),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},sd.getTexture=function(sd){var sL=this.subTextureDic[sd];return sL||(sL=this.subTextureDic[sd.substr(0,sd.length-1)]),null==sL?this._mainTexture:sL},sd.showSkinByIndex=function(sd,sL,sl){if(void 0===sl&&(sl=!0),sL<0&&sL>=this.skinDataArray.length)return!1;var sZ,sh,s_=0,sN=0,sm=this.skinDataArray[sL];if(sm){for(s_=0,sN=sm.slotArr.length;s_<sN;s_++)(sh=sm.slotArr[s_])&&(sZ=sd[sh.name])&&(sZ.showSlotData(sh,sl),sl&&"undefined"!=sZ.attachmentName&&"null"!=sZ.attachmentName?sZ.showDisplayByName(sZ.attachmentName):sZ.showDisplayByIndex(sZ.displayIndex));return!0}return!1},sd.getSkinIndexByName=function(sd){for(var sL=0,sl=this.skinDataArray.length;sL<sl;sL++)if(this.skinDataArray[sL].name==sd)return sL;return-1},sd.getGrahicsDataWithCache=function(sd,sL){return this._graphicsCache[sd][sL]},sd.setGrahicsDataWithCache=function(sd,sL,sl){this._graphicsCache[sd][sL]=sl},sd.destroy=function(){var sd;for(var sL in this._isDestroyed=!0,this.subTextureDic)(sd=this.subTextureDic[sL])&&sd.destroy();for(sL in this._textureDic)(sd=this._textureDic[sL])&&sd.destroy();for(var sl=0,sZ=this.skinSlotDisplayDataArr.length;sl<sZ;sl++)this.skinSlotDisplayDataArr[sl].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete sh.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},sd.getAniNameByIndex=function(sd){var sL=this.getAnimation(sd);return sL?sL.name:null},s_(0,sd,"rate",function(){return this._rate},function(sd){this._rate=sd}),sh.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",sh.TEMPLET_DICTIONARY=null,sh}(sX)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(sd,sL){"use strict";for(var sl in Object.defineProperty(sL,"__esModule",{value:!0}),Laya){var sZ=Laya[sl];sZ&&sZ.__isclass&&(sL[sl]=sZ)}});