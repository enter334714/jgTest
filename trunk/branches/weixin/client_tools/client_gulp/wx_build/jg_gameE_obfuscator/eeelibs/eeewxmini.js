var b=wx.$e;!function(t,o){o.un,o.uns;var i=o.static,n=o.class,a=o.getset,l=(o.__newvec,laya.utils.Browser),r=(laya.events.Event,laya.events.EventDispatcher),f=laya.resource.HTMLImage,d=laya.utils.Handler,e=laya.display.Input,c=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),g=laya.utils.RunDriver,v=(laya.media.Sound,laya.media.SoundChannel),x=laya.media.SoundManager,p=(laya.display.Stage,laya.net.URL),_=laya.utils.Utils,s=(n(fa4v7_,"laya.wx.mini.MiniAdpter"),fa4v7_.getJson=function(i){return JSON.parse(i)},fa4v7_.init=function(i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),fa4v7_._inited||(fa4v7_.window=t).navigator.userAgent.indexOf("MiniGame")<0||(fa4v7_._inited=!0,fa4v7_.isZiYu=n,fa4v7_.isPosMsgYu=i,fa4v7_.EnvConfig={},fa4v7_.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,d.create(fa4v7_,fa4v7_.onMkdirCallBack))),fa4v7_.window.focus=function(){},o.getUrlPath=function(){},fa4v7_.window.logtime=function(i){},fa4v7_.window.alertTimeLog=function(i){},fa4v7_.window.resetShareInfo=function(){},fa4v7_.window.CanvasRenderingContext2D=function(){},fa4v7_.window.CanvasRenderingContext2D.prototype=fa4v7_.window.wx.createCanvas().getContext("2d").__proto__,fa4v7_.window.document.body.appendChild=function(){},fa4v7_.EnvConfig.pixelRatioInt=0,g.getPixelRatio=fa4v7_.pixelRatio,fa4v7_._preCreateElement=l.createElement,l.createElement=fa4v7_.createElement,g.createShaderCondition=fa4v7_.createShaderCondition,_.parseXMLFromString=fa4v7_.parseXMLFromString,e._createInputElement=m._createInputElement,fa4v7_.EnvConfig.load=c.prototype.load,c.prototype.load=y.prototype.load,fa4v7_.isZiYu&&i&&wx.onMessage(function(i){i.isLoad&&(u.ziyuFileData[i.url]=i.data)}))},fa4v7_.onMkdirCallBack=function(i,n){i||(u.filesListObj=JSON.parse(n.data))},fa4v7_.pixelRatio=function(){if(!fa4v7_.EnvConfig.pixelRatioInt)try{var i=wx.getSystemInfoSync();return fa4v7_.EnvConfig.pixelRatioInt=i.pixelRatio,i.pixelRatio}catch(i){}return fa4v7_.EnvConfig.pixelRatioInt},fa4v7_.createElement=function(i){return"canvas"!=i?"textarea"==i||"input"==i?fa4v7_.onCreateInput(i):"div"==i?((e=fa4v7_._preCreateElement(i)).contains=function(i){return null},e.removeChild=function(i){},e):fa4v7_._preCreateElement(i):(1==fa4v7_.idx?fa4v7_.isZiYu?(n=sharedCanvas).style={}:n=t.canvas:n=t.wx.createCanvas(),fa4v7_.idx++,n);var n;var e},fa4v7_.onCreateInput=function(i){i=fa4v7_._preCreateElement(i);return i.focus=m.wxinputFocus,i.blur=m.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(i){},i.setType=function(i){},i.setFontFace=function(i){},i.addEventListener=function(i){},i.contains=function(i){return null},i.removeChild=function(i){},i},fa4v7_.createShaderCondition=function(i){var n=this;return function(){return n[i.replace("this.","")]}},fa4v7_.EnvConfig=null,fa4v7_.window=null,fa4v7_._preCreateElement=null,fa4v7_._inited=!1,fa4v7_.wxRequest=null,fa4v7_.systemInfo=null,fa4v7_.version="0.0.1",fa4v7_.isZiYu=!1,fa4v7_.isPosMsgYu=!1,fa4v7_.parseXMLFromString=function(i){var n;i=i.replace(/>\s+</g,"><");try{n=(new t.Parser.DOMParser).parseFromString(i,"text/xml")}catch(i){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},fa4v7_.idx=1,fa4v7_),m=(n(lthrg,"laya.wx.mini.MiniImage"),lthrg.prototype._loadImage=function(i){var n=!1;-1==i.indexOf("layaNativeDir/")&&(n=!0,i=p.formatURL(i)),u.getFileInfo(i)?lthrg.onCreateImage(i,this,!n):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?u.downImg(i,new d(lthrg,lthrg.onDownImgCallBack,[i,this]),i):lthrg.onCreateImage(i,this,!0)},lthrg.onDownImgCallBack=function(i,n,e){e?n.onError(null):lthrg.onCreateImage(i,n)},lthrg.onCreateImage=function(n,e,i){var t;function x3qj$(){t.onload=null,t.onerror=null,delete e.imgCache[n]}i=(i=void 0===i?!1:i)?n:(i=u.getFileInfo(n).md5,u.getFileNativePath(i)),null==e.imgCache&&(e.imgCache={});function ya(){x3qj$(),e.onLoaded(t)}function za(){x3qj$(),e.event("error","Load image failed")}"nativeimage"==e._type?((t=new l.window.Image).crossOrigin="",t.onload=ya,t.onerror=za,t.src=i,e.imgCache[n]=t):new f.create(i,{onload:ya,onerror:za,onCreate:function(i){t=i,e.imgCache[n]=i}})},n(i$txjg,"laya.wx.mini.MiniInput"),i$txjg._createInputElement=function(){e._initInput(e.area=l.createElement("textarea")),e._initInput(e.input=l.createElement("input")),e.inputContainer=l.createElement("div"),e.inputContainer.style.position="absolute",e.inputContainer.style.zIndex=1e5,l.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(i,n){e.inputContainer.style.left=i+"px",e.inputContainer.style.top=n+"px"},o.stage.on("resize",null,i$txjg._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){t.dispatchEvent&&t.dispatchEvent("resize")}),x._soundClass=w,x._musicClass=w},i$txjg._onStageResize=function(){o.stage._canvasTransform.identity().scale(l.width/h.canvas.width/g.getPixelRatio(),l.height/h.canvas.height/g.getPixelRatio())},i$txjg.wxinputFocus=function(i){var n=e.inputElement.target;n&&!n.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(i){},fail:function(i){}}),s.window.wx.onKeyboardConfirm(function(i){i=i?i.value:"";n.text=i,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(i){i=i?i.value:"";n.multiline||-1==i.indexOf("\n")?(n.text=i,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},i$txjg.inputEnter=function(){e.inputElement.target.focus=!1},i$txjg.wxinputblur=function(){i$txjg.hideKeyboard()},i$txjg.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(i){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(i){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(i?i.errMsg:""))}})},i$txjg),y=(n(omapc,"laya.wx.mini.MiniLoader"),(C=omapc.prototype).load=function(i,n,e,t,a){void 0===e&&(e=!0),void 0===a&&(a=!1);var o=this;0===(o._url=i).indexOf("data:image")?o._type=n="image":o._type=n=n||o.getTypeFromUrl(i),o._cache=e,o._data=null;var l="ascii";-1!=i.indexOf(".fnt")?l="utf8":"arraybuffer"==n&&(l="");var r=_.getFileExtension(i);if(-1!=omapc._fileTypeArr.indexOf(r))s.EnvConfig.load.call(this,i,n,e,t,a);else if(u.getFileInfo(i))s.EnvConfig.load.call(this,i,n,e,t,a);else{if(-1!=i.indexOf("layaNativeDir/"))return s.isZiYu?(r=u.ziyuFileData[i],void o.onLoaded(r)):(cosnole.log("read read"),void u.read(i,l,new d(omapc,omapc.onReadNativeCallBack,[l,i,n,e,t,a,o])));r=""==p.rootPath?i:i.split(p.rootPath)[0],-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?s.EnvConfig.load.call(o,i,n,e,t,a):u.readFile(r,l,new d(omapc,omapc.onReadNativeCallBack,[l,i,n,e,t,a,o]),i)}},C.resMgrLoad=function(i,t,n,e,a,o,l){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===l&&(l=3),-1!=i.indexOf("mpack")&&console.log("=============resMgrLoad url:",i),s.EnvConfig.resMgrLoad(i,(i,n,e)=>{omapc.prototype.resMgrLoadCallBack(i,n,e,t)},n,e,a,o,l)},C.resMgrLoadCallBack=function(i,n,e,t){console.log("buff:::",i,e,u.fileNativeDir+"///"+u.fileListName),t(i,n,e)},C.clearRes=function(i,n){this.clearRes(i,n=void 0===n?!1:n);n=u.getFileInfo(i);!n||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(i=n.md5,n=u.getFileNativePath(i),u.remove(n))},omapc.onReadNativeCallBack=function(i,n,e,t,a,o,l,r,u){void 0===t&&(t=!0),void 0===o&&(o=!1),(r=void 0===r?0:r)?1==r&&s.EnvConfig.load.call(l,n,e,t,a,o):(r="json"==e||"atlas"==e?s.getJson(u.data):"xml"==e?_.parseXMLFromString(u.data):u.data,l.onLoaded(r),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:n,data:r,isLoad:!0}))},i(omapc,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),omapc),u=(n(lh$xg,"laya.wx.mini.MiniFileMgr",r),lh$xg.isLoadFile=function(i){return-1!=lh$xg._fileTypeArr.indexOf(i)},lh$xg.getFileInfo=function(i){i=i.split("?")[0],i=lh$xg.filesListObj[i];return null==i?null:i},lh$xg.onFileUpdate=function(i,n){var i=i.split("/"),i=i[i.length-1],e=lh$xg.getFileInfo(n);null==e?lh$xg.onSaveFile(n,i):e.readyUrl!=n&&lh$xg.remove(i,n)},lh$xg.exits=function(i,n){i=lh$xg.getFileNativePath(i);lh$xg.fs.getFileInfo({filePath:i,success:function(i){null!=n&&n.runWith([0,i])},fail:function(i){null!=n&&n.runWith([1,i])}})},lh$xg.read=function(i,n,e,t){void 0===n&&(n="ascill"),i=""!=(t=void 0===t?"":t)?lh$xg.getFileNativePath(i):i,lh$xg.fs.readFile({filePath:i,encoding:n,success:function(i){null!=e&&e.runWith([0,i])},fail:function(i){i&&""!=t?lh$xg.down(t,n,e,t):null!=e&&e.runWith([1])}})},lh$xg.readNativeFile=function(i,n){lh$xg.fs.readFile({filePath:i,encoding:"",success:function(i){null!=n&&n.runWith([0])},fail:function(i){null!=n&&n.runWith([1])}})},lh$xg.down=function(i,n,e,t){void 0===n&&(n="ascill"),void 0===t&&(t="");var a=lh$xg.getFileNativePath(t);lh$xg.wxdown({url:i,filePath:a,success:function(i){200===i.statusCode&&lh$xg.readFile(i.filePath,n,e,t)},fail:function(i){null!=e&&e.runWith([1,i])}}).onProgressUpdate(function(i){null!=e&&e.runWith([2,i.progress])})},lh$xg.readFile=function(n,i,e,t){void 0===t&&(t=""),lh$xg.fs.readFile({filePath:n,encoding:i=void 0===i?"ascill":i,success:function(i){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||lh$xg.onFileUpdate(n,t),null!=e&&e.runWith([0,i])},fail:function(i){i&&null!=e&&e.runWith([1,i])}})},lh$xg.downImg=function(i,n,e){void 0===e&&(e="");lh$xg.wxdown({url:i,success:function(i){200===i.statusCode&&lh$xg.copyFile(i.tempFilePath,e,n)},fail:function(i){null!=n&&n.runWith([1,i])}})},lh$xg.copyFile=function(i,n,e){var t=i.split("/"),a=t[t.length-1],o=(n.split("?")[0],lh$xg.getFileInfo(n)),t=lh$xg.getFileNativePath(a);lh$xg.fs.copyFile({srcPath:i,destPath:t,success:function(i){o?o.readyUrl!=n&&lh$xg.remove(a,n,e):(lh$xg.onSaveFile(n,a),null!=e&&e.runWith([0]))},fail:function(i){null!=e&&e.runWith([1,i])}})},lh$xg.getFileNativePath=function(i){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+i},lh$xg.remove=function(n,e,t){void 0===e&&(e="");var i=lh$xg.getFileInfo(e),a=lh$xg.getFileNativePath(i.md5);o.loader.clearRes(i.readyUrl),lh$xg.fs.unlink({filePath:a,success:function(i){""!=e&&lh$xg.onSaveFile(e,n),null!=t&&t.runWith([0])},fail:function(i){}})},lh$xg.onSaveFile=function(i,n){var e=i.split("?")[0];lh$xg.filesListObj[e]={md5:n,readyUrl:i},lh$xg.fs.writeFile({filePath:lh$xg.fileNativeDir+"/"+lh$xg.fileListName,encoding:"utf8",data:JSON.stringify(lh$xg.filesListObj),success:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",i)},fail:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",i)}})},lh$xg.existDir=function(i,n){lh$xg.fs.mkdir({dirPath:i,success:function(i){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(i){-1!=i.errMsg.indexOf("file already exists")?lh$xg.readSync(lh$xg.fileListName,"utf8",n):null!=n&&n.runWith([1,i])}})},lh$xg.readSync=function(i,n,e,t){void 0===n&&(n="ascill"),void 0===t&&(t="");var a,n=lh$xg.getFileNativePath(i);try{a=lh$xg.fs.readFileSync(n),null!=e&&e.runWith([0,{data:a}])}catch(i){null!=e&&e.runWith([1])}},lh$xg.readCache=function(){},lh$xg.writeCache=function(i){var n=readyUrl.split("?")[0];lh$xg.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},lh$xg.fs.writeFile({filePath:lh$xg.fileNativeDir+"/"+lh$xg.fileListName,encoding:"utf8",data:JSON.stringify(lh$xg.filesListObj),success:function(i){},fail:function(i){}})},lh$xg.setNativeFileDir=function(i){lh$xg.fileNativeDir=wx.env.USER_DATA_PATH+i},lh$xg.filesListObj={},lh$xg.fileNativeDir=null,lh$xg.fileListName="layaairfiles.txt",lh$xg.ziyuFileData={},i(lh$xg,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),lh$xg),w=(n(xiqj$,"laya.wx.mini.MiniSound",r),(C=xiqj$.prototype).load=function(i){var n=this;var e;function vyzrf4(){if(null!=xiqj$._null)n._sound.onCanplay(xiqj$._null),n._sound.onError(xiqj$._null);else try{n._sound.onCanplay(null),n._sound.onError(null),xiqj$._null=null}catch(i){console.warn("[wxmini] _clearSound:"+i),n._sound.onCanplay(kb560),n._sound.onError(kb560),xiqj$._null=kb560}}function kb560(){}i=p.formatURL(i),this.url=i,xiqj$._audioCache[i]?this.event("complete"):(this._sound.onCanplay(function(){vyzrf4(),e.loaded=!0,e.event("complete"),xiqj$._audioCache[e.url]=e}),this._sound.onError(function(i){console.error("errCode="+i.errCode+"  errMsg="+i.errMsg),vyzrf4(),e.event("error")}),this._sound.src=i,e=this)},C.play=function(i,n){void 0===i&&(i=0),void 0===n&&(n=0),(e=this.url==x._tMusic?(xiqj$._musicAudio||(xiqj$._musicAudio=xiqj$._createSound()),xiqj$._musicAudio):xiqj$._createSound()).src=this.url;var e=new $(e);return e.url=this.url,e.loops=n,e.startTime=i,e.play(),x.addChannel(e),e},C.dispose=function(){var i=xiqj$._audioCache[this.url];i&&(i.src="",delete xiqj$._audioCache[this.url])},a(0,C,"duration",function(){return this._sound.duration}),xiqj$._createSound=function(){return xiqj$._id++,s.window.wx.createInnerAudioContext()},xiqj$._musicAudio=null,xiqj$._id=0,xiqj$._audioCache={},xiqj$._null=void 0,xiqj$),$=(n(vr4y,"laya.wx.mini.MiniSoundChannel",v),(i=vr4y.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(o.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__onNull=function(){},i.play=function(){this.isStopped=!1,x.addChannel(this),this._audio&&this._audio.play()},i.stop=function(){if(this.isStopped=!0,x.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=vr4y._null)this._audio.onEnded(vr4y._null);else try{this._audio.onEnded(null),vr4y._null=null}catch(i){console.warn("[wxmini] stop:"+i),this._audio.onEnded(_.bind(this.__onNull,this)),vr4y._null=_.bind(this.__onNull,this)}this._audio=null}},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,x.addChannel(this),this._audio.play())},a(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,i,"duration",function(){return this._audio?this._audio.duration:0}),a(0,i,"volume",function(){return 1},function(i){}),vr4y._null=void 0,vr4y);function vr4y(i){this._audio=null,this._onEnd=null,vr4y.__super.call(this),this._audio=i,this._onEnd=_.bind(this.__onEnd,this),i.onEnded(this._onEnd)}function xiqj$(){this._sound=null,this.url=null,this.loaded=!1,xiqj$.__super.call(this),this._sound=xiqj$._createSound()}function lh$xg(){lh$xg.__super.call(this)}function omapc(){}var C;function i$txjg(){}function lthrg(){}function fa4v7_(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(i,n){"use strict";for(var e in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var t=Laya[e];t&&t.__isclass&&(n[e]=t)}});