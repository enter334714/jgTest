var Laya=window.Laya=function($D,$B){var $T={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($B,$_){return 1==arguments.length?$T.__presubstr.call(this,$B):$T.__presubstr.call(this,$B,0<$_?$_:this.length+$_)},__init:function($B){$B.forEach(function($B){$B.__init$&&$B.__init$()})},__isClass:function($B){return $B&&($B.__isclass||$B==Object||$B==String||$B==Array)},__newvec:function($B,$_){var $Z=[];$Z.length=$B;for(var $n=0;$n<$B;$n++)$Z[$n]=$_;return $Z},__extend:function($B,$_){for(var $Z in $_)if($_.hasOwnProperty($Z)){var $n=Object.getOwnPropertyDescriptor($_,$Z),$g=$n.get,$q=$n.set;$g||$q?$g&&$q?Object.defineProperty($B,$Z,$n):($g&&Object.defineProperty($B,$Z,$g),$q&&Object.defineProperty($B,$Z,$q)):$B[$Z]=$_[$Z]}function $P(){$T.un(this,"constructor",$B)}$P.prototype=$_.prototype,$B.prototype=new $P,$T.un($B.prototype,"__imps",$T.__copy({},$_.prototype.__imps))},__copy:function($B,$_){if(!$_)return null;for(var $Z in $B=$B||{},$_)$B[$Z]=$_[$Z];return $B},__package:function($B,$_){if(!$T.__packages[$B]){$T.__packages[$B]=!0;var $Z=$D,$n=$B.split(".");if(1<$n.length)for(var $g=0,$q=$n.length-1;$g<$q;$g++){var $P=$Z[$n[$g]];$Z=$P||($Z[$n[$g]]={})}$Z[$n[$n.length-1]]||($Z[$n[$n.length-1]]=$_||{})}},__hasOwnProperty:function($B,$_){return $_=$_||this,Object.hasOwnProperty.call($_,$B)||function $B($_,$Z){if(Object.hasOwnProperty.call($Z.prototype,$_))return!0;var $n=$Z.prototype.__super;return null==$n?null:$B($_,$n)}($B,$_.__class)},__typeof:function($B,$_){if(!$B||!$_)return!1;if($_===String)return"string"==typeof $B;if($_===Number)return"number"==typeof $B;if($_.__interface__)$_=$_.__interface__;else if("string"!=typeof $_)return $B instanceof $_;return $B.__imps&&$B.__imps[$_]||$B.__class==$_},__as:function($B,$_){return this.__typeof($B,$_)?$B:null},__int:function($B){return $B?parseInt($B):0},interface:function($B,$_){$T.__package($B,{});var $Z=$T.__internals,$n=$Z[$B]=$Z[$B]||{self:$B};if($_){var $g=$_.split(",");$n.extend=[];for(var $q=0;$q<$g.length;$q++){var $P=$g[$q];$Z[$P]=$Z[$P]||{self:$P},$n.extend.push($Z[$P])}}var $k=$D,$m=$B.split(".");for($q=0;$q<$m.length-1;$q++)$k=$k[$m[$q]];$k[$m[$m.length-1]]={__interface__:$B}},class:function($B,$_,$Z,$n){if($Z&&$T.__extend($B,$Z),$_)if($T.__package($_,$B),$T.__classmap[$_]=$B,0<$_.indexOf(".")){if(0==$_.indexOf("laya.")){var $g=$_.split(".");$n=$n||$g[$g.length-1],$T[$n]&&console.log("Warning!,this class["+$n+"] already exist:",$T[$n]),$T[$n]=$B}}else"Main"==$_?$D.Main=$B:"MainWX"==$_?$D.MainWX=$B:($T[$_]&&console.log("Error!,this class["+$_+"] already exist:",$T[$_]),$T[$_]=$B);var $q=$T.un,$P=$B.prototype;$q($P,"hasOwnProperty",$T.__hasOwnProperty),$q($P,"__class",$B),$q($P,"__super",$Z),$q($P,"__className",$_),$q($B,"__super",$Z),$q($B,"__className",$_),$q($B,"__isclass",!0),$q($B,"super",function($B){this.__super.call($B)})},imps:function($B,$_){if(!$_)return null;var $g=$B.__imps||$T.un($B,"__imps",{});function $q($B){var $_,$Z;if(($_=$T.__internals[$B])&&($g[$B]=!0,$Z=$_.extend))for(var $n=0;$n<$Z.length;$n++)$q($Z[$n].self)}for(var $Z in $_)$q($Z)},superSet:function($B,$_,$Z,$n){var $g=$B.prototype["_$set_"+$Z];$g&&$g.call($_,$n)},superGet:function($B,$_,$Z){var $n=$B.prototype["_$get_"+$Z];return $n?$n.call($_):null},getset:function($B,$_,$Z,$n,$g){$B?($n&&($_["_$GET_"+$Z]=$n),$g&&($_["_$SET_"+$Z]=$g)):($n&&$T.un($_,"_$get_"+$Z,$n),$g&&$T.un($_,"_$set_"+$Z,$g)),$n&&$g?Object.defineProperty($_,$Z,{get:$n,set:$g,enumerable:!1,configurable:!0}):($n&&Object.defineProperty($_,$Z,{get:$n,enumerable:!1,configurable:!0}),$g&&Object.defineProperty($_,$Z,{set:$g,enumerable:!1,configurable:!0}))},static:function($Z,$n){for(var $g=0,$B=$n.length;$g<$B;$g+=2)if("length"==$n[$g])$Z.length=$n[$g+1].call($Z);else{function $_(){var $_=$n[$g],$B=$n[$g+1];Object.defineProperty($Z,$_,{get:function(){return delete this[$_],this[$_]=$B.call(this)},set:function($B){delete this[$_],this[$_]=$B},enumerable:!0,configurable:!0})}$_()}},un:function($B,$_,$Z){return $Z||($Z=$B[$_]),$T.__propun.value=$Z,Object.defineProperty($B,$_,$T.__propun),$Z},uns:function($_,$B){$B.forEach(function($B){$T.un($_,$B)})}};return $D.console=$D.console||{log:function(){}},$D.trace=$D.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$T}(window,document);!function($B,$_,$Z){$Z.un,$Z.uns,$Z.static,$Z.class,$Z.getset,$Z.__newvec}(window,document,Laya),function($P,$_,$N){$N.un,$N.uns;var $m=$N.static,$w=$N.class,$T=$N.getset;$N.__newvec;$N.interface("laya.runtime.IMarket"),$N.interface("laya.filters.IFilter"),$N.interface("laya.display.ILayout"),$N.interface("laya.resource.IDispose"),$N.interface("laya.runtime.IPlatform"),$N.interface("laya.resource.IDestroy"),$N.interface("laya.runtime.IConchNode"),$N.interface("laya.filters.IFilterAction"),$N.interface("laya.runtime.ICPlatformClass"),$N.interface("laya.resource.ICreateResource"),$N.interface("laya.runtime.IConchRenderObject"),$N.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $v=function(){function $q(){}return $w($q,"laya.utils.RunDriver"),$q.FILTER_ACTIONS=[],$q.pixelRatio=-1,$q._charSizeTestDiv=null,$q.now=function(){return Date.now()},$q.getWindow=function(){return $P},$q.getPixelRatio=function(){if($q.pixelRatio<0){var $B=$K.context,$_=$B.backingStorePixelRatio||$B.webkitBackingStorePixelRatio||$B.mozBackingStorePixelRatio||$B.msBackingStorePixelRatio||$B.oBackingStorePixelRatio||$B.backingStorePixelRatio||1;($q.pixelRatio=($K.window.devicePixelRatio||1)/$_)<1&&($q.pixelRatio=1)}return $q.pixelRatio},$q.getIncludeStr=function($B){return null},$q.createShaderCondition=function($B){var $_="(function() {return "+$B+";})";return $N._runScript($_)},$q.fontMap=[],$q.measureText=function($B,$_){var $Z=$q.hanzi.test($B);if($Z&&$q.fontMap[$_])return $q.fontMap[$_];var $n=$K.context;$n.font=$_;var $g=$n.measureText($B);return $g||($g={width:16,height:16}),$Z&&($q.fontMap[$_]=$g),$g},$q.getWebGLContext=function($B){},$q.beginFlush=function(){},$q.endFinish=function(){},$q.addToAtlas=null,$q.flashFlushImage=function($B){},$q.drawToCanvas=function($B,$_,$Z,$n,$g,$q){var $P=$CB.create("2D"),$k=new $f($Z,$n,$P);return $b.renders[$_]._fun($B,$k,$g,$q),$P},$q.createParticleTemplate2D=null,$q.createGLTextur=null,$q.createWebGLContext2D=null,$q.changeWebGLSize=function($B,$_){},$q.createRenderSprite=function($B,$_){return new $b($B,$_)},$q.createFilterAction=function($B){return new $C},$q.createGraphics=function(){return new $I},$q.clear=function($B){$u._context.ctx.clear()},$q.cancelLoadByUrl=function($B){},$q.clearAtlas=function($B){},$q.isAtlas=function($B){return!1},$q.addTextureToAtlas=function($B){},$q.getTexturePixels=function($B,$_,$Z,$n,$g){return null},$q.skinAniSprite=function(){return null},$q.update3DLoop=function(){},$m($q,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$q}(),$n=($T(1,$N,"alertGlobalError",null,function($B){var $q=0;$K.window.onerror=$B?function($B,$_,$Z,$n,$g){$q++<5&&$g&&alert($g.stack||$g)}:null}),$N.init=function($B,$_,$Z){for(var $n=[],$g=2,$q=arguments.length;$g<$q;$g++)$n.push(arguments[$g]);if(!$N._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$N._arrayBufferSlice),$N._isinit=!0,$K.__init__(),$x.__init__(),$I.__init__(),$N.timer=new $O,$N.scaleTimer=new $O,$N.loader=new $mB,$c.__init__(),$g=0;for(var $P=$n.length;$g<$P;$g++)$n[$g].enable&&$n[$g].enable();return $A.__init__(),$k.__init__(),$p.__init__(),$G.beginCheck(),$N._currentStage=$N.stage=new $jB,$N.stage.conchModel&&$N.stage.conchModel.setRootNode(),$N._getUrlPath(),$N.render=new $u(0,0),$N.stage.size($B,$_),$b.__init__(),$e.__init__(),$$.instance.__init__($N.stage,$u.canvas),$tB.__init__(),$L.autoStopMusic=!0,$Y.__init__(),$u.canvas}},$N._getUrlPath=function(){var $B=$K.window.location,$_=$B.pathname;$_=$_&&":"==$_.charAt(2)?$_.substring(1):$_,$F.rootPath=$F.basePath=$F.getPath("file:"==$B.protocol?$_:$B.protocol+"//"+$B.host+$B.pathname)},$N._arrayBufferSlice=function($B,$_){var $Z=new Uint8Array(this,$B,$_-$B),$n=new Uint8Array($Z.length);return $n.set($Z),$n.buffer},$N._runScript=function($B){return $K.window[$N._evcode]($B)},$N.stage=null,$N.timer=null,$N.scaleTimer=null,$N.loader=null,$N.version="1.8.6",$N.render=null,$N._currentStage=null,$N._isinit=!1,$N.isDebug=!1,$N.MiniAdpter={init:function(){$P.navigator&&$P.navigator.userAgent&&-1<$P.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$m($N,["conchMarket",function(){return this.conchMarket=$P.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$P.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $B(){}return $w($B,"Config"),$B.WebGLTextCacheCount=500,$B.atlasEnable=!1,$B.showCanvasMark=!1,$B.animationInterval=50,$B.isAntialias=!1,$B.isAlpha=!1,$B.premultipliedAlpha=!0,$B.isStencil=!0,$B.preserveDrawingBuffer=!1,$B}()),$D=function(){function $D(){this._events=null}$w($D,"laya.events.EventDispatcher");var $B=$D.prototype;return $B.hasListener=function($B){return!!(this._events&&this._events[$B])},$B.getListener=function($B){return this._events?this._events[$B]:null},$B.event=function($B,$_){if(!this._events||!this._events[$B])return!1;var $Z=this._events[$B];if($Z.lock)$Z.queue||($Z.queue=[]),$Z.queue.push($_);else{var $n;for($Z.lock=!0,$Z.cursor=$Z.head;$Z.cursor;)($n=$Z.cursor).recover?($Z.head=$Z.tail=$Z.cursor=null,console.error("node is recover："+$n.id)):($Z.cursor=$n.next,$n.once&&$D.delNode($Z,$n),$n.method&&(null!=$_?$n.args?$n.method.apply($n.caller,$n.args.concat($_)):$_ instanceof Array?$n.method.apply($n.caller,$_):$n.caller?$n.method.call($n.caller,$_):$N.recordError("事件派发错误","node.caller:"+$n.caller+"node.method:"+$n.method+"data:"+$_+"node.prev"+$n.prev):$n.method.apply($n.caller,$n.args)),$n.once&&$D.recoverHandler($n));$Z.lock=!1,!$Z.head&&this._events&&this._events[$B]==$Z&&delete this._events[$B],$Z.queue&&$Z.queue.length&&this.event($B,$Z.queue.shift())}return!0},$B.on=function($B,$_,$Z,$n){return this._createListener($B,$_,$Z,$n,!1)},$B.once=function($B,$_,$Z,$n){return this._createListener($B,$_,$Z,$n,!0)},$B._createListener=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=!0),$q&&this.off($B,$_,$Z,$g);var $P=$D.createHandler($_||this,$Z,$n,$g);this._events||(this._events={});var $k=this._events,$m=$k[$B];return $m?$m.tail?($P.prev=$m.tail,$m.tail.next=$P,$m.tail=$P):$m.head=$m.tail=$P:$k[$B]={head:$P,tail:$P,cursor:null,lock:!1},this},$B.off=function($B,$_,$Z,$n){if(void 0===$n&&($n=!1),!this._events||!this._events[$B])return this;for(var $g=this._events[$B],$q=$g.head;$q;){if((!$_||$q.caller===$_)&&$q.method===$Z&&(!$n||$q.once)){$D.delNode($g,$q),$g.cursor==$q&&($g.cursor=$q.next),$D.recoverHandler($q);break}$q=$q.next}return this},$B.offAll=function($B){var $_=this._events;if(!$_)return this;if($B)this._recoverHandlers($_[$B]),delete $_[$B];else{for(var $Z in $_)this._recoverHandlers($_[$Z]);this._events=null}return this},$B._recoverHandlers=function($B){if($B){for(var $_=$B.head;$_;){$D.delNode($B,$_);var $Z=$_.next;$D.recoverHandler($_),$_=$Z}$B.cursor=null}},$B.isMouseEvent=function($B){return $D.MOUSE_EVENTS[$B]},$D.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$D.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$D.delNode=function($B,$_){$_.prev?$_.prev.next=$_.next:$B.head=$_.next,$_.next?$_.next.prev=$_.prev:$B.tail=$_.prev},$D.createHandler=function($B,$_,$Z,$n){var $g=500<$D._freeHandler.length?$D._freeHandler.shift():null;if($g)if($g.recover)$g.recover=!1,$g.caller=$B,$g.method=$_,$g.args=$Z,$g.once=$n;else{var $q="";try{arguments.propertyIsEnumerable.caller}catch($B){$q=$B.stack}var $P=$g.caller?($g.caller.__proto__&&$g.caller.__proto__.constructor&&$g.caller.__proto__.constructor.name)+"|"+$g.caller.__className+"|"+$g.caller.name:"",$k=$g.method?$g.method.name:"";$N.recordError("EventDispatcher重复创建","caller="+$P+"  method="+$k+"  stack="+$q),$g={id:++$D._nodeCount,caller:$B,method:$_,args:$Z,once:$n,recover:!1}}else $g={id:++$D._nodeCount,caller:$B,method:$_,args:$Z,once:$n,recover:!1};return $g.prev=$g.next=null,$g},$D.recoverHandler=function($B){if($B.recover){if($D._errorCount<5){$D._errorCount++;var $_="";try{arguments.propertyIsEnumerable.caller}catch($B){$_=$B.stack}var $Z=$B.caller?($B.caller.__proto__&&$B.caller.__proto__.constructor&&$B.caller.__proto__.constructor.name)+"|"+$B.caller.__className+"|"+$B.caller.name:"",$n=$B.method?$B.method.name:"";$N.recordError("EventDispatcher重复回收","id="+$B.id+"  caller="+$Z+"  method="+$n+"  stack="+$_)}$B.caller=$B.method=$B.args=$B.prev=null}else $B.recover=!0,$B.caller=$B.method=$B.args=$B.prev=$B.next=null,$D._freeHandler&&$D._freeHandler.length<3e3&&$D._freeHandler.push($B)},$D._freeHandler=[],$D._nodeCount=0,$D._errorCount=0,$D}(),$y=function(){function $g($B,$_,$Z,$n){this.once=!1,void(this._id=0)===$n&&($n=!1),this.setTo($B,$_,$Z,$n)}$w($g,"laya.utils.Handler");var $B=$g.prototype;return $B.setTo=function($B,$_,$Z,$n){return this._id=$g._gid++,this.caller=$B,this.method=$_,this.args=$Z,this.once=$n,this},$B.run=function(){if(null==this.method)return null;var $B=this._id,$_=this.method.apply(this.caller,this.args);return this._id===$B&&this.once&&this.recover(),$_},$B.runWith=function($B){if(null==this.method)return null;var $_=this._id;if(null==$B)var $Z=this.method.apply(this.caller,this.args);else $Z=this.args||$B.unshift?this.args?this.method.apply(this.caller,this.args.concat($B)):this.method.apply(this.caller,$B):this.method.call(this.caller,$B);return this._id===$_&&this.once&&this.recover(),$Z},$B.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$B.recover=function(){0<this._id&&(this._id=0,this.clear())},$g.create=function($B,$_,$Z,$n){return void 0===$n&&($n=!0),new $g($B,$_,$Z,$n)},$g._gid=1,$g}(),$l=function(){function $B(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$w($B,"laya.display.BitmapFont");var $_=$B.prototype;return $_.loadFont=function($B,$_){this._path=$B,this._complete=$_,$N.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$y.create(this,this.onLoaded))},$_.onLoaded=function(){this.parseFont($kB.getRes(this._path),$kB.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$_.parseFont=function($B,$_){if(null!=$B&&null!=$_){this._texture=$_;var $Z=$B.getElementsByTagName("info");if(!$Z[0].getAttributeNode)return this.parseFont2($B,$_);this.fontSize=parseInt($Z[0].getAttributeNode("size").nodeValue);var $n,$g=$Z[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($g[0]),parseInt($g[1]),parseInt($g[2]),parseInt($g[3])],$n=$B.getElementsByTagName("char");var $q=0;for($q=0;$q<$n.length;$q++){var $P=$n[$q],$k=parseInt($P.getAttributeNode("id").nodeValue),$m=parseInt($P.getAttributeNode("xoffset").nodeValue)/1,$D=parseInt($P.getAttributeNode("yoffset").nodeValue)/1,$T=parseInt($P.getAttributeNode("xadvance").nodeValue)/1,$e=new $M;$e.x=parseInt($P.getAttributeNode("x").nodeValue),$e.y=parseInt($P.getAttributeNode("y").nodeValue),$e.width=parseInt($P.getAttributeNode("width").nodeValue),$e.height=parseInt($P.getAttributeNode("height").nodeValue);var $I=$TB.create($_,$e.x,$e.y,$e.width,$e.height,$m,$D);this._maxWidth=Math.max(this._maxWidth,$T+this.letterSpacing),this._fontCharDic[$k]=$I,this._fontWidthMap[$k]=$T}}},$_.parseFont2=function($B,$_){if(null!=$B&&null!=$_){this._texture=$_;var $Z=$B.getElementsByTagName("info");this.fontSize=parseInt($Z[0].attributes.size.nodeValue);var $n=$Z[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($n[0]),parseInt($n[1]),parseInt($n[2]),parseInt($n[3])];var $g=$B.getElementsByTagName("char"),$q=0;for($q=0;$q<$g.length;$q++){var $P=$g[$q].attributes,$k=parseInt($P.id.nodeValue),$m=parseInt($P.xoffset.nodeValue)/1,$D=parseInt($P.yoffset.nodeValue)/1,$T=parseInt($P.xadvance.nodeValue)/1,$e=new $M;$e.x=parseInt($P.x.nodeValue),$e.y=parseInt($P.y.nodeValue),$e.width=parseInt($P.width.nodeValue),$e.height=parseInt($P.height.nodeValue);var $I=$TB.create($_,$e.x,$e.y,$e.width,$e.height,$m,$D);this._maxWidth=Math.max(this._maxWidth,$T+this.letterSpacing),this._fontCharDic[$k]=$I,this._fontWidthMap[$k]=$T}}},$_.getCharTexture=function($B){return this._fontCharDic[$B.charCodeAt(0)]},$_.destroy=function(){if(this._texture){for(var $B in this._fontCharDic){var $_=this._fontCharDic[$B];$_&&$_.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$_.setSpaceWidth=function($B){this._spaceWidth=$B},$_.getCharWidth=function($B){var $_=$B.charCodeAt(0);return this._fontWidthMap[$_]?this._fontWidthMap[$_]+this.letterSpacing:" "==$B?this._spaceWidth+this.letterSpacing:0},$_.getTextWidth=function($B){for(var $_=0,$Z=0,$n=$B.length;$Z<$n;$Z++)$_+=this.getCharWidth($B.charAt($Z));return $_},$_.getMaxWidth=function(){return this._maxWidth},$_.getMaxHeight=function(){return this.fontSize},$_.drawText=function($B,$_,$Z,$n,$g,$q){var $P,$k=this.getTextWidth($B),$m=0;"center"===$g&&($m=($q-$k)/2),"right"===$g&&($m=$q-$k);for(var $D=0,$T=0,$e=$B.length;$T<$e;$T++)($P=this.getCharTexture($B.charAt($T)))&&($_.graphics.drawTexture($P,$Z+$D+$m,$n),$D+=this.getCharWidth($B.charAt($T)))},$B}(),$k=function(){function $Z(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$Z._TF_EMPTY}$w($Z,"laya.display.css.Style");var $B=$Z.prototype;return $B.getTransform=function(){return this._tf},$B.setTransform=function($B){this._tf="none"!==$B&&$B?$B:$Z._TF_EMPTY},$B.setTranslateX=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.translateX=$B},$B.setTranslateY=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.translateY=$B},$B.setScaleX=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.scaleX=$B},$B.setScale=function($B,$_){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.scaleX=$B,this._tf.scaleY=$_},$B.setScaleY=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.scaleY=$B},$B.setRotate=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.rotate=$B},$B.setSkewX=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.skewX=$B},$B.setSkewY=function($B){this._tf===$Z._TF_EMPTY&&(this._tf=new $g),this._tf.skewY=$B},$B.destroy=function(){this.scrollRect=null},$B.render=function($B,$_,$Z,$n){},$B.getCSSStyle=function(){return $_B.EMPTY},$B._enableLayout=function(){return!1},$T(0,$B,"scaleX",function(){return this._tf.scaleX},function($B){this.setScaleX($B)}),$T(0,$B,"transform",function(){return this.getTransform()},function($B){this.setTransform($B)}),$T(0,$B,"translateX",function(){return this._tf.translateX},function($B){this.setTranslateX($B)}),$T(0,$B,"translateY",function(){return this._tf.translateY},function($B){this.setTranslateY($B)}),$T(0,$B,"scaleY",function(){return this._tf.scaleY},function($B){this.setScaleY($B)}),$T(0,$B,"block",function(){return 0!=(1&this._type)}),$T(0,$B,"skewY",function(){return this._tf.skewY},function($B){this.setSkewY($B)}),$T(0,$B,"rotate",function(){return this._tf.rotate},function($B){this.setRotate($B)}),$T(0,$B,"skewX",function(){return this._tf.skewX},function($B){this.setSkewX($B)}),$T(0,$B,"paddingLeft",function(){return 0}),$T(0,$B,"paddingTop",function(){return 0}),$T(0,$B,"absolute",function(){return!0}),$Z.__init__=function(){$Z._TF_EMPTY=new $g,$Z.EMPTY=new $Z},$Z.EMPTY=null,$Z._TF_EMPTY=null,$Z}(),$A=function(){function $_($B){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$X.create($_.defaultColor),this.family=$_.defaultFamily,this.stroke=$_._STROKE,this.size=$_.defaultSize,$B&&$B!==$_.EMPTY&&$B.copyTo(this)}$w($_,"laya.display.css.Font");var $B=$_.prototype;return $B.set=function($B){this._text=null;for(var $_=$B.split(" "),$Z=0,$n=$_.length;$Z<$n;$Z++){var $g=$_[$Z];switch($g){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$g.indexOf("px")&&(this.size=parseInt($g),this.family=$_[$Z+1],$Z++)}},$B.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$B.copyTo=function($B){$B._type=this._type,$B._text=this._text,$B._weight=this._weight,$B._color=this._color,$B.family=this.family,$B.stroke=this.stroke!=$_._STROKE?this.stroke.slice():$_._STROKE,$B.indent=this.indent,$B.size=this.size},$T(0,$B,"password",function(){return 0!=(1024&this._type)},function($B){$B?this._type|=1024:this._type&=-1025}),$T(0,$B,"color",function(){return this._color.strColor},function($B){this._color=$X.create($B)}),$T(0,$B,"italic",function(){return 0!=(512&this._type)},function($B){$B?this._type|=512:this._type&=-513}),$T(0,$B,"bold",function(){return 0!=(2048&this._type)},function($B){$B?this._type|=2048:this._type&=-2049}),$T(0,$B,"weight",function(){return""+this._weight},function($B){var $_=0;switch($B){case"normal":break;case"bold":this.bold=!0,$_=700;break;case"bolder":$_=800;break;case"lighter":$_=100;break;default:$_=parseInt($B)}this._weight=$_,this._text=null}),$T(0,$B,"decoration",function(){return this._decoration?this._decoration.value:null},function($B){var $_=$B.split(" ");switch(this._decoration||(this._decoration={}),$_[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$_[0]}$_[1]&&(this._decoration.color=$X.create($_)),this._decoration.value=$B}),$_.__init__=function(){$_.EMPTY=new $_(null)},$_.EMPTY=null,$_.defaultColor="#000000",$_.defaultSize=12,$_.defaultFamily="Arial",$_.defaultFont="12px Arial",$_._STROKE=[0,"#000000"],$_._ITALIC=512,$_._PASSWORD=1024,$_._BOLD=2048,$_}(),$g=function(){function $B(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $w($B,"laya.display.css.TransformInfo"),$B}(),$I=function(){function $e(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$u.isConchNode){this._nativeObj=new $P._conchGraphics,this.id=this._nativeObj.conchID}}$w($e,"laya.display.Graphics");var $B=$e.prototype;return $B.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$B.clear=function($B){void 0===$B&&($B=!1);var $_=0,$Z=0;if($B){var $n=this._one;if(this._cmds){for($Z=this._cmds.length,$_=0;$_<$Z;$_++)!($n=this._cmds[$_])||$n.callee!==$u._context._drawTexture&&$n.callee!==$u._context._drawTextureWithTransform||($n[0]=null,$e._cache.push($n));this._cmds.length=0}else $n&&(!$n||$n.callee!==$u._context._drawTexture&&$n.callee!==$u._context._drawTextureWithTransform||($n[0]=null,$e._cache.push($n)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($_=0,$Z=this._vectorgraphArray.length;$_<$Z;$_++)$i.getInstance().deleteShape(this._vectorgraphArray[$_]);this._vectorgraphArray.length=0}},$B._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$B._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $Z,this._graphicBounds._graphics=this)},$B._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$B._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$B.getBounds=function($B){return void 0===$B&&($B=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($B)},$B.getBoundPoints=function($B){return void 0===$B&&($B=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($B)},$B._addCmd=function($B){this._cmds=this._cmds||[],$B.callee=$B.shift(),this._cmds.push($B)},$B.setFilters=function($B){this._saveToCmd($u._context._setFilters,$B)},$B.drawTexture=function($B,$_,$Z,$n,$g,$q,$P){if(void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$P&&($P=1),!$B||$P<.01)return null;$n||($n=$B.sourceWidth),$g||($g=$B.sourceHeight),$P=$P<0?0:1<$P?1:$P;var $k,$m=!$u.isWebGL&&($K.onFirefox||$K.onEdge||$K.onIE||$K.onSafari)?.5:0,$D=$n/$B.sourceWidth,$T=$g/$B.sourceHeight;return $n=$B.width*$D,$g=$B.height*$T,$B.loaded&&($n<=0||$g<=0)?null:($_+=$B.offsetX*$D,$Z+=$B.offsetY*$T,this._sp&&(this._sp._renderType|=512),$_-=$m,$Z-=$m,$n+=2*$m,$g+=2*$m,$e._cache.length?(($k=$e._cache.pop())[0]=$B,$k[1]=$_,$k[2]=$Z,$k[3]=$n,$k[4]=$g,$k[5]=$q,$k[6]=$P):$k=[$B,$_,$Z,$n,$g,$q,$P],$k.callee=$q||1!=$P?$u._context._drawTextureWithTransform:$u._context._drawTexture,null!=this._one||$q||1!=$P?this._saveToCmd($k.callee,$k):(this._one=$k,this._render=this._renderOneImg),$B.loaded||$B.once("loaded",this,this._textureLoaded,[$B,$k]),this._repaint(),$k)},$B.cleanByTexture=function($B,$_,$Z,$n,$g){if(void 0===$n&&($n=0),void 0===$g&&($g=0),!$B)return this.clear();if(this._one&&this._render===this._renderOneImg){$n||($n=$B.sourceWidth),$g||($g=$B.sourceHeight);var $q=$n/$B.sourceWidth,$P=$g/$B.sourceHeight;$n=$B.width*$q,$g=$B.height*$P,$_+=$B.offsetX*$q,$Z+=$B.offsetY*$P,this._one[0]=$B,this._one[1]=$_,this._one[2]=$Z,this._one[3]=$n,this._one[4]=$g,this._repaint()}else this.clear(),$B&&this.drawTexture($B,$_,$Z,$n,$g)},$B.drawTextures=function($B,$_){$B&&this._saveToCmd($u._context._drawTextures,[$B,$_])},$B.fillTexture=function($B,$_,$Z,$n,$g,$q,$P){if(void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$q&&($q="repeat"),$B){var $k=[$B,$_,$Z,$n,$g,$q,$P||$Q.EMPTY,{}];$B.loaded||$B.once("loaded",this,this._textureLoaded,[$B,$k]),this._saveToCmd($u._context._fillTexture,$k)}},$B._textureLoaded=function($B,$_){$_[3]=$_[3]||$B.width,$_[4]=$_[4]||$B.height,this._repaint()},$B.fillCircle=function($B,$_,$Z,$n,$g,$q,$P){$Z.bitmap.enableMerageInAtlas=!1;var $k=new Float32Array(2*($P+1)),$m=new Float32Array(2*($P+1)),$D=new Uint16Array(3*$P),$T=2*Math.PI/$P,$e=0;$k[0]=$n,$k[1]=$g,$m[0]=$n/$Z.width,$m[1]=$g/$Z.height;for(var $I=2,$A=0;$A<$P;$A++){var $$=$q*Math.cos($e)+$n,$w=$q*Math.sin($e)+$g;$k[$I]=$$,$k[$I+1]=$w,$m[$I]=$$/$Z.width,$m[$I+1]=$w/$Z.height,$e+=$T,$I+=2}for($A=$I=0;$A<$P;$A++)$D[$I++]=0,$D[$I++]=$A+1,$D[$I++]=$P+1<=$A+2?1:$A+2;this.drawTriangles($Z,$B,$_,$k,$m,$D)},$B.drawTriangles=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){void 0===$k&&($k=1),this._saveToCmd($u._context.drawTriangles,[$B,$_,$Z,$n,$g,$q,$P,$k,$m,$D])},$B._saveToCmd=function($B,$_){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$_,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($_)),$_.callee=$B,this._repaint(),$_},$B.clipRect=function($B,$_,$Z,$n){this._saveToCmd($u._context._clipRect,[$B,$_,$Z,$n])},$B.fillText=function($B,$_,$Z,$n,$g,$q,$P){void 0===$P&&($P=0),this._saveToCmd($u._context._fillText,[$B,$_,$Z,$n||$A.defaultFont,$g,$q])},$B.fillBorderText=function($B,$_,$Z,$n,$g,$q,$P,$k){this._saveToCmd($u._context._fillBorderText,[$B,$_,$Z,$n||$A.defaultFont,$g,$q,$P,$k])},$B.strokeText=function($B,$_,$Z,$n,$g,$q,$P){this._saveToCmd($u._context._strokeText,[$B,$_,$Z,$n||$A.defaultFont,$g,$q,$P])},$B.alpha=function($B){$B=$B<0?0:1<$B?1:$B,this._saveToCmd($u._context._alpha,[$B])},$B.setAlpha=function($B){$B=$B<0?0:1<$B?1:$B,this._saveToCmd($u._context._setAlpha,[$B])},$B.transform=function($B,$_,$Z){void 0===$_&&($_=0),void 0===$Z&&($Z=0),this._saveToCmd($u._context._transform,[$B,$_,$Z])},$B.rotate=function($B,$_,$Z){void 0===$_&&($_=0),void 0===$Z&&($Z=0),this._saveToCmd($u._context._rotate,[$B,$_,$Z])},$B.scale=function($B,$_,$Z,$n){void 0===$Z&&($Z=0),void 0===$n&&($n=0),this._saveToCmd($u._context._scale,[$B,$_,$Z,$n])},$B.translate=function($B,$_){this._saveToCmd($u._context._translate,[$B,$_])},$B.save=function(){this._saveToCmd($u._context._save,[])},$B.restore=function(){this._saveToCmd($u._context._restore,[])},$B.replaceText=function($B){this._repaint();var $_=this._cmds;if($_){for(var $Z=$_.length-1;-1<$Z;$Z--)if(this._isTextCmd($_[$Z].callee))return $_[$Z][0].toUpperCase?$_[$Z][0]=$B:$_[$Z][0].setText($B),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$B:this._one[0].setText($B),!0;return!1},$B._isTextCmd=function($B){return $B===$u._context._fillText||$B===$u._context._fillBorderText||$B===$u._context._strokeText},$B.replaceTextColor=function($B){this._repaint();var $_=this._cmds;if($_)for(var $Z=$_.length-1;-1<$Z;$Z--)this._isTextCmd($_[$Z].callee)&&($_[$Z][4]=$B,$_[$Z][0].toUpperCase||($_[$Z][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$B,this._one[0].toUpperCase||(this._one[0].changed=!0))},$B.loadImage=function($B,$_,$Z,$n,$g,$q){var $P=this;void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0),void 0===$g&&($g=0);var $k=$kB.getRes($B);function $m($B){$B&&($P.drawTexture($B,$_,$Z,$n,$g),null!=$q&&$q.call($P._sp,$B))}$k?$m($k):$N.loader.load($B,$y.create(null,$m),null,"image")},$B._renderEmpty=function($B,$_,$Z,$n){},$B._renderAll=function($B,$_,$Z,$n){for(var $g,$q=this._cmds,$P=0,$k=$q.length;$P<$k;$P++)($g=$q[$P]).callee.call($_,$Z,$n,$g)},$B._renderOne=function($B,$_,$Z,$n){this._one.callee.call($_,$Z,$n,this._one)},$B._renderOneImg=function($B,$_,$Z,$n){this._one.callee.call($_,$Z,$n,this._one),2305!==$B._renderType&&($B._renderType|=1)},$B.drawLine=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=1);var $P=0;$u.isWebGL&&($P=$i.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($P));var $k=$q%2==0?0:.5,$m=[$B+$k,$_+$k,$Z+$k,$n+$k,$g,$q,$P];this._saveToCmd($u._context._drawLine,$m)},$B.drawLines=function($B,$_,$Z,$n,$g){void 0===$g&&($g=1);var $q=0;if($Z&&!($Z.length<4)){$u.isWebGL&&($q=$i.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($q));var $P=$g%2==0?0:.5,$k=[$B+$P,$_+$P,$Z,$n,$g,$q];this._saveToCmd($u._context._drawLines,$k)}},$B.drawCurves=function($B,$_,$Z,$n,$g){void 0===$g&&($g=1);var $q=[$B,$_,$Z,$n,$g];this._saveToCmd($u._context._drawCurves,$q)},$B.drawRect=function($B,$_,$Z,$n,$g,$q,$P){void 0===$P&&($P=1);var $k=$q?$P/2:0,$m=$q?$P:0,$D=[$B+$k,$_+$k,$Z-$m,$n-$m,$g,$q,$P];this._saveToCmd($u._context._drawRect,$D)},$B.drawCircle=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=1);var $P=$g?$q/2:0,$k=0;$u.isWebGL&&($k=$i.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($k));var $m=[$B,$_,$Z-$P,$n,$g,$q,$k];this._saveToCmd($u._context._drawCircle,$m)},$B.drawPie=function($B,$_,$Z,$n,$g,$q,$P,$k){void 0===$k&&($k=1);var $m=$P?$k/2:0,$D=$P?$k:0,$T=0;$u.isWebGL&&($T=$i.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($T));var $e=[$B+$m,$_+$m,$Z-$D,$n,$g,$q,$P,$k,$T];$e[3]=$a.toRadian($n),$e[4]=$a.toRadian($g),this._saveToCmd($u._context._drawPie,$e)},$B.drawPoly=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=1);var $P=0,$k=!1;$u.isWebGL&&($P=$i.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($P),$k=!(6<$Z.length));var $m=$g?$q%2==0?0:.5:0,$D=[$B+$m,$_+$m,$Z,$n,$g,$q,$P,$k];this._saveToCmd($u._context._drawPoly,$D)},$B.drawPath=function($B,$_,$Z,$n,$g){var $q=[$B,$_,$Z,$n,$g];this._saveToCmd($u._context._drawPath,$q)},$T(0,$B,"cmds",function(){return this._cmds},function($B){this._sp&&(this._sp._renderType|=512),this._cmds=$B,this._render=this._renderAll,this._repaint()}),$e.__init__=function(){if($u.isConchNode){for(var $B=laya.display.Graphics.prototype,$_=$K.window.ConchGraphics.prototype,$Z=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$n=0,$g=$Z.length;$n<=$g;$n++){var $q=$Z[$n];$B[$q]=$_[$q]}$B._saveToCmd=null,$_.drawImageS&&($B.drawTextures=function($B,$_){if($B&&$B.loaded&&$B.bitmap&&$B.source){var $Z=$B.uv,$n=$B.bitmap.width,$g=$B.bitmap.height;this.drawImageS($B.bitmap.source,$Z[0]*$n,$Z[1]*$g,($Z[2]-$Z[0])*$n,($Z[5]-$Z[3])*$g,$B.offsetX,$B.offsetY,$B.width,$B.height,$_)}}),$B.drawTexture=function($B,$_,$Z,$n,$g,$q,$P){if(void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$P&&($P=1),$B)if($B.loaded){if($B.loaded&&$B.bitmap&&$B.source&&($n||($n=$B.sourceWidth),$g||($g=$B.sourceHeight),$P=$P<0?0:1<$P?1:$P,$n=$n-$B.sourceWidth+$B.width,$g=$g-$B.sourceHeight+$B.height,!($n<=0||$g<=0))){$_+=$B.offsetX,$Z+=$B.offsetY;var $k=$B.uv,$m=$B.bitmap.width,$D=$B.bitmap.height;$k[4]<$k[0]&&$k[5]<$k[1]?this.drawImageM($B.bitmap.source,$k[4]*$m,$k[5]*$D,($k[0]-$k[4])*$m,($k[1]-$k[5])*$D,$_,$Z,$n,$g,$q,$P):this.drawImageM($B.bitmap.source,$k[0]*$m,$k[1]*$D,($k[2]-$k[0])*$m,($k[5]-$k[3])*$D,$_,$Z,$n,$g,$q,$P),this._repaint()}}else $B.once("loaded",this,function(){this.drawTexture($B,$_,$Z,$n,$g,$q)})},$B.fillTexture=function($B,$_,$Z,$n,$g,$q,$P){if(void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$q&&($q="repeat"),$B&&$B.loaded){var $k,$m=$u._context.ctx,$D=$B.bitmap.width,$T=$B.bitmap.height,$e=$B.uv;$k=$B.uv!=$TB.DEF_UV?$m.createPattern($B.bitmap.source,$q,$e[0]*$D,$e[1]*$T,($e[2]-$e[0])*$D,($e[5]-$e[3])*$T):$m.createPattern($B.bitmap.source,$q);var $I=0,$A=0;$P&&($_+=$P.x%$B.width,$Z+=$P.y%$B.height,$I-=$P.x%$B.width,$A-=$P.y%$B.height),this._fillImage($k,$_,$Z,$I,$A,$n,$g)}}}},$e._cache=[],$e}(),$Z=function(){function $C(){this._cacheBoundsType=!1}$w($C,"laya.display.GraphicsBounds");var $B=$C.prototype;return $B.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$B.reset=function(){this._temp&&(this._temp.length=0)},$B.getBounds=function($B){return void 0===$B&&($B=!1),(!this._bounds||!this._temp||this._temp.length<1||$B!=this._cacheBoundsType)&&(this._bounds=$M._getWrapRec(this.getBoundPoints($B),this._bounds)),this._cacheBoundsType=$B,this._bounds},$B.getBoundPoints=function($B){return void 0===$B&&($B=!1),(!this._temp||this._temp.length<1||$B!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($B)),this._cacheBoundsType=$B,this._rstBoundPoints=$a.copyArray(this._rstBoundPoints,this._temp)},$B._getCmdPoints=function($B){void 0===$B&&($B=!1);var $_,$Z,$n=$u._context,$g=this._graphics.cmds;if(($_=this._temp||(this._temp=[])).length=0,$g||null==this._graphics._one||($C._tempCmds.length=0,$C._tempCmds.push(this._graphics._one),$g=$C._tempCmds),!$g)return $_;($Z=$C._tempMatrixArrays).length=0;var $q=$C._initMatrix;$q.identity();for(var $P,$k,$m=$C._tempMatrix,$D=NaN,$T=NaN,$e=NaN,$I=NaN,$A=NaN,$$=NaN,$w=0,$r=$g.length;$w<$r;$w++)if(($P=$g[$w]).callee)switch($P.callee){case $n._save:case 7:$Z.push($q),$q=$q.clone();break;case $n._restore:case 8:$q=$Z.pop();break;case $n._scale:case 5:$m.identity(),$m.translate(-$P[2],-$P[3]),$m.scale($P[0],$P[1]),$m.translate($P[2],$P[3]),this._switchMatrix($q,$m);break;case $n._rotate:case 3:$m.identity(),$m.translate(-$P[1],-$P[2]),$m.rotate($P[0]),$m.translate($P[1],$P[2]),this._switchMatrix($q,$m);break;case $n._translate:case 6:$m.identity(),$m.translate($P[0],$P[1]),this._switchMatrix($q,$m);break;case $n._transform:case 4:$m.identity(),$m.translate(-$P[1],-$P[2]),$m.concat($P[0]),$m.translate($P[1],$P[2]),this._switchMatrix($q,$m);break;case 16:case 24:$C._addPointArrToRst($_,$M._getBoundPointS($P[0],$P[1],$P[2],$P[3]),$q);break;case 17:$q.copyTo($m),$m.concat($P[4]),$C._addPointArrToRst($_,$M._getBoundPointS($P[0],$P[1],$P[2],$P[3]),$m);break;case $n._drawTexture:$k=$P[0],$B?$P[3]&&$P[4]?$C._addPointArrToRst($_,$M._getBoundPointS($P[1],$P[2],$P[3],$P[4]),$q):($k=$P[0],$C._addPointArrToRst($_,$M._getBoundPointS($P[1],$P[2],$k.width,$k.height),$q)):($D=($P[3]||$k.sourceWidth)/$k.width,$T=($P[4]||$k.sourceHeight)/$k.height,$e=$D*$k.sourceWidth,$I=$T*$k.sourceHeight,$A=0<$k.offsetX?$k.offsetX:0,$$=0<$k.offsetY?$k.offsetY:0,$A*=$D,$$*=$T,$C._addPointArrToRst($_,$M._getBoundPointS($P[1]-$A,$P[2]-$$,$e,$I),$q));break;case $n._fillTexture:$P[3]&&$P[4]?$C._addPointArrToRst($_,$M._getBoundPointS($P[1],$P[2],$P[3],$P[4]),$q):($k=$P[0],$C._addPointArrToRst($_,$M._getBoundPointS($P[1],$P[2],$k.width,$k.height),$q));break;case $n._drawTextureWithTransform:var $j;$j=$P[5]?($q.copyTo($m),$m.concat($P[5]),$m):$q,$B?$P[3]&&$P[4]?$C._addPointArrToRst($_,$M._getBoundPointS($P[1],$P[2],$P[3],$P[4]),$j):($k=$P[0],$C._addPointArrToRst($_,$M._getBoundPointS($P[1],$P[2],$k.width,$k.height),$j)):($k=$P[0],$D=($P[3]||$k.sourceWidth)/$k.width,$T=($P[4]||$k.sourceHeight)/$k.height,$e=$D*$k.sourceWidth,$I=$T*$k.sourceHeight,$A=0<$k.offsetX?$k.offsetX:0,$$=0<$k.offsetY?$k.offsetY:0,$A*=$D,$$*=$T,$C._addPointArrToRst($_,$M._getBoundPointS($P[1]-$A,$P[2]-$$,$e,$I),$j));break;case $n._drawRect:case 13:$C._addPointArrToRst($_,$M._getBoundPointS($P[0],$P[1],$P[2],$P[3]),$q);break;case $n._drawCircle:case $n._fillCircle:case 14:$C._addPointArrToRst($_,$M._getBoundPointS($P[0]-$P[2],$P[1]-$P[2],$P[2]+$P[2],$P[2]+$P[2]),$q);break;case $n._drawLine:case 20:$C._tempPoints.length=0;var $y;$y=.5*$P[5],$P[0]==$P[2]?$C._tempPoints.push($P[0]+$y,$P[1],$P[2]+$y,$P[3],$P[0]-$y,$P[1],$P[2]-$y,$P[3]):$P[1]==$P[3]?$C._tempPoints.push($P[0],$P[1]+$y,$P[2],$P[3]+$y,$P[0],$P[1]-$y,$P[2],$P[3]-$y):$C._tempPoints.push($P[0],$P[1],$P[2],$P[3]),$C._addPointArrToRst($_,$C._tempPoints,$q);break;case $n._drawCurves:case 22:$C._addPointArrToRst($_,$z.I.getBezierPoints($P[2]),$q,$P[0],$P[1]);break;case $n._drawPoly:case $n._drawLines:case 18:$C._addPointArrToRst($_,$P[2],$q,$P[0],$P[1]);break;case $n._drawPath:case 19:$C._addPointArrToRst($_,this._getPathPoints($P[2]),$q,$P[0],$P[1]);break;case $n._drawPie:case 15:$C._addPointArrToRst($_,this._getPiePoints($P[0],$P[1],$P[2],$P[3],$P[4]),$q)}return 200<$_.length?$_=$a.copyArray($_,$M._getWrapRec($_)._getBoundPoints()):8<$_.length&&($_=$t.scanPList($_)),$_},$B._switchMatrix=function($B,$_){$_.concat($B),$_.copyTo($B)},$B._getPiePoints=function($B,$_,$Z,$n,$g){var $q=$C._tempPoints;$C._tempPoints.length=0,$q.push($B,$_);var $P=($g-$n)%(2*Math.PI)/10,$k=NaN,$m=$n;for($k=0;$k<=10;$k++)$q.push($B+$Z*Math.cos($m),$_+$Z*Math.sin($m)),$m+=$P;return $q},$B._getPathPoints=function($B){var $_,$Z,$n=0,$g=$C._tempPoints;for($g.length=0,$_=$B.length,$n=0;$n<$_;$n++)1<($Z=$B[$n]).length&&($g.push($Z[1],$Z[2]),3<$Z.length&&$g.push($Z[3],$Z[4]));return $g},$C._addPointArrToRst=function($B,$_,$Z,$n,$g){void 0===$n&&($n=0),void 0===$g&&($g=0);var $q,$P=0;for($q=$_.length,$P=0;$P<$q;$P+=2)$C._addPointToRst($B,$_[$P]+$n,$_[$P+1]+$g,$Z)},$C._addPointToRst=function($B,$_,$Z,$n){var $g=$Q.TEMP;$g.setTo($_||0,$Z||0),$n.transformPoint($g),$B.push($g.x,$g.y)},$C._tempPoints=[],$C._tempMatrixArrays=[],$C._tempCmds=[],$m($C,["_tempMatrix",function(){return this._tempMatrix=new $V},"_initMatrix",function(){return this._initMatrix=new $V}]),$C}(),$q=function(){function $B(){}$w($B,"laya.events.Event");var $_=$B.prototype;return $_.setTo=function($B,$_,$Z){return this.type=$B,this.currentTarget=$_,this.target=$Z,this},$_.stopPropagation=function(){this._stoped=!0},$T(0,$_,"stageY",function(){return $N.stage.mouseY}),$T(0,$_,"charCode",function(){return this.nativeEvent.charCode}),$T(0,$_,"touches",function(){var $B=this.nativeEvent.touches;if($B)for(var $_=$N.stage,$Z=0,$n=$B.length;$Z<$n;$Z++){var $g=$B[$Z],$q=$Q.TEMP;$q.setTo($g.clientX,$g.clientY),$_._canvasTransform.invertTransformPoint($q),$_.transform.invertTransformPoint($q),$g.stageX=$q.x,$g.stageY=$q.y}return $B}),$T(0,$_,"keyLocation",function(){return this.nativeEvent.keyLocation}),$T(0,$_,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$T(0,$_,"altKey",function(){return this.nativeEvent.altKey}),$T(0,$_,"shiftKey",function(){return this.nativeEvent.shiftKey}),$T(0,$_,"stageX",function(){return $N.stage.mouseX}),$B.EMPTY=new $B,$B.MOUSE_DOWN="mousedown",$B.MOUSE_UP="mouseup",$B.CLICK="click",$B.RIGHT_MOUSE_DOWN="rightmousedown",$B.RIGHT_MOUSE_UP="rightmouseup",$B.RIGHT_CLICK="rightclick",$B.MOUSE_MOVE="mousemove",$B.MOUSE_OVER="mouseover",$B.MOUSE_OUT="mouseout",$B.MOUSE_WHEEL="mousewheel",$B.ROLL_OVER="mouseover",$B.ROLL_OUT="mouseout",$B.DOUBLE_CLICK="doubleclick",$B.CHANGE="change",$B.CHANGED="changed",$B.RESIZE="resize",$B.ADDED="added",$B.REMOVED="removed",$B.DISPLAY="display",$B.UNDISPLAY="undisplay",$B.ERROR="error",$B.COMPLETE="complete",$B.LOADED="loaded",$B.INITED="inited",$B.PROGRESS="progress",$B.INPUT="input",$B.RENDER="render",$B.OPEN="open",$B.MESSAGE="message",$B.CLOSE="close",$B.KEY_DOWN="keydown",$B.KEY_PRESS="keypress",$B.KEY_UP="keyup",$B.FRAME="enterframe",$B.DRAG_START="dragstart",$B.DRAG_MOVE="dragmove",$B.DRAG_END="dragend",$B.ENTER="enter",$B.SELECT="select",$B.BLUR="blur",$B.FOCUS="focus",$B.VISIBILITY_CHANGE="visibilitychange",$B.FOCUS_CHANGE="focuschange",$B.PLAYED="played",$B.PAUSED="paused",$B.STOPPED="stopped",$B.START="start",$B.END="end",$B.ENABLE_CHANGED="enablechanged",$B.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$B.COMPONENT_ADDED="componentadded",$B.COMPONENT_REMOVED="componentremoved",$B.LAYER_CHANGED="layerchanged",$B.HIERARCHY_LOADED="hierarchyloaded",$B.RECOVERED="recovered",$B.RELEASED="released",$B.LINK="link",$B.LABEL="label",$B.FULL_SCREEN_CHANGE="fullscreenchange",$B.DEVICE_LOST="devicelost",$B.MESH_CHANGED="meshchanged",$B.MATERIAL_CHANGED="materialchanged",$B.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$B.ANIMATION_CHANGED="animationchanged",$B.TRIGGER_ENTER="triggerenter",$B.TRIGGER_STAY="triggerstay",$B.TRIGGER_EXIT="triggerexit",$B.TRAIL_FILTER_CHANGE="trailfilterchange",$B.DOMINO_FILTER_CHANGE="dominofilterchange",$B}(),$e=(function(){function $B(){}$w($B,"laya.events.Keyboard"),$B.NUMBER_0=48,$B.NUMBER_1=49,$B.NUMBER_2=50,$B.NUMBER_3=51,$B.NUMBER_4=52,$B.NUMBER_5=53,$B.NUMBER_6=54,$B.NUMBER_7=55,$B.NUMBER_8=56,$B.NUMBER_9=57,$B.A=65,$B.B=66,$B.C=67,$B.D=68,$B.E=69,$B.F=70,$B.G=71,$B.H=72,$B.I=73,$B.J=74,$B.K=75,$B.L=76,$B.M=77,$B.N=78,$B.O=79,$B.P=80,$B.Q=81,$B.R=82,$B.S=83,$B.T=84,$B.U=85,$B.V=86,$B.W=87,$B.X=88,$B.Y=89,$B.Z=90,$B.F1=112,$B.F2=113,$B.F3=114,$B.F4=115,$B.F5=116,$B.F6=117,$B.F7=118,$B.F8=119,$B.F9=120,$B.F10=121,$B.F11=122,$B.F12=123,$B.F13=124,$B.F14=125,$B.F15=126,$B.NUMPAD=21,$B.NUMPAD_0=96,$B.NUMPAD_1=97,$B.NUMPAD_2=98,$B.NUMPAD_3=99,$B.NUMPAD_4=100,$B.NUMPAD_5=101,$B.NUMPAD_6=102,$B.NUMPAD_7=103,$B.NUMPAD_8=104,$B.NUMPAD_9=105,$B.NUMPAD_ADD=107,$B.NUMPAD_DECIMAL=110,$B.NUMPAD_DIVIDE=111,$B.NUMPAD_ENTER=108,$B.NUMPAD_MULTIPLY=106,$B.NUMPAD_SUBTRACT=109,$B.SEMICOLON=186,$B.EQUAL=187,$B.COMMA=188,$B.MINUS=189,$B.PERIOD=190,$B.SLASH=191,$B.BACKQUOTE=192,$B.LEFTBRACKET=219,$B.BACKSLASH=220,$B.RIGHTBRACKET=221,$B.QUOTE=222,$B.ALTERNATE=18,$B.BACKSPACE=8,$B.CAPS_LOCK=20,$B.COMMAND=15,$B.CONTROL=17,$B.DELETE=46,$B.ENTER=13,$B.ESCAPE=27,$B.PAGE_UP=33,$B.PAGE_DOWN=34,$B.END=35,$B.HOME=36,$B.LEFT=37,$B.UP=38,$B.RIGHT=39,$B.DOWN=40,$B.SHIFT=16,$B.SPACE=32,$B.TAB=9,$B.INSERT=45}(),function(){function $g(){}return $w($g,"laya.events.KeyBoardManager"),$g.__init__=function(){$g._addEvent("keydown"),$g._addEvent("keypress"),$g._addEvent("keyup")},$g._addEvent=function($_){$K.document.addEventListener($_,function($B){laya.events.KeyBoardManager._dispatch($B,$_)},!0)},$g._dispatch=function($B,$_){if($g.enabled){$g._event._stoped=!1,$g._event.nativeEvent=$B,$g._event.keyCode=$B.keyCode||$B.which||$B.charCode,"keydown"===$_?$g._pressKeys[$g._event.keyCode]=!0:"keyup"===$_&&($g._pressKeys[$g._event.keyCode]=null);for(var $Z=$N.stage.focus&&null!=$N.stage.focus.event&&$N.stage.focus.displayedInStage?$N.stage.focus:$N.stage,$n=$Z;$n;)$n.event($_,$g._event.setTo($_,$n,$Z)),$n=$n.parent}},$g.hasKeyDown=function($B){return $g._pressKeys[$B]},$g._pressKeys={},$g.enabled=!0,$m($g,["_event",function(){return this._event=new $q}]),$g}()),$$=(function(){function $B(){}$w($B,"laya.events.KeyLocation"),$B.STANDARD=0,$B.LEFT=1,$B.RIGHT=2,$B.NUM_PAD=3}(),function(){function $T(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$K.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $q,this._matrix=new $V,this._point=new $Q,this._rect=new $M,this._prePoint=new $Q,this._curTouchID=NaN}$w($T,"laya.events.MouseManager");var $B=$T.prototype;return $B.__init__=function($B,$_){var $Z=this;this._stage=$B;var $n=this,$g=this._eventList;$_.oncontextmenu=function($B){if($T.enabled)return!1},$_.addEventListener("mousedown",function($B){$T.enabled&&($K.onIE||$B.preventDefault(),$g.push($B),$n.mouseDownTime=$K.now())}),$_.addEventListener("mouseup",function($B){$T.enabled&&($B.preventDefault(),$g.push($B),$n.mouseDownTime=-$K.now())},!0),$_.addEventListener("mousemove",function($B){if($T.enabled){$B.preventDefault();var $_=$K.now();if($_-$n._lastMoveTimer<10)return;$n._lastMoveTimer=$_,$g.push($B)}},!0),$_.addEventListener("mouseout",function($B){$T.enabled&&$g.push($B)}),$_.addEventListener("mouseover",function($B){$T.enabled&&$g.push($B)}),$_.addEventListener("touchstart",function($B){$T.enabled&&($g.push($B),$T._isFirstTouch||$tB.isInputting||$B.preventDefault(),$n.mouseDownTime=$K.now())}),$_.addEventListener("touchend",function($B){$T.enabled?($T._isFirstTouch||$tB.isInputting||$B.preventDefault(),$T._isFirstTouch=!1,$g.push($B),$n.mouseDownTime=-$K.now()):$Z._curTouchID=NaN},!0),$_.addEventListener("touchmove",function($B){$T.enabled&&($B.preventDefault(),$g.push($B))},!0),$_.addEventListener("touchcancel",function($B){$T.enabled?($B.preventDefault(),$g.push($B)):$Z._curTouchID=NaN},!0),$_.addEventListener("mousewheel",function($B){$T.enabled&&$g.push($B)}),$_.addEventListener("DOMMouseScroll",function($B){$T.enabled&&$g.push($B)})},$B.initEvent=function($B,$_){var $Z;this._event._stoped=!1,this._event.nativeEvent=$_||$B,this._target=null,this._point.setTo($B.pageX||$B.clientX,$B.pageY||$B.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$B.identifier||0,this._tTouchID=this._event.touchId,($Z=$r.I._event)._stoped=!1,$Z.nativeEvent=this._event.nativeEvent,$Z.touchId=this._event.touchId},$B.checkMouseWheel=function($B){this._event.delta=$B.wheelDelta?.025*$B.wheelDelta:-$B.detail;for(var $_=$r.I.getLastOvers(),$Z=0,$n=$_.length;$Z<$n;$Z++){var $g=$_[$Z];$g.event("mousewheel",this._event.setTo("mousewheel",$g,this._target))}},$B.onMouseMove=function($B){$r.I.onMouseMove($B,this._tTouchID)},$B.onMouseDown=function($B){if($tB.isInputting&&$N.stage.focus&&$N.stage.focus.focus&&!$N.stage.focus.contains(this._target)){var $_=$N.stage.focus._tf||$N.stage.focus,$Z=$B._tf||$B;$Z instanceof laya.display.Input&&$Z.multiline==$_.multiline?$_._focusOut():$_.focus=!1}$r.I.onMouseDown($B,this._tTouchID,this._isLeftMouse)},$B.onMouseUp=function($B){$r.I.onMouseUp($B,this._tTouchID,this._isLeftMouse)},$B.check=function($B,$_,$Z,$n){this._point.setTo($_,$Z),$B.fromParentPoint(this._point),$_=this._point.x,$Z=this._point.y;var $g=$B.scrollRect;if($g&&(this._rect.setTo($g.x,$g.y,$g.width,$g.height),!this._rect.contains($_,$Z)))return!1;if(!this.disableMouseEvent){if($B.hitTestPrior&&!$B.mouseThrough&&!this.hitTest($B,$_,$Z))return!1;for(var $q=$B._childs.length-1;-1<$q;$q--){var $P=$B._childs[$q];if(!$P.destroyed&&$P.mouseEnabled&&$P.visible&&this.check($P,$_,$Z,$n))return!0}}var $k=!(!$B.hitTestPrior||$B.mouseThrough||this.disableMouseEvent)||this.hitTest($B,$_,$Z);return $k?(this._target=$B,$n.call(this,$B)):$n===this.onMouseUp&&$B===this._stage&&(this._target=this._stage,$n.call(this,this._target)),$k},$B.hitTest=function($B,$_,$Z){var $n=!1;if($B.scrollRect&&($_-=$B.scrollRect.x,$Z-=$B.scrollRect.y),$B.hitArea instanceof laya.utils.HitArea)return $B.hitArea.isHit($_,$Z);if(0<$B.width&&0<$B.height||$B.mouseThrough||$B.hitArea)if($B.mouseThrough)$n=$B.getGraphicBounds().contains($_,$Z);else{var $g=this._rect;$B.hitArea?$g=$B.hitArea:$g.setTo(0,0,$B.width,$B.height),$n=$g.contains($_,$Z)}return $n},$B.runEvent=function(){var $B=this._eventList.length;if($B){var $_=this;$_.mouseEventTime=$K.now();var $Z,$n=0,$g=0,$q=0;try{for(;$n<$B;){var $P=this._eventList[$n];switch("mousemove"!==$P.type&&(this._prePoint.x=this._prePoint.y=-1e6),$P.type){case"mousedown":this._touchIDs[0]=this._id++,$T._isTouchRespond?$T._isTouchRespond=!1:($_._isLeftMouse=0===$P.button,$_.initEvent($P),$_.check($_._stage,$_.mouseX,$_.mouseY,$_.onMouseDown));break;case"mouseup":$_._isLeftMouse=0===$P.button,$_.initEvent($P),$_.check($_._stage,$_.mouseX,$_.mouseY,$_.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$P.clientX)+Math.abs(this._prePoint.y-$P.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$P.clientX,this._prePoint.y=$P.clientY,$_.initEvent($P),$_.check($_._stage,$_.mouseX,$_.mouseY,$_.onMouseMove));break;case"touchstart":$T._isTouchRespond=!0,$_._isLeftMouse=!0;var $k=$P.changedTouches;for($g=0,$q=$k.length;$g<$q;$g++)$Z=$k[$g],($T.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$Z.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$Z.identifier]=this._id++,$_.initEvent($Z,$P),$_.check($_._stage,$_.mouseX,$_.mouseY,$_.onMouseDown));break;case"touchend":case"touchcancel":$T._isTouchRespond=!0,$_._isLeftMouse=!0;var $m=$P.changedTouches;for($g=0,$q=$m.length;$g<$q;$g++)if($Z=$m[$g],$T.multiTouchEnabled||$Z.identifier==this._curTouchID){this._curTouchID=NaN,$_.initEvent($Z,$P);$_.check($_._stage,$_.mouseX,$_.mouseY,$_.onMouseUp)||$_.onMouseUp(null)}break;case"touchmove":var $D=$P.changedTouches;for($g=0,$q=$D.length;$g<$q;$g++)$Z=$D[$g],($T.multiTouchEnabled||$Z.identifier==this._curTouchID)&&($_.initEvent($Z,$P),$_.check($_._stage,$_.mouseX,$_.mouseY,$_.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$_.checkMouseWheel($P);break;case"mouseout":$r.I.stageMouseOut();break;case"mouseover":$_._stage.event("mouseover",$_._event.setTo("mouseover",$_._stage,$_._stage))}$n++}}catch($B){throw this._eventList.length=0,$B}this._eventList.length=0}},$T.enabled=!0,$T.multiTouchEnabled=!0,$T._isTouchRespond=!1,$T._isFirstTouch=!0,$m($T,["instance",function(){return this.instance=new $T}]),$T}()),$r=function(){function $$(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $q}$w($$,"laya.events.TouchManager");var $B=$$.prototype;return $B._clearTempArrs=function(){$$._oldArr.length=0,$$._newArr.length=0,$$._tEleArr.length=0},$B.getTouchFromArr=function($B,$_){var $Z,$n,$g=0;for($Z=$_.length,$g=0;$g<$Z;$g++)if(($n=$_[$g]).id==$B)return $n;return null},$B.removeTouchFromArr=function($B,$_){var $Z=0;for($Z=$_.length-1;0<=$Z;$Z--)$_[$Z].id==$B&&$_.splice($Z,1)},$B.createTouchO=function($B,$_){var $Z;return($Z=$U.getItem("TouchData")||{}).id=$_,$Z.tar=$B,$Z},$B.onMouseDown=function($B,$_,$Z){var $n,$g,$q,$P;(void 0===$Z&&($Z=!1),this.enable)&&($n=this.getTouchFromArr($_,this.preOvers),$q=this.getEles($B,null,$$._tEleArr),$n?$n.tar=$B:($g=this.createTouchO($B,$_),this.preOvers.push($g)),$K.onMobile&&this.sendEvents($q,"mouseover",$_),$P=$Z?this.preDowns:this.preRightDowns,($n=this.getTouchFromArr($_,$P))?$n.tar=$B:($g=this.createTouchO($B,$_),$P.push($g)),this.sendEvents($q,$Z?"mousedown":"rightmousedown",$_),this._clearTempArrs())},$B.sendEvents=function($B,$_,$Z){void 0===$Z&&($Z=0);var $n,$g,$q,$P=0;for($n=$B.length,this._event._stoped=!1,$g=$B[0],$P=0;$P<$n;$P++){if(($q=$B[$P]).destroyed)return;if($q.event($_,this._event.setTo($_,$q,$g)),this._event._stoped)break}},$B.getEles=function($B,$_,$Z){for($Z?$Z.length=0:$Z=[];$B&&$B!=$_;)$Z.push($B),$B=$B.parent;return $Z},$B.checkMouseOutAndOverOfMove=function($B,$_,$Z){if(void 0===$Z&&($Z=0),$_!=$B){var $n,$g,$q=0,$P=0;if($_.contains($B))$g=this.getEles($B,$_,$$._tEleArr),this.sendEvents($g,"mouseover",$Z);else if($B.contains($_))$g=this.getEles($_,$B,$$._tEleArr),this.sendEvents($g,"mouseout",$Z);else{var $k,$m;($g=$$._tEleArr).length=0,$k=this.getEles($_,null,$$._oldArr),$m=this.getEles($B,null,$$._newArr),$P=$k.length;var $D=0;for($q=0;$q<$P;$q++){if($n=$k[$q],0<=($D=$m.indexOf($n))){$m.splice($D,$m.length-$D);break}$g.push($n)}0<$g.length&&this.sendEvents($g,"mouseout",$Z),0<$m.length&&this.sendEvents($m,"mouseover",$Z)}}},$B.onMouseMove=function($B,$_){var $Z,$n;this.enable&&(($Z=this.getTouchFromArr($_,this.preOvers))?(this.checkMouseOutAndOverOfMove($B,$Z.tar),$Z.tar=$B,$n=this.getEles($B,null,$$._tEleArr)):($n=this.getEles($B,null,$$._tEleArr),this.sendEvents($n,"mouseover",$_),this.preOvers.push(this.createTouchO($B,$_))),this.sendEvents($n,"mousemove",$_),this._clearTempArrs())},$B.getLastOvers=function(){return($$._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$$._tEleArr):($$._tEleArr.push($N.stage),$$._tEleArr)},$B.stageMouseOut=function(){var $B;$B=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($B,"mouseout",0)},$B.onMouseUp=function($B,$_,$Z){if(void 0===$Z&&($Z=!1),this.enable){var $n,$g,$q,$P,$k,$m,$D=0,$T=0,$e=$K.onMobile;if($g=this.getEles($B,null,$$._tEleArr),this.sendEvents($g,$Z?"mouseup":"rightmouseup",$_),$m=$Z?this.preDowns:this.preRightDowns,$n=this.getTouchFromArr($_,$m)){var $I,$A=$K.now();if($I=$A-this._lastClickTime<300,this._lastClickTime=$A,$B==$n.tar)$k=$g;else for($q=this.getEles($n.tar,null,$$._oldArr),($k=$$._newArr).length=0,$T=$q.length,$D=0;$D<$T;$D++)$P=$q[$D],0<=$g.indexOf($P)&&$k.push($P);0<$k.length&&this.sendEvents($k,$Z?"click":"rightclick",$_),$Z&&$I&&this.sendEvents($k,"doubleclick",$_),this.removeTouchFromArr($_,$m),$n.tar=null,$U.recover("TouchData",$n)}else;($n=this.getTouchFromArr($_,this.preOvers))&&$e&&(($k=this.getEles($n.tar,null,$k))&&0<$k.length&&this.sendEvents($k,"mouseout",$_),this.removeTouchFromArr($_,this.preOvers),$n.tar=null,$U.recover("TouchData",$n)),this._clearTempArrs()}},$$._oldArr=[],$$._newArr=[],$$._tEleArr=[],$m($$,["I",function(){return this.I=new $$}]),$$}(),$j=function(){function $B(){this._action=null}$w($B,"laya.filters.Filter");var $_=$B.prototype;return $N.imps($_,{"laya.filters.IFilter":!0}),$_.callNative=function($B){},$T(0,$_,"type",function(){return-1}),$T(0,$_,"action",function(){return this._action}),$B.BLUR=16,$B.COLOR=32,$B.GLOW=8,$B._filterStart=null,$B._filterEnd=null,$B._EndTarget=null,$B._recycleScope=null,$B._filter=null,$B._useSrc=null,$B._endSrc=null,$B._useOut=null,$B._endOut=null,$B}(),$C=function(){function $B(){this.data=null}$w($B,"laya.filters.ColorFilterAction");var $_=$B.prototype;return $N.imps($_,{"laya.filters.IFilterAction":!0}),$_.apply=function($B){var $_=$B.ctx.ctx,$Z=$B.ctx.ctx.canvas;if(0==$Z.width||0==$Z.height)return $Z;for(var $n,$g=$_.getImageData(0,0,$Z.width,$Z.height),$q=$g.data,$P=0,$k=$q.length;$P<$k;$P+=4)$n=this.getColor($q[$P],$q[$P+1],$q[$P+2],$q[$P+3]),0!=$q[$P+3]&&($q[$P]=$n[0],$q[$P+1]=$n[1],$q[$P+2]=$n[2],$q[$P+3]=$n[3]);return $_.putImageData($g,0,0),$B},$_.getColor=function($B,$_,$Z,$n){var $g=[];if(this.data._mat&&this.data._alpha){var $q=this.data._mat,$P=this.data._alpha;$g[0]=$q[0]*$B+$q[1]*$_+$q[2]*$Z+$q[3]*$n+$P[0],$g[1]=$q[4]*$B+$q[5]*$_+$q[6]*$Z+$q[7]*$n+$P[1],$g[2]=$q[8]*$B+$q[9]*$_+$q[10]*$Z+$q[11]*$n+$P[2],$g[3]=$q[12]*$B+$q[13]*$_+$q[14]*$Z+$q[15]*$n+$P[3]}return $g},$B}(),$z=(function(){function $B(){}$w($B,"laya.maths.Arith"),$B.formatR=function($B){return $B>Math.PI&&($B-=2*Math.PI),$B<-Math.PI&&($B+=2*Math.PI),$B},$B.isPOT=function($B,$_){return 0<$B&&0==($B&$B-1)&&0<$_&&0==($_&$_-1)},$B.setMatToArray=function($B,$_){$B.a,$B.b,$B.c,$B.d,$B.tx,$B.ty,$_[0]=$B.a,$_[1]=$B.b,$_[4]=$B.c,$_[5]=$B.d,$_[12]=$B.tx,$_[13]=$B.ty}}(),function(){function $B(){this._controlPoints=[new $Q,new $Q,new $Q],this._calFun=this.getPoint2}$w($B,"laya.maths.Bezier");var $_=$B.prototype;return $_._switchPoint=function($B,$_){var $Z=this._controlPoints.shift();$Z.setTo($B,$_),this._controlPoints.push($Z)},$_.getPoint2=function($B,$_){var $Z=this._controlPoints[0],$n=this._controlPoints[1],$g=this._controlPoints[2],$q=Math.pow(1-$B,2)*$Z.x+2*$B*(1-$B)*$n.x+Math.pow($B,2)*$g.x,$P=Math.pow(1-$B,2)*$Z.y+2*$B*(1-$B)*$n.y+Math.pow($B,2)*$g.y;$_.push($q,$P)},$_.getPoint3=function($B,$_){var $Z=this._controlPoints[0],$n=this._controlPoints[1],$g=this._controlPoints[2],$q=this._controlPoints[3],$P=Math.pow(1-$B,3)*$Z.x+3*$n.x*$B*(1-$B)*(1-$B)+3*$g.x*$B*$B*(1-$B)+$q.x*Math.pow($B,3),$k=Math.pow(1-$B,3)*$Z.y+3*$n.y*$B*(1-$B)*(1-$B)+3*$g.y*$B*$B*(1-$B)+$q.y*Math.pow($B,3);$_.push($P,$k)},$_.insertPoints=function($B,$_){var $Z,$n=NaN;for($Z=1/($B=0<$B?$B:5),$n=0;$n<=1;$n+=$Z)this._calFun($n,$_)},$_.getBezierPoints=function($B,$_,$Z){void 0===$_&&($_=5),void 0===$Z&&($Z=2);var $n,$g,$q=0;if(($n=$B.length)<2*($Z+1))return[];switch($g=[],$Z){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$Z;)this._controlPoints.push(new $Q);for($q=0;$q<2*$Z;$q+=2)this._switchPoint($B[$q],$B[$q+1]);for($q=2*$Z;$q<$n;$q+=2)this._switchPoint($B[$q],$B[$q+1]),$q/2%$Z==0&&this.insertPoints($_,$g);return $g},$m($B,["I",function(){return this.I=new $B}]),$B}()),$t=function(){function $D(){}return $w($D,"laya.maths.GrahamScan"),$D.multiply=function($B,$_,$Z){return($B.x-$Z.x)*($_.y-$Z.y)-($_.x-$Z.x)*($B.y-$Z.y)},$D.dis=function($B,$_){return($B.x-$_.x)*($B.x-$_.x)+($B.y-$_.y)*($B.y-$_.y)},$D._getPoints=function($B,$_,$Z){for(void 0===$_&&($_=!1),$D._mPointList||($D._mPointList=[]);$D._mPointList.length<$B;)$D._mPointList.push(new $Q);return $Z||($Z=[]),$Z.length=0,$_?$D.getFrom($Z,$D._mPointList,$B):$D.getFromR($Z,$D._mPointList,$B),$Z},$D.getFrom=function($B,$_,$Z){var $n=0;for($n=0;$n<$Z;$n++)$B.push($_[$n]);return $B},$D.getFromR=function($B,$_,$Z){var $n=0;for($n=0;$n<$Z;$n++)$B.push($_.pop());return $B},$D.pListToPointList=function($B,$_){void 0===$_&&($_=!1);var $Z=0,$n=$B.length/2,$g=$D._getPoints($n,$_,$D._tempPointList);for($Z=0;$Z<$n;$Z++)$g[$Z].setTo($B[$Z+$Z],$B[$Z+$Z+1]);return $g},$D.pointListToPlist=function($B){var $_,$Z=0,$n=$B.length,$g=$D._temPList;for($Z=$g.length=0;$Z<$n;$Z++)$_=$B[$Z],$g.push($_.x,$_.y);return $g},$D.scanPList=function($B){return $a.copyArray($B,$D.pointListToPlist($D.scan($D.pListToPointList($B,!0))))},$D.scan=function($B){var $_,$Z,$n,$g=0,$q=0,$P=0,$k=$B.length,$m={};for(($Z=$D._temArr).length=0,$g=($k=$B.length)-1;0<=$g;$g--)$n=($_=$B[$g]).x+"_"+$_.y,$m.hasOwnProperty($n)||($m[$n]=!0,$Z.push($_));for($k=$Z.length,$a.copyArray($B,$Z),$g=1;$g<$k;$g++)($B[$g].y<$B[$P].y||$B[$g].y==$B[$P].y&&$B[$g].x<$B[$P].x)&&($P=$g);for($_=$B[0],$B[0]=$B[$P],$B[$P]=$_,$g=1;$g<$k-1;$g++){for($q=($P=$g)+1;$q<$k;$q++)(0<$D.multiply($B[$q],$B[$P],$B[0])||0==$D.multiply($B[$q],$B[$P],$B[0])&&$D.dis($B[0],$B[$q])<$D.dis($B[0],$B[$P]))&&($P=$q);$_=$B[$g],$B[$g]=$B[$P],$B[$P]=$_}if(($Z=$D._temArr).length=0,$B.length<3)return $a.copyArray($Z,$B);for($Z.push($B[0],$B[1],$B[2]),$g=3;$g<$k;$g++){for(;2<=$Z.length&&0<=$D.multiply($B[$g],$Z[$Z.length-1],$Z[$Z.length-2]);)$Z.pop();$B[$g]&&$Z.push($B[$g])}return $Z},$D._mPointList=null,$D._tempPointList=[],$D._temPList=[],$D._temArr=[],$D}(),$J=function(){function $g(){}return $w($g,"laya.maths.MathUtil"),$g.subtractVector3=function($B,$_,$Z){$Z[0]=$B[0]-$_[0],$Z[1]=$B[1]-$_[1],$Z[2]=$B[2]-$_[2]},$g.lerp=function($B,$_,$Z){return $B*(1-$Z)+$_*$Z},$g.scaleVector3=function($B,$_,$Z){$Z[0]=$B[0]*$_,$Z[1]=$B[1]*$_,$Z[2]=$B[2]*$_},$g.lerpVector3=function($B,$_,$Z,$n){var $g=$B[0],$q=$B[1],$P=$B[2];$n[0]=$g+$Z*($_[0]-$g),$n[1]=$q+$Z*($_[1]-$q),$n[2]=$P+$Z*($_[2]-$P)},$g.lerpVector4=function($B,$_,$Z,$n){var $g=$B[0],$q=$B[1],$P=$B[2],$k=$B[3];$n[0]=$g+$Z*($_[0]-$g),$n[1]=$q+$Z*($_[1]-$q),$n[2]=$P+$Z*($_[2]-$P),$n[3]=$k+$Z*($_[3]-$k)},$g.slerpQuaternionArray=function($B,$_,$Z,$n,$g,$q,$P){var $k,$m,$D,$T,$e,$I=$B[$_+0],$A=$B[$_+1],$$=$B[$_+2],$w=$B[$_+3],$r=$Z[$n+0],$j=$Z[$n+1],$y=$Z[$n+2],$C=$Z[$n+3];return($m=$I*$r+$A*$j+$$*$y+$w*$C)<0&&($m=-$m,$r=-$r,$j=-$j,$y=-$y,$C=-$C),$e=1e-6<1-$m?($k=Math.acos($m),$D=Math.sin($k),$T=Math.sin((1-$g)*$k)/$D,Math.sin($g*$k)/$D):($T=1-$g,$g),$q[$P+0]=$T*$I+$e*$r,$q[$P+1]=$T*$A+$e*$j,$q[$P+2]=$T*$$+$e*$y,$q[$P+3]=$T*$w+$e*$C,$q},$g.getRotation=function($B,$_,$Z,$n){return Math.atan2($n-$_,$Z-$B)/Math.PI*180},$g.sortBigFirst=function($B,$_){return $B==$_?0:$B<$_?1:-1},$g.sortSmallFirst=function($B,$_){return $B==$_?0:$B<$_?-1:1},$g.sortNumBigFirst=function($B,$_){return parseFloat($_)-parseFloat($B)},$g.sortNumSmallFirst=function($B,$_){return parseFloat($B)-parseFloat($_)},$g.sortByKey=function($Z,$B,$_){var $n;return void 0===$B&&($B=!1),void 0===$_&&($_=!0),$n=$B?$_?$g.sortNumBigFirst:$g.sortBigFirst:$_?$g.sortNumSmallFirst:$g.sortSmallFirst,function($B,$_){return $n($B[$Z],$_[$Z])}},$g}(),$V=function(){function $Z($B,$_,$Z,$n,$g,$q){this.inPool=!1,this.bTransform=!1,void 0===$B&&($B=1),void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=1),void 0===$g&&($g=0),void 0===$q&&($q=0),this.a=$B,this.b=$_,this.c=$Z,this.d=$n,this.tx=$g,this.ty=$q,this._checkTransform()}$w($Z,"laya.maths.Matrix");var $B=$Z.prototype;return $B.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$B._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$B.setTranslate=function($B,$_){return this.tx=$B,this.ty=$_,this},$B.translate=function($B,$_){return this.tx+=$B,this.ty+=$_,this},$B.scale=function($B,$_){this.a*=$B,this.d*=$_,this.c*=$B,this.b*=$_,this.tx*=$B,this.ty*=$_,this.bTransform=!0},$B.rotate=function($B){var $_=Math.cos($B),$Z=Math.sin($B),$n=this.a,$g=this.c,$q=this.tx;this.a=$n*$_-this.b*$Z,this.b=$n*$Z+this.b*$_,this.c=$g*$_-this.d*$Z,this.d=$g*$Z+this.d*$_,this.tx=$q*$_-this.ty*$Z,this.ty=$q*$Z+this.ty*$_,this.bTransform=!0},$B.skew=function($B,$_){var $Z=Math.tan($B),$n=Math.tan($_),$g=this.a,$q=this.b;return this.a+=$n*this.c,this.b+=$n*this.d,this.c+=$Z*$g,this.d+=$Z*$q,this},$B.invertTransformPoint=function($B){var $_=this.a,$Z=this.b,$n=this.c,$g=this.d,$q=this.tx,$P=$_*$g-$Z*$n,$k=$g/$P,$m=-$Z/$P,$D=-$n/$P,$T=$_/$P,$e=($n*this.ty-$g*$q)/$P,$I=-($_*this.ty-$Z*$q)/$P;return $B.setTo($k*$B.x+$D*$B.y+$e,$m*$B.x+$T*$B.y+$I)},$B.transformPoint=function($B){return $B.setTo(this.a*$B.x+this.c*$B.y+this.tx,this.b*$B.x+this.d*$B.y+this.ty)},$B.transformPointN=function($B){return $B.setTo(this.a*$B.x+this.c*$B.y,this.b*$B.x+this.d*$B.y)},$B.transformPointArray=function($B,$_){for(var $Z=$B.length,$n=0;$n<$Z;$n+=2){var $g=$B[$n],$q=$B[$n+1];$_[$n]=this.a*$g+this.c*$q+this.tx,$_[$n+1]=this.b*$g+this.d*$q+this.ty}return $_},$B.transformPointArrayScale=function($B,$_){for(var $Z=$B.length,$n=0;$n<$Z;$n+=2){var $g=$B[$n],$q=$B[$n+1];$_[$n]=this.a*$g+this.c*$q,$_[$n+1]=this.b*$g+this.d*$q}return $_},$B.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$B.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$B.invert=function(){var $B=this.a,$_=this.b,$Z=this.c,$n=this.d,$g=this.tx,$q=$B*$n-$_*$Z;return this.a=$n/$q,this.b=-$_/$q,this.c=-$Z/$q,this.d=$B/$q,this.tx=($Z*this.ty-$n*$g)/$q,this.ty=-($B*this.ty-$_*$g)/$q,this},$B.setTo=function($B,$_,$Z,$n,$g,$q){return this.a=$B,this.b=$_,this.c=$Z,this.d=$n,this.tx=$g,this.ty=$q,this},$B.concat=function($B){var $_=this.a,$Z=this.c,$n=this.tx;return this.a=$_*$B.a+this.b*$B.c,this.b=$_*$B.b+this.b*$B.d,this.c=$Z*$B.a+this.d*$B.c,this.d=$Z*$B.b+this.d*$B.d,this.tx=$n*$B.a+this.ty*$B.c+$B.tx,this.ty=$n*$B.b+this.ty*$B.d+$B.ty,this},$B.scaleEx=function($B,$_){var $Z=this.a,$n=this.b,$g=this.c,$q=this.d;0!==$n||0!==$g?(this.a=$B*$Z,this.b=$B*$n,this.c=$_*$g):(this.a=$B*$Z,this.b=0*$q,this.c=0*$Z),this.d=$_*$q,this.bTransform=!0},$B.rotateEx=function($B){var $_=Math.cos($B),$Z=Math.sin($B),$n=this.a,$g=this.b,$q=this.c,$P=this.d;0!==$g||0!==$q?(this.a=$_*$n+$Z*$q,this.b=$_*$g+$Z*$P,this.c=-$Z*$n+$_*$q,this.d=-$Z*$g+$_*$P):(this.a=$_*$n,this.b=$Z*$P,this.c=-$Z*$n,this.d=$_*$P),this.bTransform=!0},$B.clone=function(){var $B=$Z.create();return $B.a=this.a,$B.b=this.b,$B.c=this.c,$B.d=this.d,$B.tx=this.tx,$B.ty=this.ty,$B.bTransform=this.bTransform,$B},$B.copyTo=function($B){return $B.a=this.a,$B.b=this.b,$B.c=this.c,$B.d=this.d,$B.tx=this.tx,$B.ty=this.ty,$B.bTransform=this.bTransform,$B},$B.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$B.destroy=function(){if(!this.inPool){var $B=$Z._cache;this.inPool=!0,$B._length||($B._length=0),($B[$B._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$Z.mul=function($B,$_,$Z){var $n=$B.a,$g=$B.b,$q=$B.c,$P=$B.d,$k=$B.tx,$m=$B.ty,$D=$_.a,$T=$_.b,$e=$_.c,$I=$_.d,$A=$_.tx,$$=$_.ty;return 0!==$T||0!==$e?($Z.a=$n*$D+$g*$e,$Z.b=$n*$T+$g*$I,$Z.c=$q*$D+$P*$e,$Z.d=$q*$T+$P*$I,$Z.tx=$D*$k+$e*$m+$A,$Z.ty=$T*$k+$I*$m+$$):($Z.a=$n*$D,$Z.b=$g*$I,$Z.c=$q*$D,$Z.d=$P*$I,$Z.tx=$D*$k+$A,$Z.ty=$I*$m+$$),$Z},$Z.mul16=function($B,$_,$Z){var $n=$B.a,$g=$B.b,$q=$B.c,$P=$B.d,$k=$B.tx,$m=$B.ty,$D=$_.a,$T=$_.b,$e=$_.c,$I=$_.d,$A=$_.tx,$$=$_.ty;return 0!==$T||0!==$e?($Z[0]=$n*$D+$g*$e,$Z[1]=$n*$T+$g*$I,$Z[4]=$q*$D+$P*$e,$Z[5]=$q*$T+$P*$I,$Z[12]=$D*$k+$e*$m+$A,$Z[13]=$T*$k+$I*$m+$$):($Z[0]=$n*$D,$Z[1]=$g*$I,$Z[4]=$q*$D,$Z[5]=$P*$I,$Z[12]=$D*$k+$A,$Z[13]=$I*$m+$$),$Z},$Z.mulPre=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=$B.a,$D=$B.b,$T=$B.c,$e=$B.d,$I=$B.tx,$A=$B.ty;return 0!==$Z||0!==$n?($k.a=$m*$_+$D*$n,$k.b=$m*$Z+$D*$g,$k.c=$T*$_+$e*$n,$k.d=$T*$Z+$e*$g,$k.tx=$_*$I+$n*$A+$q,$k.ty=$Z*$I+$g*$A+$P):($k.a=$m*$_,$k.b=$D*$g,$k.c=$T*$_,$k.d=$e*$g,$k.tx=$_*$I+$q,$k.ty=$g*$A+$P),$k},$Z.mulPos=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=$B.a,$D=$B.b,$T=$B.c,$e=$B.d,$I=$B.tx,$A=$B.ty;return 0!==$D||0!==$T?($k.a=$_*$m+$Z*$T,$k.b=$_*$D+$Z*$e,$k.c=$n*$m+$g*$T,$k.d=$n*$D+$g*$e,$k.tx=$m*$q+$T*$P+$I,$k.ty=$D*$q+$e*$P+$A):($k.a=$_*$m,$k.b=$Z*$e,$k.c=$n*$m,$k.d=$g*$e,$k.tx=$m*$q+$I,$k.ty=$e*$P+$A),$k},$Z.preMul=function($B,$_,$Z){var $n=$B.a,$g=$B.b,$q=$B.c,$P=$B.d,$k=$_.a,$m=$_.b,$D=$_.c,$T=$_.d,$e=$_.tx,$I=$_.ty;return $Z.a=$k*$n,$Z.b=$Z.c=0,$Z.d=$T*$P,$Z.tx=$e*$n+$B.tx,$Z.ty=$I*$P+$B.ty,0===$m&&0===$D&&0===$g&&0===$q||($Z.a+=$m*$q,$Z.d+=$D*$g,$Z.b+=$k*$g+$m*$P,$Z.c+=$D*$n+$T*$q,$Z.tx+=$I*$q,$Z.ty+=$e*$g),$Z},$Z.preMulXY=function($B,$_,$Z,$n){var $g=$B.a,$q=$B.b,$P=$B.c,$k=$B.d;return $n.a=$g,$n.b=$q,$n.c=$P,$n.d=$k,$n.tx=$_*$g+$B.tx+$Z*$P,$n.ty=$Z*$k+$B.ty+$_*$q,$n},$Z.create=function(){var $B=$Z._cache,$_=$B._length?$B[--$B._length]:new $Z;return $_.inPool=!1,$_},$Z.EMPTY=new $Z,$Z.TEMP=new $Z,$Z._cache=[],$Z}(),$Q=function(){function $B($B,$_){void 0===$B&&($B=0),void 0===$_&&($_=0),this.x=$B,this.y=$_}$w($B,"laya.maths.Point");var $_=$B.prototype;return $_.setTo=function($B,$_){return this.x=$B,this.y=$_,this},$_.distance=function($B,$_){return Math.sqrt((this.x-$B)*(this.x-$B)+(this.y-$_)*(this.y-$_))},$_.toString=function(){return this.x+","+this.y},$_.normalize=function(){var $B=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$B){var $_=1/$B;this.x*=$_,this.y*=$_}},$B.TEMP=new $B,$B.EMPTY=new $B,$B}(),$M=function(){function $D($B,$_,$Z,$n){void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0),this.x=$B,this.y=$_,this.width=$Z,this.height=$n}$w($D,"laya.maths.Rectangle");var $B=$D.prototype;return $B.setTo=function($B,$_,$Z,$n){return this.x=$B,this.y=$_,this.width=$Z,this.height=$n,this},$B.copyFrom=function($B){return this.x=$B.x,this.y=$B.y,this.width=$B.width,this.height=$B.height,this},$B.contains=function($B,$_){return!(this.width<=0||this.height<=0)&&($B>=this.x&&$B<this.right&&$_>=this.y&&$_<this.bottom)},$B.intersects=function($B){return!($B.x>this.x+this.width||$B.x+$B.width<this.x||$B.y>this.y+this.height||$B.y+$B.height<this.y)},$B.intersection=function($B,$_){return this.intersects($B)?($_||($_=new $D),$_.x=Math.max(this.x,$B.x),$_.y=Math.max(this.y,$B.y),$_.width=Math.min(this.right,$B.right)-$_.x,$_.height=Math.min(this.bottom,$B.bottom)-$_.y,$_):null},$B.union=function($B,$_){return $_||($_=new $D),this.clone($_),$B.width<=0||$B.height<=0?$_:($_.addPoint($B.x,$B.y),$_.addPoint($B.right,$B.bottom),this)},$B.clone=function($B){return $B||($B=new $D),$B.x=this.x,$B.y=this.y,$B.width=this.width,$B.height=this.height,$B},$B.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$B.equals=function($B){return!(!$B||$B.x!==this.x||$B.y!==this.y||$B.width!==this.width||$B.height!==this.height)},$B.addPoint=function($B,$_){return this.x>$B&&(this.width+=this.x-$B,this.x=$B),this.y>$_&&(this.height+=this.y-$_,this.y=$_),this.width<$B-this.x&&(this.width=$B-this.x),this.height<$_-this.y&&(this.height=$_-this.y),this},$B._getBoundPoints=function(){var $B=$D._temB;return($B.length=0)==this.width||0==this.height||$B.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$B},$B.isEmpty=function(){return this.width<=0||this.height<=0},$T(0,$B,"right",function(){return this.x+this.width}),$T(0,$B,"bottom",function(){return this.y+this.height}),$D._getBoundPointS=function($B,$_,$Z,$n){var $g=$D._temA;return($g.length=0)==$Z||0==$n||$g.push($B,$_,$B+$Z,$_,$B,$_+$n,$B+$Z,$_+$n),$g},$D._getWrapRec=function($B,$_){if(!$B||$B.length<1)return $_?$_.setTo(0,0,0,0):$D.TEMP.setTo(0,0,0,0);$_=$_||new $D;var $Z,$n,$g,$q,$P,$k=$B.length,$m=$Q.TEMP;for($g=$P=-($n=$q=99999),$Z=0;$Z<$k;$Z+=2)$m.x=$B[$Z],$m.y=$B[$Z+1],$n=$n<$m.x?$n:$m.x,$q=$q<$m.y?$q:$m.y,$g=$g>$m.x?$g:$m.x,$P=$P>$m.y?$P:$m.y;return $_.setTo($n,$q,$g-$n,$P-$q)},$D.EMPTY=new $D,$D.TEMP=new $D,$D._temB=[],$D._temA=[],$D}(),$L=function(){function $m(){}return $w($m,"laya.media.SoundManager"),$T(1,$m,"useAudioMusic",function(){return $m._useAudioMusic},function($B){$m._useAudioMusic=$B,$m._musicClass=$B?$ZB:null}),$T(1,$m,"autoStopMusic",function(){return $m._autoStopMusic},function($B){$N.stage.off("blur",null,$m._stageOnBlur),$N.stage.off("focus",null,$m._stageOnFocus),$N.stage.off("visibilitychange",null,$m._visibilityChange),($m._autoStopMusic=$B)&&($N.stage.on("blur",null,$m._stageOnBlur),$N.stage.on("focus",null,$m._stageOnFocus),$N.stage.on("visibilitychange",null,$m._visibilityChange))}),$T(1,$m,"muted",function(){return $m._muted},function($B){$B!=$m._muted&&($B&&$m.stopAllSound(),$m.musicMuted=$B,$m._muted=$B)}),$T(1,$m,"musicMuted",function(){return $m._musicMuted},function($B){$B!=$m._musicMuted&&($B?($m._tMusic&&$m._musicChannel&&!$m._musicChannel.isStopped?$m._musicChannel.pause():$m._musicChannel=null,$m._musicMuted=$B):($m._musicMuted=$B,$m._tMusic&&$m._musicChannel&&$m._musicChannel.resume()))}),$T(1,$m,"soundMuted",function(){return $m._soundMuted},function($B){$m._soundMuted=$B}),$m.addChannel=function($B){0<=$m._channels.indexOf($B)||($m._channels.push($B),$m.autoReleaseSound&&0!=$m._notUsedCount&&$m._notUsedUrls[$B.url]&&(delete $m._notUsedUrls[$B.url],0==--$m._notUsedCount&&$N.timer.clear($m,$m.disposeSoundIfNotUsed)))},$m.removeChannel=function($B){var $_=$m._channels,$Z=$_.indexOf($B);if(-1!=$Z&&($_.splice($Z,1),$m.autoReleaseSound)){var $n=$B.url,$g=$m.defaultIntervals[$n]||2e4;if(0<$g){var $q=!0;for($Z=$_.length-1;0<=$Z;$Z--)if($_[$Z].url==$n){$q=!1;break}$q&&($m._notUsedUrls[$n]=Date.now()+$g,0==$m._notUsedCount++&&$N.timer.loop(1e4,$m,$m.disposeSoundIfNotUsed))}}},$m.disposeSoundIfNotUsed=function(){var $B=$m._notUsedUrls;if(0!=$m._notUsedCount){var $_=Date.now();for(var $Z in $B)$_>=$B[$Z]&&(delete $B[$Z],--$m._notUsedCount,$m.destroySound($Z));if(0!=$m._notUsedCount)return}$N.timer.clear($m,$m.disposeSoundIfNotUsed)},$m._visibilityChange=function(){$N.stage.isVisibility?$m._stageOnFocus():$m._stageOnBlur()},$m._stageOnBlur=function(){$m._isActive=!1,$m._musicChannel&&($m._musicChannel.isStopped||($m._blurPaused=!0,$m._musicChannel.pause())),$m.stopAllSound(),$N.stage.once("mousedown",null,$m._stageOnFocus)},$m._recoverWebAudio=function(){$qB.ctx&&"running"!=$qB.ctx.state&&$qB.ctx.resume&&$qB.ctx.resume()},$m._stageOnFocus=function(){if($m._isActive=!0,$m._recoverWebAudio(),$N.stage.off("mousedown",null,$m._stageOnFocus),$m._blurPaused){var $B=$m._musicChannel;$B&&$m._music&&$B.isStopped&&($m._blurPaused=!1,$m._music._disposed?$m.playMusic($B.url,$B.loops,$B.startHandler,$B.completeHandler,$B.startTime):$B.audioBuffer?$B.resume():$m._music.play($B.startTime,$B.loops,$B.startHandler,$B))}},$m.playSound=function($B,$_,$Z,$n,$g,$q){if(void 0===$_&&($_=1),void 0===$q&&($q=0),!$B)return null;if($m._muted)return null;if($m._recoverWebAudio(),$B==$m._tMusic){if($m._musicMuted)return null}else{if(!$m._isActive)return null;if($m._soundMuted)return null}var $P,$k=$m._pool[$B];return $g||($g=$m._soundClass),$k||(($k=new $g).load($B),$m._pool[$B]=$k),($P=$k.play($q,$_,$Z))?($B==$m._tMusic&&($m._music=$k,$m._isActive||($m._blurPaused=!0,$P.pause())),$P.url=$B,$P.volume=$B==$m._tMusic?$m.musicVolume:$m.soundVolume,$P.completeHandler=$n,$P):null},$m.destroySound=function($B){var $_=$m._pool[$B];$_&&(delete $m._pool[$B],$_.dispose())},$m.playMusic=function($B,$_,$Z,$n,$g){return void 0===$_&&($_=0),void 0===$g&&($g=0),$m._tMusic=$B,$m._musicChannel&&$m._musicChannel.stop(),$m._musicChannel=$m.playSound($B,$_,$Z,$n,null,$g)},$m.stopSound=function($B){for(var $_,$Z=$m._channels.length-1;0<=$Z;$Z--)($_=$m._channels[$Z]).url==$B&&$_.stop()},$m.stopAll=function(){$m._tMusic=null;var $B=0;for($B=$m._channels.length-1;0<=$B;$B--)$m._channels[$B].stop()},$m.stopAllSound=function(){var $B,$_=0;for($_=$m._channels.length-1;0<=$_;$_--)($B=$m._channels[$_]).url!=$m._tMusic&&$B.stop()},$m.stopMusic=function(){$m._musicChannel&&$m._musicChannel.stop(),$m._tMusic=null},$m.setSoundVolume=function($B,$_){if($_)$m._setVolume($_,$B);else{$m.soundVolume=$B;var $Z,$n=0;for($n=$m._channels.length-1;0<=$n;$n--)($Z=$m._channels[$n]).url!=$m._tMusic&&($Z.volume=$B)}},$m.setMusicVolume=function($B){$m.musicVolume=$B,$m._setVolume($m._tMusic,$B)},$m._setVolume=function($B,$_){for(var $Z,$n=$m._channels.length-1;0<=$n;$n--)($Z=$m._channels[$n]).url==$B&&($Z.volume=$_)},$m.musicVolume=1,$m.soundVolume=1,$m.playbackRate=1,$m._useAudioMusic=!0,$m._muted=!1,$m._soundMuted=!1,$m._musicMuted=!1,$m._tMusic=null,$m._musicChannel=null,$m._music=null,$m._channels=[],$m._autoStopMusic=!1,$m._blurPaused=!1,$m._isActive=!0,$m._soundClass=null,$m._musicClass=null,$m.autoReleaseSound=!0,$m._pool={},$m.defaultIntervals={},$m._notUsedUrls={},$m._notUsedCount=0,$m}(),$Y=function(){var $B;function $Z(){}return $w($Z,"laya.net.LocalStorage"),$Z.__init__=function(){$Z._baseClass||($Z._baseClass=$B).init(),$Z.items=$Z._baseClass.items,$Z.support=$Z._baseClass.support},$Z.setItem=function($B,$_){$Z._baseClass.setItem($B,$_)},$Z.getItem=function($B){return $Z._baseClass.getItem($B)},$Z.setJSON=function($B,$_){$Z._baseClass.setJSON($B,$_)},$Z.getJSON=function($B){return $Z._baseClass.getJSON($B)},$Z.removeItem=function($B){$Z._baseClass.removeItem($B)},$Z.clear=function(){$Z._baseClass.clear()},$Z._baseClass=null,$Z.items=null,$Z.support=!1,$Z.__init$=function(){$B=function(){function $Z(){}return $w($Z,""),$Z.init=function(){try{$Z.support=!0,$Z.items=$P.localStorage,$Z.setItem("laya","1"),$Z.removeItem("laya")}catch($B){$Z.support=!1}$Z.support||console.log("LocalStorage is not supprot or browser is private mode.")},$Z.setItem=function($B,$_){try{$Z.support&&$Z.items.setItem($B,$_)}catch($B){console.warn("set localStorage failed",$B)}},$Z.getItem=function($B){return $Z.support?$Z.items.getItem($B):null},$Z.setJSON=function($B,$_){try{$Z.support&&$Z.items.setItem($B,JSON.stringify($_))}catch($B){console.warn("set localStorage failed",$B)}},$Z.getJSON=function($B){return JSON.parse($Z.support?$Z.items.getItem($B):null)},$Z.removeItem=function($B){$Z.support&&$Z.items.removeItem($B)},$Z.clear=function(){$Z.support&&$Z.items.clear()},$Z.items=null,$Z.support=!1,$Z}()},$Z}(),$o=(function(){function $n(){}$w($n,"laya.net.ResourceVersion"),$n.enable=function($B,$_,$Z){void 0===$Z&&($Z=2),laya.net.ResourceVersion.type=$Z,$N.loader.load($B,$y.create(null,$n.onManifestLoaded,[$_]),null,"json"),$F.customFormat=$n.addVersionPrefix},$n.onManifestLoaded=function($B,$_){$n.manifest=$_,$B.run(),$_||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$n.addVersionPrefix=function($B){return $n.manifest&&$n.manifest[$B]?2==$n.type?$n.manifest[$B]:$n.manifest[$B]+"/"+$B:$B},$n.FOLDER_VERSION=1,$n.FILENAME_VERSION=2,$n.manifest=null,$n.type=1}(),function(){function $B(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$w($B,"laya.net.TTFLoader");var $_=$B.prototype;return $_.load=function($B){var $_=(this._url=$B).split(".ttf")[0].split("/");this.fontName=$_[$_.length-1],$K.window.conch?this._loadConch():$K.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$_._loadConch=function(){this._http=new $PB,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$_._onHttpLoaded=function($B){$K.window.conch.setFontFaceFromBuffer(this.fontName,$B),this._clearHttp(),this._complete()},$_._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$_._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$_._complete=function(){$N.timer.clear(this,this._complete),$N.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$_._checkComplete=function(){$v.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$_._loadWithFontFace=function(){var $B=new $K.window.FontFace(this.fontName,"url('"+this._url+"')");$K.window.document.fonts.add($B);var $_=this;$B.loaded.then(function(){$_._complete()}),$B.load()},$_._createDiv=function(){this._div=$K.createElement("div"),this._div.innerHTML="laya";var $B=this._div.style;$B.fontFamily=this.fontName,$B.position="absolute",$B.left="-100px",$B.top="-100px",$K.document.body.appendChild(this._div)},$_._loadWithCSS=function(){var $B=this,$_=$K.createElement("style");$_.type="text/css",$K.document.body.appendChild($_),$_.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$v.measureText("LayaTTFFont",this._fontTxt).width;var $Z=this;$_.onload=function(){$N.timer.once(1e4,$Z,$B._complete)},$N.timer.loop(20,this,this._checkComplete),this._createDiv()},$B._testString="LayaTTFFont",$B}()),$F=function(){function $n($B){this._url=null,this._path=null,this._url=$n.formatURL($B),this._path=$n.getPath($B)}$w($n,"laya.net.URL");var $B=$n.prototype;return $T(0,$B,"path",function(){return this._path}),$T(0,$B,"url",function(){return this._url}),$n.formatURL=function($B,$_){if(!$B)return"null path";if(0<$B.indexOf(":"))return $B;null!=$n.customFormat&&($B=$n.customFormat($B,$_));var $Z=$B.charAt(0);if("."===$Z)return $n.formatRelativePath(($_||$n.basePath)+$B);if("~"===$Z)return $n.rootPath+$B.substring(1);if("d"===$Z){if(0===$B.indexOf("data:image"))return $B}else if("/"===$Z)return $B;return($_||$n.basePath)+$B},$n.formatRelativePath=function($B){for(var $_=$B.split("/"),$Z=0,$n=$_.length;$Z<$n;$Z++)".."==$_[$Z]&&($_.splice($Z-1,2),$Z-=2);return $_.join("/")},$n.isAbsolute=function($B){return 0<$B.indexOf(":")||"/"==$B.charAt(0)},$n.getPath=function($B){var $_=$B.lastIndexOf("/");return 0<$_?$B.substr(0,$_+1):""},$n.getFileName=function($B){var $_=$B.lastIndexOf("/");return 0<$_?$B.substr($_+1):$B},$n.version={},$n.basePath="",$n.rootPath="",$n.customFormat=function($B){var $_=$n.version[$B];return!$u.isConchApp&&$_&&($B+="?v="+$_),$B},$n}(),$u=function(){function $g($B,$_){this._timeId=0;var $Z=$g._mainCanvas.source.style;$Z.position="absolute",$Z.top=$Z.left="0px",$Z.background="#000000",$g._mainCanvas.source.id="layaCanvas";var $n=laya.renders.Render.isWebGL;$g._mainCanvas.source.width=$B,$g._mainCanvas.source.height=$_,$n&&$g.WebGL.init($g._mainCanvas,$B,$_),$K.container.appendChild($g._mainCanvas.source),($g._context=new $f($B,$_,$n?null:$g._mainCanvas)).ctx.setIsMainContext(),$K.window.requestAnimationFrame(function $B($_){$K.window.requestAnimationFrame($B);$N.stage._loop()}),$N.stage.on("visibilitychange",this,this._onVisibilitychange)}$w($g,"laya.renders.Render");var $B=$g.prototype;return $B._onVisibilitychange=function(){$N.stage.isVisibility?0!=this._timeId&&$K.window.clearInterval(this._timeId):this._timeId=$K.window.setInterval(this._enterFrame,1e3)},$B._enterFrame=function($B){$N.stage._loop()},$T(1,$g,"context",function(){return $g._context}),$T(1,$g,"canvas",function(){return $g._mainCanvas.source}),$g._context=null,$g._mainCanvas=null,$g.WebGL=null,$g.isConchNode=!1,$g.isConchApp=!1,$g.isConchWebGL=!1,$g.isWebGL=!1,$g.is3DMode=!1,$g.optimizeTextureMemory=function($B,$_){return!0},$g.__init$=function(){$P.ConchRenderType=$P.ConchRenderType||1,$P.ConchRenderType|=$P.conch?4:0,$g.isConchNode=5==(5&$P.ConchRenderType),$g.isConchApp=4==(4&$P.ConchRenderType),$g.isConchWebGL=6==$P.ConchRenderType},$g}(),$f=function(){function $P($B,$_,$Z){this.x=0,this.y=0,this._drawTexture=function($B,$_,$Z){$Z[0].loaded&&this.ctx.drawTexture($Z[0],$Z[1],$Z[2],$Z[3],$Z[4],$B,$_)},this._fillTexture=function($B,$_,$Z){$Z[0].loaded&&this.ctx.fillTexture($Z[0],$Z[1]+$B,$Z[2]+$_,$Z[3],$Z[4],$Z[5],$Z[6],$Z[7])},this._drawTextureWithTransform=function($B,$_,$Z){$Z[0].loaded&&this.ctx.drawTextureWithTransform($Z[0],$Z[1],$Z[2],$Z[3],$Z[4],$Z[5],$B,$_,$Z[6])},this._fillQuadrangle=function($B,$_,$Z){this.ctx.fillQuadrangle($Z[0],$Z[1],$Z[2],$Z[3],$Z[4])},this._drawRect=function($B,$_,$Z){var $n=this.ctx;null!=$Z[4]&&($n.fillStyle=$Z[4],$n.fillRect($B+$Z[0],$_+$Z[1],$Z[2],$Z[3],null)),null!=$Z[5]&&($n.strokeStyle=$Z[5],$n.lineWidth=$Z[6],$n.strokeRect($B+$Z[0],$_+$Z[1],$Z[2],$Z[3],$Z[6]))},this._drawPie=function($B,$_,$Z){var $n=this.ctx;$u.isWebGL&&$n.setPathId($Z[8]),$n.beginPath(),$u.isWebGL?($n.movePath($Z[0]+$B,$Z[1]+$_),$n.moveTo(0,0)):$n.moveTo($B+$Z[0],$_+$Z[1]),$n.arc($B+$Z[0],$_+$Z[1],$Z[2],$Z[3],$Z[4]),$n.closePath(),this._fillAndStroke($Z[5],$Z[6],$Z[7],!0)},this._clipRect=function($B,$_,$Z){this.ctx.clipRect($B+$Z[0],$_+$Z[1],$Z[2],$Z[3])},this._fillRect=function($B,$_,$Z){this.ctx.fillRect($B+$Z[0],$_+$Z[1],$Z[2],$Z[3],$Z[4])},this._drawCircle=function($B,$_,$Z){var $n=this.ctx;$u.isWebGL&&$n.setPathId($Z[6]),$S.drawCall++,$n.beginPath(),$u.isWebGL&&$n.movePath($Z[0]+$B,$Z[1]+$_),$n.arc($Z[0]+$B,$Z[1]+$_,$Z[2],0,$P.PI2),$n.closePath(),this._fillAndStroke($Z[3],$Z[4],$Z[5],!0)},this._fillCircle=function($B,$_,$Z){$S.drawCall++;var $n=this.ctx;$n.beginPath(),$n.fillStyle=$Z[3],$n.arc($Z[0]+$B,$Z[1]+$_,$Z[2],0,$P.PI2),$n.fill()},this._setShader=function($B,$_,$Z){this.ctx.setShader($Z[0])},this._drawLine=function($B,$_,$Z){var $n=this.ctx;$u.isWebGL&&$n.setPathId($Z[6]),$n.beginPath(),$n.strokeStyle=$Z[4],$n.lineWidth=$Z[5],$u.isWebGL?($n.movePath($B,$_),$n.moveTo($Z[0],$Z[1]),$n.lineTo($Z[2],$Z[3])):($n.moveTo($B+$Z[0],$_+$Z[1]),$n.lineTo($B+$Z[2],$_+$Z[3])),$n.stroke()},this._drawLines=function($B,$_,$Z){var $n=this.ctx;$u.isWebGL&&$n.setPathId($Z[5]),$n.beginPath(),$B+=$Z[0],$_+=$Z[1],$u.isWebGL&&$n.movePath($B,$_),$n.strokeStyle=$Z[3],$n.lineWidth=$Z[4];var $g=$Z[2],$q=2,$P=$g.length;if($u.isWebGL)for($n.moveTo($g[0],$g[1]);$q<$P;)$n.lineTo($g[$q++],$g[$q++]);else for($n.moveTo($B+$g[0],$_+$g[1]);$q<$P;)$n.lineTo($B+$g[$q++],$_+$g[$q++]);$n.stroke()},this._drawLinesWebGL=function($B,$_,$Z){this.ctx.drawLines($B+this.x+$Z[0],$_+this.y+$Z[1],$Z[2],$Z[3],$Z[4])},this._drawCurves=function($B,$_,$Z){this.ctx.drawCurves($B,$_,$Z)},this._draw=function($B,$_,$Z){$Z[0].call(null,this,$B,$_)},this._transformByMatrix=function($B,$_,$Z){this.ctx.transformByMatrix($Z[0])},this._setTransform=function($B,$_,$Z){this.ctx.setTransform($Z[0],$Z[1],$Z[2],$Z[3],$Z[4],$Z[5])},this._setTransformByMatrix=function($B,$_,$Z){this.ctx.setTransformByMatrix($Z[0])},this._save=function($B,$_,$Z){this.ctx.save()},this._restore=function($B,$_,$Z){this.ctx.restore()},this._translate=function($B,$_,$Z){this.ctx.translate($Z[0],$Z[1])},this._transform=function($B,$_,$Z){this.ctx.translate($Z[1]+$B,$Z[2]+$_);var $n=$Z[0];this.ctx.transform($n.a,$n.b,$n.c,$n.d,$n.tx,$n.ty),this.ctx.translate(-$B-$Z[1],-$_-$Z[2])},this._rotate=function($B,$_,$Z){this.ctx.translate($Z[1]+$B,$Z[2]+$_),this.ctx.rotate($Z[0]),this.ctx.translate(-$B-$Z[1],-$_-$Z[2])},this._scale=function($B,$_,$Z){this.ctx.translate($Z[2]+$B,$Z[3]+$_),this.ctx.scale($Z[0],$Z[1]),this.ctx.translate(-$B-$Z[2],-$_-$Z[3])},this._alpha=function($B,$_,$Z){this.ctx.globalAlpha*=$Z[0]},this._setAlpha=function($B,$_,$Z){this.ctx.globalAlpha=$Z[0]},this._fillText=function($B,$_,$Z){this.ctx.fillText($Z[0],$Z[1]+$B,$Z[2]+$_,$Z[3],$Z[4],$Z[5])},this._strokeText=function($B,$_,$Z){this.ctx.strokeText($Z[0],$Z[1]+$B,$Z[2]+$_,$Z[3],$Z[4],$Z[5],$Z[6])},this._fillBorderText=function($B,$_,$Z){this.ctx.fillBorderText($Z[0],$Z[1]+$B,$Z[2]+$_,$Z[3],$Z[4],$Z[5],$Z[6],$Z[7])},this._blendMode=function($B,$_,$Z){this.ctx.globalCompositeOperation=$Z[0]},this._beginClip=function($B,$_,$Z){this.ctx.beginClip&&this.ctx.beginClip($B+$Z[0],$_+$Z[1],$Z[2],$Z[3])},this._setIBVB=function($B,$_,$Z){this.ctx.setIBVB($Z[0]+$B,$Z[1]+$_,$Z[2],$Z[3],$Z[4],$Z[5],$Z[6],$Z[7])},this._fillTrangles=function($B,$_,$Z){this.ctx.fillTrangles($Z[0],$Z[1]+$B,$Z[2]+$_,$Z[3],$Z[4])},this._drawPath=function($B,$_,$Z){var $n=this.ctx;$u.isWebGL&&$n.setPathId(-1),$n.beginPath(),$B+=$Z[0],$_+=$Z[1],$u.isWebGL&&$n.movePath($B,$_);for(var $g=$Z[2],$q=0,$P=$g.length;$q<$P;$q++){var $k=$g[$q];switch($k[0]){case"moveTo":$u.isWebGL?$n.moveTo($k[1],$k[2]):$n.moveTo($B+$k[1],$_+$k[2]);break;case"lineTo":$u.isWebGL?$n.lineTo($k[1],$k[2]):$n.lineTo($B+$k[1],$_+$k[2]);break;case"arcTo":$u.isWebGL?$n.arcTo($k[1],$k[2],$k[3],$k[4],$k[5]):$n.arcTo($B+$k[1],$_+$k[2],$B+$k[3],$_+$k[4],$k[5]);break;case"closePath":$n.closePath()}}var $m=$Z[3];null!=$m&&($n.fillStyle=$m.fillStyle,$n.fill());var $D=$Z[4];null!=$D&&($n.strokeStyle=$D.strokeStyle,$n.lineWidth=$D.lineWidth||1,$n.lineJoin=$D.lineJoin,$n.lineCap=$D.lineCap,$n.miterLimit=$D.miterLimit,$n.stroke())},this.drawPoly=function($B,$_,$Z){this.ctx.drawPoly($B+this.x+$Z[0],$_+this.y+$Z[1],$Z[2],$Z[3],$Z[4],$Z[5],$Z[6])},this._drawPoly=function($B,$_,$Z){var $n=this.ctx,$g=$Z[2],$q=2,$P=$g.length;if($u.isWebGL)for($n.setPathId($Z[6]),$n.beginPath(),$B+=$Z[0],$_+=$Z[1],$n.movePath($B,$_),$n.moveTo($g[0],$g[1]);$q<$P;)$n.lineTo($g[$q++],$g[$q++]);else for($n.beginPath(),$B+=$Z[0],$_+=$Z[1],$n.moveTo($B+$g[0],$_+$g[1]);$q<$P;)$n.lineTo($B+$g[$q++],$_+$g[$q++]);$n.closePath(),this._fillAndStroke($Z[3],$Z[4],$Z[5],$Z[7])},this._drawSkin=function($B,$_,$Z){var $n=$Z[0];if($n){var $g=this.ctx;$n.render($g,$B,$_)}},this._drawParticle=function($B,$_,$Z){this.ctx.drawParticle($B+this.x,$_+this.y,$Z[0])},this._setFilters=function($B,$_,$Z){this.ctx.setFilters($Z)},$Z?this.ctx=$Z.getContext("2d"):($Z=$CB.create("3D"),this.ctx=$v.createWebGLContext2D($Z),$Z._setContext(this.ctx)),$Z.size($B,$_),this.canvas=$Z}$w($P,"laya.renders.RenderContext");var $B=$P.prototype;return $B.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$B.drawTexture=function($B,$_,$Z,$n,$g){$B.loaded&&this.ctx.drawTexture($B,$_,$Z,$n,$g,this.x,this.y)},$B._drawTextures=function($B,$_,$Z){$Z[0].loaded&&this.ctx.drawTextures($Z[0],$Z[1],$B+this.x,$_+this.y)},$B.drawTextureWithTransform=function($B,$_,$Z,$n,$g,$q,$P){$B.loaded&&this.ctx.drawTextureWithTransform($B,$_,$Z,$n,$g,$q,this.x,this.y,$P)},$B.fillQuadrangle=function($B,$_,$Z,$n,$g){this.ctx.fillQuadrangle($B,$_,$Z,$n,$g)},$B.drawCanvas=function($B,$_,$Z,$n,$g){this.ctx.drawCanvas($B,$_+this.x,$Z+this.y,$n,$g)},$B.drawRect=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=1);var $P=this.ctx;$P.strokeStyle=$g,$P.lineWidth=$q,$P.strokeRect($B+this.x,$_+this.y,$Z,$n,$q)},$B._fillAndStroke=function($B,$_,$Z,$n){void 0===$n&&($n=!1);var $g=this.ctx;null!=$B&&($g.fillStyle=$B,$u.isWebGL?$g.fill($n):$g.fill()),null!=$_&&0<$Z&&($g.strokeStyle=$_,$g.lineWidth=$Z,$g.stroke())},$B.clipRect=function($B,$_,$Z,$n){this.ctx.clipRect($B+this.x,$_+this.y,$Z,$n)},$B.fillRect=function($B,$_,$Z,$n,$g){this.ctx.fillRect($B+this.x,$_+this.y,$Z,$n,$g)},$B.drawCircle=function($B,$_,$Z,$n,$g){void 0===$g&&($g=1),$S.drawCall++;var $q=this.ctx;$q.beginPath(),$q.strokeStyle=$n,$q.lineWidth=$g,$q.arc($B+this.x,$_+this.y,$Z,0,$P.PI2),$q.stroke()},$B.drawTriangles=function($B,$_,$Z){if($u.isWebGL)this.ctx.drawTriangles($Z[0],$B+$Z[1],$_+$Z[2],$Z[3],$Z[4],$Z[5],$Z[6],$Z[7],$Z[8],$Z[9]);else{var $n=$Z[5],$g=0,$q=$n.length,$P=this.ctx;for($g=0;$g<$q;$g+=3){var $k=2*$n[$g],$m=2*$n[$g+1],$D=2*$n[$g+2];$P.drawTriangle($Z[0],$Z[3],$Z[4],$k,$m,$D,$Z[6],!0)}}},$B.fillCircle=function($B,$_,$Z,$n){$S.drawCall++;var $g=this.ctx;$g.beginPath(),$g.fillStyle=$n,$g.arc($B+this.x,$_+this.y,$Z,0,$P.PI2),$g.fill()},$B.setShader=function($B){this.ctx.setShader($B)},$B.drawLine=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=1);var $P=this.ctx;$P.beginPath(),$P.strokeStyle=$g,$P.lineWidth=$q,$P.moveTo(this.x+$B,this.y+$_),$P.lineTo(this.x+$Z,this.y+$n),$P.stroke()},$B.clear=function(){this.ctx.clear()},$B.transformByMatrix=function($B){this.ctx.transformByMatrix($B)},$B.setTransform=function($B,$_,$Z,$n,$g,$q){this.ctx.setTransform($B,$_,$Z,$n,$g,$q)},$B.setTransformByMatrix=function($B){this.ctx.setTransformByMatrix($B)},$B.save=function(){this.ctx.save()},$B.restore=function(){this.ctx.restore()},$B.translate=function($B,$_){this.ctx.translate($B,$_)},$B.transform=function($B,$_,$Z,$n,$g,$q){this.ctx.transform($B,$_,$Z,$n,$g,$q)},$B.rotate=function($B){this.ctx.rotate($B)},$B.scale=function($B,$_){this.ctx.scale($B,$_)},$B.alpha=function($B){this.ctx.globalAlpha*=$B},$B.setAlpha=function($B){this.ctx.globalAlpha=$B},$B.fillWords=function($B,$_,$Z,$n,$g,$q){void 0===$q&&($q=0),this.ctx.fillWords($B,$_,$Z,$n,$g,$q)},$B.fillBorderWords=function($B,$_,$Z,$n,$g,$q,$P){this.ctx.fillBorderWords($B,$_,$Z,$n,$g,$q,$P)},$B.fillText=function($B,$_,$Z,$n,$g,$q){this.ctx.fillText($B,$_+this.x,$Z+this.y,$n,$g,$q)},$B.strokeText=function($B,$_,$Z,$n,$g,$q,$P){this.ctx.strokeText($B,$_+this.x,$Z+this.y,$n,$g,$q,$P)},$B.blendMode=function($B){this.ctx.globalCompositeOperation=$B},$B.flush=function(){this.ctx.flush&&this.ctx.flush()},$B.addRenderObject=function($B){this.ctx.addRenderObject($B)},$B.beginClip=function($B,$_,$Z,$n){this.ctx.beginClip&&this.ctx.beginClip($B,$_,$Z,$n)},$B.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$B.fillTrangles=function($B,$_,$Z){this.ctx.fillTrangles($Z[0],$Z[1],$Z[2],$Z[3],4<$Z.length?$Z[4]:null)},$P.PI2=2*Math.PI,$P}(),$b=function(){function $P($B,$_){switch(this._next=$_||$P.NORENDER,$B){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$j._filter);case 69905:return void(this._fun=$P._initRenderFun)}this.onCreate($B)}$w($P,"laya.renders.RenderSprite");var $B=$P.prototype;return $B.onCreate=function($B){},$B._style=function($B,$_,$Z,$n){$B._style.render($B,$_,$Z,$n);var $g=this._next;$g._fun.call($g,$B,$_,$Z,$n)},$B._no=function($B,$_,$Z,$n){},$B._custom=function($B,$_,$Z,$n){$B.customRender($_,$Z,$n);var $g=$B._style._tf;this._next._fun.call(this._next,$B,$_,$Z-$g.translateX,$n-$g.translateY)},$B._clip=function($B,$_,$Z,$n){var $g=this._next;if($g!=$P.NORENDER){var $q=$B._style.scrollRect;$_.ctx.save(),$_.ctx.clipRect($Z,$n,$q.width,$q.height),$g._fun.call($g,$B,$_,$Z-$q.x,$n-$q.y),$_.ctx.restore()}},$B._blend=function($B,$_,$Z,$n){var $g=$B._style;$g.blendMode&&($_.ctx.globalCompositeOperation=$g.blendMode);var $q=this._next;$q._fun.call($q,$B,$_,$Z,$n),$_.ctx.globalCompositeOperation="source-over"},$B._mask=function($B,$_,$Z,$n){var $g=this._next;$g._fun.call($g,$B,$_,$Z,$n);var $q=$B.mask;$q&&($_.ctx.globalCompositeOperation="destination-in",(0<$q.numChildren||!$q.graphics._isOnlyOne())&&($q.cacheAsBitmap=!0),$q.render($_,$Z-$B.pivotX,$n-$B.pivotY)),$_.ctx.globalCompositeOperation="source-over"},$B._graphics=function($B,$_,$Z,$n){var $g=$B._style._tf;$B._graphics&&$B._graphics._render($B,$_,$Z-$g.translateX,$n-$g.translateY);var $q=this._next;$q._fun.call($q,$B,$_,$Z,$n)},$B._image=function($B,$_,$Z,$n){var $g=$B._style;$_.ctx.drawTexture2($Z,$n,$g._tf.translateX,$g._tf.translateY,$B.transform,$g.alpha,$g.blendMode,$B._graphics._one)},$B._image2=function($B,$_,$Z,$n){var $g=$B._style._tf;$_.ctx.drawTexture2($Z,$n,$g.translateX,$g.translateY,$B.transform,1,null,$B._graphics._one)},$B._alpha=function($B,$_,$Z,$n){var $g;if(.01<($g=$B._style.alpha)||$B._needRepaint()){var $q=$_.ctx.globalAlpha;$_.ctx.globalAlpha*=$g;var $P=this._next;$P._fun.call($P,$B,$_,$Z,$n),$_.ctx.globalAlpha=$q}},$B._transform=function($B,$_,$Z,$n){var $g=$B.transform,$q=this._next;$g&&$q!=$P.NORENDER?($_.save(),$_.transform($g.a,$g.b,$g.c,$g.d,$g.tx+$Z,$g.ty+$n),$q._fun.call($q,$B,$_,0,0),$_.restore()):$q._fun.call($q,$B,$_,$Z,$n)},$B._childs=function($B,$_,$Z,$n){var $g=$B._style,$q=$g._tf;if($Z=$Z-$q.translateX+$g.paddingLeft,$n=$n-$q.translateY+$g.paddingTop,$g._calculation){var $P=$B._getWords();if($P){var $k=$g;$k&&($k.stroke?$_.fillBorderWords($P,$Z,$n,$k.font,$k.color,$k.strokeColor,$k.stroke):$_.fillWords($P,$Z,$n,$k.font,$k.color,"none"!=$k.textDecoration&&$k.underLine?1:0))}}var $m,$D=$B._childs,$T=$D.length;if($B.viewport||$B.optimizeScrollRect&&$B._style.scrollRect){var $e=$B.viewport||$B._style.scrollRect,$I=$e.x,$A=$e.y,$$=$e.right,$w=$e.bottom,$r=NaN,$j=NaN;for($y=0;$y<$T;++$y)($m=$D[$y]).visible&&($r=$m._x)<$$&&$r+$m.width>$I&&($j=$m._y)<$w&&$j+$m.height>$A&&$m.render($_,$Z,$n)}else for(var $y=0;$y<$T;++$y)($m=$D[$y])._style.visible&&$m.render($_,$Z,$n)},$B._canvas=function($B,$_,$Z,$n){var $g=$B._$P.cacheCanvas;if($g){"bitmap"===$g.type?$S.canvasBitmap++:$S.canvasNormal++;var $q=$g.ctx;if($B._needRepaint()||!$q)this._canvas_repaint($B,$_,$Z,$n);else{var $P=$g._cacheRec;$_.drawCanvas($q.canvas,$Z+$P.x,$n+$P.y,$P.width,$P.height)}}else this._next._fun.call(this._next,$B,$_,$Z,$n)},$B._canvas_repaint=function($B,$_,$Z,$n){var $g=$B._$P.cacheCanvas,$q=this._next;if($g){var $P,$k,$m,$D,$T=$g.ctx,$e=$B._needRepaint()||!$T,$I=$g.type;if("bitmap"===$I?$S.canvasBitmap++:$S.canvasNormal++,$e){var $A,$$;$g._cacheRec||($g._cacheRec=new $M),$u.isWebGL&&"bitmap"!==$I?$g._cacheRec.setTo(-$B.pivotX,-$B.pivotY,1,1):(($D=$B.getSelfBounds()).x=$D.x-$B.pivotX,$D.y=$D.y-$B.pivotY,$D.x=$D.x-16,$D.y=$D.y-16,$D.width=$D.width+32,$D.height=$D.height+32,$D.x=Math.floor($D.x+$Z)-$Z,$D.y=Math.floor($D.y+$n)-$n,$D.width=Math.floor($D.width),$D.height=Math.floor($D.height),$g._cacheRec.copyFrom($D)),$D=$g._cacheRec;var $w,$r=$u.isWebGL?1:$K.pixelRatio*$N.stage.clientScaleX,$j=$u.isWebGL?1:$K.pixelRatio*$N.stage.clientScaleY;if(!$u.isWebGL){var $y,$C=1,$z=1;for($y=$B;$y&&$y!=$N.stage;)$C*=$y.scaleX,$z*=$y.scaleY,$y=$y.parent;$u.isWebGL?($C<1&&($r*=$C),$z<1&&($j*=$z)):(1<$C&&($r*=$C),1<$z&&($j*=$z))}if($B.scrollRect){var $t=$B.scrollRect;$D.x-=$t.x,$D.y-=$t.y}if($A=$D.width*$r,$$=$D.height*$j,$k=$D.x,$m=$D.y,$u.isWebGL&&"bitmap"===$I&&(2048<$A||2048<$$))return console.warn("cache bitmap size larger than 2048,cache ignored"),$g.ctx&&($U.recover("RenderContext",$g.ctx),$g.ctx.canvas.size(0,0),$g.ctx=null),void $q._fun.call($q,$B,$_,$Z,$n);if($T||($T=$g.ctx=$U.getItem("RenderContext")||new $f($A,$$,$CB.create("AUTO"))),$T.ctx.sprite=$B,($P=$T.canvas).clear(),($P.width!=$A||$P.height!=$$)&&$P.size($A,$$),"bitmap"===$I?$P.context.asBitmap=!0:"normal"===$I&&($P.context.asBitmap=!1),1!=$r||1!=$j){var $J=$T.ctx;$J.save(),$J.scale($r,$j),!$u.isConchWebGL&&$u.isConchApp&&($w=$B._$P.cf)&&$J.setFilterMatrix&&$J.setFilterMatrix($w._mat,$w._alpha),$q._fun.call($q,$B,$T,-$k,-$m),$J.restore(),$u.isConchApp&&!$u.isConchWebGL||$B._applyFilters()}else $J=$T.ctx,!$u.isConchWebGL&&$u.isConchApp&&($w=$B._$P.cf)&&$J.setFilterMatrix&&$J.setFilterMatrix($w._mat,$w._alpha),$q._fun.call($q,$B,$T,-$k,-$m),$u.isConchApp&&!$u.isConchWebGL||$B._applyFilters();$B._$P.staticCache&&($g.reCache=!1),$S.canvasReCache++}else $k=($D=$g._cacheRec).x,$m=$D.y,$P=$T.canvas;$_.drawCanvas($P,$Z+$k,$n+$m,$D.width,$D.height)}else $q._fun.call($q,$B,$T,$Z,$n)},$P.__init__=function(){var $B,$_,$Z=0;for($_=$v.createRenderSprite(69905,null),$B=$P.renders.length=4096,$Z=0;$Z<$B;$Z++)$P.renders[$Z]=$_;$P.renders[0]=$v.createRenderSprite(0,null),function($B,$_){for(var $Z=0,$n=0;$n<$B.length;$n++)$Z|=$B[$n],$P.renders[$Z]=$_}([1,512,4,2],new $P(1,null)),$P.renders[513]=$v.createRenderSprite(513,null),$P.renders[517]=new $P(517,null)},$P._initRenderFun=function($B,$_,$Z,$n){var $g=$B._renderType;($P.renders[$g]=$P._getTypeRender($g))._fun($B,$_,$Z,$n)},$P._getTypeRender=function($B){for(var $_=null,$Z=2048;1<$Z;)$Z&$B&&($_=$v.createRenderSprite($Z,$_)),$Z>>=1;return $_},$P.IMAGE=1,$P.ALPHA=2,$P.TRANSFORM=4,$P.BLEND=8,$P.CANVAS=16,$P.FILTERS=32,$P.MASK=64,$P.CLIP=128,$P.STYLE=256,$P.GRAPHICS=512,$P.CUSTOM=1024,$P.CHILDS=2048,$P.INIT=69905,$P.renders=[],$P.NORENDER=new $P(0,null),$P}(),$x=function(){function $k(){this._repaint=!1}$w($k,"laya.resource.Context");var $B=$k.prototype;return $B.replaceReset=function(){var $B,$_,$Z=0;for($B=$k.replaceKeys.length,$Z=0;$Z<$B;$Z++)$_=$k.replaceKeys[$Z],this[$k.newKeys[$Z]]=this[$_]},$B.replaceResotre=function(){this.__restore(),this.__reset()},$B.setIsMainContext=function(){},$B.drawTextures=function($B,$_,$Z,$n){$S.drawCall+=$_.length/2;for(var $g=$B.width,$q=$B.height,$P=0,$k=$_.length;$P<$k;$P+=2)this.drawTexture($B,$_[$P],$_[$P+1],$g,$q,$Z,$n)},$B.drawCanvas=function($B,$_,$Z,$n,$g){$S.drawCall++,this.drawImage($B.source,$_,$Z,$n,$g)},$B.fillRect=function($B,$_,$Z,$n,$g){$S.drawCall++,$g&&(this.fillStyle=$g),this.__fillRect($B,$_,$Z,$n)},$B.fillText=function($B,$_,$Z,$n,$g,$q){$S.drawCall++,3<arguments.length&&null!=$n&&(this.font=$n,this.fillStyle=$g,this.textAlign=$q,this.textBaseline="top"),this.__fillText($B,$_,$Z)},$B.fillBorderText=function($B,$_,$Z,$n,$g,$q,$P,$k){$S.drawCall++,this.font=$n,this.fillStyle=$g,this.textBaseline="top",this.strokeStyle=$q,this.lineWidth=$P,this.textAlign=$k,this.__strokeText($B,$_,$Z),this.__fillText($B,$_,$Z)},$B.strokeText=function($B,$_,$Z,$n,$g,$q,$P){$S.drawCall++,3<arguments.length&&null!=$n&&(this.font=$n,this.strokeStyle=$g,this.lineWidth=$q,this.textAlign=$P,this.textBaseline="top"),this.__strokeText($B,$_,$Z)},$B.transformByMatrix=function($B){this.transform($B.a,$B.b,$B.c,$B.d,$B.tx,$B.ty)},$B.setTransformByMatrix=function($B){this.setTransform($B.a,$B.b,$B.c,$B.d,$B.tx,$B.ty)},$B.clipRect=function($B,$_,$Z,$n){$S.drawCall++,this.beginPath(),this.rect($B,$_,$Z,$n),this.clip()},$B.drawTexture=function($B,$_,$Z,$n,$g,$q,$P){$S.drawCall++;var $k=$B.uv,$m=$B.bitmap.width,$D=$B.bitmap.height;this.drawImage($B.source,$k[0]*$m,$k[1]*$D,($k[2]-$k[0])*$m,($k[5]-$k[3])*$D,$_+$q,$Z+$P,$n,$g)},$B.drawTextureWithTransform=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){$S.drawCall++;var $D=$B.uv,$T=$B.bitmap.width,$e=$B.bitmap.height;this.save(),1!=$m&&(this.globalAlpha*=$m),$q?(this.transform($q.a,$q.b,$q.c,$q.d,$q.tx+$P,$q.ty+$k),this.drawImage($B.source,$D[0]*$T,$D[1]*$e,($D[2]-$D[0])*$T,($D[5]-$D[3])*$e,$_,$Z,$n,$g)):this.drawImage($B.source,$D[0]*$T,$D[1]*$e,($D[2]-$D[0])*$T,($D[5]-$D[3])*$e,$_+$P,$Z+$k,$n,$g),this.restore()},$B.drawTexture2=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=$k[0];if($m.loaded&&$m.bitmap&&$m.source){$S.drawCall++;var $D=1!==$q;if($D){var $T=this.globalAlpha;this.globalAlpha*=$q}var $e=$m.uv,$I=$m.bitmap.width,$A=$m.bitmap.height;$g?(this.save(),this.transform($g.a,$g.b,$g.c,$g.d,$g.tx+$B,$g.ty+$_),this.drawImage($m.source,$e[0]*$I,$e[1]*$A,($e[2]-$e[0])*$I,($e[5]-$e[3])*$A,$k[1]-$Z,$k[2]-$n,$k[3],$k[4]),this.restore()):this.drawImage($m.source,$e[0]*$I,$e[1]*$A,($e[2]-$e[0])*$I,($e[5]-$e[3])*$A,$k[1]-$Z+$B,$k[2]-$n+$_,$k[3],$k[4]),$D&&(this.globalAlpha=$T)}},$B.fillTexture=function($B,$_,$Z,$n,$g,$q,$P,$k){if(!$k.pat){if($B.uv!=$TB.DEF_UV){var $m=new $CB("2D");$m.getContext("2d"),$m.size($B.width,$B.height),$m.context.drawTexture($B,0,0,$B.width,$B.height,0,0),$B=new $TB($m)}$k.pat=this.createPattern($B.bitmap.source,$q)}var $D=$_,$T=$Z,$e=0,$I=0;$P&&($D+=$P.x%$B.width,$T+=$P.y%$B.height,$e-=$P.x%$B.width,$I-=$P.y%$B.height),this.translate($D,$T),this.fillRect($e,$I,$n,$g,$k.pat),this.translate(-$D,-$T)},$B.drawTriangle=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=$B.bitmap,$D=$m.source,$T=$B.width,$e=$B.height,$I=$m.width,$A=$m.height,$$=$Z[$n]*$I,$w=$Z[$g]*$I,$r=$Z[$q]*$I,$j=$Z[$n+1]*$A,$y=$Z[$g+1]*$A,$C=$Z[$q+1]*$A,$z=$_[$n],$t=$_[$g],$J=$_[$q],$N=$_[$n+1],$Q=$_[$g+1],$M=$_[$q+1];if($k){var $Y=($z+$t+$J)/3,$l=($N+$Q+$M)/3,$L=$z-$Y,$v=$N-$l,$V=Math.sqrt($L*$L+$v*$v);$z=$Y+$L/$V*($V+1),$N=$l+$v/$V*($V+1),$v=$Q-$l,$t=$Y+($L=$t-$Y)/($V=Math.sqrt($L*$L+$v*$v))*($V+1),$Q=$l+$v/$V*($V+1),$v=$M-$l,$J=$Y+($L=$J-$Y)/($V=Math.sqrt($L*$L+$v*$v))*($V+1),$M=$l+$v/$V*($V+1)}this.save(),$P&&this.transform($P.a,$P.b,$P.c,$P.d,$P.tx,$P.ty),this.beginPath(),this.moveTo($z,$N),this.lineTo($t,$Q),this.lineTo($J,$M),this.closePath(),this.clip();var $o=1/($$*$y+$j*$r+$w*$C-$y*$r-$j*$w-$$*$C),$F=$z*$y+$j*$J+$t*$C-$y*$J-$j*$t-$z*$C,$u=$$*$t+$z*$r+$w*$J-$t*$r-$z*$w-$$*$J,$f=$$*$y*$J+$j*$t*$r+$z*$w*$C-$z*$y*$r-$j*$w*$J-$$*$t*$C,$b=$N*$y+$j*$M+$Q*$C-$y*$M-$j*$Q-$N*$C,$x=$$*$Q+$N*$r+$w*$M-$Q*$r-$N*$w-$$*$M,$p=$$*$y*$M+$j*$Q*$r+$N*$w*$C-$N*$y*$r-$j*$w*$M-$$*$Q*$C;this.transform($F*$o,$b*$o,$u*$o,$x*$o,$f*$o,$p*$o),this.drawImage($D,$B.uv[0]*$I,$B.uv[1]*$A,$T,$e,$B.uv[0]*$I,$B.uv[1]*$A,$T,$e),this.restore()},$B.flush=function(){return 0},$B.fillWords=function($B,$_,$Z,$n,$g,$q){$n&&(this.font=$n),$g&&(this.fillStyle=$g);this.textBaseline="top",this.textAlign="left";for(var $P=0,$k=$B.length;$P<$k;$P++){var $m=$B[$P];if(this.__fillText($m.char,$m.x+$_,$m.y+$Z),1===$q){var $D=$m.height,$T=.5*$m.style.letterSpacing;$T||($T=0),this.beginPath(),this.strokeStyle=$g,this.lineWidth=1,this.moveTo($_+$m.x-$T+.5,$Z+$m.y+$D+.5),this.lineTo($_+$m.x+$m.width+$T+.5,$Z+$m.y+$D+.5),this.stroke()}}},$B.fillBorderWords=function($B,$_,$Z,$n,$g,$q,$P){$n&&(this.font=$n),$g&&(this.fillStyle=$g),this.textBaseline="top",this.lineWidth=$P,this.textAlign="left",this.strokeStyle=$q;for(var $k=0,$m=$B.length;$k<$m;$k++){var $D=$B[$k];this.__strokeText($D.char,$D.x+$_,$D.y+$Z),this.__fillText($D.char,$D.x+$_,$D.y+$Z)}},$B.destroy=function(){this.canvas.width=this.canvas.height=0},$B.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$B.drawCurves=function($B,$_,$Z){this.beginPath(),this.strokeStyle=$Z[3],this.lineWidth=$Z[4];var $n=$Z[2];$B+=$Z[0],$_+=$Z[1],this.moveTo($B+$n[0],$_+$n[1]);for(var $g=2,$q=$n.length;$g<$q;)this.quadraticCurveTo($B+$n[$g++],$_+$n[$g++],$B+$n[$g++],$_+$n[$g++]);this.stroke()},$k.__init__=function($_){var $Z=laya.resource.Context.prototype;if(!($_=$_||CanvasRenderingContext2D.prototype).inited){$_.inited=!0,$_.__fillText=$_.fillText,$_.__fillRect=$_.fillRect,$_.__strokeText=$_.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($B){$_[$B]=$Z[$B]})}},$k.replaceCanvasGetSet=function($B,$_){var $Z=Object.getOwnPropertyDescriptor($B,$_);if(!$Z||!$Z.configurable)return!1;var $n,$g={};for($n in $Z)"set"!=$n&&($g[$n]=$Z[$n]);var $q=$Z.set;return $g.set=function($B){$q.call(this,$B);var $_=this.getContext("2d");$_&&"__reset"in $_&&$_.__reset()},Object.defineProperty($B,$_,$g),!0},$k.replaceGetSet=function($B,$_){var $Z=Object.getOwnPropertyDescriptor($B,$_);if(!$Z||!$Z.configurable)return!1;var $n,$g={};for($n in $Z)"set"!=$n&&($g[$n]=$Z[$n]);var $q=$Z.set,$P="___"+$_+"__";return $k.newKeys.push($P),$g.set=function($B){$B!=this[$P]&&(this[$P]=$B,$q.call(this,$B))},Object.defineProperty($B,$_,$g),!0},$k._default=new $k,$k.newKeys=[],$m($k,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$k}(),$p=function(){function $q($B){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$q._uniqueIDCounter,this._name=$B||"Content Manager",$q._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$q._resourceManagers.push(this),this._resources=[],this._records={}}$w($q,"laya.resource.ResourceManager");var $B=$q.prototype;return $N.imps($B,{"laya.resource.IDispose":!0}),$B.getResourceByIndex=function($B){return this._resources[$B]},$B.getResourcesLength=function(){return this._resources.length},$B.addResource=function($B){return $B.resourceManager&&$B.resourceManager.removeResource($B),-1===this._resources.indexOf($B)&&(($B._resourceManager=this)._resources.push($B),this.addRecord($B.uri,$B.__className,$B.memorySize),this.addSize($B.memorySize),!0)},$B.removeResource=function($B){var $_=this._resources.indexOf($B);return-1!==$_&&(this._resources.splice($_,1),$B._resourceManager=null,this._memorySize-=$B.memorySize,this.addRecord($B.uri,$B.__className,-$B.memorySize),!0)},$B.unload=function(){for(var $B=this._resources.slice(0,this._resources.length),$_=0;$_<$B.length;$_++){$B[$_].destroy()}$B.length=0},$B.dispose=function(){if(this===$q._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$q._resourceManagers.splice($q._resourceManagers.indexOf(this),1),$q._isResourceManagersSorted=!1;for(var $B=this._resources.slice(0,this._resources.length),$_=0;$_<$B.length;$_++){var $Z=$B[$_];$Z.resourceManager.removeResource($Z),$Z.destroy()}$B.length=0},$B.addSize=function($B){$B&&(this.autoRelease&&0<$B&&this._memorySize+$B>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$B)},$B.addRecord=function($B,$_,$Z){DEBUG&&$Z&&!$B&&console.error($B,$_,$Z)},$B.garbageCollection=function($B){var $_=this._resources;($_=$_.slice()).sort(function($B,$_){if(!$B||!$_)throw new Error("a或b不能为空！");return $B.released&&$_.released?0:$B.released?1:$_.released?-1:$B._lastUseFrameCount-$_._lastUseFrameCount});for(var $Z=$S.loopCount,$n=0,$g=$_.length;$n<$g;$n++){var $q=$_[$n];if(!(1<$Z-$q._lastUseFrameCount))return void(this._memorySize>=$B&&(this._isOverflow=!0));if($q.releaseResource(),this._memorySize<$B)return void(this._isOverflow=!1)}},$T(0,$B,"id",function(){return this._id}),$T(0,$B,"name",function(){return this._name},function($B){!$B&&""===$B||this._name===$B||(this._name=$B,$q._isResourceManagersSorted=!1)}),$T(0,$B,"memorySize",function(){return this._memorySize}),$T(0,$B,"records",function(){return this._records}),$T(1,$q,"systemResourceManager",function(){return $q._systemResourceManager}),$q.__init__=function(){$q.currentResourceManager=$q.systemResourceManager},$q.getLoadedResourceManagerByIndex=function($B){return $q._resourceManagers[$B]},$q.getLoadedResourceManagersCount=function(){return $q._resourceManagers.length},$q.recreateContentManagers=function($B){void 0===$B&&($B=!1);for(var $_=$q.currentResourceManager,$Z=0;$Z<$q._resourceManagers.length;$Z++){$q.currentResourceManager=$q._resourceManagers[$Z];for(var $n=0;$n<$q.currentResourceManager._resources.length;$n++)$q.currentResourceManager._resources[$n].releaseResource($B),$q.currentResourceManager._resources[$n].activeResource($B)}$q.currentResourceManager=$_},$q.releaseContentManagers=function($B){void 0===$B&&($B=!1);for(var $_=$q.currentResourceManager,$Z=0;$Z<$q._resourceManagers.length;$Z++){$q.currentResourceManager=$q._resourceManagers[$Z];for(var $n=0;$n<$q.currentResourceManager._resources.length;$n++){var $g=$q.currentResourceManager._resources[$n];!$g.released&&$g.releaseResource($B)}}$q.currentResourceManager=$_},$q._uniqueIDCounter=0,$q._isResourceManagersSorted=!1,$q._resourceManagers=[],$m($q,["_systemResourceManager",function(){return this._systemResourceManager=new $q("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$q._systemResourceManager}]),$q}(),$K=(function(){function $B(){}$w($B,"laya.system.System"),$B.changeDefinition=function($B,$_){$N[$B]=$_;var $Z=$B+"=classObj";$N._runScript($Z)},$B.__init__=function(){$u.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $Z(){}return $w($Z,"laya.utils.Browser"),$T(1,$Z,"pixelRatio",function(){return $Z.__init__(),-1<$Z.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$v.getPixelRatio()}),$T(1,$Z,"height",function(){return $Z.__init__(),($N.stage&&$N.stage.canvasRotation?$Z.clientWidth:$Z.clientHeight)*$Z.pixelRatio}),$T(1,$Z,"clientWidth",function(){return $Z.__init__(),$Z.window.innerWidth||$Z.document.body.clientWidth}),$T(1,$Z,"window",function(){return $Z.__init__(),$Z._window}),$T(1,$Z,"clientHeight",function(){return $Z.__init__(),$Z.window.innerHeight||$Z.document.body.clientHeight||$Z.document.documentElement.clientHeight}),$T(1,$Z,"width",function(){return $Z.__init__(),($N.stage&&$N.stage.canvasRotation?$Z.clientHeight:$Z.clientWidth)*$Z.pixelRatio}),$T(1,$Z,"container",function(){return $Z.__init__(),$Z._container||(($Z._container=$Z.createElement("div")).id="layaContainer",$Z.document.body.appendChild($Z._container)),$Z._container},function($B){$Z._container=$B}),$T(1,$Z,"document",function(){return $Z.__init__(),$Z._document}),$Z.__init__=function(){if(!$Z._window){$Z._window=$v.getWindow(),$Z._document=$Z.window.document,$Z._window.addEventListener("message",function($B){laya.utils.Browser._onMessage($B)},!1),$Z.document.__createElement=$Z.document.createElement,$P.requestAnimationFrame=$P.requestAnimationFrame||$P.webkitRequestAnimationFrame||$P.mozRequestAnimationFrame||$P.oRequestAnimationFrame||$P.msRequestAnimationFrame||function($B){return $P.setTimeout($B,1e3/60)};var $B=$P.document.body.style;$B["-webkit-user-select"]="none",$B["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$Z.userAgent=$Z.window.navigator.userAgent,$Z.onIOS=!!($Z.u=$Z.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$Z.onMobile=-1<$Z.u.indexOf("Mobile"),$Z.onIPhone=-1<$Z.u.indexOf("iPhone"),$Z.onMac=-1<$Z.u.indexOf("Mac OS X"),$Z.onIPad=-1<$Z.u.indexOf("iPad"),$Z.onAndroid=-1<$Z.u.indexOf("Android")||-1<$Z.u.indexOf("Adr"),$Z.onWP=-1<$Z.u.indexOf("Windows Phone"),$Z.onQQBrowser=-1<$Z.u.indexOf("QQBrowser"),$Z.onMQQBrowser=-1<$Z.u.indexOf("MQQBrowser")||-1<$Z.u.indexOf("Mobile")&&-1<$Z.u.indexOf("QQ"),$Z.onIE=!!$Z.window.ActiveXObject||"ActiveXObject"in $Z.window,$Z.onWeiXin=-1<$Z.u.indexOf("MicroMessenger"),$Z.onPC=!$Z.onMobile,$Z.onSafari=-1<$Z.u.indexOf("Safari"),$Z.onFirefox=-1<$Z.u.indexOf("Firefox"),$Z.onEdge=-1<$Z.u.indexOf("Edge"),$Z.onMiniGame=-1<$Z.u.indexOf("MiniGame"),$Z.onLimixiu=-1<$Z.u.indexOf("limixiu"),$Z.httpProtocol="http:"==$Z.window.location.protocol,$Z.onMiniGame&&null==$Z.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$Z.webAudioEnabled=!!($Z.window.AudioContext||$Z.window.webkitAudioContext||$Z.window.mozAudioContext),$Z.soundType=$Z.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$gB=$Z.webAudioEnabled?$qB:$ZB,$Z.webAudioEnabled&&$qB.initWebAudio(),$ZB._initMusicAudio(),$Z.enableTouch="ontouchstart"in $P||$P.DocumentTouch&&$_ instanceof DocumentTouch,$P.focus(),$L._soundClass=$gB,$L._musicClass=$ZB,$u._mainCanvas=$u._mainCanvas||$CB.create("2D"),$Z.canvas||($Z.canvas=$CB.create("2D"),$Z.context=$Z.canvas.getContext("2d"))}},$Z._onMessage=function($B){if($B.data&&"size"==$B.data.name){if($Z.window.innerWidth=$B.data.width,$Z.window.innerHeight=$B.data.height,$Z.window.__innerHeight=$B.data.clientHeight,!$Z.document.createEvent)return void console.warn("no document.createEvent");var $_=$Z.document.createEvent("HTMLEvents");return $_.initEvent("resize",!1,!1),void $Z.window.dispatchEvent($_)}},$Z.createElement=function($B){return $Z.__init__(),$Z.document.__createElement($B)},$Z.getElementById=function($B){return $Z.__init__(),$Z.document.getElementById($B)},$Z.removeElement=function($B){$B&&$B.parentNode&&$B.parentNode.removeChild($B)},$Z.now=function(){return $v.now()},$Z._window=null,$Z._document=null,$Z._container=null,$Z.userAgent=null,$Z.u=null,$Z.onIOS=!1,$Z.onMac=!1,$Z.onMobile=!1,$Z.onIPhone=!1,$Z.onIPad=!1,$Z.onAndroid=!1,$Z.onWP=!1,$Z.onQQBrowser=!1,$Z.onMQQBrowser=!1,$Z.onSafari=!1,$Z.onFirefox=!1,$Z.onEdge=!1,$Z.onIE=!1,$Z.onWeiXin=!1,$Z.onMiniGame=!1,$Z.onLimixiu=!1,$Z.onPC=!1,$Z.httpProtocol=!1,$Z.webAudioEnabled=!1,$Z.soundType=null,$Z.enableTouch=!1,$Z.canvas=null,$Z.context=null,$Z.__init$=function(){},$Z}()),$H=function(){function $_($B){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$B?(this._u8d_=new Uint8Array($B),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$w($_,"laya.utils.Byte");var $B=$_.prototype;return $B.___resizeBuffer=function($_){try{var $B=new Uint8Array($_);null!=this._u8d_&&(this._u8d_.length<=$_?$B.set(this._u8d_):$B.set(this._u8d_.subarray(0,$_))),this._u8d_=$B,this._d_=new DataView($B.buffer)}catch($B){throw"___resizeBuffer err:"+$_}},$B.getString=function(){return this.rUTF(this.getUint16())},$B.getFloat32Array=function($B,$_){var $Z=$B+$_;$Z=$Z>this._length?this._length:$Z;var $n=new Float32Array(this._d_.buffer.slice($B,$Z));return this._pos_=$Z,$n},$B.getUint8Array=function($B,$_){var $Z=$B+$_;$Z=$Z>this._length?this._length:$Z;var $n=new Uint8Array(this._d_.buffer.slice($B,$Z));return this._pos_=$Z,$n},$B.getInt16Array=function($B,$_){var $Z=$B+$_;$Z=$Z>this._length?this._length:$Z;var $n=new Int16Array(this._d_.buffer.slice($B,$Z));return this._pos_=$Z,$n},$B.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $B=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$B},$B.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $B=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$B},$B.writeFloat32=function($B){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$B,this._xd_),this._pos_+=4},$B.writeFloat64=function($B){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$B,this._xd_),this._pos_+=8},$B.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $B=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$B},$B.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $B=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$B},$B.writeInt32=function($B){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$B,this._xd_),this._pos_+=4},$B.writeUint32=function($B){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$B,this._xd_),this._pos_+=4},$B.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $B=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$B},$B.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $B=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$B},$B.writeUint16=function($B){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$B,this._xd_),this._pos_+=2},$B.writeInt16=function($B){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$B,this._xd_),this._pos_+=2},$B.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$B.writeUint8=function($B){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$B),this._pos_++},$B._getUInt8=function($B){return this._d_.getUint8($B)},$B._getUint16=function($B){return this._d_.getUint16($B,this._xd_)},$B._getMatrix=function(){return new $V(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$B.rUTF=function($B){for(var $_=[],$Z=this._pos_+$B,$n=0,$g=0,$q=0,$P=String.fromCharCode,$k=this._u8d_;this._pos_<$Z;)($n=$k[this._pos_++])<128?0!=$n&&$_.push($P($n)):$n<224?$_.push($P((63&$n)<<6|127&$k[this._pos_++])):$n<240?($g=$k[this._pos_++],$_.push($P((31&$n)<<12|(127&$g)<<6|127&$k[this._pos_++]))):($g=$k[this._pos_++],$q=$k[this._pos_++],$_.push($P((15&$n)<<18|(127&$g)<<12|$q<<6&127|127&$k[this._pos_++]))),0;return $_.join("")},$B.getCustomString=function($B){for(var $_=[],$Z=0,$n=0,$g=0,$q=String.fromCharCode,$P=this._u8d_;0<$B;)if(($n=$P[this._pos_])<128)$_.push($q($n)),this._pos_++,$B--;else for($Z=$n-128,this._pos_++,$B-=$Z;0<$Z;)$n=$P[this._pos_++],$g=$P[this._pos_++],$_.push($q($g<<8|$n)),$Z--;return $_.join("")},$B.clear=function(){this._pos_=0,this.length=0},$B.__getBuffer=function(){return this._d_.buffer},$B.writeUTFBytes=function($B){for(var $_=0,$Z=($B+="").length;$_<$Z;$_++){var $n=$B.charCodeAt($_);$n<=127?this.writeByte($n):$n<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$n>>6,128|63&$n],this._pos_),this._pos_+=2):$n<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$n>>12,128|$n>>6&63,128|63&$n],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$n>>18,128|$n>>12&63,128|$n>>6&63,128|63&$n],this._pos_),this._pos_+=4)}},$B.writeUTFString=function($B){var $_=this.pos;this.writeUint16(1),this.writeUTFBytes($B);var $Z=this.pos-$_-2;if(65536<=$Z)throw"writeUTFString byte len more than 65536";this._d_.setUint16($_,$Z,this._xd_)},$B.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$B.getUTFString=function(){return this.readUTFString()},$B.readUTFBytes=function($B){if(void 0===$B&&($B=-1),0==$B)return"";var $_=this.bytesAvailable;if($_<$B)throw"readUTFBytes error - Out of bounds";return $B=0<$B?$B:$_,this.rUTF($B)},$B.getUTFBytes=function($B){return void 0===$B&&($B=-1),this.readUTFBytes($B)},$B.writeByte=function($B){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$B),this._pos_+=1},$B.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$B.getByte=function(){return this.readByte()},$B.ensureWrite=function($B){this._length<$B&&(this._length=$B),this._allocated_<$B&&(this.length=$B)},$B.writeArrayBuffer=function($B,$_,$Z){if(void 0===$_&&($_=0),void 0===$Z&&($Z=0),$_<0||$Z<0)throw"writeArrayBuffer error - Out of bounds";0==$Z&&($Z=$B.byteLength-$_),this.ensureWrite(this._pos_+$Z);var $n=new Uint8Array($B);this._u8d_.set($n.subarray($_,$_+$Z),this._pos_),this._pos_+=$Z},$T(0,$B,"buffer",function(){var $B=this._d_.buffer;return $B.byteLength==this.length?$B:$B.slice(0,this.length)}),$T(0,$B,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($B){this._xd_="littleEndian"==$B}),$T(0,$B,"length",function(){return this._length},function($B){this._allocated_<$B?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($B,2*this._allocated_))):this._allocated_>$B&&this.___resizeBuffer(this._allocated_=$B),this._length=$B}),$T(0,$B,"pos",function(){return this._pos_},function($B){this._pos_=$B}),$T(0,$B,"bytesAvailable",function(){return this._length-this._pos_}),$_.getSystemEndian=function(){if(!$_._sysEndian){var $B=new ArrayBuffer(2);new DataView($B).setInt16(0,256,!0),$_._sysEndian=256===new Int16Array($B)[0]?"littleEndian":"bigEndian"}return $_._sysEndian},$_.BIG_ENDIAN="bigEndian",$_.LITTLE_ENDIAN="littleEndian",$_._sysEndian=null,$_}(),$G=function(){function $g(){}return $w($g,"laya.utils.CacheManager"),$g.regCacheByFunction=function($B,$_){var $Z;$g.unRegCacheByFunction($B,$_),$Z={tryDispose:$B,getCacheList:$_},$g._cacheList.push($Z)},$g.unRegCacheByFunction=function($B,$_){var $Z,$n=0;for($Z=$g._cacheList.length,$n=0;$n<$Z;$n++)if($g._cacheList[$n].tryDispose==$B&&$g._cacheList[$n].getCacheList==$_)return void $g._cacheList.splice($n,1)},$g.forceDispose=function(){var $B=0,$_=$g._cacheList.length;for($B=0;$B<$_;$B++)$g._cacheList[$B].tryDispose(!0)},$g.beginCheck=function($B){void 0===$B&&($B=15e3),$N.timer.loop($B,null,$g._checkLoop)},$g.stopCheck=function(){$N.timer.clear(null,$g._checkLoop)},$g._checkLoop=function(){var $B=$g._cacheList;if(!($B.length<1)){var $_,$Z=$K.now(),$n=0;for($_=$n=$B.length;0<$n&&($B[$g._index=++$g._index%$_].tryDispose(!1),!($K.now()-$Z>$g.loopTimeLimit));)$n--}},$g.loopTimeLimit=2,$g._cacheList=[],$g._index=0,$g}(),$W=function(){function $A(){}return $w($A,"laya.utils.ClassUtils"),$A.regClass=function($B,$_){$A._classMap[$B]=$_},$A.getRegClass=function($B){return $A._classMap[$B]},$A.getInstance=function($B){var $_=$A.getClass($B);return $_?new $_:(console.warn("[error] Undefined class:",$B),null)},$A.createByJson=function($B,$_,$Z,$n,$g){"string"==typeof $B&&($B=JSON.parse($B));var $q=$B.props;if(!$_&&!($_=$g?$g.runWith($B):$A.getInstance($q.runtime||$B.type)))return null;var $P=$B.child;if($P)for(var $k=0,$m=$P.length;$k<$m;$k++){var $D=$P[$k];if("render"!==$D.props.name&&"render"!==$D.props.renderType||!$_._$set_itemRender)if("Graphic"==$D.type)$A.addGraphicsToSprite($D,$_);else if($A.isDrawType($D.type))$A.addGraphicToSprite($D,$_,!0);else{var $T=$A.createByJson($D,null,$Z,$n,$g);"Script"==$D.type?$T.hasOwnProperty("owner")?$T.owner=$_:$T.hasOwnProperty("target")&&($T.target=$_):"mask"==$D.props.renderType?$_.mask=$T:$_.addChild($T)}else $_.itemRender=$D}if($q)for(var $e in $q){var $I=$q[$e];"var"===$e&&$Z?$Z[$I]=$_:$I instanceof Array&&"function"==typeof $_[$e]?$_[$e].apply($_,$I):$_[$e]=$I}return $n&&$B.customProps&&$n.runWith([$_,$B]),$_.created&&$_.created(),$_},$A.addGraphicsToSprite=function($B,$_){var $Z;if(($Z=$B.child)&&!($Z.length<1)){var $n;$n=$A._getGraphicsFromSprite($B,$_);var $g=0,$q=0;$B.props&&($g=$A._getObjVar($B.props,"x",0),$q=$A._getObjVar($B.props,"y",0)),0!=$g&&0!=$q&&$n.translate($g,$q);var $P,$k=0;for($P=$Z.length,$k=0;$k<$P;$k++)$A._addGraphicToGraphics($Z[$k],$n);0!=$g&&0!=$q&&$n.translate(-$g,-$q)}},$A.addGraphicToSprite=function($B,$_,$Z){var $n;void 0===$Z&&($Z=!1),$n=$Z?$A._getGraphicsFromSprite($B,$_):$_.graphics,$A._addGraphicToGraphics($B,$n)},$A._getGraphicsFromSprite=function($B,$_){var $Z,$n;if(!$B||!$B.props)return $_.graphics;switch($n=$B.props.renderType){case"hit":case"unHit":var $g;$_.hitArea||($_.hitArea=new $s),($g=$_.hitArea)[$n]||($g[$n]=new $I),$Z=$g[$n]}return $Z||($Z=$_.graphics),$Z},$A._getTransformData=function($B){var $_;($B.hasOwnProperty("pivotX")||$B.hasOwnProperty("pivotY"))&&($_=$_||new $V).translate(-$A._getObjVar($B,"pivotX",0),-$A._getObjVar($B,"pivotY",0));var $Z=$A._getObjVar($B,"scaleX",1),$n=$A._getObjVar($B,"scaleY",1),$g=$A._getObjVar($B,"rotation",0);$A._getObjVar($B,"skewX",0),$A._getObjVar($B,"skewY",0);return 1==$Z&&1==$n&&0==$g||(($_=$_||new $V).scale($Z,$n),$_.rotate(.0174532922222222*$g)),$_},$A._addGraphicToGraphics=function($B,$_){var $Z,$n;if(($Z=$B.props)&&($n=$A.DrawTypeDic[$B.type])){var $g,$q;$g=$_;var $P=$A._getParams($Z,$n[1],$n[2],$n[3]);(($q=$A._tM)||1!=$A._alpha)&&($g.save(),$q&&$g.transform($q),1!=$A._alpha&&$g.alpha($A._alpha)),$g[$n[0]].apply($g,$P),($q||1!=$A._alpha)&&$g.restore()}},$A._adptLineData=function($B){return $B[2]=parseFloat($B[0])+parseFloat($B[2]),$B[3]=parseFloat($B[1])+parseFloat($B[3]),$B},$A._adptTextureData=function($B){return $B[0]=$kB.getRes($B[0]),$B},$A._adptLinesData=function($B){return $B[2]=$A._getPointListByStr($B[2]),$B},$A.isDrawType=function($B){return"Image"!=$B&&$A.DrawTypeDic.hasOwnProperty($B)},$A._getParams=function($B,$_,$Z,$n){var $g;void 0===$Z&&($Z=0),($g=$A._temParam).length=$_.length;var $q,$P,$k=0;for($q=$_.length,$k=0;$k<$q;$k++)$g[$k]=$A._getObjVar($B,$_[$k][0],$_[$k][1]);return $A._alpha=$A._getObjVar($B,"alpha",1),$P=$A._getTransformData($B),$A._tM=$P?($Z||($Z=0),$P.translate($g[$Z],$g[$Z+1]),$g[$Z]=$g[$Z+1]=0,$P):null,$n&&$A[$n]&&($g=$A[$n]($g)),$g},$A._getPointListByStr=function($B){var $_,$Z,$n=0;for($Z=($_=$B.split(",")).length,$n=0;$n<$Z;$n++)$_[$n]=parseFloat($_[$n]);return $_},$A._getObjVar=function($B,$_,$Z){return $B.hasOwnProperty($_)?$B[$_]:$Z},$A._temParam=[],$A._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$A.getClass=function($B){var $_=$A._classMap[$B]||$B;return"string"==typeof $_?$N.__classmap[$_]:$_},$A._tM=null,$A._alpha=NaN,$m($A,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$A}(),$X=function(){function $q($B){if(this._color=[],"string"==typeof $B){null===(this.strColor=$B)&&($B="#000000"),"#"==$B.charAt(0)&&($B=$B.substr(1));var $_=$B.length;if(3==$_||4==$_){for(var $Z="",$n=0;$n<$_;$n++)$Z+=$B[$n]+$B[$n];$B=$Z}var $g=this.numColor=parseInt($B,16);if(8==$B.length)return void(this._color=[parseInt($B.substr(0,2),16)/255,((16711680&$g)>>16)/255,((65280&$g)>>8)/255,(255&$g)/255])}else $g=this.numColor=$B,this.strColor=$a.toHexColor($g);this._color=[((16711680&$g)>>16)/255,((65280&$g)>>8)/255,(255&$g)/255,1],this._color.__id=++$q._COLODID}return $w($q,"laya.utils.Color"),$q._initDefault=function(){for(var $B in $q._DEFAULT={},$q._COLOR_MAP)$q._SAVE[$B]=$q._DEFAULT[$B]=new $q($q._COLOR_MAP[$B]);return $q._DEFAULT},$q._initSaveMap=function(){for(var $B in $q._SAVE_SIZE=0,$q._SAVE={},$q._DEFAULT)$q._SAVE[$B]=$q._DEFAULT[$B]},$q.create=function($B){var $_=$q._SAVE[$B+""];return null!=$_?$_:($q._SAVE_SIZE<1e3||$q._initSaveMap(),$q._SAVE[$B+""]=new $q($B))},$q._SAVE={},$q._SAVE_SIZE=0,$q._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$q._DEFAULT=$q._initDefault(),$q._COLODID=1,$q}(),$R=(function(){function $B(){this._values=[],this._keys=[]}$w($B,"laya.utils.Dictionary");var $_=$B.prototype;$_.set=function($B,$_){var $Z=this.indexOf($B);0<=$Z?this._values[$Z]=$_:(this._keys.push($B),this._values.push($_))},$_.indexOf=function($B){var $_=this._keys.indexOf($B);return 0<=$_?$_:($B="string"==typeof $B?Number($B):"number"==typeof $B?$B.toString():$B,this._keys.indexOf($B))},$_.get=function($B){var $_=this.indexOf($B);return $_<0?null:this._values[$_]},$_.remove=function($B){var $_=this.indexOf($B);return 0<=$_&&(this._keys.splice($_,1),this._values.splice($_,1),!0)},$_.clear=function(){this._values.length=0,this._keys.length=0},$T(0,$_,"values",function(){return this._values}),$T(0,$_,"keys",function(){return this._keys})}(),function(){function $B(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$w($B,"laya.utils.Dragging");var $_=$B.prototype;return $_.start=function($B,$_,$Z,$n,$g,$q,$P,$k){void 0===$k&&($k=.92),this.clearTimer(),this.target=$B,this.area=$_,this.hasInertia=$Z,this.elasticDistance=$_?$n:0,this.elasticBackTime=$g,this.data=$q,this._disableMouseEvent=$P,this.ratio=$k,1!=$B.globalScaleX||1!=$B.globalScaleY?this._parent=$B.parent:this._parent=$N.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$N.stage.on("mouseup",this,this.onStageMouseUp),$N.stage.on("mouseout",this,this.onStageMouseUp),$N.timer.frameLoop(1,this,this.loop)},$_.clearTimer=function(){$N.timer.clear(this,this.loop),$N.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$_.stop=function(){this._dragging&&($$.instance.disableMouseEvent=!1,$N.stage.off("mouseup",this,this.onStageMouseUp),$N.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$_.loop=function(){var $B=this._parent.getMousePoint(),$_=$B.x,$Z=$B.y,$n=$_-this._lastX,$g=$Z-this._lastY;if(this._clickOnly){if(!(1<Math.abs($n*$N.stage._canvasTransform.getScaleX())||1<Math.abs($g*$N.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$$.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($n,$g);0==$n&&0==$g||(this._lastX=$_,this._lastY=$Z,this.target.x+=$n*this._elasticRateX,this.target.y+=$g*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$_.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $B=this.area.x-this.target.x;else $B=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$B/this.elasticDistance),this.target.y<this.area.y)var $_=this.area.y-this.target.y;else $_=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$_/this.elasticDistance)}},$_.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$_.onStageMouseUp=function($B){if($$.instance.disableMouseEvent=!1,$N.stage.off("mouseup",this,this.onStageMouseUp),$N.stage.off("mouseout",this,this.onStageMouseUp),$N.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $_=this._offsets.length,$Z=Math.min($_,6),$n=this._offsets.length-$Z,$g=$_-1;$n<$g;$g--)this._offsetY+=this._offsets[$g--],this._offsetX+=this._offsets[$g];this._offsetX=this._offsetX/$Z*2,this._offsetY=this._offsetY/$Z*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$N.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$_.checkElastic=function(){var $B=NaN,$_=NaN;if(this.target.x<this.area.x?$B=this.area.x:this.target.x>this.area.x+this.area.width&&($B=this.area.x+this.area.width),this.target.y<this.area.y?$_=this.area.y:this.target.y>this.area.y+this.area.height&&($_=this.area.y+this.area.height),isNaN($B)&&isNaN($_))this.clear();else{var $Z={};isNaN($B)||($Z.x=$B),isNaN($_)||($Z.y=$_),this._tween=$d.to(this.target,$Z,this.elasticBackTime,$h.sineOut,$y.create(this,this.clear),0,!1,!1)}},$_.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($N.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$_.clear=function(){if(this.target){this.clearTimer();var $B=this.target;this.target=null,this._parent=null,$B.event("dragend",this.data)}},$B}()),$h=function(){function $k(){}return $w($k,"laya.utils.Ease"),$k.linearNone=function($B,$_,$Z,$n){return $Z*$B/$n+$_},$k.linearIn=function($B,$_,$Z,$n){return $Z*$B/$n+$_},$k.linearInOut=function($B,$_,$Z,$n){return $Z*$B/$n+$_},$k.linearOut=function($B,$_,$Z,$n){return $Z*$B/$n+$_},$k.bounceIn=function($B,$_,$Z,$n){return $Z-$k.bounceOut($n-$B,0,$Z,$n)+$_},$k.bounceInOut=function($B,$_,$Z,$n){return $B<.5*$n?.5*$k.bounceIn(2*$B,0,$Z,$n)+$_:.5*$k.bounceOut(2*$B-$n,0,$Z,$n)+.5*$Z+$_},$k.bounceOut=function($B,$_,$Z,$n){return($B/=$n)<1/2.75?$Z*(7.5625*$B*$B)+$_:$B<2/2.75?$Z*(7.5625*($B-=1.5/2.75)*$B+.75)+$_:$B<2.5/2.75?$Z*(7.5625*($B-=2.25/2.75)*$B+.9375)+$_:$Z*(7.5625*($B-=2.625/2.75)*$B+.984375)+$_},$k.backIn=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=1.70158),$Z*($B/=$n)*$B*(($g+1)*$B-$g)+$_},$k.backInOut=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=1.70158),($B/=.5*$n)<1?.5*$Z*($B*$B*((1+($g*=1.525))*$B-$g))+$_:$Z/2*(($B-=2)*$B*((1+($g*=1.525))*$B+$g)+2)+$_},$k.backOut=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=1.70158),$Z*(($B=$B/$n-1)*$B*(($g+1)*$B+$g)+1)+$_},$k.elasticIn=function($B,$_,$Z,$n,$g,$q){var $P;return void 0===$g&&($g=0),void 0===$q&&($q=0),0==$B?$_:1==($B/=$n)?$_+$Z:($q||($q=.3*$n),$P=!$g||0<$Z&&$g<$Z||$Z<0&&$g<-$Z?($g=$Z,$q/4):$q/$k.PI2*Math.asin($Z/$g),-$g*Math.pow(2,10*($B-=1))*Math.sin(($B*$n-$P)*$k.PI2/$q)+$_)},$k.elasticInOut=function($B,$_,$Z,$n,$g,$q){var $P;return void 0===$g&&($g=0),void 0===$q&&($q=0),0==$B?$_:2==($B/=.5*$n)?$_+$Z:($q||($q=$n*(.3*1.5)),$P=!$g||0<$Z&&$g<$Z||$Z<0&&$g<-$Z?($g=$Z,$q/4):$q/$k.PI2*Math.asin($Z/$g),$B<1?$g*Math.pow(2,10*($B-=1))*Math.sin(($B*$n-$P)*$k.PI2/$q)*-.5+$_:$g*Math.pow(2,-10*($B-=1))*Math.sin(($B*$n-$P)*$k.PI2/$q)*.5+$Z+$_)},$k.elasticOut=function($B,$_,$Z,$n,$g,$q){var $P;return void 0===$g&&($g=0),void 0===$q&&($q=0),0==$B?$_:1==($B/=$n)?$_+$Z:($q||($q=.3*$n),$P=!$g||0<$Z&&$g<$Z||$Z<0&&$g<-$Z?($g=$Z,$q/4):$q/$k.PI2*Math.asin($Z/$g),$g*Math.pow(2,-10*$B)*Math.sin(($B*$n-$P)*$k.PI2/$q)+$Z+$_)},$k.strongIn=function($B,$_,$Z,$n){return $Z*($B/=$n)*$B*$B*$B*$B+$_},$k.strongInOut=function($B,$_,$Z,$n){return($B/=.5*$n)<1?.5*$Z*$B*$B*$B*$B*$B+$_:.5*$Z*(($B-=2)*$B*$B*$B*$B+2)+$_},$k.strongOut=function($B,$_,$Z,$n){return $Z*(($B=$B/$n-1)*$B*$B*$B*$B+1)+$_},$k.sineInOut=function($B,$_,$Z,$n){return.5*-$Z*(Math.cos(Math.PI*$B/$n)-1)+$_},$k.sineIn=function($B,$_,$Z,$n){return-$Z*Math.cos($B/$n*$k.HALF_PI)+$Z+$_},$k.sineOut=function($B,$_,$Z,$n){return $Z*Math.sin($B/$n*$k.HALF_PI)+$_},$k.quintIn=function($B,$_,$Z,$n){return $Z*($B/=$n)*$B*$B*$B*$B+$_},$k.quintInOut=function($B,$_,$Z,$n){return($B/=.5*$n)<1?.5*$Z*$B*$B*$B*$B*$B+$_:.5*$Z*(($B-=2)*$B*$B*$B*$B+2)+$_},$k.quintOut=function($B,$_,$Z,$n){return $Z*(($B=$B/$n-1)*$B*$B*$B*$B+1)+$_},$k.quartIn=function($B,$_,$Z,$n){return $Z*($B/=$n)*$B*$B*$B+$_},$k.quartInOut=function($B,$_,$Z,$n){return($B/=.5*$n)<1?.5*$Z*$B*$B*$B*$B+$_:.5*-$Z*(($B-=2)*$B*$B*$B-2)+$_},$k.quartOut=function($B,$_,$Z,$n){return-$Z*(($B=$B/$n-1)*$B*$B*$B-1)+$_},$k.cubicIn=function($B,$_,$Z,$n){return $Z*($B/=$n)*$B*$B+$_},$k.cubicInOut=function($B,$_,$Z,$n){return($B/=.5*$n)<1?.5*$Z*$B*$B*$B+$_:.5*$Z*(($B-=2)*$B*$B+2)+$_},$k.cubicOut=function($B,$_,$Z,$n){return $Z*(($B=$B/$n-1)*$B*$B+1)+$_},$k.quadIn=function($B,$_,$Z,$n){return $Z*($B/=$n)*$B+$_},$k.quadInOut=function($B,$_,$Z,$n){return($B/=.5*$n)<1?.5*$Z*$B*$B+$_:.5*-$Z*(--$B*($B-2)-1)+$_},$k.quadOut=function($B,$_,$Z,$n){return-$Z*($B/=$n)*($B-2)+$_},$k.expoIn=function($B,$_,$Z,$n){return 0==$B?$_:$Z*Math.pow(2,10*($B/$n-1))+$_-.001*$Z},$k.expoInOut=function($B,$_,$Z,$n){return 0==$B?$_:$B==$n?$_+$Z:($B/=.5*$n)<1?.5*$Z*Math.pow(2,10*($B-1))+$_:.5*$Z*(2-Math.pow(2,-10*--$B))+$_},$k.expoOut=function($B,$_,$Z,$n){return $B==$n?$_+$Z:$Z*(1-Math.pow(2,-10*$B/$n))+$_},$k.circIn=function($B,$_,$Z,$n){return-$Z*(Math.sqrt(1-($B/=$n)*$B)-1)+$_},$k.circInOut=function($B,$_,$Z,$n){return($B/=.5*$n)<1?.5*-$Z*(Math.sqrt(1-$B*$B)-1)+$_:.5*$Z*(Math.sqrt(1-($B-=2)*$B)+1)+$_},$k.circOut=function($B,$_,$Z,$n){return $Z*Math.sqrt(1-($B=$B/$n-1)*$B)+$_},$k.HALF_PI=.5*Math.PI,$k.PI2=2*Math.PI,$k}(),$s=function(){function $e(){this._hit=null,this._unHit=null}$w($e,"laya.utils.HitArea");var $B=$e.prototype;return $B.isHit=function($B,$_){return!!$e.isHitGraphic($B,$_,this.hit)&&!$e.isHitGraphic($B,$_,this.unHit)},$B.contains=function($B,$_){return this.isHit($B,$_)},$T(0,$B,"hit",function(){return this._hit||(this._hit=new $I),this._hit},function($B){this._hit=$B}),$T(0,$B,"unHit",function(){return this._unHit||(this._unHit=new $I),this._unHit},function($B){this._unHit=$B}),$e.isHitGraphic=function($B,$_,$Z){if(!$Z)return!1;var $n;if(!($n=$Z.cmds)&&$Z._one&&(($n=$e._cmds).length=1,$n[0]=$Z._one),!$n)return!1;var $g,$q,$P=0;for($g=$n.length,$P=0;$P<$g;$P++)if($q=$n[$P]){var $k=$u._context;switch($q.callee){case $k._translate:case 6:$B-=$q[0],$_-=$q[1]}if($e.isHitCmd($B,$_,$q))return!0}return!1},$e.isHitCmd=function($B,$_,$Z){if(!$Z)return!1;var $n=$u._context,$g=!1;switch($Z.callee){case $n._drawRect:case 13:$e._rec.setTo($Z[0],$Z[1],$Z[2],$Z[3]),$g=$e._rec.contains($B,$_);break;case $n._drawCircle:case $n._fillCircle:case 14:$g=($B-=$Z[0])*$B+($_-=$Z[1])*$_<$Z[2]*$Z[2];break;case $n._drawPoly:case 18:$B-=$Z[0],$_-=$Z[1],$g=$e.ptInPolygon($B,$_,$Z[2])}return $g},$e.ptInPolygon=function($B,$_,$Z){var $n;($n=$e._ptPoint).setTo($B,$_);var $g,$q=0,$P=NaN,$k=NaN,$m=NaN,$D=NaN;$g=$Z.length;for(var $T=0;$T<$g;$T+=2){if($P=$Z[$T],$k=$Z[$T+1],$m=$Z[($T+2)%$g],$k!=($D=$Z[($T+3)%$g]))if(!($n.y<Math.min($k,$D)))if(!($n.y>=Math.max($k,$D)))($n.y-$k)*($m-$P)/($D-$k)+$P>$n.x&&$q++}return $q%2==1},$e._cmds=[],$m($e,["_rec",function(){return this._rec=new $M},"_ptPoint",function(){return this._ptPoint=new $Q}]),$e}(),$U=(function(){function $g($B,$_,$Z,$n){this.char=$B,this.charNum=$B.charCodeAt(0),this._x=this._y=0,this.width=$_,this.height=$Z,this.style=$n,this.isWord=!$g._isWordRegExp.test($B)}$w($g,"laya.utils.HTMLChar");var $B=$g.prototype;$N.imps($B,{"laya.display.ILayout":!0}),$B.setSprite=function($B){this._sprite=$B},$B.getSprite=function(){return this._sprite},$B._isChar=function(){return!0},$B._getCSSStyle=function(){return this.style},$T(0,$B,"width",function(){return this._w},function($B){this._w=$B}),$T(0,$B,"x",function(){return this._x},function($B){this._sprite&&(this._sprite.x=$B),this._x=$B}),$T(0,$B,"y",function(){return this._y},function($B){this._sprite&&(this._sprite.y=$B),this._y=$B}),$T(0,$B,"height",function(){return this._h},function($B){this._h=$B}),$g._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $_(){}$w($_,"laya.utils.Log"),$_.enable=function(){$_._logdiv||($_._logdiv=$K.window.document.createElement("div"),$K.window.document.body.appendChild($_._logdiv),$_._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$_.toggle=function(){var $B=$_._logdiv.style;"1px"==$B.width?$B.width=$B.height="50%":$B.width=$B.height="1px"},$_.print=function($B){$_._logdiv&&($_.maxCount<=$_._count&&$_.clear(),$_._count++,$_._logdiv.innerText+=$B+"\n",$_._logdiv.scrollTop=$_._logdiv.scrollHeight)},$_.clear=function(){$_._logdiv.innerText="",$_._count=0},$_._logdiv=null,$_._count=0,$_.maxCount=20}(),function(){function $_(){}$w($_,"laya.utils.Mouse"),$T(1,$_,"cursor",function(){return $_._style.cursor},function($B){$_._style.cursor=$B}),$_.hide=function(){"none"!=$_.cursor&&($_._preCursor=$_.cursor,$_.cursor="none")},$_.show=function(){"none"==$_.cursor&&($_.cursor=$_._preCursor?$_._preCursor:"auto")},$_._preCursor=null,$m($_,["_style",function(){return this._style=$K.document.body.style}])}(),function(){function $q(){}return $w($q,"laya.utils.Pool"),$q.getPoolBySign=function($B){return $q._poolDic[$B]||($q._poolDic[$B]=[])},$q.clearBySign=function($B){$q._poolDic[$B]&&($q._poolDic[$B].length=0)},$q.recover=function($B,$_){$_.__InPool||($_.__InPool=!0,$q.getPoolBySign($B).push($_))},$q.getItemByClass=function($B,$_){var $Z=$q.getPoolBySign($B),$n=$Z.length?$Z.pop():new $_;return $n.__InPool=!1,$n},$q.getItemByCreateFun=function($B,$_,$Z){var $n=$q.getPoolBySign($B),$g=$n.length?$n.pop():$_.call($Z);return $g.__InPool=!1,$g},$q.getItem=function($B){var $_=$q.getPoolBySign($B),$Z=$_.length?$_.pop():null;return $Z&&($Z.__InPool=!1),$Z},$q._poolDic={},$q.InPoolSign="__InPool",$q}()),$S=function(){function $m(){}return $w($m,"laya.utils.Stat"),$T(1,$m,"onclick",null,function($B){$m._sp&&$m._sp.on("click",$m._sp,$B),$m._canvas&&($m._canvas.source.onclick=$B,$m._canvas.source.style.pointerEvents="")}),$m.show=function($B,$_,$Z){if(void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),!$u.isConchApp||$u.isConchWebGL){if($u.isConchWebGL||$K.onMiniGame||$K.onLimixiu||($m._useCanvas=!0),$m._show=!0,$m._fpsData.length=60,$m._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$m._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$m._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$m._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$u.isWebGL)if($m._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$u.is3DMode){if($m._view[0].title="FPS(3D)",$m._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$m._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$m._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$Z){var $n=8;$m._view[$n++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$m._view[$n++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$m._view[$n++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$Z){$n=8;$m._view[$n++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$m._view[$n++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$m._view[$n++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$m._view[$n++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$m._view[$n++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$m._view[$n++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$m._view[$n++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $m._view[0].title="FPS(WebGL)",$m._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $m._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$m._useCanvas?$m.createUIPre($B,$_):$m.createUI($B,$_),$m.enable()}else $K.window.conch.showFPS&&$K.window.conch.showFPS($B,$_)},$m.createUIPre=function($B,$_){var $Z=$K.pixelRatio;$m._width=170*$Z,$m._vx=75*$Z,$m._height=$Z*(12*$m._view.length+3*$Z)+4,$m._fontSize=12*$Z;for(var $n=0;$n<$m._view.length;$n++)$m._view[$n].x=4,$m._view[$n].y=$n*$m._fontSize+2*$Z;$m._canvas||(($m._canvas=new $CB("2D")).size($m._width,$m._height),($m._ctx=$m._canvas.getContext("2d")).textBaseline="top",$m._ctx.font=$m._fontSize+"px Sans-serif",$m._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$B+"px;top:"+$_+"px;width:"+$m._width/$Z+"px;height:"+$m._height/$Z+"px;"),$m._first=!0,$m.loop(),$m._first=!1,$K.container.appendChild($m._canvas.source)},$m.createUI=function($B,$_){var $Z=$m._sp,$n=$K.pixelRatio;$Z||($Z=new $eB,($m._leftText=new $rB).pos(5,5),$m._leftText.color="#ffffff",$Z.addChild($m._leftText),($m._txt=new $rB).pos(80*$n,5),$m._txt.color="#ffffff",$Z.addChild($m._txt),$m._sp=$Z),$Z.pos($B,$_);for(var $g="",$q=0;$q<$m._view.length;$q++){$g+=$m._view[$q].title+"\n"}$m._leftText.text=$g;var $P=170*$n,$k=$n*(12*$m._view.length+3*$n)+4;$m._txt.fontSize=$m._fontSize*$n,$m._leftText.fontSize=$m._fontSize*$n,$Z.size($P,$k),$Z.graphics.clear(),$Z.graphics.setAlpha(.5),$Z.graphics.drawRect(0,0,$P,$k,"#999999"),$Z.graphics.setAlpha(1),$m.loop()},$m.enable=function(){$N.timer.frameLoop(1,$m,$m.loop)},$m.hide=function(){$m._show=!1,$N.timer.clear($m,$m.loop),$m._canvas&&$K.removeElement($m._canvas.source)},$m.clear=function(){$m.trianglesFaces=$m.drawCall=$m.shaderCall=$m.spriteCount=$m.spriteRenderUseCacheCount=$m.treeNodeCollision=$m.treeSpriteCollision=$m.canvasNormal=$m.canvasBitmap=$m.canvasReCache=0},$m.loop=function(){$m._count++;var $B=$K.now();if(!($B-$m._timer<1e3)){var $_=$m._count;if($m.FPS=Math.round(1e3*$_/($B-$m._timer)),$m._show){$m.trianglesFaces=Math.round($m.trianglesFaces/$_),$m.spriteCount=$m._useCanvas?($m.drawCall=Math.round($m.drawCall/$_)-2,$m.shaderCall=Math.round($m.shaderCall/$_),Math.round($m.spriteCount/$_)-1):($m.drawCall=Math.round($m.drawCall/$_)-2,$m.shaderCall=Math.round($m.shaderCall/$_)-4,Math.round($m.spriteCount/$_)-4),$m.spriteRenderUseCacheCount=Math.round($m.spriteRenderUseCacheCount/$_),$m.canvasNormal=Math.round($m.canvasNormal/$_),$m.canvasBitmap=Math.round($m.canvasBitmap/$_),$m.canvasReCache=Math.ceil($m.canvasReCache/$_),$m.treeNodeCollision=Math.round($m.treeNodeCollision/$_),$m.treeSpriteCollision=Math.round($m.treeSpriteCollision/$_);var $Z=0<$m.FPS?Math.floor(1e3/$m.FPS).toString():" ";$m._fpsStr=$m.FPS+($m.renderSlow?" slow":"")+" "+$Z,$m._spriteStr=$m.spriteCount+($m.spriteRenderUseCacheCount?"/"+$m.spriteRenderUseCacheCount:""),$m._canvasStr=$m.canvasReCache+"/"+$m.canvasNormal+"/"+$m.canvasBitmap,$m.currentMemorySize=$p.systemResourceManager.memorySize,$m._useCanvas?$m.renderInfoPre():$m.renderInfo(),$m.clear()}$m._count=0,$m._timer=$B}},$m.renderInfoPre=function(){if($m._canvas){var $B=$m._ctx;$B.clearRect($m._first?0:$m._vx,0,$m._width,$m._height);for(var $_=$u.WebGL.mainContext,$Z=0;$Z<$m._view.length;$Z++){var $n=$m._view[$Z];$m._first&&($B.fillStyle="white",$B.fillText($n.title,$n.x,$n.y,null,null,null)),$B.fillStyle=$n.color;var $g=-1;if(($n=$m._view[$Z]).varying){if($_)switch($n.varying){case 1:$g=$_.getParameter($_[$n.value]);break;case 2:$g=$_.getExtension($n.value)}}else $g=$m[$n.value];"M"==$n.units&&($g=Math.floor($g/1048576*100)/100+" M"),"K"==$n.units&&($g=Math.floor($g/1024*100)/100+" K"),"string"==$n.units&&($g=$g.match(/\d+\.?\d/i)),$B.fillText($g+"",$n.x+$m._vx,$n.y,null,null,null)}}},$m.renderInfo=function(){for(var $B="",$_=$u.WebGL.mainContext,$Z=0;$Z<$m._view.length;$Z++){var $n=$m._view[$Z],$g=-1;if($n.varying){if($_)switch($n.varying){case 1:$g=$_.getParameter($_[$n.value]);break;case 2:$g=$_.getExtension($n.value)}}else $g=$m[$n.value];"M"==$n.units&&($g=Math.floor($g/1048576*100)/100+" M"),"K"==$n.units&&($g=Math.floor($g/1024*100)/100+" K"),"string"==$n.units&&($g=$g.match(/\d+\.?\d/i)),$B+=$g+"\n"}$m._txt.text=$B},$m.FPS=0,$m.loopCount=0,$m.shaderCall=0,$m.drawCall=0,$m.trianglesFaces=0,$m.spriteCount=0,$m.spriteRenderUseCacheCount=0,$m.treeNodeCollision=0,$m.treeSpriteCollision=0,$m.canvasNormal=0,$m.canvasBitmap=0,$m.canvasReCache=0,$m.renderSlow=!1,$m.currentMemorySize=0,$m._fpsStr=null,$m._canvasStr=null,$m._spriteStr=null,$m._fpsData=[],$m._timer=0,$m._count=0,$m._view=[],$m._fontSize=12,$m._txt=null,$m._leftText=null,$m._sp=null,$m._show=!1,$m._useCanvas=!1,$m._canvas=null,$m._ctx=null,$m._first=!1,$m._vx=NaN,$m._width=0,$m._height=100,$m}(),$O=(function(){function $B(){this._strsToID={},this._idToStrs=[],this._length=0}$w($B,"laya.utils.StringKey");var $_=$B.prototype;$_.add=function($B){var $_=this._strsToID[$B];return null!=$_?$_:(this._idToStrs[this._length]=$B,this._strsToID[$B]=this._length++)},$_.getID=function($B){var $_=this._strsToID[$B];return null==$_?-1:$_},$_.getName=function($B){var $_=this._idToStrs[$B];return null==$_?void 0:$_}}(),function(){var $D;function $B(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$w($B,"laya.utils.Timer");var $_=$B.prototype;return $_._init=function(){$N.timer&&$N.timer.frameLoop(1,this,this._update)},$_._now=function(){return Date.now()},$_._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $B=this.currFrame=this.currFrame+this.scale,$_=this._now();this._delta=($_-this._lastTimer)*this.scale;var $Z=this.currTimer=this.currTimer+this._delta;$N.isDebug&&6e4<Math.abs($_-this._lastTimer)&&console.error("系统时间错误！"+($_-this._lastTimer)),this._lastTimer=$_;var $n=this._handlers;for($P=this._count=0,$k=$n.length;$P<$k;$P++)if(null!==($m=$n[$P]).method){var $g=$m.userFrame?$B:$Z;if($g>=$m.exeTime)if($m.repeat)if($m.jumpFrame)for(;$g>=$m.exeTime;)$m.exeTime+=$m.delay,$m.run(!1);else $m.exeTime+=$m.delay,$m.run(!1),$g>$m.exeTime&&($m.exeTime+=Math.ceil(($g-$m.exeTime)/$m.delay)*$m.delay);else $m.run(!0)}else this._count++;(30<this._count||$B%200==0)&&this._clearHandlers();for(var $q=this._laters,$P=0,$k=$q.length-1;$P<=$k;$P++){var $m=$q[$P];this._isIgnoreRecover($m)||(null!==$m.method&&(delete this._map[$m.key],$m.run(!1)),this._recoverHandler($m)),$P===$k&&($k=$q.length-1)}$q.length=0}},$_._clearHandlers=function(){for(var $B=this._handlers,$_=0,$Z=$B.length;$_<$Z;$_++){var $n=$B[$_];null!==$n.method?this._temp.push($n):this._isIgnoreRecover($n)?this._temp.push($n):this._recoverHandler($n)}this._handlers=this._temp,this._temp=$B,this._temp.length=0},$_._recoverHandler=function($B){this._map[$B.key]==$B&&delete this._map[$B.key],$B.recover()},$_._create=function($B,$_,$Z,$n,$g,$q,$P,$k){if(!$Z)return $g.apply($n,$q),null;if($P){var $m=this._getHandler($n,$g);if($m)return $m.repeat=$_,$m.userFrame=$B,$m.delay=$Z,$m.ignoreRecover=$k,$m.caller=$n,$m.method=$g,$m.args=$q,$m.exeTime=$Z+($B?this.currFrame:this.currTimer+this._now()-this._lastTimer),$m}return($m=$D.create()).repeat=$_,$m.userFrame=$B,$m.delay=$Z,$m.ignoreRecover=$k,$m.caller=$n,$m.method=$g,$m.args=$q,$m.exeTime=$Z+($B?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($m),this._handlers.push($m),$m},$_._indexHandler=function($B){var $_=$B.caller,$Z=$B.method,$n=$_?$_.$_GID||($_.$_GID=$a.getGID()):0,$g=$Z.$_TID||($Z.$_TID=this._mid++);$B.key=$n+"_"+$g,this._map[$B.key]=$B},$_.once=function($B,$_,$Z,$n,$g){void 0===$g&&($g=!0),this._create(!1,!1,$B,$_,$Z,$n,$g,!1)},$_.loop=function($B,$_,$Z,$n,$g,$q,$P){void 0===$g&&($g=!0),void 0===$q&&($q=!1),void 0===$P&&($P=!1);var $k=this._create(!1,!0,$B,$_,$Z,$n,$g,$P);$k&&($k.jumpFrame=$q)},$_.frameOnce=function($B,$_,$Z,$n,$g){void 0===$g&&($g=!0),this._create(!0,!1,$B,$_,$Z,$n,$g,!1)},$_.frameLoop=function($B,$_,$Z,$n,$g,$q){void 0===$g&&($g=!0),void 0===$q&&($q=!1),this._create(!0,!0,$B,$_,$Z,$n,$g,$q)},$_.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$D._freeCount},$_.clear=function($B,$_){var $Z=this._getHandler($B,$_);return!(!$Z||this._isIgnoreRecover($Z))&&(delete this._map[$Z.key],$Z.key=null,$Z.clear(),!0)},$_.clearAll=function($B){if($B)for(var $_=0,$Z=this._handlers.length;$_<$Z;$_++){var $n=this._handlers[$_];$n.caller===$B&&(this._isIgnoreRecover($n)||(delete this._map[$n.key],$n.key=null,$n.clear()))}},$_._getHandler=function($B,$_){var $Z=$B?$B.$_GID||($B.$_GID=$a.getGID()):0,$n=$_.$_TID||($_.$_TID=this._mid++);return this._map[$Z+"_"+$n]},$_._isIgnoreRecover=function($B){if($B.ignoreRecover||$B.caller&&"IgnoreRecover"==$B.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $_="";try{arguments.propertyIsEnumerable.caller}catch($B){$_=$B.stack}$N.recordError("报错：核心定时器销毁忽略  "+$_)}return!0}return!1},$_.hasHandler=function($B,$_){return this._map[$B.$_GID+"_"+$_.$_TID]},$_.callLater=function($B,$_,$Z){if(null==this._getHandler($B,$_)){var $n=$D.create();$n.caller=$B,$n.method=$_,$n.args=$Z,this._indexHandler($n),this._laters.push($n)}},$_.runCallLater=function($B,$_){var $Z=this._getHandler($B,$_);$Z&&null!=$Z.method&&(this._isIgnoreRecover($Z)||(delete this._map[$Z.key],$Z.run(!0)))},$_.runTimer=function($B,$_){this.runCallLater($B,$_)},$T(0,$_,"delta",function(){return this._delta}),$B.__init$=function(){$D=function(){function $_(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$w($_,"");var $B=$_.prototype;return $B.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$B.recover=function(){this.clear(),this.args=$_._freeHandler,$_._freeHandler=this,$_._freeCount++},$B.run=function($B){var $_=this.caller;if($_&&$_.destroyed)return this.clear();var $Z=this.method,$n=this.args;$B&&this.clear(),null!=$Z&&($n?$Z.apply($_,$n):$Z.call($_))},$_._freeHandler=null,$_._freeCount=0,$_.create=function(){var $B=$_._freeHandler;return $B?($_._freeHandler=$B.args,--$_._freeCount,$B.args=null,$B):new $_},$_}()},$B}()),$d=function(){function $e(){this.gid=0}$w($e,"laya.utils.Tween");var $B=$e.prototype;return $B.to=function($B,$_,$Z,$n,$g,$q,$P){return void 0===$q&&($q=0),void 0===$P&&($P=!1),this._create($B,$_,$Z,$n,$g,$q,$P,!0,!1,!0)},$B.from=function($B,$_,$Z,$n,$g,$q,$P){return void 0===$q&&($q=0),void 0===$P&&($P=!1),this._create($B,$_,$Z,$n,$g,$q,$P,!1,!1,!0)},$B._create=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){if(!$B)throw new Error("Tween:target is null");this._target=$B,this._duration=$Z,this._ease=$n||$_.ease||$e.easeNone,this._complete=$g||$_.complete,this._delay=$q,this._props=[],this._usedTimer=0,this._startTimer=$K.now(),this._usedPool=$m,this._delayParam=null,this.update=$_.update;var $T=$B.$_GID||($B.$_GID=$a.getGID());return $e.tweenMap[$T]?($P&&$e.clearTween($B),$e.tweenMap[$T].push(this)):$e.tweenMap[$T]=[this],$D?$q<=0?this.firstStart($B,$_,$k):(this._delayParam=[$B,$_,$k],$N.scaleTimer.once($q,this,this.firstStart,this._delayParam)):this._initProps($B,$_,$k),this},$B.firstStart=function($B,$_,$Z){this._delayParam=null,$B.destroyed?this.clear():(this._initProps($B,$_,$Z),this._beginLoop())},$B._initProps=function($B,$_,$Z){for(var $n in $_)if("number"==typeof $B[$n]){var $g=$Z?$B[$n]:$_[$n],$q=$Z?$_[$n]:$B[$n];this._props.push([$n,$g,$q-$g]),$Z||($B[$n]=$g)}},$B._beginLoop=function(){$N.scaleTimer.frameLoop(1,this,this._doEase)},$B._doEase=function(){this._updateEase($K.now())},$B._updateEase=function($B){var $_=this._target;if($_){if($_.destroyed)return $e.clearTween($_);var $Z=this._usedTimer=$B-this._startTimer-this._delay;if(!($Z<0)){if($Z>=this._duration)return this.complete();for(var $n=0<$Z?this._ease($Z,0,1,this._duration):0,$g=this._props,$q=0,$P=$g.length;$q<$P;$q++){var $k=$g[$q];$_[$k[0]]=$k[1]+$n*$k[2]}this.update&&this.update.run()}}},$B.complete=function(){if(this._target){$N.scaleTimer.runTimer(this,this.firstStart);for(var $B=this._target,$_=this._props,$Z=this._complete,$n=0,$g=$_.length;$n<$g;$n++){var $q=$_[$n];$B[$q[0]]=$q[1]+$q[2]}this.update&&this.update.run(),this.clear(),$Z&&$Z.run()}},$B.pause=function(){$N.scaleTimer.clear(this,this._beginLoop),$N.scaleTimer.clear(this,this._doEase),$N.scaleTimer.clear(this,this.firstStart);var $B;($B=$K.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$B)},$B.setStartTime=function($B){this._startTimer=$B},$B.clear=function(){this._target&&(this._remove(),this._clear())},$B._clear=function(){this.pause(),$N.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$U.recover("tween",this))},$B.recover=function(){this._usedPool=!0,this._clear()},$B._remove=function(){var $B=$e.tweenMap[this._target.$_GID];if($B)for(var $_=0,$Z=$B.length;$_<$Z;$_++)if($B[$_]===this){$B.splice($_,1);break}},$B.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$K.now(),this._delayParam)$N.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $B=this._props,$_=0,$Z=$B.length;$_<$Z;$_++){var $n=$B[$_];this._target[$n[0]]=$n[1]}$N.scaleTimer.once(this._delay,this,this._beginLoop)}},$B.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$K.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$N.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$T(0,$B,"progress",null,function($B){var $_=$B*this._duration;this._startTimer=$K.now()-this._delay-$_}),$e.to=function($B,$_,$Z,$n,$g,$q,$P,$k){return void 0===$q&&($q=0),void 0===$P&&($P=!1),void 0===$k&&($k=!0),$U.getItemByClass("tween",$e)._create($B,$_,$Z,$n,$g,$q,$P,!0,$k,!0)},$e.from=function($B,$_,$Z,$n,$g,$q,$P,$k){return void 0===$q&&($q=0),void 0===$P&&($P=!1),void 0===$k&&($k=!0),$U.getItemByClass("tween",$e)._create($B,$_,$Z,$n,$g,$q,$P,!1,$k,!0)},$e.clearAll=function($B){if($B&&$B.$_GID){var $_=$e.tweenMap[$B.$_GID];if($_){for(var $Z=0,$n=$_.length;$Z<$n;$Z++)$_[$Z]._clear();$_.length=0}}},$e.clear=function($B){$B.clear()},$e.clearTween=function($B){$e.clearAll($B)},$e.easeNone=function($B,$_,$Z,$n){return $Z*$B/$n+$_},$e.tweenMap={},$e}(),$a=function(){function $k(){}return $w($k,"laya.utils.Utils"),$k.toRadian=function($B){return $B*$k._pi2},$k.toAngle=function($B){return $B*$k._pi},$k.toHexColor=function($B){if($B<0||isNaN($B))return null;for(var $_=$B.toString(16);$_.length<6;)$_="0"+$_;return"#"+$_},$k.getGID=function(){return $k._gid++},$k.concatArray=function($B,$_){if(!$_)return $B;if(!$B)return $_;var $Z=0,$n=$_.length;for($Z=0;$Z<$n;$Z++)$B.push($_[$Z]);return $B},$k.clearArray=function($B){return $B&&($B.length=0),$B},$k.copyArray=function($B,$_){if($B||($B=[]),!$_)return $B;$B.length=$_.length;var $Z=0,$n=$_.length;for($Z=0;$Z<$n;$Z++)$B[$Z]=$_[$Z];return $B},$k.getGlobalRecByPoints=function($B,$_,$Z,$n,$g){var $q,$P;return $q=new $Q($_,$Z),$q=$B.localToGlobal($q),$P=new $Q($n,$g),$P=$B.localToGlobal($P),$M._getWrapRec([$q.x,$q.y,$P.x,$P.y])},$k.getGlobalPosAndScale=function($B){return $k.getGlobalRecByPoints($B,0,0,1,1)},$k.bind=function($B,$_){return $B.bind($_)},$k.measureText=function($B,$_){return $v.measureText($B,$_)},$k.contextMeasureText=function($B){var $_=$K.context.measureText($B);return $_||($_={width:16,height:16}),$_},$k.updateOrder=function($B){if(!$B||$B.length<2)return!1;for(var $_,$Z=1,$n=0,$g=$B.length,$q=NaN;$Z<$g;){for($_=$B[$n=$Z],$q=$B[$n]._zOrder;-1<--$n&&$B[$n]._zOrder>$q;)$B[$n+1]=$B[$n];$B[$n+1]=$_,$Z++}var $P=$_.parent.conchModel;if($P)if(null!=$P.updateZOrder)$P.updateZOrder();else{for($Z=0;$Z<$g;$Z++)$P.removeChild($B[$Z].conchModel);for($Z=0;$Z<$g;$Z++)$P.addChildAt($B[$Z].conchModel,$Z)}return!0},$k.transPointList=function($B,$_,$Z){var $n=0,$g=$B.length;for($n=0;$n<$g;$n+=2)$B[$n]+=$_,$B[$n+1]+=$Z},$k.parseInt=function($B,$_){void 0===$_&&($_=0);var $Z=$K.window.parseInt($B,$_);return isNaN($Z)?0:$Z},$k.getFileExtension=function($B){$k._extReg.lastIndex=$B.lastIndexOf(".");var $_=$k._extReg.exec($B);return $_&&1<$_.length?$_[1].toLowerCase():null},$k.getTransformRelativeToWindow=function($B,$_,$Z){var $n=$N.stage,$g=laya.utils.Utils.getGlobalPosAndScale($B),$q=$n._canvasTransform.clone(),$P=$q.tx,$k=$q.ty;$q.rotate(-Math.PI/180*$N.stage.canvasDegree),$q.scale($N.stage.clientScaleX,$N.stage.clientScaleY);var $m=$N.stage.canvasDegree%180!=0,$D=NaN,$T=NaN;$m?($D=$Z+$g.y,$T=$_+$g.x,$D*=$q.d,$T*=$q.a,90==$N.stage.canvasDegree?($D=$P-$D,$T+=$k):($D+=$P,$T=$k-$T)):($D=$_+$g.x,$T=$Z+$g.y,$D*=$q.a,$T*=$q.d,$D+=$P,$T+=$k);var $e=NaN,$I=NaN;return $I=$m?($e=$q.d*$g.height,$q.a*$g.width):($e=$q.a*$g.width,$q.d*$g.height),{x:$D,y:$T,scaleX:$e,scaleY:$I}},$k.fitDOMElementInArea=function($B,$_,$Z,$n,$g,$q){$B._fitLayaAirInitialized||($B._fitLayaAirInitialized=!0,$B.style.transformOrigin=$B.style.webKittransformOrigin="left top",$B.style.position="absolute");var $P=$k.getTransformRelativeToWindow($_,$Z,$n);$B.style.transform=$B.style.webkitTransform="scale("+$P.scaleX+","+$P.scaleY+") rotate("+$N.stage.canvasDegree+"deg)",$B.style.width=$g+"px",$B.style.height=$q+"px",$B.style.left=$P.x+"px",$B.style.top=$P.y+"px"},$k.isOkTextureList=function($B){if(!$B)return!1;var $_,$Z=0,$n=$B.length;for($Z=0;$Z<$n;$Z++)if(!($_=$B[$Z])||!$_.source)return!1;return!0},$k.isOKCmdList=function($B){if(!$B)return!1;var $_,$Z,$n=0,$g=$B.length,$q=$u._context;for($n=0;$n<$g;$n++)switch(($_=$B[$n]).callee){case $q._drawTexture:case $q._fillTexture:case $q._drawTextureWithTransform:if(!($Z=$_[0])||!$Z.source)return!1}return!0},$k._gid=1,$k._pi=180/Math.PI,$k._pi2=Math.PI/180,$k._extReg=/\.(\w+)\??/g,$k.parseXMLFromString=function($B){var $_;if($B=$B.replace(/>\s+</g,"><"),-1<($_=(new DOMParser).parseFromString($B,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($_.firstChild.firstChild.textContent);return $_},$k}(),$i=function(){function $B(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$u.isWebGL&&$G.regCacheByFunction($a.bind(this.startDispose,this),$a.bind(this.getCacheList,this))}$w($B,"laya.utils.VectorGraphManager");var $_=$B.prototype;return $_.getId=function(){return this._id++},$_.addShape=function($B,$_){this.shapeDic[$B]=$_,this.useDic[$B]||(this.useDic[$B]=!0)},$_.addLine=function($B,$_){this.shapeLineDic[$B]=$_,this.shapeLineDic[$B]||(this.shapeLineDic[$B]=!0)},$_.getShape=function($B){this._checkKey&&null!=this.useDic[$B]&&(this.useDic[$B]=!0)},$_.deleteShape=function($B){this.shapeDic[$B]&&(this.shapeDic[$B]=null,delete this.shapeDic[$B]),this.shapeLineDic[$B]&&(this.shapeLineDic[$B]=null,delete this.shapeLineDic[$B]),null!=this.useDic[$B]&&delete this.useDic[$B]},$_.getCacheList=function(){var $B,$_=[];for($B in this.shapeDic)$_.push(this.shapeDic[$B]);for($B in this.shapeLineDic)$_.push(this.shapeLineDic[$B]);return $_},$_.startDispose=function($B){var $_;for($_ in this.useDic)this.useDic[$_]=!1;this._checkKey=!0},$_.endDispose=function(){if(this._checkKey){var $B;for($B in this.useDic)this.useDic[$B]||this.deleteShape($B);this._checkKey=!1}},$B.getInstance=function(){return $B.instance=$B.instance||new $B},$B.instance=null,$B}(),$c=function(){function $n(){this._obj=null,this._obj=$n.supportWeakMap?new $K.window.WeakMap:{},$n.supportWeakMap||$n._maps.push(this)}$w($n,"laya.utils.WeakObject");var $B=$n.prototype;return $B.set=function($B,$_){if(null!=$B)if($n.supportWeakMap){var $Z=$B;"string"!=typeof $B&&"number"!=typeof $B||($Z=$n._keys[$B])||($Z=$n._keys[$B]={k:$B}),this._obj.set($Z,$_)}else"string"==typeof $B||"number"==typeof $B?this._obj[$B]=$_:($B.$_GID||($B.$_GID=$a.getGID()),this._obj[$B.$_GID]=$_)},$B.get=function($B){if(null==$B)return null;if($n.supportWeakMap){var $_="string"==typeof $B||"number"==typeof $B?$n._keys[$B]:$B;return $_?this._obj.get($_):null}return"string"==typeof $B||"number"==typeof $B?this._obj[$B]:this._obj[$B.$_GID]},$B.del=function($B){if(null!=$B)if($n.supportWeakMap){var $_="string"==typeof $B||"number"==typeof $B?$n._keys[$B]:$B;if(!$_)return;this._obj.delete($_)}else"string"==typeof $B||"number"==typeof $B?delete this._obj[$B]:delete this._obj[this._obj.$_GID]},$B.has=function($B){if(null==$B)return!1;if($n.supportWeakMap){var $_="string"==typeof $B||"number"==typeof $B?$n._keys[$B]:$B;return this._obj.has($_)}return"string"==typeof $B||"number"==typeof $B?null!=this._obj[$B]:null!=this._obj[this._obj.$_GID]},$n.__init__=function(){($n.supportWeakMap=null!=$K.window.WeakMap)||$N.timer.loop($n.delInterval,null,$n.clearCache)},$n.clearCache=function(){for(var $B=0,$_=$n._maps.length;$B<$_;$B++){$n._maps[$B]._obj={}}},$n.supportWeakMap=!1,$n.delInterval=3e5,$n._keys={},$n._maps=[],$m($n,["I",function(){return this.I=new $n}]),$n}(),$E=function(){function $B(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$w($B,"laya.utils.WordText");var $_=$B.prototype;return $_.setText=function($B){this.changed=!0,this._text=$B},$_.toString=function(){return this._text},$_.charCodeAt=function($B){return this._text?this._text.charCodeAt($B):NaN},$_.charAt=function($B){return this._text?this._text.charAt($B):null},$T(0,$_,"length",function(){return this._text?this._text.length:0}),$B}(),$BB=function($B){function $P(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$P.__super.call(this),this._childs=$P.ARRAY_EMPTY,this._$P=$P.PROP_EMPTY,this.timer=$N.scaleTimer,this.conchModel=$u.isConchNode?this.createConchModel():null}$w($P,"laya.display.Node",$D);var $_=$P.prototype;return $_._setBit=function($B,$_){1==$B&&(this._getBit($B)!=$_&&this._updateDisplayedInstage());$_?this._bits|=$B:this._bits&=~$B},$_._getBit=function($B){return 0!=(this._bits&$B)},$_._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$_._setUpNoticeType=function($B){var $_=this;for($_._setBit($B,!0),$_=$_.parent;$_;){if($_._getBit($B))return;$_._setBit($B,!0),$_=$_.parent}},$_.on=function($B,$_,$Z,$n){return"display"!==$B&&"undisplay"!==$B||this._getBit(1)||this._setUpNoticeType(1),this._createListener($B,$_,$Z,$n,!1)},$_.once=function($B,$_,$Z,$n){return"display"!==$B&&"undisplay"!==$B||this._getBit(1)||this._setUpNoticeType(1),this._createListener($B,$_,$Z,$n,!0)},$_.createConchModel=function(){return null},$_.destroy=function($B){void 0===$B&&($B=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($B?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$_.destroyChildren=function(){if(this._childs)for(var $B=this._childs.length-1;-1<$B;$B--)this._childs[$B].destroy(!0)},$_.addChild=function($B){if(!$B||this.destroyed||$B===this)return $B;if($B.zOrder&&this._set$P("hasZorder",!0),$B._parent===this){var $_=this.getChildIndex($B);$_!==this._childs.length-1&&(this._childs.splice($_,1),this._childs.push($B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,this._childs.length-1)),this._childChanged())}else $B.parent&&$B.parent.removeChild($B),this._childs===$P.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($B),this.conchModel&&this.conchModel.addChildAt($B.conchModel,this._childs.length-1),($B.parent=this)._childChanged();return $B},$_.addChildren=function($B){for(var $_=arguments,$Z=0,$n=$_.length;$Z<$n;)this.addChild($_[$Z++])},$_.addChildAt=function($B,$_){if(!$B||this.destroyed||$B===this)return $B;if($B.zOrder&&this._set$P("hasZorder",!0),0<=$_&&$_<=this._childs.length){if($B._parent===this){var $Z=this.getChildIndex($B);this._childs.splice($Z,1),this._childs.splice($_,0,$B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,$_)),this._childChanged()}else $B.parent&&$B.parent.removeChild($B),this._childs===$P.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($_,0,$B),this.conchModel&&this.conchModel.addChildAt($B.conchModel,$_),$B.parent=this;return $B}throw new Error("appendChildAt:The index is out of bounds")},$_.getChildIndex=function($B){return this._childs.indexOf($B)},$_.getChildByName=function($B){var $_=this._childs;if($_)for(var $Z=0,$n=$_.length;$Z<$n;$Z++){var $g=$_[$Z];if($g.name===$B)return $g}return null},$_._get$P=function($B){return this._$P[$B]},$_._set$P=function($B,$_){return this.destroyed||(this._$P===$P.PROP_EMPTY&&(this._$P={}),this._$P[$B]=$_),$_},$_.getChildAt=function($B){return this._childs[$B]},$_.setChildIndex=function($B,$_){var $Z=this._childs;if($_<0||$_>=$Z.length)throw new Error("setChildIndex:The index is out of bounds.");var $n=this.getChildIndex($B);if($n<0)throw new Error("setChildIndex:node is must child of this object.");return $Z.splice($n,1),$Z.splice($_,0,$B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,$_)),this._childChanged(),$B},$_._childChanged=function($B){},$_.removeChild=function($B){if(!this._childs)return $B;var $_=this._childs.indexOf($B);return this.removeChildAt($_)},$_.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$_.removeChildByName=function($B){var $_=this.getChildByName($B);return $_&&this.removeChild($_),$_},$_.removeChildAt=function($B){var $_=this.getChildAt($B);if($_){for(var $Z=this._childs.length-1,$n=$B;$n<$Z;++$n)this._childs[$n]=this._childs[$n+1];this._childs.length=$Z,this.conchModel&&this.conchModel.removeChild($_.conchModel),$_.parent=null}return $_},$_.removeChildren=function($B,$_){if(void 0===$B&&($B=0),void 0===$_&&($_=2147483647),this._childs&&0<this._childs.length){var $Z=this._childs;if(0===$B&&$q<=$_){var $n=$Z;this._childs=$P.ARRAY_EMPTY}else $n=$Z.splice($B,$_-$B);for(var $g=0,$q=$n.length;$g<$q;$g++)$n[$g].parent=null,this.conchModel&&this.conchModel.removeChild($n[$g].conchModel)}return this},$_.replaceChild=function($B,$_){var $Z=this._childs.indexOf($_);return-1<$Z?(this._childs.splice($Z,1,$B),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($B.conchModel,$Z)),$_.parent=null,$B.parent=this,$B):null},$_._updateDisplayedInstage=function(){var $B;$B=this;var $_=$N.stage;for(this._displayedInStage=!1;$B;){if($B._getBit(1)){this._displayedInStage=$B._displayedInStage;break}if($B==$_||$B._displayedInStage){this._displayedInStage=!0;break}$B=$B.parent}},$_._setDisplay=function($B){this._displayedInStage!==$B&&((this._displayedInStage=$B)?this.event("display"):this.event("undisplay"))},$_._displayChild=function($B,$_){var $Z=$B._childs;if($Z)for(var $n=0;$n<$Z.length;$n++){var $g=$Z[$n];$g&&$g._getBit(1)&&(0<$g._childs.length?this._displayChild($g,$_):$g._setDisplay($_))}$B._setDisplay($_)},$_.contains=function($B){if($B===this)return!0;for(;$B;){if($B.parent===this)return!0;$B=$B.parent}return!1},$_.timerLoop=function($B,$_,$Z,$n,$g,$q){void 0===$g&&($g=!0),void 0===$q&&($q=!1),this.timer.loop($B,$_,$Z,$n,$g,$q)},$_.timerOnce=function($B,$_,$Z,$n,$g){void 0===$g&&($g=!0),this.timer._create(!1,!1,$B,$_,$Z,$n,$g)},$_.frameLoop=function($B,$_,$Z,$n,$g){void 0===$g&&($g=!0),this.timer._create(!0,!0,$B,$_,$Z,$n,$g)},$_.frameOnce=function($B,$_,$Z,$n,$g){void 0===$g&&($g=!0),this.timer._create(!0,!1,$B,$_,$Z,$n,$g)},$_.clearTimer=function($B,$_){this.timer.clear($B,$_)},$T(0,$_,"numChildren",function(){return this._childs.length}),$T(0,$_,"destroyed",function(){return this._destroyed}),$T(0,$_,"parent",function(){return this._parent},function($B){this._parent!==$B&&($B?(this._parent=$B,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$B.displayedInStage&&this._displayChild(this,!0)),$B._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$B))}),$T(0,$_,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$P.ARRAY_EMPTY=[],$P.PROP_EMPTY={},$P.NOTICE_DISPLAY=1,$P.MOUSEENABLE=2,$P}(),$_B=function($B){function $I($B){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$I.__super.call(this),this._padding=$I._PADDING,this._spacing=$I._SPACING,this._aligns=$I._ALIGNS,this._font=$A.EMPTY,this._ower=$B}$w($I,"laya.display.css.CSSStyle",$B);var $_=$I.prototype;return $_.destroy=function(){this._ower=null,this._font=null,this._rect=null},$_.inherit=function($B){this._font=$B._font,this._spacing=$B._spacing===$I._SPACING?$I._SPACING:$B._spacing.slice(),this.lineHeight=$B.lineHeight},$_._widthAuto=function(){return 0!=(262144&this._type)},$_.widthed=function($B){return 0!=(8&this._type)},$_._calculation=function($B,$_){if($_.indexOf("%")<0)return!1;var $n=this._ower,$g=$n.parent,$q=this._rect;function $P($B,$_,$Z){return $B*$Z[0]+$_*$Z[1]+$Z[2]}function $Z($B){var $_=$g.width,$Z=$n.width;$q.width&&($n.width=$P($_,$Z,$q.width)),$q.height&&($n.height=$P($_,$Z,$q.height)),$q.left&&($n.x=$P($_,$Z,$q.left)),$q.top&&($n.y=$P($_,$Z,$q.top))}null===$q&&($g._getCSSStyle()._type|=524288,$g.on("resize",this,$Z),this._rect=$q={input:{}});var $k=$_.split(" ");return $k[0]=parseFloat($k[0])/100,1==$k.length?$k[1]=$k[2]=0:($k[1]=parseFloat($k[1])/100,$k[2]=parseFloat($k[2])),$q[$B]=$k,$q.input[$B]=$_,$Z(),!0},$_.heighted=function($B){return 0!=(8192&this._type)},$_.size=function($B,$_){var $Z=this._ower,$n=!1;-1!==$B&&$B!=this._ower.width&&(this._type|=8,this._ower.width=$B,$n=!0),-1!==$_&&$_!=this._ower.height&&(this._type|=8192,this._ower.height=$_,$n=!0),$n&&($Z._layoutLater(),524288&this._type&&$Z.event("resize",this))},$_._getAlign=function(){return this._aligns[0]},$_._getValign=function(){return this._aligns[1]},$_._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$_._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $A(this._font))},$_.render=function($B,$_,$Z,$n){var $g=$B.width,$q=$B.height;$Z-=$B.pivotX,$n-=$B.pivotY,this._bgground&&null!=this._bgground.color&&$_.ctx.fillRect($Z,$n,$g,$q,this._bgground.color),this._border&&this._border.color&&$_.drawRect($Z,$n,$g,$q,this._border.color.strColor,this._border.size)},$_.getCSSStyle=function(){return this},$_.cssText=function($B){this.attrs($I.parseOneCSS($B,";"))},$_.attrs=function($B){if($B)for(var $_=0,$Z=$B.length;$_<$Z;$_++){var $n=$B[$_];this[$n[0]]=$n[1]}},$_.setTransform=function($B){"none"===$B?this._tf=$k._TF_EMPTY:this.attrs($I.parseOneCSS($B,","))},$_.translate=function($B,$_){this._tf===$k._TF_EMPTY&&(this._tf=new $g),this._tf.translateX=$B,this._tf.translateY=$_},$_.scale=function($B,$_){this._tf===$k._TF_EMPTY&&(this._tf=new $g),this._tf.scaleX=$B,this._tf.scaleY=$_},$_._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$T(0,$_,"block",$B.prototype._$get_block,function($B){$B?this._type|=1:this._type&=-2}),$T(0,$_,"valign",function(){return $I._valigndef[this._aligns[1]]},function($B){this._aligns===$I._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$I._valigndef[$B]}),$T(0,$_,"height",null,function($B){if(this._type|=8192,"string"==typeof $B){if(this._calculation("height",$B))return;$B=parseInt($B)}this.size(-1,$B)}),$T(0,$_,"width",null,function($B){if(this._type|=8,"string"==typeof $B){var $_=$B.indexOf("auto");if(0<=$_&&(this._type|=262144,$B=$B.substr(0,$_)),this._calculation("width",$B))return;$B=parseInt($B)}this.size($B,-1)}),$T(0,$_,"fontWeight",function(){return this._font.weight},function($B){this._createFont().weight=$B}),$T(0,$_,"left",null,function($B){var $_=this._ower;if("string"==typeof $B){if("center"===$B?$B="50% -50% 0":"right"===$B&&($B="100% -100% 0"),this._calculation("left",$B))return;$B=parseInt($B)}$_.x=$B}),$T(0,$_,"_translate",null,function($B){this.translate($B[0],$B[1])}),$T(0,$_,"absolute",function(){return 0!=(4&this._type)}),$T(0,$_,"top",null,function($B){var $_=this._ower;if("string"==typeof $B){if("middle"===$B?$B="50% -50% 0":"bottom"===$B&&($B="100% -100% 0"),this._calculation("top",$B))return;$B=parseInt($B)}$_.y=$B}),$T(0,$_,"align",function(){return $I._aligndef[this._aligns[0]]},function($B){this._aligns===$I._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$I._aligndef[$B]}),$T(0,$_,"bold",function(){return this._font.bold},function($B){this._createFont().bold=$B}),$T(0,$_,"padding",function(){return this._padding},function($B){this._padding=$B}),$T(0,$_,"leading",function(){return this._spacing[1]},function($B){"string"==typeof $B&&($B=parseInt($B+"")),this._spacing===$I._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$B}),$T(0,$_,"lineElement",function(){return 0!=(65536&this._type)},function($B){$B?this._type|=65536:this._type&=-65537}),$T(0,$_,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($B){this.lineElement=!1,"right"===$B?this._type|=32768:this._type&=-32769}),$T(0,$_,"textDecoration",function(){return this._font.decoration},function($B){this._createFont().decoration=$B}),$T(0,$_,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($B){"nowrap"===$B&&(this._type|=131072),"none"===$B&&(this._type&=-131073)}),$T(0,$_,"background",null,function($B){$B?(this._bgground||(this._bgground={}),this._bgground.color=$B,this._ower.conchModel&&this._ower.conchModel.bgColor($B),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$T(0,$_,"wordWrap",function(){return 0==(131072&this._type)},function($B){$B?this._type&=-131073:this._type|=131072}),$T(0,$_,"color",function(){return this._font.color},function($B){this._createFont().color=$B}),$T(0,$_,"password",function(){return this._font.password},function($B){this._createFont().password=$B}),$T(0,$_,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($B){"none"===$B?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$B),this._ower.conchModel&&this._ower.conchModel.bgColor($B),this._ower._renderType|=256}),$T(0,$_,"font",function(){return this._font.toString()},function($B){this._createFont().set($B)}),$T(0,$_,"weight",null,function($B){this._createFont().weight=$B}),$T(0,$_,"letterSpacing",function(){return this._spacing[0]},function($B){"string"==typeof $B&&($B=parseInt($B+"")),this._spacing===$I._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$B}),$T(0,$_,"fontSize",function(){return this._font.size},function($B){this._createFont().size=$B}),$T(0,$_,"italic",function(){return this._font.italic},function($B){this._createFont().italic=$B}),$T(0,$_,"fontFamily",function(){return this._font.family},function($B){this._createFont().family=$B}),$T(0,$_,"stroke",function(){return this._font.stroke[0]},function($B){this._createFont().stroke===$A._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$B}),$T(0,$_,"strokeColor",function(){return this._font.stroke[1]},function($B){this._createFont().stroke===$A._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$B}),$T(0,$_,"border",function(){return this._border?this._border.value:""},function($B){if("none"!=$B){this._border||(this._border={});var $_=(this._border.value=$B).split(" ");if(this._border.color=$X.create($_[$_.length-1]),1==$_.length)return this._border.size=1,void(this._border.type="solid");var $Z=0;0<$_[0].indexOf("px")?(this._border.size=parseInt($_[0]),$Z++):this._border.size=1,this._border.type=$_[$Z],this._ower._renderType|=256}else this._border=null}),$T(0,$_,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($B){$B?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$B?null:$X.create($B),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$T(0,$_,"position",function(){return 4&this._type?"absolute":""},function($B){"absolute"==$B?this._type|=4:this._type&=-5}),$T(0,$_,"display",null,function($B){switch($B){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$T(0,$_,"paddingLeft",function(){return this.padding[3]}),$T(0,$_,"paddingTop",function(){return this.padding[0]}),$T(0,$_,"_scale",null,function($B){this._ower.scale($B[0],$B[1])}),$T(0,$_,"_rotate",null,function($B){this._ower.rotation=$B}),$I.parseOneCSS=function($B,$_){for(var $Z,$n=[],$g=$B.split($_),$q=0,$P=$g.length;$q<$P;$q++){var $k=$g[$q],$m=$k.indexOf(":"),$D=$k.substr(0,$m).replace(/^\s+|\s+$/g,"");if(0!=$D.length){var $T=$k.substr($m+1).replace(/^\s+|\s+$/g,""),$e=[$D,$T];switch($D){case"italic":case"bold":$e[1]="true"==$T;break;case"line-height":$e[0]="lineHeight",$e[1]=parseInt($T);break;case"font-size":$e[0]="fontSize",$e[1]=parseInt($T);break;case"padding":1<($Z=$T.split(" ")).length||($Z[1]=$Z[2]=$Z[3]=$Z[0]),$e[1]=[parseInt($Z[0]),parseInt($Z[1]),parseInt($Z[2]),parseInt($Z[3])];break;case"rotate":$e[0]="_rotate",$e[1]=parseFloat($T);break;case"scale":$Z=$T.split(" "),$e[0]="_scale",$e[1]=[parseFloat($Z[0]),parseFloat($Z[1])];break;case"translate":$Z=$T.split(" "),$e[0]="_translate",$e[1]=[parseInt($Z[0]),parseInt($Z[1])];break;default:($e[0]=$I._CSSTOVALUE[$D])||($e[0]=$D)}$n.push($e)}}return $n},$I.parseCSS=function($B,$_){for(var $Z;null!=($Z=$I._parseCSSRegExp.exec($B));)$I.styleSheets[$Z[1]]=$I.parseOneCSS($Z[2],";")},$I.EMPTY=new $I(null),$I._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$I._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$I._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$I._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$I.styleSheets={},$I.ALIGN_CENTER=1,$I.ALIGN_RIGHT=2,$I.VALIGN_MIDDLE=1,$I.VALIGN_BOTTOM=2,$I._CSS_BLOCK=1,$I._DISPLAY_NONE=2,$I._ABSOLUTE=4,$I._WIDTH_SET=8,$I._PADDING=[0,0,0,0],$I._RECT=[-1,-1,-1,-1],$I._SPACING=[0,0],$I._ALIGNS=[0,0,0],$I.ADDLAYOUTED=512,$I._NEWFONT=4096,$I._HEIGHT_SET=8192,$I._BACKGROUND_SET=16384,$I._FLOAT_RIGHT=32768,$I._LINE_ELEMENT=65536,$I._NOWARP=131072,$I._WIDTHAUTO=262144,$I._LISTERRESZIE=524288,$I}($k),$ZB=function($B){function $P(){this.url=null,this.audio=null,this.loaded=!1,$P.__super.call(this)}$w($P,"laya.media.h5audio.AudioSound",$D);var $_=$P.prototype;return $_.dispose=function(){var $B=$P._audioCache[this.url];$B&&($B.src="",delete $P._audioCache[this.url])},$_.load=function($B){var $_;if($B=$F.formatURL($B),(this.url=$B)==$L._tMusic?($P._initMusicAudio(),($_=$P._musicAudio).src!=$B&&($P._audioCache[$_.src]=null,$_=null)):$_=$P._audioCache[$B],$_&&2<=$_.readyState)this.event("complete");else{$_||($_=$B==$L._tMusic?($P._initMusicAudio(),$P._musicAudio):$K.createElement("audio"),($P._audioCache[$B]=$_).src=$B),$_.addEventListener("canplaythrough",$n),$_.addEventListener("error",$g);var $Z=this;(this.audio=$_).load?$_.load():$g()}function $n(){$q(),$Z.loaded=!0,$Z.event("complete")}function $g(){$_.load=null,$q(),$Z.event("error")}function $q(){$_.removeEventListener("canplaythrough",$n),$_.removeEventListener("error",$g)}},$_.play=function($B,$_,$Z){if(void 0===$B&&($B=0),void 0===$_&&($_=0),!this.url)return null;var $n,$g;if(!($n=this.url==$L._tMusic?$P._musicAudio:$P._audioCache[this.url]))return null;$g=$U.getItem("audio:"+this.url),$u.isConchApp?$g||(($g=$K.createElement("audio")).src=this.url):this.url==$L._tMusic?($P._initMusicAudio(),($g=$P._musicAudio).src=this.url):$g=$g||$n.cloneNode(!0);var $q=new $IB($g);return $q.url=this.url,$q.loops=$_,$q.startTime=$B,$q.startHandler=$Z,$q.play(!1),$L.addChannel($q),$q},$T(0,$_,"duration",function(){var $B;return($B=$P._audioCache[this.url])?$B.duration:0}),$P._initMusicAudio=function(){$P._musicAudio||($P._musicAudio||($P._musicAudio=$K.createElement("audio")),$u.isConchApp||$K.document.addEventListener("mousedown",$P._makeMusicOK))},$P._makeMusicOK=function(){$K.document.removeEventListener("mousedown",$P._makeMusicOK),$P._musicAudio.src?$P._musicAudio.play():($P._musicAudio.src="",$P._musicAudio.load())},$P._audioCache={},$P._musicAudio=null,$P}(),$nB=function($B){function $_(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$_.__super.call(this)}$w($_,"laya.media.SoundChannel",$D);var $Z=$_.prototype;return $Z.play=function(){},$Z.stop=function(){},$Z.pause=function(){},$Z.resume=function(){},$Z.__runComplete=function($B){$B&&$B.run()},$T(0,$Z,"volume",function(){return 1},function($B){}),$T(0,$Z,"position",function(){return 0}),$T(0,$Z,"duration",function(){return 0}),$_}(),$gB=function($B){function $_(){$_.__super.call(this)}$w($_,"laya.media.Sound",$D);var $Z=$_.prototype;return $Z.load=function($B){},$Z.play=function($B,$_,$Z){return void 0===$B&&($B=0),void 0===$_&&($_=0),null},$Z.dispose=function(){},$T(0,$Z,"duration",function(){return 0}),$_}(),$qB=function($B){function $g(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$g.__super.call(this)}$w($g,"laya.media.webaudio.WebAudioSound",$D);var $_=$g.prototype;return $_.load=function($B){this.url=$B,this.audioBuffer=$g._dataCache[$B],this.audioBuffer?this._loaded(this.audioBuffer):($g.e.on("loaded:"+$B,this,this._loaded),$g.e.on("err:"+$B,this,this._err),$g.__loadingSound[$B]||($g.__loadingSound[$B]=!0,$N.loader.load($B,$y.create(this,this.onloaded),null,$kB.BUFFER,4,!1,null,!0)))},$_.onloaded=function($B){$B||this._err(),this._disposed?this._removeLoadEvents():(this.data=$B,$g.buffs.push({buffer:this.data,url:this.url}),$g.decode())},$_._err=function(){if(this._removeLoadEvents(),$g.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $B,$_,$Z,$n=0;for($B=($_=this.__toPlays).length,$n=0;$n<$B;$n++)($Z=$_[$n])[3]&&!$Z[3].isStopped&&$Z[3].event("error");this.__toPlays.length=0}},$_._loaded=function($B){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$B,this.loaded=!0,this.event("complete"))},$_._removeLoadEvents=function(){$g.e.off("loaded:"+this.url,this,this._loaded),$g.e.off("err:"+this.url,this,this._err)},$_.__playAfterLoaded=function(){if(this.__toPlays){var $B,$_,$Z,$n=0;for($B=($_=this.__toPlays).length,$n=0;$n<$B;$n++)($Z=$_[$n])[3]&&!$Z[3].isStopped&&this.play($Z[0],$Z[1],$Z[2],$Z[3]);this.__toPlays.length=0}},$_.play=function($B,$_,$Z,$n){return void 0===$B&&($B=0),void 0===$_&&($_=0),$n=$n||new $AB,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$B,$_,$Z,$n]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$n.url=this.url,$n.loops=$_,$n.audioBuffer=this.audioBuffer,$n.startTime=$B,$n.startHandler=$Z,$n.play(!1),$L.addChannel($n),$n},$_.dispose=function(){this._disposed=!0,delete $g._dataCache[this.url],delete $g.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$T(0,$_,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$g.decode=function(){if(!($g.buffs.length<=0||$g.isDecoding))if($g.isDecoding=!0,($g.tInfo=$g.buffs.shift())&&$g.tInfo.buffer&&$g.tInfo.buffer.byteLength)try{$g.ctx.decodeAudioData($g.tInfo.buffer,$g._done,$g._fail)}catch($B){console.error("decodeAudioData error  byteLength:"+$g.tInfo.buffer.byteLength+"  url:"+$g.tInfo.url)}else $g._fail()},$g._done=function($B){$g.e.event("loaded:"+$g.tInfo.url,$B),$g._dataCache[$g.tInfo.url]=$B,$g.isDecoding=!1,$g.decode()},$g._fail=function(){$g.e.event("err:"+$g.tInfo.url,null),$g.isDecoding=!1,$g.decode()},$g._playEmptySound=function(){if(null!=$g.ctx){if($g._emptySource&&($g._emptySource.stop(),$g._emptySource.disconnect(0),!$AB._tryCleanFailed))try{$g._emptySource.buffer=null}catch($B){$AB._tryCleanFailed=!0}var $B=$g.ctx.createBufferSource();$B.buffer=$g._miniBuffer,$B.connect($g.ctx.destination),$B.start(0,0,0),$g._emptySource=$B}},$g._unlock=function(){$g._unlocked||($g._playEmptySound(),"running"==$g.ctx.state?($K.document.removeEventListener("mousedown",$g._unlock,!0),$K.document.removeEventListener("touchend",$g._unlock,!0),$K.document.removeEventListener("touchstart",$g._unlock,!0),$g._unlocked=!0):"suspended"==$g.ctx.state&&$L._recoverWebAudio())},$g.initWebAudio=function(){"running"!=$g.ctx.state&&($g._unlock(),$K.document.addEventListener("mousedown",$g._unlock,!0),$K.document.addEventListener("touchend",$g._unlock,!0),$K.document.addEventListener("touchstart",$g._unlock,!0))},$g._emptySource=null,$g._dataCache={},$g.buffs=[],$g.isDecoding=!1,$g._unlocked=!1,$g.tInfo=null,$g.__loadingSound={},$m($g,["window",function(){return this.window=$K.window},"webAudioEnabled",function(){return this.webAudioEnabled=$g.window.AudioContext||$g.window.webkitAudioContext||$g.window.mozAudioContext},"ctx",function(){return this.ctx=$g.webAudioEnabled?new($g.window.AudioContext||$g.window.webkitAudioContext||$g.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$g.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $D}]),$g}(),$PB=function($B){function $_(){this._responseType=null,this._data=null,$_.__super.call(this),this._http=new $K.window.XMLHttpRequest}$w($_,"laya.net.HttpRequest",$D);var $Z=$_.prototype;return $Z.send=function($B,$_,$Z,$n,$g){void 0===$Z&&($Z="get"),void 0===$n&&($n="text"),this._responseType=$n,this._data=null;var $q=this,$P=this._http;if($P.open($Z,$B,!0),$g)for(var $k=0;$k<$g.length;$k++)$P.setRequestHeader($g[$k++],$g[$k]);else $u.isConchApp||($_&&"string"!=typeof $_?$P.setRequestHeader("Content-Type","application/json"):$P.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$P.responseType="arraybuffer"!==$n?"text":"arraybuffer",$P.onerror=function($B){$q._onError($B)},$P.onabort=function($B){$q._onAbort($B)},$P.onprogress=function($B){$q._onProgress($B)},$P.onload=function($B){$q._onLoad($B)},$P.send($_)},$Z._onProgress=function($B){$B&&$B.lengthComputable&&this.event("progress",$B.loaded/$B.total)},$Z._onAbort=function($B){this.error("Request was aborted by user")},$Z._onError=function($B){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$Z._onLoad=function($B){var $_=this._http,$Z=void 0!==$_.status?$_.status:200;200===$Z||204===$Z||0===$Z?this.complete():this.error("["+$_.status+"]"+$_.statusText+":"+$_.responseURL)},$Z.error=function($B){this.clear(),this.event("error",$B)},$Z.complete=function(){this.clear();var $_=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$a.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($B){$_=!1,this.error($B.message)}$_&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$Z.clear=function(){var $B=this._http;$B.onerror=$B.onabort=$B.onprogress=$B.onload=null},$T(0,$Z,"url",function(){return this._http.responseURL}),$T(0,$Z,"http",function(){return this._http}),$T(0,$Z,"data",function(){return this._data}),$_}(),$kB=function($B){function $Y(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$Y.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}$w($Y,"laya.net.Loader",$D);var $_=$Y.prototype;return $_.load=function($B,$_,$Z,$n,$g){if($B&&""!=$B||console.error("Loader 加载的url不合法 "+$B),void 0===$Z&&($Z=!0),void 0===$g&&($g=!1),0===(this._url=$B).indexOf("data:image")?this._type=$_="image":this._type=$_||($_=this.getTypeFromUrl($B)),this._cache=$Z,this._data=null,!$g&&$Y.loadedMap[$B])return this._data=$Y.loadedMap[$B],this.event("progress",1),void this.event("complete",this._data);if($n&&$Y.setGroup($B,$n),null!=$Y.parserMap[$_])return this._customParse=!0,void($Y.parserMap[$_]instanceof laya.utils.Handler?$Y.parserMap[$_].runWith(this):$Y.parserMap[$_].call(null,this));if("image"===$_||"htmlimage"===$_||"nativeimage"===$_)return this._loadImage($B);if("ttf"===$_)return this._loadTTF($B);switch($_){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$_}$Y.preLoadedMap[$B]?this.onLoaded($Y.preLoadedMap[$B]):$P.resMgrLoad($B,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$_.getTypeFromUrl=function($B){var $_=$a.getFileExtension($B);return $_?$Y.typeMap[$_]:(console.warn("Not recognize the resources suffix",$B),"text")},$_._loadTTF=function($B){$B=$F.formatURL($B);var $_=new $o;$_.complete=$y.create(this,this.onLoaded),$_.load($B)},$_._loadImage=function($B){$P.imgMgrLoad($B,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$_._loadImageComplete=function($B,$_,$Z){if(null!=$Z)if($Z instanceof ArrayBuffer){var $n=new DataView($Z),$g=new laya.webgl.resource.WebGLImage(new Uint8Array($Z,8),$B,0,!1,$n.getUint32(0),$n.getUint32(4));this.onLoaded($g)}else if($Z instanceof $TB)$Y.imgMgrSet[$B]=$_,$P.imgMgrLock($B,$Y.imgMgrSet[$B]),this._url=$B,this.complete($Z);else{var $q=-1!=$B.indexOf(".png",$B.length-4)?6408:6407;$g=new laya.webgl.resource.WebGLImage($Z,$B,$q,!1,$Z.width,$Z.height);this.onLoaded($g)}else this.event("error","Load image failed")},$_.imageCancel=function($B,$_,$Z){$P.imgMgrCancel&&$P.imgMgrCancel($B,this._onImageCallback)},$_._loadSound=function($B){var $_=new $L._soundClass,$Z=this;function $n(){$_.offAll()}$_.on("complete",this,function(){$n(),$Z.onLoaded($_)}),$_.on("error",this,function(){$n(),$_.dispose(),$Z.event("error","Load sound failed")}),$_.load($B)},$_.onProgress=function($B){"atlas"===this._type?this.event("progress",.3*$B):this.event("progress",$B)},$_.onError=function($B){this.event("error",$B)},$_._loadedComplete=function($B,$_,$Z){if(null!=$Z)switch(this._type){case"atlas":case"plf":case"json":var $n=new $H($Z);this.onLoaded(JSON.parse($n.readUTFBytes()));break;case"font":$n=new $H($Z);this.onLoaded($a.parseXMLFromString($n.readUTFBytes()));break;default:this.onLoaded($Z)}else this.event("error",$B)},$_.onLoaded=function($B){var $_=this._type;if("plf"==$_)this.parsePLFData($B),this.complete($B);else if("image"===$_){var $Z=new $TB($B);$Z.url=this._url,this.complete($Z)}else if("sound"===$_||"htmlimage"===$_||"nativeimage"===$_)this.complete($B);else if("atlas"===$_){if(!$B.src&&!$B._setContext){if(!this._data){if((this._data=$B).meta&&$B.meta.image)for(var $n=$B.meta.image.split(","),$g=0<=this._url.indexOf("/")?"/":"\\",$q=this._url.lastIndexOf($g),$P=0<=$q?this._url.substr(0,$q+1):"",$k=0,$m=$n.length;$k<$m;$k++)$n[$k]=$P+$n[$k];else $n=[this._url.replace(".json",".png")];$n.reverse(),$B.toLoads=$n,$B.pics=[]}return this.event("progress",.3+1/$n.length*.6),this._loadImage($n.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($B),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $D=this._data.frames,$T=this._url.split("?")[0],$e=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$T.substring(0,$T.lastIndexOf("."))+"/",$I=this._data.pics,$A=$F.formatURL(this._url),$$=$Y.atlasMap[$A]||($Y.atlasMap[$A]=[]);$$.dir=$e;var $w=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $r in $w=parseFloat(this._data.meta.scale),$D){var $j,$y=$D[$r],$C=$I[$y.frame.idx?$y.frame.idx:0],$z=$F.formatURL($e+$r);$C.scaleRate=$w,$j=$TB.create($C,$y.frame.x,$y.frame.y,$y.frame.w,$y.frame.h,$y.spriteSourceSize.x,$y.spriteSourceSize.y,$y.sourceSize.w,$y.sourceSize.h),$Y.cacheRes($z,$j),$Y.keepCache(this._url,$e+$r),$j.url=$z,$$.push($z)}else for($r in $D)$C=$I[($y=$D[$r]).frame.idx?$y.frame.idx:0],$z=$F.formatURL($e+$r),$Y.cacheRes($z,$TB.create($C,$y.frame.x,$y.frame.y,$y.frame.w,$y.frame.h,$y.spriteSourceSize.x,$y.spriteSourceSize.y,$y.sourceSize.w,$y.sourceSize.h)),$Y.loadedMap[$z].url=$z,$Y.keepCache(this._url,$e+$r),$$.push($z);delete this._data.pics,this.complete(this._data)}else if("font"==$_){if(!$B.src)return this._data=$B,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $t=new $l;$t.parseFont(this._data,$B);var $J=this._url.split(".fnt")[0].split("/"),$N=$J[$J.length-1];$rB.registerBitmapFont($N,$t),this._data=$t,this.complete(this._data)}else if("pkm"==$_){var $Q=$JB.create($B,this._url),$M=new $TB($Q);$M.url=this._url,this.complete($M)}else this.complete($B)},$_.parsePLFData=function($B){var $_,$Z,$n;for($_ in $B)switch($n=$B[$_],$_){case"json":case"text":for($Z in $n)$Y.preLoadedMap[$F.formatURL($Z)]=$n[$Z];break;default:for($Z in $n)$Y.preLoadedMap[$F.formatURL($Z)]=$n[$Z]}},$_.complete=function($B){this._data=$B,this._customParse?this.event("loaded",$B instanceof Array?[$B]:$B):($Y._loaders.push(this),$Y._isWorking||$Y.checkNext())},$_.endLoad=function($B){$B&&(this._data=$B),this._cache&&$Y.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$T(0,$_,"url",function(){return this._url}),$T(0,$_,"data",function(){return this._data}),$T(0,$_,"cache",function(){return this._cache}),$T(0,$_,"type",function(){return this._type}),$Y.checkNext=function(){$Y._isWorking=!0;for(var $B=$K.now();$Y._startIndex<$Y._loaders.length;)if($K.now(),$Y._loaders[$Y._startIndex].endLoad(),$Y._startIndex++,$K.now()-$B>$Y.maxTimeOut)return console.warn("loader callback cost a long time:"+($K.now()-$B)+" url="+$Y._loaders[$Y._startIndex-1].url),void $N.timer.frameOnce(1,null,$Y.checkNext);$Y._loaders.length=0,$Y._startIndex=0,$Y._isWorking=!1},$Y.clearRes=function($B,$_){if(null!=$B){void 0===$_&&($_=!1),$B=$F.formatURL($B);var $Z=$Y.getAtlas($B);if($Z){for(var $n=0,$g=$Z.length;$n<$g;$n++){var $q=$Z[$n],$P=$Y.getRes($q);delete $Y.loadedMap[$q],$Y.clearCache($B.substring($F.basePath.length),$q.substring($F.basePath.length)),$P&&$P.destroy($_)}$Z.length=0,delete $Y.atlasMap[$B],delete $Y.loadedMap[$B]}else{var $k=$Y.loadedMap[$B];$k&&(delete $Y.loadedMap[$B],$k instanceof laya.resource.Texture&&$k.bitmap&&$k.destroy($_))}}},$Y.clearTextureRes=function($B){$B=$F.formatURL($B);var $_=laya.net.Loader.getAtlas($B),$Z=$_&&0<$_.length?laya.net.Loader.getRes($_[0]):laya.net.Loader.getRes($B);$Z&&$Z.bitmap&&($u.isConchApp&&!$u.isConchWebGL?$Z.bitmap.source.releaseTexture&&$Z.bitmap.source.releaseTexture():null==$Z.bitmap._atlaser&&$Z.bitmap.releaseResource(!0))},$Y.getRes=function($B){return $Y.loadedMap[$F.formatURL($B)]},$Y.getAtlas=function($B){return $Y.atlasMap[$F.formatURL($B)]},$Y.cacheRes=function($B,$_){$B=$F.formatURL($B),null!=$Y.loadedMap[$B]?console.warn("Resources already exist,is repeated loading:",$B):$Y.loadedMap[$B]=$_},$Y.setGroup=function($B,$_){$Y.groupMap[$_]||($Y.groupMap[$_]=[]),$Y.groupMap[$_].push($B)},$Y.clearResByGroup=function($B){if($Y.groupMap[$B]){var $_=$Y.groupMap[$B],$Z=0,$n=$_.length;for($Z=0;$Z<$n;$Z++)$Y.clearRes($_[$Z]);$_.length=0}},$Y.keepCache=function($B,$_){if($B&&$_){var $Z=$Y.cacheSet[$_];$Z?-1==$Z.indexOf($B)&&$Z.push($B):$Y.cacheSet[$_]=[$B]}},$Y.clearCache=function($B,$_){if($B&&$_){var $Z=$Y.cacheSet[$_];if($Z){var $n=$Z.indexOf($B);if(-1!==$n){var $g=$Z.length-1;0==$g?(delete $Y.cacheSet[$_],0<$Y.imgMgrSet[$_]?$P.imgMgrFree($_,$Y.imgMgrSet[$_]):$Y.clearRes($_,!0)):($Z[$n]=$Z[$g],$Z.length=$g)}}}},$Y.saveObject=function($B,$_,$Z){if($_&&$B){var $n=$Y.objectSet[$B];$n?(console.warn("Loader.saveObject: "+$B),$n[0]=$_,$n[1]=$Z):$Y.objectSet[$B]=[$_,$Z,[]]}},$Y.findObject=function($B){if($B){var $_=$Y.objectSet[$B];if($_)return $_[0]}return null},$Y.keepObject=function($B,$_){if($B&&$_){var $Z=$Y.objectSet[$_];$Z&&-1===$Z[2].indexOf($B)&&$Z[2].push($B)}},$Y.clearObject=function($B,$_){if($B&&$_){var $Z=$Y.objectSet[$_];if($Z){var $n=$Z[2],$g=$n.indexOf($B);if(-1!==$g){var $q=$n.length-1;0==$q?(delete $Y.objectSet[$_],$Z[1]&&$Z[1].call(null,$Z[0])):($n[$g]=$n[$q],$n.length=$q)}}}},$Y.TEXT="text",$Y.JSON="json",$Y.XML="xml",$Y.BUFFER="arraybuffer",$Y.IMAGE="image",$Y.SOUND="sound",$Y.ATLAS="atlas",$Y.FONT="font",$Y.TTF="ttf",$Y.PLF="plf",$Y.PKM="pkm",$Y.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$Y.parserMap={},$Y.groupMap={},$Y.maxTimeOut=100,$Y.loadedMap={},$Y.preLoadedMap={},$Y.atlasMap={},$Y._loaders=[],$Y._isWorking=!1,$Y._startIndex=0,$Y.imgCache={},$Y.cacheSet={},$Y.objectSet={},$Y.imgMgrSet={},$Y}(),$mB=function($B){var $I;function $A(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$A.__super.call(this);for(var $B=0;$B<this._maxPriority;$B++)this._resInfos[$B]=[]}$w($A,"laya.net.LoaderManager",$D);var $_=$A.prototype;return $_.create=function($B,$Z,$_,$n,$g,$q,$P,$k){if(null==$q&&($q=2),null==$P&&($P=!0),$B instanceof Array){var $m=$B,$D=$m.length,$T=0;if($_)var $e=$y.create($_.caller,$_.method,$_.args,!1);for(var $I=0;$I<$D;$I++){var $A=$m[$I];"string"==typeof $A&&($A=$m[$I]={url:$A}),$A.progress=0}for($I=0;$I<$D;$I++){$A=$m[$I];var $$=$_?$y.create(null,$j,[$A],!1):null,$w=$_||$Z?$y.create(null,$r,[$A]):null;this._create($A.url,$w,$$,$A.clas||$n,$A.params||$g,null!=$A.priority&&0<=$A.priority?$A.priority:$q,$P,$A.group||$k)}function $r($B,$_){$T++,$B.progress=1,$T===$D&&$Z&&$Z.run()}function $j($B,$_){$B.progress=$_;for(var $Z=0,$n=0;$n<$D;$n++){$Z+=$m[$n].progress}var $g=$Z/$D;$e.runWith($g)}return!0}return this._create($B,$Z,$_,$n,$g,$q,$P,$k)},$_._create=function($_,$Z,$B,$n,$g,$q,$P,$k){$_&&""!=$_||console.error("加载的url不合法 "+$_),null==$q&&($q=2),null==$P&&($P=!0);var $m=$F.formatURL($_),$D=this.getRes($m);if($D)!$D.hasOwnProperty("loaded")||$D.loaded?($B&&$B.runWith(1),$Z&&$Z.run()):$Z&&$N.loader._createListener($_,$Z.caller,$Z.method,$Z.args,!0,!1);else{var $T=$a.getFileExtension($_),$e=$A.createMap[$T];if(!$e)throw new Error("LoaderManager:unknown file("+$_+") extension with: "+$T+".");$n||($n=$e[0]);var $I=$e[1];if("atlas"==$T)this.load($_,$Z,$B,$I,$q,$P);else{$n===$TB&&($I="htmlimage"),($D=$n?new $n:null).hasOwnProperty("_loaded")&&($D._loaded=!1),$D._setUrl($_),$k&&$D._setGroup($k),this._createLoad($D,$_,$y.create(null,function($B){$D&&!$D.destroyed&&$B&&$D.onAsynLoaded.call($D,$_,$B,$g),$Z&&$Z.run();$N.loader.event($_)}),$B,$I,$q,!1,$k,!0),$P&&this.cacheRes($m,$D)}}return $D},$_.load=function($B,$_,$Z,$n,$g,$q,$P,$k){$B&&""!=$B||console.error("加载的url不合法 "+$B);var $m=this;if(null==$g&&($g=2),null==$q&&($q=!0),void 0===$k&&($k=!1),$B instanceof Array)return this._loadAssets($B,$_,$Z,$n,$g,$q,$P);var $D=$kB.getRes($B);if(null!=$D)$N.timer.frameOnce(1,null,function(){$Z&&$Z.runWith(1),$_&&$_.runWith($D),$m._loaderCount||$m.event("complete")});else{var $T=$A._resMap[$B];$T?($_&&$T._createListener("complete",$_.caller,$_.method,$_.args,!1,!1),$Z&&$T._createListener("progress",$Z.caller,$Z.method,$Z.args,!1,!1)):(($T=this._infoPool.length?this._infoPool.pop():new $I).url=$B,$T.clas=null,$T.type=$n,$T.cache=$q,$T.group=$P,$T.ignoreCache=$k,$T.priority=$g,$_&&$T.on("complete",$_.caller,$_.method,$_.args),$Z&&$T.on("progress",$Z.caller,$Z.method,$Z.args),$A._resMap[$B]=$T,$g=$g<this._maxPriority?0<=$g?$g:0:this._maxPriority-1,this._resInfos[$g].push($T),this._next())}return this},$_.cancel=function($B,$_,$Z){if($D=$A._resMap[$B]){$_&&$D.off("complete",$_.caller,$_.method,!1),$Z&&$D.off("progress",$Z.caller,$Z.method,!1);var $n=$D.getListener("complete"),$g=$D.getListener("progress");if(!($n&&$n.head||$g&&$g.head)){if($D.loader){var $q=$D.loader;$q.imageCancel($B),$q.offAll(),$q._data=null,$q._customParse=!1,$q._url=null,$q._class=null,$q._type=null,this._loaders.push($q),this._loaderCount--,delete this._loaderMap[$D.url]}for(var $P=0;$P<this._maxPriority;$P++)for(var $k=this._resInfos[$P],$m=$k.length-1;-1<$m;$m--){var $D;($D=$k[$m])&&$D.url===$B&&($k[$m]=null,$D.destroy(),$D.offAll(),this._infoPool.push($D))}delete $A._resMap[$B],this._next()}}},$_._createLoad=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){var $D=this;if(null==$q&&($q=2),null==$P&&($P=!0),void 0===$m&&($m=!1),$_ instanceof Array)return this._loadAssets($_,$Z,$n,$g,$q,$P,$k);var $T=$kB.getRes($_);if(null!=$T)$N.timer.frameOnce(1,null,function(){$n&&$n.runWith(1),$Z&&$Z.runWith($T),$D._loaderCount||$D.event("complete")});else{var $e=$A._resMap[$_];$e?($Z&&$e._createListener("complete",$Z.caller,$Z.method,$Z.args,!1,!1),$n&&$e._createListener("progress",$n.caller,$n.method,$n.args,!1,!1)):(($e=this._infoPool.length?this._infoPool.pop():new $I).url=$_,$e.clas=$B,$e.type=$g,$e.cache=$P,$e.group=$k,$e.ignoreCache=$m,$e.priority=$q,$Z&&$e.on("complete",$Z.caller,$Z.method,$Z.args),$n&&$e.on("progress",$n.caller,$n.method,$n.args),$A._resMap[$_]=$e,$q=$q<this._maxPriority?0<=$q?$q:0:this._maxPriority-1,this._resInfos[$q].push($e),this._next())}return this},$_._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $B=0;$B<this._maxPriority;$B++)for(var $_=this._resInfos[$B];0<$_.length;){var $Z=$_.shift();if($Z)return this._doLoad($Z)}this._loaderCount||this.event("complete")}},$_._doLoad=function($_){var $Z=this._loaders.length?this._loaders.pop():new $kB;this._loaderCount++,(this._loaderMap[$_.url]=$Z).on("complete",null,$g),$Z.on("progress",null,function($B){$_.event("progress",$B)}),$Z.on("error",null,function($B){$g(null)}),$_.loader=$Z;var $n=this;function $g($B){$Z.offAll(),$Z._data=null,$Z._customParse=!1,$Z._url=null,$Z._class=null,$Z._type=null,$n._loaders.push($Z),$n._loaderCount--,delete $n._loaderMap[$_.url],$n._endLoad($_,$B instanceof Array?[$B]:$B),$n._next()}$Z._class=$_.clas,1<=$_.priority?($Z.priority=$_.priority,$Z.realTime=!1):($Z.priority=0,$Z.realTime=!0),$Z.load($_.url,$_.type,$_.cache,$_.group,$_.ignoreCache)},$_._endLoad=function($B,$_){var $Z=$B.url;if(null==$_){var $n=this._failRes[$Z]||0;if($n<this.retryNum)return console.warn("[warn]Retry to load:",$Z),this._failRes[$Z]=$n+1,void $N.timer.once(this.retryDelay,this,this._addReTry,[$B],!1);console.warn("[error]Failed to load:",$Z),this.event("error",$Z)}this._failRes[$Z]&&(this._failRes[$Z]=0),delete $A._resMap[$Z],$B.event("complete",$_),$B.destroy(),$B.offAll(),this._infoPool.push($B)},$_._addReTry=function($B){this._resInfos[this._maxPriority-1].push($B),this._next()},$_.clearRes=function($B,$_){void 0===$_&&($_=!1),$kB.clearRes($B,$_)},$_.getRes=function($B){return $kB.getRes($B)},$_.cacheRes=function($B,$_){$kB.cacheRes($B,$_)},$_.clearTextureRes=function($B){$kB.clearTextureRes($B)},$_.setGroup=function($B,$_){$kB.setGroup($B,$_)},$_.clearResByGroup=function($B){$kB.clearResByGroup($B)},$_.clearUnLoaded=function(){for(var $B=0;$B<this._maxPriority;$B++){for(var $_=this._resInfos[$B],$Z=$_.length-1;-1<$Z;$Z--){var $n=$_[$Z];$n&&($n.destroy(),$n.offAll(),this._infoPool.push($n))}$_.length=0}this._loaderCount=0,$A._resMap={}},$_.cancelLoadByUrls=function($B){if($B)for(var $_=0,$Z=$B.length;$_<$Z;$_++)this.cancelLoadByUrl($B[$_])},$_.cancelLoadByUrl=function($B){for(var $_=0;$_<this._maxPriority;$_++)for(var $Z=this._resInfos[$_],$n=$Z.length-1;-1<$n;$n--){var $g=$Z[$n];$g&&$g.url===$B&&($Z[$n]=null,$g.destroy(),$g.offAll(),this._infoPool.push($g))}$A._resMap[$B]&&delete $A._resMap[$B]},$_._loadAssets=function($B,$Z,$P,$_,$n,$g,$q){null==$n&&($n=2),null==$g&&($g=!0);for(var $k=$B.length,$m=0,$D=0,$T=[],$e=!0,$I=0;$I<$k;$I++){var $A=$B[$I];if(!$A)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$B);"string"==typeof $A&&($A={url:$A,type:$_,size:1,priority:$n}),$A.size||($A.size=1),$A.progress=0,$D+=$A.size,$T.push($A);var $$=$P?$y.create(null,$j,[$A],!1):null,$w=$Z||$P?$y.create(null,$r,[$A]):null;this.load($A.url,$w,$$,$A.type,null!=$A.priority&&0<=$A.priority?$A.priority:2,$g,$A.group||$q)}function $r($B,$_){$m++,$B.progress=1,$_||($e=!1),$m===$k&&$Z&&$Z.runWith($e)}function $j($B,$_){if(null!=$P){$B.progress=$_;for(var $Z=0,$n=0;$n<$T.length;$n++){var $g=$T[$n];$Z+=$g.size*$g.progress}var $q=$Z/$D;$P.runWith($q)}}return this},$A.cacheRes=function($B,$_){$kB.cacheRes($B,$_)},$A._resMap={},$m($A,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$A.__init$=function(){$I=function($B){function $_(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$_.__super.call(this)}return $w($_,"",$D),$_.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$_}()},$A}(),$DB=(function($B){function $g($B){$g.__super.call(this),$B||($B=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $_=0,$Z=0,$n=0;$n<20;$n++)$n%5!=4?this._mat[$_++]=$B[$n]:this._alpha[$Z++]=$B[$n];this._action=$v.createFilterAction(32),this._action.data=this}$w($g,"laya.filters.ColorFilter",$j);var $_=$g.prototype;$N.imps($_,{"laya.filters.IFilter":!0}),$_.callNative=function($B){$B._$P.cf=this;$B.conchModel&&$B.conchModel.setFilterMatrix&&$B.conchModel.setFilterMatrix(this._mat,this._alpha)},$T(0,$_,"type",function(){return 32}),$T(0,$_,"action",function(){return this._action})}(),function($B){function $n($B,$_,$Z){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$_&&($_=0),$n.__super.call(this),this._byteClass=$Z||$H,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$B&&0<$_&&$_<65535&&this.connect($B,$_)}$w($n,"laya.net.Socket",$D);var $_=$n.prototype;$_.connect=function($B,$_){var $Z="ws://"+$B+":"+$_;$Z="https:"==$K.window.location.protocol?"wss://"+$B+":"+$_:"ws://"+$B+":"+$_,this.connectByUrl($Z)},$_.connectByUrl=function($B){var $_=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $K.window.WebSocket($B,this.protocols):this._socket=new $K.window.WebSocket($B),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($B){$_._onOpen($B)},this._socket.onmessage=function($B){$_._onMessage($B)},this._socket.onclose=function($B){$_._onClose($B)},this._socket.onerror=function($B){$_._onError($B)}},$_.cleanSocket=function(){try{this._socket.close()}catch($B){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$_.close=function(){if(null!=this._socket)try{this._socket.close()}catch($B){}},$_._onOpen=function($B){this._connected=!0,this.event("open",$B)},$_._onMessage=function($B){if($B&&$B.data){var $_=$B.data;if(this.disableInput&&$_)this.event("message",$_);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $Z=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$_&&("string"==typeof $_?this._input.writeUTFBytes($_):this._input.writeArrayBuffer($_),this._addInputPosition=this._input.pos,this._input.pos=$Z),this.event("message",$_)}}},$_._onClose=function($B){this._connected=!1,this.event("close",$B)},$_._onError=function($B){this.event("error",$B)},$_.send=function($B){this._socket.send($B)},$_.flush=function(){if(this._output&&0<this._output.length){var $_;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($B){$_=$B}this._output.endian=this.endian,this._output.clear(),$_&&this.event("error",$_)}},$T(0,$_,"input",function(){return this._input}),$T(0,$_,"output",function(){return this._output}),$T(0,$_,"connected",function(){return this._connected}),$T(0,$_,"endian",function(){return this._endian},function($B){this._endian=$B,null!=this._input&&(this._input.endian=$B),null!=this._output&&(this._output.endian=$B)}),$n.LITTLE_ENDIAN="littleEndian",$n.BIG_ENDIAN="bigEndian"}(),function($B){function $k(){$k.__super.call(this),this._$1__id=++$k._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($k._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$p.currentResourceManager&&$p.currentResourceManager.addResource(this)}$w($k,"laya.resource.Resource",$D);var $_=$k.prototype;return $N.imps($_,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$_._setUrl=function($B){var $_;this._url!==$B&&(this._url&&(($_=$k._urlResourcesMap[this._url]).splice($_.indexOf(this),1),0===$_.length&&delete $k._urlResourcesMap[this._url]),$B&&(($_=$k._urlResourcesMap[$B])||($k._urlResourcesMap[$B]=$_=[]),$_.push(this)),this._url=$B)},$_._getGroup=function(){return this._group},$_._setGroup=function($B){var $_;this._group!==$B&&(this._group&&(($_=$k._groupResourcesMap[this._group]).splice($_.indexOf(this),1),0===$_.length&&delete $k._groupResourcesMap[this._group]),$B&&(($_=$k._groupResourcesMap[$B])||($k._groupResourcesMap[$B]=$_=[]),$_.push(this)),this._group=$B)},$_._addReference=function(){this._referenceCount++},$_._removeReference=function(){this._referenceCount--},$_._clearReference=function(){this._referenceCount=0},$_._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$_.recreateResource=function(){this.completeCreate()},$_.disposeResource=function(){},$_.activeResource=function($B){void 0===$B&&($B=!1),this._lastUseFrameCount=$S.loopCount,!this._destroyed&&this.__loaded&&(this._released||$B)&&this.recreateResource()},$_.releaseResource=function($B){return void 0===$B&&($B=!0),!(!$B&&this.lock)&&(!(this._released&&!$B)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$_.onAsynLoaded=function($B,$_,$Z){throw new Error("Resource: must override this function!")},$_.destroy=function(){var $B;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $k._idResourcesMap[this.id],this._url&&(($B=$k._urlResourcesMap[this._url])&&($B.splice($B.indexOf(this),1),0===$B.length&&delete $k._urlResourcesMap[this.url]),$kB.clearRes(this._url),this.__loaded||$v.cancelLoadByUrl(this._url)),this._group&&(($B=$k._groupResourcesMap[this._group]).splice($B.indexOf(this),1),0===$B.length&&delete $k._groupResourcesMap[this.url]))},$_.completeCreate=function(){this._released=!1,this.event("recovered",this)},$_.dispose=function(){this.destroy()},$T(0,$_,"memorySize",function(){return this._memorySize},function($B){var $_=$B-this._memorySize;this._memorySize=$B,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$_),this.resourceManager&&this.resourceManager.addSize($_)}),$T(0,$_,"_loaded",null,function($B){this.__loaded=$B}),$T(0,$_,"loaded",function(){return this.__loaded}),$T(0,$_,"id",function(){return this._$1__id}),$T(0,$_,"destroyed",function(){return this._destroyed}),$T(0,$_,"group",function(){return this._getGroup()},function($B){this._setGroup($B)}),$T(0,$_,"resourceManager",function(){return this._resourceManager}),$T(0,$_,"url",function(){return this._url}),$T(0,$_,"released",function(){return this._released}),$T(0,$_,"referenceCount",function(){return this._referenceCount}),$k.getResourceByID=function($B){return $k._idResourcesMap[$B]},$k.getResourceByURL=function($B,$_){return void 0===$_&&($_=0),null==$k._urlResourcesMap[$B]?null:$k._urlResourcesMap[$B][$_]},$k.getResourceCountByURL=function($B){return $k._urlResourcesMap[$B].length},$k.destroyUnusedResources=function($B){var $_;if($B){var $Z=$k._groupResourcesMap[$B];if($Z)for(var $n=$Z.slice(),$g=0,$q=$n.length;$g<$q;$g++)($_=$n[$g]).lock||0!==$_._referenceCount||$_.destroy()}else for(var $P in $k._idResourcesMap)($_=$k._idResourcesMap[$P]).lock||0!==$_._referenceCount||$_.destroy()},$k._uniqueIDCounter=0,$k._idResourcesMap={},$k._urlResourcesMap={},$k._groupResourcesMap={},$k}()),$TB=function($B){function $Y($B,$_){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$Y.__super.call(this),$B&&null!=$B._addReference&&$B._addReference(),this.setTo($B,$_)}$w($Y,"laya.resource.Texture",$D);var $_=$Y.prototype;return $_._setUrl=function($B){this.url=$B},$_.setTo=function($B,$_){if($B instanceof $P.HTMLElement){var $Z=$CB.create("2D",$B);this.bitmap=$Z}else this.bitmap=$B;if(this.uv=$_||$Y.DEF_UV,$B){this._w=$B.width,this._h=$B.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $n=this;if(this._loaded)$v.addToAtlas&&$v.addToAtlas($n);else{var $g=$B;$g instanceof laya.resource.HTMLImage&&$g.image&&$g.image.addEventListener("load",function($B){$v.addToAtlas&&$v.addToAtlas($n)},!1)}}},$_.active=function(){this.bitmap&&this.bitmap.activeResource()},$_.destroy=function($B){if(void 0===$B&&($B=!1),this.alphaTexture&&(this.alphaTexture.destroy($B),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $_=this.bitmap;$B?($u.isConchApp&&$_.source&&$_.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$_.dispose(),$_._clearReference()):($_._removeReference(),0==$_.referenceCount&&($u.isConchApp&&$_.source&&$_.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$_.dispose())),this.url&&this===$N.loader.getRes(this.url)&&$N.loader.clearRes(this.url,$B),this._loaded=!1}},$_.load=function($B){var $_=this;this._loaded=!1,$B=$F.customFormat($B);var $Z=this.bitmap||(this.bitmap=$JB.create($B));$Z.uri=$B,$Z&&$Z._addReference();var $n=this;$Z.onload=function(){$Z.onload=null,$n._loaded=!0,$_.sourceWidth=$_._w=$Z.width,$_.sourceHeight=$_._h=$Z.height,$n.event("loaded",this),$v.addToAtlas&&$v.addToAtlas($n)}},$_.addTextureToAtlas=function($B){$v.addTextureToAtlas(this)},$_.getPixels=function($B,$_,$Z,$n){if($u.isConchApp){var $g=this.bitmap;if($g.source&&$g.source.getImageData){var $q=$g.source.getImageData($B,$_,$Z,$n),$P=new Uint8Array($q);return Array.from($P)}return null}return $u.isWebGL?$v.getTexturePixels(this,$B,$_,$Z,$n):($K.canvas.size($Z,$n),$K.canvas.clear(),$K.context.drawTexture(this,-$B,-$_,this.width,this.height,0,0),$K.context.getImageData(0,0,$Z,$n).data)},$_.onAsynLoaded=function($B,$_){if($_){if("function"!=typeof $_._addReference)throw new Error("bitmap._addReference is not a function. "+$_.className+" "+typeof $_._addReference+" "+$_.constructor);$_._addReference()}this.setTo($_,this.uv),this._loaded&&this.event("loaded",this)},$T(0,$_,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$T(0,$_,"loaded",function(){return this._loaded}),$T(0,$_,"released",function(){return!this.bitmap||this.bitmap.released}),$T(0,$_,"width",function(){return this._w?this._w:this.uv&&this.uv!==$Y.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($B){this._w=$B,this.sourceWidth||(this.sourceWidth=$B)}),$T(0,$_,"repeat",function(){return!$u.isWebGL||!this.bitmap||this.bitmap.repeat},function($B){$B&&$u.isWebGL&&this.bitmap&&(this.bitmap.repeat=$B)&&(this.bitmap.enableMerageInAtlas=!1)}),$T(0,$_,"height",function(){return this._h?this._h:this.uv&&this.uv!==$Y.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($B){this._h=$B,this.sourceHeight||(this.sourceHeight=$B)}),$T(0,$_,"isLinearSampling",function(){return!$u.isWebGL||9728!=this.bitmap.minFifter},function($B){!$B&&$u.isWebGL&&($B||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$Y.moveUV=function($B,$_,$Z){for(var $n=0;$n<8;$n+=2)$Z[$n]+=$B,$Z[$n+1]+=$_;return $Z},$Y.create=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){void 0===$q&&($q=0),void 0===$P&&($P=0),void 0===$k&&($k=0),void 0===$m&&($m=0);var $D=$B instanceof laya.resource.Texture,$T=$D?$B.uv:$Y.DEF_UV,$e=$D?$B.bitmap:$B,$I=$v.isAtlas($e);if($I){var $A=$e._atlaser,$$=$B._atlasID;if(-1==$$)throw new Error("create texture error");$e=$A._inAtlasTextureBitmapValue[$$],$T=$A._inAtlasTextureOriUVValue[$$]}var $w=new $Y($e,null);$e.width&&$_+$n>$e.width&&($n=$e.width-$_),$e.height&&$Z+$g>$e.height&&($g=$e.height-$Z),$w.width=$n,$w.height=$g,$w.offsetX=$q,$w.offsetY=$P,$w.sourceWidth=$k||$n,$w.sourceHeight=$m||$g;var $r=1/$e.width,$j=1/$e.height;$_*=$r,$Z*=$j,$n*=$r,$g*=$j;var $y=$w.uv[0],$C=$w.uv[1],$z=$w.uv[4],$t=$w.uv[5],$J=$z-$y,$N=$t-$C,$Q=$Y.moveUV($T[0],$T[1],[$_,$Z,$_+$n,$Z,$_+$n,$Z+$g,$_,$Z+$g]);$w.uv=[$y+$Q[0]*$J,$C+$Q[1]*$N,$z-(1-$Q[2])*$J,$C+$Q[3]*$N,$z-(1-$Q[4])*$J,$t-(1-$Q[5])*$N,$y+$Q[6]*$J,$t-(1-$Q[7])*$N],$I&&$w.addTextureToAtlas();var $M=$e.scaleRate;return $M&&1!=$M?($w.sourceWidth/=$M,$w.sourceHeight/=$M,$w.width/=$M,$w.height/=$M,$w.scaleRate=$M,$w.offsetX/=$M,$w.offsetY/=$M):$w.scaleRate=1,$w},$Y.createFromTexture=function($B,$_,$Z,$n,$g){var $q=$B.scaleRate;1!=$q&&($_*=$q,$Z*=$q,$n*=$q,$g*=$q);var $P=$M.TEMP.setTo($_-$B.offsetX,$Z-$B.offsetY,$n,$g),$k=$P.intersection($Y._rect1.setTo(0,0,$B.width,$B.height),$Y._rect2);if(!$k)return null;var $m=$Y.create($B,$k.x,$k.y,$k.width,$k.height,$k.x-$P.x,$k.y-$P.y,$n,$g);if($m.bitmap&&$m.bitmap._removeReference)return $m.bitmap._removeReference(),$m;var $D="bitmap:"+($m.bitmap?$m.bitmap.constructor?$m.bitmap.constructor.name:$m.bitmap.__className:"")+", url:"+($B.url+" | "+($m.bitmap?$m.bitmap.url:$B.url))+", x="+$_+",y="+$Z+",width="+$n+",height="+$g+", result="+($k?$k.x+","+$k.y+","+$k.width+","+$k.height:"null")+", rect="+$P.x+","+$P.y+","+$P.width+","+$P.height;throw new Error("报错：bitmap._removeReference is not a function  "+$D)},$Y.DEF_UV=[0,0,1,0,1,1,0,1],$Y.INV_UV=[0,1,1,1,1,0,0,0],$Y._rect1=new $M,$Y._rect2=new $M,$Y}(),$B=function($B){var $k;function $q(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$q.__super.call(this)}$w($q,"laya.utils.TimeLine",$D);var $_=$q.prototype;return $_.to=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=0),this._create($B,$_,$Z,$n,$g,!0)},$_.from=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=0),this._create($B,$_,$Z,$n,$g,!1)},$_._create=function($B,$_,$Z,$n,$g,$q){var $P=$U.getItemByClass("tweenData",$k);return $P.isTo=$q,$P.type=0,$P.target=$B,$P.duration=$Z,$P.data=$_,$P.startTime=this._startTime+$g,$P.endTime=$P.startTime+$P.duration,$P.ease=$n,this._startTime=Math.max($P.endTime,this._startTime),this._tweenDataList.push($P),this._startTimeSort=!0,this._endTimeSort=!0,this},$_.addLabel=function($B,$_){var $Z=$U.getItemByClass("tweenData",$k);return $Z.type=1,$Z.data=$B,$Z.endTime=$Z.startTime=this._startTime+$_,this._labelDic||(this._labelDic={}),this._labelDic[$B]=$Z,this._tweenDataList.push($Z),this},$_.removeLabel=function($B){if(this._labelDic&&this._labelDic[$B]){var $_=this._labelDic[$B];if($_){var $Z=this._tweenDataList.indexOf($_);-1<$Z&&this._tweenDataList.splice($Z,1)}delete this._labelDic[$B]}},$_.gotoTime=function($B){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $_,$Z,$n,$g;for(var $q in this._firstTweenDic)if($Z=this._firstTweenDic[$q])for(var $P in $Z)$Z.diyTarget.hasOwnProperty($P)&&($Z.diyTarget[$P]=$Z[$P]);for($q in this._tweenDic)($_=this._tweenDic[$q]).clear(),delete this._tweenDic[$q];if(this._index=0,this._gidIndex=0,this._currTime=$B,this._lastTime=$K.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$n=this._tweenDataList.concat(),$n.sort(function($B,$_){return $B.endTime>$_.endTime?1:$B.endTime<$_.endTime?-1:0})}else $n=this._endTweenDataList;for(var $k=0,$m=$n.length;$k<$m;$k++)if(0==($g=$n[$k]).type){if(!($B>=$g.endTime))break;this._index=Math.max(this._index,$k+1);var $D=$g.data;if($g.isTo)for(var $T in $D)$g.target[$T]=$D[$T]}for($k=0,$m=this._tweenDataList.length;$k<$m;$k++)0==($g=this._tweenDataList[$k]).type&&$B>=$g.startTime&&$B<$g.endTime&&(this._index=Math.max(this._index,$k+1),this._gidIndex++,($_=$U.getItemByClass("tween",$d))._create($g.target,$g.data,$g.duration,$g.ease,$y.create(this,this._animComplete,[this._gidIndex]),0,!1,$g.isTo,!0,!1),$_.setStartTime(this._currTime-($B-$g.startTime)),$_._updateEase(this._currTime),$_.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$_)}},$_.gotoLabel=function($B){if(null!=this._labelDic){var $_=this._labelDic[$B];$_&&this.gotoTime($_.startTime)}},$_.pause=function(){$N.timer.clear(this,this._update)},$_.resume=function(){this.play(this._currTime,this._loopKey)},$_.play=function($B,$_){if(void 0===$B&&($B=0),void 0===$_&&($_=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($B,$_){return $B.startTime>$_.startTime?1:$B.startTime<$_.startTime?-1:0});for(var $Z=0,$n=this._tweenDataList.length;$Z<$n;$Z++){var $g=this._tweenDataList[$Z];if(null!=$g&&0==$g.type){var $q=$g.target,$P=$q.$_GID||($q.$_GID=$a.getGID()),$k=null;for(var $m in null==this._firstTweenDic[$P]?(($k={}).diyTarget=$q,this._firstTweenDic[$P]=$k):$k=this._firstTweenDic[$P],$g.data)null==$k[$m]&&($k[$m]=$q[$m])}}}"string"==typeof $B?this.gotoLabel($B):this.gotoTime($B),this._loopKey=$_,this._lastTime=$K.now(),$N.timer.frameLoop(1,this,this._update)}},$_._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $B in this._tweenDic)($_=this._tweenDic[$B]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $_,$Z=$K.now(),$n=$Z-this._lastTime,$g=this._currTime+=$n*this.scale;for($B in this._lastTime=$Z,this._tweenDic)($_=this._tweenDic[$B])._updateEase($g);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $q=this._tweenDataList[this._index];$g>=$q.startTime&&(this._index++,0==$q.type?(this._gidIndex++,($_=$U.getItemByClass("tween",$d))._create($q.target,$q.data,$q.duration,$q.ease,$y.create(this,this._animComplete,[this._gidIndex]),0,!1,$q.isTo,!0,!1),$_.setStartTime($g),$_.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$_)._updateEase($g)):this.event("label",$q.data))}},$_._animComplete=function($B){this._tweenDic[$B]&&delete this._tweenDic[$B]},$_._complete=function(){this.event("complete")},$_.reset=function(){var $B;if(this._labelDic)for($B in this._labelDic)delete this._labelDic[$B];for($B in this._tweenDic)this._tweenDic[$B].clear(),delete this._tweenDic[$B];for($B in this._firstTweenDic)delete this._firstTweenDic[$B];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $_,$Z=0;for($_=this._tweenDataList.length,$Z=0;$Z<$_;$Z++)this._tweenDataList[$Z]&&this._tweenDataList[$Z].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$N.timer.clear(this,this._update)},$_.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$T(0,$_,"index",function(){return this._frameIndex},function($B){this._frameIndex=$B,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$T(0,$_,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$q.to=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=0),(new $q).to($B,$_,$Z,$n,$g)},$q.from=function($B,$_,$Z,$n,$g){return void 0===$g&&($g=0),(new $q).from($B,$_,$Z,$n,$g)},$q.__init$=function(){$k=function(){function $B(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $w($B,""),$B.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$U.recover("tweenData",this)},$B}()},$q}(),$eB=function($g){function $Z(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$Z.__super.call(this),this._style=$k.EMPTY}$w($Z,"laya.display.Sprite",$g);var $B=$Z.prototype;return $N.imps($B,{"laya.display.ILayout":!0}),$B.createConchModel=function(){return new ConchNode},$B.destroy=function($B){if(void 0===$B&&($B=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $_=this.mask;$_&&(this.mask=null,$_.destroy($B))}$g.prototype.destroy.call(this,$B),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$B.updateZOrder=function(){$a.updateOrder(this._childs)&&this.repaint()},$B.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$B.setBounds=function($B){this._set$P("uBounds",$B)},$B.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $M),$M._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$B.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $M),$M._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$B._boundPointsToParent=function($B){void 0===$B&&($B=!1);var $_=0,$Z=0;this._style&&($_=this._style._tf.translateX,$Z=this._style._tf.translateY,$B=$B||0!==this._style._tf.rotate,this._style.scrollRect&&($_+=this._style.scrollRect.x,$Z+=this._style.scrollRect.y));var $n=this._getBoundPointsM($B);if(!$n||$n.length<1)return $n;if(8!=$n.length&&($n=$B?$t.scanPList($n):$M._getWrapRec($n,$M.TEMP)._getBoundPoints()),!this.transform)return $a.transPointList($n,this._x-$_,this._y-$Z),$n;var $g=$Q.TEMP,$q=0,$P=$n.length;for($q=0;$q<$P;$q+=2)$g.x=$n[$q],$g.y=$n[$q+1],this.toParentPoint($g),$n[$q]=$g.x,$n[$q+1]=$g.y;return $n},$B.getGraphicBounds=function($B){return void 0===$B&&($B=!1),this._graphics?this._graphics.getBounds($B):$M.TEMP.setTo(0,0,0,0)},$B._getBoundPointsM=function($B){if(void 0===$B&&($B=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $_=$a.clearArray(this._$P.temBM),$Z=$M.TEMP;return $Z.copyFrom(this.scrollRect),$a.concatArray($_,$Z._getBoundPoints()),$_}for(var $n,$g,$q,$P=this._graphics?this._graphics.getBoundPoints():$a.clearArray(this._$P.temBM),$k=0,$m=($q=this._childs).length;$k<$m;$k++)($n=$q[$k])instanceof laya.display.Sprite&&1==$n.visible&&($g=$n._boundPointsToParent($B))&&($P=$P?$a.concatArray($P,$g):$g);return $P},$B.getStyle=function(){return this._style===$k.EMPTY&&(this._style=new $k),this._style},$B.setStyle=function($B){this._style=$B},$B._adjustTransform=function(){this._tfChanged=!1;var $B,$_=this._style._tf,$Z=$_.scaleX,$n=$_.scaleY;if($_.rotate||1!==$Z||1!==$n||$_.skewX||$_.skewY){($B=this._transform||(this._transform=$V.create())).bTransform=!0;var $g=.0174532922222222*($_.rotate-$_.skewX),$q=.0174532922222222*($_.rotate+$_.skewY),$P=Math.cos($q),$k=Math.sin($q),$m=Math.sin($g),$D=Math.cos($g);return $B.a=$Z*$P,$B.b=$Z*$k,$B.c=-$n*$m,$B.d=$n*$D,$B.tx=$B.ty=0,$B}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$B},$B.pos=function($B,$_,$Z){if(void 0===$Z&&($Z=!1),this._x!==$B||this._y!==$_){if(this.destroyed)return this;if($Z){this._x=$B,this._y=$_,this.conchModel&&this.conchModel.pos(this._x,this._y);var $n=this._parent;$n&&0===$n._repaint&&($n._repaint=1,$n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$B,this.y=$_}return this},$B.pivot=function($B,$_){return this.pivotX=$B,this.pivotY=$_,this},$B.size=function($B,$_){return this.width=$B,this.height=$_,this},$B.scale=function($B,$_,$Z){void 0===$Z&&($Z=!1);var $n=this.getStyle(),$g=$n._tf;if($g.scaleX!=$B||$g.scaleY!=$_){if(this.destroyed)return this;if($Z){$n.setScale($B,$_),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($B,$_),this._renderType|=4;var $q=this._parent;$q&&0===$q._repaint&&($q._repaint=1,$q.parentRepaint())}else this.scaleX=$B,this.scaleY=$_}return this},$B.skew=function($B,$_){return this.skewX=$B,this.skewY=$_,this},$B.render=function($B,$_,$Z){$S.spriteCount++,$b.renders[this._renderType]._fun(this,$B,$_+this._x,$Z+this._y),this._repaint=0},$B.drawToCanvas=function($B,$_,$Z,$n){if($u.isConchNode){var $g=$CB.create("2D");return new $f($B,$_,$g).ctx.setCanvasType(1),this.conchModel.drawToCanvas($g.source,$Z,$n),$g}return $v.drawToCanvas(this,this._renderType,$B,$_,$Z,$n)},$B.customRender=function($B,$_,$Z){this._renderType|=1024},$B._applyFilters=function(){var $B;if(!$u.isWebGL&&(($B=this._$P.filters)&&!($B.length<1)))for(var $_=0,$Z=$B.length;$_<$Z;$_++)$B[$_].action.apply(this._$P.cacheCanvas)},$B._isHaveGlowFilter=function(){var $B,$_=0;if(this.filters)for($_=0;$_<this.filters.length;$_++)if(8==this.filters[$_].type)return!0;for($_=0,$B=this._childs.length;$_<$B;$_++)if(this._childs[$_]._isHaveGlowFilter())return!0;return!1},$B.localToGlobal=function($B,$_){void 0===$_&&($_=!1),!0===$_&&($B=new $Q($B.x,$B.y));for(var $Z=this;$Z&&$Z!=$N.stage;)$B=$Z.toParentPoint($B),$Z=$Z.parent;return $B},$B.globalToLocal=function($B,$_){void 0===$_&&($_=!1),$_&&($B=new $Q($B.x,$B.y));for(var $Z=this,$n=[];$Z&&$Z!=$N.stage;)$n.push($Z),$Z=$Z.parent;for(var $g=$n.length-1;0<=$g;)$B=($Z=$n[$g]).fromParentPoint($B),$g--;return $B},$B.toParentPoint=function($B){if(!$B)return $B;$B.x-=this.pivotX,$B.y-=this.pivotY,this.transform&&this._transform.transformPoint($B),$B.x+=this._x,$B.y+=this._y;var $_=this._style.scrollRect;return $_&&($B.x-=$_.x,$B.y-=$_.y),$B},$B.fromParentPoint=function($B){if(!$B)return $B;$B.x-=this._x,$B.y-=this._y;var $_=this._style.scrollRect;return $_&&($B.x+=$_.x,$B.y+=$_.y),this.transform&&this._transform.invertTransformPoint($B),$B.x+=this.pivotX,$B.y+=this.pivotY,$B},$B.on=function($B,$_,$Z,$n){return 1!==this._mouseEnableState&&this.isMouseEvent($B)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($B,$_,$Z,$n,!1)):$g.prototype.on.call(this,$B,$_,$Z,$n)},$B.once=function($B,$_,$Z,$n){return 1!==this._mouseEnableState&&this.isMouseEvent($B)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($B,$_,$Z,$n,!0)):$g.prototype.once.call(this,$B,$_,$Z,$n)},$B._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $B=this;for($B=$B.parent;$B&&1!==$B._mouseEnableState&&!$B._getBit(2);)$B.mouseEnabled=!0,$B._setBit(2,!0),$B=$B.parent}},$B.loadImage=function($B,$_,$Z,$n,$g,$q){var $P=this;return void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0),void 0===$g&&($g=0),this.graphics.loadImage($B,$_,$Z,$n,$g,function($B){$P.destroyed||($P.size($_+($n||$B.width),$Z+($g||$B.height)),$P.repaint(),$q&&$q.runWith($B))}),this},$B.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$B._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$B._childChanged=function($B){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$B&&this._get$P("hasZorder")&&$N.timer.callLater(this,this.updateZOrder),this.repaint()},$B.parentRepaint=function(){var $B=this._parent;$B&&0===$B._repaint&&($B._repaint=1,$B.parentRepaint())},$B.startDrag=function($B,$_,$Z,$n,$g,$q,$P){void 0===$_&&($_=!1),void 0===$Z&&($Z=0),void 0===$n&&($n=300),void 0===$q&&($q=!1),void 0===$P&&($P=.92),this._$P.dragging||this._set$P("dragging",new $R),this._$P.dragging.start(this,$B,$_,$Z,$n,$g,$q,$P)},$B.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$B._releaseMem=function(){if(this._$P){var $B=this._$P.cacheCanvas;$B&&$B.ctx&&($U.recover("RenderContext",$B.ctx),$B.ctx.canvas.size(0,0),$B.ctx=null);var $_=this._$P._filterCache;$_&&($_.destroy(),$_.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$B._setDisplay=function($B){$B||this._releaseMem(),$g.prototype._setDisplay.call(this,$B)},$B.hitTestPoint=function($B,$_){var $Z=this.globalToLocal($Q.TEMP.setTo($B,$_));return $B=$Z.x,$_=$Z.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$M.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($B,$_)},$B.getMousePoint=function(){return this.globalToLocal($Q.TEMP.setTo($N.stage.mouseX,$N.stage.mouseY))},$B._getWords=function(){return null},$B._addChildsToLayout=function($B){var $_=this._getWords();if(null==$_&&0==this._childs.length)return!1;if($_)for(var $Z=0,$n=$_.length;$Z<$n;$Z++)$B.push($_[$Z]);$Z=0;for(var $g=this._childs.length;$Z<$g;++$Z){var $q=this._childs[$Z];$q._style._enableLayout()&&$q._addToLayout($B)}return!0},$B._addToLayout=function($B){this._style.absolute||(this._style.block?$B.push(this):this._addChildsToLayout($B)&&(this.x=this.y=0))},$B._isChar=function(){return!1},$B._getCSSStyle=function(){return this._style.getCSSStyle()},$B._setAttributes=function($B,$_){switch($B){case"x":this.x=parseFloat($_);break;case"y":this.y=parseFloat($_);break;case"width":this.width=parseFloat($_);break;case"height":this.height=parseFloat($_);break;default:this[$B]=$_}},$B._layoutLater=function(){this.parent&&this.parent._layoutLater()},$T(0,$B,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($B){this._optimizeScrollRect!=$B&&(this._optimizeScrollRect=$B,this.conchModel&&this.conchModel.optimizeScrollRect($B))}),$T(0,$B,"customRenderEnable",null,function($B){if($B&&(this._renderType|=1024,$u.isConchNode)){$Z.CustomList.push(this);var $_=new $CB("2d");$_._setContext(new CanvasRenderingContext2D),this.customContext=new $f(0,0,$_),$_.context.setCanvasType&&$_.context.setCanvasType(2),this.conchModel.custom($_.context)}}),$T(0,$B,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($B){this.cacheAs=$B?this._$P.hasFilter?"none":"normal":"none"}),$T(0,$B,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($B){var $_=this._$P.cacheCanvas;if($B!==($_?$_.type:"none")){if("none"!==$B)this._getBit(1)||this._setUpNoticeType(1),$_||($_=this._set$P("cacheCanvas",$U.getItemByClass("cacheCanvas",Object))),$_.type=$B,$_.reCache=!0,this._renderType|=16,"bitmap"==$B&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($_){var $Z=$_;$Z&&$Z.ctx&&($U.recover("RenderContext",$Z.ctx),$Z.ctx.canvas.size(0,0),$Z.ctx=null),$U.recover("cacheCanvas",$_)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$T(0,$B,"zOrder",function(){return this._zOrder},function($B){this._zOrder!=$B&&(this._zOrder=$B,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($B),this._parent&&($B&&this._parent._set$P("hasZorder",!0),$N.timer.callLater(this._parent,this.updateZOrder)))}),$T(0,$B,"rotation",function(){return this._style._tf.rotate},function($B){var $_=this.getStyle();if($_._tf.rotate!==$B){$_.setRotate($B),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($B),this._renderType|=4;var $Z=this._parent;$Z&&0===$Z._repaint&&($Z._repaint=1,$Z.parentRepaint())}}),$T(0,$B,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($B){this._width!==$B&&(this._width=$B,this.conchModel&&this.conchModel.size($B,this._height),this.repaint())}),$T(0,$B,"x",function(){return this._x},function($B){if(this._x!==$B){if(this.destroyed)return;this._x=$B,this.conchModel&&this.conchModel.pos($B,this._y);var $_=this._parent;$_&&0===$_._repaint&&($_._repaint=1,$_.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$T(0,$B,"globalScaleY",function(){for(var $B=1,$_=this;$_&&$_!==$N.stage;)$B*=$_.scaleY,$_=$_.parent;return $B}),$T(0,$B,"hitArea",function(){return this._$P.hitArea},function($B){this._set$P("hitArea",$B)}),$T(0,$B,"staticCache",function(){return this._$P.staticCache},function($B){this._set$P("staticCache",$B),$B||this.reCache()}),$T(0,$B,"texture",function(){return this._texture},function($B){this._texture!=$B&&(this._texture=$B,this.graphics.cleanByTexture($B,0,0))}),$T(0,$B,"y",function(){return this._y},function($B){if(this._y!==$B){if(this.destroyed)return;this._y=$B,this.conchModel&&this.conchModel.pos(this._x,$B);var $_=this._parent;$_&&0===$_._repaint&&($_._repaint=1,$_.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$T(0,$B,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($B){this._height!==$B&&(this._height=$B,this.conchModel&&this.conchModel.size(this._width,$B),this.repaint())}),$T(0,$B,"blendMode",function(){return this._style.blendMode},function($B){this.getStyle().blendMode=$B,this.conchModel&&this.conchModel.blendMode($B),$B&&"source-over"!=$B?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$T(0,$B,"scaleX",function(){return this._style._tf.scaleX},function($B){var $_=this.getStyle();if($_._tf.scaleX!==$B){$_.setScaleX($B),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($B,$_._tf.scaleY),this._renderType|=4;var $Z=this._parent;$Z&&0===$Z._repaint&&($Z._repaint=1,$Z.parentRepaint())}}),$T(0,$B,"scaleY",function(){return this._style._tf.scaleY},function($B){var $_=this.getStyle();if($_._tf.scaleY!==$B){$_.setScaleY($B),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($_._tf.scaleX,$B),this._renderType|=4;var $Z=this._parent;$Z&&0===$Z._repaint&&($Z._repaint=1,$Z.parentRepaint())}}),$T(0,$B,"stage",function(){return $N.stage}),$T(0,$B,"skewX",function(){return this._style._tf.skewX},function($B){var $_=this.getStyle();if($_._tf.skewX!==$B){$_.setSkewX($B),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($B,$_._tf.skewY),this._renderType|=4;var $Z=this._parent;$Z&&0===$Z._repaint&&($Z._repaint=1,$Z.parentRepaint())}}),$T(0,$B,"scrollRect",function(){return this._style.scrollRect},function($B){this.getStyle().scrollRect=$B,this.repaint(),$B?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($B.x,$B.y,$B.width,$B.height)):(this._renderType&=-129,this.conchModel&&($Z.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$T(0,$B,"skewY",function(){return this._style._tf.skewY},function($B){var $_=this.getStyle();if($_._tf.skewY!==$B){$_.setSkewY($B),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($_._tf.skewX,$B),this._renderType|=4;var $Z=this._parent;$Z&&0===$Z._repaint&&($Z._repaint=1,$Z.parentRepaint())}}),$T(0,$B,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($B){this._tfChanged=!1,(this._transform=$B)&&(this._x=$B.tx,this._y=$B.ty,$B.tx=$B.ty=0,this.conchModel&&this.conchModel.transform($B.a,$B.b,$B.c,$B.d,this._x,this._y)),$B?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$T(0,$B,"pivotX",function(){return this._style._tf.translateX},function($B){this.getStyle().setTranslateX($B),this.conchModel&&this.conchModel.pivot($B,this._style._tf.translateY),this.repaint()}),$T(0,$B,"pivotY",function(){return this._style._tf.translateY},function($B){this.getStyle().setTranslateY($B),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$B),this.repaint()}),$T(0,$B,"alpha",function(){return this._style.alpha},function($B){this._style&&this._style.alpha!==$B&&($B=$B<0?0:1<$B?1:$B,this.getStyle().alpha=$B,this.conchModel&&this.conchModel.alpha($B),1!==$B?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$T(0,$B,"visible",function(){return this._style.visible},function($B){this._style&&this._style.visible!==$B&&(this.getStyle().visible=$B,this.conchModel&&this.conchModel.visible($B),this.parentRepaint())}),$T(0,$B,"graphics",function(){return this._graphics||(this.graphics=$v.createGraphics())},function($B){this._graphics&&(this._graphics._sp=null),(this._graphics=$B)?(this._renderType&=-2,this._renderType|=512,($B._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($Z.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$T(0,$B,"filters",function(){return this._$P.filters},function($B){$B&&0===$B.length&&($B=null),this._$P.filters!=$B&&(this._set$P("filters",$B?$B.slice():null),$u.isConchApp&&(this.conchModel&&($Z.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$u.isWebGL&&($B&&$B.length?this._renderType|=32:this._renderType&=-33),$B&&0<$B.length?(this._getBit(1)||this._setUpNoticeType(1),$u.isWebGL&&1==$B.length&&$B[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($u.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$T(0,$B,"parent",$g.prototype._$get_parent,function($B){$N.superSet($BB,this,"parent",$B),$B&&this._getBit(2)&&this._$2__onDisplay()}),$T(0,$B,"mask",function(){return this._$P._mask},function($B){$B&&this.mask&&this.mask._$P.maskParent||($B?(this.cacheAs="bitmap",this._set$P("_mask",$B),$B._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$B),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($B?$B.conchModel:null),this._renderType|=64,this.parentRepaint())}),$T(0,$B,"mouseEnabled",function(){return 1<this._mouseEnableState},function($B){this._mouseEnableState=$B?2:1}),$T(0,$B,"globalScaleX",function(){for(var $B=1,$_=this;$_&&$_!==$N.stage;)$B*=$_.scaleX,$_=$_.parent;return $B}),$T(0,$B,"mouseX",function(){return this.getMousePoint().x}),$T(0,$B,"mouseY",function(){return this.getMousePoint().y}),$Z.fromImage=function($B){return(new $Z).loadImage($B)},$Z._cachePool=[],$Z.CustomList=[],$m($Z,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$P.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$Z}($BB),$IB=function($B){function $_($B){this._audio=null,this._onEnd=null,this._resumePlay=null,$_.__super.call(this),this._onEnd=$a.bind(this.__onEnd,this),this._resumePlay=$a.bind(this.__resumePlay,this),$B.addEventListener("ended",this._onEnd),this._audio=$B}$w($_,"laya.media.h5audio.AudioSoundChannel",$nB);var $Z=$_.prototype;return $Z.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($N.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$Z.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$K.container.appendChild(this._audio),this._audio.play()}catch($B){this.event("error")}},$Z.play=function($B){this.isStopped=!1;try{this._audio.playbackRate=$L.playbackRate,this._audio.currentTime=this.startTime}catch($B){return void this._audio.addEventListener("canplay",this._resumePlay)}$L.addChannel(this),$K.container.appendChild(this._audio),!$B&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$Z.stop=function(){this.isStopped=!0,$L.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$u.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$K.onIE||this._audio!=$ZB._musicAudio&&$U.recover("audio:"+this.url,this._audio),$K.removeElement(this._audio),this._audio=null)},$Z.pause=function(){this.isStopped=!0,$L.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$Z.resume=function(){this._audio&&(this.isStopped=!1,$L.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$T(0,$Z,"position",function(){return this._audio?this._audio.currentTime:0}),$T(0,$Z,"duration",function(){return this._audio?this._audio.duration:0}),$T(0,$Z,"volume",function(){return this._audio?this._audio.volume:1},function($B){this._audio&&(this._audio.volume=$B)}),$_}(),$AB=function($B){function $_(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$qB.ctx,$_.__super.call(this),this._onPlayEnd=$a.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$w($_,"laya.media.webaudio.WebAudioSoundChannel",$nB);var $Z=$_.prototype;return $Z.play=function($B){if($L.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $_=this.context,$Z=this.gain,$n=$_.createBufferSource();(this.bufferSource=$n).buffer=this.audioBuffer,$n.connect($Z),$Z&&$Z.disconnect(),$Z.connect($_.destination),$n.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$K.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($n.loop=!0),$n.playbackRate.setTargetAtTime?$n.playbackRate.setTargetAtTime($L.playbackRate,this.context.currentTime,.1):$n.playbackRate.value=$L.playbackRate,$n.start(0,this.startTime),!$B&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$Z.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($N.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$Z._clearBufferSource=function(){if(this.bufferSource){var $B=this.bufferSource;$B.stop?$B.stop(0):$B.noteOff(0),$B.disconnect(0),$B.onended=null,$_._tryCleanFailed||this._tryClearBuffer($B),this.bufferSource=null}},$Z._tryClearBuffer=function($B){try{$B.buffer=null}catch($B){$_._tryCleanFailed=!0}},$Z.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$L.removeChannel(this),this.startHandler=null,this.completeHandler=null},$Z.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$L.removeChannel(this)},$Z.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$T(0,$Z,"position",function(){return this.bufferSource?($K.now()-this._startTime)/1e3+this.startTime:0}),$T(0,$Z,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$T(0,$Z,"volume",function(){return this._volume},function($B){this.isStopped||(this._volume=$B,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($B,this.context.currentTime,.1):this.gain.gain.value=$B)}),$_._tryCleanFailed=!1,$_}(),$$B=function($B){function $_(){$_.__super.call(this),this._w=0,this._h=0}$w($_,"laya.resource.Bitmap",$DB);var $Z=$_.prototype;return $T(0,$Z,"width",function(){return this._w}),$T(0,$Z,"height",function(){return this._h}),$T(0,$Z,"source",function(){return this._source}),$_}(),$wB=function($_){function $B(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$B.__super.call(this),this._interval=$n.animationInterval,this._setUpNoticeType(1)}$w($B,"laya.display.AnimationPlayerBase",$_);var $Z=$B.prototype;return $Z.play=function($B,$_,$Z,$n){void 0===$B&&($B=0),void 0===$_&&($_=!0),void 0===$Z&&($Z=""),void 0===$n&&($n=!0),this._isPlaying=!0,this.index="string"==typeof $B?this._getFrameByLabel($B):$B,this.loop=$_,this._actionName=$Z,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$Z._getFrameByLabel=function($B){var $_=0;for($_=0;$_<this._count;$_++)if(this._labels[$_]&&0<=this._labels[$_].indexOf($B))return $_;return 0},$Z._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$Z._setControlNode=function($B){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$B)&&$B!=this&&($B.on("display",this,this._checkResumePlaying),$B.on("undisplay",this,this._checkResumePlaying))},$Z._setDisplay=function($B){$_.prototype._setDisplay.call(this,$B),this._checkResumePlaying()},$Z._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$Z.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$Z.addLabel=function($B,$_){this._labels||(this._labels={}),this._labels[$_]||(this._labels[$_]=[]),this._labels[$_].push($B)},$Z.removeLabel=function($B){if($B){if(this._labels)for(var $_ in this._labels)this._removeLabelFromLabelList(this._labels[$_],$B)}else this._labels=null},$Z._removeLabelFromLabelList=function($B,$_){if($B)for(var $Z=$B.length-1;0<=$Z;$Z--)$B[$Z]==$_&&$B.splice($Z,1)},$Z.gotoAndStop=function($B){this.index="string"==typeof $B?this._getFrameByLabel($B):$B,this.stop()},$Z._displayToIndex=function($B){},$Z.clear=function(){this.stop(),this._labels=null},$T(0,$Z,"interval",function(){return this._interval},function($B){this._interval!=$B&&(this._frameRateChanged=!0,this._interval=$B,this._isPlaying&&0<$B&&this.timerLoop($B,this,this._frameLoop,null,!0,!0))}),$T(0,$Z,"isPlaying",function(){return this._isPlaying}),$T(0,$Z,"index",function(){return this._index},function($B){if(this._index=$B,this._displayToIndex($B),this._labels&&this._labels[$B])for(var $_=this._labels[$B],$Z=0,$n=$_.length;$Z<$n;$Z++)this.event("label",$_[$Z])}),$T(0,$Z,"count",function(){return this._count}),$B.WRAP_POSITIVE=0,$B.WRAP_REVERSE=1,$B.WRAP_PINGPONG=2,$B}($eB),$rB=function($_){function $A(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$A.__super.call(this),this.overflow=$A.VISIBLE,this._style=new $_B(this),this._style.wordWrap=!1}$w($A,"laya.display.Text",$_);var $B=$A.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$B._getBoundPointsM=function($B){void 0===$B&&($B=!1);var $_=$M.TEMP;return $_.setTo(0,0,this.width,this.height),$_._getBoundPoints()},$B.getGraphicBounds=function($B){void 0===$B&&($B=!1);var $_=$M.TEMP;return $_.setTo(0,0,this.width,this.height),$_},$B._getCSSStyle=function(){return this._style},$B.lang=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T){if($B=$A.langPacks&&$A.langPacks[$B]?$A.langPacks[$B]:$B,arguments.length<2)this._text=$B;else{for(var $e=0,$I=arguments.length;$e<$I;$e++)$B=$B.replace("{"+$e+"}",arguments[$e+1]);this._text=$B}},$B._isPassWordMode=function(){var $B=this._style.password;return"prompt"in this&&this.prompt==this._text&&($B=!1),$B},$B._getPassWordTxt=function($B){var $_;$_="";for(var $Z=$B.length;0<$Z;$Z--)$_+="●";return $_},$B.renderText=function($B,$_){var $Z=this.graphics;$Z.clear(!0);var $n=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($K.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$K.context.font=$n;var $g=this.padding,$q=$g[3],$P="left",$k=this._lines,$m=this.leading+this._charSize.height,$D=this._currBitmapFont;$D&&($m=this.leading+$D.getMaxHeight());var $T=$g[0];if(!$D&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($P="right",$q=this._width-$g[1]):"center"==this.align&&($P="center",$q=.5*this._width+$g[3]-$g[1])),0<this._height){var $e=this._textHeight>this._height?"top":this.valign;"middle"===$e?$T=.5*(this._height-$_*$m)+$g[0]-$g[2]:"bottom"===$e&&($T=this._height-$_*$m-$g[2])}var $I=this._style;if($D&&$D.autoScaleSize)var $A=$D.fontSize/this.fontSize;if(this._clipPoint)if($Z.save(),$D&&$D.autoScaleSize){var $$=0,$w=0;$$=this._width?this._width-$g[3]-$g[1]:this._textWidth,$w=this._height?this._height-$g[0]-$g[2]:this._textHeight,$$*=$A,$w*=$A,$Z.clipRect($g[3],$g[0],$$,$w)}else $Z.clipRect($g[3],$g[0],this._width?this._width-$g[3]-$g[1]:this._textWidth,this._height?this._height-$g[0]-$g[2]:this._textHeight);var $r=$I.password;"prompt"in this&&this.prompt==this._text&&($r=!1);for(var $j=0,$y=0,$C=Math.min(this._lines.length,$_+$B)||1,$z=$B;$z<$C;$z++){var $t,$J=$k[$z];if($r){var $N=$J.length;$J="";for(var $Q=$N;0<$Q;$Q--)$J+="●"}if($j=$q-(this._clipPoint?this._clipPoint.x:0),$y=$T+$m*$z-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($P,$j,$y,$z),$D){var $M=this.width;$D.autoScaleSize&&($M=this.width*$A),$D.drawText($J,this,$j,$y,this.align,$M)}else $u.isWebGL?(this._words||(this._words=[]),($t=this._words.length>$z-$B?this._words[$z-$B]:new $E).setText($J)):$t=$J,$I.stroke?$Z.fillBorderText($t,$j,$y,$n,this.color,$I.strokeColor,$I.stroke,$P):$Z.fillText($t,$j,$y,$n,this.color,$P)}if($D&&$D.autoScaleSize){var $Y=1/$A;this.scale($Y,$Y)}this._clipPoint&&$Z.restore(),this._startX=$q,this._startY=$T},$B.drawUnderline=function($B,$_,$Z,$n){var $g=this._lineWidths[$n];switch($B){case"center":$_-=$g/2;break;case"right":$_-=$g}$Z+=this._charSize.height,this._graphics.drawLine($_,$Z,$_+$g,$Z,this.underlineColor||this.color,1)},$B.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$K.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $Q(0,0)):this._clipPoint=null;var $B=this._lines.length;if(this.overflow!=$A.VISIBLE){var $_=this.overflow==$A.HIDDEN?Math.floor:Math.ceil;$B=Math.min($B,$_((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $Z=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($Z,$B),this.repaint()},$B.evalTextSize=function(){var $B,$_=NaN;$B=Math.max.apply(this,this._lineWidths),$_=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$B==this._textWidth&&$_==this._textHeight||(this._textWidth=$B,this._textHeight=$_,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$B.checkEnabledViewportOrNot=function(){return this.overflow==$A.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$B.changeText=function($B){this._text!==$B&&(this.lang($B+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$B.parseLines=function($B){var $_=this.wordWrap||this.overflow==$A.HIDDEN;if($_)var $Z=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $n=$a.contextMeasureText($A._testWord);$u.isConchApp&&0===$n.width&&0===$n.height&&($n=$a.contextMeasureText("W")),this._charSize.width=$n.width,this._charSize.height=$n.height||this.fontSize}for(var $g=$B.replace(/\r\n/g,"\n").split("\n"),$q=0,$P=$g.length;$q<$P;$q++){var $k=$g[$q];$_?this.parseLine($k,$Z):(this._lineWidths.push(this.getTextWidth($k)),this._lines.push($k))}},$B.parseLine=function($B,$_){$K.context;var $Z,$n=this._lines,$g=0,$q=NaN,$P=NaN,$k=0;if(($q=this.getTextWidth($B))<=$_)return $n.push($B),void this._lineWidths.push($q);$q=this._charSize.width,0==($g=Math.floor($_/$q))&&($g=1),$P=$q=this.getTextWidth($B.substring(0,$g));for(var $m=$g,$D=$B.length;$m<$D;$m++)if($_<($P+=$q=this.getTextWidth($B.charAt($m))))if(this.wordWrap){var $T=$B.substring($k,$m);if($T.charCodeAt($T.length-1)<255?($Z=/(?:\w|-)+$/.exec($T))&&($m=$Z.index+$k,0==$Z.index?$m+=$T.length:$T=$B.substring($k,$m)):$A.RightToLeft&&($Z=/([\u0600-\u06FF])+$/.exec($T))&&($m=$Z.index+$k,0==$Z.index?$m+=$T.length:$T=$B.substring($k,$m)),$n.push($T),this._lineWidths.push($P-$q),!(($k=$m)+$g<$D)){$n.push($B.substring($k,$D)),this._lineWidths.push(this.getTextWidth($n[$n.length-1])),$k=-1;break}$m+=$g,$P=$q=this.getTextWidth($B.substring($k,$m)),$m--}else if(this.overflow==$A.HIDDEN)return $n.push($B.substring(0,$m)),void this._lineWidths.push(this.getTextWidth($n[$n.length-1]));this.wordWrap&&-1!=$k&&($n.push($B.substring($k,$D)),this._lineWidths.push(this.getTextWidth($n[$n.length-1])))},$B.getTextWidth=function($B){return this._currBitmapFont?this._currBitmapFont.getTextWidth($B):$a.contextMeasureText($B).width},$B.getWordWrapWidth=function(){var $B=this.padding,$_=NaN;return($_=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($_=this.wordWrap?100:$K.width),$_<=0&&($_=100),$_-$B[3]-$B[1]},$B.getCharPoint=function($B,$_){this._isChanged&&$N.timer.runCallLater(this,this.typeset);for(var $Z=0,$n=this._lines,$g=0,$q=0,$P=$n.length;$q<$P;$q++){if($B<($Z+=$n[$q].length)){var $k=$q;break}$g=$Z}var $m=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$K.context.font=$m;var $D=this.getTextWidth(this._text.substring($g,$B));return($_||new $Q).setTo(this._startX+$D-(this._clipPoint?this._clipPoint.x:0),this._startY+$k*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$T(0,$B,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($B){$B!=this._width&&($N.superSet($eB,this,"width",$B),this.isChanged=!0)}),$T(0,$B,"textWidth",function(){return this._isChanged&&$N.timer.runCallLater(this,this.typeset),this._textWidth}),$T(0,$B,"height",function(){return this._height?this._height:this.textHeight},function($B){$B!=this._height&&($N.superSet($eB,this,"height",$B),this.isChanged=!0)}),$T(0,$B,"textHeight",function(){return this._isChanged&&$N.timer.runCallLater(this,this.typeset),this._textHeight}),$T(0,$B,"padding",function(){return this._getCSSStyle().padding},function($B){this._getCSSStyle().padding=$B,this.isChanged=!0}),$T(0,$B,"bold",function(){return this._getCSSStyle().bold},function($B){this._getCSSStyle().bold=$B,this.isChanged=!0}),$T(0,$B,"text",function(){return this._text||""},function($B){this._text!==$B&&(this.lang($B+""),this.isChanged=!0,this.event("change"))}),$T(0,$B,"color",function(){return this._getCSSStyle().color},function($B){this._getCSSStyle().color!=$B&&(this._getCSSStyle().color=$B,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$T(0,$B,"font",function(){return this._getCSSStyle().fontFamily},function($B){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$A._bitmapFonts&&$A._bitmapFonts[$B]&&(this._currBitmapFont=$A._bitmapFonts[$B]),this._getCSSStyle().fontFamily=$B,this.isChanged=!0}),$T(0,$B,"fontSize",function(){return this._getCSSStyle().fontSize},function($B){this._getCSSStyle().fontSize=$B,this.isChanged=!0}),$T(0,$B,"italic",function(){return this._getCSSStyle().italic},function($B){this._getCSSStyle().italic=$B,this.isChanged=!0}),$T(0,$B,"align",function(){return this._getCSSStyle().align},function($B){this._getCSSStyle().align=$B,this.isChanged=!0}),$T(0,$B,"valign",function(){return this._getCSSStyle().valign},function($B){this._getCSSStyle().valign=$B,this.isChanged=!0}),$T(0,$B,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($B){this._getCSSStyle().wordWrap=$B,this.isChanged=!0}),$T(0,$B,"leading",function(){return this._getCSSStyle().leading},function($B){this._getCSSStyle().leading=$B,this.isChanged=!0}),$T(0,$B,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($B){this._getCSSStyle().backgroundColor=$B,this.isChanged=!0}),$T(0,$B,"borderColor",function(){return this._getCSSStyle().borderColor},function($B){this._getCSSStyle().borderColor=$B,this.isChanged=!0}),$T(0,$B,"stroke",function(){return this._getCSSStyle().stroke},function($B){this._getCSSStyle().stroke=$B,this.isChanged=!0}),$T(0,$B,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($B){this._getCSSStyle().strokeColor=$B,this.isChanged=!0}),$T(0,$B,"isChanged",null,function($B){this._isChanged!==$B&&(this._isChanged=$B)&&$N.timer.callLater(this,this.typeset)}),$T(0,$B,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($B){if(!(this.overflow!=$A.SCROLL||this.textWidth<this._width)&&this._clipPoint){$B=$B<this.padding[3]?this.padding[3]:$B;var $_=this._textWidth-this._width;$B=$_<$B?$_:$B;var $Z=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$B,this.renderText(this._lastVisibleLineIndex,$Z)}}),$T(0,$B,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($B){if(!(this.overflow!=$A.SCROLL||this.textHeight<this._height)&&this._clipPoint){$B=$B<this.padding[0]?this.padding[0]:$B;var $_=this._textHeight-this._height,$Z=($B=$_<$B?$_:$B)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$Z;var $n=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$B,this.renderText($Z,$n)}}),$T(0,$B,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$T(0,$B,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$T(0,$B,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$T(0,$B,"underlineColor",function(){return this._underlineColor},function($B){this._underlineColor=$B,this._isChanged=!0,this.typeset()}),$A.registerBitmapFont=function($B,$_){$A._bitmapFonts||($A._bitmapFonts={}),$A._bitmapFonts[$B]=$_},$A.unregisterBitmapFont=function($B,$_){if(void 0===$_&&($_=!0),$A._bitmapFonts&&$A._bitmapFonts[$B]){var $Z=$A._bitmapFonts[$B];$_&&$Z.destroy(),delete $A._bitmapFonts[$B]}},$A.setTextRightToLeft=function(){var $B;($B=$K.canvas.source.style).display="none",$B.position="absolute",$B.direction="rtl",$u._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$K.document.body.appendChild($K.canvas.source)},$A.supportFont=function($B){$K.context.font="10px sans-serif";var $_=$a.contextMeasureText("abcji").width;$K.context.font="10px "+$B;var $Z=$a.contextMeasureText("abcji").width;return console.log($_,$Z),$_!==$Z},$A._testWord="游",$A.langPacks=null,$A.VISIBLE="visible",$A.SCROLL="scroll",$A.HIDDEN="hidden",$A.CharacterCache=!0,$A.RightToLeft=!1,$A._bitmapFonts=null,$m($A,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$A}($eB),$jB=function($e){function $P(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$P.__super.call(this),this.offset=new $Q,this._canvasTransform=new $V,this._previousOrientation=$K.window.orientation;var $_=this;this.transform=$V.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $B=$K.window,$Z=this;$B.addEventListener("focus",function(){$_._isFocused=!0,$Z.event("focus"),$Z.event("focuschange")}),$B.addEventListener("blur",function(){$_._isFocused=!1,$Z.event("blur"),$Z.event("focuschange"),$Z._isInputting()&&($tB.inputElement.target.focus=!1)});var $n="visibilityState",$g="visibilitychange",$q=$B.document;void 0!==$q.hidden?($g="visibilitychange",$n="visibilityState"):void 0!==$q.mozHidden?($g="mozvisibilitychange",$n="mozVisibilityState"):void 0!==$q.msHidden?($g="msvisibilitychange",$n="msVisibilityState"):void 0!==$q.webkitHidden&&($g="webkitvisibilitychange",$n="webkitVisibilityState"),$B.document.addEventListener($g,function(){"hidden"==$K.document[$n]?$Z._setStageVisible(!1):$Z._setStageVisible(!0)}),$B.document.addEventListener("qbrowserVisibilityChange",function($B){$Z._setStageVisible(!$B.hidden)}),$B.addEventListener("resize",function(){var $B=$K.window.orientation;null!=$B&&$B!=$_._previousOrientation&&$Z._isInputting()&&($tB.inputElement.target.focus=!1),$_._previousOrientation=$B,$Z._isInputting()||$Z._resetCanvas()}),$B.addEventListener("orientationchange",function($B){$Z._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$K.onMobile&&this.on("mousedown",this,this._onmouseMove)}$w($P,"laya.display.Stage",$e);var $B=$P.prototype;return $B._setStageVisible=function($B){this._isVisibility!=$B&&(this._isVisibility=$B,this._isVisibility||this._isInputting()&&($tB.inputElement.target.focus=!1),this.event("visibilitychange"))},$B._isInputting=function(){return $K.onMobile&&$tB.isInputting},$B._changeCanvasSize=function(){this.setScreenSize($K.clientWidth*$K.pixelRatio,$K.clientHeight*$K.pixelRatio)},$B._resetCanvas=function(){if(this.screenAdaptationEnabled){var $B=$u._mainCanvas;$B.source.style;$B.size(1,1),$N.timer.once(100,this,this._changeCanvasSize)}},$B.setScreenSize=function($B,$_){var $Z=!1;if("none"!==this._screenMode&&($Z=($B/$_<1?"vertical":"horizontal")!==this._screenMode)){var $n=$_;$_=$B,$B=$n}this.canvasRotation=$Z;var $g=$u._mainCanvas,$q=$g.source.style,$P=this._canvasTransform.identity(),$k=this._scaleMode,$m=$B/this.designWidth,$D=$_/this.designHeight,$T=this.designWidth,$e=this.designHeight,$I=$B,$A=$_,$$=$K.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$k){case"noscale":$m=$D=1,$I=this.designWidth,$A=this.designHeight;break;case"showall":$m=$D=Math.min($m,$D),$T=$I=Math.round(this.designWidth*$m),$e=$A=Math.round(this.designHeight*$D);break;case"noborder":$m=$D=Math.max($m,$D),$I=Math.round(this.designWidth*$m),$A=Math.round(this.designHeight*$D);break;case"full":$m=$D=1,this._width=$T=$B,this._height=$e=$_;break;case"fixedwidth":$D=$m,this._height=$e=Math.round($_/$m);break;case"fixedheight":$m=$D,this._width=$T=Math.round($B/$D);break;case"fixedauto":$B/$_<this.designWidth/this.designHeight?($D=$m,this._height=$e=Math.round($_/$m)):($m=$D,this._width=$T=Math.round($B/$D))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$T=$T+1&2147483646,$e=$e+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$m*=this.scaleX,$D*=this.scaleY,1===$m&&1===$D?this.transform.identity():(this.transform.a=this._formatData($m/($I/$T)),this.transform.d=this._formatData($D/($A/$e)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$g.size($T,$e),$v.changeWebGLSize($T,$e),$P.scale($I/$T/$$,$A/$e/$$),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($B-$I)/$$:this.offset.x=.5*($B-$I)/$$,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($_-$A)/$$:this.offset.y=.5*($_-$A)/$$,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$P.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$Z&&("horizontal"===this._screenMode?($P.rotate(Math.PI/2),$P.translate($_/$$,0),this.canvasDegree=90):($P.rotate(-Math.PI/2),$P.translate(0,$B/$$),this.canvasDegree=-90)),$P.a=this._formatData($P.a),$P.d=this._formatData($P.d),$P.tx=this._formatData($P.tx),$P.ty=this._formatData($P.ty),$q.transformOrigin=$q.webkitTransformOrigin=$q.msTransformOrigin=$q.mozTransformOrigin=$q.oTransformOrigin="0px 0px 0px",$q.transform=$q.webkitTransform=$q.msTransform=$q.mozTransform=$q.oTransform="matrix("+$P.toString()+")",$P.translate(parseInt($q.left)||0,parseInt($q.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$B._formatData=function($B){return Math.abs($B)<1e-6?0:Math.abs(1-$B)<.001?0<$B?1:-1:$B},$B.getMousePoint=function(){return $Q.TEMP.setTo(this.mouseX,this.mouseY)},$B.repaint=function(){this._repaint=1},$B.parentRepaint=function(){},$B._loop=function(){return this.render($u.context,0,0),!0},$B._onmouseMove=function($B){this._mouseMoveTime=$K.now()},$B.getTimeFromFrameStart=function(){return $K.now()-this._frameStartTime},$B.render=function($B,$_,$Z){if("sleep"===this._frameRate&&!$u.isConchApp){var $n=$K.now();if(!(1e3<=$n-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($S.loopCount++,$$.instance.runEvent(),$N.timer._update()));this._frameStartTime=$n}if(this._renderCount++,$u.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$K.now();var $g="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$q=this._renderCount%2==0;if($S.renderSlow=!$g,$g||$q||$u.isConchApp){var $P;$S.loopCount++,$$.instance.runEvent(),$N.timer._update(),$v.update3DLoop();var $k=0,$m=0;if($u.isConchNode)for($k=0,$m=this._scenes.length;$k<$m;$k++)($P=this._scenes[$k])&&$P._updateSceneConch();else for($k=0,$m=this._scenes.length;$k<$m;$k++)($P=this._scenes[$k])&&$P._updateScene();if($u.isConchNode){var $D=$eB.CustomList;for($k=0,$m=$D.length;$k<$m;$k++){var $T=$D[$k];$T.customRender($T.customContext,0,0)}return}}$u.isConchNode||this.renderingEnabled&&($g||!$q||$u.isConchWebGL)&&($u.isWebGL?$u.WebGL.mainContext&&!$u.WebGL.mainContext.isContextLost()&&($B.clear(),$e.prototype.render.call(this,$B,$_,$Z),$S._show&&$S._sp&&$S._sp.render($B,$_,$Z),$v.clear(this._bgColor),$v.beginFlush(),$B.flush(),$v.endFinish(),$i.instance&&$i.getInstance().endDispose()):($v.clear(this._bgColor),$e.prototype.render.call(this,$B,$_,$Z),$S._show&&$S._sp&&$S._sp.render($B,$_,$Z)))}else this._renderCount%5==0&&($S.loopCount++,$$.instance.runEvent(),$N.timer._update())},$B._requestFullscreen=function(){var $B=$K.document.documentElement;$B.requestFullscreen?$B.requestFullscreen():$B.mozRequestFullScreen?$B.mozRequestFullScreen():$B.webkitRequestFullscreen?$B.webkitRequestFullscreen():$B.msRequestFullscreen&&$B.msRequestFullscreen()},$B._fullScreenChanged=function(){$N.stage.event("fullscreenchange")},$B.exitFullscreen=function(){var $B=$K.document;$B.exitFullscreen?$B.exitFullscreen():$B.mozCancelFullScreen?$B.mozCancelFullScreen():$B.webkitExitFullscreen&&$B.webkitExitFullscreen()},$T(0,$B,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$T(0,$B,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$T(0,$B,"frameRate",function(){return this._frameRate},function($B){if(this._frameRate=$B,$u.isConchApp)switch(this._frameRate){case"slow":$K.window.conch&&$K.window.conchConfig.setSlowFrame&&$K.window.conchConfig.setSlowFrame(!0);break;case"fast":$K.window.conch&&$K.window.conchConfig.setSlowFrame&&$K.window.conchConfig.setSlowFrame(!1);break;case"mouse":$K.window.conch&&$K.window.conchConfig.setMouseFrame&&$K.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$K.window.conch&&$K.window.conchConfig.setLimitFPS&&$K.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$T(0,$B,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$T(0,$B,"width",$e.prototype._$get_width,function($B){this.designWidth=$B,$N.superSet($eB,this,"width",$B),$N.timer.callLater(this,this._changeCanvasSize)}),$T(0,$B,"alignH",function(){return this._alignH},function($B){this._alignH=$B,$N.timer.callLater(this,this._changeCanvasSize)}),$T(0,$B,"isFocused",function(){return this._isFocused}),$T(0,$B,"height",$e.prototype._$get_height,function($B){this.designHeight=$B,$N.superSet($eB,this,"height",$B),$N.timer.callLater(this,this._changeCanvasSize)}),$T(0,$B,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$V.create()},$e.prototype._$set_transform),$T(0,$B,"isVisibility",function(){return this._isVisibility}),$T(0,$B,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$T(0,$B,"scaleMode",function(){return this._scaleMode},function($B){this._scaleMode=$B,$N.timer.callLater(this,this._changeCanvasSize)}),$T(0,$B,"alignV",function(){return this._alignV},function($B){this._alignV=$B,$N.timer.callLater(this,this._changeCanvasSize)}),$T(0,$B,"bgColor",function(){return this._bgColor},function($B){this._bgColor=$B,this.conchModel&&this.conchModel.bgColor($B),$u.isWebGL&&($B?$P._wgColor=$X.create($B)._color:$K.onMiniGame||($P._wgColor=null)),$K.onLimixiu?$P._wgColor=$X.create($B)._color:$u.canvas.style.background=$B||"none"}),$T(0,$B,"mouseX",function(){return Math.round($$.instance.mouseX/this.clientScaleX)}),$T(0,$B,"mouseY",function(){return Math.round($$.instance.mouseY/this.clientScaleY)}),$T(0,$B,"screenMode",function(){return this._screenMode},function($B){this._screenMode=$B}),$T(0,$B,"visible",$e.prototype._$get_visible,function($B){this.visible!==$B&&($N.superSet($eB,this,"visible",$B),$u._mainCanvas.source.style.visibility=$B?"visible":"hidden")}),$T(0,$B,"fullScreenEnabled",null,function($B){var $_=$K.document,$Z=$u.canvas;$B?($Z.addEventListener("mousedown",this._requestFullscreen),$Z.addEventListener("touchstart",this._requestFullscreen),$_.addEventListener("fullscreenchange",this._fullScreenChanged),$_.addEventListener("mozfullscreenchange",this._fullScreenChanged),$_.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$_.addEventListener("msfullscreenchange",this._fullScreenChanged)):($Z.removeEventListener("mousedown",this._requestFullscreen),$Z.removeEventListener("touchstart",this._requestFullscreen),$_.removeEventListener("fullscreenchange",this._fullScreenChanged),$_.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$_.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$_.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$P.SCALE_NOSCALE="noscale",$P.SCALE_EXACTFIT="exactfit",$P.SCALE_SHOWALL="showall",$P.SCALE_NOBORDER="noborder",$P.SCALE_FULL="full",$P.SCALE_FIXED_WIDTH="fixedwidth",$P.SCALE_FIXED_HEIGHT="fixedheight",$P.SCALE_FIXED_AUTO="fixedauto",$P.ALIGN_LEFT="left",$P.ALIGN_RIGHT="right",$P.ALIGN_CENTER="center",$P.ALIGN_TOP="top",$P.ALIGN_MIDDLE="middle",$P.ALIGN_BOTTOM="bottom",$P.SCREEN_NONE="none",$P.SCREEN_HORIZONTAL="horizontal",$P.SCREEN_VERTICAL="vertical",$P.FRAME_FAST="fast",$P.FRAME_SLOW="slow",$P.FRAME_MOUSE="mouse",$P.FRAME_SLEEP="sleep",$P.FRAME_MOUSE_THREDHOLD=2e3,$m($P,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$P}($eB),$yB=(function($B){function $_(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$_.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$w($_,"laya.media.SoundNode",$eB);var $Z=$_.prototype;$Z._onParentChange=function(){this.target=this.parent},$Z.play=function($B,$_){void 0===$B&&($B=1),isNaN($B)&&($B=1),this.url&&(this.stop(),this._channel=$L.playSound(this.url,$B,null,$_))},$Z.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$Z._setPlayAction=function($B,$_,$Z,$n){void 0===$n&&($n=!0),this[$Z]&&$B&&($n?$B.on($_,this,this[$Z]):$B.off($_,this,this[$Z]))},$Z._setPlayActions=function($B,$_,$Z,$n){if(void 0===$n&&($n=!0),$B&&$_){var $g,$q=$_.split(","),$P=0;for($g=$q.length,$P=0;$P<$g;$P++)this._setPlayAction($B,$q[$P],$Z,$n)}},$T(0,$Z,"playEvent",null,function($B){(this._playEvents=$B)&&this._tar&&this._setPlayActions(this._tar,$B,"play")}),$T(0,$Z,"target",null,function($B){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$B,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$T(0,$Z,"stopEvent",null,function($B){(this._stopEvents=$B)&&this._tar&&this._setPlayActions(this._tar,$B,"stop")})}(),function($B){function $_(){this._src=null,this._onload=null,this._onerror=null,$_.__super.call(this)}$w($_,"laya.resource.FileBitmap",$$B);var $Z=$_.prototype;return $T(0,$Z,"src",function(){return this._src},function($B){this._src=$B}),$T(0,$Z,"onload",null,function($B){}),$T(0,$Z,"onerror",null,function($B){}),$_}()),$CB=function($B){function $Z($B,$_){this._is2D=!1,$Z.__super.call(this);var $n=this;if(this._source=this,"2D"===$B||"AUTO"===$B&&!$u.isWebGL){this._is2D=!0,this._source=$_||$K.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $g=this;$g.getContext=function($B,$_){if($n._ctx)return $n._ctx;var $Z=$n._ctx=$n._source.getContext($B,$_);return $Z&&($Z._canvas=$g,$u.isFlash||$K.onLimixiu||($Z.size=function($B,$_){})),$Z}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$w($Z,"laya.resource.HTMLCanvas",$$B);var $_=$Z.prototype;return $_.clear=function(){this._ctx&&this._ctx.clear()},$_.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$_.release=function(){},$_._setContext=function($B){this._ctx=$B},$_.getContext=function($B,$_){return this._ctx?this._ctx:this._ctx=$Z._createContext(this)},$_.getMemSize=function(){return 0},$_.size=function($B,$_){(this._w!=$B||this._h!=$_||this._source&&(this._source.width!=$B||this._source.height!=$_))&&(this._w=$B,this._h=$_,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($B,$_),this._source&&(this._source.height=$_,this._source.width=$B))},$_.getCanvas=function(){return this._source},$_.toBase64=function($B,$_,$Z){if(this._source)if($u.isConchApp&&this._source.toBase64)this._source.toBase64($B,$_,$Z);else{var $n=this._source.toDataURL($B,$_);$Z.call(this,$n)}},$T(0,$_,"context",function(){return this._ctx}),$T(0,$_,"asBitmap",null,function($B){}),$Z.create=function($B,$_){return new $Z($B,$_)},$Z.TYPE2D="2D",$Z.TYPE3D="3D",$Z.TYPEAUTO="AUTO",$Z._createContext=null,$Z}(),$zB=(function($B){function $m($B,$_,$Z,$n,$g,$q,$P,$k){throw $m.__super.call(this),new Error("不允许new！")}$w($m,"laya.resource.HTMLSubImage",$$B),$m.create=function($B,$_,$Z,$n,$g,$q,$P,$k){return void 0===$k&&($k=!1),new $m($B,$_,$Z,$n,$g,$q,$P,$k)}}(),function($B){function $e(){this._frames=null,this._url=null,$e.__super.call(this),this._setControlNode(this)}$w($e,"laya.display.Animation",$B);var $_=$e.prototype;$_.destroy=function($B){void 0===$B&&($B=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$B),this._frames=null,this._labels=null},$_.play=function($B,$_,$Z,$n){void 0===$B&&($B=0),void 0===$_&&($_=!0),void 0===$Z&&($Z=""),void 0===$n&&($n=!0),$Z&&this._setFramesFromCache($Z,$n),this._isPlaying=!0,this.index="string"==typeof $B?this._getFrameByLabel($B):$B,this.loop=$_,this._actionName=$Z,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$_._setFramesFromCache=function($B,$_){var $Z;return void 0===$_&&($_=!1),this._url&&($B=this._url+"#"+$B),$B&&$e.framesMap[$B]?(($Z=$e.framesMap[$B])instanceof Array?(this._frames=$e.framesMap[$B],this._count=this._frames.length):($Z.nodeRoot&&($e.framesMap[$B]=this._parseGraphicAnimationByData($Z),$Z=$e.framesMap[$B]),this._frames=$Z.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$Z.interval),this._labels=this._copyLabels($Z.labels)),!0):($_&&console.log("ani not found:",$B),!1)},$_._copyLabels=function($B){if(!$B)return null;var $_,$Z;for($Z in $_={},$B)$_[$Z]=$a.copyArray([],$B[$Z]);return $_},$_._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$B.prototype._frameLoop.call(this)},$_._displayToIndex=function($B){this._frames&&(this.graphics=this._frames[$B])},$_.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$_.loadImages=function($B,$_){return void 0===$_&&($_=""),this._url="",this._setFramesFromCache($_)||(this.frames=$e.framesMap[$_]?$e.framesMap[$_]:$e.createFrames($B,$_)),this},$_.loadAtlas=function($_,$Z,$n){void 0===$n&&($n=""),this._url="";var $g=this;function $B($B){$_===$B&&($g.frames=$e.framesMap[$n]?$e.framesMap[$n]:$e.createFrames($_,$n),$Z&&$Z.run())}return $g._setFramesFromCache($n)||($kB.getAtlas($_)?$B($_):$N.loader.load($_,$y.create(null,$B,[$_]),null,"atlas")),this},$_.loadAnimation=function($B,$_,$Z){this._url=$B;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$_&&$_.run()):!$Z||$kB.getAtlas($Z)?this._loadAnimationData($B,$_,$Z):$N.loader.load($Z,$y.create(this,this._loadAnimationData,[$B,$_,$Z]),null,"atlas"),this},$_._loadAnimationData=function($k,$m,$B){var $D=this;if(!$B||$kB.getAtlas($B)){var $T=this;$kB.getRes($k)?$_($k):$N.loader.load($k,$y.create(null,$_,[$k]),null,"json"),$kB.clearRes($k)}else console.warn("atlas load fail:"+$B);function $_($B){if($kB.getRes($B)&&$k===$B){var $_;if($e.framesMap[$k+"#"])$T._setFramesFromCache($D._actionName,!0),$D.index=0,$D._checkResumePlaying();else{var $Z=$T._parseGraphicAnimation($kB.getRes($k));if(!$Z)return;var $n,$g=$Z.animationList,$q=0,$P=$g.length;for($q=0;$q<$P;$q++)$_=$g[$q],$e.framesMap[$k+"#"+$_.name]=$_,$n||($n=$_);$n&&($e.framesMap[$k+"#"]=$n,$T._setFramesFromCache($D._actionName,!0),$D.index=0),$D._checkResumePlaying()}$m&&$m.run()}}},$_._parseGraphicAnimation=function($B){return $NB.parseAnimationData($B)},$_._parseGraphicAnimationByData=function($B){return $NB.parseAnimationByData($B)},$T(0,$_,"frames",function(){return this._frames},function($B){(this._frames=$B)&&(this._count=$B.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$T(0,$_,"autoPlay",null,function($B){$B?this.play():this.stop()}),$T(0,$_,"source",null,function($B){-1<$B.indexOf(".ani")?this.loadAnimation($B):-1<$B.indexOf(".json")||-1<$B.indexOf("als")||-1<$B.indexOf("atlas")?this.loadAtlas($B):this.loadImages($B.split(","))}),$T(0,$_,"autoAnimation",null,function($B){this.play(0,!0,$B,!1)}),$e.createFrames=function($B,$_){var $Z,$n,$g=0,$q=0;if("string"==typeof $B){var $P=$kB.getAtlas($B);if($P&&$P.length)for($Z=[],$g=0,$q=$P.length;$g<$q;$g++)($n=new $v.createGraphics).drawTexture($kB.getRes($P[$g]),0,0),$Z.push($n)}else if($B instanceof Array)for($Z=[],$g=0,$q=$B.length;$g<$q;$g++)($n=new $v.createGraphics).loadImage($B[$g],0,0),$Z.push($n);return $_&&($e.framesMap[$_]=$Z),$Z},$e.clearCache=function($B){var $_,$Z=$e.framesMap,$n=$B+"#";for($_ in $Z)$_!==$B&&0!=$_.indexOf($n)||delete $e.framesMap[$_]},$e.framesMap={}}($wB),function($B){function $q(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$q.__super.call(this),null==$q._sortIndexFun&&($q._sortIndexFun=$J.sortByKey("index",!1,!0))}$w($q,"laya.display.FrameAnimation",$B);var $_=$q.prototype;return $_._setUp=function($B,$_){this._labels=null,this._animationNewFrames=null,this._targetDic=$B,this._animationData=$_,this.interval=1e3/$_.frameRate,$_.parsed?(this._count=$_.count,this._labels=$_.labels,this._animationNewFrames=$_.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$_.parsed=!0,$_.labels=this._labels,$_.count=this._count,$_.animationNewFrames=this._animationNewFrames},$_.clear=function(){$B.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$_._displayToIndex=function($B){if(this._animationData){$B<0&&($B=0),$B>this._count&&($B=this._count);var $_=this._animationData.nodes,$Z=0,$n=$_.length;for($Z=0;$Z<$n;$Z++)this._displayNodeToFrame($_[$Z],$B)}},$_._displayNodeToFrame=function($B,$_,$Z){$Z||($Z=this._targetDic);var $n=$Z[$B.target];if($n){var $g,$q,$P,$k=$B.frames,$m=$B.keys,$D=0,$T=$m.length;for($D=0;$D<$T;$D++)$P=($q=$k[$g=$m[$D]]).length>$_?$q[$_]:$q[$q.length-1],$n[$g]=$P}},$_._calculateDatas=function(){if(this._animationData){var $B,$_=this._animationData.nodes,$Z=0,$n=$_.length;for($Z=this._count=0;$Z<$n;$Z++)$B=$_[$Z],this._calculateNodeKeyFrames($B);this._count+=1}},$_._calculateNodeKeyFrames=function($B){var $_,$Z,$n=$B.keyframes,$g=$B.target;for($_ in $B.frames||($B.frames={}),$B.keys?$B.keys.length=0:$B.keys=[],$B.initValues||($B.initValues={}),$n)$Z=$n[$_],$B.frames[$_]||($B.frames[$_]=[]),this._targetDic&&this._targetDic[$g]&&($B.initValues[$_]=this._targetDic[$g][$_]),$Z.sort($q._sortIndexFun),$B.keys.push($_),this._calculateNodePropFrames($Z,$B.frames[$_],$_,$g)},$_.resetToInitState=function(){if(this._targetDic&&this._animationData){var $B,$_,$Z=this._animationData.nodes,$n=0,$g=$Z.length;for($n=0;$n<$g;$n++)if($_=($B=$Z[$n]).initValues){var $q,$P=this._targetDic[$B.target];if($P)for($q in $_)$P[$q]=$_[$q]}}},$_._calculateNodePropFrames=function($B,$_,$Z,$n){var $g=0,$q=$B.length-1;if(0<$q){for($_.length=$B[$q].index+1,$g=0;$g<$q;$g++)this._dealKeyFrame($B[$g]),this._calculateFrameValues($B[$g],$B[$g+1],$_);this._dealKeyFrame($B[$g])}0==$q&&($_[$B[0].index]=$B[0].value,this._animationNewFrames&&(this._animationNewFrames[$B[0].index]=!0))},$_._dealKeyFrame=function($B){$B.label&&""!=$B.label&&this.addLabel($B.label,$B.index)},$_._calculateFrameValues=function($B,$_,$Z){var $n,$g=0,$q=$B.index,$P=$_.index,$k=$B.value,$m=$_.value-$B.value,$D=$P-$q;if($P>this._count&&(this._count=$P),$B.tween)for(null==($n=$h[$B.tweenMethod])&&($n=$h.linearNone),$g=$q;$g<$P;$g++)$Z[$g]=$n($g-$q,$k,$m,$D),this._animationNewFrames&&(this._animationNewFrames[$g]=!0);else for($g=$q;$g<$P;$g++)$Z[$g]=$k;this._animationNewFrames&&(this._animationNewFrames[$B.index]=!0,this._animationNewFrames[$_.index]=!0),$Z[$_.index]=$_.value},$q._sortIndexFun=null,$q}($wB)),$tB=function($_){function $g(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$g.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$rB.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$w($g,"laya.display.Input",$_);var $B=$g.prototype;return $B.setSelection=function($B,$_){this.focus=!0,laya.display.Input.inputElement.selectionStart=$B,laya.display.Input.inputElement.selectionEnd=$_},$B._onUnDisplay=function($B){this.focus=!1},$B._onMouseDown=function($B){this.focus=!0},$B._syncInputTransform=function(){var $B=this.nativeInput,$_=$a.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$Z=this._width-this.padding[1]-this.padding[3],$n=this._height-this.padding[0]-this.padding[2];$u.isConchApp?($B.setScale($_.scaleX,$_.scaleY),$B.setSize($Z,$n),$B.setPos($_.x,$_.y)):($g.inputContainer.style.transform=$g.inputContainer.style.webkitTransform="scale("+$_.scaleX+","+$_.scaleY+") rotate("+$N.stage.canvasDegree+"deg)",$B.style.width=$Z+"px",$B.style.height=$n+"px",$g.inputContainer.style.left=$_.x+"px",$g.inputContainer.style.top=$_.y+"px")},$B.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$B._setInputMethod=function(){$g.input.parentElement&&$g.inputContainer.removeChild($g.input),$g.area.parentElement&&$g.inputContainer.removeChild($g.area),$g.inputElement=this._multiline?$g.area:$g.input,$g.inputContainer.appendChild($g.inputElement),$rB.RightToLeft&&($g.inputElement.style.direction="rtl")},$B._focusIn=function(){laya.display.Input.isInputting=!0;var $B=this.nativeInput;this._focus=!0;var $_=$B.style;$_.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$B.readOnly=!this._editable,$u.isConchApp&&($B.setType(this._type),$B.setForbidEdit(!this._editable)),$B.maxLength=this._maxChars;this.padding;if($B.type=this._type,$B.value=this._content,$B.placeholder=this._prompt,$N.stage.off("keydown",this,this._onKeyDown),$N.stage.on("keydown",this,this._onKeyDown),($N.stage.focus=this).event("focus"),$K.onPC&&$B.focus(),!$K.onMiniGame){this._text;this._text=null}this.typeset(),$B.setColor(this._originColor),$B.setFontSize(this.fontSize),$B.setFontFace($K.onIPhone&&$rB._fontFamilyMap[this.font]||this.font),$u.isConchApp&&$B.setMultiAble&&$B.setMultiAble(this._multiline),$_.lineHeight=this.leading+this.fontSize+"px",$_.fontStyle=this.italic?"italic":"normal",$_.fontWeight=this.bold?"bold":"normal",$_.textAlign=this.align,$_.padding="0 0",this._syncInputTransform(),!$u.isConchApp&&$K.onPC&&$N.timer.frameLoop(1,this,this._syncInputTransform)},$B._setPromptColor=function(){($g.promptStyleDOM=$K.getElementById("promptStyle"))||(($g.promptStyleDOM=$K.createElement("style")).setAttribute("id","promptStyle"),$K.document.head.appendChild($g.promptStyleDOM)),$g.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$B._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($N.superSet($rB,this,"text",this._content),$N.superSet($rB,this,"color",this._originColor)):($N.superSet($rB,this,"text",this._prompt),$N.superSet($rB,this,"color",this._promptColor)),$N.stage.off("keydown",this,this._onKeyDown),$N.stage.focus=null,this.event("blur"),$u.isConchApp&&this.nativeInput.blur(),$K.onPC&&$N.timer.clear(this,this._syncInputTransform)},$B._onKeyDown=function($B){13===$B.keyCode&&($K.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$B.changeText=function($B){this._content=$B,this._focus?(this.nativeInput.value=$B||"",this.event("change")):$_.prototype.changeText.call(this,$B)},$T(0,$B,"color",$_.prototype._$get_color,function($B){this._focus&&this.nativeInput.setColor($B),$N.superSet($rB,this,"color",this._content?$B:this._promptColor),this._originColor=$B}),$T(0,$B,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($B){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$T(0,$B,"multiline",function(){return this._multiline},function($B){this._multiline=$B,this.valign=$B?"top":"middle"}),$T(0,$B,"maxChars",function(){return this._maxChars},function($B){$B<=0&&($B=1e5),this._maxChars=$B}),$T(0,$B,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($B){$N.superSet($rB,this,"color",this._originColor),$B+="",this._focus?(this.nativeInput.value=$B||"",this.event("change")):(this._multiline||($B=$B.replace(/\r?\n/g,"")),(this._content=$B)?$N.superSet($rB,this,"text",$B):($N.superSet($rB,this,"text",this._prompt),$N.superSet($rB,this,"color",this.promptColor)))}),$T(0,$B,"nativeInput",function(){return this._multiline?$g.area:$g.input}),$T(0,$B,"prompt",function(){return this._prompt},function($B){!this._text&&$B&&$N.superSet($rB,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$N.superSet($rB,this,"text",this._text==this._prompt?$B:this._text):$N.superSet($rB,this,"text",$B),this._prompt=$rB.langPacks&&$rB.langPacks[$B]?$rB.langPacks[$B]:$B}),$T(0,$B,"focus",function(){return this._focus},function($B){var $_=this.nativeInput;this._focus!==$B&&($B?($_.target?$_.target._focusOut():this._setInputMethod(),($_.target=this)._focusIn()):($_.target=null,this._focusOut(),$K.document.body.scrollTop=0,$_.blur(),$u.isConchApp?$_.setPos(-1e4,-1e4):$g.inputContainer.contains($_)&&$g.inputContainer.removeChild($_)))}),$T(0,$B,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($B){$B?(-1<($B="[^"+$B+"]").indexOf("^^")&&($B=$B.replace("^^","")),this._restrictPattern=new RegExp($B,"g")):this._restrictPattern=null}),$T(0,$B,"editable",function(){return this._editable},function($B){this._editable=$B,$u.isConchApp&&$g.input.setForbidEdit(!$B)}),$T(0,$B,"promptColor",function(){return this._promptColor},function($B){this._promptColor=$B,this._content||$N.superSet($rB,this,"color",$B)}),$T(0,$B,"type",function(){return this._type},function($B){this._getCSSStyle().password="password"==$B,this._type=$B,$u.isConchApp&&this.nativeInput.setType($B)}),$T(0,$B,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($B){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$T(0,$B,"asPassword",function(){return this._getCSSStyle().password},function($B){this._getCSSStyle().password=$B,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$g.__init__=function(){$g._createInputElement(),$K.onMobile&&$u.canvas.addEventListener($g.IOS_IFRAME?$K.onMiniGame?"touchend":"click":"touchend",$g._popupInputMethod)},$g._popupInputMethod=function($B){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$g._createInputElement=function(){$g._initInput($g.area=$K.createElement("textarea")),$g._initInput($g.input=$K.createElement("input")),($g.inputContainer=$K.createElement("div")).style.position="absolute",$g.inputContainer.style.zIndex=1e5,$K.container.appendChild($g.inputContainer),$g.inputContainer.setPos=function($B,$_){$g.inputContainer.style.left=$B+"px",$g.inputContainer.style.top=$_+"px"}},$g._initInput=function($_){var $B=$_.style;$B.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$B.resize="none",$B.backgroundColor="transparent",$B.border="none",$B.outline="none",$B.zIndex=1,$_.addEventListener("input",$g._processInputting),$_.addEventListener("mousemove",$g._stopEvent),$_.addEventListener("mousedown",$g._stopEvent),$_.addEventListener("touchmove",$g._stopEvent),$_.setFontFace=function($B){$_.style.fontFamily=$B},$u.isConchApp||($_.setColor=function($B){$_.style.color=$B},$_.setFontSize=function($B){$_.style.fontSize=$B+"px"})},$g._processInputting=function($B){var $_=laya.display.Input.inputElement.target;if($_){var $Z=laya.display.Input.inputElement.value;$_._restrictPattern&&($Z=$Z.replace(/\u2006|\x27/g,""),$_._restrictPattern.test($Z)&&($Z=$Z.replace($_._restrictPattern,""),laya.display.Input.inputElement.value=$Z)),$_._text=$Z,$_.event("input")}},$g._stopEvent=function($B){"touchmove"==$B.type&&$B.preventDefault(),$B.stopPropagation&&$B.stopPropagation()},$g.TYPE_TEXT="text",$g.TYPE_PASSWORD="password",$g.TYPE_EMAIL="email",$g.TYPE_URL="url",$g.TYPE_NUMBER="number",$g.TYPE_RANGE="range",$g.TYPE_DATE="date",$g.TYPE_MONTH="month",$g.TYPE_WEEK="week",$g.TYPE_TIME="time",$g.TYPE_DATE_TIME="datetime",$g.TYPE_DATE_TIME_LOCAL="datetime-local",$g.TYPE_SEARCH="search",$g.input=null,$g.area=null,$g.inputElement=null,$g.inputContainer=null,$g.confirmButton=null,$g.promptStyleDOM=null,$g.inputHeight=45,$g.isInputting=!1,$g.stageMatrix=null,$m($g,["IOS_IFRAME",function(){return this.IOS_IFRAME=$K.onIOS&&$K.window.top!=$K.window.self}]),$g}($rB),$JB=function($B){function $Z($B,$_){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$Z.__super.call(this),$B&&this._init_($B,$_)}$w($Z,"laya.resource.HTMLImage",$yB);var $_=$Z.prototype;return $_._init_=function($B,$_){this._src=$B,this._source=new $K.window.Image,$_&&($_.onload&&(this.onload=$_.onload),$_.onerror&&(this.onerror=$_.onerror),$_.onCreate&&$_.onCreate(this)),0!=$B.indexOf("data:image")&&(this._source.crossOrigin=""),$B&&(this._source.src=$B)},$_.recreateResource=function(){var $B=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $_=this;this._source=new $K.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($_._needReleaseAgain)return $_._needReleaseAgain=!1,$_._source.onload=null,void($_._source=null);$_._source.onload=null,$_.memorySize=$B._w*$B._h*4,$_._recreateLock=!1,$_.completeCreate()},this._source.src=this._src}},$_.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$_.onresize=function(){this._w=this._source.width,this._h=this._source.height},$T(0,$_,"onload",null,function($B){var $_=this;this._onload=$B,this._source&&(this._source.onload=null!=this._onload?function(){$_.onresize(),$_._onload()}:null)}),$T(0,$_,"onerror",null,function($B){var $_=this;this._onerror=$B,this._source&&(this._source.onerror=null!=this._onerror?function(){$_._onerror()}:null)}),$T(0,$_,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($B){this._enableMerageInAtlas=$B,$u.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$B)}),$Z.create=function($B,$_){return new $Z($B,$_)},$Z}(),$NB=(function($q){function $B(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$B.__super.call(this)}$w($B,"laya.display.EffectAnimation",$q);var $_=$B.prototype;$_._onOtherBegin=function($B){$B!=this&&this.stop()},$_.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$_._onPlayAction=function(){this.play(0,!1)},$_.play=function($B,$_,$Z,$n){void 0===$B&&($B=0),void 0===$_&&($_=!0),void 0===$Z&&($Z=""),void 0===$n&&($n=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$B,$_,$Z,$n))},$_._recordInitData=function(){if(this._aniKeys){var $B,$_,$Z=0;for($B=this._aniKeys.length,$Z=0;$Z<$B;$Z++)$_=this._aniKeys[$Z],this._initData[$_]=this._target[$_]}},$_._displayToIndex=function($B){if(this._animationData){$B<0&&($B=0),$B>this._count&&($B=this._count);var $_=this._animationData.nodes,$Z=0,$n=$_.length;for($n=1<$n?1:$n,$Z=0;$Z<$n;$Z++)this._displayNodeToFrame($_[$Z],$B)}},$_._displayNodeToFrame=function($B,$_,$Z){if(this._target){var $n;$n=this._target;var $g,$q,$P,$k,$m=$B.frames,$D=$B.keys,$T=0,$e=$D.length;$k=$B.secondFrames;var $I,$A,$$,$w,$r=0;for($T=0;$T<$e;$T++)$q=$m[$g=$D[$T]],$P=-1==($r=$k[$g])?this._initData[$g]:$_<$r?($$=($A=$B.keyframes[$g])[0]).tween?(null==($I=$h[$$.tweenMethod])&&($I=$h.linearNone),$w=$A[1],$I($_,this._initData[$g],$w.value-this._initData[$g],$w.index)):this._initData[$g]:$q.length>$_?$q[$_]:$q[$q.length-1],$n[$g]=$P}},$_._calculateNodeKeyFrames=function($B){$q.prototype._calculateNodeKeyFrames.call(this,$B);var $_,$Z,$n,$g=$B.keyframes;$B.target;for($_ in $n={},$B.secondFrames=$n,$g)($Z=$g[$_]).length<=1?$n[$_]=-1:$n[$_]=$Z[1].index},$T(0,$_,"target",function(){return this._target},function($B){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$B,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$T(0,$_,"playEvent",null,function($B){(this._playEvents=$B)&&this.addEvent()}),$T(0,$_,"effectData",null,function($B){var $_;$B&&(($_=$B.animations)&&$_[0]&&(this._setUp({},$_[0]),$_[0].nodes&&$_[0].nodes[0]&&(this._aniKeys=$_[0].nodes[0].keys)))}),$T(0,$_,"effectClass",null,function($B){var $_,$Z;(this._effectClass=$W.getClass($B),this._effectClass)&&(($_=this._effectClass.uiView)&&($Z=$_.animations)&&$Z[0]&&(this._setUp({},$Z[0]),$Z[0].nodes&&$Z[0].nodes[0]&&(this._aniKeys=$Z[0].nodes[0].keys)))}),$B.EffectAnimationBegin="effectanimationbegin"}($zB),function($_){var $l;function $L(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$L.__super.call(this)}$w($L,"laya.utils.GraphicAnimation",$_);var $B=$L.prototype;return $B._parseNodeList=function($B){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$B.compId]=$B.props,$B.compId&&this._nodeList.push($B.compId);var $_=$B.child;if($_){var $Z=0,$n=$_.length;for($Z=0;$Z<$n;$Z++)this._parseNodeList($_[$Z])}},$B._calGraphicData=function($B){var $_;if(this._setUp(null,$B),this._createGraphicData(),this._nodeIDAniDic)for($_ in this._nodeIDAniDic)this._nodeIDAniDic[$_]=null},$B._createGraphicData=function(){var $B,$_=[],$Z=0,$n=this.count,$g=this._animationNewFrames;for($g||($g=[]),$Z=0;$Z<$n;$Z++)!$g[$Z]&&$B||($B=this._createFrameGraphic($Z)),$_.push($B);this._gList=$_},$B._createFrameGraphic=function($B){var $_=$v.createGraphics();return $L._rootMatrix||($L._rootMatrix=new $V),this._updateNodeGraphic(this._rootNode,$B,$L._rootMatrix,$_),$_},$B._updateNodeGraphic=function($B,$_,$Z,$n,$g){var $q;void 0===$g&&($g=1);var $P,$k,$m,$D=($q=this._nodeGDic[$B.compId]=this._getNodeGraphicData($B.compId,$_,this._nodeGDic[$B.compId])).alpha*$g;if(!($D<.01)&&($q.resultTransform||($q.resultTransform=$V.create()),$P=$q.resultTransform,$V.mul($q.transform,$Z,$P),$q.skin&&($k=this._getTextureByUrl($q.skin))&&($P._checkTransform()?($n.drawTexture($k,0,0,$q.width,$q.height,$P,$D),$q.resultTransform=null):$n.drawTexture($k,$P.tx,$P.ty,$q.width,$q.height,null,$D)),$m=$B.child)){var $T,$e=0;for($T=$m.length,$e=0;$e<$T;$e++)this._updateNodeGraphic($m[$e],$_,$P,$n,$D)}},$B._updateNoChilds=function($B,$_){if($B.skin){var $Z=this._getTextureByUrl($B.skin);if($Z){var $n=$B.transform;$n._checkTransform();!$n.bTransform?$_.drawTexture($Z,$n.tx,$n.ty,$B.width,$B.height,null,$B.alpha):$_.drawTexture($Z,0,0,$B.width,$B.height,$n.clone(),$B.alpha)}}},$B._updateNodeGraphic2=function($B,$_,$Z){var $n;if($n=this._nodeGDic[$B.compId]=this._getNodeGraphicData($B.compId,$_,this._nodeGDic[$B.compId]),$B.child){var $g=$n.transform;$g._checkTransform();var $q,$P;$P=($q=!$g.bTransform)&&(0!=$g.tx||0!=$g.ty);var $k,$m,$D;if(($k=$g.bTransform||1!=$n.alpha)&&$Z.save(),1!=$n.alpha&&$Z.alpha($n.alpha),$q?$P&&$Z.translate($g.tx,$g.ty):$Z.transform($g.clone()),$m=$B.child,$n.skin&&($D=this._getTextureByUrl($n.skin))&&$Z.drawTexture($D,0,0,$n.width,$n.height),$m){var $T,$e=0;for($T=$m.length,$e=0;$e<$T;$e++)this._updateNodeGraphic2($m[$e],$_,$Z)}$k?$Z.restore():$q?$P&&$Z.translate(-$g.tx,-$g.ty):$Z.transform($g.clone().invert())}else this._updateNoChilds($n,$Z)},$B._calculateNodeKeyFrames=function($B){$_.prototype._calculateNodeKeyFrames.call(this,$B),this._nodeIDAniDic[$B.target]=$B},$B.getNodeDataByID=function($B){return this._nodeIDAniDic[$B]},$B._getParams=function($B,$_,$Z,$n){var $g=$L._temParam;$g.length=$_.length;var $q=0,$P=$_.length;for($q=0;$q<$P;$q++)$g[$q]=this._getObjVar($B,$_[$q][0],$Z,$_[$q][1],$n);return $g},$B._getObjVar=function($B,$_,$Z,$n,$g){if($B.hasOwnProperty($_)){var $q=$B[$_];if($Z>=$q.length&&($Z=$q.length-1),null!=$B[$_][$Z])return $B[$_][$Z]}return $g.hasOwnProperty($_)?$g[$_]:$n},$B._getNodeGraphicData=function($B,$_,$Z){$Z||($Z=$l.create()),$Z.transform?$Z.transform.identity():$Z.transform=$V.create();var $n=this.getNodeDataByID($B);if(!$n)return $Z;var $g,$q,$P=$n.frames,$k=this._getParams($P,$L._drawTextureCmd,$_,this._nodeDefaultProps[$B]),$m=$k[0],$D=NaN,$T=NaN,$e=$k[5],$I=$k[6],$A=$k[13],$$=$k[14],$w=$k[7],$r=$k[8],$j=$k[9],$y=$k[11],$C=$k[12];$D=$k[3],$T=$k[4],0!=$D&&0!=$T||($m=null),-1==$D&&($D=0),-1==$T&&($T=0),$Z.skin=$m,$Z.width=$D,$Z.height=$T,$m&&(($g=this._getTextureByUrl($m))?($D||($D=$g.sourceWidth),$T||($T=$g.sourceHeight)):console.warn("lost skin:",$m,",you may load pics first")),$Z.alpha=$k[10],$q=$Z.transform,0!=$A&&($e=$A*$D),0!=$$&&($I=$$*$T),0==$e&&0==$I||$q.translate(-$e,-$I);var $z=null;if($j||1!==$w||1!==$r||$y||$C){($z=$L._tempMt).identity(),$z.bTransform=!0;var $t=.0174532922222222*($j-$y),$J=.0174532922222222*($j+$C),$N=Math.cos($J),$Q=Math.sin($J),$M=Math.sin($t),$Y=Math.cos($t);$z.a=$w*$N,$z.b=$w*$Q,$z.c=-$r*$M,$z.d=$r*$Y,$z.tx=$z.ty=0}return $z&&($q=$V.mul($q,$z,$q)),$q.translate($k[1],$k[2]),$Z},$B._getTextureByUrl=function($B){return $kB.getRes($B)},$B.setAniData=function($B,$_){if($B.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$B,this._parseNodeList($B);var $Z,$n={},$g=[],$q=$B.animations,$P=0,$k=$q.length;for($P=0;$P<$k;$P++)if($Z=$q[$P],this._labels=null,(!$_||$_==$Z.name)&&$Z){try{this._calGraphicData($Z)}catch($B){console.warn("parse animation fail:"+$Z.name+",empty animation created"),this._gList=[]}var $m={};$m.interval=1e3/$Z.frameRate,$m.frames=this._gList,$m.labels=this._labels,$m.name=$Z.name,$g.push($m),$n[$Z.name]=$m}this.animationList=$g,this.animationDic=$n}$L._temParam.length=0},$B.parseByData=function($B){var $_,$Z;$_=$B.nodeRoot,$Z=$B.aniO,delete $B.nodeRoot,delete $B.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$_,this._parseNodeList($_),this._labels=null;try{this._calGraphicData($Z)}catch($B){console.warn("parse animation fail:"+$Z.name+",empty animation created"),this._gList=[]}var $n=$B;return $n.interval=1e3/$Z.frameRate,$n.frames=this._gList,$n.labels=this._labels,$n.name=$Z.name,$n},$B.setUpAniData=function($B){if($B.animations){var $_,$Z={},$n=[],$g=$B.animations,$q=0,$P=$g.length;for($q=0;$q<$P;$q++)if($_=$g[$q]){var $k={};$k.name=$_.name,$k.aniO=$_,$k.nodeRoot=$B,$n.push($k),$Z[$_.name]=$k}this.animationList=$n,this.animationDic=$Z}},$B._clear=function(){var $B,$_;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($B in this._nodeGDic)($_=this._nodeGDic[$B])&&$_.recover();this._nodeGDic=null},$L.parseAnimationByData=function($B){var $_;return $L._I||($L._I=new $L),$_=$L._I.parseByData($B),$L._I._clear(),$_},$L.parseAnimationData=function($B){var $_;return $L._I||($L._I=new $L),$L._I.setUpAniData($B),($_={}).animationList=$L._I.animationList,$_.animationDic=$L._I.animationDic,$L._I._clear(),$_},$L._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$L._temParam=[],$L._I=null,$L._rootMatrix=null,$m($L,["_tempMt",function(){return this._tempMt=new $V}]),$L.__init$=function(){$l=function(){function $B(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $w($B,""),$B.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$U.recover("GraphicNode",this)},$B.create=function(){return $U.getItemByClass("GraphicNode",$B)},$B}()},$L}($zB));$N.__init([$D,$mB,$u,$K,$O,$Y,$B,$NB])}(window,document,Laya),function($B,$_,$Z){$Z.un,$Z.uns,$Z.static;var $n=$Z.class;$Z.getset,$Z.__newvec;new(function(){function $B(){}return $n($B,"LayaMain"),$B}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($B,$_){"use strict";for(var $Z in Object.defineProperty($_,"__esModule",{value:!0}),Laya){var $n=Laya[$Z];$n&&$n.__isclass&&($_[$Z]=$n)}}),function($B,$_,$J){$J.un,$J.uns;var $P=$J.static,$I=$J.class,$n=$J.getset,$q=$J.__newvec,$T=laya.maths.Arith,$e=laya.maths.Bezier,$Z=laya.resource.Bitmap,$A=laya.utils.Browser,$m=laya.utils.Byte,$$=laya.utils.Color,$N=(laya.filters.ColorFilter,$J.Config),$g=laya.resource.Context,$Q=(laya.events.Event,laya.filters.Filter),$k=laya.display.Graphics,$D=laya.resource.HTMLCanvas,$w=(laya.utils.HTMLChar,laya.resource.HTMLImage),$r=laya.resource.HTMLSubImage,$M=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$Y=laya.maths.Point,$l=laya.maths.Rectangle,$j=laya.renders.Render,$y=(laya.renders.RenderContext,laya.renders.RenderSprite),$C=laya.resource.Resource,$z=laya.resource.ResourceManager,$t=laya.utils.RunDriver,$L=laya.display.Sprite,$v=laya.display.Stage,$V=laya.utils.Stat,$o=laya.utils.StringKey,$F=(laya.display.css.Style,laya.system.System),$u=laya.display.Text,$f=laya.resource.Texture,$b=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$x=laya.utils.VectorGraphManager;laya.utils.WordText;$J.interface("laya.webgl.shapes.IShape"),$J.interface("laya.webgl.submit.ISubmit"),$J.interface("laya.webgl.text.ICharSegment"),$J.interface("laya.webgl.canvas.save.ISaveData"),$J.interface("laya.webgl.resource.IMergeAtlasBitmap"),$J.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $p=function(){function $B(){}$I($B,"laya.filters.webgl.FilterActionGL");var $_=$B.prototype;return $J.imps($_,{"laya.filters.IFilterActionGL":!0}),$_.setValue=function($B){},$_.setValueMix=function($B){},$_.apply3d=function($B,$_,$Z,$n,$g){return null},$_.apply=function($B){return null},$n(0,$_,"typeMix",function(){return 0}),$B}(),$K=function(){function $B(){}return $I($B,"laya.webgl.shader.ShaderValue"),$B}(),$H=function(){var $n,$g;function $B($B,$_,$Z){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $g,void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),this._cells=null,this._rowInfo=null,this._init($B,$_),this._atlasID=$Z}$I($B,"laya.webgl.atlas.AtlasGrid");var $_=$B.prototype;return $_.getAltasID=function(){return this._atlasID},$_.setAltasID=function($B){0<=$B&&(this._atlasID=$B)},$_.addTex=function($B,$_,$Z){var $n=this._get($_,$Z);return 0==$n.ret||(this._fill($n.x,$n.y,$_,$Z,$B),this._texCount++),$n},$_._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$_._init=function($B,$_){if(this._width=$B,this._height=$_,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$q(this._height);for(var $Z=0;$Z<this._height;$Z++)this._rowInfo[$Z]=new $n;return this._clear(),!0},$_._get=function($B,$_){var $Z=new $W;if($B>=this._failSize.width&&$_>=this._failSize.height)return $Z;for(var $n=-1,$g=-1,$q=this._width,$P=this._height,$k=this._cells,$m=0;$m<$P;$m++)if(!(this._rowInfo[$m].spaceCount<$B))for(var $D=0;$D<$q;){var $T=3*($m*$q+$D);if(0!=$k[$T]||$k[1+$T]<$B||$k[2+$T]<$_)$D+=$k[1+$T];else{$n=$D,$g=$m;for(var $e=0;$e<$B;$e++)if($k[3*$e+$T+2]<$_){$n=-1;break}if(!($n<0))return $Z.ret=!0,$Z.x=$n,$Z.y=$g,$Z;$D+=$k[1+$T]}}return $Z},$_._fill=function($B,$_,$Z,$n,$g){var $q=this._width,$P=this._height;this._check($B+$Z<=$q&&$_+$n<=$P);for(var $k=$_;$k<$n+$_;++$k){this._check(this._rowInfo[$k].spaceCount>=$Z),this._rowInfo[$k].spaceCount-=$Z;for(var $m=0;$m<$Z;$m++){var $D=3*($B+$k*$q+$m);this._check(0==this._cells[$D]),this._cells[$D]=$g,this._cells[1+$D]=$Z,this._cells[2+$D]=$n}}if(0<$B)for($k=0;$k<$n;++$k){var $T=0;for($m=$B-1;0<=$m&&0==this._cells[3*(($_+$k)*$q+$m)];--$m,++$T);for($m=$T;0<$m;--$m)this._cells[3*(($_+$k)*$q+$B-$m)+1]=$m,this._check(0<$m)}if(0<$_)for($m=$B;$m<$B+$Z;++$m){for($T=0,$k=$_-1;0<=$k&&0==this._cells[3*($m+$k*$q)];--$k,$T++);for($k=$T;0<$k;--$k)this._cells[3*($m+($_-$k)*$q)+2]=$k,this._check(0<$k)}},$_._check=function($B){0==$B&&console.log("xtexMerger 错误啦")},$_._clear=function(){for(var $B=this._texCount=0;$B<this._height;$B++)this._rowInfo[$B].spaceCount=this._width;for(var $_=0;$_<this._height;$_++)for(var $Z=0;$Z<this._width;$Z++){var $n=3*($_*this._width+$Z);this._cells[$n]=0,this._cells[1+$n]=this._width-$Z,this._cells[2+$n]=this._width-$_}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$B.__init$=function(){$n=function(){function $B(){this.spaceCount=0}return $I($B,""),$B}(),$g=function(){function $B(){this.width=0,this.height=0}return $I($B,""),$B}()},$B}(),$G=function(){function $j($B,$_,$Z,$n){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$B,this._height=$_,this._gridSize=$Z,this._maxAtlaserCount=$n,this._gridNumX=$B/$Z,this._gridNumY=$_/$Z,this._curAtlasIndex=0,this._atlaserArray=[]}$I($j,"laya.webgl.atlas.AtlasResourceManager");var $B=$j.prototype;return $B.setAtlasParam=function($B,$_,$Z,$n){if(1==this._setAtlasParam)return $j._sid_=0,this._width=$B,this._height=$_,this._gridSize=$Z,this._maxAtlaserCount=$n,this._gridNumX=$B/$Z,this._gridNumY=$_/$Z,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$B.pushData=function($B){var $_,$Z=$B.bitmap,$n=-1,$g=null,$q=0,$P=0;for($q=0,$_=this._atlaserArray.length;$q<$_&&($P=(this._curAtlasIndex+$q)%$_,-1==($n=($g=this._atlaserArray[$P]).findBitmapIsExist($Z)));$q++);if(-1!=$n){var $k=$g.InAtlasWebGLImagesOffsetValue[$n];return $$=$k[0],$w=$k[1],$g.addToAtlas($B,$$,$w),!0}this._setAtlasParam=!1;for(var $m=Math.ceil(($B.bitmap.width+2)/this._gridSize),$D=Math.ceil(($B.bitmap.height+2)/this._gridSize),$T=!1,$e=0;$e<2;$e++){var $I=this._maxAtlaserCount;for($q=0;$q<$I;$q++){$P=(this._curAtlasIndex+$q)%$I,this._atlaserArray.length-1>=$P||this._atlaserArray.push(new $lB(this._gridNumX,this._gridNumY,this._width,this._height,$j._sid_++));var $A=this._atlaserArray[$P],$$=0,$w=0,$r=$A.addTex(1,$m,$D);if($r.ret){$$=$r.x*this._gridSize+1,$w=$r.y*this._gridSize+1,$Z.lock=!0,$A.addToAtlasTexture($Z,$$,$w),$A.addToAtlas($B,$$,$w),$T=!0,this._curAtlasIndex=$P;break}}if($T)break;this._atlaserArray.push(new $lB(this._gridNumX,this._gridNumY,this._width,this._height,$j._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $T||console.log(">>>AtlasManager pushData error"),$T},$B.addToAtlas=function($B){laya.webgl.atlas.AtlasResourceManager.instance.pushData($B)},$B.garbageCollection=function(){if(!0===this._needGC){for(var $B=this._atlaserArray.length-this._maxAtlaserCount,$_=0;$_<$B;$_++)this._atlaserArray[$_].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$B),this._atlaserArray.splice(0,$B),this._needGC=!1}return!0},$B.freeAll=function(){for(var $B=0,$_=this._atlaserArray.length;$B<$_;$B++)this._atlaserArray[$B].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$B.getAtlaserCount=function(){return this._atlaserArray.length},$B.getAtlaserByIndex=function($B){return this._atlaserArray[$B]},$n(1,$j,"instance",function(){return $j._Instance||($j._Instance=new $j(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$j._Instance}),$n(1,$j,"enabled",function(){return $N.atlasEnable}),$n(1,$j,"atlasLimitWidth",function(){return $j._atlasLimitWidth},function($B){$j._atlasLimitWidth=$B}),$n(1,$j,"atlasLimitHeight",function(){return $j._atlasLimitHeight},function($B){$j._atlasLimitHeight=$B}),$j._enable=function(){$N.atlasEnable=!0},$j._disable=function(){$N.atlasEnable=!1},$j.__init__=function(){$j.atlasTextureWidth=2048,$j.atlasTextureHeight=2048,$j.maxTextureCount=6,$j.atlasLimitWidth=512,$j.atlasLimitHeight=512},$j._atlasLimitWidth=0,$j._atlasLimitHeight=0,$j.gridSize=16,$j.atlasTextureWidth=0,$j.atlasTextureHeight=0,$j.maxTextureCount=0,$j._atlasRestore=0,$j.BOARDER_TYPE_NO=0,$j.BOARDER_TYPE_RIGHT=1,$j.BOARDER_TYPE_LEFT=2,$j.BOARDER_TYPE_BOTTOM=4,$j.BOARDER_TYPE_TOP=8,$j.BOARDER_TYPE_ALL=15,$j._sid_=0,$j._Instance=null,$j}(),$W=function(){function $B(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $I($B,"laya.webgl.atlas.MergeFillInfo"),$B}(),$X=function(){function $_(){}return $I($_,"laya.webgl.canvas.BlendMode"),$_._init_=function($B){$_.fns=[$_.BlendNormal,$_.BlendAdd,$_.BlendMultiply,$_.BlendScreen,$_.BlendOverlay,$_.BlendLight,$_.BlendMask,$_.BlendDestinationOut],$_.targetFns=[$_.BlendNormalTarget,$_.BlendAddTarget,$_.BlendMultiplyTarget,$_.BlendScreenTarget,$_.BlendOverlayTarget,$_.BlendLightTarget,$_.BlendMask,$_.BlendDestinationOut]},$_.BlendNormal=function($B){$B.blendFunc(1,771)},$_.BlendAdd=function($B){$B.blendFunc(1,772)},$_.BlendMultiply=function($B){$B.blendFunc(774,771)},$_.BlendScreen=function($B){$B.blendFunc(1,1)},$_.BlendOverlay=function($B){$B.blendFunc(1,769)},$_.BlendLight=function($B){$B.blendFunc(1,1)},$_.BlendNormalTarget=function($B){$B.blendFunc(1,771)},$_.BlendAddTarget=function($B){$B.blendFunc(1,772)},$_.BlendMultiplyTarget=function($B){$B.blendFunc(774,771)},$_.BlendScreenTarget=function($B){$B.blendFunc(1,1)},$_.BlendOverlayTarget=function($B){$B.blendFunc(1,769)},$_.BlendLightTarget=function($B){$B.blendFunc(1,1)},$_.BlendMask=function($B){$B.blendFunc(0,770)},$_.BlendDestinationOut=function($B){$B.blendFunc(0,0)},$_.activeBlendFunction=null,$_.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$_.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$_.NORMAL="normal",$_.ADD="add",$_.MULTIPLY="multiply",$_.SCREEN="screen",$_.LIGHT="light",$_.OVERLAY="overlay",$_.DESTINATIONOUT="destination-out",$_.fns=[],$_.targetFns=[],$_}(),$R=function(){function $Z($B){this._color=$$.create("black"),this.setValue($B)}$I($Z,"laya.webgl.canvas.DrawStyle");var $B=$Z.prototype;return $B.setValue=function($B){if($B){if("string"==typeof $B)return void(this._color=$$.create($B));if($B instanceof laya.utils.Color)return void(this._color=$B)}},$B.reset=function(){this._color=$$.create("black")},$B.equal=function($B){return"string"==typeof $B?this._color.strColor===$B:$B instanceof laya.utils.Color&&this._color.numColor===$B.numColor},$B.toColorStr=function(){return this._color.strColor},$Z.create=function($B){var $_;if($B&&("string"==typeof $B?$_=$$.create($B):$B instanceof laya.utils.Color&&($_=$B),$_))return $_._drawStyle||($_._drawStyle=new $Z($B));return laya.webgl.canvas.DrawStyle.DEFAULT},$P($Z,["DEFAULT",function(){return this.DEFAULT=new $Z("#000000")}]),$Z}(),$h=function(){function $B(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$zB.mainContext;this.ib=$cB.create(35048),this.vb=$EB.create(5)}$I($B,"laya.webgl.canvas.Path");var $_=$B.prototype;return $_.addPoint=function($B,$_){this.tempArray.push($B,$_)},$_.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$_.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$_.polygon=function($B,$_,$Z,$n,$g,$q){var $P;return this.geomatrys.push(this._curGeomatry=$P=new $oB($B,$_,$Z,$n,$g,$q)),$n||($P.fill=!1),null==$q&&($P.borderWidth=0),$P},$_.setGeomtry=function($B){this.geomatrys.push(this._curGeomatry=$B)},$_.drawLine=function($B,$_,$Z,$n,$g){var $q;return this.closePath?this.geomatrys.push(this._curGeomatry=$q=new $VB($B,$_,$Z,$n,$g)):this.geomatrys.push(this._curGeomatry=$q=new $vB($B,$_,$Z,$n,$g)),$q.fill=!1,$q},$_.update=function(){var $B=this.ib._byteLength,$_=this.geomatrys.length;this.offset=$B;for(var $Z=this.geoStart;$Z<$_;$Z++)this.geomatrys[$Z].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$_,this.count=(this.ib._byteLength-$B)/$wB.BYTES_PIDX},$_.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$_.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$B}(),$s=function(){function $k(){}$I($k,"laya.webgl.canvas.save.SaveBase");var $B=$k.prototype;return $J.imps($B,{"laya.webgl.canvas.save.ISaveData":!0}),$B.isSaveMark=function(){return!1},$B.restore=function($B){this._dataObj[this._valueName]=this._value,($k._cache[$k._cache._length++]=this)._newSubmit&&($B._curSubmit=$qB.RENDERBASE,$B._renderKey=0)},$k._createArray=function(){var $B=[];return $B._length=0,$B},$k._init=function(){var $B=$k._namemap={};return $B[1]="ALPHA",$B[2]="fillStyle",$B[8]="font",$B[256]="lineWidth",$B[512]="strokeStyle",$B[8192]="_mergeID",$B[1024]=$B[2048]=$B[4096]=[],$B[16384]="textBaseline",$B[32768]="textAlign",$B[65536]="_nBlendType",$B[1048576]="shader",$B[2097152]="filters",$B},$k.save=function($B,$_,$Z,$n){if(($B._saveMark._saveuse&$_)!==$_){$B._saveMark._saveuse|=$_;var $g=$k._cache,$q=0<$g._length?$g[--$g._length]:new $k;$q._value=$Z[$q._valueName=$k._namemap[$_]],$q._dataObj=$Z,$q._newSubmit=$n;var $P=$B._save;$P[$P._length++]=$q}},$k._cache=laya.webgl.canvas.save.SaveBase._createArray(),$k._namemap=$k._init(),$k}(),$U=function(){function $q(){this._clipRect=new $l}$I($q,"laya.webgl.canvas.save.SaveClipRect");var $B=$q.prototype;return $J.imps($B,{"laya.webgl.canvas.save.ISaveData":!0}),$B.isSaveMark=function(){return!1},$B.restore=function($B){$B._clipRect=this._clipSaveRect,($q._cache[$q._cache._length++]=this)._submitScissor.submitLength=$B._submits._length-this._submitScissor.submitIndex,$B._curSubmit=$qB.RENDERBASE,$B._renderKey=0},$q.save=function($B,$_){if(131072!=(131072&$B._saveMark._saveuse)){$B._saveMark._saveuse|=131072;var $Z=$q._cache,$n=0<$Z._length?$Z[--$Z._length]:new $q;$n._clipSaveRect=$B._clipRect,$B._clipRect=$n._clipRect.copyFrom($B._clipRect),$n._submitScissor=$_;var $g=$B._save;$g[$g._length++]=$n}},$P($q,["_cache",function(){return this._cache=$s._createArray()}]),$q}(),$S=function(){function $A(){this._contextX=0,this._contextY=0,this._clipRect=new $l,this._rect=new $l,this._matrix=new $M}$I($A,"laya.webgl.canvas.save.SaveClipRectStencil");var $B=$A.prototype;return $J.imps($B,{"laya.webgl.canvas.save.ISaveData":!0}),$B.isSaveMark=function(){return!1},$B.restore=function($B){$TB.restore($B,this._rect,this._saveMatrix,this._contextX,this._contextY),$B._clipRect=this._clipSaveRect,$B._curMat=this._saveMatrix,$B._x=this._contextX,$B._y=this._contextY,$A._cache[$A._cache._length++]=this,$B._curSubmit=$qB.RENDERBASE},$A.save=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){if(262144!=(262144&$B._saveMark._saveuse)){$B._saveMark._saveuse|=262144;var $T=$A._cache,$e=0<$T._length?$T[--$T._length]:new $A;$e._clipSaveRect=$B._clipRect,$e._clipRect.setTo($P,$k,$m,$D),$B._clipRect=$e._clipRect,$e._rect.x=$Z,$e._rect.y=$n,$e._rect.width=$g,$e._rect.height=$q,$e._contextX=$B._x,$e._contextY=$B._y,$e._saveMatrix=$B._curMat,$B._curMat.copyTo($e._matrix),$B._curMat=$e._matrix,$e._submitStencil=$_;var $I=$B._save;$I[$I._length++]=$e}},$P($A,["_cache",function(){return this._cache=$s._createArray()}]),$A}(),$O=function(){function $n(){this._saveuse=0}$I($n,"laya.webgl.canvas.save.SaveMark");var $B=$n.prototype;return $J.imps($B,{"laya.webgl.canvas.save.ISaveData":!0}),$B.isSaveMark=function(){return!0},$B.restore=function($B){$B._saveMark=this._preSaveMark,$n._no[$n._no._length++]=this},$n.Create=function($B){var $_=$n._no,$Z=0<$_._length?$_[--$_._length]:new $n;return $Z._saveuse=0,$Z._preSaveMark=$B._saveMark,$B._saveMark=$Z},$P($n,["_no",function(){return this._no=$s._createArray()}]),$n}(),$d=function(){function $q(){this._matrix=new $M}$I($q,"laya.webgl.canvas.save.SaveTransform");var $B=$q.prototype;return $J.imps($B,{"laya.webgl.canvas.save.ISaveData":!0}),$B.isSaveMark=function(){return!1},$B.restore=function($B){$B._curMat=this._savematrix,$q._no[$q._no._length++]=this},$q.save=function($B){var $_=$B._saveMark;if(2048!=(2048&$_._saveuse)){$_._saveuse|=2048;var $Z=$q._no,$n=0<$Z._length?$Z[--$Z._length]:new $q;$n._savematrix=$B._curMat,$B._curMat=$B._curMat.copyTo($n._matrix);var $g=$B._save;$g[$g._length++]=$n}},$P($q,["_no",function(){return this._no=$s._createArray()}]),$q}(),$a=function(){function $g(){}$I($g,"laya.webgl.canvas.save.SaveTranslate");var $B=$g.prototype;return $J.imps($B,{"laya.webgl.canvas.save.ISaveData":!0}),$B.isSaveMark=function(){return!1},$B.restore=function($B){$B._curMat;$B._x=this._x,$B._y=this._y,$g._no[$g._no._length++]=this},$g.save=function($B){var $_=$g._no,$Z=0<$_._length?$_[--$_._length]:new $g;$Z._x=$B._x,$Z._y=$B._y;var $n=$B._save;$n[$n._length++]=$Z},$P($g,["_no",function(){return this._no=$s._createArray()}]),$g}(),$i=function(){function $B(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $l}$I($B,"laya.webgl.resource.RenderTargetMAX");var $_=$B.prototype;return $_.setSP=function($B){this._sp=$B},$_.size=function($B,$_){var $Z=this;this._width!==$B||this._height!==$_?(this.repaint=!0,this._width=$B,this._height=$_,this.target?this.target.size($B,$_):this.target=$xB.create($B,$_),this.target.hasListener("recovered")||this.target.on("recovered",this,function($B){$J.timer.callLater($Z._sp,$Z._sp.repaint)})):this.target.size($B,$_)},$_._flushToTarget=function($B,$_){if(!$_._destroy){var $Z=$yB.worldScissorTest,$n=$yB.worldClipRect;$yB.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$yB.worldScissorTest=!1,$zB.mainContext.disable(3089);var $g=$yB.worldAlpha,$q=$yB.worldMatrix4,$P=$yB.worldMatrix,$k=$yB.worldFilters,$m=$yB.worldShaderDefines;if($yB.worldMatrix=$M.EMPTY,$yB.restoreTempArray(),$yB.worldMatrix4=$yB.TEMPMAT4_ARRAY,$yB.worldAlpha=1,$yB.worldFilters=null,$yB.worldShaderDefines=null,$bB.activeShader=null,$_.start(),$N.showCanvasMark?$_.clear(0,1,0,.3):$_.clear(0,0,0,0),$B.flush(),$_.end(),$bB.activeShader=null,$yB.worldAlpha=$g,$yB.worldMatrix4=$q,$yB.worldMatrix=$P,$yB.worldFilters=$k,$yB.worldShaderDefines=$m,$yB.worldScissorTest=$Z){var $D=$yB.height-$n.y-$n.height;$zB.mainContext.scissor($n.x,$D,$n.width,$n.height),$zB.mainContext.enable(3089)}$yB.worldClipRect=$n}},$_.flush=function($B){this.repaint&&(this._flushToTarget($B,this.target),this.repaint=!1)},$_.drawTo=function($B,$_,$Z,$n,$g){$B.drawTexture(this.target.getTexture(),$_,$Z,$n,$g,0,0)},$_.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$B}(),$c=function(){function $B(){this.ALPHA=1,this.shaderType=0,this.defines=new $LB}return $I($B,"laya.webgl.shader.d2.Shader2D"),$B.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$B.__init__=function(){var $B,$_;$OB.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$OB.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$OB.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$OB.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$OB.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$OB.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$OB.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$OB.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$B="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$_='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$OB.preCompile2D(0,1,$B,$_,null),$B="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$_='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$OB.preCompile2D(0,2,$B,$_,null),$B="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$_="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$OB.preCompile2D(0,4,$B,$_,null),$B="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$_='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$OB.preCompile2D(0,256,$B,$_,null),$B="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$_="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$OB.preCompile2D(0,512,$B,$_,null)},$B}(),$E=function(){function $_($B,$_,$Z){this._value=0,this._name2int=$B,this._int2name=$_,this._int2nameMap=$Z}$I($_,"laya.webgl.shader.ShaderDefines");var $B=$_.prototype;return $B.add=function($B){return"string"==typeof $B&&($B=this._name2int[$B]),this._value|=$B,this._value},$B.addInt=function($B){return this._value|=$B,this._value},$B.remove=function($B){return"string"==typeof $B&&($B=this._name2int[$B]),this._value&=~$B,this._value},$B.isDefine=function($B){return(this._value&$B)===$B},$B.getValue=function(){return this._value},$B.setValue=function($B){this._value=$B},$B.toNameDic=function(){var $B=this._int2nameMap[this._value];return $B||$_._toText(this._value,this._int2name,this._int2nameMap)},$_._reg=function($B,$_,$Z,$n){$n[$Z[$B]=$_]=$B},$_._toText=function($B,$_,$Z){var $n=$Z[$B];if($n)return $n;for(var $g={},$q=1,$P=0;$P<32&&!($B<($q=1<<$P));$P++)if($B&$q){var $k=$_[$q];$k&&($g[$k]="")}return $Z[$B]=$g},$_._toInt=function($B,$_){for(var $Z=$B.split("."),$n=0,$g=0,$q=$Z.length;$g<$q;$g++){var $P=$_[$Z[$g]];if(!$P)throw new Error("Defines to int err:"+$B+"/"+$Z[$g]);$n|=$P}return $n},$_}(),$BB=function(){function $P(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $M}$I($P,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $B=$P.prototype;return $B.init=function($B,$_,$Z){if($_)this._vs=$_;else{this._vs=[];var $n=$B.width,$g=$B.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($n,0,1,0,1,1,1,1),this._vs.push($n,$g,1,1,1,1,1,1),this._vs.push(0,$g,0,1,1,1,1,1)}$Z?this._ps=$Z:($P._defaultPS||($P._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$P._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$B},$B.init2=function($B,$_,$Z,$n,$g){this.transform&&(this.transform=null),$Z?this._ps=$Z:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$n,this._uvs=$g,this.mEleNum=this._ps.length,this.mTexture=$B,($j.isConchNode||$j.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$B._initMyData=function(){var $B=0,$_=0,$Z=4*this._verticles.length;this._vs=$P._tempVS;var $n=!1;if($j.isConchNode||$j.isConchApp?(this._vs.length=$Z,$n=!0):this._vs.length<$Z&&(this._vs.length=$Z,$n=!0),$P._tVSLen=$Z,$n)for(;$B<$Z;)this._vs[$B]=this._verticles[$_],this._vs[$B+1]=this._verticles[$_+1],this._vs[$B+2]=this._uvs[$_],this._vs[$B+3]=this._uvs[$_+1],this._vs[$B+4]=1,this._vs[$B+5]=1,this._vs[$B+6]=1,this._vs[$B+7]=1,$B+=8,$_+=2;else for(;$B<$Z;)this._vs[$B]=this._verticles[$_],this._vs[$B+1]=this._verticles[$_+1],this._vs[$B+2]=this._uvs[$_],this._vs[$B+3]=this._uvs[$_+1],$B+=8,$_+=2},$B.getData2=function($B,$_,$Z){var $n;this.mVBBuffer=$B,this.mIBBuffer=$_,this._initMyData(),$B.appendEx2(this._vs,Float32Array,$P._tVSLen,4),this._indexStart=$_._byteLength,($n=$P._tempIB).length<this._ps.length&&($n.length=this._ps.length);for(var $g=0,$q=this._ps.length;$g<$q;$g++)$n[$g]=this._ps[$g]+$Z;$_.appendEx2($n,Uint16Array,this._ps.length,2)},$B.getData=function($B,$_,$Z){if(this.mVBBuffer=$B,this.mIBBuffer=$_,$B.append(this.mVBData),this._indexStart=$_._byteLength,this.mIBData.start!=$Z){for(var $n=0,$g=this._ps.length;$n<$g;$n++)this.mIBData[$n]=this._ps[$n]+$Z;this.mIBData.start=$Z}$_.append(this.mIBData)},$B.render=function($B,$_,$Z){if($j.isWebGL&&this.mTexture){$B._renderKey=0,$B._shader2D.glTexture=null,$_B.getInstance().addSkinMesh(this);var $n=$qB.createShape($B,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$QB.create(512,0));this.transform||(this.transform=$M.EMPTY),this.transform.translate($_,$Z),$M.mul(this.transform,$B._curMat,this._tempMatrix),this.transform.translate(-$_,-$Z);var $g=$n.shaderValue,$q=$g.u_mmat2||$yB.getMatrArray();$yB.mat2MatArray(this._tempMatrix,$q),$g.textureHost=this.mTexture,$g.offsetX=0,$g.offsetY=0,$g.u_mmat2=$q,$g.ALPHA=$B._shader2D.ALPHA,$B._submits[$B._submits._length++]=$n}else $j.isConchApp&&this.mTexture&&(this.transform||(this.transform=$M.EMPTY),$B.setSkinMesh&&$B.setSkinMesh($_,$Z,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$P._tempVS=[],$P._tempIB=[],$P._defaultPS=null,$P._tVSLen=0,$P}(),$_B=function(){function $B(){this.ib=null,this.vb=null;$zB.mainContext;this.ib=$cB.create(35048),this.vb=$EB.create(8)}$I($B,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $_=$B.prototype;return $_.addSkinMesh=function($B){$B.getData2(this.vb,this.ib,this.vb._byteLength/32)},$_.reset=function(){this.vb.clear(),this.ib.clear()},$B.getInstance=function(){return $B.instance=$B.instance||new $B},$B.instance=null,$B}(),$ZB=function(){function $B($B,$_,$Z,$n,$g,$q,$P,$k,$m){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$m&&($m=0),this.x=$B,this.y=$_,this.width=$Z,this.height=$n,this.edges=$g,this.color=$q,this.borderWidth=$P,this.borderColor=$k}$I($B,"laya.webgl.shapes.BasePoly");var $_=$B.prototype;return $J.imps($_,{"laya.webgl.shapes.IShape":!0}),$_.getData=function($B,$_,$Z){},$_.rebuild=function($B){},$_.setMatrix=function($B){},$_.needUpdate=function($B){return!0},$_.sector=function($B,$_,$Z){var $n=this.x,$g=this.y,$q=this.edges,$P=(this.r1-this.r0)/$q,$k=this.width,$m=this.height,$D=this.color,$T=($D>>16&255)/255,$e=($D>>8&255)/255,$I=(255&$D)/255;$B.push($n,$g,$T,$e,$I);for(var $A=0;$A<$q+1;$A++)$B.push($n+Math.sin($P*$A+this.r0)*$k,$g+Math.cos($P*$A+this.r0)*$m),$B.push($T,$e,$I);for($A=0;$A<$q;$A++)$_.push($Z,$Z+$A+1,$Z+$A+2)},$_.createLine2=function($B,$_,$Z,$n,$g,$q){var $P,$k,$m,$D,$T,$e,$I,$A,$$,$w,$r,$j,$y,$C,$z,$t,$J,$N,$Q,$M,$Y=$B.concat(),$l=$g,$L=this.borderColor,$v=($L>>16&255)/255,$V=($L>>8&255)/255,$o=(255&$L)/255,$F=$Y.length/2,$u=$n,$f=$Z/2;$m=$Y[0],$D=$Y[1],$w=$m-($T=$Y[2]),$$=($$=-($D-($e=$Y[3])))/($M=Math.sqrt($$*$$+$w*$w))*$f,$w=$w/$M*$f,$l.push($m-$$+this.x,$D-$w+this.y,$v,$V,$o,$m+$$+this.x,$D+$w+this.y,$v,$V,$o);for(var $b=1;$b<$F-1;$b++)$m=$Y[2*($b-1)],$D=$Y[2*($b-1)+1],$T=$Y[2*$b],$e=$Y[2*$b+1],$I=$Y[2*($b+1)],$A=$Y[2*($b+1)+1],$w=$m-$T,$j=$T-$I,$z=(-($$=($$=-($D-$e))/($M=Math.sqrt($$*$$+$w*$w))*$f)+$m)*(-($w=$w/$M*$f)+$e)-(-$$+$T)*(-$w+$D),$N=(-($r=($r=-($e-$A))/($M=Math.sqrt($r*$r+$j*$j))*$f)+$I)*(-($j=$j/$M*$f)+$e)-(-$r+$T)*(-$j+$A),$Q=($y=-$w+$D-(-$w+$e))*($J=-$r+$T-(-$r+$I))-($t=-$j+$A-(-$j+$e))*($C=-$$+$T-(-$$+$m)),Math.abs($Q)<.1?($Q+=10.1,$l.push($T-$$+this.x,$e-$w+this.y,$v,$V,$o,$T+$$+this.x,$e+$w+this.y,$v,$V,$o)):((($P=($C*$N-$J*$z)/$Q)-$T)*($P-$T)+(($k=($t*$z-$y*$N)/$Q)-$e)+($k-$e),$l.push($P+this.x,$k+this.y,$v,$V,$o,$T-($P-$T)+this.x,$e-($k-$e)+this.y,$v,$V,$o));$m=$Y[$Y.length-4],$D=$Y[$Y.length-3],$w=$m-($T=$Y[$Y.length-2]),$$=($$=-($D-($e=$Y[$Y.length-1])))/($M=Math.sqrt($$*$$+$w*$w))*$f,$w=$w/$M*$f,$l.push($T-$$+this.x,$e-$w+this.y,$v,$V,$o,$T+$$+this.x,$e+$w+this.y,$v,$V,$o);var $x=$q;for($b=1;$b<$x;$b++)$_.push($u+2*($b-1),$u+2*($b-1)+1,$u+2*$b+1,$u+2*$b+1,$u+2*$b,$u+2*($b-1));return $l},$_.createLine=function($B,$_,$Z,$n){var $g=$B.concat(),$q=$B,$P=this.borderColor,$k=($P>>16&255)/255,$m=($P>>8&255)/255,$D=(255&$P)/255;$g.splice(0,5);var $T,$e,$I,$A,$$,$w,$r,$j,$y,$C,$z,$t,$J,$N,$Q,$M,$Y,$l,$L,$v,$V=$g.length/5,$o=$n,$F=$Z/2;$I=$g[0],$A=$g[1],$C=$I-($$=$g[5]),$y=($y=-($A-($w=$g[6])))/($v=Math.sqrt($y*$y+$C*$C))*$F,$C=$C/$v*$F,$q.push($I-$y,$A-$C,$k,$m,$D,$I+$y,$A+$C,$k,$m,$D);for(var $u=1;$u<$V-1;$u++)$I=$g[5*($u-1)],$A=$g[5*($u-1)+1],$$=$g[5*$u],$w=$g[5*$u+1],$r=$g[5*($u+1)],$j=$g[5*($u+1)+1],$C=$I-$$,$t=$$-$r,$Q=(-($y=($y=-($A-$w))/($v=Math.sqrt($y*$y+$C*$C))*$F)+$I)*(-($C=$C/$v*$F)+$w)-(-$y+$$)*(-$C+$A),$l=(-($z=($z=-($w-$j))/($v=Math.sqrt($z*$z+$t*$t))*$F)+$r)*(-($t=$t/$v*$F)+$w)-(-$z+$$)*(-$t+$j),$L=($J=-$C+$A-(-$C+$w))*($Y=-$z+$$-(-$z+$r))-($M=-$t+$j-(-$t+$w))*($N=-$y+$$-(-$y+$I)),Math.abs($L)<.1?($L+=10.1,$q.push($$-$y,$w-$C,$k,$m,$D,$$+$y,$w+$C,$k,$m,$D)):((($T=($N*$l-$Y*$Q)/$L)-$$)*($T-$$)+(($e=($M*$Q-$J*$l)/$L)-$w)+($e-$w),$q.push($T,$e,$k,$m,$D,$$-($T-$$),$w-($e-$w),$k,$m,$D));$I=$g[$g.length-10],$A=$g[$g.length-9],$C=$I-($$=$g[$g.length-5]),$y=($y=-($A-($w=$g[$g.length-4])))/($v=Math.sqrt($y*$y+$C*$C))*$F,$C=$C/$v*$F,$q.push($$-$y,$w-$C,$k,$m,$D,$$+$y,$w+$C,$k,$m,$D);var $f=this.edges+1;for($u=1;$u<$f;$u++)$_.push($o+2*($u-1),$o+2*($u-1)+1,$o+2*$u+1,$o+2*$u+1,$o+2*$u,$o+2*($u-1));return $q},$_.createLoopLine=function($B,$_,$Z,$n,$g,$q){var $P=$B.concat(),$k=$g||$B,$m=this.borderColor,$D=($m>>16&255)/255,$T=($m>>8&255)/255,$e=(255&$m)/255;$P.splice(0,5);var $I=[$P[0],$P[1]],$A=[$P[$P.length-5],$P[$P.length-4]],$$=$A[0]+.5*($I[0]-$A[0]),$w=$A[1]+.5*($I[1]-$A[1]);$P.unshift($$,$w,0,0,0),$P.push($$,$w,0,0,0);var $r,$j,$y,$C,$z,$t,$J,$N,$Q,$M,$Y,$l,$L,$v,$V,$o,$F,$u,$f,$b,$x=$P.length/5,$p=$n,$K=$Z/2;$y=$P[0],$C=$P[1],$M=$y-($z=$P[5]),$Q=($Q=-($C-($t=$P[6])))/($b=Math.sqrt($Q*$Q+$M*$M))*$K,$M=$M/$b*$K,$k.push($y-$Q,$C-$M,$D,$T,$e,$y+$Q,$C+$M,$D,$T,$e);for(var $H=1;$H<$x-1;$H++)$y=$P[5*($H-1)],$C=$P[5*($H-1)+1],$z=$P[5*$H],$t=$P[5*$H+1],$J=$P[5*($H+1)],$N=$P[5*($H+1)+1],$M=$y-$z,$l=$z-$J,$V=(-($Q=($Q=-($C-$t))/($b=Math.sqrt($Q*$Q+$M*$M))*$K)+$y)*(-($M=$M/$b*$K)+$t)-(-$Q+$z)*(-$M+$C),$u=(-($Y=($Y=-($t-$N))/($b=Math.sqrt($Y*$Y+$l*$l))*$K)+$J)*(-($l=$l/$b*$K)+$t)-(-$Y+$z)*(-$l+$N),$f=($L=-$M+$C-(-$M+$t))*($F=-$Y+$z-(-$Y+$J))-($o=-$l+$N-(-$l+$t))*($v=-$Q+$z-(-$Q+$y)),Math.abs($f)<.1?($f+=10.1,$k.push($z-$Q,$t-$M,$D,$T,$e,$z+$Q,$t+$M,$D,$T,$e)):((($r=($v*$u-$F*$V)/$f)-$z)*($r-$z)+(($j=($o*$V-$L*$u)/$f)-$t)+($j-$t),$k.push($r,$j,$D,$T,$e,$z-($r-$z),$t-($j-$t),$D,$T,$e));$q&&($_=$q);var $G=this.edges+1;for($H=1;$H<$G;$H++)$_.push($p+2*($H-1),$p+2*($H-1)+1,$p+2*$H+1,$p+2*$H+1,$p+2*$H,$p+2*($H-1));return $_.push($p+2*($H-1),$p+2*($H-1)+1,$p+1,$p+1,$p,$p+2*($H-1)),$k},$B}(),$nB=function(){function $w(){}return $I($w,"laya.webgl.shapes.Earcut"),$w.earcut=function($B,$_,$Z){$Z=$Z||2;var $n,$g,$q,$P,$k,$m,$D,$T=$_&&$_.length,$e=$T?$_[0]*$Z:$B.length,$I=$w.linkedList($B,0,$e,$Z,!0),$A=[];if(!$I)return $A;if($T&&($I=$w.eliminateHoles($B,$_,$I,$Z)),$B.length>80*$Z){$n=$q=$B[0],$g=$P=$B[1];for(var $$=$Z;$$<$e;$$+=$Z)($k=$B[$$])<$n&&($n=$k),($m=$B[$$+1])<$g&&($g=$m),$q<$k&&($q=$k),$P<$m&&($P=$m);$D=0!==($D=Math.max($q-$n,$P-$g))?1/$D:0}return $w.earcutLinked($I,$A,$Z,$n,$g,$D),$A},$w.linkedList=function($B,$_,$Z,$n,$g){var $q,$P;if($g===0<$w.signedArea($B,$_,$Z,$n))for($q=$_;$q<$Z;$q+=$n)$P=$w.insertNode($q,$B[$q],$B[$q+1],$P);else for($q=$Z-$n;$_<=$q;$q-=$n)$P=$w.insertNode($q,$B[$q],$B[$q+1],$P);return $P&&$w.equals($P,$P.next)&&($w.removeNode($P),$P=$P.next),$P},$w.filterPoints=function($B,$_){if(!$B)return $B;$_||($_=$B);var $Z,$n=$B;do{if($Z=!1,$n.steiner||!$w.equals($n,$n.next)&&0!==$w.area($n.prev,$n,$n.next))$n=$n.next;else{if($w.removeNode($n),($n=$_=$n.prev)===$n.next)break;$Z=!0}}while($Z||$n!==$_);return $_},$w.earcutLinked=function($B,$_,$Z,$n,$g,$q,$P){if($B){!$P&&$q&&$w.indexCurve($B,$n,$g,$q);for(var $k,$m,$D=$B;$B.prev!==$B.next;)if($k=$B.prev,$m=$B.next,$q?$w.isEarHashed($B,$n,$g,$q):$w.isEar($B))$_.push($k.i/$Z),$_.push($B.i/$Z),$_.push($m.i/$Z),$w.removeNode($B),$B=$m.next,$D=$m.next;else if(($B=$m)===$D){$P?1===$P?($B=$w.cureLocalIntersections($B,$_,$Z),$w.earcutLinked($B,$_,$Z,$n,$g,$q,2)):2===$P&&$w.splitEarcut($B,$_,$Z,$n,$g,$q):$w.earcutLinked($w.filterPoints($B,null),$_,$Z,$n,$g,$q,1);break}}},$w.isEar=function($B){var $_=$B.prev,$Z=$B,$n=$B.next;if(0<=$w.area($_,$Z,$n))return!1;for(var $g=$B.next.next;$g!==$B.prev;){if($w.pointInTriangle($_.x,$_.y,$Z.x,$Z.y,$n.x,$n.y,$g.x,$g.y)&&0<=$w.area($g.prev,$g,$g.next))return!1;$g=$g.next}return!0},$w.isEarHashed=function($B,$_,$Z,$n){var $g=$B.prev,$q=$B,$P=$B.next;if(0<=$w.area($g,$q,$P))return!1;for(var $k=$g.x<$q.x?$g.x<$P.x?$g.x:$P.x:$q.x<$P.x?$q.x:$P.x,$m=$g.y<$q.y?$g.y<$P.y?$g.y:$P.y:$q.y<$P.y?$q.y:$P.y,$D=$g.x>$q.x?$g.x>$P.x?$g.x:$P.x:$q.x>$P.x?$q.x:$P.x,$T=$g.y>$q.y?$g.y>$P.y?$g.y:$P.y:$q.y>$P.y?$q.y:$P.y,$e=$w.zOrder($k,$m,$_,$Z,$n),$I=$w.zOrder($D,$T,$_,$Z,$n),$A=$B.nextZ;$A&&$A.z<=$I;){if($A!==$B.prev&&$A!==$B.next&&$w.pointInTriangle($g.x,$g.y,$q.x,$q.y,$P.x,$P.y,$A.x,$A.y)&&0<=$w.area($A.prev,$A,$A.next))return!1;$A=$A.nextZ}for($A=$B.prevZ;$A&&$A.z>=$e;){if($A!==$B.prev&&$A!==$B.next&&$w.pointInTriangle($g.x,$g.y,$q.x,$q.y,$P.x,$P.y,$A.x,$A.y)&&0<=$w.area($A.prev,$A,$A.next))return!1;$A=$A.prevZ}return!0},$w.cureLocalIntersections=function($B,$_,$Z){var $n=$B;do{var $g=$n.prev,$q=$n.next.next;!$w.equals($g,$q)&&$w.intersects($g,$n,$n.next,$q)&&$w.locallyInside($g,$q)&&$w.locallyInside($q,$g)&&($_.push($g.i/$Z),$_.push($n.i/$Z),$_.push($q.i/$Z),$w.removeNode($n),$w.removeNode($n.next),$n=$B=$q),$n=$n.next}while($n!==$B);return $n},$w.splitEarcut=function($B,$_,$Z,$n,$g,$q){var $P=$B;do{for(var $k=$P.next.next;$k!==$P.prev;){if($P.i!==$k.i&&$w.isValidDiagonal($P,$k)){var $m=$w.splitPolygon($P,$k);return $P=$w.filterPoints($P,$P.next),$m=$w.filterPoints($m,$m.next),$w.earcutLinked($P,$_,$Z,$n,$g,$q),void $w.earcutLinked($m,$_,$Z,$n,$g,$q)}$k=$k.next}$P=$P.next}while($P!==$B)},$w.eliminateHoles=function($B,$_,$Z,$n){var $g,$q,$P,$k,$m,$D=[];for($g=0,$q=$_.length;$g<$q;$g++)$P=$_[$g]*$n,$k=$g<$q-1?$_[$g+1]*$n:$B.length,($m=$w.linkedList($B,$P,$k,$n,!1))===$m.next&&($m.steiner=!0),$D.push($w.getLeftmost($m));for($D.sort($w.compareX),$g=0;$g<$D.length;$g++)$w.eliminateHole($D[$g],$Z),$Z=$w.filterPoints($Z,$Z.next);return $Z},$w.compareX=function($B,$_){return $B.x-$_.x},$w.eliminateHole=function($B,$_){if($_=$w.findHoleBridge($B,$_)){var $Z=$w.splitPolygon($_,$B);$w.filterPoints($Z,$Z.next)}},$w.findHoleBridge=function($B,$_){var $Z,$n=$_,$g=$B.x,$q=$B.y,$P=-1/0;do{if($q<=$n.y&&$q>=$n.next.y&&$n.next.y!==$n.y){var $k=$n.x+($q-$n.y)*($n.next.x-$n.x)/($n.next.y-$n.y);if($k<=$g&&$P<$k){if(($P=$k)===$g){if($q===$n.y)return $n;if($q===$n.next.y)return $n.next}$Z=$n.x<$n.next.x?$n:$n.next}}$n=$n.next}while($n!==$_);if(!$Z)return null;if($g===$P)return $Z.prev;var $m,$D=$Z,$T=$Z.x,$e=$Z.y,$I=1/0;for($n=$Z.next;$n!==$D;)$g>=$n.x&&$n.x>=$T&&$g!==$n.x&&$w.pointInTriangle($q<$e?$g:$P,$q,$T,$e,$q<$e?$P:$g,$q,$n.x,$n.y)&&(($m=Math.abs($q-$n.y)/($g-$n.x))<$I||$m===$I&&$n.x>$Z.x)&&$w.locallyInside($n,$B)&&($Z=$n,$I=$m),$n=$n.next;return $Z},$w.indexCurve=function($B,$_,$Z,$n){for(var $g=$B;null===$g.z&&($g.z=$w.zOrder($g.x,$g.y,$_,$Z,$n)),$g.prevZ=$g.prev,$g.nextZ=$g.next,($g=$g.next)!==$B;);$g.prevZ.nextZ=null,$g.prevZ=null,$w.sortLinked($g)},$w.sortLinked=function($B){var $_,$Z,$n,$g,$q,$P,$k,$m,$D=1;do{for($Z=$B,$q=$B=null,$P=0;$Z;){for($P++,$n=$Z,$_=$k=0;$_<$D&&($k++,$n=$n.nextZ);$_++);for($m=$D;0<$k||0<$m&&$n;)0!==$k&&(0===$m||!$n||$Z.z<=$n.z)?($Z=($g=$Z).nextZ,$k--):($n=($g=$n).nextZ,$m--),$q?$q.nextZ=$g:$B=$g,$g.prevZ=$q,$q=$g;$Z=$n}$q.nextZ=null,$D*=2}while(1<$P);return $B},$w.zOrder=function($B,$_,$Z,$n,$g){return($B=1431655765&(($B=858993459&(($B=252645135&(($B=16711935&(($B=32767*($B-$Z)*$g)|$B<<8))|$B<<4))|$B<<2))|$B<<1))|($_=1431655765&(($_=858993459&(($_=252645135&(($_=16711935&(($_=32767*($_-$n)*$g)|$_<<8))|$_<<4))|$_<<2))|$_<<1))<<1},$w.getLeftmost=function($B){for(var $_=$B,$Z=$B;$_.x<$Z.x&&($Z=$_),($_=$_.next)!==$B;);return $Z},$w.pointInTriangle=function($B,$_,$Z,$n,$g,$q,$P,$k){return 0<=($g-$P)*($_-$k)-($B-$P)*($q-$k)&&0<=($B-$P)*($n-$k)-($Z-$P)*($_-$k)&&0<=($Z-$P)*($q-$k)-($g-$P)*($n-$k)},$w.isValidDiagonal=function($B,$_){return $B.next.i!==$_.i&&$B.prev.i!==$_.i&&!$w.intersectsPolygon($B,$_)&&$w.locallyInside($B,$_)&&$w.locallyInside($_,$B)&&$w.middleInside($B,$_)},$w.area=function($B,$_,$Z){return($_.y-$B.y)*($Z.x-$_.x)-($_.x-$B.x)*($Z.y-$_.y)},$w.equals=function($B,$_){return $B.x===$_.x&&$B.y===$_.y},$w.intersects=function($B,$_,$Z,$n){return!!($w.equals($B,$_)&&$w.equals($Z,$n)||$w.equals($B,$n)&&$w.equals($Z,$_))||0<$w.area($B,$_,$Z)!=0<$w.area($B,$_,$n)&&0<$w.area($Z,$n,$B)!=0<$w.area($Z,$n,$_)},$w.intersectsPolygon=function($B,$_){var $Z=$B;do{if($Z.i!==$B.i&&$Z.next.i!==$B.i&&$Z.i!==$_.i&&$Z.next.i!==$_.i&&$w.intersects($Z,$Z.next,$B,$_))return!0;$Z=$Z.next}while($Z!==$B);return!1},$w.locallyInside=function($B,$_){return $w.area($B.prev,$B,$B.next)<0?0<=$w.area($B,$_,$B.next)&&0<=$w.area($B,$B.prev,$_):$w.area($B,$_,$B.prev)<0||$w.area($B,$B.next,$_)<0},$w.middleInside=function($B,$_){for(var $Z=$B,$n=!1,$g=($B.x+$_.x)/2,$q=($B.y+$_.y)/2;$Z.y>$q!=$Z.next.y>$q&&$Z.next.y!==$Z.y&&$g<($Z.next.x-$Z.x)*($q-$Z.y)/($Z.next.y-$Z.y)+$Z.x&&($n=!$n),($Z=$Z.next)!==$B;);return $n},$w.splitPolygon=function($B,$_){var $Z=new $gB($B.i,$B.x,$B.y),$n=new $gB($_.i,$_.x,$_.y),$g=$B.next,$q=$_.prev;return($B.next=$_).prev=$B,($Z.next=$g).prev=$Z,($n.next=$Z).prev=$n,($q.next=$n).prev=$q,$n},$w.insertNode=function($B,$_,$Z,$n){var $g=new $gB($B,$_,$Z);return $n?($g.next=$n.next,($g.prev=$n).next.prev=$g,$n.next=$g):($g.prev=$g).next=$g,$g},$w.removeNode=function($B){$B.next.prev=$B.prev,$B.prev.next=$B.next,$B.prevZ&&($B.prevZ.nextZ=$B.nextZ),$B.nextZ&&($B.nextZ.prevZ=$B.prevZ)},$w.signedArea=function($B,$_,$Z,$n){for(var $g=0,$q=$_,$P=$Z-$n;$q<$Z;$q+=$n)$g+=($B[$P]-$B[$q])*($B[$q+1]+$B[$P+1]),$P=$q;return $g},$w}(),$gB=function(){function $B($B,$_,$Z){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$B,this.x=$_,this.y=$Z,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $I($B,"laya.webgl.shapes.EarcutNode"),$B}(),$qB=(function(){function $B($B,$_,$Z,$n,$g,$q,$P){this.lineWidth=$B,this.lineColor=$_,this.lineAlpha=$Z,this.fillColor=$n,this.fillAlpha=$g,this.shape=$P,this.fill=$q}$I($B,"laya.webgl.shapes.GeometryData");var $_=$B.prototype;$_.clone=function(){return new $B(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$_.getIndexData=function(){return null},$_.getVertexData=function(){return null},$_.destroy=function(){this.shape=null}}(),function(){function $B($B){if($B instanceof Float32Array)this.points=$B;else if($B instanceof Array){$B.length;this.points=new Float32Array($B)}}$I($B,"laya.webgl.shapes.Vertex");var $_=$B.prototype;$J.imps($_,{"laya.webgl.shapes.IShape":!0}),$_.getData=function($B,$_,$Z){},$_.needUpdate=function($B){return!1},$_.rebuild=function($B){},$_.setMatrix=function($B){}}(),function(){function $m($B){void 0===$B&&($B=1e4),this._renderType=$B}$I($m,"laya.webgl.submit.Submit");var $B=$m.prototype;return $J.imps($B,{"laya.webgl.submit.ISubmit":!0}),$B.releaseRender=function(){var $B=$m._cache;($B[$B._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$B.getRenderType=function(){return this._renderType},$B.renderSubmit=function(){if(0===this._numEle)return 1;var $B=this.shaderValue.textureHost;if($B){var $_=$B.source;if(!$B.bitmap||!$_)return 1;this.shaderValue.texture=$_,$B.alphaTexture&&$B.alphaTexture.source&&(this.shaderValue.texture1=$B.alphaTexture.source)}this._vb.bind_upload(this._ib);var $Z=$zB.mainContext;return this.shaderValue.upload(),$X.activeBlendFunction!==this._blendFn&&($Z.enable(3042),this._blendFn($Z),$X.activeBlendFunction=this._blendFn),$V.drawCall++,$V.trianglesFaces+=this._numEle/3,$Z.drawElements(4,this._numEle,5123,this._startIdx),1},$m.__init__=function(){var $B=$m.RENDERBASE=new $m(-1);$B.shaderValue=new $QB(0,0),$B.shaderValue.ALPHA=-1234},$m.createSubmit=function($B,$_,$Z,$n,$g){var $q=$m._cache._length?$m._cache[--$m._cache._length]:new $m;null==$Z&&(($Z=$q._selfVb||($q._selfVb=$EB.create(-1))).clear(),$n=0),$q._ib=$_,$q._vb=$Z,$q._startIdx=$n*$wB.BYTES_PIDX,$q._numEle=0;var $P=$B._nBlendType;$q._blendFn=$B._targets?$X.targetFns[$P]:$X.fns[$P],$q.shaderValue=$g,$q.shaderValue.setValue($B._shader2D);var $k=$B._shader2D.filters;return $k&&$q.shaderValue.setFilters($k),$q},$m.createShape=function($B,$_,$Z,$n,$g,$q){var $P=$m._cache._length?$m._cache[--$m._cache._length]:new $m;$P._ib=$_,$P._vb=$Z,$P._numEle=$n,$P._startIdx=$g,$P.shaderValue=$q,$P.shaderValue.setValue($B._shader2D);var $k=$B._nBlendType;return $P._blendFn=$B._targets?$X.targetFns[$k]:$X.fns[$k],$P},$m.TYPE_2D=1e4,$m.TYPE_CANVAS=10003,$m.TYPE_CMDSETRT=10004,$m.TYPE_CUSTOM=10005,$m.TYPE_BLURRT=10006,$m.TYPE_CMDDESTORYPRERT=10007,$m.TYPE_DISABLESTENCIL=10008,$m.TYPE_OTHERIBVB=10009,$m.TYPE_PRIMITIVE=10010,$m.TYPE_RT=10011,$m.TYPE_BLUR_RT=10012,$m.TYPE_TARGET=10013,$m.TYPE_CHANGE_VALUE=10014,$m.TYPE_SHAPE=10015,$m.TYPE_TEXTURE=10016,$m.TYPE_FILLTEXTURE=10017,$m.RENDERBASE=null,$m._cache=(($m._cache=[])._length=0,$m._cache),$m}()),$PB=function(){function $n(){this.fun=null,this.args=null}$I($n,"laya.webgl.submit.SubmitCMD");var $B=$n.prototype;return $J.imps($B,{"laya.webgl.submit.ISubmit":!0}),$B.renderSubmit=function(){return this.fun.apply(null,this.args),1},$B.getRenderType=function(){return 0},$B.releaseRender=function(){var $B=$n._cache;$B[$B._length++]=this},$n.create=function($B,$_){var $Z=$n._cache._length?$n._cache[--$n._cache._length]:new $n;return $Z.fun=$_,$Z.args=$B,$Z},$n._cache=(($n._cache=[])._length=0,$n._cache),$n}(),$kB=function(){function $_(){this.variables={}}$I($_,"laya.webgl.submit.SubmitCMDScope");var $B=$_.prototype;return $B.getValue=function($B){return this.variables[$B]},$B.addValue=function($B,$_){return this.variables[$B]=$_},$B.setValue=function($B,$_){return this.variables.hasOwnProperty($B)?this.variables[$B]=$_:null},$B.clear=function(){for(var $B in this.variables)delete this.variables[$B]},$B.recycle=function(){this.clear(),$_.POOL.push(this)},$_.create=function(){var $B=$_.POOL.pop();return $B||($B=new $_),$B},$_.POOL=[],$_}(),$mB=function(){function $e(){this.offset=0,this.startIndex=0,this._mat=$M.create()}$I($e,"laya.webgl.submit.SubmitOtherIBVB");var $B=$e.prototype;return $J.imps($B,{"laya.webgl.submit.ISubmit":!0}),$B.releaseRender=function(){var $B=$e._cache;($B[$B._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$B.getRenderType=function(){return 10009},$B.renderSubmit=function(){var $B=this._shaderValue.textureHost;if($B){var $_=$B.source;if(!$B.bitmap||!$_)return 1;this._shaderValue.texture=$_}this._vb.bind_upload(this._ib);var $Z=$yB.worldMatrix4,$n=$M.TEMP;$M.mulPre(this._mat,$Z[0],$Z[1],$Z[4],$Z[5],$Z[12],$Z[13],$n);var $g=$yB.worldMatrix4=$e.tempMatrix4;$g[0]=$n.a,$g[1]=$n.b,$g[4]=$n.c,$g[5]=$n.d,$g[12]=$n.tx,$g[13]=$n.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $q=$zB.mainContext;return $X.activeBlendFunction!==this._blendFn&&($q.enable(3042),this._blendFn($q),$X.activeBlendFunction=this._blendFn),$V.drawCall++,$V.trianglesFaces+=this._numEle/3,$q.drawElements(4,this._numEle,5123,this.startIndex),$yB.worldMatrix4=$Z,$bB.activeShader=null,1},$e.create=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){void 0===$m&&($m=0);var $D=$e._cache._length?$e._cache[--$e._cache._length]:new $e;$D._ib=$Z,$D._vb=$_,$D._numEle=$n,$D._shader=$g,$D._shaderValue=$q;var $T=$B._nBlendType;switch($D._blendFn=$B._targets?$X.targetFns[$T]:$X.fns[$T],$m){case 0:$D.offset=0,$D.startIndex=$k/($wB.BYTES_PE*$_.vertexStride)*1.5,$D.startIndex*=$wB.BYTES_PIDX;break;case 1:$D.startIndex=$P,$D.offset=$k}return $D},$e._cache=(($e._cache=[])._length=0,$e._cache),$e.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$e}(),$DB=function(){function $Z(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $l,this.screenRect=new $l}$I($Z,"laya.webgl.submit.SubmitScissor");var $B=$Z.prototype;return $J.imps($B,{"laya.webgl.submit.ISubmit":!0}),$B._scissor=function($B,$_,$Z,$n){var $g=$yB.worldMatrix4,$q=$g[0],$P=$g[5],$k=$g[12],$m=$g[13];if($n*=$P,($Z*=$q)<1||$n<1)return!1;var $D=($B=$B*$q+$k)+$Z,$T=($_=$_*$P+$m)+$n;$B<0&&($Z=$D-($B=0)),$_<0&&($n=$T-($_=0));var $e=$yB.worldClipRect;if($B=Math.max($B,$e.x),$_=Math.max($_,$e.y),$Z=Math.min($D,$e.right)-$B,$n=Math.min($T,$e.bottom)-$_,$Z<1||$n<1)return!1;var $I=$yB.worldScissorTest;return this.screenRect.copyFrom($e),$e.x=$B,$e.y=$_,$e.width=$Z,$e.height=$n,$yB.worldScissorTest=!0,$_=$yB.height-$_-$n,$zB.mainContext.scissor($B,$_,$Z,$n),$zB.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$I?($_=$yB.height-this.screenRect.y-this.screenRect.height,$zB.mainContext.scissor(this.screenRect.x,$_,this.screenRect.width,this.screenRect.height),$zB.mainContext.enable(3089)):($zB.mainContext.disable(3089),$yB.worldScissorTest=!1),$e.copyFrom(this.screenRect),!0},$B._scissorWithTagart=function($B,$_,$Z,$n){if($Z<1||$n<1)return!1;var $g=$B+$Z,$q=$_+$n;$B<0&&($Z=$g-($B=0)),$_<0&&($n=$q-($_=0));var $P=$yB.worldClipRect;if($B=Math.max($B,$P.x),$_=Math.max($_,$P.y),$Z=Math.min($g,$P.right)-$B,$n=Math.min($q,$P.bottom)-$_,$Z<1||$n<1)return!1;var $k=$yB.worldScissorTest;return this.screenRect.copyFrom($P),$yB.worldScissorTest=!0,$P.x=$B,$P.y=$_,$P.width=$Z,$P.height=$n,$_=$yB.height-$_-$n,$zB.mainContext.scissor($B,$_,$Z,$n),$zB.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$k?($_=$yB.height-this.screenRect.y-this.screenRect.height,$zB.mainContext.scissor(this.screenRect.x,$_,this.screenRect.width,this.screenRect.height),$zB.mainContext.enable(3089)):($zB.mainContext.disable(3089),$yB.worldScissorTest=!1),$P.copyFrom(this.screenRect),!0},$B.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$B.getRenderType=function(){return 0},$B.releaseRender=function(){var $B=$Z._cache;($B[$B._length++]=this).context=null},$Z.create=function($B){var $_=$Z._cache._length?$Z._cache[--$Z._cache._length]:new $Z;return $_.context=$B,$_},$Z._cache=(($Z._cache=[])._length=0,$Z._cache),$Z}(),$TB=function(){function $m(){this.step=0,this.blendMode=null,this.level=0}$I($m,"laya.webgl.submit.SubmitStencil");var $B=$m.prototype;return $J.imps($B,{"laya.webgl.submit.ISubmit":!0}),$B.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$B.getRenderType=function(){return 0},$B.releaseRender=function(){var $B=$m._cache;$B[$B._length++]=this},$B.do1=function(){var $B=$zB.mainContext;$B.enable(2960),$B.clear(1024),$B.colorMask(!1,!1,!1,!1),$B.stencilFunc(514,this.level,255),$B.stencilOp(7680,7680,7682)},$B.do2=function(){var $B=$zB.mainContext;$B.stencilFunc(514,this.level+1,255),$B.colorMask(!0,!0,!0,!0),$B.stencilOp(7680,7680,7680)},$B.do3=function(){var $B=$zB.mainContext;$B.colorMask(!0,!0,!0,!0),$B.stencilOp(7680,7680,7680),$B.clear(1024),$B.disable(2960)},$B.do4=function(){var $B=$zB.mainContext;0==this.level&&($B.enable(2960),$B.clear(1024)),$B.colorMask(!1,!1,!1,!1),$B.stencilFunc(519,0,255),$B.stencilOp(7680,7680,7682)},$B.do5=function(){var $B=$zB.mainContext;$B.stencilFunc(514,this.level,255),$B.colorMask(!0,!0,!0,!0),$B.stencilOp(7680,7680,7680)},$B.do6=function(){var $B=$zB.mainContext;$X.targetFns[$X.TOINT[this.blendMode]]($B)},$B.do7=function(){var $B=$zB.mainContext;$B.colorMask(!1,!1,!1,!1),$B.stencilOp(7680,7680,7683)},$B.do8=function(){var $B=$zB.mainContext;$B.colorMask(!0,!0,!0,!0),$B.stencilFunc(514,this.level,255),$B.stencilOp(7680,7680,7680)},$m.restore=function($B,$_,$Z,$n,$g){var $q;if(($B._renderKey=0)<$m._mask&&$m._mask--,0==$m._mask)$q=laya.webgl.submit.SubmitStencil.create(3),$B.addRenderObject($q),$B._curSubmit=$qB.RENDERBASE;else{$q=laya.webgl.submit.SubmitStencil.create(7),$B.addRenderObject($q);var $P=$B._vb;$P._byteLength;if($rB.fillRectImgVb($P,null,$_.x,$_.y,$_.width,$_.height,$f.DEF_UV,$Z,$n,$g,0,0)){$B._shader2D.glTexture=null;var $k=$B._curSubmit=$qB.createSubmit($B,$B._ib,$P,($P._byteLength-64)/32*3,$QB.create(2,0));$k.shaderValue.ALPHA=1,$B._submits[$B._submits._length++]=$k,$B._curSubmit._numEle+=6,$B._curSubmit=$qB.RENDERBASE}else alert("clipRect calc stencil rect error");$q=laya.webgl.submit.SubmitStencil.create(8),$B.addRenderObject($q)}},$m.restore2=function($B,$_){var $Z;($B._renderKey=0)<$m._mask&&$m._mask--,0==$m._mask?($Z=laya.webgl.submit.SubmitStencil.create(3),$B.addRenderObject($Z),$B._curSubmit=$qB.RENDERBASE):($Z=laya.webgl.submit.SubmitStencil.create(7),$B.addRenderObject($Z),$B._submits[$B._submits._length++]=$_,$Z=laya.webgl.submit.SubmitStencil.create(8),$B.addRenderObject($Z))},$m.create=function($B){var $_=$m._cache._length?$m._cache[--$m._cache._length]:new $m;return 5==($_.step=$B)&&++$m._mask,$_.level=$m._mask,$_},$m._cache=(($m._cache=[])._length=0,$m._cache),$m._mask=0,$m}(),$eB=function(){function $k(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$I($k,"laya.webgl.submit.SubmitTarget");var $B=$k.prototype;return $J.imps($B,{"laya.webgl.submit.ISubmit":!0}),$B.renderSubmit=function(){this._vb.bind_upload(this._ib);var $B=this.scope.getValue(this.proName);return $B&&(this.shaderValue.texture=$B.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$B.width,$B.height]),this.shaderValue.upload(),this.blend(),$V.drawCall++,$V.trianglesFaces+=this._numEle/3,$zB.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$B.blend=function(){if($X.activeBlendFunction!==$X.fns[this.blendType]){var $B=$zB.mainContext;$B.enable(3042),$X.fns[this.blendType]($B),$X.activeBlendFunction=$X.fns[this.blendType]}},$B.getRenderType=function(){return 0},$B.releaseRender=function(){var $B=$k._cache;($B[$B._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$k.create=function($B,$_,$Z,$n,$g,$q){var $P=$k._cache._length?$k._cache[--$k._cache._length]:new $k;return $P._ib=$_,$P._vb=$Z,$P.proName=$q,$P._startIdx=$n*$wB.BYTES_PIDX,$P._numEle=0,$P.blendType=$B._nBlendType,$P.shaderValue=$g,$P.shaderValue.setValue($B._shader2D),$P},$k._cache=(($k._cache=[])._length=0,$k._cache),$k}(),$IB=function(){function $B(){this._sourceStr=null}$I($B,"laya.webgl.text.CharSegment");var $_=$B.prototype;return $J.imps($_,{"laya.webgl.text.ICharSegment":!0}),$_.textToSpit=function($B){this._sourceStr=$B},$_.getChar=function($B){return this._sourceStr.charAt($B)},$_.getCharCode=function($B){return this._sourceStr.charCodeAt($B)},$_.length=function(){return this._sourceStr.length},$B}(),$AB=function(){var $B;function $V(){}return $I($V,"laya.webgl.text.DrawText"),$V.__init__=function(){$V._charsTemp=new Array,$V._drawValue=new $B,$V._charSeg=new $IB},$V.customCharSeg=function($B){$V._charSeg=$B},$V.getChar=function($B,$_,$Z){var $n=$sB.createOneChar($B,$Z);return-1!=$_&&($V._charsCache[$_]=$n),$n},$V._drawSlow=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e,$I,$A,$$){var $w,$r,$j=$V._drawValue.value($q,$k,$m,$D,$I,$A,$$),$y=0,$C=0,$z=$V._charsTemp,$t=0,$J=NaN;if($n)for($z.length=$n.length,$y=0,$C=$n.length;$y<$C;$y++)($r=$n[$y])&&($J=$r.charNum+$j.txtID,$z[$y]=$w=$V._charsCache[$J]||$V.getChar($r.char,$J,$j),$w.active());else{var $N=$Z instanceof laya.utils.WordText?$Z.toString():$Z;if($u.CharacterCache){$V._charSeg.textToSpit($N);var $Q=$V._charSeg.length();for($y=0,$C=$z.length=$Q;$y<$C;$y++)$J=$V._charSeg.getCharCode($y)+$j.txtID,$z[$y]=$w=$V._charsCache[$J]||$V.getChar($V._charSeg.getChar($y),$J,$j),$w.active(),$t+=$w.cw}else $z.length=0,($w=$V.getChar($N,-1,$j)).active(),$t+=$w.cw,$z[0]=$w}var $M=0;null!==$P&&"left"!==$P&&($M=-("center"==$P?$t/2:$t));var $Y,$l,$L=NaN,$v=0;if($n)for($y=0,$C=$z.length;$y<$C;$y++)$w=$z[$y],$r=$n[$y],$w&&$r&&!$w.isSpace&&($L=$w.borderSize,$Y=$w.texture,$_._drawText($Y,$T+$M+$r.x*$I-$L,$e+$r.y*$A-$L,$Y.width,$Y.height,$g,0,0,0,0));else{for($y=0,$C=$z.length;$y<$C;$y++)($w=$z[$y])&&!$w.isSpace&&($L=$w.borderSize,$Y=$w.texture,$_._drawText($Y,$T+$M-$L,$e-$L,$Y.width,$Y.height,$g,0,0,0,0),$B&&(($l=$B[$v++])||($l=$B[$v-1]=[]),$l[0]=$Y,$l[1]=$M-$L,$l[2]=-$L)),$M+=$w.cw;$B&&($B.length=$v)}},$V._drawFast=function($B,$_,$Z,$n,$g){for(var $q,$P,$k=0,$m=$B.length;$k<$m;$k++)($q=($P=$B[$k])[0]).active(),$_._drawText($q,$n+$P[1],$g+$P[2],$q.width,$q.height,$Z,0,0,0,0)},$V.drawText=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e){if(void 0===$e&&($e=0),!($_&&0===$_.length||$Z&&0===$Z.length)){var $I=$n.a,$A=$n.d;(0!==$n.b||0!==$n.c)&&($I=$A=1);var $$=1!==$I||1!==$A;if($$&&$J.stage.transform){var $w=$J.stage.transform;$$=$w.a===$I&&$w.d===$A}else $$=!1;if($$){var $r=($n=$n.copyTo($NB._tmpMatrix)).tx,$j=$n.ty;$n.scale(1/$I,1/$A),$n._checkTransform(),$D*=$I,$T*=$A,$D+=$r-$n.tx,$T+=$j-$n.ty}else $I=$A=1;if($Z)$V._drawSlow(null,$B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$I,$A,$e);else{if(null===$_.toUpperCase){var $y=$I+1e5*$A,$C=$_;return void($C.changed||$C.id!==$y?($C.id=$y,$C.changed=!1,$V._drawSlow($C.save,$B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$I,$A,$e)):$V._drawFast($C.save,$B,$n,$D,$T))}var $z=$_+$g.toString()+$P+$k+$m+$I+$A+$q,$t=$V._textsCache[$z];$u.CharacterCache?$t?$V._drawFast($t,$B,$n,$D,$T):($V._textsCache.__length||($V._textsCache.__length=0),$V._textsCache.__length>$N.WebGLTextCacheCount&&(($V._textsCache={}).__length=0,$V._curPoolIndex=0),$V._textCachesPool[$V._curPoolIndex]?($t=$V._textsCache[$z]=$V._textCachesPool[$V._curPoolIndex]).length=0:$V._textCachesPool[$V._curPoolIndex]=$t=$V._textsCache[$z]=[],$V._textsCache.__length++,$V._curPoolIndex++,$V._drawSlow($t,$B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$I,$A,$e)):$V._drawSlow($t,$B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$I,$A,$e)}}},$V._charsTemp=null,$V._textCachesPool=[],$V._curPoolIndex=0,$V._charsCache={},$V._textsCache={},$V._drawValue=null,$V.d=[],$V._charSeg=null,$V.__init$=function(){$B=function(){function $m(){}return $I($m,""),$m.prototype.value=function($B,$_,$Z,$n,$g,$q,$P){this.font=$B,this.fillColor=$_,this.borderColor=$Z,this.lineWidth=$n,this.scaleX=$g,this.scaleY=$q,this.underLine=$P;var $k=$B.toString()+$g+$q+$n+($_?$_.toLowerCase():" ")+($Z?$Z.toLowerCase():" ")+$P;return this.txtID=$m._keymap[$k],this.txtID||(this.txtID=1e-7*++$m._keymapCount,$m._keymap[$k]=this.txtID),this},$m.clear=function(){$m._keymap={},$m._keymapCount=1},$m._keymap={},$m._keymapCount=1,$m}()},$V}(),$$B=function(){function $g($B){this._index=0,this._size=14,this._italic=-2,$g._cache2=$g._cache2||[],this.setFont($B||"14px Arial")}$I($g,"laya.webgl.text.FontInContext");var $B=$g.prototype;return $B.setFont=function($B){var $_=$g._cache2[$B];if($_)this._words=$_[0],this._size=$_[1];else{this._words=$B.split(" ");for(var $Z=0,$n=this._words.length;$Z<$n;$Z++)if(0<this._words[$Z].indexOf("px")){this._index=$Z;break}this._size=parseInt(this._words[this._index]),$g._cache2[$B]=[this._words,this._size]}this._text=null,this._italic=-2},$B.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$B.hasType=function($B){for(var $_=0,$Z=this._words.length;$_<$Z;$_++)if(this._words[$_]===$B)return $_;return-1},$B.removeType=function($B){for(var $_=0,$Z=this._words.length;$_<$Z;$_++)if(this._words[$_]===$B){this._words.splice($_,1),this._index>$_&&this._index--;break}this._text=null,this._italic=-2},$B.copyTo=function($B){return $B._text=this._text,$B._size=this._size,$B._index=this._index,$B._words=this._words.slice(),$B._italic=-2,$B},$B.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$n(0,$B,"size",function(){return this._size},function($B){this._size=$B,this._words[this._index]=$B+"px",this._text=null}),$g.create=function($B){var $_=$g._cache[$B];return $_||($_=$g._cache[$B]=new $g($B))},$g.EMPTY=new $g,$g._cache={},$g._cache2=null,$g}(),$wB=function(){function $B(){}return $I($B,"laya.webgl.utils.CONST3D2D"),$B.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$B.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$B.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$B._TMPARRAY=[],$B._OFFSETX=0,$B._OFFSETY=0,$P($B,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$B}(),$rB=function(){function $$(){}return $I($$,"laya.webgl.utils.GlUtils"),$$.make2DProjection=function($B,$_,$Z){return[2/$B,0,0,0,0,-2/$_,0,0,0,0,2/$Z,0,-1,1,0,1]},$$.fillIBQuadrangle=function($B,$_){if(65535/4<$_)throw Error("IBQuadrangle count:"+$_+" must<:"+Math.floor(65535/4));$_=Math.floor($_),$B._resizeBuffer(6*($_+1)*2,!1),$B.byteLength=$B.bufferLength;for(var $Z=$B.getUint16Array(),$n=0,$g=0;$g<$_;$g++)$Z[$n++]=4*$g,$Z[$n++]=4*$g+2,$Z[$n++]=4*$g+1,$Z[$n++]=4*$g,$Z[$n++]=4*$g+3,$Z[$n++]=4*$g+2;return $B.setNeedUpload(),!0},$$.expandIBQuadrangle=function($B,$_){$B.bufferLength>=6*$_*2||$$.fillIBQuadrangle($B,$_)},$$.mathCeilPowerOfTwo=function($B){return $B--,$B|=$B>>1,$B|=$B>>2,$B|=$B>>4,$B|=$B>>8,$B|=$B>>16,++$B},$$.fillQuadrangleImgVb=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=16+($B._byteLength>>2);$B.byteLength=$m<<2;var $D=$B.getFloat32Array();$D[($m-=16)+2]=$g[0],$D[$m+3]=$g[1],$D[$m+6]=$g[2],$D[$m+7]=$g[3],$D[$m+10]=$g[4],$D[$m+11]=$g[5],$D[$m+14]=$g[6],$D[$m+15]=$g[7];var $T=$q.a,$e=$q.b,$I=$q.c,$A=$q.d;if(1!==$T||0!==$e||0!==$I||1!==$A){$q.bTransform=!0;var $$=$q.tx+$P,$w=$q.ty+$k;$D[$m]=($n[0]+$_)*$T+($n[1]+$Z)*$I+$$,$D[$m+1]=($n[0]+$_)*$e+($n[1]+$Z)*$A+$w,$D[$m+4]=($n[2]+$_)*$T+($n[3]+$Z)*$I+$$,$D[$m+5]=($n[2]+$_)*$e+($n[3]+$Z)*$A+$w,$D[$m+8]=($n[4]+$_)*$T+($n[5]+$Z)*$I+$$,$D[$m+9]=($n[4]+$_)*$e+($n[5]+$Z)*$A+$w,$D[$m+12]=($n[6]+$_)*$T+($n[7]+$Z)*$I+$$,$D[$m+13]=($n[6]+$_)*$e+($n[7]+$Z)*$A+$w}else $q.bTransform=!1,$_+=$q.tx+$P,$Z+=$q.ty+$k,$D[$m]=$_+$n[0],$D[$m+1]=$Z+$n[1],$D[$m+4]=$_+$n[2],$D[$m+5]=$Z+$n[3],$D[$m+8]=$_+$n[4],$D[$m+9]=$Z+$n[5],$D[$m+12]=$_+$n[6],$D[$m+13]=$Z+$n[7];return $B._upload=!0},$$.fillTranglesVB=function($B,$_,$Z,$n,$g,$q,$P){var $k=($B._byteLength>>2)+$n.length;$B.byteLength=$k<<2;var $m=$B.getFloat32Array();$k-=$n.length;for(var $D=$n.length,$T=$g.a,$e=$g.b,$I=$g.c,$A=$g.d,$$=0;$$<$D;$$+=4)if($m[$k+$$+2]=$n[$$+2],$m[$k+$$+3]=$n[$$+3],1!==$T||0!==$e||0!==$I||1!==$A){$g.bTransform=!0;var $w=$g.tx+$q,$r=$g.ty+$P;$m[$k+$$]=($n[$$]+$_)*$T+($n[$$+1]+$Z)*$I+$w,$m[$k+$$+1]=($n[$$]+$_)*$e+($n[$$+1]+$Z)*$A+$r}else $g.bTransform=!1,$_+=$g.tx+$q,$Z+=$g.ty+$P,$m[$k+$$]=$_+$n[$$],$m[$k+$$+1]=$Z+$n[$$+1];return $B._upload=!0},$$.copyPreImgVb=function($B,$_,$Z){var $n=$B._byteLength>>2;$B.byteLength=$n+16<<2;for(var $g=$B.getFloat32Array(),$q=0,$P=$n-16;$q<4;$q++)$g[$n]=$g[$P]+$_,++$P,$g[++$n]=$g[$P]+$Z,++$P,$g[++$n]=$g[$P],++$P,$g[++$n]=$g[$P],++$n,++$P;$B._upload=!0},$$.fillRectImgVb=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e,$I){void 0===$I&&($I=!1);var $A,$$,$w,$r,$j,$y,$C,$z,$t,$J,$N,$Q,$M,$Y,$l,$L,$v=1,$V=$k.a,$o=$k.b,$F=$k.c,$u=$k.d,$f=$_&&$_.width<99999999;if(1!==$V||0!==$o||0!==$F||1!==$u?($k.bTransform=!0,0===$o&&0===$F&&($v=23,$t=$g+$Z,$J=$q+$n,$A=$V*$Z+($N=$k.tx+$m),$w=$V*$t+$N,$$=$u*$n+($Q=$k.ty+$D),$r=$u*$J+$Q)):($v=23,$k.bTransform=!1,$w=($A=$Z+$k.tx+$m)+$g,$r=($$=$n+$k.ty+$D)+$q),$f&&($j=$_.x,$y=$_.y,$C=$_.width+$j,$z=$_.height+$y),1!==$v){if(Math.min($A,$w)>=$C)return!1;if(Math.min($$,$r)>=$z)return!1;if(Math.max($w,$A)<=$j)return!1;if(Math.max($r,$$)<=$y)return!1}var $b=$B._byteLength>>2;$B.byteLength=16+$b<<2;var $x=$B.getFloat32Array();switch($x[2+$b]=$P[0],$x[3+$b]=$P[1],$x[6+$b]=$P[2],$x[7+$b]=$P[3],$x[10+$b]=$P[4],$x[11+$b]=$P[5],$x[14+$b]=$P[6],$x[15+$b]=$P[7],$v){case 1:$N=$k.tx+$m,$Q=$k.ty+$D;var $p=$V*$Z,$K=$F*$n,$H=$u*$n,$G=$o*$Z,$W=$V*($t=$g+$Z),$X=$F*($J=$q+$n),$R=$u*$J,$h=$o*$t;$I?($M=$p+$K+$N,$l=Math.round($M)-$M,$Y=$H+$G+$Q,$L=Math.round($Y)-$Y,$x[$b]=$M+$l,$x[1+$b]=$Y+$L,$x[4+$b]=$W+$K+$N+$l,$x[5+$b]=$H+$h+$Q+$L,$x[8+$b]=$W+$X+$N+$l,$x[9+$b]=$R+$h+$Q+$L,$x[12+$b]=$p+$X+$N+$l,$x[13+$b]=$R+$G+$Q+$L):($x[$b]=$p+$K+$N,$x[1+$b]=$H+$G+$Q,$x[4+$b]=$W+$K+$N,$x[5+$b]=$H+$h+$Q,$x[8+$b]=$W+$X+$N,$x[9+$b]=$R+$h+$Q,$x[12+$b]=$p+$X+$N,$x[13+$b]=$R+$G+$Q);break;case 23:$I?($M=$A+$T,$l=Math.round($M)-$M,$Y=$$,$L=Math.round($Y)-$Y,$x[$b]=$M+$l,$x[1+$b]=$Y+$L,$x[4+$b]=$w+$T+$l,$x[5+$b]=$$+$L,$x[8+$b]=$w+$l,$x[9+$b]=$r+$L,$x[12+$b]=$A+$l,$x[13+$b]=$r+$L):($x[$b]=$A+$T,$x[1+$b]=$$,$x[4+$b]=$w+$T,$x[5+$b]=$$,$x[8+$b]=$w,$x[9+$b]=$r,$x[12+$b]=$A,$x[13+$b]=$r)}return $B._upload=!0},$$.fillLineVb=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=.5*$P,$D=$$._fillLineArray,$T=-($n-$q),$e=$Z-$g,$I=Math.sqrt($T*$T+$e*$e);$T/=$I,$e/=$I,$T*=$m,$e*=$m,$D[0]=$Z-$T,$D[1]=$n-$e,$D[4]=$Z+$T,$D[5]=$n+$e,$D[8]=$g+$T,$D[9]=$q+$e,$D[12]=$g-$T,$D[13]=$q-$e,$k&&$k.transformPointArray($D,$D);var $A=16+($B._byteLength>>2);return $B.byteLength=$A<<2,$B.insertData($D,$A-16),!0},$$._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$$}(),$jB=(function(){function $m(){}$I($m,"laya.webgl.utils.MatirxArray"),$m.ArrayMul=function($B,$_,$Z){if($B)if($_)for(var $n=NaN,$g=NaN,$q=NaN,$P=NaN,$k=0;$k<4;$k++)$n=$B[$k],$g=$B[$k+4],$q=$B[$k+8],$P=$B[$k+12],$Z[$k]=$n*$_[0]+$g*$_[1]+$q*$_[2]+$P*$_[3],$Z[$k+4]=$n*$_[4]+$g*$_[5]+$q*$_[6]+$P*$_[7],$Z[$k+8]=$n*$_[8]+$g*$_[9]+$q*$_[10]+$P*$_[11],$Z[$k+12]=$n*$_[12]+$g*$_[13]+$q*$_[14]+$P*$_[15];else $m.copyArray($B,$Z);else $m.copyArray($_,$Z)},$m.copyArray=function($B,$_){if($B&&$_)for(var $Z=0;$Z<$B.length;$Z++)$_[$Z]=$B[$Z]}}(),function(){function $_($B,$_,$Z){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$B,this._vb=new $EB($B,35048),$_&&this._vb._resizeBuffer($_,!1),this._ib=new $cB,$Z&&this._ib._resizeBuffer($Z,!1)}$I($_,"laya.webgl.utils.Mesh2D");var $B=$_.prototype;return $B.cloneWithNewVB=function(){var $B=new $_(this._stride,0,0);return $B._ib=this._ib,$B._quadNum=this._quadNum,$B._attribInfo=this._attribInfo,$B},$B.cloneWithNewVBIB=function(){var $B=new $_(this._stride,0,0);return $B._attribInfo=this._attribInfo,$B},$B.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$B.getVBR=function(){return this._vb},$B.getIBR=function(){return this._ib},$B.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$B.createQuadIB=function($B){this._quadNum=$B,this._ib._resizeBuffer(6*$B*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $_=this._ib.getUint16Array(),$Z=0,$n=0,$g=0;$g<$B;$g++)$_[$Z++]=$n,$_[$Z++]=$n+2,$_[$Z++]=$n+1,$_[$Z++]=$n,$_[$Z++]=$n+3,$_[$Z++]=$n+2,$n+=4;this._ib.setNeedUpload()},$B.setAttributes=function($B){if(this._attribInfo=$B,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$B.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$B.releaseMesh=function(){},$B.destroy=function(){},$B.clearVB=function(){this._vb.clear()},$_._gvaoid=0,$_}()),$yB=function(){function $g(){}return $I($g,"laya.webgl.utils.RenderState2D"),$g.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$g.mat2MatArray=function($B,$_){var $Z=$B,$n=$_;return $n[0]=$Z.a,$n[1]=$Z.b,$n[2]=$g.EMPTYMAT4_ARRAY[2],$n[3]=$g.EMPTYMAT4_ARRAY[3],$n[4]=$Z.c,$n[5]=$Z.d,$n[6]=$g.EMPTYMAT4_ARRAY[6],$n[7]=$g.EMPTYMAT4_ARRAY[7],$n[8]=$g.EMPTYMAT4_ARRAY[8],$n[9]=$g.EMPTYMAT4_ARRAY[9],$n[10]=$g.EMPTYMAT4_ARRAY[10],$n[11]=$g.EMPTYMAT4_ARRAY[11],$n[12]=$Z.tx,$n[13]=$Z.ty,$n[14]=$g.EMPTYMAT4_ARRAY[14],$n[15]=$g.EMPTYMAT4_ARRAY[15],$_},$g.restoreTempArray=function(){$g.TEMPMAT4_ARRAY[0]=1,$g.TEMPMAT4_ARRAY[1]=0,$g.TEMPMAT4_ARRAY[4]=0,$g.TEMPMAT4_ARRAY[5]=1,$g.TEMPMAT4_ARRAY[12]=0,$g.TEMPMAT4_ARRAY[13]=0},$g.clear=function(){$g.worldScissorTest=!1,$g.worldShaderDefines=null,$g.worldFilters=null,$g.worldAlpha=1,$g.worldClipRect.x=$g.worldClipRect.y=0,$g.worldClipRect.width=$g.width,$g.worldClipRect.height=$g.height,$g.curRenderTarget=null},$g._MAXSIZE=99999999,$g.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$g.worldMatrix4=$g.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$g.worldAlpha=1,$g.worldScissorTest=!1,$g.worldFilters=null,$g.worldShaderDefines=null,$g.curRenderTarget=null,$g.width=0,$g.height=0,$P($g,["worldMatrix",function(){return this.worldMatrix=new $M},"worldClipRect",function(){return this.worldClipRect=new $l(0,0,99999999,99999999)}]),$g}(),$CB=function(){var $y,$Z;function $C($B,$_,$Z,$n,$g){var $q=this;function $P($B){var $_=[],$Z=new $y($_);return $q._compileToTree($Z,$B.split("\n"),0,$_,$g),$Z}var $k=$A.now();this._VS=$P($_),this._PS=$P($Z),this._nameMap=$n,2<$A.now()-$k&&console.log("ShaderCompile use time:"+($A.now()-$k)+"  size:"+$_.length+"/"+$Z.length)}$I($C,"laya.webgl.utils.ShaderCompile");var $B=$C.prototype;return $B._compileToTree=function($B,$_,$Z,$n,$g){var $q,$P,$k,$m,$D,$T,$e,$I=0,$A=0,$$=0,$w=0;for($A=$Z;$A<$_.length;$A++)if(!(($k=$_[$A]).length<1)&&0!==($I=$k.indexOf("//"))){if(0<=$I&&($k=$k.substr(0,$I)),$q=$e||new $y($n),$e=null,$q.text=$k,$q.noCompile=!0,0<=($I=$k.indexOf("#"))){for($m="#",$w=$I+1,$$=$k.length;$w<$$;$w++){var $r=$k.charAt($w);if(" "===$r||"\t"===$r||"\r"===$r||"\n"===$r||"?"===$r)break;$m+=$r}switch($q.name=$m){case"#ifdef":case"#ifndef":if($q.src=$k,$q.noCompile=null!=$k.match(/[!&|()=<>]/),$q.noCompile?console.log("function():Boolean{return "+$k.substr($I+$q.name.length)+"}"):($T=$k.replace(/^\s*/,"").split(/\s+/),$q.setCondition($T[1],"#ifdef"===$m?1:2),$q.text="//"+$q.text),$q.setParent($B),$B=$q,$g)for($T=$k.substr($w).split($C._splitToWordExps3),$w=0;$w<$T.length;$w++)($k=$T[$w]).length&&($g[$k]=!0);continue;case"#if":if($q.src=$k,$q.noCompile=!0,$q.setParent($B),$B=$q,$g)for($T=$k.substr($w).split($C._splitToWordExps3),$w=0;$w<$T.length;$w++)($k=$T[$w]).length&&"defined"!=$k&&($g[$k]=!0);continue;case"#else":$q.src=$k,$P=($B=$B.parent).childs[$B.childs.length-1],$q.noCompile=$P.noCompile,$q.noCompile||($q.condition=$P.condition,$q.conditionType=1==$P.conditionType?2:1,$q.text="//"+$q.text+" "+$P.text+" "+$q.conditionType),$q.setParent($B),$B=$q;continue;case"#endif":$P=($B=$B.parent).childs[$B.childs.length-1],$q.noCompile=$P.noCompile,$q.noCompile||($q.text="//"+$q.text),$q.setParent($B);continue;case"#include":$T=$C.splitToWords($k,null);var $j=$C.includes[$T[1]];if(!$j)throw"ShaderCompile error no this include file:"+$T[1];if(($I=$T[0].indexOf("?"))<0){$q.setParent($B),$k=$j.getWith("with"==$T[2]?$T[3]:null),this._compileToTree($q,$k.split("\n"),0,$n,$g),$q.text="";continue}$q.setCondition($T[0].substr($I+1),1),$q.text=$j.getWith("with"==$T[2]?$T[3]:null);break;case"#import":$D=($T=$C.splitToWords($k,null))[1],$n.push({node:$q,file:$C.includes[$D],ofs:$q.text.length});continue}}else{if(($P=$B.childs[$B.childs.length-1])&&!$P.name){0<$n.length&&$C.splitToWords($k,$P),$e=$q,$P.text+="\n"+$k;continue}0<$n.length&&$C.splitToWords($k,$q)}$q.setParent($B)}},$B.createShader=function($B,$_,$Z){var $n={},$g="";if($B)for(var $q in $B)$g+="#define "+$q+"\n",$n[$q]=!0;var $P=this._VS.toscript($n,[]),$k=this._PS.toscript($n,[]);return($Z||$OB.create)($g+$P.join("\n"),$g+$k.join("\n"),$_,this._nameMap)},$C._parseOne=function($B,$_,$Z,$n,$g,$q){var $P={type:$C.shaderParamsMap[$Z[$n+1]],name:$Z[$n+2],size:isNaN(parseInt($Z[$n+3]))?1:parseInt($Z[$n+3])};return $q&&("attribute"==$g?$B.push($P):$_.push($P)),":"==$Z[$n+3]&&($P.type=$Z[$n+4],$n+=2),$n+=2},$C.addInclude=function($B,$_){if(!$_||0===$_.length)throw new Error("add shader include file err:"+$B);if($C.includes[$B])throw new Error("add shader include file err, has add:"+$B);$C.includes[$B]=new $Z($_)},$C.preGetParams=function($B,$_){var $Z=[$B,$_],$n={},$g=[],$q=[],$P={},$k=[];$n.attributes=$g,$n.uniforms=$q,$n.defines=$P;for(var $m=0,$D=0,$T=0;$T<2;$T++){$Z[$T]=$Z[$T].replace($C._removeAnnotation,"");var $e,$I=$Z[$T].match($C._reg);for($m=0,$D=$I.length;$m<$D;$m++){var $A=$I[$m];if("attribute"==$A||"uniform"==$A)$m=$C._parseOne($g,$q,$I,$m,$A,!0);else{if("#define"==$A){$k[$A=$I[++$m]]=1;continue}if("#ifdef"==$A){$P[$e=$I[++$m]]=$P[$e]||[];for($m++;$m<$D;$m++)if("attribute"==($A=$I[$m])||"uniform"==$A)$m=$C._parseOne($g,$q,$I,$m,$A,$k[$e]);else if("#else"==$A)for($m++;$m<$D;$m++)if("attribute"==($A=$I[$m])||"uniform"==$A)$m=$C._parseOne($g,$q,$I,$m,$A,!$k[$e]);else if("#endif"==$A)break}}}}return $n},$C.splitToWords=function($B,$_){for(var $Z,$n,$g=[],$q=-1,$P=0,$k=$B.length;$P<$k;$P++)if($Z=$B.charAt($P),0<=" \t=+-*/&%!<>()'\",;".indexOf($Z)){if(0<=$q&&1<$P-$q&&($n=$B.substr($q,$P-$q),$g.push($n)),'"'==$Z||"'"==$Z){var $m=$B.indexOf($Z,$P+1);if($m<0)throw"Sharder err:"+$B;$g.push($B.substr($P+1,$m-$P-1)),$P=$m,$q=-1;continue}"("==$Z&&$_&&0<$g.length&&($n=$g[$g.length-1]+";","vec4;main;".indexOf($n)<0&&($_.useFuns+=$n)),$q=-1}else $q<0&&($q=$P);return $q<$k&&1<$k-$q&&($n=$B.substr($q,$k-$q),$g.push($n)),$g},$C.IFDEF_NO=0,$C.IFDEF_YES=1,$C.IFDEF_ELSE=2,$C.IFDEF_PARENT=3,$C._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$C._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$C._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$C.includes={},$P($C,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$C.__init$=function(){$y=function(){function $Z($B){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$B}$I($Z,"");var $B=$Z.prototype;return $B.setParent=function($B){$B.childs.push(this),this.z=$B.z+1,this.parent=$B},$B.setCondition=function($B,$_){$B&&(this.conditionType=$_,$B=$B.replace(/(\s*$)/g,""),this.condition=function(){return this[$B]},this.condition.__condition=$B)},$B.toscript=function($B,$_){return this._toscript($B,$_,++$Z.__id)},$B._toscript=function($n,$g,$q){if(this.childs.length<1&&!this.text)return $g;$g.length;if(this.condition){var $B=!!this.condition.call($n);if(2===this.conditionType&&($B=!$B),!$B)return $g}if(this.text&&$g.push(this.text),0<this.childs.length&&this.childs.forEach(function($B,$_,$Z){$B._toscript($n,$g,$q)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $_,$Z=0,$P=this.includefiles.length;$Z<$P;$Z++)this.includefiles[$Z].curUseID!=$q&&0<($_=this.includefiles[$Z].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$Z].curUseID=$q,$g[0]=$_+$g[0]);return $g},$Z.__id=1,$Z}(),$Z=function(){function $B($B){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$B;for(var $_=0,$Z=0,$n=0;!(($_=$B.indexOf("#begin",$_))<0);){for($n=$_+5;!(($n=$B.indexOf("#end",$n))<0)&&"i"===$B.charAt($n+4);)$n+=5;if($n<0)throw"add include err,no #end:"+$B;$Z=$B.indexOf("\n",$_);var $g=$C.splitToWords($B.substr($_,$Z-$_),null);"code"==$g[1]?this.codes[$g[2]]=$B.substr($Z+1,$n-$Z-1):"function"==$g[1]&&($Z=$B.indexOf("function",$_),$Z+="function".length,this.funs[$g[3]]=$B.substr($Z+1,$n-$Z-1),this.funnames+=$g[3]+";"),$_=$n+1}}$I($B,"");var $_=$B.prototype;return $_.getWith=function($B){var $_=$B?this.codes[$B]:this.script;if(!$_)throw"get with error:"+$B;return $_},$_.getFunsScript=function($B){var $_="";for(var $Z in this.funs)0<=$B.indexOf($Z+";")&&($_+=this.funs[$Z]);return $_},$B}()},$C}(),$zB=function(){function $P(){}return $I($P,"laya.webgl.WebGL"),$P._uint8ArraySlice=function(){for(var $B=this.length,$_=new Uint8Array(this.length),$Z=0;$Z<$B;$Z++)$_[$Z]=this[$Z];return $_},$P._float32ArraySlice=function(){for(var $B=this.length,$_=new Float32Array(this.length),$Z=0;$Z<$B;$Z++)$_[$Z]=this[$Z];return $_},$P._uint16ArraySlice=function($B){var $_,$Z=arguments,$n=0,$g=0;if(0===$Z.length)for($n=this.length,$_=new Uint16Array($n),$g=0;$g<$n;$g++)$_[$g]=this[$g];else if(2===$Z.length){var $q=$Z[0],$P=$Z[1];if($q<$P)for($n=$P-$q,$_=new Uint16Array($n),$g=$q;$g<$P;$g++)$_[$g-$q]=this[$g];else $_=new Uint16Array(0)}return $_},$P.expandContext=function(){var $B=$g.prototype,$_=CanvasRenderingContext2D.prototype;$_.fillTrangles=$B.fillTrangles,$dB.__int__(null),$_.setIBVB=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){void 0===$m&&($m=0),void 0===$D&&($D=0),null===$Z&&(this._ib=this._ib||$cB.QuadrangleIB,$Z=this._ib,$rB.expandIBQuadrangle($Z,$n._byteLength/64+8)),this._setIBVB($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D)},$_.fillTrangles=function($B,$_,$Z,$n,$g){this._curMat=this._curMat||$M.create(),this._vb=this._vb||$EB.create(),this._ib||(this._ib=$cB.create(),$rB.fillIBQuadrangle(this._ib,$P/4));var $q=this._vb,$P=$n.length>>4;$rB.fillTranglesVB($q,$_,$Z,$n,$g||this._curMat,0,0),$rB.expandIBQuadrangle(this._ib,$q._byteLength/64+8);var $k=new $QB(1,0);$k.textureHost=$B;var $m=new $iB("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$q._vertType=3,this._setIBVB($_,$Z,this._ib,$q,6*$P,$g,$m,$k,0,0)}},$P.enable=function(){if($A.__init__(),$j.isConchApp&&!$j.isConchWebGL)return $t.skinAniSprite=function(){return new $BB},$P.expandContext(),!1;if($t.getWebGLContext=function($B){for(var $_,$Z=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$n=0;$n<$Z.length;$n++){try{$_=$B.getContext($Z[$n],{stencil:$N.isStencil,alpha:$N.isAlpha,antialias:$N.isAntialias,premultipliedAlpha:$N.premultipliedAlpha,preserveDrawingBuffer:$N.preserveDrawingBuffer})}catch($B){}if($_)return $_}return null},null==($P.mainContext=$P.mainContext||$t.getWebGLContext($j._mainCanvas)))return!1;if($j.isWebGL)return!0;$w.create=function($B,$_){return new $B_($B,$_)},$r.create=function($B,$_,$Z,$n,$g,$q,$P){return new $SB($B,$_,$Z,$n,$g,$q,$P)},$j.WebGL=$P,$j.isWebGL=!0,$AB.__init__(),$t.createRenderSprite=function($B,$_){return new $MB($B,$_)},$t.createWebGLContext2D=function($B){return new $NB($B)},$t.changeWebGLSize=function($B,$_){laya.webgl.WebGL.onStageResize($B,$_)},$t.createGraphics=function(){return new $JB};var $B=$t.createFilterAction;return $t.createFilterAction=$B||function($B){return new $YB},$t.clear=function($B){$yB.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $_=$j.context.ctx,$Z=0==$_._submits._length||$N.preserveDrawingBuffer?$$.create($B)._color:$v._wgColor;$Z&&$_.clearBG($Z[0],$Z[1],$Z[2],$Z[3]),$yB.clear()},$t.addToAtlas=function($B,$_){void 0===$_&&($_=!1);var $Z=$B.bitmap;$j.optimizeTextureMemory($B.url,$B)?$J.__typeof($Z,"laya.webgl.resource.IMergeAtlasBitmap")&&$Z.allowMerageInAtlas&&$Z.on("recovered",$B,$B.addTextureToAtlas):$Z.enableMerageInAtlas=!1},$t.isAtlas=function($B){return $B instanceof laya.webgl.atlas.AtlasWebGLCanvas},$G._enable(),$t.beginFlush=function(){for(var $B=$G.instance,$_=$B.getAtlaserCount(),$Z=0;$Z<$_;$Z++){var $n=$B.getAtlaserByIndex($Z).texture;$n._flashCacheImageNeedFlush&&$t.flashFlushImage($n)}},$t.drawToCanvas=function($B,$_,$Z,$n,$g,$q){($Z<=0||$n<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$Z|=0,$n|=0,$g|=0,$q|=0;var $P=$xB.create($Z,$n,6408,5121,0,!1);$P.start(),$P.clear(0,0,0,0),$j.context.clear(),$y.renders[$_]._fun($B,$j.context,$g,$yB.height-$n+$q),$j.context.flush(),$P.end();var $k=$P.getData(0,0,$Z,$n);if($P.recycle(),$k.byteLength==$Z*$n*4){var $m=new $hB;$m._canvas=$A.createElement("canvas"),$m.size($Z,$n);var $D=$m._canvas.getContext("2d");$A.canvas.size($Z,$n);var $T=$A.context,$e=$T.createImageData($Z,$n);return $e.data.set(new Uint8ClampedArray($k.buffer)),$m._imgData=$e,$T.putImageData($e,0,0),$D.save(),$D.translate(0,$n),$D.scale(1,-1),$D.drawImage($A.canvas.source,0,0),$D.restore(),$m}console.log("drawToCanvas error: w:"+$Z+",h:"+$n+",datalen:"+$k.byteLength)},$t.createFilterAction=function($B){var $_;switch($B){case 32:$_=new $YB}return $_},$t.addTextureToAtlas=function($B){$B._uvID++,$G._atlasRestore++,$B.bitmap.enableMerageInAtlas&&$G.instance.addToAtlas($B)},$t.getTexturePixels=function($B,$_,$Z,$n,$g){$j.context.ctx.clear();var $q=new $L;$q.graphics.drawTexture($B,-$_,-$Z);var $P=$xB.create($n,$g);$P.start(),$P.clear(0,0,0,0),$q.render($j.context,0,0),$j.context.ctx.flush(),$P.end();for(var $k=$P.getData(0,0,$n,$g),$m=[],$D=0,$T=$g-1;0<=$T;$T--)for(var $e=0;$e<$n;$e++)$D=4*($T*$n+$e),$m.push($k[$D]),$m.push($k[$D+1]),$m.push($k[$D+2]),$m.push($k[$D+3]);return $m},$t.skinAniSprite=function(){return new $BB},$D.create=function($B,$_){var $Z=new $hB;return $Z._imgData=$_,$Z.flipY=!1,$Z},$Q._filterStart=function($B,$_,$Z,$n,$g){var $q=$B.getValue("bounds"),$P=$xB.create($q.width,$q.height);if($P.start(),$P.clear(0,0,0,0),$B.addValue("src",$P),$B.addValue("ScissorTest",$yB.worldScissorTest),$yB.worldScissorTest){var $k=new $l;$k.copyFrom($Z.ctx._clipRect),$B.addValue("clipRect",$k),$yB.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$Q._filterEnd=function($B,$_,$Z,$n,$g){var $q=$B.getValue("bounds");$B.getValue("src").end();var $P=$xB.create($q.width,$q.height);$P.start(),$P.clear(0,0,0,0),$B.addValue("out",$P),$_._set$P("_filterCache",$P),$_._set$P("_isHaveGlowFilter",$B.getValue("_isHaveGlowFilter"))},$Q._EndTarget=function($B,$_){if($B.getValue("src").recycle(),$B.getValue("out").end(),$B.getValue("ScissorTest")){$yB.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$_.ctx.save();var $Z=$B.getValue("clipRect");$_.ctx.clipRect($Z.x,$Z.y,$Z.width,$Z.height)}},$Q._useSrc=function($B){var $_=$B.getValue("out");$_.end(),($_=$B.getValue("src")).start(),$_.clear(0,0,0,0)},$Q._endSrc=function($B){$B.getValue("src").end()},$Q._useOut=function($B){var $_=$B.getValue("src");$_.end(),($_=$B.getValue("out")).start(),$_.clear(0,0,0,0)},$Q._endOut=function($B){$B.getValue("out").end()},$Q._recycleScope=function($B){$B.recycle()},$Q._filter=function($B,$_,$Z,$n){var $g=this._next;if($g){var $q,$P,$k=$B.filters,$m=$k.length;if(1==$m&&32==$k[0].type)return $_.ctx.save(),$_.ctx.setFilters([$k[0]]),$g._fun.call($g,$B,$_,$Z,$n),void $_.ctx.restore();var $D=$kB.create(),$T=$Y.TEMP,$e=$_.ctx._getTransformMatrix(),$I=$M.create();$e.copyTo($I);var $A=0,$$=0,$w=!1,$r=$B._$P._filterCache?$B._$P._filterCache:null;if(!$r||$B._repaint){$w=$B._isHaveGlowFilter(),$D.addValue("_isHaveGlowFilter",$w),$w&&($A=50,$$=25),($P=new $l).copyFrom($B.getSelfBounds()),$P.x+=$B.x,$P.y+=$B.y,$P.x-=$B.pivotX+4,$P.y-=$B.pivotY+4;var $j=$P.x,$y=$P.y;if($P.width+=$A+8,$P.height+=$A+8,$T.x=$P.x*$I.a+$P.y*$I.c,$T.y=$P.y*$I.d+$P.x*$I.b,$P.x=$T.x,$P.y=$T.y,$T.x=$P.width*$I.a+$P.height*$I.c,$T.y=$P.height*$I.d+$P.width*$I.b,$P.width=$T.x,$P.height=$T.y,$P.width<=0||$P.height<=0)return;$r&&$r.recycle(),$D.addValue("bounds",$P);var $C=$PB.create([$D,$B,$_,0,0],$Q._filterStart);$_.addRenderObject($C),$_.ctx._renderKey=0,$_.ctx._shader2D.glTexture=null;var $z=$B.x-$j+$$,$t=$B.y-$y+$$;$g._fun.call($g,$B,$_,$z,$t),$C=$PB.create([$D,$B,$_,0,0],$Q._filterEnd),$_.addRenderObject($C);for(var $J=0;$J<$m;$J++){0!=$J&&($C=$PB.create([$D],$Q._useSrc),$_.addRenderObject($C),$q=$QB.create(1,0),$M.TEMP.identity(),$_.ctx.drawTarget($D,0,0,$P.width,$P.height,$M.TEMP,"out",$q,null,$X.TOINT.overlay),$C=$PB.create([$D],$Q._useOut),$_.addRenderObject($C)),$k[$J].action.apply3d($D,$B,$_,0,0)}$C=$PB.create([$D,$_],$Q._EndTarget),$_.addRenderObject($C)}else{if(($w=!!$B._$P._isHaveGlowFilter&&$B._$P._isHaveGlowFilter)&&($A=50,$$=25),($P=$B.getBounds()).width<=0||$P.height<=0)return;$P.width+=$A,$P.height+=$A,$T.x=$P.x*$I.a+$P.y*$I.c,$T.y=$P.y*$I.d+$P.x*$I.b,$P.x=$T.x,$P.y=$T.y,$T.x=$P.width*$I.a+$P.height*$I.c,$T.y=$P.height*$I.d+$P.width*$I.b,$P.width=$T.x,$P.height=$T.y,$D.addValue("out",$r)}$Z=$Z-$$-$B.x,$n=$n-$$-$B.y,$T.setTo($Z,$n),$I.transformPoint($T),$Z=$T.x+$P.x,$n=$T.y+$P.y,$q=$QB.create(1,0),$M.TEMP.identity(),$_.ctx.drawTarget($D,$Z,$n,$P.width,$P.height,$M.TEMP,"out",$q,null,$X.TOINT.overlay),$C=$PB.create([$D],$Q._recycleScope),$_.addRenderObject($C),$I.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$P._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$P._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$P._uint8ArraySlice),!0},$P.onStageResize=function($B,$_){null!=$P.mainContext&&($P.mainContext.viewport(0,0,$B,$_),$yB.width=$B,$yB.height=$_)},$P.onInvalidGLRes=function(){$G.instance.freeAll(),$z.releaseContentManagers(!0),$P.doNodeRepaint($J.stage),$P.mainContext.viewport(0,0,$yB.width,$yB.height),$J.stage.event("devicelost")},$P.doNodeRepaint=function($B){0==$B.numChildren&&$B.repaint();for(var $_=0;$_<$B.numChildren;$_++)$P.doNodeRepaint($B.getChildAt($_))},$P.init=function($B,$_,$Z){$P.mainCanvas=$B,$D._createContext=function($B){return new $NB($B)},$hB._createContext=function($B){return new $NB($B)};var $n=laya.webgl.WebGL.mainContext;if(null!=$n.getShaderPrecisionFormat){var $g=$n.getShaderPrecisionFormat(35633,36338),$q=$n.getShaderPrecisionFormat(35632,36338);$P.shaderHighPrecision=!(!$g.precision||!$q.precision)}else $P.shaderHighPrecision=!1;if($P.compressAstc=$n.getExtension("WEBGL_compressed_texture_astc"),$P.compressAtc=$n.getExtension("WEBGL_compressed_texture_atc"),$P.compressEtc=$n.getExtension("WEBGL_compressed_texture_etc"),$P.compressEtc1=$n.getExtension("WEBGL_compressed_texture_etc1"),$P.compressPvrtc=$n.getExtension("WEBGL_compressed_texture_pvrtc"),$P.compressS3tc=$n.getExtension("WEBGL_compressed_texture_s3tc"),$P.compressS3tc_srgb=$n.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$P.compressAstc=$P.compressAstc?$P.compressAstc:{},$P.compressAtc=$P.compressAtc?$P.compressAtc:{},$P.compressEtc=$P.compressEtc?$P.compressEtc:{},$P.compressEtc1=$P.compressEtc1?$P.compressEtc1:{},$P.compressPvrtc=$P.compressPvrtc?$P.compressPvrtc:{},$P.compressS3tc=$P.compressS3tc?$P.compressS3tc:{},$P.compressS3tc_srgb=$P.compressS3tc_srgb?$P.compressS3tc_srgb:{},$n.deleteTexture1=$n.deleteTexture,$n.deleteTexture=function($B){$B==$tB.curBindTexValue&&($tB.curBindTexValue=null),$n.deleteTexture1($B)},$P.onStageResize($_,$Z),null==$P.mainContext)throw new Error("webGL getContext err!");$F.__init__(),$G.__init__(),$LB.__init__(),$qB.__init__(),$NB.__init__(),$QB.__init__(),$c.__init__(),$dB.__int__($n),$X._init_($n),$j.isConchApp&&conch.setOnInvalidGLRes($P.onInvalidGLRes)},$P.mainCanvas=null,$P.antialias=!0,$P.shaderHighPrecision=!1,$P._bg_null=[0,0,0,0],$P}(),$tB=function(){function $n(){}return $I($n,"laya.webgl.WebGLContext"),$n.UseProgram=function($B){return $n._useProgram!==$B&&($zB.mainContext.useProgram($B),$n._useProgram=$B,!0)},$n.setDepthTest=function($B,$_){$_!==$n._depthTest&&(($n._depthTest=$_)?$B.enable(2929):$B.disable(2929))},$n.setDepthMask=function($B,$_){$_!==$n._depthMask&&($n._depthMask=$_,$B.depthMask($_))},$n.setDepthFunc=function($B,$_){$_!==$n._depthFunc&&($n._depthFunc=$_,$B.depthFunc($_))},$n.setBlend=function($B,$_){$_!==$n._blend&&(($n._blend=$_)?$B.enable(3042):$B.disable(3042))},$n.setBlendFunc=function($B,$_,$Z){($_!==$n._sFactor||$Z!==$n._dFactor)&&($n._sFactor=$_,$n._dFactor=$Z,$B.blendFunc($_,$Z))},$n.setCullFace=function($B,$_){$_!==$n._cullFace&&(($n._cullFace=$_)?$B.enable(2884):$B.disable(2884))},$n.setFrontFace=function($B,$_){$_!==$n._frontFace&&($n._frontFace=$_,$B.frontFace($_))},$n.bindTexture=function($B,$_,$Z){$B.bindTexture($_,$Z),$n.curBindTexTarget=$_,$n.curBindTexValue=$Z},$n.DEPTH_BUFFER_BIT=256,$n.STENCIL_BUFFER_BIT=1024,$n.COLOR_BUFFER_BIT=16384,$n.POINTS=0,$n.LINES=1,$n.LINE_LOOP=2,$n.LINE_STRIP=3,$n.TRIANGLES=4,$n.TRIANGLE_STRIP=5,$n.TRIANGLE_FAN=6,$n.ZERO=0,$n.ONE=1,$n.SRC_COLOR=768,$n.ONE_MINUS_SRC_COLOR=769,$n.SRC_ALPHA=770,$n.ONE_MINUS_SRC_ALPHA=771,$n.DST_ALPHA=772,$n.ONE_MINUS_DST_ALPHA=773,$n.DST_COLOR=774,$n.ONE_MINUS_DST_COLOR=775,$n.SRC_ALPHA_SATURATE=776,$n.FUNC_ADD=32774,$n.BLEND_EQUATION=32777,$n.BLEND_EQUATION_RGB=32777,$n.BLEND_EQUATION_ALPHA=34877,$n.FUNC_SUBTRACT=32778,$n.FUNC_REVERSE_SUBTRACT=32779,$n.BLEND_DST_RGB=32968,$n.BLEND_SRC_RGB=32969,$n.BLEND_DST_ALPHA=32970,$n.BLEND_SRC_ALPHA=32971,$n.CONSTANT_COLOR=32769,$n.ONE_MINUS_CONSTANT_COLOR=32770,$n.CONSTANT_ALPHA=32771,$n.ONE_MINUS_CONSTANT_ALPHA=32772,$n.BLEND_COLOR=32773,$n.ARRAY_BUFFER=34962,$n.ELEMENT_ARRAY_BUFFER=34963,$n.ARRAY_BUFFER_BINDING=34964,$n.ELEMENT_ARRAY_BUFFER_BINDING=34965,$n.STREAM_DRAW=35040,$n.STATIC_DRAW=35044,$n.DYNAMIC_DRAW=35048,$n.BUFFER_SIZE=34660,$n.BUFFER_USAGE=34661,$n.CURRENT_VERTEX_ATTRIB=34342,$n.FRONT=1028,$n.BACK=1029,$n.CULL_FACE=2884,$n.FRONT_AND_BACK=1032,$n.BLEND=3042,$n.DITHER=3024,$n.STENCIL_TEST=2960,$n.DEPTH_TEST=2929,$n.SCISSOR_TEST=3089,$n.POLYGON_OFFSET_FILL=32823,$n.SAMPLE_ALPHA_TO_COVERAGE=32926,$n.SAMPLE_COVERAGE=32928,$n.NO_ERROR=0,$n.INVALID_ENUM=1280,$n.INVALID_VALUE=1281,$n.INVALID_OPERATION=1282,$n.OUT_OF_MEMORY=1285,$n.CW=2304,$n.CCW=2305,$n.LINE_WIDTH=2849,$n.ALIASED_POINT_SIZE_RANGE=33901,$n.ALIASED_LINE_WIDTH_RANGE=33902,$n.CULL_FACE_MODE=2885,$n.FRONT_FACE=2886,$n.DEPTH_RANGE=2928,$n.DEPTH_WRITEMASK=2930,$n.DEPTH_CLEAR_VALUE=2931,$n.DEPTH_FUNC=2932,$n.STENCIL_CLEAR_VALUE=2961,$n.STENCIL_FUNC=2962,$n.STENCIL_FAIL=2964,$n.STENCIL_PASS_DEPTH_FAIL=2965,$n.STENCIL_PASS_DEPTH_PASS=2966,$n.STENCIL_REF=2967,$n.STENCIL_VALUE_MASK=2963,$n.STENCIL_WRITEMASK=2968,$n.STENCIL_BACK_FUNC=34816,$n.STENCIL_BACK_FAIL=34817,$n.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$n.STENCIL_BACK_PASS_DEPTH_PASS=34819,$n.STENCIL_BACK_REF=36003,$n.STENCIL_BACK_VALUE_MASK=36004,$n.STENCIL_BACK_WRITEMASK=36005,$n.VIEWPORT=2978,$n.SCISSOR_BOX=3088,$n.COLOR_CLEAR_VALUE=3106,$n.COLOR_WRITEMASK=3107,$n.UNPACK_ALIGNMENT=3317,$n.PACK_ALIGNMENT=3333,$n.MAX_TEXTURE_SIZE=3379,$n.MAX_VIEWPORT_DIMS=3386,$n.SUBPIXEL_BITS=3408,$n.RED_BITS=3410,$n.GREEN_BITS=3411,$n.BLUE_BITS=3412,$n.ALPHA_BITS=3413,$n.DEPTH_BITS=3414,$n.STENCIL_BITS=3415,$n.POLYGON_OFFSET_UNITS=10752,$n.POLYGON_OFFSET_FACTOR=32824,$n.TEXTURE_BINDING_2D=32873,$n.SAMPLE_BUFFERS=32936,$n.SAMPLES=32937,$n.SAMPLE_COVERAGE_VALUE=32938,$n.SAMPLE_COVERAGE_INVERT=32939,$n.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$n.COMPRESSED_TEXTURE_FORMATS=34467,$n.DONT_CARE=4352,$n.FASTEST=4353,$n.NICEST=4354,$n.GENERATE_MIPMAP_HINT=33170,$n.BYTE=5120,$n.UNSIGNED_BYTE=5121,$n.SHORT=5122,$n.UNSIGNED_SHORT=5123,$n.INT=5124,$n.UNSIGNED_INT=5125,$n.FLOAT=5126,$n.DEPTH_COMPONENT=6402,$n.ALPHA=6406,$n.RGB=6407,$n.RGBA=6408,$n.LUMINANCE=6409,$n.LUMINANCE_ALPHA=6410,$n.UNSIGNED_SHORT_4_4_4_4=32819,$n.UNSIGNED_SHORT_5_5_5_1=32820,$n.UNSIGNED_SHORT_5_6_5=33635,$n.FRAGMENT_SHADER=35632,$n.VERTEX_SHADER=35633,$n.MAX_VERTEX_ATTRIBS=34921,$n.MAX_VERTEX_UNIFORM_VECTORS=36347,$n.MAX_VARYING_VECTORS=36348,$n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$n.MAX_TEXTURE_IMAGE_UNITS=34930,$n.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$n.SHADER_TYPE=35663,$n.DELETE_STATUS=35712,$n.LINK_STATUS=35714,$n.VALIDATE_STATUS=35715,$n.ATTACHED_SHADERS=35717,$n.ACTIVE_UNIFORMS=35718,$n.ACTIVE_ATTRIBUTES=35721,$n.SHADING_LANGUAGE_VERSION=35724,$n.CURRENT_PROGRAM=35725,$n.NEVER=512,$n.LESS=513,$n.EQUAL=514,$n.LEQUAL=515,$n.GREATER=516,$n.NOTEQUAL=517,$n.GEQUAL=518,$n.ALWAYS=519,$n.KEEP=7680,$n.REPLACE=7681,$n.INCR=7682,$n.DECR=7683,$n.INVERT=5386,$n.INCR_WRAP=34055,$n.DECR_WRAP=34056,$n.VENDOR=7936,$n.RENDERER=7937,$n.VERSION=7938,$n.NEAREST=9728,$n.LINEAR=9729,$n.NEAREST_MIPMAP_NEAREST=9984,$n.LINEAR_MIPMAP_NEAREST=9985,$n.NEAREST_MIPMAP_LINEAR=9986,$n.LINEAR_MIPMAP_LINEAR=9987,$n.TEXTURE_MAG_FILTER=10240,$n.TEXTURE_MIN_FILTER=10241,$n.TEXTURE_WRAP_S=10242,$n.TEXTURE_WRAP_T=10243,$n.TEXTURE_2D=3553,$n.TEXTURE=5890,$n.TEXTURE_CUBE_MAP=34067,$n.TEXTURE_BINDING_CUBE_MAP=34068,$n.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$n.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$n.TEXTURE0=33984,$n.TEXTURE1=33985,$n.TEXTURE2=33986,$n.TEXTURE3=33987,$n.TEXTURE4=33988,$n.TEXTURE5=33989,$n.TEXTURE6=33990,$n.TEXTURE7=33991,$n.TEXTURE8=33992,$n.TEXTURE9=33993,$n.TEXTURE10=33994,$n.TEXTURE11=33995,$n.TEXTURE12=33996,$n.TEXTURE13=33997,$n.TEXTURE14=33998,$n.TEXTURE15=33999,$n.TEXTURE16=34e3,$n.TEXTURE17=34001,$n.TEXTURE18=34002,$n.TEXTURE19=34003,$n.TEXTURE20=34004,$n.TEXTURE21=34005,$n.TEXTURE22=34006,$n.TEXTURE23=34007,$n.TEXTURE24=34008,$n.TEXTURE25=34009,$n.TEXTURE26=34010,$n.TEXTURE27=34011,$n.TEXTURE28=34012,$n.TEXTURE29=34013,$n.TEXTURE30=34014,$n.TEXTURE31=34015,$n.ACTIVE_TEXTURE=34016,$n.REPEAT=10497,$n.CLAMP_TO_EDGE=33071,$n.MIRRORED_REPEAT=33648,$n.FLOAT_VEC2=35664,$n.FLOAT_VEC3=35665,$n.FLOAT_VEC4=35666,$n.INT_VEC2=35667,$n.INT_VEC3=35668,$n.INT_VEC4=35669,$n.BOOL=35670,$n.BOOL_VEC2=35671,$n.BOOL_VEC3=35672,$n.BOOL_VEC4=35673,$n.FLOAT_MAT2=35674,$n.FLOAT_MAT3=35675,$n.FLOAT_MAT4=35676,$n.SAMPLER_2D=35678,$n.SAMPLER_CUBE=35680,$n.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$n.VERTEX_ATTRIB_ARRAY_SIZE=34339,$n.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$n.VERTEX_ATTRIB_ARRAY_TYPE=34341,$n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$n.VERTEX_ATTRIB_ARRAY_POINTER=34373,$n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$n.COMPILE_STATUS=35713,$n.LOW_FLOAT=36336,$n.MEDIUM_FLOAT=36337,$n.HIGH_FLOAT=36338,$n.LOW_INT=36339,$n.MEDIUM_INT=36340,$n.HIGH_INT=36341,$n.FRAMEBUFFER=36160,$n.RENDERBUFFER=36161,$n.RGBA4=32854,$n.RGB5_A1=32855,$n.RGB565=36194,$n.DEPTH_COMPONENT16=33189,$n.STENCIL_INDEX=6401,$n.STENCIL_INDEX8=36168,$n.DEPTH_STENCIL=34041,$n.RENDERBUFFER_WIDTH=36162,$n.RENDERBUFFER_HEIGHT=36163,$n.RENDERBUFFER_INTERNAL_FORMAT=36164,$n.RENDERBUFFER_RED_SIZE=36176,$n.RENDERBUFFER_GREEN_SIZE=36177,$n.RENDERBUFFER_BLUE_SIZE=36178,$n.RENDERBUFFER_ALPHA_SIZE=36179,$n.RENDERBUFFER_DEPTH_SIZE=36180,$n.RENDERBUFFER_STENCIL_SIZE=36181,$n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$n.COLOR_ATTACHMENT0=36064,$n.DEPTH_ATTACHMENT=36096,$n.STENCIL_ATTACHMENT=36128,$n.DEPTH_STENCIL_ATTACHMENT=33306,$n.NONE=0,$n.FRAMEBUFFER_COMPLETE=36053,$n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$n.FRAMEBUFFER_UNSUPPORTED=36061,$n.FRAMEBUFFER_BINDING=36006,$n.RENDERBUFFER_BINDING=36007,$n.MAX_RENDERBUFFER_SIZE=34024,$n.INVALID_FRAMEBUFFER_OPERATION=1286,$n.UNPACK_FLIP_Y_WEBGL=37440,$n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$n.CONTEXT_LOST_WEBGL=37442,$n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$n.BROWSER_DEFAULT_WEBGL=37444,$n._useProgram=null,$n._depthTest=!0,$n._depthMask=!0,$n._blend=!1,$n._cullFace=!1,$n.curBindTexTarget=null,$n.curBindTexValue=null,$P($n,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$n}(),$JB=function($B){function $_(){$_.__super.call(this)}$I($_,"laya.webgl.display.GraphicsGL",$k);var $Z=$_.prototype;return $Z.setShader=function($B){this._saveToCmd($j.context._setShader,[$B])},$Z.setIBVB=function($B,$_,$Z,$n,$g,$q){this._saveToCmd($j.context._setIBVB,[$B,$_,$Z,$n,$g,$q])},$Z.drawParticle=function($B,$_,$Z){var $n=$t.createParticleTemplate2D($Z);$n.x=$B,$n.y=$_,this._saveToCmd($j.context._drawParticle,[$n])},$_}(),$NB=function($B){var $Z;function $H($B){this._x=0,this._y=0,this._id=++$H._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$H.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$H.MAXCLIPRECT,this.mOutPoint,this._canvas=$B,this._canvas._addReference(),$H._contextcount++,$j.isFlash?(this._ib=$cB.create(35044),$rB.fillIBQuadrangle(this._ib,16)):this._ib=$cB.QuadrangleIB,this.clear()}$I($H,"laya.webgl.canvas.WebGLContext2D",$g);var $_=$H.prototype;return $_.setIsMainContext=function(){this._isMain=!0},$_.clearBG=function($B,$_,$Z,$n){var $g=$zB.mainContext;$g.clearColor($B,$_,$Z,$n),$g.clear(16384)},$_._getSubmits=function(){return this._submits},$_._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $B=0,$_=this._submits._length;$B<$_;$B++)this._submits[$B].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$_.destroy=function(){--$H._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$cB.QuadrangleIB&&this._ib.releaseResource()},$_.clear=function(){this._submits||(this._other=$Z.DEFAULT,this._curMat=$M.create(),this._vb=$EB.create(-1),this._submits=[],this._save=[$O.Create(this)],this._save.length=10,this._shader2D=new $c,this._triangleMesh=$fB.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$Z.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$H.MAXCLIPRECT,this._curSubmit=$qB.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$R.DEFAULT;for(var $B=0,$_=this._submits._length;$B<$_;$B++)this._submits[$B].releaseRender(),this._submits[$B]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$_.size=function($B,$_){if(this._width!=$B||this._height!=$_)if(0==$B||0==$_){0!=this._vb._byteLength&&(this._width=$B,this._height=$_,this._vb.clear(),this._vb.upload());for(var $Z=0,$n=this._submits._length;$Z<$n;$Z++)this._submits[$Z].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$B,this._height=$_,this._targets&&this._targets.size($B,$_),this._canvas.memorySize-=this._canvas.memorySize;0===$B&&0===$_&&this._releaseMem()},$_._getTransformMatrix=function(){return this._curMat},$_.translate=function($B,$_){0===$B&&0===$_||($a.save(this),this._curMat.bTransform&&($d.save(this),this._curMat.transformPointN($Y.TEMP.setTo($B,$_)),$B=$Y.TEMP.x,$_=$Y.TEMP.y),this._x+=$B,this._y+=$_)},$_.save=function(){this._save[this._save._length++]=$O.Create(this)},$_.restore=function(){var $B=this._save._length;if(!($B<1))for(var $_=$B-1;0<=$_;$_--){var $Z=this._save[$_];if($Z.restore(this),$Z.isSaveMark())return void(this._save._length=$_)}},$_._fillText=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){void 0===$D&&($D=0);var $T=this._shader2D,$e=this._curSubmit.shaderValue,$I=$g?$$B.create($g):this._other.font;if($G.enabled)$T.ALPHA!==$e.ALPHA&&($T.glTexture=null),$AB.drawText(this,$B,$_,this._curMat,$I,$m||this._other.textAlign,$q,$P,$k,$Z,$n,$D);else{this._shader2D.defines.getValue();var $A=$q?$$.create($q)._color:$T.colorAdd;$T.ALPHA===$e.ALPHA&&$A===$T.colorAdd&&$e.colorAdd===$T.colorAdd||($T.glTexture=null,$T.colorAdd=$A),$AB.drawText(this,$B,$_,this._curMat,$I,$m||this._other.textAlign,$q,$P,$k,$Z,$n,$D)}},$_.fillWords=function($B,$_,$Z,$n,$g,$q){this._fillText(null,$B,$_,$Z,$n,$g,null,-1,null,$q)},$_.fillBorderWords=function($B,$_,$Z,$n,$g,$q,$P){this._fillBorderText(null,$B,$_,$Z,$n,$g,$q,$P,null)},$_.fillText=function($B,$_,$Z,$n,$g,$q){this._fillText($B,null,$_,$Z,$n,$g,null,-1,$q)},$_.strokeText=function($B,$_,$Z,$n,$g,$q,$P){this._fillText($B,null,$_,$Z,$n,null,$g,$q||1,$P)},$_.fillBorderText=function($B,$_,$Z,$n,$g,$q,$P,$k){this._fillBorderText($B,null,$_,$Z,$n,$g,$q,$P,$k)},$_._fillBorderText=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){if(!$G.enabled)return this._fillText($B,$_,$Z,$n,$g,null,$P,$k||1,$m),void this._fillText($B,$_,$Z,$n,$g,$q,null,-1,$m);var $D=this._shader2D,$T=this._curSubmit.shaderValue;$D.ALPHA!==$T.ALPHA&&($D.glTexture=null);var $e=$g?($H._fontTemp.setFont($g),$H._fontTemp):this._other.font;$AB.drawText(this,$B,$_,this._curMat,$e,$m||this._other.textAlign,$q,$P,$k||1,$Z,$n,0)},$_.fillRect=function($B,$_,$Z,$n,$g){var $q=this._vb;if($rB.fillRectImgVb($q,this._clipRect,$B,$_,$Z,$n,$f.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $P=this._shader2D.fillStyle;$g&&(this._shader2D.fillStyle=$R.create($g));var $k=this._shader2D,$m=this._curSubmit.shaderValue;if($k.fillStyle!==$m.fillStyle||$k.ALPHA!==$m.ALPHA){$k.glTexture=null;var $D=this._curSubmit=$qB.createSubmit(this,this._ib,$q,($q._byteLength-64)/32*3,$QB.create(2,0));$D.shaderValue.color=$k.fillStyle._color._color,$D.shaderValue.ALPHA=$k.ALPHA,this._submits[this._submits._length++]=$D}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$P}},$_.fillTexture=function($B,$_,$Z,$n,$g,$q,$P,$k){if($B.loaded&&$B.bitmap&&$B.source){var $m=this._vb,$D=$B.bitmap.width,$T=$B.bitmap.height,$e=$B.uv,$I=$P.x%$B.width,$A=$P.y%$B.height;if($D!=$k.w||$T!=$k.h){if(!$k.w&&!$k.h)switch($k.oy=$k.ox=0,$q){case"repeat":$k.width=$n,$k.height=$g;break;case"repeat-x":$k.width=$n,$A<0?$B.height+$A>$g?$k.height=$g:$k.height=$B.height+$A:($k.oy=$A,$B.height+$A>$g?$k.height=$g-$A:$k.height=$B.height);break;case"repeat-y":$I<0?$B.width+$I>$n?$k.width=$n:$k.width=$B.width+$I:($k.ox=$I,$B.width+$I>$n?$k.width=$n-$I:$k.width=$B.width),$k.height=$g;break;case"no-repeat":$I<0?$B.width+$I>$n?$k.width=$n:$k.width=$B.width+$I:($k.ox=$I,$B.width+$I>$n?$k.width=$n-$I:$k.width=$B.width),$A<0?$B.height+$A>$g?$k.height=$g:$k.height=$B.height+$A:($k.oy=$A,$B.height+$A>$g?$k.height=$g-$A:$k.height=$B.height);break;default:$k.width=$n,$k.height=$g}$k.w=$D,$k.h=$T,$k.uv=[0,0,$k.width/$D,0,$k.width/$D,$k.height/$T,0,$k.height/$T]}if($_+=$k.ox,$Z+=$k.oy,$I-=$k.ox,$A-=$k.oy,$rB.fillRectImgVb($m,this._clipRect,$_,$Z,$k.width,$k.height,$k.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $$=$uB.create(this,this._ib,$m,($m._byteLength-64)/32*3,$QB.create(256,0)),$w=(this._submits[this._submits._length++]=$$).shaderValue;$w.textureHost=$B;var $r=$e[0]*$D,$j=$e[1]*$T,$y=($e[2]-$e[0])*$D,$C=($e[5]-$e[3])*$T,$z=-$I/$D,$t=-$A/$T;$w.u_TexRange[0]=$r/$D,$w.u_TexRange[1]=$y/$D,$w.u_TexRange[2]=$j/$T,$w.u_TexRange[3]=$C/$T,$w.u_offset[0]=$z,$w.u_offset[1]=$t,$G.enabled&&!this._isMain&&$$.addTexture($B,($m._byteLength>>2)-16),(this._curSubmit=$$)._renderType=10017,$$._numEle+=6}}else this.sprite&&$J.timer.callLater(this,this._repaintSprite)},$_.setShader=function($B){$s.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$B},$_.setFilters=function($B){$s.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$B,this._curSubmit=$qB.RENDERBASE,this._renderKey=0,this._drawCount++},$_.drawTexture=function($B,$_,$Z,$n,$g,$q,$P){this._drawTextureM($B,$_,$Z,$n,$g,$q,$P,null,1)},$_.addTextureVb=function($B,$_,$Z){var $n=this._curSubmit._vb||this._vb,$g=$n._byteLength>>2;$n.byteLength=$g+16<<2;for(var $q=$n.getFloat32Array(),$P=0;$P<16;$P+=4)$q[$g++]=$B[$P]+$_,$q[$g++]=$B[$P+1]+$Z,$q[$g++]=$B[$P+2],$q[$g++]=$B[$P+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$n._upload=!0},$_.willDrawTexture=function($B,$_){if(!($B.loaded&&$B.bitmap&&$B.source))return this.sprite&&$J.timer.callLater(this,this._repaintSprite),0;var $Z=$B.bitmap,$n=$Z.id+this._shader2D.ALPHA*$_+10016;if($n==this._renderKey)return $n;var $g=this._shader2D,$q=$g.ALPHA,$P=this._curSubmit.shaderValue;$g.ALPHA*=$_,this._renderKey=$n,this._drawCount++,$g.glTexture=$Z;var $k=this._vb,$m=null,$D=$k._byteLength/32*3,$T=$P.textureHost&&$P.textureHost==$B&&$P.textureHost.alphaTexture==$B.alphaTexture;return $m=$uB.create(this,this._ib,$k,$D,$QB.create(1,0)),(this._submits[this._submits._length++]=$m).shaderValue.textureHost=$B,$m._renderType=10016,$m._preIsSameTextureShader=10016===this._curSubmit._renderType&&$g.ALPHA===$P.ALPHA&&$T,this._curSubmit=$m,$g.ALPHA=$q,$n},$_.drawTextures=function($B,$_,$Z,$n){if($B.loaded&&$B.bitmap&&$B.source){var $g=this._clipRect;if(this._clipRect=$H.MAXCLIPRECT,this._drawTextureM($B,$_[0],$_[1],$B.width,$B.height,$Z,$n,null,1)){if(this._clipRect=$g,$V.drawCall++,!($_.length<4)){for(var $q=this._curSubmit._vb||this._vb,$P=this._curMat.a,$k=this._curMat.d,$m=2,$D=$_.length;$m<$D;$m+=2)$rB.copyPreImgVb($q,($_[$m]-$_[$m-2])*$P,($_[$m+1]-$_[$m-1])*$k),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$J.timer.callLater(this,this._repaintSprite)},$_._drawTextureM=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){if(!$B.loaded||!$B.source)return this.sprite&&$J.timer.callLater(this,this._repaintSprite),!1;var $D=this._curSubmit._vb||this._vb,$T=$B.bitmap;$_+=$q,$Z+=$P,this._drawCount++;var $e=$T.id+this._shader2D.ALPHA*$m+10016;if($e!=this._renderKey){this._renderKey=$e;var $I=this._curSubmit.shaderValue,$A=this._shader2D,$$=$A.ALPHA;$A.ALPHA*=$m,$A.glTexture=$T;var $w=this._vb,$r=null,$j=$w._byteLength/32*3,$y=$I.textureHost&&$I.textureHost==$B&&$I.textureHost.alphaTexture==$B.alphaTexture;$r=$uB.create(this,this._ib,$w,$j,$QB.create(1,0)),(this._submits[this._submits._length++]=$r).shaderValue.textureHost=$B,$r._renderType=10016,$r._preIsSameTextureShader=10016===this._curSubmit._renderType&&$A.ALPHA===$I.ALPHA&&$y,this._curSubmit=$r,$D=this._curSubmit._vb||this._vb,$A.ALPHA=$$}return!!$rB.fillRectImgVb($D,this._clipRect,$_,$Z,$n||$B.width,$g||$B.height,$B.uv,$k||this._curMat,this._x,this._y,0,0)&&($G.enabled&&!this._isMain&&this._curSubmit.addTexture($B,($D._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$_._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$_._drawText=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){var $T=$B.bitmap;this._drawCount++;var $e=$T.id+this._shader2D.ALPHA+10016;if($e!=this._renderKey){this._renderKey=$e;var $I=this._curSubmit.shaderValue,$A=this._shader2D;$A.glTexture=$T;var $$=this._vb,$w=null,$r=$$._byteLength/32*3,$j=$I.textureHost&&$I.textureHost==$B&&$I.textureHost.alphaTexture==$B.alphaTexture;($w=$G.enabled?$uB.create(this,this._ib,$$,$r,$QB.create(1,0)):$uB.create(this,this._ib,$$,$r,$aB.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$A.ALPHA===$I.ALPHA&&$j,(this._submits[this._submits._length++]=$w).shaderValue.textureHost=$B,$w._renderType=10016,this._curSubmit=$w}$B.active();var $y=this._curSubmit._vb||this._vb;$rB.fillRectImgVb($y,this._clipRect,$_+$P,$Z+$k,$n||$B.width,$g||$B.height,$B.uv,$q||this._curMat,this._x,this._y,$m,$D,!0)&&($G.enabled&&!this._isMain&&this._curSubmit.addTexture($B,($y._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$_.drawTextureWithTransform=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){if($q){var $D=this._curMat,$T=this._x,$e=this._y;(0!==$P||0!==$k)&&(this._x=$P*$D.a+$k*$D.c,this._y=$k*$D.d+$P*$D.b),$q&&$D.bTransform?($M.mul($q,$D,$H._tmpMatrix),($q=$H._tmpMatrix)._checkTransform()):(this._x+=$D.tx,this._y+=$D.ty),this._drawTextureM($B,$_,$Z,$n,$g,0,0,$q,$m),this._x=$T,this._y=$e}else this._drawTextureM($B,$_,$Z,$n,$g,$P,$k,null,$m)},$_.fillQuadrangle=function($B,$_,$Z,$n,$g){var $q=this._curSubmit,$P=this._vb,$k=this._shader2D,$m=$q.shaderValue;if(this._renderKey=0,$B.bitmap){var $D=$B.bitmap;$k.glTexture==$D&&$k.ALPHA===$m.ALPHA||($k.glTexture=$D,($q=this._curSubmit=$qB.createSubmit(this,this._ib,$P,$P._byteLength/32*3,$QB.create(1,0))).shaderValue.glTexture=$D,this._submits[this._submits._length++]=$q),$rB.fillQuadrangleImgVb($P,$_,$Z,$n,$B.uv,$g||this._curMat,this._x,this._y)}else $q.shaderValue.fillStyle&&$q.shaderValue.fillStyle.equal($B)&&$k.ALPHA===$m.ALPHA||($k.glTexture=null,($q=this._curSubmit=$qB.createSubmit(this,this._ib,$P,$P._byteLength/32*3,$QB.create(2,0))).shaderValue.defines.add(2),$q.shaderValue.fillStyle=$R.create($B),this._submits[this._submits._length++]=$q),$rB.fillQuadrangleImgVb($P,$_,$Z,$n,$f.DEF_UV,$g||this._curMat,this._x,this._y);$q._numEle+=6},$_.drawTexture2=function($B,$_,$Z,$n,$g,$q,$P,$k){if(0!=$q){var $m=this._curMat;if(this._x=$B*$m.a+$_*$m.c,this._y=$_*$m.d+$B*$m.b,$g&&($g=$m.bTransform||$g.bTransform?($M.mul($g,$m,$H._tmpMatrix),$H._tmpMatrix):(this._x+=$g.tx+$m.tx,this._y+=$g.ty+$m.ty,$M.EMPTY)),1!==$q||$P){var $D=this._shader2D.ALPHA,$T=this._nBlendType;this._shader2D.ALPHA=$q,$P&&(this._nBlendType=$X.TOINT($P)),this._drawTextureM($k[0],$k[1]-$Z,$k[2]-$n,$k[3],$k[4],0,0,$g,1),this._shader2D.ALPHA=$D,this._nBlendType=$T}else this._drawTextureM($k[0],$k[1]-$Z,$k[2]-$n,$k[3],$k[4],0,0,$g,1);this._x=this._y=0}},$_.drawCanvas=function($B,$_,$Z,$n,$g){var $q=$B.context;if(this._renderKey=0,$q._targets)this._submits[this._submits._length++]=$FB.create($q,0,null),this._curSubmit=$qB.RENDERBASE,$q._targets.drawTo(this,$_,$Z,$n,$g);else{var $P=this._submits[this._submits._length++]=$FB.create($q,this._shader2D.ALPHA,this._shader2D.filters),$k=$n/$B.width,$m=$g/$B.height,$D=$P._matrix;this._curMat.copyTo($D),1!=$k&&1!=$m&&$D.scale($k,$m);var $T=$D.tx,$e=$D.ty;$D.tx=$D.ty=0,$D.transformPoint($Y.TEMP.setTo($_,$Z)),$D.translate($Y.TEMP.x+$T,$Y.TEMP.y+$e),this._curSubmit=$qB.RENDERBASE}$N.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$q._targets?"yellow":"green",this.strokeRect($_-1,$Z-1,$n+2,$g+2,1),this.strokeRect($_,$Z,$n,$g,1),this.restore())},$_.drawTarget=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){void 0===$D&&($D=-1);var $T=this._vb;if($rB.fillRectImgVb($T,this._clipRect,$_,$Z,$n,$g,$m||$f.DEF_UV,$q||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $e=this._curSubmit=$eB.create(this,this._ib,$T,($T._byteLength-64)/32*3,$k,$P);$e.blendType=-1==$D?this._nBlendType:$D,$e.scope=$B,this._submits[this._submits._length++]=$e,this._curSubmit._numEle+=6}},$_.mixRGBandAlpha=function($B){return this._mixRGBandAlpha($B,this._shader2D.ALPHA)},$_._mixRGBandAlpha=function($B,$_){var $Z=(4278190080&$B)>>>24;return 0!=$Z?$Z*=$_:$Z=255*$_,16777215&$B|$Z<<24},$_.drawTriangles=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){if(!$B.loaded||!$B.source)return this.sprite&&$J.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$B.bitmap;var $T=this._mixRGBandAlpha(4294967295,$k),$e=($n.length,$q.length);this._renderKey=-1;var $I=this._curSubmit=$uB.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$QB.create(1,0));return $I.shaderValue.textureHost=$B,$I._renderType=10016,this._submits[this._submits._length++]=$I,$P?($H._tmpMatrix.a=$P.a,$H._tmpMatrix.b=$P.b,$H._tmpMatrix.c=$P.c,$H._tmpMatrix.d=$P.d,$H._tmpMatrix.tx=$P.tx+$_,$H._tmpMatrix.ty=$P.ty+$Z,$M.mul($H._tmpMatrix,this._curMat,$H._tmpMatrix)):($H._tmpMatrix.a=this._curMat.a,$H._tmpMatrix.b=this._curMat.b,$H._tmpMatrix.c=this._curMat.c,$H._tmpMatrix.d=this._curMat.d,$H._tmpMatrix.tx=this._curMat.tx+$_,$H._tmpMatrix.ty=this._curMat.ty+$Z),this._triangleMesh.addData($n,$g,$q,$H._tmpMatrix,$T,this),this._curSubmit._numEle+=$e,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$_.transform=function($B,$_,$Z,$n,$g,$q){$d.save(this),$M.mul($M.TEMP.setTo($B,$_,$Z,$n,$g,$q),this._curMat,this._curMat),this._curMat._checkTransform()},$_.setTransformByMatrix=function($B){$B.copyTo(this._curMat)},$_.transformByMatrix=function($B){$d.save(this),$M.mul($B,this._curMat,this._curMat),this._curMat._checkTransform()},$_.rotate=function($B){$d.save(this),this._curMat.rotateEx($B)},$_.scale=function($B,$_){$d.save(this),this._curMat.scaleEx($B,$_)},$_.clipRect=function($B,$_,$Z,$n){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $g=$TB.create(4);this.addRenderObject($g);var $q=this._vb,$P=$q._byteLength>>2;if($rB.fillRectImgVb($q,null,$B,$_,$Z,$n,$f.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $k=this._curSubmit=$qB.createSubmit(this,this._ib,$q,($q._byteLength-64)/32*3,$QB.create(2,0));$k.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$k,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $m=$TB.create(5);this.addRenderObject($m);var $D=$q.getFloat32Array(),$T=Math.min(Math.min(Math.min($D[0+$P],$D[4+$P]),$D[8+$P]),$D[12+$P]),$e=Math.max(Math.max(Math.max($D[0+$P],$D[4+$P]),$D[8+$P]),$D[12+$P]),$I=Math.min(Math.min(Math.min($D[1+$P],$D[5+$P]),$D[9+$P]),$D[13+$P]),$A=Math.max(Math.max(Math.max($D[1+$P],$D[5+$P]),$D[9+$P]),$D[13+$P]);$S.save(this,$m,$B,$_,$Z,$n,$T,$I,$e-$T,$A-$I),this._curSubmit=$qB.RENDERBASE}else{$Z*=this._curMat.a,$n*=this._curMat.d;var $$=$Y.TEMP;this._curMat.transformPoint($$.setTo($B,$_)),$Z<0&&($$.x=$$.x+$Z,$Z=-$Z),$n<0&&($$.y=$$.y+$n,$n=-$n),this._renderKey=0;var $w=this._curSubmit=$DB.create(this);(this._submits[this._submits._length++]=$w).submitIndex=this._submits._length,$w.submitLength=9999999,$U.save(this,$w);var $r=this._clipRect,$j=$r.x,$y=$r.y,$C=$$.x+$Z,$z=$$.y+$n;$j<$$.x&&($r.x=$$.x),$y<$$.y&&($r.y=$$.y),$r.width=Math.min($C,$j+$r.width)-$r.x,$r.height=Math.min($z,$y+$r.height)-$r.y,this._shader2D.glTexture=null,$w.clipRect.copyFrom($r),this._curSubmit=$qB.RENDERBASE}},$_.setIBVB=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T){if(void 0===$m&&($m=0),void 0===$D&&($D=0),void 0===$T&&($T=0),null===$Z){if($j.isFlash){var $e=$n;$e._selfIB||($e._selfIB=$cB.create(35044)),$e._selfIB.clear(),$Z=$e._selfIB}else $Z=this._ib;$rB.expandIBQuadrangle($Z,$n._byteLength/(4*$n.vertexStride*4))}if(!$k||!$P)throw Error("setIBVB must input:shader shaderValues");var $I=$mB.create(this,$n,$Z,$g,$P,$k,$m,$D,$T);$q||($q=$M.EMPTY),$q.translate($B,$_),$M.mul($q,this._curMat,$I._mat),$q.translate(-$B,-$_),this._submits[this._submits._length++]=$I,this._curSubmit=$qB.RENDERBASE,this._renderKey=0},$_.addRenderObject=function($B){this._submits[this._submits._length++]=$B},$_.fillTrangles=function($B,$_,$Z,$n,$g){var $q=this._curSubmit,$P=this._vb,$k=this._shader2D,$m=$q.shaderValue,$D=$n.length>>4,$T=$B.bitmap;this._renderKey=0,$k.glTexture==$T&&$k.ALPHA===$m.ALPHA||(($q=this._curSubmit=$qB.createSubmit(this,this._ib,$P,$P._byteLength/32*3,$QB.create(1,0))).shaderValue.textureHost=$B,this._submits[this._submits._length++]=$q),$rB.fillTranglesVB($P,$_,$Z,$n,$g||this._curMat,this._x,this._y),$q._numEle+=6*$D},$_.submitElement=function($B,$_){var $Z=this._submits;for($_<0&&($_=$Z._length);$B<$_;)$B+=$Z[$B].renderSubmit()},$_.finish=function(){$zB.mainContext.finish()},$_.flush=function(){var $B=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($B>this._ib.bufferLength/12&&$rB.expandIBQuadrangle(this._ib,$B),!this._isMain&&$G.enabled&&$G._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$G._atlasRestore;for(var $_=this._submits,$Z=0,$n=$_._length;$Z<$n;$Z++){var $g=$_[$Z];10016===$g.getRenderType()&&$g.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$_B.instance&&$_B.getInstance().reset();var $q;for($Z=0,$q=this.meshlist.length;$Z<$q;$Z++){var $P=this.meshlist[$Z];$P.canReuse?$P.releaseMesh():$P.destroy()}return this.meshlist.length=0,this._curSubmit=$qB.RENDERBASE,this._renderKey=0,this._triangleMesh=$fB.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$_.setPathId=function($B){if(this.mId=$B,-1!=this.mId){this.mHaveKey=!1;var $_=$x.getInstance();$_.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$_.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$_.movePath=function($B,$_){var $Z=$B,$n=$_;$B=this._curMat.a*$Z+this._curMat.c*$n+this._curMat.tx,$_=this._curMat.b*$Z+this._curMat.d*$n+this._curMat.ty,this.mX+=$B,this.mY+=$_},$_.beginPath=function(){var $B=this._getPath();$B.tempArray.length=0,$B.closePath=!1,this.mX=0,this.mY=0},$_.closePath=function(){this._path.closePath=!0},$_.fill=function($B){void 0===$B&&($B=!1);var $_=this._getPath();this.drawPoly(0,0,$_.tempArray,this.fillStyle._color.numColor,0,0,$B)},$_.stroke=function(){var $B=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$B.drawLine(0,0,$B.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $_=$x.getInstance().shapeLineDic[this.mId];$_.rebuild($B.tempArray),$B.setGeomtry($_)}else $x.getInstance().addLine(this.mId,$B.drawLine(0,0,$B.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$B.update();var $Z=[this.mX,this.mY],$n=$qB.createShape(this,$B.ib,$B.vb,$B.count,$B.offset,$QB.create(4,0));$n.shaderValue.ALPHA=this._shader2D.ALPHA,$n.shaderValue.u_pos=$Z,$n.shaderValue.u_mmat2=$yB.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$n,this._renderKey=-1}},$_.line=function($B,$_,$Z,$n,$g,$q){var $P=this._curSubmit,$k=this._vb;if($rB.fillLineVb($k,this._clipRect,$B,$_,$Z,$n,$g,$q)){this._renderKey=0;var $m=this._shader2D,$D=$P.shaderValue;$m.strokeStyle===$D.strokeStyle&&$m.ALPHA===$D.ALPHA||($m.glTexture=null,($P=this._curSubmit=$qB.createSubmit(this,this._ib,$k,($k._byteLength-64)/32*3,$QB.create(2,0))).shaderValue.strokeStyle=$m.strokeStyle,$P.shaderValue.mainID=2,$P.shaderValue.ALPHA=$m.ALPHA,this._submits[this._submits._length++]=$P),$P._numEle+=6}},$_.moveTo=function($B,$_,$Z){void 0===$Z&&($Z=!0);var $n=this._getPath();if($Z){var $g=$B,$q=$_;$B=this._curMat.a*$g+this._curMat.c*$q,$_=this._curMat.b*$g+this._curMat.d*$q}$n.addPoint($B,$_)},$_.lineTo=function($B,$_,$Z){void 0===$Z&&($Z=!0);var $n=this._getPath();if($Z){var $g=$B,$q=$_;$B=this._curMat.a*$g+this._curMat.c*$q,$_=this._curMat.b*$g+this._curMat.d*$q}$n.addPoint($B,$_)},$_.drawCurves=function($B,$_,$Z){this.setPathId(-1),this.beginPath(),this.strokeStyle=$Z[3],this.lineWidth=$Z[4];var $n=$Z[2];$B+=$Z[0],$_+=$Z[1],this.movePath($B,$_),this.moveTo($n[0],$n[1]);for(var $g=2,$q=$n.length;$g<$q;)this.quadraticCurveTo($n[$g++],$n[$g++],$n[$g++],$n[$g++]);this.stroke()},$_.arcTo=function($B,$_,$Z,$n,$g){if(-1==this.mId||!this.mHaveKey){var $q=0,$P=0,$k=0,$m=this._getPath();this._curMat.copyTo($H._tmpMatrix),$H._tmpMatrix.tx=$H._tmpMatrix.ty=0,$H._tempPoint.setTo($m.getEndPointX(),$m.getEndPointY()),$H._tmpMatrix.invertTransformPoint($H._tempPoint);var $D=$H._tempPoint.x-$B,$T=$H._tempPoint.y-$_,$e=Math.sqrt($D*$D+$T*$T);if(!($e<=1e-6)){var $I=$D/$e,$A=$T/$e,$$=$Z-$B,$w=$n-$_,$r=$$*$$+$w*$w,$j=Math.sqrt($r);if(!($j<=1e-6)){var $y=$$/$j,$C=$w/$j,$z=$I+$y,$t=$A+$C,$J=Math.sqrt($z*$z+$t*$t);if(!($J<=1e-6)){var $N=$z/$J,$Q=$t/$J,$M=Math.acos($N*$I+$Q*$A),$Y=Math.PI/2-$M,$l=($e=$g/Math.tan($Y))*$I+$B,$L=$e*$A+$_,$v=Math.sqrt($e*$e+$g*$g),$V=$B+$N*$v,$o=$_+$Q*$v,$F=0,$u=0;if(0<=$I*$C-$A*$y){var $f=2*$Y/$H.SEGNUM;$F=Math.sin($f),$u=Math.cos($f)}else $f=2*-$Y/$H.SEGNUM,$F=Math.sin($f),$u=Math.cos($f);$P=this._curMat.a*$l+this._curMat.c*$L,$k=this._curMat.b*$l+this._curMat.d*$L,$P==this._path.getEndPointX()&&$k==this._path.getEndPointY()||$m.addPoint($P,$k);var $b=$l-$V,$x=$L-$o;for($q=0;$q<$H.SEGNUM;$q++){var $p=$b*$u+$x*$F,$K=-$b*$F+$x*$u;$P=$p+$V,$k=$K+$o,$B=this._curMat.a*$P+this._curMat.c*$k,$k=$_=this._curMat.b*$P+this._curMat.d*$k,($P=$B)==this._path.getEndPointX()&&$k==this._path.getEndPointY()||$m.addPoint($P,$k),$b=$p,$x=$K}}}}}},$_.arc=function($B,$_,$Z,$n,$g,$q,$P){if(void 0===$q&&($q=!1),void 0===$P&&($P=!0),-1!=this.mId){var $k=$x.getInstance().shapeDic[this.mId];if($k&&this.mHaveKey&&!$k.needUpdate(this._curMat))return;$_=$B=0}var $m,$D=0,$T=0,$e=0,$I=0,$A=0,$$=0,$w=0;if($T=$g-$n,$q)if(Math.abs($T)>=2*Math.PI)$T=2*-Math.PI;else for(;0<$T;)$T-=2*Math.PI;else if(Math.abs($T)>=2*Math.PI)$T=2*Math.PI;else for(;$T<0;)$T+=2*Math.PI;$m=$T/($w=$Z<101?Math.max(10,$T*$Z/5):$Z<201?Math.max(10,$T*$Z/20):Math.max(10,$T*$Z/40))/2,$e=Math.abs(4/3*(1-Math.cos($m))/Math.sin($m)),$q&&($e=-$e);var $r=this._getPath(),$j=NaN,$y=NaN;for($$=0;$$<=$w;$$++)$D=$n+$T*($$/$w),$I=$B+Math.cos($D)*$Z,$A=$_+Math.sin($D)*$Z,$P&&($j=$I,$y=$A,$I=this._curMat.a*$j+this._curMat.c*$y,$A=this._curMat.b*$j+this._curMat.d*$y),$I==this._path.getEndPointX()&&$A==this._path.getEndPointY()||$r.addPoint($I,$A);$I=$B+Math.cos($g)*$Z,$A=$_+Math.sin($g)*$Z,$P&&($j=$I,$y=$A,$I=this._curMat.a*$j+this._curMat.c*$y,$A=this._curMat.b*$j+this._curMat.d*$y),$I==this._path.getEndPointX()&&$A==this._path.getEndPointY()||$r.addPoint($I,$A)},$_.quadraticCurveTo=function($B,$_,$Z,$n){var $g=$e.I,$q=$Z,$P=$n;$Z=this._curMat.a*$q+this._curMat.c*$P,$n=this._curMat.b*$q+this._curMat.d*$P,$q=$B,$P=$_,$B=this._curMat.a*$q+this._curMat.c*$P,$_=this._curMat.b*$q+this._curMat.d*$P;for(var $k=$g.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$B,$_,$Z,$n],30,2),$m=0,$D=$k.length/2;$m<$D;$m++)this.lineTo($k[2*$m],$k[2*$m+1],!1);this.lineTo($Z,$n,!1)},$_.rect=function($B,$_,$Z,$n){this._other=this._other.make(),this._other.path||(this._other.path=new $h),this._other.path.rect($B,$_,$Z,$n)},$_.strokeRect=function($B,$_,$Z,$n,$g){var $q=.5*$g;this.line($B-$q,$_,$B+$Z+$q,$_,$g,this._curMat),this.line($B+$Z,$_,$B+$Z,$_+$n,$g,this._curMat),this.line($B,$_,$B,$_+$n,$g,this._curMat),this.line($B-$q,$_+$n,$B+$Z+$q,$_+$n,$g,this._curMat)},$_.clip=function(){},$_.drawPoly=function($B,$_,$Z,$n,$g,$q,$P){void 0===$P&&($P=!1),this._renderKey=0,this._shader2D.glTexture=null;var $k=this._getPath();if(-1==this.mId)$k.polygon($B,$_,$Z,$n,$g||1,$q);else if(this.mHaveKey){var $m=$x.getInstance().shapeDic[this.mId];$m.setMatrix(this._curMat),$m.rebuild($k.tempArray),$k.setGeomtry($m)}else{var $D=$k.polygon($B,$_,$Z,$n,$g||1,$q);$x.getInstance().addShape(this.mId,$D),$D.setMatrix(this._curMat)}$k.update();var $T,$e=[this.mX,this.mY];if(($T=$qB.createShape(this,$k.ib,$k.vb,$k.count,$k.offset,$QB.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$T.shaderValue.u_pos=$e,$T.shaderValue.u_mmat2=$yB.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$T,0<$g){if(this.mHaveLineKey){var $I=$x.getInstance().shapeLineDic[this.mId];$I.rebuild($k.tempArray),$k.setGeomtry($I)}else $x.getInstance().addShape(this.mId,$k.drawLine($B,$_,$Z,$g,$q));$k.update(),($T=$qB.createShape(this,$k.ib,$k.vb,$k.count,$k.offset,$QB.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$T.shaderValue.u_mmat2=$yB.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$T}},$_.drawParticle=function($B,$_,$Z){$Z.x=$B,$Z.y=$_,this._submits[this._submits._length++]=$Z},$_._getPath=function(){return this._path||(this._path=new $h)},$n(0,$_,"globalCompositeOperation",function(){return $X.NAMES[this._nBlendType]},function($B){var $_=$X.TOINT[$B];null==$_||this._nBlendType===$_||($s.save(this,65536,this,!0),this._curSubmit=$qB.RENDERBASE,this._renderKey=0,this._nBlendType=$_)}),$n(0,$_,"strokeStyle",function(){return this._shader2D.strokeStyle},function($B){this._shader2D.strokeStyle.equal($B)||($s.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$R.create($B))}),$n(0,$_,"globalAlpha",function(){return this._shader2D.ALPHA},function($B){($B=Math.floor(1e3*$B)/1e3)!=this._shader2D.ALPHA&&($s.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$B)}),$n(0,$_,"asBitmap",null,function($B){if($B){if(this._targets||(this._targets=new $i),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$n(0,$_,"fillStyle",function(){return this._shader2D.fillStyle},function($B){this._shader2D.fillStyle.equal($B)||($s.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$R.create($B))}),$n(0,$_,"textAlign",function(){return this._other.textAlign},function($B){this._other.textAlign===$B||(this._other=this._other.make(),$s.save(this,32768,this._other,!1),this._other.textAlign=$B)}),$n(0,$_,"lineWidth",function(){return this._other.lineWidth},function($B){this._other.lineWidth===$B||(this._other=this._other.make(),$s.save(this,256,this._other,!1),this._other.lineWidth=$B)}),$n(0,$_,"textBaseline",function(){return this._other.textBaseline},function($B){this._other.textBaseline===$B||(this._other=this._other.make(),$s.save(this,16384,this._other,!1),this._other.textBaseline=$B)}),$n(0,$_,"font",null,function($B){$B!=this._other.font.toString()&&(this._other=this._other.make(),$s.save(this,8,this._other,!1),this._other.font===$$B.EMPTY?this._other.font=new $$B($B):this._other.font.setFont($B))}),$H.__init__=function(){$Z.DEFAULT=new $Z},$H._tempPoint=new $Y,$H._SUBMITVBSIZE=32e3,$H._MAXSIZE=99999999,$H._RECTVBSIZE=16,$H.MAXCLIPRECT=new $l(0,0,99999999,99999999),$H._COUNT=0,$H._tmpMatrix=new $M,$H.SEGNUM=32,$H._contextcount=0,$P($H,["_fontTemp",function(){return this._fontTemp=new $$B},"_drawStyleTemp",function(){return this._drawStyleTemp=new $R(null)}]),$H.__init$=function(){$Z=function(){function $B(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$$B.EMPTY}$I($B,"");var $_=$B.prototype;return $_.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$$B.EMPTY},$_.make=function(){return this===$B.DEFAULT?new $B:this},$B.DEFAULT=null,$B}()},$H}(),$QB=function($B){function $n($B,$_){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$n.__super.call(this),this.defines=new $LB,this.position=$n._POSITION,this.mainID=$B,this.subID=$_,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$B|$_,this._inClassCache=$n._cache[this._cacheID],0<$B&&!this._inClassCache&&(this._inClassCache=$n._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$I($n,"laya.webgl.shader.d2.value.Value2D",$K);var $_=$n.prototype;return $_.setValue=function($B){},$_.refresh=function(){var $B=this.size;return $B[0]=$yB.width,$B[1]=$yB.height,this.alpha=this.ALPHA*$yB.worldAlpha,this.mmat=$yB.worldMatrix4,this},$_._ShaderWithCompile=function(){return $OB.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$iB.create)},$_._withWorldShaderDefines=function(){var $B=$yB.worldShaderDefines,$_=$OB.sharders[this.mainID|this.defines._value|$B.getValue()];if(!$_){var $Z,$n={};for($Z in this.defines.toNameDic())$n[$Z]="";for($Z in $B.toNameDic())$n[$Z]="";$_=$OB.withCompile2D(0,this.mainID,$n,this.mainID|this.defines._value|$B.getValue(),$iB.create)}var $g=$yB.worldFilters;if(!$g)return $_;for(var $q,$P=$g.length,$k=0;$k<$P;$k++)($q=$g[$k])&&$q.action.setValue(this);return $_},$_.upload=function(){var $B=$yB;this.alpha=this.ALPHA*$B.worldAlpha,$yB.worldMatrix4!==$yB.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$zB.shaderHighPrecision&&this.defines.add(1024);var $_,$Z=$B.worldShaderDefines?this._withWorldShaderDefines():$OB.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$B.width,this.size[1]=$B.height,this.mmat=$B.worldMatrix4,$bB.activeShader!==$Z?$Z._shaderValueWidth!==$B.width||$Z._shaderValueHeight!==$B.height?($Z._shaderValueWidth=$B.width,$Z._shaderValueHeight=$B.height):$_=$Z._params2dQuick2||$Z._make2dQuick2():$Z._shaderValueWidth!==$B.width||$Z._shaderValueHeight!==$B.height?($Z._shaderValueWidth=$B.width,$Z._shaderValueHeight=$B.height):$_=$Z._params2dQuick1||$Z._make2dQuick1(),$Z.upload(this,$_)},$_.setFilters=function($B){if(this.filters=$B)for(var $_,$Z=$B.length,$n=0;$n<$Z;$n++)($_=$B[$n])&&(this.defines.add($_.type),$_.action.setValue(this))},$_.clear=function(){this.defines.setValue(this.subID)},$_.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$n._initone=function($B,$_){$n._typeClass[$B]=$_,$n._cache[$B]=[],$n._cache[$B]._length=0},$n.__init__=function(){$n._POSITION=[2,5126,!1,4*$wB.BYTES_PE,0],$n._TEXCOORD=[2,5126,!1,4*$wB.BYTES_PE,2*$wB.BYTES_PE],$n._initone(2,$HB),$n._initone(4,$XB),$n._initone(256,$GB),$n._initone(512,$KB),$n._initone(1,$WB),$n._initone(65,$aB),$n._initone(9,$WB)},$n.create=function($B,$_){var $Z=$n._cache[$B|$_];return $Z._length?$Z[--$Z._length]:new $n._typeClass[$B|$_]($_)},$n._POSITION=null,$n._TEXCOORD=null,$n._cache=[],$n._typeClass=[],$n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$n}(),$MB=function($B){function $r($B,$_){$r.__super.call(this,$B,$_)}$I($r,"laya.webgl.utils.RenderSprite3D",$y);var $_=$r.prototype;return $_.onCreate=function($B){switch($B){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$_._mask=function($B,$_,$Z,$n){var $g,$q,$P=this._next,$k=$B.mask;if($k){$_.ctx.save();var $m=$_.ctx.globalCompositeOperation,$D=new $l;if($D.copyFrom($k.getBounds()),$D.width=Math.round($D.width),$D.height=Math.round($D.height),$D.x=Math.round($D.x),$D.y=Math.round($D.y),0<$D.width&&0<$D.height){var $T=$B._style._tf,$e=$kB.create();$e.addValue("bounds",$D),$g=$PB.create([$e,$_],laya.webgl.utils.RenderSprite3D.tmpTarget),$_.addRenderObject($g),$k.render($_,-$D.x,-$D.y),$g=$PB.create([$e],laya.webgl.utils.RenderSprite3D.endTmpTarget),$_.addRenderObject($g),$_.ctx.save(),$_.clipRect($Z-$T.translateX+$D.x,$n-$T.translateY+$D.y,$D.width,$D.height),$P._fun.call($P,$B,$_,$Z,$n),$_.ctx.restore(),$q=$TB.create(6),$m=$_.ctx.globalCompositeOperation,$q.blendMode="mask",$_.addRenderObject($q),$M.TEMP.identity();var $I=$QB.create(1,0),$A=$f.INV_UV,$$=$D.width,$w=$D.height;($D.width<32||$D.height<32)&&(($A=$r.tempUV)[0]=0,$A[1]=0,$A[2]=32<=$D.width?1:$D.width/32,$A[3]=0,$A[4]=32<=$D.width?1:$D.width/32,$A[5]=32<=$D.height?1:$D.height/32,$A[6]=0,$A[7]=32<=$D.height?1:$D.height/32,$D.width=32<=$D.width?$D.width:32,$D.height=32<=$D.height?$D.height:32,$A[1]*=-1,$A[3]*=-1,$A[5]*=-1,$A[7]*=-1,$A[1]+=1,$A[3]+=1,$A[5]+=1,$A[7]+=1),$_.ctx.drawTarget($e,$Z+$D.x-$T.translateX,$n+$D.y-$T.translateY,$$,$w,$M.TEMP,"tmpTarget",$I,$A,6),$g=$PB.create([$e],laya.webgl.utils.RenderSprite3D.recycleTarget),$_.addRenderObject($g),($q=$TB.create(6)).blendMode=$m,$_.addRenderObject($q)}$_.ctx.restore()}else $P._fun.call($P,$B,$_,$Z,$n)},$_._blend=function($B,$_,$Z,$n){var $g=$B._style,$q=this._next;$g.blendMode?($_.ctx.save(),$_.ctx.globalCompositeOperation=$g.blendMode,$q._fun.call($q,$B,$_,$Z,$n),$_.ctx.restore()):$q._fun.call($q,$B,$_,$Z,$n)},$_._transform=function($B,$_,$Z,$n){var $g=$B.transform,$q=this._next;if($g&&$q!=$y.NORENDER){var $P=$_.ctx;$B._style;$g.tx=$Z,$g.ty=$n;var $k=$P._getTransformMatrix(),$m=$k.clone();$M.mul($g,$k,$k),$k._checkTransform(),$g.tx=$g.ty=0,$q._fun.call($q,$B,$_,0,0),$m.copyTo($k),$m.destroy()}else $q._fun.call($q,$B,$_,$Z,$n)},$r.tmpTarget=function($B,$_){var $Z=$B.getValue("bounds"),$n=$xB.create($Z.width,$Z.height);$n.start(),$n.clear(0,0,0,0),$B.addValue("tmpTarget",$n)},$r.endTmpTarget=function($B){$B.getValue("tmpTarget").end()},$r.recycleTarget=function($B){$B.getValue("tmpTarget").recycle(),$B.recycle()},$P($r,["tempUV",function(){return this.tempUV=new Array(8)}]),$r}(),$YB=function($B){function $_(){this.data=null,$_.__super.call(this)}$I($_,"laya.filters.webgl.ColorFilterActionGL",$p);var $Z=$_.prototype;return $J.imps($Z,{"laya.filters.IFilterActionGL":!0}),$Z.setValue=function($B){$B.colorMat=this.data._mat,$B.colorAlpha=this.data._alpha},$Z.apply3d=function($B,$_,$Z,$n,$g){var $q=$B.getValue("bounds"),$P=$QB.create(1,0);$P.setFilters([this.data]);var $k=$M.TEMP;$k.identity(),$Z.ctx.drawTarget($B,0,0,$q.width,$q.height,$k,"src",$P)},$_}(),$lB=function($B){function $q($B,$_,$Z,$n,$g){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$q.__super.call(this,$B,$_,$g),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $RB,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$Z,this._atlasCanvas.height=$n,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$I($q,"laya.webgl.atlas.Atlaser",$H);var $_=$q.prototype;return $_.computeUVinAtlasTexture=function($B,$_,$Z,$n){var $g=$G.atlasTextureWidth,$q=$G.atlasTextureHeight,$P=$Z/$g,$k=$n/$q,$m=($Z+$B.bitmap.width)/$g,$D=($n+$B.bitmap.height)/$q,$T=$B.bitmap.width/$g,$e=$B.bitmap.height/$q;$B.uv=[$P+$_[0]*$T,$k+$_[1]*$e,$m-(1-$_[2])*$T,$k+$_[3]*$e,$m-(1-$_[4])*$T,$D-(1-$_[5])*$e,$P+$_[6]*$T,$D-(1-$_[7])*$e]},$_.findBitmapIsExist=function($B){if($B instanceof laya.webgl.resource.WebGLImage){var $_=$B,$Z=$_.url,$n=this._InAtlasWebGLImagesKey[$Z||$_.id];if($n)return $n.offsetInfoID}return-1},$_.addToAtlasTexture=function($B,$_,$Z){if($B instanceof laya.webgl.resource.WebGLImage){var $n=$B,$g=$n.url;this._InAtlasWebGLImagesKey[$g||$n.id]={bitmap:$B,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$_,$Z])}this._atlasCanvas.texSubImage2D($_,$Z,$B.atlasSource),$B.clearAtlasSource()},$_.addToAtlas=function($B,$_,$Z){$B._atlasID=this._inAtlasTextureKey.length;var $n=$B.uv.slice(),$g=$B.bitmap;this._inAtlasTextureKey.push($B),this._inAtlasTextureOriUVValue.push($n),this._inAtlasTextureBitmapValue.push($g),this.computeUVinAtlasTexture($B,$n,$_,$Z),$B.bitmap=this._atlasCanvas},$_.clear=function(){for(var $B=0,$_=this._inAtlasTextureKey.length;$B<$_;$B++)this._inAtlasTextureKey[$B].bitmap=this._inAtlasTextureBitmapValue[$B],this._inAtlasTextureKey[$B].uv=this._inAtlasTextureOriUVValue[$B],this._inAtlasTextureKey[$B]._atlasID=-1,this._inAtlasTextureKey[$B].bitmap.lock=!1,this._inAtlasTextureKey[$B].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$_.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$n(0,$_,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$n(0,$_,"texture",function(){return this._atlasCanvas}),$n(0,$_,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$q}(),$LB=function($B){function $Z(){$Z.__super.call(this,$Z.__name2int,$Z.__int2name,$Z.__int2nameMap)}return $I($Z,"laya.webgl.shader.d2.ShaderDefines2D",$E),$Z.__init__=function(){$Z.reg("TEXTURE2D",1),$Z.reg("COLOR2D",2),$Z.reg("PRIMITIVE",4),$Z.reg("GLOW_FILTER",8),$Z.reg("BLUR_FILTER",16),$Z.reg("COLOR_FILTER",32),$Z.reg("COLOR_ADD",64),$Z.reg("WORLDMAT",128),$Z.reg("FILLTEXTURE",256),$Z.reg("FSHIGHPRECISION",1024),$Z.reg("TXTALPHA",2048),$Z.reg("TXTCOMPRESS",4096)},$Z.reg=function($B,$_){$E._reg($B,$_,$Z.__name2int,$Z.__int2name)},$Z.toText=function($B,$_,$Z){return $E._toText($B,$_,$Z)},$Z.toInt=function($B){return $E._toInt($B,$Z.__name2int)},$Z.TEXTURE2D=1,$Z.COLOR2D=2,$Z.PRIMITIVE=4,$Z.FILTERGLOW=8,$Z.FILTERBLUR=16,$Z.FILTERCOLOR=32,$Z.COLORADD=64,$Z.WORLDMAT=128,$Z.FILLTEXTURE=256,$Z.SKINMESH=512,$Z.SHADERDEFINE_FSHIGHPRECISION=1024,$Z.TXTALPHA=2048,$Z.TXTCOMPRESS=4096,$Z.__name2int={},$Z.__int2name=[],$Z.__int2nameMap=[],$Z}(),$vB=(function($B){function $k($B,$_,$Z,$n,$g,$q,$P){$k.__super.call(this,$B,$_,$Z,$n,40,$g,$q,$P)}$I($k,"laya.webgl.shapes.Ellipse",$ZB)}(),function($B){function $q($B,$_,$Z,$n,$g){this._points=[],this.rebuild($Z),$q.__super.call(this,$B,$_,0,0,0,$g,$n,$g,0)}$I($q,"laya.webgl.shapes.Line",$ZB);var $_=$q.prototype;return $_.rebuild=function($B){var $_=$B.length;$_!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($_/2-1)),this.mFloat32Array=new Float32Array(5*$_)),this._points.length=0;for(var $Z=NaN,$n=NaN,$g=-1,$q=-1,$P=$B.length/2,$k=0;$k<$P;$k++)$Z=$B[2*$k],$n=$B[2*$k+1],(.01<Math.abs($g-$Z)||.01<Math.abs($q-$n))&&this._points.push($Z,$n),$g=$Z,$q=$n},$_.getData=function($B,$_,$Z){var $n=[],$g=[];0<this.borderWidth&&this.createLine2(this._points,$n,this.borderWidth,$Z,$g,this._points.length/2),this.mUint16Array.set($n,0),this.mFloat32Array.set($g,0),$B.append(this.mUint16Array),$_.append(this.mFloat32Array)},$q}()),$VB=function($B){function $e($B,$_,$Z,$n,$g){this._points=[];for(var $q=NaN,$P=NaN,$k=-1,$m=-1,$D=$Z.length/2-1,$T=0;$T<$D;$T++)$q=$Z[2*$T],$P=$Z[2*$T+1],(.01<Math.abs($k-$q)||.01<Math.abs($m-$P))&&this._points.push($q,$P),$k=$q,$m=$P;$q=$Z[2*$D],$P=$Z[2*$D+1],$k=this._points[0],$m=this._points[1],(.01<Math.abs($k-$q)||.01<Math.abs($m-$P))&&this._points.push($q,$P),$e.__super.call(this,$B,$_,0,0,this._points.length/2,0,$n,$g)}$I($e,"laya.webgl.shapes.LoopLine",$ZB);var $_=$e.prototype;return $_.getData=function($B,$_,$Z){if(0<this.borderWidth){for(var $n=this.color,$g=($n>>16&255)/255,$q=($n>>8&255)/255,$P=(255&$n)/255,$k=[],$m=0,$D=0,$T=[],$e=Math.floor(this._points.length/2),$I=0;$I<$e;$I++)$m=this._points[2*$I],$D=this._points[2*$I+1],$k.push(this.x+$m,this.y+$D,$g,$q,$P);this.createLoopLine($k,$T,this.borderWidth,$Z+$k.length/5),$B.append(new Uint16Array($T)),$_.append(new Float32Array($k))}},$_.createLoopLine=function($B,$_,$Z,$n,$g,$q){$B.length;var $P=$B.concat(),$k=$g||$B,$m=this.borderColor,$D=($m>>16&255)/255,$T=($m>>8&255)/255,$e=(255&$m)/255,$I=[$P[0],$P[1]],$A=[$P[$P.length-5],$P[$P.length-4]],$$=$A[0]+.5*($I[0]-$A[0]),$w=$A[1]+.5*($I[1]-$A[1]);$P.unshift($$,$w,0,0,0),$P.push($$,$w,0,0,0);var $r,$j,$y,$C,$z,$t,$J,$N,$Q,$M,$Y,$l,$L,$v,$V,$o,$F,$u,$f,$b,$x=$P.length/5,$p=$n,$K=$Z/2;$y=$P[0],$C=$P[1],$M=$y-($z=$P[5]),$Q=($Q=-($C-($t=$P[6])))/($b=Math.sqrt($Q*$Q+$M*$M))*$K,$M=$M/$b*$K,$k.push($y-$Q,$C-$M,$D,$T,$e,$y+$Q,$C+$M,$D,$T,$e);for(var $H=1;$H<$x-1;$H++)$y=$P[5*($H-1)],$C=$P[5*($H-1)+1],$z=$P[5*$H],$t=$P[5*$H+1],$J=$P[5*($H+1)],$N=$P[5*($H+1)+1],$M=$y-$z,$l=$z-$J,$V=(-($Q=($Q=-($C-$t))/($b=Math.sqrt($Q*$Q+$M*$M))*$K)+$y)*(-($M=$M/$b*$K)+$t)-(-$Q+$z)*(-$M+$C),$u=(-($Y=($Y=-($t-$N))/($b=Math.sqrt($Y*$Y+$l*$l))*$K)+$J)*(-($l=$l/$b*$K)+$t)-(-$Y+$z)*(-$l+$N),$f=($L=-$M+$C-(-$M+$t))*($F=-$Y+$z-(-$Y+$J))-($o=-$l+$N-(-$l+$t))*($v=-$Q+$z-(-$Q+$y)),Math.abs($f)<.1?($f+=10.1,$k.push($z-$Q,$t-$M,$D,$T,$e,$z+$Q,$t+$M,$D,$T,$e)):((($r=($v*$u-$F*$V)/$f)-$z)*($r-$z)+(($j=($o*$V-$L*$u)/$f)-$t)+($j-$t),$k.push($r,$j,$D,$T,$e,$z-($r-$z),$t-($j-$t),$D,$T,$e));$q&&($_=$q);var $G=this.edges+1;for($H=1;$H<$G;$H++)$_.push($p+2*($H-1),$p+2*($H-1)+1,$p+2*$H+1,$p+2*$H+1,$p+2*$H,$p+2*($H-1));return $_.push($p+2*($H-1),$p+2*($H-1)+1,$p+1,$p+1,$p,$p+2*($H-1)),$k},$e}(),$oB=function($B){function $P($B,$_,$Z,$n,$g,$q){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$M.create(),this._points=$Z.slice(0,$Z.length),$P.__super.call(this,$B,$_,0,0,this._points.length/2,$n,$g,$q)}$I($P,"laya.webgl.shapes.Polygon",$ZB);var $_=$P.prototype;return $_.rebuild=function($B){this._repaint||(this._points.length=0,this._points=this._points.concat($B))},$_.setMatrix=function($B){$B.copyTo(this._mat)},$_.needUpdate=function($B){return this._repaint=this._mat.a==$B.a&&this._mat.b==$B.b&&this._mat.c==$B.c&&this._mat.d==$B.d&&this._mat.tx==$B.tx&&this._mat.ty==$B.ty,!this._repaint},$_.getData=function($B,$_,$Z){var $n,$g=0,$q=this._points,$P=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$Z){for(this._start=$Z,$n=[],$P=this.earcutTriangles.length,$g=0;$g<$P;$g++)$n.push(this.earcutTriangles[$g]+$Z);this.mUint16Array=new Uint16Array($n)}}else{this._start=$Z,$n=[];var $k=[],$m=[],$D=this.color,$T=($D>>16&255)/255,$e=($D>>8&255)/255,$I=(255&$D)/255;for($P=Math.floor($q.length/2),$g=0;$g<$P;$g++)$k.push(this.x+$q[2*$g],this.y+$q[2*$g+1],$T,$e,$I),$m.push(this.x+$q[2*$g],this.y+$q[2*$g+1]);for(this.earcutTriangles=$nB.earcut($m,null,2),$P=this.earcutTriangles.length,$g=0;$g<$P;$g++)$n.push(this.earcutTriangles[$g]+$Z);this.mUint16Array=new Uint16Array($n),this.mFloat32Array=new Float32Array($k)}$B.append(this.mUint16Array),$_.append(this.mFloat32Array)},$P}(),$FB=function($B){function $q(){this._matrix=new $M,this._matrix4=$wB.defaultMatrix4.concat(),$q.__super.call(this,1e4),this.shaderValue=new $QB(0,0)}$I($q,"laya.webgl.submit.SubmitCanvas",$qB);var $_=$q.prototype;return $_.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $B=$yB.worldAlpha,$_=$yB.worldMatrix4,$Z=$yB.worldMatrix,$n=$yB.worldFilters,$g=$yB.worldShaderDefines,$q=this.shaderValue,$P=this._matrix,$k=this._matrix4,$m=$M.TEMP;return $M.mul($P,$Z,$m),$k[0]=$m.a,$k[1]=$m.b,$k[4]=$m.c,$k[5]=$m.d,$k[12]=$m.tx,$k[13]=$m.ty,$yB.worldMatrix=$m.clone(),$yB.worldMatrix4=$k,$yB.worldAlpha=$yB.worldAlpha*$q.alpha,$q.filters&&$q.filters.length&&($yB.worldFilters=$q.filters,$yB.worldShaderDefines=$q.defines),this._ctx_src.flush(),$yB.worldAlpha=$B,$yB.worldMatrix4=$_,$yB.worldMatrix.destroy(),$yB.worldMatrix=$Z,$yB.worldFilters=$n,$yB.worldShaderDefines=$g,1},$_.releaseRender=function(){var $B=$q._cache;this._ctx_src=null,$B[$B._length++]=this},$_.getRenderType=function(){return 10003},$q.create=function($B,$_,$Z){var $n=$q._cache._length?$q._cache[--$q._cache._length]:new $q;$n._ctx_src=$B;var $g=$n.shaderValue;return $g.alpha=$_,$g.defines.setValue(0),$Z&&$Z.length&&$g.setFilters($Z),$n},$q._cache=(($q._cache=[])._length=0,$q._cache),$q}(),$uB=function($B){function $D($B){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$B&&($B=1e4),$D.__super.call(this,$B)}$I($D,"laya.webgl.submit.SubmitTexture",$qB);var $_=$D.prototype;return $_.releaseRender=function(){var $B=$D._cache;($B[$B._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$_.addTexture=function($B,$_){this._texsID[this._texs.length]=$B._uvID,this._texs.push($B),this._vbPos.push($_)},$_.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $B=this.shaderValue.textureHost.bitmap;if(null!==$B)for(var $_=this._vb.getFloat32Array(),$Z=0,$n=this._texs.length;$Z<$n;$Z++){var $g=this._texs[$Z];$g.active();var $q=$g.uv;if(this._texsID[$Z]!==$g._uvID){this._texsID[$Z]=$g._uvID;var $P=this._vbPos[$Z];$_[$P+2]=$q[0],$_[$P+3]=$q[1],$_[$P+6]=$q[2],$_[$P+7]=$q[3],$_[$P+10]=$q[4],$_[$P+11]=$q[5],$_[$P+14]=$q[6],$_[$P+15]=$q[7],this._vb.setNeedUpload()}$g.bitmap!==$B&&(this._isSameTexture=!1)}}},$_.renderSubmit=function(){if(0===this._numEle)return $D._shaderSet=!1,1;var $B=this.shaderValue.textureHost;if($B){var $_=$B.source;if(!$B.bitmap||!$_)return $D._shaderSet=!1,1;this.shaderValue.texture=$_,$B.alphaTexture&&$B.alphaTexture.source&&(this.shaderValue.texture1=$B.alphaTexture.source)}this._vb.bind_upload(this._ib);var $Z=$zB.mainContext;if($X.activeBlendFunction!==this._blendFn&&($Z.enable(3042),this._blendFn($Z),$X.activeBlendFunction=this._blendFn),$V.drawCall++,$V.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$bB.activeShader&&$D._shaderSet?($bB.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$bB.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$D._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $n=$B.bitmap,$g=0,$q=$bB.activeShader,$P=0,$k=this._texs.length;$P<$k;$P++){var $m=this._texs[$P];$m.bitmap===$n&&$P+1!==$k||($q.uploadTexture2D($m.source),$Z.drawElements(4,6*($P-$g+1),5123,this._startIdx+6*$g*$wB.BYTES_PIDX),$n=$m.bitmap,$g=$P)}else $Z.drawElements(4,this._numEle,5123,this._startIdx);return 1},$D.create=function($B,$_,$Z,$n,$g){var $q=$D._cache._length?$D._cache[--$D._cache._length]:new $D;null==$Z&&(($Z=$q._selfVb||($q._selfVb=$EB.create(-1))).clear(),$n=0),$q._ib=$_,$q._vb=$Z,$q._startIdx=$n*$wB.BYTES_PIDX,$q._numEle=0;var $P=$B._nBlendType;$q._blendFn=$B._targets?$X.targetFns[$P]:$X.fns[$P],$q.shaderValue=$g,$q.shaderValue.setValue($B._shader2D);var $k=$B._shader2D.filters;return $k&&$q.shaderValue.setFilters($k),$q},$D._cache=(($D._cache=[])._length=0,$D._cache),$D._shaderSet=!0,$D}(),$fB=function($B){function $j(){$j.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$I($j,"laya.webgl.utils.MeshTexture",$jB);var $_=$j.prototype;return $_.addData=function($B,$_,$Z,$n,$g,$q){for(var $P=$B.length/2,$k=this._vb.needSize($P*$j.const_stride)>>2,$m=this._vb.getFloat32Array(),$D=0,$T=0;$T<$P;$T++){var $e=$B[$D],$I=$B[$D+1],$A=$e*$n.a+$I*$n.c+$n.tx,$$=$e*$n.b+$I*$n.d+$n.ty;$m[$k++]=$A,$m[$k++]=$$,$m[$k++]=$_[$D],$m[$k++]=$_[$D+1],$D+=2}this._vb.setNeedUpload();var $w=this.vertNum;if(0<$w){($P=$Z.length)>$j.tmpIdx.length&&($j.tmpIdx=new Uint16Array($P));for(var $r=0;$r<$P;$r++)$j.tmpIdx[$r]=$Z[$r]+$w;this._ib.appendU16Array($j.tmpIdx,$Z.length)}else this._ib.append($Z);this._ib.setNeedUpload(),this.vertNum+=$P,this.indexNum+=$Z.length},$_.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$_.destroy=function(){this._ib.destroy(),this._vb.destroy()},$j.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $j},$j.const_stride=16,$j._POOL=[],$P($j,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$j}(),$bB=function($B){function $_(){$_.__super.call(this),this.lock=!0}return $I($_,"laya.webgl.shader.BaseShader",$C),$_.activeShader=null,$_.bindShader=null,$_}(),$xB=function($_){function $T($B,$_,$Z,$n,$g,$q,$P,$k,$m){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$Z&&($Z=6408),void 0===$n&&($n=5121),void 0===$g&&($g=34041),void 0===$q&&($q=!1),void 0===$P&&($P=!1),void 0===$k&&($k=-1),void 0===$m&&($m=-1),this._type=1,this._w=$B,this._h=$_,this._surfaceFormat=$Z,this._surfaceType=$n,this._depthStencilFormat=$g,$j.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$q,this._repeat=$P,this._minFifter=$k,this._magFifter=$m,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$T.__super.call(this,this.bitmap,$f.INV_UV)}$I($T,"laya.webgl.resource.RenderTarget2D",$_);var $B=$T.prototype;return $J.imps($B,{"laya.resource.IDispose":!0}),$B.getType=function(){return this._type},$B.getTexture=function(){return this},$B.size=function($B,$_){this._w==$B&&this._h==$_||(this._w=$B,this._h=$_,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$B.release=function(){this.destroy()},$B.recycle=function(){$T.POOL.push(this)},$B.start=function(){var $B=$zB.mainContext;return this._preRenderTarget=$yB.curRenderTarget,$yB.curRenderTarget=this,$B.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($B.viewport(0,0,this._w,this._h),this._svWidth=$yB.width,this._svHeight=$yB.height,$yB.width=this._w,$yB.height=this._h,$bB.activeShader=null),this},$B.clear=function($B,$_,$Z,$n){void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=1);var $g=$zB.mainContext;$g.clearColor($B,$_,$Z,$n);var $q=16384;switch(this._depthStencilFormat){case 33189:$q|=256;break;case 36168:$q|=1024;break;case 34041:$q|=256,$q|=1024}$g.clear($q)},$B.end=function(){var $B=$zB.mainContext;$B.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$yB.curRenderTarget=this._preRenderTarget,1==this._type?($B.viewport(0,0,this._svWidth,this._svHeight),$yB.width=this._svWidth,$yB.height=this._svHeight,$bB.activeShader=null):$B.viewport(0,0,$J.stage.width,$J.stage.height)},$B.getData=function($B,$_,$Z,$n){var $g=$zB.mainContext;if($g.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$g.checkFramebufferStatus(36160)))return $g.bindFramebuffer(36160,null),null;var $q=new Uint8Array(this._w*this._h*4);return $g.readPixels($B,$_,$Z,$n,this._surfaceFormat,this._surfaceType,$q),$g.bindFramebuffer(36160,null),$q},$B.destroy=function($B){void 0===$B&&($B=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$_.prototype.destroy.call(this))},$B.dispose=function(){},$B._createWebGLRenderTarget=function(){this.bitmap=new $UB(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($B){this.event("recovered")})},$n(0,$B,"surfaceFormat",function(){return this._surfaceFormat}),$n(0,$B,"magFifter",function(){return this._magFifter}),$n(0,$B,"surfaceType",function(){return this._surfaceType}),$n(0,$B,"mipMap",function(){return this._mipMap}),$n(0,$B,"depthStencilFormat",function(){return this._depthStencilFormat}),$n(0,$B,"minFifter",function(){return this._minFifter}),$n(0,$B,"source",function(){return this._alreadyResolved?$J.superGet($f,this,"source"):null}),$T.create=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){void 0===$Z&&($Z=6408),void 0===$n&&($n=5121),void 0===$g&&($g=34041),void 0===$q&&($q=!1),void 0===$P&&($P=!1),void 0===$k&&($k=-1),void 0===$m&&($m=-1);var $D=$T.POOL.pop();return $D||($D=new $T($B,$_)),$D.bitmap&&$D._w==$B&&$D._h==$_&&$D._surfaceFormat==$Z&&$D._surfaceType==$n&&$D._depthStencilFormat==$g&&$D._mipMap==$q&&$D._repeat==$P&&$D._minFifter==$k&&$D._magFifter==$m||($D._w=$B,$D._h=$_,$D._surfaceFormat=$Z,$D._surfaceType=$n,$D._depthStencilFormat=$g,$j.isConchWebGL&&34041===$D._depthStencilFormat&&($D._depthStencilFormat=33189),$D._mipMap=$q,$D._repeat=$P,$D._minFifter=$k,$D._magFifter=$m,$D.release(),$D._createWebGLRenderTarget()),$D},$T.TYPE2D=1,$T.TYPE3D=2,$T.POOL=[],$T}($f),$pB=function($B){function $_(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$_.__super.call(this),$_._gl=$zB.mainContext}$I($_,"laya.webgl.utils.Buffer",$C);var $Z=$_.prototype;return $Z._bind=function(){this.activeResource(),$_._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($_._bindVertexBuffer=this._glBuffer),$_._gl.bindBuffer(this._bufferType,$_._bindActive[this._bufferType]=this._glBuffer),$bB.activeShader=null)},$Z.recreateResource=function(){this._glBuffer||(this._glBuffer=$_._gl.createBuffer()),this.completeCreate()},$Z.disposeResource=function(){this._glBuffer&&($zB.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$n(0,$Z,"bufferUsage",function(){return this._bufferUsage}),$_._gl=null,$_._bindActive={},$_._bindVertexBuffer=null,$_._enableAtributes=[],$_}(),$KB=function($B){function $Z($B){this.texcoord=null,this.offsetX=300,this.offsetY=0,$Z.__super.call(this,512,0);var $_=8*$wB.BYTES_PE;this.position=[2,5126,!1,$_,0],this.texcoord=[2,5126,!1,$_,2*$wB.BYTES_PE],this.color=[4,5126,!1,$_,4*$wB.BYTES_PE]}return $I($Z,"laya.webgl.shader.d2.skinAnishader.SkinSV",$QB),$Z}(),$HB=function($B){function $_($B){$_.__super.call(this,2,0),this.color=[]}return $I($_,"laya.webgl.shader.d2.value.Color2dSV",$QB),$_.prototype.setValue=function($B){$B.fillStyle&&(this.color=$B.fillStyle._color._color),$B.strokeStyle&&(this.color=$B.strokeStyle._color._color)},$_}(),$GB=function($B){function $_($B){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$QB._TEXCOORD,$_.__super.call(this,256,0)}$I($_,"laya.webgl.shader.d2.value.FillTextureSV",$QB);var $Z=$_.prototype;return $Z.setValue=function($B){this.ALPHA=$B.ALPHA,$B.filters&&this.setFilters($B.filters)},$Z.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$_}(),$WB=function($B){function $_($B){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$QB._TEXCOORD,void 0===$B&&($B=0),$_.__super.call(this,1,$B)}$I($_,"laya.webgl.shader.d2.value.TextureSV",$QB);var $Z=$_.prototype;return $Z.setValue=function($B){this.ALPHA=$B.ALPHA,$B.filters&&this.setFilters($B.filters)},$Z.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$_}(),$XB=function($B){function $_($B){this.a_color=null,this.u_pos=[0,0],$_.__super.call(this,4,0),this.position=[2,5126,!1,5*$wB.BYTES_PE,0],this.a_color=[3,5126,!1,5*$wB.BYTES_PE,2*$wB.BYTES_PE]}return $I($_,"laya.webgl.shader.d2.value.PrimitiveSV",$QB),$_}(),$RB=function($B){function $_(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$_.__super.call(this)}$I($_,"laya.webgl.atlas.AtlasWebGLCanvas",$B);var $Z=$_.prototype;return $Z.recreateResource=function(){var $B=$zB.mainContext,$_=this._source=$B.createTexture(),$Z=$tB.curBindTexTarget,$n=$tB.curBindTexValue;$tB.bindTexture($B,3553,$_),$B.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$B.texParameteri(3553,10241,9729),$B.texParameteri(3553,10240,9729),$B.texParameteri(3553,10242,33071),$B.texParameteri(3553,10243,33071),$Z&&$n&&$tB.bindTexture($B,$Z,$n),this.memorySize=this._w*this._h*4,this.completeCreate()},$Z.disposeResource=function(){this._source&&($zB.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$Z.texSubImage2D=function($B,$_,$Z){if($j.isFlash){this._flashCacheImage||(this._flashCacheImage=$w.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $n=$Z.bitmapdata;this._flashCacheImage._image.copyPixels($n,0,0,$n.width,$n.height,$B,$_),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $g=$zB.mainContext,$q=$tB.curBindTexTarget,$P=$tB.curBindTexValue;$tB.bindTexture($g,3553,this._source),$g.pixelStorei(37441,!0),0<=$B-1&&$g.texSubImage2D(3553,0,$B-1,$_,6408,5121,$Z),$B+1<=this._w&&$g.texSubImage2D(3553,0,$B+1,$_,6408,5121,$Z),0<=$_-1&&$g.texSubImage2D(3553,0,$B,$_-1,6408,5121,$Z),$_+1<=this._h&&$g.texSubImage2D(3553,0,$B,$_+1,6408,5121,$Z),$g.texSubImage2D(3553,0,$B,$_,6408,5121,$Z),$g.pixelStorei(37441,!1),$q&&$P&&$tB.bindTexture($g,$q,$P)}},$Z.texSubImage2DPixel=function($B,$_,$Z,$n,$g){var $q=$zB.mainContext,$P=$tB.curBindTexTarget,$k=$tB.curBindTexValue;$tB.bindTexture($q,3553,this._source);var $m=new Uint8Array($g.data);$q.pixelStorei(37441,!0),$q.texSubImage2D(3553,0,$B,$_,$Z,$n,6408,5121,$m),$q.pixelStorei(37441,!1),$P&&$k&&$tB.bindTexture($q,$P,$k)},$n(0,$Z,"width",$B.prototype._$get_width,function($B){this._w=$B}),$n(0,$Z,"height",$B.prototype._$get_height,function($B){this._h=$B}),$_}($Z),$hB=function($B){function $g(){this.flipY=!0,this.alwaysChange=!1,$g.__super.call(this)}$I($g,"laya.webgl.resource.WebGLCanvas",$Z);var $_=$g.prototype;return $_.getCanvas=function(){return this._canvas},$_.clear=function(){this._ctx&&this._ctx.clear()},$_.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$_._setContext=function($B){this._ctx=$B},$_.getContext=function($B,$_){return this._ctx?this._ctx:this._ctx=$g._createContext(this)},$_.size=function($B,$_){this._w==$B&&this._h==$_||(this._w=$B,this._h=$_,this._ctx&&this._ctx.size($B,$_),this._canvas&&(this._canvas.height=$_,this._canvas.width=$B))},$_.activeResource=function($B){void 0===$B&&($B=!1),this._source||this.recreateResource()},$_.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$_.disposeResource=function(){this._source&&!this.iscpuSource&&($zB.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$_.createWebGlTexture=function(){var $B=$zB.mainContext;this._canvas;var $_=this._source=$B.createTexture();this.iscpuSource=!1;var $Z=$tB.curBindTexTarget,$n=$tB.curBindTexValue;$tB.bindTexture($B,3553,$_),$B.pixelStorei(37440,this.flipY?1:0),$g.premulAlpha&&$B.pixelStorei(37441,!0),$B.texImage2D(3553,0,6408,6408,5121,this._imgData),$g.premulAlpha&&$B.pixelStorei(37441,!1),$B.texParameteri(3553,10240,9729),$B.texParameteri(3553,10241,9729),$B.texParameteri(3553,10242,33071),$B.texParameteri(3553,10243,33071),$B.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$Z&&$n&&$tB.bindTexture($B,$Z,$n)},$_.reloadCanvasData=function(){var $B=$zB.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $_=$tB.curBindTexTarget,$Z=$tB.curBindTexValue;$tB.bindTexture($B,3553,this._source),$g.premulAlpha&&$B.pixelStorei(37441,!0),$B.texImage2D(3553,0,6408,6408,5121,this._imgData),$g.premulAlpha&&$B.pixelStorei(37441,!1),$B.pixelStorei(37440,0),$_&&$Z&&$tB.bindTexture($B,$_,$Z)},$_.texSubImage2D=function($B,$_,$Z){var $n=$zB.mainContext,$g=$tB.curBindTexTarget,$q=$tB.curBindTexValue;$tB.bindTexture($n,3553,this._source),$n.pixelStorei(37441,!0),$n.texSubImage2D(3553,0,$_,$Z,6408,5121,$B._source),$n.pixelStorei(37441,!1),$g&&$q&&$tB.bindTexture($n,$g,$q)},$_.toBase64=function($B,$_,$Z){var $n=null;this._canvas&&($n=this._canvas.toDataURL($B,$_)),$Z.call(this,$n)},$n(0,$_,"context",function(){return this._ctx}),$n(0,$_,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$n(0,$_,"asBitmap",null,function($B){this._ctx&&(this._ctx.asBitmap=$B)}),$g._createContext=null,$g.premulAlpha=!1,$g}(),$sB=function($B){function $q($B,$_){this.CborderSize=12,$q.__super.call(this),this.char=$B,this.isSpace=" "===$B,this.xs=$_.scaleX,this.ys=$_.scaleY,this.font=$_.font.toString(),this.fontSize=$_.font.size,this.fillColor=$_.fillColor,this.borderColor=$_.borderColor,this.lineWidth=$_.lineWidth,this.underLine=$_.underLine;var $Z,$n=$j.isConchApp;$n?(($Z=ConchTextCanvas)._source=ConchTextCanvas,$Z._source.canvas=ConchTextCanvas):$Z=$A.canvas.source,this.canvas=$Z,this._enableMerageInAtlas=!0,this._ctx=$n?$Z:this.canvas.getContext("2d",void 0);var $g=$b.measureText(this.char,this.font);this.cw=$g.width*this.xs,this.ch=($g.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $f(this)}$I($q,"laya.webgl.resource.WebGLCharImage",$Z);var $_=$q.prototype;return $J.imps($_,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$_.active=function(){this.texture.active()},$_.recreateResource=function(){var $B=$j.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$B){var $_=this.fontSize;1==this.xs&&1==this.ys||($_=parseInt($_*(this.xs>this.ys?this.xs:this.ys)+""));var $Z="normal 100 "+this.font;$Z=$Z.replace($q._fontSizeReg,$_),this.borderColor&&($Z+=" 1 "+this.borderColor),this._ctx.font=$Z,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$u.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $n=this._ctx.measureText(this.char);$n||($n={width:16});var $g=$n.width+1;this._ctx.lineTo($g,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$_.onresize=function($B,$_){this._w=$B,this._h=$_,this._allowMerageInAtlas=!0},$_.clearAtlasSource=function(){},$n(0,$_,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$n(0,$_,"atlasSource",function(){return this.canvas}),$n(0,$_,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($B){this._enableMerageInAtlas=$B}),$q.createOneChar=function($B,$_){return new $q($B,$_)},$q._fontSizeReg=new RegExp("\\d+(?=px)","g"),$q}(),$UB=function($B){function $D($B,$_,$Z,$n,$g,$q,$P,$k,$m){void 0===$Z&&($Z=6408),void 0===$n&&($n=5121),void 0===$g&&($g=34041),void 0===$q&&($q=!1),void 0===$P&&($P=!1),void 0===$k&&($k=-1),void 0===$m&&($m=1),$D.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$B,this._h=$_,this._surfaceFormat=$Z,this._surfaceType=$n,this._depthStencilFormat=$g,this._mipMap=$q,this._repeat=$P,this._minFifter=$k,this._magFifter=$m}$I($D,"laya.webgl.resource.WebGLRenderTarget",$Z);var $_=$D.prototype;return $_.recreateResource=function(){var $B=$zB.mainContext;this._frameBuffer||(this._frameBuffer=$B.createFramebuffer()),this._source||(this._source=$B.createTexture());var $_=$tB.curBindTexTarget,$Z=$tB.curBindTexValue;$tB.bindTexture($B,3553,this._source),$B.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $n=this._minFifter,$g=this._magFifter,$q=this._repeat?10497:33071,$P=$T.isPOT(this._w,this._h);if($P?(this._mipMap?-1!==$n||($n=9987):-1!==$n||($n=9729),-1!==$g||($g=9729),$B.texParameteri(3553,10241,$n),$B.texParameteri(3553,10240,$g),$B.texParameteri(3553,10242,$q),$B.texParameteri(3553,10243,$q),this._mipMap&&$B.generateMipmap(3553)):(-1!==$n||($n=9729),-1!==$g||($g=9729),$B.texParameteri(3553,10241,$n),$B.texParameteri(3553,10240,$g),$B.texParameteri(3553,10242,33071),$B.texParameteri(3553,10243,33071)),$B.bindFramebuffer(36160,this._frameBuffer),$B.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$B.createRenderbuffer()),$B.bindRenderbuffer(36161,this._depthStencilBuffer),$B.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$B.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$B.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$B.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$B.bindFramebuffer(36160,null),$_&&$Z&&$tB.bindTexture($B,$_,$Z),$B.bindRenderbuffer(36161,null),$P&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$_.disposeResource=function(){this._frameBuffer&&($zB.mainContext.deleteTexture(this._source),$zB.mainContext.deleteFramebuffer(this._frameBuffer),$zB.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$n(0,$_,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$n(0,$_,"frameBuffer",function(){return this._frameBuffer}),$D}(),$SB=function($B){function $k($B,$_,$Z,$n,$g,$q,$P){this.offsetX=0,this.offsetY=0,$k.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$q,this.canvas=$B,this._ctx=$B.getContext("2d",void 0),this._w=$n,this._h=$g,this.offsetX=$_,this.offsetY=$Z,this.src=$P,this._enableMerageInAtlas=!0,$G.enabled&&this._w<$G.atlasLimitWidth&&this._h<$G.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$I($k,"laya.webgl.resource.WebGLSubImage",$Z);var $_=$k.prototype;return $J.imps($_,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$_.size=function($B,$_){this._w=$B,this._h=$_,this._ctx&&this._ctx.size($B,$_),this.canvas&&(this.canvas.height=$_,this.canvas.width=$B)},$_.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$_.createWebGlTexture=function(){var $B=$zB.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $_=this._source=$B.createTexture(),$Z=$tB.curBindTexTarget,$n=$tB.curBindTexValue;$tB.bindTexture($B,3553,$_),$B.pixelStorei(37441,!0),$B.texImage2D(3553,0,6408,6408,5121,this.canvas),$B.pixelStorei(37441,!1);var $g=this.minFifter,$q=this.magFifter,$P=this.repeat?10497:33071,$k=$T.isPOT(this.width,this.height);$k?(this.mipmap?-1!==$g||($g=9987):-1!==$g||($g=9729),-1!==$q||($q=9729),$B.texParameteri(3553,10240,$q),$B.texParameteri(3553,10241,$g),$B.texParameteri(3553,10242,$P),$B.texParameteri(3553,10243,$P),this.mipmap&&$B.generateMipmap(3553)):(-1!==$g||($g=9729),-1!==$q||($q=9729),$B.texParameteri(3553,10241,$g),$B.texParameteri(3553,10240,$q),$B.texParameteri(3553,10242,33071),$B.texParameteri(3553,10243,33071)),$Z&&$n&&$tB.bindTexture($B,$Z,$n),this.canvas=null,$k&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$_.disposeResource=function(){$G.enabled&&this._allowMerageInAtlas||!this._source||($zB.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$_.clearAtlasSource=function(){},$n(0,$_,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$n(0,$_,"atlasSource",function(){return this.canvas}),$n(0,$_,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($B){this._allowMerageInAtlas=$B}),$k}(),$OB=function($B){function $D($B,$_,$Z,$n){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$D.__super.call(this),!$B||!$_)throw"Shader Error";this._id=++$D._count,this._vs=$B,this._ps=$_,this._nameMap=$n||{},null!=$Z&&($D.sharders[$Z]=this)}$I($D,"laya.webgl.shader.Shader",$bB);var $_=$D.prototype;return $_.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$_.disposeResource=function(){$zB.mainContext.deleteShader(this._vshader),$zB.mainContext.deleteShader(this._pshader),$zB.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$_._compile=function(){if(!$zB.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $B=[this._vs,this._ps],$_=$zB.mainContext;if(this._program=$_.createProgram(),this._vshader=$D._createShader($_,$B[0],35633),this._pshader=$D._createShader($_,$B[1],35632),$_.attachShader(this._program,this._vshader),$_.attachShader(this._program,this._pshader),$_.linkProgram(this._program),!$j.isConchApp&&!$_.getProgramParameter(this._program,35714))throw $_.getProgramInfoLog(this._program);var $Z,$n,$g=0,$q=0;for($q=$j.isConchApp?$_.getProgramParameterEx(this._vs,this._ps,"",35721):$_.getProgramParameter(this._program,35721),$g=0;$g<$q;$g++){var $P=null;$Z={vartype:"attribute",glfun:null,ivartype:0,attrib:$P=$j.isConchApp?$_.getActiveAttribEx(this._vs,this._ps,"",$g):$_.getActiveAttrib(this._program,$g),location:$_.getAttribLocation(this._program,$P.name),name:$P.name,type:$P.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($Z)}var $k=0;for($k=$j.isConchApp?$_.getProgramParameterEx(this._vs,this._ps,"",35718):$_.getProgramParameter(this._program,35718),$g=0;$g<$k;$g++){var $m=null;$m=$j.isConchApp?$_.getActiveUniformEx(this._vs,this._ps,"",$g):$_.getActiveUniform(this._program,$g),0<($Z={vartype:"uniform",glfun:null,ivartype:1,attrib:$P,location:$_.getUniformLocation(this._program,$m.name),name:$m.name,type:$m.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($Z.name=$Z.name.substr(0,$Z.name.length-3),$Z.isArray=!0,$Z.location=$_.getUniformLocation(this._program,$Z.name)),this._params.push($Z)}for($g=0,$n=this._params.length;$g<$n;$g++)if(($Z=this._params[$g]).indexOfParams=$g,$Z.index=1,$Z.value=[$Z.location,null],$Z.codename=$Z.name,$Z.name=this._nameMap[$Z.codename]?this._nameMap[$Z.codename]:$Z.codename,(this._paramsMap[$Z.name]=$Z)._this=this,$Z.uploadedValue=[],"attribute"!==$Z.vartype)switch($Z.type){case 5124:$Z.fun=$Z.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$Z.fun=$Z.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$Z.fun=$Z.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$Z.fun=$Z.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$Z.fun=$Z.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$Z.fun=this._uniform_sampler2D;break;case 35680:$Z.fun=this._uniform_samplerCube;break;case 35676:$Z.glfun=$_.uniformMatrix4fv,$Z.fun=this._uniformMatrix4fv;break;case 35670:$Z.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $Z.fun=this._attribute}},$_.getUniform=function($B){return this._paramsMap[$B]},$_._attribute=function($B,$_){var $Z=$zB.mainContext,$n=$pB._enableAtributes,$g=$B.location;return $n[$g]||$Z.enableVertexAttribArray($g),$Z.vertexAttribPointer($g,$_[0],$_[1],$_[2],$_[3],$_[4]+this._offset),$n[$g]=$pB._bindVertexBuffer,1},$_._uniform1f=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_?($zB.mainContext.uniform1f($B.location,$Z[0]=$_),1):0},$_._uniform1fv=function($B,$_){if($_.length<4){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($zB.mainContext.uniform1fv($B.location,$_),$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3],1):0}return $zB.mainContext.uniform1fv($B.location,$_),1},$_._uniform_vec2=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]?($zB.mainContext.uniform2f($B.location,$Z[0]=$_[0],$Z[1]=$_[1]),1):0},$_._uniform_vec2v=function($B,$_){if($_.length<2){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($zB.mainContext.uniform2fv($B.location,$_),$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3],1):0}return $zB.mainContext.uniform2fv($B.location,$_),1},$_._uniform_vec3=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]?($zB.mainContext.uniform3f($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2]),1):0},$_._uniform_vec3v=function($B,$_){return $zB.mainContext.uniform3fv($B.location,$_),1},$_._uniform_vec4=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($zB.mainContext.uniform4f($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3]),1):0},$_._uniform_vec4v=function($B,$_){return $zB.mainContext.uniform4fv($B.location,$_),1},$_._uniformMatrix2fv=function($B,$_){return $zB.mainContext.uniformMatrix2fv($B.location,!1,$_),1},$_._uniformMatrix3fv=function($B,$_){return $zB.mainContext.uniformMatrix3fv($B.location,!1,$_),1},$_._uniformMatrix4fv=function($B,$_){return $zB.mainContext.uniformMatrix4fv($B.location,!1,$_),1},$_._uniform1i=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_?($zB.mainContext.uniform1i($B.location,$Z[0]=$_),1):0},$_._uniform1iv=function($B,$_){return $zB.mainContext.uniform1iv($B.location,$_),1},$_._uniform_ivec2=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]?($zB.mainContext.uniform2i($B.location,$Z[0]=$_[0],$Z[1]=$_[1]),1):0},$_._uniform_ivec2v=function($B,$_){return $zB.mainContext.uniform2iv($B.location,$_),1},$_._uniform_vec3i=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]?($zB.mainContext.uniform3i($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2]),1):0},$_._uniform_vec3vi=function($B,$_){return $zB.mainContext.uniform3iv($B.location,$_),1},$_._uniform_vec4i=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($zB.mainContext.uniform4i($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3]),1):0},$_._uniform_vec4vi=function($B,$_){return $zB.mainContext.uniform4iv($B.location,$_),1},$_._uniform_sampler2D=function($B,$_){var $Z=$zB.mainContext,$n=$B.uploadedValue;return null==$n[0]?($n[0]=this._curActTexIndex,$Z.uniform1i($B.location,this._curActTexIndex),$Z.activeTexture($D._TEXTURES[this._curActTexIndex]),$tB.bindTexture($Z,3553,$_),this._curActTexIndex++,1):($Z.activeTexture($D._TEXTURES[$n[0]]),$tB.bindTexture($Z,3553,$_),0)},$_._uniform_samplerCube=function($B,$_){var $Z=$zB.mainContext,$n=$B.uploadedValue;return null==$n[0]?($n[0]=this._curActTexIndex,$Z.uniform1i($B.location,this._curActTexIndex),$Z.activeTexture($D._TEXTURES[this._curActTexIndex]),$tB.bindTexture($Z,34067,$_),this._curActTexIndex++,1):($Z.activeTexture($D._TEXTURES[$n[0]]),$tB.bindTexture($Z,34067,$_),0)},$_._noSetValue=function($B){console.log("no....:"+$B.name)},$_.uploadOne=function($B,$_){this.activeResource(),$tB.UseProgram(this._program);var $Z=this._paramsMap[$B];$Z.fun.call(this,$Z,$_)},$_.uploadTexture2D=function($B){$V.shaderCall++;var $_=$zB.mainContext;$_.activeTexture(33984),$tB.bindTexture($_,3553,$B)},$_.uploadTexture2D1=function($B){$V.shaderCall++;var $_=$zB.mainContext;$_.activeTexture(33985),$tB.bindTexture($_,3553,$B)},$_.upload=function($B,$_){$bB.activeShader=$bB.bindShader=this,this._lastUseFrameCount===$V.loopCount||this.activeResource(),$tB.UseProgram(this._program),this._reCompile?($_=this._params,this._reCompile=!1):$_=$_||this._params;$zB.mainContext;for(var $Z,$n,$g=$_.length,$q=0,$P=0;$P<$g;$P++)null!==($n=$B[($Z=$_[$P]).name])&&($q+=$Z.fun.call(this,$Z,$n));$V.shaderCall+=$q},$_.uploadArray=function($B,$_,$Z){$bB.activeShader=this,($bB.bindShader=this).activeResource(),$tB.UseProgram(this._program);this._params;for(var $n,$g,$q=0,$P=$_-2;0<=$P;$P-=2)($g=this._paramsMap[$B[$P]])&&null!=($n=$B[$P+1])&&($Z&&$Z[$g.name]&&$Z[$g.name].bind(),$q+=$g.fun.call(this,$g,$n));$V.shaderCall+=$q},$_.getParams=function(){return this._params},$D.getShader=function($B){return $D.sharders[$B]},$D.create=function($B,$_,$Z,$n){return new $D($B,$_,$Z,$n)},$D.withCompile=function($B,$_,$Z,$n){if($Z&&$D.sharders[$Z])return $D.sharders[$Z];var $g=$D._preCompileShader[2e-4*$B];if(!$g)throw new Error("withCompile shader err!"+$B);return $g.createShader($_,$Z,$n)},$D.withCompile2D=function($B,$_,$Z,$n,$g){if($n&&$D.sharders[$n])return $D.sharders[$n];var $q=$D._preCompileShader[2e-4*$B+$_];if(!$q)throw new Error("withCompile shader err!"+$B+" "+$_);return $q.createShader($Z,$n,$g)},$D.addInclude=function($B,$_){$CB.addInclude($B,$_)},$D.preCompile=function($B,$_,$Z,$n){var $g=2e-4*$B;$D._preCompileShader[$g]=new $CB($g,$_,$Z,$n)},$D.preCompile2D=function($B,$_,$Z,$n,$g){var $q=2e-4*$B+$_;$D._preCompileShader[$q]=new $CB($q,$Z,$n,$g)},$D._createShader=function($B,$_,$Z){var $n=$B.createShader($Z);return $B.shaderSource($n,$_),$B.compileShader($n),$n},$D._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$D._count=0,$D._preCompileShader={},$D.SHADERNAME2ID=2e-4,$D.sharders=(($D.sharders=[]).length=32,$D.sharders),$P($D,["nameKey",function(){return this.nameKey=new $o}]),$D}(),$dB=function($B){function $_(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$_.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$I($_,"laya.webgl.utils.Buffer2D",$B);var $Z=$_.prototype;return $Z.needSize=function($B){var $_=this._byteLength;if($B){var $Z=this._byteLength+$B;$Z<=this._buffer.byteLength||this._resizeBuffer($Z<<1,!0),this._byteLength=$Z}return $_},$Z._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$V.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$pB._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$pB._gl.bufferSubData(this._bufferType,0,this._buffer)},$Z._bufferSubData=function($B,$_,$Z){if(void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$V.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$pB._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$_||$Z){var $n=this._buffer.slice($_,$Z);$pB._gl.bufferSubData(this._bufferType,$B,$n)}else $pB._gl.bufferSubData(this._bufferType,$B,this._buffer)},$Z._checkArrayUse=function(){},$Z._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$Z._bind_subUpload=function($B,$_,$Z){return void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($B,$_,$Z),!0)},$Z._resizeBuffer=function($B,$_){if($B<this._buffer.byteLength)return this;if(this.memorySize=$B,$_&&this._buffer&&0<this._buffer.byteLength){var $Z=new ArrayBuffer($B);new Uint8Array($Z).set(new Uint8Array(this._buffer),0),this._buffer=$Z}else this._buffer=new ArrayBuffer($B);return this._checkArrayUse(),this._upload=!0,this},$Z.append=function($B){this._upload=!0;var $_,$Z;$_=$B.byteLength,$B instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$_,!0),$Z=new Uint8Array(this._buffer,this._byteLength)):$B instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$_,!0),$Z=new Uint16Array(this._buffer,this._byteLength)):$B instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$_,!0),$Z=new Float32Array(this._buffer,this._byteLength)),$Z.set($B,0),this._byteLength+=$_,this._checkArrayUse()},$Z.appendU16Array=function($B,$_){this._resizeBuffer(this._byteLength+2*$_,!0);for(var $Z=new Uint16Array(this._buffer,this._byteLength,$_),$n=0;$n<$_;$n++)$Z[$n]=$B[$n];this._byteLength+=2*$_,this._checkArrayUse()},$Z.appendEx=function($B,$_){this._upload=!0;var $Z;$Z=$B.byteLength,this._resizeBuffer(this._byteLength+$Z,!0),new $_(this._buffer,this._byteLength).set($B,0),this._byteLength+=$Z,this._checkArrayUse()},$Z.appendEx2=function($B,$_,$Z,$n){void 0===$n&&($n=1),this._upload=!0;var $g,$q;$g=$Z*$n,this._resizeBuffer(this._byteLength+$g,!0),$q=new $_(this._buffer,this._byteLength);var $P=0;for($P=0;$P<$Z;$P++)$q[$P]=$B[$P];this._byteLength+=$g,this._checkArrayUse()},$Z.getBuffer=function(){return this._buffer},$Z.setNeedUpload=function(){this._upload=!0},$Z.getNeedUpload=function(){return this._upload},$Z.upload=function(){var $B=this._bind_upload();return $pB._gl.bindBuffer(this._bufferType,null),$pB._bindActive[this._bufferType]=null,$bB.activeShader=null,$B},$Z.subUpload=function($B,$_,$Z){void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0);var $n=this._bind_subUpload();return $pB._gl.bindBuffer(this._bufferType,null),$pB._bindActive[this._bufferType]=null,$bB.activeShader=null,$n},$Z.disposeResource=function(){$B.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$Z.clear=function(){this._byteLength=0,this._upload=!0},$n(0,$Z,"bufferLength",function(){return this._buffer.byteLength}),$n(0,$Z,"byteLength",null,function($B){this._byteLength!==$B&&($B<=this._buffer.byteLength||this._resizeBuffer(2*$B+256,!0),this._byteLength=$B)}),$_.__int__=function($B){$cB.QuadrangleIB=$cB.create(35044),$rB.fillIBQuadrangle($cB.QuadrangleIB,16)},$_.FLOAT32=4,$_.SHORT=2,$_}($pB),$aB=(function($_){function $Z($B){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$Z.__super.call(this,9)}$I($Z,"laya.webgl.shader.d2.value.GlowSV",$_);var $B=$Z.prototype;$B.setValue=function($B){$_.prototype.setValue.call(this,$B)},$B.clear=function(){$_.prototype.clear.call(this)}}($WB),function($B){function $_($B){$_.__super.call(this,64),this.defines.add(64)}$I($_,"laya.webgl.shader.d2.value.TextSV",$B);var $Z=$_.prototype;return $Z.release=function(){($_.pool[$_._length++]=this).clear()},$Z.clear=function(){$B.prototype.clear.call(this)},$_.create=function(){return $_._length?$_.pool[--$_._length]:new $_(null)},$_.pool=[],$_._length=0,$_}($WB)),$iB=function($B){function $g($B,$_,$Z,$n){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$g.__super.call(this,$B,$_,$Z,$n)}$I($g,"laya.webgl.shader.d2.Shader2X",$B);var $_=$g.prototype;return $_.upload2dQuick1=function($B){this.upload($B,this._params2dQuick1||this._make2dQuick1())},$_._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $B,$_=this._params,$Z=0,$n=$_.length;$Z<$n;$Z++)$B=$_[$Z],($j.isFlash||"size"!==$B.name&&"position"!==$B.name&&"texcoord"!==$B.name)&&this._params2dQuick1.push($B)}return this._params2dQuick1},$_.disposeResource=function(){$B.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$_.upload2dQuick2=function($B){this.upload($B,this._params2dQuick2||this._make2dQuick2())},$_._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $B,$_=this._params,$Z=0,$n=$_.length;$Z<$n;$Z++)$B=$_[$Z],($j.isFlash||"size"!==$B.name)&&this._params2dQuick2.push($B)}return this._params2dQuick2},$g.create=function($B,$_,$Z,$n){return new $g($B,$_,$Z,$n)},$g}($OB),$cB=function($B){function $_($B){this._uint8Array=null,this._uint16Array=null,void 0===$B&&($B=35044),$_.__super.call(this),this._bufferUsage=$B,this._bufferType=34963,$j.isFlash||(this._buffer=new ArrayBuffer(8))}$I($_,"laya.webgl.utils.IndexBuffer2D",$dB);var $Z=$_.prototype;return $Z._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$Z.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$Z.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$Z.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$_.QuadrangleIB=null,$_.create=function($B){return void 0===$B&&($B=35044),new $_($B)},$_}(),$EB=function($B){function $Z($B,$_){this._floatArray32=null,this._vertexStride=0,$Z.__super.call(this),this._vertexStride=$B,this._bufferUsage=$_,this._bufferType=34962,$j.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$I($Z,"laya.webgl.utils.VertexBuffer2D",$B);var $_=$Z.prototype;return $_.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$_.bind=function($B){$B&&$B._bind(),this._bind()},$_.insertData=function($B,$_){this.getFloat32Array().set($B,$_),this._upload=!0},$_.bind_upload=function($B){$B._bind_upload()||$B._bind(),this._bind_upload()||this._bind()},$_._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$_.disposeResource=function(){$B.prototype.disposeResource.call(this)},$_.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$n(0,$_,"vertexStride",function(){return this._vertexStride}),$Z.create=function($B,$_){return void 0===$_&&($_=35048),new $Z($B,$_)},$Z}($dB),$B_=function($B){function $k($B,$_,$Z,$n,$g,$q){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$Z&&($Z=6408),void 0===$n&&($n=!0),$k.__super.call(this,$B,$_),$B){if(this._format=$Z,this._mipmap=$n,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $B)this._url=$B,this._src=$B,this._image=new $A.window.Image,$_&&($_.onload&&(this.onload=$_.onload),$_.onerror&&(this.onerror=$_.onerror),$_.onCreate&&$_.onCreate(this)),this._image.crossOrigin=$B&&0==$B.indexOf("data:")?null:"",$B&&(this._image.src=$B);else if($B instanceof ArrayBuffer){this._src=$_,this._url=this._src;var $P=new $m($B);$P.readUTFBytes(4),$P.readUTFBytes(2),$P.getInt16();$P.endian="bigEndian",this._w=$P.getInt16(),this._h=$P.getInt16();$P.getInt16(),$P.getInt16();this._image=new Uint8Array($B,$P.pos),this._format=$zB.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$G.enabled&&this._w<$G.atlasLimitWidth&&this._h<$G.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($B instanceof Uint8Array))return this._src=$_,this._url=this._src,this._image=$B.source||$B,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$_,this._url=this._src,this._w=$g,this._h=$q,this._image=$B,this._format=0===$Z?$B.byteLength/($g*$q)==4?6408:6407:$Z}this._$5__enableMerageInAtlas=!0}}$I($k,"laya.webgl.resource.WebGLImage",$w);var $_=$k.prototype;return $J.imps($_,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$_._init_=function($B,$_){},$_._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $B=$zB.mainContext,$_=this._source=$B.createTexture(),$Z=$tB.curBindTexTarget,$n=$tB.curBindTexValue;$tB.bindTexture($B,3553,$_);var $g=this.minFifter,$q=this.magFifter,$P=this.repeat?10497:33071,$k=$T.isPOT(this._w,this._h),$m=!1;switch($k?(this.mipmap?-1!==$g||($g=9987):-1!==$g||($g=9729),-1!==$q||($q=9729),$B.texParameteri(3553,10241,$g),$B.texParameteri(3553,10240,$q),$B.texParameteri(3553,10242,$P),$B.texParameteri(3553,10243,$P),this.mipmap&&$B.generateMipmap(3553)):(-1!==$g||($g=9729),-1!==$q||($q=9729),$B.texParameteri(3553,10241,$g),$B.texParameteri(3553,10240,$q),$B.texParameteri(3553,10242,33071),$B.texParameteri(3553,10243,33071)),$B.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$B.pixelStorei($B.UNPACK_ALIGNMENT,1),$B.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$B.pixelStorei($B.UNPACK_ALIGNMENT,1),$B.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$m=!0,$B.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $zB.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$m=!0,$B.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$B.pixelStorei(37441,!1),$Z&&$n&&$tB.bindTexture($B,$Z,$n),this.uri||(this.uri=this._url),$m?this.memorySize=this._image.length:$k&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$_.recreateResource=function(){var $B=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $_=this;this._image=new $A.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($_._needReleaseAgain)return $_._needReleaseAgain=!1,$_._image.onload=null,void($_._image=null);$_._allowMerageInAtlas&&$_._enableMerageInAtlas?($B.memorySize=0,$B._recreateLock=!1):$_._createWebGlTexture(),$_.completeCreate()},this._image.src=this._src}},$_.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$zB.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$_.onresize=function(){this._w=this._image.width,this._h=this._image.height,$G.enabled&&this._w<$G.atlasLimitWidth&&this._h<$G.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$_.clearAtlasSource=function(){this._image=null},$n(0,$_,"format",function(){return this._format}),$n(0,$_,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($B){this._$5__enableMerageInAtlas=$B}),$n(0,$_,"mipmap",function(){return this._mipmap}),$n(0,$_,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$n(0,$_,"atlasSource",function(){return this._image}),$n(0,$_,"onload",null,function($B){var $_=this;this._onload=$B,this._image&&(this._image.onload=null!=this._onload?function(){$_.onresize(),$_._onload()}:null)}),$n(0,$_,"onerror",null,function($B){var $_=this;this._onerror=$B,this._image&&(this._image.onerror=null!=this._onerror?function(){$_._onerror()}:null)}),$k}();$J.__init([$AB,$H,$NB,$CB])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($B,$_){"use strict";for(var $Z in Object.defineProperty($_,"__esModule",{value:!0}),Laya){var $n=Laya[$Z];$n&&$n.__isclass&&($_[$Z]=$n)}}),function($q,$B,$n){$n.un,$n.uns;var $g=$n.static,$P=$n.class,$k=$n.getset,$m=($n.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$$=laya.utils.ClassUtils,$e=(laya.events.Event,laya.utils.HTMLChar),$D=laya.net.Loader,$T=(laya.display.Node,laya.maths.Rectangle),$I=laya.renders.Render,$A=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$w=laya.utils.Stat,$b=laya.display.Text,$r=laya.resource.Texture,$j=laya.net.URL,$y=laya.utils.Utils,$C=function(){function $A(){}return $P($A,"laya.html.utils.HTMLParse"),$A.parse=function($B,$_,$Z){$_=($_="<root>"+($_=$_.replace(/<br>/g,"<br/>"))+"</root>").replace($A.spacePattern,$A.char255);var $n=$y.parseXMLFromString($_);$A._parseXML($B,$n.childNodes[0].childNodes,$Z)},$A._parseXML=function($B,$_,$Z,$n){var $g=0,$q=0;if($_.join||$_.item)for($g=0,$q=$_.length;$g<$q;++$g)$A._parseXML($B,$_[$g],$Z,$n);else{var $P,$k,$m;if(3==$_.nodeType)return void($B instanceof laya.html.dom.HTMLDivElement?(null==$_.nodeName&&($_.nodeName="#text"),$k=$_.nodeName.toLowerCase(),0<($m=$_.textContent.replace(/^\s+|\s+$/g,"")).length&&($P=$$.getInstance($k))&&($B.addChild($P),$P.innerTEXT=$m.replace($A.char255AndOneSpacePattern," "))):0<($m=$_.textContent.replace(/^\s+|\s+$/g,"")).length&&($B.innerTEXT=$m.replace($A.char255AndOneSpacePattern," ")));if("#comment"==($k=$_.nodeName.toLowerCase()))return;if($P=$$.getInstance($k)){($P=$B.addChild($P)).URI=$Z,$P.href=$n;var $D=$_.attributes;if($D&&0<$D.length)for($g=0,$q=$D.length;$g<$q;++$g){var $T=$D[$g],$e=$T.nodeName,$I=$T.value;$P._setAttributes($e,$I)}$A._parseXML($P,$_.childNodes,$Z,$P.href)}else $A._parseXML($B,$_.childNodes,$Z,$n)}},$A.char255=String.fromCharCode(255),$A.spacePattern=/&nbsp;|&#160;/g,$A.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$A}(),$z=function(){function $f(){}return $P($f,"laya.html.utils.Layout"),$f.later=function($B){null==$f._will&&($f._will=[],$n.stage.frameLoop(1,null,function(){if(!($f._will.length<1)){for(var $B=0;$B<$f._will.length;$B++)laya.html.utils.Layout.layout($f._will[$B]);$f._will.length=0}})),$f._will.push($B)},$f.layout=function($B){if(!$B||!$B._style)return null;if(0==(512&$B._style._type))return null;$B.getStyle()._type&=-513;var $_=$f._multiLineLayout($B);return $I.isConchApp&&$B.layaoutCallNative&&$B.layaoutCallNative(),$_},$f._multiLineLayout=function($B){if($b.RightToLeft)return $f._multiLineLayout2($B);var $_=new Array;$B._addChildsToLayout($_);var $Z,$n,$g,$q,$P,$k=0,$m=$_.length,$D=$B._getCSSStyle(),$T=$D.letterSpacing,$e=$D.leading,$I=$D.lineHeight,$A=$D._widthAuto()||!$D.wordWrap,$$=$A?999999:$B.width,$w=($B.height,0),$r=$D.italic?$D.fontSize/3:0,$j=$D._getAlign(),$y=$D._getValign(),$C=0!==$y||0!==$j||0!=$I,$z=0,$t=0,$J=0,$N=0,$Q=new Array,$M=$Q[0]=new $x,$Y=!1,$l=!1;$M.h=0,$D.italic&&($$-=$D.fontSize/3);var $L=0,$v=!0;function $V(){$M.y=$t,$t+=$M.h+$e,0==$M.h&&($t+=$I),$M.mWidth=$L,$L=0,$M=new $x,$Q.push($M),$M.h=0,$Y=!($v=!($z=0))}for($k=0;$k<$m;$k++)if(null!=($Z=$_[$k]))if($v=!1,$Z instanceof laya.html.dom.HTMLBrElement)$V(),$M.y=$t;else{if($Z._isChar()){if(($q=$Z).isWord)$Y=$l||"\n"===$q.char,$M.wordStartIndex=$M.elements.length;else{if($J=$q.width+$q.style.letterSpacin,0<$Q.length&&$$<$z+$J&&0<$M.wordStartIndex){var $o;$o=$M.elements.length-$M.wordStartIndex+1,$M.elements.length=$M.wordStartIndex,$k-=$o,$V();continue}$Y=!1,$L+=$q.width}$J=$q.width+$T,$N=$q.height,$l=!1,($Y=$Y||$$<$z+$J)&&$V(),$M.minTextHeight=Math.min($M.minTextHeight,$Z.height)}else $n=$Z._getCSSStyle(),$P=$Z,$g=$n.padding,0===$n._getCssFloat()||($C=!0),$Y=$l||$n.lineElement,$J=$P.width*$P._style._tf.scaleX+$g[1]+$g[3]+$T,$N=$P.height*$P._style._tf.scaleY+$g[0]+$g[2],$l=$n.lineElement,($Y=$Y||$$<$z+$J&&$n.wordWrap)&&$V();$M.elements.push($Z),$M.h=Math.max($M.h,$N),$Z.x=$z,$Z.y=$t,$z+=$J,$M.w=$z-$T,$M.y=$t,$w=Math.max($z+$r,$w)}else $v||($z+=$f.DIV_ELEMENT_PADDING),$M.wordStartIndex=$M.elements.length;if($t=$M.y+$M.h,$C){var $F=0,$u=$$;for($A&&0<$B.width&&($u=$B.width),$k=0,$m=$Q.length;$k<$m;$k++)$Q[$k].updatePos(0,$u,$k,$F,$j,$y,$I),$F+=Math.max($I,$Q[$k].h+$e);$t=$F}return $A&&($B.width=$w),$t>$B.height&&($B.height=$t),[$w,$t]},$f._multiLineLayout2=function($B){var $_=new Array;$B._addChildsToLayout($_);var $Z,$n,$g,$q,$P,$k=0,$m=$_.length,$D=$B._getCSSStyle(),$T=$D.letterSpacing,$e=$D.leading,$I=$D.lineHeight,$A=$D._widthAuto()||!$D.wordWrap,$$=$A?999999:$B.width,$w=($B.height,0),$r=$D.italic?$D.fontSize/3:0,$j=2-$D._getAlign(),$y=$D._getValign(),$C=0!==$y||0!=$j||0!=$I,$z=0,$t=0,$J=0,$N=0,$Q=new Array,$M=$Q[0]=new $x,$Y=!1,$l=!1;$M.h=0,$D.italic&&($$-=$D.fontSize/3);var $L=0,$v=!0;function $V(){$M.y=$t,$t+=$M.h+$e,0==$M.h&&($t+=$I),$M.mWidth=$L,$L=0,$M=new $x,$Q.push($M),$M.h=0,$Y=!($v=!($z=0))}for($k=0;$k<$m;$k++)if(null!=($Z=$_[$k]))if($v=!1,$Z instanceof laya.html.dom.HTMLBrElement)$V(),$M.y=$t;else{if($Z._isChar()){if(($q=$Z).isWord)$Y=$l||"\n"===$q.char,$M.wordStartIndex=$M.elements.length;else{if(0<$Q.length&&$$<$z+$J&&0<$M.wordStartIndex){var $o;$o=$M.elements.length-$M.wordStartIndex+1,$M.elements.length=$M.wordStartIndex,$k-=$o,$V();continue}$Y=!1,$L+=$q.width}$J=$q.width+$T,$N=$q.height,$l=!1,($Y=$Y||$$<$z+$J)&&$V(),$M.minTextHeight=Math.min($M.minTextHeight,$Z.height)}else $n=$Z._getCSSStyle(),$P=$Z,$g=$n.padding,0===$n._getCssFloat()||($C=!0),$Y=$l||$n.lineElement,$J=$P.width*$P._style._tf.scaleX+$g[1]+$g[3]+$T,$N=$P.height*$P._style._tf.scaleY+$g[0]+$g[2],$l=$n.lineElement,($Y=$Y||$$<$z+$J&&$n.wordWrap)&&$V();$M.elements.push($Z),$M.h=Math.max($M.h,$N),$Z.x=$z,$Z.y=$t,$z+=$J,$M.w=$z-$T,$M.y=$t,$w=Math.max($z+$r,$w)}else $v||($z+=$f.DIV_ELEMENT_PADDING),$M.wordStartIndex=$M.elements.length;if($t=$M.y+$M.h,$C){var $F=0,$u=$$;for($k=0,$m=$Q.length;$k<$m;$k++)$Q[$k].updatePos(0,$u,$k,$F,$j,$y,$I),$F+=Math.max($I,$Q[$k].h+$e);$t=$F}for($A&&($B.width=$w),$t>$B.height&&($B.height=$t),$k=0,$m=$Q.length;$k<$m;$k++)$Q[$k].revertOrder($$);return[$w,$t]},$f._will=null,$f.DIV_ELEMENT_PADDING=0,$f}(),$x=function(){function $B(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$P($B,"laya.html.utils.LayoutLine");var $_=$B.prototype;return $_.updatePos=function($B,$_,$Z,$n,$g,$q,$P){var $k,$m=0;0<this.elements.length&&($m=($k=this.elements[this.elements.length-1]).x+$k.width-this.elements[0].x);var $D=0,$T=NaN;1===$g&&($D=($_-$m)/2),2===$g&&($D=$_-$m),0===$P||0!=$q||($q=1);for(var $e=0,$I=this.elements.length;$e<$I;$e++){var $A=($k=this.elements[$e])._getCSSStyle();switch(0!==$D&&($k.x+=$D),$A._getValign()){case 0:$k.y=$n;break;case 1:var $$=0;99999!=this.minTextHeight&&($$=this.minTextHeight);var $w=($$+$P)/2;$w=Math.max($w,this.h),$T=(laya.html.dom.HTMLImageElement,$n+$w-$k.height),$k.y=$T;break;case 2:$k.y=$n+($P-$k.height)}}},$_.revertOrder=function($B){var $_;if(0<this.elements.length){var $Z,$n=0;for($Z=this.elements.length,$n=0;$n<$Z;$n++)($_=this.elements[$n]).x=$B-$_.x-$_.width}},$B}(),$t=function($Z){function $_(){this.URI=null,this._href=null,$_.__super.call(this),this._text=$_._EMPTYTEXT,this.setStyle(new $m(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$P($_,"laya.html.dom.HTMLElement",$Z);var $B=$_.prototype;return $B.layaoutCallNative=function(){var $B=0;if(this._childs&&0<($B=this._childs.length))for(var $_=0;$_<$B;$_++)this._childs[$_].layaoutCallNative&&this._childs[$_].layaoutCallNative();var $Z=this._getWords();$Z?laya.html.dom.HTMLElement.fillWords(this,$Z,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$B.appendChild=function($B){return this.addChild($B)},$B._getWords2=function(){var $B=this._text.text;if(!$B||0===$B.length)return null;var $_,$Z,$n=0,$g=0;if(this._text.drawWords)$Z=this._text.drawWords;else{for($g=($_=$B.split(" ")).length-1,$Z=[],$n=0;$n<$g;$n++)$Z.push($_[$n]," ");0<=$g&&$Z.push($_[$g]),this._text.drawWords=$Z}var $q,$P=this._text.words;if($P&&$P.length===$Z.length)return $P;null===$P&&(this._text.words=$P=[]),$P.length=$Z.length;var $k=this.style,$m=$k.font;for($n=0,$g=$Z.length;$n<$g;$n++){$q=$y.measureText($Z[$n],$m);var $D=$P[$n]=new $e($Z[$n],$q.width,$q.height||$k.fontSize,$k);if(1<$D.char.length&&($D.charNum=$D.char),this.href){var $T=new $A;this.addChild($T),$D.setSprite($T)}}return $P},$B._getWords=function(){if(!$b.CharacterCache)return this._getWords2();var $B=this._text.text;if(!$B||0===$B.length)return null;var $_,$Z=this._text.words;if($Z&&$Z.length===$B.length)return $Z;null===$Z&&(this._text.words=$Z=[]),$Z.length=$B.length;for(var $n=this.style,$g=$n.font,$q=0,$P=$B.length;$q<$P;$q++)if($_=$y.measureText($B.charAt($q),$g)){var $k=$Z[$q]=new $e($B.charAt($q),$_.width,$_.height||$n.fontSize,$n);if(this.href){var $m=new $A;this.addChild($m),$k.setSprite($m)}}else console.warn("_getWords size is null"+$B.charAt($q),$g);return $Z},$B.showLinkSprite=function(){var $B=this._text.words;if($B)for(var $_,$Z,$n=[],$g=0;$g<$B.length;$g++)$Z=$B[$g],($_=new $A).graphics.drawRect(0,0,$Z.width,$Z.height,"#ff0000"),$_.width=$Z.width,$_.height=$Z.height,this.addChild($_),$n.push($_)},$B._layoutLater=function(){var $B=this.style;512&$B._type||($B.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$B.block?($z.later(this),$B._type|=512):this.parent&&this.parent._layoutLater())},$B._setAttributes=function($B,$_){switch($B){case"style":return void this.style.cssText($_);case"class":return void(this.className=$_)}$Z.prototype._setAttributes.call(this,$B,$_)},$B.updateHref=function(){if(null!=this._href){var $B=this._getWords();if($B)for(var $_,$Z,$n=0;$n<$B.length;$n++)($Z=($_=$B[$n]).getSprite())&&($Z.size($_.width,$_.height),$Z.on("click",this,this.onLinkHandler))}},$B.onLinkHandler=function($B){switch($B.type){case"click":for(var $_=this;$_;)$_.event("link",[this.href]),$_=$_.parent}},$B.formatURL=function($B){return this.URI?$j.formatURL($B,this.URI?this.URI.path:null):$B},$k(0,$B,"href",function(){return this._href},function($B){null!=(this._href=$B)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$k(0,$B,"color",null,function($B){this.style.color=$B}),$k(0,$B,"onClick",null,function($B){$n._runScript("fn=function(event){"+$B+";}"),this.on("click",this,void 0)}),$k(0,$B,"id",null,function($B){$J.document.setElementById($B,this)}),$k(0,$B,"innerTEXT",function(){return this._text.text},function($B){this.text=$B}),$k(0,$B,"style",function(){return this._style}),$k(0,$B,"text",function(){return this._text.text},function($B){this._text==$_._EMPTYTEXT?this._text={text:$B,words:null}:(this._text.text=$B,this._text.words&&(this._text.words.length=0)),$I.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$k(0,$B,"parent",$Z.prototype._$get_parent,function($B){if($B instanceof laya.html.dom.HTMLElement){var $_=$B;this.URI||(this.URI=$_.URI),this.style.inherit($_.style)}$n.superSet($A,this,"parent",$B)}),$k(0,$B,"className",null,function($B){this.style.attrs($J.document.styleSheets["."+$B])}),$_.fillWords=function($B,$_,$Z,$n,$g,$q,$P){$B.graphics.clear();for(var $k=0,$m=$_.length;$k<$m;$k++){var $D=$_[$k];$B.graphics.fillText($D.char,$D.x+$Z,$D.y+$n,$g,$q,"left",$P)}},$_._EMPTYTEXT={text:null,words:null},$_}($A),$_=(function($B){function $_(){$_.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$P($_,"laya.html.dom.HTMLBrElement",$t)}(),function($B){function $_(){this.contextHeight=NaN,this.contextWidth=NaN,$_.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$P($_,"laya.html.dom.HTMLDivElement",$B);var $Z=$_.prototype;return $Z.appendHTML=function($B){$C.parse(this,$B,this.URI),this.layout()},$Z._addChildsToLayout=function($_){var $B=this._getWords();if(null==$B&&0==this._childs.length)return!1;$B&&$B.forEach(function($B){$_.push($B)});for(var $Z=!0,$n=0,$g=this._childs.length;$n<$g;$n++){var $q=this._childs[$n];$Z?$Z=!1:$_.push(null),$q._addToLayout($_)}return!0},$Z._addToLayout=function($B){this.layout()},$Z.layout=function(){if(this.style){this.style._type|=512;var $B=$z.layout(this);if($B){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $T);var $_=this._$P.mHtmlBounds;$_.x=$_.y=0,$_.width=this.contextWidth=$B[0],$_.height=this.contextHeight=$B[1],this.setBounds($_)}}},$k(0,$Z,"height",function(){return this._height?this._height:this.contextHeight},$B.prototype._$set_height),$k(0,$Z,"innerHTML",null,function($B){this.destroyChildren(),this.appendHTML($B)}),$k(0,$Z,"width",function(){return this._width?this._width:this.contextWidth},function($B){var $_=!1;$_=0===$B?$B!=this._width:$B!=this.width,$n.superSet($t,this,"width",$B),$_&&this.layout()}),$_}($t)),$J=function($B){function $_(){this.all=new Array,this.styleSheets=$m.styleSheets,$_.__super.call(this)}$P($_,"laya.html.dom.HTMLDocument",$t);var $Z=$_.prototype;return $Z.getElementById=function($B){return this.all[$B]},$Z.setElementById=function($B,$_){this.all[$B]=$_},$g($_,["document",function(){return this.document=new $_}]),$_}();(function($B){function $_(){this._tex=null,this._url=null,this._renderArgs=[],$_.__super.call(this),this.style.block=!0}$P($_,"laya.html.dom.HTMLImageElement",$t);var $Z=$_.prototype;$Z._addToLayout=function($B){!this._style.absolute&&$B.push(this)},$Z.render=function($B,$_,$Z){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($w.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$B.ctx.drawTexture2($_,$Z,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$Z.layaoutCallNative=function(){var $B=0;if(this._childs&&0<($B=this._childs.length))for(var $_=0;$_<$B;$_++)this._childs[$_].layaoutCallNative&&this._childs[$_].layaoutCallNative()},$k(0,$Z,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($B){this._width!==$B&&(this._width=$B,this._style.width=$B,this.repaint())}),$k(0,$Z,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($B){this._height!==$B&&(this._height=$B,this._style.height=$B,this.repaint())}),$Z.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$D.clearCache(this,this._url),this._tex=null),$t.prototype.destroy.call(this)},$Z.onloaded=function(){var $B=this._style;$B&&!$B.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$B&&!$B.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$I.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$Z._loadImageComplete=function($B,$_,$Z){if(!this._destroyed)if(null!=$Z)if($Z instanceof ArrayBuffer){var $n=new DataView($Z);new laya.webgl.resource.WebGLImage(new Uint8Array($Z,8),$B,0,!1,$n.getUint32(0),$n.getUint32(4));this.onloaded()}else if($Z instanceof $r)$D.imgMgrSet[$B]=$_,$q.imgMgrLock($B,$D.imgMgrSet[$B]),this._url=$B,this._tex=$Z,$D.keepCache(this,$B),$D.cacheRes($B,this._tex),this.onloaded();else{var $g=-1!=$B.indexOf(".png",$B.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($Z,$B,$g,!1,$Z.width,$Z.height);this.onloaded()}else this.event("error","Load image failed")},$k(0,$Z,"src",null,function($B){($B=this.formatURL($B),this._url!=$B)&&(null!=this._tex&&($D.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$B,(this._tex=$D.getRes($B))?($D.keepCache(this,$B),this.onloaded()):$q.imgMgrLoad($B,this._loadImageComplete.bind(this),2,!1))})})(),function($B){function $_(){this.type=null,$_.__super.call(this),this.visible=!1}$P($_,"laya.html.dom.HTMLLinkElement",$B);var $Z=$_.prototype;$Z._onload=function($B){switch(this.type){case"text/css":$m.parseCSS($B,this.URI)}},$k(0,$Z,"href",$B.prototype._$get_href,function($B){var $_=this;$B=this.formatURL($B),this.URI=new $j($B);var $Z=new $D;$Z.once("complete",null,function($B){$_._onload($B)}),$Z.load($B,"text")}),$_._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($t),function($B){function $_(){$_.__super.call(this),this.visible=!1}$P($_,"laya.html.dom.HTMLStyleElement",$B),$k(0,$_.prototype,"text",$B.prototype._$get_text,function($B){$m.parseCSS($B,null)})}($t),function($B){function $_(){$_.__super.call(this),this._getCSSStyle().valign="middle"}$P($_,"laya.html.dom.HTMLIframeElement",$B),$k(0,$_.prototype,"href",$B.prototype._$get_href,function($Z){var $n=this;$Z=this.formatURL($Z);var $B=new $D;$B.once("complete",null,function($B){var $_=$n.URI;$n.URI=new $j($Z),$n.innerHTML=$B,!$_||($n.URI=$_)}),$B.load($Z,"text")})}($_)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($B,$_){"use strict";for(var $Z in Object.defineProperty($_,"__esModule",{value:!0}),Laya){var $n=Laya[$Z];$n&&$n.__isclass&&($_[$Z]=$n)}}),function($g,$B,$w){$w.un,$w.uns;var $n=$w.static,$q=$w.class,$P=$w.getset,$Z=($w.__newvec,laya.display.Animation),$r=(laya.utils.Browser,laya.utils.ClassUtils),$k=laya.filters.ColorFilter,$m=laya.utils.Ease,$D=laya.events.Event,$T=(laya.events.EventDispatcher,laya.display.css.Font),$e=laya.display.FrameAnimation,$_=laya.display.Graphics,$I=laya.utils.Handler,$A=laya.display.Input,$y=laya.net.Loader,$$=(laya.display.Node,laya.maths.Point),$j=laya.maths.Rectangle,$C=laya.renders.Render,$z=laya.display.Sprite,$t=laya.display.Text,$J=laya.resource.Texture,$N=laya.utils.Tween,$Q=laya.utils.Utils,$M=laya.utils.WeakObject;$w.interface("laya.ui.IItem"),$w.interface("laya.ui.ISelect"),$w.interface("laya.ui.IRender"),$w.interface("laya.ui.IComponent"),$w.interface("laya.ui.IBox","IComponent");var $Y=function(){function $B(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $q($B,"laya.ui.LayoutStyle"),$n($B,["EMPTY",function(){return this.EMPTY=new $B}]),$B}(),$l=function(){function $B(){}return $q($B,"laya.ui.Styles"),$B.labelColor="#000000",$B.buttonStateNum=3,$B.scrollBarMinNum=15,$B.scrollBarDelayTime=500,$n($B,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$B}(),$L=function(){function $g(){}return $q($g,"laya.ui.UIUtils"),$g.fillArray=function($B,$_,$Z){var $n=$B.concat();if($_)for(var $g=$_.split(","),$q=0,$P=Math.min($n.length,$g.length);$q<$P;$q++){var $k=$g[$q];$n[$q]="true"==$k||"false"!=$k&&$k,null!=$Z&&($n[$q]=$Z($k))}return $n},$g.toColor=function($B){return $Q.toHexColor($B)},$g.gray=function($B,$_){void 0===$_&&($_=!0),$_?$g.addFilter($B,$g.grayFilter):$g.clearFilter($B,$k)},$g.addFilter=function($B,$_){var $Z=$B.filters||[];$Z.push($_),$B.filters=$Z},$g.clearFilter=function($B,$_){var $Z=$B.filters;if(null!=$Z&&0<$Z.length){for(var $n=$Z.length-1;-1<$n;$n--){var $g=$Z[$n];$w.__typeof($g,$_)&&$Z.splice($n,1)}$B.filters=$Z}},$g._getReplaceStr=function($B){return $g.escapeSequence[$B]},$g.adptString=function($B){return $B.replace(/\\(\w)/g,$g._getReplaceStr)},$g.getBindFun=function($B){var $_=$g._funMap.get($B);if(null==$_){var $Z='"'+$B+'"',$n="(function(data){if(data==null)return;with(data){try{\nreturn "+($Z=$Z.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$_=$w._runScript($n),$g._funMap.set($B,$_)}return $_},$n($g,["grayFilter",function(){return this.grayFilter=new $k([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $M}]),$g}(),$v=function(){function $B(){}return $q($B,"UIConfig"),$B.touchScrollEnable=!0,$B.mouseWheelEnable=!0,$B.showButtons=!0,$B.popupBgColor="#000000",$B.popupBgAlpha=.5,$B.closeDialogOnSide=!0,$B}(),$V=function($Z){function $j(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$j.__super.call(this),this._weakKeys=[]}$q($j,"laya.ui.AutoBitmap",$Z);var $B=$j.prototype;return $B.destroy=function(){if($y.clearObject(this,this._weakKey),this._weakKeys){for(var $B=0,$_=this._weakKeys.length;$B<$_;++$B)$y.clearObject(this,this._weakKeys[$B]);this._weakKeys=null}$Z.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$B._setChanged=function(){this._isChanged||(this._isChanged=!0,$w.timer.callLater(this,this.changeSource))},$B.changeSource=function(){this._isChanged=!1;var $B=this._source;if($B&&$B.bitmap){var $_=this.width,$Z=this.height,$n=this._sizeGrid,$g=$B.sourceWidth,$q=$B.sourceHeight;if(!$n||$g===$_&&$q===$Z)this.cleanByTexture($B,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$_,$Z);else{$y.clearObject(this,this._weakKey),$B.$_GID||($B.$_GID=$Q.getGID());var $P=$B.$_GID+"."+$_+"."+$Z+"."+$n.join("."),$k=$y.findObject($P);if($Q.isOKCmdList($k))return this._weakKey=$P,$y.keepObject(this,this._weakKey),void(this.cmds=$k);this.clear();var $m,$D,$T=$n[0],$e=$n[1],$I=$n[2],$A=$n[3],$$=$n[4],$w=!1;if($_==$g&&($A=$e=0),$Z==$q&&($T=$I=0),$_<$A+$e){var $r=$_;$w=!0,$_=$A+$e,this.save(),this.clipRect(0,0,$r,$Z)}$A&&$T&&($m=$j.getTexture($B,0,0,$A,$T),$D=this._weakKeys[0],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[0]=$m.weakKey),this.drawTexture($m,0,0,$A,$T)):($y.clearObject(this,$D),this._weakKeys[0]="")),$e&&$T&&($m=$j.getTexture($B,$g-$e,0,$e,$T),$D=this._weakKeys[1],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[1]=$m.weakKey),this.drawTexture($m,$_-$e,0,$e,$T)):($y.clearObject(this,$D),this._weakKeys[1]="")),$A&&$I&&($m=$j.getTexture($B,0,$q-$I,$A,$I),$D=this._weakKeys[2],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[2]=$m.weakKey),this.drawTexture($m,0,$Z-$I,$A,$I)):($y.clearObject(this,$D),this._weakKeys[2]="")),$e&&$I&&($m=$j.getTexture($B,$g-$e,$q-$I,$e,$I),$D=this._weakKeys[3],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[3]=$m.weakKey),this.drawTexture($m,$_-$e,$Z-$I,$e,$I)):($y.clearObject(this,$D),this._weakKeys[3]="")),$T&&($m=$j.getTexture($B,$A,0,$g-$A-$e,$T),$D=this._weakKeys[4],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[4]=$m.weakKey),this.drawBitmap($$,$m,$A,0,$_-$A-$e,$T)):($y.clearObject(this,$D),this._weakKeys[4]="")),$I&&($m=$j.getTexture($B,$A,$q-$I,$g-$A-$e,$I),$D=this._weakKeys[5],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[5]=$m.weakKey),this.drawBitmap($$,$m,$A,$Z-$I,$_-$A-$e,$I)):($y.clearObject(this,$D),this._weakKeys[5]="")),$A&&($m=$j.getTexture($B,0,$T,$A,$q-$T-$I),$D=this._weakKeys[6],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[6]=$m.weakKey),this.drawBitmap($$,$m,0,$T,$A,$Z-$T-$I)):($y.clearObject(this,$D),this._weakKeys[6]="")),$e&&($m=$j.getTexture($B,$g-$e,$T,$e,$q-$T-$I),$D=this._weakKeys[7],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[7]=$m.weakKey),this.drawBitmap($$,$m,$_-$e,$T,$e,$Z-$T-$I)):($y.clearObject(this,$D),this._weakKeys[7]="")),$m=$j.getTexture($B,$A,$T,$g-$A-$e,$q-$T-$I),$D=this._weakKeys[8],$m?($D!=$m.weakKey&&($y.clearObject(this,$D),$y.keepObject(this,$m.weakKey),this._weakKeys[8]=$m.weakKey),this.drawBitmap($$,$m,$A,$T,$_-$A-$e,$Z-$T-$I)):($y.clearObject(this,$D),this._weakKeys[8]=""),$w&&this.restore(),this.autoCacheCmd&&!$C.isConchApp&&($y.saveObject($P,this.cmds,null),this._weakKey=$P,$y.keepObject(this,this._weakKey))}this._repaint()}},$B.drawBitmap=function($B,$_,$Z,$n,$g,$q){void 0===$g&&($g=0),void 0===$q&&($q=0),$g<.1||$q<.1||(!$B||$_.width==$g&&$_.height==$q?this.drawTexture($_,$Z,$n,$g,$q):this.fillTexture($_,$Z,$n,$g,$q))},$B.clear=function($B){void 0===$B&&($B=!0),$Z.prototype.clear.call(this,!1)},$P(0,$B,"sizeGrid",function(){return this._sizeGrid},function($B){this._sizeGrid=$B,this._setChanged()}),$P(0,$B,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($B){this._width!=$B&&(this._width=$B,this._setChanged())}),$P(0,$B,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($B){this._height!=$B&&(this._height=$B,this._setChanged())}),$P(0,$B,"source",function(){return this._source},function($B){$B?(this._source=$B,this._setChanged()):(this._source=null,this.clear())}),$j.getTexture=function($B,$_,$Z,$n,$g){$n<=0&&($n=1),$g<=0&&($g=1),$B.$_GID||($B.$_GID=$Q.getGID());var $q=$B.$_GID+"."+$_+"."+$Z+"."+$n+"."+$g,$P=$y.findObject($q);if((!$P||!$P.source)&&($P=$J.createFromTexture($B,$_,$Z,$n,$g))){if($B.alphaTexture){var $k=$B.width/$B.alphaTexture.width;$P.alphaTexture=$J.createFromTexture($B.alphaTexture,$_/$k,$Z/$k,$n/$k,$g/$k)}$y.saveObject($q,$P),$P.weakKey=$q}return $P},$j}($_),$o=(function($B){function $_(){$_.__super.call(this)}$q($_,"laya.ui.UIEvent",$D),$_.SHOW_TIP="showtip",$_.HIDE_TIP="hidetip"}(),function($_){function $B(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$B.__super.call(this),this._layout=$Y.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$q($B,"laya.ui.Component",$_);var $Z=$B.prototype;return $w.imps($Z,{"laya.ui.IComponent":!0}),$Z.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$Z.preinitialize=function(){},$Z.createChildren=function(){},$Z.initialize=function(){},$Z.callLater=function($B,$_){$w.timer.callLater(this,$B,$_)},$Z.runCallLater=function($B){$w.timer.runCallLater(this,$B)},$Z.commitMeasure=function(){},$Z.changeSize=function(){this.event("resize")},$Z.getLayout=function(){return this._layout===$Y.EMPTY&&(this._layout=new $Y),this._layout},$Z._setLayoutEnabled=function($B){this._layout&&this._layout.enable!=$B&&(this._layout.enable=$B,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$Z.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$Z.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$Z.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$Z.resetLayoutX=function(){var $B=this._layout;if(isNaN($B.anchorX)||(this.pivotX=$B.anchorX*this.width),this.layoutEnabled){var $_=this.parent;$_&&(isNaN($B.centerX)?isNaN($B.left)?isNaN($B.right)||(this.x=Math.round($_.width-this.displayWidth-$B.right+this.pivotX*this.scaleX)):(this.x=Math.round($B.left+this.pivotX*this.scaleX),isNaN($B.right)||(this.width=($_._width-$B.left-$B.right)/(this.scaleX||.01))):this.x=Math.round(.5*($_.width-this.displayWidth)+$B.centerX+this.pivotX*this.scaleX))}},$Z.resetLayoutY=function(){var $B=this._layout;if(isNaN($B.anchorY)||(this.pivotY=$B.anchorY*this.height),this.layoutEnabled){var $_=this.parent;$_&&(isNaN($B.centerY)?isNaN($B.top)?isNaN($B.bottom)||(this.y=Math.round($_.height-this.displayHeight-$B.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($B.top+this.pivotY*this.scaleY),isNaN($B.bottom)||(this.height=($_._height-$B.top-$B.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($_.height-this.displayHeight)+$B.centerY+this.pivotY*this.scaleY))}},$Z.onMouseOver=function($B){$w.stage.event("showtip",this._toolTip)},$Z.onMouseOut=function($B){$w.stage.event("hidetip",this._toolTip)},$P(0,$Z,"displayWidth",function(){return this.width*this.scaleX}),$P(0,$Z,"width",function(){return this._width?this._width:this.measureWidth},function($B){this._width!=$B&&(this._width=$B,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$P(0,$Z,"measureWidth",function(){var $B=0;this.commitMeasure();for(var $_=this.numChildren-1;-1<$_;$_--){var $Z=this.getChildAt($_);$Z.visible&&($B=Math.max($Z.x+$Z.width*$Z.scaleX,$B))}return $B}),$P(0,$Z,"displayHeight",function(){return this.height*this.scaleY}),$P(0,$Z,"height",function(){return this._height?this._height:this.measureHeight},function($B){this._height!=$B&&(this._height=$B,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$P(0,$Z,"dataSource",function(){return this._dataSource},function($B){for(var $_ in this._dataSource=$B,this._dataSource)this.hasOwnProperty($_)&&"function"!=typeof this[$_]&&(this[$_]=this._dataSource[$_])}),$P(0,$Z,"scaleY",$_.prototype._$get_scaleY,function($B){$w.superGet($z,this,"scaleY")!=$B&&($w.superSet($z,this,"scaleY",$B),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$P(0,$Z,"measureHeight",function(){var $B=0;this.commitMeasure();for(var $_=this.numChildren-1;-1<$_;$_--){var $Z=this.getChildAt($_);$Z.visible&&($B=Math.max($Z.y+$Z.height*$Z.scaleY,$B))}return $B}),$P(0,$Z,"scaleX",$_.prototype._$get_scaleX,function($B){$w.superGet($z,this,"scaleX")!=$B&&($w.superSet($z,this,"scaleX",$B),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$P(0,$Z,"top",function(){return this._layout.top},function($B){$B!=this._layout.top&&(this.getLayout().top=$B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$P(0,$Z,"bottom",function(){return this._layout.bottom},function($B){$B!=this._layout.bottom&&(this.getLayout().bottom=$B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$P(0,$Z,"left",function(){return this._layout.left},function($B){$B!=this._layout.left&&(this.getLayout().left=$B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$P(0,$Z,"right",function(){return this._layout.right},function($B){$B!=this._layout.right&&(this.getLayout().right=$B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$P(0,$Z,"centerX",function(){return this._layout.centerX},function($B){$B!=this._layout.centerX&&(this.getLayout().centerX=$B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$P(0,$Z,"centerY",function(){return this._layout.centerY},function($B){$B!=this._layout.centerY&&(this.getLayout().centerY=$B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$P(0,$Z,"anchorX",function(){return this._layout.anchorX},function($B){$B!=this._layout.anchorX&&(this.getLayout().anchorX=$B,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$P(0,$Z,"anchorY",function(){return this._layout.anchorY},function($B){$B!=this._layout.anchorY&&(this.getLayout().anchorY=$B,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$P(0,$Z,"tag",function(){return this._tag},function($B){this._tag=$B}),$P(0,$Z,"toolTip",function(){return this._toolTip},function($B){this._toolTip!=$B&&(null!=(this._toolTip=$B)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$P(0,$Z,"comXml",function(){return this._comXml},function($B){this._comXml=$B}),$P(0,$Z,"gray",function(){return this._gray},function($B){$B!==this._gray&&(this._gray=$B,$L.gray(this,$B))}),$P(0,$Z,"disabled",function(){return this._disabled},function($B){$B!==this._disabled&&(this.gray=this._disabled=$B,this.mouseEnabled=!$B)}),$B}($z)),$F=function($B){function $_(){this.lockLayer=null,this.popupEffect=function($B){$B.scale(1,1),$N.from($B,{x:$w.stage.width/2,y:$w.stage.height/2,scaleX:0,scaleY:0},300,$m.backOut,$I.create(this,this.doOpen,[$B]))},this.closeEffect=function($B,$_){$N.to($B,{x:$w.stage.width/2,y:$w.stage.height/2,scaleX:0,scaleY:0},300,$m.strongOut,$I.create(this,this.doClose,[$B,$_]))},$_.__super.call(this),this.maskLayer=new $z,this.popupEffectHandler=$I.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$I.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$w.stage.addChild(this),$w.stage.on("resize",this,this._onResize),$v.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$q($_,"laya.ui.DialogManager",$z);var $Z=$_.prototype;return $Z._closeOnSide=function(){var $B=this.getChildAt(this.numChildren-1);$B instanceof laya.ui.Dialog&&$B.close("side")},$Z.setLockView=function($B){this.lockLayer||(this.lockLayer=new $u,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($w.stage.width,$w.stage.height)),this.lockLayer.removeChildren(),$B&&($B.centerX=$B.centerY=0,this.lockLayer.addChild($B))},$Z._onResize=function($B){var $_=this.maskLayer.width=$w.stage.width,$Z=this.maskLayer.height=$w.stage.height;this.lockLayer&&this.lockLayer.size($_,$Z),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$_,$Z,$v.popupBgColor),this.maskLayer.alpha=$v.popupBgAlpha;for(var $n=this.numChildren-1;-1<$n;$n--){var $g=this.getChildAt($n);$g.popupCenter&&this._centerDialog($g)}},$Z._centerDialog=function($B){$B.x=Math.round(($w.stage.width-$B.width>>1)+$B.pivotX),$B.y=Math.round(($w.stage.height-$B.height>>1)+$B.pivotY)},$Z.open=function($B,$_,$Z){void 0===$_&&($_=!1),void 0===$Z&&($Z=!1),$_&&this._closeAll(),$B.popupCenter&&this._centerDialog($B),this.addChild($B),($B.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$Z&&null!=$B.popupEffect?$B.popupEffect.runWith($B):this.doOpen($B),this.event("open")},$Z.doOpen=function($B){$B.onOpened()},$Z.lock=function($B){this.lockLayer&&($B?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$Z.close=function($B,$_,$Z){void 0===$Z&&($Z=!1),$Z&&null!=$B.closeEffect?$B.closeEffect.runWith([$B,$_]):this.doClose($B,$_),this.event("close")},$Z.doClose=function($B,$_){$B.removeSelf(),$B.isModal&&this._checkMask(),$B.closeHandler&&$B.closeHandler.runWith($_),$B.onClosed($_)},$Z.closeAll=function(){this._closeAll(),this.event("close")},$Z._closeAll=function(){for(var $B=this.numChildren-1;-1<$B;$B--){var $_=this.getChildAt($B);$_&&null!=$_.close&&this.doClose($_)}},$Z.getDialogsByGroup=function($B){for(var $_=[],$Z=this.numChildren-1;-1<$Z;$Z--){var $n=this.getChildAt($Z);$n&&$n.group===$B&&$_.push($n)}return $_},$Z.closeByGroup=function($B){for(var $_=[],$Z=this.numChildren-1;-1<$Z;$Z--){var $n=this.getChildAt($Z);$n&&$n.group===$B&&($n.close(),$_.push($n))}return $_},$Z._checkMask=function(){this.maskLayer.removeSelf();for(var $B=this.numChildren-1;-1<$B;$B--){var $_=this.getChildAt($B);if($_&&$_.isModal)return void this.addChildAt(this.maskLayer,$B)}},$_}(),$u=function($B){function $_(){$_.__super.call(this)}$q($_,"laya.ui.Box",$B);var $Z=$_.prototype;return $w.imps($Z,{"laya.ui.IBox":!0}),$P(0,$Z,"dataSource",$B.prototype._$get_dataSource,function($B){for(var $_ in this._dataSource=$B){var $Z=this.getChildByName($_);$Z?$Z.dataSource=$B[$_]:this.hasOwnProperty($_)&&"function"!=typeof this[$_]&&(this[$_]=$B[$_])}}),$_}($o),$f=function($_){function $Z($B,$_){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$Z.__super.call(this),this._labelColors=$l.buttonLabelColors,this._stateNum=$l.buttonStateNum,void 0===$_&&($_=""),this.skin=$B,this.label=$_}$q($Z,"laya.ui.Button",$_);var $B=$Z.prototype;return $w.imps($B,{"laya.ui.ISelect":!0}),$B.destroy=function($B){this.clearEvent(),$y.clearCache(this,this._skin),$y.clearObject(this,this._weakKey),void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($B),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$B.clearEvent=function(){this._skin&&$g.atalsNotify&&$g.atalsNotify.off(this._skin,this,this._setBtnSource)},$B.createChildren=function(){this.graphics=this._bitmap=new $V},$B.createText=function(){this._text||(this._text=new $t,this._text.overflow=$t.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$B.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$B.onMouse=function($B){if(!1!==this.toggle||!this._selected)return"click"===$B.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$Z.stateMap[$B.type]))},$B.changeClips=function(){var $B=$y.getRes(this._skin);if($B)if(this._skin&&""!=this._skin){$y.clearObject(this,this._weakKey);var $_=$B.sourceWidth,$Z=$B.sourceHeight/this._stateNum;$B.$_GID||($B.$_GID=$Q.getGID());var $n=$B.$_GID+"-"+this._stateNum,$g=$y.findObject($n);if($Q.isOkTextureList($g)||($g=null),$g)this._weakKey=$n,$y.keepObject(this,this._weakKey),this._sources=$g;else{if(this._sources=[],1===this._stateNum)this._sources.push($B);else for(var $q=0;$q<this._stateNum;$q++){var $P=$J.createFromTexture($B,0,$Z*$q,$_,$Z);if($B.alphaTexture){var $k=$B.width/$B.alphaTexture.width;$P.alphaTexture=$J.createFromTexture($B.alphaTexture,0/$k,$Z*$q/$k,$_/$k,$Z/$k)}this._sources.push($P)}$y.saveObject($n,this._sources),this._weakKey=$n,$y.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$_,this._bitmap.height=this._height||$Z,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$_)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$B.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $B=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$B]),this.label&&(this._text.color=this._labelColors[$B],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$B]))},$B._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$P(0,$B,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($B){this.createText(),this._text.strokeColor=$B}),$P(0,$B,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$P(0,$B,"skin",function(){return this._skin},function($B){if(this._skin!=$B)if(this.clearEvent(),$y.clearCache(this,this._skin),this._skin=$B,$y.keepCache(this,this._skin),$y.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $_=$g.resAtalsObj&&$g.resAtalsObj[this._skin];$_?($g.atalsNotify&&$g.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$_.sourceW),0==this.height&&(this.height=$_.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$B._setBtnSource=function($B,$_){$B===this._skin&&$_&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$P(0,$B,"state",function(){return this._state},function($B){this._state!=$B&&(this._state=$B,this._setStateChanged())}),$P(0,$B,"text",function(){return this.createText(),this._text}),$P(0,$B,"stateNum",function(){return this._stateNum},function($B){"string"==typeof $B&&($B=parseInt($B)),this._stateNum!=$B&&(this._stateNum=$B<1?1:3<$B?3:$B,this.callLater(this.changeClips))}),$P(0,$B,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($B){this._strokeColors=$L.fillArray($l.buttonLabelColors,$B,String),this._setStateChanged()}),$P(0,$B,"labelColors",function(){return this._labelColors.join(",")},function($B){this._labelColors=$L.fillArray($l.buttonLabelColors,$B,String),this._setStateChanged()}),$P(0,$B,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$P(0,$B,"label",function(){return this._text?this._text.text:null},function($B){(this._text||$B)&&(this.createText(),this._text.text!=$B&&($B&&!this._text.parent&&this.addChild(this._text),this._text.text=($B+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$P(0,$B,"selected",function(){return this._selected},function($B){this._selected!=$B&&(this._selected=$B,this.state=this._selected?2:0,this.event("change"))}),$P(0,$B,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($B){this.createText(),this._text.padding=$L.fillArray($l.labelPadding,$B,Number)}),$P(0,$B,"labelSize",function(){return this.createText(),this._text.fontSize},function($B){this.createText(),this._text.fontSize=$B}),$P(0,$B,"labelStroke",function(){return this.createText(),this._text.stroke},function($B){this.createText(),this._text.stroke=$B}),$P(0,$B,"labelBold",function(){return this.createText(),this._text.bold},function($B){this.createText(),this._text.bold=$B}),$P(0,$B,"labelFont",function(){return this.createText(),this._text.font},function($B){this.createText(),this._text.font=$B}),$P(0,$B,"labelAlign",function(){return this.createText(),this._text.align},function($B){this.createText(),this._text.align=$B}),$P(0,$B,"clickHandler",function(){return this._clickHandler},function($B){this._clickHandler=$B}),$P(0,$B,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($B){this._bitmap.sizeGrid=$L.fillArray($l.defaultSizeGrid,$B,Number)}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($o,this,"width",$B),this._autoSize&&(this._bitmap.width=$B,this._text&&(this._text.width=$B))}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($o,this,"height",$B),this._autoSize&&(this._bitmap.height=$B,this._text&&(this._text.height=$B))}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)||"string"==typeof $B?this.label=$B+"":$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($B){this._bitmap._offset=$B?$L.fillArray([1,1],$B,Number):[]}),$n($Z,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$Z}($o),$b=function($_){function $n($B,$_,$Z){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$n.__super.call(this),void 0===$_&&($_=1),void 0===$Z&&($Z=1),this._clipX=$_,this._clipY=$Z,this.skin=$B}$q($n,"laya.ui.Clip",$_);var $B=$n.prototype;return $B.destroy=function($B){this.clearEvent(),this.clearLoad(),$y.clearCache(this,this._skin),$y.clearObject(this,this._weakKey),void 0===$B&&($B=!0),$_.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$B.dispose=function(){this.destroy(!0),$w.loader.clearRes(this._skin)},$B.createChildren=function(){this.graphics=this._bitmap=new $V},$B._onDisplay=function($B){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$B.changeClip=function(){if(this._clipChanged=!1,this._skin){var $B=$y.getRes(this._skin);if($B)this.loadComplete(this._skin,$B);else{if($g.resAtalsObj&&$g.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$I.create(this,this.loadComplete,[this._skin]),this._progress=null,$w.loader.load(this._skin,this._complete,this._progress)}}},$B.loadComplete=function($B,$_){if($B===this._skin&&$_){$y.clearObject(this,this._weakKey);var $Z=this._clipWidth||Math.ceil($_.sourceWidth/this._clipX),$n=this._clipHeight||Math.ceil($_.sourceHeight/this._clipY),$g=this._skin+$Z+$n,$q=$y.findObject($g);if($Q.isOkTextureList($q)||($q=null),$q)this._weakKey=$g,$y.keepObject(this,this._weakKey),this._sources=$q;else{this._sources=[];for(var $P=0;$P<this._clipY;$P++)for(var $k=0;$k<this._clipX;$k++){var $m=$J.createFromTexture($_,$Z*$k,$n*$P,$Z,$n);if($_.alphaTexture){var $D=$_.width/$_.alphaTexture.width;$m.alphaTexture=$J.createFromTexture($_.alphaTexture,$Z*$k/$D,$n*$P/$D,$Z/$D,$n/$D)}this._sources.push($m)}$y.saveObject($g,this._sources),this._weakKey=$g,$y.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$B.play=function($B,$_){void 0===$B&&($B=0),void 0===$_&&($_=-1),this._isPlaying=!0,this.index=$B,this._toIndex=$_,this._index++,$w.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$B._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$B.stop=function(){this._isPlaying=!1,$w.timer.clear(this,this._loop),this.event("complete")},$B._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$P(0,$B,"interval",function(){return this._interval},function($B){this._interval!=$B&&(this._interval=$B,this._isPlaying&&this.play())}),$B.clearEvent=function(){this._skin&&$g.atalsNotify&&$g.atalsNotify.off(this._skin,this,this._setBtnSource)},$B.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$w.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$P(0,$B,"skin",function(){return this._skin},function($B){if(this._skin!=$B)if(this.clearLoad(),this.clearEvent(),$y.clearCache(this,this._skin),this._skin=$B){$y.keepCache(this,this._skin);var $_=$y.getRes($B),$Z=$g.resAtalsObj&&$g.resAtalsObj[this._skin];!$_&&$Z?$g.atalsNotify&&$g.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$B._setBtnSource=function($B,$_){$B===this._skin&&$_&&(this.loadComplete($B,$_),this.clearEvent())},$P(0,$B,"sources",function(){return this._sources},function($B){this._sources=$B,this.index=this._index,this.event("loaded")}),$P(0,$B,"clipX",function(){return this._clipX},function($B){this._clipX=$B||1,this._setClipChanged()}),$P(0,$B,"clipY",function(){return this._clipY},function($B){this._clipY=$B||1,this._setClipChanged()}),$P(0,$B,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$P(0,$B,"clipWidth",function(){return this._clipWidth},function($B){this._clipWidth=$B,this._setClipChanged()}),$P(0,$B,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($B){this._bitmap.sizeGrid=$L.fillArray($l.defaultSizeGrid,$B,Number)}),$P(0,$B,"group",function(){return this._group},function($B){$B&&this._skin&&$y.setGroup(this._skin,$B),this._group=$B}),$P(0,$B,"clipHeight",function(){return this._clipHeight},function($B){this._clipHeight=$B,this._setClipChanged()}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($o,this,"width",$B),this._bitmap.width=$B}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($o,this,"height",$B),this._bitmap.height=$B}),$P(0,$B,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$P(0,$B,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$P(0,$B,"index",function(){return this._index},function($B){this._index=$B,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$B]),this.event("change")}),$P(0,$B,"autoPlay",function(){return this._autoPlay},function($B){this._autoPlay!=$B&&((this._autoPlay=$B)?this.play():this.stop())}),$P(0,$B,"isPlaying",function(){return this._isPlaying},function($B){this._isPlaying=$B}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)&&Math.floor($B)==$B||"string"==typeof $B?this.index=parseInt($B):$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"bitmap",function(){return this._bitmap}),$n}($o),$x=function($_){function $B(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$B.__super.call(this)}$q($B,"laya.ui.ColorPicker",$_);var $Z=$B.prototype;return $Z.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._colorPanel&&this._colorPanel.destroy($B),this._colorButton&&this._colorButton.destroy($B),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$Z.createChildren=function(){this.addChild(this._colorButton=new $f),this._colorPanel=new $u,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $z),this._colorPanel.addChild(this._colorBlock=new $z),this._colorPanel.addChild(this._colorInput=new $A)},$Z.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$Z.onPanelMouseDown=function($B){$B.stopPropagation()},$Z.changePanel=function(){this._panelChanged=!1;var $B=this._colorPanel.graphics;$B.clear(),$B.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($B=this._colorTiles.graphics).clear();for(var $_=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$Z=0;$Z<12;$Z++)for(var $n=0;$n<20;$n++){var $g=0;$g=0===$n?$_[$Z]:1===$n?0:51*(((3*$Z+$n/6)%3<<0)+3*($Z/6<<0))<<16|$n%6*51<<8|($Z<<0)%6*51;var $q=$L.toColor($g);this._colors.push($q);var $P=$n*this._gridSize,$k=$Z*this._gridSize;$B.drawRect($P,$k,this._gridSize,this._gridSize,$q,"#000000")}},$Z.onColorButtonClick=function($B){this._colorPanel.parent?this.close():this.open()},$Z.open=function(){var $B=this.localToGlobal(new $$),$_=$B.x+this._colorPanel.width<=$w.stage.width?$B.x:$w.stage.width-this._colorPanel.width,$Z=$B.y+this._colorButton.height;$Z=$Z+this._colorPanel.height<=$w.stage.height?$Z:$B.y-this._colorPanel.height,this._colorPanel.pos($_,$Z),this._colorPanel.zOrder=1001,$w._currentStage.addChild(this._colorPanel),$w.stage.on("mousedown",this,this.removeColorBox)},$Z.close=function(){$w.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$Z.removeColorBox=function($B){this.close()},$Z.onColorFieldKeyDown=function($B){13==$B.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$B.stopPropagation())},$Z.onColorInputChange=function($B){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$Z.onColorTilesClick=function($B){this.selectedColor=this.getColorByMouse(),this.close()},$Z.onColorTilesMouseMove=function($B){this._colorInput.focus=!1;var $_=this.getColorByMouse();this._colorInput.text=$_,this.drawBlock($_)},$Z.getColorByMouse=function(){var $B=this._colorTiles.getMousePoint(),$_=Math.floor($B.x/this._gridSize),$Z=Math.floor($B.y/this._gridSize);return this._colors[20*$Z+$_]},$Z.drawBlock=function($B){var $_=this._colorBlock.graphics;$_.clear();var $Z=$B||"#ffffff";$_.drawRect(0,0,50,20,$Z,this._borderColor),$B||$_.drawLine(0,0,50,20,"#ff0000")},$Z.changeColor=function(){var $B=this.graphics;$B.clear();var $_=this._selectedColor||"#000000";$B.drawRect(0,0,this._colorButton.width,this._colorButton.height,$_)},$Z._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$P(0,$Z,"inputBgColor",function(){return this._inputBgColor},function($B){this._inputBgColor=$B,this._setPanelChanged()}),$P(0,$Z,"selectedColor",function(){return this._selectedColor},function($B){this._selectedColor!=$B&&(this._selectedColor=this._colorInput.text=$B,this.drawBlock($B),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$D.EMPTY.setTo("change",this,this)))}),$P(0,$Z,"skin",function(){return this._colorButton.skin},function($B){this._colorButton.skin=$B,this.changeColor()}),$P(0,$Z,"bgColor",function(){return this._bgColor},function($B){this._bgColor=$B,this._setPanelChanged()}),$P(0,$Z,"borderColor",function(){return this._borderColor},function($B){this._borderColor=$B,this._setPanelChanged()}),$P(0,$Z,"inputColor",function(){return this._inputColor},function($B){this._inputColor=$B,this._setPanelChanged()}),$B}($o),$p=function($_){function $Z($B,$_){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$Z.__super.call(this),this._itemColors=$l.comboBoxItemColors,this.skin=$B,this.labels=$_}$q($Z,"laya.ui.ComboBox",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._button&&this._button.destroy($B),this._list&&this._list.destroy($B),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$B.createChildren=function(){this.addChild(this._button=new $f),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$B._createList=function(){this._list=new $S,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$B._setListEvent=function($B){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$I.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$B.onListDown=function($B){$B.stopPropagation()},$B.onScrollBarDown=function($B){$B.stopPropagation()},$B.onButtonMouseDown=function($B){this.callLater(this.switchTo,[!this._isOpen])},$B.changeList=function(){this._listChanged=!1;var $B=this.width-2,$_=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$B,height:this._itemHeight,fontSize:this._itemSize,color:$_}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$B.onlistItemMouse=function($B,$_){var $Z=$B.type;if("mouseover"===$Z||"mouseout"===$Z){if(this._isCustomList)return;var $n=this._list.getCell($_);if(!$n)return;var $g=$n.getChildByName("label");$g&&("mouseover"===$Z?($g.bgColor=this._itemColors[0],$g.color=this._itemColors[1]):($g.bgColor=null,$g.color=this._itemColors[2]))}else"click"===$Z&&(this.selectedIndex=$_,this.isOpen=!1)},$B.switchTo=function($B){this.isOpen=$B},$B.changeOpen=function(){this.isOpen=!this._isOpen},$B.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $B=this._list.graphics;$B.clear(),$B.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $_=this._list.array||[],$Z=$_.length=0,$n=this._labels.length;$Z<$n;$Z++)$_.push({label:this._labels[$Z]});this._list.height=this._listHeight,this._list.array=$_},$B.changeSelected=function(){this._button.label=this.selectedLabel},$B._onStageMouseWheel=function($B){this._list&&!this._list.contains($B.target)&&this.removeList(null)},$B.removeList=function($B){$w.stage.off("mousedown",this,this.removeList),$w.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$P(0,$B,"selectedIndex",function(){return this._selectedIndex},function($B){this._selectedIndex!=$B&&(this._selectedIndex=$B,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$D.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$P(0,$B,"measureHeight",function(){return this._button.height}),$P(0,$B,"skin",function(){return this._button.skin},function($B){this._button.skin!=$B&&(this._button.skin=$B,this._listChanged=!0)}),$P(0,$B,"measureWidth",function(){return this._button.width}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($o,this,"width",$B),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$P(0,$B,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($B){this.selectedIndex=this._labels.indexOf($B)}),$P(0,$B,"labels",function(){return this._labels.join(",")},function($B){0<this._labels.length&&(this.selectedIndex=-1),$B?this._labels=$B.split(","):this._labels.length=0,this._itemChanged=!0}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($o,this,"height",$B),this._button.height=this._height}),$P(0,$B,"selectHandler",function(){return this._selectHandler},function($B){this._selectHandler=$B}),$P(0,$B,"visibleNum",function(){return this._visibleNum},function($B){this._visibleNum=$B,this._listChanged=!0}),$P(0,$B,"labelBold",function(){return this._button.text.bold},function($B){this._button.text.bold=$B}),$P(0,$B,"itemColors",function(){return String(this._itemColors)},function($B){this._itemColors=$L.fillArray(this._itemColors,$B,String),this._listChanged=!0}),$P(0,$B,"itemSize",function(){return this._itemSize},function($B){this._itemSize=$B,this._listChanged=!0}),$P(0,$B,"scrollBar",function(){return this.list.scrollBar}),$P(0,$B,"isOpen",function(){return this._isOpen},function($B){if(this._isOpen!=$B)if(this._isOpen=$B,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $_=this.localToGlobal($$.TEMP.setTo(0,0)),$Z=$_.y+this._button.height;$Z=$Z+this._listHeight<=$w.stage.height?$Z:$_.y-this._listHeight,this._list.pos($_.x,$Z),this._list.zOrder=1001,$w._currentStage.addChild(this._list),$w.stage.once("mousedown",this,this.removeList),$w.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$P(0,$B,"scrollBarSkin",function(){return this._scrollBarSkin},function($B){this._scrollBarSkin=$B}),$P(0,$B,"sizeGrid",function(){return this._button.sizeGrid},function($B){this._button.sizeGrid=$B}),$P(0,$B,"button",function(){return this._button}),$P(0,$B,"list",function(){return this._list||this._createList(),this._list},function($B){$B&&($B.removeSelf(),this._isCustomList=!0,this._list=$B,this._setListEvent($B),this._itemHeight=$B.getCell(0).height+$B.spaceY)}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)&&Math.floor($B)==$B||"string"==typeof $B?this.selectedIndex=parseInt($B):$B instanceof Array?this.labels=$B.join(","):$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"labelColors",function(){return this._button.labelColors},function($B){this._button.labelColors!=$B&&(this._button.labelColors=$B)}),$P(0,$B,"labelPadding",function(){return this._button.text.padding.join(",")},function($B){this._button.text.padding=$L.fillArray($l.labelPadding,$B,Number)}),$P(0,$B,"labelSize",function(){return this._button.text.fontSize},function($B){this._button.text.fontSize=$B}),$P(0,$B,"labelFont",function(){return this._button.text.font},function($B){this._button.text.font=$B}),$P(0,$B,"stateNum",function(){return this._button.stateNum},function($B){this._button.stateNum=$B}),$Z}($o),$K=function($_){function $Z($B){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$Z.__super.call(this),this._showButtons=$v.showButtons,this._touchScrollEnable=$v.touchScrollEnable,this._mouseWheelEnable=$v.mouseWheelEnable,this.skin=$B,this.max=1}$q($Z,"laya.ui.ScrollBar",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),this.stopScroll(),this.target=null,$_.prototype.destroy.call(this,$B),this.upButton&&this.upButton.destroy($B),this.downButton&&this.downButton.destroy($B),this.slider&&this.slider.destroy($B),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$B.createChildren=function(){this.addChild(this.slider=new $H),this.addChild(this.upButton=new $f),this.addChild(this.downButton=new $f)},$B.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$B.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$B.onButtonMouseDown=function($B){var $_=$B.currentTarget===this.upButton;this.slide($_),$w.timer.once($l.scrollBarDelayTime,this,this.startLoop,[$_]),$w.stage.once("mouseup",this,this.onStageMouseUp)},$B.startLoop=function($B){$w.timer.frameLoop(1,this,this.slide,[$B])},$B.slide=function($B){$B?this.value-=this._scrollSize:this.value+=this._scrollSize},$B.onStageMouseUp=function($B){$w.timer.clear(this,this.startLoop),$w.timer.clear(this,this.slide)},$B.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$B.changeSize=function(){$_.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$B.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$B.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$B.setScroll=function($B,$_,$Z){this.runCallLater(this.changeSize),this.slider.setSlider($B,$_,$Z),this.slider.bar.visible=0<$_,!this._hide&&this.autoHide&&(this.visible=!1)},$B.onTargetMouseWheel=function($B){this.value-=$B.delta*this._scrollSize,this.target=this._target},$B.onTargetMouseDown=function($B){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $$),this._lastPoint.setTo($w.stage.mouseX,$w.stage.mouseY),$w.timer.clear(this,this.tweenMove),$N.clearTween(this),$w.stage.once("mouseup",this,this.onStageMouseUp2),$w.stage.once("mouseout",this,this.onStageMouseUp2),$w.timer.frameLoop(1,this,this.loop)},$B.loop=function(){var $B=$w.stage.mouseY,$_=$w.stage.mouseX;if(this._lastOffset=this.isVertical?$B-this._lastPoint.y:$_-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$w.stage._canvasTransform.getScaleY():$w.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$_,this._lastPoint.y=$B,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$B.onStageMouseUp2=function($B){if($w.stage.off("mouseup",this,this.onStageMouseUp2),$w.stage.off("mouseout",this,this.onStageMouseUp2),$w.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$N.to(this,{value:this.min},this.elasticBackTime,$m.sineOut,$I.create(this,this.elasticOver)):this._value>this.max&&$N.to(this,{value:this.max},this.elasticBackTime,$m.sineOut,$I.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$w.stage.mouseY-this._lastPoint.y:$w.stage.mouseX-this._lastPoint.x);for(var $_=0,$Z=Math.min(this._offsets.length,3),$n=0;$n<$Z;$n++)$_+=this._offsets[this._offsets.length-1-$n];if(this._lastOffset=$_/$Z,($_=Math.abs(this._lastOffset))<2)return void this.event("end");60<$_&&(this._lastOffset=0<this._lastOffset?60:-60);var $g=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$w.timer.frameLoop(1,this,this.tweenMove,[$g])}},$B.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$N.to(this,{alpha:0},500),this.event("end")},$B.tweenMove=function($B){this._lastOffset*=this.rollRatio;var $_=NaN;if(0<$B&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$_=.5*-(this.min-$B-this.value),this._lastOffset>$_&&(this._lastOffset=$_)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$_=.5*-(this.max+$B-this.value),this._lastOffset<$_&&(this._lastOffset=$_))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($w.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$N.to(this,{value:this.min},this.elasticBackTime,$m.sineOut,$I.create(this,this.elasticOver)):this._value>this.max?$N.to(this,{value:this.max},this.elasticBackTime,$m.sineOut,$I.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$N.to(this,{alpha:0},500)}},$B.stopScroll=function(){this.onStageMouseUp2(null),$w.timer.clear(this,this.tweenMove),$N.clearTween(this)},$P(0,$B,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$P(0,$B,"skin",function(){return this._skin},function($B){this._skin!=$B&&(this._skin=$B,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$P(0,$B,"max",function(){return this.slider.max},function($B){this.slider.max=$B}),$P(0,$B,"showButtons",function(){return this._showButtons},function($B){this._showButtons=$B,this.callLater(this.changeScrollBar)}),$P(0,$B,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$P(0,$B,"min",function(){return this.slider.min},function($B){this.slider.min=$B}),$P(0,$B,"value",function(){return this._value},function($B){$B!==this._value&&(this._value=$B,this._isElastic||(this.slider._value!=$B&&(this.slider._value=$B,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$P(0,$B,"isVertical",function(){return this.slider.isVertical},function($B){this.slider.isVertical=$B}),$P(0,$B,"sizeGrid",function(){return this.slider.sizeGrid},function($B){this.slider.sizeGrid=$B}),$P(0,$B,"scrollSize",function(){return this._scrollSize},function($B){this._scrollSize=$B}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)||"string"==typeof $B?this.value=Number($B):$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"thumbPercent",function(){return this._thumbPercent},function($B){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$B=1<=$B?.99:$B,this._thumbPercent=$B,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$B,$l.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$B,$l.scrollBarMinNum))}),$P(0,$B,"target",function(){return this._target},function($B){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$B)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$P(0,$B,"hide",function(){return this._hide},function($B){this._hide=$B,this.visible=!$B}),$P(0,$B,"touchScrollEnable",function(){return this._touchScrollEnable},function($B){this._touchScrollEnable=$B,this.target=this._target}),$P(0,$B,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($B){this._mouseWheelEnable=$B,this.target=this._target}),$P(0,$B,"tick",function(){return this.slider.tick},function($B){this.slider.tick=$B}),$Z}($o),$H=function($_){function $Z($B){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$Z.__super.call(this),this.skin=$B}$q($Z,"laya.ui.Slider",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._bg&&this._bg.destroy($B),this._bar&&this._bar.destroy($B),this._progress&&this._progress.destroy($B),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$B.createChildren=function(){this.addChild(this._bg=new $G),this.addChild(this._bar=new $f)},$B.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$B.onBarMouseDown=function($B){this._globalSacle||(this._globalSacle=new $$),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$w.stage.mouseX,this._ty=$w.stage.mouseY,$w.stage.on("mousemove",this,this.mouseMove),$w.stage.once("mouseup",this,this.mouseUp),$w.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$B.showValueText=function(){if(this.showLabel){var $B=laya.ui.Slider.label;this.addChild($B),$B.textField.changeText(this._value+""),this.isVertical?($B.x=this._bar.x+20,$B.y=.5*(this._bar.height-$B.height)+this._bar.y):($B.y=this._bar.y-20,$B.x=.5*(this._bar.width-$B.width)+this._bar.x)}},$B.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$B.mouseUp=function($B){$w.stage.off("mousemove",this,this.mouseMove),$w.stage.off("mouseup",this,this.mouseUp),$w.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$B.mouseMove=function($B){var $_=this._value;this.isVertical?(this._bar.y+=($w.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($w.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$w.stage.mouseX,this._ty=$w.stage.mouseY;var $Z=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$Z)/$Z,this._value!=$_&&this.sendChangeEvent(),this.showValueText()},$B.sendChangeEvent=function($B){void 0===$B&&($B="change"),this.event($B),this.changeHandler&&this.changeHandler.runWith(this._value)},$B.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$B.changeSize=function(){$_.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$B.setSlider=function($B,$_,$Z){this._value=-1,this._min=$B,this._max=$B<$_?$_:$B,this.value=$Z<$B?$B:$_<$Z?$_:$Z},$B.changeValue=function(){var $B=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$B)/$B,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $_=this._max-this._min;0===$_&&($_=1),this.isVertical?(this._bar.y=(this._value-this._min)/$_*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$_*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$B.onBgMouseDown=function($B){var $_=this._bg.getMousePoint();this.isVertical?this.value=$_.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$_.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$P(0,$B,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$P(0,$B,"skin",function(){return this._skin},function($B){if(this._skin!=$B){this._skin=$B,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $_=this._skin.replace(".png","$progress.png");$y.getRes($_)&&(this._progress||(this.addChild(this._progress=new $G),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$_),this.setBarPoint(),this.callLater(this.changeValue)}}),$P(0,$B,"allowClickBack",function(){return this._allowClickBack},function($B){this._allowClickBack!=$B&&((this._allowClickBack=$B)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$P(0,$B,"max",function(){return this._max},function($B){this._max!=$B&&(this._max=$B,this.callLater(this.changeValue))}),$P(0,$B,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$P(0,$B,"tick",function(){return this._tick},function($B){this._tick!=$B&&(this._tick=$B,this.callLater(this.changeValue))}),$P(0,$B,"sizeGrid",function(){return this._bg.sizeGrid},function($B){this._bg.sizeGrid=$B,this._bar.sizeGrid=$B,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$P(0,$B,"min",function(){return this._min},function($B){this._min!=$B&&(this._min=$B,this.callLater(this.changeValue))}),$P(0,$B,"value",function(){return this._value},function($B){if(this._value!=$B){var $_=this._value;this._value=$B,this.changeValue(),this._value!=$_&&this.sendChangeEvent()}}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)||"string"==typeof $B?this.value=Number($B):$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"bar",function(){return this._bar}),$n($Z,["label",function(){return this.label=new $W}]),$Z}($o),$G=function($_){function $Z($B){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$Z.__super.call(this),this.skin=$B}$q($Z,"laya.ui.Image",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$y.clearCache(this,this._skin)},$B.dispose=function(){this.destroy(!0),$y.clearCache(this,this._skin),this.clearEvent()},$B.createChildren=function(){this.graphics=this._bitmap=new $V},$B.setSource=function($B,$_){this.destroyed||$B===this._skin&&$_&&(this.source=$_,this.onCompResize(),this.clearEvent())},$B.clearEvent=function(){this._skin&&$g.atalsNotify&&$g.atalsNotify.off(this._skin,this,this.setSource)},$B.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$w.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$P(0,$B,"source",function(){return this._bitmap.source},function($B){this._bitmap&&(this._bitmap.source=$B,this.event("loaded"),this.repaint())}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"string"==typeof(this._dataSource=$B)?this.skin=$B:$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"measureHeight",function(){return this._bitmap.height}),$P(0,$B,"skin",function(){return this._skin},function($B){if(this._skin!=$B)if($y.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$B){$y.keepCache(this,this._skin);var $_=$y.getRes($B),$Z=$g.resAtalsObj&&$g.resAtalsObj[this._skin];$_?(this.source=$_,this.onCompResize()):$Z?($g.atalsNotify&&$g.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$Z.sourceW),0==this.height&&(this.height=$Z.sourceH)):(this._complete=$I.create(this,this.setSource,[this._skin]),this._progress=null,$w.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$P(0,$B,"group",function(){return this._group},function($B){$B&&this._skin&&$y.setGroup(this._skin,$B),this._group=$B}),$P(0,$B,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($B){this._bitmap.sizeGrid=$L.fillArray($l.defaultSizeGrid,$B,Number)}),$P(0,$B,"measureWidth",function(){return this._bitmap.width}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($o,this,"width",$B),this._bitmap.width=0==$B?1e-7:$B}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($o,this,"height",$B),this._bitmap.height=0==$B?1e-7:$B}),$Z}($o),$W=function($_){function $Z($B){this._tf=null,$Z.__super.call(this),void 0===$B&&($B=""),$T.defaultColor=$l.labelColor,this.text=$B}$q($Z,"laya.ui.Label",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._tf=null},$B.createChildren=function(){this.addChild(this._tf=new $t)},$B.changeText=function($B){this._tf.changeText($B)},$P(0,$B,"padding",function(){return this._tf.padding.join(",")},function($B){this._tf.padding=$L.fillArray($l.labelPadding,$B,Number)}),$P(0,$B,"bold",function(){return this._tf.bold},function($B){this._tf.bold=$B}),$P(0,$B,"align",function(){return this._tf.align},function($B){this._tf.align=$B}),$P(0,$B,"text",function(){return this._tf.text},function($B){this._tf.text!=$B&&($B&&($B=$L.adptString($B+"")),this._tf.text=$B,this.event("change"),this._width&&this._height||this.onCompResize())}),$P(0,$B,"italic",function(){return this._tf.italic},function($B){this._tf.italic=$B}),$P(0,$B,"wordWrap",function(){return this._tf.wordWrap},function($B){this._tf.wordWrap=$B}),$P(0,$B,"font",function(){return this._tf.font},function($B){this._tf.font=$B}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)||"string"==typeof $B?this.text=$B+"":$w.superSet($o,this,"dataSource",$B)}),$P(0,$B,"color",function(){return this._tf.color},function($B){this._tf.color=$B}),$P(0,$B,"valign",function(){return this._tf.valign},function($B){this._tf.valign=$B}),$P(0,$B,"leading",function(){return this._tf.leading},function($B){this._tf.leading=$B}),$P(0,$B,"fontSize",function(){return this._tf.fontSize},function($B){this._tf.fontSize=$B}),$P(0,$B,"bgColor",function(){return this._tf.bgColor},function($B){this._tf.bgColor=$B}),$P(0,$B,"borderColor",function(){return this._tf.borderColor},function($B){this._tf.borderColor=$B}),$P(0,$B,"stroke",function(){return this._tf.stroke},function($B){this._tf.stroke=$B}),$P(0,$B,"strokeColor",function(){return this._tf.strokeColor},function($B){this._tf.strokeColor=$B}),$P(0,$B,"textField",function(){return this._tf}),$P(0,$B,"measureWidth",function(){return this._tf.width}),$P(0,$B,"measureHeight",function(){return this._tf.height}),$P(0,$B,"width",function(){return this._width||this._tf.text?$w.superGet($o,this,"width"):0},function($B){$w.superSet($o,this,"width",$B),this._tf.width=$B}),$P(0,$B,"height",function(){return this._height||this._tf.text?$w.superGet($o,this,"height"):0},function($B){$w.superSet($o,this,"height",$B),this._tf.height=$B}),$P(0,$B,"overflow",function(){return this._tf.overflow},function($B){this._tf.overflow=$B}),$P(0,$B,"underline",function(){return this._tf.underline},function($B){this._tf.underline=$B}),$P(0,$B,"underlineColor",function(){return this._tf.underlineColor},function($B){this._tf.underlineColor=$B}),$Z}($o),$X=function($_){function $Z($B){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$Z.__super.call(this),this.skin=$B}$q($Z,"laya.ui.ProgressBar",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._bg&&this._bg.destroy($B),this._bar&&this._bar.destroy($B),this._bg=this._bar=null,this.changeHandler=null},$B.createChildren=function(){this.addChild(this._bg=new $G),this.addChild(this._bar=new $G)},$B.changeValue=function(){if(this.sizeGrid){var $B=this.sizeGrid.split(","),$_=Number($B[3]),$Z=Number($B[1]),$n=(this.width-$_-$Z)*this._value;this._bar.width=$_+$Z+$n,this._bar.visible=this._bar.width>$_+$Z}else this._bar.width=this.width*this._value},$P(0,$B,"measureHeight",function(){return this._bg.height}),$P(0,$B,"skin",function(){return this._skin},function($B){this._skin!=$B&&(this._skin=$B,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$P(0,$B,"measureWidth",function(){return this._bg.width}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($o,this,"height",$B),this._bg.height=this._height,this._bar.height=this._height}),$P(0,$B,"bar",function(){return this._bar}),$P(0,$B,"value",function(){return this._value},function($B){this._value!=$B&&($B=1<$B?1:$B<0?0:$B,this._value=$B,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($B))}),$P(0,$B,"bg",function(){return this._bg}),$P(0,$B,"sizeGrid",function(){return this._bg.sizeGrid},function($B){this._bg.sizeGrid=this._bar.sizeGrid=$B}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($o,this,"width",$B),this._bg.width=this._width,this.callLater(this.changeValue)}),$P(0,$B,"dataSource",$_.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)||"string"==typeof $B?this.value=Number($B):$w.superSet($o,this,"dataSource",$B)}),$Z}($o),$R=(function($B){function $Z(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$Z.__super.call(this),this._tipBox=new $o,this._tipBox.addChild(this._tipText=new $t),this._tipText.x=this._tipText.y=5,this._tipText.color=$Z.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$w.stage.on("showtip",this,this._onStageShowTip),$w.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$q($Z,"laya.ui.TipManager",$o);var $_=$Z.prototype;$_._onStageHideTip=function($B){$w.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$_._onStageShowTip=function($B){$w.timer.once($Z.tipDelay,this,this._showTip,[$B],!0)},$_._showTip=function($B){if("string"==typeof $B){var $_=String($B);Boolean($_)&&this._defaultTipHandler($_)}else $B instanceof laya.utils.Handler?$B.run():"function"==typeof $B&&$B.apply();$w.stage.on("mousemove",this,this._onStageMouseMove),$w.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$_._onStageMouseDown=function($B){this.closeAll()},$_._onStageMouseMove=function($B){this._showToStage(this,$Z.offsetX,$Z.offsetY)},$_._showToStage=function($B,$_,$Z){void 0===$_&&($_=0),void 0===$Z&&($Z=0);var $n=$B.getBounds();$B.x=$w.stage.mouseX+$_,$B.y=$w.stage.mouseY+$Z,$B.x+$n.width>$w.stage.width&&($B.x-=$n.width+$_),$B.y+$n.height>$w.stage.height&&($B.y-=$n.height+$Z)},$_.closeAll=function(){$w.timer.clear(this,this._showTip),$w.stage.off("mousemove",this,this._onStageMouseMove),$w.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$_.showDislayTip=function($B){this.addChild($B),this._showToStage(this),$w._currentStage.addChild(this)},$_._showDefaultTip=function($B){this._tipText.text=$B;var $_=this._tipBox.graphics;$_.clear(),$_.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$Z.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$w._currentStage.addChild(this)},$P(0,$_,"defaultTipHandler",function(){return this._defaultTipHandler},function($B){this._defaultTipHandler=$B}),$Z.offsetX=10,$Z.offsetY=15,$Z.tipTextColor="#ffffff",$Z.tipBackColor="#111111",$Z.tipDelay=200}(),function($B){var $A;function $$(){this._idMap=null,this._aniList=null,this._watchMap={},$$.__super.call(this)}$q($$,"laya.ui.View",$u);var $_=$$.prototype;return $_.createView=function($B){if($B.animations&&!this._idMap&&(this._idMap={}),$$.createComp($B,this,this),$B.animations){var $_,$Z,$n=[],$g=$B.animations,$q=0,$P=$g.length;for($q=0;$q<$P;$q++){switch($_=new $e,$Z=$g[$q],$_._setUp(this._idMap,$Z),(this[$Z.name]=$_)._setControlNode(this),$Z.action){case 1:$_.play(0,!1);break;case 2:$_.play(0,!0)}$n.push($_)}this._aniList=$n}0<this._width&&null==$B.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$_.onEvent=function($B,$_){},$_.loadUI=function($B){var $_=$$.uiMap[$B];$_&&this.createView($_)},$_.destroy=function($B){void 0===$B&&($B=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$B)},$_.changeData=function($B){var $_=this._watchMap[$B];if($_){console.log("change",$B);for(var $Z=0,$n=$_.length;$Z<$n;$Z++){$_[$Z].exe(this)}}},$$._regs=function(){for(var $B in $$.uiClassMap)$r.regClass($B,$$.uiClassMap[$B])},$$.createComp=function($B,$_,$Z,$n){if(!($_=$_||$$.getCompInstance($B)))return console.warn("can not create:"+$B.type),null;var $g=$B.child;if($g)for(var $q=$_ instanceof laya.ui.List,$P=0,$k=$g.length;$P<$k;$P++){var $m=$g[$P];if(!$_.hasOwnProperty("itemRender")||"render"!=$m.props.name&&"render"!==$m.props.renderType)if("Graphic"==$m.type)$r.addGraphicsToSprite($m,$_);else if($r.isDrawType($m.type))$r.addGraphicToSprite($m,$_,!0);else{if($q){var $D=[],$T=$$.createComp($m,null,$Z,$D);$D.length&&($T._$bindData=$D)}else $T=$$.createComp($m,null,$Z,$n);"Script"==$m.type?"owner"in $T?$T.owner=$_:"target"in $T&&($T.target=$_):"mask"==$m.props.renderType||"mask"==$m.props.name?$_.mask=$T:$T instanceof laya.display.Sprite&&$_.addChild($T)}else $_.itemRender=$m}var $e=$B.props;for(var $I in $e){var $A=$e[$I];$$.eventDic[$I]?$A&&$Z&&$_.on($I,$Z,$Z.onEvent,[$A]):$$.setCompValue($_,$I,$A,$Z,$n)}return $w.__typeof($_,"laya.ui.IItem")&&$_.initItems(),$B.compId&&$Z&&$Z._idMap&&($Z._idMap[$B.compId]=$_),$_},$$.setCompValue=function($B,$_,$Z,$n,$g){if("string"==typeof $Z&&-1<$Z.indexOf("${")){if($$._sheet||($$._sheet=$r.getClass("laya.data.Table")),!$$._sheet)return void console.warn("Can not find class Sheet");if($g)$g.push($B,$_,$Z);else if($n){-1==$Z.indexOf("].")&&($Z=$Z.replace(".","[0]."));var $q,$P,$k=new $A($B,$_,$Z);$k.exe($n);for(var $m=$Z.replace(/\[.*?\]\./g,".");null!=($q=$$._parseWatchData.exec($m));){for(var $D=$q[1];null!=($P=$$._parseKeyWord.exec($D));){var $T=$P[0],$e=$n._watchMap[$T]||($n._watchMap[$T]=[]);$e.push($k),$$._sheet.I.notifer.on($T,$n,$n.changeData,[$T])}($e=$n._watchMap[$D]||($n._watchMap[$D]=[])).push($k),$$._sheet.I.notifer.on($D,$n,$n.changeData,[$D])}}}else if("var"===$_&&$n)$n[$Z]=$B;else if("onClick"==$_){var $I=$w._runScript("(function(){"+$Z+"})");$B.on("click",$n,$I)}else $B[$_]="true"===$Z||"false"!==$Z&&$Z},$$.getCompInstance=function($B){var $_,$Z=$B.props?$B.props.runtime:null;return $_=$Z?$$.viewClassMap[$Z]||$$.uiClassMap[$Z]||$w.__classmap[$Z]:$$.uiClassMap[$B.type],$B.props&&$B.props.hasOwnProperty("renderType")&&"instance"==$B.props.renderType?$_.instance:$_?new $_:null},$$.regComponent=function($B,$_){$$.uiClassMap[$B]=$_,$r.regClass($B,$_)},$$.regViewRuntime=function($B,$_){$$.viewClassMap[$B]=$_},$$.uiMap={},$$.viewClassMap={},$$._sheet=null,$n($$,["uiClassMap",function(){return this.uiClassMap={ViewStack:$BB,LinkButton:$f,TextArea:$DB,ColorPicker:$x,Box:$u,Button:$f,CheckBox:$h,Clip:$b,ComboBox:$p,Component:$o,HScrollBar:$O,HSlider:$a,Image:$G,Label:$W,List:$S,Panel:$d,ProgressBar:$X,Radio:$c,RadioGroup:$kB,ScrollBar:$K,Slider:$H,Tab:$mB,TextInput:$ZB,View:$$,VScrollBar:$_B,VSlider:$nB,Tree:$E,HBox:$qB,VBox:$PB,Sprite:$z,Animation:$Z,Text:$t,FontClip:$U}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$$.__init$=function(){$$._regs(),$A=function(){function $B($B,$_,$Z){this.comp=null,this.prop=null,this.value=null,this.comp=$B,this.prop=$_,this.value=$Z}return $q($B,""),$B.prototype.exe=function($B){var $_=$L.getBindFun(this.value);this.comp[this.prop]=$_.call(this,$B)},$B}()},$$}()),$h=function($B){function $Z($B,$_){void 0===$_&&($_=""),$Z.__super.call(this,$B,$_)}$q($Z,"laya.ui.CheckBox",$B);var $_=$Z.prototype;return $_.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$_.initialize=function(){$B.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$P(0,$_,"dataSource",$B.prototype._$get_dataSource,function($B){"boolean"==typeof(this._dataSource=$B)?this.selected=$B:"string"==typeof $B?this.selected="true"===$B:$w.superSet($f,this,"dataSource",$B)}),$Z}($f),$s=function($B){function $_(){this._space=0,this._align="none",this._itemChanged=!1,$_.__super.call(this)}$q($_,"laya.ui.LayoutBox",$u);var $Z=$_.prototype;return $Z.addChild=function($B){return $B.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$B)},$Z.onResize=function($B){this._setItemChanged()},$Z.addChildAt=function($B,$_){return $B.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$B,$_)},$Z.removeChild=function($B){return $B.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$B)},$Z.removeChildAt=function($B){return this.getChildAt($B).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$B)},$Z.refresh=function(){this._setItemChanged()},$Z.changeItems=function(){this._itemChanged=!1},$Z.sortItem=function($B){$B&&$B.sort(function($B,$_){return $B.y-$_.y})},$Z._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$P(0,$Z,"space",function(){return this._space},function($B){this._space=$B,this._setItemChanged()}),$P(0,$Z,"align",function(){return this._align},function($B){this._align=$B,this._setItemChanged()}),$_}(),$U=function($_){function $Z($B,$_){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$Z.__super.call(this),$B&&(this.skin=$B),$_&&(this.sheet=$_)}$q($Z,"laya.ui.FontClip",$_);var $B=$Z.prototype;return $B.createChildren=function(){this._bitmap=new $V,this.on("loaded",this,this._onClipLoaded)},$B._onClipLoaded=function(){this.callLater(this.changeValue)},$B.changeValue=function(){var $B;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$B=this._sources[0]))){var $_="horizontal"===this._direction;$_?(this._wordsW=this._valueArr.length*($B.sourceWidth+this.spaceX),this._wordsH=$B.sourceHeight):(this._wordsW=$B.sourceWidth,this._wordsH=($B.sourceHeight+this.spaceY)*this._valueArr.length);var $Z=0;if(this._width)switch(this._align){case"center":$Z=.5*(this._width-this._wordsW);break;case"right":$Z=this._width-this._wordsW;break;default:$Z=0}for(var $n=0,$g=this._valueArr.length;$n<$g;$n++){var $q=this._indexMap[this._valueArr.charAt($n)];this.sources[$q]&&($B=this.sources[$q],$_?this.graphics.drawTexture($B,$Z+$n*($B.sourceWidth+this.spaceX),0,$B.sourceWidth,$B.sourceHeight):this.graphics.drawTexture($B,0+$Z,$n*($B.sourceHeight+this.spaceY),$B.sourceWidth,$B.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$B.destroy=function($B){void 0===$B&&($B=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$_.prototype.destroy.call(this,$B)},$P(0,$B,"sheet",function(){return this._sheet},function($B){$B+="";var $_=(this._sheet=$B).split(" ");this._clipX=String($_[0]).length,this.clipY=$_.length,this._indexMap={};for(var $Z=0;$Z<this._clipY;$Z++)for(var $n=$_[$Z].split(""),$g=0,$q=$n.length;$g<$q;$g++)this._indexMap[$n[$g]]=$Z*this._clipX+$g}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($b,this,"height",$B),this.callLater(this.changeValue)}),$P(0,$B,"direction",function(){return this._direction},function($B){this._direction=$B,this.callLater(this.changeValue)}),$P(0,$B,"value",function(){return this._valueArr?this._valueArr:""},function($B){$B+="",this._valueArr=$B,this.callLater(this.changeValue)}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($b,this,"width",$B),this.callLater(this.changeValue)}),$P(0,$B,"spaceX",function(){return this._spaceX},function($B){this._spaceX=$B,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$P(0,$B,"spaceY",function(){return this._spaceY},function($B){this._spaceY=$B,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$P(0,$B,"align",function(){return this._align},function($B){this._align=$B,this.callLater(this.changeValue)}),$P(0,$B,"measureWidth",function(){return this._wordsW}),$P(0,$B,"measureHeight",function(){return this._wordsH}),$Z}($b),$S=function($B){function $_(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $$,$_.__super.call(this)}$q($_,"laya.ui.List",$B);var $Z=$_.prototype;return $w.imps($Z,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$Z.destroy=function($B){void 0===$B&&($B=!0),this._content&&this._content.destroy($B),this._scrollBar&&this._scrollBar.destroy($B),laya.ui.Component.prototype.destroy.call(this,$B),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$Z.createChildren=function(){this.addChild(this._content=new $u)},$Z.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$w.superGet($u,this,"cacheAs")),$w.superSet($u,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$Z.onScrollEnd=function(){$w.superSet($u,this,"cacheAs",this._$P.cacheAs)},$Z._removePreScrollBar=function(){var $B=this.removeChildByName("scrollBar");$B&&$B.destroy(!0)},$Z.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $B=this._getOneCell(),$_=$B.width+this._spaceX||1,$Z=$B.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$_):Math.ceil(this._width/$_)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$Z):Math.round(this._height/$Z));var $n=this._width?this._width:$_*this.repeatX-this._spaceX,$g=this._height?this._height:$Z*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$Z:$_,this._cellOffset=this._isVertical?$Z*Math.max(this._repeatY2,this._repeatY)-$g-this._spaceY:$_*Math.max(this._repeatX2,this._repeatX)-$n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$g:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$n),this.setContentSize($n,$g);var $q=this._isVertical?this.repeatX:this.repeatY,$P=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$q,$P),this._createdLine=$P,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$Z._getOneCell=function(){if(0===this._cells.length){var $B=this.createItem();if(this._offset.setTo($B.x,$B.y),this.cacheContent)return $B;this._cells.push($B)}return this._cells[0]},$Z._createItems=function($B,$_,$Z){var $n=this._content,$g=this._getOneCell(),$q=$g.width+this._spaceX,$P=$g.height+this._spaceY;if(this.cacheContent){var $k=new $u;$k.cacheAsBitmap=!0,$k.pos((this._isVertical?0:$B)*$q,(this._isVertical?$B:0)*$P),this._content.addChild($k),this._content.optimizeScrollRect=!0,$n=$k}else{for(var $m=[],$D=this._cells.length-1;-1<$D;$D--){var $T=this._cells[$D];$T.removeSelf(),$m.push($T)}this._cells.length=0}for(var $e=$B;$e<$Z;$e++)for(var $I=0;$I<$_;$I++)($g=$m&&$m.length?$m.pop():this.createItem()).x=(this._isVertical?$I:$e)*$q-$n.x,$g.y=(this._isVertical?$e:$I)*$P-$n.y,$g.name="item"+($e*$_+$I),$n.addChild($g),this.addCell($g)},$Z.createItem=function(){var $B=[];if("function"==typeof this._itemRender)var $_=new this._itemRender;else $_=$R.createComp(this._itemRender,null,null,$B);if(0==$B.length&&$_._watchMap){var $Z=$_._watchMap;for(var $n in $Z)for(var $g=$Z[$n],$q=0;$q<$g.length;$q++){var $P=$g[$q];$B.push($P.comp,$P.prop,$P.value)}}return $B.length&&($_._$bindData=$B),$_},$Z.addCell=function($B){$B.on("click",this,this.onCellMouse),$B.on("rightclick",this,this.onCellMouse),$B.on("mouseover",this,this.onCellMouse),$B.on("mouseout",this,this.onCellMouse),$B.on("mousedown",this,this.onCellMouse),$B.on("mouseup",this,this.onCellMouse),this._cells.push($B)},$Z.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $B=0,$_=$B=0;$_<1e4;$_++){var $Z=this.getChildByName("item"+$_);if(!$Z)break;this.addCell($Z),$B++}this.repeatY=$B}},$Z.setContentSize=function($B,$_){this._content.width=$B,this._content.height=$_,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $j),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$B,$_),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$Z.onCellMouse=function($B){"mousedown"===$B.type&&(this._isMoved=!1);var $_=$B.currentTarget,$Z=this._startIndex+this._cells.indexOf($_);$Z<0||("click"===$B.type||"rightclick"===$B.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$Z:this.changeCellState($_,!0,0):"mouseover"!==$B.type&&"mouseout"!==$B.type||this._selectedIndex===$Z||this.changeCellState($_,"mouseover"===$B.type,0),this.mouseHandler&&this.mouseHandler.runWith([$B,$Z]))},$Z.changeCellState=function($B,$_,$Z){var $n=$B.getChildByName("selectBox");$n&&(this.selectEnable=!0,$n.visible=$_,$n.index=$Z)},$Z.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$Z.onScrollBarChange=function($B){this.runCallLater(this.changeCells);var $_=this._scrollBar.value,$Z=this._isVertical?this.repeatX:this.repeatY,$n=this._isVertical?this.repeatY:this.repeatX,$g=Math.floor($_/this._cellSize);if(this.cacheContent)$P=$n+1,this._createdLine-$g<$P&&(this._createItems(this._createdLine,$Z,this._createdLine+$P),this.renderItems(this._createdLine*$Z,0),this._createdLine+=$P);else{var $q=$g*$Z,$P=0;if($q>this._startIndex){$P=$q-this._startIndex;var $k=!0,$m=this._startIndex+$Z*($n+1);this._isMoved=!0}else $q<this._startIndex&&($P=this._startIndex-$q,$k=!1,$m=this._startIndex-1,this._isMoved=!0);for(var $D=0;$D<$P;$D++){if($k){var $T=this._cells.shift();this._cells[this._cells.length]=$T;var $e=$m+$D}else $T=this._cells.pop(),this._cells.unshift($T),$e=$m-$D;var $I=Math.floor($e/$Z)*this._cellSize;this._isVertical?$T.y=$I:$T.x=$I,this.renderItem($T,$e)}this._startIndex=$q,this.changeSelectStatus()}var $A=this._content.scrollRect;this._isVertical?($A.y=$_-this._offset.y,$A.x=-this._offset.x):($A.y=-this._offset.y,$A.x=$_-this._offset.x),this._content.scrollRect=$A},$Z.posCell=function($B,$_){if(this._scrollBar){var $Z=this._isVertical?this.repeatX:this.repeatY,$n=(this._isVertical?this.repeatY:this.repeatX,Math.floor($_/$Z)*this._cellSize);this._isVertical?$B.y=$n:$B.x=$n}},$Z.changeSelectStatus=function(){for(var $B=0,$_=this._cells.length;$B<$_;$B++)this.changeCellState(this._cells[$B],this._selectedIndex===this._startIndex+$B,1)},$Z.renderItems=function($B,$_){void 0===$B&&($B=0),void 0===$_&&($_=0);for(var $Z=$B,$n=$_||this._cells.length;$Z<$n;$Z++)this.renderItem(this._cells[$Z],this._startIndex+$Z);this.changeSelectStatus(),this._twDone=!0},$Z.renderItem=function($B,$_){this._array&&0<=$_&&$_<this._array.length?($B.visible=!0,$B._$bindData?($B._dataSource=this._array[$_],this._bindData($B,this._array[$_])):$B.dataSource=this._array[$_],this.cacheContent||this.posCell($B,$_),this.hasListener("render")&&this.event("render",[$B,$_]),this.renderHandler&&this.renderHandler.runWith([$B,$_]),this.renderTwHandler&&this.renderTwHandler.runWith([$B,$_])):($B.visible=!1,$B.dataSource=null)},$Z._bindData=function($B,$_){for(var $Z=$B._$bindData,$n=0,$g=$Z.length;$n<$g;$n++){var $q=$Z[$n++],$P=$Z[$n++],$k=$Z[$n],$m=$L.getBindFun($k);$q[$P]=$m.call(this,$_)}},$Z.refresh=function(){this.array=this._array},$Z.getItem=function($B){return-1<$B&&$B<this._array.length?this._array[$B]:null},$Z.changeItem=function($B,$_){-1<$B&&$B<this._array.length&&(this._array[$B]=$_,$B>=this._startIndex&&$B<this._startIndex+this._cells.length&&this.renderItem(this.getCell($B),$B))},$Z.setItem=function($B,$_){this.changeItem($B,$_)},$Z.addItem=function($B){this._array.push($B),this.array=this._array},$Z.addItemAt=function($B,$_){this._array.splice($_,0,$B),this.array=this._array},$Z.deleteItem=function($B){this._array.splice($B,1),this.array=this._array},$Z.getCell=function($B){return this.runCallLater(this.changeCells),-1<$B&&this._cells?this._cells[($B-this._startIndex)%this._cells.length]:null},$Z.scrollTo=function($B){if(this._scrollBar){var $_=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($B/$_)*this._cellSize}else this.startIndex=$B},$Z.tweenTo=function($B,$_,$Z){if(void 0===$_&&($_=200),this._scrollBar){var $n=this._isVertical?this.repeatX:this.repeatY;$N.to(this._scrollBar,{value:Math.floor($B/$n)*this._cellSize},$_,null,$Z,0,!0)}else this.startIndex=$B,$Z&&$Z.run()},$Z._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$Z.commitMeasure=function(){this.runCallLater(this.changeCells)},$P(0,$Z,"cacheAs",$B.prototype._$get_cacheAs,function($B){$w.superSet($u,this,"cacheAs",$B),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$B?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$P(0,$Z,"content",function(){return this._content}),$P(0,$Z,"height",$B.prototype._$get_height,function($B){$B!=this._height&&($w.superSet($u,this,"height",$B),this._setCellChanged())}),$P(0,$Z,"itemRender",function(){return this._itemRender},function($B){if(this._itemRender!=$B){this._itemRender=$B;for(var $_=this._cells.length-1;-1<$_;$_--)this._cells[$_].destroy();this._cells.length=0,this._setCellChanged()}}),$P(0,$Z,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($B){this._removePreScrollBar();var $_=new $_B;$_.name="scrollBar",$_.right=0,$B&&" "!=$B&&($_.skin=$B),this.scrollBar=$_,this.addChild($_),this._setCellChanged()}),$P(0,$Z,"page",function(){return this._page},function($B){this._page=$B,this._array&&(this._page=0<$B?$B:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$P(0,$Z,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($B){this._removePreScrollBar();var $_=new $O;$_.name="scrollBar",$_.bottom=0,$B&&" "!=$B&&($_.skin=$B),this.scrollBar=$_,this.addChild($_),this._setCellChanged()}),$P(0,$Z,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($B){this._repeatX=$B,this._setCellChanged()}),$P(0,$Z,"scrollBar",function(){return this._scrollBar},function($B){this._scrollBar!=$B&&(this._scrollBar=$B)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$P(0,$Z,"width",$B.prototype._$get_width,function($B){$B!=this._width&&($w.superSet($u,this,"width",$B),this._setCellChanged())}),$P(0,$Z,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($B){this._repeatY=$B,this._setCellChanged()}),$P(0,$Z,"spaceX",function(){return this._spaceX},function($B){this._spaceX=$B,this._setCellChanged()}),$P(0,$Z,"spaceY",function(){return this._spaceY},function($B){this._spaceY=$B,this._setCellChanged()}),$P(0,$Z,"selectedIndex",function(){return this._selectedIndex},function($B){this._selectedIndex!=$B&&(this._selectedIndex=$B,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($B),this.startIndex=this._startIndex)}),$P(0,$Z,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($B){this.selectedIndex=this._array.indexOf($B)}),$P(0,$Z,"length",function(){return this._array?this._array.length:0}),$P(0,$Z,"selection",function(){return this.getCell(this._selectedIndex)},function($B){this.selectedIndex=this._startIndex+this._cells.indexOf($B)}),$P(0,$Z,"startIndex",function(){return this._startIndex},function($B){this._startIndex=0<$B?$B:0,this.callLater(this.renderItems)}),$P(0,$Z,"twSwitch",function(){return this._twSwitch},function($B){this._twSwitch=$B}),$P(0,$Z,"twDone",function(){return this._twDone},function($B){this._twDone=$B}),$P(0,$Z,"array",function(){return this._array},function($B){this.runCallLater(this.changeCells),this._array=$B||[];var $_=this._array.length;if(this.totalPage=Math.ceil($_/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$_?this._selectedIndex:$_-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $Z=this._isVertical?this.repeatX:this.repeatY,$n=this._isVertical?this.repeatY:this.repeatX,$g=Math.ceil($_/$Z);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$n/$g,this._scrollBar.setScroll(0,($g-$n)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$P(0,$Z,"dataSource",$B.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)&&Math.floor($B)==$B||"string"==typeof $B?this.selectedIndex=parseInt($B):$B instanceof Array?this.array=$B:$w.superSet($u,this,"dataSource",$B)}),$P(0,$Z,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$_}($u),$O=function($B){function $_(){$_.__super.call(this)}return $q($_,"laya.ui.HScrollBar",$B),$_.prototype.initialize=function(){$B.prototype.initialize.call(this),this.slider.isVertical=!1},$_}($K),$d=function($B){function $_(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$_.__super.call(this),this.width=this.height=100}$q($_,"laya.ui.Panel",$B);var $Z=$_.prototype;return $Z.destroy=function($B){void 0===$B&&($B=!0),laya.ui.Component.prototype.destroy.call(this,$B),this._content&&this._content.destroy($B),this._vScrollBar&&this._vScrollBar.destroy($B),this._hScrollBar&&this._hScrollBar.destroy($B),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$Z.destroyChildren=function(){this._content.destroyChildren()},$Z.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $u)},$Z.addChild=function($B){return $B.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($B)},$Z.onResize=function(){this._setScrollChanged()},$Z.addChildAt=function($B,$_){return $B.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($B,$_)},$Z.removeChild=function($B){return $B.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($B)},$Z.removeChildAt=function($B){return this.getChildAt($B).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($B)},$Z.removeChildren=function($B,$_){return void 0===$B&&($B=0),void 0===$_&&($_=2147483647),this._content.removeChildren($B,$_),this._setScrollChanged(),this},$Z.getChildAt=function($B){return this._content.getChildAt($B)},$Z.getChildByName=function($B){return this._content.getChildByName($B)},$Z.getChildIndex=function($B){return this._content.getChildIndex($B)},$Z.changeScroll=function(){this._scrollChanged=!1;var $B=this.contentWidth||1,$_=this.contentHeight||1,$Z=this._vScrollBar,$n=this._hScrollBar,$g=$Z&&$_>this._height,$q=$n&&$B>this._width,$P=$g?this._width-$Z.width:this._width,$k=$q?this._height-$n.height:this._height;$Z&&($Z.x=this._width-$Z.width,$Z.y=0,$Z.height=this._height-($q?$n.height:0),$Z.scrollSize=Math.max(.033*this._height,1),$Z.thumbPercent=$k/$_,$Z.setScroll(0,$_-$k,$Z.value)),$n&&($n.x=0,$n.y=this._height-$n.height,$n.width=this._width-($g?$Z.width:0),$n.scrollSize=Math.max(.033*this._width,1),$n.thumbPercent=$P/$B,$n.setScroll(0,$B-$P,$n.value))},$Z.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$Z.setContentSize=function($B,$_){var $Z=this._content;$Z.width=$B,$Z.height=$_,$Z.scrollRect||($Z.scrollRect=new $j),$Z.scrollRect.setTo(0,0,$B,$_),$Z.scrollRect=$Z.scrollRect},$Z.onScrollBarChange=function($B){var $_=this._content.scrollRect;if($_){var $Z=Math.round($B.value);$B.isVertical?$_.y=$Z:$_.x=$Z,this._content.scrollRect=$_}},$Z.scrollTo=function($B,$_){void 0===$B&&($B=0),void 0===$_&&($_=0),this.vScrollBar&&(this.vScrollBar.value=$_),this.hScrollBar&&(this.hScrollBar.value=$B)},$Z.refresh=function(){this.changeScroll()},$Z.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$w.superGet($u,this,"cacheAs")),$w.superSet($u,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$Z.onScrollEnd=function(){$w.superSet($u,this,"cacheAs",this._$P.cacheAs)},$Z._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$P(0,$Z,"numChildren",function(){return this._content.numChildren}),$P(0,$Z,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($B){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $O),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$B}),$P(0,$Z,"contentWidth",function(){for(var $B=0,$_=this._content.numChildren-1;-1<$_;$_--){var $Z=this._content.getChildAt($_);$B=Math.max($Z.x+$Z.width*$Z.scaleX,$B)}return $B}),$P(0,$Z,"contentHeight",function(){for(var $B=0,$_=this._content.numChildren-1;-1<$_;$_--){var $Z=this._content.getChildAt($_);$B=Math.max($Z.y+$Z.height*$Z.scaleY,$B)}return $B}),$P(0,$Z,"width",$B.prototype._$get_width,function($B){$w.superSet($u,this,"width",$B),this._setScrollChanged()}),$P(0,$Z,"hScrollBar",function(){return this._hScrollBar}),$P(0,$Z,"content",function(){return this._content}),$P(0,$Z,"height",$B.prototype._$get_height,function($B){$w.superSet($u,this,"height",$B),this._setScrollChanged()}),$P(0,$Z,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($B){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $_B),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$B}),$P(0,$Z,"vScrollBar",function(){return this._vScrollBar}),$P(0,$Z,"cacheAs",$B.prototype._$get_cacheAs,function($B){$w.superSet($u,this,"cacheAs",$B),this._$P.cacheAs=null,"none"!==$B?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$_}($u),$a=function($B){function $_($B){$_.__super.call(this,$B),this.isVertical=!1}return $q($_,"laya.ui.HSlider",$H),$_}(),$i=function($B){function $Z($B,$_){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$Z.__super.call(this),this.skin=$_,this.labels=$B}$q($Z,"laya.ui.UIGroup",$B);var $_=$Z.prototype;return $w.imps($_,{"laya.ui.IItem":!0}),$_.preinitialize=function(){this.mouseEnabled=!0},$_.destroy=function($B){void 0===$B&&($B=!0),laya.ui.Component.prototype.destroy.call(this,$B),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$_.addItem=function($B,$_){void 0===$_&&($_=!0);var $Z=$B,$n=this._items.length;if($Z.name="item"+$n,this.addChild($Z),this.initItems(),$_&&0<$n){var $g=this._items[$n-1];"horizontal"==this._direction?$Z.x=$g.x+$g.width+this._space:$Z.y=$g.y+$g.height+this._space}else $_&&($Z.x=0,$Z.y=0);return $n},$_.delItem=function($B,$_){void 0===$_&&($_=!0);var $Z=this._items.indexOf($B);if(-1!=$Z){var $n=$B;this.removeChild($n);for(var $g=$Z+1,$q=this._items.length;$g<$q;$g++){var $P=this._items[$g];$P.name="item"+($g-1),$_&&("horizontal"==this._direction?$P.x-=$n.width+this._space:$P.y-=$n.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $k;$k=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$k}}},$_.initItems=function(){this._items||(this._items=[]);for(var $B=this._items.length=0;$B<1e4;$B++){var $_=this.getChildByName("item"+$B);if(null==$_)break;this._items.push($_),$_.selected=$B===this._selectedIndex,$_.clickHandler=$I.create(this,this.itemClick,[$B],!1)}},$_.itemClick=function($B){this.selectedIndex=$B},$_.setSelect=function($B,$_){this._items&&-1<$B&&$B<this._items.length&&(this._items[$B].selected=$_)},$_.createItem=function($B,$_){return null},$_.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $B=0,$_=0,$Z=this._items.length;$_<$Z;$_++){var $n=this._items[$_];this._skin&&($n.skin=this._skin),this._labelColors&&($n.labelColors=this._labelColors),this._labelSize&&($n.labelSize=this._labelSize),this._labelStroke&&($n.labelStroke=this._labelStroke),this._labelStrokeColor&&($n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($n.strokeColors=this._strokeColors),this._labelBold&&($n.labelBold=this._labelBold),this._labelPadding&&($n.labelPadding=this._labelPadding),this._labelAlign&&($n.labelAlign=this._labelAlign),this._stateNum&&($n.stateNum=this._stateNum),this._labelFont&&($n.labelFont=this._labelFont),"horizontal"===this._direction?($n.y=0,$n.x=$B,$B+=$n.width+this._space):($n.x=0,$n.y=$B,$B+=$n.height+this._space)}this.changeSize()},$_.commitMeasure=function(){this.runCallLater(this.changeLabels)},$_._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$P(0,$_,"labelStrokeColor",function(){return this._labelStrokeColor},function($B){this._labelStrokeColor!=$B&&(this._labelStrokeColor=$B,this._setLabelChanged())}),$P(0,$_,"skin",function(){return this._skin},function($B){this._skin!=$B&&(this._skin=$B,this._setLabelChanged())}),$P(0,$_,"selectedIndex",function(){return this._selectedIndex},function($B){this._selectedIndex!=$B&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$B,this.setSelect($B,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$P(0,$_,"labels",function(){return this._labels},function($B){if(this._labels!=$B){if(this._labels=$B,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $_=this._labels.split(","),$Z=0,$n=$_.length;$Z<$n;$Z++){var $g=this.createItem(this._skin,$_[$Z]);$g.name="item"+$Z,this.addChild($g)}this.initItems()}}),$P(0,$_,"strokeColors",function(){return this._strokeColors},function($B){this._strokeColors!=$B&&(this._strokeColors=$B,this._setLabelChanged())}),$P(0,$_,"labelColors",function(){return this._labelColors},function($B){this._labelColors!=$B&&(this._labelColors=$B,this._setLabelChanged())}),$P(0,$_,"labelStroke",function(){return this._labelStroke},function($B){this._labelStroke!=$B&&(this._labelStroke=$B,this._setLabelChanged())}),$P(0,$_,"labelSize",function(){return this._labelSize},function($B){this._labelSize!=$B&&(this._labelSize=$B,this._setLabelChanged())}),$P(0,$_,"stateNum",function(){return this._stateNum},function($B){this._stateNum!=$B&&(this._stateNum=$B,this._setLabelChanged())}),$P(0,$_,"labelBold",function(){return this._labelBold},function($B){this._labelBold!=$B&&(this._labelBold=$B,this._setLabelChanged())}),$P(0,$_,"labelFont",function(){return this._labelFont},function($B){this._labelFont!=$B&&(this._labelFont=$B,this._setLabelChanged())}),$P(0,$_,"labelPadding",function(){return this._labelPadding},function($B){this._labelPadding!=$B&&(this._labelPadding=$B,this._setLabelChanged())}),$P(0,$_,"direction",function(){return this._direction},function($B){this._direction=$B,this._setLabelChanged()}),$P(0,$_,"space",function(){return this._space},function($B){this._space=$B,this._setLabelChanged()}),$P(0,$_,"items",function(){return this._items}),$P(0,$_,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($B){this.selectedIndex=this._items.indexOf($B)}),$P(0,$_,"dataSource",$B.prototype._$get_dataSource,function($B){"number"==typeof(this._dataSource=$B)&&Math.floor($B)==$B||"string"==typeof $B?this.selectedIndex=parseInt($B):$B instanceof Array?this.labels=$B.join(","):$w.superSet($u,this,"dataSource",$B)}),$Z}($u),$c=function($_){function $Z($B,$_){this._value=null,void 0===$_&&($_=""),$Z.__super.call(this,$B,$_)}$q($Z,"laya.ui.Radio",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._value=null},$B.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$B.initialize=function(){$_.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$B.onClick=function($B){this.selected=!0},$P(0,$B,"value",function(){return null!=this._value?this._value:this.label},function($B){this._value=$B}),$Z}($f),$E=function($B){function $_(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$_.__super.call(this),this.width=this.height=200}$q($_,"laya.ui.Tree",$B);var $Z=$_.prototype;return $w.imps($Z,{"laya.ui.IRender":!0}),$Z.destroy=function($B){void 0===$B&&($B=!0),laya.ui.Component.prototype.destroy.call(this,$B),this._list&&this._list.destroy($B),this._list=null,this._source=null,this._renderHandler=null},$Z.createChildren=function(){this.addChild(this._list=new $S),this._list.renderHandler=$I.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$Z.onListChange=function($B){this.event("change")},$Z.getArray=function(){var $B,$_=[];for(var $Z in this._source)$B=this._source[$Z],this.getParentOpenStatus($B)&&($B.x=this._spaceLeft*this.getDepth($B),$_.push($B));return $_},$Z.getDepth=function($B,$_){return void 0===$_&&($_=0),null==$B.nodeParent?$_:this.getDepth($B.nodeParent,$_+1)},$Z.getParentOpenStatus=function($B){var $_=$B.nodeParent;return null==$_||!!$_.isOpen&&(null==$_.nodeParent||this.getParentOpenStatus($_))},$Z.renderItem=function($B,$_){var $Z=$B.dataSource;if($Z){$B.left=$Z.x;var $n=$B.getChildByName("arrow");$n&&($Z.hasChild?($n.visible=!0,$n.index=$Z.isOpen?1:0,$n.tag=$_,$n.off("click",this,this.onArrowClick),$n.on("click",this,this.onArrowClick)):$n.visible=!1);var $g=$B.getChildByName("folder");$g&&(2==$g.clipY?$g.index=$Z.isDirectory?0:1:$g.index=$Z.isDirectory?$Z.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$B,$_])}},$Z.onArrowClick=function($B){var $_=$B.currentTarget.tag;this._list.array[$_].isOpen=!this._list.array[$_].isOpen,this.event("open"),this._list.array=this.getArray()},$Z.setItemState=function($B,$_){this._list.array[$B]&&(this._list.array[$B].isOpen=$_,this._list.array=this.getArray())},$Z.fresh=function(){this._list.array=this.getArray(),this.repaint()},$Z.parseXml=function($B,$_,$Z,$n){var $g,$q=$B.childNodes,$P=$q.length;if(!$n){$g={};var $k,$m=$B.attributes;for(var $D in $m){var $T=($k=$m[$D]).nodeName,$e=$k.nodeValue;$g[$T]="true"==$e||"false"!=$e&&$e}$g.nodeParent=$Z,0<$P&&($g.isDirectory=!0),$g.hasChild=0<$P,$_.push($g)}for(var $I=0;$I<$P;$I++){var $A=$q[$I];this.parseXml($A,$_,$g,!1)}},$Z.parseOpenStatus=function($B,$_){for(var $Z=0,$n=$_.length;$Z<$n;$Z++){var $g=$_[$Z];if($g.isDirectory)for(var $q=0,$P=$B.length;$q<$P;$q++){var $k=$B[$q];if($k.isDirectory&&this.isSameParent($k,$g)&&$g.label==$k.label){$g.isOpen=$k.isOpen;break}}}},$Z.isSameParent=function($B,$_){return null==$B.nodeParent&&null==$_.nodeParent||null!=$B.nodeParent&&null!=$_.nodeParent&&($B.nodeParent.label==$_.nodeParent.label&&this.isSameParent($B.nodeParent,$_.nodeParent))},$Z.filter=function($B){if(Boolean($B)){var $_=[];this.getFilterSource(this._source,$_,$B),this._list.array=$_}else this._list.array=this.getArray()},$Z.getFilterSource=function($B,$_,$Z){var $n;for(var $g in $Z=$Z.toLocaleLowerCase(),$B)!($n=$B[$g]).isDirectory&&-1<String($n.label).toLowerCase().indexOf($Z)&&($n.x=0,$_.push($n)),$n.child&&0<$n.child.length&&this.getFilterSource($n.child,$_,$Z)},$P(0,$Z,"spaceBottom",function(){return this._list.spaceY},function($B){this._list.spaceY=$B}),$P(0,$Z,"keepStatus",function(){return this._keepStatus},function($B){this._keepStatus=$B}),$P(0,$Z,"itemRender",function(){return this._list.itemRender},function($B){this._list.itemRender=$B}),$P(0,$Z,"array",function(){return this._list.array},function($B){this._keepStatus&&this._list.array&&$B&&this.parseOpenStatus(this._list.array,$B),this._source=$B,this._list.array=this.getArray()}),$P(0,$Z,"mouseHandler",function(){return this._list.mouseHandler},function($B){this._list.mouseHandler=$B}),$P(0,$Z,"dataSource",$B.prototype._$get_dataSource,function($B){this._dataSource=$B,$w.superSet($u,this,"dataSource",$B)}),$P(0,$Z,"source",function(){return this._source}),$P(0,$Z,"scrollBar",function(){return this._list.scrollBar}),$P(0,$Z,"list",function(){return this._list}),$P(0,$Z,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($B){this._list.vScrollBarSkin=$B}),$P(0,$Z,"renderHandler",function(){return this._renderHandler},function($B){this._renderHandler=$B}),$P(0,$Z,"selectedIndex",function(){return this._list.selectedIndex},function($B){this._list.selectedIndex=$B}),$P(0,$Z,"spaceLeft",function(){return this._spaceLeft},function($B){this._spaceLeft=$B}),$P(0,$Z,"selectedItem",function(){return this._list.selectedItem},function($B){this._list.selectedItem=$B}),$P(0,$Z,"width",$B.prototype._$get_width,function($B){$w.superSet($u,this,"width",$B),this._list.width=$B}),$P(0,$Z,"height",$B.prototype._$get_height,function($B){$w.superSet($u,this,"height",$B),this._list.height=$B}),$P(0,$Z,"xml",null,function($B){var $_=[];this.parseXml($B.childNodes[0],$_,null,!0),this.array=$_}),$P(0,$Z,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$_}($u),$BB=function($B){function $_(){this._items=null,this._selectedIndex=0,$_.__super.call(this),this._setIndexHandler=$I.create(this,this.setIndex,null,!1)}$q($_,"laya.ui.ViewStack",$B);var $Z=$_.prototype;return $w.imps($Z,{"laya.ui.IItem":!0}),$Z.setItems=function($B){this.removeChildren();for(var $_=0,$Z=0,$n=$B.length;$Z<$n;$Z++){var $g=$B[$Z];$g&&($g.name="item"+$_,this.addChild($g),$_++)}this.initItems()},$Z.addItem=function($B){$B.name="item"+this._items.length,this.addChild($B),this.initItems()},$Z.initItems=function(){this._items=[];for(var $B=0;$B<1e4;$B++){var $_=this.getChildByName("item"+$B);if(null==$_)break;this._items.push($_),$_.visible=$B==this._selectedIndex}},$Z.setSelect=function($B,$_){this._items&&-1<$B&&$B<this._items.length&&(this._items[$B].visible=$_)},$Z.setIndex=function($B){this.selectedIndex=$B},$P(0,$Z,"dataSource",$B.prototype._$get_dataSource,function($B){if("number"==typeof(this._dataSource=$B)&&Math.floor($B)==$B||"string"==typeof $B)this.selectedIndex=parseInt($B);else for(var $_ in this._dataSource)this.hasOwnProperty($_)&&(this[$_]=this._dataSource[$_])}),$P(0,$Z,"selectedIndex",function(){return this._selectedIndex},function($B){this._selectedIndex!=$B&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$B,this.setSelect(this._selectedIndex,!0))}),$P(0,$Z,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($B){this.selectedIndex=this._items.indexOf($B)}),$P(0,$Z,"items",function(){return this._items}),$P(0,$Z,"setIndexHandler",function(){return this._setIndexHandler},function($B){this._setIndexHandler=$B}),$_}($u),$_B=function($B){function $_(){$_.__super.call(this)}return $q($_,"laya.ui.VScrollBar",$K),$_}(),$ZB=function($_){function $Z($B){this._bg=null,this._skin=null,$Z.__super.call(this),void 0===$B&&($B=""),this.text=$B,this.skin=this.skin}$q($Z,"laya.ui.TextInput",$_);var $B=$Z.prototype;return $B.preinitialize=function(){this.mouseEnabled=!0},$B.destroy=function($B){$y.clearCache(this,this._skin),void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._bg&&this._bg.destroy(),this._bg=null},$B.createChildren=function(){this.addChild(this._tf=new $A),this._tf.padding=$l.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$B._onFocus=function(){this.event("focus",this)},$B._onBlur=function(){this.event("blur",this)},$B._onInput=function(){this.event("input",this)},$B._onEnter=function(){this.event("enter",this)},$B.initialize=function(){this.width=128,this.height=22},$B.select=function(){this._tf.select()},$B.setSelection=function($B,$_){this._tf.setSelection($B,$_)},$P(0,$B,"text",$_.prototype._$get_text,function($B){this._tf.text!=$B&&($B+="",this._tf.text=$B,this.event("change"))}),$P(0,$B,"bg",function(){return this._bg},function($B){this.graphics=this._bg=$B}),$P(0,$B,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($B){this._tf.inputElementYAdjuster=$B}),$P(0,$B,"multiline",function(){return this._tf.multiline},function($B){this._tf.multiline=$B}),$P(0,$B,"skin",function(){return this._skin},function($B){this._skin!=$B&&($y.clearCache(this,this._skin),this._skin=$B,this._bg||(this.graphics=this._bg=new $V),$y.keepCache(this,this._skin),this._bg.source=$y.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$P(0,$B,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($B){this._bg||(this.graphics=this._bg=new $V),this._bg.sizeGrid=$L.fillArray($l.defaultSizeGrid,$B,Number)}),$P(0,$B,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($B){this._tf.inputElementXAdjuster=$B}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($W,this,"width",$B),this._bg&&(this._bg.width=$B)}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($W,this,"height",$B),this._bg&&(this._bg.height=$B)}),$P(0,$B,"editable",function(){return this._tf.editable},function($B){this._tf.editable=$B}),$P(0,$B,"restrict",function(){return this._tf.restrict},function($B){this._tf.restrict=$B}),$P(0,$B,"prompt",function(){return this._tf.prompt},function($B){this._tf.prompt=$B}),$P(0,$B,"promptColor",function(){return this._tf.promptColor},function($B){this._tf.promptColor=$B}),$P(0,$B,"maxChars",function(){return this._tf.maxChars},function($B){this._tf.maxChars=$B}),$P(0,$B,"focus",function(){return this._tf.focus},function($B){this._tf.focus=$B}),$P(0,$B,"type",function(){return this._tf.type},function($B){this._tf.type=$B}),$P(0,$B,"asPassword",function(){return this._tf.asPassword},function($B){this._tf.asPassword=$B}),$Z}($W),$nB=function($B){function $_(){$_.__super.call(this)}return $q($_,"laya.ui.VSlider",$H),$_}(),$gB=function($B){function $n(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$n.__super.call(this)}$q($n,"laya.ui.Dialog",$B);var $_=$n.prototype;return $_.initialize=function(){this.popupEffect=$n.manager.popupEffectHandler,this.closeEffect=$n.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$_._dealDragArea=function(){var $B=this.getChildByName("drag");$B&&(this.dragArea=$B.x+","+$B.y+","+$B.width+","+$B.height,$B.removeSelf())},$_._onClick=function($B){var $_=$B.target;if($_)switch($_.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($_.name)}},$_.show=function($B,$_){void 0===$B&&($B=!1),void 0===$_&&($_=!0),this._open(!1,$B,$_)},$_.popup=function($B,$_){void 0===$B&&($B=!1),void 0===$_&&($_=!0),this._open(!0,$B,$_)},$_._open=function($B,$_,$Z){$n.manager.lock(!1),this.isModal=$B,$n.manager.open(this,$_,$Z)},$_.onOpened=function(){},$_.close=function($B,$_){void 0===$_&&($_=!0),$n.manager.close(this,$B,$_)},$_.onClosed=function($B){},$_._onMouseDown=function($B){var $_=this.getMousePoint();this._dragArea.contains($_.x,$_.y)?this.startDrag():this.stopDrag()},$P(0,$_,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($B){if($B){var $_=$L.fillArray([0,0,0,0],$B,Number);this._dragArea=new $j($_[0],$_[1],$_[2],$_[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$P(0,$_,"isPopup",function(){return null!=this.parent}),$P(0,$_,"zOrder",$B.prototype._$get_zOrder,function($B){$w.superSet($R,this,"zOrder",$B),$n.manager._checkMask()}),$P(1,$n,"manager",function(){return $n._manager=$n._manager||new $F},function($B){$n._manager=$B}),$n.setLockView=function($B){$n.manager.setLockView($B)},$n.lock=function($B){$n.manager.lock($B)},$n.closeAll=function(){$n.manager.closeAll()},$n.getDialogsByGroup=function($B){return $n.manager.getDialogsByGroup($B)},$n.closeByGroup=function($B){return $n.manager.closeByGroup($B)},$n.CLOSE="close",$n.CANCEL="cancel",$n.SURE="sure",$n.NO="no",$n.OK="ok",$n.YES="yes",$n._manager=null,$n}($R),$qB=function($B){function $_(){$_.__super.call(this)}$q($_,"laya.ui.HBox",$B);var $Z=$_.prototype;return $Z.sortItem=function($B){$B&&$B.sort(function($B,$_){return $B.x-$_.x})},$Z.changeItems=function(){this._itemChanged=!1;for(var $B=[],$_=0,$Z=0,$n=this.numChildren;$Z<$n;$Z++){var $g=this.getChildAt($Z);$g&&$g.layoutEnabled&&($B.push($g),$_=this._height?this._height:Math.max($_,$g.height*$g.scaleY))}this.sortItem($B);var $q=0;for($Z=0,$n=$B.length;$Z<$n;$Z++)($g=$B[$Z]).x=$q,$q+=$g.width*$g.scaleX+this._space,"top"==this._align?$g.y=0:"middle"==this._align?$g.y=.5*($_-$g.height*$g.scaleY):"bottom"==this._align&&($g.y=$_-$g.height*$g.scaleY);this.changeSize()},$P(0,$Z,"height",$B.prototype._$get_height,function($B){this._height!=$B&&($w.superSet($s,this,"height",$B),this.callLater(this.changeItems))}),$_.NONE="none",$_.TOP="top",$_.MIDDLE="middle",$_.BOTTOM="bottom",$_}($s),$PB=function($B){function $_(){$_.__super.call(this)}$q($_,"laya.ui.VBox",$B);var $Z=$_.prototype;return $Z.changeItems=function(){this._itemChanged=!1;for(var $B=[],$_=0,$Z=0,$n=this.numChildren;$Z<$n;$Z++){var $g=this.getChildAt($Z);$g&&$g.layoutEnabled&&($B.push($g),$_=this._width?this._width:Math.max($_,$g.width*$g.scaleX))}this.sortItem($B);var $q=0;for($Z=0,$n=$B.length;$Z<$n;$Z++)($g=$B[$Z]).y=$q,$q+=$g.height*$g.scaleY+this._space,"left"==this._align?$g.x=0:"center"==this._align?$g.x=.5*($_-$g.width*$g.scaleX):"right"==this._align&&($g.x=$_-$g.width*$g.scaleX);this.changeSize()},$P(0,$Z,"width",$B.prototype._$get_width,function($B){this._width!=$B&&($w.superSet($s,this,"width",$B),this.callLater(this.changeItems))}),$_.NONE="none",$_.LEFT="left",$_.CENTER="center",$_.RIGHT="right",$_}($s),$kB=function($B){function $_(){$_.__super.call(this)}return $q($_,"laya.ui.RadioGroup",$i),$_.prototype.createItem=function($B,$_){return new $c($B,$_)},$_}(),$mB=function($B){function $_(){$_.__super.call(this)}return $q($_,"laya.ui.Tab",$i),$_.prototype.createItem=function($B,$_){return new $f($B,$_)},$_}(),$DB=function($_){function $Z($B){this._vScrollBar=null,this._hScrollBar=null,void 0===$B&&($B=""),$Z.__super.call(this,$B)}$q($Z,"laya.ui.TextArea",$_);var $B=$Z.prototype;return $B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$B.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$B.onVBarChanged=function($B){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$B.onHBarChanged=function($B){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$B.changeScroll=function(){var $B=this._vScrollBar&&0<this._tf.maxScrollY,$_=this._hScrollBar&&0<this._tf.maxScrollX,$Z=$B?this._width-this._vScrollBar.width:this._width,$n=$_?this._height-this._hScrollBar.height:this._height,$g=this._tf.padding||$l.labelPadding;this._tf.width=$Z,this._tf.height=$n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$g[2],this._vScrollBar.y=$g[1],this._vScrollBar.height=this._height-($_?this._hScrollBar.height:0)-$g[1]-$g[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$n/Math.max(this._tf.textHeight,$n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$B),this._hScrollBar&&(this._hScrollBar.x=$g[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$g[3],this._hScrollBar.width=this._width-($B?this._vScrollBar.width:0)-$g[0]-$g[2],this._hScrollBar.scrollSize=Math.max(.033*$Z,1),this._hScrollBar.thumbPercent=$Z/Math.max(this._tf.textWidth,$Z),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$_)},$B.scrollTo=function($B){this.commitMeasure(),this._tf.scrollY=$B},$P(0,$B,"scrollY",function(){return this._tf.scrollY}),$P(0,$B,"width",$_.prototype._$get_width,function($B){$w.superSet($ZB,this,"width",$B),this.callLater(this.changeScroll)}),$P(0,$B,"hScrollBar",function(){return this._hScrollBar}),$P(0,$B,"height",$_.prototype._$get_height,function($B){$w.superSet($ZB,this,"height",$B),this.callLater(this.changeScroll)}),$P(0,$B,"maxScrollX",function(){return this._tf.maxScrollX}),$P(0,$B,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($B){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $_B),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$B}),$P(0,$B,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($B){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $O),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$B}),$P(0,$B,"vScrollBar",function(){return this._vScrollBar}),$P(0,$B,"maxScrollY",function(){return this._tf.maxScrollY}),$P(0,$B,"scrollX",function(){return this._tf.scrollX}),$Z}($ZB);!function($B){function $_(){this._uiView=null,this.isCloseOther=!1,$_.__super.call(this)}$q($_,"laya.ui.AsynDialog",$gB);var $Z=$_.prototype;$Z.createView=function($B){this._uiView=$B},$Z._open=function($B,$_,$Z){this.isModal=$B,this.isCloseOther=$_,$gB.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$Z.onCreated=function(){this.createUI(),this.onOpen()},$Z.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$Z.onOpen=function(){$gB.manager.open(this,this.isCloseOther),$gB.manager.lock(!1)},$Z.close=function($B,$_){void 0===$_&&($_=!0),$gB.manager.close(this),this.onClose()},$Z.onClose=function(){},$Z.destroy=function($B){void 0===$B&&($B=!0),laya.ui.View.prototype.destroy.call(this,$B),this._uiView=null,this.onDestroy()},$Z.onDestroy=function(){}}();$w.__init([$R])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($B,$_){"use strict";for(var $Z in Object.defineProperty($_,"__esModule",{value:!0}),Laya){var $n=Laya[$Z];$n&&$n.__isclass&&($_[$Z]=$n)}}),function($I,$B,$t){$t.un,$t.uns;var $e=$t.static,$A=$t.class,$$=$t.getset,$n=$t.__newvec,$z=laya.maths.Arith,$P=laya.webgl.atlas.AtlasResourceManager,$Z=laya.webgl.shader.BaseShader,$o=laya.utils.Browser,$k=laya.webgl.utils.Buffer,$J=laya.utils.Byte,$g=laya.utils.ClassUtils,$m=$t.Config,$q=(laya.events.Event,laya.events.EventDispatcher),$l=laya.utils.Handler,$j=laya.net.Loader,$_=laya.net.LoaderManager,$D=(laya.maths.MathUtil,laya.display.Node),$w=laya.renders.Render,$T=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$r=laya.resource.Resource,$y=laya.utils.RunDriver,$C=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$N=laya.display.Sprite,$Q=laya.utils.Stat,$M=laya.utils.StringKey,$L=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$Y=laya.utils.Utils,$v=laya.webgl.WebGL,$V=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$t.interface("laya.d3.core.IClone"),$t.interface("laya.d3.graphics.IVertex"),$t.interface("laya.d3.core.render.IUpdate"),$t.interface("laya.d3.core.scene.ITreeNode"),$t.interface("laya.d3.core.render.IRenderable");(function(){function $f(){}$A($f,"laya.d3.animation.AnimationClipParser01"),$f.READ_DATA=function(){$f._DATA.offset=$f._reader.getUint32(),$f._DATA.size=$f._reader.getUint32()},$f.READ_BLOCK=function(){for(var $B=$f._BLOCK.count=$f._reader.getUint16(),$_=$f._BLOCK.blockStarts=[],$Z=$f._BLOCK.blockLengths=[],$n=0;$n<$B;$n++)$_.push($f._reader.getUint32()),$Z.push($f._reader.getUint32())},$f.READ_STRINGS=function(){var $B=$f._reader.getUint32(),$_=$f._reader.getUint16(),$Z=$f._reader.pos;$f._reader.pos=$B+$f._DATA.offset;for(var $n=0;$n<$_;$n++)$f._strings[$n]=$f._reader.readUTFString();$f._reader.pos=$Z},$f.parse=function($B,$_){$f._animationClip=$B;($f._reader=$_).__getBuffer();$f.READ_DATA(),$f.READ_BLOCK(),$f.READ_STRINGS();for(var $Z=0,$n=$f._BLOCK.count;$Z<$n;$Z++){var $g=$_.getUint16(),$q=$f._strings[$g],$P=$f["READ_"+$q];if(null==$P)throw new Error("model file err,no this function:"+$g+" "+$q);$P.call()}},$f.READ_ANIMATIONS=function(){var $B,$_=0,$Z=0,$n=$f._reader,$g=$n.__getBuffer(),$q=[],$P=$n.getUint8();for($q.length=$P,$_=0;$_<$P;$_++)$q[$_]=$n.getUint16();var $k=[],$m=$n.getUint16();for($k.length=$m,$_=0;$_<$m;$_++)$k[$_]=$n.getFloat32();var $D=$f._animationClip;$D.name=$f._strings[$n.getUint16()];var $T=$D._duration=$n.getFloat32();$D.islooping=!!$n.getByte(),$D._frameRate=$n.getInt16();var $e=$n.getInt16(),$I=$D._nodes=new Array;$I.length=$e,($D._publicClipDatas=[]).length=$e;var $A=$D._nodesMap={},$$=0,$w=0;for($_=0;$_<$e;$_++){$B=$I[$_]=new $X;var $r=$n.getUint16(),$j=$B.path=[];for($j.length=$r,$Z=0;$Z<$r;$Z++)$j[$Z]=$f._strings[$n.getUint16()];var $y=$j.join("/"),$C=$A[$y];$C||($A[$y]=$C=[]),$C.push($B);var $z=$n.getInt16();-1!==$z&&($B.componentType=$f._strings[$z]);var $t=$G._propertyIndexDic[$f._strings[$n.getUint16()]];if(null==$t)throw new Error("AnimationClipParser01:unknown property name.");var $J=$t<4,$N=!$J||$J&&""===$j[0];($B._cacheProperty=$N)?$$++:$w++,$B.propertyNameID=$t;var $Q=$q[$n.getUint8()];$B.keyFrameWidth=$Q/4;var $M=$B.keyFrames=[],$Y=$M.length=$n.getUint16(),$l=null,$L=NaN;for($Z=0;$Z<$Y;$Z++){var $v=$M[$Z]=new $W;$L=$v.startTime=$k[$n.getUint16()];var $V=$n.pos;$v.inTangent=new Float32Array($g.slice($V,$V+$Q)),$n.pos+=$Q,$V=$n.pos,$v.outTangent=new Float32Array($g.slice($V,$V+$Q)),$n.pos+=$Q,$V=$n.pos,$v.data=new Float32Array($g.slice($V,$V+$Q)),$n.pos+=$Q,$l&&($l.next=$v,$l.duration=$L-$l.startTime),$l=$v}$v.next=null,$v.duration=$T-$L}var $o=$D._nodeToCachePropertyMap=new Int32Array($e),$F=$D._cachePropertyMap=new Int32Array($$),$u=$D._unCachePropertyMap=new Int32Array($w);for($$=$w=0,$_=0;$_<$e;$_++)($B=$I[$_])._cacheProperty?($o[$_]=$$,$F[$$++]=$_):$u[$w++]=$_},$f._animationClip=null,$f._reader=null,$f._strings=[],$e($f,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $K(){}$A($K,"laya.d3.animation.AnimationClipParser02"),$K.READ_DATA=function(){$K._DATA.offset=$K._reader.getUint32(),$K._DATA.size=$K._reader.getUint32()},$K.READ_BLOCK=function(){for(var $B=$K._BLOCK.count=$K._reader.getUint16(),$_=$K._BLOCK.blockStarts=[],$Z=$K._BLOCK.blockLengths=[],$n=0;$n<$B;$n++)$_.push($K._reader.getUint32()),$Z.push($K._reader.getUint32())},$K.READ_STRINGS=function(){var $B=$K._reader.getUint32(),$_=$K._reader.getUint16(),$Z=$K._reader.pos;$K._reader.pos=$B+$K._DATA.offset;for(var $n=0;$n<$_;$n++)$K._strings[$n]=$K._reader.readUTFString();$K._reader.pos=$Z},$K.parse=function($B,$_){$K._animationClip=$B;($K._reader=$_).__getBuffer();$K.READ_DATA(),$K.READ_BLOCK(),$K.READ_STRINGS();for(var $Z=0,$n=$K._BLOCK.count;$Z<$n;$Z++){var $g=$_.getUint16(),$q=$K._strings[$g],$P=$K["READ_"+$q];if(null==$P)throw new Error("model file err,no this function:"+$g+" "+$q);$P.call()}},$K.READ_ANIMATIONS=function(){var $B,$_=0,$Z=0,$n=$K._reader,$g=$n.__getBuffer(),$q=[],$P=$n.getUint8();for($q.length=$P,$_=0;$_<$P;$_++)$q[$_]=$n.getUint16();var $k=[],$m=$n.getUint16();for($k.length=$m,$_=0;$_<$m;$_++)$k[$_]=$n.getFloat32();var $D=$K._animationClip;$D.name=$K._strings[$n.getUint16()];var $T=$D._duration=$n.getFloat32();$D.islooping=!!$n.getByte(),$D._frameRate=$n.getInt16();var $e=$n.getInt16(),$I=$D._nodes=new Array;$I.length=$e,($D._publicClipDatas=[]).length=$e;var $A=$D._nodesMap={},$$=0,$w=0;for($_=0;$_<$e;$_++){$B=$I[$_]=new $X;var $r=$n.getUint16(),$j=$B.path=[];for($j.length=$r,$Z=0;$Z<$r;$Z++)$j[$Z]=$K._strings[$n.getUint16()];var $y=$j.join("/"),$C=$A[$y];$C||($A[$y]=$C=[]),$C.push($B);var $z=$n.getInt16();-1!==$z&&($B.componentType=$K._strings[$z]);var $t=$G._propertyIndexDic[$K._strings[$n.getUint16()]];if(null==$t)throw new Error("AnimationClipParser02:unknown property name.");var $J=$t<4,$N=!$J||$J&&""===$j[0];($B._cacheProperty=$N)?$$++:$w++,$B.propertyNameID=$t;var $Q=$q[$n.getUint8()];$B.keyFrameWidth=$Q/4;var $M=$B.keyFrames=[],$Y=$M.length=$n.getUint16(),$l=null,$L=NaN;for($Z=0;$Z<$Y;$Z++){var $v=$M[$Z]=new $W;$L=$v.startTime=$k[$n.getUint16()];var $V=$n.pos;$v.inTangent=new Float32Array($g.slice($V,$V+$Q)),$n.pos+=$Q,$V=$n.pos,$v.outTangent=new Float32Array($g.slice($V,$V+$Q)),$n.pos+=$Q,$V=$n.pos,$v.data=new Float32Array($g.slice($V,$V+$Q)),$n.pos+=$Q,$l&&($l.next=$v,$l.duration=$L-$l.startTime),$l=$v}$v.next=null,$v.duration=$T-$L}var $o=$n.getUint16();for($_=0;$_<$o;$_++){var $F,$u=new $H;$u.time=$n.getFloat32(),$u.eventName=$K._strings[$n.getUint16()];var $f=$n.getUint16();for(0<$f&&($u.params=$F=[]),$Z=0;$Z<$f;$Z++){switch($n.getByte()){case 0:$F.push(!!$n.getByte());break;case 1:$F.push($n.getInt32());break;case 2:$F.push($n.getFloat32());break;case 3:$F.push($K._strings[$n.getUint16()]);break;default:throw new Error("unknown type.")}}$D.addEvent($u)}var $b=$D._nodeToCachePropertyMap=new Int32Array($e),$x=$D._cachePropertyMap=new Int32Array($$),$p=$D._unCachePropertyMap=new Int32Array($w);for($$=$w=0,$_=0;$_<$e;$_++)($B=$I[$_])._cacheProperty?($b[$_]=$$,$x[$$++]=$_):$p[$w++]=$_},$K._animationClip=null,$K._reader=null,$K._strings=[],$e($K,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $H=function(){function $B(){this.time=NaN,this.eventName=null,this.params=null}return $A($B,"laya.d3.animation.AnimationEvent"),$B}(),$G=function(){function $n(){this._childs=[],this.transform=new $y_(this)}$A($n,"laya.d3.animation.AnimationNode");var $B=$n.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.addChild=function($B){$B._parent=this,$B.transform.setParent(this.transform),this._childs.push($B)},$B.removeChild=function($B){var $_=this._childs.indexOf($B);-1!==$_&&this._childs.splice($_,1)},$B.getChildByName=function($B){for(var $_=0,$Z=this._childs.length;$_<$Z;$_++){var $n=this._childs[$_];if($n.name===$B)return $n}return null},$B.getChildByIndex=function($B){return this._childs[$B]},$B.getChildCount=function(){return this._childs.length},$B.cloneTo=function($B){var $_=$B;$_.name=this.name;for(var $Z=0,$n=this._childs.length;$Z<$n;$Z++){var $g=this._childs[$Z],$q=$g.clone();$_.addChild($q);var $P=$g.transform,$k=$q.transform;$k.setLocalPosition($P.getLocalPosition()),$k.setLocalRotation($P.getLocalRotation()),$k.setLocalScale($P.getLocalScale()),$k._localRotationEuler=$P._localRotationEuler,$k._setWorldMatrixIgnoreUpdate($P.getWorldMatrix())}},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$n.__init__=function(){$n.registerAnimationNodeProperty("localPosition",$n._getLocalPosition,$n._setLocalPosition),$n.registerAnimationNodeProperty("localRotation",$n._getLocalRotation,$n._setLocalRotation),$n.registerAnimationNodeProperty("localScale",$n._getLocalScale,$n._setLocalScale),$n.registerAnimationNodeProperty("localRotationEuler",$n._getLocalRotationEuler,$n._setLocalRotationEuler),$n.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$n._getParticleRenderSharedMaterialTintColor,$n._setParticleRenderSharedMaterialTintColor),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$n._getMeshRenderSharedMaterialTilingOffset,$n._setMeshRenderSharedMaterialTilingOffset),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$n._getMeshRenderSharedMaterialAlbedo,$n._setMeshRenderSharedMaterialAlbedo),$n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$n._getSkinnedMeshRenderSharedMaterialTilingOffset,$n._setSkinnedMeshRenderSharedMaterialTilingOffset),$n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$n._getSkinnedMeshRenderSharedMaterialAlbedo,$n._setSkinnedMeshRenderSharedMaterialAlbedo),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$n._getMeshRenderSharedMaterialAlbedo,$n._setMeshRenderSharedMaterialAlbedo),$n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$n._getSkinnedMeshRenderSharedMaterialAlbedo,$n._setSkinnedMeshRenderSharedMaterialAlbedo),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$n._getMeshRenderSharedMaterialIntensity,$n._setMeshRenderSharedMaterialIntensity),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$n._getMeshRenderSharedMaterialAlpha,$n._setMeshRenderSharedMaterialAlpha),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$n._getMeshRenderSharedMaterialAlphaColor,$n._setMeshRenderSharedMaterialAlphaColor),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$n._getMeshRenderSharedMaterialBaseColor,$n._setMeshRenderSharedMaterialBaseColor),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$n._getMeshRenderSharedMaterialDissolve,$n._setMeshRenderSharedMaterialDissolve),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$n._getMeshRenderSharedMaterialDissolveSpeed,$n._setMeshRenderSharedMaterialDissolveSpeed),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$n._getMeshRenderSharedMaterialMMultiplier,$n._setMeshRenderSharedMaterialMMultiplier),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$n._getMeshRenderSharedMaterialBaseScrollSpeedX,$n._setMeshRenderSharedMaterialBaseScrollSpeedX),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$n._getMeshRenderSharedMaterialBaseScrollSpeedY,$n._setMeshRenderSharedMaterialBaseScrollSpeedY),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$n._getMeshRenderSharedMaterialSecondScrollSpeedX,$n._setMeshRenderSharedMaterialSecondScrollSpeedX),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$n._getMeshRenderSharedMaterialSecondScrollSpeedY,$n._setMeshRenderSharedMaterialSecondScrollSpeedY),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$n._getMeshRenderSharedMaterialDetailTilingOffset,$n._setMeshRenderSharedMaterialDetailTilingOffset),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$n._getMeshRenderSharedMaterialDissolveTilingOffset,$n._setMeshRenderSharedMaterialDissolveTilingOffset),$n.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$n._getMeshRenderSharedMaterialMaskTilingOffset,$n._setMeshRenderSharedMaterialMaskTilingOffset)},$n.registerAnimationNodeProperty=function($B,$_,$Z){if($n._propertyIndexDic[$B])throw new Error("AnimationNode: this propertyName has registered.");$n._propertyIndexDic[$B]=$n._propertyIDCounter,$n._propertyGetFuncs[$n._propertyIDCounter]=$_,$n._propertySetFuncs[$n._propertyIDCounter]=$Z,$n._propertyIDCounter++},$n._getLocalPosition=function($B,$_){return $B?$B.transform.getLocalPosition():$_._transform.localPosition.elements},$n._setLocalPosition=function($B,$_,$Z){if($B)$B.transform.setLocalPosition($Z);else{var $n=$_._transform,$g=$n.localPosition;$g.elements=$Z,$n.localPosition=$g}},$n._getLocalRotation=function($B,$_){return $B?$B.transform.getLocalRotation():$_._transform.localRotation.elements},$n._setLocalRotation=function($B,$_,$Z){if($B)$B.transform.setLocalRotation($Z);else{var $n=$_._transform,$g=$n.localRotation;$g.elements=$Z,$n.localRotation=$g}},$n._getLocalScale=function($B,$_){return $B?$B.transform.getLocalScale():$_._transform.localScale.elements},$n._setLocalScale=function($B,$_,$Z){if($B)$B.transform.setLocalScale($Z);else{var $n=$_._transform,$g=$n.localScale;$g.elements=$Z,$n.localScale=$g}},$n._getLocalRotationEuler=function($B,$_){return $B?$B.transform.getLocalRotationEuler():$_._transform.localRotationEuler.elements},$n._setLocalRotationEuler=function($B,$_,$Z){if($B)$B.transform.setLocalRotationEuler($Z);else{var $n=$_._transform,$g=$n.localRotationEuler;$g.elements=$Z,$n.localRotationEuler=$g}},$n._getMeshRenderSharedMaterialTilingOffset=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $_.meshRender.sharedMaterial.tilingOffset.elements},$n._setMeshRenderSharedMaterialTilingOffset=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).tilingOffset).elements=$Z,$n.tilingOffset=$g)}else($g=($n=$_.meshRender.material).tilingOffset).elements=$Z,$n.tilingOffset=$g},$n._getMeshRenderSharedMaterialAlbedo=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $_.meshRender.sharedMaterial.albedoColor.elements},$n._setMeshRenderSharedMaterialAlbedo=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).albedoColor).elements=$Z,$n.albedoColor=$g)}else($g=($n=$_.meshRender.material).albedoColor).elements=$Z,$n.albedoColor=$g},$n._getSkinnedMeshRenderSharedMaterialTilingOffset=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $_.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$n._setSkinnedMeshRenderSharedMaterialTilingOffset=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.skinnedMeshRender.material).tilingOffset).elements=$Z,$n.tilingOffset=$g)}else($g=($n=$_.skinnedMeshRender.material).tilingOffset).elements=$Z,$n.tilingOffset=$g},$n._getSkinnedMeshRenderSharedMaterialAlbedo=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $_.skinnedMeshRender.sharedMaterial.albedoColor.elements},$n._setSkinnedMeshRenderSharedMaterialAlbedo=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.skinnedMeshRender.material).albedoColor).elements=$Z,$n.albedoColor=$g)}else($g=($n=$_.skinnedMeshRender.material).albedoColor).elements=$Z,$n.albedoColor=$g},$n._getParticleRenderSharedMaterialTintColor=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.particleRender.sharedMaterial.tintColor.elements:null}return $_.particleRender.sharedMaterial.tintColor.elements},$n._setParticleRenderSharedMaterialTintColor=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.particleRender.material).tintColor).elements=$Z,$n.tintColor=$g)}else($g=($n=$_.particleRender.material).tintColor).elements=$Z,$n.tintColor=$g},$n._getMeshRenderSharedMaterialAlphaColor=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $_.meshRender.sharedMaterial.alphaColor.elements},$n._setMeshRenderSharedMaterialAlphaColor=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).alphaColor).elements=$Z,$n.alphaColor=$g)}else($g=($n=$_.meshRender.material).alphaColor).elements=$Z,$n.alphaColor=$g},$n._getMeshRenderSharedMaterialBaseColor=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.baseColor.elements:null}return $_.meshRender.sharedMaterial.baseColor.elements},$n._setMeshRenderSharedMaterialBaseColor=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).baseColor).elements=$Z,$n.baseColor=$g)}else($g=($n=$_.meshRender.material).baseColor).elements=$Z,$n.baseColor=$g},$n._getMeshRenderSharedMaterialDissolve=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.dissolve:0}return $_.meshRender.sharedMaterial.dissolve},$n._setMeshRenderSharedMaterialDissolve=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.dissolve=$Z[0])}else $_.meshRender.material.dissolve=$Z[0]},$n._getMeshRenderSharedMaterialDissolveSpeed=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $_.meshRender.sharedMaterial.dissolveSpeed},$n._setMeshRenderSharedMaterialDissolveSpeed=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.dissolveSpeed=$Z[0])}else $_.meshRender.material.dissolveSpeed=$Z[0]},$n._getMeshRenderSharedMaterialMMultiplier=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.mMultiplier:0}return $_.meshRender.sharedMaterial.mMultiplier},$n._setMeshRenderSharedMaterialMMultiplier=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.mMultiplier=$Z[0])}else $_.meshRender.material.mMultiplier=$Z[0]},$n._getMeshRenderSharedMaterialBaseScrollSpeedX=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $_.meshRender.sharedMaterial.baseScrollSpeedX},$n._setMeshRenderSharedMaterialBaseScrollSpeedX=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.baseScrollSpeedX=$Z[0])}else $_.meshRender.material.baseScrollSpeedX=$Z[0]},$n._getMeshRenderSharedMaterialBaseScrollSpeedY=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $_.meshRender.sharedMaterial.baseScrollSpeedY},$n._setMeshRenderSharedMaterialBaseScrollSpeedY=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.baseScrollSpeedY=$Z[0])}else $_.meshRender.material.baseScrollSpeedY=$Z[0]},$n._getMeshRenderSharedMaterialSecondScrollSpeedX=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $_.meshRender.sharedMaterial.secondScrollSpeedX},$n._setMeshRenderSharedMaterialSecondScrollSpeedX=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.secondScrollSpeedX=$Z[0])}else $_.meshRender.material.secondScrollSpeedX=$Z[0]},$n._getMeshRenderSharedMaterialSecondScrollSpeedY=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $_.meshRender.sharedMaterial.secondScrollSpeedY},$n._setMeshRenderSharedMaterialSecondScrollSpeedY=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.secondScrollSpeedY=$Z[0])}else $_.meshRender.material.secondScrollSpeedY=$Z[0]},$n._getMeshRenderSharedMaterialAlpha=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.alpha:0}return $_.meshRender.sharedMaterial.alpha},$n._setMeshRenderSharedMaterialAlpha=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.alpha=$Z[0])}else $_.meshRender.material.alpha=$Z[0]},$n._getMeshRenderSharedMaterialIntensity=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.intensity:0}return $_.meshRender.sharedMaterial.intensity},$n._setMeshRenderSharedMaterialIntensity=function($B,$_,$Z){if($B){var $n=$B.transform._entity;$n&&($n.owner.meshRender.material.intensity=$Z[0])}else $_.meshRender.material.intensity=$Z[0]},$n._getMeshRenderSharedMaterialDetailTilingOffset=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $_.meshRender.sharedMaterial.detailTilingOffset.elements},$n._setMeshRenderSharedMaterialDetailTilingOffset=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).detailTilingOffset).elements=$Z,$n.detailTilingOffset=$g)}else($g=($n=$_.meshRender.material).detailTilingOffset).elements=$Z,$n.detailTilingOffset=$g},$n._getMeshRenderSharedMaterialDissolveTilingOffset=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $_.meshRender.sharedMaterial.dissolveTilingOffset.elements},$n._setMeshRenderSharedMaterialDissolveTilingOffset=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).dissolveTilingOffset).elements=$Z,$n.dissolveTilingOffset=$g)}else($g=($n=$_.meshRender.material).dissolveTilingOffset).elements=$Z,$n.dissolveTilingOffset=$g},$n._getMeshRenderSharedMaterialMaskTilingOffset=function($B,$_){if($B){var $Z=$B.transform._entity;return $Z?$Z.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $_.meshRender.sharedMaterial.maskTilingOffset.elements},$n._setMeshRenderSharedMaterialMaskTilingOffset=function($B,$_,$Z){var $n,$g;if($B){var $q=$B.transform._entity;$q&&(($g=($n=$q.owner.meshRender.material).maskTilingOffset).elements=$Z,$n.maskTilingOffset=$g)}else($g=($n=$_.meshRender.material).maskTilingOffset).elements=$Z,$n.maskTilingOffset=$g},$n._propertyIDCounter=0,$n._propertyIndexDic={},$n._propertySetFuncs=[],$n._propertyGetFuncs=[],$n}(),$W=function(){function $B(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $A($B,"laya.d3.animation.Keyframe"),$B}(),$X=function(){function $B(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $A($B,"laya.d3.animation.KeyframeNode"),$B}(),$F=(function(){function $B(){this._tempVector30=new $P_,this._tempVector31=new $P_,this._tempVector32=new $P_,this._a=new $P_,this._b=new $P_,this._c=new $P_,this._d=new $P_}$A($B,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $_=$B.prototype;$_.Init=function($B,$_,$Z,$n){$B.cloneTo(this._d),$_.cloneTo(this._c),$P_.scale($B,2,this._a),$P_.scale($Z,2,this._tempVector30),$P_.subtract(this._a,this._tempVector30,this._a),$P_.add(this._a,$_,this._a),$P_.add(this._a,$n,this._a),$P_.scale($Z,3,this._b),$P_.scale($B,3,this._tempVector30),$P_.subtract(this._b,this._tempVector30,this._b),$P_.subtract(this._b,$n,this._b),$P_.scale($_,2,this._tempVector30),$P_.subtract(this._b,this._tempVector30,this._b)},$_.Slerp=function($B,$_){$P_.scale(this._a,$B*$B*$B,this._tempVector30),$P_.scale(this._b,$B*$B,this._tempVector31),$P_.scale(this._c,$B,this._tempVector32),$P_.add(this._tempVector30,this._tempVector31,$_),$P_.add($_,this._tempVector32,$_),$P_.add($_,this._d,$_)}}(),function(){function $x($B,$_,$Z,$n){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$B,this._h=$_,this._minHeight=$Z,this._maxHeight=$n}$A($x,"laya.d3.core.HeightMap");var $B=$x.prototype;$B._inBounds=function($B,$_){return 0<=$B&&$B<this._h&&0<=$_&&$_<this._w},$B.getHeight=function($B,$_){return this._inBounds($B,$_)?this._datas[$B][$_]:NaN},$$(0,$B,"width",function(){return this._w}),$$(0,$B,"height",function(){return this._h}),$$(0,$B,"maxHeight",function(){return this._maxHeight}),$$(0,$B,"minHeight",function(){return this._minHeight}),$x.creatFromMesh=function($B,$_,$Z,$n){for(var $g=[],$q=[],$P=$B.getSubMeshCount(),$k=0;$k<$P;$k++){for(var $m=$B.getSubMesh($k),$D=$m._getVertexBuffer(),$T=$D.getData(),$e=[],$I=0;$I<$T.length;$I+=$D.vertexDeclaration.vertexStride/4){var $A=new $P_($T[$I+0],$T[$I+1],$T[$I+2]);$e.push($A)}$g.push($e);var $$=$m._getIndexBuffer();$q.push($$.getData())}var $w=$B.boundingBox,$r=$w.min.x,$j=$w.min.z,$y=$w.max.x,$C=$w.max.z,$z=$w.min.y,$t=$w.max.y,$J=$y-$r,$N=$C-$j,$Q=$n.elements[0]=$J/($_-1),$M=$n.elements[1]=$N/($Z-1),$Y=new $x($_,$Z,$z,$t),$l=$x._tempRay,$L=$l.direction.elements;$L[0]=0,$L[1]=-1,$L[2]=0;var $v=$t+.1;$l.origin.elements[1]=$v;for(var $V=0;$V<$Z;$V++){var $o=$j+$V*$M;$Y._datas[$V]=[];for(var $F=0;$F<$_;$F++){var $u=$r+$F*$Q,$f=$l.origin.elements;$f[0]=$u,$f[2]=$o;var $b=$x._getPosition($l,$g,$q);$Y._datas[$V][$F]=$b===Number.MAX_VALUE?NaN:$v-$b}}return $Y},$x.createFromImage=function($B,$_,$Z){for(var $n=$B.width,$g=$B.height,$q=new $x($n,$g,$_,$Z),$P=($Z-$_)/254,$k=$B.getPixels(),$m=0,$D=0;$D<$g;$D++)for(var $T=$q._datas[$D]=[],$e=0;$e<$n;$e++){var $I=$k[$m++],$A=$k[$m++],$$=$k[$m++],$w=$k[$m++];$T[$e]=255==$I&&255==$A&&255==$$&&255==$w?NaN:($I+$A+$$)/3*$P+$_}return $q},$x._getPosition=function($B,$_,$Z){for(var $n=Number.MAX_VALUE,$g=0;$g<$_.length;$g++)for(var $q=$_[$g],$P=$Z[$g],$k=0;$k<$P.length;$k+=3){var $m=$q[$P[$k+0]],$D=$q[$P[$k+1]],$T=$q[$P[$k+2]],$e=$$_.rayIntersectsTriangle($B,$m,$D,$T);!isNaN($e)&&$e<$n&&($n=$e)}return $n},$e($x,["_tempRay",function(){return this._tempRay=new $g_(new $P_,new $P_)}])}(),function(){function $g(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$A($g,"laya.d3.core.Layer");var $B=$g.prototype;return $B._binarySearchIndex=function(){for(var $B=0,$_=$g._collsionTestList.length-1,$Z=0;$B<=$_;){$Z=Math.floor(($B+$_)/2);var $n=$g._collsionTestList[$Z];if($n==this._number)return $Z;$n>this._number?$_=$Z-1:$B=$Z+1}return $B},$B._addCollider=function($B){0===this._colliders.length&&$g._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$B._isRigidbody?(this._colliders.unshift($B),this._nonRigidbodyOffset++):this._colliders.push($B)},$B._removeCollider=function($B){var $_=this._colliders.indexOf($B);$_<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($_,1),0===this._colliders.length&&$g._collsionTestList.splice($g._collsionTestList.indexOf(this._number),1)},$$(0,$B,"number",function(){return this._number}),$$(0,$B,"visible",function(){return this._visible},function($B){this._visible=$B,$g._visibleLayers=$B?$g._visibleLayers|this.mask:$g._visibleLayers&~this.mask}),$$(0,$B,"mask",function(){return this._mask}),$$(1,$g,"visibleLayers",function(){return $g._visibleLayers},function($B){$g._visibleLayers=$B;for(var $_=0,$Z=$g._layerList.length;$_<$Z;$_++){var $n=$g._layerList[$_];$n._visible=0!=($n._mask&$g._visibleLayers)}}),$g.__init__=function(){$g._layerList.length=31;for(var $B=0;$B<31;$B++){var $_=new $g;$g._layerList[$B]=$_,0===$B?($_.name="Default Layer",$_.visible=!0):($_.name="Layer-"+$B,$_.visible=!1),$_._number=$B,$_._mask=Math.pow(2,$B)}$g.currentCreationLayer=$g._layerList[0]},$g.getLayerByNumber=function($B){if($B<0||30<$B)throw new Error("无法返回指定Layer，该number超出范围！");return $g._layerList[$B]},$g.getLayerByName=function($B){for(var $_=0;$_<31;$_++)if($g._layerList[$_].name===$B)return $g._layerList[$_];throw new Error("无法返回指定Layer,该name不存在")},$g.isVisible=function($B){return 0!=($B&$g._currentCameraCullingMask&$g._visibleLayers)},$g._layerList=[],$g._visibleLayers=2147483647,$g._collsionTestList=[],$g._currentCameraCullingMask=2147483647,$g.maxCount=31,$g.currentCreationLayer=null,$g}()),$u=(function(){function $B($B,$_,$Z){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$B,this._minCount=$_,this._maxCount=$Z}$A($B,"laya.d3.core.particleShuriKen.module.Burst");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($B){var $_=$B;$_._time=this._time,$_._minCount=this._minCount,$_._maxCount=this._maxCount},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"time",function(){return this._time}),$$(0,$_,"minCount",function(){return this._minCount}),$$(0,$_,"maxCount",function(){return this._maxCount})}(),function(){function $B($B){this._color=null,this.enbale=!1,this._color=$B}$A($B,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $_=$B.prototype;$_.cloneTo=function($B){var $_=$B;this._color.cloneTo($_._color),$_.enbale=this.enbale},$_.clone=function(){var $B;switch(this._color.type){case 0:$B=$b.createByConstant(this._color.constant.clone());break;case 1:$B=$b.createByGradient(this._color.gradient.clone());break;case 2:$B=$b.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$B=$b.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $_=new this.constructor($B);return $_.enbale=this.enbale,$_},$$(0,$_,"color",function(){return this._color})}(),function(){function $B(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$A($B,"laya.d3.core.particleShuriKen.module.Emission");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$_._destroy=function(){this._bursts=null,this._destroyed=!0},$_.getBurstsCount=function(){return this._bursts.length},$_.getBurstByIndex=function($B){return this._bursts[$B]},$_.addBurst=function($B){var $_=this._bursts.length;if(0<$_)for(var $Z=0;$Z<$_;$Z++)this._bursts[$Z].time>$B.time&&this._bursts.splice($Z,0,$B);this._bursts.push($B)},$_.removeBurst=function($B){var $_=this._bursts.indexOf($B);-1!==$_&&this._bursts.splice($_,1)},$_.removeBurstByIndex=function($B){this._bursts.splice($B,1)},$_.clearBurst=function(){this._bursts.length=0},$_.cloneTo=function($B){var $_=$B,$Z=$_._bursts;$Z.length=this._bursts.length;for(var $n=0,$g=this._bursts.length;$n<$g;$n++){var $q=$Z[$n];$q?this._bursts[$n].cloneTo($q):$Z[$n]=this._bursts[$n].clone()}$_._emissionRate=this._emissionRate,$_.enbale=this.enbale},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"destroyed",function(){return this._destroyed}),$$(0,$_,"emissionRate",function(){return this._emissionRate},function($B){if($B<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$B})}(),function(){function $n(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$A($n,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $B=$n.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.cloneTo=function($B){var $_=$B;$_._type=this._type,$_._constant=this._constant,this._overTime.cloneTo($_._overTime),$_._constantMin=this._constantMin,$_._constantMax=this._constantMax,this._overTimeMin.cloneTo($_._overTimeMin),this._overTimeMax.cloneTo($_._overTimeMax)},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$B,"frameOverTimeData",function(){return this._overTime}),$$(0,$B,"constant",function(){return this._constant}),$$(0,$B,"type",function(){return this._type}),$$(0,$B,"frameOverTimeDataMin",function(){return this._overTimeMin}),$$(0,$B,"constantMin",function(){return this._constantMin}),$$(0,$B,"frameOverTimeDataMax",function(){return this._overTimeMax}),$$(0,$B,"constantMax",function(){return this._constantMax}),$n.createByConstant=function($B){var $_=new $n;return $_._type=0,$_._constant=$B,$_},$n.createByOverTime=function($B){var $_=new $n;return $_._type=1,$_._overTime=$B,$_},$n.createByRandomTwoConstant=function($B,$_){var $Z=new $n;return $Z._type=2,$Z._constantMin=$B,$Z._constantMax=$_,$Z},$n.createByRandomTwoOverTime=function($B,$_){var $Z=new $n;return $Z._type=3,$Z._overTimeMin=$B,$Z._overTimeMax=$_,$Z},$n}()),$f=function(){function $D(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$A($D,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $B=$D.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.cloneTo=function($B){var $_=$B;$_._type=this._type,$_._separateAxes=this._separateAxes,$_._constant=this._constant,this._constantSeparate.cloneTo($_._constantSeparate),this._gradient.cloneTo($_._gradient),this._gradientX.cloneTo($_._gradientX),this._gradientY.cloneTo($_._gradientY),this._gradientZ.cloneTo($_._gradientZ),$_._constantMin=this._constantMin,$_._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($_._constantMinSeparate),this._constantMaxSeparate.cloneTo($_._constantMaxSeparate),this._gradientMin.cloneTo($_._gradientMin),this._gradientMax.cloneTo($_._gradientMax),this._gradientXMin.cloneTo($_._gradientXMin),this._gradientXMax.cloneTo($_._gradientXMax),this._gradientYMin.cloneTo($_._gradientYMin),this._gradientYMax.cloneTo($_._gradientYMax),this._gradientZMin.cloneTo($_._gradientZMin),this._gradientZMax.cloneTo($_._gradientZMax)},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$B,"gradientZ",function(){return this._gradientZ}),$$(0,$B,"constant",function(){return this._constant}),$$(0,$B,"gradient",function(){return this._gradient}),$$(0,$B,"separateAxes",function(){return this._separateAxes}),$$(0,$B,"type",function(){return this._type}),$$(0,$B,"constantSeparate",function(){return this._constantSeparate}),$$(0,$B,"gradientX",function(){return this._gradientX}),$$(0,$B,"gradientY",function(){return this._gradientY}),$$(0,$B,"gradientW",function(){return this._gradientW}),$$(0,$B,"gradientMin",function(){return this._gradientMin}),$$(0,$B,"constantMin",function(){return this._constantMin}),$$(0,$B,"gradientMax",function(){return this._gradientMax}),$$(0,$B,"constantMax",function(){return this._constantMax}),$$(0,$B,"gradientWMin",function(){return this._gradientWMin}),$$(0,$B,"constantMinSeparate",function(){return this._constantMinSeparate}),$$(0,$B,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$$(0,$B,"gradientXMin",function(){return this._gradientXMin}),$$(0,$B,"gradientXMax",function(){return this._gradientXMax}),$$(0,$B,"gradientWMax",function(){return this._gradientWMax}),$$(0,$B,"gradientYMin",function(){return this._gradientYMin}),$$(0,$B,"gradientYMax",function(){return this._gradientYMax}),$$(0,$B,"gradientZMin",function(){return this._gradientZMin}),$$(0,$B,"gradientZMax",function(){return this._gradientZMax}),$D.createByConstant=function($B){var $_=new $D;return $_._type=0,$_._separateAxes=!1,$_._constant=$B,$_},$D.createByConstantSeparate=function($B){var $_=new $D;return $_._type=0,$_._separateAxes=!0,$_._constantSeparate=$B,$_},$D.createByGradient=function($B){var $_=new $D;return $_._type=1,$_._separateAxes=!1,$_._gradient=$B,$_},$D.createByGradientSeparate=function($B,$_,$Z,$n){var $g=new $D;return $g._type=1,$g._separateAxes=!0,$g._gradientX=$B,$g._gradientY=$_,$g._gradientZ=$Z,$g._gradientW=$n,$g},$D.createByRandomTwoConstant=function($B,$_){var $Z=new $D;return $Z._type=2,$Z._separateAxes=!1,$Z._constantMin=$B,$Z._constantMax=$_,$Z},$D.createByRandomTwoConstantSeparate=function($B,$_){var $Z=new $D;return $Z._type=2,$Z._separateAxes=!0,$Z._constantMinSeparate=$B,$Z._constantMaxSeparate=$_,$Z},$D.createByRandomTwoGradient=function($B,$_){var $Z=new $D;return $Z._type=3,$Z._separateAxes=!1,$Z._gradientMin=$B,$Z._gradientMax=$_,$Z},$D.createByRandomTwoGradientSeparate=function($B,$_,$Z,$n,$g,$q,$P,$k){var $m=new $D;return $m._type=3,$m._separateAxes=!0,$m._gradientXMin=$B,$m._gradientXMax=$_,$m._gradientYMin=$Z,$m._gradientYMax=$n,$m._gradientZMin=$g,$m._gradientZMax=$q,$m._gradientWMin=$P,$m._gradientWMax=$k,$m},$D}(),$b=function(){function $n(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$A($n,"laya.d3.core.particleShuriKen.module.GradientColor");var $B=$n.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.cloneTo=function($B){var $_=$B;$_._type=this._type,this._constant.cloneTo($_._constant),this._constantMin.cloneTo($_._constantMin),this._constantMax.cloneTo($_._constantMax),this._gradient.cloneTo($_._gradient),this._gradientMin.cloneTo($_._gradientMin),this._gradientMax.cloneTo($_._gradientMax)},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$B,"gradient",function(){return this._gradient}),$$(0,$B,"constant",function(){return this._constant}),$$(0,$B,"type",function(){return this._type}),$$(0,$B,"gradientMin",function(){return this._gradientMin}),$$(0,$B,"constantMin",function(){return this._constantMin}),$$(0,$B,"gradientMax",function(){return this._gradientMax}),$$(0,$B,"constantMax",function(){return this._constantMax}),$n.createByConstant=function($B){var $_=new $n;return $_._type=0,$_._constant=$B,$_},$n.createByGradient=function($B){var $_=new $n;return $_._type=1,$_._gradient=$B,$_},$n.createByRandomTwoConstant=function($B,$_){var $Z=new $n;return $Z._type=2,$Z._constantMin=$B,$Z._constantMax=$_,$Z},$n.createByRandomTwoGradient=function($B,$_){var $Z=new $n;return $Z._type=3,$Z._gradientMin=$B,$Z._gradientMax=$_,$Z},$n}(),$x=(function(){function $B(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$A($B,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.addAlpha=function($B,$_){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$B&&($B=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$B,this._alphaElements[this._alphaCurrentLength++]=$_):DEBUG},$_.addRGB=function($B,$_){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$B&&($B=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$B,this._rgbElements[this._rgbCurrentLength++]=$_.x,this._rgbElements[this._rgbCurrentLength++]=$_.y,this._rgbElements[this._rgbCurrentLength++]=$_.z):DEBUG},$_.cloneTo=function($B){var $_=$B,$Z=0,$n=0;$_._alphaCurrentLength=this._alphaCurrentLength;var $g=$_._alphaElements;for($g.length=this._alphaElements.length,$Z=0,$n=this._alphaElements.length;$Z<$n;$Z++)$g[$Z]=this._alphaElements[$Z];$_._rgbCurrentLength=this._rgbCurrentLength;var $q=$_._rgbElements;for($q.length=this._rgbElements.length,$Z=0,$n=this._rgbElements.length;$Z<$n;$Z++)$q[$Z]=this._rgbElements[$Z]},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$$(0,$_,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $B(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$A($B,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.add=function($B,$_){this._currentLength<8?(6===this._currentLength&&1!==$B&&($B=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$B,this._elements[this._currentLength++]=$_):console.log("Warning:data count must lessEqual than 4")},$_.cloneTo=function($B){var $_=$B;$_._currentLength=this._currentLength;var $Z=$_._elements;$Z.length=this._elements.length;for(var $n=0,$g=this._elements.length;$n<$g;$n++)$Z[$n]=this._elements[$n]},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"gradientCount",function(){return this._currentLength/2})}(),function(){function $B(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$A($B,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.add=function($B,$_){this._currentLength<8?(6===this._currentLength&&1!==$B&&($B=1,DEBUG),this._elements[this._currentLength++]=$B,this._elements[this._currentLength++]=$_):DEBUG},$_.getKeyByIndex=function($B){return this._elements[2*$B]},$_.getValueByIndex=function($B){return this._elements[2*$B+1]},$_.getAverageValue=function(){for(var $B=0,$_=this._currentLength-2;$B<$_;$B+=2){this._elements[$B+1];this._elements[$B+3],this._elements[$B+2]-this._elements[$B]}return 0},$_.cloneTo=function($B){var $_=$B;$_._currentLength=this._currentLength;var $Z=$_._elements;$Z.length=this._elements.length;for(var $n=0,$g=this._elements.length;$n<$g;$n++)$Z[$n]=this._elements[$n]},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"gradientCount",function(){return this._currentLength/2})}(),function(){function $B(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$A($B,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.add=function($B,$_){this._currentLength<8?(6===this._currentLength&&1!==$B&&($B=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$B,this._elements[this._currentLength++]=$_.x,this._elements[this._currentLength++]=$_.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$_.cloneTo=function($B){var $_=$B;$_._currentLength=this._currentLength;var $Z=$_._elements;$Z.length=this._elements.length;for(var $n=0,$g=this._elements.length;$n<$g;$n++)$Z[$n]=this._elements[$n]},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"gradientCount",function(){return this._currentLength/3})}(),function(){function $k(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$A($k,"laya.d3.core.particleShuriKen.module.GradientSize");var $B=$k.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.getMaxSizeInGradient=function(){var $B=0,$_=0,$Z=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($B=0,$_=this._gradientX.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientX.getValueByIndex($B));for($B=0,$_=this._gradientY.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientY.getValueByIndex($B))}else for($B=0,$_=this._gradient.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradient.getValueByIndex($B));break;case 1:$Z=this._separateAxes?($Z=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$Z=Math.max($Z,this._constantMinSeparate.y),Math.max($Z,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($B=0,$_=this._gradientXMin.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientXMin.getValueByIndex($B));for($B=0,$_=this._gradientXMax.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientXMax.getValueByIndex($B));for($B=0,$_=this._gradientYMin.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientYMin.getValueByIndex($B));for($B=0,$_=this._gradientZMax.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientZMax.getValueByIndex($B))}else{for($B=0,$_=this._gradientMin.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientMin.getValueByIndex($B));for($B=0,$_=this._gradientMax.gradientCount;$B<$_;$B++)$Z=Math.max($Z,this._gradientMax.getValueByIndex($B))}}return $Z},$B.cloneTo=function($B){var $_=$B;$_._type=this._type,$_._separateAxes=this._separateAxes,this._gradient.cloneTo($_._gradient),this._gradientX.cloneTo($_._gradientX),this._gradientY.cloneTo($_._gradientY),this._gradientZ.cloneTo($_._gradientZ),$_._constantMin=this._constantMin,$_._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($_._constantMinSeparate),this._constantMaxSeparate.cloneTo($_._constantMaxSeparate),this._gradientMin.cloneTo($_._gradientMin),this._gradientMax.cloneTo($_._gradientMax),this._gradientXMin.cloneTo($_._gradientXMin),this._gradientXMax.cloneTo($_._gradientXMax),this._gradientYMin.cloneTo($_._gradientYMin),this._gradientYMax.cloneTo($_._gradientYMax),this._gradientZMin.cloneTo($_._gradientZMin),this._gradientZMax.cloneTo($_._gradientZMax)},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$B,"gradientZ",function(){return this._gradientZ}),$$(0,$B,"gradient",function(){return this._gradient}),$$(0,$B,"separateAxes",function(){return this._separateAxes}),$$(0,$B,"type",function(){return this._type}),$$(0,$B,"gradientMin",function(){return this._gradientMin}),$$(0,$B,"constantMin",function(){return this._constantMin}),$$(0,$B,"gradientX",function(){return this._gradientX}),$$(0,$B,"gradientY",function(){return this._gradientY}),$$(0,$B,"gradientMax",function(){return this._gradientMax}),$$(0,$B,"constantMax",function(){return this._constantMax}),$$(0,$B,"constantMinSeparate",function(){return this._constantMinSeparate}),$$(0,$B,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$$(0,$B,"gradientXMin",function(){return this._gradientXMin}),$$(0,$B,"gradientXMax",function(){return this._gradientXMax}),$$(0,$B,"gradientYMin",function(){return this._gradientYMin}),$$(0,$B,"gradientYMax",function(){return this._gradientYMax}),$$(0,$B,"gradientZMin",function(){return this._gradientZMin}),$$(0,$B,"gradientZMax",function(){return this._gradientZMax}),$k.createByGradient=function($B){var $_=new $k;return $_._type=0,$_._separateAxes=!1,$_._gradient=$B,$_},$k.createByGradientSeparate=function($B,$_,$Z){var $n=new $k;return $n._type=0,$n._separateAxes=!0,$n._gradientX=$B,$n._gradientY=$_,$n._gradientZ=$Z,$n},$k.createByRandomTwoConstant=function($B,$_){var $Z=new $k;return $Z._type=1,$Z._separateAxes=!1,$Z._constantMin=$B,$Z._constantMax=$_,$Z},$k.createByRandomTwoConstantSeparate=function($B,$_){var $Z=new $k;return $Z._type=1,$Z._separateAxes=!0,$Z._constantMinSeparate=$B,$Z._constantMaxSeparate=$_,$Z},$k.createByRandomTwoGradient=function($B,$_){var $Z=new $k;return $Z._type=2,$Z._separateAxes=!1,$Z._gradientMin=$B,$Z._gradientMax=$_,$Z},$k.createByRandomTwoGradientSeparate=function($B,$_,$Z,$n,$g,$q){var $P=new $k;return $P._type=2,$P._separateAxes=!0,$P._gradientXMin=$B,$P._gradientXMax=$_,$P._gradientYMin=$Z,$P._gradientYMax=$n,$P._gradientZMin=$g,$P._gradientZMax=$q,$P},$k}()),$p=function(){function $k(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$A($k,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $B=$k.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.cloneTo=function($B){var $_=$B;$_._type=this._type,this._constant.cloneTo($_._constant),this._gradientX.cloneTo($_._gradientX),this._gradientY.cloneTo($_._gradientY),this._gradientZ.cloneTo($_._gradientZ),this._constantMin.cloneTo($_._constantMin),this._constantMax.cloneTo($_._constantMax),this._gradientXMin.cloneTo($_._gradientXMin),this._gradientXMax.cloneTo($_._gradientXMax),this._gradientYMin.cloneTo($_._gradientYMin),this._gradientYMax.cloneTo($_._gradientYMax),this._gradientZMin.cloneTo($_._gradientZMin),this._gradientZMax.cloneTo($_._gradientZMax)},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$B,"gradientZ",function(){return this._gradientZ}),$$(0,$B,"constant",function(){return this._constant}),$$(0,$B,"type",function(){return this._type}),$$(0,$B,"gradientXMax",function(){return this._gradientXMax}),$$(0,$B,"constantMin",function(){return this._constantMin}),$$(0,$B,"gradientX",function(){return this._gradientX}),$$(0,$B,"gradientY",function(){return this._gradientY}),$$(0,$B,"gradientXMin",function(){return this._gradientXMin}),$$(0,$B,"constantMax",function(){return this._constantMax}),$$(0,$B,"gradientYMin",function(){return this._gradientYMin}),$$(0,$B,"gradientYMax",function(){return this._gradientYMax}),$$(0,$B,"gradientZMin",function(){return this._gradientZMin}),$$(0,$B,"gradientZMax",function(){return this._gradientZMax}),$k.createByConstant=function($B){var $_=new $k;return $_._type=0,$_._constant=$B,$_},$k.createByGradient=function($B,$_,$Z){var $n=new $k;return $n._type=1,$n._gradientX=$B,$n._gradientY=$_,$n._gradientZ=$Z,$n},$k.createByRandomTwoConstant=function($B,$_){var $Z=new $k;return $Z._type=2,$Z._constantMin=$B,$Z._constantMax=$_,$Z},$k.createByRandomTwoGradient=function($B,$_,$Z,$n,$g,$q){var $P=new $k;return $P._type=3,$P._gradientXMin=$B,$P._gradientXMax=$_,$P._gradientYMin=$Z,$P._gradientYMax=$n,$P._gradientZMin=$g,$P._gradientZMax=$q,$P},$k}(),$K=(function(){function $B($B){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$B}$A($B,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($B){var $_=$B;this._angularVelocity.cloneTo($_._angularVelocity),$_.enbale=this.enbale},$_.clone=function(){var $B;switch(this._angularVelocity.type){case 0:$B=this._angularVelocity.separateAxes?$f.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$f.createByConstant(this._angularVelocity.constant);break;case 1:$B=this._angularVelocity.separateAxes?$f.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$f.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$B=this._angularVelocity.separateAxes?$f.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$f.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$B=this._angularVelocity.separateAxes?$f.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$f.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $_=new this.constructor($B);return $_.enbale=this.enbale,$_},$$(0,$_,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $B(){this.enable=!1,this.randomDirection=!1}$A($B,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $_=$B.prototype;return $t.imps($_,{"laya.d3.core.IClone":!0}),$_._getShapeBoundBox=function($B){throw new Error("BaseShape: must override it.")},$_._getSpeedBoundBox=function($B){throw new Error("BaseShape: must override it.")},$_.generatePositionAndDirection=function($B,$_,$Z,$n){throw new Error("BaseShape: must override it.")},$_._calculateProceduralBounds=function($B,$_,$Z){this._getShapeBoundBox($B);var $n=$B.min,$g=$B.max;$P_.multiply($n,$_,$n),$P_.multiply($g,$_,$g);var $q=new $dB(new $P_,new $P_);this.randomDirection?($q.min=new $P_(-1,-1,-1),$q.max=new $P_(1,1,1)):this._getSpeedBoundBox($q);var $P=new $dB(new $P_,new $P_),$k=$P.min,$m=$P.max;$P_.scale($q.min,$Z.y,$k),$P_.scale($q.max,$Z.y,$m),$P_.add($B.min,$k,$k),$P_.add($B.max,$m,$m),$P_.min($B.min,$k,$B.min),$P_.max($B.max,$k,$B.max);var $D=new $dB(new $P_,new $P_),$T=$D.min,$e=$D.max;$P_.scale($q.min,$Z.x,$T),$P_.scale($q.max,$Z.x,$e),$P_.min($D.min,$e,$k),$P_.max($D.min,$e,$m),$P_.min($B.min,$k,$B.min),$P_.max($B.max,$k,$B.max)},$_.cloneTo=function($B){$B.enable=this.enable},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$B}()),$R=function(){function $q(){}return $A($q,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$q._randomPointUnitArcCircle=function($B,$_,$Z){var $n=$_.elements,$g=NaN;$g=$Z?$Z.getFloat()*$B:Math.random()*$B,$n[0]=Math.cos($g),$n[1]=Math.sin($g)},$q._randomPointInsideUnitArcCircle=function($B,$_,$Z){var $n=$_.elements;$q._randomPointUnitArcCircle($B,$_,$Z);var $g=NaN;$g=$Z?Math.pow($Z.getFloat(),.5):Math.pow(Math.random(),.5),$n[0]=$n[0]*$g,$n[1]=$n[1]*$g},$q._randomPointUnitCircle=function($B,$_){var $Z=$B.elements,$n=NaN;$n=$_?$_.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$Z[0]=Math.cos($n),$Z[1]=Math.sin($n)},$q._randomPointInsideUnitCircle=function($B,$_){var $Z=$B.elements;$q._randomPointUnitCircle($B);var $n=NaN;$n=$_?Math.pow($_.getFloat(),.5):Math.pow(Math.random(),.5),$Z[0]=$Z[0]*$n,$Z[1]=$Z[1]*$n},$q._randomPointUnitSphere=function($B,$_){var $Z=$B.elements,$n=NaN,$g=NaN;$g=$_?($n=$Z[2]=2*$_.getFloat()-1,$_.getFloat()*Math.PI*2):($n=$Z[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $q=Math.sqrt(1-$n*$n);$Z[0]=$q*Math.cos($g),$Z[1]=$q*Math.sin($g)},$q._randomPointInsideUnitSphere=function($B,$_){var $Z=$B.elements;$q._randomPointUnitSphere($B);var $n=NaN;$n=$_?Math.pow($_.getFloat(),1/3):Math.pow(Math.random(),1/3),$Z[0]=$Z[0]*$n,$Z[1]=$Z[1]*$n,$Z[2]=$Z[2]*$n},$q._randomPointInsideHalfUnitBox=function($B,$_){var $Z=$B.elements;$_?($Z[0]=$_.getFloat()-.5,$Z[1]=$_.getFloat()-.5,$Z[2]=$_.getFloat()-.5):($Z[0]=Math.random()-.5,$Z[1]=Math.random()-.5,$Z[2]=Math.random()-.5)},$q}(),$h=(function(){function $B($B){this._size=null,this.enbale=!1,this._size=$B}$A($B,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($B){var $_=$B;this._size.cloneTo($_._size),$_.enbale=this.enbale},$_.clone=function(){var $B;switch(this._size.type){case 0:$B=this._size.separateAxes?$x.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$x.createByGradient(this._size.gradient.clone());break;case 1:$B=this._size.separateAxes?$x.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$x.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$B=this._size.separateAxes?$x.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$x.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $_=new this.constructor($B);return $_.enbale=this.enbale,$_},$$(0,$_,"size",function(){return this._size})}(),function(){function $n(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$A($n,"laya.d3.core.particleShuriKen.module.StartFrame");var $B=$n.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.cloneTo=function($B){var $_=$B;$_._type=this._type,$_._constant=this._constant,$_._constantMin=this._constantMin,$_._constantMax=this._constantMax},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$B,"constant",function(){return this._constant}),$$(0,$B,"type",function(){return this._type}),$$(0,$B,"constantMin",function(){return this._constantMin}),$$(0,$B,"constantMax",function(){return this._constantMax}),$n.createByConstant=function($B){var $_=new $n;return $_._type=0,$_._constant=$B,$_},$n.createByRandomTwoConstant=function($B,$_){var $Z=new $n;return $Z._type=1,$Z._constantMin=$B,$Z._constantMax=$_,$Z},$n}()),$s=(function(){function $B($B,$_){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $q_(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$B,this._startFrame=$_}$A($B,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($B){var $_=$B;this.tiles.cloneTo($_.tiles),$_.type=this.type,$_.randomRow=this.randomRow,this._frame.cloneTo($_._frame),this._startFrame.cloneTo($_._startFrame),$_.cycles=this.cycles,$_.enableUVChannels=this.enableUVChannels,$_.enable=this.enable},$_.clone=function(){var $B,$_;switch(this._frame.type){case 0:$B=$u.createByConstant(this._frame.constant);break;case 1:$B=$u.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$B=$u.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$B=$u.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$_=$h.createByConstant(this._startFrame.constant);break;case 1:$_=$h.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $Z=new this.constructor($B,$_);return this.tiles.cloneTo($Z.tiles),$Z.type=this.type,$Z.randomRow=this.randomRow,$Z.cycles=this.cycles,$Z.enableUVChannels=this.enableUVChannels,$Z.enable=this.enable,$Z},$$(0,$_,"frame",function(){return this._frame}),$$(0,$_,"startFrame",function(){return this._startFrame})}(),function(){function $B($B){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$B}$A($B,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $_=$B.prototype;$t.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($B){var $_=$B;this._velocity.cloneTo($_._velocity),$_.enbale=this.enbale,$_.space=this.space},$_.clone=function(){var $B;switch(this._velocity.type){case 0:$B=$p.createByConstant(this._velocity.constant.clone());break;case 1:$B=$p.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$B=$p.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$B=$p.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $_=new this.constructor($B);return $_.enbale=this.enbale,$_.space=this.space,$_},$$(0,$_,"velocity",function(){return this._velocity})}(),function(){function $B(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $I_,this._vb=$K_.create($B._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$p_.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$b_.nameKey.getID("LINE"),this._shaderCompile=$Q_._preCompileShader[this._sharderNameID]}$A($B,"laya.d3.core.PhasorSpriter3D");var $_=$B.prototype;return $_.line=function($B,$_,$Z,$n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($B.x,$B.y,$B.z,$_.x,$_.y,$_.z,$_.w),this.addVertex($Z.x,$Z.y,$Z.z,$n.x,$n.y,$n.z,$n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$_.circle=function($B,$_,$Z,$n,$g,$q){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$_,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$_,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$B,Math.cos(this._tempNumver0)*$B,0,$Z,$n,$g,$q),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$_.plane=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$n/2,this._tempNumver1=$g/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($B-this._tempNumver0,$_+this._tempNumver1,$Z,$q,$P,$k,$m),this.addVertex($B+this._tempNumver0,$_+this._tempNumver1,$Z,$q,$P,$k,$m),this.addVertex($B-this._tempNumver0,$_-this._tempNumver1,$Z,$q,$P,$k,$m),this.addVertex($B+this._tempNumver0,$_-this._tempNumver1,$Z,$q,$P,$k,$m),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$_.box=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$n/2,this._tempNumver1=$g/2,this._tempNumver2=$q/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($B-this._tempNumver0,$_+this._tempNumver1,$Z+this._tempNumver2,$P,$k,$m,$D),this.addVertex($B+this._tempNumver0,$_+this._tempNumver1,$Z+this._tempNumver2,$P,$k,$m,$D),this.addVertex($B-this._tempNumver0,$_-this._tempNumver1,$Z+this._tempNumver2,$P,$k,$m,$D),this.addVertex($B+this._tempNumver0,$_-this._tempNumver1,$Z+this._tempNumver2,$P,$k,$m,$D),this.addVertex($B+this._tempNumver0,$_+this._tempNumver1,$Z-this._tempNumver2,$P,$k,$m,$D),this.addVertex($B-this._tempNumver0,$_+this._tempNumver1,$Z-this._tempNumver2,$P,$k,$m,$D),this.addVertex($B+this._tempNumver0,$_-this._tempNumver1,$Z-this._tempNumver2,$P,$k,$m,$D),this.addVertex($B-this._tempNumver0,$_-this._tempNumver1,$Z-this._tempNumver2,$P,$k,$m,$D),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$_.cone=function($B,$_,$Z,$n,$g,$q,$P){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$Z+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$Z>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$Z,this.addVertexIndex(0,$_,0,$n,$g,$q,$P,this._tempUint0),this.addVertexIndex(0,0,0,$n,$g,$q,$P,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$Z;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($B*this._tempNumver2,0,$B*this._tempNumver3,$n,$g,$q,$P,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$Z-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($B*this._tempNumver2,0,$B*this._tempNumver3,$n,$g,$q,$P,this._tempUint0+(this._tempInt0+$Z)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$Z-1?this.addIndexes(this._tempUint1+$Z+2):this.addIndexes(this._tempUint1+this._tempInt0+$Z+1),this.addIndexes(this._tempUint1+this._tempInt0+$Z),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$_.boundingBoxLine=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($B,$g,$q,$P,$k,$m,$D),this.addVertex($n,$g,$q,$P,$k,$m,$D),this.addVertex($B,$_,$q,$P,$k,$m,$D),this.addVertex($n,$_,$q,$P,$k,$m,$D),this.addVertex($n,$g,$Z,$P,$k,$m,$D),this.addVertex($B,$g,$Z,$P,$k,$m,$D),this.addVertex($n,$_,$Z,$P,$k,$m,$D),this.addVertex($B,$_,$Z,$P,$k,$m,$D),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$_.addVertex=function($B,$_,$Z,$n,$g,$q,$P){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$B,this._vbData[this._posInVBData+1]=$_,this._vbData[this._posInVBData+2]=$Z,this._vbData[this._posInVBData+3]=$n,this._vbData[this._posInVBData+4]=$g,this._vbData[this._posInVBData+5]=$q,this._vbData[this._posInVBData+6]=$P,this._posInVBData+=this._floatSizePerVer,this},$_.addVertexIndex=function($B,$_,$Z,$n,$g,$q,$P,$k){return this._hasBegun||this.addVertexIndexException(),this._vbData[$k]=$B,this._vbData[$k+1]=$_,this._vbData[$k+2]=$Z,this._vbData[$k+3]=$n,this._vbData[$k+4]=$g,this._vbData[$k+5]=$q,this._vbData[$k+6]=$P,($k+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$k),this},$_.addIndexes=function($B){var $_=arguments;this._hasBegun||this.addVertexIndexException();for(var $Z=0;$Z<$_.length;$Z++)this._ibData[this._posInIBData]=$_[$Z],this._posInIBData++;return this},$_.begin=function($B,$_){return this._hasBegun&&this.beginException0(),1!==$B&&4!==$B&&this.beginException1(),this._primitiveType=$B,this._camera=$_,this._hasBegun=!0,this},$_.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$_.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($B._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$Q.drawCall++,$v.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$_.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$_.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$_.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$_.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$_.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$_.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(28,[new $PB(0,"vector3",0),new $PB(12,"vector4",1)])}]),$B}()),$U=function(){function $B(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$B._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $I_}$A($B,"laya.d3.core.render.RenderElement");var $_=$B.prototype;return $_.getDynamicBatchBakedVertexs=function($B){for(var $_=this._renderObj._getVertexBuffer($B),$Z=$_.getData().slice(),$n=$_.vertexDeclaration,$g=$n.getVertexElementByUsage(0).offset/4,$q=$n.getVertexElementByUsage(3).offset/4,$P=this._sprite3D.transform,$k=$P.worldMatrix,$m=$P.rotation,$D=$n.vertexStride/4,$T=0,$e=$Z.length;$T<$e;$T+=$D){var $I=$T+$g,$A=$T+$q;$r_.transformVector3ArrayToVector3ArrayCoordinate($Z,$I,$k,$Z,$I),$r_.transformVector3ArrayByQuat($Z,$A,$m,$Z,$A)}return $Z},$_.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$_._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$$(0,$_,"id",function(){return this._id}),$$(0,$_,"renderObj",function(){return this._renderObj},function($B){this._renderObj!==$B&&(this._renderObj=$B)}),$B._uniqueIDCounter=0,$B}(),$S=function(){function $_($B){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$_._uniqueIDCounter,this._needSort=!1,this._scene=$B,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$A($_,"laya.d3.core.render.RenderQueue");var $B=$_.prototype;return $B._sortOpaqueFunc=function($B,$_){if($B._render&&$_._render){var $Z=$B._material.renderQueue-$_._material.renderQueue;return 0==$Z?$B._render._distanceForSort-$_._render._distanceForSort:$Z}return 0},$B._sortAlphaFunc=function($B,$_){if($B._render&&$_._render){var $Z=$B._material.renderQueue-$_._material.renderQueue;return 0==$Z?$_._render._distanceForSort-$B._render._distanceForSort:$Z}return 0},$B._begainRenderElement=function($B,$_,$Z){return!!$_._beforeRender($B)},$B._sortAlpha=function($B){$_._cameraPosition=$B,this._finalElements.sort(this._sortAlphaFunc)},$B._sortOpaque=function($B){$_._cameraPosition=$B,this._finalElements.sort(this._sortOpaqueFunc)},$B._preRender=function($B){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$B._render=function($B,$_){for(var $Z,$n,$g,$q,$P,$k,$m=$Q.loopCount,$D=this._scene,$T=$B.camera,$e=($T.id,!1),$I=0,$A=this._finalElements.length;$I<$A;$I++){var $$,$w,$r,$j=this._finalElements[$I];if(null!=$j._onPreRenderFunction&&$j._onPreRenderFunction.call($j._sprite3D,$B),0===$j._type){if($B.owner=$r=$j._sprite3D,$B.renderElement=$j,$r._preRenderUpdateComponents($B),$$=$j.renderObj,$w=$j._material,this._begainRenderElement($B,$$,$w)){if($Z=$$._getVertexBuffers(),!($g=($n=$$._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$n.id]){this._errorRecord[$n.id]=1;var $y="vertexBuffer:"+("("+$n._destroyed+","+$n._released+","+$n._referenceCount+","+$n._buffer+")")+", material:"+($w?$w.__className+"("+$w._destroyed+","+$w._released+")":"null")+", owner:"+($r?$r.__className+"("+$r._destroyed+","+$r._activeInHierarchy+","+$r._displayedInStage+")":"null")+", renderObj:"+($$?$$.__className+"("+$$._destroyed+","+$$._released+","+$$._referenceCount+")":"")+", parent:, url:"+($r?$r.url:"")+", disposeStack:"+$n.disposeStack;$t.recordError("报错：unknown vertexDeclaration  "+$y)}continue}if($e=($q=$B._shader=$w._getShader($D._shaderDefineValue,$g.shaderDefineValue,$r._shaderDefineValue)).bind()||$m!==$q._uploadLoopCount,$Z){if($q._uploadVertexBuffer!==$Z||$e){for(var $C=0;$C<$Z.length;$C++){var $z=$Z[$C];$q.uploadAttributesX($z.vertexDeclaration.shaderValues.data,$z)}$q._uploadVertexBuffer=$Z}}else($q._uploadVertexBuffer!==$n||$e)&&($q.uploadAttributes($g.shaderValues.data,null),$q._uploadVertexBuffer=$n);($q._uploadScene!==$D||$e)&&($q.uploadSceneUniforms($D._shaderValues.data),$q._uploadScene=$D),($T!==$q._uploadCamera||$q._uploadSprite3D!==$r||$e)&&($q.uploadSpriteUniforms($r._shaderValues.data),$q._uploadSprite3D=$r),($T!==$q._uploadCamera||$e)&&($q.uploadCameraUniforms($T._shaderValues.data),$q._uploadCamera=$T),($q._uploadMaterial!==$w||$e)&&($w._upload(),$q._uploadMaterial=$w),$P!==$w?($w._setRenderStateBlendDepth(),$w._setRenderStateFrontFace($_,$r.transform),$P=$w,$k=$r):$k!==$r&&($w._setRenderStateFrontFace($_,$r.transform),$k=$r),$$._render($B),$q._uploadLoopCount=$m}$r._postRenderUpdateComponents($B)}else if(2===$j._type){$j.renderObj;$B.owner=$r=$j._sprite3D,$B.renderElement=$j,$B._batchIndexStart=$j._tempBatchIndexStart,$B._batchIndexEnd=$j._tempBatchIndexEnd,$$=$j.renderObj,$w=$j._material,this._begainRenderElement($B,$$,$w)&&($g=($n=$$._getVertexBuffer(0)).vertexDeclaration,$e=($q=$B._shader=$w._getShader($D._shaderDefineValue,$g.shaderDefineValue,$r._shaderDefineValue)).bind()||$m!==$q._uploadLoopCount,($q._uploadVertexBuffer!==$n||$e)&&($q.uploadAttributes($g.shaderValues.data,null),$q._uploadVertexBuffer=$n),($q._uploadScene!==$D||$e)&&($q.uploadSceneUniforms($D._shaderValues.data),$q._uploadScene=$D),($T!==$q._uploadCamera||$q._uploadSprite3D!==$r||$e)&&($q.uploadSpriteUniforms($r._shaderValues.data),$q._uploadSprite3D=$r),($T!==$q._uploadCamera||$e)&&($q.uploadCameraUniforms($T._shaderValues.data),$q._uploadCamera=$T),($q._uploadMaterial!==$w||$e)&&($w._upload(),$q._uploadMaterial=$w),$P!==$w?($w._setRenderStateBlendDepth(),$w._setRenderStateFrontFace($_,$r.transform),$P=$w,$k=$r):$k!==$r&&($w._setRenderStateFrontFace($_,$r.transform),$k=$r),$$._render($B),$q._uploadLoopCount=$m)}}},$B._renderShadow=function($B,$_){for(var $Z,$n,$g,$q,$P,$k=$Q.loopCount,$m=this._scene,$D=$B.camera,$T=!1,$e=0,$I=this._finalElements.length;$e<$I;$e++){var $A,$$,$w,$r=this._finalElements[$e];0===$r._type&&($B.owner=$w=$r._sprite3D,$_||$w._projectionViewWorldUpdateCamera===$D&&$w._projectionViewWorldUpdateLoopCount===$Q.loopCount||($w._render._renderUpdate($B._projectionViewMatrix),$w._projectionViewWorldUpdateLoopCount=$Q.loopCount,$w._projectionViewWorldUpdateCamera=$D),$B.renderElement=$r,$w._preRenderUpdateComponents($B),$A=$r.renderObj,$$=$r._material,this._begainRenderElement($B,$A,null)&&($n=($Z=$A._getVertexBuffer(0)).vertexDeclaration,$T=($g=$B._shader=$$._getShader($m._shaderDefineValue,$n.shaderDefineValue,$w._shaderDefineValue)).bind()||$k!==$g._uploadLoopCount,($g._uploadVertexBuffer!==$Z||$T)&&($g.uploadAttributes($n.shaderValues.data,null),$g._uploadVertexBuffer=$Z),($D!==$g._uploadCamera||$g._uploadSprite3D!==$w||$T)&&($g.uploadSpriteUniforms($w._shaderValues.data),$g._uploadSprite3D=$w),($D!==$g._uploadCamera||$T)&&($g.uploadCameraUniforms($D._shaderValues.data),$g._uploadCamera=$D),($g._uploadMaterial!==$$||$T)&&($$._upload(),$g._uploadMaterial=$$),$g._uploadRenderElement,$q!==$$?($$._setRenderStateFrontFace(!1,$w.transform),$q=$$,$P=$w):$P!==$w&&($$._setRenderStateFrontFace(!1,$w.transform),$P=$w),$A._render($B),$g._uploadLoopCount=$k),$w._postRenderUpdateComponents($B))}},$B._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$B._addRenderElement=function($B){this._renderElements.push($B),this._needSort=!0},$B._addDynamicBatchElement=function($B){this._dynamicBatchCombineRenderElements.push($B)},$$(0,$B,"id",function(){return this._id}),$_._uniqueIDCounter=0,$_._cameraPosition=null,$_}(),$O=function(){function $B(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $A($B,"laya.d3.core.render.RenderState"),$B.clientWidth=0,$B.clientHeight=0,$B}(),$d=function(){function $P($B,$_){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $iB(new $P_,0),this._corners=[new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_],this._boundingBoxCenter=new $P_,this._children=$n(8),this._objects=[],this._tempBoundBoxCorners=[new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_],this._scene=$B,this._currentDepth=$_}$A($P,"laya.d3.core.scene.OctreeNode");var $B=$P.prototype;return $t.imps($B,{"laya.d3.core.scene.ITreeNode":!0}),$B.init=function($B,$_){var $Z=new $P_,$n=new $P_;$P_.scale($_,-.5,$Z),$P_.scale($_,.5,$n),$P_.add($Z,$B,$Z),$P_.add($n,$B,$n),this.exactBox=new $dB($Z,$n),this.relaxBox=new $dB($Z,$n)},$B.addTreeNode=function($B){1===Collision.boxContainsBox(this._relaxBox,$B.boundingBox)?this.addNodeDown($B,0):this.addObject($B)},$B.addChild=function($B){var $_=this._children[$B];if(null==$_){$_=new $P(this._scene,this._currentDepth+1),(this._children[$B]=$_)._parent=this,$P_.subtract(this._exactBox.max,this._exactBox.min,$P.tempSize),$P_.multiply($P.tempSize,$P._octreeSplit[$B],$P.tempCenter),$P_.add(this._exactBox.min,$P.tempCenter,$P.tempCenter),$P_.scale($P.tempSize,.25,$P.tempSize);var $Z=new $P_,$n=new $P_;$P_.subtract($P.tempCenter,$P.tempSize,$Z),$P_.add($P.tempCenter,$P.tempSize,$n),$_.exactBox=new $dB($Z,$n),$P_.scale($P.tempSize,$P.relax,$P.tempSize);var $g=new $P_,$q=new $P_;$P_.subtract($P.tempCenter,$P.tempSize,$g),$P_.add($P.tempCenter,$P.tempSize,$q),$_.relaxBox=new $dB($g,$q)}return $_},$B.addObject=function($B){($B._treeNode=this)._objects.push($B)},$B.removeObject=function($B){if($B._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $_=this._objects.indexOf($B);return-1!==$_&&(this._objects.splice($_,1),!0)},$B.clearObject=function(){this._objects.length=0},$B.addNodeUp=function($B,$_){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$B.boundingBox)?this._parent.addNodeUp($B,$_-1):this.addNodeDown($B,$_)},$B.addNodeDown=function($B,$_){if($_<this._scene.treeLevel){var $Z=this.inChildIndex($B.boundingBoxCenter),$n=this.addChild($Z);1===Collision.boxContainsBox($n._relaxBox,$B.boundingBox)?$n.addNodeDown($B,++$_):this.addObject($B)}else this.addObject($B)},$B.inChildIndex=function($B){return 4*($B.z<this._boundingBoxCenter.z?0:1)+2*($B.y<this._boundingBoxCenter.y?0:1)+($B.x<this._boundingBoxCenter.x?0:1)},$B.updateObject=function($B){1===Collision.boxContainsBox(this._relaxBox,$B.boundingBox)?(this.removeObject($B),$B._treeNode=null,this.addNodeDown($B,this._currentDepth)):this._parent&&(this.removeObject($B),$B._treeNode=null,this._parent.addNodeUp($B,this._currentDepth-1))},$B.cullingObjects=function($B,$_,$Z,$n,$g){var $q,$P=0,$k=0,$m=0,$D=this._scene._dynamicBatchManager;for($P=0,$q=this._objects.length;$P<$q;$P++){var $T=this._objects[$P];if($F.isVisible($T._owner.layer.mask)&&$T.enable){if($_&&($Q.treeSpriteCollision+=1,0===$B.containsBoundSphere($T.boundingSphere)))continue;$T._renderUpdate($g),$T._distanceForSort=$P_.distance($T.boundingSphere.center,$n)+$T.sortingFudge;var $e=$T._renderElements;for($k=0,$m=$e.length;$k<$m;$k++){var $I=$e[$k],$A=$I._staticBatch;if($A&&$A._material===$I._material)$A._addBatchRenderElement($I);else{var $$=$I.renderObj;$$.triangleCount<10&&1===$$._vertexBufferCount&&$$._getIndexBuffer()&&$I._material.renderQueue<2&&$I._canDynamicBatch&&!$T._owner.isStatic?$D._addPrepareRenderElement($I):this._scene.getRenderQueue($I._material.renderQueue)._addRenderElement($I)}}}}for($P=0;$P<8;$P++){var $w=this._children[$P];if(null!=$w){var $r=$_;if($_){var $j=$B.containsBoundBox($w._relaxBox);if($Q.treeNodeCollision+=1,0===$j)continue;$r=2===$j}$w.cullingObjects($B,$r,$Z,$n,$g)}}},$B.cullingShadowObjects=function($B,$_,$Z,$n,$g){var $q,$P=0,$k=0,$m=0;this._scene._dynamicBatchManager;for($P=0,$q=this._objects.length;$P<$q;$P++){var $D=this._objects[$P];if($D.castShadow&&$F.isVisible($D._owner.layer.mask)&&$D.enable){if($Z&&0===$B[0].containsBoundSphere($D.boundingSphere))continue;for(var $T=1,$e=$B.length;$T<$e;$T++){var $I=$_[$T-1];if(0!==$B[$T].containsBoundSphere($D.boundingSphere)){var $A=$D._renderElements;for($k=0,$m=$A.length;$k<$m;$k++)$I._addRenderElement($A[$k])}}}}for($P=0;$P<8;$P++){var $$=this._children[$P];if(null!=$$){var $w=$Z;if($Z){var $r=$B[0].containsBoundBox($$._relaxBox);if(0===$r)continue;$w=2===$r}$$.cullingShadowObjects($B,$_,$w,$n,$g)}}},$B.cullingShadowObjectsOnePSSM=function($B,$_,$Z,$n,$g,$q){var $P,$k=$_[0],$m=0,$D=0,$T=0;for($m=0,$P=this._objects.length;$m<$P;$m++){var $e=this._objects[$m];if($e.castShadow&&$F.isVisible($e._owner.layer.mask)&&$e.enable){if($n&&0===$B.containsBoundSphere($e.boundingSphere))continue;$e._renderUpdate($Z);var $I=$e._renderElements;for($D=0,$T=$I.length;$D<$T;$D++)$k._addRenderElement($I[$D])}}for($m=0;$m<8;$m++){var $A=this._children[$m];if(null!=$A){var $$=$n;if($n){var $w=$B.containsBoundBox($A._relaxBox);if(0===$w)continue;$$=2===$w}$A.cullingShadowObjectsOnePSSM($B,$_,$Z,$$,$g,$q)}}},$B.renderBoudingBox=function($B){this._renderBoudingBox($B);for(var $_=0;$_<8;++$_){var $Z=this._children[$_];$Z&&$Z.renderBoudingBox($B)}},$B.buildAllChild=function($B){if($B<this._scene.treeLevel)for(var $_=0;$_<8;$_++){this.addChild($_).buildAllChild($B+1)}},$B._renderBoudingBox=function($B){},$$(0,$B,"exactBox",function(){return this._exactBox},function($B){this._exactBox=$B,$P_.add($B.min,$B.max,this._boundingBoxCenter),$P_.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$$(0,$B,"relaxBox",function(){return this._relaxBox},function($B){(this._relaxBox=$B).getCorners(this._corners),$iB.createfromPoints(this._corners,this._boundingSphere)}),$P.debugMode=!1,$P.relax=1.15,$P.CHILDNUM=8,$e($P,["tempVector0",function(){return this.tempVector0=new $P_},"tempSize",function(){return this.tempSize=new $P_},"tempCenter",function(){return this.tempCenter=new $P_},"_octreeSplit",function(){return this._octreeSplit=[new $P_(.25,.25,.25),new $P_(.75,.25,.25),new $P_(.25,.75,.25),new $P_(.75,.75,.25),new $P_(.25,.25,.75),new $P_(.75,.25,.75),new $P_(.25,.75,.75),new $P_(.75,.75,.75)]}]),$P}(),$a=(function(){function $B(){}$A($B,"laya.d3.core.scene.SceneManager")}(),function(){function $B($B,$_,$Z,$n){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$B&&($B=1),void 0===$_&&($_=1),void 0===$Z&&($Z=1),void 0===$n&&($n=1),this._r=$B,this._g=$_,this._b=$Z,this._a=$n}return $A($B,"laya.d3.core.trail.module.Color",null,"Color$1"),$B.prototype.cloneTo=function($B){$B._r=this._r,$B._g=this._g,$B._b=this._b,$B._a=this._a},$e($B,["RED",function(){return this.RED=new $B(1,0,0,1)},"GREEN",function(){return this.GREEN=new $B(0,1,0,1)},"BLUE",function(){return this.BLUE=new $B(0,0,1,1)},"CYAN",function(){return this.CYAN=new $B(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $B(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $B(1,0,1,1)},"GRAY",function(){return this.GRAY=new $B(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $B(1,1,1,1)},"BLACK",function(){return this.BLACK=new $B(0,0,0,1)}]),$B}()),$i=(function(){function $B(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$A($B,"laya.d3.core.trail.module.Gradient");var $_=$B.prototype;$_.setKeys=function($B,$_){var $Z,$n;this._colorKeys=$B;for(var $g=this.index=0;$g<$B.length;$g++){var $q=($Z=$B[$g]).color;this._colorKeyData[this.index++]=$q._r,this._colorKeyData[this.index++]=$q._g,this._colorKeyData[this.index++]=$q._b,this._colorKeyData[this.index++]=$Z.time}this._alphaKeys=$_;for(var $P=this.index=0;$P<$_.length;$P++)$n=$_[$P],this._alphaKeyData[this.index++]=$n.alpha,this._alphaKeyData[this.index++]=$n.time},$_.cloneTo=function($B){var $_=0,$Z=0,$n=this.colorKeys,$g=[];for($_=0,$Z=$n.length;$_<$Z;$_++){var $q=new $c;$n[$_].cloneTo($q),$g.push($q)}var $P=this.alphaKeys,$k=[];for($_=0,$Z=$P.length;$_<$Z;$_++){var $m=new $i;$P[$_].cloneTo($m),$k.push($m)}$B.setKeys($g,$k)},$$(0,$_,"mode",function(){return this._mode},function($B){this._mode=$B}),$$(0,$_,"colorKeys",function(){return this._colorKeys},function($B){this._colorKeys=$B;for(var $_=this.index=0;$_<$B.length;$_++){var $Z=$B[$_],$n=$Z.color;this._colorKeyData[this.index++]=$n._r,this._colorKeyData[this.index++]=$n._g,this._colorKeyData[this.index++]=$n._b,this._colorKeyData[this.index++]=$Z.time}}),$$(0,$_,"alphaKeys",function(){return this._alphaKeys},function($B){this._alphaKeys=$B;for(var $_=this.index=0;$_<$B.length;$_++){var $Z=$B[$_];this._alphaKeyData[this.index++]=$Z.alpha,this._alphaKeyData[this.index++]=$Z.time}})}(),function(){function $B($B,$_){this._alpha=NaN,this._time=NaN,void 0===$B&&($B=0),void 0===$_&&($_=0),this._alpha=$B,this._time=$_}$A($B,"laya.d3.core.trail.module.GradientAlphaKey");var $_=$B.prototype;return $_.cloneTo=function($B){$B.alpha=this.alpha,$B.time=this.time},$$(0,$_,"alpha",function(){return this._alpha},function($B){this._alpha=$B}),$$(0,$_,"time",function(){return this._time},function($B){this._time=$B}),$B}()),$c=function(){function $B($B,$_){this._color=null,this._time=NaN,void 0===$_&&($_=0),this._color=$B||new $a,this._time=$_}$A($B,"laya.d3.core.trail.module.GradientColorKey");var $_=$B.prototype;return $_.cloneTo=function($B){this.color.cloneTo($B.color),$B.time=this.time},$$(0,$_,"color",function(){return this._color},function($B){this._color=$B}),$$(0,$_,"time",function(){return this._time},function($B){this._time=$B}),$B}(),$E=(function(){function $B(){}$A($B,"laya.d3.core.trail.module.GradientMode"),$B.Blend=0,$B.Fixed=1}(),function(){function $B(){}$A($B,"laya.d3.core.trail.module.TextureMode"),$B.Stretch=0,$B.Tile=1}(),function(){function $B(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$A($B,"laya.d3.core.trail.module.TrailKeyFrame"),$B.prototype.cloneTo=function($B){$B.time=this.time,$B.inTangent=this.inTangent,$B.outTangent=this.outTangent,$B.value=this.value}}(),function(){function $_($B){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $P_,this._curPosition=new $P_,this._delVector3=new $P_,this._lastFixedVertexPosition=new $P_,this._pointAtoBVector3=new $P_,this._pointA=new $P_,this._pointB=new $P_,this._owner=$B,this._id=$_.renderElementCount++,0==this._id?$B._owner.transform.position.cloneTo(this._lastPosition):$B._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $K_($E.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $K_($E.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$A($_,"laya.d3.core.trail.TrailRenderElement");var $B=$_.prototype;$t.imps($B,{"laya.d3.core.render.IRenderable":!0}),$B._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$B._addTrailByFirstPosition=function($B,$_){$P_.subtract($_,$B,this._delVector3),$P_.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$P_.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$P_.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($B),$B.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$B._addTrailByNextPosition=function($B){$P_.subtract($B,this._lastFixedVertexPosition,this._delVector3),$P_.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$P_.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$P_.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$P_.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$cB.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($B),$B.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($B),this._virtualVerticesCount=2)},$B._updateVerticesByPosition=function($B){this._pointe=$B.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$B._updateVertexBuffer2=function(){var $B,$_=0,$Z=0,$n=0;for($n=0,$B=(this._verticesCount+this._virtualVerticesCount)/2;$n<$B;$n++)$Z=0==this._owner.textureMode?(this._VerticesToTailLength[$n]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$n],this._vertices2[$_++]=1-$Z,this._vertices2[$_++]=1-$Z;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$B._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$B._updateDisappear=function(){var $B,$_=0;for($_=this._curDisappearIndex,$B=(this._verticesCount+this._virtualVerticesCount)/2;$_<$B;$_++)this._owner._curtime-this._everyGroupVertexBirthTime[$_]>=this._owner.time+$cB.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$B._beforeRender=function($B){return this._camera=$B.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$P_.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$B._render=function($B){this._isDead||($v.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$Q.drawCall++,$Q.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$B._getVertexBuffer=function($B){return void 0===$B&&($B=0),0===$B?this._vertexBuffer1:1===$B?this._vertexBuffer2:null},$B._getVertexBuffers=function(){return this._vertexBuffers},$B._getIndexBuffer=function(){return null},$B.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$B._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$$(0,$B,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$$(0,$B,"triangleCount",function(){return 0}),$_.renderElementCount=0}(),function(){function $B(){}$A($B,"laya.d3.core.trail.VertexTrail");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration1}),$$(1,$B,"vertexDeclaration1",function(){return $B._vertexDeclaration1}),$$(1,$B,"vertexDeclaration2",function(){return $B._vertexDeclaration2}),$e($B,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $qB(32,[new $PB(0,"vector3",0),new $PB(12,"vector3",41),new $PB(24,"single",33),new $PB(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $qB(4,[new $PB(0,"single",38)])}]),$B}()),$BB=function(){function $z($B){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$B}$A($z,"laya.d3.graphics.DynamicBatch");var $B=$z.prototype;return $t.imps($B,{"laya.d3.core.render.IRenderable":!0}),$B._getVertexBuffer=function($B){return void 0===$B&&($B=0),0===$B?this._vertexBuffer:null},$B._getIndexBuffer=function(){return this._indexBuffer},$B._getCombineRenderElementFromPool=function($B,$_,$Z){var $n=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $n||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$n=new $U,$n._sprite3D=new $S_),$n._sprite3D._render._renderUpdate($Z),$n},$B._getRenderElement=function($B,$_,$Z){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$z.maxVertexCount),this._indexDatas=new Uint16Array($z.maxIndexCount),this._vertexBuffer=$K_.create(this._vertexDeclaration,$z.maxVertexCount,35048),this._indexBuffer=$p_.create("ushort",$z.maxIndexCount,35048));for(var $n=this._merageElements.length=0,$g=0,$q=0,$P=this._combineRenderElements.length;$q<$P;$q++){var $k=this._combineRenderElements[$q],$m=$k.getDynamicBatchBakedVertexs(0),$D=$k.getBakedIndices(),$T=$k._sprite3D.transform._isFrontFaceInvert,$e=$n/(this._vertexDeclaration.vertexStride/4),$I=$g,$A=$I+$D.length;$k._tempBatchIndexStart=$I,$k._tempBatchIndexEnd=$A,this._indexDatas.set($D,$g);var $$=0;if($T)for($$=$I;$$<$A;$$+=3){this._indexDatas[$$]=$e+this._indexDatas[$$];var $w=this._indexDatas[$$+1],$r=this._indexDatas[$$+2];this._indexDatas[$$+1]=$e+$r,this._indexDatas[$$+2]=$e+$w}else for($$=$I;$$<$A;$$+=3)this._indexDatas[$$]=$e+this._indexDatas[$$],this._indexDatas[$$+1]=$e+this._indexDatas[$$+1],this._indexDatas[$$+2]=$e+this._indexDatas[$$+2];$g+=$D.length,this._vertexDatas.set($m,$n),$n+=$m.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$q=this._combineRenderElementPoolIndex=0,$P=this._materials.length;$q<$P;$q++){var $j=this._getCombineRenderElementFromPool($B,$_,$Z);$j._type=2,$j._staticBatch=null;var $y=($j.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$q]]._tempBatchIndexStart,$C=$q+1===this._materialToRenderElementsOffsets.length?$g:this._combineRenderElements[this._materialToRenderElementsOffsets[$q+1]]._tempBatchIndexStart;$j._tempBatchIndexStart=$y,$j._tempBatchIndexEnd=$C,$j._material=this._materials[$q],this._merageElements.push($j)}},$B._addCombineRenderObjTest=function($B){var $_=$B.renderObj,$Z=this._currentCombineIndexCount+$_._getIndexBuffer().indexCount,$n=this._currentCombineVertexCount+$_._getVertexBuffer().vertexCount;return!($z.maxVertexCount<$n||$z.maxIndexCount<$Z)},$B._addCombineRenderObj=function($B){var $_=$B.renderObj;this._combineRenderElements.push($B),this._currentCombineIndexCount=this._currentCombineIndexCount+$_._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$_._getVertexBuffer().vertexCount},$B._addCombineMaterial=function($B){this._materials.push($B)},$B._addMaterialToRenderElementOffset=function($B){this._materialToRenderElementsOffsets.push($B)},$B._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$B._addToRenderQueue=function($B,$_,$Z,$n){this._getRenderElement($_,$Z,$n);for(var $g=0,$q=this._materials.length;$g<$q;$g++)$B.getRenderQueue(this._materials[$g].renderQueue)._addDynamicBatchElement(this._merageElements[$g])},$B._beforeRender=function($B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$B._render=function($B){var $_=$B._batchIndexEnd-$B._batchIndexStart;$v.mainContext.drawElements(4,$_,5123,2*$B._batchIndexStart),$Q.drawCall++,$Q.trianglesFaces+=$_/3},$B._getVertexBuffers=function(){return null},$$(0,$B,"_vertexBufferCount",function(){return 1}),$$(0,$B,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$$(0,$B,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$z.maxVertexCount=2e4,$z.maxIndexCount=4e4,$z.maxCombineTriangleCount=10,$z}(),$_B=function(){function $z(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$A($z,"laya.d3.graphics.DynamicBatchManager");var $B=$z.prototype;return $B.getDynamicBatch=function($B,$_){var $Z,$n=$B.id.toString()+$_;return this._dynamicBatches[$n]?$Z=this._dynamicBatches[$n]:this._dynamicBatches[$n]=$Z=new $BB($B),$Z},$B._garbageCollection=function(){for(var $B in this._dynamicBatches)0===this._dynamicBatches[$B].combineRenderElementsCount&&delete this._dynamicBatches[$B]},$B._addPrepareRenderElement=function($B){this._prepareDynamicBatchCombineElements.push($B)},$B._finishCombineDynamicBatch=function($B){var $_,$Z,$n;this._prepareDynamicBatchCombineElements.sort($z._sortPrepareDynamicBatch);for(var $g,$q,$P,$k,$m,$D=-1,$T=!0,$e=0,$I=-1,$A=0,$$=this._prepareDynamicBatchCombineElements.length;$A<$$;$A++){var $w=($q=this._prepareDynamicBatchCombineElements[$A]).renderObj._getVertexBuffer(0).vertexDeclaration,$r=$Z!==$w;$r&&($e=0,$Z=$w);var $j=$e!==$D;if($j&&($D=$e),($r||$j)&&($P=this.getDynamicBatch($w,$e),$_=null),$T)if($P._addCombineRenderObjTest($q)){if($_!==($g=$q._material))$k&&($B.getRenderQueue($m._material.renderQueue)._addRenderElement($m),$m=$k=null,$I=-1),$k=$g,$I=$P.combineRenderElementsCount,$m=$q,$_=$g;else if($k){var $y=$m.renderObj,$C=$q.renderObj;$y._getVertexBuffer().vertexCount+$C._getVertexBuffer().vertexCount>$BB.maxVertexCount||$y._getIndexBuffer().indexCount+$C._getIndexBuffer().indexCount>$BB.maxIndexCount?($B.getRenderQueue($m._material.renderQueue)._addRenderElement($m),$k=$g,$I=$P.combineRenderElementsCount,$m=$q):($P._addCombineMaterial($k),$P._addMaterialToRenderElementOffset($I),$P._addCombineRenderObj($m),$m=$k=null,$I=-1,$P._addCombineRenderObj($q))}else $P._addCombineRenderObj($q);$T=!0}else $k&&($B.getRenderQueue($m._material.renderQueue)._addRenderElement($m),$m=$k=null,$I=-1),$e++,$T=!1;else $n=this._prepareDynamicBatchCombineElements[$A-1],$P._addMaterialToRenderElementOffset($P.combineRenderElementsCount),$_=$n._material,$P._addCombineMaterial($_),$P._addCombineRenderObj($n),$T=!0,$_!==($g=$q._material)?($k=$g,$I=$P.combineRenderElementsCount,$m=$q):$P._addCombineRenderObj($q),$_=$g}$k&&($B.getRenderQueue($m._material.renderQueue)._addRenderElement($m),$m=$k=null,$I=-1),this._prepareDynamicBatchCombineElements.length=0},$B._clearRenderElements=function(){for(var $B in this._dynamicBatches)this._dynamicBatches[$B]._clearRenderElements()},$B._addToRenderQueue=function($B,$_,$Z,$n){for(var $g in this._dynamicBatches){var $q=this._dynamicBatches[$g];0<$q.combineRenderElementsCount&&$q._addToRenderQueue($B,$_,$Z,$n)}},$B.dispose=function(){this._dynamicBatches=null},$z._sortPrepareDynamicBatch=function($B,$_){return $B._mainSortID-$_._mainSortID},$z}(),$ZB=function(){function $B(){}return $A($B,"laya.d3.graphics.FrustumCulling"),$B.renderShadowObjectCulling=function($B,$_,$Z,$n,$g){var $q=0,$P=0,$k=0,$m=0;for($q=0,$k=$Z.length;$q<$k;$q++){var $D=$Z[$q];$D&&$D._clearRenderElements()}var $T,$e,$I,$A=$B._cullingRenders;if(1<$g){for($q=0,$k=$B._cullingRendersLength;$q<$k;$q++)if(($T=$A[$q]).castShadow&&$F.isVisible($T._owner.layer.mask)&&$T.enable)for(var $$=1,$w=$_.length;$$<$w;$$++)if($e=$Z[$$-1],0!==$_[$$].containsBoundSphere($T.boundingSphere))for($P=0,$m=($I=$T._renderElements).length;$P<$m;$P++)$e._addRenderElement($I[$P])}else for($q=0,$k=$B._cullingRendersLength;$q<$k;$q++)if(($T=$A[$q]).castShadow&&$F.isVisible($T._owner.layer.mask)&&$T.enable&&0!==$_[0].containsBoundSphere($T.boundingSphere))for($T._renderUpdate($n),$e=$Z[0],$P=0,$m=($I=$T._renderElements).length;$P<$m;$P++)$e._addRenderElement($I[$P])},$B.renderShadowObjectCullingOctree=function($B,$_,$Z,$n,$g){for(var $q=0,$P=$Z.length;$q<$P;$q++){var $k=$Z[$q];$k&&$k._clearRenderElements()}1<$g?$B.treeRoot.cullingShadowObjects($_,$Z,!0,0,$B):$B.treeRoot.cullingShadowObjectsOnePSSM($_[0],$Z,$n,!0,0,$B)},$B.renderObjectCulling=function($B,$_,$Z,$n,$g,$q){var $P=0,$k=0,$m=0,$D=0,$T=$_._quenes,$e=$_._dynamicBatchManager,$I=$_._cullingRenders;for($P=0,$k=$T.length;$P<$k;$P++){var $A=$T[$P];$A&&$A._clearRenderElements()}var $$=$nB._staticBatchManagers;for($P=0,$k=$$.length;$P<$k;$P++)$$[$P]._clearRenderElements();$e._clearRenderElements();var $w=$Z.transform.position;for($P=0,$k=$_._cullingRendersLength;$P<$k;$P++){var $r=$I[$P];if($F.isVisible($r._owner.layer.mask)&&$r.enable&&0!==$B.containsBoundSphere($r.boundingSphere)&&$r._renderUpdate($q)){$r._distanceForSort=$P_.distance($r.boundingSphere.center,$w)+$r.sortingFudge;var $j=$r._renderElements;for($m=0,$D=$j.length;$m<$D;$m++){var $y=$j[$m],$C=$y._staticBatch;if($C&&$C._material===$y._material)$C._addBatchRenderElement($y);else{var $z=$y.renderObj;$z.triangleCount<10&&1===$z._vertexBufferCount&&$z._getIndexBuffer()&&$y._material.renderQueue<2&&$y._canDynamicBatch&&!$r._owner.isStatic?$e._addPrepareRenderElement($y):$_.getRenderQueue($y._material.renderQueue)._addRenderElement($y)}}}}for($P=0,$k=$$.length;$P<$k;$P++)$$[$P]._addToRenderQueue($_,$n,$g,$q);$e._finishCombineDynamicBatch($_),$e._addToRenderQueue($_,$n,$g,$q)},$B.renderObjectCullingOctree=function($B,$_,$Z,$n,$g,$q){var $P=0,$k=0,$m=$_._quenes,$D=$_._dynamicBatchManager;for($P=0,$k=$m.length;$P<$k;$P++){var $T=$m[$P];$T&&$T._clearRenderElements()}var $e=$nB._staticBatchManagers;for($P=0,$k=$e.length;$P<$k;$P++)$e[$P]._clearRenderElements();for($D._clearRenderElements(),$_._cullingRenders.length=0,$_.treeRoot.cullingObjects($B,!0,0,$Z.transform.position,$q),$P=0,$k=$e.length;$P<$k;$P++)$e[$P]._addToRenderQueue($_,$n,$g,$q);$D._finishCombineDynamicBatch($_),$D._addToRenderQueue($_,$n,$g,$q)},$B.renderObjectCullingNoBoundFrustum=function($B,$_,$Z,$n,$g){var $q=0,$P=0,$k=0,$m=0,$D=$B._quenes,$T=$B._dynamicBatchManager,$e=$B._cullingRenders;for($q=0,$P=$D.length;$q<$P;$q++){var $I=$D[$q];$I&&$I._clearRenderElements()}var $A=$nB._staticBatchManagers;for($q=0,$P=$A.length;$q<$P;$q++)$A[$q]._clearRenderElements();$T._clearRenderElements();var $$=$_.transform.position;for($q=0,$P=$B._cullingRendersLength;$q<$P;$q++){var $w=$e[$q];if($F.isVisible($w._owner.layer.mask)&&$w.enable){$w._renderUpdate($g),$w._distanceForSort=$P_.distance($w.boundingSphere.center,$$)+$w.sortingFudge;var $r=$w._renderElements;for($k=0,$m=$r.length;$k<$m;$k++){var $j=$r[$k],$y=$j._staticBatch;if($y&&$y._material===$j._material)$y._addBatchRenderElement($j);else{var $C=$j.renderObj;$C.triangleCount<10&&1===$C._vertexBufferCount&&$C._getIndexBuffer()&&$j._material.renderQueue<2&&$j._canDynamicBatch&&!$w._owner.isStatic?$T._addPrepareRenderElement($j):$B.getRenderQueue($j._material.renderQueue)._addRenderElement($j)}}}}for($q=0,$P=$A.length;$q<$P;$q++)$A[$q]._addToRenderQueue($B,$Z,$n,$g);$T._finishCombineDynamicBatch($B),$T._addToRenderQueue($B,$Z,$n,$g)},$B}(),$nB=function(){function $q(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$A($q,"laya.d3.graphics.StaticBatchManager");var $B=$q.prototype;return $B._finishInit=function(){for(var $B in this._staticBatches)this._staticBatches[$B]._finishInit();this._initBatchRenderElements.length=0},$B._initStaticBatchs=function($B){throw new Error("StaticBatchManager:must override this function.")},$B._addInitBatchSprite=function($B){for(var $_=$B._render._renderElements,$Z=0,$n=$_.length;$Z<$n;$Z++)this._initBatchRenderElements.push($_[$Z])},$B._clearRenderElements=function(){for(var $B in this._staticBatches)this._staticBatches[$B]._clearRenderElements()},$B._garbageCollection=function($B){var $_=$B._staticBatch,$Z=$_._initBatchRenderElements,$n=$Z.indexOf($B);$Z.splice($n,1),0===$Z.length&&($_.dispose(),delete this._staticBatches[$_._key])},$B._addToRenderQueue=function($B,$_,$Z,$n){for(var $g in this._staticBatches){var $q=this._staticBatches[$g];0<$q._batchRenderElements.length&&$q._updateToRenderQueue($B,$n)}},$B.dispose=function(){this._staticBatches=null},$q._addToStaticBatchQueue=function($B){$B instanceof laya.d3.core.RenderableSprite3D&&$B._addToInitStaticBatchManager();for(var $_=0,$Z=$B.numChildren;$_<$Z;$_++)$q._addToStaticBatchQueue($B._childs[$_])},$q.combine=function($B,$_){var $Z,$n=0,$g=0;if($_)for($n=0,$g=$_.length;$n<$g;$n++){$_[$n]._addToInitStaticBatchManager()}else $B&&$q._addToStaticBatchQueue($B);for($n=0,$g=$q._staticBatchManagers.length;$n<$g;$n++)($Z=$q._staticBatchManagers[$n])._initStaticBatchs($B),$Z._finishInit()},$q._staticBatchManagers=[],$q}(),$gB=function(){function $B($B,$_,$Z){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$B,this._manager=$_,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$Z}$A($B,"laya.d3.graphics.StaticBatch");var $_=$B.prototype;return $t.imps($_,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$_._binarySearch=function($B){for(var $_=0,$Z=this._batchRenderElements.length-1,$n=0;$_<=$Z;)$n=Math.floor(($_+$Z)/2),this._compareBatchRenderElement(this._batchRenderElements[$n],$B)?$Z=$n-1:$_=$n+1;return $_},$_._compareBatchRenderElement=function($B,$_){throw new Error("StaticBatch:must override this function.")},$_._getVertexDecLightMap=function($B){return $B===$pB.vertexDeclaration?$FB.vertexDeclaration:$B===$xB.vertexDeclaration?$oB.vertexDeclaration:$B===$MB.vertexDeclaration?$zB.vertexDeclaration:$B===$WB.vertexDeclaration?null:$B===$wB.vertexDeclaration?$rB.vertexDeclaration:$B===$HB.vertexDeclaration?$fB.vertexDeclaration:$B===$vB.vertexDeclaration?$VB.vertexDeclaration:$B===$KB.vertexDeclaration?$uB.vertexDeclaration:$B===$xB.vertexDeclaration?$oB.vertexDeclaration:$B===$YB.vertexDeclaration?$tB.vertexDeclaration:$B===$WB.vertexDeclaration?null:$B===$wB.vertexDeclaration?$rB.vertexDeclaration:$B===$GB.vertexDeclaration?$bB.vertexDeclaration:$B===$vB.vertexDeclaration?$VB.vertexDeclaration:$B},$_._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$_._addBatchRenderElement=function($B){this._batchRenderElements.splice(this._binarySearch($B),0,$B)},$_._updateToRenderQueue=function($B,$_){this._combineRenderElementPoolIndex=0,this._getRenderElement($B.getRenderQueue(this._material.renderQueue)._renderElements,$B,$_)},$_._getRenderElement=function($B,$_,$Z){throw new Error("StaticBatch:must override this function.")},$_._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$_._clearRenderElements=function(){this._batchRenderElements.length=0},$_.dispose=function(){},$_._getVertexBuffer=function($B){return void 0===$B&&($B=0),null},$_._getIndexBuffer=function(){return null},$_._beforeRender=function($B){return!0},$_._render=function($B){},$_._getVertexBuffers=function(){return null},$$(0,$_,"_vertexBufferCount",function(){return 1}),$$(0,$_,"triangleCount",function(){return 0}),$B.combine=function($B){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$nB.combine($B)},$B.maxBatchVertexCount=65535,$B}(),$qB=function(){function $P($B,$_){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$P._uniqueIDCounter,this._id>$P.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$P.maxVertexDeclaration);this._shaderValues=new $I_,this._vertexElementsDic={},this._vertexStride=$B,this._vertexElements=$_;for(var $Z=0;$Z<$_.length;$Z++){var $n=$_[$Z],$g=$n.elementUsage;this._vertexElementsDic[$g]=$n;var $q=[$P._getTypeSize($n.elementFormat)/4,5126,!1,this._vertexStride,$n.offset];switch(this._shaderValues.setValue($g,$q),$g){case 1:this._addShaderDefine($Q_.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($Q_.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($Q_.SHADERDEFINE_UV1)}}}$A($P,"laya.d3.graphics.VertexDeclaration");var $B=$P.prototype;return $B._addShaderDefine=function($B){this._shaderDefineValue|=$B},$B._removeShaderDefine=function($B){this._shaderDefineValue&=~$B},$B.getVertexElements=function(){return this._vertexElements.slice()},$B.getVertexElementByUsage=function($B){return this._vertexElementsDic[$B]},$B.unBinding=function(){},$$(0,$B,"shaderDefineValue",function(){return this._shaderDefineValue}),$$(0,$B,"id",function(){return this._id}),$$(0,$B,"vertexStride",function(){return this._vertexStride}),$$(0,$B,"shaderValues",function(){return this._shaderValues}),$P._getTypeSize=function($B){switch($B){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$P.getVertexStride=function($B){for(var $_=0,$Z=0;$Z<$B.Length;$Z++){var $n=$B[$Z],$g=$n.offset+$P._getTypeSize($n.elementFormat);$_<$g&&($_=$g)}return $_},$P._maxVertexDeclarationBit=1e3,$P._uniqueIDCounter=1,$e($P,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$P}(),$PB=function(){function $B($B,$_,$Z){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$B,this.elementFormat=$_,this.elementUsage=$Z}return $A($B,"laya.d3.graphics.VertexElement"),$B}(),$kB=(function(){function $B(){}$A($B,"laya.d3.graphics.VertexElementFormat"),$B.Single="single",$B.Vector2="vector2",$B.Vector3="vector3",$B.Vector4="vector4",$B.Color="color",$B.Byte4="byte4",$B.Short2="short2",$B.Short4="short4",$B.NormalizedShort2="normalizedshort2",$B.NormalizedShort4="normalizedshort4",$B.HalfVector2="halfvector2",$B.HalfVector4="halfvector4"}(),function(){function $B(){}$A($B,"laya.d3.graphics.VertexElementUsage"),$B.POSITION0=0,$B.COLOR0=1,$B.TEXTURECOORDINATE0=2,$B.NORMAL0=3,$B.BINORMAL0=4,$B.TANGENT0=5,$B.BLENDINDICES0=6,$B.BLENDWEIGHT0=7,$B.DEPTH0=8,$B.FOG0=9,$B.POINTSIZE0=10,$B.SAMPLE0=11,$B.TESSELLATEFACTOR0=12,$B.COLOR1=13,$B.NEXTTEXTURECOORDINATE0=14,$B.TEXTURECOORDINATE1=15,$B.NEXTTEXTURECOORDINATE1=16,$B.CORNERTEXTURECOORDINATE0=17,$B.VELOCITY0=18,$B.STARTCOLOR0=19,$B.STARTSIZE=20,$B.AGEADDSCALE0=21,$B.STARTROTATION=22,$B.ENDCOLOR0=23,$B.STARTLIFETIME=24,$B.TIME0=33,$B.SHAPEPOSITIONSTARTLIFETIME=30,$B.DIRECTIONTIME=32,$B.SIZEROTATION0=27,$B.RADIUS0=28,$B.RADIAN0=29,$B.STARTSPEED=31,$B.RANDOM0=34,$B.RANDOM1=35,$B.SIMULATIONWORLDPOSTION=36,$B.SIMULATIONWORLDROTATION=37,$B.TEXTURECOORDINATE0X=38,$B.TEXTURECOORDINATE0X1=39,$B.TEXTURECOORDINATE0Y=40,$B.OFFSETVECTOR=41}(),function(){function $B($B,$_,$Z){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$B,this._textureCoordinate0=$_,this._time=$Z}$A($B,"laya.d3.graphics.VertexGlitter");var $_=$B.prototype;$t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate0}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"time",function(){return this._time}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(24,[new $PB(0,"vector3",0),new $PB(12,"vector2",2),new $PB(20,"single",33)])}])}(),function(){function $B($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$B,this._position=$_,this._velocity=$Z,this._startColor=$n,this._endColor=$g,this._sizeRotation=$q,this._radius=$P,this._radian=$k,this._ageAddScale=$m,this._time=$D}$A($B,"laya.d3.graphics.VertexParticle");var $_=$B.prototype;$t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"endColor",function(){return this._endColor}),$$(0,$_,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$$(0,$_,"sizeRotation",function(){return this._sizeRotation}),$$(0,$_,"velocity",function(){return this._velocity}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"startColor",function(){return this._startColor}),$$(0,$_,"radius",function(){return this._radius}),$$(0,$_,"radian",function(){return this._radian}),$$(0,$_,"ageAddScale",function(){return this._ageAddScale}),$$(0,$_,"time",function(){return this._time}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(116,[new $PB(0,"vector4",17),new $PB(16,"vector3",0),new $PB(28,"vector3",18),new $PB(40,"vector4",19),new $PB(56,"vector4",23),new $PB(72,"vector3",27),new $PB(84,"vector2",28),new $PB(92,"vector4",29),new $PB(108,"single",24),new $PB(112,"single",33)])}])}(),function(){function $B($B){this._position=null,this._position=$B}$A($B,"laya.d3.graphics.VertexPosition");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(12,[new $PB(0,"vector3",0)])}]),$B}()),$mB=function(){function $B($B,$_){this._position=null,this._normal=null,this._position=$B,this._normal=$_}$A($B,"laya.d3.graphics.VertexPositionNormal");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(24,[new $PB(0,"vector3",0),new $PB(12,"vector3",3)])}]),$B}(),$DB=function(){function $B($B,$_,$Z){this._position=null,this._normal=null,this._color=null,this._position=$B,this._normal=$_,this._color=$Z}$A($B,"laya.d3.graphics.VertexPositionNormalColor");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(40,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1)])}]),$B}(),$TB=function(){function $B($B,$_,$Z,$n,$g){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$B,this._normal=$_,this._color=$Z,this._blendIndex=$n,this._blendWeight=$g}$A($B,"laya.d3.graphics.VertexPositionNormalColorSkin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(72,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector4",7),new $PB(56,"vector4",6)])}]),$B}(),$eB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._tangent=$n,this._blendIndex=$g,this._blendWeight=$q}$A($B,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(88,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector4",7),new $PB(56,"vector4",6),new $PB(72,"vector4",5)])}]),$B}(),$IB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._tangent=$n,this._blendIndex=$g,this._blendWeight=$q}$A($B,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(84,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector4",7),new $PB(56,"vector4",6),new $PB(72,"vector3",5)])}]),$B}(),$AB=function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._tangent=$n}$A($B,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(56,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector4",5)])}]),$B}(),$$B=function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._tangent=$n}$A($B,"laya.d3.graphics.VertexPositionNormalColorTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(52,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector3",5)])}]),$B}(),$wB=function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate=$n}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(48,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2)])}]),$B}(),$rB=function(){function $B($B,$_,$Z,$n,$g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate0=$n,this._textureCoordinate1=$g}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(56,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector2",15)])}]),$B}(),$jB=function(){function $B($B,$_,$Z,$n,$g,$q,$P){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate0=$n,this._textureCoordinate1=$g,this._blendIndex=$q,this._blendWeight=$P}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(88,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector2",15),new $PB(56,"vector4",7),new $PB(72,"vector4",6)])}]),$B}(),$yB=function(){function $B($B,$_,$Z,$n,$g,$q,$P,$k){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate0=$n,this._textureCoordinate1=$g,this._tangent=$q,this._blendIndex=$P,this._blendWeight=$k}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(104,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector2",15),new $PB(56,"vector4",7),new $PB(72,"vector4",6),new $PB(88,"vector4",5)])}]),$B}(),$CB=function(){function $B(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$_.VertexPositionNormalColorTexture0SkinTangent=function($B,$_,$Z,$n,$g,$q,$P,$k){this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate0=$n,this._textureCoordinate1=$g,this._tangent=$q,this._blendIndex=$P,this._blendWeight=$k},$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(100,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector2",15),new $PB(56,"vector4",7),new $PB(72,"vector4",6),new $PB(88,"vector3",5)])}]),$B}(),$zB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate0=$n,this._textureCoordinate1=$g,this._tangent=$q}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(72,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector2",15),new $PB(56,"vector4",5)])}]),$B}(),$tB=function(){function $B(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$A($B,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$_.VertexPositionNormalColorTexture0Tangent=function($B,$_,$Z,$n,$g,$q){this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate0=$n,this._textureCoordinate1=$g,this._tangent=$q},$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(68,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector2",15),new $PB(56,"vector3",5)])}]),$B}(),$JB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate=$n,this._blendIndex=$g,this._blendWeight=$q}$A($B,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(80,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector4",7),new $PB(64,"vector4",6)])}]),$B}(),$NB=function(){function $B($B,$_,$Z,$n,$g,$q,$P){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate=$n,this._tangent=$g,this._blendIndex=$q,this._blendWeight=$P}$A($B,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(96,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector4",7),new $PB(64,"vector4",6),new $PB(80,"vector4",5)])}]),$B}(),$QB=function(){function $B($B,$_,$Z,$n,$g,$q,$P){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate=$n,this._tangent=$g,this._blendIndex=$q,this._blendWeight=$P}$A($B,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(92,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector4",7),new $PB(64,"vector4",6),new $PB(80,"vector3",5)])}]),$B}(),$MB=function(){function $B($B,$_,$Z,$n,$g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate=$n,this._tangent=$g}$A($B,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(64,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector4",5)])}]),$B}(),$YB=function(){function $B($B,$_,$Z,$n,$g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$B,this._normal=$_,this._color=$Z,this._textureCoordinate=$n,this._tangent=$g}$A($B,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"color",function(){return this._color}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(60,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",1),new $PB(40,"vector2",2),new $PB(48,"vector3",5)])}]),$B}(),$lB=function(){function $B($B,$_,$Z){this._position=null,this._normal=null,this._tangent=null,this._position=$B,this._normal=$_,this._tangent=$Z}$A($B,"laya.d3.graphics.VertexPositionNormalSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(40,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector4",5)])}]),$B}(),$LB=function(){function $B($B,$_,$Z){this._position=null,this._normal=null,this._tangent=null,this._position=$B,this._normal=$_,this._tangent=$Z}$A($B,"laya.d3.graphics.VertexPositionNormalTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(36,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector3",5)])}]),$B}(),$vB=function(){function $B($B,$_,$Z){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z}$A($B,"laya.d3.graphics.VertexPositionNormalTexture");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(32,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2)])}]),$B}(),$VB=function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$B,this._normal=$_,this._textureCoordinate0=$Z,this._textureCoordinate1=$n}$A($B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(40,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15)])}]),$B}(),$oB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$B,this._normal=$_,this._textureCoordinate0=$Z,this._textureCoordinate1=$n,this._blendIndex=$g,this._blendWeight=$q}$A($B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(72,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15),new $PB(40,"vector4",7),new $PB(56,"vector4",6)])}]),$B}(),$FB=function(){function $B($B,$_,$Z,$n,$g,$q,$P){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._textureCoordinate0=$Z,this._textureCoordinate1=$n,this._tangent=$g,this._blendIndex=$q,this._blendWeight=$P}$A($B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(88,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15),new $PB(40,"vector4",7),new $PB(56,"vector4",6),new $PB(72,"vector4",5)])}]),$B}(),$uB=function(){function $B(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$A($B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$_.VertexPositionNormalTexture0SkinTangent=function($B,$_,$Z,$n,$g,$q,$P){this._position=$B,this._normal=$_,this._textureCoordinate0=$Z,this._textureCoordinate1=$n,this._tangent=$g,this._blendIndex=$q,this._blendWeight=$P},$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(84,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15),new $PB(40,"vector4",7),new $PB(56,"vector4",6),new $PB(72,"vector3",5)])}]),$B}(),$fB=function(){function $B($B,$_,$Z,$n,$g){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$B,this._normal=$_,this._textureCoordinate0=$Z,this._textureCoordinate1=$n,this._tangent=$g}$A($B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(56,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15),new $PB(40,"vector4",5)])}]),$B}(),$bB=function(){function $B(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$A($B,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$_.VertexPositionNormalTexture0Tangent=function($B,$_,$Z,$n,$g){this._position=$B,this._normal=$_,this._textureCoordinate0=$Z,this._textureCoordinate1=$n,this._tangent=$g},$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(52,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15),new $PB(40,"vector3",5)])}]),$B}(),$xB=function(){function $B($B,$_,$Z,$n,$g){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z,this._blendIndex=$n,this._blendWeight=$g}$A($B,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(64,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector4",7),new $PB(48,"vector4",6)])}]),$B}(),$pB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z,this._tangent=$n,this._blendIndex=$g,this._blendWeight=$q}$A($B,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(80,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector4",7),new $PB(48,"vector4",6),new $PB(64,"vector4",5)])}]),$B}(),$KB=function(){function $B($B,$_,$Z,$n,$g,$q){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z,this._tangent=$n,this._blendIndex=$g,this._blendWeight=$q}$A($B,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(76,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector4",7),new $PB(48,"vector4",6),new $PB(64,"vector3",5)])}]),$B}(),$HB=function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z,this._tangent=$n}$A($B,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(48,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector4",5)])}]),$B}(),$GB=function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z,this._tangent=$n}$A($B,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(44,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector3",5)])}]),$B}(),$WB=function(){function $B($B,$_,$Z){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z}$A($B,"laya.d3.graphics.VertexPositionNTBTexture");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(56,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector3",5),new $PB(36,"vector3",4),new $PB(48,"vector2",2)])}]),$B}(),$XB=function(){function $B($B,$_,$Z,$n,$g,$q,$P,$k){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$B,this._normal=$_,this._textureCoordinate0=$n,this._textureCoordinate1=$g,this._tangent=$q,$Z=$Z,this._blendIndex=$P,this._blendWeight=$k}$A($B,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"tangent",function(){return this._tangent}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(0,$_,"textureCoordinate1",function(){return this._textureCoordinate1}),$$(0,$_,"blendIndex",function(){return this._blendIndex}),$$(0,$_,"blendWeight",function(){return this._blendWeight}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(96,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector3",5),new $PB(36,"vector3",4),new $PB(48,"vector2",2),new $PB(56,"vector2",15),new $PB(64,"vector4",7),new $PB(80,"vector4",6)])}]),$B}(),$RB=function(){function $B($B,$_,$Z){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$B,this._normal=$_,this._textureCoordinate=$Z}$A($B,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"textureCoordinate",function(){return this._textureCoordinate}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(88,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector3",5),new $PB(36,"vector3",4),new $PB(48,"vector2",2),new $PB(56,"vector4",7),new $PB(72,"vector4",6)])}]),$B}(),$hB=(function(){function $B($B,$_,$Z,$n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$B,this._normal=$_,this._textureCoord0=$Z,this._textureCoord1=$n}$A($B,"laya.d3.graphics.VertexPositionTerrain");var $_=$B.prototype;$t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"normal",function(){return this._normal}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoord0",function(){return this._textureCoord0}),$$(0,$_,"textureCoord1",function(){return this._textureCoord1}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(40,[new $PB(0,"vector3",0),new $PB(12,"vector3",3),new $PB(24,"vector2",2),new $PB(32,"vector2",15)])}])}(),function(){function $B($B,$_){this._position=null,this._textureCoordinate0=null,this._position=$B,this._textureCoordinate0=$_}$A($B,"laya.d3.graphics.VertexPositionTexture0");var $_=$B.prototype;return $t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"position",function(){return this._position}),$$(0,$_,"textureCoordinate0",function(){return this._textureCoordinate0}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(20,[new $PB(0,"vector3",0),new $PB(12,"vector2",2)])}]),$B}()),$sB=(function(){function $B($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e,$I,$A){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$B,this._positionStartLifeTime=$_,this._velocity=$Z,this._startColor=$n,this._startSize=$g,this._startRotation0=$q,this._startRotation1=$P,this._startRotation2=$k,this._startLifeTime=$m,this._time=$D,this._startSpeed=$T,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$A}$A($B,"laya.d3.graphics.VertexShurikenParticleBillboard");var $_=$B.prototype;$t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$$(0,$_,"random1",function(){return this._randoms1}),$$(0,$_,"startRotation2",function(){return this._startRotation2}),$$(0,$_,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$$(0,$_,"velocity",function(){return this._velocity}),$$(0,$_,"random0",function(){return this._randoms0}),$$(0,$_,"startSize",function(){return this._startSize}),$$(0,$_,"startColor",function(){return this._startColor}),$$(0,$_,"startRotation0",function(){return this._startRotation0}),$$(0,$_,"startRotation1",function(){return this._startRotation1}),$$(0,$_,"startLifeTime",function(){return this._startLifeTime}),$$(0,$_,"time",function(){return this._time}),$$(0,$_,"startSpeed",function(){return this._startSpeed}),$$(0,$_,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(152,[new $PB(0,"vector4",17),new $PB(16,"vector4",30),new $PB(32,"vector4",32),new $PB(48,"vector4",19),new $PB(64,"vector3",20),new $PB(76,"vector3",22),new $PB(88,"single",31),new $PB(92,"vector4",34),new $PB(108,"vector4",35),new $PB(124,"vector3",36),new $PB(136,"vector4",37)])}])}(),function(){function $B($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e,$I,$A){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$B,this._positionStartLifeTime=$_,this._velocity=$Z,this._startColor=$n,this._startSize=$g,this._startRotation0=$q,this._startRotation1=$P,this._startRotation2=$k,this._startLifeTime=$m,this._time=$D,this._startSpeed=$T,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$A}$A($B,"laya.d3.graphics.VertexShurikenParticleMesh");var $_=$B.prototype;$t.imps($_,{"laya.d3.graphics.IVertex":!0}),$$(0,$_,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$$(0,$_,"velocity",function(){return this._velocity}),$$(0,$_,"position",function(){return this._positionStartLifeTime}),$$(0,$_,"random0",function(){return this._randoms0}),$$(0,$_,"startSize",function(){return this._startSize}),$$(0,$_,"startColor",function(){return this._startColor}),$$(0,$_,"startRotation0",function(){return this._startRotation0}),$$(0,$_,"startRotation1",function(){return this._startRotation1}),$$(0,$_,"random1",function(){return this._randoms1}),$$(0,$_,"startRotation2",function(){return this._startRotation2}),$$(0,$_,"startLifeTime",function(){return this._startLifeTime}),$$(0,$_,"time",function(){return this._time}),$$(0,$_,"startSpeed",function(){return this._startSpeed}),$$(0,$_,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$$(0,$_,"vertexDeclaration",function(){return $B._vertexDeclaration}),$$(1,$B,"vertexDeclaration",function(){return $B._vertexDeclaration}),$e($B,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qB(172,[new $PB(0,"vector3",0),new $PB(12,"vector4",1),new $PB(28,"vector2",2),new $PB(36,"vector4",30),new $PB(52,"vector4",32),new $PB(68,"vector4",19),new $PB(84,"vector3",20),new $PB(96,"vector3",22),new $PB(108,"single",31),new $PB(112,"vector4",34),new $PB(128,"vector4",35),new $PB(144,"vector3",36),new $PB(156,"vector4",37)])}])}(),function(){function $C($B,$_,$Z,$n,$g,$q){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$Z,this._materials=$n,this._subMeshes=$g,this._materialMap=$q,this._version=$_,this._onLoaded($B)}$A($C,"laya.d3.loaders.LoadModelV01");var $B=$C.prototype;return $B._onLoaded=function($B){this._readData=$B,this.READ_BLOCK();for(var $_=0;$_<this._BLOCK.count;$_++){var $Z=this._readData.getUint16(),$n=this._strings[$Z],$g=this["READ_"+$n];if(null==$g)throw new Error("model file err,no this function:"+$Z+" "+$n);if(!$g.call(this))break}return this._mesh},$B.onError=function(){},$B._readString=function(){return this._strings[this._readData.getUint16()]},$B.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$B.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$B.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $B=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $_=0;$_<this._STRINGS.size;$_++)this._strings[$_]=this._readData.readUTFString();return this._readData.pos=$B,!0},$B.READ_MATERIAL=function(){var $B=this._readData.getUint16(),$_=(this._readString(),this._readString());return this._materials[$B]="null"!==$_?$j.getRes(this._materialMap[$_]):new $L_,!0},$B.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $B,$_=this._readData.__getBuffer(),$Z=0,$n=this._readData.getUint32(),$g=this._readData.getUint32(),$q=(new Float32Array($_.slice($n+this._DATA.offset,$n+this._DATA.offset+$g)),this._readData.getUint32()),$P=this._readData.getUint32(),$k=new Float32Array($_.slice($q+this._DATA.offset,$q+this._DATA.offset+$P));for(this.mesh._inverseBindPoses=[],$Z=0,$B=$k.length;$Z<$B;$Z+=16){var $m=new $B_($k[$Z+0],$k[$Z+1],$k[$Z+2],$k[$Z+3],$k[$Z+4],$k[$Z+5],$k[$Z+6],$k[$Z+7],$k[$Z+8],$k[$Z+9],$k[$Z+10],$k[$Z+11],$k[$Z+12],$k[$Z+13],$k[$Z+14],$k[$Z+15]);this.mesh._inverseBindPoses.push($m)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$B.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $B=this._readString();this._shaderAttributes=$B.match($C._attrReg);var $_=this._readData.getUint32(),$Z=this._readData.getUint32(),$n=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$g=this._readData.getUint32(),$q=this._readData.getUint32(),$P=this._readData.getUint32(),$k=this._readData.__getBuffer(),$m=new $D_(this._mesh),$D=this._getVertexDeclaration(),$T=$K_.create($D,$g/$D.vertexStride,35044,!0),$e=$n+this._DATA.offset,$I=$k.slice($e,$e+$g);$T.setData(new Float32Array($I));for(var $A=($m._vertexBuffer=$T).vertexDeclaration.getVertexElements(),$$=0;$$<$A.length;$$++)$m._bufferUsage[$A[$$].elementUsage]=$T;var $w=$p_.create("ushort",$Z/2,35044,!0),$r=$_+this._DATA.offset,$j=$k.slice($r,$r+$Z);$w.setData(new Uint16Array($j)),$m._indexBuffer=$w;var $y=$k.slice($q+this._DATA.offset,$q+this._DATA.offset+$P);return $m._boneIndicesList[0]=new Uint8Array($y),this._subMeshes.push($m),!0},$B.READ_DATAAREA=function(){return!1},$B._getVertexDeclaration=function(){for(var $B,$_=!1,$Z=!1,$n=!1,$g=!1,$q=!1,$P=!1,$k=!1,$m=!1,$D=!1,$T=0;$T<this._shaderAttributes.length;$T+=8)switch(this._shaderAttributes[$T]){case"POSITION":$_=!0;break;case"NORMAL":$Z=!0;break;case"COLOR":$n=!0;break;case"UV":$g=!0;break;case"UV1":$q=!0;break;case"BLENDWEIGHT":$k=!0;break;case"BLENDINDICES":$m=!0;break;case"TANGENT":$P=!0;break;case"BINORMAL":$D=!0}return $_&&$Z&&$n&&$g&&$q&&$k&&$m&&$P?$B=$CB.vertexDeclaration:$_&&$Z&&$n&&$g&&$q&&$k&&$m?$B=$jB.vertexDeclaration:$_&&$Z&&$g&&$q&&$k&&$m&&$P?$B=$uB.vertexDeclaration:$_&&$Z&&$g&&$q&&$k&&$m?$B=$oB.vertexDeclaration:$_&&$Z&&$n&&$g&&$k&&$m&&$P?$B=$QB.vertexDeclaration:$_&&$Z&&$n&&$g&&$k&&$m?$B=$JB.vertexDeclaration:$_&&$Z&&$P&&$D&&$g&&$k&&$m?$B=$RB.vertexDeclaration:$_&&$Z&&$g&&$k&&$m&&$P?$B=$KB.vertexDeclaration:$_&&$Z&&$g&&$k&&$m?$B=$xB.vertexDeclaration:$_&&$Z&&$n&&$k&&$m&&$P?$B=$IB.vertexDeclaration:$_&&$Z&&$n&&$k&&$m?$B=$TB.vertexDeclaration:$_&&$Z&&$n&&$g&&$q&&$P?$B=$tB.vertexDeclaration:$_&&$Z&&$n&&$g&&$q?$B=$rB.vertexDeclaration:$_&&$Z&&$g&&$q&&$P?$B=$bB.vertexDeclaration:$_&&$Z&&$g&&$q?$B=$VB.vertexDeclaration:$_&&$Z&&$n&&$g&&$P?$B=$YB.vertexDeclaration:$_&&$Z&&$g&&$P&&$D?$B=$WB.vertexDeclaration:$_&&$Z&&$n&&$g?$B=$wB.vertexDeclaration:$_&&$Z&&$g&&$P?$B=$GB.vertexDeclaration:$_&&$Z&&$g?$B=$vB.vertexDeclaration:$_&&$Z&&$n&&$P?$B=$$B.vertexDeclaration:$_&&$Z&&$n&&($B=$DB.vertexDeclaration),$B},$$(0,$B,"mesh",function(){return this._mesh}),$C._attrReg=new RegExp("(\\w+)|([:,;])","g"),$C}()),$UB=function(){function $N(){}return $A($N,"laya.d3.loaders.LoadModelV02"),$N.parse=function($B,$_,$Z,$n,$g,$q){$N._mesh=$Z,$N._materials=$n,$N._subMeshes=$g,$N._materialMap=$q,$N._version=$_,$N._readData=$B,$N.READ_DATA(),$N.READ_BLOCK(),$N.READ_STRINGS();for(var $P=0,$k=$N._BLOCK.count;$P<$k;$P++){$N._readData.pos=$N._BLOCK.blockStarts[$P];var $m=$N._readData.getUint16(),$D=$N._strings[$m],$T=$N["READ_"+$D];if(null==$T)throw new Error("model file err,no this function:"+$m+" "+$D);$T.call()}$N._strings.length=0,$N._readData=null,$N._version=null,$N._mesh=null,$N._materials=null,$N._subMeshes=null,$N._materialMap=null},$N._readString=function(){return $N._strings[$N._readData.getUint16()]},$N.READ_DATA=function(){$N._DATA.offset=$N._readData.getUint32(),$N._DATA.size=$N._readData.getUint32()},$N.READ_BLOCK=function(){for(var $B=$N._BLOCK.count=$N._readData.getUint16(),$_=$N._BLOCK.blockStarts=[],$Z=$N._BLOCK.blockLengths=[],$n=0;$n<$B;$n++)$_.push($N._readData.getUint32()),$Z.push($N._readData.getUint32())},$N.READ_STRINGS=function(){var $B=$N._readData.getUint32(),$_=$N._readData.getUint16(),$Z=$N._readData.pos;$N._readData.pos=$B+$N._DATA.offset;for(var $n=0;$n<$_;$n++)$N._strings[$n]=$N._readData.readUTFString();$N._readData.pos=$Z},$N.READ_MATERIAL=function(){$N._readString(),$N._readString();var $B=$N._readString();return""!==$B&&$N._materials.push($j.getRes($N._materialMap[$B])),!0},$N.READ_MESH=function(){$N._readString();var $B,$_=$N._readData.__getBuffer(),$Z=0,$n=$N._readData.getInt16(),$g=$N._DATA.offset;for($Z=0;$Z<$n;$Z++){var $q=$g+$N._readData.getUint32(),$P=$N._readData.getUint32(),$k=new Float32Array($_.slice($q,$q+$P)),$m=$N._readString().match($N._attrReg),$D=$N._getVertexDeclaration($m),$T=$K_.create($D,4*$k.length/$D.vertexStride,35044,!0);$T.setData($k),$N._mesh._vertexBuffers.push($T)}var $e=$g+$N._readData.getUint32(),$I=$N._readData.getUint32(),$A=new Uint16Array($_.slice($e,$e+$I)),$$=$p_.create("ushort",$I/2,35044,!0);$$.setData($A),$N._mesh._indexBuffer=$$;var $w=$N._mesh._boneNames=[],$r=$N._readData.getUint16();for($w.length=$r,$Z=0;$Z<$r;$Z++)$w[$Z]=$N._strings[$N._readData.getUint16()];var $j=$N._readData.getUint32(),$y=$N._readData.getUint32(),$C=(new Float32Array($_.slice($g+$j,$g+$j+$y)),$N._readData.getUint32()),$z=$N._readData.getUint32(),$t=new Float32Array($_.slice($g+$C,$g+$C+$z));for($N._mesh._inverseBindPoses=[],$Z=0,$B=$t.length;$Z<$B;$Z+=16){var $J=new $B_($t[$Z+0],$t[$Z+1],$t[$Z+2],$t[$Z+3],$t[$Z+4],$t[$Z+5],$t[$Z+6],$t[$Z+7],$t[$Z+8],$t[$Z+9],$t[$Z+10],$t[$Z+11],$t[$Z+12],$t[$Z+13],$t[$Z+14],$t[$Z+15]);$N._mesh._inverseBindPoses.push($J)}return $N._mesh._skinnedDatas=new Float32Array(16*$t.length),!0},$N.READ_SUBMESH=function(){var $B=$N._readData.__getBuffer(),$_=new $D_($N._mesh),$Z=$N._readData.getInt16(),$n=$N._readData.getUint32(),$g=$N._readData.getUint32();$_._vertexBuffer=$N._mesh._vertexBuffers[$Z],$_._vertexStart=$n,$_._vertexCount=$g;var $q=$N._readData.getUint32(),$P=$N._readData.getUint32(),$k=$N._mesh._indexBuffer;$_._indexBuffer=$k,$_._indexStart=$q,$_._indexCount=$P,$_._indices=new Uint16Array($k.getData().buffer,2*$q,$P);var $m=$N._DATA.offset,$D=$_._subIndexBufferStart,$T=$_._subIndexBufferCount,$e=$_._boneIndicesList,$I=$N._readData.getUint16();$D.length=$I,$T.length=$I,$e.length=$I;for(var $A=0;$A<$I;$A++){$D[$A]=$N._readData.getUint32(),$T[$A]=$N._readData.getUint32();var $$=$N._readData.getUint32(),$w=$N._readData.getUint32();$_._boneIndicesList[$A]=new Uint8Array($B.slice($m+$$,$m+$$+$w))}return $N._subMeshes.push($_),!0},$N._getVertexDeclaration=function($B){for(var $_,$Z=!1,$n=!1,$g=!1,$q=!1,$P=!1,$k=!1,$m=!1,$D=!1,$T=!1,$e=0;$e<$B.length;$e++)switch($B[$e]){case"POSITION":$Z=!0;break;case"NORMAL":$n=!0;break;case"COLOR":$g=!0;break;case"UV":$q=!0;break;case"UV1":$P=!0;break;case"BLENDWEIGHT":$m=!0;break;case"BLENDINDICES":$D=!0;break;case"TANGENT":$k=!0;break;case"BINORMAL":$T=!0}return $Z&&$n&&$g&&$q&&$P&&$m&&$D&&$k?$_=$CB.vertexDeclaration:$Z&&$n&&$g&&$q&&$P&&$m&&$D?$_=$jB.vertexDeclaration:$Z&&$n&&$q&&$P&&$m&&$D&&$k?$_=$uB.vertexDeclaration:$Z&&$n&&$q&&$P&&$m&&$D?$_=$oB.vertexDeclaration:$Z&&$n&&$g&&$q&&$m&&$D&&$k?$_=$QB.vertexDeclaration:$Z&&$n&&$g&&$q&&$m&&$D?$_=$JB.vertexDeclaration:$Z&&$n&&$q&&$m&&$D&&$k?$_=$KB.vertexDeclaration:$Z&&$n&&$q&&$m&&$D?$_=$xB.vertexDeclaration:$Z&&$n&&$g&&$m&&$D&&$k?$_=$IB.vertexDeclaration:$Z&&$n&&$g&&$m&&$D?$_=$TB.vertexDeclaration:$Z&&$n&&$g&&$q&&$P&&$k?$_=$tB.vertexDeclaration:$Z&&$n&&$g&&$q&&$P?$_=$rB.vertexDeclaration:$Z&&$n&&$q&&$P&&$k?$_=$bB.vertexDeclaration:$Z&&$n&&$q&&$P?$_=$VB.vertexDeclaration:$Z&&$n&&$g&&$q&&$k?$_=$YB.vertexDeclaration:$Z&&$n&&$q&&$k&&$T?$_=$WB.vertexDeclaration:$Z&&$n&&$g&&$q?$_=$wB.vertexDeclaration:$Z&&$n&&$q&&$k?$_=$GB.vertexDeclaration:$Z&&$n&&$q?$_=$vB.vertexDeclaration:$Z&&$n&&$g&&$k?$_=$$B.vertexDeclaration:$Z&&$n&&$g&&($_=$DB.vertexDeclaration),$_},$N._attrReg=new RegExp("(\\w+)|([:,;])","g"),$N._strings=[],$N._readData=null,$N._version=null,$N._mesh=null,$N._materials=null,$N._subMeshes=null,$N._materialMap=null,$e($N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$N}(),$SB=function(){function $J(){}return $A($J,"laya.d3.loaders.LoadModelV03"),$J.parse=function($B,$_,$Z,$n,$g){$J._mesh=$Z,$J._subMeshes=$n,$J._materialMap=$g,$J._version=$_,$J._readData=$B,$J.READ_DATA(),$J.READ_BLOCK(),$J.READ_STRINGS();for(var $q=0,$P=$J._BLOCK.count;$q<$P;$q++){$J._readData.pos=$J._BLOCK.blockStarts[$q];var $k=$J._readData.getUint16(),$m=$J._strings[$k],$D=$J["READ_"+$m];if(null==$D)throw new Error("model file err,no this function:"+$k+" "+$m);$D.call()}$J._strings.length=0,$J._readData=null,$J._version=null,$J._mesh=null,$J._subMeshes=null,$J._materialMap=null},$J._readString=function(){return $J._strings[$J._readData.getUint16()]},$J.READ_DATA=function(){$J._DATA.offset=$J._readData.getUint32(),$J._DATA.size=$J._readData.getUint32()},$J.READ_BLOCK=function(){for(var $B=$J._BLOCK.count=$J._readData.getUint16(),$_=$J._BLOCK.blockStarts=[],$Z=$J._BLOCK.blockLengths=[],$n=0;$n<$B;$n++)$_.push($J._readData.getUint32()),$Z.push($J._readData.getUint32())},$J.READ_STRINGS=function(){var $B=$J._readData.getUint32(),$_=$J._readData.getUint16(),$Z=$J._readData.pos;$J._readData.pos=$B+$J._DATA.offset;for(var $n=0;$n<$_;$n++)$J._strings[$n]=$J._readData.readUTFString();$J._readData.pos=$Z},$J.READ_MESH=function(){var $B,$_=$J._readString(),$Z=$J._readData.__getBuffer(),$n=0,$g=$J._readData.getInt16(),$q=$J._DATA.offset;for($n=0;$n<$g;$n++){var $P,$k=$q+$J._readData.getUint32(),$m=$J._readData.getUint32(),$D=new Float32Array($Z.slice($k,$k+$m)),$T=$J._readString();switch($J._version){case"LAYAMODEL:03":$P=$J._vertexDeclarationMap_Discard[$T];break;case"LAYAMODEL:0301":$P=$J._vertexDeclarationMap[$T];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$P)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$J._version+"  bufferAttribute="+$T+"  name="+$_+"  url="+($J._mesh?$J._mesh.url:"null"));var $e=$K_.create($P,4*$D.length/$P.vertexStride,35044,!0,$J._mesh._url+"_"+$n);$e.setData($D),$J._mesh._vertexBuffers.push($e)}var $I=$q+$J._readData.getUint32(),$A=$J._readData.getUint32(),$$=new Uint16Array($Z.slice($I,$I+$A)),$w=$p_.create("ushort",$A/2,35044,!0,$J._mesh._url);$w.setData($$),$J._mesh._indexBuffer=$w;var $r=$J._mesh._boneNames=[],$j=$J._readData.getUint16();for($r.length=$j,$n=0;$n<$j;$n++)$r[$n]=$J._strings[$J._readData.getUint16()];$J._readData.pos+=8;var $y=$J._readData.getUint32(),$C=$J._readData.getUint32(),$z=new Float32Array($Z.slice($q+$y,$q+$y+$C));for($J._mesh._inverseBindPoses=[],$n=0,$B=$z.length;$n<$B;$n+=16){var $t=new $B_($z[$n+0],$z[$n+1],$z[$n+2],$z[$n+3],$z[$n+4],$z[$n+5],$z[$n+6],$z[$n+7],$z[$n+8],$z[$n+9],$z[$n+10],$z[$n+11],$z[$n+12],$z[$n+13],$z[$n+14],$z[$n+15]);$J._mesh._inverseBindPoses.push($t)}return $J._mesh._skinnedDatas=new Float32Array(16*$z.length),!0},$J.READ_SUBMESH=function(){var $B=$J._readData.__getBuffer(),$_=new $D_($J._mesh),$Z=$J._readData.getInt16(),$n=$J._readData.getUint32(),$g=$J._readData.getUint32();$_._vertexBuffer=$J._mesh._vertexBuffers[$Z],$_._vertexStart=$n,$_._vertexCount=$g;var $q=$J._readData.getUint32(),$P=$J._readData.getUint32(),$k=$J._mesh._indexBuffer;$_._indexBuffer=$k,$_._indexStart=$q,$_._indexCount=$P,$_._indices=new Uint16Array($k.getData().buffer,2*$q,$P);var $m=$J._DATA.offset,$D=$_._subIndexBufferStart,$T=$_._subIndexBufferCount,$e=$_._boneIndicesList,$I=$J._readData.getUint16();$D.length=$I,$T.length=$I,$e.length=$I;for(var $A=0;$A<$I;$A++){$D[$A]=$J._readData.getUint32(),$T[$A]=$J._readData.getUint32();var $$=$J._readData.getUint32(),$w=$J._readData.getUint32();$e[$A]=new Uint8Array($B.slice($m+$$,$m+$$+$w))}return $J._subMeshes.push($_),!0},$J._strings=[],$J._readData=null,$J._version=null,$J._mesh=null,$J._subMeshes=null,$J._materialMap=null,$e($J,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$CB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$jB.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$XB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$uB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$oB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$QB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$JB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$KB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$xB.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$IB.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$TB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$tB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$rB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$bB.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$VB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$YB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$WB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$wB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$GB.vertexDeclaration,"POSITION,NORMAL,UV":$vB.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$$B.vertexDeclaration,"POSITION,NORMAL,COLOR":$DB.vertexDeclaration,"POSITION,NORMAL,TANGENT":$LB.vertexDeclaration,"POSITION,NORMAL":$mB.vertexDeclaration,"POSITION,UV":$hB.vertexDeclaration,POSITION:$kB.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$yB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$jB.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$XB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$FB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$oB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$NB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$JB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$pB.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$xB.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$eB.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$TB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$zB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$rB.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$fB.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$VB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$MB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$WB.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$wB.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$HB.vertexDeclaration,"POSITION,NORMAL,UV":$vB.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$AB.vertexDeclaration,"POSITION,NORMAL,COLOR":$DB.vertexDeclaration,"POSITION,NORMAL,TANGENT":$lB.vertexDeclaration,"POSITION,NORMAL":$mB.vertexDeclaration,"POSITION,UV":$hB.vertexDeclaration,POSITION:$kB.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$J}(),$OB=function(){function $k(){}return $A($k,"laya.d3.loaders.MeshReader"),$k.read=function($B,$_,$Z,$n,$g){var $q=new $J($B);$q.pos=0;var $P=$q.readUTFString();switch($P){case"LAYAMODEL:01":case"LAYASKINANI:01":$k._readVersion01($q,$P,$_,$Z,$n,$g);break;case"LAYAMODEL:02":$UB.parse($q,$P,$_,$Z,$n,$g);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$SB.parse($q,$P,$_,$n,$g);break;default:throw new Error("MeshReader: unknown mesh version.")}$_._setSubMeshes($n)},$k._readVersion01=function($B,$_,$Z,$n,$g,$q){new $sB($B,$_,$Z,$n,$g,$q)},$k}(),$dB=function(){function $B($B,$_){this.min=null,this.max=null,this.min=$B,this.max=$_}$A($B,"laya.d3.math.BoundBox");var $_=$B.prototype;return $t.imps($_,{"laya.d3.core.IClone":!0}),$_.getCorners=function($B){$B.length=8;var $_=this.min.elements,$Z=this.max.elements,$n=$_[0],$g=$_[1],$q=$_[2],$P=$Z[0],$k=$Z[1],$m=$Z[2];$B[0]=new $P_($n,$k,$m),$B[1]=new $P_($P,$k,$m),$B[2]=new $P_($P,$g,$m),$B[3]=new $P_($n,$g,$m),$B[4]=new $P_($n,$k,$q),$B[5]=new $P_($P,$k,$q),$B[6]=new $P_($P,$g,$q),$B[7]=new $P_($n,$g,$q)},$_.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$_.cloneTo=function($B){var $_=$B;this.min.cloneTo($_.min),this.max.cloneTo($_.max)},$_.clone=function(){var $B=new this.constructor(new $P_,new $P_);return this.cloneTo($B),$B},$B.createfromPoints=function($B,$_){if(null==$B)throw new Error("points");var $Z=$_.min,$n=$_.max,$g=$Z.elements;$g[0]=Number.MAX_VALUE,$g[1]=Number.MAX_VALUE,$g[2]=Number.MAX_VALUE;var $q=$n.elements;$q[0]=-Number.MAX_VALUE,$q[1]=-Number.MAX_VALUE,$q[2]=-Number.MAX_VALUE;for(var $P=0,$k=$B.length;$P<$k;++$P)$P_.min($Z,$B[$P],$Z),$P_.max($n,$B[$P],$n)},$B.merge=function($B,$_,$Z){$P_.min($B.min,$_.min,$Z.min),$P_.max($B.max,$_.max,$Z.max)},$B}(),$aB=function(){function $D($B){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$B,this._near=new $__(new $P_),this._far=new $__(new $P_),this._left=new $__(new $P_),this._right=new $__(new $P_),this._top=new $__(new $P_),this._bottom=new $__(new $P_),$D._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$A($D,"laya.d3.math.BoundFrustum");var $B=$D.prototype;return $B.equalsBoundFrustum=function($B){return this._matrix.equalsOtherMatrix($B.matrix)},$B.equalsObj=function($B){if($B instanceof laya.d3.math.BoundFrustum){var $_=$B;return this.equalsBoundFrustum($_)}return!1},$B.getPlane=function($B){switch($B){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$B.getCorners=function($B){$D._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($B[0]),$D._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($B[1]),$D._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($B[2]),$D._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($B[3]),$D._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($B[4]),$D._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($B[5]),$D._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($B[6]),$D._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($B[7])},$B.containsPoint=function($B){for(var $_=$__.PlaneIntersectionType_Front,$Z=$__.PlaneIntersectionType_Front,$n=0;$n<6;$n++){switch($n){case 0:$Z=Collision.intersectsPlaneAndPoint(this._near,$B);break;case 1:$Z=Collision.intersectsPlaneAndPoint(this._far,$B);break;case 2:$Z=Collision.intersectsPlaneAndPoint(this._left,$B);break;case 3:$Z=Collision.intersectsPlaneAndPoint(this._right,$B);break;case 4:$Z=Collision.intersectsPlaneAndPoint(this._top,$B);break;case 5:$Z=Collision.intersectsPlaneAndPoint(this._bottom,$B)}switch($Z){case $__.PlaneIntersectionType_Back:return 0;case $__.PlaneIntersectionType_Intersecting:$_=$__.PlaneIntersectionType_Intersecting}}switch($_){case $__.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$B.containsBoundBox=function($B){for(var $_,$Z=$D._tempV30,$n=$D._tempV31,$g=1,$q=0;$q<6;$q++){if($_=this.getPlane($q),this._getBoxToPlanePVertexNVertex($B,$_.normal,$Z,$n),Collision.intersectsPlaneAndPoint($_,$Z)===$__.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($_,$n)===$__.PlaneIntersectionType_Back&&($g=2)}return $g},$B.containsBoundSphere=function($B){for(var $_=$__.PlaneIntersectionType_Front,$Z=$__.PlaneIntersectionType_Front,$n=0;$n<6;$n++){switch($n){case 0:$Z=Collision.intersectsPlaneAndSphere(this._near,$B);break;case 1:$Z=Collision.intersectsPlaneAndSphere(this._far,$B);break;case 2:$Z=Collision.intersectsPlaneAndSphere(this._left,$B);break;case 3:$Z=Collision.intersectsPlaneAndSphere(this._right,$B);break;case 4:$Z=Collision.intersectsPlaneAndSphere(this._top,$B);break;case 5:$Z=Collision.intersectsPlaneAndSphere(this._bottom,$B)}switch($Z){case $__.PlaneIntersectionType_Back:return 0;case $__.PlaneIntersectionType_Intersecting:$_=$__.PlaneIntersectionType_Intersecting}}switch($_){case $__.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$B._getBoxToPlanePVertexNVertex=function($B,$_,$Z,$n){var $g=$B.min,$q=$g.elements,$P=$B.max,$k=$P.elements,$m=$_.elements,$D=$m[0],$T=$m[1],$e=$m[2];$g.cloneTo($Z);var $I=$Z.elements;0<=$D&&($I[0]=$k[0]),0<=$T&&($I[1]=$k[1]),0<=$e&&($I[2]=$k[2]),$P.cloneTo($n);var $A=$n.elements;0<=$D&&($A[0]=$q[0]),0<=$T&&($A[1]=$q[1]),0<=$e&&($A[2]=$q[2])},$$(0,$B,"top",function(){return this._top}),$$(0,$B,"matrix",function(){return this._matrix},function($B){this._matrix=$B,$D._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$$(0,$B,"near",function(){return this._near}),$$(0,$B,"far",function(){return this._far}),$$(0,$B,"left",function(){return this._left}),$$(0,$B,"right",function(){return this._right}),$$(0,$B,"bottom",function(){return this._bottom}),$D._getPlanesFromMatrix=function($B,$_,$Z,$n,$g,$q,$P){var $k=$B.elements,$m=$k[0],$D=$k[1],$T=$k[2],$e=$k[3],$I=$k[4],$A=$k[5],$$=$k[6],$w=$k[7],$r=$k[8],$j=$k[9],$y=$k[10],$C=$k[11],$z=$k[12],$t=$k[13],$J=$k[14],$N=$k[15],$Q=$_.normal.elements;$Q[0]=$e+$T,$Q[1]=$w+$$,$Q[2]=$C+$y,$_.distance=$N+$J,$_.normalize();var $M=$Z.normal.elements;$M[0]=$e-$T,$M[1]=$w-$$,$M[2]=$C-$y,$Z.distance=$N-$J,$Z.normalize();var $Y=$n.normal.elements;$Y[0]=$e+$m,$Y[1]=$w+$I,$Y[2]=$C+$r,$n.distance=$N+$z,$n.normalize();var $l=$g.normal.elements;$l[0]=$e-$m,$l[1]=$w-$I,$l[2]=$C-$r,$g.distance=$N-$z,$g.normalize();var $L=$q.normal.elements;$L[0]=$e-$D,$L[1]=$w-$A,$L[2]=$C-$j,$q.distance=$N-$t,$q.normalize();var $v=$P.normal.elements;$v[0]=$e+$D,$v[1]=$w+$A,$v[2]=$C+$j,$P.distance=$N+$t,$P.normalize()},$D._get3PlaneInterPoint=function($B,$_,$Z){var $n=$B.normal,$g=$_.normal,$q=$Z.normal;$P_.cross($g,$q,$D._tempV30),$P_.cross($q,$n,$D._tempV31),$P_.cross($n,$g,$D._tempV32);var $P=$P_.dot($n,$D._tempV30),$k=$P_.dot($g,$D._tempV31),$m=$P_.dot($q,$D._tempV32);return $P_.scale($D._tempV30,-$B.distance/$P,$D._tempV33),$P_.scale($D._tempV31,-$_.distance/$k,$D._tempV34),$P_.scale($D._tempV32,-$Z.distance/$m,$D._tempV35),$P_.add($D._tempV33,$D._tempV34,$D._tempV36),$P_.add($D._tempV35,$D._tempV36,$D._tempV37),$D._tempV37},$e($D,["_tempV30",function(){return this._tempV30=new $P_},"_tempV31",function(){return this._tempV31=new $P_},"_tempV32",function(){return this._tempV32=new $P_},"_tempV33",function(){return this._tempV33=new $P_},"_tempV34",function(){return this._tempV34=new $P_},"_tempV35",function(){return this._tempV35=new $P_},"_tempV36",function(){return this._tempV36=new $P_},"_tempV37",function(){return this._tempV37=new $P_}]),$D}(),$iB=function(){function $T($B,$_){this.center=null,this.radius=NaN,this.center=$B,this.radius=$_}$A($T,"laya.d3.math.BoundSphere");var $B=$T.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.toDefault=function(){this.center.toDefault(),this.radius=0},$B.intersectsRayDistance=function($B){return Collision.intersectsRayAndSphereRD($B,this)},$B.intersectsRayPoint=function($B,$_){return Collision.intersectsRayAndSphereRP($B,this,$_)},$B.cloneTo=function($B){var $_=$B;this.center.cloneTo($_.center),$_.radius=this.radius},$B.clone=function(){var $B=new this.constructor(new $P_,new $P_);return this.cloneTo($B),$B},$T.createFromSubPoints=function($B,$_,$Z,$n){if(null==$B)throw new Error("points");if($_<0||$_>=$B.length)throw new Error("start"+$_+"Must be in the range [0, "+($B.length-1)+"]");if($Z<0||$_+$Z>$B.length)throw new Error("count"+$Z+"Must be in the range <= "+$B.length+"}");var $g=$_+$Z,$q=$T._tempVector3;$q.elements[0]=0,$q.elements[1]=0,$q.elements[2]=0;for(var $P=$_;$P<$g;++$P)$P_.add($B[$P],$q,$q);var $k=$n.center;$P_.scale($q,1/$Z,$k);var $m=0;for($P=$_;$P<$g;++$P){var $D=$P_.distanceSquared($k,$B[$P]);$m<$D&&($m=$D)}$n.radius=Math.sqrt($m)},$T.createfromPoints=function($B,$_){if(null==$B)throw new Error("points");$T.createFromSubPoints($B,0,$B.length,$_)},$e($T,["_tempVector3",function(){return this._tempVector3=new $P_}]),$T}(),$cB=(function(){function $B(){}$A($B,"laya.d3.math.ContainmentType"),$B.Disjoint=0,$B.Contains=1,$B.Intersects=2}(),function(){function $Z(){}return $A($Z,"laya.d3.math.MathUtils3D"),$Z.isZero=function($B){return Math.abs($B)<$Z.zeroTolerance},$Z.nearEqual=function($B,$_){return!!$Z.isZero($B-$_)},$Z.fastInvSqrt=function($B){return $Z.isZero($B)?$B:1/Math.sqrt($B)},$e($Z,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$Z}()),$EB=function(){function $m(){var $B=this.elements=new Float32Array(9);$B[0]=1,$B[1]=0,$B[2]=0,$B[3]=0,$B[4]=1,$B[5]=0,$B[6]=0,$B[7]=0,$B[8]=1}$A($m,"laya.d3.math.Matrix3x3");var $B=$m.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.determinant=function(){var $B=this.elements,$_=$B[0],$Z=$B[1],$n=$B[2],$g=$B[3],$q=$B[4],$P=$B[5],$k=$B[6],$m=$B[7],$D=$B[8];return $_*($D*$q-$P*$m)+$Z*(-$D*$g+$P*$k)+$n*($m*$g-$q*$k)},$B.translate=function($B,$_){var $Z=$_.elements,$n=this.elements,$g=$B.elements,$q=$n[0],$P=$n[1],$k=$n[2],$m=$n[3],$D=$n[4],$T=$n[5],$e=$n[6],$I=$n[7],$A=$n[8],$$=$g[0],$w=$g[1];$Z[0]=$q,$Z[1]=$P,$Z[2]=$k,$Z[3]=$m,$Z[4]=$D,$Z[5]=$T,$Z[6]=$$*$q+$w*$m+$e,$Z[7]=$$*$P+$w*$D+$I,$Z[8]=$$*$k+$w*$T+$A},$B.rotate=function($B,$_){var $Z=$_.elements,$n=this.elements,$g=$n[0],$q=$n[1],$P=$n[2],$k=$n[3],$m=$n[4],$D=$n[5],$T=$n[6],$e=$n[7],$I=$n[8],$A=Math.sin($B),$$=Math.cos($B);$Z[0]=$$*$g+$A*$k,$Z[1]=$$*$q+$A*$m,$Z[2]=$$*$P+$A*$D,$Z[3]=$$*$k-$A*$g,$Z[4]=$$*$m-$A*$q,$Z[5]=$$*$D-$A*$P,$Z[6]=$T,$Z[7]=$e,$Z[8]=$I},$B.scale=function($B,$_){var $Z=$_.elements,$n=this.elements,$g=$B.elements,$q=$g[0],$P=$g[1];$Z[0]=$q*$n[0],$Z[1]=$q*$n[1],$Z[2]=$q*$n[2],$Z[3]=$P*$n[3],$Z[4]=$P*$n[4],$Z[5]=$P*$n[5],$Z[6]=$n[6],$Z[7]=$n[7],$Z[8]=$n[8]},$B.invert=function($B){var $_=$B.elements,$Z=this.elements,$n=$Z[0],$g=$Z[1],$q=$Z[2],$P=$Z[3],$k=$Z[4],$m=$Z[5],$D=$Z[6],$T=$Z[7],$e=$Z[8],$I=$e*$k-$m*$T,$A=-$e*$P+$m*$D,$$=$T*$P-$k*$D,$w=$n*$I+$g*$A+$q*$$;$w||($B=null),$w=1/$w,$_[0]=$I*$w,$_[1]=(-$e*$g+$q*$T)*$w,$_[2]=($m*$g-$q*$k)*$w,$_[3]=$A*$w,$_[4]=($e*$n-$q*$D)*$w,$_[5]=(-$m*$n+$q*$P)*$w,$_[6]=$$*$w,$_[7]=(-$T*$n+$g*$D)*$w,$_[8]=($k*$n-$g*$P)*$w},$B.transpose=function($B){var $_=$B.elements,$Z=this.elements;if($B===this){var $n=$Z[1],$g=$Z[2],$q=$Z[5];$_[1]=$Z[3],$_[2]=$Z[6],$_[3]=$n,$_[5]=$Z[7],$_[6]=$g,$_[7]=$q}else $_[0]=$Z[0],$_[1]=$Z[3],$_[2]=$Z[6],$_[3]=$Z[1],$_[4]=$Z[4],$_[5]=$Z[7],$_[6]=$Z[2],$_[7]=$Z[5],$_[8]=$Z[8]},$B.identity=function(){var $B=this.elements;$B[0]=1,$B[1]=0,$B[2]=0,$B[3]=0,$B[4]=1,$B[5]=0,$B[6]=0,$B[7]=0,$B[8]=1},$B.cloneTo=function($B){var $_,$Z,$n;if(($Z=this.elements)!==($n=$B.elements))for($_=0;$_<9;++$_)$n[$_]=$Z[$_]},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$m.createFromTranslation=function($B,$_){$_.elements;var $Z=$B.elements;$_[0]=1,$_[1]=0,$_[2]=0,$_[3]=0,$_[4]=1,$_[5]=0,$_[6]=$Z[0],$_[7]=$Z[1],$_[8]=1},$m.createFromRotation=function($B,$_){var $Z=$_.elements,$n=Math.sin($B),$g=Math.cos($B);$Z[0]=$g,$Z[1]=$n,$Z[2]=0,$Z[3]=-$n,$Z[4]=$g,$Z[5]=0,$Z[6]=0,$Z[7]=0,$Z[8]=1},$m.createFromScaling=function($B,$_){var $Z=$_.elements,$n=$B.elements;$Z[0]=$n[0],$Z[1]=0,$Z[2]=0,$Z[3]=0,$Z[4]=$n[1],$Z[5]=0,$Z[6]=0,$Z[7]=0,$Z[8]=1},$m.createFromMatrix4x4=function($B,$_){$_[0]=$B[0],$_[1]=$B[1],$_[2]=$B[2],$_[3]=$B[4],$_[4]=$B[5],$_[5]=$B[6],$_[6]=$B[8],$_[7]=$B[9],$_[8]=$B[10]},$m.multiply=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements,$P=$g[0],$k=$g[1],$m=$g[2],$D=$g[3],$T=$g[4],$e=$g[5],$I=$g[6],$A=$g[7],$$=$g[8],$w=$q[0],$r=$q[1],$j=$q[2],$y=$q[3],$C=$q[4],$z=$q[5],$t=$q[6],$J=$q[7],$N=$q[8];$n[0]=$w*$P+$r*$D+$j*$I,$n[1]=$w*$k+$r*$T+$j*$A,$n[2]=$w*$m+$r*$e+$j*$$,$n[3]=$y*$P+$C*$D+$z*$I,$n[4]=$y*$k+$C*$T+$z*$A,$n[5]=$y*$m+$C*$e+$z*$$,$n[6]=$t*$P+$J*$D+$N*$I,$n[7]=$t*$k+$J*$T+$N*$A,$n[8]=$t*$m+$J*$e+$N*$$},$m.lookAt=function($B,$_,$Z,$n){$P_.subtract($B,$_,$m._tempV30),$P_.normalize($m._tempV30,$m._tempV30),$P_.cross($Z,$m._tempV30,$m._tempV31),$P_.normalize($m._tempV31,$m._tempV31),$P_.cross($m._tempV30,$m._tempV31,$m._tempV32);var $g=$m._tempV30.elements,$q=$m._tempV31.elements,$P=$m._tempV32.elements,$k=$n.elements;$k[0]=$q[0],$k[3]=$q[1],$k[6]=$q[2],$k[1]=$P[0],$k[4]=$P[1],$k[7]=$P[2],$k[2]=$g[0],$k[5]=$g[1],$k[8]=$g[2]},$m.DEFAULT=new $m,$e($m,["_tempV30",function(){return this._tempV30=new $P_},"_tempV31",function(){return this._tempV31=new $P_},"_tempV32",function(){return this._tempV32=new $P_}]),$m}(),$B_=function(){function $M($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e,$I,$A,$$,$w){void 0===$B&&($B=1),void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$q&&($q=1),void 0===$P&&($P=0),void 0===$k&&($k=0),void 0===$m&&($m=0),void 0===$D&&($D=0),void 0===$T&&($T=1),void 0===$e&&($e=0),void 0===$I&&($I=0),void 0===$A&&($A=0),void 0===$$&&($$=0),void 0===$w&&($w=1);var $r=this.elements=new Float32Array(16);$r[0]=$B,$r[1]=$_,$r[2]=$Z,$r[3]=$n,$r[4]=$g,$r[5]=$q,$r[6]=$P,$r[7]=$k,$r[8]=$m,$r[9]=$D,$r[10]=$T,$r[11]=$e,$r[12]=$I,$r[13]=$A,$r[14]=$$,$r[15]=$w}$A($M,"laya.d3.math.Matrix4x4");var $B=$M.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.getElementByRowColumn=function($B,$_){if($B<0||3<$B)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($_<0||3<$_)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$B+$_]},$B.setElementByRowColumn=function($B,$_,$Z){if($B<0||3<$B)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($_<0||3<$_)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$B+$_]=$Z},$B.equalsOtherMatrix=function($B){var $_=this.elements,$Z=$B.elements;return $cB.nearEqual($_[0],$Z[0])&&$cB.nearEqual($_[1],$Z[1])&&$cB.nearEqual($_[2],$Z[2])&&$cB.nearEqual($_[3],$Z[3])&&$cB.nearEqual($_[4],$Z[4])&&$cB.nearEqual($_[5],$Z[5])&&$cB.nearEqual($_[6],$Z[6])&&$cB.nearEqual($_[7],$Z[7])&&$cB.nearEqual($_[8],$Z[8])&&$cB.nearEqual($_[9],$Z[9])&&$cB.nearEqual($_[10],$Z[10])&&$cB.nearEqual($_[11],$Z[11])&&$cB.nearEqual($_[12],$Z[12])&&$cB.nearEqual($_[13],$Z[13])&&$cB.nearEqual($_[14],$Z[14])&&$cB.nearEqual($_[15],$Z[15])},$B.decomposeTransRotScale=function($B,$_,$Z){var $n=$M._tempMatrix4x4;return this.decomposeTransRotMatScale($B,$n,$Z)?($Z_.createFromMatrix4x4($n,$_),!0):($_.identity(),!1)},$B.decomposeTransRotMatScale=function($B,$_,$Z){var $n=this.elements,$g=$B.elements,$q=$_.elements,$P=$Z.elements;$g[0]=$n[12],$g[1]=$n[13],$g[2]=$n[14];var $k=$n[0],$m=$n[1],$D=$n[2],$T=$n[4],$e=$n[5],$I=$n[6],$A=$n[8],$$=$n[9],$w=$n[10],$r=$P[0]=Math.sqrt($k*$k+$m*$m+$D*$D),$j=$P[1]=Math.sqrt($T*$T+$e*$e+$I*$I),$y=$P[2]=Math.sqrt($A*$A+$$*$$+$w*$w);if($cB.isZero($r)||$cB.isZero($j)||$cB.isZero($y))return $q[1]=$q[2]=$q[3]=$q[4]=$q[6]=$q[7]=$q[8]=$q[9]=$q[11]=$q[12]=$q[13]=$q[14]=0,$q[0]=$q[5]=$q[10]=$q[15]=1,!1;var $C=$M._tempVector0,$z=$C.elements;$z[0]=$A/$y,$z[1]=$$/$y,$z[2]=$w/$y;var $t=$M._tempVector1,$J=$t.elements;$J[0]=$k/$r,$J[1]=$m/$r,$J[2]=$D/$r;var $N=$M._tempVector2;$P_.cross($C,$t,$N);var $Q=$M._tempVector1;return $P_.cross($N,$C,$Q),$q[3]=$q[7]=$q[11]=$q[12]=$q[13]=$q[14]=0,$q[15]=1,$q[0]=$Q.x,$q[1]=$Q.y,$q[2]=$Q.z,$q[4]=$N.x,$q[5]=$N.y,$q[6]=$N.z,$q[8]=$C.x,$q[9]=$C.y,$q[10]=$C.z,$q[0]*$k+$q[1]*$m+$q[2]*$D<0&&($P[0]=-$r),$q[4]*$T+$q[5]*$e+$q[6]*$I<0&&($P[1]=-$j),$q[8]*$A+$q[9]*$$+$q[10]*$w<0&&($P[2]=-$y),!0},$B.decomposeYawPitchRoll=function($B){var $_=$B.elements,$Z=Math.asin(-this.elements[9]);$_[1]=$Z,Math.cos($Z)>$cB.zeroTolerance?($_[2]=Math.atan2(this.elements[1],this.elements[5]),$_[0]=Math.atan2(this.elements[8],this.elements[10])):($_[2]=Math.atan2(-this.elements[4],this.elements[0]),$_[0]=0)},$B.normalize=function(){var $B=this.elements,$_=$B[0],$Z=$B[1],$n=$B[2],$g=Math.sqrt($_*$_+$Z*$Z+$n*$n);if(!$g)return $B[0]=0,$B[1]=0,void($B[2]=0);1!=$g&&($g=1/$g,$B[0]=$_*$g,$B[1]=$Z*$g,$B[2]=$n*$g)},$B.transpose=function(){var $B,$_;return $_=($B=this.elements)[1],$B[1]=$B[4],$B[4]=$_,$_=$B[2],$B[2]=$B[8],$B[8]=$_,$_=$B[3],$B[3]=$B[12],$B[12]=$_,$_=$B[6],$B[6]=$B[9],$B[9]=$_,$_=$B[7],$B[7]=$B[13],$B[13]=$_,$_=$B[11],$B[11]=$B[14],$B[14]=$_,this},$B.invert=function($B){var $_=this.elements,$Z=$B.elements,$n=$_[0],$g=$_[1],$q=$_[2],$P=$_[3],$k=$_[4],$m=$_[5],$D=$_[6],$T=$_[7],$e=$_[8],$I=$_[9],$A=$_[10],$$=$_[11],$w=$_[12],$r=$_[13],$j=$_[14],$y=$_[15],$C=$n*$m-$g*$k,$z=$n*$D-$q*$k,$t=$n*$T-$P*$k,$J=$g*$D-$q*$m,$N=$g*$T-$P*$m,$Q=$q*$T-$P*$D,$M=$e*$r-$I*$w,$Y=$e*$j-$A*$w,$l=$e*$y-$$*$w,$L=$I*$j-$A*$r,$v=$I*$y-$$*$r,$V=$A*$y-$$*$j,$o=$C*$V-$z*$v+$t*$L+$J*$l-$N*$Y+$Q*$M;0!==Math.abs($o)&&($o=1/$o,$Z[0]=($m*$V-$D*$v+$T*$L)*$o,$Z[1]=($q*$v-$g*$V-$P*$L)*$o,$Z[2]=($r*$Q-$j*$N+$y*$J)*$o,$Z[3]=($A*$N-$I*$Q-$$*$J)*$o,$Z[4]=($D*$l-$k*$V-$T*$Y)*$o,$Z[5]=($n*$V-$q*$l+$P*$Y)*$o,$Z[6]=($j*$t-$w*$Q-$y*$z)*$o,$Z[7]=($e*$Q-$A*$t+$$*$z)*$o,$Z[8]=($k*$v-$m*$l+$T*$M)*$o,$Z[9]=($g*$l-$n*$v-$P*$M)*$o,$Z[10]=($w*$N-$r*$t+$y*$C)*$o,$Z[11]=($I*$t-$e*$N-$$*$C)*$o,$Z[12]=($m*$Y-$k*$L-$D*$M)*$o,$Z[13]=($n*$L-$g*$Y+$q*$M)*$o,$Z[14]=($r*$z-$w*$J-$j*$C)*$o,$Z[15]=($e*$J-$I*$z+$A*$C)*$o)},$B.identity=function(){var $B=this.elements;$B[1]=$B[2]=$B[3]=$B[4]=$B[6]=$B[7]=$B[8]=$B[9]=$B[11]=$B[12]=$B[13]=$B[14]=0,$B[0]=$B[5]=$B[10]=$B[15]=1},$B.cloneTo=function($B){var $_,$Z,$n;if(($Z=this.elements)!==($n=$B.elements))for($_=0;$_<16;++$_)$n[$_]=$Z[$_]},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$B.getTranslationVector=function($B){var $_=this.elements,$Z=$B.elements;$Z[0]=$_[12],$Z[1]=$_[13],$Z[2]=$_[14]},$B.setTranslationVector=function($B){var $_=this.elements,$Z=$B.elements;$_[12]=$Z[0],$_[13]=$Z[1],$_[14]=$Z[2]},$B.getForward=function($B){var $_=this.elements,$Z=$B.elements;$Z[0]=-$_[8],$Z[1]=-$_[9],$Z[2]=-$_[10]},$B.setForward=function($B){var $_=this.elements,$Z=$B.elements;$_[8]=-$Z[0],$_[9]=-$Z[1],$_[10]=-$Z[2]},$M.createRotationX=function($B,$_){var $Z=$_.elements,$n=Math.sin($B),$g=Math.cos($B);$Z[1]=$Z[2]=$Z[3]=$Z[4]=$Z[7]=$Z[8]=$Z[11]=$Z[12]=$Z[13]=$Z[14]=0,$Z[0]=$Z[15]=1,$Z[5]=$Z[10]=$g,$Z[6]=$n,$Z[9]=-$n},$M.createRotationY=function($B,$_){var $Z=$_.elements,$n=Math.sin($B),$g=Math.cos($B);$Z[1]=$Z[3]=$Z[4]=$Z[6]=$Z[7]=$Z[9]=$Z[11]=$Z[12]=$Z[13]=$Z[14]=0,$Z[5]=$Z[15]=1,$Z[0]=$Z[10]=$g,$Z[2]=-$n,$Z[8]=$n},$M.createRotationZ=function($B,$_){var $Z=$_.elements,$n=Math.sin($B),$g=Math.cos($B);$Z[2]=$Z[3]=$Z[6]=$Z[7]=$Z[8]=$Z[9]=$Z[11]=$Z[12]=$Z[13]=$Z[14]=0,$Z[10]=$Z[15]=1,$Z[0]=$Z[5]=$g,$Z[1]=$n,$Z[4]=-$n},$M.createRotationYawPitchRoll=function($B,$_,$Z,$n){$Z_.createFromYawPitchRoll($B,$_,$Z,$M._tempQuaternion),$M.createRotationQuaternion($M._tempQuaternion,$n)},$M.createRotationAxis=function($B,$_,$Z){var $n=$B.elements,$g=$n[0],$q=$n[1],$P=$n[2],$k=Math.cos($_),$m=Math.sin($_),$D=$g*$g,$T=$q*$q,$e=$P*$P,$I=$g*$q,$A=$g*$P,$$=$q*$P,$w=$Z.elements;$w[3]=$w[7]=$w[11]=$w[12]=$w[13]=$w[14]=0,$w[15]=1,$w[0]=$D+$k*(1-$D),$w[1]=$I-$k*$I+$m*$P,$w[2]=$A-$k*$A-$m*$q,$w[4]=$I-$k*$I-$m*$P,$w[5]=$T+$k*(1-$T),$w[6]=$$-$k*$$+$m*$g,$w[8]=$A-$k*$A+$m*$q,$w[9]=$$-$k*$$-$m*$g,$w[10]=$e+$k*(1-$e)},$M.createRotationQuaternion=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$Z[0],$q=$Z[1],$P=$Z[2],$k=$Z[3],$m=$g*$g,$D=$q*$q,$T=$P*$P,$e=$g*$q,$I=$P*$k,$A=$P*$g,$$=$q*$k,$w=$q*$P,$r=$g*$k;$n[3]=$n[7]=$n[11]=$n[12]=$n[13]=$n[14]=0,$n[15]=1,$n[0]=1-2*($D+$T),$n[1]=2*($e+$I),$n[2]=2*($A-$$),$n[4]=2*($e-$I),$n[5]=1-2*($T+$m),$n[6]=2*($w+$r),$n[8]=2*($A+$$),$n[9]=2*($w-$r),$n[10]=1-2*($D+$m)},$M.createTranslate=function($B,$_){var $Z=$B.elements,$n=$_.elements;$n[4]=$n[8]=$n[1]=$n[9]=$n[2]=$n[6]=$n[3]=$n[7]=$n[11]=0,$n[0]=$n[5]=$n[10]=$n[15]=1,$n[12]=$Z[0],$n[13]=$Z[1],$n[14]=$Z[2]},$M.createScaling=function($B,$_){var $Z=$B.elements,$n=$_.elements;$n[0]=$Z[0],$n[5]=$Z[1],$n[10]=$Z[2],$n[1]=$n[4]=$n[8]=$n[12]=$n[9]=$n[13]=$n[2]=$n[6]=$n[14]=$n[3]=$n[7]=$n[11]=0,$n[15]=1},$M.multiply=function($B,$_,$Z){var $n,$g,$q,$P,$k,$m,$D,$T;for($g=$Z.elements,$q=$B.elements,$g===($P=$_.elements)&&($P=$P.slice()),$n=0;$n<4;$n++)$k=$q[$n],$m=$q[$n+4],$D=$q[$n+8],$T=$q[$n+12],$g[$n]=$k*$P[0]+$m*$P[1]+$D*$P[2]+$T*$P[3],$g[$n+4]=$k*$P[4]+$m*$P[5]+$D*$P[6]+$T*$P[7],$g[$n+8]=$k*$P[8]+$m*$P[9]+$D*$P[10]+$T*$P[11],$g[$n+12]=$k*$P[12]+$m*$P[13]+$D*$P[14]+$T*$P[15]},$M.createFromQuaternion=function($B,$_){var $Z=$_.elements,$n=$B.elements,$g=$n[0],$q=$n[1],$P=$n[2],$k=$n[3],$m=$g+$g,$D=$q+$q,$T=$P+$P,$e=$g*$m,$I=$q*$m,$A=$q*$D,$$=$P*$m,$w=$P*$D,$r=$P*$T,$j=$k*$m,$y=$k*$D,$C=$k*$T;$Z[0]=1-$A-$r,$Z[1]=$I+$C,$Z[2]=$$-$y,$Z[3]=0,$Z[4]=$I-$C,$Z[5]=1-$e-$r,$Z[6]=$w+$j,$Z[7]=0,$Z[8]=$$+$y,$Z[9]=$w-$j,$Z[10]=1-$e-$A,$Z[11]=0,$Z[12]=0,$Z[13]=0,$Z[14]=0,$Z[15]=1},$M.createAffineTransformation=function($B,$_,$Z,$n){var $g=$B.elements,$q=$_.elements,$P=$Z.elements,$k=$n.elements,$m=$q[0],$D=$q[1],$T=$q[2],$e=$q[3],$I=$m+$m,$A=$D+$D,$$=$T+$T,$w=$m*$I,$r=$m*$A,$j=$m*$$,$y=$D*$A,$C=$D*$$,$z=$T*$$,$t=$e*$I,$J=$e*$A,$N=$e*$$,$Q=$P[0],$M=$P[1],$Y=$P[2];$k[0]=(1-($y+$z))*$Q,$k[1]=($r+$N)*$Q,$k[2]=($j-$J)*$Q,$k[3]=0,$k[4]=($r-$N)*$M,$k[5]=(1-($w+$z))*$M,$k[6]=($C+$t)*$M,$k[7]=0,$k[8]=($j+$J)*$Y,$k[9]=($C-$t)*$Y,$k[10]=(1-($w+$y))*$Y,$k[11]=0,$k[12]=$g[0],$k[13]=$g[1],$k[14]=$g[2],$k[15]=1},$M.createLookAt=function($B,$_,$Z,$n){var $g=$n.elements,$q=$M._tempVector0,$P=$M._tempVector1,$k=$M._tempVector2;$P_.subtract($B,$_,$k),$P_.normalize($k,$k),$P_.cross($Z,$k,$q),$P_.normalize($q,$q),$P_.cross($k,$q,$P),$n.identity(),$g[0]=$q.x,$g[4]=$q.y,$g[8]=$q.z,$g[1]=$P.x,$g[5]=$P.y,$g[9]=$P.z,$g[2]=$k.x,$g[6]=$k.y,$g[10]=$k.z,$g[12]=-$P_.dot($q,$B),$g[13]=-$P_.dot($P,$B),$g[14]=-$P_.dot($k,$B)},$M.createPerspective=function($B,$_,$Z,$n,$g){var $q=$g.elements,$P=1/Math.tan($B/2),$k=1/($Z-$n);$q[0]=$P/$_,$q[5]=$P,$q[10]=($n+$Z)*$k,$q[11]=-1,$q[14]=2*$n*$Z*$k,$q[1]=$q[2]=$q[3]=$q[4]=$q[6]=$q[7]=$q[8]=$q[9]=$q[12]=$q[13]=$q[15]=0},$M.createOrthoOffCenterRH=function($B,$_,$Z,$n,$g,$q,$P){var $k=$P.elements,$m=1/($B-$_),$D=1/($Z-$n),$T=1/($g-$q);$k[1]=$k[2]=$k[3]=$k[4]=$k[6]=$k[7]=$k[8]=$k[9]=$k[11]=0,$k[15]=1,$k[0]=-2*$m,$k[5]=-2*$D,$k[10]=2*$T,$k[12]=($B+$_)*$m,$k[13]=($n+$Z)*$D,$k[14]=($q+$g)*$T},$M.translation=function($B,$_){var $Z=$B.elements,$n=$_.elements;$n[0]=$n[5]=$n[10]=$n[15]=1,$n[12]=$Z[0],$n[13]=$Z[1],$n[14]=$Z[2]},$e($M,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $M},"_tempVector0",function(){return this._tempVector0=new $P_},"_tempVector1",function(){return this._tempVector1=new $P_},"_tempVector2",function(){return this._tempVector2=new $P_},"_tempQuaternion",function(){return this._tempQuaternion=new $Z_},"DEFAULT",function(){return this.DEFAULT=new $M},"ZERO",function(){return this.ZERO=new $M(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$M}(),$__=(function(){function $C($B,$_){this.extents=null,this.transformation=null,this.extents=$B,this.transformation=$_}$A($C,"laya.d3.math.OrientedBoundBox");var $B=$C.prototype;$B.getCorners=function($B){var $_=$C._tempV30.elements,$Z=$C._tempV31.elements,$n=$C._tempV32.elements,$g=this.extents.elements;$_[0]=$g[0],$_[1]=$_[2]=0,$Z[1]=$g[1],$Z[0]=$Z[2]=0,$n[2]=$g[2],$n[0]=$n[1]=0,$P_.TransformNormal($C._tempV30,this.transformation,$C._tempV30),$P_.TransformNormal($C._tempV31,this.transformation,$C._tempV31),$P_.TransformNormal($C._tempV32,this.transformation,$C._tempV32);var $q=$C._tempV33;this.transformation.getTranslationVector($q),$B.length=8,$P_.add($q,$C._tempV30,$C._tempV34),$P_.add($C._tempV34,$C._tempV31,$C._tempV34),$P_.add($C._tempV34,$C._tempV32,$B[0]),$P_.add($q,$C._tempV30,$C._tempV34),$P_.add($C._tempV34,$C._tempV31,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV32,$B[1]),$P_.subtract($q,$C._tempV30,$C._tempV34),$P_.add($C._tempV34,$C._tempV31,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV32,$B[2]),$P_.subtract($q,$C._tempV30,$C._tempV34),$P_.add($C._tempV34,$C._tempV31,$C._tempV34),$P_.add($C._tempV34,$C._tempV32,$B[3]),$P_.add($q,$C._tempV30,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV31,$C._tempV34),$P_.add($C._tempV34,$C._tempV32,$B[4]),$P_.add($q,$C._tempV30,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV31,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV32,$B[5]),$P_.subtract($q,$C._tempV30,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV31,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV32,$B[6]),$P_.subtract($q,$C._tempV30,$C._tempV34),$P_.subtract($C._tempV34,$C._tempV31,$C._tempV34),$P_.add($C._tempV34,$C._tempV32,$B[7])},$B.transform=function($B){$B_.multiply(this.transformation,$B,this.transformation)},$B.scale=function($B){$P_.multiply(this.extents,$B,this.extents)},$B.translate=function($B){this.transformation.getTranslationVector($C._tempV30),$P_.add($C._tempV30,$B,$C._tempV31),this.transformation.setTranslationVector($C._tempV31)},$B.Size=function($B){$P_.scale(this.extents,2,$B)},$B.getSize=function($B){var $_=this.extents.elements;$C._tempV30.x=$_[0],$C._tempV31.y=$_[1],$C._tempV32.z=$_[2],$P_.TransformNormal($C._tempV30,this.transformation,$C._tempV30),$P_.TransformNormal($C._tempV31,this.transformation,$C._tempV31),$P_.TransformNormal($C._tempV31,this.transformation,$C._tempV32);var $Z=$B.elements;$Z[0]=$P_.scalarLength($C._tempV30),$Z[1]=$P_.scalarLength($C._tempV31),$Z[2]=$P_.scalarLength($C._tempV32)},$B.getSizeSquared=function($B){var $_=this.extents.elements;$C._tempV30.x=$_[0],$C._tempV31.y=$_[1],$C._tempV32.z=$_[2],$P_.TransformNormal($C._tempV30,this.transformation,$C._tempV30),$P_.TransformNormal($C._tempV31,this.transformation,$C._tempV31),$P_.TransformNormal($C._tempV31,this.transformation,$C._tempV32);var $Z=$B.elements;$Z[0]=$P_.scalarLengthSquared($C._tempV30),$Z[1]=$P_.scalarLengthSquared($C._tempV31),$Z[2]=$P_.scalarLengthSquared($C._tempV32)},$B.getCenter=function($B){this.transformation.getTranslationVector($B)},$B.containsPoint=function($B){var $_=this.extents.elements,$Z=$_[0],$n=$_[1],$g=$_[2];this.transformation.invert($C._tempM0),$P_.transformCoordinate($B,$C._tempM0,$C._tempV30);var $q=$C._tempV30.elements,$P=Math.abs($q[0]),$k=Math.abs($q[1]),$m=Math.abs($q[2]);return $cB.nearEqual($P,$Z)&&$cB.nearEqual($k,$n)&&$cB.nearEqual($m,$g)?2:$P<$Z&&$k<$n&&$m<$g?1:0},$B.containsPoints=function($B){var $_=this.extents.elements,$Z=$_[0],$n=$_[1],$g=$_[2];this.transformation.invert($C._tempM0);for(var $q=!0,$P=!1,$k=0;$k<$B.length;$k++){$P_.transformCoordinate($B[$k],$C._tempM0,$C._tempV30);var $m=$C._tempV30.elements,$D=Math.abs($m[0]),$T=Math.abs($m[1]),$e=Math.abs($m[2]);$cB.nearEqual($D,$Z)&&$cB.nearEqual($T,$n)&&$cB.nearEqual($e,$g)&&($P=!0),$D<$Z&&$T<$n&&$e<$g?$P=!0:$q=!1}return $q?1:$P?2:0},$B.containsSphere=function($B,$_){void 0===$_&&($_=!1);var $Z=this.extents.elements,$n=$Z[0],$g=$Z[1],$q=$Z[2],$P=$B.radius;this.transformation.invert($C._tempM0),$P_.transformCoordinate($B.center,$C._tempM0,$C._tempV30);var $k=NaN;if($k=$_?$P:($P_.scale($P_.UnitX,$P,$C._tempV31),$P_.TransformNormal($C._tempV31,$C._tempM0,$C._tempV31),$P_.scalarLength($C._tempV31)),$P_.scale(this.extents,-1,$C._tempV32),$P_.Clamp($C._tempV30,$C._tempV32,this.extents,$C._tempV33),$k*$k<$P_.distanceSquared($C._tempV30,$C._tempV33))return 0;var $m=$C._tempV30.elements,$D=$m[0],$T=$m[1],$e=$m[2],$I=$C._tempV32.elements,$A=$I[0],$$=$I[1],$w=$I[2];return $A+$k<=$D&&$D<=$n-$k&&$k<$n-$A&&$$+$k<=$T&&$T<=$g-$k&&$k<$g-$$&&$w+$k<=$e&&$e<=$q-$k&&$k<$q-$w?1:2},$B.containsOrientedBoundBox=function($B){var $_=0,$Z=0;$B.getCorners($C._corners);var $n=this.containsPoints($C._corners);if(0!=$n)return $n;var $g=this.extents.elements;$B.extents.cloneTo($C._tempV35);var $q=$C._tempV35.elements;$C._getRows(this.transformation,$C._rows1),$C._getRows($B.transformation,$C._rows2);var $P=NaN;for($_=0;$_<4;$_++)for($Z=0;$Z<4;$Z++)3==$_||3==$Z?($C._tempM0.setElementByRowColumn($_,$Z,0),$C._tempM1.setElementByRowColumn($_,$Z,0)):($P=$P_.dot($C._rows1[$_],$C._rows2[$Z]),$C._tempM0.setElementByRowColumn($_,$Z,$P),$C._tempM1.setElementByRowColumn($_,$Z,Math.abs($P)));$B.getCenter($C._tempV34),this.getCenter($C._tempV36),$P_.subtract($C._tempV34,$C._tempV36,$C._tempV30);var $k=$C._tempV31.elements;$k[0]=$P_.dot($C._tempV30,$C._rows1[0]),$k[1]=$P_.dot($C._tempV30,$C._rows1[1]),$k[2]=$P_.dot($C._tempV30,$C._rows1[2]);var $m=$C._tempV32.elements,$D=$C._tempV33.elements;for($_=0;$_<3;$_++)if($m[0]=$C._tempM1.getElementByRowColumn($_,0),$m[1]=$C._tempM1.getElementByRowColumn($_,1),$m[2]=$C._tempM1.getElementByRowColumn($_,2),$g[$_]+$P_.dot($C._tempV35,$C._tempV32)<Math.abs($k[$_]))return 0;for($Z=0;$Z<3;$Z++)if($m[0]=$C._tempM1.getElementByRowColumn(0,$Z),$m[1]=$C._tempM1.getElementByRowColumn(1,$Z),$m[2]=$C._tempM1.getElementByRowColumn(2,$Z),$D[0]=$C._tempM0.getElementByRowColumn(0,$Z),$D[1]=$C._tempM0.getElementByRowColumn(1,$Z),$D[2]=$C._tempM0.getElementByRowColumn(2,$Z),$P_.dot(this.extents,$C._tempV32)+$q[$Z]<Math.abs($P_.dot($C._tempV31,$C._tempV33)))return 0;for($_=0;$_<3;$_++)for($Z=0;$Z<3;$Z++){var $T=($_+1)%3,$e=($_+2)%3,$I=($Z+1)%3,$A=($Z+2)%3;if($g[$T]*$C._tempM1.getElementByRowColumn($e,$Z)+$g[$e]*$C._tempM1.getElementByRowColumn($T,$Z)+($q[$I]*$C._tempM1.getElementByRowColumn($_,$A)+$q[$A]*$C._tempM1.getElementByRowColumn($_,$I))<Math.abs($k[$e]*$C._tempM0.getElementByRowColumn($T,$Z)-$k[$T]*$C._tempM0.getElementByRowColumn($e,$Z)))return 0}return 2},$B.containsLine=function($B,$_){$C._corners[0]=$B,$C._corners[1]=$_;var $Z=this.containsPoints($C._corners);if(0!=$Z)return $Z;var $n=this.extents.elements,$g=$n[0],$q=$n[1],$P=$n[2];this.transformation.invert($C._tempM0),$P_.transformCoordinate($B,$C._tempM0,$C._tempV30),$P_.transformCoordinate($_,$C._tempM0,$C._tempV31),$P_.add($C._tempV30,$C._tempV31,$C._tempV32),$P_.scale($C._tempV32,.5,$C._tempV32),$P_.subtract($C._tempV30,$C._tempV32,$C._tempV33);var $k=$C._tempV33.elements,$m=$k[0],$D=$k[1],$T=$k[2],$e=$C._tempV34.elements,$I=$e[0]=Math.abs($k[0]),$A=$e[1]=Math.abs($k[1]),$$=$e[2]=Math.abs($k[2]),$w=$C._tempV32.elements,$r=$w[0],$j=$w[1],$y=$w[2];return Math.abs($r)>$g+$I?0:Math.abs($j)>$q+$A?0:Math.abs($y)>$P+$$?0:Math.abs($j*$T-$y*$D)>$q*$$+$P*$A?0:Math.abs($r*$T-$y*$m)>$g*$$+$P*$I?0:Math.abs($r*$D-$j*$m)>$g*$A+$q*$I?0:2},$B.containsBoundBox=function($B){var $_=0,$Z=0,$n=$B.min,$g=$B.max;$B.getCorners($C._corners);var $q=this.containsPoints($C._corners);if(0!=$q)return $q;$P_.subtract($g,$n,$C._tempV30),$P_.scale($C._tempV30,.5,$C._tempV30),$P_.add($n,$C._tempV30,$C._tempV30),$P_.subtract($g,$C._tempV30,$C._tempV31);var $P=this.extents.elements,$k=$C._tempV31.elements;$C._getRows(this.transformation,$C._rows1),this.transformation.invert($C._tempM0);for($_=0;$_<3;$_++)for($Z=0;$Z<3;$Z++)$C._tempM1.setElementByRowColumn($_,$Z,Math.abs($C._tempM0.getElementByRowColumn($_,$Z)));this.getCenter($C._tempV35),$P_.subtract($C._tempV30,$C._tempV35,$C._tempV32);var $m=$C._tempV31.elements;$m[0]=$P_.dot($C._tempV32,$C._rows1[0]),$m[1]=$P_.dot($C._tempV32,$C._rows1[1]),$m[2]=$P_.dot($C._tempV32,$C._rows1[2]);var $D=$C._tempV33.elements,$T=$C._tempV34.elements;for($_=0;$_<3;$_++)if($D[0]=$C._tempM1.getElementByRowColumn($_,0),$D[1]=$C._tempM1.getElementByRowColumn($_,1),$D[2]=$C._tempM1.getElementByRowColumn($_,2),$P[$_]+$P_.dot($C._tempV31,$C._tempV33)<Math.abs($m[$_]))return 0;for($Z=0;$Z<3;$Z++)if($D[0]=$C._tempM1.getElementByRowColumn(0,$Z),$D[1]=$C._tempM1.getElementByRowColumn(1,$Z),$D[2]=$C._tempM1.getElementByRowColumn(2,$Z),$T[0]=$C._tempM0.getElementByRowColumn(0,$Z),$T[1]=$C._tempM0.getElementByRowColumn(1,$Z),$T[2]=$C._tempM0.getElementByRowColumn(2,$Z),$P_.dot(this.extents,$C._tempV33)+$k[$Z]<Math.abs($P_.dot($C._tempV31,$C._tempV34)))return 0;for($_=0;$_<3;$_++)for($Z=0;$Z<3;$Z++){var $e=($_+1)%3,$I=($_+2)%3,$A=($Z+1)%3,$$=($Z+2)%3;if($P[$e]*$C._tempM1.getElementByRowColumn($I,$Z)+$P[$I]*$C._tempM1.getElementByRowColumn($e,$Z)+($k[$A]*$C._tempM1.getElementByRowColumn($_,$$)+$k[$$]*$C._tempM1.getElementByRowColumn($_,$A))<Math.abs($m[$I]*$C._tempM0.getElementByRowColumn($e,$Z)-$m[$e]*$C._tempM0.getElementByRowColumn($I,$Z)))return 0}return 2},$B.intersectsRay=function($B,$_){$P_.scale(this.extents,-1,$C._tempV30),this.transformation.invert($C._tempM0),$P_.TransformNormal($B.direction,$C._tempM0,$C._ray.direction),$P_.transformCoordinate($B.origin,$C._tempM0,$C._ray.origin),$C._boxBound1.min=$C._tempV30,$C._boxBound1.max=this.extents;var $Z=Collision.intersectsRayAndBoxRP($C._ray,$C._boxBound1,$_);return-1!==$Z&&$P_.transformCoordinate($_,this.transformation,$_),$Z},$B._getLocalCorners=function($B){$B.length=8;var $_=this.extents.elements;$C._tempV30.x=$_[0],$C._tempV31.y=$_[1],$C._tempV32.z=$_[2],$P_.add($C._tempV30,$C._tempV31,$C._tempV33),$P_.add($C._tempV33,$C._tempV32,$B[0]),$P_.add($C._tempV30,$C._tempV31,$C._tempV33),$P_.subtract($C._tempV33,$C._tempV32,$B[1]),$P_.subtract($C._tempV31,$C._tempV30,$C._tempV33),$P_.subtract($C._tempV33,$C._tempV30,$B[2]),$P_.subtract($C._tempV31,$C._tempV30,$C._tempV33),$P_.add($C._tempV33,$C._tempV32,$B[3]),$P_.subtract($C._tempV30,$C._tempV31,$C._tempV33),$P_.add($C._tempV33,$C._tempV32,$B[4]),$P_.subtract($C._tempV30,$C._tempV31,$C._tempV33),$P_.subtract($C._tempV33,$C._tempV32,$B[5]),$P_.scale($B[0],-1,$B[6]),$P_.subtract($C._tempV32,$C._tempV30,$C._tempV33),$P_.subtract($C._tempV33,$C._tempV31,$B[7])},$B.equals=function($B){return this.extents==$B.extents&&this.transformation==$B.transformation},$B.cloneTo=function($B){var $_=$B;this.extents.cloneTo($_.extents),this.transformation.cloneTo($_.transformation)},$C.createByBoundBox=function($B,$_){var $Z=$B.min,$n=$B.max;$P_.subtract($n,$Z,$C._tempV30),$P_.scale($C._tempV30,.5,$C._tempV30),$P_.add($Z,$C._tempV30,$C._tempV31),$P_.subtract($n,$C._tempV31,$C._tempV32),$B_.translation($C._tempV31,$C._tempM0);var $g=$C._tempV32.clone(),$q=$C._tempM0.clone();$_.extents=$g,$_.transformation=$q},$C.createByMinAndMaxVertex=function($B,$_){return $P_.subtract($_,$B,$C._tempV30),$P_.scale($C._tempV30,.5,$C._tempV30),$P_.add($B,$C._tempV30,$C._tempV31),$P_.subtract($_,$C._tempV31,$C._tempV32),$B_.translation($C._tempV31,$C._tempM0),new $C($C._tempV32,$C._tempM0)},$C._getRows=function($B,$_){$_.length=3;var $Z=$B.elements,$n=$_[0].elements;$n[0]=$Z[0],$n[1]=$Z[1],$n[2]=$Z[2];var $g=$_[1].elements;$g[0]=$Z[4],$g[1]=$Z[5],$g[2]=$Z[6];var $q=$_[2].elements;$q[0]=$Z[8],$q[1]=$Z[9],$q[2]=$Z[10]},$C.getObbtoObbMatrix4x4=function($B,$_,$Z,$n){var $g=$B.transformation,$q=$_.transformation;if($Z){$C._getRows($g,$C._rows1),$C._getRows($q,$C._rows2);for(var $P=0;$P<3;$P++)for(var $k=0;$k<3;$k++)$n.setElementByRowColumn($P,$k,$P_.dot($C._rows2[$P],$C._rows1[$k]));$_.getCenter($C._tempV30),$B.getCenter($C._tempV31),$P_.subtract($C._tempV30,$C._tempV31,$C._tempV32);var $m=$n.elements;$m[12]=$P_.dot($C._tempV32,$C._rows1[0]),$m[13]=$P_.dot($C._tempV32,$C._rows1[1]),$m[14]=$P_.dot($C._tempV32,$C._rows1[2]),$m[15]=1}else $g.invert($C._tempM0),$B_.multiply($q,$C._tempM0,$n)},$C.merge=function($B,$_,$Z){var $n=$B.extents,$g=$B.transformation;$C.getObbtoObbMatrix4x4($B,$_,$Z,$C._tempM0),$_._getLocalCorners($C._corners),$P_.transformCoordinate($C._corners[0],$C._tempM0,$C._corners[0]),$P_.transformCoordinate($C._corners[1],$C._tempM0,$C._corners[1]),$P_.transformCoordinate($C._corners[2],$C._tempM0,$C._corners[2]),$P_.transformCoordinate($C._corners[3],$C._tempM0,$C._corners[3]),$P_.transformCoordinate($C._corners[4],$C._tempM0,$C._corners[4]),$P_.transformCoordinate($C._corners[5],$C._tempM0,$C._corners[5]),$P_.transformCoordinate($C._corners[6],$C._tempM0,$C._corners[6]),$P_.transformCoordinate($C._corners[7],$C._tempM0,$C._corners[7]),$P_.scale($n,-1,$C._boxBound1.min),$n.cloneTo($C._boxBound1.max),$dB.createfromPoints($C._corners,$C._boxBound2),$dB.merge($C._boxBound2,$C._boxBound1,$C._boxBound3);var $q=$C._boxBound3.min,$P=$C._boxBound3.max;$P_.subtract($P,$q,$C._tempV30),$P_.scale($C._tempV30,.5,$C._tempV30),$P_.add($q,$C._tempV30,$C._tempV32),$P_.subtract($P,$C._tempV32,$n),$P_.transformCoordinate($C._tempV32,$g,$C._tempV33)},$e($C,["_tempV30",function(){return this._tempV30=new $P_},"_tempV31",function(){return this._tempV31=new $P_},"_tempV32",function(){return this._tempV32=new $P_},"_tempV33",function(){return this._tempV33=new $P_},"_tempV34",function(){return this._tempV34=new $P_},"_tempV35",function(){return this._tempV35=new $P_},"_tempV36",function(){return this._tempV36=new $P_},"_tempM0",function(){return this._tempM0=new $B_},"_tempM1",function(){return this._tempM1=new $B_},"_corners",function(){return this._corners=[new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_]},"_rows1",function(){return this._rows1=[new $P_,new $P_,new $P_]},"_rows2",function(){return this._rows2=[new $P_,new $P_,new $P_]},"_ray",function(){return this._ray=new $g_(new $P_,new $P_)},"_boxBound1",function(){return this._boxBound1=new $dB(new $P_,new $P_)},"_boxBound2",function(){return this._boxBound2=new $dB(new $P_,new $P_)},"_boxBound3",function(){return this._boxBound3=new $dB(new $P_,new $P_)}])}(),function(){function $t($B,$_){this.normal=null,this.distance=NaN,void 0===$_&&($_=0),this.normal=$B,this.distance=$_}return $A($t,"laya.d3.math.Plane"),$t.prototype.normalize=function(){var $B=this.normal.elements,$_=$B[0],$Z=$B[1],$n=$B[2],$g=1/Math.sqrt($_*$_+$Z*$Z+$n*$n);$B[0]=$_*$g,$B[1]=$Z*$g,$B[2]=$n*$g,this.distance*=$g},$t.createPlaneBy3P=function($B,$_,$Z){var $n=$B.elements,$g=$_.elements,$q=$Z.elements,$P=$g[0]-$n[0],$k=$g[1]-$n[1],$m=$g[2]-$n[2],$D=$q[0]-$n[0],$T=$q[1]-$n[1],$e=$q[2]-$n[2],$I=$k*$e-$m*$T,$A=$m*$D-$P*$e,$$=$P*$T-$k*$D,$w=1/Math.sqrt($I*$I+$A*$A+$$*$$),$r=$I*$w,$j=$A*$w,$y=$$*$w,$C=$t._TEMPVec3.elements;$C[0]=$r,$C[1]=$j,$C[2]=$y;var $z=-($r*$n[0]+$j*$n[1]+$y*$n[2]);return new $t($t._TEMPVec3,$z)},$t.PlaneIntersectionType_Back=0,$t.PlaneIntersectionType_Front=1,$t.PlaneIntersectionType_Intersecting=2,$e($t,["_TEMPVec3",function(){return this._TEMPVec3=new $P_}]),$t}()),$Z_=function(){function $g($B,$_,$Z,$n){this.elements=new Float32Array(4),void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=1),this.elements[0]=$B,this.elements[1]=$_,this.elements[2]=$Z,this.elements[3]=$n}$A($g,"laya.d3.math.Quaternion");var $B=$g.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.scaling=function($B,$_){var $Z=$_.elements,$n=this.elements;$Z[0]=$n[0]*$B,$Z[1]=$n[1]*$B,$Z[2]=$n[2]*$B,$Z[3]=$n[3]*$B},$B.normalize=function($B){var $_=$B.elements,$Z=this.elements,$n=$Z[0],$g=$Z[1],$q=$Z[2],$P=$Z[3],$k=$n*$n+$g*$g+$q*$q+$P*$P;0<$k&&($k=1/Math.sqrt($k),$_[0]=$n*$k,$_[1]=$g*$k,$_[2]=$q*$k,$_[3]=$P*$k)},$B.length=function(){var $B=this.elements,$_=$B[0],$Z=$B[1],$n=$B[2],$g=$B[3];return Math.sqrt($_*$_+$Z*$Z+$n*$n+$g*$g)},$B.rotateX=function($B,$_){var $Z=$_.elements,$n=this.elements;$B*=.5;var $g=$n[0],$q=$n[1],$P=$n[2],$k=$n[3],$m=Math.sin($B),$D=Math.cos($B);$Z[0]=$g*$D+$k*$m,$Z[1]=$q*$D+$P*$m,$Z[2]=$P*$D-$q*$m,$Z[3]=$k*$D-$g*$m},$B.rotateY=function($B,$_){var $Z=$_.elements,$n=this.elements;$B*=.5;var $g=$n[0],$q=$n[1],$P=$n[2],$k=$n[3],$m=Math.sin($B),$D=Math.cos($B);$Z[0]=$g*$D-$P*$m,$Z[1]=$q*$D+$k*$m,$Z[2]=$P*$D+$g*$m,$Z[3]=$k*$D-$q*$m},$B.rotateZ=function($B,$_){var $Z=$_.elements,$n=this.elements;$B*=.5;var $g=$n[0],$q=$n[1],$P=$n[2],$k=$n[3],$m=Math.sin($B),$D=Math.cos($B);$Z[0]=$g*$D+$q*$m,$Z[1]=$q*$D-$g*$m,$Z[2]=$P*$D+$k*$m,$Z[3]=$k*$D-$P*$m},$B.getYawPitchRoll=function($B){$P_.transformQuat($P_.ForwardRH,this,$g.TEMPVector31),$P_.transformQuat($P_.Up,this,$g.TEMPVector32);var $_=$g.TEMPVector32.elements;$g.angleTo($P_.ZERO,$g.TEMPVector31,$g.TEMPVector33);var $Z=$g.TEMPVector33.elements;$Z[0]==Math.PI/2?($Z[1]=$g.arcTanAngle($_[2],$_[0]),$Z[2]=0):$Z[0]==-Math.PI/2?($Z[1]=$g.arcTanAngle(-$_[2],-$_[0]),$Z[2]=0):($B_.createRotationY(-$Z[1],$g.TEMPMatrix0),$B_.createRotationX(-$Z[0],$g.TEMPMatrix1),$P_.transformCoordinate($g.TEMPVector32,$g.TEMPMatrix0,$g.TEMPVector32),$P_.transformCoordinate($g.TEMPVector32,$g.TEMPMatrix1,$g.TEMPVector32),$Z[2]=$g.arcTanAngle($_[1],-$_[0])),$Z[1]<=-Math.PI&&($Z[1]=Math.PI),$Z[2]<=-Math.PI&&($Z[2]=Math.PI),$Z[1]>=Math.PI&&$Z[2]>=Math.PI&&($Z[1]=0,$Z[2]=0,$Z[0]=Math.PI-$Z[0]);var $n=$B.elements;$n[0]=$Z[1],$n[1]=$Z[0],$n[2]=$Z[2]},$B.invert=function($B){var $_=$B.elements,$Z=this.elements,$n=$Z[0],$g=$Z[1],$q=$Z[2],$P=$Z[3],$k=$n*$n+$g*$g+$q*$q+$P*$P,$m=$k?1/$k:0;$_[0]=-$n*$m,$_[1]=-$g*$m,$_[2]=-$q*$m,$_[3]=$P*$m},$B.identity=function(){var $B=this.elements;$B[0]=0,$B[1]=0,$B[2]=0,$B[3]=1},$B.fromArray=function($B,$_){void 0===$_&&($_=0),this.elements[0]=$B[$_+0],this.elements[1]=$B[$_+1],this.elements[2]=$B[$_+2],this.elements[3]=$B[$_+3]},$B.cloneTo=function($B){var $_,$Z,$n;if(($Z=this.elements)!==($n=$B.elements))for($_=0;$_<4;++$_)$n[$_]=$Z[$_]},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$B.equals=function($B){var $_=this.elements,$Z=$B.elements;return $cB.nearEqual($_[0],$Z[0])&&$cB.nearEqual($_[1],$Z[1])&&$cB.nearEqual($_[2],$Z[2])&&$cB.nearEqual($_[3],$Z[3])},$B.lengthSquared=function(){var $B=this.elements[0],$_=this.elements[1],$Z=this.elements[2],$n=this.elements[3];return $B*$B+$_*$_+$Z*$Z+$n*$n},$$(0,$B,"x",function(){return this.elements[0]}),$$(0,$B,"y",function(){return this.elements[1]}),$$(0,$B,"z",function(){return this.elements[2]}),$$(0,$B,"w",function(){return this.elements[3]}),$g.createFromYawPitchRoll=function($B,$_,$Z,$n){var $g=.5*$Z,$q=.5*$_,$P=.5*$B,$k=Math.sin($g),$m=Math.cos($g),$D=Math.sin($q),$T=Math.cos($q),$e=Math.sin($P),$I=Math.cos($P),$A=$n.elements;$A[0]=$I*$D*$m+$e*$T*$k,$A[1]=$e*$T*$m-$I*$D*$k,$A[2]=$I*$T*$k-$e*$D*$m,$A[3]=$I*$T*$m+$e*$D*$k},$g.multiply=function($B,$_,$Z){var $n=$B.elements,$g=$_.elements,$q=$Z.elements,$P=$n[0],$k=$n[1],$m=$n[2],$D=$n[3],$T=$g[0],$e=$g[1],$I=$g[2],$A=$g[3],$$=$k*$I-$m*$e,$w=$m*$T-$P*$I,$r=$P*$e-$k*$T,$j=$P*$T+$k*$e+$m*$I;$q[0]=$P*$A+$T*$D+$$,$q[1]=$k*$A+$e*$D+$w,$q[2]=$m*$A+$I*$D+$r,$q[3]=$D*$A-$j},$g.arcTanAngle=function($B,$_){return 0==$B?1==$_?Math.PI/2:-Math.PI/2:0<$B?Math.atan($_/$B):$B<0?0<$_?Math.atan($_/$B)+Math.PI:Math.atan($_/$B)-Math.PI:0},$g.angleTo=function($B,$_,$Z){$P_.subtract($_,$B,$g.TEMPVector30),$P_.normalize($g.TEMPVector30,$g.TEMPVector30),$Z.elements[0]=Math.asin($g.TEMPVector30.y),$Z.elements[1]=$g.arcTanAngle(-$g.TEMPVector30.z,-$g.TEMPVector30.x)},$g.createFromAxisAngle=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements;$_*=.5;var $q=Math.sin($_);$n[0]=$q*$g[0],$n[1]=$q*$g[1],$n[2]=$q*$g[2],$n[3]=Math.cos($_)},$g.createFromMatrix3x3=function($B,$_){var $Z,$n=$_.elements,$g=$B.elements,$q=$g[0]+$g[4]+$g[8];if(0<$q)$Z=Math.sqrt($q+1),$n[3]=.5*$Z,$Z=.5/$Z,$n[0]=($g[5]-$g[7])*$Z,$n[1]=($g[6]-$g[2])*$Z,$n[2]=($g[1]-$g[3])*$Z;else{var $P=0;$g[4]>$g[0]&&($P=1),$g[8]>$g[3*$P+$P]&&($P=2);var $k=($P+1)%3,$m=($P+2)%3;$Z=Math.sqrt($g[3*$P+$P]-$g[3*$k+$k]-$g[3*$m+$m]+1),$n[$P]=.5*$Z,$Z=.5/$Z,$n[3]=($g[3*$k+$m]-$g[3*$m+$k])*$Z,$n[$k]=($g[3*$k+$P]+$g[3*$P+$k])*$Z,$n[$m]=($g[3*$m+$P]+$g[3*$P+$m])*$Z}},$g.createFromMatrix4x4=function($B,$_){var $Z,$n,$g=$B.elements,$q=$_.elements,$P=$g[0]+$g[5]+$g[10];0<$P?($Z=Math.sqrt($P+1),$q[3]=.5*$Z,$Z=.5/$Z,$q[0]=($g[6]-$g[9])*$Z,$q[1]=($g[8]-$g[2])*$Z,$q[2]=($g[1]-$g[4])*$Z):$g[0]>=$g[5]&&$g[0]>=$g[10]?($n=.5/($Z=Math.sqrt(1+$g[0]-$g[5]-$g[10])),$q[0]=.5*$Z,$q[1]=($g[1]+$g[4])*$n,$q[2]=($g[2]+$g[8])*$n,$q[3]=($g[6]-$g[9])*$n):$g[5]>$g[10]?($n=.5/($Z=Math.sqrt(1+$g[5]-$g[0]-$g[10])),$q[0]=($g[4]+$g[1])*$n,$q[1]=.5*$Z,$q[2]=($g[9]+$g[6])*$n,$q[3]=($g[8]-$g[2])*$n):($n=.5/($Z=Math.sqrt(1+$g[10]-$g[0]-$g[5])),$q[0]=($g[8]+$g[2])*$n,$q[1]=($g[9]+$g[6])*$n,$q[2]=.5*$Z,$q[3]=($g[1]-$g[4])*$n)},$g.slerp=function($B,$_,$Z,$n){var $g,$q,$P,$k,$m,$D=$B.elements,$T=$_.elements,$e=$n.elements,$I=$D[0],$A=$D[1],$$=$D[2],$w=$D[3],$r=$T[0],$j=$T[1],$y=$T[2],$C=$T[3];return($q=$I*$r+$A*$j+$$*$y+$w*$C)<0&&($q=-$q,$r=-$r,$j=-$j,$y=-$y,$C=-$C),$m=1e-6<1-$q?($g=Math.acos($q),$P=Math.sin($g),$k=Math.sin((1-$Z)*$g)/$P,Math.sin($Z*$g)/$P):($k=1-$Z,$Z),$e[0]=$k*$I+$m*$r,$e[1]=$k*$A+$m*$j,$e[2]=$k*$$+$m*$y,$e[3]=$k*$w+$m*$C,$e},$g.lerp=function($B,$_,$Z,$n){var $g=$n.elements,$q=$B.elements,$P=$_.elements,$k=$q[0],$m=$q[1],$D=$q[2],$T=$q[3];$g[0]=$k+$Z*($P[0]-$k),$g[1]=$m+$Z*($P[1]-$m),$g[2]=$D+$Z*($P[2]-$D),$g[3]=$T+$Z*($P[3]-$T)},$g.add=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]+$q[0],$n[1]=$g[1]+$q[1],$n[2]=$g[2]+$q[2],$n[3]=$g[3]+$q[3]},$g.dot=function($B,$_){var $Z=$B.elements,$n=$_.elements;return $Z[0]*$n[0]+$Z[1]*$n[1]+$Z[2]*$n[2]+$Z[3]*$n[3]},$g.rotationLookAt=function($B,$_,$Z){$g.lookAt($P_.ZERO,$B,$_,$Z)},$g.lookAt=function($B,$_,$Z,$n){$EB.lookAt($B,$_,$Z,$g._tempMatrix3x3),$g.rotationMatrix($g._tempMatrix3x3,$n)},$g.invert=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$B.lengthSquared();$cB.isZero($g)||($g=1/$g,$n[0]=-$Z[0]*$g,$n[1]=-$Z[1]*$g,$n[2]=-$Z[2]*$g,$n[3]=$Z[3]*$g)},$g.rotationMatrix=function($B,$_){var $Z=$B.elements,$n=$Z[0],$g=$Z[1],$q=$Z[2],$P=$Z[3],$k=$Z[4],$m=$Z[5],$D=$Z[6],$T=$Z[7],$e=$Z[8],$I=$_.elements,$A=NaN,$$=NaN,$w=$n+$k+$e;0<$w?($A=Math.sqrt($w+1),$I[3]=.5*$A,$A=.5/$A,$I[0]=($m-$T)*$A,$I[1]=($D-$q)*$A,$I[2]=($g-$P)*$A):$k<=$n&&$e<=$n?($$=.5/($A=Math.sqrt(1+$n-$k-$e)),$I[0]=.5*$A,$I[1]=($g+$P)*$$,$I[2]=($q+$D)*$$,$I[3]=($m-$T)*$$):$e<$k?($$=.5/($A=Math.sqrt(1+$k-$n-$e)),$I[0]=($P+$g)*$$,$I[1]=.5*$A,$I[2]=($T+$m)*$$,$I[3]=($D-$q)*$$):($$=.5/($A=Math.sqrt(1+$e-$n-$k)),$I[0]=($D+$q)*$$,$I[1]=($T+$m)*$$,$I[2]=.5*$A,$I[3]=($g-$P)*$$)},$g.DEFAULT=new $g,$e($g,["TEMPVector30",function(){return this.TEMPVector30=new $P_},"TEMPVector31",function(){return this.TEMPVector31=new $P_},"TEMPVector32",function(){return this.TEMPVector32=new $P_},"TEMPVector33",function(){return this.TEMPVector33=new $P_},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $B_},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $B_},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $EB},"NAN",function(){return this.NAN=new $g(NaN,NaN,NaN,NaN)}]),$g}(),$n_=function(){function $B($B){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$B,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$A($B,"laya.d3.math.Rand");var $_=$B.prototype;return $_.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$_.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$_.getSignedFloat=function(){return 2*this.getFloat()-1},$$(0,$_,"seed",function(){return this.seeds[0]},function($B){this.seeds[0]=$B,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$B.getFloatFromInt=function($B){return 1/8388607*(8388607&$B)},$B.getByteFromInt=function($B){return(8388607&$B)>>>15},$B}(),$g_=(function(){function $g($B){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($B instanceof Array)||4!==$B.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$B[0],this._state0L=0|$B[1],this._state1U=0|$B[2],this._state1L=0|$B[3]}$A($g,"laya.d3.math.RandX");var $B=$g.prototype;$B.randomint=function(){var $B=this._state0U,$_=this._state0L,$Z=this._state1U,$n=this._state1L,$g=($n>>>0)+($_>>>0),$q=$Z+$B+($g/2>>>31)>>>0,$P=$g>>>0,$k=0,$m=0;$k=($B^=$k=$B<<23|(-512&$_)>>>9)^(this._state0U=$Z),$m=($_^=$m=$_<<23)^(this._state0L=$n);$k^=$B>>>18,$m^=$_>>>18|(262143&$B)<<14;return $k^=$Z>>>5,$m^=$n>>>5|(31&$Z)<<27,this._state1U=$k,this._state1L=$m,[$q,$P]},$B.random=function(){var $B=this.randomint(),$_=$B[0],$Z=1023<<20|$_>>>12,$n=0|($B[1]>>>12|(4095&$_)<<20);return $g._CONVERTION_BUFFER.setUint32(0,$Z,!1),$g._CONVERTION_BUFFER.setUint32(4,$n,!1),$n_._CONVERTION_BUFFER.getFloat64(0,!1)-1},$e($g,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $n_([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $B($B,$_){this.origin=null,this.direction=null,this.origin=$B,this.direction=$_}return $A($B,"laya.d3.math.Ray"),$B}()),$q_=function(){function $B($B,$_){this.elements=new Float32Array(2),void 0===$B&&($B=0),void 0===$_&&($_=0);var $Z=this.elements;$Z[0]=$B,$Z[1]=$_}$A($B,"laya.d3.math.Vector2");var $_=$B.prototype;return $t.imps($_,{"laya.d3.core.IClone":!0}),$_.fromArray=function($B,$_){void 0===$_&&($_=0),this.elements[0]=$B[$_+0],this.elements[1]=$B[$_+1]},$_.cloneTo=function($B){var $_=$B.elements,$Z=this.elements;$_[0]=$Z[0],$_[1]=$Z[1]},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"x",function(){return this.elements[0]},function($B){this.elements[0]=$B}),$$(0,$_,"y",function(){return this.elements[1]},function($B){this.elements[1]=$B}),$B.scale=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements;$n[0]=$g[0]*$_,$n[1]=$g[1]*$_},$e($B,["ZERO",function(){return this.ZERO=new $B(0,0)},"ONE",function(){return this.ONE=new $B(1,1)}]),$B}(),$P_=function(){function $T($B,$_,$Z){this.elements=new Float32Array(3),void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0);var $n=this.elements;$n[0]=$B,$n[1]=$_,$n[2]=$Z}$A($T,"laya.d3.math.Vector3");var $B=$T.prototype;return $t.imps($B,{"laya.d3.core.IClone":!0}),$B.fromArray=function($B,$_){void 0===$_&&($_=0),this.elements[0]=$B[$_+0],this.elements[1]=$B[$_+1],this.elements[2]=$B[$_+2]},$B.cloneTo=function($B){var $_=$B.elements,$Z=this.elements;$_[0]=$Z[0],$_[1]=$Z[1],$_[2]=$Z[2]},$B.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$B.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$B.reset=function($B,$_,$Z){this.elements[0]=$B,this.elements[1]=$_,this.elements[2]=$Z},$$(0,$B,"x",function(){return this.elements[0]},function($B){this.elements[0]=$B}),$$(0,$B,"y",function(){return this.elements[1]},function($B){this.elements[1]=$B}),$$(0,$B,"z",function(){return this.elements[2]},function($B){this.elements[2]=$B}),$T.distanceSquared=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$Z[0]-$n[0],$q=$Z[1]-$n[1],$P=$Z[2]-$n[2];return $g*$g+$q*$q+$P*$P},$T.distance=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$Z[0]-$n[0],$q=$Z[1]-$n[1],$P=$Z[2]-$n[2];return Math.sqrt($g*$g+$q*$q+$P*$P)},$T.min=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=Math.min($g[0],$q[0]),$n[1]=Math.min($g[1],$q[1]),$n[2]=Math.min($g[2],$q[2])},$T.max=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=Math.max($g[0],$q[0]),$n[1]=Math.max($g[1],$q[1]),$n[2]=Math.max($g[2],$q[2])},$T.transformQuat=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements,$P=$g[0],$k=$g[1],$m=$g[2],$D=$q[0],$T=$q[1],$e=$q[2],$I=$q[3],$A=$I*$P+$T*$m-$e*$k,$$=$I*$k+$e*$P-$D*$m,$w=$I*$m+$D*$k-$T*$P,$r=-$D*$P-$T*$k-$e*$m;$n[0]=$A*$I+$r*-$D+$$*-$e-$w*-$T,$n[1]=$$*$I+$r*-$T+$w*-$D-$A*-$e,$n[2]=$w*$I+$r*-$e+$A*-$T-$$*-$D},$T.scalarLength=function($B){var $_=$B.elements,$Z=$_[0],$n=$_[1],$g=$_[2];return Math.sqrt($Z*$Z+$n*$n+$g*$g)},$T.scalarLengthSquared=function($B){var $_=$B.elements,$Z=$_[0],$n=$_[1],$g=$_[2];return $Z*$Z+$n*$n+$g*$g},$T.normalize=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$Z[0],$q=$Z[1],$P=$Z[2],$k=$g*$g+$q*$q+$P*$P;0<$k&&($k=1/Math.sqrt($k),$n[0]=$Z[0]*$k,$n[1]=$Z[1]*$k,$n[2]=$Z[2]*$k)},$T.multiply=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]*$q[0],$n[1]=$g[1]*$q[1],$n[2]=$g[2]*$q[2]},$T.scale=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements;$n[0]=$g[0]*$_,$n[1]=$g[1]*$_,$n[2]=$g[2]*$_},$T.lerp=function($B,$_,$Z,$n){var $g=$n.elements,$q=$B.elements,$P=$_.elements,$k=$q[0],$m=$q[1],$D=$q[2];$g[0]=$k+$Z*($P[0]-$k),$g[1]=$m+$Z*($P[1]-$m),$g[2]=$D+$Z*($P[2]-$D)},$T.transformV3ToV3=function($B,$_,$Z){var $n=$T._tempVector4;$T.transformV3ToV4($B,$_,$n);var $g=$n.elements,$q=$Z.elements;$q[0]=$g[0],$q[1]=$g[1],$q[2]=$g[2]},$T.transformV3ToV4=function($B,$_,$Z){var $n=$B.elements,$g=$n[0],$q=$n[1],$P=$n[2],$k=$_.elements,$m=$Z.elements;$m[0]=$g*$k[0]+$q*$k[4]+$P*$k[8]+$k[12],$m[1]=$g*$k[1]+$q*$k[5]+$P*$k[9]+$k[13],$m[2]=$g*$k[2]+$q*$k[6]+$P*$k[10]+$k[14],$m[3]=$g*$k[3]+$q*$k[7]+$P*$k[11]+$k[15]},$T.TransformNormal=function($B,$_,$Z){var $n=$B.elements,$g=$n[0],$q=$n[1],$P=$n[2],$k=$_.elements,$m=$Z.elements;$m[0]=$g*$k[0]+$q*$k[4]+$P*$k[8],$m[1]=$g*$k[1]+$q*$k[5]+$P*$k[9],$m[2]=$g*$k[2]+$q*$k[6]+$P*$k[10]},$T.transformCoordinate=function($B,$_,$Z){var $n=$T._tempVector4.elements,$g=$B.elements,$q=$g[0],$P=$g[1],$k=$g[2],$m=$_.elements;$n[0]=$q*$m[0]+$P*$m[4]+$k*$m[8]+$m[12],$n[1]=$q*$m[1]+$P*$m[5]+$k*$m[9]+$m[13],$n[2]=$q*$m[2]+$P*$m[6]+$k*$m[10]+$m[14],$n[3]=1/($q*$m[3]+$P*$m[7]+$k*$m[11]+$m[15]);var $D=$Z.elements;$D[0]=$n[0]*$n[3],$D[1]=$n[1]*$n[3],$D[2]=$n[2]*$n[3]},$T.Clamp=function($B,$_,$Z,$n){var $g=$B.elements,$q=$g[0],$P=$g[1],$k=$g[2],$m=$_.elements,$D=$m[0],$T=$m[1],$e=$m[2],$I=$Z.elements,$A=$I[0],$$=$I[1],$w=$I[2],$r=$n.elements;$q=($q=$A<$q?$A:$q)<$D?$D:$q,$P=($P=$$<$P?$$:$P)<$T?$T:$P,$k=($k=$w<$k?$w:$k)<$e?$e:$k,$r[0]=$q,$r[1]=$P,$r[2]=$k},$T.add=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]+$q[0],$n[1]=$g[1]+$q[1],$n[2]=$g[2]+$q[2]},$T.subtract=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]-$q[0],$n[1]=$g[1]-$q[1],$n[2]=$g[2]-$q[2]},$T.cross=function($B,$_,$Z){var $n=$B.elements,$g=$_.elements,$q=$Z.elements,$P=$n[0],$k=$n[1],$m=$n[2],$D=$g[0],$T=$g[1],$e=$g[2];$q[0]=$k*$e-$m*$T,$q[1]=$m*$D-$P*$e,$q[2]=$P*$T-$k*$D},$T.dot=function($B,$_){var $Z=$B.elements,$n=$_.elements;return $Z[0]*$n[0]+$Z[1]*$n[1]+$Z[2]*$n[2]},$T.equals=function($B,$_){var $Z=$B.elements,$n=$_.elements;return $cB.nearEqual(Math.abs($Z[0]),Math.abs($n[0]))&&$cB.nearEqual(Math.abs($Z[1]),Math.abs($n[1]))&&$cB.nearEqual(Math.abs($Z[2]),Math.abs($n[2]))},$T.ZERO=new $T(0,0,0),$T.ONE=new $T(1,1,1),$T.NegativeUnitX=new $T(-1,0,0),$T.UnitX=new $T(1,0,0),$T.UnitY=new $T(0,1,0),$T.UnitZ=new $T(0,0,1),$T.ForwardRH=new $T(0,0,-1),$T.ForwardLH=new $T(0,0,1),$T.Up=new $T(0,1,0),$T.NAN=new $T(NaN,NaN,NaN),$e($T,["_tempVector4",function(){return this._tempVector4=new $k_}]),$T}(),$k_=function(){function $B($B,$_,$Z,$n){this.elements=new Float32Array(4),void 0===$B&&($B=0),void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=0);var $g=this.elements;$g[0]=$B,$g[1]=$_,$g[2]=$Z,$g[3]=$n}$A($B,"laya.d3.math.Vector4");var $_=$B.prototype;return $t.imps($_,{"laya.d3.core.IClone":!0}),$_.fromArray=function($B,$_){void 0===$_&&($_=0),this.elements[0]=$B[$_+0],this.elements[1]=$B[$_+1],this.elements[2]=$B[$_+2],this.elements[3]=$B[$_+3]},$_.cloneTo=function($B){var $_=$B.elements,$Z=this.elements;$_[0]=$Z[0],$_[1]=$Z[1],$_[2]=$Z[2],$_[3]=$Z[3]},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$_.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$_.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$$(0,$_,"x",function(){return this.elements[0]},function($B){this.elements[0]=$B}),$$(0,$_,"y",function(){return this.elements[1]},function($B){this.elements[1]=$B}),$$(0,$_,"z",function(){return this.elements[2]},function($B){this.elements[2]=$B}),$$(0,$_,"w",function(){return this.elements[3]},function($B){this.elements[3]=$B}),$B.lerp=function($B,$_,$Z,$n){var $g=$n.elements,$q=$B.elements,$P=$_.elements,$k=$q[0],$m=$q[1],$D=$q[2],$T=$q[3];$g[0]=$k+$Z*($P[0]-$k),$g[1]=$m+$Z*($P[1]-$m),$g[2]=$D+$Z*($P[2]-$D),$g[3]=$T+$Z*($P[3]-$T)},$B.transformByM4x4=function($B,$_,$Z){var $n=$B.elements,$g=$n[0],$q=$n[1],$P=$n[2],$k=$n[3],$m=$_.elements,$D=$Z.elements;$D[0]=$g*$m[0]+$q*$m[4]+$P*$m[8]+$k*$m[12],$D[1]=$g*$m[1]+$q*$m[5]+$P*$m[9]+$k*$m[13],$D[2]=$g*$m[2]+$q*$m[6]+$P*$m[10]+$k*$m[14],$D[3]=$g*$m[3]+$q*$m[7]+$P*$m[11]+$k*$m[15]},$B.equals=function($B,$_){var $Z=$B.elements,$n=$_.elements;return $cB.nearEqual(Math.abs($Z[0]),Math.abs($n[0]))&&$cB.nearEqual(Math.abs($Z[1]),Math.abs($n[1]))&&$cB.nearEqual(Math.abs($Z[2]),Math.abs($n[2]))&&$cB.nearEqual(Math.abs($Z[3]),Math.abs($n[3]))},$B.normalize=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$B.length();0<$g&&($n[0]=$Z[0]*$g,$n[1]=$Z[1]*$g,$n[2]=$Z[2]*$g,$n[3]=$Z[3]*$g)},$B.add=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]+$q[0],$n[1]=$g[1]+$q[1],$n[2]=$g[2]+$q[2],$n[3]=$g[3]+$q[3]},$B.subtract=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]-$q[0],$n[1]=$g[1]-$q[1],$n[2]=$g[2]-$q[2],$n[3]=$g[3]-$q[3]},$B.multiply=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=$g[0]*$q[0],$n[1]=$g[1]*$q[1],$n[2]=$g[2]*$q[2],$n[3]=$g[3]*$q[3]},$B.scale=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements;$n[0]=$g[0]*$_,$n[1]=$g[1]*$_,$n[2]=$g[2]*$_,$n[3]=$g[3]*$_},$B.Clamp=function($B,$_,$Z,$n){var $g=$B.elements,$q=$g[0],$P=$g[1],$k=$g[2],$m=$g[3],$D=$_.elements,$T=$D[0],$e=$D[1],$I=$D[2],$A=$D[3],$$=$Z.elements,$w=$$[0],$r=$$[1],$j=$$[2],$y=$$[3],$C=$n.elements;$q=($q=$w<$q?$w:$q)<$T?$T:$q,$P=($P=$r<$P?$r:$P)<$e?$e:$P,$k=($k=$j<$k?$j:$k)<$I?$I:$k,$m=($m=$y<$m?$y:$m)<$A?$A:$m,$C[0]=$q,$C[1]=$P,$C[2]=$k,$C[3]=$m},$B.distanceSquared=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$Z[0]-$n[0],$q=$Z[1]-$n[1],$P=$Z[2]-$n[2],$k=$Z[3]-$n[3];return $g*$g+$q*$q+$P*$P+$k*$k},$B.distance=function($B,$_){var $Z=$B.elements,$n=$_.elements,$g=$Z[0]-$n[0],$q=$Z[1]-$n[1],$P=$Z[2]-$n[2],$k=$Z[3]-$n[3];return Math.sqrt($g*$g+$q*$q+$P*$P+$k*$k)},$B.dot=function($B,$_){var $Z=$B.elements,$n=$_.elements;return $Z[0]*$n[0]+$Z[1]*$n[1]+$Z[2]*$n[2]+$Z[3]*$n[3]},$B.min=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=Math.min($g[0],$q[0]),$n[1]=Math.min($g[1],$q[1]),$n[2]=Math.min($g[2],$q[2]),$n[3]=Math.min($g[3],$q[3])},$B.max=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_.elements;$n[0]=Math.max($g[0],$q[0]),$n[1]=Math.max($g[1],$q[1]),$n[2]=Math.max($g[2],$q[2]),$n[3]=Math.max($g[3],$q[3])},$e($B,["ZERO",function(){return this.ZERO=new $B},"ONE",function(){return this.ONE=new $B(1,1,1,1)},"UnitX",function(){return this.UnitX=new $B(1,0,0,0)},"UnitY",function(){return this.UnitY=new $B(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $B(0,0,1,0)},"UnitW",function(){return this.UnitW=new $B(0,0,0,1)}]),$B}(),$m_=function(){function $q($B,$_,$Z,$n){this.minDepth=0,this.maxDepth=1,this.x=$B,this.y=$_,this.width=$Z,this.height=$n}$A($q,"laya.d3.math.Viewport");var $B=$q.prototype;return $B.project=function($B,$_,$Z){$P_.transformV3ToV3($B,$_,$Z);var $n=$B.elements,$g=$_.elements,$q=$Z.elements,$P=$n[0]*$g[3]+$n[1]*$g[7]+$n[2]*$g[11]+$g[15];1!==$P&&($q[0]=$q[0]/$P,$q[1]=$q[1]/$P,$q[2]=$q[2]/$P),$q[0]=.5*($q[0]+1)*this.width+this.x,$q[1]=.5*(1-$q[1])*this.height+this.y,$q[2]=$q[2]*(this.maxDepth-this.minDepth)+this.minDepth},$B.unprojectFromMat=function($B,$_,$Z){var $n=$B.elements,$g=$_.elements,$q=$Z.elements;$q[0]=($n[0]-this.x)/this.width*2-1,$q[1]=-(($n[1]-this.y)/this.height*2-1);var $P=(this.maxDepth-this.minDepth)/2;$q[2]=($n[2]-this.minDepth-$P)/$P;var $k=$q[0]*$g[3]+$q[1]*$g[7]+$q[2]*$g[11]+$g[15];$P_.transformV3ToV3($Z,$_,$Z),1!==$k&&($q[0]=$q[0]/$k,$q[1]=$q[1]/$k,$q[2]=$q[2]/$k)},$B.unprojectFromWVP=function($B,$_,$Z,$n,$g){$B_.multiply($_,$Z,$q._tempMatrix4x4),$n&&$B_.multiply($q._tempMatrix4x4,$n,$q._tempMatrix4x4),$q._tempMatrix4x4.invert($q._tempMatrix4x4),this.unprojectFromMat($B,$q._tempMatrix4x4,$g)},$e($q,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $B_}]),$q}(),$D_=function(){function $L($B){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$B,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$A($L,"laya.d3.resource.models.SubMesh");var $B=$L.prototype;return $t.imps($B,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$B._getVertexBuffer=function($B){return void 0===$B&&($B=0),0===$B?this._vertexBuffer:null},$B._getIndexBuffer=function(){return this._indexBuffer},$B._getStaticBatchBakedVertexs=function($B,$_){var $Z,$n,$g=this._vertexBuffer,$q=$g.vertexDeclaration,$P=$q.getVertexElementByUsage(0).offset/4,$k=$q.getVertexElementByUsage(3).offset/4,$m=$_.meshRender.lightmapScaleOffset,$D=0,$T=0,$e=0,$I=0,$A=0,$$=0;if($m)if($n=$q.getVertexElementByUsage(15))$e=$q.vertexStride/4,$Z=0<this._vertexCount?$g.getData().slice(this._vertexStart*$e,(this._vertexStart+this._vertexCount)*$e):$g.getData().slice(),$I=$n.offset/4;else{$e=($$=$q.vertexStride/4)+2,$Z=this._vertexCount?new Float32Array(this._vertexCount*($g.vertexDeclaration.vertexStride/4+2)):new Float32Array($g.vertexCount*($g.vertexDeclaration.vertexStride/4+2)),$I=($A=$q.getVertexElementByUsage(2).offset/4)+2;var $w=$g.getData();for($D=0,$T=$w.length/$$;$D<$T;$D++){var $r=0;$r=0<this._vertexCount?(this._vertexStart+$D)*$$:$D*$$;var $j=$D*$e,$y=0;for($y=0;$y<$I;$y++)$Z[$j+$y]=$w[$r+$y];for($y=$I;$y<$$;$y++)$Z[$j+$y+2]=$w[$r+$y]}}else $e=$q.vertexStride/4,$Z=this._vertexCount?$g.getData().slice(this._vertexStart*$e,(this._vertexStart+this._vertexCount)*$e):$g.getData().slice();if($B){var $C=$B.worldMatrix,$z=$L._tempMatrix4x40;$C.invert($z);var $t=$L._tempMatrix4x41,$J=$_.transform.worldMatrix;$B_.multiply($z,$J,$t)}else $t=$_.transform.worldMatrix;var $N=$L._tempQuaternion0;for($t.decomposeTransRotScale($L._tempVector30,$N,$L._tempVector31),$D=0,$T=$Z.length/$e;$D<$T;$D++){var $Q=$D*$e+$P,$M=$D*$e+$k;if($r_.transformVector3ArrayToVector3ArrayCoordinate($Z,$Q,$t,$Z,$Q),$r_.transformVector3ArrayByQuat($Z,$M,$N,$Z,$M),$m){var $Y=$D*$e+$I;if($n)$r_.transformLightingMapTexcoordByUV1Array($Z,$Y,$m,$Z,$Y);else{var $l=$D*$$+$A;$r_.transformLightingMapTexcoordByUV0Array($w,$l,$m,$Z,$Y)}}}return $Z},$B._getVertexBuffers=function(){return null},$B._beforeRender=function($B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$B._render=function($B){var $_,$Z=0,$n=$B.renderElement;if(1<this._indexCount){var $g=this._boneIndicesList.length;if(1<$g){for(var $q=0;$q<$g;$q++)($_=$n._skinAnimationDatas||this._skinAnimationDatas)&&($n._shaderValue.setValue(0,$_[$q]),$B._shader.uploadRenderElementUniforms($n._shaderValue.data)),$v.mainContext.drawElements(4,this._subIndexBufferCount[$q],5123,2*this._subIndexBufferStart[$q]);$Q.drawCall+=$g}else($_=$n._skinAnimationDatas||this._skinAnimationDatas)&&($n._shaderValue.setValue(0,$_[0]),$B._shader.uploadRenderElementUniforms($n._shaderValue.data)),$v.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$Q.drawCall++;$Z=this._indexCount}else $Z=this._indexBuffer.indexCount,($_=$n._skinAnimationDatas||this._skinAnimationDatas)&&($n._shaderValue.setValue(0,$_[0]),$B._shader.uploadRenderElementUniforms($n._shaderValue.data)),$v.mainContext.drawElements(4,$Z,5123,0),$Q.drawCall++;$Q.trianglesFaces+=$Z/3},$B.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$B.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$$(0,$B,"_vertexBufferCount",function(){return 1}),$$(0,$B,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$e($L,["_tempVector30",function(){return this._tempVector30=new $P_},"_tempVector31",function(){return this._tempVector31=new $P_},"_tempQuaternion0",function(){return this._tempQuaternion0=new $Z_},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $B_},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $B_}]),$L}(),$T_=function(){function $B($B){this.defineCounter=0,this.defines=null,$B?(this.defineCounter=$B.defineCounter,this.defines=$B.defines.slice()):(this.defineCounter=0,this.defines=[])}return $A($B,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$B.prototype.registerDefine=function($B){var $_=Math.pow(2,this.defineCounter++);return this.defines[$_]=$B,$_},$B}(),$e_=function(){function $B(){}return $A($B,"laya.d3.shader.ShaderInit3D"),$B.__init__=function(){var $B,$_;$Q_._globalRegDefine("HIGHPRECISION",$Q_.SHADERDEFINE_HIGHPRECISION),$Q_._globalRegDefine("FOG",$Q_.SHADERDEFINE_FOG),$Q_._globalRegDefine("DIRECTIONLIGHT",$Q_.SHADERDEFINE_DIRECTIONLIGHT),$Q_._globalRegDefine("POINTLIGHT",$Q_.SHADERDEFINE_POINTLIGHT),$Q_._globalRegDefine("SPOTLIGHT",$Q_.SHADERDEFINE_SPOTLIGHT),$Q_._globalRegDefine("UV",$Q_.SHADERDEFINE_UV0),$Q_._globalRegDefine("COLOR",$Q_.SHADERDEFINE_COLOR),$Q_._globalRegDefine("UV1",$Q_.SHADERDEFINE_UV1),$Q_._globalRegDefine("CASTSHADOW",$A_.SHADERDEFINE_CAST_SHADOW),$Q_._globalRegDefine("SHADOWMAP_PSSM1",$A_.SHADERDEFINE_SHADOW_PSSM1),$Q_._globalRegDefine("SHADOWMAP_PSSM2",$A_.SHADERDEFINE_SHADOW_PSSM2),$Q_._globalRegDefine("SHADOWMAP_PSSM3",$A_.SHADERDEFINE_SHADOW_PSSM3),$Q_._globalRegDefine("SHADOWMAP_PCF_NO",$A_.SHADERDEFINE_SHADOW_PCF_NO),$Q_._globalRegDefine("SHADOWMAP_PCF1",$A_.SHADERDEFINE_SHADOW_PCF1),$Q_._globalRegDefine("SHADOWMAP_PCF2",$A_.SHADERDEFINE_SHADOW_PCF2),$Q_._globalRegDefine("SHADOWMAP_PCF3",$A_.SHADERDEFINE_SHADOW_PCF3),$Q_._globalRegDefine("DEPTHFOG",$Q_.SAHDERDEFINE_DEPTHFOG),$b_.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$b_.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$B={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$_={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $Z=$b_.nameKey.add("SIMPLE");shaderCompile=$Q_.add($Z,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$B,$_),$x_.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$x_.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$x_.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$x_.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$x_.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$x_.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$x_.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$x_.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$x_.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$B}(),$I_=function(){function $B(){this._data=null,this._data=[]}$A($B,"laya.d3.shader.ValusArray");var $_=$B.prototype;return $_.setValue=function($B,$_){this._data[$B]=$_},$$(0,$_,"data",function(){return this._data}),$B}(),$A_=function(){function $B(){}return $B.SHADERDEFINE_RECEIVE_SHADOW=1,$B.SHADERDEFINE_CAST_SHADOW=512,$B.SHADERDEFINE_SHADOW_PSSM1=1024,$B.SHADERDEFINE_SHADOW_PSSM2=2048,$B.SHADERDEFINE_SHADOW_PSSM3=4096,$B.SHADERDEFINE_SHADOW_PCF_NO=8192,$B.SHADERDEFINE_SHADOW_PCF1=16384,$B.SHADERDEFINE_SHADOW_PCF2=32768,$B.SHADERDEFINE_SHADOW_PCF3=65536,$B.MAX_PSSM_COUNT=3,$B}(),$$_=function(){function $S(){}return $A($S,"laya.d3.utils.Picker"),$S.calculateCursorRay=function($B,$_,$Z,$n,$g,$q){var $P=$B.elements[0],$k=$B.elements[1],$m=$S._tempVector30,$D=$m.elements;$D[0]=$P,$D[1]=$k,$D[2]=$_.minDepth;var $T=$S._tempVector31,$e=$T.elements;$e[0]=$P,$e[1]=$k,$e[2]=$_.maxDepth;var $I=$q.origin,$A=$S._tempVector32;$_.unprojectFromWVP($m,$Z,$n,$g,$I),$_.unprojectFromWVP($T,$Z,$n,$g,$A);var $$=$q.direction.elements;$$[0]=$A.x-$I.x,$$[1]=$A.y-$I.y,$$[2]=$A.z-$I.z,$P_.normalize($q.direction,$q.direction)},$S.rayIntersectsPositionsAndIndices=function($B,$_,$Z,$n,$g){for(var $q=$Z.vertexStride/4,$P=$Z.getVertexElementByUsage(0).offset/4,$k=Number.MAX_VALUE,$m=-1,$D=-1,$T=-1,$e=0;$e<$n.length;$e+=3){var $I=$S._tempVector35,$A=$I.elements,$$=$n[$e]*$q,$w=$$+$P;$A[0]=$_[$w],$A[1]=$_[1+$w],$A[2]=$_[2+$w];var $r=$S._tempVector36,$j=$r.elements,$y=$n[$e+1]*$q,$C=$y+$P;$j[0]=$_[$C],$j[1]=$_[1+$C],$j[2]=$_[2+$C];var $z=$S._tempVector37,$t=$z.elements,$J=$n[$e+2]*$q,$N=$J+$P;$t[0]=$_[$N],$t[1]=$_[1+$N],$t[2]=$_[2+$N];var $Q=laya.d3.utils.Picker.rayIntersectsTriangle($B,$I,$r,$z);!isNaN($Q)&&$Q<$k&&($k=$Q,$m=$$,$D=$y,$T=$J)}if($k===Number.MAX_VALUE)return $g.position.toDefault(),$g.distance=Number.MAX_VALUE,$g.trianglePositions[0].toDefault(),$g.trianglePositions[1].toDefault(),$g.trianglePositions[2].toDefault(),$g.triangleNormals[0].toDefault(),$g.triangleNormals[1].toDefault(),$g.triangleNormals[2].toDefault(),!1;$g.distance=$k,$P_.scale($B.direction,$k,$g.position),$P_.add($B.origin,$g.position,$g.position);var $M=$g.trianglePositions,$Y=$M[0],$l=$M[1],$L=$M[2],$v=$Y.elements,$V=$l.elements,$o=$L.elements,$F=$m+$P;$v[0]=$_[$F],$v[1]=$_[$F+1],$v[2]=$_[$F+2];var $u=$D+$P;$V[0]=$_[$u],$V[1]=$_[$u+1],$V[2]=$_[$u+2];var $f=$T+$P;$o[0]=$_[$f],$o[1]=$_[$f+1],$o[2]=$_[$f+2];var $b=$Z.getVertexElementByUsage(3);if($b){var $x=$b.offset/4,$p=$g.triangleNormals,$K=$p[0],$H=$p[1],$G=$p[2],$W=$K.elements,$X=$H.elements,$R=$G.elements,$h=$m+$x;$W[0]=$_[$h],$W[1]=$_[$h+1],$W[2]=$_[$h+2];var $s=$D+$x;$X[0]=$_[$s],$X[1]=$_[$s+1],$X[2]=$_[$s+2];var $U=$T+$x;$R[0]=$_[$U],$R[1]=$_[$U+1],$R[2]=$_[$U+2]}return!0},$S.rayIntersectsTriangle=function($B,$_,$Z,$n){var $g=$S._tempVector30,$q=$S._tempVector31;$P_.subtract($Z,$_,$g),$P_.subtract($n,$_,$q);var $P,$k=$S._tempVector32;if($P_.cross($B.direction,$q,$k),($P=$P_.dot($g,$k))>-Number.MIN_VALUE&&$P<Number.MIN_VALUE)return Number.NaN;var $m,$D=1/$P,$T=$S._tempVector33;if($P_.subtract($B.origin,$_,$T),$m=$P_.dot($T,$k),($m*=$D)<0||1<$m)return Number.NaN;var $e,$I,$A=$S._tempVector34;return $P_.cross($T,$g,$A),$e=$P_.dot($B.direction,$A),($e*=$D)<0||1<$m+$e?Number.NaN:($I=$P_.dot($q,$A),($I*=$D)<0?Number.NaN:$I)},$e($S,["_tempVector30",function(){return this._tempVector30=new $P_},"_tempVector31",function(){return this._tempVector31=new $P_},"_tempVector32",function(){return this._tempVector32=new $P_},"_tempVector33",function(){return this._tempVector33=new $P_},"_tempVector34",function(){return this._tempVector34=new $P_},"_tempVector35",function(){return this._tempVector35=new $P_},"_tempVector36",function(){return this._tempVector36=new $P_},"_tempVector37",function(){return this._tempVector37=new $P_}]),$S}(),$w_=(function(){function $B(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $P_,new $P_,new $P_],this.trianglePositions.length=3,this.triangleNormals=[new $P_,new $P_,new $P_],this.triangleNormals.length=3,this.position=new $P_}$A($B,"laya.d3.utils.RaycastHit"),$B.prototype.cloneTo=function($B){$B.distance=this.distance,this.trianglePositions[0].cloneTo($B.trianglePositions[0]),this.trianglePositions[1].cloneTo($B.trianglePositions[1]),this.trianglePositions[2].cloneTo($B.trianglePositions[2]),this.triangleNormals[0].cloneTo($B.triangleNormals[0]),this.triangleNormals[1].cloneTo($B.triangleNormals[1]),this.triangleNormals[2].cloneTo($B.triangleNormals[2]),this.position.cloneTo($B.position),$B.sprite3D=this.sprite3D}}(),function(){function $B($B,$_){this._width=0,this._height=0,this._width=$B,this._height=$_}$A($B,"laya.d3.utils.Size");var $_=$B.prototype;return $$(0,$_,"width",function(){return-1===this._width?$O.clientWidth:this._width}),$$(0,$_,"height",function(){return-1===this._height?$O.clientHeight:this._height}),$$(1,$B,"fullScreen",function(){return new $B(-1,-1)}),$B}()),$r_=function(){function $F(){}return $A($F,"laya.d3.utils.Utils3D"),$F._rotationTransformScaleSkinAnimation=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e){var $I,$A,$$,$w,$r,$j=$F._tempArray16_0,$y=$F._tempArray16_1,$C=$F._tempArray16_2,$z=$n+$n,$t=$g+$g,$J=$q+$q,$N=$n*$z,$Q=$g*$z,$M=$g*$t,$Y=$q*$z,$l=$q*$t,$L=$q*$J,$v=$P*$z,$V=$P*$t,$o=$P*$J;for($j[15]=1,$j[0]=1-$M-$L,$j[1]=$Q+$o,$j[2]=$Y-$V,$j[4]=$Q-$o,$j[5]=1-$N-$L,$j[6]=$l+$v,$j[8]=$Y+$V,$j[9]=$l-$v,$j[10]=1-$N-$M,$y[15]=1,$y[0]=$k,$y[5]=$m,$y[10]=$D,$I=0;$I<4;$I++)$A=$j[$I],$$=$j[$I+4],$w=$j[$I+8],$r=$j[$I+12],$C[$I]=$A,$C[$I+4]=$$,$C[$I+8]=$w,$C[$I+12]=$A*$B+$$*$_+$w*$Z+$r;for($I=0;$I<4;$I++)$A=$C[$I],$$=$C[$I+4],$w=$C[$I+8],$r=$C[$I+12],$T[$I+$e]=$A*$y[0]+$$*$y[1]+$w*$y[2]+$r*$y[3],$T[$I+$e+4]=$A*$y[4]+$$*$y[5]+$w*$y[6]+$r*$y[7],$T[$I+$e+8]=$A*$y[8]+$$*$y[9]+$w*$y[10]+$r*$y[11],$T[$I+$e+12]=$A*$y[12]+$$*$y[13]+$w*$y[14]+$r*$y[15]},$F._createNodeByJson=function($B,$_,$Z,$n){if(!$Z)switch($_.type){case"Sprite3D":$Z=new $f_;break;case"MeshSprite3D":$Z=new $S_;break;case"SkinnedMeshSprite3D":$Z=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$Z=new ShuriKenParticle3D;break;case"TrailSprite3D":$Z=new TrailSprite3D;break;case"Terrain":$Z=new Terrain;break;case"Camera":$Z=new $U_;break;case"DirectionLight":$Z=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $g=$_.props;if($g)for(var $q in $g)$Z[$q]=$g[$q];var $P=$_.customProps;$P&&($Z instanceof laya.d3.core.Sprite3D?($Z._parseBaseCustomProps($P),$Z._parseCustomProps($B,$n,$P,$_),$Z._parseCustomComponent($B,$n,$_.components)):$Z._parseCustomProps($B,$n,$P,$_));var $k=$_.child;if($k)for(var $m=0,$D=$k.length;$m<$D;$m++){var $T=$F._createNodeByJson($B,$k[$m],null,$n);$Z.addChild($T)}return $Z},$F._computeBoneAndAnimationDatasByBindPoseMatrxix=function($B,$_,$Z,$n,$g,$q){var $P,$k,$m=0,$D=0,$T=$B.length;for($P=0;$P<$T;$m+=$B[$P].keyframeWidth,$D+=16,$P++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($_[$m+0],$_[$m+1],$_[$m+2],$_[$m+3],$_[$m+4],$_[$m+5],$_[$m+6],$_[$m+7],$_[$m+8],$_[$m+9],$n,$D),0!=$P&&($k=16*$B[$P].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($n,$k,$n,$D,$n,$D));var $e=$Z.length;for($P=0;$P<$e;$P++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($n,16*$q[$P],$Z[$P],$g,16*$P)},$F._computeAnimationDatasByArrayAndMatrixFast=function($B,$_,$Z,$n){for(var $g=0,$q=$B.length;$g<$q;$g++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($_,16*$n[$g],$B[$g],$Z,16*$g)},$F._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($B,$_,$Z,$n,$g){var $q,$P,$k=0,$m=0,$D=$B.length;for($q=0;$q<$D;$k+=$B[$q].keyframeWidth,$m+=16,$q++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($_[$k+7],$_[$k+8],$_[$k+9],$_[$k+3],$_[$k+4],$_[$k+5],$_[$k+6],$_[$k+0],$_[$k+1],$_[$k+2],$n,$m),0!=$q&&($P=16*$B[$q].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($n,$P,$n,$m,$n,$m));var $T=$Z.length;for($q=0;$q<$T;$q++){var $e=16*$q;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($n,$e,$Z[$q],$g,$e)}},$F._computeAnimationDatasByArrayAndMatrixFastOld=function($B,$_,$Z){for(var $n=$B.length,$g=0;$g<$n;$g++){var $q=16*$g;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($_,$q,$B[$g],$Z,$q)}},$F._computeRootAnimationData=function($B,$_,$Z){for(var $n=0,$g=0,$q=0,$P=$B.length;$n<$P;$g+=$B[$n].keyframeWidth,$q+=16,$n++)laya.d3.utils.Utils3D.createAffineTransformationArray($_[$g+0],$_[$g+1],$_[$g+2],$_[$g+3],$_[$g+4],$_[$g+5],$_[$g+6],$_[$g+7],$_[$g+8],$_[$g+9],$Z,$q)},$F.transformVector3ArrayByQuat=function($B,$_,$Z,$n,$g){var $q=$Z.elements,$P=$B[$_],$k=$B[$_+1],$m=$B[$_+2],$D=$q[0],$T=$q[1],$e=$q[2],$I=$q[3],$A=$I*$P+$T*$m-$e*$k,$$=$I*$k+$e*$P-$D*$m,$w=$I*$m+$D*$k-$T*$P,$r=-$D*$P-$T*$k-$e*$m;$n[$g]=$A*$I+$r*-$D+$$*-$e-$w*-$T,$n[$g+1]=$$*$I+$r*-$T+$w*-$D-$A*-$e,$n[$g+2]=$w*$I+$r*-$e+$A*-$T-$$*-$D},$F.mulMatrixByArray=function($B,$_,$Z,$n,$g,$q){var $P,$k,$m,$D,$T;if($g===$Z){for($Z=$F._tempArray16_3,$P=0;$P<16;++$P)$Z[$P]=$g[$q+$P];$n=0}for($P=0;$P<4;$P++)$k=$B[$_+$P],$m=$B[$_+$P+4],$D=$B[$_+$P+8],$T=$B[$_+$P+12],$g[$q+$P]=$k*$Z[$n+0]+$m*$Z[$n+1]+$D*$Z[$n+2]+$T*$Z[$n+3],$g[$q+$P+4]=$k*$Z[$n+4]+$m*$Z[$n+5]+$D*$Z[$n+6]+$T*$Z[$n+7],$g[$q+$P+8]=$k*$Z[$n+8]+$m*$Z[$n+9]+$D*$Z[$n+10]+$T*$Z[$n+11],$g[$q+$P+12]=$k*$Z[$n+12]+$m*$Z[$n+13]+$D*$Z[$n+14]+$T*$Z[$n+15]},$F.mulMatrixByArrayFast=function($B,$_,$Z,$n,$g,$q){var $P,$k,$m,$D,$T;for($P=0;$P<4;$P++)$k=$B[$_+$P],$m=$B[$_+$P+4],$D=$B[$_+$P+8],$T=$B[$_+$P+12],$g[$q+$P]=$k*$Z[$n+0]+$m*$Z[$n+1]+$D*$Z[$n+2]+$T*$Z[$n+3],$g[$q+$P+4]=$k*$Z[$n+4]+$m*$Z[$n+5]+$D*$Z[$n+6]+$T*$Z[$n+7],$g[$q+$P+8]=$k*$Z[$n+8]+$m*$Z[$n+9]+$D*$Z[$n+10]+$T*$Z[$n+11],$g[$q+$P+12]=$k*$Z[$n+12]+$m*$Z[$n+13]+$D*$Z[$n+14]+$T*$Z[$n+15]},$F.mulMatrixByArrayAndMatrixFast=function($B,$_,$Z,$n,$g){var $q,$P,$k,$m,$D,$T=$Z.elements,$e=$T[0],$I=$T[1],$A=$T[2],$$=$T[3],$w=$T[4],$r=$T[5],$j=$T[6],$y=$T[7],$C=$T[8],$z=$T[9],$t=$T[10],$J=$T[11],$N=$T[12],$Q=$T[13],$M=$T[14],$Y=$T[15],$l=$_,$L=$_+4,$v=$_+8,$V=$_+12,$o=$g,$F=$g+4,$u=$g+8,$f=$g+12;for($q=0;$q<4;$q++)$P=$B[$l+$q],$k=$B[$L+$q],$m=$B[$v+$q],$D=$B[$V+$q],$n[$o+$q]=$P*$e+$k*$I+$m*$A+$D*$$,$n[$F+$q]=$P*$w+$k*$r+$m*$j+$D*$y,$n[$u+$q]=$P*$C+$k*$z+$m*$t+$D*$J,$n[$f+$q]=$P*$N+$k*$Q+$m*$M+$D*$Y},$F.createAffineTransformationArray=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e){var $I=$n+$n,$A=$g+$g,$$=$q+$q,$w=$n*$I,$r=$n*$A,$j=$n*$$,$y=$g*$A,$C=$g*$$,$z=$q*$$,$t=$P*$I,$J=$P*$A,$N=$P*$$;$T[$e+0]=(1-($y+$z))*$k,$T[$e+1]=($r+$N)*$k,$T[$e+2]=($j-$J)*$k,$T[$e+3]=0,$T[$e+4]=($r-$N)*$m,$T[$e+5]=(1-($w+$z))*$m,$T[$e+6]=($C+$t)*$m,$T[$e+7]=0,$T[$e+8]=($j+$J)*$D,$T[$e+9]=($C-$t)*$D,$T[$e+10]=(1-($w+$y))*$D,$T[$e+11]=0,$T[$e+12]=$B,$T[$e+13]=$_,$T[$e+14]=$Z,$T[$e+15]=1},$F.transformVector3ArrayToVector3ArrayCoordinate=function($B,$_,$Z,$n,$g){var $q=$F._tempArray4_0,$P=$B[$_+0],$k=$B[$_+1],$m=$B[$_+2],$D=$Z.elements;$q[0]=$P*$D[0]+$k*$D[4]+$m*$D[8]+$D[12],$q[1]=$P*$D[1]+$k*$D[5]+$m*$D[9]+$D[13],$q[2]=$P*$D[2]+$k*$D[6]+$m*$D[10]+$D[14],$q[3]=1/($P*$D[3]+$k*$D[7]+$m*$D[11]+$D[15]),$n[$g+0]=$q[0]*$q[3],$n[$g+1]=$q[1]*$q[3],$n[$g+2]=$q[2]*$q[3]},$F.transformLightingMapTexcoordByUV0Array=function($B,$_,$Z,$n,$g){var $q=$Z.elements;$n[$g+0]=$B[$_+0]*$q[0]+$q[2],$n[$g+1]=($B[$_+1]-1)*$q[1]+$q[3]},$F.transformLightingMapTexcoordByUV1Array=function($B,$_,$Z,$n,$g){var $q=$Z.elements;$n[$g+0]=$B[$_+0]*$q[0]+$q[2],$n[$g+1]=1+$B[$_+1]*$q[1]+$q[3]},$F.getURLVerion=function($B){var $_=$B.indexOf("?");return 0<=$_?$B.substr($_):null},$F._quaternionCreateFromYawPitchRollArray=function($B,$_,$Z,$n){var $g=.5*$Z,$q=.5*$_,$P=.5*$B,$k=Math.sin($g),$m=Math.cos($g),$D=Math.sin($q),$T=Math.cos($q),$e=Math.sin($P),$I=Math.cos($P);$n[0]=$I*$D*$m+$e*$T*$k,$n[1]=$e*$T*$m-$I*$D*$k,$n[2]=$I*$T*$k-$e*$D*$m,$n[3]=$I*$T*$m+$e*$D*$k},$F._createAffineTransformationArray=function($B,$_,$Z,$n){var $g=$_[0],$q=$_[1],$P=$_[2],$k=$_[3],$m=$g+$g,$D=$q+$q,$T=$P+$P,$e=$g*$m,$I=$g*$D,$A=$g*$T,$$=$q*$D,$w=$q*$T,$r=$P*$T,$j=$k*$m,$y=$k*$D,$C=$k*$T,$z=$Z[0],$t=$Z[1],$J=$Z[2];$n[0]=(1-($$+$r))*$z,$n[1]=($I+$C)*$z,$n[2]=($A-$y)*$z,$n[3]=0,$n[4]=($I-$C)*$t,$n[5]=(1-($e+$r))*$t,$n[6]=($w+$j)*$t,$n[7]=0,$n[8]=($A+$y)*$J,$n[9]=($w-$j)*$J,$n[10]=(1-($e+$$))*$J,$n[11]=0,$n[12]=$B[0],$n[13]=$B[1],$n[14]=$B[2],$n[15]=1},$F._mulMatrixArray=function($B,$_,$Z,$n){var $g,$q,$P,$k,$m,$D=$_.elements,$T=$D[0],$e=$D[1],$I=$D[2],$A=$D[3],$$=$D[4],$w=$D[5],$r=$D[6],$j=$D[7],$y=$D[8],$C=$D[9],$z=$D[10],$t=$D[11],$J=$D[12],$N=$D[13],$Q=$D[14],$M=$D[15],$Y=$n,$l=$n+4,$L=$n+8,$v=$n+12;for($g=0;$g<4;$g++)$q=$B[$g],$P=$B[$g+4],$k=$B[$g+8],$m=$B[$g+12],$Z[$Y+$g]=$q*$T+$P*$e+$k*$I+$m*$A,$Z[$l+$g]=$q*$$+$P*$w+$k*$r+$m*$j,$Z[$L+$g]=$q*$y+$P*$C+$k*$z+$m*$t,$Z[$v+$g]=$q*$J+$P*$N+$k*$Q+$m*$M},$F.getYawPitchRoll=function($B,$_){$F.transformQuat($P_.ForwardRH,$B,$Z_.TEMPVector31),$F.transformQuat($P_.Up,$B,$Z_.TEMPVector32);var $Z=$Z_.TEMPVector32.elements;$F.angleTo($P_.ZERO,$Z_.TEMPVector31,$Z_.TEMPVector33);var $n=$Z_.TEMPVector33.elements;$n[0]==Math.PI/2?($n[1]=$F.arcTanAngle($Z[2],$Z[0]),$n[2]=0):$n[0]==-Math.PI/2?($n[1]=$F.arcTanAngle(-$Z[2],-$Z[0]),$n[2]=0):($B_.createRotationY(-$n[1],$Z_.TEMPMatrix0),$B_.createRotationX(-$n[0],$Z_.TEMPMatrix1),$P_.transformCoordinate($Z_.TEMPVector32,$Z_.TEMPMatrix0,$Z_.TEMPVector32),$P_.transformCoordinate($Z_.TEMPVector32,$Z_.TEMPMatrix1,$Z_.TEMPVector32),$n[2]=$F.arcTanAngle($Z[1],-$Z[0])),$n[1]<=-Math.PI&&($n[1]=Math.PI),$n[2]<=-Math.PI&&($n[2]=Math.PI),$n[1]>=Math.PI&&$n[2]>=Math.PI&&($n[1]=0,$n[2]=0,$n[0]=Math.PI-$n[0]),$_[0]=$n[1],$_[1]=$n[0],$_[2]=$n[2]},$F.arcTanAngle=function($B,$_){return 0==$B?1==$_?Math.PI/2:-Math.PI/2:0<$B?Math.atan($_/$B):$B<0?0<$_?Math.atan($_/$B)+Math.PI:Math.atan($_/$B)-Math.PI:0},$F.angleTo=function($B,$_,$Z){$P_.subtract($_,$B,$Z_.TEMPVector30),$P_.normalize($Z_.TEMPVector30,$Z_.TEMPVector30),$Z.elements[0]=Math.asin($Z_.TEMPVector30.y),$Z.elements[1]=$F.arcTanAngle(-$Z_.TEMPVector30.z,-$Z_.TEMPVector30.x)},$F.transformQuat=function($B,$_,$Z){var $n=$Z.elements,$g=$B.elements,$q=$_,$P=$g[0],$k=$g[1],$m=$g[2],$D=$q[0],$T=$q[1],$e=$q[2],$I=$q[3],$A=$I*$P+$T*$m-$e*$k,$$=$I*$k+$e*$P-$D*$m,$w=$I*$m+$D*$k-$T*$P,$r=-$D*$P-$T*$k-$e*$m;$n[0]=$A*$I+$r*-$D+$$*-$e-$w*-$T,$n[1]=$$*$I+$r*-$T+$w*-$D-$A*-$e,$n[2]=$w*$I+$r*-$e+$A*-$T-$$*-$D},$F.quaterionNormalize=function($B,$_){var $Z=$B[0],$n=$B[1],$g=$B[2],$q=$B[3],$P=$Z*$Z+$n*$n+$g*$g+$q*$q;0<$P&&($P=1/Math.sqrt($P),$_[0]=$Z*$P,$_[1]=$n*$P,$_[2]=$g*$P,$_[3]=$q*$P)},$F.matrix4x4MultiplyFFF=function($B,$_,$Z){var $n,$g,$q,$P,$k;if($Z===$_)for($_=new Float32Array(16),$n=0;$n<16;++$n)$_[$n]=$Z[$n];for($n=0;$n<4;$n++)$g=$B[$n],$q=$B[$n+4],$P=$B[$n+8],$k=$B[$n+12],$Z[$n]=$g*$_[0]+$q*$_[1]+$P*$_[2]+$k*$_[3],$Z[$n+4]=$g*$_[4]+$q*$_[5]+$P*$_[6]+$k*$_[7],$Z[$n+8]=$g*$_[8]+$q*$_[9]+$P*$_[10]+$k*$_[11],$Z[$n+12]=$g*$_[12]+$q*$_[13]+$P*$_[14]+$k*$_[15]},$F.matrix4x4MultiplyMFM=function($B,$_,$Z){$F.matrix4x4MultiplyFFF($B.elements,$_,$Z.elements)},$e($F,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $P_},"_tempVector3_1",function(){return this._tempVector3_1=new $P_},"_tempVector3_2",function(){return this._tempVector3_2=new $P_},"_tempVector3_3",function(){return this._tempVector3_3=new $P_},"_tempVector3_4",function(){return this._tempVector3_4=new $P_},"_tempVector3_5",function(){return this._tempVector3_5=new $P_},"_tempVector3_6",function(){return this._tempVector3_6=new $P_},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$F}(),$j_=function(){function $V(){}return $A($V,"Laya3D"),$V._cancelLoadByUrl=function($B){$t.loader.cancelLoadByUrl($B),$V._innerFirstLevelLoaderManager.cancelLoadByUrl($B),$V._innerSecondLevelLoaderManager.cancelLoadByUrl($B),$V._innerThirdLevelLoaderManager.cancelLoadByUrl($B),$V._innerFourthLevelLoaderManager.cancelLoadByUrl($B)},$V._changeWebGLSize=function($B,$_){$v.onStageResize($B,$_),$O.clientWidth=$B,$O.clientHeight=$_},$V.__init__=function(){var $B=$_.createMap;$B.lh=[$f_,"SPRITE3DHIERARCHY"],$B.ls=[$u_,"SPRITE3DHIERARCHY"],$B.lm=[$W_,"MESH"],$B.lmat=[$x_,"MATERIAL"],$B.jpg=[$R_,"nativeimage"],$B.jpeg=[$R_,"nativeimage"],$B.png=[$R_,"nativeimage"],$B.pkm=[$R_,"arraybuffer"],$B.raw=[$H_,"arraybuffer"],$B.mipmaps=[$H_,"arraybuffer"],$j.parserMap.SPRITE3DHIERARCHY=$V._loadHierarchy,$j.parserMap.MESH=$V._loadMesh,$j.parserMap.MATERIAL=$V._loadMaterial,$j.parserMap.TEXTURECUBE=$V._loadTextureCube,$j.parserMap.TERRAIN=$V._loadTerrain,$V._innerFirstLevelLoaderManager.on("error",null,$V._eventLoadManagerError),$V._innerSecondLevelLoaderManager.on("error",null,$V._eventLoadManagerError),$V._innerThirdLevelLoaderManager.on("error",null,$V._eventLoadManagerError),$V._innerFourthLevelLoaderManager.on("error",null,$V._eventLoadManagerError)},$V.READ_BLOCK=function(){return $V._readData.pos+=4,!0},$V.READ_DATA=function(){return $V._DATA.offset=$V._readData.getUint32(),$V._DATA.size=$V._readData.getUint32(),!0},$V.READ_STRINGS=function(){var $B=[],$_={offset:0,size:0};$_.offset=$V._readData.getUint16(),$_.size=$V._readData.getUint16();$V._readData.pos;$V._readData.pos=$_.offset+$V._DATA.offset;for(var $Z=0;$Z<$_.size;$Z++){var $n=$V._readData.readUTFString();-1===$n.lastIndexOf(".lmat")&&-1===$n.lastIndexOf(".lpbr")||$B.push($n)}return $B},$V.formatRelativePath=function($B,$_){var $Z;if("."===$_.charAt(0)){for(var $n=($B+$_).split("/"),$g=0,$q=$n.length;$g<$q;$g++)if(".."==$n[$g]){var $P=$g-1;0<$P&&".."!==$n[$P]&&($n.splice($P,2),$g-=2)}$Z=$n.join("/")}else $Z=$B+$_;return null!=$L.customFormat&&($Z=$L.customFormat($Z,null)),$Z},$V._eventLoadManagerError=function($B){$t.loader.event("error",$B)},$V._addHierarchyInnerUrls=function($B,$_,$Z,$n,$g,$q){var $P=$V.formatRelativePath($n,$g);$Z&&($P+=$Z),$B.push({url:$P,clas:$q}),$_[$g]=$P},$V._getSprite3DHierarchyInnerUrls=function($B,$_,$Z,$n,$g,$q,$P){var $k,$m=0,$D=0;switch($B.type){case"Scene":var $T=$B.customProps.lightmaps;for($m=0,$D=$T.length;$m<$D;$m++){var $e=$T[$m].replace(".exr",".png");$V._addHierarchyInnerUrls($n,$g,$q,$P,$e,$R_)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $I;if($B.instanceParams)($I=$B.instanceParams.loadPath)&&$V._addHierarchyInnerUrls($_,$g,$q,$P,$I,$W_);else{($I=($k=$B.customProps).meshPath)&&$V._addHierarchyInnerUrls($_,$g,$q,$P,$I,$W_);var $A=$k.materials;if($A)for($m=0,$D=$A.length;$m<$D;$m++){for(var $$=$A[$m],$w=$$.type.split("."),$r=$o.window,$j=0,$y=$w.length;$j<$y;++$j){$r=$r[this.clasPaths[$j]]}if("function"!=typeof $r)throw"_getSprite3DHierarchyInnerUrls 错误: "+$$.type+" 不是类";$V._addHierarchyInnerUrls($Z,$g,$q,$P,$$.path,$r)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $C=($k=$B.customProps).meshPath;$C&&$V._addHierarchyInnerUrls($_,$g,$q,$P,$C,$W_);var $z=$k.material;if($z){$w=$z.type.split("."),$r=$o.window;for($j=0,$y=$w.length;$j<$y;++$j){$r=$r[this.clasPaths[$j]]}$V._addHierarchyInnerUrls($Z,$g,$q,$P,$z.path,$r)}else{var $t=$k.materialPath;if($t)$V._addHierarchyInnerUrls($Z,$g,$q,$P,$t,ShurikenParticleMaterial);else{var $J=$k.texturePath;$J&&$V._addHierarchyInnerUrls($n,$g,$q,$P,$J,$R_)}}break;case"Terrain":$V._addHierarchyInnerUrls($n,$g,$q,$P,$B.customProps.dataPath,TerrainRes)}var $N=$B.components;for(var $Q in $N){var $M=$N[$Q];switch($Q){case"Animator":var $Y=$M.avatarPath;if($Y)$V._addHierarchyInnerUrls($n,$g,$q,$P,$Y,Avatar);else{var $l=$M.avatar;$l&&$V._addHierarchyInnerUrls($n,$g,$q,$P,$l.path,Avatar)}var $L=$M.clipPaths;for($m=0,$D=$L.length;$m<$D;$m++)$V._addHierarchyInnerUrls($n,$g,$q,$P,$L[$m],AnimationClip)}}var $v=$B.child;for($m=0,$D=$v.length;$m<$D;$m++)$V._getSprite3DHierarchyInnerUrls($v[$m],$_,$Z,$n,$g,$q,$P)},$V._loadHierarchy=function($B){$B.on("loaded",null,$V._onHierarchylhLoaded,[$B,$B._class._getGroup()]),$B.load($B.url,"json",!1,null,!0)},$V._onHierarchylhLoaded=function($B,$_,$Z){if($B._class.destroyed)$B.endLoad();else{var $n=$B.url,$g=$r_.getURLVerion($n),$q=$L.getPath($n),$P=[],$k=[],$m=[],$D={};$V._getSprite3DHierarchyInnerUrls($Z,$P,$k,$m,$D,$g,$q);var $T=$P.length+$k.length+$m.length,$e=$T+1,$I=1/$e;if($V._onProcessChange($B,0,$I,1),0<$m.length){var $A=$T/$e,$$=$l.create(null,$V._onProcessChange,[$B,$I,$A],!1);$V._innerFourthLevelLoaderManager.create($m,$l.create(null,$V._onHierarchyInnerForthLevResouLoaded,[$B,$_,$$,$Z,$D,$P,$k,$I+$A*$m.length,$A]),$$,null,null,1,!0,$_)}else $V._onHierarchyInnerForthLevResouLoaded($B,$_,null,$Z,$D,$P,$k,$I,$A)}},$V._onHierarchyInnerForthLevResouLoaded=function($B,$_,$Z,$n,$g,$q,$P,$k,$m){if($B._class.destroyed)$B.endLoad();else if($Z&&$Z.recover(),0<$P.length){var $D=$l.create(null,$V._onProcessChange,[$B,$k,$m],!1);$V._innerSecondLevelLoaderManager.create($P,$l.create(null,$V._onHierarchyInnerSecondLevResouLoaded,[$B,$_,$D,$n,$g,$q,$k+$m*$P.length,$m]),$Z,null,null,1,!0,$_)}else $V._onHierarchyInnerSecondLevResouLoaded($B,$_,null,$n,$g,$q,$k,$m)},$V._onHierarchyInnerSecondLevResouLoaded=function($B,$_,$Z,$n,$g,$q,$P,$k){if($B._class.destroyed)$B.endLoad();else if($Z&&$Z.recover(),0<$q.length){var $m=$l.create(null,$V._onProcessChange,[$B,$P,$k],!1);$V._innerFirstLevelLoaderManager.create($q,$l.create(null,$V._onHierarchyInnerFirstLevResouLoaded,[$B,$m,$n,$g]),$Z,null,null,1,!0,$_)}else $V._onHierarchyInnerFirstLevResouLoaded($B,null,$n,$g)},$V._onHierarchyInnerFirstLevResouLoaded=function($B,$_,$Z,$n){$_&&$_.recover(),$B.endLoad([$Z,$n])},$V._loadTerrain=function($B){$B.on("loaded",null,$V._onTerrainLtLoaded,[$B,$B._class._getGroup()]),$B.load($B.url,"json",!1,null,!0)},$V._onTerrainLtLoaded=function($B,$_,$Z){if($B._class.destroyed)$B.endLoad();else{var $n,$g,$q=$B.url,$P=$r_.getURLVerion($q),$k=$L.getPath($q),$m=[],$D={},$T=0,$e=0,$I=$Z.heightData;$n=$I.url,$g=$V.formatRelativePath($k,$n),$P&&($g+=$P),$n=$D[$n]=$g;var $A=$Z.detailTexture;for($T=0,$e=$A.length;$T<$e;$T++)$m.push({url:$A[$T].diffuse});var $$=$Z.normalMap;for($T=0,$e=$$.length;$T<$e;$T++)$m.push({url:$$[$T]});var $w=$Z.alphaMap;for($T=0,$e=$w.length;$T<$e;$T++)$m.push({url:$w[$T],params:[!1,!1,6408,!0]});for($T=0,$e=$m.length;$T<$e;$T++){var $r=$m[$T].url;$g=$V.formatRelativePath($k,$r),$P&&($g+=$P),$m[$T].url=$g,$D[$r]=$g}var $j=$m.length,$y=$j+2,$C=1/$y;$V._onProcessChange($B,0,$C,1);var $z={heightMapLoaded:!1,texturesLoaded:!1},$t=$l.create(null,$V._onProcessChange,[$B,$C,$C],!1);$V._innerFourthLevelLoaderManager.create($n,$l.create(null,$V._onTerrainHeightMapLoaded,[$B,$t,$Z,$D,$z]),$t,null,[$I.numX,$I.numZ,$I.bitType,$I.value],1,!0,$_);var $J=$l.create(null,$V._onProcessChange,[$B,2*$C,$j/$y],!1);$V._innerFourthLevelLoaderManager.create($m,$l.create(null,$V._onTerrainTexturesLoaded,[$B,$J,$Z,$D,$z]),$J,null,null,1,!0,$_)}},$V._onTerrainHeightMapLoaded=function($B,$_,$Z,$n,$g){$g.heightMapLoaded=!0,$g.texturesLoaded&&($B.endLoad([$Z,$n]),$_.recover())},$V._onTerrainTexturesLoaded=function($B,$_,$Z,$n,$g){$g.texturesLoaded=!0,$g.heightMapLoaded&&($B.endLoad([$Z,$n]),$_.recover())},$V._loadMesh=function($B){$B.on("loaded",null,$V._onMeshLmLoaded,[$B,$B._class._getGroup()]),$B.load($B.url,"arraybuffer",!1,null,!0)},$V._onMeshLmLoaded=function($B,$_,$Z){if($B._class.destroyed)$B.endLoad();else{var $n,$g,$q,$P=$B.url,$k=$r_.getURLVerion($P),$m=$L.getPath($P),$D={},$T=0,$e=0;switch(($V._readData=new $J($Z)).pos=0,$V._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $I=$V._readData.getUint32();$V._readData.pos=$V._readData.pos+4,$e=$V._readData.getUint16(),$V._readData.pos=$V._readData.pos+8*$e;var $A=$V._readData.getUint32();for($e=$V._readData.getUint16(),$V._readData.pos=$I+$A,$n=[],$T=0;$T<$e;$T++){var $$=$V._readData.readUTFString();-1!==$$.lastIndexOf(".lmat")&&$n.push($$)}break;default:for($V.READ_BLOCK(),$T=0;$T<2;$T++){var $w=$V._readData.getUint16(),$r=$V._strings[$w],$j=$V["READ_"+$r];if(null==$j)throw new Error("model file err,no this function:"+$w+" "+$r);1===$T?$n=$j.call():$j.call()}}for($T=0,$q=$n.length;$T<$q;$T++){var $y=$n[$T];$g=$V.formatRelativePath($m,$y),$k&&($g+=$k),$n[$T]=$g,$D[$y]=$g}if(0<$n.length){$V._onProcessChange($B,0,.5,1);var $C=$l.create(null,$V._onProcessChange,[$B,.5,.5],!1);$V._innerSecondLevelLoaderManager.create($n,$l.create(null,$V._onMeshMateialLoaded,[$B,$C,$Z,$D]),$C,null,null,1,!0,$_)}else $B.endLoad([$Z,$D])}},$V._onMeshMateialLoaded=function($B,$_,$Z,$n){$B.endLoad([$Z,$n]),$_.recover()},$V._getMaterialTexturePath=function($B,$_,$Z){var $n=$B.length-4;return $B.indexOf(".dds")!=$n&&$B.indexOf(".tga")!=$n&&$B.indexOf(".exr")!=$n&&$B.indexOf(".DDS")!=$n&&$B.indexOf(".TGA")!=$n&&$B.indexOf(".EXR")!=$n||($B=$B.substr(0,$n)+".png"),$B=$V.formatRelativePath($Z,$B),$_&&($B+=$_),$B},$V._loadMaterial=function($B){$B.on("loaded",null,$V._onMaterilLmatLoaded,[$B,$B._class._getGroup()]),$B.load($B.url,"json",!1,null,!0)},$V._onMaterilLmatLoaded=function($B,$_,$Z){if($B._class.destroyed)$B.endLoad();else{var $n,$g=$B.url,$q=$r_.getURLVerion($g),$P=$L.getPath($g),$k=[],$m={},$D=$Z.customProps,$T=$Z.version;if($T)switch($T){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $e=$Z.props.textures,$I=0,$A=$e.length;$I<$A;$I++){var $$=$e[$I],$w=$$.path;if($w){var $r=$w.length-4;$w.indexOf(".exr")!=$r&&$w.indexOf(".EXR")!=$r||($w=$w.substr(0,$r)+".png"),$n=$V.formatRelativePath($P,$w),$q&&($n+=$q),$k.push({url:$n,params:$$.params}),$m[$w]=$n}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $j=$D.diffuseTexture.texture2D;if($j&&($n=$V._getMaterialTexturePath($j,$q,$P),$k.push($n),$m[$j]=$n),$D.normalTexture){var $y=$D.normalTexture.texture2D;$y&&($n=$V._getMaterialTexturePath($y,$q,$P),$k.push($n),$m[$y]=$n)}if($D.specularTexture){var $C=$D.specularTexture.texture2D;$C&&($n=$V._getMaterialTexturePath($C,$q,$P),$k.push($n),$m[$C]=$n)}if($D.emissiveTexture){var $z=$D.emissiveTexture.texture2D;$z&&($n=$V._getMaterialTexturePath($z,$q,$P),$k.push($n),$m[$z]=$n)}if($D.ambientTexture){var $t=$D.ambientTexture.texture2D;$t&&($n=$V._getMaterialTexturePath($t,$q,$P),$k.push($n),$m[$t]=$n)}if($D.reflectTexture){var $J=$D.reflectTexture.texture2D;$J&&($n=$V._getMaterialTexturePath($J,$q,$P),$k.push($n),$m[$J]=$n)}}var $N=$k.length,$Q=$N+1,$M=1/$Q;if($V._onProcessChange($B,0,$M,1),0<$N){var $Y=$l.create(null,$V._onProcessChange,[$B,$M,$N/$Q],!1);$V._innerFourthLevelLoaderManager.create($k,$l.create(null,$V._onMateialTexturesLoaded,[$B,$Y,$Z,$m]),$Y,$R_,null,1,!0,$_)}else $V._onMateialTexturesLoaded($B,null,$Z,null)}},$V._onMateialTexturesLoaded=function($B,$_,$Z,$n){$B.endLoad([$Z,$n]),$_&&$_.recover()},$V._loadTextureCube=function($B){$B.on("loaded",null,$V._onTextureCubeLtcLoaded,[$B]),$B.load($B.url,"json",!1,null,!0)},$V._onTextureCubeLtcLoaded=function($B,$_){if($B._class.destroyed)$B.endLoad();else{var $Z=$L.getPath($B.url),$n=[$V.formatRelativePath($Z,$_.px),$V.formatRelativePath($Z,$_.nx),$V.formatRelativePath($Z,$_.py),$V.formatRelativePath($Z,$_.ny),$V.formatRelativePath($Z,$_.pz),$V.formatRelativePath($Z,$_.nz)];$V._onProcessChange($B,0,1/7,1);var $g=$l.create(null,$V._onProcessChange,[$B,1/7,6/7],!1);$V._innerFourthLevelLoaderManager.load($n,$l.create(null,$V._onTextureCubeImagesLoaded,[$B,$n,$g]),$g,"nativeimage")}},$V._onTextureCubeImagesLoaded=function($B,$_,$Z){var $n=[];$n.length=6;for(var $g=0;$g<6;$g++){var $q=$_[$g];$n[$g]=$j.getRes($q),$j.clearRes($q)}$B.endLoad($n),$Z.recover()},$V._onProcessChange=function($B,$_,$Z,$n){($n=$_+$n*$Z)<1&&$B.event("progress",$n)},$V.init=function($B,$_,$Z,$n,$g,$q){if(void 0===$Z&&($Z=!1),void 0===$n&&($n=!1),void 0===$g&&($g=!0),void 0===$q&&($q=!0),$y.update3DLoop=function(){},$y.cancelLoadByUrl=function($B){$V._cancelLoadByUrl($B)},$m.isAntialias=$Z,$m.isAlpha=$n,$m.premultipliedAlpha=$g,$m.isStencil=$q,!$v.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$y.changeWebGLSize=$V._changeWebGLSize,$w.is3DMode=!0,$t.init($B,$_),$F.__init__(),$e_.__init__(),$S_.__init__(),$G.__init__(),$V.__init__(),$P.maxTextureCount=2,($V.debugMode||$d.debugMode)&&($V._debugPhasorSprite=new $s)},$V.HIERARCHY="SPRITE3DHIERARCHY",$V.MESH="MESH",$V.MATERIAL="MATERIAL",$V.PBRMATERIAL="PBRMTL",$V.TEXTURECUBE="TEXTURECUBE",$V.TERRAIN="TERRAIN",$V._readData=null,$V._debugPhasorSprite=null,$V.debugMode=!1,$e($V,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $_},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $_},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $_},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $_}]),$V}(),$y_=function($B){function $g($B){$g.__super.call(this),this._owner=$B,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$A($g,"laya.d3.animation.AnimationTransform3D",$q);var $_=$g.prototype;return $_._getlocalMatrix=function(){return this._localUpdate&&($r_._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$_._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldTransform()}},$_._setWorldMatrixAndUpdate=function($B){if(this._worldMatrix=$B,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $_=this._getlocalMatrix(),$Z=0;$Z<16;++$Z)this._worldMatrix[$Z]=$_[$Z];else $r_.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$_._setWorldMatrixNoUpdate=function($B){this._worldMatrix=$B},$_._setWorldMatrixIgnoreUpdate=function($B){this._worldMatrix=$B,this._worldUpdate=!1},$_.getLocalPosition=function(){return this._localPosition},$_.setLocalPosition=function($B){if(this._parent)this._localPosition=$B,this._localUpdate=!0,this._onWorldTransform();else{var $_=this._entity.owner._transform,$Z=this._entity.localPosition,$n=$Z.elements;$n[0]=$B[0],$n[1]=$B[1],$n[2]=$B[2],$_.localPosition=$Z}},$_.getLocalRotation=function(){if(this._localQuaternionUpdate){var $B=this._localRotationEuler;$r_._quaternionCreateFromYawPitchRollArray($B[1]/$g._angleToRandin,$B[0]/$g._angleToRandin,$B[2]/$g._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$_.setLocalRotation=function($B){if(this._parent)this._localRotation=$B,$r_.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $_=this._entity.owner._transform,$Z=this._entity.localRotation,$n=$Z.elements;$n[0]=$B[0],$n[1]=$B[1],$n[2]=$B[2],$n[3]=$B[3],$_.localRotation=$Z}},$_.getLocalScale=function(){return this._localScale},$_.setLocalScale=function($B){if(this._parent)this._localScale=$B,this._localUpdate=!0,this._onWorldTransform();else{var $_=this._entity.owner._transform,$Z=this._entity.localScale,$n=$Z.elements;$n[0]=$B[0],$n[1]=$B[1],$n[2]=$B[2],$_.localScale=$Z}},$_.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$r_.getYawPitchRoll(this._localRotation,$g._tempVector3);var $B=$g._tempVector3,$_=this._localRotationEuler;$_[0]=$B[1]*$g._angleToRandin,$_[1]=$B[0]*$g._angleToRandin,$_[2]=$B[2]*$g._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$_.setLocalRotationEuler=function($B){if(this._parent)$r_._quaternionCreateFromYawPitchRollArray($B[1]/$g._angleToRandin,$B[0]/$g._angleToRandin,$B[2]/$g._angleToRandin,this._localRotation),this._localRotationEuler=$B,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $_=this._entity.owner._transform,$Z=this._entity.localRotationEuler,$n=$Z.elements;$n[0]=$B[0],$n[1]=$B[1],$n[2]=$B[2],$_.localRotationEuler=$Z}},$_.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$r_.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $B=this._getlocalMatrix(),$_=0;$_<16;++$_)this._worldMatrix[$_]=$B[$_];this._worldUpdate=!1}return this._worldMatrix},$_.setParent=function($B){if(this._parent!==$B){if(this._parent){var $_=this._parent._childs,$Z=$_.indexOf(this);$_.splice($Z,1)}$B&&($B._childs.push(this),$B&&this._onWorldTransform()),this._parent=$B}},$e($g,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$g}(),$C_=function($B){function $_(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$_.__super.call(this),this._destroyed=!1,this._id=$_._uniqueIDCounter,$_._uniqueIDCounter++}$A($_,"laya.d3.component.Component3D",$q);var $Z=$_.prototype;return $t.imps($Z,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$Z._initialize=function($B){this._owner=$B,this._enable=!0,this.started=!1,this._load($B)},$Z._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$Z._load=function($B){},$Z._start=function($B){},$Z._update=function($B){},$Z._lateUpdate=function($B){},$Z._preRenderUpdate=function($B){},$Z._postRenderUpdate=function($B){},$Z._unload=function($B){this.offAll()},$Z._cloneTo=function($B){},$$(0,$Z,"id",function(){return this._id}),$$(0,$Z,"destroyed",function(){return this._destroyed}),$$(0,$Z,"owner",function(){return this._owner}),$$(0,$Z,"enable",function(){return this._enable},function($B){this._enable!==$B&&(this._enable=$B,this.event("enablechanged",this._enable))}),$$(0,$Z,"isSingleton",function(){return $_._isSingleton}),$_._isSingleton=!0,$_._uniqueIDCounter=1,$_}(),$z_=function($B){function $_(){this._destroyed=!1,$_.__super.call(this),this._destroyed=!1}$A($_,"laya.d3.core.GeometryFilter",$q);var $Z=$_.prototype;return $t.imps($Z,{"laya.resource.IDestroy":!0}),$Z._destroy=function(){this.offAll(),this._destroyed=!0},$$(0,$Z,"_isAsyncLoaded",function(){return!0}),$$(0,$Z,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$$(0,$Z,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$$(0,$Z,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$$(0,$Z,"destroyed",function(){return this._destroyed}),$_}(),$t_=function($B){function $n($B){$n.__super.call(this),this._id=++$n._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $dB(new $P_,new $P_),this._boundingBoxCenter=new $P_,this._boundingSphere=new $iB(new $P_,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$B,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$A($n,"laya.d3.core.render.BaseRender",$q);var $_=$n.prototype;return $t.imps($_,{"laya.resource.IDestroy":!0}),$_._changeMaterialReference=function($B,$_){$B&&$B._removeReference(),$_._addReference()},$_._getInstanceMaterial=function($B,$_){var $Z=new $B.constructor;return $B.cloneTo($Z),$Z.name=$Z.name+"(Instance)",this._materialsInstance[$_]=!0,this._changeMaterialReference(this._materials[$_],$Z),this._materials[$_]=$Z},$_._setShaderValuelightMap=function($B){this._setShaderValueTexture(3,$B)},$_._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$_._renderRenderableBoundBox=function(){var $B=$j_._debugPhasorSprite,$_=this.boundingBox,$Z=$n._tempBoundBoxCorners;$_.getCorners($Z),$B.line($Z[0],$n._greenColor,$Z[1],$n._greenColor),$B.line($Z[2],$n._greenColor,$Z[3],$n._greenColor),$B.line($Z[4],$n._greenColor,$Z[5],$n._greenColor),$B.line($Z[6],$n._greenColor,$Z[7],$n._greenColor),$B.line($Z[0],$n._greenColor,$Z[3],$n._greenColor),$B.line($Z[1],$n._greenColor,$Z[2],$n._greenColor),$B.line($Z[2],$n._greenColor,$Z[6],$n._greenColor),$B.line($Z[3],$n._greenColor,$Z[7],$n._greenColor),$B.line($Z[0],$n._greenColor,$Z[4],$n._greenColor),$B.line($Z[1],$n._greenColor,$Z[5],$n._greenColor),$B.line($Z[4],$n._greenColor,$Z[7],$n._greenColor),$B.line($Z[5],$n._greenColor,$Z[6],$n._greenColor)},$_._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$_._calculateBoundingBox=function(){throw"BaseRender: must override it."},$_._setShaderValueTexture=function($B,$_){this._owner._shaderValues.setValue($B,$_)},$_._setShaderValueMatrix4x4=function($B,$_){this._owner._shaderValues.setValue($B,$_?$_.elements:null)},$_._setShaderValueColor=function($B,$_){this._owner._shaderValues.setValue($B,$_?$_.elements:null)},$_._setShaderValueBuffer=function($B,$_){this._owner._shaderValues.setValue($B,$_)},$_._setShaderValueInt=function($B,$_){this._owner._shaderValues.setValue($B,$_)},$_._setShaderValueBool=function($B,$_){this._owner._shaderValues.setValue($B,$_)},$_._setShaderValueNumber=function($B,$_){this._owner._shaderValues.setValue($B,$_)},$_._setShaderValueVector2=function($B,$_){this._owner._shaderValues.setValue($B,$_?$_.elements:null)},$_._addShaderDefine=function($B){this._owner._shaderDefineValue|=$B},$_._removeShaderDefine=function($B){this._owner._shaderDefineValue&=~$B},$_._renderUpdate=function($B){return!0},$_._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $B=this._owner.scene;if($B){var $_=$B.getlightmaps()[this._lightmapIndex];$_?(this._addShaderDefine($s_.SAHDERDEFINE_LIGHTMAP),$_.loaded?this._setShaderValuelightMap($_):$_.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($s_.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($s_.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($s_.SAHDERDEFINE_LIGHTMAP)},$_._updateOctreeNode=function(){var $B=this._treeNode;$B&&this._octreeNodeNeedChange&&($B.updateObject(this),this._octreeNodeNeedChange=!1)},$_._destroy=function(){this.offAll();var $B=0,$_=0;for($B=0,$_=this._renderElements.length;$B<$_;$B++)this._renderElements[$B]._destroy();for($B=0,$_=this._materials.length;$B<$_;$B++)this._materials[$B]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$$(0,$_,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$$(0,$_,"id",function(){return this._id}),$$(0,$_,"material",function(){var $B=this._materials[0];if($B&&!this._materialsInstance[0]){var $_=this._getInstanceMaterial($B,0);this.event("materialchanged",[this,0,$_])}return this._materials[0]},function($B){this.sharedMaterial=$B}),$$(0,$_,"sharedMaterial",function(){return this._materials[0]},function($B){var $_=this._materials[0];$_!==$B&&(this._materials[0]=$B,this._materialsInstance[0]=!1,this._changeMaterialReference($_,$B),this.event("materialchanged",[this,0,$B]))}),$$(0,$_,"lightmapIndex",function(){return this._lightmapIndex},function($B){this._lightmapIndex=$B,this._applyLightMapParams()}),$$(0,$_,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($B){this._lightmapScaleOffset=$B,this._setShaderValueColor(2,$B),this._addShaderDefine($s_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$$(0,$_,"enable",function(){return this._enable},function($B){this._enable=$B,this.event("enablechanged",[this,$B])}),$$(0,$_,"materials",function(){for(var $B=0,$_=this._materials.length;$B<$_;$B++)if(!this._materialsInstance[$B]){var $Z=this._getInstanceMaterial(this._materials[$B],$B);this.event("materialchanged",[this,$B,$Z])}return this._materials.slice()},function($B){this.sharedMaterials=$B}),$$(0,$_,"sharedMaterials",function(){return this._materials.slice()},function($B){if(!$B)throw new Error("MeshRender: shadredMaterials value can't be null.");var $_=$B.length;this._materialsInstance.length=$_;for(var $Z=0;$Z<$_;$Z++){var $n=this._materials[$Z];$n!==$B[$Z]&&(this._materialsInstance[$Z]=!1,this._changeMaterialReference($n,$B[$Z]),this.event("materialchanged",[this,$Z,$B[$Z]]))}this._materials=$B}),$$(0,$_,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$$(0,$_,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $B=this.boundingBox;$P_.add($B.min,$B.max,this._boundingBoxCenter),$P_.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$$(0,$_,"receiveShadow",function(){return this._receiveShadow},function($B){this._receiveShadow!==$B&&((this._receiveShadow=$B)?this._addShaderDefine($A_.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($A_.SHADERDEFINE_RECEIVE_SHADOW))}),$$(0,$_,"destroyed",function(){return this._destroyed}),$n._uniqueIDCounter=0,$e($n,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_,new $P_]},"_greenColor",function(){return this._greenColor=new $k_(0,1,0,1)}]),$n}(),$J_=function($B){function $k($B){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$k.__super.call(this),this._localPosition=new $P_,this._localRotation=new $Z_(0,0,0,1),this._localScale=new $P_(1,1,1),this._localRotationEuler=new $P_,this._localMatrix=new $B_,this._position=new $P_,this._rotation=new $Z_(0,0,0,1),this._scale=new $P_(1,1,1),this._worldMatrix=new $B_,this._forward=new $P_,this._up=new $P_,this._right=new $P_,this._owner=$B,this._childs=[]}$A($k,"laya.d3.core.Transform3D",$q);var $_=$k.prototype;return $_._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$B_.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $B=$k._tempVector30;$P_.multiply(this.pivot,this._localScale,$B);var $_=$k._tempVector31;$P_.subtract($B,this.pivot,$_);var $Z=$k._tempVector32,$n=this.localRotation;$P_.transformQuat($B,$n,$Z),$P_.subtract($Z,$B,$Z);var $g=$k._tempVector33;$P_.subtract(this._localPosition,$_,$g),$P_.subtract($g,$Z,$g),$B_.createAffineTransformation($g,$n,this._localScale,this._localMatrix)}},$_._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldPositionRotationTransform()}},$_._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldPositionScaleTransform()}},$_._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldPositionTransform()}},$_._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldPositionRotationTransform()}},$_._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldPositionScaleTransform()}},$_._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._onWorldTransform()}},$_.translate=function($B,$_){void 0===$_&&($_=!0),$_?($B_.createFromQuaternion(this.localRotation,$k._tempMatrix0),$P_.transformCoordinate($B,$k._tempMatrix0,$k._tempVector30),$P_.add(this.localPosition,$k._tempVector30,this._localPosition),this.localPosition=this._localPosition):($P_.add(this.position,$B,this._position),this.position=this._position)},$_.rotate=function($B,$_,$Z){var $n;void 0===$_&&($_=!0),void 0===$Z&&($Z=!0),$n=$Z?$B:($P_.scale($B,Math.PI/180,$k._tempVector30),$k._tempVector30),$Z_.createFromYawPitchRoll($n.y,$n.x,$n.z,$k._tempQuaternion0),$_?($Z_.multiply(this._localRotation,$k._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($Z_.multiply($k._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$_.lookAt=function($B,$_,$Z){void 0===$Z&&($Z=!1);var $n,$g=$B.elements;if($Z){if($n=this._localPosition.elements,Math.abs($n[0]-$g[0])<$cB.zeroTolerance&&Math.abs($n[1]-$g[1])<$cB.zeroTolerance&&Math.abs($n[2]-$g[2])<$cB.zeroTolerance)return;$Z_.lookAt(this._localPosition,$B,$_,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $q=this.position;if($n=$q.elements,Math.abs($n[0]-$g[0])<$cB.zeroTolerance&&Math.abs($n[1]-$g[1])<$cB.zeroTolerance&&Math.abs($n[2]-$g[2])<$cB.zeroTolerance)return;$Z_.lookAt($q,$B,$_,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$$(0,$_,"_isFrontFaceInvert",function(){var $B=this.scale,$_=$B.x<0;return $B.y<0&&($_=!$_),$B.z<0&&($_=!$_),$_}),$$(0,$_,"owner",function(){return this._owner}),$$(0,$_,"localRotation",function(){if(this._localQuaternionUpdate){var $B=this._localRotationEuler.elements;$Z_.createFromYawPitchRoll($B[1]/$k._angleToRandin,$B[0]/$k._angleToRandin,$B[2]/$k._angleToRandin,this._localRotation)}return this._localRotation},function($B){this._localRotation=$B,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$$(0,$_,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$B_.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($B){null===this._parent?$B.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$B_.multiply(this._localMatrix,$B,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$B,this._worldUpdate=!1}),$$(0,$_,"worldNeedUpdate",function(){return this._worldUpdate}),$$(0,$_,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($B){this._localMatrix=$B,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$$(0,$_,"dummy",function(){return this._dummy},function($B){this._dummy!==$B&&(this._dummy&&(this._dummy._entity=null),$B&&($B._entity=this),this._dummy=$B)}),$$(0,$_,"localPosition",function(){return this._localPosition},function($B){this._localPosition=$B,this._localUpdate=!0,this._onWorldPositionTransform()}),$$(0,$_,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $B=this._parent.position;$P_.multiply(this._localPosition,this._parent.scale,$k._tempVector30),$P_.transformQuat($k._tempVector30,this._parent.rotation,$k._tempVector30),$P_.add($B,$k._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($B){if(null!=this._parent){$P_.subtract($B,this._parent.position,this._localPosition);var $_=this._parent.scale.elements,$Z=$_[0],$n=$_[1],$g=$_[2];if(1!==$Z||1!==$n||1!==$g){var $q=$k._tempVector30,$P=$q.elements;$P[0]=1/$Z,$P[1]=1/$n,$P[2]=1/$g,$P_.multiply(this._localPosition,$q,this._localPosition)}this._parent.rotation.invert($k._tempQuaternion0),$P_.transformQuat(this._localPosition,$k._tempQuaternion0,this._localPosition)}else $B.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$B,this._positionUpdate=!1}),$$(0,$_,"localScale",function(){return this._localScale},function($B){this._localScale=$B,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$$(0,$_,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($k._tempVector30);var $B=$k._tempVector30.elements,$_=this._localRotationEuler.elements;$_[0]=$B[1]*$k._angleToRandin,$_[1]=$B[0]*$k._angleToRandin,$_[2]=$B[2]*$k._angleToRandin}return this._localRotationEuler},function($B){this._localRotationEuler=$B,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$$(0,$_,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$Z_.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($B){null!=this._parent?(this._parent.rotation.invert($k._tempQuaternion0),$Z_.multiply($B,$k._tempQuaternion0,this._localRotation)):$B.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$B,this._rotationUpdate=!1}),$$(0,$_,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$P_.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($B){if(null!==this._parent){var $_=this._parent.scale.elements,$Z=$k._tempVector30.elements;$Z[0]=1/$_[0],$Z[1]=1/$_[1],$Z[2]=1/$_[2],$P_.multiply($B,$k._tempVector30,this._localScale)}else $B.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$B,this._scaleUpdate=!1}),$$(0,$_,"rotationEuler",null,function($B){$Z_.createFromYawPitchRoll($B.y,$B.x,$B.z,this._rotation),this.rotation=this._rotation}),$$(0,$_,"forward",function(){var $B=this.worldMatrix.elements;return this._forward.elements[0]=-$B[8],this._forward.elements[1]=-$B[9],this._forward.elements[2]=-$B[10],this._forward}),$$(0,$_,"up",function(){var $B=this.worldMatrix.elements;return this._up.elements[0]=$B[4],this._up.elements[1]=$B[5],this._up.elements[2]=$B[6],this._up}),$$(0,$_,"right",function(){var $B=this.worldMatrix.elements;return this._right.elements[0]=$B[0],this._right.elements[1]=$B[1],this._right.elements[2]=$B[2],this._right}),$$(0,$_,"parent",function(){return this._parent},function($B){if(this._parent!==$B){if(this._parent){var $_=this._parent._childs,$Z=$_.indexOf(this);$_.splice($Z,1)}$B&&($B._childs.push(this),$B&&this._onWorldTransform()),this._parent=$B}}),$e($k,["_tempVector30",function(){return this._tempVector30=new $P_},"_tempVector31",function(){return this._tempVector31=new $P_},"_tempVector32",function(){return this._tempVector32=new $P_},"_tempVector33",function(){return this._tempVector33=new $P_},"_tempQuaternion0",function(){return this._tempQuaternion0=new $Z_},"_tempMatrix0",function(){return this._tempMatrix0=new $B_},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$k}(),$N_=(function($B){function $_(){this._rotation=0,this._matNeedUpdte=!1,$_.__super.call(this),this._matrix=new $B_,this._offset=new $q_,this._tiling=new $q_(1,1)}$A($_,"laya.d3.core.TransformUV",$q);var $Z=$_.prototype;$t.imps($Z,{"laya.d3.core.IClone":!0}),$Z._updateMatrix=function(){$_._tempOffsetV3.elements[0]=this._offset.x,$_._tempOffsetV3.elements[1]=this._offset.y,$Z_.createFromYawPitchRoll(0,0,this._rotation,$_._tempRotationQua),$_._tempTitlingV3.elements[0]=this._tiling.x,$_._tempTitlingV3.elements[1]=this._tiling.y,$B_.createAffineTransformation($_._tempOffsetV3,$_._tempRotationQua,$_._tempTitlingV3,this._matrix)},$Z.cloneTo=function($B){$B._matrix=this._matrix.clone(),$B._offset=this._offset.clone(),$B._rotation=this._rotation,$B._tiling=this._tiling.clone()},$Z.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$Z,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$$(0,$Z,"tiling",function(){return this._tiling},function($B){this._tiling=$B,this._matNeedUpdte=!0}),$$(0,$Z,"offset",function(){return this._offset},function($B){this._offset=$B,this._matNeedUpdte=!0}),$$(0,$Z,"rotation",function(){return this._rotation},function($B){this._rotation=$B,this._matNeedUpdte=!0}),$e($_,["_tempOffsetV3",function(){return this._tempOffsetV3=new $P_(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $Z_},"_tempTitlingV3",function(){return this._tempTitlingV3=new $P_(1,1,1)}])}(),function($Z){function $B(){this.x=NaN,this.y=NaN,this.z=NaN,$B.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$A($B,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$Z);var $_=$B.prototype;$_._getShapeBoundBox=function($B){var $_=$B.min.elements;$_[0]=.5*-this.x,$_[1]=.5*-this.y,$_[2]=.5*-this.z;var $Z=$B.max.elements;$Z[0]=.5*this.x,$Z[1]=.5*this.y,$Z[2]=.5*this.z},$_._getSpeedBoundBox=function($B){var $_=$B.min.elements;$_[0]=0,$_[1]=0,$_[2]=0;var $Z=$B.max.elements;$Z[0]=0,$Z[1]=1,$Z[2]=0},$_.generatePositionAndDirection=function($B,$_,$Z,$n){var $g=$B.elements,$q=$_.elements;$Z?($Z.seed=$n[16],$R._randomPointInsideHalfUnitBox($B,$Z),$n[16]=$Z.seed):$R._randomPointInsideHalfUnitBox($B),$g[0]=this.x*$g[0],$g[1]=this.y*$g[1],$g[2]=this.z*$g[2],this.randomDirection?$Z?($Z.seed=$n[17],$R._randomPointUnitSphere($_,$Z),$n[17]=$Z.seed):$R._randomPointUnitSphere($_):($q[0]=0,$q[1]=0,$q[2]=1)},$_.cloneTo=function($B){$Z.prototype.cloneTo.call(this,$B);var $_=$B;$_.x=this.x,$_.y=this.y,$_.z=this.z,$_.randomDirection=this.randomDirection}}($K),function($Z){function $P(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$P.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$A($P,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$Z);var $B=$P.prototype;$B._getShapeBoundBox=function($B){var $_=$B.min.elements;$_[0]=$_[2]=-this.radius,$_[1]=0;var $Z=$B.max.elements;$Z[0]=$Z[2]=this.radius,$Z[1]=0},$B._getSpeedBoundBox=function($B){var $_=$B.min.elements;$_[0]=$_[1]=-1,$_[2]=0;var $Z=$B.max.elements;$Z[0]=$Z[1]=1,$Z[2]=0},$B.generatePositionAndDirection=function($B,$_,$Z,$n){var $g=$B.elements,$q=$P._tempPositionPoint.elements;$Z?($Z.seed=$n[16],this.emitFromEdge?$R._randomPointUnitArcCircle(this.arc,$P._tempPositionPoint,$Z):$R._randomPointInsideUnitArcCircle(this.arc,$P._tempPositionPoint,$Z),$n[16]=$Z.seed):this.emitFromEdge?$R._randomPointUnitArcCircle(this.arc,$P._tempPositionPoint):$R._randomPointInsideUnitArcCircle(this.arc,$P._tempPositionPoint),$g[0]=-$q[0],$g[1]=$q[1],$g[2]=0,$P_.scale($B,this.radius,$B),this.randomDirection?$Z?($Z.seed=$n[17],$R._randomPointUnitSphere($_,$Z),$n[17]=$Z.seed):$R._randomPointUnitSphere($_):$B.cloneTo($_)},$B.cloneTo=function($B){$Z.prototype.cloneTo.call(this,$B);var $_=$B;$_.radius=this.radius,$_.arc=this.arc,$_.emitFromEdge=this.emitFromEdge,$_.randomDirection=this.randomDirection},$e($P,["_tempPositionPoint",function(){return this._tempPositionPoint=new $q_}])}($K),function($Z){function $I(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$I.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$A($I,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$Z);var $B=$I.prototype;$B._getShapeBoundBox=function($B){var $_=this.radius+this.length*Math.sin(this.angle),$Z=this.length*Math.cos(this.angle),$n=$B.min.elements;$n[0]=$n[1]=-$_,$n[2]=0;var $g=$B.max.elements;$g[0]=$g[1]=$_,$g[2]=$Z},$B._getSpeedBoundBox=function($B){var $_=Math.sin(this.angle),$Z=$B.min.elements;$Z[0]=$Z[1]=-$_,$Z[2]=0;var $n=$B.max.elements;$n[0]=$Z[1]=$_,$n[2]=1},$B.generatePositionAndDirection=function($B,$_,$Z,$n){var $g,$q=$B.elements,$P=$_.elements,$k=$I._tempPositionPoint.elements,$m=NaN,$D=NaN,$T=Math.cos(this.angle),$e=Math.sin(this.angle);switch(this.emitType){case 0:$Z?($Z.seed=$n[16],$R._randomPointInsideUnitCircle($I._tempPositionPoint,$Z),$n[16]=$Z.seed):$R._randomPointInsideUnitCircle($I._tempPositionPoint),$m=$k[0],$D=$k[1],$q[0]=$m*this.radius,$q[1]=$D*this.radius,$q[2]=0,this.randomDirection?($Z?($Z.seed=$n[17],$R._randomPointInsideUnitCircle($I._tempDirectionPoint,$Z),$n[17]=$Z.seed):$R._randomPointInsideUnitCircle($I._tempDirectionPoint),$g=$I._tempDirectionPoint.elements,$P[0]=$g[0]*$e,$P[1]=$g[1]*$e):($P[0]=$m*$e,$P[1]=$D*$e),$P[2]=$T;break;case 1:$Z?($Z.seed=$n[16],$R._randomPointUnitCircle($I._tempPositionPoint,$Z),$n[16]=$Z.seed):$R._randomPointUnitCircle($I._tempPositionPoint),$m=$k[0],$D=$k[1],$q[0]=$m*this.radius,$q[1]=$D*this.radius,$q[2]=0,this.randomDirection?($Z?($Z.seed=$n[17],$R._randomPointInsideUnitCircle($I._tempDirectionPoint,$Z),$n[17]=$Z.seed):$R._randomPointInsideUnitCircle($I._tempDirectionPoint),$g=$I._tempDirectionPoint.elements,$P[0]=$g[0]*$e,$P[1]=$g[1]*$e):($P[0]=$m*$e,$P[1]=$D*$e),$P[2]=$T;break;case 2:$Z?($Z.seed=$n[16],$R._randomPointInsideUnitCircle($I._tempPositionPoint,$Z)):$R._randomPointInsideUnitCircle($I._tempPositionPoint),$m=$k[0],$D=$k[1],$q[0]=$m*this.radius,$q[1]=$D*this.radius,$P[$q[2]=0]=$m*$e,$P[1]=$D*$e,$P[2]=$T,$P_.normalize($_,$_),$Z?($P_.scale($_,this.length*$Z.getFloat(),$_),$n[16]=$Z.seed):$P_.scale($_,this.length*Math.random(),$_),$P_.add($B,$_,$B),this.randomDirection&&($Z?($Z.seed=$n[17],$R._randomPointUnitSphere($_,$Z),$n[17]=$Z.seed):$R._randomPointUnitSphere($_));break;case 3:$Z?($Z.seed=$n[16],$R._randomPointUnitCircle($I._tempPositionPoint,$Z)):$R._randomPointUnitCircle($I._tempPositionPoint),$m=$k[0],$D=$k[1],$q[0]=$m*this.radius,$q[1]=$D*this.radius,$P[$q[2]=0]=$m*$e,$P[1]=$D*$e,$P[2]=$T,$P_.normalize($_,$_),$Z?($P_.scale($_,this.length*$Z.getFloat(),$_),$n[16]=$Z.seed):$P_.scale($_,this.length*Math.random(),$_),$P_.add($B,$_,$B),this.randomDirection&&($Z?($Z.seed=$n[17],$R._randomPointUnitSphere($_,$Z),$n[17]=$Z.seed):$R._randomPointUnitSphere($_));break;default:throw new Error("ConeShape:emitType is invalid.")}},$B.cloneTo=function($B){$Z.prototype.cloneTo.call(this,$B);var $_=$B;$_.angle=this.angle,$_.radius=this.radius,$_.length=this.length,$_.emitType=this.emitType,$_.randomDirection=this.randomDirection},$e($I,["_tempPositionPoint",function(){return this._tempPositionPoint=new $q_},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $q_}])}($K),function($Z){function $B(){this.radius=NaN,this.emitFromShell=!1,$B.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$A($B,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$Z);var $_=$B.prototype;$_._getShapeBoundBox=function($B){var $_=$B.min.elements;$_[0]=$_[1]=$_[2]=-this.radius;var $Z=$B.max.elements;$Z[0]=$Z[1]=this.radius,$Z[2]=0},$_._getSpeedBoundBox=function($B){var $_=$B.min.elements;$_[0]=$_[1]=-1,$_[2]=0;var $Z=$B.max.elements;$Z[0]=$Z[1]=$Z[2]=1},$_.generatePositionAndDirection=function($B,$_,$Z,$n){var $g=$B.elements;$Z?($Z.seed=$n[16],this.emitFromShell?$R._randomPointUnitSphere($B,$Z):$R._randomPointInsideUnitSphere($B,$Z),$n[16]=$Z.seed):this.emitFromShell?$R._randomPointUnitSphere($B):$R._randomPointInsideUnitSphere($B),$P_.scale($B,this.radius,$B);var $q=$g[2];$q<0&&($g[2]=-1*$q),this.randomDirection?$Z?($Z.seed=$n[17],$R._randomPointUnitSphere($_,$Z),$n[17]=$Z.seed):$R._randomPointUnitSphere($_):$B.cloneTo($_)},$_.cloneTo=function($B){$Z.prototype.cloneTo.call(this,$B);var $_=$B;$_.radius=this.radius,$_.emitFromShell=this.emitFromShell,$_.randomDirection=this.randomDirection}}($K),function($Z){function $B(){this.radius=NaN,this.emitFromShell=!1,$B.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$A($B,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$Z);var $_=$B.prototype;$_._getShapeBoundBox=function($B){var $_=$B.min.elements;$_[0]=$_[1]=$_[2]=-this.radius;var $Z=$B.max.elements;$Z[0]=$Z[1]=$Z[2]=this.radius},$_._getSpeedBoundBox=function($B){var $_=$B.min.elements;$_[0]=$_[1]=$_[2]=-1;var $Z=$B.max.elements;$Z[0]=$Z[1]=$Z[2]=1},$_.generatePositionAndDirection=function($B,$_,$Z,$n){$Z?($Z.seed=$n[16],this.emitFromShell?$R._randomPointUnitSphere($B,$Z):$R._randomPointInsideUnitSphere($B,$Z),$n[16]=$Z.seed):this.emitFromShell?$R._randomPointUnitSphere($B):$R._randomPointInsideUnitSphere($B),$P_.scale($B,this.radius,$B),this.randomDirection?$Z?($Z.seed=$n[17],$R._randomPointUnitSphere($_,$Z),$n[17]=$Z.seed):$R._randomPointUnitSphere($_):$B.cloneTo($_)},$_.cloneTo=function($B){$Z.prototype.cloneTo.call(this,$B);var $_=$B;$_.radius=this.radius,$_.emitFromShell=this.emitFromShell,$_.randomDirection=this.randomDirection}}($K),function($B){function $_(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$_.__super.call(this)}return $A($_,"laya.d3.core.render.SubMeshRenderElement",$U),$_}()),$Q_=function($B){function $r($B,$_,$Z,$n,$g,$q){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$B,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$A_.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$s_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$s_.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$L_.SHADERDEFINE_ALPHATEST]="ALPHATEST";$r.__super.call(this,$B,$_,$Z,null,{}),this._attributeMap=$n;var $P;for($P in $g){var $k=$g[$P];switch($k[1]){case 0:this._renderElementUniformMap[$P]=$k[0];break;case 1:this._materialUniformMap[$P]=$k[0];break;case 2:this._spriteUniformMap[$P]=$k[0];break;case 3:this._cameraUniformMap[$P]=$k[0];break;case 4:this._sceneUniformMap[$P]=$k[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$A($r,"laya.d3.shader.ShaderCompile3D",$C);var $_=$r.prototype;return $_._definesToNameDic=function($B,$_){for(var $Z={},$n=1,$g=0;$g<32&&!($B<($n=1<<$g));$g++)if($B&$n){var $q=$_[$n];$q&&($Z[$q]="")}return $Z},$_.withCompile=function($B,$_,$Z,$n){var $g,$q,$P;if($q=this.sharders[$B])if($P=$q[$_]){if($g=$P[$Z])return $g}else $P=$q[$_]=[];else $P=($q=this.sharders[$B]=[])[$_]=[];var $k,$m=this._definesToNameDic($B,$r._globalInt2name),$D=this._definesToNameDic($_,this._spriteInt2name),$T=this._definesToNameDic($Z,this._materialInt2name),$e={},$I="";if($m)for($k in $m)$I+="#define "+$k+"\n",$e[$k]=!0;if($D)for($k in $D)$I+="#define "+$k+"\n",$e[$k]=!0;if($T)for($k in $T)$I+="#define "+$k+"\n",$e[$k]=!0;var $A=$b_.nameKey.getName(this._name)+" compile ("+$B+","+$_+","+$Z+")",$$=this._VS.toscript($e,[]),$w=this._PS.toscript($e,[]);$o.now();if($g=$b_.create($I+$$.join("\n"),$I+$w.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$n,$A),$P[$Z]=$g,laya.d3.shader.ShaderCompile3D.debugMode)$o.now();return $g},$_.precompileShaderWithShaderDefine=function($B,$_,$Z){this.withCompile($B,$_,$Z,!0)},$_.addMaterialDefines=function($B){var $_=$B.defines;for(var $Z in $_){var $n=$_[$Z],$g=parseInt($Z);this._materialInt2name[$g]=$n,this._materialName2Int[$n]=$g}},$_.addSpriteDefines=function($B){var $_=$B.defines;for(var $Z in $_){var $n=$_[$Z],$g=parseInt($Z);this._spriteInt2name[$g]=$n,this._spriteName2Int[$n]=$g}},$_.getMaterialDefineByName=function($B){return this._materialName2Int[$B]},$_.registerMaterialDefine=function($B){var $_=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$_]=$B,this._materialName2Int[$B]=$_},$_.registerSpriteDefine=function($B){var $_=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$_]=$B,this._spriteName2Int[$B]=$_},$r._globalRegDefine=function($B,$_){$r._globalInt2name[$_]=$B},$r.add=function($B,$_,$Z,$n,$g){return laya.d3.shader.ShaderCompile3D._preCompileShader[$B]=new $r($B,$_,$Z,$n,$g,$C.includes)},$r.get=function($B){return laya.d3.shader.ShaderCompile3D._preCompileShader[$b_.nameKey.getID($B)]},$r._preCompileShader={},$r._globalInt2name=[],$r.debugMode=!1,$r.SHADERDEFINE_HIGHPRECISION=1,$r.SHADERDEFINE_FOG=4,$r.SHADERDEFINE_DIRECTIONLIGHT=8,$r.SHADERDEFINE_POINTLIGHT=16,$r.SHADERDEFINE_SPOTLIGHT=32,$r.SHADERDEFINE_UV0=64,$r.SHADERDEFINE_COLOR=128,$r.SHADERDEFINE_UV1=256,$r.SAHDERDEFINE_DEPTHFOG=131072,$r}(),$M_=function($B){function $$(){$$.__super.call(this)}$A($$,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$nB);var $_=$$.prototype;return $_._getStaticBatch=function($B,$_,$Z,$n){var $g,$q;return $q=$B?$B.id.toString()+$Z.id.toString()+$_.id.toString()+$n.toString():$Z.id.toString()+$_.id.toString()+$n.toString(),this._staticBatches[$q]?$g=this._staticBatches[$q]:this._staticBatches[$q]=$g=new $Y_($q,this,$B,$_,$Z),$g},$_._initStaticBatchs=function($B){var $_,$Z;this._initBatchRenderElements.sort($$._sortPrepareStaticBatch);for(var $n,$g=!1,$q=0,$P=0,$k=this._initBatchRenderElements.length;$P<$k;$P++){var $m,$D=this._initBatchRenderElements[$P],$T=$D.renderObj._getVertexBuffer(0);$D._sprite3D;if($Z===$T.vertexDeclaration&&$_===$D._material)if($g)$n._addCombineBatchRenderObjTest($D)?($m=$D._staticBatch)!==$n&&($m&&$m._deleteCombineBatchRenderObj($D),$n._addCombineBatchRenderObj($D)):($g=!1,$q++);else{var $e=this._initBatchRenderElements[$P-1],$I=$e.renderObj,$A=$D.renderObj;$g=!(65535<$I._getVertexBuffer().vertexCount+$A._getVertexBuffer().vertexCount)&&($n=this._getStaticBatch($B,$Z,$_,$q),($m=$e._staticBatch)!==$n&&($m&&$m._deleteCombineBatchRenderObj($e),$n._addCombineBatchRenderObj($e)),($m=$D._staticBatch)!==$n&&($m&&$m._deleteCombineBatchRenderObj($D),$n._addCombineBatchRenderObj($D)),!0)}else $g=!1,$q=0;$_=$D._material,$Z=$T.vertexDeclaration}},$$._sortPrepareStaticBatch=function($B,$_){var $Z=$B._render,$n=$_._render,$g=$Z.lightmapIndex-$n.lightmapIndex;if(0!=$g)return $g;var $q=$Z.receiveShadow-$n.receiveShadow;if(0!=$q)return $q;var $P=$B._mainSortID-$_._mainSortID;return 0==$P?$B.renderObj.triangleCount-$_.renderObj.triangleCount:$P},$$}(),$Y_=function($B){function $q($B,$_,$Z,$n,$g){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$q.__super.call(this,$B,$_,$Z),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$n,this._material=$g}$A($q,"laya.d3.graphics.SubMeshStaticBatch",$gB);var $_=$q.prototype;return $_._compareBatchRenderElement=function($B,$_){return $B._batchIndexStart>$_._batchIndexStart},$_._addCombineBatchRenderObjTest=function($B){var $_=$B.renderObj._vertexCount;return!(65535<(0<$_?this._currentCombineVertexCount+$_:this._currentCombineVertexCount+$B.renderObj._getVertexBuffer().vertexCount))},$_._addCombineBatchRenderObj=function($B){var $_=$B.renderObj,$Z=$_._vertexCount;this._initBatchRenderElements.push($B),$B._staticBatch=this,0<$Z?(this._currentCombineIndexCount+=$_._indexCount,this._currentCombineVertexCount+=$Z):(this._currentCombineIndexCount=this._currentCombineIndexCount+$_._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$_._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$_._deleteCombineBatchRenderObj=function($B){var $_=$B.renderObj,$Z=this._initBatchRenderElements.indexOf($B);if(-1!==$Z){this._initBatchRenderElements.splice($Z,1),$B._staticBatch=null;var $n=$_._vertexCount;0<$n?(this._currentCombineIndexCount=this._currentCombineIndexCount-$_._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$n):(this._currentCombineIndexCount=this._currentCombineIndexCount-$_._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$_._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$_._finishInit=function(){if(this._needFinishCombine){var $B=0,$_=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $Z=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$n=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$K_.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$p_.create("ushort",this._currentCombineIndexCount,35044);for(var $g=0,$q=this._initBatchRenderElements.length;$g<$q;$g++){var $P=this._initBatchRenderElements[$g],$k=$P.renderObj,$m=$k._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$P._sprite3D),$D=$k.getIndices(),$T=$P._sprite3D.transform._isFrontFaceInvert,$e=$B/(this._vertexDeclaration.vertexStride/4)-$k._vertexStart,$I=$_,$A=$I+$D.length;$P._batchIndexStart=$I,$P._batchIndexEnd=$A,$n.set($D,$_);var $$=0;if($T)for($$=$I;$$<$A;$$+=3){$n[$$]=$e+$n[$$];var $w=$n[$$+1],$r=$n[$$+2];$n[$$+1]=$e+$r,$n[$$+2]=$e+$w}else for($$=$I;$$<$A;$$+=3)$n[$$]=$e+$n[$$],$n[$$+1]=$e+$n[$$+1],$n[$$+2]=$e+$n[$$+2];$_+=$D.length,$Z.set($m,$B),$B+=$m.length}this._vertexBuffer.setData($Z),this._indexBuffer.setData($n),this._needFinishCombine=!1}},$_._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $N_)},$_._getRenderElement=function($B,$_,$Z){for(var $n,$g,$q=this._batchRenderElements.length,$P=!0,$k=0;$k<$q;$k++){var $m,$D,$T=($g=this._batchRenderElements[$k])._sprite3D._render;if(0!==$k&&($P=($m=($n=this._batchRenderElements[$k-1])._sprite3D._render).lightmapIndex!==$T.lightmapIndex||$m.receiveShadow!==$T.receiveShadow||$n._batchIndexEnd!==$g._batchIndexStart),$P){($D=this._getCombineRenderElementFromPool()).renderObj=this,$D._material=this._material,$D._batchIndexStart=$g._batchIndexStart,$D._batchIndexEnd=$g._batchIndexEnd;var $e=$T.lightmapIndex,$I=$e+1,$A=this._batchOwnerIndices[$I];$A||($A=this._batchOwnerIndices[$I]=[]);var $$,$w=$A[$g._render.receiveShadow?1:0];void 0===$w?($A[$T.receiveShadow?1:0]=this._batchOwners.length,($$=new $S_(null,"StaticBatchMeshSprite3D"))._scene=$_,$$._transform=this._rootOwner?this._rootOwner._transform:null,$$._render.lightmapIndex=$e,$$._render.receiveShadow=$g._render.receiveShadow,this._batchOwners.push($$)):$$=this._batchOwners[$w],$$._render._renderUpdate($Z),$D._sprite3D=$$,$B.push($D)}else $D._batchIndexEnd=$g._batchIndexEnd}},$_._beforeRender=function($B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$_._render=function($B){var $_=$B.renderElement,$Z=$_._batchIndexStart,$n=$_._batchIndexEnd-$Z;$v.mainContext.drawElements(4,$n,5123,2*$Z),$Q.drawCall++,$Q.trianglesFaces+=$n/3},$_.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$_._getVertexBuffer=function($B){return void 0===$B&&($B=0),this._vertexBuffer},$q}(),$l_=function($B){function $_(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$_.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$A($_,"laya.d3.core.ComponentNode",$D);var $Z=$_.prototype;return $Z.addComponent=function($B){var $_,$Z=this._componentsMap.indexOf($B);if(-1===$Z)$_=[],this._componentsMap.push($B),this._typeComponentsIndices.push($_);else if($_=this._typeComponentsIndices[$Z],this._components[$_[0]].isSingleton)throw new Error("无法单实例创建"+$B+"组件，"+$B+"组件已存在！");var $n=$g.getInstance($B);return $_.push(this._components.length),this._components.push($n),$n instanceof laya.d3.component.Script&&this._scripts.push($n),$n._initialize(this),$n},$Z._removeComponent=function($B,$_){var $Z=this._typeComponentsIndices[$B],$n=$Z[$_],$g=this._components[$n];this._components.splice($n,1),$g instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($g),1),$Z.splice($_,1),0===$Z.length&&(this._typeComponentsIndices.splice($B,1),this._componentsMap.splice($B,1));for(var $q=0,$P=this._componentsMap.length;$q<$P;$q++)for(var $k=($Z=this._typeComponentsIndices[$q]).length-1;0<=$k;$k--){var $m=$Z[$k];if(!($n<$m))break;$Z[$k]=--$m}$g._destroy()},$Z.getComponentByType=function($B,$_){void 0===$_&&($_=0);var $Z=this._componentsMap.indexOf($B);return-1===$Z?null:this._components[this._typeComponentsIndices[$Z][$_]]},$Z.getComponentsByType=function($B,$_){var $Z=this._componentsMap.indexOf($B);if(-1!==$Z){var $n=this._typeComponentsIndices[$Z],$g=$n.length;$_.length=$g;for(var $q=0;$q<$g;$q++)$_[$q]=this._components[$n[$q]]}else $_.length=0},$Z.getComponentByIndex=function($B){return this._components[$B]},$Z.removeComponentByType=function($B,$_){void 0===$_&&($_=0);var $Z=this._componentsMap.indexOf($B);-1!==$Z&&this._removeComponent($Z,$_)},$Z.removeComponentsByType=function($B){var $_=this._componentsMap.indexOf($B);if(-1!==$_)for(var $Z=this._typeComponentsIndices[$_],$n=0,$g=$Z.length;$n<$g;$Z.length<$g?$g--:$n++)this._removeComponent($_,$n)},$Z.removeAllComponent=function(){for(var $B=0,$_=this._componentsMap.length;$B<$_;this._componentsMap.length<$_?$_--:$B++)this.removeComponentsByType(this._componentsMap[$B])},$Z._updateComponents=function($B){for(var $_=0,$Z=this._components.length;$_<$Z;$_++){var $n=this._components[$_];!$n.started&&($n._start($B),$n.started=!0),$n.enable&&$n._update($B)}},$Z._lateUpdateComponents=function($B){for(var $_=0;$_<this._components.length;$_++){var $Z=this._components[$_];!$Z.started&&($Z._start($B),$Z.started=!0),$Z.enable&&$Z._lateUpdate($B)}},$Z._preRenderUpdateComponents=function($B){for(var $_=0;$_<this._components.length;$_++){var $Z=this._components[$_];!$Z.started&&($Z._start($B),$Z.started=!0),$Z.enable&&$Z._preRenderUpdate($B)}},$Z._postRenderUpdateComponents=function($B){for(var $_=0;$_<this._components.length;$_++){var $Z=this._components[$_];!$Z.started&&($Z._start($B),$Z.started=!0),$Z.enable&&$Z._postRenderUpdate($B)}},$_}(),$L_=function($n){function $B(){$B.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $I_,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $k_(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$A($B,"laya.d3.core.material.BaseMaterial",$n);var $_=$B.prototype;return $t.imps($_,{"laya.d3.core.IClone":!0}),$_._addShaderDefine=function($B){this._shaderDefineValue|=$B},$_._removeShaderDefine=function($B){this._shaderDefineValue&=~$B},$_._addDisablePublicShaderDefine=function($B){this._disablePublicShaderDefine|=$B},$_._removeDisablePublicShaderDefine=function($B){this._disablePublicShaderDefine&=~$B},$_._setBuffer=function($B,$_){this._shaderValues.setValue($B,$_),this._values[$B]=$_},$_._getBuffer=function($B){return this._values[$B]},$_._setMatrix4x4=function($B,$_){this._shaderValues.setValue($B,$_?$_.elements:null),this._values[$B]=$_},$_._getMatrix4x4=function($B){return this._values[$B]},$_._setInt=function($B,$_){this._shaderValues.setValue($B,$_),this._values[$B]=$_},$_._getInt=function($B){return this._values[$B]},$_._setNumber=function($B,$_){this._shaderValues.setValue($B,$_),this._values[$B]=$_},$_._getNumber=function($B){return this._values[$B]},$_._setBool=function($B,$_){this._shaderValues.setValue($B,$_),this._values[$B]=$_},$_._getBool=function($B){return this._values[$B]},$_._setVector2=function($B,$_){this._shaderValues.setValue($B,$_?$_.elements:null),this._values[$B]=$_},$_._getVector2=function($B){return this._values[$B]},$_._setColor=function($B,$_){this._shaderValues.setValue($B,$_?$_.elements:null),this._values[$B]=$_},$_._getColor=function($B){return this._values[$B]},$_._setTexture=function($B,$_){var $Z=this._values[$B];this._values[$B]=$_,this._shaderValues.setValue($B,$_),0<this.referenceCount&&($Z&&$Z._removeReference(),$_&&$_._addReference())},$_._getTexture=function($B){return this._values[$B]},$_._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$_._getShader=function($B,$_,$Z){var $n=($B|$_)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($n,$Z,this._shaderDefineValue),this._shader},$_._setRenderStateBlendDepth=function(){var $B=$v.mainContext;switch($V.setDepthMask($B,this.depthWrite),0===this.depthTest?$V.setDepthTest($B,!1):($V.setDepthTest($B,!0),$V.setDepthFunc($B,this.depthTest)),this.blend){case 0:$V.setBlend($B,!1);break;case 1:$V.setBlend($B,!0),$V.setBlendFunc($B,this.srcBlend,this.dstBlend);break;case 2:$V.setBlend($B,!0)}},$_._setRenderStateFrontFace=function($B,$_){var $Z=$v.mainContext,$n=0;switch(this.cull){case 0:$V.setCullFace($Z,!1);break;case 1:$V.setCullFace($Z,!0),$n=$B?$_&&$_._isFrontFaceInvert?2305:2304:$_&&$_._isFrontFaceInvert?2304:2305,$V.setFrontFace($Z,$n);break;case 2:$V.setCullFace($Z,!0),$n=$B?$_&&$_._isFrontFaceInvert?2304:2305:$_&&$_._isFrontFaceInvert?2305:2304,$V.setFrontFace($Z,$n)}},$_.onAsynLoaded=function($B,$_,$Z){var $n=$_[0],$g=$_[1];switch($n.version){case"LAYAMATERIAL:01":var $q=0,$P=0,$k=$n.props;for(var $m in $k)switch($m){case"vectors":var $D=$k[$m];for($q=0,$P=$D.length;$q<$P;$q++){var $T=$D[$q],$e=$T.value;switch($e.length){case 2:this[$T.name]=new $q_($e[0],$e[1]);break;case 3:this[$T.name]=new $P_($e[0],$e[1],$e[2]);break;case 4:this[$T.name]=new $k_($e[0],$e[1],$e[2],$e[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $I=$k[$m];for($q=0,$P=$I.length;$q<$P;$q++){var $A=$I[$q],$$=$A.path;$$&&(this[$A.name]=$j.getRes($g[$$]))}break;case"defines":var $w=$k[$m];for($q=0,$P=$w.length;$q<$P;$q++){var $r=this._shaderCompile.getMaterialDefineByName($w[$q]);this._addShaderDefine($r)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$m]=$k[$m];break;case"renderQueue":switch($k[$m]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$m]=$k[$m]}break;case"LAYAMATERIAL:02":for($m in $k=$n.props)switch($m){case"vectors":for($q=0,$P=($D=$k[$m]).length;$q<$P;$q++)switch(($e=($T=$D[$q]).value).length){case 2:this[$T.name]=new $q_($e[0],$e[1]);break;case 3:this[$T.name]=new $P_($e[0],$e[1],$e[2]);break;case 4:this[$T.name]=new $k_($e[0],$e[1],$e[2],$e[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($q=0,$P=($I=$k[$m]).length;$q<$P;$q++)($$=($A=$I[$q]).path)&&(this[$A.name]=$j.getRes($g[$$]));break;case"defines":for($q=0,$P=($w=$k[$m]).length;$q<$P;$q++)$r=this._shaderCompile.getMaterialDefineByName($w[$q]),this._addShaderDefine($r);break;default:this[$m]=$k[$m]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$_._addReference=function(){$n.prototype._addReference.call(this);for(var $B=0,$_=this._values.length;$B<$_;$B++){var $Z=this._values[$B];$Z&&$Z instanceof laya.d3.resource.BaseTexture&&$Z._addReference()}},$_._removeReference=function(){$n.prototype._removeReference.call(this);for(var $B=0,$_=this._values.length;$B<$_;$B++){var $Z=this._values[$B];$Z&&$Z instanceof laya.d3.resource.BaseTexture&&$Z._removeReference()}},$_.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$_.setShaderName=function($B){var $_=$b_.nameKey.getID($B);if(-1===$_)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$Q_._preCompileShader[$_]},$_.cloneTo=function($B){var $_=$B;$_.name=this.name,$_.cull=this.cull,$_.blend=this.blend,$_.srcBlend=this.srcBlend,$_.dstBlend=this.dstBlend,$_.srcBlendRGB=this.srcBlendRGB,$_.dstBlendRGB=this.dstBlendRGB,$_.srcBlendAlpha=this.srcBlendAlpha,$_.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($_.blendConstColor),$_.blendEquation=this.blendEquation,$_.blendEquationRGB=this.blendEquationRGB,$_.blendEquationAlpha=this.blendEquationAlpha,$_.depthTest=this.depthTest,$_.depthWrite=this.depthWrite,$_.renderQueue=this.renderQueue,$_._shader=this._shader,$_._disablePublicShaderDefine=this._disablePublicShaderDefine,$_._shaderDefineValue=this._shaderDefineValue;var $Z,$n=0,$g=$_._shaderValues;$_._shaderValues.data.length=this._shaderValues.data.length;var $q=this._values.length,$P=$_._values;for($n=0,$Z=$P.length=$q;$n<$Z;$n++){var $k=this._values[$n];if($k)if("number"==typeof $k)$P[$n]=$k,$g.data[$n]=$k;else if("number"==typeof $k&&Math.floor($k)==$k)$P[$n]=$k,$g.data[$n]=$k;else if("boolean"==typeof $k)$P[$n]=$k,$g.data[$n]=$k;else if($k instanceof laya.d3.math.Vector2){var $m=$P[$n]||($P[$n]=new $q_);$k.cloneTo($m),$g.data[$n]=$m.elements}else if($k instanceof laya.d3.math.Vector3){var $D=$P[$n]||($P[$n]=new $P_);$k.cloneTo($D),$g.data[$n]=$D.elements}else if($k instanceof laya.d3.math.Vector4){var $T=$P[$n]||($P[$n]=new $k_);$k.cloneTo($T),$g.data[$n]=$T.elements}else if($k instanceof laya.d3.math.Matrix4x4){var $e=$P[$n]||($P[$n]=new $B_);$k.cloneTo($e),$g.data[$n]=$e.elements}else $k instanceof laya.d3.resource.BaseTexture&&($P[$n]=$k,$g.data[$n]=$k)}},$_.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$$(0,$_,"alphaTestValue",function(){return this._getNumber(0)},function($B){this._setNumber(0,$B)}),$$(0,$_,"alphaTest",function(){return this._alphaTest},function($B){(this._alphaTest=$B)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$B.__init__=function(){$B.SHADERDEFINE_ALPHATEST=$B.shaderDefines.registerDefine("ALPHATEST")},$B.RENDERQUEUE_OPAQUE=2e3,$B.RENDERQUEUE_ALPHATEST=2450,$B.RENDERQUEUE_TRANSPARENT=3e3,$B.CULL_NONE=0,$B.CULL_FRONT=1,$B.CULL_BACK=2,$B.BLEND_DISABLE=0,$B.BLEND_ENABLE_ALL=1,$B.BLEND_ENABLE_SEPERATE=2,$B.BLENDPARAM_ZERO=0,$B.BLENDPARAM_ONE=1,$B.BLENDPARAM_SRC_COLOR=768,$B.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$B.BLENDPARAM_DST_COLOR=774,$B.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$B.BLENDPARAM_SRC_ALPHA=770,$B.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$B.BLENDPARAM_DST_ALPHA=772,$B.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$B.BLENDPARAM_SRC_ALPHA_SATURATE=776,$B.BLENDEQUATION_ADD=0,$B.BLENDEQUATION_SUBTRACT=1,$B.BLENDEQUATION_REVERSE_SUBTRACT=2,$B.DEPTHTEST_OFF=0,$B.DEPTHTEST_NEVER=512,$B.DEPTHTEST_LESS=513,$B.DEPTHTEST_EQUAL=514,$B.DEPTHTEST_LEQUAL=515,$B.DEPTHTEST_GREATER=516,$B.DEPTHTEST_NOTEQUAL=517,$B.DEPTHTEST_GEQUAL=518,$B.DEPTHTEST_ALWAYS=519,$B.SHADERDEFINE_ALPHATEST=1,$B.ALPHATESTVALUE=0,$e($B,["shaderDefines",function(){return this.shaderDefines=new $T_}]),$B}($r),$v_=function($B){function $_(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$_.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$A($_,"laya.d3.resource.BaseTexture",$r);var $Z=$_.prototype;return $$(0,$Z,"width",function(){return this._width}),$$(0,$Z,"repeat",function(){return this._repeat},function($B){if(this._repeat!==$B&&(this._repeat=$B,this._source)){var $_=$v.mainContext;$V.bindTexture($_,this._type,this._source),$z.isPOT(this._width,this._height)&&this._repeat?($_.texParameteri(this._type,10242,10497),$_.texParameteri(this._type,10243,10497)):($_.texParameteri(this._type,10242,33071),$_.texParameteri(this._type,10243,33071))}}),$$(0,$Z,"height",function(){return this._height}),$$(0,$Z,"magFifter",function(){return this._magFifter},function($B){(this._magFifter=$B)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($B)}),$$(0,$Z,"wrapModeV",function(){return this._wrapModeV}),$$(0,$Z,"size",function(){return this._size}),$$(0,$Z,"wrapModeU",function(){return this._wrapModeU}),$$(0,$Z,"mipmap",function(){return this._mipmap},function($B){this._mipmap=$B,this._mipmap!=$B&&this._conchTexture&&this._conchTexture.setMipMap($B)}),$$(0,$Z,"minFifter",function(){return this._minFifter},function($B){this._minFifter=$B,this._minFifter!=$B&&this._conchTexture&&this._conchTexture.setMinFifter($B)}),$$(0,$Z,"format",function(){return this._format}),$$(0,$Z,"source",function(){return this.activeResource(),this._source}),$$(0,$Z,"defaulteTexture",function(){return $X_.grayTexture}),$_.WARPMODE_REPEAT=0,$_.WARPMODE_CLAMP=1,$_}(),$V_=function($B){function $_(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$_.__super.call(this),this._boundingBoxCorners=$n(8,null)}$A($_,"laya.d3.resource.models.BaseMesh",$r);var $Z=$_.prototype;return $Z._getPositions=function(){throw new Error("未Override,请重载该属性！")},$Z._generateBoundingObject=function(){this._boundingSphere=new $iB(new $P_,0),$iB.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $dB(new $P_,new $P_),$dB.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$Z.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$Z.getRenderElement=function($B){throw new Error("未Override,请重载该属性！")},$$(0,$Z,"subMeshCount",function(){return this._subMeshCount}),$$(0,$Z,"boundingBox",function(){return this._boundingBox}),$$(0,$Z,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$$(0,$Z,"boundingSphere",function(){return this._boundingSphere}),$_}(),$o_=(function($B){function $_(){$_.__super.call(this)}$A($_,"laya.d3.component.Script",$C_);var $Z=$_.prototype;$Z.onTriggerEnter=function($B){},$Z.onTriggerExit=function($B){},$Z.onTriggerStay=function($B){},$$(0,$Z,"isSingleton",function(){return $_._isSingleton}),$_._isSingleton=!1}(),function($B){function $_($B){this._owner=null,this._sharedMesh=null,$_.__super.call(this),this._owner=$B}$A($_,"laya.d3.core.MeshFilter",$B);var $Z=$_.prototype;return $Z._sharedMeshLoaded=function(){this.event("loaded")},$Z._destroy=function(){$B.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$$(0,$Z,"sharedMesh",function(){return this._sharedMesh},function($B){var $_=this._sharedMesh;$_&&$_._removeReference(),(this._sharedMesh=$B)._addReference(),this.event("meshchanged",[this,$_,$B]),$B.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$$(0,$Z,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$$(0,$Z,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$$(0,$Z,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$$(0,$Z,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$_}($z_)),$F_=function($B){function $_($B){$_.__super.call(this,$B),$B.meshFilter.on("meshchanged",this,this._onMeshChanged)}$A($_,"laya.d3.core.MeshRender",$t_);var $Z=$_.prototype;return $Z._onMeshChanged=function($B,$_,$Z){$Z.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$Z.once("loaded",this,this._onMeshLoaed)},$Z._onMeshLoaed=function($B,$_){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$Z._calculateBoundingSphereByInitSphere=function($B){var $_=NaN,$Z=this._owner.transform,$n=$Z.scale.elements,$g=Math.abs($n[0]),$q=Math.abs($n[1]),$P=Math.abs($n[2]);$_=$q<=$g&&$P<=$g?$g:$P<=$q?$q:$P,$P_.transformCoordinate($B.center,$Z.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$B.radius*$_},$Z._calculateBoundBoxByInitCorners=function($B){for(var $_=this._owner.transform.worldMatrix,$Z=0;$Z<8;$Z++)$P_.transformCoordinate($B[$Z],$_,$t_._tempBoundBoxCorners[$Z]);$dB.createfromPoints($t_._tempBoundBoxCorners,this._boundingBox)},$Z._calculateBoundingSphere=function(){var $B=this._owner.meshFilter.sharedMesh;null==$B||null==$B.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($B.boundingSphere)},$Z._calculateBoundingBox=function(){var $B=this._owner.meshFilter.sharedMesh;null==$B||null==$B.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($B.boundingBoxCorners)},$Z._renderUpdate=function($B){var $_=this._owner.transform;if($_){this._setShaderValueMatrix4x4(0,$_.worldMatrix);var $Z=this._owner.getProjectionViewWorldMatrix($B);this._setShaderValueMatrix4x4(1,$Z)}else this._setShaderValueMatrix4x4(0,$B_.DEFAULT),this._setShaderValueMatrix4x4(1,$B);return $j_.debugMode&&this._renderRenderableBoundBox(),!0},$_}(),$u_=function($_){function $n(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$n.__super.call(this),this._renderState=new $O,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $I_,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $_B,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $P_(.7,.7,.7),this.ambientColor=new $P_(.212,.227,.259),$v.shaderHighPrecision&&this.addShaderDefine($Q_.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$A($n,"laya.d3.core.scene.Scene",$_);var $B=$n.prototype;return $t.imps($B,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$B._setUrl=function($B){this._url=$B},$B._getGroup=function(){return this._group},$B._setGroup=function($B){this._group=$B},$B._display=function(){$t.stage._scenes.push(this),$t.stage._scenes.sort($n._sortScenes);for(var $B=0,$_=this._childs.length;$B<$_;$B++){var $Z=this._childs[$B];$Z.active&&$Z._activeHierarchy()}},$B._unDisplay=function(){var $B=$t.stage._scenes;$B.splice($B.indexOf(this),1);for(var $_=0,$Z=this._childs.length;$_<$Z;$_++){var $n=this._childs[$_];$n.active&&$n._inActiveHierarchy()}},$B._addChild3D=function($B){$B.transform._onWorldTransform(),$B._setBelongScene(this),this.displayedInStage&&$B.active&&$B._activeHierarchy()},$B._removeChild3D=function($B){$B.transform.parent=null,this.displayedInStage&&$B.active&&$B._inActiveHierarchy(),$B._setUnBelongScene()},$B.initOctree=function($B,$_,$Z,$n,$g){void 0===$g&&($g=6),this.treeSize=new $P_($B,$_,$Z),this.treeLevel=$g,this.treeRoot=new $d(this,0),this.treeRoot.init($n,this.treeSize)},$B._prepareUpdateToRenderState=function($B,$_){$_.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$_.scene=this},$B._prepareSceneToRender=function($B){var $_=this._lights.length;if(0<$_)for(var $Z=0,$n=0;$n<$_&&!(this._lights[$n]._prepareToScene($B)&&++$Z>=this._enableLightCount);$n++);},$B._updateChilds=function($B){for(var $_=0,$Z=this._childs.length;$_<$Z;++$_)this._childs[$_]._update($B)},$B._preRenderScene=function($B,$_,$Z){var $n,$g=$_._viewMatrix,$q=$_._projectionMatrix,$P=$_._projectionViewMatrix,$k=0,$m=$_.camera;for($m.useOcclusionCulling?this.treeRoot?$ZB.renderObjectCullingOctree($Z,this,$m,$g,$q,$P):$ZB.renderObjectCulling($Z,this,$m,$g,$q,$P):$ZB.renderObjectCullingNoBoundFrustum(this,$m,$g,$q,$P),$k=0,$n=this._quenes.length;$k<$n;$k++)this._quenes[$k]&&this._quenes[$k]._preRender($_)},$B._clear=function($B,$_){var $Z=$_._viewport,$n=$_.camera,$g=$Z.x,$q=$n.renderTargetSize.height-$Z.y-$Z.height,$P=$Z.width,$k=$Z.height;$B.viewport($g,$q,$P,$k);var $m=256,$D=$n.renderTarget;switch($n.clearFlag){case 0:var $T=$n.clearColor;if($T){$B.enable(3089),$B.scissor($g,$q,$P,$k);var $e=$T.elements;$B.clearColor($e[0],$e[1],$e[2],$e[3]),$m|=16384}if($D)switch($T||($m=16384),$D.depthStencilFormat){case 33189:$m|=256;break;case 36168:$m|=1024;break;case 34041:$m|=256,$m|=1024}$B.clear($m),$T&&$B.disable(3089);break;case 1:case 2:if($D)switch($m=16384,$D.depthStencilFormat){case 33189:$m|=256;break;case 36168:$m|=1024;break;case 34041:$m|=256,$m|=1024}$B.clear($m);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$B._renderScene=function($B,$_){var $Z,$n,$g=$_.camera,$q=0;for($q=0;$q<2;$q++)($n=this._quenes[$q])&&($g.renderTarget?$n._render($_,!0):$n._render($_,!1));if(1===$g.clearFlag){var $P=$g.sky;$P&&($V.setCullFace($B,!1),$V.setDepthFunc($B,515),$V.setDepthMask($B,!1),$P._render($_),$V.setDepthFunc($B,513),$V.setDepthMask($B,!0))}for($q=2,$Z=this._quenes.length;$q<$Z;$q++)($n=this._quenes[$q])&&($n._sortAlpha($_.camera.transform.position),$g.renderTarget?$n._render($_,!0):$n._render($_,!1))},$B._set3DRenderConfig=function($B){$B.disable(3042),$V._blend=!1,$B.blendFunc(770,771),$V._sFactor=770,$V._dFactor=771,$B.disable(2929),$V._depthTest=!1,$B.enable(2884),$V._cullFace=!0,$B.depthMask(1),$V._depthMask=!0,$B.frontFace(2304),$V._frontFace=2304},$B._set2DRenderConfig=function($B){$V.setBlend($B,!0),$V.setBlendFunc($B,1,771),$V.setDepthTest($B,!1),$V.setCullFace($B,!1),$V.setDepthMask($B,!0),$V.setFrontFace($B,2305),$B.viewport(0,0,$T.width,$T.height)},$B._parseCustomProps=function($B,$_,$Z,$n){var $g=$n.customProps.lightmaps,$q=$g.length,$P=this._lightmaps;$P.length=$q;for(var $k=0;$k<$q;$k++)$P[$k]=$j.getRes($_[$g[$k].replace(".exr",".png")]);this.setlightmaps($P);var $m=$n.customProps.ambientColor;$m&&(this.ambientColor=new $P_($m[0],$m[1],$m[2]));var $D=$n.customProps.fogColor;$D&&(this.fogColor=new $P_($D[0],$D[1],$D[2]))},$B._addLight=function($B){this._lights.indexOf($B)<0&&this._lights.push($B)},$B._removeLight=function($B){var $_=this._lights.indexOf($B);0<=$_&&this._lights.splice($_,1)},$B._updateScene=function(){var $B=this._renderState;this._prepareUpdateToRenderState($v.mainContext,$B),this._updateComponents($B),this._updateChilds($B),this._lateUpdateComponents($B),this._time+=$B.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$B._updateSceneConch=function(){var $B=this._renderState;this._prepareUpdateToRenderState($v.mainContext,$B),this._updateComponents($B),this._lateUpdateComponents($B),this._prepareSceneToRender($B);for(var $_=0,$Z=this._cameraPool.length;$_<$Z;$_++){var $n=this._cameraPool[$_];($B.camera=$n)._prepareCameraToRender()}},$B._preRenderShadow=function($B,$_,$Z,$n,$g){this.treeRoot?$ZB.renderShadowObjectCullingOctree(this,$_,$Z,$n,$g):$ZB.renderShadowObjectCulling(this,$_,$Z,$n,$g);for(var $q=0,$P=$Z.length;$q<$P;$q++)$Z[$q]&&$Z[$q]._preRender($B)},$B._renderShadowMap=function($B,$_,$Z){var $n=this.parallelSplitShadowMaps[0];$n._calcAllLightCameraInfo($Z);var $g,$q,$P,$k=$n.PSSMNum;if(this._preRenderShadow($_,$n._lightCulling,$n._shadowQuenes,$n._lightVPMatrix[0],$k),this.addShaderDefine($A_.SHADERDEFINE_CAST_SHADOW),1<$k)for(var $m=0;$m<$k;$m++)$g=$n.getRenderTarget($m+1),$n.beginRenderTarget($m+1),$B.clearColor(1,1,1,1),$B.clear(16640),$B.viewport(0,0,$g.width,$g.height),$_.camera=$P=$n.getLightCamera($m),$P._prepareCameraToRender(),$P._prepareCameraViewProject($P.viewMatrix,$P.projectionMatrix),$_._projectionViewMatrix=$n._lightVPMatrix[$m+1],($q=$n._shadowQuenes[$m])._preRender($_),$q._renderShadow($_,!1),$n.endRenderTarget($m+1);else $g=$n.getRenderTarget(1),$n.beginRenderTarget(1),$B.clearColor(1,1,1,1),$B.clear(16640),$B.viewport(0,0,$g.width,$g.height),$_.camera=$P=$n.getLightCamera(0),$P._prepareCameraToRender(),$P._prepareCameraViewProject($P.viewMatrix,$P.projectionMatrix),$_._projectionViewMatrix=$n._lightVPMatrix[0],($q=$n._shadowQuenes[0])._preRender($_),$q._renderShadow($_,!0),$n.endRenderTarget(1);this.removeShaderDefine($A_.SHADERDEFINE_CAST_SHADOW)},$B.addTreeNode=function($B){this.treeRoot.addTreeNode($B)},$B.removeTreeNode=function($B){this.treeSize&&$B._treeNode&&$B._treeNode.removeObject($B)},$B.setlightmaps=function($B){this._lightmaps=$B;for(var $_=0,$Z=this._renderableSprite3Ds.length;$_<$Z;$_++)this._renderableSprite3Ds[$_]._render._applyLightMapParams()},$B.getlightmaps=function(){return this._lightmaps},$B.addChildAt=function($B,$_){if(!($B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($B&&$B.__className));if(!$B||this.destroyed||$B===this)return $B;if($B.zOrder&&this._set$P("hasZorder",!0),0<=$_&&$_<=this._childs.length){if($B._parent===this){var $Z=this.getChildIndex($B);this._childs.splice($Z,1),this._childs.splice($_,0,$B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,$_)),this._childChanged()}else $B.parent&&$B.parent.removeChild($B),this._childs===$D.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($_,0,$B),this.conchModel&&this.conchModel.addChildAt($B.conchModel,$_),($B.parent=this)._addChild3D($B);return $B}throw new Error("appendChildAt:The index is out of bounds")},$B.addChild=function($B){if(!($B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$B||this.destroyed||$B===this)return $B;if($B.zOrder&&this._set$P("hasZorder",!0),$B._parent===this){var $_=this.getChildIndex($B);$_!==this._childs.length-1&&(this._childs.splice($_,1),this._childs.push($B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,this._childs.length-1)),this._childChanged())}else $B.parent&&$B.parent.removeChild($B),this._childs===$D.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($B),this.conchModel&&this.conchModel.addChildAt($B.conchModel,this._childs.length-1),($B.parent=this)._childChanged(),this._addChild3D($B);return $B},$B.removeChildAt=function($B){var $_=this.getChildAt($B);return $_&&(this._removeChild3D($_),this._childs.splice($B,1),this.conchModel&&this.conchModel.removeChild($_.conchModel),$_.parent=null),$_},$B.removeChildren=function($B,$_){if(void 0===$B&&($B=0),void 0===$_&&($_=2147483647),this._childs&&0<this._childs.length){var $Z=this._childs;if(0===$B&&$q<=$_){var $n=$Z;this._childs=$D.ARRAY_EMPTY}else $n=$Z.splice($B,$_-$B);for(var $g=0,$q=$n.length;$g<$q;$g++)this._removeChild3D($n[$g]),$n[$g].parent=null,this.conchModel&&this.conchModel.removeChild($n[$g].conchModel)}return this},$B.addFrustumCullingObject=function($B){this.treeRoot?this.addTreeNode($B):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($B):this._cullingRenders[this._cullingRendersLength]=$B,$B._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$B.removeFrustumCullingObject=function($B){if(this.treeRoot)this.removeTreeNode($B);else{this._cullingRendersLength--;var $_=$B._indexInSceneFrustumCullingObjects;if($_!==this._cullingRendersLength){var $Z=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$_]=$Z)._indexInSceneFrustumCullingObjects=$_,$B._indexInSceneFrustumCullingObjects=-1}}},$B.getRenderQueue=function($B){return $B<3e3?this._quenes[1]||(this._quenes[1]=new $S(this)):this._quenes[2]||(this._quenes[2]=new $S(this))},$B.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $S(this)},$B.addShaderDefine=function($B){this._shaderDefineValue|=$B},$B.removeShaderDefine=function($B){this._shaderDefineValue&=~$B},$B.addScript=function($B){return this._addComponent($B)},$B.getScriptByType=function($B,$_){return void 0===$_&&($_=0),this._getComponentByType($B,$_)},$B.getScriptsByType=function($B,$_){this._getComponentsByType($B,$_)},$B.getScriptByIndex=function($B){return this._getComponentByIndex($B)},$B.removeScriptByType=function($B,$_){void 0===$_&&($_=0),this._removeComponentByType($B,$_)},$B.removeScriptsByType=function($B){this._removeComponentByType($B)},$B.removeAllScript=function(){this._removeAllComponent()},$B.render=function($B,$_,$Z){($w._context.ctx._renderKey=0)<this._childs.length&&$B.addRenderObject(this)},$B.renderSubmit=function(){var $B=$v.mainContext,$_=this._renderState;this._set3DRenderConfig($B),this._prepareSceneToRender(this._renderState);var $Z,$n=0,$g=0;if($j_.debugMode||$d.debugMode)for($n=0,$g=this._cameraPool.length;$n<$g;$n++)$Z=this._cameraPool[$n],$j_._debugPhasorSprite.begin(1,$Z),$Z.activeInHierarchy&&$Z._renderCamera($B,$_,this),$j_._debugPhasorSprite.end();else for($n=0,$g=this._cameraPool.length;$n<$g;$n++)($Z=this._cameraPool[$n]).activeInHierarchy&&$Z._renderCamera($B,$_,this);return this._set2DRenderConfig($B),1},$B.onAsynLoaded=function($B,$_,$Z){var $n=$_[0];if("Scene"!==$n.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $g=$_[1];$r_._createNodeByJson(this,$n,this,$g),this.event("hierarchyloaded",[this]),this.__loaded=!0},$B.destroy=function($B){void 0===$B&&($B=!0),this.destroyed||($_.prototype.destroy.call(this,$B),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$j.clearRes(this.url),this.loaded||$j_._cancelLoadByUrl(this.url))},$B.getRenderType=function(){return 0},$B.releaseRender=function(){},$B._addComponent=function($B){var $_,$Z=this._componentsMap.indexOf($B);if(-1===$Z)$_=[],this._componentsMap.push($B),this._typeComponentsIndices.push($_);else if($_=this._typeComponentsIndices[$Z],this._components[$_[0]].isSingleton)throw new Error("无法单实例创建"+$B+"组件，"+$B+"组件已存在！");var $n=$g.getInstance($B);$_.push(this._components.length),this._components.push($n);return $n._initialize(this),$n},$B._removeComponent=function($B,$_){var $Z=this._typeComponentsIndices[$B],$n=$Z[$_],$g=this._components[$n];this._components.splice($n,1),$Z.splice($_,1),0===$Z.length&&(this._typeComponentsIndices.splice($B,1),this._componentsMap.splice($B,1));for(var $q=0,$P=this._componentsMap.length;$q<$P;$q++)for(var $k=($Z=this._typeComponentsIndices[$q]).length-1;0<=$k;$k--){var $m=$Z[$k];if(!($n<$m))break;$Z[$k]=--$m}$g._destroy()},$B._getComponentByType=function($B,$_){void 0===$_&&($_=0);var $Z=this._componentsMap.indexOf($B);return-1===$Z?null:this._components[this._typeComponentsIndices[$Z][$_]]},$B._getComponentsByType=function($B,$_){var $Z=this._componentsMap.indexOf($B);if(-1!==$Z){var $n=this._typeComponentsIndices[$Z],$g=$n.length;$_.length=$g;for(var $q=0;$q<$g;$q++)$_[$q]=this._components[$n[$q]]}else $_.length=0},$B._getComponentByIndex=function($B){return this._components[$B]},$B._removeComponentByType=function($B,$_){void 0===$_&&($_=0);var $Z=this._componentsMap.indexOf($B);-1!==$Z&&this._removeComponent($Z,$_)},$B._removeComponentsByType=function($B){var $_=this._componentsMap.indexOf($B);if(-1!==$_)for(var $Z=this._typeComponentsIndices[$_],$n=0,$g=$Z.length;$n<$g;$Z.length<$g?$g--:$n++)this._removeComponent($_,$n)},$B._removeAllComponent=function(){for(var $B=0,$_=this._componentsMap.length;$B<$_;this._componentsMap.length<$_?$_--:$B++)this._removeComponentsByType(this._componentsMap[$B])},$B._updateComponents=function($B){for(var $_=0,$Z=this._components.length;$_<$Z;$_++){var $n=this._components[$_];!$n.started&&($n._start($B),$n.started=!0),$n.enable&&$n._update($B)}},$B._lateUpdateComponents=function($B){for(var $_=0;$_<this._components.length;$_++){var $Z=this._components[$_];!$Z.started&&($Z._start($B),$Z.started=!0),$Z.enable&&$Z._lateUpdate($B)}},$B._preRenderUpdateComponents=function($B){for(var $_=0;$_<this._components.length;$_++){var $Z=this._components[$_];!$Z.started&&($Z._start($B),$Z.started=!0),$Z.enable&&$Z._preRenderUpdate($B)}},$B._postRenderUpdateComponents=function($B){for(var $_=0;$_<this._components.length;$_++){var $Z=this._components[$_];!$Z.started&&($Z._start($B),$Z.started=!0),$Z.enable&&$Z._postRenderUpdate($B)}},$$(0,$B,"_loaded",null,function($B){this.__loaded=$B}),$$(0,$B,"fogColor",function(){return this._fogColor},function($B){this._fogColor=$B,this._shaderValues.setValue(0,$B.elements)}),$$(0,$B,"enableFog",function(){return this._enableFog},function($B){this._enableFog!==$B&&((this._enableFog=$B)?(this.addShaderDefine($Q_.SHADERDEFINE_FOG),this.removeShaderDefine($Q_.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($Q_.SHADERDEFINE_FOG))}),$$(0,$B,"url",function(){return this._url}),$$(0,$B,"loaded",function(){return this.__loaded}),$$(0,$B,"enableDepthFog",function(){return this._enableDepthFog},function($B){this._enableDepthFog!=$B&&((this._enableDepthFog=$B)?(this.addShaderDefine($Q_.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($Q_.SHADERDEFINE_FOG)):this.removeShaderDefine($Q_.SAHDERDEFINE_DEPTHFOG))}),$$(0,$B,"fogStart",function(){return this._fogStart},function($B){this._fogStart=$B,this._shaderValues.setValue(1,$B)}),$$(0,$B,"fogRange",function(){return this._fogRange},function($B){this._fogRange=$B,this._shaderValues.setValue(2,$B)}),$$(0,$B,"ambientColor",function(){return this._ambientColor},function($B){this._ambientColor=$B,this._shaderValues.setValue(21,$B.elements)}),$$(0,$B,"scene",function(){return this}),$$(0,$B,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$n._sortScenes=function($B,$_){if($B.parent!==$t.stage||$_.parent!==$t.stage)return $B.parent!==$t.stage&&$_.parent!==$t.stage?$n._sortScenes($B.parent,$_.parent):$B.parent===$t.stage?-1:1;var $Z=$t.stage._childs;return $Z.indexOf($B)-$Z.indexOf($_)},$n.load=function($B){return $t.loader.create($B,null,null,$n)},$n.FOGCOLOR=0,$n.FOGSTART=1,$n.FOGRANGE=2,$n.LIGHTDIRECTION=3,$n.LIGHTDIRCOLOR=4,$n.POINTLIGHTPOS=5,$n.POINTLIGHTRANGE=6,$n.POINTLIGHTATTENUATION=7,$n.POINTLIGHTCOLOR=8,$n.SPOTLIGHTPOS=9,$n.SPOTLIGHTDIRECTION=10,$n.SPOTLIGHTSPOT=11,$n.SPOTLIGHTRANGE=12,$n.SPOTLIGHTATTENUATION=13,$n.SPOTLIGHTCOLOR=14,$n.SHADOWDISTANCE=15,$n.SHADOWLIGHTVIEWPROJECT=16,$n.SHADOWMAPPCFOFFSET=17,$n.SHADOWMAPTEXTURE1=18,$n.SHADOWMAPTEXTURE2=19,$n.SHADOWMAPTEXTURE3=20,$n.AMBIENTCOLOR=21,$n.TIME=22,$n}($N),$f_=function($B){function $_($B){$_.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $B_,this._shaderValues=new $I_,this._colliders=[],this._id=++$_._uniqueIDCounter,this._transform=new $J_(this),this.name=$B||"Sprite3D-"+$_._nameNumberCounter++,this.layer=$F.currentCreationLayer,this.active=!0}$A($_,"laya.d3.core.Sprite3D",$l_);var $Z=$_.prototype;return $t.imps($Z,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$Z._setUrl=function($B){this._url=$B},$Z._getGroup=function(){return this._group},$Z._setGroup=function($B){this._group=$B},$Z._addChild3D=function($B){$B.transform.parent=this.transform,this._hierarchyAnimator&&(!$B._hierarchyAnimator&&$B._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($B,!0,[$B.name])),this._scene&&($B._setBelongScene(this._scene),this._activeInHierarchy&&$B._active&&$B._activeHierarchy())},$Z._removeChild3D=function($B){$B.transform.parent=null,this._scene&&(this._activeInHierarchy&&$B._active&&$B._inActiveHierarchy(),$B._setUnBelongScene()),this._hierarchyAnimator&&($B._hierarchyAnimator==this._hierarchyAnimator&&$B._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($B,!1,[$B.name]))},$Z._parseBaseCustomProps=function($B){var $_=this.transform.localPosition;$B.translate?($_.fromArray($B.translate),$_.x*=100,$_.y*=100,$_.z*=100):$_.elements.fill(0),this.transform.localPosition=$_;var $Z=this.transform.localRotation;$B.rotation?$Z.fromArray($B.rotation):$Z.fromArray([0,0,0,-1]),this.transform.localRotation=$Z;var $n=this.transform.localScale;$B.scale?$n.fromArray($B.scale):$n.elements.fill(1),this.transform.localScale=$n;var $g=$B.layer;null!=$g&&(this.layer=$F.getLayerByNumber($g))},$Z._parseCustomComponent=function($B,$_,$Z){for(var $n in $Z){var $g=$Z[$n];switch($n){case"Animator":var $q=this.addComponent(Animator);if($g.avatarPath)$q.avatar=$j.getRes($_[$g.avatarPath]);else{var $P=$g.avatar;if($P){$q.avatar=$j.getRes($_[$P.path]);var $k=$P.linkSprites;$k&&$B.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$q,$k])}}for(var $m=$g.clipPaths,$D=$m.length,$T=0;$T<$D;$T++)$q.addClip($j.getRes($_[$m[$T]]));$q.clip=$j.getRes($_[$m[0]]);var $e=$g.playOnWake;void 0!==$e&&($q.playOnWake=$e);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $I=this.addComponent(SphereCollider);$I.isTrigger=$g.isTrigger;var $A=$I.center;$A.fromArray($g.center),$I.center=$A,$I.radius=$g.radius;break;case"BoxCollider":var $$=this.addComponent(BoxCollider);$$.isTrigger=$g.isTrigger,$$.center.fromArray($g.center);var $w=$$.size;$w.fromArray($g.size),$$.size=$w;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$Z._onRootNodeHierarchyLoaded=function($B,$_){for(var $Z in $_){for(var $n=this,$g=$_[$Z],$q=0,$P=$g.length;$q<$P;$q++){var $k=$g[$q];if(""===$k)break;if(!($n=$n.getChildByName($k)))break}$n&&$B.linkSprite3DToAvatarNode($Z,$n)}},$Z._setHierarchyAnimator=function($B,$_){this._changeHierarchyAnimator($B);for(var $Z=0,$n=this._childs.length;$Z<$n;$Z++){var $g=this._childs[$Z];$g._hierarchyAnimator==$_&&$g._setHierarchyAnimator($B,$_)}},$Z._clearHierarchyAnimator=function($B,$_){this._changeHierarchyAnimator($_);for(var $Z=0,$n=this._childs.length;$Z<$n;$Z++){var $g=this._childs[$Z];$g._hierarchyAnimator==$B&&$g._clearHierarchyAnimator($B,$_)}},$Z._getAnimatorToLinkSprite3D=function($B,$_,$Z){var $n=this.getComponentByType(Animator);if($n&&($n.avatar?$n.avatar._version||$B._setAnimatorToLinkAvatar($n,$_):$B._setAnimatorToLinkSprite3DNoAvatar($n,$_,$Z)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$Z.unshift(this._parent.name);var $g=this._parent;$g._hierarchyAnimator&&$g._getAnimatorToLinkSprite3D($B,$_,$Z)}},$Z._setAnimatorToLinkSprite3DNoAvatar=function($B,$_,$Z){var $n=0,$g=0;for($n=0,$g=$B.getClipCount();$n<$g;$n++)$B._handleSpriteOwnersBySprite($n,$_,$Z,this);for($n=0,$g=this._childs.length;$n<$g;$n++){var $q=this._childs[$n],$P=$Z.length;$Z.push($q.name),$q._setAnimatorToLinkSprite3DNoAvatar($B,$_,$Z),$Z.splice($P,1)}},$Z._changeHierarchyAnimator=function($B){this._hierarchyAnimator=$B},$Z._isLinkSpriteToAnimationNode=function($B,$_,$Z){var $n=$B._avatarNodes.indexOf($_),$g=$B._cacheSpriteToNodesMap;if($Z)this._transform.dummy=$_.transform,$B._cacheNodesToSpriteMap[$n]=$g.length,$g.push($n);else{this._transform.dummy=null;var $q=$B._cacheNodesToSpriteMap[$n];$B._cacheNodesToSpriteMap[$n]=null,$g.splice($q,1)}},$Z._setBelongScene=function($B){this._scene=$B;for(var $_=0,$Z=this._childs.length;$_<$Z;$_++)this._childs[$_]._setBelongScene($B)},$Z._setUnBelongScene=function(){this._scene=null;for(var $B=0,$_=this._childs.length;$B<$_;$B++)this._childs[$B]._setUnBelongScene()},$Z._activeHierarchy=function(){var $B=0,$_=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$B=0,$_=this._colliders.length;$B<$_;$B++)this._layer._addCollider(this._colliders[$B]);for(this.event("activeinhierarchychanged",!0),$B=0,$_=this._childs.length;$B<$_;$B++){var $Z=this._childs[$B];$Z._active&&$Z._activeHierarchy()}},$Z._inActiveHierarchy=function(){var $B=0,$_=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$B=0,$_=this._colliders.length;$B<$_;$B++){var $Z=this._colliders[$B];$Z._clearCollsionMap(),this._layer._removeCollider($Z)}for(this.event("activeinhierarchychanged",!1),$B=0,$_=this._childs.length;$B<$_;$B++){var $n=this._childs[$B];$n._active&&$n._inActiveHierarchy()}},$Z.addComponent=function($B){var $_,$Z=this._componentsMap.indexOf($B);if(-1===$Z)$_=[],this._componentsMap.push($B),this._typeComponentsIndices.push($_);else if($_=this._typeComponentsIndices[$Z],this._components[$_[0]].isSingleton)throw new Error("无法单实例创建"+$B+"组件，"+$B+"组件已存在！");var $n=$g.getInstance($B);return $_.push(this._components.length),this._components.push($n),$n instanceof laya.d3.component.Script&&this._scripts.push($n),$n._initialize(this),$n},$Z._removeComponent=function($B,$_){var $Z,$n=0,$g=this._typeComponentsIndices[$B],$q=$g[$_],$P=this._components[$q];for($P instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($P),1),$g.splice($_,1),0===$g.length&&(this._typeComponentsIndices.splice($B,1),this._componentsMap.splice($B,1)),$n=0,$Z=this._componentsMap.length;$n<$Z;$n++)for(var $k=($g=this._typeComponentsIndices[$n]).length-1;0<=$k;$k--){var $m=$g[$k];if(!($q<$m))break;$g[$k]=--$m}$P._destroy()},$Z._clearSelfRenderObjects=function(){},$Z._addSelfRenderObjects=function(){},$Z._parseCustomProps=function($B,$_,$Z,$n){},$Z._updateChilds=function($B){var $_=this._childs.length;if(0!==$_)for(var $Z=0;$Z<$_;++$Z)this._childs[$Z]._update($B)},$Z._getSortID=function($B,$_){return 1e3*$_.id+$B._getVertexBuffer().vertexDeclaration.id},$Z._update=function($B){($B.owner=this)._activeInHierarchy&&(this._updateComponents($B),this._lateUpdateComponents($B),$Q.spriteCount++,this._childs.length&&this._updateChilds($B))},$Z.getProjectionViewWorldMatrix=function($B){return $B_.multiply($B,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$Z.loadHierarchy=function($B){this.addChild(laya.d3.core.Sprite3D.load($B))},$Z.addChildAt=function($B,$_){if(!($B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$B||this.destroyed||$B===this)return $B;if($B.zOrder&&this._set$P("hasZorder",!0),0<=$_&&$_<=this._childs.length){if($B._parent===this){var $Z=this.getChildIndex($B);this._childs.splice($Z,1),this._childs.splice($_,0,$B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,$_)),this._childChanged()}else $B.parent&&$B.parent.removeChild($B),this._childs===$D.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($_,0,$B),this.conchModel&&this.conchModel.addChildAt($B.conchModel,$_),($B.parent=this)._addChild3D($B);return $B}throw new Error("appendChildAt:The index is out of bounds")},$Z.addChild=function($B){if(!($B instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$B||this.destroyed||$B===this)return $B;if($B.zOrder&&this._set$P("hasZorder",!0),$B._parent===this){var $_=this.getChildIndex($B);$_!==this._childs.length-1&&(this._childs.splice($_,1),this._childs.push($B),this.conchModel&&(this.conchModel.removeChild($B.conchModel),this.conchModel.addChildAt($B.conchModel,this._childs.length-1)),this._childChanged())}else $B.parent&&$B.parent.removeChild($B),this._childs===$D.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($B),this.conchModel&&this.conchModel.addChildAt($B.conchModel,this._childs.length-1),($B.parent=this)._childChanged(),this._addChild3D($B);return $B},$Z.removeChildAt=function($B){var $_=this.getChildAt($B);return $_&&(this._removeChild3D($_),this._childs.splice($B,1),this.conchModel&&this.conchModel.removeChild($_.conchModel),$_.parent=null),$_},$Z.removeChildren=function($B,$_){if(void 0===$B&&($B=0),void 0===$_&&($_=2147483647),this._childs&&0<this._childs.length){var $Z=this._childs;if(0===$B&&$q<=$_){var $n=$Z;this._childs=$D.ARRAY_EMPTY}else $n=$Z.splice($B,$_-$B);for(var $g=0,$q=$n.length;$g<$q;$g++)this._removeChild3D($n[$g]),$n[$g].parent=null,this.conchModel&&this.conchModel.removeChild($n[$g].conchModel)}return this},$Z.onAsynLoaded=function($B,$_,$Z){var $n=$_[0];if("Sprite3D"!==$n.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $g=$_[1];$r_._createNodeByJson(this,$n,this,$g),this.event("hierarchyloaded",[this]),this.__loaded=!0},$Z.cloneTo=function($B){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $_=$B;$_.name=this.name,$_._destroyed=this._destroyed,$_.timer=this.timer,$_._$P=this._$P,$_.active=this._active;var $Z=$_.transform.localPosition;this.transform.localPosition.cloneTo($Z),$_.transform.localPosition=$Z;var $n=$_.transform.localRotation;this.transform.localRotation.cloneTo($n),$_.transform.localRotation=$n;var $g=$_.transform.localScale;this.transform.localScale.cloneTo($g),$_.transform.localScale=$g,$_.isStatic=this.isStatic;var $q=0,$P=0;for($q=0,$P=this._componentsMap.length;$q<$P;$q++){var $k=$_.addComponent(this._componentsMap[$q]);this._components[$q]._cloneTo($k)}for($q=0,$P=this._childs.length;$q<$P;$q++)$_.addChild(this._childs[$q].clone());var $m=$_.getComponentByType(Animator);if($m){var $D=$m._linkSpritesData;if($D)for(var $T in $D){for(var $e=$D[$T],$I=$_,$A=0,$$=$e.length;$A<$$&&($I=$I.getChildByName($e[$A]));$A++);if($I){var $w=$m._avatarNodeMap[$T];$I._isLinkSpriteToAnimationNode($m,$w,!0)}}}},$Z.clone=function(){var $B=new this.constructor;return this.cloneTo($B),$B},$Z.destroy=function($B){if(void 0===$B&&($B=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$B);var $_,$Z=0;for($Z=0,$_=this._components.length;$Z<$_;$Z++)this._components[$Z]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$j.clearRes(this.url),this.loaded||$j_._cancelLoadByUrl(this.url)}},$Z._handleSpriteToAvatar=function($B,$_){$B._avatarNodes;var $Z=$B._avatarNodeMap[this.name];$Z&&$Z.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($B,$Z,$_)},$Z._setAnimatorToLinkAvatar=function($B,$_){this._handleSpriteToAvatar($B,$_);for(var $Z=0,$n=this._childs.length;$Z<$n;$Z++){this._childs[$Z]._setAnimatorToLinkAvatar($B,$_)}},$$(0,$Z,"activeInHierarchy",function(){return this._activeInHierarchy}),$$(0,$Z,"_loaded",null,function($B){this.__loaded=$B}),$$(0,$Z,"active",function(){return this._active},function($B){this._active!==$B&&(this._active=$B,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($B?this._activeHierarchy():this._inActiveHierarchy()))}),$$(0,$Z,"componentsCount",function(){return this._components.length}),$$(0,$Z,"loaded",function(){return this.__loaded}),$$(0,$Z,"id",function(){return this._id}),$$(0,$Z,"url",function(){return this._url}),$$(0,$Z,"layer",function(){return this._layer},function($B){if(this._layer!==$B){if(!$B)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $_=0,$Z=this._colliders.length;if(this._layer)for($_=0;$_<$Z;$_++)this._layer._removeCollider(this._colliders[$_]);for($_=0;$_<$Z;$_++)$B._addCollider(this._colliders[$_])}this._layer=$B,this.event("layerchanged",$B)}}),$$(0,$Z,"scene",function(){return this._scene}),$$(0,$Z,"transform",function(){return this._transform}),$_.instantiate=function($B,$_,$Z,$n,$g){void 0===$Z&&($Z=!0);var $q=$B.clone();$_&&$_.addChild($q);var $P=$q.transform;if($Z){var $k=$P.worldMatrix;$B.transform.worldMatrix.cloneTo($k),$P.worldMatrix=$k}else $n&&($P.position=$n),$g&&($P.rotation=$g);return $q},$_.load=function($B){return $t.loader.create($B,null,null,$_)},$_.WORLDMATRIX=0,$_.MVPMATRIX=1,$_._uniqueIDCounter=0,$_._nameNumberCounter=0,$_}(),$b_=function($B){function $T($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$T.__super.call(this),!$B||!$_)throw"Shader Error";this._id=++$T._count,this._vs=$B,this._ps=$_,this._attributeMap=$Z,this._sceneUniformMap=$n,this._cameraUniformMap=$g,this._spriteUniformMap=$q,this._materialUniformMap=$P,this._renderElementUniformMap=$k,this._precompile=$m,this._define=$D,this._precompile&&$T.extCompileObj&&$T.extCompileFunc?$T.extCompileFunc.call($T.extCompileObj,$B,$_,$D):this.recreateResource()}$A($T,"laya.d3.shader.Shader3D",$Z);var $_=$T.prototype;return $_.recreateResource=function(){$o.now();this._compile(),this.completeCreate(),this.memorySize=0},$_.disposeResource=function(){$v.mainContext.deleteShader(this._vshader),$v.mainContext.deleteShader(this._pshader),$v.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$_._compile=function(){if(!$v.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $B=[this._vs,this._ps],$_=$v.mainContext;if(this._program=$_.createProgram(),this._vshader=$T._createShader($_,$B[0],35633),this._pshader=$T._createShader($_,$B[1],35632),$_.attachShader(this._program,this._vshader),$_.attachShader(this._program,this._pshader),$_.linkProgram(this._program),!$w.isConchApp&&$Q_.debugMode&&!$_.getProgramParameter(this._program,35714))throw $_.getProgramInfoLog(this._program);var $Z,$n=0,$g=0,$q=0;for($q=$w.isConchApp?$_.getProgramParameterEx(this._vs,this._ps,"",35721):$_.getProgramParameter(this._program,35721),$n=0;$n<$q;$n++){var $P=null;$Z={vartype:"attribute",ivartype:0,attrib:$P=$w.isConchApp?$_.getActiveAttribEx(this._vs,this._ps,"",$n):$_.getActiveAttrib(this._program,$n),location:$_.getAttribLocation(this._program,$P.name),name:$P.name,type:$P.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($Z)}var $k=0;for($k=$w.isConchApp?$_.getProgramParameterEx(this._vs,this._ps,"",35718):$_.getProgramParameter(this._program,35718),$n=0;$n<$k;$n++){var $m=null;$m=$w.isConchApp?$_.getActiveUniformEx(this._vs,this._ps,"",$n):$_.getActiveUniform(this._program,$n),0<($Z={vartype:"uniform",ivartype:1,attrib:$P,location:$_.getUniformLocation(this._program,$m.name),name:$m.name,type:$m.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($Z.name=$Z.name.substr(0,$Z.name.length-3),$Z.isArray=!0,$Z.location=$_.getUniformLocation(this._program,$Z.name)),this._uniformParams.push($Z)}for($n=0,$g=this._attributeParams.length;$n<$g;$n++)($Z=this._attributeParams[$n]).indexOfParams=$n,$Z.index=1,$Z.value=[$Z.location,null],$Z.codename=$Z.name,$Z.name=null!=this._attributeMap[$Z.codename]?this._attributeMap[$Z.codename]:$Z.codename,this._attributeParamsMap.push($Z.name),this._attributeParamsMap.push($Z),$Z._this=this,$Z.uploadedValue=[],$Z.fun=this._attribute;for($n=0,$g=this._uniformParams.length;$n<$g;$n++)switch(($Z=this._uniformParams[$n]).indexOfParams=$n,$Z.index=1,$Z.value=[$Z.location,null],$Z.codename=$Z.name,null!=this._sceneUniformMap[$Z.codename]?($Z.name=this._sceneUniformMap[$Z.codename],this._sceneUniformParamsMap.push($Z.name),this._sceneUniformParamsMap.push($Z)):null!=this._cameraUniformMap[$Z.codename]?($Z.name=this._cameraUniformMap[$Z.codename],this._cameraUniformParamsMap.push($Z.name),this._cameraUniformParamsMap.push($Z)):null!=this._spriteUniformMap[$Z.codename]?($Z.name=this._spriteUniformMap[$Z.codename],this._spriteUniformParamsMap.push($Z.name),this._spriteUniformParamsMap.push($Z)):null!=this._materialUniformMap[$Z.codename]?($Z.name=this._materialUniformMap[$Z.codename],this._materialUniformParamsMap.push($Z.name),this._materialUniformParamsMap.push($Z)):null!=this._renderElementUniformMap[$Z.codename]?($Z.name=this._renderElementUniformMap[$Z.codename],this._renderElementUniformParamsMap.push($Z.name),this._renderElementUniformParamsMap.push($Z)):console.log("Shader:can't find uinform name:"+$Z.codename+" in shader file."),$Z._this=this,$Z.uploadedValue=[],$Z.type){case 5124:$Z.fun=$Z.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$Z.fun=$Z.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$Z.fun=$Z.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$Z.fun=$Z.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$Z.fun=$Z.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$Z.fun=this._uniform_sampler2D;break;case 35680:$Z.fun=this._uniform_samplerCube;break;case 35676:$Z.fun=this._uniformMatrix4fv;break;case 35670:$Z.fun=this._uniform1i;break;case 35674:$Z.fun=this._uinformMatrix2fv;break;case 35675:$Z.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$_._attribute=function($B,$_){var $Z=$v.mainContext,$n=$k._enableAtributes,$g=$B.location;return $n[$g]||$Z.enableVertexAttribArray($g),$Z.vertexAttribPointer($g,$_[0],$_[1],$_[2],$_[3],$_[4]),$n[$g]=$k._bindVertexBuffer,1},$_._uniform1f=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_?($v.mainContext.uniform1f($B.location,$Z[0]=$_),1):0},$_._uniform1fv=function($B,$_){if($_.length<4){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($v.mainContext.uniform1fv($B.location,$_),$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3],1):0}return $v.mainContext.uniform1fv($B.location,$_),1},$_._uniform_vec2=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]?($v.mainContext.uniform2f($B.location,$Z[0]=$_[0],$Z[1]=$_[1]),1):0},$_._uniform_vec2v=function($B,$_){if($_.length<2){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($v.mainContext.uniform2fv($B.location,$_),$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3],1):0}return $v.mainContext.uniform2fv($B.location,$_),1},$_._uniform_vec3=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]?($v.mainContext.uniform3f($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2]),1):0},$_._uniform_vec3v=function($B,$_){return $v.mainContext.uniform3fv($B.location,$_),1},$_._uniform_vec4=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($v.mainContext.uniform4f($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3]),1):0},$_._uniform_vec4v=function($B,$_){return $v.mainContext.uniform4fv($B.location,$_),1},$_._uniformMatrix2fv=function($B,$_){return $v.mainContext.uniformMatrix2fv($B.location,!1,$_),1},$_._uniformMatrix3fv=function($B,$_){return $v.mainContext.uniformMatrix3fv($B.location,!1,$_),1},$_._uniformMatrix4fv=function($B,$_){return $v.mainContext.uniformMatrix4fv($B.location,!1,$_),1},$_._uinformMatrix2fv=function($B,$_){return $v.mainContext.uniformMatrix2fv($B.location,!1,$_),1},$_._uinformMatrix3fv=function($B,$_){return $v.mainContext.uniformMatrix3fv($B.location,!1,$_),1},$_._uniform1i=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_?($v.mainContext.uniform1i($B.location,$Z[0]=$_),1):0},$_._uniform1iv=function($B,$_){return $v.mainContext.uniform1iv($B.location,$_),1},$_._uniform_ivec2=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]?($v.mainContext.uniform2i($B.location,$Z[0]=$_[0],$Z[1]=$_[1]),1):0},$_._uniform_ivec2v=function($B,$_){return $v.mainContext.uniform2iv($B.location,$_),1},$_._uniform_vec3i=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]?($v.mainContext.uniform3i($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2]),1):0},$_._uniform_vec3vi=function($B,$_){return $v.mainContext.uniform3iv($B.location,$_),1},$_._uniform_vec4i=function($B,$_){var $Z=$B.uploadedValue;return $Z[0]!==$_[0]||$Z[1]!==$_[1]||$Z[2]!==$_[2]||$Z[3]!==$_[3]?($v.mainContext.uniform4i($B.location,$Z[0]=$_[0],$Z[1]=$_[1],$Z[2]=$_[2],$Z[3]=$_[3]),1):0},$_._uniform_vec4vi=function($B,$_){return $v.mainContext.uniform4iv($B.location,$_),1},$_._uniform_sampler2D=function($B,$_){var $Z=$_.source||$_.defaulteTexture.source,$n=$v.mainContext,$g=$B.uploadedValue;if(null!=$g[0])return $n.activeTexture($T._TEXTURES[$g[0]]),$Z&&$V.bindTexture($n,3553,$Z),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $g[0]=this._curActTexIndex,$n.uniform1i($B.location,this._curActTexIndex),$n.activeTexture($T._TEXTURES[this._curActTexIndex]),$Z&&$V.bindTexture($n,3553,$Z),this._curActTexIndex++,1},$_._uniform_samplerCube=function($B,$_){var $Z=$_.source||$_.defaulteTexture.source,$n=$v.mainContext,$g=$B.uploadedValue;if(null!=$g[0])return $n.activeTexture($T._TEXTURES[$g[0]]),$Z?$V.bindTexture($n,34067,$Z):$V.bindTexture($n,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $g[0]=this._curActTexIndex,$n.uniform1i($B.location,this._curActTexIndex),$n.activeTexture($T._TEXTURES[this._curActTexIndex]),$Z?$V.bindTexture($n,34067,$Z):$V.bindTexture($n,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$_._noSetValue=function($B){console.log("no....:"+$B.name)},$_.bind=function(){return $Z.activeShader=this,($Z.bindShader=this).activeResource(),$V.UseProgram(this._program)},$_.uploadAttributes=function($B,$_){for(var $Z,$n,$g=0,$q=0,$P=this._attributeParamsMap.length;$q<$P;$q+=2)$n=this._attributeParamsMap[$q+1],null!=($Z=$B[this._attributeParamsMap[$q]])&&($_&&$_[$n.name]&&$_[$n.name].bind(),$g+=$n.fun.call(this,$n,$Z));$Q.shaderCall+=$g},$_.uploadAttributesX=function($B,$_){for(var $Z,$n,$g=0,$q=0,$P=this._attributeParamsMap.length;$q<$P;$q+=2)$n=this._attributeParamsMap[$q+1],null!=($Z=$B[this._attributeParamsMap[$q]])&&($_._bind(),$g+=$n.fun.call(this,$n,$Z));$Q.shaderCall+=$g},$_.uploadSceneUniforms=function($B){for(var $_,$Z,$n=0,$g=0,$q=this._sceneUniformParamsMap.length;$g<$q;$g+=2)$Z=this._sceneUniformParamsMap[$g+1],null!=($_=$B[this._sceneUniformParamsMap[$g]])&&($n+=$Z.fun.call(this,$Z,$_));$Q.shaderCall+=$n},$_.uploadCameraUniforms=function($B){for(var $_,$Z,$n=0,$g=0,$q=this._cameraUniformParamsMap.length;$g<$q;$g+=2)$Z=this._cameraUniformParamsMap[$g+1],null!=($_=$B[this._cameraUniformParamsMap[$g]])&&($n+=$Z.fun.call(this,$Z,$_));$Q.shaderCall+=$n},$_.uploadSpriteUniforms=function($B){for(var $_,$Z,$n=0,$g=0,$q=this._spriteUniformParamsMap.length;$g<$q;$g+=2)$Z=this._spriteUniformParamsMap[$g+1],null!=($_=$B[this._spriteUniformParamsMap[$g]])&&($n+=$Z.fun.call(this,$Z,$_));$Q.shaderCall+=$n},$_.uploadMaterialUniforms=function($B){for(var $_,$Z,$n=0,$g=0,$q=this._materialUniformParamsMap.length;$g<$q;$g+=2)$Z=this._materialUniformParamsMap[$g+1],null!=($_=$B[this._materialUniformParamsMap[$g]])&&($n+=$Z.fun.call(this,$Z,$_));$Q.shaderCall+=$n},$_.uploadRenderElementUniforms=function($B){for(var $_,$Z,$n=0,$g=0,$q=this._renderElementUniformParamsMap.length;$g<$q;$g+=2)$Z=this._renderElementUniformParamsMap[$g+1],null!=($_=$B[this._renderElementUniformParamsMap[$g]])&&($n+=$Z.fun.call(this,$Z,$_));$Q.shaderCall+=$n},$T.create=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){return new $T($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D)},$T.addInclude=function($B,$_){$C.addInclude($B,$_)},$T._createShader=function($B,$_,$Z){var $n=$B.createShader($Z);if($B.shaderSource($n,$_),$B.compileShader($n),$Q_.debugMode&&!$B.getShaderParameter($n,35713))throw $B.getShaderInfoLog($n);return $n},$T.PERIOD_RENDERELEMENT=0,$T.PERIOD_MATERIAL=1,$T.PERIOD_SPRITE=2,$T.PERIOD_CAMERA=3,$T.PERIOD_SCENE=4,$T._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$T._count=0,$T._preCompile=!1,$T.extCompileFunc=null,$T.extCompileObj=null,$e($T,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $M}]),$T}(),$x_=function($k){function $m(){this._transformUV=null,$m.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $P_(.6,.6,.6)),this._setColor(10,new $P_(1,1,1)),this._setColor(11,new $k_(1,1,1,8)),this._setColor(12,new $P_(1,1,1)),this._setColor(7,new $k_(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $k_(1,1,0,0)),this.renderMode=1}$A($m,"laya.d3.core.material.StandardMaterial",$k);var $B=$m.prototype;return $B.disableLight=function(){this._addDisablePublicShaderDefine($Q_.SHADERDEFINE_POINTLIGHT|$Q_.SHADERDEFINE_SPOTLIGHT|$Q_.SHADERDEFINE_DIRECTIONLIGHT)},$B.disableFog=function(){this._addDisablePublicShaderDefine($Q_.SHADERDEFINE_FOG)},$B.onAsynLoaded=function($B,$_,$Z){var $n=$_[0];if($n.version)$k.prototype.onAsynLoaded.call(this,$B,$_,$Z);else{var $g=$_[1],$q=$n.props;for(var $P in $q)this[$P]=$q[$P];$m._parseStandardMaterial($g,this,$n),this._endLoaded()}},$B.cloneTo=function($B){$k.prototype.cloneTo.call(this,$B);var $_=$B;this._transformUV&&($_._transformUV=this._transformUV.clone())},$$(0,$B,"ambientColor",function(){return this._getColor(9)},function($B){this._setColor(9,$B)}),$$(0,$B,"ambientTexture",function(){return this._getTexture(5)},function($B){$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$B)}),$$(0,$B,"renderMode",null,function($B){switch($B){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($m.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($B)}),$$(0,$B,"reflectColor",function(){return this._getColor(12)},function($B){this._setColor(12,$B)}),$$(0,$B,"tilingOffset",function(){return this._getColor(15)},function($B){if($B){var $_=$B.elements;1!=$_[0]||1!=$_[1]||0!=$_[2]||0!=$_[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$B)}),$$(0,$B,"albedo",function(){return this._getColor(7)},function($B){this._setColor(7,$B)}),$$(0,$B,"diffuseColor",function(){return this._getColor(10)},function($B){this._setColor(10,$B)}),$$(0,$B,"albedoColor",function(){return this._getColor(7)},function($B){this._setColor(7,$B)}),$$(0,$B,"specularColor",function(){return this._getColor(11)},function($B){this._setColor(11,$B)}),$$(0,$B,"diffuseTexture",function(){return this._getTexture(1)},function($B){$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$B)}),$$(0,$B,"normalTexture",function(){return this._getTexture(2)},function($B){$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$B)}),$$(0,$B,"specularTexture",function(){return this._getTexture(3)},function($B){$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$B)}),$$(0,$B,"emissiveTexture",function(){return this._getTexture(4)},function($B){$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$B)}),$$(0,$B,"reflectTexture",function(){return this._getTexture(6)},function($B){$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$B)}),$$(0,$B,"transformUV",function(){return this._transformUV},function($B){this._transformUV=$B,this._setMatrix4x4(13,$B.matrix),$B?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$B.matrix.elements,0)}),$m.__init__=function(){$m.SHADERDEFINE_DIFFUSEMAP=$m.shaderDefines.registerDefine("DIFFUSEMAP"),$m.SHADERDEFINE_NORMALMAP=$m.shaderDefines.registerDefine("NORMALMAP"),$m.SHADERDEFINE_SPECULARMAP=$m.shaderDefines.registerDefine("SPECULARMAP"),$m.SHADERDEFINE_EMISSIVEMAP=$m.shaderDefines.registerDefine("EMISSIVEMAP"),$m.SHADERDEFINE_AMBIENTMAP=$m.shaderDefines.registerDefine("AMBIENTMAP"),$m.SHADERDEFINE_REFLECTMAP=$m.shaderDefines.registerDefine("REFLECTMAP"),$m.SHADERDEFINE_UVTRANSFORM=$m.shaderDefines.registerDefine("UVTRANSFORM"),$m.SHADERDEFINE_TILINGOFFSET=$m.shaderDefines.registerDefine("TILINGOFFSET"),$m.SHADERDEFINE_ADDTIVEFOG=$m.shaderDefines.registerDefine("ADDTIVEFOG")},$m.load=function($B){return $t.loader.create($B,null,null,$m)},$m._parseStandardMaterial=function($B,$_,$Z){var $n=$Z.customProps,$g=$n.ambientColor;$_.ambientColor=new $P_($g[0],$g[1],$g[2]);var $q=$n.diffuseColor;$_.diffuseColor=new $P_($q[0],$q[1],$q[2]);var $P=$n.specularColor;$_.specularColor=new $k_($P[0],$P[1],$P[2],$P[3]);var $k=$n.reflectColor;$_.reflectColor=new $P_($k[0],$k[1],$k[2]);var $m=$n.albedoColor;$m&&($_.albedo=new $k_($m[0],$m[1],$m[2],$m[3]));var $D=$n.diffuseTexture.texture2D;$D&&($_.diffuseTexture=$j.getRes($B[$D]));var $T=$n.normalTexture.texture2D;$T&&($_.normalTexture=$j.getRes($B[$T]));var $e=$n.specularTexture.texture2D;$e&&($_.specularTexture=$j.getRes($B[$e]));var $I=$n.emissiveTexture.texture2D;$I&&($_.emissiveTexture=$j.getRes($B[$I]));var $A=$n.ambientTexture.texture2D;$A&&($_.ambientTexture=$j.getRes($B[$A]));var $$=$n.reflectTexture.texture2D;$$&&($_.reflectTexture=$j.getRes($B[$$]))},$m.RENDERMODE_OPAQUE=1,$m.RENDERMODE_OPAQUEDOUBLEFACE=2,$m.RENDERMODE_CUTOUT=3,$m.RENDERMODE_CUTOUTDOUBLEFACE=4,$m.RENDERMODE_TRANSPARENT=13,$m.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$m.RENDERMODE_ADDTIVE=15,$m.RENDERMODE_ADDTIVEDOUBLEFACE=16,$m.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$m.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$m.RENDERMODE_DEPTHREAD_ADDTIVE=7,$m.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$m.RENDERMODE_NONDEPTH_TRANSPARENT=9,$m.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$m.RENDERMODE_NONDEPTH_ADDTIVE=11,$m.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$m.SHADERDEFINE_DIFFUSEMAP=0,$m.SHADERDEFINE_NORMALMAP=0,$m.SHADERDEFINE_SPECULARMAP=0,$m.SHADERDEFINE_EMISSIVEMAP=0,$m.SHADERDEFINE_AMBIENTMAP=0,$m.SHADERDEFINE_REFLECTMAP=0,$m.SHADERDEFINE_UVTRANSFORM=0,$m.SHADERDEFINE_TILINGOFFSET=0,$m.SHADERDEFINE_ADDTIVEFOG=0,$m.DIFFUSETEXTURE=1,$m.NORMALTEXTURE=2,$m.SPECULARTEXTURE=3,$m.EMISSIVETEXTURE=4,$m.AMBIENTTEXTURE=5,$m.REFLECTTEXTURE=6,$m.ALBEDO=7,$m.UVANIAGE=8,$m.MATERIALAMBIENT=9,$m.MATERIALDIFFUSE=10,$m.MATERIALSPECULAR=11,$m.MATERIALREFLECT=12,$m.UVMATRIX=13,$m.UVAGE=14,$m.TILINGOFFSET=15,$e($m,["defaultMaterial",function(){var $B=new $m;return $B.lock=!0,this.defaultMaterial=$B},"shaderDefines",function(){return this.shaderDefines=new $T_($L_.shaderDefines)}]),$m}($L_),$p_=function($B){function $P($B,$_,$Z,$n,$g){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$Z&&($Z=35044),void 0===$n&&($n=!1),$P.__super.call(this),this._indexType=$B,this._indexCount=$_,this._bufferUsage=$Z,this._bufferType=34963,this._canRead=$n;var $q;if("ushort"==$B)this._indexTypeByteCount=2;else{if("ubyte"!=$B)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$q=this._indexTypeByteCount*$_,this._byteLength=$q,this._bind(),$k._gl.bufferData(this._bufferType,$q,this._bufferUsage),this.uri=$g,$n?("ushort"==$B?this._buffer=new Uint16Array($_):"ubyte"==$B&&(this._buffer=new Uint8Array($_)),this.memorySize=2*$q):this.memorySize=$q}$A($P,"laya.d3.graphics.IndexBuffer3D",$B);var $_=$P.prototype;return $_.setData=function($B,$_,$Z,$n){void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=4294967295);var $g=0;if("ushort"==this._indexType?($g=2,0===$Z&&4294967295===$n||($B=new Uint16Array($B.buffer,$Z*$g,$n))):"ubyte"==this._indexType&&($g=1,0===$Z&&4294967295===$n||($B=new Uint8Array($B.buffer,$Z*$g,$n))),this._bind(),$k._gl.bufferSubData(this._bufferType,$_*$g,$B),this._canRead)if(0!==$_||0!==$Z||4294967295!==$n){var $q=this._buffer.length-$_;$q<$n&&($n=$q);for(var $P=0;$P<$n;$P++)this._buffer[$_+$P]=$B[$P]}else this._buffer=$B},$_.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$_.disposeResource=function(){$B.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$$(0,$_,"indexType",function(){return this._indexType}),$$(0,$_,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$$(0,$_,"indexCount",function(){return this._indexCount}),$$(0,$_,"canRead",function(){return this._canRead}),$P.INDEXTYPE_UBYTE="ubyte",$P.INDEXTYPE_USHORT="ushort",$P.create=function($B,$_,$Z,$n,$g){return void 0===$Z&&($Z=35044),void 0===$n&&($n=!1),new $P($B,$_,$Z,$n,$g)},$P}($k),$K_=function($q){function $P($B,$_,$Z,$n,$g){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$n&&($n=!1),$P.__super.call(this),this._vertexDeclaration=$B,this._vertexCount=$_,this._bufferUsage=$Z,this._bufferType=34962,this._canRead=$n,this.uri=$g,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$_,this._bind(),$k._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$n&&(this._buffer=new Float32Array(this._byteLength/4))}$A($P,"laya.d3.graphics.VertexBuffer3D",$q);var $B=$P.prototype;return $B.bindWithIndexBuffer=function($B){$B&&$B._bind(),this._bind()},$B.setData=function($B,$_,$Z,$n){if(void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=4294967295),0===$Z&&4294967295===$n||($B=new Float32Array($B.buffer,4*$Z,$n)),this._bind(),$k._gl.bufferSubData(this._bufferType,4*$_,$B),this._canRead)if(0!==$_||0!==$Z||4294967295!==$n){var $g=this._buffer.length-$_;$g<$n&&($n=$g);for(var $q=0;$q<$n;$q++)this._buffer[$_+$q]=$B[$q]}else this._buffer=$B},$B.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$B.disposeResource=function(){for(var $B=$v.mainContext,$_=this._vertexDeclaration.getVertexElements(),$Z=$k._enableAtributes,$n=0,$g=$_.length;$n<$g;$n++)$Z[$n]===this._glBuffer&&($B.disableVertexAttribArray($n),$Z[$n]=null);$q.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$$(0,$B,"vertexDeclaration",function(){return this._vertexDeclaration}),$$(0,$B,"vertexCount",function(){return this._vertexCount}),$$(0,$B,"canRead",function(){return this._canRead}),$P.create=function($B,$_,$Z,$n,$g){return void 0===$Z&&($Z=35044),void 0===$n&&($n=!1),new $P($B,$_,$Z,$n,$g)},$P}($k),$H_=function($B){function $C(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$C.__super.call(this),this._type=3553}$A($C,"laya.d3.resource.DataTexture2D",$v_);var $_=$C.prototype;return $_.genDebugMipmaps=function(){var $B=[];return $B.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$B.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$B.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$B.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$B.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$B.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$B.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$B.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$B.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$B.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$B},$_._onTextureLoaded=function($B){},$_._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $B=$v.mainContext,$_=this._source=$B.createTexture(),$Z=this._width,$n=this._height,$g=$V.curBindTexTarget,$q=$V.curBindTexValue,$P=!1;if($V.bindTexture($B,this._type,$_),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $k=0;$B.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $m=0;$m<this._mipmaps.length;$m++){if(this._mipmaps[$m].byteLength!=$D*$T*4)throw"mipmap size error  level:"+$m;$B.texSubImage2D(this._type,0,$C.simLodRect[$k++],$C.simLodRect[$k++],$C.simLodRect[$k++],$C.simLodRect[$k++],6408,5121,new Uint8Array(this._mipmaps[$m]))}this.minFifter=9729,this.magFifter=9729}else{var $D=this._width,$T=this._height;for($k=0,$B.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$m=0;$m<this._mipmaps.length;$m++){if(this._mipmaps[$m].byteLength!=$D*$T*4)throw"mipmap size error  level:"+$m;$B.texImage2D(this._type,$m,6408,$D,$T,0,6408,5121,new Uint8Array(this._mipmaps[$m])),($D/=2)<1&&($D=1),($T/=2)<1&&($T=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$B.pixelStorei($B.UNPACK_ALIGNMENT,1),$B.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $e=0,$I=!1,$A=!1;this._buffer.byteLength==4*$Z*$n?($e=6408,$I=!0):this._buffer.byteLength==3*$Z*$n?($e=6407,$A=!0):$e=this._format,$I||$A?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$A&&$B.pixelStorei($B.UNPACK_ALIGNMENT,1),$B.texImage2D(this._type,0,$e,$Z,$n,0,$e,5121,this._buffer)):$B&&$e==$B.ALPHA?($B.texImage2D(3553,0,$e,$Z,$n,0,$e,$B.UNSIGNED_BYTE,this._buffer),$P=!0):0!=$e&&($B.compressedTexImage2D(3553,0,$e,$Z,$n,0,this._buffer),$P=!0)}var $$=this._minFifter,$w=this._magFifter,$r=0==this._wrapModeU?10497:33071,$j=0==this._wrapModeV?10497:33071,$y=$z.isPOT($Z,$n);$y?(this._mipmap||this._mipmaps?-1!==$$||($$=9987):-1!==$$||($$=9729),-1!==$w||($w=9729),$B.texParameteri(this._type,10241,$$),$B.texParameteri(this._type,10240,$w),$B.texParameteri(this._type,10242,$r),$B.texParameteri(this._type,10243,$j),this._mipmap&&$B.generateMipmap(this._type)):(-1!==$$||($$=9729),-1!==$w||($w=9729),$B.texParameteri(this._type,10241,$$),$B.texParameteri(this._type,10240,$w),$B.texParameteri(this._type,10242,33071),$B.texParameteri(this._type,10243,33071)),$g&&$q&&$V.bindTexture($B,$g,$q),this.memorySize=$P?this._buffer.length:$y?$Z*$n*4*(1+1/3):$Z*$n*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$_.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$_.onAsynLoaded=function($B,$_,$Z){var $n;$Z&&($n=$Z[0].call(this,$_)),$n&&(this._width=$n.width,this._height=$n.height,this._buffer=$n.data),this._src=$B,this._size=new $w_(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$_.getPixels=function(){return new Uint8Array(this._buffer)},$_.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($v.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$$(0,$_,"src",function(){return this._src}),$C.create=function($B,$_,$Z,$n,$g,$q,$P){if(void 0===$n&&($n=9729),void 0===$g&&($g=9729),void 0===$q&&($q=!0),!$B||$B.byteLength<$_*$Z*4)throw"DataTexture2D create error";var $k=new $C;return $k.uri=$P,$k._buffer=$B,$k._width=$_,$k._height=$Z,$k._mipmap=$q,$k._magFifter=$n,$k._minFifter=$g,$k._size=new $w_($k._width,$k._height),$k._conchTexture?alert("怎么给runtime传递datatexture数据"):$k.activeResource(),$k},$C.load=function($B,$_,$Z,$n,$g){if(void 0===$_&&($_=0),void 0===$Z&&($Z=0),void 0===$n&&($n=9729),void 0===$g&&($g=9729),"mipmaps"===$Y.getFileExtension($B)){var $q=$t.loader.create($B,null,null,$C,[function($B){this._mipmaps=[];var $_=new Uint32Array($B);this._width=$_[0];var $Z=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$Z=1024),this._width!=$Z)throw"现在只支持512x256的环境贴图。当前的是"+$_[0];this._height=$_[1];for(var $n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$g=this._height,$q=8;;){var $P=$n*$g*4;if($q+$P>$B.byteLength)throw"load mipmaps data size error ";var $k=new Uint8Array($B,$q,$P);if(this._mipmaps.push($k),$q+=$P,1==$n&&1==$g)break;($n/=2)<1&&($n=1),($g/=2)<1&&($g=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$q.simLodInfo=new Float32Array(40);for(var $P=0;$P<$q.simLodInfo.length;)$q.simLodInfo[$P]=($C.simLodRect[$P]+.5)/1024,$P++,$q.simLodInfo[$P]=($C.simLodRect[$P]+.5)/256,$P++,$q.simLodInfo[$P]=Math.max($C.simLodRect[$P]-1,.1)/1024,$P++,$q.simLodInfo[$P]=Math.max($C.simLodRect[$P]-1.5,.1)/256,$P++}return $q}if("number"==typeof $_)return $t.loader.create($B,null,null,$C,[function($B){return this._width=$_,this._height=$Z,this._buffer=$B,null}]);if("function"==typeof $_)return $t.loader.create($B,null,null,$C,[$_]);throw new Error("unknown params.")},$C.lodasatlas=!1,$e($C,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$C}(),$G_=function($B){function $_(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$_.__super.call(this)}$A($_,"laya.d3.resource.models.PrimitiveMesh",$V_);var $Z=$_.prototype;return $t.imps($Z,{"laya.d3.core.render.IRenderable":!0}),$Z._getVertexBuffer=function($B){return void 0===$B&&($B=0),0===$B?this._vertexBuffer:null},$Z._getVertexBuffers=function(){return null},$Z._getIndexBuffer=function(){return this._indexBuffer},$Z._getPositions=function(){var $B,$_=[],$Z=this._vertexBuffer.vertexDeclaration.getVertexElements(),$n=0;for($n=0;$n<$Z.length;$n++){var $g=$Z[$n];if("vector3"===$g.elementFormat&&0===$g.elementUsage){$B=$g;break}}var $q=this._vertexBuffer.getData();for($n=0;$n<$q.length;$n+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $P=$n+$B.offset/4,$k=new $P_($q[$P+0],$q[$P+1],$q[$P+2]);$_.push($k)}return $_},$Z.getRenderElement=function($B){return this},$Z.getRenderElementsCount=function(){return 1},$Z.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$Z._beforeRender=function($B){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$Z._render=function($B){$v.mainContext.drawElements(4,this._numberIndices,5123,0),$Q.drawCall++,$Q.trianglesFaces+=this._numberIndices/3},$$(0,$Z,"_vertexBufferCount",function(){return 1}),$$(0,$Z,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$_}(),$W_=function($B){function $_(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$_.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$A($_,"laya.d3.resource.models.Mesh",$V_);var $Z=$_.prototype;return $Z._getPositions=function(){var $B,$_,$Z,$n,$g,$q=[],$P=0,$k=0,$m=0;if(0!==this._vertexBuffers.length){var $D=this._vertexBuffers.length;for($P=0;$P<$D;$P++){for($Z=($B=this._vertexBuffers[$P]).vertexDeclaration.getVertexElements(),$k=0;$k<$Z.length;$k++)if("vector3"===($n=$Z[$k]).elementFormat&&0===$n.elementUsage){$_=$n;break}for($g=$B.getData(),$k=0;$k<$g.length;$k+=$B.vertexDeclaration.vertexStride/4)$m=$k+$_.offset/4,$q.push(new $P_($g[$m+0],$g[$m+1],$g[$m+2]))}}else{var $T=this._subMeshes.length;for($P=0;$P<$T;$P++){for($Z=($B=this._subMeshes[$P]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$k=0;$k<$Z.length;$k++)if("vector3"===($n=$Z[$k]).elementFormat&&0===$n.elementUsage){$_=$n;break}for($g=$B.getData(),$k=0;$k<$g.length;$k+=$B.vertexDeclaration.vertexStride/4)$m=$k+$_.offset/4,$q.push(new $P_($g[$m+0],$g[$m+1],$g[$m+2]))}}return $q},$Z._setSubMeshes=function($B){this._subMeshes=$B,this._subMeshCount=$B.length;for(var $_=0;$_<this._subMeshCount;$_++)$B[$_]._indexInMesh=$_;this._positions=this._getPositions(),this._generateBoundingObject()},$Z.onAsynLoaded=function($B,$_,$Z){var $n=$_[0],$g=$_[1];$OB.read($n,this,this._materials,this._subMeshes,$g),this.completeCreate(),this._endLoaded()},$Z.getSubMesh=function($B){return this._subMeshes[$B]},$Z.getSubMeshCount=function(){return this._subMeshes.length},$Z.getRenderElementsCount=function(){return this._subMeshes.length},$Z.getRenderElement=function($B){return this._subMeshes[$B]},$Z.disposeResource=function(){for(var $B=0;$B<this._subMeshes.length;$B++)this._subMeshes[$B].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$$(0,$Z,"materials",function(){return this._materials.slice()}),$$(0,$Z,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$_.load=function($B){return $t.loader.create($B,null,null,$_)},$_}(),$X_=(function($B){function $D($B,$_,$Z,$n,$g,$q,$P,$k,$m){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$Z&&($Z=6408),void 0===$n&&($n=5121),void 0===$g&&($g=33189),void 0===$q&&($q=!1),void 0===$P&&($P=!1),void 0===$k&&($k=-1),void 0===$m&&($m=-1),$D.__super.call(this),this._type=3553,this._width=$B,this._height=$_,this._size=new $w_($B,$_),this._surfaceFormat=$Z,this._surfaceType=$n,this._depthStencilFormat=$g,$w.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$q,this._repeat=$P,this._minFifter=$k,this._magFifter=$m,this.activeResource(),this._alreadyResolved=!0}$A($D,"laya.d3.resource.RenderTexture",$v_);var $_=$D.prototype;$_.recreateResource=function(){var $B=$v.mainContext;this._frameBuffer=$B.createFramebuffer(),this._source=$B.createTexture();var $_=$V.curBindTexTarget,$Z=$V.curBindTexValue;$V.bindTexture($B,this._type,this._source),$B.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $n=this._minFifter,$g=this._magFifter,$q=this._repeat?10497:33071;if($z.isPOT(this._width,this._height)?(this._mipmap?-1!==$n||($n=9987):-1!==$n||($n=9729),-1!==$g||($g=9729),$B.texParameteri(this._type,10241,$n),$B.texParameteri(this._type,10240,$g),$B.texParameteri(this._type,10242,$q),$B.texParameteri(this._type,10243,$q),this._mipmap&&$B.generateMipmap(this._type)):(-1!==$n||($n=9729),-1!==$g||($g=9729),$B.texParameteri(this._type,10241,$n),$B.texParameteri(this._type,10240,$g),$B.texParameteri(this._type,10242,33071),$B.texParameteri(this._type,10243,33071)),$_&&$Z&&$V.bindTexture($B,$_,$Z),$B.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$B.createRenderbuffer(),$B.bindRenderbuffer(36161,this._depthStencilBuffer),$B.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$B.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$B.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$B.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$B.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$B.framebufferTexture2D(36160,36064,3553,this._source,0),$B.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$_.start=function(){$v.mainContext.bindFramebuffer(36160,this.frameBuffer),($D._currentRenderTarget=this)._alreadyResolved=!1},$_.end=function(){$v.mainContext.bindFramebuffer(36160,null),$D._currentRenderTarget=null,this._alreadyResolved=!0},$_.getData=function($B,$_,$Z,$n){var $g=$v.mainContext;if($g.bindFramebuffer(36160,this._frameBuffer),!(36053===$g.checkFramebufferStatus(36160)))return $g.bindFramebuffer(36160,null),null;var $q=new Uint8Array(this._width*this._height*4);return $g.readPixels($B,$_,$Z,$n,this._surfaceFormat,this._surfaceType,$q),$g.bindFramebuffer(36160,null),$q},$_.disposeResource=function(){if(this._frameBuffer){var $B=$v.mainContext;$B.deleteTexture(this._source),$B.deleteFramebuffer(this._frameBuffer),$B.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$$(0,$_,"surfaceFormat",function(){return this._surfaceFormat}),$$(0,$_,"surfaceType",function(){return this._surfaceType}),$$(0,$_,"depthStencilFormat",function(){return this._depthStencilFormat}),$$(0,$_,"source",function(){return this._alreadyResolved?$t.superGet($v_,this,"source"):null}),$$(0,$_,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$$(0,$_,"frameBuffer",function(){return this._frameBuffer}),$D._currentRenderTarget=null}(),function($B){function $_($B){this._color=null,this._pixels=null,$_.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $w_(this.width,this.height),this._color=$B,this._pixels=new Uint8Array([255*$B.x,255*$B.y,255*$B.z,255*$B.w]),this.uri="SolidColorTexture2D_"+this.id}$A($_,"laya.d3.resource.SolidColorTexture2D",$v_);var $Z=$_.prototype;return $Z._createWebGlTexture=function(){var $B=$v.mainContext,$_=this._source=$B.createTexture(),$Z=this._width,$n=this._height,$g=$V.curBindTexTarget,$q=$V.curBindTexValue;$V.bindTexture($B,this._type,$_),$B.texImage2D(this._type,0,6408,$Z,$n,0,6408,5121,this._pixels);var $P=this._minFifter,$k=this._magFifter,$m=this._repeat?10497:33071,$D=$z.isPOT($Z,$n);$D?(this._mipmap?-1!==$P||($P=9987):-1!==$P||($P=9729),-1!==$k||($k=9729),$B.texParameteri(this._type,10241,$P),$B.texParameteri(this._type,10240,$k),$B.texParameteri(this._type,10242,$m),$B.texParameteri(this._type,10243,$m),this._mipmap&&$B.generateMipmap(this._type)):(-1!==$P||($P=9729),-1!==$k||($k=9729),$B.texParameteri(this._type,10241,$P),$B.texParameteri(this._type,10240,$k),$B.texParameteri(this._type,10242,33071),$B.texParameteri(this._type,10243,33071)),$g&&$q&&$V.bindTexture($B,$g,$q),this.memorySize=$D?$Z*$n*4*(1+1/3):$Z*$n*4},$Z.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$Z.disposeResource=function(){this._source&&($v.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$e($_,["magentaTexture",function(){var $B=new $_(new $k_(1,0,1,1));return $B.lock=!0,this.magentaTexture=$B},"grayTexture",function(){var $B=new $_(new $k_(.5,.5,.5,1));return $B.lock=!0,this.grayTexture=$B}]),$_}()),$R_=function($B){function $g($B,$_,$Z,$n){this._canRead=!1,this._image=null,this._pixels=null,void 0===$B&&($B=!1),void 0===$_&&($_=!0),void 0===$Z&&($Z=6408),void 0===$n&&($n=!0),$g.__super.call(this),this._type=3553,this._repeat=$_,this._canRead=$B,this._format=$Z,this._mipmap=$n}$A($g,"laya.d3.resource.Texture2D",$v_);var $_=$g.prototype;return $_._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $B=$v.mainContext,$_=this._source=$B.createTexture(),$Z=this._width,$n=this._height,$g=$V.curBindTexTarget,$q=$V.curBindTexValue;switch($V.bindTexture($B,this._type,$_),this._format){case 6407:case 6408:this._canRead?$B.texImage2D(this._type,0,this._format,$Z,$n,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$B.texImage2D(this._type,0,this._image._format,$Z,$n,0,this._image._format,5121,this._image.atlasSource):$B.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $v.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$B.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $P=this._minFifter,$k=this._magFifter,$m=this._repeat?10497:33071,$D=0==this._wrapModeU?10497:33071,$T=0==this._wrapModeV?10497:33071,$e=$z.isPOT($Z,$n);$e?(this._mipmap?-1!==$P||($P=9987):-1!==$P||($P=9729),-1!==$k||($k=9729),$B.texParameteri(this._type,10241,$P),$B.texParameteri(this._type,10240,$k),$B.texParameteri(this._type,10242,$m),$B.texParameteri(this._type,10243,$m),$B.texParameteri(this._type,10242,$D),$B.texParameteri(this._type,10243,$T),this._mipmap&&$B.generateMipmap(this._type)):(-1!==$P||($P=9729),-1!==$k||($k=9729),$B.texParameteri(this._type,10241,$P),$B.texParameteri(this._type,10240,$k),$B.texParameteri(this._type,10242,33071),$B.texParameteri(this._type,10243,33071)),$g&&$q&&$V.bindTexture($B,$g,$q),this._image.onload=null,this._image=null,this.memorySize=$e?$Z*$n*4*(1+1/3):$Z*$n*4},$_.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$_.onAsynLoaded=function($B,$_,$Z){if($Z){var $n=$Z[0];void 0!==$n&&(this._canRead=$n);var $g=$Z[1];void 0!==$g&&(this._repeat=$g);var $q=$Z[2];void 0!==$q&&(this._format=$q);var $P=$Z[3];void 0!==$P&&(this._mipmap=$P);var $k=$Z.wrapModeU;void 0!==$k&&(this._wrapModeU=$k);var $m=$Z.wrapModeV;void 0!==$m&&(this._wrapModeV=$m)}switch(this._format){case 6407:case 6408:var $D=(this._image=$_).width,$T=$_.height;this._width=$D,this._height=$T,this._size=new $w_($D,$T),this._canRead&&($w.isConchApp?$_ instanceof $I.HTMLElement&&(this._pixels=new Uint8Array($_.getImageData(0,0,$D,$T))):($o.canvas.size($D,$T),$o.canvas.clear(),$o.context.drawImage($_,0,0,$D,$T),this._pixels=new Uint8Array($o.context.getImageData(0,0,$D,$T).data.buffer)));break;case $v.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $e=new $J($_);$e.readUTFBytes(4),$e.readUTFBytes(2),$e.getInt16();$e.endian="bigEndian",this._width=$e.getInt16(),this._height=$e.getInt16(),this._size=new $w_(this._width,this._height);$e.getInt16(),$e.getInt16();this._image=new Uint8Array($_,$e.pos)}this.recreateResource(),this._endLoaded()},$_.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$_.disposeResource=function(){this._source&&($v.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$$(0,$_,"_src",function(){return this.url}),$$(0,$_,"src",function(){return this.url}),$g.load=function($B){return $t.loader.create($B,null,null,$g)},$g}(),$h_=function($_){function $Z($B,$_){$Z.__super.call(this),void 0===$B&&($B=.3),void 0===$_&&($_=1e3),this._tempVector3=new $P_,this._position=new $P_,this._up=new $P_,this._forward=new $P_,this._right=new $P_,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$w_.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$B,this._farPlane=$_,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$t.stage.on("resize",this,this._onScreenSizeChanged)}$A($Z,"laya.d3.core.BaseCamera",$_);var $B=$Z.prototype;return $B._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $B=this.scene._cameraPool,$_=$B.length-1,$Z=0;$Z<$_;$Z++)if($B[$Z].renderingOrder>$B[$_].renderingOrder){var $n=$B[$Z];$B[$Z]=$B[$_],$B[$_]=$n}},$B._calculateProjectionMatrix=function(){},$B._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$B._prepareCameraToRender=function(){$F._currentCameraCullingMask=this.cullingMask;var $B=this._shaderValues;$B.setValue(0,this.transform.position.elements),$B.setValue(5,this.forward.elements),$B.setValue(6,this.up.elements)},$B._prepareCameraViewProject=function($B,$_){var $Z=this._shaderValues;$Z.setValue(1,$B.elements),$Z.setValue(2,$_.elements)},$B._renderCamera=function($B,$_,$Z){},$B.addLayer=function($B){29!==$B.number&&30!=$B.number&&(this.cullingMask=this.cullingMask|$B.mask)},$B.removeLayer=function($B){29!==$B.number&&30!=$B.number&&(this.cullingMask=this.cullingMask&~$B.mask)},$B.addAllLayers=function(){this.cullingMask=2147483647},$B.removeAllLayers=function(){this.cullingMask=0|$F.getLayerByNumber(29).mask|$F.getLayerByNumber(30).mask},$B.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$B.moveForward=function($B){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$B,this.transform.translate(this._tempVector3)},$B.moveRight=function($B){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$B,this.transform.translate(this._tempVector3)},$B.moveVertical=function($B){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$B,this.transform.translate(this._tempVector3,!1)},$B._addSelfRenderObjects=function(){var $B=this.scene._cameraPool,$_=$B.length;if(0<$_){for(var $Z=$_-1;0<=$Z;$Z--)if(this.renderingOrder<=$B[$Z].renderingOrder){$B.splice($Z+1,0,this);break}}else $B.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$B._clearSelfRenderObjects=function(){var $B=this.scene._cameraPool;$B.splice($B.indexOf(this),1)},$B.destroy=function($B){void 0===$B&&($B=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$t.stage.off("resize",this,this._onScreenSizeChanged),$_.prototype.destroy.call(this,$B)},$$(0,$B,"sky",function(){return this._sky},function($B){(this._sky=$B)._ownerCamera=this}),$$(0,$B,"forward",function(){var $B=this.transform.worldMatrix.elements,$_=this._forward.elements;return $_[0]=-$B[8],$_[1]=-$B[9],$_[2]=-$B[10],this._forward}),$$(0,$B,"position",function(){var $B=this.transform.worldMatrix.elements,$_=this._position.elements;return $_[0]=$B[12],$_[1]=$B[13],$_[2]=$B[14],this._position}),$$(0,$B,"renderTarget",function(){return this._renderTarget},function($B){null!=(this._renderTarget=$B)&&(this._renderTargetSize=$B.size)}),$$(0,$B,"up",function(){var $B=this.transform.worldMatrix.elements,$_=this._up.elements;return $_[0]=$B[4],$_[1]=$B[5],$_[2]=$B[6],this._up}),$$(0,$B,"right",function(){var $B=this.transform.worldMatrix.elements,$_=this._right.elements;return $_[0]=$B[0],$_[1]=$B[1],$_[2]=$B[2],this._right}),$$(0,$B,"renderTargetSize",function(){return this._renderTargetSize},function($B){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$B,this._calculateProjectionMatrix()}),$$(0,$B,"fieldOfView",function(){return this._fieldOfView},function($B){this._fieldOfView=$B,this._calculateProjectionMatrix()}),$$(0,$B,"nearPlane",function(){return this._nearPlane},function($B){this._nearPlane=$B,this._calculateProjectionMatrix()}),$$(0,$B,"farPlane",function(){return this._farPlane},function($B){this._farPlane=$B,this._calculateProjectionMatrix()}),$$(0,$B,"orthographic",function(){return this._orthographic},function($B){this._orthographic=$B,this._calculateProjectionMatrix()}),$$(0,$B,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($B){this._orthographicVerticalSize=$B,this._calculateProjectionMatrix()}),$$(0,$B,"renderingOrder",function(){return this._renderingOrder},function($B){this._renderingOrder=$B,this._sortCamerasByRenderingOrder()}),$Z.CAMERAPOS=0,$Z.VIEWMATRIX=1,$Z.PROJECTMATRIX=2,$Z.VPMATRIX=3,$Z.VPMATRIX_NO_TRANSLATE=4,$Z.CAMERADIRECTION=5,$Z.CAMERAUP=6,$Z.ENVIRONMENTDIFFUSE=7,$Z.ENVIRONMENTSPECULAR=8,$Z.SIMLODINFO=9,$Z.DIFFUSEIRRADMATR=10,$Z.DIFFUSEIRRADMATG=11,$Z.DIFFUSEIRRADMATB=12,$Z.HDREXPOSURE=13,$Z.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$Z.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$Z.CLEARFLAG_SOLIDCOLOR=0,$Z.CLEARFLAG_SKY=1,$Z.CLEARFLAG_DEPTHONLY=2,$Z.CLEARFLAG_NONE=3,$e($Z,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $B_(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $B_},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $B_}]),$Z}($f_),$s_=function($Z){function $_($B){this._render=null,this._geometryFilter=null,$_.__super.call(this,$B)}$A($_,"laya.d3.core.RenderableSprite3D",$Z);var $B=$_.prototype;return $B._addToInitStaticBatchManager=function(){},$B._setBelongScene=function($B){$Z.prototype._setBelongScene.call(this,$B),$B._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$B._setUnBelongScene=function(){var $B=this._scene._renderableSprite3Ds,$_=$B.indexOf(this);$B.splice($_,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$Z.prototype._setUnBelongScene.call(this)},$B._update=function($B){($B.owner=this)._activeInHierarchy&&(this._updateComponents($B),this._render._updateOctreeNode(),this._lateUpdateComponents($B),$Q.spriteCount++,this._childs.length&&this._updateChilds($B))},$B.destroy=function($B){void 0===$B&&($B=!0),$Z.prototype.destroy.call(this,$B),this._render._destroy(),this._render=null},$_.__init__=function(){$_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$_.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$_.SAHDERDEFINE_LIGHTMAP=$_.shaderDefines.registerDefine("LIGHTMAP")},$_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$_.SAHDERDEFINE_LIGHTMAP=4,$_.LIGHTMAPSCALEOFFSET=2,$_.LIGHTMAP=3,$e($_,["shaderDefines",function(){return this.shaderDefines=new $T_}]),$_}($f_),$U_=(function($B){function $n($B,$_,$Z){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$B&&($B=1),void 0===$_&&($_=1),void 0===$Z&&($Z=1),$n.__super.call(this),this._long=$B,this._width=$_,this._height=$Z,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$A($n,"laya.d3.resource.models.BoxMesh",$G_);var $_=$n.prototype;$_.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $B=$vB.vertexDeclaration,$_=($B.vertexStride,this._long/2),$Z=this._height/2,$n=this._width/2,$g=new Float32Array([-$_,$Z,-$n,0,1,0,0,0,$_,$Z,-$n,0,1,0,1,0,$_,$Z,$n,0,1,0,1,1,-$_,$Z,$n,0,1,0,0,1,-$_,-$Z,-$n,0,-1,0,0,1,$_,-$Z,-$n,0,-1,0,1,1,$_,-$Z,$n,0,-1,0,1,0,-$_,-$Z,$n,0,-1,0,0,0,-$_,$Z,-$n,-1,0,0,0,0,-$_,$Z,$n,-1,0,0,1,0,-$_,-$Z,$n,-1,0,0,1,1,-$_,-$Z,-$n,-1,0,0,0,1,$_,$Z,-$n,1,0,0,1,0,$_,$Z,$n,1,0,0,0,0,$_,-$Z,$n,1,0,0,0,1,$_,-$Z,-$n,1,0,0,1,1,-$_,$Z,$n,0,0,1,0,0,$_,$Z,$n,0,0,1,1,0,$_,-$Z,$n,0,0,1,1,1,-$_,-$Z,$n,0,0,1,0,1,-$_,$Z,-$n,0,0,-1,1,0,$_,$Z,-$n,0,0,-1,0,0,$_,-$Z,-$n,0,0,-1,0,1,-$_,-$Z,-$n,0,0,-1,1,1]),$q=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $K_($B,this._numberVertices,35044,!0),this._indexBuffer=new $p_("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($g),this._indexBuffer.setData($q),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$$(0,$_,"long",function(){return this._long},function($B){this._long!==$B&&(this._long=$B,this.releaseResource(),this.activeResource())}),$$(0,$_,"width",function(){return this._width},function($B){this._width!==$B&&(this._width=$B,this.releaseResource(),this.activeResource())}),$$(0,$_,"height",function(){return this._height},function($B){this._height!==$B&&(this._height=$B,this.releaseResource(),this.activeResource())})}(),function($B){function $g($B,$_,$Z,$n){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$B&&($B=10),void 0===$_&&($_=10),void 0===$Z&&($Z=10),void 0===$n&&($n=10),$g.__super.call(this),this._long=$B,this._width=$_,this._stacks=$Z,this._slices=$n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$A($g,"laya.d3.resource.models.PlaneMesh",$G_);var $_=$g.prototype;$_.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $B=new Uint16Array(this._numberIndices),$_=$vB.vertexDeclaration,$Z=$_.vertexStride/4,$n=new Float32Array(this._numberVertices*$Z),$g=this._long/2,$q=this._width/2,$P=this._long/this._stacks,$k=this._width/this._slices,$m=0,$D=0;$D<=this._slices;$D++)for(var $T=0;$T<=this._stacks;$T++)$n[$m++]=$T*$P-$g,$n[$m++]=0,$n[$m++]=$D*$k-$q,$n[$m++]=0,$n[$m++]=1,$n[$m++]=0,$n[$m++]=1*$T/this._stacks,$n[$m++]=1*$D/this._slices;var $e=0;for($D=0;$D<this._slices;$D++)for($T=0;$T<this._stacks;$T++)$B[$e++]=($D+1)*(this._stacks+1)+$T,$B[$e++]=$D*(this._stacks+1)+$T,$B[$e++]=($D+1)*(this._stacks+1)+$T+1,$B[$e++]=$D*(this._stacks+1)+$T,$B[$e++]=$D*(this._stacks+1)+$T+1,$B[$e++]=($D+1)*(this._stacks+1)+$T+1;this._vertexBuffer=new $K_($_,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $p_("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($n),this._indexBuffer.setData($B),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$$(0,$_,"long",function(){return this._long},function($B){this._long!==$B&&(this._long=$B,this.releaseResource(),this.activeResource())}),$$(0,$_,"width",function(){return this._width},function($B){this._width!==$B&&(this._width=$B,this.releaseResource(),this.activeResource())}),$$(0,$_,"stacks",function(){return this._stacks},function($B){this._stacks!==$B&&(this._stacks=$B,this.releaseResource(),this.activeResource())}),$$(0,$_,"slices",function(){return this._slices},function($B){this._slices!==$B&&(this._slices=$B,this.releaseResource(),this.activeResource())})}(),function($B){function $P($B,$_,$Z){void 0===$B&&($B=0),void 0===$_&&($_=.3),void 0===$Z&&($Z=1e3),this._viewMatrix=new $B_,this._projectionMatrix=new $B_,this._projectionViewMatrix=new $B_,this._viewport=new $m_(0,0,0,0),this._normalizedViewport=new $m_(0,0,1,1),this._aspectRatio=$B,this._boundFrustumUpdate=!0,this._boundFrustum=new $aB($B_.DEFAULT),$P.__super.call(this,$_,$Z),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$A($P,"laya.d3.core.Camera",$h_);var $_=$P.prototype;return $_._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$_._parseCustomProps=function($B,$_,$Z,$n){var $g=$Z.clearColor;this.clearColor=new $k_($g[0],$g[1],$g[2],$g[3]);var $q=$Z.viewport;this.normalizedViewport=new $m_($q[0],$q[1],$q[2],$q[3])},$_._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $B=this.orthographicVerticalSize*this.aspectRatio*.5,$_=.5*this.orthographicVerticalSize;$B_.createOrthoOffCenterRH(-$B,$B,-$_,$_,this.nearPlane,this.farPlane,this._projectionMatrix)}else $B_.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$_._update=function($B){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$B)},$_._renderCamera=function($B,$_,$Z){var $n,$g;$Z.parallelSplitShadowMaps[0]&&$Z._renderShadowMap($B,$_,this),($_.camera=this)._prepareCameraToRender(),$Z._preRenderUpdateComponents($_),$n=$_._viewMatrix=this.viewMatrix;var $q=this._renderTarget;$q?($q.start(),$B_.multiply($h_._invertYScaleMatrix,this._projectionMatrix,$h_._invertYProjectionMatrix),$B_.multiply($h_._invertYScaleMatrix,this.projectionViewMatrix,$h_._invertYProjectionViewMatrix),$g=$_._projectionMatrix=$h_._invertYProjectionMatrix,$_._projectionViewMatrix=$h_._invertYProjectionViewMatrix):($g=$_._projectionMatrix=this._projectionMatrix,$_._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($n,$g),$_._viewport=this.viewport,$Z._preRenderScene($B,$_,this.boundFrustum),$Z._clear($B,$_),$Z._renderScene($B,$_),$Z._postRenderUpdateComponents($_),$q&&$q.end()},$_.viewportPointToRay=function($B,$_){$$_.calculateCursorRay($B,this.viewport,this._projectionMatrix,this.viewMatrix,null,$_)},$_.normalizedViewportPointToRay=function($B,$_){var $Z=$P._tempVector20,$n=this.viewport,$g=$B.elements,$q=$Z.elements;$q[0]=$g[0]*$n.width,$q[1]=$g[1]*$n.height,$$_.calculateCursorRay($Z,this.viewport,this._projectionMatrix,this.viewMatrix,null,$_)},$_.worldToViewportPoint=function($B,$_){$B_.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($B,this._projectionViewMatrix,$_);var $Z=$_.elements;$Z[0]=$Z[0]/$t.stage.clientScaleX,$Z[1]=$Z[1]/$t.stage.clientScaleY},$_.worldToNormalizedViewportPoint=function($B,$_){$B_.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($B,this._projectionViewMatrix,$_);var $Z=$_.elements;$Z[0]=$Z[0]/$t.stage.clientScaleX,$Z[1]=$Z[1]/$t.stage.clientScaleY},$_.convertScreenCoordToOrthographicCoord=function($B,$_){if(this._orthographic){var $Z=$O.clientWidth,$n=$O.clientHeight,$g=this.orthographicVerticalSize*this.aspectRatio/$Z,$q=this.orthographicVerticalSize/$n,$P=$B.elements,$k=$_.elements;return $k[0]=(-$Z/2+$P[0])*$g,$k[1]=($n/2-$P[1])*$q,$k[2]=(this.nearPlane-this.farPlane)*($P[2]+1)/2-this.nearPlane,$P_.transformCoordinate($_,this.transform.worldMatrix,$_),!0}return!1},$$(0,$_,"projectionViewMatrix",function(){return $B_.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$$(0,$_,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $B=this.viewport;return $B.width/$B.height},function($B){if($B<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$B,this._calculateProjectionMatrix()}),$$(0,$_,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$$(0,$_,"needViewport",function(){var $B=this.normalizedViewport;return 0===$B.x&&0===$B.y&&1===$B.width&&1===$B.height}),$$(0,$_,"viewport",function(){if(this._viewportExpressedInClipSpace){var $B=this._normalizedViewport,$_=this.renderTargetSize,$Z=$_.width,$n=$_.height;this._viewport.x=$B.x*$Z,this._viewport.y=$B.y*$n,this._viewport.width=$B.width*$Z,this._viewport.height=$B.height*$n}return this._viewport},function($B){if(null!=this.renderTarget&&($B.x<0||$B.y<0||0==$B.width||0==$B.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$B,this._calculateProjectionMatrix()}),$$(0,$_,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $B=this._viewport,$_=this.renderTargetSize,$Z=$_.width,$n=$_.height;this._normalizedViewport.x=$B.x/$Z,this._normalizedViewport.y=$B.y/$n,this._normalizedViewport.width=$B.width/$Z,this._normalizedViewport.height=$B.height/$n}return this._normalizedViewport},function($B){$B.x<0&&($B.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$B.y<0&&($B.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$B.x+$B.width&&($B.width=1-$B.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$B.y+$B.height&&($B.height=1-$B.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$B,this._calculateProjectionMatrix()}),$$(0,$_,"projectionMatrix",function(){return this._projectionMatrix},function($B){this._projectionMatrix=$B,this._useUserProjectionMatrix=!0}),$$(0,$_,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$e($P,["_tempVector20",function(){return this._tempVector20=new $q_}]),$P}()),$S_=function($Z){function $n($B,$_){$n.__super.call(this,$_),this._geometryFilter=new $o_(this),this._render=new $F_(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$B&&(this._geometryFilter.sharedMesh=$B)instanceof laya.d3.resource.models.Mesh&&($B.loaded?this._render.sharedMaterials=$B.materials:$B.once("loaded",this,this._applyMeshMaterials))}$A($n,"laya.d3.core.MeshSprite3D",$Z);var $B=$n.prototype;return $B._changeRenderObjectByMesh=function($B){var $_=this._render._renderElements,$Z=$_[$B];$Z||($Z=$_[$B]=new $N_),$Z._render=this._render;var $n=this._render.sharedMaterials[$B];$n||($n=$x_.defaultMaterial);var $g=this._geometryFilter.sharedMesh.getRenderElement($B);return $Z._mainSortID=this._getSortID($g,$n),$Z._sprite3D=this,$Z.renderObj=$g,$Z._material=$n,$Z},$B._changeRenderObjectByMaterial=function($B,$_){var $Z=this._render._renderElements[$B];$_||($_=$x_.defaultMaterial);var $n=this._geometryFilter.sharedMesh.getRenderElement($B);return $Z._mainSortID=this._getSortID($n,$_),$Z._sprite3D=this,$Z.renderObj=$n,$Z._material=$_,$Z},$B._changeRenderObjectsByMesh=function(){var $B=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$B;for(var $_=0;$_<$B;$_++)this._changeRenderObjectByMesh($_)},$B._onMeshChanged=function($B){var $_=$B.sharedMesh;$_.loaded?this._changeRenderObjectsByMesh():$_.once("loaded",this,this._onMeshLoaded)},$B._onMeshLoaded=function($B){$B===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$B._onMaterialChanged=function($B,$_,$Z){$_<this._render._renderElements.length&&this._changeRenderObjectByMaterial($_,$Z)},$B._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$B._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$B._parseCustomProps=function($B,$_,$Z,$n){var $g=this.meshRender,$q=$Z.lightmapIndex;null!=$q&&($g.lightmapIndex=$q);var $P,$k,$m=$Z.lightmapScaleOffset;if($m&&($g.lightmapScaleOffset=new $k_($m[0],$m[1],$m[2],$m[3])),$n.instanceParams)($P=$n.instanceParams.loadPath)&&($k=$j.getRes($_[$P]),(this.meshFilter.sharedMesh=$k).loaded?$g.sharedMaterials=$k.materials:$k.once("loaded",this,this._applyMeshMaterials));else{($P=$Z.meshPath)&&($k=$j.getRes($_[$P]),this.meshFilter.sharedMesh=$k);var $D=$Z.materials;if($D){var $T=$g.sharedMaterials,$e=$D.length;$T.length=$e;for(var $I=0;$I<$e;$I++)$T[$I]=$j.getRes($_[$D[$I].path]);$g.sharedMaterials=$T}}},$B._applyMeshMaterials=function($B){for(var $_=this._render.sharedMaterials,$Z=$B.materials,$n=0,$g=$Z.length;$n<$g;$n++)$_[$n]||($_[$n]=$Z[$n]);this._render.sharedMaterials=$_},$B._addToInitStaticBatchManager=function(){$n._staticBatchManager._addInitBatchSprite(this)},$B.cloneTo=function($B){var $_=$B;$_._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $Z=this._render,$n=$_._render;$n.enable=$Z.enable,$n.sharedMaterials=$Z.sharedMaterials,$n.castShadow=$Z.castShadow;var $g=$Z.lightmapScaleOffset;$g&&($n.lightmapScaleOffset=$g.clone()),$n.lightmapIndex=$Z.lightmapIndex,$n.receiveShadow=$Z.receiveShadow,$n.sortingFudge=$Z.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$B)},$B.destroy=function($B){if(void 0===$B&&($B=!0),!this.destroyed){var $_=this.meshFilter.sharedMesh;null!=$_&&($_.loaded||$_.off("loaded",this,this._applyMeshMaterials)),$Z.prototype.destroy.call(this,$B),this._geometryFilter._destroy()}},$$(0,$B,"meshFilter",function(){return this._geometryFilter}),$$(0,$B,"meshRender",function(){return this._render}),$n.__init__=function(){$nB._staticBatchManagers.push($n._staticBatchManager)},$n.load=function($B){return $t.loader.create($B,null,null,$n)},$e($n,["_staticBatchManager",function(){return this._staticBatchManager=new $M_}]),$n}($s_)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($B,$_){"use strict";for(var $Z in Object.defineProperty($_,"__esModule",{value:!0}),Laya){var $n=Laya[$Z];$n&&$n.__isclass&&($_[$Z]=$n)}}),function($B,$_,$gB){$gB.un,$gB.uns;var $Z=$gB.static,$n=$gB.class,$q=$gB.getset,$w=$gB.__newvec,$k=laya.maths.Bezier,$e=laya.utils.Browser,$vB=laya.utils.Byte,$g=(laya.events.Event,laya.events.EventDispatcher),$P=laya.display.Graphics,$m=(laya.resource.HTMLCanvas,laya.utils.Handler),$D=laya.net.Loader,$I=laya.maths.MathUtil,$VB=laya.maths.Matrix,$r=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$T=(laya.renders.RenderContext,laya.resource.Resource),$A=laya.utils.RunDriver,$qB=laya.display.Sprite,$$=laya.utils.Stat,$oB=laya.resource.Texture,$j=(laya.net.URL,laya.utils.Utils),$V=function(){function $B(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $n($B,"laya.ani.AnimationContent"),$B}(),$o=function(){function $B(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $n($B,"laya.ani.AnimationNodeContent"),$B}(),$C=function(){function $B(){}return $n($B,"laya.ani.AnimationParser01"),$B.parse=function($B,$_){var $Z=$_.__getBuffer(),$n=0,$g=0,$q=0,$P=0,$k=0,$m=0,$D=0,$T=$_.readUTFString();$B._aniClassName=$T;var $e,$I=$_.readUTFString().split("\n"),$A=$_.getUint8(),$$=$_.getUint32(),$w=$_.getUint32();0<$$&&($e=$Z.slice($$,$w));var $r=new $vB($e);for(0<$w&&($B._publicExtData=$Z.slice($w,$Z.byteLength)),$B._useParent=!!$_.getUint8(),$B._anis.length=$A,$n=0;$n<$A;$n++){var $j=$B._anis[$n]=new $V;$j.nodes=new Array;var $y=$j.name=$I[$_.getUint16()];$B._aniMap[$y]=$n,$j.bone3DMap={},$j.playTime=$_.getFloat32(),$j.playTime<=0&&console.error("播放时间不能为0  url="+$B.url+" name="+$j.name);var $C=$j.nodes.length=$_.getUint8();for($g=$j.totalKeyframeDatasLength=0;$g<$C;$g++){var $z=$j.nodes[$g]=new $o;$z.childs=[];var $t=$_.getInt16();0<=$t&&($z.name=$I[$t],$j.bone3DMap[$z.name]=$g),$z.keyFrame=new Array,$z.parentIndex=$_.getInt16(),-1==$z.parentIndex?$z.parent=null:$z.parent=$j.nodes[$z.parentIndex],$z.lerpType=$_.getUint8();var $J=$_.getUint32();$r.pos=$J;var $N=$z.keyframeWidth=$r.getUint16();if($j.totalKeyframeDatasLength+=$N,0===$z.lerpType||1===$z.lerpType)for($z.interpolationMethod=[],$z.interpolationMethod.length=$N,$q=0;$q<$N;$q++)$z.interpolationMethod[$q]=$f.interpolation[$r.getUint8()];null!=$z.parent&&$z.parent.childs.push($z);var $Q=$_.getUint16();0<$Q&&($z.extenData=$Z.slice($_.pos,$_.pos+$Q),$_.pos+=$Q);var $M,$Y=$_.getUint16(),$l=0;for($q=0,$P=$z.keyFrame.length=$Y;$q<$P;$q++){if(($M=$z.keyFrame[$q]=new $F).duration=$_.getFloat32(),$M.startTime=$l,2===$z.lerpType){$M.interpolationData=[];var $L,$v=$_.getUint8();switch($L=$_.getFloat32()){case 254:for($M.interpolationData.length=$N,$D=0;$D<$N;$D++)$M.interpolationData[$D]=0;break;case 255:for($M.interpolationData.length=$N,$D=0;$D<$N;$D++)$M.interpolationData[$D]=5;break;default:for($M.interpolationData.push($L),$m=1;$m<$v;$m++)$M.interpolationData.push($_.getFloat32())}}for($M.data=new Float32Array($N),$k=0;$k<$N;$k++)$M.data[$k]=$_.getFloat32(),-1e-8<$M.data[$k]&&$M.data[$k]<1e-8&&($M.data[$k]=0);$l+=$M.duration}$M.startTime=$j.playTime,$z.playTime=$j.playTime,$B._calculateKeyFrame($z,$Y,$N)}}},$B}(),$z=function(){function $t(){}return $n($t,"laya.ani.AnimationParser02"),$t.READ_DATA=function(){$t._DATA.offset=$t._reader.getUint32(),$t._DATA.size=$t._reader.getUint32()},$t.READ_BLOCK=function(){for(var $B=$t._BLOCK.count=$t._reader.getUint16(),$_=$t._BLOCK.blockStarts=[],$Z=$t._BLOCK.blockLengths=[],$n=0;$n<$B;$n++)$_.push($t._reader.getUint32()),$Z.push($t._reader.getUint32())},$t.READ_STRINGS=function(){var $B=$t._reader.getUint32(),$_=$t._reader.getUint16(),$Z=$t._reader.pos;$t._reader.pos=$B+$t._DATA.offset;for(var $n=0;$n<$_;$n++)$t._strings[$n]=$t._reader.readUTFString();$t._reader.pos=$Z},$t.parse=function($B,$_){$t._templet=$B;($t._reader=$_).__getBuffer();$t.READ_DATA(),$t.READ_BLOCK(),$t.READ_STRINGS();for(var $Z=0,$n=$t._BLOCK.count;$Z<$n;$Z++){var $g=$_.getUint16(),$q=$t._strings[$g],$P=$t["READ_"+$q];if(null==$P)throw new Error("model file err,no this function:"+$g+" "+$q);$P.call()}},$t.READ_ANIMATIONS=function(){var $B=$t._reader,$_=$B.__getBuffer(),$Z=0,$n=0,$g=0,$q=0,$P=$B.getUint16(),$k=[];for($k.length=$P,$Z=0;$Z<$P;$Z++)$k[$Z]=$f.interpolation[$B.getByte()];var $m=$B.getUint8();for($t._templet._anis.length=$m,$Z=0;$Z<$m;$Z++){var $D=$t._templet._anis[$Z]={};$D.nodes=new Array;var $T=$D.name=$t._strings[$B.getUint16()];$t._templet._aniMap[$T]=$Z,$D.bone3DMap={},$D.playTime=$B.getFloat32();var $e=$D.nodes.length=$B.getInt16();for($n=$D.totalKeyframeDatasLength=0;$n<$e;$n++){var $I=$D.nodes[$n]={};$I.keyframeWidth=$P,$I.childs=[];var $A=$B.getUint16();0<=$A&&($I.name=$t._strings[$A],$D.bone3DMap[$I.name]=$n),$I.keyFrame=new Array,$I.parentIndex=$B.getInt16(),-1==$I.parentIndex?$I.parent=null:$I.parent=$D.nodes[$I.parentIndex],$D.totalKeyframeDatasLength+=$P,$I.interpolationMethod=$k,null!=$I.parent&&$I.parent.childs.push($I);var $$=$B.getUint16(),$w=null,$r=null;for($g=0,$q=$I.keyFrame.length=$$;$g<$q;$g++){($w=$I.keyFrame[$g]={}).startTime=$B.getFloat32(),$r&&($r.duration=$w.startTime-$r.startTime);var $j=$t._DATA.offset,$y=$B.getUint32(),$C=4*$P,$z=$_.slice($j+$y,$j+$y+$C);$w.data=new Float32Array($z),$r=$w}$w.duration=0,$I.playTime=$D.playTime,$t._templet._calculateKeyFrame($I,$$,$P)}}},$t._templet=null,$t._reader=null,$t._strings=[],$Z($t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$t}(),$FB=(function(){function $B(){}$n($B,"laya.ani.AnimationState"),$B.stopped=0,$B.paused=1,$B.playing=2}(),function(){function $g(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $sB,this.resultMatrix=new $VB,this._children=[]}$n($g,"laya.ani.bone.Bone");var $B=$g.prototype;return $B.setTempMatrix=function($B){this._tempMatrix=$B;var $_,$Z=0;for($Z=0,$_=this._children.length;$Z<$_;$Z++)this._children[$Z].setTempMatrix(this._tempMatrix)},$B.update=function($B){var $_;if(this.rotation=this.transform.skX,$B)$_=this.resultTransform.getMatrix(),$VB.mul($_,$B,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$_=this.resultTransform.getMatrix(),$VB.mul($_,this.parentBone.resultMatrix,this.resultMatrix);else{var $Z=this.parentBone,$n=NaN,$g=NaN,$q=NaN,$P=this.parentBone.resultMatrix;$_=this.resultTransform.getMatrix();var $k=$P.a*$_.tx+$P.c*$_.ty+$P.tx,$m=$P.b*$_.tx+$P.d*$_.ty+$P.ty,$D=new $VB;this.inheritRotation?($n=Math.atan2($Z.resultMatrix.b,$Z.resultMatrix.a),$g=Math.cos($n),$q=Math.sin($n),$D.setTo($g,$q,-$q,$g,0,0),$VB.mul(this._tempMatrix,$D,$VB.TEMP),$VB.TEMP.copyTo($D),$_=this.resultTransform.getMatrix(),$VB.mul($_,$D,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$_=this.resultTransform.getMatrix(),$VB.TEMP.identity(),$VB.TEMP.d=this.d,$VB.mul($_,$VB.TEMP,this.resultMatrix)),this.resultMatrix.tx=$k,this.resultMatrix.ty=$m}else($_=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $T,$e=0;for($e=0,$T=this._children.length;$e<$T;$e++)this._children[$e].update()},$B.updateChild=function(){var $B,$_=0;for($_=0,$B=this._children.length;$_<$B;$_++)this._children[$_].update()},$B.setRotation=function($B){this._sprite&&(this._sprite.rotation=180*$B/Math.PI)},$B.updateDraw=function($B,$_){$g.ShowBones&&!$g.ShowBones[this.name]||(this._sprite||(this._sprite=new $qB,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$gB.stage.addChild(this._sprite)),this._sprite.x=$B+this.resultMatrix.tx,this._sprite.y=$_+this.resultMatrix.ty);var $Z,$n=0;for($n=0,$Z=this._children.length;$n<$Z;$n++)this._children[$n].updateDraw($B,$_)},$B.addChild=function($B){this._children.push($B),$B.parentBone=this},$B.findBone=function($B){if(this.name==$B)return this;var $_,$Z,$n=0;for($n=0,$_=this._children.length;$n<$_;$n++)if($Z=this._children[$n].findBone($B))return $Z;return null},$B.localToWorld=function($B){var $_=$B[0],$Z=$B[1];$B[0]=$_*this.resultMatrix.a+$Z*this.resultMatrix.c+this.resultMatrix.tx,$B[1]=$_*this.resultMatrix.b+$Z*this.resultMatrix.d+this.resultMatrix.ty},$g.ShowBones={},$g}()),$uB=function(){function $w(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$n($w,"laya.ani.bone.BoneSlot");var $B=$w.prototype;return $B.showSlotData=function($B,$_){void 0===$_&&($_=!0),this.currSlotData=$B,$_&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$B.showDisplayByName=function($B){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($B))},$B.replaceDisplayByName=function($B,$_){if(this.currSlotData){var $Z;$Z=this.currSlotData.getDisplayByName($B);var $n;$n=this.currSlotData.getDisplayByName($_),this.replaceDisplayByIndex($Z,$n)}},$B.replaceDisplayByIndex=function($B,$_){this.currSlotData&&(this._replaceDic[$B]=$_,this.displayIndex==$B&&this.showDisplayByIndex($B))},$B.showDisplayByIndex=function($B){if(null!=this._replaceDic[$B]&&($B=this._replaceDic[$B]),this.currSlotData&&-1<$B&&$B<this.currSlotData.displayArr.length){if(this.displayIndex=$B,this.currDisplayData=this.currSlotData.displayArr[$B],this.currDisplayData){var $_=this.currDisplayData.name;this.currTexture=this.templet.getTexture($_),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$r.isConchApp||$r.isConchApp&&"0.9.15"<$qB.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$B.replaceSkin=function($B){this._diyTexture=$B,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$B.setParentMatrix=function($B){this._parentMatrix=$B},$B.draw=function($B,$_,$Z,$n){if(void 0===$Z&&($Z=!1),void 0===$n&&($n=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $g,$q=this.currTexture;switch(this._diyTexture&&($q=this._diyTexture),this.currDisplayData.type){case 0:if($B){var $P=this.getDisplayMatrix();if(this._parentMatrix){var $k=!1;if($P){var $m;if($VB.mul($P,this._parentMatrix,$VB.TEMP),$m=$Z?(null==this._resultMatrix&&(this._resultMatrix=new $VB),this._resultMatrix):new $VB,!$r.isWebGL&&this.currDisplayData.uvs||$r.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $D=$w._tempMatrix;$D.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($D.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($k=!0,$D.rotate(-Math.PI/2)),$VB.mul($D,$VB.TEMP,$m)}else $VB.TEMP.copyTo($m);$k?$B.drawTexture($q,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$m):$B.drawTexture($q,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$m)}}}break;case 1:if(null==($g=$Z?(null==this._skinSprite&&(this._skinSprite=$w.createSkinMesh()),this._skinSprite):$w.createSkinMesh()))return;var $T;if(null==this.currDisplayData.bones){var $e,$I=this.currDisplayData.weights;this.deformData&&($I=this.deformData),$e=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$N.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$N.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$I;this.currDisplayData.triangles.length;$T=this.currDisplayData.triangles,$g.init2($q,null,$T,this._mVerticleArr,$e);var $A,$$=this.getDisplayMatrix();if(this._parentMatrix)if($$)$VB.mul($$,this._parentMatrix,$VB.TEMP),$A=$Z?(null==this._resultMatrix&&(this._resultMatrix=new $VB),this._resultMatrix):new $VB,$VB.TEMP.copyTo($A),$g.transform=$A}else this.skinMesh($_,$g,$n);$B.drawSkin($g);break;case 2:if(null==($g=$Z?(null==this._skinSprite&&(this._skinSprite=$w.createSkinMesh()),this._skinSprite):$w.createSkinMesh()))return;this.skinMesh($_,$g,$n),$B.drawSkin($g)}}},$B.skinMesh=function($B,$_,$Z){var $n,$g=this.currTexture,$q=this.currDisplayData.bones;$n=this._diyTexture?($g=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$N.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$N.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $P,$k,$m=this.currDisplayData.weights,$D=this.currDisplayData.triangles,$T=0,$e=0,$I=0,$A=NaN,$$=NaN,$w=0,$r=0,$j=[],$y=0,$C=0;if(this.deformData&&0<this.deformData.length){var $z=0;for($y=0,$C=$q.length;$y<$C;){for($I=$q[$y++]+$y,$e=$T=0;$y<$I;$y++)$k=$B[$q[$y]],$A=$m[$w]+this.deformData[$z++],$$=$m[$w+1]+this.deformData[$z++],$r=$m[$w+2],$T+=($A*$k.a+$$*$k.c+$k.tx)*$r,$e+=($A*$k.b+$$*$k.d+$k.ty)*$r,$w+=3;$j.push($T,$e)}}else for($y=0,$C=$q.length;$y<$C;){for($I=$q[$y++]+$y,$e=$T=0;$y<$I;$y++)$k=$B[$q[$y]],$A=$m[$w],$$=$m[$w+1],$r=$m[$w+2],$T+=($A*$k.a+$$*$k.c+$k.tx)*$r,$e+=($A*$k.b+$$*$k.d+$k.ty)*$r,$w+=3;$j.push($T,$e)}this._mVerticleArr=$j,$P=$D,$_.init2($g,null,$P,this._mVerticleArr,$n)},$B.drawBonePoint=function($B){$B&&this._parentMatrix&&$B.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$B.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$B.getMatrix=function(){return this._resultMatrix},$B.copy=function(){var $B=new $w;return $B.type="copy",$B.name=this.name,$B.attachmentName=this.attachmentName,$B.srcDisplayIndex=this.srcDisplayIndex,$B.parent=this.parent,$B.displayIndex=this.displayIndex,$B.templet=this.templet,$B.currSlotData=this.currSlotData,$B.currTexture=this.currTexture,$B.currDisplayData=this.currDisplayData,$B},$w.createSkinMesh=function(){return $r.isWebGL||$r.isConchApp?$A.skinAniSprite():($r.isWebGL,null)},$Z($w,["_tempMatrix",function(){return this._tempMatrix=new $VB}]),$w}(),$fB=function(){function $B(){this.skinName=null,this.deformSlotDataList=[]}return $n($B,"laya.ani.bone.DeformAniData"),$B}(),$bB=function(){function $B(){this.deformSlotDisplayList=[]}return $n($B,"laya.ani.bone.DeformSlotData"),$B}(),$xB=function(){function $B(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$n($B,"laya.ani.bone.DeformSlotDisplayData");var $_=$B.prototype;return $_.binarySearch1=function($B,$_){var $Z=0,$n=$B.length-2;if(0==$n)return 1;for(var $g=$n>>>1;;){if($B[Math.floor($g+1)]<=$_?$Z=$g+1:$n=$g,$Z==$n)return $Z+1;$g=$Z+$n>>>1}return 0},$_.apply=function($B,$_,$Z){if(void 0===$Z&&($Z=1),$B+=.05,!(this.timeList.length<=0)){var $n=0;if(!($B<this.timeList[0])){var $g=this.vectices[0].length,$q=[],$P=this.binarySearch1(this.timeList,$B);if(this.frameIndex=$P,$B>=this.timeList[this.timeList.length-1]){var $k=this.vectices[this.vectices.length-1];if($Z<1)for($n=0;$n<$g;$n++)$q[$n]+=($k[$n]-$q[$n])*$Z;else for($n=0;$n<$g;$n++)$q[$n]=$k[$n];this.deformData=$q}else{this.tweenKeyList[this.frameIndex];var $m=this.vectices[this.frameIndex-1],$D=this.vectices[this.frameIndex],$T=this.timeList[this.frameIndex-1],$e=this.timeList[this.frameIndex];$Z=this.tweenKeyList[$P-1]?($B-$T)/($e-$T):0;var $I=NaN;for($n=0;$n<$g;$n++)$I=$m[$n],$q[$n]=$I+($D[$n]-$I)*$Z;this.deformData=$q}}}},$B}(),$pB=function(){function $B(){this.time=NaN,this.drawOrder=[]}return $n($B,"laya.ani.bone.DrawOrderData"),$B}(),$KB=function(){function $B(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $n($B,"laya.ani.bone.EventData"),$B}(),$y=function(){function $nB($B,$_){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$B,this._targetBone=$_[$B.targetBoneIndex],this.isSpine=$B.isSpine,null==this._bones&&(this._bones=[]);for(var $Z=this._bones.length=0,$n=$B.boneIndexs.length;$Z<$n;$Z++)this._bones.push($_[$B.boneIndexs[$Z]]);this.name=$B.name,this.mix=$B.mix,this.bendDirection=$B.bendDirection}$n($nB,"laya.ani.bone.IkConstraint");var $B=$nB.prototype;return $B.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$B._applyIk1=function($B,$_,$Z,$n){var $g=$B.parentBone,$q=1/($g.resultMatrix.a*$g.resultMatrix.d-$g.resultMatrix.b*$g.resultMatrix.c),$P=$_-$g.resultMatrix.tx,$k=$Z-$g.resultMatrix.ty,$m=($P*$g.resultMatrix.d-$k*$g.resultMatrix.c)*$q-$B.transform.x,$D=($k*$g.resultMatrix.a-$P*$g.resultMatrix.b)*$q-$B.transform.y,$T=Math.atan2($D,$m)*$nB.radDeg-0-$B.transform.skX;$B.transform.scX<0&&($T+=180),180<$T?$T-=360:$T<-180&&($T+=360),$B.transform.skX=$B.transform.skY=$B.transform.skX+$T*$n,$B.update()},$B.updatePos=function($B,$_){this._sp&&this._sp.pos($B,$_)},$B._applyIk2=function($B,$_,$Z,$n,$g,$q){if(0!=$q){var $P=$B.resultTransform.x,$k=$B.resultTransform.y,$m=$B.transform.scX,$D=$B.transform.scY,$T=$_.transform.scX,$e=0,$I=0,$A=0;$A=$m<0?($m=-$m,$e=180,-1):($e=0,1),$D<0&&($D=-$D,$A=-$A),$I=$T<0?($T=-$T,180):0;var $$=$_.resultTransform.x,$w=NaN,$r=NaN,$j=NaN,$y=$B.resultMatrix.a,$C=$B.resultMatrix.c,$z=$B.resultMatrix.b,$t=$B.resultMatrix.d,$J=Math.abs($m-$D)<=1e-4;$j=$J?($r=$y*$$+$C*($w=$_.resultTransform.y)+$B.resultMatrix.tx,$z*$$+$t*$w+$B.resultMatrix.ty):($w=0,$r=$y*$$+$B.resultMatrix.tx,$z*$$+$B.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $qB,$gB.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($Z,$n,15,"#ffff00"),this._sp.graphics.drawCircle($r,$j,15,"#ff00ff")),$B.setRotation(Math.atan2($j-$B.resultMatrix.ty,$r-$B.resultMatrix.tx));var $N=$B.parentBone;$y=$N.resultMatrix.a,$C=$N.resultMatrix.c,$z=$N.resultMatrix.b;var $Q=1/($y*($t=$N.resultMatrix.d)-$C*$z),$M=$Z-$N.resultMatrix.tx,$Y=$n-$N.resultMatrix.ty,$l=($M*$t-$Y*$C)*$Q-$P,$L=($Y*$y-$M*$z)*$Q-$k,$v=(($M=$r-$N.resultMatrix.tx)*$t-($Y=$j-$N.resultMatrix.ty)*$C)*$Q-$P,$V=($Y*$y-$M*$z)*$Q-$k,$o=Math.sqrt($v*$v+$V*$V),$F=$_.length*$T,$u=NaN,$f=NaN;if($J){var $b=($l*$l+$L*$L-$o*$o-($F*=$m)*$F)/(2*$o*$F);$b<-1?$b=-1:1<$b&&($b=1),$f=Math.acos($b)*$g,$y=$o+$F*$b,$C=$F*Math.sin($f),$u=Math.atan2($L*$y-$l*$C,$l*$y+$L*$C)}else{var $x=($y=$m*$F)*$y,$p=($C=$D*$F)*$C,$K=$l*$l+$L*$L,$H=Math.atan2($L,$l),$G=-2*$p*$o,$W=$p-$x;if(0<($t=$G*$G-4*$W*($z=$p*$o*$o+$x*$K-$x*$p))){var $X=Math.sqrt($t);$G<0&&($X=-$X);var $R=($X=-($G+$X)/2)/$W,$h=$z/$X,$s=Math.abs($R)<Math.abs($h)?$R:$h;$s*$s<=$K&&($Y=Math.sqrt($K-$s*$s)*$g,$u=$H-Math.atan2($Y,$s),$f=Math.atan2($Y/$D,($s-$o)/$m))}var $U=0,$S=Number.MAX_VALUE,$O=0,$d=0,$a=0,$i=0,$c=0,$E=0;$i<($t=($M=$o+$y)*$M)&&($a=0,$i=$t,$c=$M),($t=($M=$o-$y)*$M)<$S&&($U=Math.PI,$S=$t,$O=$M);var $BB=Math.acos(-$y*$o/($x-$p));($t=($M=$y*Math.cos($BB)+$o)*$M+($Y=$C*Math.sin($BB))*$Y)<$S&&($U=$BB,$S=$t,$O=$M,$d=$Y),$i<$t&&($a=$BB,$i=$t,$c=$M,$E=$Y),$f=$K<=($S+$i)/2?($u=$H-Math.atan2($d*$g,$O),$U*$g):($u=$H-Math.atan2($E*$g,$c),$a*$g)}var $_B=Math.atan2($w,$$)*$A,$ZB=$B.resultTransform.skX;180<($u=($u-$_B)*$nB.radDeg+$e-$ZB)?$u-=360:$u<-180&&($u+=360),$B.resultTransform.x=$P,$B.resultTransform.y=$k,$B.resultTransform.skX=$B.resultTransform.skY=$ZB+$u*$q,$ZB=$_.resultTransform.skX,180<($f=(($f+$_B)*$nB.radDeg-0)*$A+$I-($ZB%=360))?$f-=360:$f<-180&&($f+=360),$_.resultTransform.x=$$,$_.resultTransform.y=$w,$_.resultTransform.skX=$_.resultTransform.skY=$_.resultTransform.skY+$f*$q,$B.update()}},$B._applyIk3=function($B,$_,$Z,$n,$g,$q){if(0!=$q){var $P,$k,$m=$_.resultMatrix.a*$_.length,$D=$_.resultMatrix.b*$_.length,$T=$m*$m+$D*$D,$e=Math.sqrt($T),$I=$B.resultMatrix.tx,$A=$B.resultMatrix.ty,$$=$_.resultMatrix.tx,$w=$_.resultMatrix.ty,$r=$$-$I,$j=$w-$A,$y=$r*$r+$j*$j,$C=Math.sqrt($y),$z=($r=$Z-$B.resultMatrix.tx)*$r+($j=$n-$B.resultMatrix.ty)*$j,$t=Math.sqrt($z);if($e+$C<=$t||$t+$e<=$C||$t+$C<=$e){var $J=NaN;$$=$I+($J=$e+$C<=$t?1:-1)*($Z-$I)*$C/$t,$w=$A+$J*($n-$A)*$C/$t}else{var $N=($y-$T+$z)/(2*$z),$Q=Math.sqrt($y-$N*$N*$z)/$t,$M=$I+$r*$N,$Y=$A+$j*$N,$l=-$j*$Q,$L=$r*$Q;$w=0<$g?($$=$M-$l,$Y-$L):($$=$M+$l,$Y+$L)}$P=$$,$k=$w,this.isDebug&&(this._sp||(this._sp=new $qB,$gB.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($I,$A,15,"#ff00ff"),this._sp.graphics.drawCircle($Z,$n,15,"#ffff00"),this._sp.graphics.drawCircle($P,$k,15,"#ff00ff"));var $v,$V;$v=Math.atan2($k-$B.resultMatrix.ty,$P-$B.resultMatrix.tx),$B.setRotation($v),($V=$nB._tempMatrix).identity(),$V.rotate($v),$V.scale($B.resultMatrix.getScaleX(),$B.resultMatrix.getScaleY()),$V.translate($B.resultMatrix.tx,$B.resultMatrix.ty),$V.copyTo($B.resultMatrix),$B.updateChild();var $o,$F;$o=Math.atan2($n-$k,$Z-$P),$_.setRotation($o),($F=$nB._tempMatrix).identity(),$F.rotate($o),$F.scale($_.resultMatrix.getScaleX(),$_.resultMatrix.getScaleY()),$F.translate($P,$k),$V.copyTo($_.resultMatrix),$_.updateChild()}},$Z($nB,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $VB}]),$nB}(),$HB=function(){function $B(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $n($B,"laya.ani.bone.IkConstraintData"),$B}(),$t=function(){function $F($B,$_){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$B,this.position=$B.position,this.spacing=$B.spacing,this.rotateMix=$B.rotateMix,this.translateMix=$B.translateMix,this.bones=[];for(var $Z=this.data.bones,$n=0,$g=$Z.length;$n<$g;$n++)this.bones.push($_[$Z[$n]])}$n($F,"laya.ani.bone.PathConstraint");var $B=$F.prototype;return $B.apply=function($B,$_){if(this.target){var $Z=this.translateMix,$n=this.translateMix,$g=0<$n,$q=this.data.spacingMode,$P="length"==$q,$k=this.data.rotateMode,$m="tangent"==$k,$D="chainScale"==$k,$T=[],$e=this.bones.length,$I=$m?$e:$e+1,$A=[];(this._spaces=$A)[0]=this.position;var $$=this.spacing;if($D||$P)for(var $w=0,$r=$I-1;$w<$r;){var $j=this.bones[$w],$y=$j.length,$C=$y*$j.resultMatrix.a,$z=$y*$j.resultMatrix.b;$y=Math.sqrt($C*$C+$z*$z),$D&&($T[$w]=$y),$A[++$w]=$P?Math.max(0,$y+$$):$$}else for($w=1;$w<$I;$w++)$A[$w]=$$;var $t=this.computeWorldPositions(this.target,$B,$_,$I,$m,"percent"==this.data.positionMode,"percent"==$q);if(this._debugKey){for($w=0;$w<$t.length;$w++)$_.drawCircle($t[$w++],$t[$w++],5,"#00ff00");var $J=[];for($w=0;$w<$t.length;$w++)$J.push($t[$w++],$t[$w++]);$_.drawLines(0,0,$J,"#ff0000")}var $N=$t[0],$Q=$t[1],$M=this.data.offsetRotation,$Y="chain"==$k&&0==$M,$l=NaN;for($w=0,$l=3;$w<$e;$w++,$l+=3){($j=this.bones[$w]).resultMatrix.tx+=($N-$j.resultMatrix.tx)*$Z,$j.resultMatrix.ty+=($Q-$j.resultMatrix.ty)*$Z;var $L=($C=$t[$l])-$N,$v=($z=$t[$l+1])-$Q;if($D&&0!=($y=$T[$w])){var $V=(Math.sqrt($L*$L+$v*$v)/$y-1)*$n+1;$j.resultMatrix.a*=$V,$j.resultMatrix.c*=$V}if($N=$C,$Q=$z,$g){var $o=$j.resultMatrix.a,$F=$j.resultMatrix.c,$u=$j.resultMatrix.b,$f=$j.resultMatrix.d,$b=NaN,$x=NaN,$p=NaN;$b=$m?$t[$l-1]:0==$A[$w+1]?$t[$l+2]:Math.atan2($v,$L),$b-=Math.atan2($u,$o)-$M/180*Math.PI,$Y&&($x=Math.cos($b),$p=Math.sin($b),$N+=(($y=$j.length)*($x*$o-$p*$u)-$L)*$n,$Q+=($y*($p*$o+$x*$u)-$v)*$n),$b>Math.PI?$b-=2*Math.PI:$b<-Math.PI&&($b+=2*Math.PI),$b*=$n,$x=Math.cos($b),$p=Math.sin($b),$j.resultMatrix.a=$x*$o-$p*$u,$j.resultMatrix.c=$x*$F-$p*$f,$j.resultMatrix.b=$p*$o+$x*$u,$j.resultMatrix.d=$p*$F+$x*$f}}}},$B.computeWorldVertices2=function($B,$_,$Z,$n,$g,$q){var $P,$k,$m=$B.currDisplayData.bones,$D=$B.currDisplayData.weights,$T=$B.currDisplayData.triangles,$e=0,$I=0,$A=0,$$=0,$w=0,$r=0,$j=0,$y=0,$C=0,$z=0,$t=0;if(null!=$m){for($e=0;$e<$Z;$e+=2)$I+=($$=$m[$I])+1,$A+=$$;var $J=$_;for($w=$q,$r=3*$A;$w<$n;$w+=2){for($y=$j=0,$$=$m[$I++],$$+=$I;$I<$$;$I++,$r+=3){$P=$J[$m[$I]].resultMatrix,$C=$D[$r],$z=$D[$r+1];var $N=$D[$r+2];$j+=($C*$P.a+$z*$P.c+$P.tx)*$N,$y+=($C*$P.b+$z*$P.d+$P.ty)*$N}$g[$w]=$j,$g[$w+1]=$y}}else{var $Q,$M;if($T||($T=$D),$B.deformData&&($T=$B.deformData),$Q=$B.parent,$_)for($t=$_.length,$e=0;$e<$t;$e++)if($_[$e].name==$Q){$k=$_[$e];break}$k&&($M=$k.resultMatrix),$M||($M=$F._tempMt);var $Y=$M.tx,$l=$M.ty,$L=$M.a,$v=$M.b,$V=$M.c,$o=$M.d;for($k&&($o*=$k.d),$I=$Z,$w=$q;$w<$n;$I+=2,$w+=2)$C=$T[$I],$z=$T[$I+1],$g[$w]=$C*$L+$z*$v+$Y,$g[$w+1]=-($C*$V+$z*$o+$l)}},$B.computeWorldPositions=function($B,$_,$Z,$n,$g,$q,$P){$B.currDisplayData.bones,$B.currDisplayData.weights,$B.currDisplayData.triangles;var $k=[],$m=0,$D=$B.currDisplayData.verLen,$T=this.position,$e=this._spaces,$I=[],$A=[],$$=$D/6,$w=-1,$r=NaN,$j=0,$y=0,$C=NaN,$z=NaN,$t=NaN,$J=NaN;if($$--,$D-=4,this.computeWorldVertices2($B,$_,2,$D,$k,0),this._debugKey)for($m=0;$m<$k.length;)$Z.drawCircle($k[$m++],$k[$m++],10,"#ff0000");$I=$k,this._curves.length=$$;var $N=this._curves,$Q=$I[$r=0],$M=$I[1],$Y=0,$l=0,$L=0,$v=0,$V=0,$o=0,$F=NaN,$u=NaN,$f=NaN,$b=NaN,$x=NaN,$p=NaN,$K=NaN,$H=NaN,$G=0;for($m=0,$G=2;$m<$$;$m++,$G+=6)$Y=$I[$G],$l=$I[$G+1],$L=$I[$G+2],$v=$I[$G+3],$x=2*($F=.1875*($Q-2*$Y+$L))+($f=.09375*(3*($Y-$L)-$Q+($V=$I[$G+4]))),$p=2*($u=.1875*($M-2*$l+$v))+($b=.09375*(3*($l-$v)-$M+($o=$I[$G+5]))),$K=.75*($Y-$Q)+$F+.16666667*$f,$H=.75*($l-$M)+$u+.16666667*$b,$r+=Math.sqrt($K*$K+$H*$H),$K+=$x,$H+=$p,$x+=$f,$p+=$b,$r+=Math.sqrt($K*$K+$H*$H),$K+=$x,$H+=$p,$r+=Math.sqrt($K*$K+$H*$H),$K+=$x+$f,$H+=$p+$b,$r+=Math.sqrt($K*$K+$H*$H),$N[$m]=$r,$Q=$V,$M=$o;if($q&&($T*=$r),$P)for($m=0;$m<$n;$m++)$e[$m]*=$r;var $W=this._segments,$X=0,$R=0;for($R=$y=$j=$m=0;$m<$n;$m++,$j+=3)if(($C=$T+=$z=$e[$m])<0)this.addBeforePosition($C,$I,0,$A,$j);else if($r<$C)this.addAfterPosition($C-$r,$I,$D-4,$A,$j);else{for(;;$y++)if(!(($J=$N[$y])<$C)){0==$y?$C/=$J:$C=($C-($t=$N[$y-1]))/($J-$t);break}if($y!=$w){var $h=6*($w=$y);for($Q=$I[$h],$M=$I[$h+1],$Y=$I[$h+2],$l=$I[$h+3],$L=$I[$h+4],$v=$I[$h+5],$x=2*($F=.03*($Q-2*$Y+$L))+($f=.006*(3*($Y-$L)-$Q+($V=$I[$h+6]))),$p=2*($u=.03*($M-2*$l+$v))+($b=.006*(3*($l-$v)-$M+($o=$I[$h+7]))),$K=.3*($Y-$Q)+$F+.16666667*$f,$H=.3*($l-$M)+$u+.16666667*$b,$X=Math.sqrt($K*$K+$H*$H),$W[0]=$X,$h=1;$h<8;$h++)$K+=$x,$H+=$p,$x+=$f,$p+=$b,$X+=Math.sqrt($K*$K+$H*$H),$W[$h]=$X;$K+=$x,$H+=$p,$X+=Math.sqrt($K*$K+$H*$H),$W[8]=$X,$K+=$x+$f,$H+=$p+$b,$X+=Math.sqrt($K*$K+$H*$H),$W[9]=$X,$R=0}for($C*=$X;;$R++)if(!(($J=$W[$R])<$C)){0==$R?$C/=$J:$C=$R+($C-($t=$W[$R-1]))/($J-$t);break}this.addCurvePosition(.1*$C,$Q,$M,$Y,$l,$L,$v,$V,$o,$A,$j,$g||0<$m&&0==$z)}return $A},$B.addBeforePosition=function($B,$_,$Z,$n,$g){var $q=$_[$Z],$P=$_[$Z+1],$k=$_[$Z+2]-$q,$m=$_[$Z+3]-$P,$D=Math.atan2($m,$k);$n[$g]=$q+$B*Math.cos($D),$n[$g+1]=$P+$B*Math.sin($D),$n[$g+2]=$D},$B.addAfterPosition=function($B,$_,$Z,$n,$g){var $q=$_[$Z+2],$P=$_[$Z+3],$k=$q-$_[$Z],$m=$P-$_[$Z+1],$D=Math.atan2($m,$k);$n[$g]=$q+$B*Math.cos($D),$n[$g+1]=$P+$B*Math.sin($D),$n[$g+2]=$D},$B.addCurvePosition=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T,$e){0==$B&&($B=1e-4);var $I=$B*$B,$A=$I*$B,$$=1-$B,$w=$$*$$,$r=$w*$$,$j=$$*$B,$y=3*$j,$C=$$*$y,$z=$y*$B,$t=$_*$r+$n*$C+$q*$z+$k*$A,$J=$Z*$r+$g*$C+$P*$z+$m*$A;$D[$T]=$t,$D[$T+1]=$J,$D[$T+2]=$e?Math.atan2($J-($Z*$w+$g*$j*2+$P*$I),$t-($_*$w+$n*$j*2+$q*$I)):0},$F.NONE=-1,$F.BEFORE=-2,$F.AFTER=-3,$Z($F,["_tempMt",function(){return this._tempMt=new $VB}]),$F}(),$GB=function(){function $B(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $n($B,"laya.ani.bone.PathConstraintData"),$B}(),$WB=function(){function $B(){this.name=null,this.slotArr=[]}return $n($B,"laya.ani.bone.SkinData"),$B}(),$XB=function(){function $B(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$n($B,"laya.ani.bone.SkinSlotDisplayData");var $_=$B.prototype;return $_.createTexture=function($B){return this.texture||(this.texture=new $oB($B.bitmap,this.uvs),$B.bitmap.alphaTexture&&(this.texture.alphaTexture=new $oB($B.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$B.height,this.texture.height=$B.width,this.texture.offsetX=-$B.offsetX,this.texture.offsetY=-$B.offsetY,this.texture.sourceWidth=$B.sourceHeight,this.texture.sourceHeight=$B.sourceWidth):(this.texture.width=$B.width,this.texture.height=$B.height,this.texture.offsetX=-$B.offsetX,this.texture.offsetY=-$B.offsetY,this.texture.sourceWidth=$B.sourceWidth,this.texture.sourceHeight=$B.sourceHeight),$r.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$_.destory=function(){this.texture&&this.texture.destroy()},$B}(),$RB=function(){function $B(){this.name=null,this.displayArr=[]}return $n($B,"laya.ani.bone.SlotData"),$B.prototype.getDisplayByName=function($B){for(var $_=0,$Z=this.displayArr.length;$_<$Z;$_++)if(this.displayArr[$_].attachmentName==$B)return $_;return-1},$B}(),$J=function(){function $B($B,$_){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$w(2,0),this._data=$B,null==this._bones&&(this._bones=[]),this.target=$_[$B.targetIndex];var $Z,$n=0;for($n=0,$Z=$B.boneIndexs.length;$n<$Z;$n++)this._bones.push($_[$B.boneIndexs[$n]]);this.rotateMix=$B.rotateMix,this.translateMix=$B.translateMix,this.scaleMix=$B.scaleMix,this.shearMix=$B.shearMix}return $n($B,"laya.ani.bone.TfConstraint"),$B.prototype.apply=function(){for(var $B,$_=this.target.resultMatrix.a,$Z=this.target.resultMatrix.b,$n=this.target.resultMatrix.c,$g=this.target.resultMatrix.d,$q=0,$P=this._bones.length;$q<$P;$q++){if($B=this._bones[$q],0<this.rotateMix){var $k=$B.resultMatrix.a,$m=$B.resultMatrix.b,$D=$B.resultMatrix.c,$T=$B.resultMatrix.d,$e=Math.atan2($n,$_)-Math.atan2($D,$k)+this._data.offsetRotation*Math.PI/180;$e>Math.PI?$e-=2*Math.PI:$e<-Math.PI&&($e+=2*Math.PI),$e*=this.rotateMix;var $I=Math.cos($e),$A=Math.sin($e);$B.resultMatrix.a=$I*$k-$A*$D,$B.resultMatrix.b=$I*$m-$A*$T,$B.resultMatrix.c=$A*$k+$I*$D,$B.resultMatrix.d=$A*$m+$I*$T}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$B.resultMatrix.tx+=(this._temp[0]-$B.resultMatrix.tx)*this.translateMix,$B.resultMatrix.ty+=(this._temp[1]-$B.resultMatrix.ty)*this.translateMix,$B.updateChild()),0<this.scaleMix){var $$=Math.sqrt($B.resultMatrix.a*$B.resultMatrix.a+$B.resultMatrix.c*$B.resultMatrix.c),$w=Math.sqrt($_*$_+$n*$n),$r=1e-5<$$?($$+($w-$$+this._data.offsetScaleX)*this.scaleMix)/$$:0;$B.resultMatrix.a*=$r,$B.resultMatrix.c*=$r,$$=Math.sqrt($B.resultMatrix.b*$B.resultMatrix.b+$B.resultMatrix.d*$B.resultMatrix.d),$w=Math.sqrt($Z*$Z+$g*$g),$r=1e-5<$$?($$+($w-$$+this._data.offsetScaleY)*this.scaleMix)/$$:0,$B.resultMatrix.b*=$r,$B.resultMatrix.d*=$r}if(0<this.shearMix){$m=$B.resultMatrix.b,$T=$B.resultMatrix.d;var $j=Math.atan2($T,$m);($e=Math.atan2($g,$Z)-Math.atan2($n,$_)-($j-Math.atan2($B.resultMatrix.c,$B.resultMatrix.a)))>Math.PI?$e-=2*Math.PI:$e<-Math.PI&&($e+=2*Math.PI),$e=$j+($e+this._data.offsetShearY*Math.PI/180)*this.shearMix,$r=Math.sqrt($m*$m+$T*$T),$B.resultMatrix.b=Math.cos($e)*$r,$B.resultMatrix.d=Math.sin($e)*$r}}},$B}(),$hB=function(){function $B(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $n($B,"laya.ani.bone.TfConstraintData"),$B}(),$sB=function(){function $B(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$n($B,"laya.ani.bone.Transform");var $_=$B.prototype;return $_.initData=function($B){null!=$B.x&&(this.x=$B.x),null!=$B.y&&(this.y=$B.y),null!=$B.skX&&(this.skX=$B.skX),null!=$B.skY&&(this.skY=$B.skY),null!=$B.scX&&(this.scX=$B.scX),null!=$B.scY&&(this.scY=$B.scY)},$_.getMatrix=function(){var $B;return($B=this.mMatrix?this.mMatrix:this.mMatrix=new $VB).identity(),$B.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($B,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$B.rotate(this.skX*Math.PI/180),$B.translate(this.x,this.y),$B},$_.skew=function($B,$_,$Z){var $n=Math.sin($Z),$g=Math.cos($Z),$q=Math.sin($_),$P=Math.cos($_);return $B.setTo($B.a*$P-$B.b*$n,$B.a*$q+$B.b*$g,$B.c*$P-$B.d*$n,$B.c*$q+$B.d*$g,$B.tx*$P-$B.ty*$n,$B.tx*$q+$B.ty*$g),$B},$B}(),$N=function(){function $B(){}return $n($B,"laya.ani.bone.UVTools"),$B.getRelativeUV=function($B,$_,$Z){var $n=$B[0],$g=$B[2]-$B[0],$q=$B[1],$P=$B[5]-$B[1];$Z||($Z=[]),$Z.length=$_.length;var $k,$m=0;$k=$Z.length;var $D=1/$g,$T=1/$P;for($m=0;$m<$k;$m+=2)$Z[$m]=($_[$m]-$n)*$D,$Z[$m+1]=($_[$m+1]-$q)*$T;return $Z},$B.getAbsoluteUV=function($B,$_,$Z){if(0==$B[0]&&0==$B[1]&&1==$B[4]&&1==$B[5])return $Z?($j.copyArray($Z,$_),$Z):$_;var $n=$B[0],$g=$B[2]-$B[0],$q=$B[1],$P=$B[5]-$B[1];$Z||($Z=[]),$Z.length=$_.length;var $k,$m=0;for($k=$Z.length,$m=0;$m<$k;$m+=2)$Z[$m]=$_[$m]*$g+$n,$Z[$m+1]=$_[$m+1]*$P+$q;return $Z},$B}(),$F=function(){function $B(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $n($B,"laya.ani.KeyFramesContent"),$B}(),$Q=function(){function $T(){}return $n($T,"laya.ani.math.BezierLerp"),$T.getBezierRate=function($B,$_,$Z,$n,$g){var $q=$T._getBezierParamKey($_,$Z,$n,$g),$P=100*$q+$B;if($T._bezierResultCache[$P])return $T._bezierResultCache[$P];var $k,$m=$T._getBezierPoints($_,$Z,$n,$g,$q),$D=0;for($k=$m.length,$D=0;$D<$k;$D+=2)if($B<=$m[$D])return $T._bezierResultCache[$P]=$m[$D+1],$m[$D+1];return $T._bezierResultCache[$P]=1},$T._getBezierParamKey=function($B,$_,$Z,$n){return 100*(100*(100*(100*$B+$_)+$Z)+$n)},$T._getBezierPoints=function($B,$_,$Z,$n,$g){return $T._bezierPointsCache[$g]?$T._bezierPointsCache[$g]:($q=[0,0,$B,$_,$Z,$n,1,1],$P=(new $k).getBezierPoints($q,100,3),$T._bezierPointsCache[$g]=$P);var $q,$P},$T._bezierResultCache={},$T._bezierPointsCache={},$T}(),$M=function($B){function $_(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$_.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$n($_,"laya.ani.AnimationPlayer",$g);var $Z=$_.prototype;return $gB.imps($Z,{"laya.resource.IDestroy":!0}),$Z._onTempletLoadedComputeFullKeyframeIndices=function($B,$_,$Z){this._templet===$Z&&this._cachePlayRate===$B&&this._cacheFrameRate===$_&&this._computeFullKeyframeIndices()},$Z._computeFullKeyframeIndices=function(){for(var $B=this._fullFrames=[],$_=this._templet,$Z=this._cacheFrameRateInterval*this._cachePlayRate,$n=0,$g=$_.getAnimationCount();$n<$g;$n++){for(var $q=[],$P=0,$k=$_.getAnimation($n).nodes.length;$P<$k;$P++){for(var $m=$_.getAnimation($n).nodes[$P],$D=Math.floor($m.playTime/$Z+.01),$T=new Uint16Array($D+1),$e=-1,$I=0,$A=$m.keyFrame.length;$I<$A;$I++){var $$=$m.keyFrame[$I],$w=$$.startTime,$r=$w+$$.duration+$Z;do{for(var $j=Math.floor($w/$Z+.5),$y=$e+1;$y<$j;$y++)$T[$y]=$I;$T[$e=$j]=$I,$w+=$Z}while($w<=$r)}$q.push($T)}$B.push($q)}},$Z._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$Z._calculatePlayDuration=function(){if(0!==this.state){var $B=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$B),this._playEnd>$B&&(this._playEnd=$B),this._playDuration=this._playEnd-this._playStart}},$Z._setPlayParams=function($B,$_){this._currentTime=$B,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$_+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$_},$Z._setPlayParamsWhenStop=function($B,$_){this._currentTime=$B,this._currentKeyframeIndex=Math.max(Math.floor($B/$_+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$_,this._currentAnimationClipIndex=-1},$Z._update=function($B){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $_=this._cacheFrameRateInterval*this._cachePlayRate,$Z=0;this._startUpdateLoopCount!==$$.loopCount&&($Z=$B*this.playbackRate,this._elapsedPlaybackTime+=$Z);var $n=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$n)return this._setPlayParamsWhenStop($n,$_),void this.event("stopped");if($Z+=this._currentTime,0<$n)if($n<=$Z)do{if($Z-=$n,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($n,$_),this._stopWhenCircleFinish=!1,void this.event("stopped");$Z<$n&&(this._setPlayParams($Z,$_),this.event("complete"))}while($n<=$Z);else this._setPlayParams($Z,$_);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($n,$_),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$Z._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$Z.play=function($B,$_,$Z,$n,$g){if(void 0===$B&&($B=0),void 0===$_&&($_=1),void 0===$Z&&($Z=2147483647),void 0===$n&&($n=0),void 0===$g&&($g=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($Z<0||$n<0||$g<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$g&&$g<$n)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$_,this._overallDuration=$Z,this._playStart=$n,this._playEnd=$g,this._paused=!1,this._currentAnimationClipIndex=$B,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$$.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$Z.playByFrame=function($B,$_,$Z,$n,$g,$q){void 0===$B&&($B=0),void 0===$_&&($_=1),void 0===$Z&&($Z=2147483647),void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$q&&($q=30);var $P=1e3/$q;this.play($B,$_,$Z,$n*$P,$g*$P)},$Z.stop=function($B){void 0===$B&&($B=!0),$B?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$q(0,$Z,"playEnd",function(){return this._playEnd}),$q(0,$Z,"templet",function(){return this._templet},function($B){0===!this.state&&this.stop(!0),this._templet!==$B&&((this._templet=$B).loaded?this._computeFullKeyframeIndices():$B.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$q(0,$Z,"playStart",function(){return this._playStart}),$q(0,$Z,"playDuration",function(){return this._playDuration}),$q(0,$Z,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$q(0,$Z,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$q(0,$Z,"overallDuration",function(){return this._overallDuration}),$q(0,$Z,"currentFrameTime",function(){return this._currentFrameTime}),$q(0,$Z,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$q(0,$Z,"currentPlayTime",function(){return this._currentTime+this._playStart}),$q(0,$Z,"cachePlayRate",function(){return this._cachePlayRate},function($B){this._cachePlayRate!==$B&&(this._cachePlayRate=$B,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$B,this._cacheFrameRate])))}),$q(0,$Z,"cacheFrameRate",function(){return this._cacheFrameRate},function($B){this._cacheFrameRate!==$B&&(this._cacheFrameRate=$B,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$B])))}),$q(0,$Z,"currentTime",null,function($B){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($B<this._playStart||$B>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$$.loopCount;var $_=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$B,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$_),0),this._currentFrameTime=this._currentKeyframeIndex*$_}}),$q(0,$Z,"paused",function(){return this._paused},function($B){(this._paused=$B)&&this.event("paused")}),$q(0,$Z,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$q(0,$Z,"destroyed",function(){return this._destroyed}),$_}(),$u=function($B){function $_(){$_.__super.call(this),$r.isConchNode&&(this.drawSkin=function($B){$B.transform||($B.transform=$VB.EMPTY),this._addCmd([$B]),this.setSkinMesh&&this.setSkinMesh($B._ps,$B.mVBData,$B.mEleNum,0,$B.mTexture,$B.transform)})}return $n($_,"laya.ani.GraphicsAni",$P),$_.prototype.drawSkin=function($B){var $_=[$B];this._saveToCmd($r._context._drawSkin,$_)},$_.create=function(){return $_._caches.pop()||new $_},$_.recycle=function($B){$B.clear(),$_._caches.push($B)},$_._caches=[],$_}(),$f=function($B){function $y(){this._aniMap={},this.unfixedLastAniIndex=-1,$y.__super.call(this),this._anis=new Array}$n($y,"laya.ani.AnimationTemplet",$T);var $_=$y.prototype;return $_.parse=function($B){var $_=new $vB($B);this._aniVersion=$_.readUTFString(),$C.parse(this,$_)},$_._calculateKeyFrame=function($B,$_,$Z){var $n=$B.keyFrame;$n[$_]=$n[0];for(var $g=0;$g<$_;$g++){var $q=$n[$g];$q.nextData=0===$q.duration?$q.data:$n[$g+1].data}$n.length--},$_.onAsynLoaded=function($B,$_,$Z){var $n=new $vB($_);switch(this._aniVersion=$n.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$z.parse(this,$n);break;default:$C.parse(this,$n)}this._endLoaded()},$_.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$_.getAnimationCount=function(){return this._anis.length},$_.getAnimation=function($B){return this._anis[$B]},$_.getAniDuration=function($B){return this._anis[$B].playTime},$_.getNodes=function($B){return this._anis[$B].nodes},$_.getNodeIndexWithName=function($B,$_){return this._anis[$B].bone3DMap[$_]},$_.getNodeCount=function($B){return this._anis[$B].nodes.length},$_.getTotalkeyframesLength=function($B){return this._anis[$B].totalKeyframeDatasLength},$_.getPublicExtData=function(){return this._publicExtData},$_.getAnimationDataWithCache=function($B,$_,$Z,$n){var $g=$_[$Z];if($g){var $q=$g[$B];return $q?$q[$n]:null}return null},$_.setAnimationDataWithCache=function($B,$_,$Z,$n,$g){var $q=$_[$Z]||($_[$Z]={});($q[$B]||($q[$B]=[]))[$n]=$g},$_.getOriginalData=function($B,$_,$Z,$n,$g){for(var $q=this._anis[$B].nodes,$P=0,$k=0,$m=$q.length,$D=0;$k<$m;$k++){var $T,$e=$q[$k];$T=$e.keyFrame[$Z[$k][$n]],$e.dataOffset=$D;var $I=$g-$T.startTime,$A=$e.lerpType;if($A)switch($A){case 0:case 1:for($P=0;$P<$e.keyframeWidth;)$P+=$e.interpolationMethod[$P]($e,$P,$_,$D+$P,$T.data,$I,null,$T.duration,$T.nextData);break;case 2:var $$=$T.interpolationData,$w=$$.length,$r=0;for($P=0;$P<$w;){var $j=$$[$P];switch($j){case 6:case 7:$P+=$y.interpolation[$j]($e,$r,$_,$D+$r,$T.data,$I,null,$T.duration,$T.nextData,$$,$P+1);break;default:$P+=$y.interpolation[$j]($e,$r,$_,$D+$r,$T.data,$I,null,$T.duration,$T.nextData)}$r++}}else for($P=0;$P<$e.keyframeWidth;)$P+=$e.interpolationMethod[$P]($e,$P,$_,$D+$P,$T.data,$I,null,$T.duration,$T.nextData);$D+=$e.keyframeWidth}},$_.getNodesCurrentFrameIndex=function($B,$_){var $Z=this._anis[$B].nodes;$B!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($Z.length),this.unfixedCurrentTimes=new Float32Array($Z.length),this.unfixedLastAniIndex=$B);for(var $n=0,$g=$Z.length;$n<$g;$n++){var $q=$Z[$n];for($_<this.unfixedCurrentTimes[$n]&&(this.unfixedCurrentFrameIndexes[$n]=0),this.unfixedCurrentTimes[$n]=$_;this.unfixedCurrentFrameIndexes[$n]<$q.keyFrame.length&&!($q.keyFrame[this.unfixedCurrentFrameIndexes[$n]].startTime>this.unfixedCurrentTimes[$n]);)this.unfixedCurrentFrameIndexes[$n]++;this.unfixedCurrentFrameIndexes[$n]--}return this.unfixedCurrentFrameIndexes},$_.getOriginalDataUnfixedRate=function($B,$_,$Z){var $n=this._anis[$B].nodes;$B!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($n.length),this.unfixedCurrentTimes=new Float32Array($n.length),this.unfixedKeyframes=$w($n.length),this.unfixedLastAniIndex=$B);for(var $g=0,$q=0,$P=$n.length,$k=0;$q<$P;$q++){var $m=$n[$q];for($Z<this.unfixedCurrentTimes[$q]&&(this.unfixedCurrentFrameIndexes[$q]=0),this.unfixedCurrentTimes[$q]=$Z;this.unfixedCurrentFrameIndexes[$q]<$m.keyFrame.length&&!($m.keyFrame[this.unfixedCurrentFrameIndexes[$q]].startTime>this.unfixedCurrentTimes[$q]);)this.unfixedKeyframes[$q]=$m.keyFrame[this.unfixedCurrentFrameIndexes[$q]],this.unfixedCurrentFrameIndexes[$q]++;var $D=this.unfixedKeyframes[$q];$m.dataOffset=$k;var $T=$Z-$D.startTime;if($m.lerpType)switch($m.lerpType){case 0:case 1:for($g=0;$g<$m.keyframeWidth;)$g+=$m.interpolationMethod[$g]($m,$g,$_,$k+$g,$D.data,$T,null,$D.duration,$D.nextData);break;case 2:var $e=$D.interpolationData,$I=$e.length,$A=0;for($g=0;$g<$I;){var $$=$e[$g];switch($$){case 6:case 7:$g+=$y.interpolation[$$]($m,$A,$_,$k+$A,$D.data,$T,null,$D.duration,$D.nextData,$e,$g+1);break;default:$g+=$y.interpolation[$$]($m,$A,$_,$k+$A,$D.data,$T,null,$D.duration,$D.nextData)}$A++}}else for($g=0;$g<$m.keyframeWidth;)$g+=$m.interpolationMethod[$g]($m,$g,$_,$k+$g,$D.data,$T,null,$D.duration,$D.nextData);$k+=$m.keyframeWidth}},$y._LinearInterpolation_0=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){var $T=0===$k?0:$q/$k;return $Z[$n]=(1-$T)*$g[$_]+$T*$m[$_],1},$y._QuaternionInterpolation_1=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){var $T=0===$k?0:$q/$k;return $I.slerpQuaternionArray($g,$_,$m,$_,$T,$Z,$n),4},$y._AngleInterpolation_2=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){return 0},$y._RadiansInterpolation_3=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){return 0},$y._Matrix4x4Interpolation_4=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){for(var $T=0;$T<16;$T++,$_++)$Z[$n+$T]=$g[$_]+$q*$P[$_];return 16},$y._NoInterpolation_5=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D){return $Z[$n]=$g[$_],1},$y._BezierInterpolation_6=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T){return void 0===$T&&($T=0),$Z[$n]=$g[$_]+($m[$_]-$g[$_])*$Q.getBezierRate($q/$k,$D[$T],$D[$T+1],$D[$T+2],$D[$T+3]),5},$y._BezierInterpolation_7=function($B,$_,$Z,$n,$g,$q,$P,$k,$m,$D,$T){return void 0===$T&&($T=0),$Z[$n]=$D[$T+4]+$D[$T+5]*$Q.getBezierRate((.001*$q+$D[$T+6])/$D[$T+7],$D[$T],$D[$T+1],$D[$T+2],$D[$T+3]),9},$y.load=function($B){return $gB.loader.create($B,null,null,$y)},$y.interpolation=[$y._LinearInterpolation_0,$y._QuaternionInterpolation_1,$y._AngleInterpolation_2,$y._RadiansInterpolation_3,$y._Matrix4x4Interpolation_4,$y._NoInterpolation_5,$y._BezierInterpolation_6,$y._BezierInterpolation_7],$y}(),$Y=function($_){function $Z($B,$_){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$Z.__super.call(this),void 0===$_&&($_=0),$B&&this.init($B,$_)}$n($Z,"laya.ani.bone.Skeleton",$_);var $B=$Z.prototype;return $B.init=function($B,$_){void 0===$_&&($_=0);var $Z,$n,$g,$q=0,$P=0;if(1==$_)for(this._graphicsCache=[],$q=0,$P=$B.getAnimationCount();$q<$P;$q++)this._graphicsCache.push([]);if(this._yReverseMatrix=$B.yReverseMatrix,this._aniMode=$_,this._templet=$B,this._player=new $M,this._player.cacheFrameRate=$B.rate,this._player.templet=$B,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$B.mBoneArr,this._rootBone=$B.mRootBone,this._aniSectionDic=$B.aniSectionDic,0<$B.ikArr.length)for(this._ikArr=[],$q=0,$P=$B.ikArr.length;$q<$P;$q++)this._ikArr.push(new $y($B.ikArr[$q],this._boneList));if(0<$B.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$q=0,$P=$B.pathArr.length;$q<$P;$q++)$Z=$B.pathArr[$q],$n=new $t($Z,this._boneList),($g=this._boneSlotDic[$Z.name])&&(($n=new $t($Z,this._boneList)).target=$g),this._pathDic[$Z.name]=$n;if(0<$B.tfArr.length)for(this._tfArr=[],$q=0,$P=$B.tfArr.length;$q<$P;$q++)this._tfArr.push(new $J($B.tfArr[$q],this._boneList));if(0<$B.skinDataArray.length){var $k=this._templet.skinDataArray[this._skinIndex];this._skinName=$k.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$B.load=function($B,$_,$Z){},$B._onLoaded=function(){},$B._parseComplete=function(){var $B=$l.TEMPLET_DICTIONARY[this._aniPath];$B&&(this.init($B,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$B._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$B._onPlay=function(){this.event("played")},$B._onStop=function(){var $B,$_=this._templet.eventAniArr[this._aniClipIndex];if($_&&this._eventIndex<$_.length)for(;this._eventIndex<$_.length;this._eventIndex++)($B=$_[this._eventIndex]).time>=this._player.playStart&&$B.time<=this._player.playEnd&&this.event("label",$B);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$B._onPause=function(){this.event("paused")},$B._parseSrcBoneMatrix=function(){var $B=0,$_=0;for($_=this._templet.srcBoneMatrixArr.length,$B=0;$B<$_;$B++)this._boneMatrixArray.push(new $VB);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $Z,$n,$g=this._templet.boneSlotArray;for($B=0,$_=$g.length;$B<$_;$B++)$Z=$g[$B],null==($n=this._bindBoneBoneSlotDic[$Z.parent])&&(this._bindBoneBoneSlotDic[$Z.parent]=$n=[]),this._boneSlotDic[$Z.name]=$Z=$Z.copy(),$n.push($Z),this._boneSlotArray.push($Z)}},$B._emitMissedEvents=function($B,$_,$Z){void 0===$Z&&($Z=0);var $n=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($n){var $g,$q,$P=0;for($g=$n.length,$P=$Z;$P<$g;$P++)($q=$n[$P]).time>=this._player.playStart&&$q.time<=this._player.playEnd&&this.event("label",$q)}},$B._update=function($B){if(void 0===$B&&($B=!0),!(this._pause||$B&&this._indexControl)){var $_=this.timer.currTimer,$Z=this._player.currentKeyframeIndex,$n=$_-this._lastTime;if($B?this._player._update($n):$Z=-1,this._lastTime=$_,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$n&&this._clipIndex==$Z&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $g;this._lastUpdateAniClipIndex=this._aniClipIndex,$Z>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $q,$P=this._templet.eventAniArr[this._aniClipIndex];if($P&&this._eventIndex<$P.length&&(($g=$P[this._eventIndex]).time>=this._player.playStart&&$g.time<=this._player.playEnd?this._player.currentPlayTime>=$g.time&&(this.event("label",$g),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($q=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$q&&(this.graphics=$q));var $k=0,$m=0;for($m=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$m-1)&&0<$m;)$m--;if($m<this._clipIndex)for($k=$m;$k<this._clipIndex;$k++)this._createGraphics($k)}else if(1==this._aniMode){if($q=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$q&&(this.graphics=$q));for($m=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$m-1)&&0<$m;)$m--;if($m<this._clipIndex)for($k=$m;$k<this._clipIndex;$k++)this._createGraphics($k)}this._createGraphics()}}},$B._createGraphics=function($B){void 0===$B&&($B=-1),-1==$B&&($B=this._clipIndex);var $_,$Z,$n=$B*this._player.cacheFrameRateInterval,$g=this._templet.drawOrderAniArr[this._aniClipIndex];if($g&&0<$g.length)for(this._drawOrderIndex=0,$_=$g[this._drawOrderIndex];$n>=$_.time&&(this._drawOrder=$_.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$g.length));)$_=$g[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$u.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$u.create(),$Z=this.graphics;var $q=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$B,$n);var $P,$k,$m,$D,$T=this._aniSectionDic[this._aniClipIndex],$e=0,$I=0,$A=0,$$=0,$w=0,$r=this._templet.srcBoneMatrixArr.length;for($w=$T[$I=0];$I<$r;$I++)$D=this._boneList[$I],$m=this._templet.srcBoneMatrixArr[$I],$D.resultTransform.scX=$m.scX*this._curOriginalData[$e++],$D.resultTransform.skX=$m.skX+this._curOriginalData[$e++],$D.resultTransform.skY=$m.skY+this._curOriginalData[$e++],$D.resultTransform.scY=$m.scY*this._curOriginalData[$e++],$D.resultTransform.x=$m.x+this._curOriginalData[$e++],$D.resultTransform.y=$m.y+this._curOriginalData[$e++],8===this._templet.tMatrixDataLen&&($D.resultTransform.skewX=$m.skewX+this._curOriginalData[$e++],$D.resultTransform.skewY=$m.skewY+this._curOriginalData[$e++]);var $j,$y={},$C={};for($w+=$T[1];$I<$w;$I++)$y[($j=$q[$I]).name]=this._curOriginalData[$e++],$C[$j.name]=this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++];var $z,$t,$J={},$N={};for($w+=$T[2];$I<$w;$I++)$J[($j=$q[$I]).name]=this._curOriginalData[$e++],$N[$j.name]=this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++];if(this._pathDic)for($w+=$T[3];$I<$w;$I++){if($j=$q[$I],$z=this._pathDic[$j.name])switch(new $vB($j.extenData).getByte()){case 1:$z.position=this._curOriginalData[$e++];break;case 2:$z.spacing=this._curOriginalData[$e++];break;case 3:$z.rotateMix=this._curOriginalData[$e++],$z.translateMix=this._curOriginalData[$e++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($VB.TEMP.identity()),this._ikArr)for($I=0,$w=this._ikArr.length;$I<$w;$I++)$t=this._ikArr[$I],$J.hasOwnProperty($t.name)&&($t.bendDirection=$J[$t.name]),$N.hasOwnProperty($t.name)&&($t.mix=$N[$t.name]),$t.apply();if(this._pathDic)for(var $Q in this._pathDic)($z=this._pathDic[$Q]).apply(this._boneList,$Z);if(this._tfArr)for($I=0,$$=this._tfArr.length;$I<$$;$I++)this._tfArr[$I].apply();for($I=0,$$=this._boneList.length;$I<$$;$I++)if($D=this._boneList[$I],$k=this._bindBoneBoneSlotDic[$D.name],$D.resultMatrix.copyTo(this._boneMatrixArray[$I]),$k)for($A=0,$w=$k.length;$A<$w;$A++)($P=$k[$A])&&$P.setParentMatrix($D.resultMatrix);var $M,$Y,$l,$L,$v={},$V=this._templet.deformAniArr;if($V&&0<$V.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$I=0,$w=this._boneSlotArray.length;$I<$w;$I++)($P=this._boneSlotArray[$I]).deformData=null;var $o,$F=$V[this._aniClipIndex];for($o in $M=$F.default,this._setDeform($M,$v,this._boneSlotArray,$n),$F)"default"!=$o&&$o!=this._skinName&&($M=$F[$o],this._setDeform($M,$v,this._boneSlotArray,$n));$M=$F[this._skinName],this._setDeform($M,$v,this._boneSlotArray,$n)}if(this._drawOrder)for($I=0,$w=this._drawOrder.length;$I<$w;$I++)$Y=$y[($P=this._boneSlotArray[this._drawOrder[$I]]).name],$l=$C[$P.name],isNaN($l)||($Z.save(),$Z.alpha($l)),isNaN($Y)||-2==$Y||(this._templet.attachmentNames?$P.showDisplayByName(this._templet.attachmentNames[$Y]):$P.showDisplayByIndex($Y)),$v[this._drawOrder[$I]]?($L=$v[this._drawOrder[$I]],$P.currDisplayData&&$L[$P.currDisplayData.attachmentName]?$P.deformData=$L[$P.currDisplayData.attachmentName]:$P.deformData=null):$P.deformData=null,isNaN($l)?$P.draw($Z,this._boneMatrixArray,2==this._aniMode):$P.draw($Z,this._boneMatrixArray,2==this._aniMode,$l),isNaN($l)||$Z.restore();else for($I=0,$w=this._boneSlotArray.length;$I<$w;$I++)$Y=$y[($P=this._boneSlotArray[$I]).name],$l=$C[$P.name],isNaN($l)||($Z.save(),$Z.alpha($l)),isNaN($Y)||-2==$Y||(this._templet.attachmentNames?$P.showDisplayByName(this._templet.attachmentNames[$Y]):$P.showDisplayByIndex($Y)),$v[$I]?($L=$v[$I],$P.currDisplayData&&$L[$P.currDisplayData.attachmentName]?$P.deformData=$L[$P.currDisplayData.attachmentName]:$P.deformData=null):$P.deformData=null,isNaN($l)?$P.draw($Z,this._boneMatrixArray,2==this._aniMode):$P.draw($Z,this._boneMatrixArray,2==this._aniMode,$l),isNaN($l)||$Z.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$B,$Z):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$B,$Z)},$B._setDeform=function($B,$_,$Z,$n){if($B){var $g,$q,$P,$k=0,$m=0,$D=0;if($B)for($k=0,$m=$B.deformSlotDataList.length;$k<$m;$k++)for($g=$B.deformSlotDataList[$k],$D=0;$D<$g.deformSlotDisplayList.length;$D++)$P=$Z[($q=$g.deformSlotDisplayList[$D]).slotIndex],$q.apply($n,$P),$_[$q.slotIndex]||($_[$q.slotIndex]={}),$_[$q.slotIndex][$q.attachment]=$q.deformData}},$B.getAnimNum=function(){return this._templet.getAnimationCount()},$B.getAniNameByIndex=function($B){return this._templet.getAniNameByIndex($B)},$B.getSlotByName=function($B){return this._boneSlotDic[$B]},$B.showSkinByName=function($B,$_){void 0===$_&&($_=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($B),$_)},$B.showSkinByIndex=function($B,$_){void 0===$_&&($_=!0);for(var $Z=0;$Z<this._boneSlotArray.length;$Z++)this._boneSlotArray[$Z].showSlotData(null,$_);if(this._templet.showSkinByIndex(this._boneSlotDic,$B,$_)){var $n=this._templet.skinDataArray[$B];this._skinIndex=$B,this._skinName=$n.name}this._clearCache()},$B.showSlotSkinByIndex=function($B,$_){if(0!=this._aniMode){var $Z=this.getSlotByName($B);$Z&&$Z.showDisplayByIndex($_),this._clearCache()}},$B.showSlotSkinByName=function($B,$_){if(0!=this._aniMode){var $Z=this.getSlotByName($B);$Z&&$Z.showDisplayByName($_),this._clearCache()}},$B.replaceSlotSkinName=function($B,$_,$Z){if(0!=this._aniMode){var $n=this.getSlotByName($B);$n&&$n.replaceDisplayByName($_,$Z),this._clearCache()}},$B.replaceSlotSkinByIndex=function($B,$_,$Z){if(0!=this._aniMode){var $n=this.getSlotByName($B);$n&&$n.replaceDisplayByIndex($_,$Z),this._clearCache()}},$B.setSlotSkin=function($B,$_){if(0!=this._aniMode){var $Z=this.getSlotByName($B);$Z&&$Z.replaceSkin($_),this._clearCache()}},$B._clearCache=function(){if(1==this._aniMode)for(var $B=0,$_=this._graphicsCache.length;$B<$_;$B++){for(var $Z=0,$n=this._graphicsCache[$B].length;$Z<$n;$Z++){var $g=this._graphicsCache[$B][$Z];$g!=this.graphics&&$u.recycle($g)}this._graphicsCache[$B].length=0}},$B.play=function($B,$_,$Z,$n,$g,$q){void 0===$Z&&($Z=!0),void 0===$n&&($n=0),void 0===$g&&($g=0),void 0===$q&&($q=!0),this._indexControl=!1;var $P=-1,$k=NaN;if($k=$_?2147483647:0,"string"==typeof $B)for(var $m=0,$D=this._templet.getAnimationCount();$m<$D;$m++){var $T=this._templet.getAnimation($m);if($T&&$B==$T.name){$P=$m;break}}else $P=$B;-1<$P&&$P<this.getAnimNum()&&(this._aniClipIndex=$P,($Z||this._pause||this._currAniIndex!=$P)&&(this._currAniIndex=$P,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($P)),this._drawOrder=null,this._eventIndex=0,this._player.play($P,this._player.playbackRate,$k,$n,$g),$q&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$e.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$B.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$B.playbackRate=function($B){this._player&&(this._player.playbackRate=$B)},$B.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$B.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$e.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$B._getGrahicsDataWithCache=function($B,$_){return this._graphicsCache[$B][$_]},$B._setGrahicsDataWithCache=function($B,$_,$Z){this._graphicsCache[$B][$_]=$Z},$B.destroy=function($B){void 0===$B&&($B=!0),$_.prototype.destroy.call(this,$B),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$q(0,$B,"url",function(){return this._aniPath},function($B){this.load($B)}),$q(0,$B,"index",function(){return this._index},function($B){this.player&&(this._index=$B,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$q(0,$B,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$q(0,$B,"templet",function(){return this._templet}),$q(0,$B,"player",function(){return this._player}),$Z.useSimpleMeshInCanvas=!1,$Z}($qB),$l=function($_){function $g(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$g.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$n($g,"laya.ani.bone.Templet",$_);var $B=$g.prototype;return $B.getLoadList=function(){return this._loadList},$B.loadAni=function($B){this._skBufferUrl=$B,$gB.loader.load($B,$m.create(this,this.onComplete),null,"arraybuffer")},$B.onComplete=function($B){if(this._isDestroyed)this.destroy();else{var $_=$D.getRes(this._skBufferUrl);$_?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$_)):this.event("error","load failed:"+this._skBufferUrl)}},$B.parseData=function($B,$_,$Z){void 0===$Z&&($Z=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$B,this._mainTexture&&$r.isWebGL&&$B.bitmap&&($B.bitmap.enableMerageInAtlas=!1),this._rate=$Z,this.parse($_)},$B.buildArmature=function($B){return void 0===$B&&($B=0),new $Y(this,$B)},$B.parse=function($B){$_.prototype.parse.call(this,$B),this._endLoaded(),this._aniVersion!=$g.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$g.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$B._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $B=0;this._loadList=[];var $_,$Z=new $vB(this.getPublicExtData()),$n=0,$g=0,$q=0,$P=$Z.getInt32(),$k=$Z.readUTFString(),$m=$k.split("\n");for($B=0;$B<$P;$B++)$_=this._path+$m[2*$B],$k=$m[2*$B+1],$Z.getFloat32(),$Z.getFloat32(),$n=$Z.getFloat32(),$g=$Z.getFloat32(),$q=$Z.getFloat32(),isNaN($q)?0:$q,$q=$Z.getFloat32(),isNaN($q)?0:$q,$q=$Z.getFloat32(),isNaN($q)?$n:$q,$q=$Z.getFloat32(),isNaN($q)?$g:$q,-1==this._loadList.indexOf($_)&&this._loadList.push($_);this.event("inited",this)}},$B._textureComplete=function(){for(var $B,$_,$Z=0,$n=this._loadList.length;$Z<$n;$Z++)$_=this._loadList[$Z],$B=this._textureDic[$_]=$D.getRes($_),$r.isWebGL&&$B&&$B.bitmap&&($B.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$B._parsePublicExtData=function(){var $B=0,$_=0,$Z=0,$n=0,$g=0;for($B=0,$g=this.getAnimationCount();$B<$g;$B++)this._graphicsCache.push([]);var $q;$q="Dragon"!=this._aniClassName;var $P,$k,$m=new $vB(this.getPublicExtData()),$D=0,$T=0,$e=0,$I=0,$A=0,$$=0,$w=0,$r=0,$j=0,$y=$m.getInt32(),$C=$m.readUTFString(),$z=$C.split("\n");for($B=0;$B<$y;$B++){if($P=this._mainTexture,$k=this._path+$z[2*$B],$C=$z[2*$B+1],null==this._mainTexture&&($P=this._textureDic[$k]),!$P)return this.event("error",this),void(this.isParseFail=!0);$D=$m.getFloat32(),$T=$m.getFloat32(),$e=$m.getFloat32(),$I=$m.getFloat32(),$j=$m.getFloat32(),$A=isNaN($j)?0:$j,$j=$m.getFloat32(),$$=isNaN($j)?0:$j,$j=$m.getFloat32(),$w=isNaN($j)?$e:$j,$j=$m.getFloat32(),$r=isNaN($j)?$I:$j,this.subTextureDic[$C]=$oB.create($P,$D,$T,$e,$I,-$A,-$$,$w,$r),$P.alphaTexture&&(this.subTextureDic[$C].alphaTexture=$oB.create($P.alphaTexture,$D,$T,$e,$I,-$A,-$$,$w,$r))}this._mainTexture=$P;var $t,$J,$N,$Q,$M,$Y=$m.getUint16();for($B=0;$B<$Y;$B++)($t=[]).push($m.getUint16()),$t.push($m.getUint16()),$t.push($m.getUint16()),$t.push($m.getUint16()),this.aniSectionDic[$B]=$t;var $l,$L=$m.getInt16(),$v={};for($B=0;$B<$L;$B++)$J=new $FB,0==$B?$l=$J:$J.root=$l,$J.d=$q?-1:1,$Q=$m.readUTFString(),$M=$m.readUTFString(),$J.length=$m.getFloat32(),1==$m.getByte()&&($J.inheritRotation=!1),1==$m.getByte()&&($J.inheritScale=!1),$J.name=$Q,$M&&(($N=$v[$M])?$N.addChild($J):this.mRootBone=$J),$v[$Q]=$J,this.mBoneArr.push($J);this.tMatrixDataLen=$m.getUint16();var $V,$o,$F=$m.getUint16(),$u=Math.floor($F/this.tMatrixDataLen),$f=this.srcBoneMatrixArr;for($B=0;$B<$u;$B++)($V=new $sB).scX=$m.getFloat32(),$V.skX=$m.getFloat32(),$V.skY=$m.getFloat32(),$V.scY=$m.getFloat32(),$V.x=$m.getFloat32(),$V.y=$m.getFloat32(),8===this.tMatrixDataLen&&($V.skewX=$m.getFloat32(),$V.skewY=$m.getFloat32()),$f.push($V),($J=this.mBoneArr[$B]).transform=$V;var $b,$x=$m.getUint16(),$p=0;for($B=0;$B<$x;$B++){for($o=new $HB,$p=$m.getUint16(),$_=0;$_<$p;$_++)$o.boneNames.push($m.readUTFString()),$o.boneIndexs.push($m.getInt16());$o.name=$m.readUTFString(),$o.targetBoneName=$m.readUTFString(),$o.targetBoneIndex=$m.getInt16(),$o.bendDirection=$m.getFloat32(),$o.mix=$m.getFloat32(),$o.isSpine=$q,this.ikArr.push($o)}var $K,$H=$m.getUint16(),$G=0;for($B=0;$B<$H;$B++){for($b=new $hB,$G=$m.getUint16(),$_=0;$_<$G;$_++)$b.boneIndexs.push($m.getInt16());$b.name=$m.getUTFString(),$b.targetIndex=$m.getInt16(),$b.rotateMix=$m.getFloat32(),$b.translateMix=$m.getFloat32(),$b.scaleMix=$m.getFloat32(),$b.shearMix=$m.getFloat32(),$b.offsetRotation=$m.getFloat32(),$b.offsetX=$m.getFloat32(),$b.offsetY=$m.getFloat32(),$b.offsetScaleX=$m.getFloat32(),$b.offsetScaleY=$m.getFloat32(),$b.offsetShearY=$m.getFloat32(),this.tfArr.push($b)}var $W=$m.getUint16(),$X=0;for($B=0;$B<$W;$B++){for(($K=new $GB).name=$m.readUTFString(),$X=$m.getUint16(),$_=0;$_<$X;$_++)$K.bones.push($m.getInt16());$K.target=$m.readUTFString(),$K.positionMode=$m.readUTFString(),$K.spacingMode=$m.readUTFString(),$K.rotateMode=$m.readUTFString(),$K.offsetRotation=$m.getFloat32(),$K.position=$m.getFloat32(),$K.spacing=$m.getFloat32(),$K.rotateMix=$m.getFloat32(),$K.translateMix=$m.getFloat32(),this.pathArr.push($K)}var $R,$h,$s,$U,$S,$O=0,$d=0,$a=0,$i=NaN,$c=0,$E=$m.getInt16();for($B=0;$B<$E;$B++){var $BB=$m.getUint8(),$_B={};this.deformAniArr.push($_B);for(var $ZB=0;$ZB<$BB;$ZB++)for(($R=new $fB).skinName=$m.getUTFString(),$_B[$R.skinName]=$R,$O=$m.getInt16(),$_=0;$_<$O;$_++)for($h=new $bB,$R.deformSlotDataList.push($h),$d=$m.getInt16(),$Z=0;$Z<$d;$Z++)for($s=new $xB,$h.deformSlotDisplayList.push($s),$s.slotIndex=$m.getInt16(),$s.attachment=$m.getUTFString(),$a=$m.getInt16(),$n=0;$n<$a;$n++)for(1==$m.getByte()?$s.tweenKeyList.push(!0):$s.tweenKeyList.push(!1),$i=$m.getFloat32(),$s.timeList.push($i),$U=[],$s.vectices.push($U),$c=$m.getInt16(),$g=0;$g<$c;$g++)$U.push($m.getFloat32())}var $nB,$gB,$qB=$m.getInt16(),$PB=0,$kB=0;for($B=0;$B<$qB;$B++){for($PB=$m.getInt16(),$S=[],$_=0;$_<$PB;$_++){for(($nB=new $pB).time=$m.getFloat32(),$kB=$m.getInt16(),$Z=0;$Z<$kB;$Z++)$nB.drawOrder.push($m.getInt16());$S.push($nB)}this.drawOrderAniArr.push($S)}var $mB,$DB=$m.getInt16(),$TB=0;for($B=0;$B<$DB;$B++){for($TB=$m.getInt16(),$gB=[],$_=0;$_<$TB;$_++)($mB=new $KB).name=$m.getUTFString(),$mB.intValue=$m.getInt32(),$mB.floatValue=$m.getFloat32(),$mB.stringValue=$m.getUTFString(),$mB.time=$m.getFloat32(),$gB.push($mB);this.eventAniArr.push($gB)}var $eB=$m.getInt16();if(0<$eB)for(this.attachmentNames=[],$B=0;$B<$eB;$B++)this.attachmentNames.push($m.getUTFString());var $IB,$AB,$$B=$m.getInt16();for($B=0;$B<$$B;$B++)($IB=new $uB).name=$m.readUTFString(),$IB.parent=$m.readUTFString(),$IB.attachmentName=$m.readUTFString(),$IB.srcDisplayIndex=$IB.displayIndex=$m.getInt16(),($IB.templet=this).boneSlotDic[$IB.name]=$IB,null==($AB=this.bindBoneBoneSlotDic[$IB.parent])&&(this.bindBoneBoneSlotDic[$IB.parent]=$AB=[]),$AB.push($IB),this.boneSlotArray.push($IB);var $wB,$rB,$jB,$yB=$m.readUTFString().split("\n"),$CB=0,$zB=$m.getUint8(),$tB=0,$JB=0,$NB=0,$QB=0,$MB=0,$YB=0,$lB=0;for($B=0;$B<$zB;$B++){for(($wB=new $WB).name=$yB[$CB++],$tB=$m.getUint8(),$_=0;$_<$tB;$_++){for(($rB=new $RB).name=$yB[$CB++],$IB=this.boneSlotDic[$rB.name],$JB=$m.getUint8(),$Z=0;$Z<$JB;$Z++){if($jB=new $XB,this.skinSlotDisplayDataArr.push($jB),$jB.name=$yB[$CB++],$jB.attachmentName=$yB[$CB++],$jB.transform=new $sB,$jB.transform.scX=$m.getFloat32(),$jB.transform.skX=$m.getFloat32(),$jB.transform.skY=$m.getFloat32(),$jB.transform.scY=$m.getFloat32(),$jB.transform.x=$m.getFloat32(),$jB.transform.y=$m.getFloat32(),$rB.displayArr.push($jB),$jB.width=$m.getFloat32(),$jB.height=$m.getFloat32(),$jB.type=$m.getUint8(),$jB.verLen=$m.getUint16(),0<($L=$m.getUint16()))for($jB.bones=[],$n=0;$n<$L;$n++){var $LB=$m.getUint16();$jB.bones.push($LB)}if(0<($NB=$m.getUint16()))for($jB.uvs=[],$n=0;$n<$NB;$n++)$jB.uvs.push($m.getFloat32());if(0<($QB=$m.getUint16()))for($jB.weights=[],$n=0;$n<$QB;$n++)$jB.weights.push($m.getFloat32());if(0<($MB=$m.getUint16()))for($jB.triangles=[],$n=0;$n<$MB;$n++)$jB.triangles.push($m.getUint16());if(0<($YB=$m.getUint16()))for($jB.vertices=[],$n=0;$n<$YB;$n++)$jB.vertices.push($m.getFloat32());if(0<($lB=$m.getUint16()))for($jB.lengths=[],$n=0;$n<$lB;$n++)$jB.lengths.push($m.getFloat32())}$wB.slotArr.push($rB)}this.skinDic[$wB.name]=$wB,this.skinDataArray.push($wB)}1==$m.getUint8()?(this.yReverseMatrix=new $VB(1,0,0,-1,0,0),$l&&$l.setTempMatrix(this.yReverseMatrix)):$l&&$l.setTempMatrix(new $VB),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$B.getTexture=function($B){var $_=this.subTextureDic[$B];return $_||($_=this.subTextureDic[$B.substr(0,$B.length-1)]),null==$_?this._mainTexture:$_},$B.showSkinByIndex=function($B,$_,$Z){if(void 0===$Z&&($Z=!0),$_<0&&$_>=this.skinDataArray.length)return!1;var $n,$g,$q=0,$P=0,$k=this.skinDataArray[$_];if($k){for($q=0,$P=$k.slotArr.length;$q<$P;$q++)($g=$k.slotArr[$q])&&($n=$B[$g.name])&&($n.showSlotData($g,$Z),$Z&&"undefined"!=$n.attachmentName&&"null"!=$n.attachmentName?$n.showDisplayByName($n.attachmentName):$n.showDisplayByIndex($n.displayIndex));return!0}return!1},$B.getSkinIndexByName=function($B){for(var $_=0,$Z=this.skinDataArray.length;$_<$Z;$_++)if(this.skinDataArray[$_].name==$B)return $_;return-1},$B.getGrahicsDataWithCache=function($B,$_){return this._graphicsCache[$B][$_]},$B.setGrahicsDataWithCache=function($B,$_,$Z){this._graphicsCache[$B][$_]=$Z},$B.destroy=function(){var $B;for(var $_ in this._isDestroyed=!0,this.subTextureDic)($B=this.subTextureDic[$_])&&$B.destroy();for($_ in this._textureDic)($B=this._textureDic[$_])&&$B.destroy();for(var $Z=0,$n=this.skinSlotDisplayDataArr.length;$Z<$n;$Z++)this.skinSlotDisplayDataArr[$Z].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $g.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$B.getAniNameByIndex=function($B){var $_=this.getAnimation($B);return $_?$_.name:null},$q(0,$B,"rate",function(){return this._rate},function($B){this._rate=$B}),$g.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$g.TEMPLET_DICTIONARY=null,$g}($f)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($B,$_){"use strict";for(var $Z in Object.defineProperty($_,"__esModule",{value:!0}),Laya){var $n=Laya[$Z];$n&&$n.__isclass&&($_[$Z]=$n)}});