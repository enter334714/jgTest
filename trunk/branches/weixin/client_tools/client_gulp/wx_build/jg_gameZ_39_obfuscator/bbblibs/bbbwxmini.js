var _=wx.y$;!function(o,a){a.un,a.uns;var e=a.static,l=a.class,n=a.getset;a.__newvec;var u=laya.utils.Browser,i=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,t=laya.display.Input,f=laya.net.Loader;laya.maths.Matrix;var v=laya.renders.Render,h=laya.utils.RunDriver;laya.media.Sound;var y=laya.media.SoundChannel,m=laya.media.SoundManager,p=(laya.display.Stage,laya.net.URL),g=laya.utils.Utils;l(agy4,"laya.wx.mini.MiniAdpter"),agy4.getJson=function(e){return JSON.parse(e)},agy4.init=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),agy4._inited||(agy4.window=o).navigator.userAgent.indexOf("MiniGame")<0||(agy4._inited=!0,agy4.isZiYu=n,agy4.isPosMsgYu=e,agy4.EnvConfig={},agy4.isZiYu||(r.setNativeFileDir("/layaairGame"),r.existDir(r.fileNativeDir,c.create(agy4,agy4.onMkdirCallBack))),agy4.window.focus=function(){},a.getUrlPath=function(){},agy4.window.logtime=function(e){},agy4.window.alertTimeLog=function(e){},agy4.window.resetShareInfo=function(){},agy4.window.CanvasRenderingContext2D=function(){},agy4.window.CanvasRenderingContext2D.prototype=agy4.window.wx.createCanvas().getContext("2d").__proto__,agy4.window.document.body.appendChild=function(){},agy4.EnvConfig.pixelRatioInt=0,h.getPixelRatio=agy4.pixelRatio,agy4._preCreateElement=u.createElement,u.createElement=agy4.createElement,h.createShaderCondition=agy4.createShaderCondition,g.parseXMLFromString=agy4.parseXMLFromString,t._createInputElement=E._createInputElement,agy4.EnvConfig.load=f.prototype.load,f.prototype.load=w.prototype.load,agy4.isZiYu&&e&&wx.onMessage(function(e){e.isLoad&&(r.ziyuFileData[e.url]=e.data)}))},agy4.onMkdirCallBack=function(e,n){e||(r.filesListObj=JSON.parse(n.data))},agy4.pixelRatio=function(){if(!agy4.EnvConfig.pixelRatioInt)try{var e=wx.getSystemInfoSync();return agy4.EnvConfig.pixelRatioInt=e.pixelRatio,e.pixelRatio}catch(e){}return agy4.EnvConfig.pixelRatioInt},agy4.createElement=function(e){return"canvas"!=e?"textarea"==e||"input"==e?agy4.onCreateInput(e):"div"==e?((i=agy4._preCreateElement(e)).contains=function(e){return null},i.removeChild=function(e){},i):agy4._preCreateElement(e):(1==agy4.idx?agy4.isZiYu?(n=sharedCanvas).style={}:n=o.canvas:n=o.wx.createCanvas(),agy4.idx++,n);var n,i},agy4.onCreateInput=function(e){return(e=agy4._preCreateElement(e)).focus=E.wxinputFocus,e.blur=E.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(e){},e.setType=function(e){},e.setFontFace=function(e){},e.addEventListener=function(e){},e.contains=function(e){return null},e.removeChild=function(e){},e},agy4.createShaderCondition=function(e){var n=this;return function(){return n[e.replace("this.","")]}},agy4.EnvConfig=null,agy4.window=null,agy4._preCreateElement=null,agy4._inited=!1,agy4.wxRequest=null,agy4.systemInfo=null,agy4.version="0.0.1",agy4.isZiYu=!1,agy4.isPosMsgYu=!1,agy4.parseXMLFromString=function(e){var n;e=e.replace(/>\s+</g,"><");try{n=(new o.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},agy4.idx=1;var s=agy4;function agy4(){}function vl7nx(){}l(vl7nx,"laya.wx.mini.MiniImage"),vl7nx.prototype._loadImage=function(e){var n=!1;-1==e.indexOf("layaNativeDir/")&&(n=!0,e=p.formatURL(e)),r.getFileInfo(e)?vl7nx.onCreateImage(e,this,!n):-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?r.downImg(e,new c(vl7nx,vl7nx.onDownImgCallBack,[e,this]),e):vl7nx.onCreateImage(e,this,!0)},vl7nx.onDownImgCallBack=function(e,n,i){i?n.onError(null):vl7nx.onCreateImage(e,n)},vl7nx.onCreateImage=function(n,i,e){var t;function pou39a(){t.onload=null,t.onerror=null,delete i.imgCache[n]}function zkecld(){pou39a(),i.onLoaded(t)}function kldzi(){pou39a(),i.event("error","Load image failed")}e=(e=void 0!==e&&e)?n:(e=r.getFileInfo(n).md5,r.getFileNativePath(e)),null==i.imgCache&&(i.imgCache={}),"nativeimage"==i._type?((t=new u.window.Image).crossOrigin="",t.onload=zkecld,t.onerror=kldzi,t.src=e,i.imgCache[n]=t):new d.create(e,{onload:zkecld,onerror:kldzi,onCreate:function(e){t=e,i.imgCache[n]=e}})},l(u4a9,"laya.wx.mini.MiniInput"),u4a9._createInputElement=function(){t._initInput(t.area=u.createElement("textarea")),t._initInput(t.input=u.createElement("input")),t.inputContainer=u.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,u.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(e,n){t.inputContainer.style.left=e+"px",t.inputContainer.style.top=n+"px"},a.stage.on("resize",null,u4a9._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){o.dispatchEvent&&o.dispatchEvent("resize")}),m._soundClass=x,m._musicClass=x,o._videoClass=k},u4a9._onStageResize=function(){a.stage._canvasTransform.identity().scale(u.width/v.canvas.width/h.getPixelRatio(),u.height/v.canvas.height/h.getPixelRatio())},u4a9.wxinputFocus=function(e){var n=t.inputElement.target;n&&!n.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(e){},fail:function(e){}}),s.window.wx.onKeyboardConfirm(function(e){e=e?e.value:"",n.text=e,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(e){e=e?e.value:"",n.multiline||-1==e.indexOf("\n")?(n.text=e,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},u4a9.inputEnter=function(){t.inputElement.target.focus=!1},u4a9.wxinputblur=function(){u4a9.hideKeyboard()},u4a9.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(e){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(e){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(e?e.errMsg:""))}})};var E=u4a9;function u4a9(){}l(gi5rf8,"laya.wx.mini.MiniLoader"),(_=gi5rf8.prototype).load=function(e,n,i,t,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var a=this;0===(a._url=e).indexOf("data:image")?a._type=n="image":a._type=n=n||a.getTypeFromUrl(e),a._cache=i,a._data=null;var l="ascii";-1!=e.indexOf(".fnt")?l="utf8":"arraybuffer"==n&&(l="");var u=g.getFileExtension(e);if(-1!=gi5rf8._fileTypeArr.indexOf(u))s.EnvConfig.load.call(this,e,n,i,t,o);else if(r.getFileInfo(e))s.EnvConfig.load.call(this,e,n,i,t,o);else{if(-1!=e.indexOf("layaNativeDir/"))return s.isZiYu?(u=r.ziyuFileData[e],void a.onLoaded(u)):(cosnole.log("read read"),void r.read(e,l,new c(gi5rf8,gi5rf8.onReadNativeCallBack,[l,e,n,i,t,o,a])));u=""==p.rootPath?e:e.split(p.rootPath)[0],-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?s.EnvConfig.load.call(a,e,n,i,t,o):r.readFile(u,l,new c(gi5rf8,gi5rf8.onReadNativeCallBack,[l,e,n,i,t,o,a]),e)}},_.resMgrLoad=function(e,t,n,i,o,a,l){void 0===n&&(n=0),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===l&&(l=3),-1!=e.indexOf("mpack")&&console.log("=============resMgrLoad url:",e),s.EnvConfig.resMgrLoad(e,(e,n,i)=>{gi5rf8.prototype.resMgrLoadCallBack(e,n,i,t)},n,i,o,a,l)},_.resMgrLoadCallBack=function(e,n,i,t){console.log("buff:::",e,i,r.fileNativeDir+"///"+r.fileListName),t(e,n,i)},_.clearRes=function(e,n){this.clearRes(e,n=void 0!==n&&n),!(n=r.getFileInfo(e))||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(e=n.md5,n=r.getFileNativePath(e),r.remove(n))},gi5rf8.onReadNativeCallBack=function(e,n,i,t,o,a,l,u,r){void 0===t&&(t=!0),void 0===a&&(a=!1),(u=void 0===u?0:u)?1==u&&s.EnvConfig.load.call(l,n,i,t,o,a):(u="json"==i||"atlas"==i?s.getJson(r.data):"xml"==i?g.parseXMLFromString(r.data):r.data,l.onLoaded(u),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:n,data:u,isLoad:!0}))},e(gi5rf8,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]);var w=gi5rf8;function gi5rf8(){}l(lnkvec,"laya.wx.mini.MiniFileMgr",i),lnkvec.isLoadFile=function(e){return-1!=lnkvec._fileTypeArr.indexOf(e)},lnkvec.getFileInfo=function(e){return e=e.split("?")[0],null==(e=lnkvec.filesListObj[e])?null:e},lnkvec.onFileUpdate=function(e,n){e=(e=e.split("/"))[e.length-1];var i=lnkvec.getFileInfo(n);null==i?lnkvec.onSaveFile(n,e):i.readyUrl!=n&&lnkvec.remove(e,n)},lnkvec.exits=function(e,n){e=lnkvec.getFileNativePath(e),lnkvec.fs.getFileInfo({filePath:e,success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){null!=n&&n.runWith([1,e])}})},lnkvec.read=function(e,n,i,t){void 0===n&&(n="ascill"),e=""!=(t=void 0===t?"":t)?lnkvec.getFileNativePath(e):e,lnkvec.fs.readFile({filePath:e,encoding:n,success:function(e){null!=i&&i.runWith([0,e])},fail:function(e){e&&""!=t?lnkvec.down(t,n,i,t):null!=i&&i.runWith([1])}})},lnkvec.readNativeFile=function(e,n){lnkvec.fs.readFile({filePath:e,encoding:"",success:function(e){null!=n&&n.runWith([0])},fail:function(e){null!=n&&n.runWith([1])}})},lnkvec.down=function(e,n,i,t){void 0===n&&(n="ascill"),void 0===t&&(t="");var o=lnkvec.getFileNativePath(t);lnkvec.wxdown({url:e,filePath:o,success:function(e){200===e.statusCode&&lnkvec.readFile(e.filePath,n,i,t)},fail:function(e){null!=i&&i.runWith([1,e])}}).onProgressUpdate(function(e){null!=i&&i.runWith([2,e.progress])})},lnkvec.readFile=function(n,e,i,t){void 0===t&&(t=""),lnkvec.fs.readFile({filePath:n,encoding:e=void 0===e?"ascill":e,success:function(e){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||lnkvec.onFileUpdate(n,t),null!=i&&i.runWith([0,e])},fail:function(e){e&&null!=i&&i.runWith([1,e])}})},lnkvec.downImg=function(e,n,i){void 0===i&&(i=""),lnkvec.wxdown({url:e,success:function(e){200===e.statusCode&&lnkvec.copyFile(e.tempFilePath,i,n)},fail:function(e){null!=n&&n.runWith([1,e])}})},lnkvec.copyFile=function(e,n,i){var t=e.split("/"),o=t[t.length-1];n.split("?")[0];var a=lnkvec.getFileInfo(n);t=lnkvec.getFileNativePath(o),lnkvec.fs.copyFile({srcPath:e,destPath:t,success:function(e){a?a.readyUrl!=n&&lnkvec.remove(o,n,i):(lnkvec.onSaveFile(n,o),null!=i&&i.runWith([0]))},fail:function(e){null!=i&&i.runWith([1,e])}})},lnkvec.getFileNativePath=function(e){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},lnkvec.remove=function(n,i,t){void 0===i&&(i="");var e=lnkvec.getFileInfo(i),o=lnkvec.getFileNativePath(e.md5);a.loader.clearRes(e.readyUrl),lnkvec.fs.unlink({filePath:o,success:function(e){""!=i&&lnkvec.onSaveFile(i,n),null!=t&&t.runWith([0])},fail:function(e){}})},lnkvec.onSaveFile=function(e,n){var i=e.split("?")[0];lnkvec.filesListObj[i]={md5:n,readyUrl:e},lnkvec.fs.writeFile({filePath:lnkvec.fileNativeDir+"/"+lnkvec.fileListName,encoding:"utf8",data:JSON.stringify(lnkvec.filesListObj),success:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",e)},fail:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",e)}})},lnkvec.existDir=function(e,n){lnkvec.fs.mkdir({dirPath:e,success:function(e){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?lnkvec.readSync(lnkvec.fileListName,"utf8",n):null!=n&&n.runWith([1,e])}})},lnkvec.readSync=function(e,n,i,t){var o;void 0===n&&(n="ascill"),void 0===t&&(t=""),n=lnkvec.getFileNativePath(e);try{o=lnkvec.fs.readFileSync(n),null!=i&&i.runWith([0,{data:o}])}catch(e){null!=i&&i.runWith([1])}},lnkvec.readCache=function(){},lnkvec.writeCache=function(e){var n=readyUrl.split("?")[0];lnkvec.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},lnkvec.fs.writeFile({filePath:lnkvec.fileNativeDir+"/"+lnkvec.fileListName,encoding:"utf8",data:JSON.stringify(lnkvec.filesListObj),success:function(e){},fail:function(e){}})},lnkvec.setNativeFileDir=function(e){lnkvec.fileNativeDir=wx.env.USER_DATA_PATH+e},lnkvec.filesListObj={},lnkvec.fileNativeDir=null,lnkvec.fileListName="layaairfiles.txt",lnkvec.ziyuFileData={},e(lnkvec,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]);var r=lnkvec;function lnkvec(){lnkvec.__super.call(this)}l(y3u49a,"laya.wx.mini.MiniSound",i),(_=y3u49a.prototype).load=function(e){var n;e=p.formatURL(e),this.url=e,y3u49a._audioCache[e]?this.event("complete"):(this._sound.onCanplay(function(){n.loaded=!0,n.event("complete"),y3u49a._audioCache[n.url]=n}),this._sound.onError(function(e){console.error("errCode="+e.errCode+"  errMsg="+e.errMsg),n.event("error")}),this._sound.src=e,n=this)},_.play=function(e,n){var i,t;return void 0===e&&(e=0),void 0===n&&(n=0),i=this.url==m._tMusic?(y3u49a._musicAudio||(y3u49a._musicAudio=this._sound),y3u49a._musicAudio):this._sound,t=this._chanell,i.src=this.url,i.startTime=0,t.isStopped&&(t.url=this.url,t.loops=n,t.startTime=e,t.play(),m.addChannel(t)),t},_.dispose=function(){var e=y3u49a._audioCache[this.url];e&&(e.src="",delete y3u49a._audioCache[this.url])},n(0,_,"duration",function(){return this._sound.duration}),y3u49a._createSound=function(){return y3u49a._id++,s.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},y3u49a._musicAudio=null,y3u49a._id=0,y3u49a._audioCache={},y3u49a._null=void 0;var x=y3u49a;function y3u49a(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,y3u49a.__super.call(this),this._sound=y3u49a._createSound(),this._chanell=new C(this._sound)}var _;l(y943,"laya.wx.mini.MiniSoundChannel",y),(e=y943.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.__onNull=function(){},e.play=function(){this.isStopped=!1,m.addChannel(this),this._audio&&this._audio.play()},e.stop=function(){this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},n(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),n(0,e,"duration",function(){return this._audio?this._audio.duration:0}),n(0,e,"volume",function(){return 1},function(e){}),y943._null=void 0;var C=y943;function y943(e){this._audio=null,this._onEnd=null,y943.__super.call(this),this.isStopped=!0,this._audio=e,this._onEnd=g.bind(this.__onEnd,this),e.onEnded(this._onEnd)}l(nxlve,"laya.wx.mini.MiniVideo"),(i=nxlve.prototype).on=function(e,n,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(n),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(n),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},i.onTimeUpdateFunc=function(e){this.position=e.position,this._duration=e.duration},i.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},i.onended=function(e,n){this.onEndedFunC=n.bind(e),this.videoElement.onended=this.onEndedFunction.bind(this)},i.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},i.off=function(e,n,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(n),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(n),this.videoElement.offEnded=this.onEndedFunction.bind(this))},i.load=function(e){this.videoElement&&(this.videoElement.src=e)},i.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},i.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},i.size=function(e,n){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=n)},i.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},i.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},n(0,i,"duration",function(){return this._duration}),n(0,i,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(e){this.videoElement&&(this.videoElement.initialTime=e)}),n(0,i,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),n(0,i,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),n(0,i,"ended",function(){return this.videoend}),n(0,i,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(e){this.videoElement&&(this.videoElement.loop=e)}),n(0,i,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(e){this.videoElement&&(this.videoElement.playbackRate=e)}),n(0,i,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(e){this.videoElement&&(this.videoElement.muted=e)}),n(0,i,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),n(0,i,"x",function(){return this.videoElement?this.videoElement.x:0},function(e){this.videoElement&&(this.videoElement.x=e)}),n(0,i,"y",function(){return this.videoElement?this.videoElement.y:0},function(e){this.videoElement&&(this.videoElement.y=e)}),n(0,i,"currentSrc",function(){return this.videoElement.src}),n(0,i,"src",function(){return this.videoElement?this.videoElement.src:0},function(e){this.videoElement&&(this.videoElement.src=e)}),n(0,i,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(e){this.videoElement&&(this.videoElement.controls=e)}),n(0,i,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(e){this.videoElement&&(this.videoElement.autoplay=e)});var k=nxlve;function nxlve(){this.videoend=!1,this.videourl="",this.videoElement=s.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,n){"use strict";for(var i in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var t=Laya[i];t&&t.__isclass&&(n[i]=t)}});