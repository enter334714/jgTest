var _=wx.y$;import{setRoleInfo,init,getOpenId,userLogin,checkPay,payRequest,payMoney}from"../utils/currency";var config={game_id:256,game_pkg:_[30894],partner_label:_[30895],partner_id:_[30896],game_ver:_[30897],is_auth:!1};window.config=config;var partner_config={appId:2036,channel_id:194,env:1};var p$JGXR8=p$JX8RG();var HOST=_[30898];var p$JGX8R=null;var p$JXR8G=null;var sysInfo=wx.getSystemInfoSync();var platform=sysInfo.platform;var partner_user_info=null;function p$JX8RG(){var o={};return{order_data:{},init:function(e,n){e=e&&e.game_ver?e.game_ver:0;console.log(_[30899]);var t=this;var r;r=wx.getStorageSync(_[30900])?0:(r=t.uuid(16,32),wx.setStorageSync(_[30900],r),1),wx.getStorageSync(_[30901])||(o=t.uuid(16,32),wx.setStorageSync(_[30901],o));var o=wx.getLaunchOptionsSync();var a=o.scene||"";wx.showShareMenu(),r&&o.query&&o.query.ad_code&&wx.setStorageSync(_[30902],o.query.ad_code),t.log(_[282],{install:r,scene:a});t=o.query&&o.query.invite?o.query.invite:"";o=o.query&&o.query.invite_type?o.query.invite_type:"";t&&(p$JXR8G={invite:t,invite_type:o,is_new:r,scene:a}),e&&this.checkGameVersion(e,function(e){n&&n(e)})},login:function(e,n){console.log(_[30903]),o[_[30493]]=typeof n==_[29936]?n:null;n={channel_id:partner_config.channel_id,imei:wx.getStorageSync(_[30904])||"",appId:partner_config.appId,mobile:"",device:wx.getStorageSync(_[30905])||""};init(n).then(e=>{e=e.data;console.log(_[30906],JSON.stringify(e)),0==e.status?(wx.setStorageSync(_[30904],e.data.imei),wx.setStorageSync(_[30905],e.data.device),wx.getStorageSync(_[30907])?this.partner_login():getOpenId(partner_config.appId).then(e=>{e=e.data;0==e.status?(console.log(_[30908]),wx.setStorageSync(_[30907],e.data.openid),wx.setStorageSync(_[30909],e.data.session_key),this.partner_login()):console.log(_[30910])})):console.log(_[30911],JSON.stringify(err))})},partner_login:function(){userLogin({channel_id:partner_config.channel_id,appId:partner_config.appId}).then(e=>{console.log(_[30912],JSON.stringify(e));e=e.data;0==e.Code?(wx.setStorageSync(_[19503],e.UserId),this.do_login({UserId:e.UserId,token:wx.getStorageSync(_[30909])})):(console.log(_[30913]),o[_[30493]]&&o[_[30493]](1,{errMsg:e.Message}))})},do_login:function(t){var r=this;var e=r.getPublicData();if(e[_[30914]]=JSON.stringify(t),p$JXR8G&&typeof p$JXR8G==_[277])for(var n in p$JXR8G)e[n]=p$JXR8G[n];wx.request({url:_[26267]+HOST+_[30915],method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:e,success:function(e){if(console.log(_[30916]+JSON.stringify(e)),200==e.statusCode){e=e.data;if(e.state){try{wx.setStorageSync(_[30917],e.data.sdk_token),wx.setStorageSync(_[30918],e.data.user_id),wx.setStorageSync(_[30919],e.data.username),e.data.ext&&wx.setStorageSync(_[30920],e.data.ext)}catch(e){}var n={userid:e.data.user_id,account:e.data.nick_name,token:e.data.token,invite_uid:e.data.invite_uid||"",invite_nickname:e.data.invite_nickname||"",invite_head_img:e.data.invite_head_img||"",head_img:e.data.head_img||"",is_client:e.data.is_client||"0",ios_pay:e.data.ios_pay||"0",isBindPhone:t.isBindPhone};o[_[30493]]&&o[_[30493]](0,n)}else o[_[30493]]&&o[_[30493]](1,{errMsg:e.msg});r.getShareInfo(_[30921],function(e){console.log(_[30922]),r.logStartShare(_[30921]),wx.onShareAppMessage(function(){return r.logStartShare(_[30921]),{title:e.title,imageUrl:e.img,query:e.query}})})}else o[_[30493]]&&o[_[30493]](1,{errMsg:_[30923]})}})},share:function(e){o[_[30581]]=typeof callback==_[29936]?callback:null;var n=e.type||_[30581];console.log(_[30924]+n);var t=this;this.getShareInfo(n,function(e){t.logStartShare(n),wx.shareAppMessage({title:e.title,imageUrl:e.img,query:e.query})})},logStartShare:function(e){var n=wx.getStorageSync(_[30917]);wx.request({url:_[26267]+HOST+_[30925],method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:n,server_id:p$JGX8R?p$JGX8R.server_id:"",role_id:p$JGX8R?p$JGX8R.role_id:"",type:e},success:function(e){}})},openService:function(){wx.openCustomerServiceConversation()},checkGameVersion:function(e,t){console.log(_[30926]);wx.getStorageSync(_[30917]);wx.request({url:_[26267]+HOST+_[30927],method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:e},success:function(e){var n;console.log(_[30928]+JSON.stringify(e)),200==e.statusCode&&(n=e.data).state?t&&t(n.data):t&&t({develop:0})}})},getShareInfo:function(e,n){console.log(_[30929]);var t=wx.getStorageSync(_[30917]);wx.request({url:_[26267]+HOST+_[30930],method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:t,type:e,server_id:p$JGX8R?p$JGX8R.server_id:"",role_id:p$JGX8R?p$JGX8R.role_id:"",no_log:1},success:function(e){console.log(_[30931]),console.log(e),200==e.statusCode?(e=e.data).state?n&&n(e.data):o[_[30581]]&&o[_[30581]](1,{errMsg:_[30932]+e.msg}):o[_[30581]]&&o[_[30581]](1,{errMsg:_[30933]})}})},updateShare:function(e,n,t,r,o,a){console.log(_[30934]);var i=wx.getStorageSync(_[30917]);wx.request({url:_[26267]+HOST+_[30935],method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:i,invite:e,invite_type:n,is_new:t,role_id:r,sever_id:o,scene:a},success:function(e){console.log(_[30936]+JSON.stringify(e))}})},msgCheck:function(e,t){console.log(_[30937]+e),wx.request({url:_[26267]+HOST+_[30938]+config.partner_id+"/"+config.game_pkg,method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:{content:e,openid:wx.getStorageSync(_[30907])},success:function(e){console.log(_[30939]+JSON.stringify(e));let n={data:{}};1==e.data.code?(n.statusCode=200,n.data.state=1):(n.statusCode=0,n.data.state=0),t&&t(n)}})},pay:function(e,n){this.startPay(e,n)},startPay:function(e,n){console.log(_[30940]+JSON.stringify(e));var t=this;o[_[30564]]=typeof n==_[29936]?n:null;n=wx.getStorageSync(_[30917]);var r=wx.getStorageSync(_[30920]);n?(e={cpbill:e.cpbill,productid:e.productid,productname:e.productname,productdesc:e.productdesc,serverid:e.serverid,servername:e.servername,roleid:e.roleid,rolename:e.rolename,rolelevel:e.rolelevel,price:e.price,extension:e.extension,sdk_token:n,session_key:r,platform:platform},t.order_data=e,(n=t.getPublicData())[_[30942]]=JSON.stringify(e),wx.request({url:_[26267]+HOST+_[30943],method:_[30465],dataType:_[6065],header:{"content-type":_[30613]},data:n,success:function(e){if(console.log(_[30944]+JSON.stringify(e)),200==e.statusCode){e=e.data;if(e.state)if(console.log(_[30945]+JSON.stringify(e.data.pay_data)),""==e.data.ext){let n=e.data.pay_data;n[_[30946]]=partner_config.appId,n[_[30947]]=partner_config.channel_id,n[_[30948]]=wx.getStorageSync(_[19503]),checkPay({total_fee:n.Amount,app:partner_config.appId,channel:partner_config.channel_id,role_id:n.role_id,zone_id:n.zone_id,platform:platform}).then(e=>{n[_[30949]]=e.data.Code,n[_[30950]]=e.data.url,payRequest(n).then(e=>{console.log(_[30951],JSON.stringify(n),JSON.stringify(e)),0==e.data.Code?payMoney({order_id:e.data.OrderId,amount:n.amount,offerId:e.data.Ext.offerId,buyQuantity:e.data.Ext.buyQuantity,env:partner_config.env,platform:platform,appId:partner_config.appId,channel_id:partner_config.channel_id}).then(e=>{console.log(_[30952],JSON.stringify(e))}).catch(e=>{console.log(e)}):o[_[30564]]&&o[_[30564]](1,{errMsg:e.data.Message})})})}else t.extDo({ext1:e.data.ext,ext2:e.data.pay_data});else o[_[30564]]&&o[_[30564]](1,{errMsg:e.msg})}else o[_[30493]]&&o[_[30493]](1,{errMsg:_[30923]})}})):o[_[30564]]&&o[_[30564]](1,{errMsg:_[30941]})},extDo:function(e){wx.navigateToMiniProgram({appId:e.ext1,path:_[30953]+e.ext2.cp_trade_sn+_[30954]+e.ext2.total_charge/100,extraData:{},envVersion:_[30955],success(e){}})},logCreateRole:function(e){var n=wx.getStorageSync(_[30918]);var t=wx.getStorageSync(_[30919]);var r={};r[_[30956]]=n,r[_[30957]]=t,r[_[11136]]=e.roleid,r[_[30958]]=e.rolelevel,r[_[30959]]=e.rolename,r[_[11813]]=e.serverid,e.roleid&&e.serverid&&(p$JGX8R={role_id:e.roleid,server_id:e.serverid}),this.log(_[6],r),setRoleInfo({appId:partner_config.appId,zone_id:e.serverid,zone_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,vip:"0",party_name:"",left_coin:"",is_role_create:1})},logEnterGame:function(e){var n=wx.getStorageSync(_[30918]);var t=wx.getStorageSync(_[30919]);var r={};r[_[30956]]=n,r[_[30957]]=t,r[_[11136]]=e.roleid,r[_[30958]]=e.rolelevel,r[_[30959]]=e.rolename,r[_[11813]]=e.serverid,e.roleid&&e.serverid&&(p$JGX8R={role_id:e.roleid,server_id:e.serverid}),this.log(_[5947],r),p$JXR8G&&this.updateShare(p$JXR8G.invite,p$JXR8G.invite_type,p$JXR8G.is_new,e.roleid,e.serverid,p$JXR8G.scene),setRoleInfo({appId:partner_config.appId,zone_id:e.serverid,zone_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,vip:"0",party_name:"",left_coin:"",is_role_create:0})},logRoleUpLevel:function(e){var n=wx.getStorageSync(_[30918]);var t=wx.getStorageSync(_[30919]);var r={};r[_[30956]]=n,r[_[30957]]=t,r[_[11136]]=e.roleid,r[_[30958]]=e.rolelevel,r[_[30959]]=e.rolename,r[_[11813]]=e.serverid,e.roleid&&e.serverid&&(p$JGX8R={role_id:e.roleid,server_id:e.serverid}),this.log(_[30960],r),setRoleInfo({appId:partner_config.appId,zone_id:e.serverid,zone_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,vip:"0",party_name:"",left_coin:"",is_role_create:0})},uuid:function(e,n){var t=_[30961].split("");var r,o=[];var a;if(e=e||t.length,n)for(r=0;r<n;r++)o[r]=t[0|Math.random()*e];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(a=0|16*Math.random(),o[r]=t[19==r?3&a|8:a]);return o.join("")},getPublicData:function(){var e=wx.getStorageSync(_[30900]);var n=wx.getStorageSync(_[30901]);var t=wx.getStorageSync(_[30902]);return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,partner_label:config.partner_label,ad_code:t,uuid:e,idfv:n,mac:_[30962],is_from_min:1,dname:sysInfo.model,net_type:0==sysInfo.wifiSignal?"4G":_[30963],os_ver:sysInfo.system,sdk_ver:sysInfo.version,game_ver:config.game_ver,device:sysInfo.platform==_[30382]?1:2}},log:function(e,n){var t=this.getPublicData();for(var r in n)t[r]=n[r];console.log(_[30964]+e),console.log(t),wx.request({url:_[26267]+HOST+_[30965]+e+_[30966]+encodeURIComponent(JSON.stringify(t))})},getDate:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},downloadClient:function(){wx.openCustomerServiceConversation()},weiduanHelper:function(){},sendUrl:function(){},setMessageToFriendQuery:function(e,n){e=e.activity_id;n(wx.setMessageToFriendQuery({shareMessageToFriendScene:e}))},setLoadingCmp:function(){},sendCode:function(e,n){console.log(_[30967],e.phone)},bindPhone:function(e,n){console.log(_[30968],e.phone,e.code)},subscribeMessage:function(e,n){console.log(_[30969]+e),o[_[30589]]=typeof n==_[29936]?n:null,wx.requestSubscribeMessage({tmplIds:e,success(e){console.log(_[30970]),console.log(e),o[_[30589]]&&o[_[30589]](e)},fail(e){console.log(_[30971]),console.log(e),o[_[30589]]&&o[_[30589]](e)}})}}}function run(e,n,t){e in p$JGXR8&&p$JGXR8[e](n,t)}exports.init=function(e,n){run(_[363],e,n)},exports.login=function(e){run(_[30493],"",e)},exports.login=function(e){run(_[30493],"",e)},exports.pay=function(e,n){run(_[30564],e,n)},exports.openService=function(){run(_[24342])},exports.logCreateRole=function(e,n,t,r,o){run(_[30576],{serverid:e,servername:n,roleid:t,rolename:r,rolelevel:o})},exports.logEnterGame=function(e,n,t,r,o){run(_[30578],{serverid:e,servername:n,roleid:t,rolename:r,rolelevel:o})},exports.logRoleUpLevel=function(e,n,t,r,o){run(_[30580],{serverid:e,servername:n,roleid:t,rolename:r,rolelevel:o})},exports.share=function(e){run(_[30581],{type:e})},exports.msgCheck=function(e,n){run(_[12518],e,n)},exports.downloadClient=function(){run(_[30972])},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run(_[30973])},exports.weiduanHelper=function(){run(_[24232])},exports.sendUrl=function(){run(_[30974])},exports.setMessageToFriendQuery=function(e,n){run(_[30975],e,n)},exports.setLoadingCmp=function(){run(_[30976])},exports.sendCode=function(e,n){run(_[30977],e,n)},exports.bindPhone=function(e,n){run(_[11943],e,n)},exports.subscribeMessage=function(e,n){run(_[30589],e,n)};