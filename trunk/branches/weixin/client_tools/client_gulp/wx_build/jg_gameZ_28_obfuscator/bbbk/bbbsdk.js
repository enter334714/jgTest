var _=wx.y$;import{setRoleInfo,init,getOpenId,userLogin,checkPay,payRequest,payMoney}from"../utils/currency";var config={game_id:256,game_pkg:_[0],partner_label:_[1],partner_id:_[2],game_ver:_[3],is_auth:!1};window.config=config;var partner_config={appId:2036,channel_id:194,env:1};var p$UPJHV=p$UJVHP();var HOST=_[4];var p$UPJVH=null;var p$UJHVP=null;var sysInfo=wx.getSystemInfoSync();var platform=sysInfo.platform;var partner_user_info=null;function p$UJVHP(){var o={};return{order_data:{},init:function(e,n){e=e&&e.game_ver?e.game_ver:0;console.log(_[5]);var t=this;var r;r=wx.getStorageSync(_[6])?0:(r=t.uuid(16,32),wx.setStorageSync(_[6],r),1),wx.getStorageSync(_[7])||(o=t.uuid(16,32),wx.setStorageSync(_[7],o));var o=wx.getLaunchOptionsSync();var a=o.scene||"";wx.showShareMenu(),r&&o.query&&o.query.ad_code&&wx.setStorageSync(_[8],o.query.ad_code),t.log(_[9],{install:r,scene:a});t=o.query&&o.query.invite?o.query.invite:"";o=o.query&&o.query.invite_type?o.query.invite_type:"";t&&(p$UJHVP={invite:t,invite_type:o,is_new:r,scene:a}),e&&this.checkGameVersion(e,function(e){n&&n(e)})},login:function(e,n){console.log(_[10]),o[_[11]]=typeof n==_[12]?n:null;wx.getStorageSync(_[13])?this.partner_login():getOpenId(partner_config.appId).then(e=>{e=e.data;0==e.status?(console.log(_[14]),wx.setStorageSync(_[13],e.data.openid),wx.setStorageSync(_[15],e.data.session_key),this.partner_login()):console.log(_[16])})},partner_login:function(){var e={channel_id:partner_config.channel_id,imei:wx.getStorageSync(_[17])||"",appId:partner_config.appId,mobile:"",device:wx.getStorageSync(_[18])||""};init(e).then(e=>{e=e.data;console.log(_[19],JSON.stringify(e)),0==e.status?(wx.setStorageSync(_[17],e.data.imei),wx.setStorageSync(_[18],e.data.device),userLogin({channel_id:partner_config.channel_id,appId:partner_config.appId}).then(e=>{console.log(_[20],JSON.stringify(e));e=e.data;0==e.Code?(wx.setStorageSync(_[21],e.UserId),this.do_login({UserId:e.UserId,token:wx.getStorageSync(_[15])})):(console.log(_[22]),o[_[11]]&&o[_[11]](1,{errMsg:e.Message}))})):console.log(_[23],JSON.stringify(err))})},do_login:function(t){var r=this;var e=r.getPublicData();if(e[_[24]]=JSON.stringify(t),p$UJHVP&&typeof p$UJHVP==_[25])for(var n in p$UJHVP)e[n]=p$UJHVP[n];wx.request({url:_[26]+HOST+_[27],method:_[28],dataType:_[29],header:{"content-type":_[30]},data:e,success:function(e){if(console.log(_[31]+JSON.stringify(e)),200==e.statusCode){e=e.data;if(e.state){try{wx.setStorageSync(_[32],e.data.sdk_token),wx.setStorageSync(_[33],e.data.user_id),wx.setStorageSync(_[34],e.data.username),e.data.ext&&wx.setStorageSync(_[35],e.data.ext)}catch(e){}var n={userid:e.data.user_id,account:e.data.nick_name,token:e.data.token,invite_uid:e.data.invite_uid||"",invite_nickname:e.data.invite_nickname||"",invite_head_img:e.data.invite_head_img||"",head_img:e.data.head_img||"",is_client:e.data.is_client||"0",ios_pay:e.data.ios_pay||"0",isBindPhone:t.isBindPhone};o[_[11]]&&o[_[11]](0,n)}else o[_[11]]&&o[_[11]](1,{errMsg:e.msg});r.getShareInfo(_[36],function(e){console.log(_[37]),r.logStartShare(_[36]),wx.onShareAppMessage(function(){return r.logStartShare(_[36]),{title:e.title,imageUrl:e.img,query:e.query}})})}else o[_[11]]&&o[_[11]](1,{errMsg:_[38]})}})},share:function(e){o[_[39]]=typeof callback==_[12]?callback:null;var n=e.type||_[39];console.log(_[40]+n);var t=this;this.getShareInfo(n,function(e){t.logStartShare(n),wx.shareAppMessage({title:e.title,imageUrl:e.img,query:e.query})})},logStartShare:function(e){var n=wx.getStorageSync(_[32]);wx.request({url:_[26]+HOST+_[41],method:_[28],dataType:_[29],header:{"content-type":_[30]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:n,server_id:p$UPJVH?p$UPJVH.server_id:"",role_id:p$UPJVH?p$UPJVH.role_id:"",type:e},success:function(e){}})},openService:function(){wx.openCustomerServiceConversation()},checkGameVersion:function(e,t){console.log(_[42]);wx.getStorageSync(_[32]);wx.request({url:_[26]+HOST+_[43],method:_[28],dataType:_[29],header:{"content-type":_[30]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:e},success:function(e){var n;console.log(_[44]+JSON.stringify(e)),200==e.statusCode&&(n=e.data).state?t&&t(n.data):t&&t({develop:0})}})},getShareInfo:function(e,n){console.log(_[45]);var t=wx.getStorageSync(_[32]);wx.request({url:_[26]+HOST+_[46],method:_[28],dataType:_[29],header:{"content-type":_[30]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:t,type:e,server_id:p$UPJVH?p$UPJVH.server_id:"",role_id:p$UPJVH?p$UPJVH.role_id:"",no_log:1},success:function(e){console.log(_[47]),console.log(e),200==e.statusCode?(e=e.data).state?n&&n(e.data):o[_[39]]&&o[_[39]](1,{errMsg:_[48]+e.msg}):o[_[39]]&&o[_[39]](1,{errMsg:_[49]})}})},updateShare:function(e,n,t,r,o,a){console.log(_[50]);var i=wx.getStorageSync(_[32]);wx.request({url:_[26]+HOST+_[51],method:_[28],dataType:_[29],header:{"content-type":_[30]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:i,invite:e,invite_type:n,is_new:t,role_id:r,sever_id:o,scene:a},success:function(e){console.log(_[52]+JSON.stringify(e))}})},msgCheck:function(e,t){console.log(_[53]+e),wx.request({url:_[26]+HOST+_[54]+config.partner_id+"/"+config.game_pkg,method:_[28],dataType:_[29],header:{"content-type":_[30]},data:{content:e,openid:wx.getStorageSync(_[13])},success:function(e){console.log(_[55]+JSON.stringify(e));let n={data:{}};1==e.data.code?(n.statusCode=200,n.data.state=1):(n.statusCode=0,n.data.state=0),t&&t(n)}})},pay:function(e,n){this.startPay(e,n)},startPay:function(e,n){console.log(_[56]+JSON.stringify(e));var t=this;o[_[57]]=typeof n==_[12]?n:null;n=wx.getStorageSync(_[32]);var r=wx.getStorageSync(_[35]);n?(e={cpbill:e.cpbill,productid:e.productid,productname:e.productname,productdesc:e.productdesc,serverid:e.serverid,servername:e.servername,roleid:e.roleid,rolename:e.rolename,rolelevel:e.rolelevel,price:e.price,extension:e.extension,sdk_token:n,session_key:r,platform:platform},t.order_data=e,(n=t.getPublicData())[_[59]]=JSON.stringify(e),wx.request({url:_[26]+HOST+_[60],method:_[28],dataType:_[29],header:{"content-type":_[30]},data:n,success:function(n){if(console.log(_[61]+JSON.stringify(n)),200==n.statusCode){n=n.data;if(n.state)if(console.log(_[62]+JSON.stringify(n.data.pay_data)),""==n.data.ext){let e=n.data.pay_data;e[_[63]]=partner_config.appId,e[_[64]]=partner_config.channel_id,e[_[65]]=wx.getStorageSync(_[21]),checkPay({total_fee:e.amount,u9uid:wx.getStorageSync(_[21]),channel:partner_config.channel_id,channel_id:partner_config.channel_id,platform:platform,appId:partner_config.appId,amount:e.amount,productOrderId:e.ProductOrderId,ext:e.ext,appExt:e.appExt,IsSwitchPayChannel:0,role_id:e.role_id,zone_id:e.zone_id,zone_name:e.zone_name,env:0,DeviceId:wx.getStorageSync(_[18])}).then(e=>{console.log(_[66],e)})}else t.extDo({ext1:n.data.ext,ext2:n.data.pay_data});else o[_[57]]&&o[_[57]](1,{errMsg:n.msg})}else o[_[11]]&&o[_[11]](1,{errMsg:_[38]})}})):o[_[57]]&&o[_[57]](1,{errMsg:_[58]})},extDo:function(e){wx.navigateToMiniProgram({appId:e.ext1,path:_[67]+e.ext2.cp_trade_sn+_[68]+e.ext2.total_charge/100,extraData:{},envVersion:_[69],success(e){}})},logCreateRole:function(e){var n=wx.getStorageSync(_[33]);var t=wx.getStorageSync(_[34]);var r={};r[_[70]]=n,r[_[71]]=t,r[_[72]]=e.roleid,r[_[73]]=e.rolelevel,r[_[74]]=e.rolename,r[_[75]]=e.serverid,e.roleid&&e.serverid&&(p$UPJVH={role_id:e.roleid,server_id:e.serverid}),this.log(_[76],r),setRoleInfo({appId:partner_config.appId,zone_id:e.serverid,zone_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,vip:"0",party_name:"",left_coin:"",is_role_create:1})},logEnterGame:function(e){var n=wx.getStorageSync(_[33]);var t=wx.getStorageSync(_[34]);var r={};r[_[70]]=n,r[_[71]]=t,r[_[72]]=e.roleid,r[_[73]]=e.rolelevel,r[_[74]]=e.rolename,r[_[75]]=e.serverid,e.roleid&&e.serverid&&(p$UPJVH={role_id:e.roleid,server_id:e.serverid}),this.log(_[77],r),p$UJHVP&&this.updateShare(p$UJHVP.invite,p$UJHVP.invite_type,p$UJHVP.is_new,e.roleid,e.serverid,p$UJHVP.scene),setRoleInfo({appId:partner_config.appId,zone_id:e.serverid,zone_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,vip:"0",party_name:"",left_coin:"",is_role_create:0})},logRoleUpLevel:function(e){var n=wx.getStorageSync(_[33]);var t=wx.getStorageSync(_[34]);var r={};r[_[70]]=n,r[_[71]]=t,r[_[72]]=e.roleid,r[_[73]]=e.rolelevel,r[_[74]]=e.rolename,r[_[75]]=e.serverid,e.roleid&&e.serverid&&(p$UPJVH={role_id:e.roleid,server_id:e.serverid}),this.log(_[78],r),setRoleInfo({appId:partner_config.appId,zone_id:e.serverid,zone_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,vip:"0",party_name:"",left_coin:"",is_role_create:0})},uuid:function(e,n){var t=_[79].split("");var r,o=[];var a;if(e=e||t.length,n)for(r=0;r<n;r++)o[r]=t[0|Math.random()*e];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(a=0|16*Math.random(),o[r]=t[19==r?3&a|8:a]);return o.join("")},getPublicData:function(){var e=wx.getStorageSync(_[6]);var n=wx.getStorageSync(_[7]);var t=wx.getStorageSync(_[8]);return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,partner_label:config.partner_label,ad_code:t,uuid:e,idfv:n,mac:_[80],is_from_min:1,dname:sysInfo.model,net_type:0==sysInfo.wifiSignal?"4G":_[81],os_ver:sysInfo.system,sdk_ver:sysInfo.version,game_ver:config.game_ver,device:sysInfo.platform==_[82]?1:2}},log:function(e,n){var t=this.getPublicData();for(var r in n)t[r]=n[r];console.log(_[83]+e),console.log(t),wx.request({url:_[26]+HOST+_[84]+e+_[85]+encodeURIComponent(JSON.stringify(t))})},getDate:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},downloadClient:function(){wx.openCustomerServiceConversation()},weiduanHelper:function(){},sendUrl:function(){},setMessageToFriendQuery:function(e,n){e=e.activity_id;n(wx.setMessageToFriendQuery({shareMessageToFriendScene:e}))},setLoadingCmp:function(){},sendCode:function(e,n){console.log(_[86],e.phone)},bindPhone:function(e,n){console.log(_[87],e.phone,e.code)},subscribeMessage:function(e,n){console.log(_[88]+e),o[_[89]]=typeof n==_[12]?n:null,wx.requestSubscribeMessage({tmplIds:e,success(e){console.log(_[90]),console.log(e),o[_[89]]&&o[_[89]](e)},fail(e){console.log(_[91]),console.log(e),o[_[89]]&&o[_[89]](e)}})}}}function run(e,n,t){e in p$UPJHV&&p$UPJHV[e](n,t)}exports.init=function(e,n){run(_[92],e,n)},exports.login=function(e){run(_[11],"",e)},exports.login=function(e){run(_[11],"",e)},exports.pay=function(e,n){run(_[57],e,n)},exports.openService=function(){run(_[93])},exports.logCreateRole=function(e,n,t,r,o){run(_[94],{serverid:e,servername:n,roleid:t,rolename:r,rolelevel:o})},exports.logEnterGame=function(e,n,t,r,o){run(_[95],{serverid:e,servername:n,roleid:t,rolename:r,rolelevel:o})},exports.logRoleUpLevel=function(e,n,t,r,o){run(_[96],{serverid:e,servername:n,roleid:t,rolename:r,rolelevel:o})},exports.share=function(e){run(_[39],{type:e})},exports.msgCheck=function(e,n){run(_[97],e,n)},exports.downloadClient=function(){run(_[98])},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run(_[99])},exports.weiduanHelper=function(){run(_[100])},exports.sendUrl=function(){run(_[101])},exports.setMessageToFriendQuery=function(e,n){run(_[102],e,n)},exports.setLoadingCmp=function(){run(_[103])},exports.sendCode=function(e,n){run(_[104],e,n)},exports.bindPhone=function(e,n){run(_[105],e,n)},exports.subscribeMessage=function(e,n){run(_[89],e,n)};