var S=wx.$J;!function(o,s){s.un,s.uns;var e=s.static,a=s.class,i=s.getset,l=(s.__newvec,laya.utils.Browser),n=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,t=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),y=laya.utils.RunDriver,p=(laya.media.Sound,laya.media.SoundChannel),v=laya.media.SoundManager,m=(laya.display.Stage,laya.net.URL),k=laya.utils.Utils,r=(a(k7o6sy,"laya.wx.mini.MiniAdpter"),k7o6sy.getJson=function(e){return JSON.parse(e)},k7o6sy.init=function(e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),k7o6sy._inited||(k7o6sy.window=o).navigator.userAgent.indexOf("MiniGame")<0||(k7o6sy._inited=!0,k7o6sy.isZiYu=i,k7o6sy.isPosMsgYu=e,k7o6sy.EnvConfig={},k7o6sy.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,c.create(k7o6sy,k7o6sy.onMkdirCallBack))),k7o6sy.window.focus=function(){},s.getUrlPath=function(){},k7o6sy.window.logtime=function(e){},k7o6sy.window.alertTimeLog=function(e){},k7o6sy.window.resetShareInfo=function(){},k7o6sy.window.CanvasRenderingContext2D=function(){},k7o6sy.window.CanvasRenderingContext2D.prototype=k7o6sy.window.wx.createCanvas().getContext("2d").__proto__,k7o6sy.window.document.body.appendChild=function(){},k7o6sy.EnvConfig.pixelRatioInt=0,y.getPixelRatio=k7o6sy.pixelRatio,k7o6sy._preCreateElement=l.createElement,l.createElement=k7o6sy.createElement,y.createShaderCondition=k7o6sy.createShaderCondition,k.parseXMLFromString=k7o6sy.parseXMLFromString,t._createInputElement=g._createInputElement,k7o6sy.EnvConfig.load=f.prototype.load,f.prototype.load=E.prototype.load,k7o6sy.isZiYu&&e&&wx.onMessage(function(e){e.isLoad&&(u.ziyuFileData[e.url]=e.data)}))},k7o6sy.onMkdirCallBack=function(e,i){e||(u.filesListObj=JSON.parse(i.data))},k7o6sy.pixelRatio=function(){if(!k7o6sy.EnvConfig.pixelRatioInt)try{var e=wx.getSystemInfoSync();return k7o6sy.EnvConfig.pixelRatioInt=e.pixelRatio,e.pixelRatio}catch(e){}return k7o6sy.EnvConfig.pixelRatioInt},k7o6sy.createElement=function(e){return"canvas"!=e?"textarea"==e||"input"==e?k7o6sy.onCreateInput(e):"div"==e?((n=k7o6sy._preCreateElement(e)).contains=function(e){return null},n.removeChild=function(e){},n):k7o6sy._preCreateElement(e):(1==k7o6sy.idx?k7o6sy.isZiYu?(i=sharedCanvas).style={}:i=o.canvas:i=o.wx.createCanvas(),k7o6sy.idx++,i);var i;var n},k7o6sy.onCreateInput=function(e){e=k7o6sy._preCreateElement(e);return e.focus=g.wxinputFocus,e.blur=g.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(e){},e.setType=function(e){},e.setFontFace=function(e){},e.addEventListener=function(e){},e.contains=function(e){return null},e.removeChild=function(e){},e},k7o6sy.createShaderCondition=function(e){var i=this;return function(){return i[e.replace("this.","")]}},k7o6sy.EnvConfig=null,k7o6sy.window=null,k7o6sy._preCreateElement=null,k7o6sy._inited=!1,k7o6sy.wxRequest=null,k7o6sy.systemInfo=null,k7o6sy.version="0.0.1",k7o6sy.isZiYu=!1,k7o6sy.isPosMsgYu=!1,k7o6sy.parseXMLFromString=function(e){var i;e=e.replace(/>\s+</g,"><");try{i=(new o.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return i},k7o6sy.idx=1,k7o6sy),g=(a(hziax,"laya.wx.mini.MiniImage"),hziax.prototype._loadImage=function(e){var i=!1;-1==e.indexOf("layaNativeDir/")&&(i=!0,e=m.formatURL(e)),u.getFileInfo(e)?hziax.onCreateImage(e,this,!i):-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?u.downImg(e,new c(hziax,hziax.onDownImgCallBack,[e,this]),e):hziax.onCreateImage(e,this,!0)},hziax.onDownImgCallBack=function(e,i,n){n?i.onError(null):hziax.onCreateImage(e,i)},hziax.onCreateImage=function(i,n,e){var t;function qm1fr(){t.onload=null,t.onerror=null,delete n.imgCache[i]}e=(e=void 0===e?!1:e)?i:(e=u.getFileInfo(i).md5,u.getFileNativePath(e)),null==n.imgCache&&(n.imgCache={});function za(){qm1fr(),n.onLoaded(t)}function Aa(){qm1fr(),n.event("error","Load image failed")}"nativeimage"==n._type?((t=new l.window.Image).crossOrigin="",t.onload=za,t.onerror=Aa,t.src=e,n.imgCache[i]=t):new d.create(e,{onload:za,onerror:Aa,onCreate:function(e){t=e,n.imgCache[i]=e}})},a(g4u,"laya.wx.mini.MiniInput"),g4u._createInputElement=function(){t._initInput(t.area=l.createElement("textarea")),t._initInput(t.input=l.createElement("input")),t.inputContainer=l.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,l.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(e,i){t.inputContainer.style.left=e+"px",t.inputContainer.style.top=i+"px"},s.stage.on("resize",null,g4u._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){o.dispatchEvent&&o.dispatchEvent("resize")}),v._soundClass=x,v._musicClass=x,o._videoClass=_},g4u._onStageResize=function(){s.stage._canvasTransform.identity().scale(l.width/h.canvas.width/y.getPixelRatio(),l.height/h.canvas.height/y.getPixelRatio())},g4u.wxinputFocus=function(e){var i=t.inputElement.target;i&&!i.editable||(r.window.wx.offKeyboardConfirm(),r.window.wx.offKeyboardInput(),r.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(e){},fail:function(e){}}),r.window.wx.onKeyboardConfirm(function(e){e=e?e.value:"";i.text=e,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),r.window.wx.onKeyboardInput(function(e){e=e?e.value:"";i.multiline||-1==e.indexOf("\n")?(i.text=e,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},g4u.inputEnter=function(){t.inputElement.target.focus=!1},g4u.wxinputblur=function(){g4u.hideKeyboard()},g4u.hideKeyboard=function(){r.window.wx.offKeyboardConfirm(),r.window.wx.offKeyboardInput(),r.window.wx.hideKeyboard({success:function(e){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(e){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(e?e.errMsg:""))}})},g4u),E=(a(f67sk,"laya.wx.mini.MiniLoader"),(C=f67sk.prototype).load=function(e,i,n,t,o){void 0===n&&(n=!0),void 0===o&&(o=!1);var s=this;0===(s._url=e).indexOf("data:image")?s._type=i="image":s._type=i=i||s.getTypeFromUrl(e),s._cache=n,s._data=null;var a="ascii";-1!=e.indexOf(".fnt")?a="utf8":"arraybuffer"==i&&(a="");var l=k.getFileExtension(e);if(-1!=f67sk._fileTypeArr.indexOf(l))r.EnvConfig.load.call(this,e,i,n,t,o);else if(u.getFileInfo(e))r.EnvConfig.load.call(this,e,i,n,t,o);else{if(-1!=e.indexOf("layaNativeDir/"))return r.isZiYu?(l=u.ziyuFileData[e],void s.onLoaded(l)):(cosnole.log("read read"),void u.read(e,a,new c(f67sk,f67sk.onReadNativeCallBack,[a,e,i,n,t,o,s])));l=""==m.rootPath?e:e.split(m.rootPath)[0],-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?r.EnvConfig.load.call(s,e,i,n,t,o):u.readFile(l,a,new c(f67sk,f67sk.onReadNativeCallBack,[a,e,i,n,t,o,s]),e)}},C.resMgrLoad=function(e,t,i,n,o,s,a){void 0===i&&(i=0),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=0),void 0===a&&(a=3),-1!=e.indexOf("mpack")&&console.log("=============resMgrLoad url:",e),r.EnvConfig.resMgrLoad(e,(e,i,n)=>{f67sk.prototype.resMgrLoadCallBack(e,i,n,t)},i,n,o,s,a)},C.resMgrLoadCallBack=function(e,i,n,t){console.log("buff:::",e,n,u.fileNativeDir+"///"+u.fileListName),t(e,i,n)},C.clearRes=function(e,i){this.clearRes(e,i=void 0===i?!1:i);i=u.getFileInfo(e);!i||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(e=i.md5,i=u.getFileNativePath(e),u.remove(i))},f67sk.onReadNativeCallBack=function(e,i,n,t,o,s,a,l,u){void 0===t&&(t=!0),void 0===s&&(s=!1),(l=void 0===l?0:l)?1==l&&r.EnvConfig.load.call(a,i,n,t,o,s):(l="json"==n||"atlas"==n?r.getJson(u.data):"xml"==n?k.parseXMLFromString(u.data):u.data,a.onLoaded(l),!r.isZiYu&&r.isPosMsgYu&&"arraybuffer"!=n&&wx.postMessage({url:i,data:l,isLoad:!0}))},e(f67sk,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),f67sk),u=(a(os7ky,"laya.wx.mini.MiniFileMgr",n),os7ky.isLoadFile=function(e){return-1!=os7ky._fileTypeArr.indexOf(e)},os7ky.getFileInfo=function(e){e=e.split("?")[0],e=os7ky.filesListObj[e];return null==e?null:e},os7ky.onFileUpdate=function(e,i){var e=e.split("/"),e=e[e.length-1],n=os7ky.getFileInfo(i);null==n?os7ky.onSaveFile(i,e):n.readyUrl!=i&&os7ky.remove(e,i)},os7ky.exits=function(e,i){e=os7ky.getFileNativePath(e);os7ky.fs.getFileInfo({filePath:e,success:function(e){null!=i&&i.runWith([0,e])},fail:function(e){null!=i&&i.runWith([1,e])}})},os7ky.read=function(e,i,n,t){void 0===i&&(i="ascill"),e=""!=(t=void 0===t?"":t)?os7ky.getFileNativePath(e):e,os7ky.fs.readFile({filePath:e,encoding:i,success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){e&&""!=t?os7ky.down(t,i,n,t):null!=n&&n.runWith([1])}})},os7ky.readNativeFile=function(e,i){os7ky.fs.readFile({filePath:e,encoding:"",success:function(e){null!=i&&i.runWith([0])},fail:function(e){null!=i&&i.runWith([1])}})},os7ky.down=function(e,i,n,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var o=os7ky.getFileNativePath(t);os7ky.wxdown({url:e,filePath:o,success:function(e){200===e.statusCode&&os7ky.readFile(e.filePath,i,n,t)},fail:function(e){null!=n&&n.runWith([1,e])}}).onProgressUpdate(function(e){null!=n&&n.runWith([2,e.progress])})},os7ky.readFile=function(i,e,n,t){void 0===t&&(t=""),os7ky.fs.readFile({filePath:i,encoding:e=void 0===e?"ascill":e,success:function(e){-1==i.indexOf("http://")&&-1==i.indexOf("https://")||os7ky.onFileUpdate(i,t),null!=n&&n.runWith([0,e])},fail:function(e){e&&null!=n&&n.runWith([1,e])}})},os7ky.downImg=function(e,i,n){void 0===n&&(n="");os7ky.wxdown({url:e,success:function(e){200===e.statusCode&&os7ky.copyFile(e.tempFilePath,n,i)},fail:function(e){null!=i&&i.runWith([1,e])}})},os7ky.copyFile=function(e,i,n){var t=e.split("/"),o=t[t.length-1],s=(i.split("?")[0],os7ky.getFileInfo(i)),t=os7ky.getFileNativePath(o);os7ky.fs.copyFile({srcPath:e,destPath:t,success:function(e){s?s.readyUrl!=i&&os7ky.remove(o,i,n):(os7ky.onSaveFile(i,o),null!=n&&n.runWith([0]))},fail:function(e){null!=n&&n.runWith([1,e])}})},os7ky.getFileNativePath=function(e){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},os7ky.remove=function(i,n,t){void 0===n&&(n="");var e=os7ky.getFileInfo(n),o=os7ky.getFileNativePath(e.md5);s.loader.clearRes(e.readyUrl),os7ky.fs.unlink({filePath:o,success:function(e){""!=n&&os7ky.onSaveFile(n,i),null!=t&&t.runWith([0])},fail:function(e){}})},os7ky.onSaveFile=function(e,i){var n=e.split("?")[0];os7ky.filesListObj[n]={md5:i,readyUrl:e},os7ky.fs.writeFile({filePath:os7ky.fileNativeDir+"/"+os7ky.fileListName,encoding:"utf8",data:JSON.stringify(os7ky.filesListObj),success:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",e)},fail:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",e)}})},os7ky.existDir=function(e,i){os7ky.fs.mkdir({dirPath:e,success:function(e){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?os7ky.readSync(os7ky.fileListName,"utf8",i):null!=i&&i.runWith([1,e])}})},os7ky.readSync=function(e,i,n,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var o,i=os7ky.getFileNativePath(e);try{o=os7ky.fs.readFileSync(i),null!=n&&n.runWith([0,{data:o}])}catch(e){null!=n&&n.runWith([1])}},os7ky.readCache=function(){},os7ky.writeCache=function(e){var i=readyUrl.split("?")[0];os7ky.filesListObj[i]={md5:md5Name,readyUrl:readyUrl},os7ky.fs.writeFile({filePath:os7ky.fileNativeDir+"/"+os7ky.fileListName,encoding:"utf8",data:JSON.stringify(os7ky.filesListObj),success:function(e){},fail:function(e){}})},os7ky.setNativeFileDir=function(e){os7ky.fileNativeDir=wx.env.USER_DATA_PATH+e},os7ky.filesListObj={},os7ky.fileNativeDir=null,os7ky.fileListName="layaairfiles.txt",os7ky.ziyuFileData={},e(os7ky,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),os7ky),x=(a(ebpn4u,"laya.wx.mini.MiniSound",n),(C=ebpn4u.prototype).load=function(e){var i;e=m.formatURL(e),this.url=e,ebpn4u._audioCache[e]?this.event("complete"):(this._sound.onCanplay(function(){i.loaded=!0,i.event("complete"),ebpn4u._audioCache[i.url]=i}),this._sound.onError(function(e){console.error("errCode="+e.errCode+"  errMsg="+e.errMsg),i.event("error")}),this._sound.src=e,i=this)},C.play=function(e,i){var n,t;return void 0===e&&(e=0),void 0===i&&(i=0),t=(n=this.url==v._tMusic?(ebpn4u._musicAudio||(ebpn4u._musicAudio=this._sound),ebpn4u._musicAudio):this._sound,this._chanell),n.src=this.url,n.startTime=0,t.isStopped&&(t.url=this.url,t.loops=i,t.startTime=e,t.play(),v.addChannel(t)),t},C.dispose=function(){var e=ebpn4u._audioCache[this.url];e&&(e.src="",delete ebpn4u._audioCache[this.url])},i(0,C,"duration",function(){return this._sound.duration}),ebpn4u._createSound=function(){return ebpn4u._id++,r.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},ebpn4u._musicAudio=null,ebpn4u._id=0,ebpn4u._audioCache={},ebpn4u._null=void 0,ebpn4u),w=(a(ix9d2,"laya.wx.mini.MiniSoundChannel",p),(e=ix9d2.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(s.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.__onNull=function(){},e.play=function(){this.isStopped=!1,v.addChannel(this),this._audio&&this._audio.play()},e.stop=function(){this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},i(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),i(0,e,"duration",function(){return this._audio?this._audio.duration:0}),i(0,e,"volume",function(){return 1},function(e){}),ix9d2._null=void 0,ix9d2),_=(a(sy0ogk,"laya.wx.mini.MiniVideo"),(n=sy0ogk.prototype).on=function(e,i,n){"loadedmetadata"==e?(this.onPlayFunc=n.bind(i),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=n.bind(i),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},n.onTimeUpdateFunc=function(e){this.position=e.position,this._duration=e.duration},n.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},n.onended=function(e,i){this.onEndedFunC=i.bind(e),this.videoElement.onended=this.onEndedFunction.bind(this)},n.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},n.off=function(e,i,n){"loadedmetadata"==e?(this.onPlayFunc=n.bind(i),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=n.bind(i),this.videoElement.offEnded=this.onEndedFunction.bind(this))},n.load=function(e){this.videoElement&&(this.videoElement.src=e)},n.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},n.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},n.size=function(e,i){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=i)},n.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},n.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},i(0,n,"duration",function(){return this._duration}),i(0,n,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(e){this.videoElement&&(this.videoElement.initialTime=e)}),i(0,n,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),i(0,n,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),i(0,n,"ended",function(){return this.videoend}),i(0,n,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(e){this.videoElement&&(this.videoElement.loop=e)}),i(0,n,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(e){this.videoElement&&(this.videoElement.playbackRate=e)}),i(0,n,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(e){this.videoElement&&(this.videoElement.muted=e)}),i(0,n,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),i(0,n,"x",function(){return this.videoElement?this.videoElement.x:0},function(e){this.videoElement&&(this.videoElement.x=e)}),i(0,n,"y",function(){return this.videoElement?this.videoElement.y:0},function(e){this.videoElement&&(this.videoElement.y=e)}),i(0,n,"currentSrc",function(){return this.videoElement.src}),i(0,n,"src",function(){return this.videoElement?this.videoElement.src:0},function(e){this.videoElement&&(this.videoElement.src=e)}),i(0,n,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(e){this.videoElement&&(this.videoElement.controls=e)}),i(0,n,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(e){this.videoElement&&(this.videoElement.autoplay=e)}),sy0ogk);function sy0ogk(){this.videoend=!1,this.videourl="",this.videoElement=r.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function ix9d2(e){this._audio=null,this._onEnd=null,ix9d2.__super.call(this),this.isStopped=!0,this._audio=e,this._onEnd=k.bind(this.__onEnd,this),e.onEnded(this._onEnd)}function ebpn4u(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,ebpn4u.__super.call(this),this._sound=ebpn4u._createSound(),this._chanell=new w(this._sound)}function os7ky(){os7ky.__super.call(this)}function f67sk(){}var C;function g4u(){}function hziax(){}function k7o6sy(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,i){"use strict";for(var n in Object.defineProperty(i,"__esModule",{value:!0}),Laya){var t=Laya[n];t&&t.__isclass&&(i[n]=t)}});