"use strict";var a=wx.$y;var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof2(e)};!function(){function e(e,t){if(!(0<e.length))return t({code:0,msg:"\u62d2\u7edd\u8ba2\u9605"}),0;wx.request({url:c+"/api/wx/wx_subscribe",method:"POST",data:{tmpid:e,appid:l,openid:u,sign:p,platform:f},success:function(e){var o=e.data.data;for(var n in o)wx.setStorageSync(n,o[n]);t({code:1,msg:"\u8ba2\u9605\u6210\u529f",tem_ids:o})},fail:function(e){console.log(e,"rrrrrrrrrr")}})}function t(o){wx.checkSession({success:function(){var e;console.log("\u91cd\u65b0\u83b7\u53d6 success-"+u),u?(e={user:{openid:u,sign:p},shareInfo:y.query},o(e)):D.login(function(e){u?o(e):wx.showModal({title:"\u63d0\u793a",content:"\u767b\u5f55\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u5c0f\u6e38\u620f4"})})},fail:function(){"develop"==d&&console.log("\u91cd\u65b0\u83b7\u53d6openid fail"),D.login(function(e){u?o(e):wx.showModal({title:"\u63d0\u793a",content:"\u767b\u5f55\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u5c0f\u6e38\u620f3"})})}})}function a(e){var o;o=e.split("&");for(var n=0;n<o.length;n++){if(""==o[n])return;var t=e.split("=");if("chid"==t[0]||"subchid"==t[0]||"shareid"==t[0]||"sharetype"==t[0])return}return 1}var i,r,o=require("./config.js"),s="v3.7",c="",d="develop",g="",m="test_sub_channel_id",w="",h=0,l="",u="",v="",p="",_={},y={},f="",x=+new Date,S=120,b=0,q=0,D={getDybUserInfo:function(o){x=+new Date,"develop"==d&&console.log("----------getDybUserInfo-------------"),t(function(e){D.initData(function(e){}),o(e)})},login:function(t){"develop"==d&&console.log(u+"======login========"),wx.login({success:function(e){e={code:e.code,game_appid:l,channel_id:g,sub_channel_id:m,shareid:h,sharetype:w,version:s,gdt:v,platform:f,aid:b};"develop"==d&&console.log(e,"\u521d\u59cb\u5316\u767b\u9646logins\u6570\u636e"),wx.request({url:c+"/api/wx/get_wx_userinfo",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:e,dataType:"json",success:function(e){var o,n;e.data.code?(o={},n={user:o={openid:e.data.data.openid,sign:e.data.data.sign},shareInfo:y.query},u=e.data.data.openid,p=e.data.data.sign,_=o,wx.setStorageSync("sop_user",o),t(n)):wx.showModal({title:"\u63d0\u793a",content:e.data.msg})},fail:function(e){console.log("\u8c03\u7528\u5931\u8d25",e),wx.showModal({title:"\u63d0\u793a",content:"\u767b\u5f55\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u5c0f\u6e38\u620f1"})}})},fail:function(e){console.log("\u8c03\u7528\u5931\u8d25",e),wx.showModal({title:"\u63d0\u793a",content:"\u767b\u5f55\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u5c0f\u6e38\u620f2"})}})},initData:function(e){"develop"==d&&console.log("----------init_Data-------------");var o={};o.openid=u,o.sign=p,o.game_appid=l,o.channel_id=g,o.sub_channel_id=m,o.version=s,o.platform=f,o.aid=b,o.gdt=v,wx.request({url:c+"/api/wx/init_data",data:o,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){"develop"==d&&console.log(e.data,"init_data_success"),1==e.data.code&&(S=e.data.data.online_time||60)}})},createRole:function(e,n){"develop"==d&&console.log("----------roleData-------------"),t(function(){var o={openid:u,game_appid:l,sign:p,gdt:v,version:s,platform:f,aid:b};return null==_typeof2(e.server_id)&&""==String(e.server_id)&&"undefined"==String(e.server_id)?void n({code:0,msg:"\u670d\u52a1\u5668ID\u4e0d\u6b63\u786e"}):(o.server_id=e.server_id,null!=_typeof2(e.server_name)||""!=String(e.server_name)||"undefined"!=String(e.server_name)?o.server_name=e.server_name:o.server_name="\u9ed8\u8ba4\u533a\u670d",null==_typeof2(e.role_name)&&""==String(e.role_name)&&"undefined"==String(e.role_name)?void n({code:0,msg:"\u89d2\u8272\u540d\u79f0\u4e0d\u6b63\u786e"}):(o.role_name=e.role_name,void wx.request({url:c+"/api/wx/create_role",data:o,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){n(e.data),1==e.data.code?wx.request({url:c+"/api/wx/role_login",data:o,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},complete:function(e){}}):n(e.data)},complete:function(){console.log("finshshow-----"),wx.reportAnalytics("finishShow")}})))})},submitOrder:function(o,i){var r=+new Date;console.log("\u5f00\u59cb\u65f6\u95f4:",r),wx.showLoading({title:"\u6b63\u5728\u652f\u4ed8",mask:!0}),"develop"==d&&console.log("----------\u63d0\u4ea4\u8ba2\u5355-------------\u652f\u4ed8\u73af\u5883"),t(function(){if(null==_typeof2(o.server_name)||""==String(o.server_name)||"undefined"==String(o.server_name))return i({code:0,msg:"\u7f3a\u5c11\u670d\u52a1\u5668\u540d"}),0;if(null==_typeof2(o.role_name)||""==String(o.role_name)||"undefined"==String(o.role_name))return i({code:0,msg:"\u7f3a\u5c11\u89d2\u8272\u540d"}),0;var e={game_appid:l,extra_info:o.extra_info,goods_count:o.goods_count,goods_name:o.goods_name,pay_amount:o.pay_amount,account_id:u,redirect_uri:o.redirect_uri,role_name:o.role_name,server_name:o.server_name,channel_id:g,sub_channel_id:m,order_sn:o.order_sn,sign:p,gdt:v,version:s,platform:f,aid:b},t=+new Date-r;console.log("request_before",t),wx.request({url:c+"/api/wx/wxgame_create",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:e,success:function(a){var n=+new Date-r;var e;"develop"==d&&console.log(a.data,"\u652f\u4ed8\u63a5\u53e3\u8fd4\u56de",n),a.data.code?"ios"==f||"js"==a.data.data.type?wx.navigateToMiniProgram({appId:"wxab2e839b6578e72c",path:"pages/come/come?scene="+a.data.data.id,extraData:{game_appid:l,openid:u},envVersion:"release",success:function(e){wx.hideLoading(),console.log(e,"res")},fail:function(e){wx.hideLoading(),console.log(e,"fff")},complete:function(e){wx.hideLoading()}}):"android"==f||"windows"==f?wx.requestMidasPayment({mode:a.data.data.param.mode,offerId:a.data.data.param.offerId,currencyType:a.data.data.param.currencyType,platform:a.data.data.param.platform,buyQuantity:a.data.data.param.buyQuantity,zoneId:1,success:function(e){i({code:1,msg:"\u652f\u4ed8\u6210\u529f"}),"develop"==d&&console.log("\u652f\u4ed8\u6210\u529f\u56de\u8c03\u51fd\u6570");var o=0,n=a.data.data.order_sn,t=setInterval(function(){wx.request({url:c+"/api/wx/wxgame_notify",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{bill_no:n,game_appid:l,account_id:u,sign:p},success:function(e){"develop"==d&&console.log(e.data,"\u652f\u4ed8\u6210\u529f\u67e5\u8be2\u56de\u8c03"),(1==e.data.code||10<o)&&clearInterval(t),o++},complete:function(e){30<o&&clearInterval(t)}})},2e3)},fail:function(e){"develop"==d&&console.log("\u652f\u4ed8\u5931\u8d25",e),wx.hideLoading(),i({code:0,msg:"\u652f\u4ed8\u5931\u8d25"});var o=+new Date-r;console.log("fail_time",o),e.request_before=t,e.req_success=n,e.failTime=o,e.appid=l,e.openid=u,wx.request({url:c+"/api/wx/fail_pay",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:e,success:function(e){}})}}):(wx.hideLoading(),wx.showModal({title:"\u63d0\u793a",content:"\u8bf7\u4f7f\u7528\u624b\u673a\u5b8c\u6210\u652f\u4ed8",showCancel:!1,cancelColor:"cancelColor"})):(wx.hideLoading(),(e=a.data.data.data)&&90011==e.errcode&&(u="",wx.removeStorageSync("sop_user")),i({code:0,msg:a.data.msg}))},fail:function(e){i({code:0,msg:"\u8bf7\u6c42\u5931\u8d25"})}})})},subscribeMsg:function(o,a){var i=[],r=[];for(var n in o)wx.getStorageSync(o[n])||i.push(o[n]);if(0==i.length)return console.log("\u5df2\u7ecf\u8ba2\u9605"),void a({code:2,msg:"\u5df2\u7ecf\u8ba2\u9605"});var t=[];wx.requestSubscribeMessage({tmplIds:i,success:function(o){if(console.log(o,"success-ssssssss"),"requestSubscribeMessage:ok"==o.errMsg){for(var n in i)wx.getStorageSync(i[n])||("accept"==o[i[n]]?(r.push(i[n]),console.log(r,"upppppppp")):(t.push(i[n]),wx.showModal({title:"\u8ba2\u9605",content:"\u4e3a\u4e86\u53ca\u65f6\u4e86\u89e3\u6e38\u620f\u52a8\u6001,\u8bf7\u8ba2\u9605\u901a\u77e5",cancelColor:"cancelColor",success:function(e){e.confirm?wx.openSetting({withSubscriptions:!0,success:function(e){console.log(e,"openSetting");var o=e.subscriptionsSetting.itemSettings;for(var n in t)wx.getStorageSync(t[n])||"accept"==o[t[n]]&&(r[i[n]]=i[n])}}):a({code:0,msg:"\u62d2\u7edd\u8ba2\u9605"})}})));e(r,a)}},fail:function(o){console.log(o,"fail"),wx.openSetting({withSubscriptions:!0,success:function(o){console.log(o,"openSetting");var n=o.subscriptionsSetting.itemSettings;for(var t in i)wx.getStorageSync(i[t])||"accept"==n[i[t]]&&r.push(i[t]);e(r,a)},fail:function(){a({code:0,msg:"\u62d2\u7edd\u8ba2\u9605"})}})}})},onShare:function(e){"develop"==d&&console.log("----------\u8bbe\u7f6e\u8f6c\u53d1-------------"),!e.query||a(e.query)?(wx.showShareMenu({showShareItems:["shareAppMessage","shareTimeline"],withShareTicket:!0}),wx.onShareAppMessage(function(){return{title:e.title,imageUrl:e.imageUrl,query:"subchid="+m+"&sharetype=onshare&shareid="+u+"&"+e.query}})):console.log("query error")},share:function(e){"develop"==d&&console.log("----------\u4e3b\u52a8\u8f6c\u53d1-------------"),t(function(){if(e.query&&!a(e.query))return console.log("query error"),0;wx.showShareMenu({showShareItems:["shareAppMessage","shareTimeline"],withShareTicket:!0}),wx.shareAppMessage({title:e.title,imageUrl:e.imageUrl,query:"subchid="+m+"&sharetype=share&shareid="+u+"&"+e.query})})},dot:function(e,o){e={game_appid:l,account_id:u,step:e,sign:p,version:s,platform:f};wx.request({url:c+"/api/wx/dot_record",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:e,success:function(e){o(e.data)},fail:function(e){o({code:0,msg:"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25",res:e})}})},createVideoAd:function(e,n){var o;"develop"==d&&console.log(void 0===i?"undefined":_typeof2(i),"typeof(video)"),"object"!=(void 0===i?"undefined":_typeof2(i))?("develop"==d&&console.log(r,"typeof(adUnitId11)"),r=e,(i=wx.createRewardedVideoAd({adUnitId:e})).onError(function(e){var o={};"develop"==d&&console.log(e,"----------onError-------------"),o.msg=e.errMsg,o.state="error",o.isEnded=!1,o.res=e,n(o)}),i.onClose(function(e){var o={};D.advertisement("close",function(e){}),o.state="close",o.isEnded=e.isEnded,o.msg="\u89c6\u9891\u5e7f\u544a\u5173\u95ed",n(o)}),i.load().then(function(){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u6210\u529f"),i.show().then(function(e){D.advertisement("show",function(e){}),n({state:"show",msg:"\u89c6\u9891\u5c55\u793a\u6210\u529f",isEnded:!1})}).catch(function(e){var o={};o.code=2,o.state="error",o.msg=e.errMsg,o.isEnded=!1,n(e)})}).catch(function(e){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25",e)})):r!=e?("develop"==d&&console.log(r,e,"typeof(new)"),r=e,(o=wx.createRewardedVideoAd({adUnitId:e})).load().then(function(){o.show().then(function(e){D.advertisement("show",function(e){}),n({state:"show",msg:"\u89c6\u9891\u5c55\u793a\u6210\u529f",isEnded:!1})}).catch(function(e){var o={};o.code=2,o.state="error",o.msg=e.errMsg,o.isEnded=!1,n(e)})}).catch(function(e){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25",e)})):("develop"==d&&console.log(i,"----------createVideoAd-------------"),i.onClose(function(e){i.offClose(i.onClose());var o={};D.advertisement("close",function(e){}),o.state="close",o.isEnded=e.isEnded,o.msg="\u89c6\u9891\u5e7f\u544a\u5173\u95ed",n(o)}),i.show().then(function(e){D.advertisement("show",function(e){}),n({state:"show",msg:"\u89c6\u9891\u5c55\u793a\u6210\u529f",isEnded:!1})}).catch(function(e){var o={};o.code=2,o.state="error",o.msg=e.errMsg,o.isEnded=!1,n(e)}))},advertisement:function(n,a){"develop"==d&&console.log(n,"----------\u4e0a\u62a5\u5e7f\u544a-------------"),t(function(){var e={openid:u,game_appid:l,sign:p,version:s,platform:f},o="";"show"==n?o=c+"/api/wx/videoClick":"close"==n?o=c+"/api/wx/watch":"share"==n&&(o=c+"/api/wx/share"),wx.request({url:o,data:e,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},complete:function(e){a(e.data)}})})},gameLevel:function(e,o){var n={};n.openid=u,n.appid=l,n.sign=p,n.level=e,n.version=s,n.platform=f,wx.request({url:c+"/api/wx/game_level",data:n,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},complete:function(e){o(e.data)}})},msg_check:function(e,o){var n={};n.content=e,n.appid=l,n.version=s,wx.request({url:c+"/api/v2/msg_sec_check",data:n,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){o(e.data)}})},img_check:function(e,o){wx.uploadFile({url:c+"/api/v2/img_sec_check",filePath:e,name:"media",formData:{appid:l},success:function(e){o(e.data)}})},media_check:function(e,o,n){wx.request({url:c+"/api/v2/media_check",data:{appid:l,media_url:e,type:o},method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){n(e.data)}})}};var n;_=wx.getStorageSync("sop_user"),u=_.openid,p=_.sign,console.log("==wxsdk version==",s),d=o.env,c=o.url,l=o.appid,y=wx.getLaunchOptionsSync(),"develop"==d&&console.log(y,"wx.getLaunchOptionsSync(111)"),o=y.query,g=y.scene,v=o.gdt_vid||"",(n=o.weixinadinfo)&&(n=n.split("."),b=n[0],console.log("\u6765\u6e90\u2f34\u544a\u7684\u2f34\u544aid\u662f\uff1a"+b)),n=y.referrerInfo,o.via?(m=o.via||"test_sub_channel_id",h=o.shareid||0,w=o.sharetype||""):o.subchid?(m=o.subchid||"test_sub_channel_id",h=o.shareid||0,w=o.sharetype||""):n&&"string"==typeof n.extraData&&(n.extraData=JSON.parse(n.extraData),m=n.extraData.subchid,h=n.extraData.shareid||0,w=n.extraData.sharetype||""),o=wx.getSystemInfoSync(),f=o.platform,q=o.SDKVersion,wx.onHide(function(){var e;console.log("onhide",x),e=Math.floor((+new Date-x)/1e3),"develop"==d&&console.log("----------timing-------------:",e,S,x),!u||e<S||(e={openid:u,game_appid:l,timing:e,sign:p,version:s,platform:f},wx.request({url:c+"/api/wx/online_time",data:e,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){x=+new Date}})),x=+new Date}),0<=function(e,o){e=e.split("."),o=o.split(".");for(var n=Math.max(e.length,o.length);e.length<n;)e.push("0");for(;o.length<n;)o.push("0");for(var t=0;t<n;t++){var a=parseInt(e[t]),i=parseInt(o[t]);if(i<a)return 1;if(a<i)return-1}return 0}(q,"2.10.3")&&wx.onAddToFavorites(function(){}),window.dyb=D}();