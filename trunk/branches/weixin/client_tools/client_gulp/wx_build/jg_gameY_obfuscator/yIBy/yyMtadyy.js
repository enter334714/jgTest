var a=wx.$y;!function(o,a){a.un,a.uns;var n=a.static,l=a.class,e=a.getset,u=(a.__newvec,laya.utils.Browser),t=(laya.events.Event,laya.events.EventDispatcher),r=laya.resource.HTMLImage,c=laya.utils.Handler,i=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),v=laya.utils.RunDriver,m=(laya.media.Sound,laya.media.SoundChannel),p=laya.media.SoundManager,y=(laya.display.Stage,laya.net.URL),w=laya.utils.Utils,s=(l(ay536v,"laya.wx.mini.MiniAdpter"),ay536v.getJson=function(n){return JSON.parse(n)},ay536v.init=function(n,e){void 0===n&&(n=!1),void 0===e&&(e=!1),ay536v._inited||(ay536v.window=o).navigator.userAgent.indexOf("MiniGame")<0||(ay536v._inited=!0,ay536v.isZiYu=e,ay536v.isPosMsgYu=n,ay536v.EnvConfig={},ay536v.isZiYu||(d.setNativeFileDir("/layaairGame"),d.existDir(d.fileNativeDir,c.create(ay536v,ay536v.onMkdirCallBack))),ay536v.window.focus=function(){},a.getUrlPath=function(){},ay536v.window.logtime=function(n){},ay536v.window.alertTimeLog=function(n){},ay536v.window.resetShareInfo=function(){},ay536v.window.CanvasRenderingContext2D=function(){},ay536v.window.CanvasRenderingContext2D.prototype=ay536v.window.wx.createCanvas().getContext("2d").__proto__,ay536v.window.document.body.appendChild=function(){},ay536v.EnvConfig.pixelRatioInt=0,v.getPixelRatio=ay536v.pixelRatio,ay536v._preCreateElement=u.createElement,u.createElement=ay536v.createElement,v.createShaderCondition=ay536v.createShaderCondition,w.parseXMLFromString=ay536v.parseXMLFromString,i._createInputElement=g._createInputElement,ay536v.EnvConfig.load=f.prototype.load,f.prototype.load=E.prototype.load,ay536v.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(d.ziyuFileData[n.url]=n.data)}))},ay536v.onMkdirCallBack=function(n,e){n||(d.filesListObj=JSON.parse(e.data))},ay536v.pixelRatio=function(){if(!ay536v.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return ay536v.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return ay536v.EnvConfig.pixelRatioInt},ay536v.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?ay536v.onCreateInput(n):"div"==n?((t=ay536v._preCreateElement(n)).contains=function(n){return null},t.removeChild=function(n){},t):ay536v._preCreateElement(n):(1==ay536v.idx?ay536v.isZiYu?(e=sharedCanvas).style={}:e=o.canvas:e=o.wx.createCanvas(),ay536v.idx++,e);var e;var t},ay536v.onCreateInput=function(n){n=ay536v._preCreateElement(n);return n.focus=g.wxinputFocus,n.blur=g.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},ay536v.createShaderCondition=function(n){var e=this;return function(){return e[n.replace("this.","")]}},ay536v.EnvConfig=null,ay536v.window=null,ay536v._preCreateElement=null,ay536v._inited=!1,ay536v.wxRequest=null,ay536v.systemInfo=null,ay536v.version="0.0.1",ay536v.isZiYu=!1,ay536v.isPosMsgYu=!1,ay536v.parseXMLFromString=function(n){var e;n=n.replace(/>\s+</g,"><");try{e=(new o.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return e},ay536v.idx=1,ay536v),g=(l(d1uma5,"laya.wx.mini.MiniImage"),d1uma5.prototype._loadImage=function(n){var e=!1;-1==n.indexOf("layaNativeDir/")&&(e=!0,n=y.formatURL(n)),d.getFileInfo(n)?d1uma5.onCreateImage(n,this,!e):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?d.downImg(n,new c(d1uma5,d1uma5.onDownImgCallBack,[n,this]),n):d1uma5.onCreateImage(n,this,!0)},d1uma5.onDownImgCallBack=function(n,e,t){t?e.onError(null):d1uma5.onCreateImage(n,e)},d1uma5.onCreateImage=function(e,t,n){var i;function cl2ks9(){i.onload=null,i.onerror=null,delete t.imgCache[e]}n=(n=void 0===n?!1:n)?e:(n=d.getFileInfo(e).md5,d.getFileNativePath(n)),null==t.imgCache&&(t.imgCache={});function za(){cl2ks9(),t.onLoaded(i)}function Aa(){cl2ks9(),t.event("error","Load image failed")}"nativeimage"==t._type?((i=new u.window.Image).crossOrigin="",i.onload=za,i.onerror=Aa,i.src=n,t.imgCache[e]=i):new r.create(n,{onload:za,onerror:Aa,onCreate:function(n){i=n,t.imgCache[e]=n}})},l(kn29sc,"laya.wx.mini.MiniInput"),kn29sc._createInputElement=function(){i._initInput(i.area=u.createElement("textarea")),i._initInput(i.input=u.createElement("input")),i.inputContainer=u.createElement("div"),i.inputContainer.style.position="absolute",i.inputContainer.style.zIndex=1e5,u.container.appendChild(i.inputContainer),i.inputContainer.setPos=function(n,e){i.inputContainer.style.left=n+"px",i.inputContainer.style.top=e+"px"},a.stage.on("resize",null,kn29sc._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){o.dispatchEvent&&o.dispatchEvent("resize")}),p._soundClass=x,p._musicClass=x,o._videoClass=C},kn29sc._onStageResize=function(){a.stage._canvasTransform.identity().scale(u.width/h.canvas.width/v.getPixelRatio(),u.height/h.canvas.height/v.getPixelRatio())},kn29sc.wxinputFocus=function(n){var e=i.inputElement.target;e&&!e.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),s.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"";e.text=n,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(n){n=n?n.value:"";e.multiline||-1==n.indexOf("\n")?(e.text=n,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},kn29sc.inputEnter=function(){i.inputElement.target.focus=!1},kn29sc.wxinputblur=function(){kn29sc.hideKeyboard()},kn29sc.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},kn29sc),E=(l(xz,"laya.wx.mini.MiniLoader"),(F=xz.prototype).load=function(n,e,t,i,o){void 0===t&&(t=!0),void 0===o&&(o=!1);var a=this;0===(a._url=n).indexOf("data:image")?a._type=e="image":a._type=e=e||a.getTypeFromUrl(n),a._cache=t,a._data=null;var l="ascii";-1!=n.indexOf(".fnt")?l="utf8":"arraybuffer"==e&&(l="");var u=w.getFileExtension(n);if(-1!=xz._fileTypeArr.indexOf(u))s.EnvConfig.load.call(this,n,e,t,i,o);else if(d.getFileInfo(n))s.EnvConfig.load.call(this,n,e,t,i,o);else{if(-1!=n.indexOf("layaNativeDir/"))return s.isZiYu?(u=d.ziyuFileData[n],void a.onLoaded(u)):(cosnole.log("read read"),void d.read(n,l,new c(xz,xz.onReadNativeCallBack,[l,n,e,t,i,o,a])));u=""==y.rootPath?n:n.split(y.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?s.EnvConfig.load.call(a,n,e,t,i,o):d.readFile(u,l,new c(xz,xz.onReadNativeCallBack,[l,n,e,t,i,o,a]),n)}},F.resMgrLoad=function(n,i,e,t,o,a,l){void 0===e&&(e=0),void 0===t&&(t=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===l&&(l=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),s.EnvConfig.resMgrLoad(n,(n,e,t)=>{xz.prototype.resMgrLoadCallBack(n,e,t,i)},e,t,o,a,l)},F.resMgrLoadCallBack=function(n,e,t,i){console.log("buff:::",n,t,d.fileNativeDir+"///"+d.fileListName),i(n,e,t)},F.clearRes=function(n,e){this.clearRes(n,e=void 0===e?!1:e);e=d.getFileInfo(n);!e||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=e.md5,e=d.getFileNativePath(n),d.remove(e))},xz.onReadNativeCallBack=function(n,e,t,i,o,a,l,u,d){void 0===i&&(i=!0),void 0===a&&(a=!1),(u=void 0===u?0:u)?1==u&&s.EnvConfig.load.call(l,e,t,i,o,a):(u="json"==t||"atlas"==t?s.getJson(d.data):"xml"==t?w.parseXMLFromString(d.data):d.data,l.onLoaded(u),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=t&&wx.postMessage({url:e,data:u,isLoad:!0}))},n(xz,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),xz),d=(l(d1wu4t,"laya.wx.mini.MiniFileMgr",t),d1wu4t.isLoadFile=function(n){return-1!=d1wu4t._fileTypeArr.indexOf(n)},d1wu4t.getFileInfo=function(n){n=n.split("?")[0],n=d1wu4t.filesListObj[n];return null==n?null:n},d1wu4t.onFileUpdate=function(n,e){var n=n.split("/"),n=n[n.length-1],t=d1wu4t.getFileInfo(e);null==t?d1wu4t.onSaveFile(e,n):t.readyUrl!=e&&d1wu4t.remove(n,e)},d1wu4t.exits=function(n,e){n=d1wu4t.getFileNativePath(n);d1wu4t.fs.getFileInfo({filePath:n,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){null!=e&&e.runWith([1,n])}})},d1wu4t.read=function(n,e,t,i){void 0===e&&(e="ascill"),n=""!=(i=void 0===i?"":i)?d1wu4t.getFileNativePath(n):n,d1wu4t.fs.readFile({filePath:n,encoding:e,success:function(n){null!=t&&t.runWith([0,n])},fail:function(n){n&&""!=i?d1wu4t.down(i,e,t,i):null!=t&&t.runWith([1])}})},d1wu4t.readNativeFile=function(n,e){d1wu4t.fs.readFile({filePath:n,encoding:"",success:function(n){null!=e&&e.runWith([0])},fail:function(n){null!=e&&e.runWith([1])}})},d1wu4t.down=function(n,e,t,i){void 0===e&&(e="ascill"),void 0===i&&(i="");var o=d1wu4t.getFileNativePath(i);d1wu4t.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&d1wu4t.readFile(n.filePath,e,t,i)},fail:function(n){null!=t&&t.runWith([1,n])}}).onProgressUpdate(function(n){null!=t&&t.runWith([2,n.progress])})},d1wu4t.readFile=function(e,n,t,i){void 0===i&&(i=""),d1wu4t.fs.readFile({filePath:e,encoding:n=void 0===n?"ascill":n,success:function(n){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||d1wu4t.onFileUpdate(e,i),null!=t&&t.runWith([0,n])},fail:function(n){n&&null!=t&&t.runWith([1,n])}})},d1wu4t.downImg=function(n,e,t){void 0===t&&(t="");d1wu4t.wxdown({url:n,success:function(n){200===n.statusCode&&d1wu4t.copyFile(n.tempFilePath,t,e)},fail:function(n){null!=e&&e.runWith([1,n])}})},d1wu4t.copyFile=function(n,e,t){var i=n.split("/"),o=i[i.length-1],a=(e.split("?")[0],d1wu4t.getFileInfo(e)),i=d1wu4t.getFileNativePath(o);d1wu4t.fs.copyFile({srcPath:n,destPath:i,success:function(n){a?a.readyUrl!=e&&d1wu4t.remove(o,e,t):(d1wu4t.onSaveFile(e,o),null!=t&&t.runWith([0]))},fail:function(n){null!=t&&t.runWith([1,n])}})},d1wu4t.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},d1wu4t.remove=function(e,t,i){void 0===t&&(t="");var n=d1wu4t.getFileInfo(t),o=d1wu4t.getFileNativePath(n.md5);a.loader.clearRes(n.readyUrl),d1wu4t.fs.unlink({filePath:o,success:function(n){""!=t&&d1wu4t.onSaveFile(t,e),null!=i&&i.runWith([0])},fail:function(n){}})},d1wu4t.onSaveFile=function(n,e){var t=n.split("?")[0];d1wu4t.filesListObj[t]={md5:e,readyUrl:n},d1wu4t.fs.writeFile({filePath:d1wu4t.fileNativeDir+"/"+d1wu4t.fileListName,encoding:"utf8",data:JSON.stringify(d1wu4t.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},d1wu4t.existDir=function(n,e){d1wu4t.fs.mkdir({dirPath:n,success:function(n){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?d1wu4t.readSync(d1wu4t.fileListName,"utf8",e):null!=e&&e.runWith([1,n])}})},d1wu4t.readSync=function(n,e,t,i){void 0===e&&(e="ascill"),void 0===i&&(i="");var o,e=d1wu4t.getFileNativePath(n);try{o=d1wu4t.fs.readFileSync(e),null!=t&&t.runWith([0,{data:o}])}catch(n){null!=t&&t.runWith([1])}},d1wu4t.readCache=function(){},d1wu4t.writeCache=function(n){var e=readyUrl.split("?")[0];d1wu4t.filesListObj[e]={md5:md5Name,readyUrl:readyUrl},d1wu4t.fs.writeFile({filePath:d1wu4t.fileNativeDir+"/"+d1wu4t.fileListName,encoding:"utf8",data:JSON.stringify(d1wu4t.filesListObj),success:function(n){},fail:function(n){}})},d1wu4t.setNativeFileDir=function(n){d1wu4t.fileNativeDir=wx.env.USER_DATA_PATH+n},d1wu4t.filesListObj={},d1wu4t.fileNativeDir=null,d1wu4t.fileListName="layaairfiles.txt",d1wu4t.ziyuFileData={},n(d1wu4t,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),d1wu4t),x=(l($n9gk,"laya.wx.mini.MiniSound",t),(F=$n9gk.prototype).load=function(n){var e;n=y.formatURL(n),this.url=n,$n9gk._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){e.loaded=!0,e.event("complete"),$n9gk._audioCache[e.url]=e}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),e.event("error")}),this._sound.src=n,e=this)},F.play=function(n,e){var t,i;return void 0===n&&(n=0),void 0===e&&(e=0),i=(t=this.url==p._tMusic?($n9gk._musicAudio||($n9gk._musicAudio=this._sound),$n9gk._musicAudio):this._sound,this._chanell),t.src=this.url,t.startTime=0,i.isStopped&&(i.url=this.url,i.loops=e,i.startTime=n,i.play(),p.addChannel(i)),i},F.dispose=function(){var n=$n9gk._audioCache[this.url];n&&(n.src="",delete $n9gk._audioCache[this.url])},e(0,F,"duration",function(){return this._sound.duration}),$n9gk._createSound=function(){return $n9gk._id++,s.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},$n9gk._musicAudio=null,$n9gk._id=0,$n9gk._audioCache={},$n9gk._null=void 0,$n9gk),_=(l(h_of7j,"laya.wx.mini.MiniSoundChannel",m),(n=h_of7j.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,p.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},e(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),e(0,n,"duration",function(){return this._audio?this._audio.duration:0}),e(0,n,"volume",function(){return 1},function(n){}),h_of7j._null=void 0,h_of7j),C=(l(l_8fo,"laya.wx.mini.MiniVideo"),(t=l_8fo.prototype).on=function(n,e,t){"loadedmetadata"==n?(this.onPlayFunc=t.bind(e),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=t.bind(e),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},t.onTimeUpdateFunc=function(n){this.position=n.position,this._duration=n.duration},t.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},t.onended=function(n,e){this.onEndedFunC=e.bind(n),this.videoElement.onended=this.onEndedFunction.bind(this)},t.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},t.off=function(n,e,t){"loadedmetadata"==n?(this.onPlayFunc=t.bind(e),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=t.bind(e),this.videoElement.offEnded=this.onEndedFunction.bind(this))},t.load=function(n){this.videoElement&&(this.videoElement.src=n)},t.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},t.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},t.size=function(n,e){this.videoElement&&(this.videoElement.width=n,this.videoElement.height=e)},t.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},t.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},e(0,t,"duration",function(){return this._duration}),e(0,t,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(n){this.videoElement&&(this.videoElement.initialTime=n)}),e(0,t,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),e(0,t,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),e(0,t,"ended",function(){return this.videoend}),e(0,t,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(n){this.videoElement&&(this.videoElement.loop=n)}),e(0,t,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(n){this.videoElement&&(this.videoElement.playbackRate=n)}),e(0,t,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(n){this.videoElement&&(this.videoElement.muted=n)}),e(0,t,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),e(0,t,"x",function(){return this.videoElement?this.videoElement.x:0},function(n){this.videoElement&&(this.videoElement.x=n)}),e(0,t,"y",function(){return this.videoElement?this.videoElement.y:0},function(n){this.videoElement&&(this.videoElement.y=n)}),e(0,t,"currentSrc",function(){return this.videoElement.src}),e(0,t,"src",function(){return this.videoElement?this.videoElement.src:0},function(n){this.videoElement&&(this.videoElement.src=n)}),e(0,t,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(n){this.videoElement&&(this.videoElement.controls=n)}),e(0,t,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(n){this.videoElement&&(this.videoElement.autoplay=n)}),l_8fo);function l_8fo(){this.videoend=!1,this.videourl="",this.videoElement=s.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function h_of7j(n){this._audio=null,this._onEnd=null,h_of7j.__super.call(this),this.isStopped=!0,this._audio=n,this._onEnd=w.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function $n9gk(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,$n9gk.__super.call(this),this._sound=$n9gk._createSound(),this._chanell=new _(this._sound)}function d1wu4t(){d1wu4t.__super.call(this)}function xz(){}var F;function kn29sc(){}function d1uma5(){}function ay536v(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,e){"use strict";for(var t in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var i=Laya[t];i&&i.__isclass&&(e[t]=i)}});