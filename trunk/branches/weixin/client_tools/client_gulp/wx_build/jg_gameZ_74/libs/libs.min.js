var Laya=window.Laya=function($u,$_){var $c={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($_,$S){return 1==arguments.length?$c.__presubstr.call(this,$_):$c.__presubstr.call(this,$_,0<$S?$S:this.length+$S)},__init:function($_){$_.forEach(function($_){$_.__init$&&$_.__init$()})},__isClass:function($_){return $_&&($_.__isclass||$_==Object||$_==String||$_==Array)},__newvec:function($_,$S){var $j=[];$j.length=$_;for(var $O=0;$O<$_;$O++)$j[$O]=$S;return $j},__extend:function($_,$S){for(var $j in $S)if($S.hasOwnProperty($j)){var $O=Object.getOwnPropertyDescriptor($S,$j),$V=$O.get,$M=$O.set;$V||$M?$V&&$M?Object.defineProperty($_,$j,$O):($V&&Object.defineProperty($_,$j,$V),$M&&Object.defineProperty($_,$j,$M)):$_[$j]=$S[$j]}function $R(){$c.un(this,"constructor",$_)}$R.prototype=$S.prototype,$_.prototype=new $R,$c.un($_.prototype,"__imps",$c.__copy({},$S.prototype.__imps))},__copy:function($_,$S){if(!$S)return null;for(var $j in $_=$_||{},$S)$_[$j]=$S[$j];return $_},__package:function($_,$S){if(!$c.__packages[$_]){$c.__packages[$_]=!0;var $j=$u,$O=$_.split(".");if(1<$O.length)for(var $V=0,$M=$O.length-1;$V<$M;$V++){var $R=$j[$O[$V]];$j=$R||($j[$O[$V]]={})}$j[$O[$O.length-1]]||($j[$O[$O.length-1]]=$S||{})}},__hasOwnProperty:function($_,$S){return $S=$S||this,Object.hasOwnProperty.call($S,$_)||function $_($S,$j){if(Object.hasOwnProperty.call($j.prototype,$S))return!0;var $O=$j.prototype.__super;return null==$O?null:$_($S,$O)}($_,$S.__class)},__typeof:function($_,$S){if(!$_||!$S)return!1;if($S===String)return"string"==typeof $_;if($S===Number)return"number"==typeof $_;if($S.__interface__)$S=$S.__interface__;else if("string"!=typeof $S)return $_ instanceof $S;return $_.__imps&&$_.__imps[$S]||$_.__class==$S},__as:function($_,$S){return this.__typeof($_,$S)?$_:null},__int:function($_){return $_?parseInt($_):0},interface:function($_,$S){$c.__package($_,{});var $j=$c.__internals,$O=$j[$_]=$j[$_]||{self:$_};if($S){var $V=$S.split(",");$O.extend=[];for(var $M=0;$M<$V.length;$M++){var $R=$V[$M];$j[$R]=$j[$R]||{self:$R},$O.extend.push($j[$R])}}var $w=$u,$a=$_.split(".");for($M=0;$M<$a.length-1;$M++)$w=$w[$a[$M]];$w[$a[$a.length-1]]={__interface__:$_}},class:function($_,$S,$j,$O){if($j&&$c.__extend($_,$j),$S)if($c.__package($S,$_),$c.__classmap[$S]=$_,0<$S.indexOf(".")){if(0==$S.indexOf("laya.")){var $V=$S.split(".");$O=$O||$V[$V.length-1],$c[$O]&&console.log("Warning!,this class["+$O+"] already exist:",$c[$O]),$c[$O]=$_}}else"Main"==$S?$u.Main=$_:"MainWX"==$S?$u.MainWX=$_:($c[$S]&&console.log("Error!,this class["+$S+"] already exist:",$c[$S]),$c[$S]=$_);var $M=$c.un,$R=$_.prototype;$M($R,"hasOwnProperty",$c.__hasOwnProperty),$M($R,"__class",$_),$M($R,"__super",$j),$M($R,"__className",$S),$M($_,"__super",$j),$M($_,"__className",$S),$M($_,"__isclass",!0),$M($_,"super",function($_){this.__super.call($_)})},imps:function($_,$S){if(!$S)return null;var $V=$_.__imps||$c.un($_,"__imps",{});function $M($_){var $S,$j;if(($S=$c.__internals[$_])&&($V[$_]=!0,$j=$S.extend))for(var $O=0;$O<$j.length;$O++)$M($j[$O].self)}for(var $j in $S)$M($j)},superSet:function($_,$S,$j,$O){var $V=$_.prototype["_$set_"+$j];$V&&$V.call($S,$O)},superGet:function($_,$S,$j){var $O=$_.prototype["_$get_"+$j];return $O?$O.call($S):null},getset:function($_,$S,$j,$O,$V){$_?($O&&($S["_$GET_"+$j]=$O),$V&&($S["_$SET_"+$j]=$V)):($O&&$c.un($S,"_$get_"+$j,$O),$V&&$c.un($S,"_$set_"+$j,$V)),$O&&$V?Object.defineProperty($S,$j,{get:$O,set:$V,enumerable:!1,configurable:!0}):($O&&Object.defineProperty($S,$j,{get:$O,enumerable:!1,configurable:!0}),$V&&Object.defineProperty($S,$j,{set:$V,enumerable:!1,configurable:!0}))},static:function($j,$O){for(var $V=0,$_=$O.length;$V<$_;$V+=2)if("length"==$O[$V])$j.length=$O[$V+1].call($j);else{function $S(){var $S=$O[$V],$_=$O[$V+1];Object.defineProperty($j,$S,{get:function(){return delete this[$S],this[$S]=$_.call(this)},set:function($_){delete this[$S],this[$S]=$_},enumerable:!0,configurable:!0})}$S()}},un:function($_,$S,$j){return $j||($j=$_[$S]),$c.__propun.value=$j,Object.defineProperty($_,$S,$c.__propun),$j},uns:function($S,$_){$_.forEach(function($_){$c.un($S,$_)})}};return $u.console=$u.console||{log:function(){}},$u.trace=$u.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$c}(window,document);!function($_,$S,$j){$j.un,$j.uns,$j.static,$j.class,$j.getset,$j.__newvec}(window,document,Laya),function($R,$S,$f){$f.un,$f.uns;var $a=$f.static,$v=$f.class,$c=$f.getset;$f.__newvec;$f.interface("laya.runtime.IMarket"),$f.interface("laya.filters.IFilter"),$f.interface("laya.display.ILayout"),$f.interface("laya.resource.IDispose"),$f.interface("laya.runtime.IPlatform"),$f.interface("laya.resource.IDestroy"),$f.interface("laya.runtime.IConchNode"),$f.interface("laya.filters.IFilterAction"),$f.interface("laya.runtime.ICPlatformClass"),$f.interface("laya.resource.ICreateResource"),$f.interface("laya.runtime.IConchRenderObject"),$f.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $d=function(){function $M(){}return $v($M,"laya.utils.RunDriver"),$M.FILTER_ACTIONS=[],$M.pixelRatio=-1,$M._charSizeTestDiv=null,$M.now=function(){return Date.now()},$M.getWindow=function(){return $R},$M.getPixelRatio=function(){if($M.pixelRatio<0){var $_=$m.context,$S=$_.backingStorePixelRatio||$_.webkitBackingStorePixelRatio||$_.mozBackingStorePixelRatio||$_.msBackingStorePixelRatio||$_.oBackingStorePixelRatio||$_.backingStorePixelRatio||1;($M.pixelRatio=($m.window.devicePixelRatio||1)/$S)<1&&($M.pixelRatio=1)}return $M.pixelRatio},$M.getIncludeStr=function($_){return null},$M.createShaderCondition=function($_){var $S="(function() {return "+$_+";})";return $f._runScript($S)},$M.fontMap=[],$M.measureText=function($_,$S){var $j=$M.hanzi.test($_);if($j&&$M.fontMap[$S])return $M.fontMap[$S];var $O=$m.context;$O.font=$S;var $V=$O.measureText($_);return $V||($V={width:16,height:16}),$j&&($M.fontMap[$S]=$V),$V},$M.getWebGLContext=function($_){},$M.beginFlush=function(){},$M.endFinish=function(){},$M.addToAtlas=null,$M.flashFlushImage=function($_){},$M.drawToCanvas=function($_,$S,$j,$O,$V,$M){var $R=$k_.create("2D"),$w=new $h($j,$O,$R);return $N.renders[$S]._fun($_,$w,$V,$M),$R},$M.createParticleTemplate2D=null,$M.createGLTextur=null,$M.createWebGLContext2D=null,$M.changeWebGLSize=function($_,$S){},$M.createRenderSprite=function($_,$S){return new $N($_,$S)},$M.createFilterAction=function($_){return new $k},$M.createGraphics=function(){return new $s},$M.clear=function($_){$x._context.ctx.clear()},$M.cancelLoadByUrl=function($_){},$M.clearAtlas=function($_){},$M.isAtlas=function($_){return!1},$M.addTextureToAtlas=function($_){},$M.getTexturePixels=function($_,$S,$j,$O,$V){return null},$M.skinAniSprite=function(){return null},$M.update3DLoop=function(){},$a($M,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$M}(),$O=($c(1,$f,"alertGlobalError",null,function($_){var $M=0;$m.window.onerror=$_?function($_,$S,$j,$O,$V){$M++<5&&$V&&alert($V.stack||$V)}:null}),$f.init=function($_,$S,$j){for(var $O=[],$V=2,$M=arguments.length;$V<$M;$V++)$O.push(arguments[$V]);if(!$f._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$f._arrayBufferSlice),$f._isinit=!0,$m.__init__(),$B.__init__(),$s.__init__(),$f.timer=new $p,$f.scaleTimer=new $p,$f.loader=new $a_,$r.__init__(),$V=0;for(var $R=$O.length;$V<$R;$V++)$O[$V].enable&&$O[$V].enable();return $C.__init__(),$w.__init__(),$t.__init__(),$G.beginCheck(),$f._currentStage=$f.stage=new $o_,$f.stage.conchModel&&$f.stage.conchModel.setRootNode(),$f._getUrlPath(),$f.render=new $x(0,0),$f.stage.size($_,$S),$N.__init__(),$q.__init__(),$i.instance.__init__($f.stage,$x.canvas),$H_.__init__(),$$.autoStopMusic=!0,$g.__init__(),$x.canvas}},$f._getUrlPath=function(){var $_=$m.window.location,$S=$_.pathname;$S=$S&&":"==$S.charAt(2)?$S.substring(1):$S,$F.rootPath=$F.basePath=$F.getPath("file:"==$_.protocol?$S:$_.protocol+"//"+$_.host+$_.pathname)},$f._arrayBufferSlice=function($_,$S){var $j=new Uint8Array(this,$_,$S-$_),$O=new Uint8Array($j.length);return $O.set($j),$O.buffer},$f._runScript=function($_){return $m.window[$f._evcode]($_)},$f.stage=null,$f.timer=null,$f.scaleTimer=null,$f.loader=null,$f.version="1.8.6",$f.render=null,$f._currentStage=null,$f._isinit=!1,$f.isDebug=!1,$f.MiniAdpter={init:function(){$R.navigator&&$R.navigator.userAgent&&-1<$R.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$a($f,["conchMarket",function(){return this.conchMarket=$R.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$R.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $_(){}return $v($_,"Config"),$_.WebGLTextCacheCount=500,$_.atlasEnable=!1,$_.showCanvasMark=!1,$_.animationInterval=50,$_.isAntialias=!1,$_.isAlpha=!1,$_.premultipliedAlpha=!0,$_.isStencil=!0,$_.preserveDrawingBuffer=!1,$_}()),$u=function(){function $u(){this._events=null}$v($u,"laya.events.EventDispatcher");var $_=$u.prototype;return $_.hasListener=function($_){return!!(this._events&&this._events[$_])},$_.getListener=function($_){return this._events?this._events[$_]:null},$_.event=function($_,$S){if(!this._events||!this._events[$_])return!1;var $j=this._events[$_];if($j.lock)$j.queue||($j.queue=[]),$j.queue.push($S);else{var $O;for($j.lock=!0,$j.cursor=$j.head;$j.cursor;)($O=$j.cursor).recover?($j.head=$j.tail=$j.cursor=null,console.error("node is recover："+$O.id)):($j.cursor=$O.next,$O.once&&$u.delNode($j,$O),$O.method&&(null!=$S?$O.args?$O.method.apply($O.caller,$O.args.concat($S)):$S instanceof Array?$O.method.apply($O.caller,$S):$O.caller?$O.method.call($O.caller,$S):$f.recordError("事件派发错误","node.caller:"+$O.caller+"node.method:"+$O.method+"data:"+$S+"node.prev"+$O.prev):$O.method.apply($O.caller,$O.args)),$O.once&&$u.recoverHandler($O));$j.lock=!1,!$j.head&&this._events&&this._events[$_]==$j&&delete this._events[$_],$j.queue&&$j.queue.length&&this.event($_,$j.queue.shift())}return!0},$_.on=function($_,$S,$j,$O){return this._createListener($_,$S,$j,$O,!1)},$_.once=function($_,$S,$j,$O){return this._createListener($_,$S,$j,$O,!0)},$_._createListener=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=!0),$M&&this.off($_,$S,$j,$V);var $R=$u.createHandler($S||this,$j,$O,$V);this._events||(this._events={});var $w=this._events,$a=$w[$_];return $a?$a.tail?($R.prev=$a.tail,$a.tail.next=$R,$a.tail=$R):$a.head=$a.tail=$R:$w[$_]={head:$R,tail:$R,cursor:null,lock:!1},this},$_.off=function($_,$S,$j,$O){if(void 0===$O&&($O=!1),!this._events||!this._events[$_])return this;for(var $V=this._events[$_],$M=$V.head;$M;){if((!$S||$M.caller===$S)&&$M.method===$j&&(!$O||$M.once)){$u.delNode($V,$M),$V.cursor==$M&&($V.cursor=$M.next),$u.recoverHandler($M);break}$M=$M.next}return this},$_.offAll=function($_){var $S=this._events;if(!$S)return this;if($_)this._recoverHandlers($S[$_]),delete $S[$_];else{for(var $j in $S)this._recoverHandlers($S[$j]);this._events=null}return this},$_._recoverHandlers=function($_){if($_){for(var $S=$_.head;$S;){$u.delNode($_,$S);var $j=$S.next;$u.recoverHandler($S),$S=$j}$_.cursor=null}},$_.isMouseEvent=function($_){return $u.MOUSE_EVENTS[$_]},$u.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$u.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$u.delNode=function($_,$S){$S.prev?$S.prev.next=$S.next:$_.head=$S.next,$S.next?$S.next.prev=$S.prev:$_.tail=$S.prev},$u.createHandler=function($_,$S,$j,$O){var $V=500<$u._freeHandler.length?$u._freeHandler.shift():null;if($V)if($V.recover)$V.recover=!1,$V.caller=$_,$V.method=$S,$V.args=$j,$V.once=$O;else{var $M="";try{arguments.propertyIsEnumerable.caller}catch($_){$M=$_.stack}var $R=$V.caller?($V.caller.__proto__&&$V.caller.__proto__.constructor&&$V.caller.__proto__.constructor.name)+"|"+$V.caller.__className+"|"+$V.caller.name:"",$w=$V.method?$V.method.name:"";$f.recordError("EventDispatcher重复创建","caller="+$R+"  method="+$w+"  stack="+$M),$V={id:++$u._nodeCount,caller:$_,method:$S,args:$j,once:$O,recover:!1}}else $V={id:++$u._nodeCount,caller:$_,method:$S,args:$j,once:$O,recover:!1};return $V.prev=$V.next=null,$V},$u.recoverHandler=function($_){if($_.recover){if($u._errorCount<5){$u._errorCount++;var $S="";try{arguments.propertyIsEnumerable.caller}catch($_){$S=$_.stack}var $j=$_.caller?($_.caller.__proto__&&$_.caller.__proto__.constructor&&$_.caller.__proto__.constructor.name)+"|"+$_.caller.__className+"|"+$_.caller.name:"",$O=$_.method?$_.method.name:"";$f.recordError("EventDispatcher重复回收","id="+$_.id+"  caller="+$j+"  method="+$O+"  stack="+$S)}$_.caller=$_.method=$_.args=$_.prev=null}else $_.recover=!0,$_.caller=$_.method=$_.args=$_.prev=$_.next=null,$u._freeHandler&&$u._freeHandler.length<3e3&&$u._freeHandler.push($_)},$u._freeHandler=[],$u._nodeCount=0,$u._errorCount=0,$u}(),$l=function(){function $V($_,$S,$j,$O){this.once=!1,void(this._id=0)===$O&&($O=!1),this.setTo($_,$S,$j,$O)}$v($V,"laya.utils.Handler");var $_=$V.prototype;return $_.setTo=function($_,$S,$j,$O){return this._id=$V._gid++,this.caller=$_,this.method=$S,this.args=$j,this.once=$O,this},$_.run=function(){if(null==this.method)return null;var $_=this._id,$S=this.method.apply(this.caller,this.args);return this._id===$_&&this.once&&this.recover(),$S},$_.runWith=function($_){if(null==this.method)return null;var $S=this._id;if(null==$_)var $j=this.method.apply(this.caller,this.args);else $j=this.args||$_.unshift?this.args?this.method.apply(this.caller,this.args.concat($_)):this.method.apply(this.caller,$_):this.method.call(this.caller,$_);return this._id===$S&&this.once&&this.recover(),$j},$_.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$_.recover=function(){0<this._id&&(this._id=0,this.clear())},$V.create=function($_,$S,$j,$O){return void 0===$O&&($O=!0),new $V($_,$S,$j,$O)},$V._gid=1,$V}(),$E=function(){function $_(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$v($_,"laya.display.BitmapFont");var $S=$_.prototype;return $S.loadFont=function($_,$S){this._path=$_,this._complete=$S,$f.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$l.create(this,this.onLoaded))},$S.onLoaded=function(){this.parseFont($w_.getRes(this._path),$w_.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$S.parseFont=function($_,$S){if(null!=$_&&null!=$S){this._texture=$S;var $j=$_.getElementsByTagName("info");if(!$j[0].getAttributeNode)return this.parseFont2($_,$S);this.fontSize=parseInt($j[0].getAttributeNode("size").nodeValue);var $O,$V=$j[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($V[0]),parseInt($V[1]),parseInt($V[2]),parseInt($V[3])],$O=$_.getElementsByTagName("char");var $M=0;for($M=0;$M<$O.length;$M++){var $R=$O[$M],$w=parseInt($R.getAttributeNode("id").nodeValue),$a=parseInt($R.getAttributeNode("xoffset").nodeValue)/1,$u=parseInt($R.getAttributeNode("yoffset").nodeValue)/1,$c=parseInt($R.getAttributeNode("xadvance").nodeValue)/1,$q=new $P;$q.x=parseInt($R.getAttributeNode("x").nodeValue),$q.y=parseInt($R.getAttributeNode("y").nodeValue),$q.width=parseInt($R.getAttributeNode("width").nodeValue),$q.height=parseInt($R.getAttributeNode("height").nodeValue);var $s=$c_.create($S,$q.x,$q.y,$q.width,$q.height,$a,$u);this._maxWidth=Math.max(this._maxWidth,$c+this.letterSpacing),this._fontCharDic[$w]=$s,this._fontWidthMap[$w]=$c}}},$S.parseFont2=function($_,$S){if(null!=$_&&null!=$S){this._texture=$S;var $j=$_.getElementsByTagName("info");this.fontSize=parseInt($j[0].attributes.size.nodeValue);var $O=$j[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($O[0]),parseInt($O[1]),parseInt($O[2]),parseInt($O[3])];var $V=$_.getElementsByTagName("char"),$M=0;for($M=0;$M<$V.length;$M++){var $R=$V[$M].attributes,$w=parseInt($R.id.nodeValue),$a=parseInt($R.xoffset.nodeValue)/1,$u=parseInt($R.yoffset.nodeValue)/1,$c=parseInt($R.xadvance.nodeValue)/1,$q=new $P;$q.x=parseInt($R.x.nodeValue),$q.y=parseInt($R.y.nodeValue),$q.width=parseInt($R.width.nodeValue),$q.height=parseInt($R.height.nodeValue);var $s=$c_.create($S,$q.x,$q.y,$q.width,$q.height,$a,$u);this._maxWidth=Math.max(this._maxWidth,$c+this.letterSpacing),this._fontCharDic[$w]=$s,this._fontWidthMap[$w]=$c}}},$S.getCharTexture=function($_){return this._fontCharDic[$_.charCodeAt(0)]},$S.destroy=function(){if(this._texture){for(var $_ in this._fontCharDic){var $S=this._fontCharDic[$_];$S&&$S.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$S.setSpaceWidth=function($_){this._spaceWidth=$_},$S.getCharWidth=function($_){var $S=$_.charCodeAt(0);return this._fontWidthMap[$S]?this._fontWidthMap[$S]+this.letterSpacing:" "==$_?this._spaceWidth+this.letterSpacing:0},$S.getTextWidth=function($_){for(var $S=0,$j=0,$O=$_.length;$j<$O;$j++)$S+=this.getCharWidth($_.charAt($j));return $S},$S.getMaxWidth=function(){return this._maxWidth},$S.getMaxHeight=function(){return this.fontSize},$S.drawText=function($_,$S,$j,$O,$V,$M){var $R,$w=this.getTextWidth($_),$a=0;"center"===$V&&($a=($M-$w)/2),"right"===$V&&($a=$M-$w);for(var $u=0,$c=0,$q=$_.length;$c<$q;$c++)($R=this.getCharTexture($_.charAt($c)))&&($S.graphics.drawTexture($R,$j+$u+$a,$O),$u+=this.getCharWidth($_.charAt($c)))},$_}(),$w=function(){function $j(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$j._TF_EMPTY}$v($j,"laya.display.css.Style");var $_=$j.prototype;return $_.getTransform=function(){return this._tf},$_.setTransform=function($_){this._tf="none"!==$_&&$_?$_:$j._TF_EMPTY},$_.setTranslateX=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.translateX=$_},$_.setTranslateY=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.translateY=$_},$_.setScaleX=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.scaleX=$_},$_.setScale=function($_,$S){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.scaleX=$_,this._tf.scaleY=$S},$_.setScaleY=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.scaleY=$_},$_.setRotate=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.rotate=$_},$_.setSkewX=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.skewX=$_},$_.setSkewY=function($_){this._tf===$j._TF_EMPTY&&(this._tf=new $V),this._tf.skewY=$_},$_.destroy=function(){this.scrollRect=null},$_.render=function($_,$S,$j,$O){},$_.getCSSStyle=function(){return $S_.EMPTY},$_._enableLayout=function(){return!1},$c(0,$_,"scaleX",function(){return this._tf.scaleX},function($_){this.setScaleX($_)}),$c(0,$_,"transform",function(){return this.getTransform()},function($_){this.setTransform($_)}),$c(0,$_,"translateX",function(){return this._tf.translateX},function($_){this.setTranslateX($_)}),$c(0,$_,"translateY",function(){return this._tf.translateY},function($_){this.setTranslateY($_)}),$c(0,$_,"scaleY",function(){return this._tf.scaleY},function($_){this.setScaleY($_)}),$c(0,$_,"block",function(){return 0!=(1&this._type)}),$c(0,$_,"skewY",function(){return this._tf.skewY},function($_){this.setSkewY($_)}),$c(0,$_,"rotate",function(){return this._tf.rotate},function($_){this.setRotate($_)}),$c(0,$_,"skewX",function(){return this._tf.skewX},function($_){this.setSkewX($_)}),$c(0,$_,"paddingLeft",function(){return 0}),$c(0,$_,"paddingTop",function(){return 0}),$c(0,$_,"absolute",function(){return!0}),$j.__init__=function(){$j._TF_EMPTY=new $V,$j.EMPTY=new $j},$j.EMPTY=null,$j._TF_EMPTY=null,$j}(),$C=function(){function $S($_){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$L.create($S.defaultColor),this.family=$S.defaultFamily,this.stroke=$S._STROKE,this.size=$S.defaultSize,$_&&$_!==$S.EMPTY&&$_.copyTo(this)}$v($S,"laya.display.css.Font");var $_=$S.prototype;return $_.set=function($_){this._text=null;for(var $S=$_.split(" "),$j=0,$O=$S.length;$j<$O;$j++){var $V=$S[$j];switch($V){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$V.indexOf("px")&&(this.size=parseInt($V),this.family=$S[$j+1],$j++)}},$_.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$_.copyTo=function($_){$_._type=this._type,$_._text=this._text,$_._weight=this._weight,$_._color=this._color,$_.family=this.family,$_.stroke=this.stroke!=$S._STROKE?this.stroke.slice():$S._STROKE,$_.indent=this.indent,$_.size=this.size},$c(0,$_,"password",function(){return 0!=(1024&this._type)},function($_){$_?this._type|=1024:this._type&=-1025}),$c(0,$_,"color",function(){return this._color.strColor},function($_){this._color=$L.create($_)}),$c(0,$_,"italic",function(){return 0!=(512&this._type)},function($_){$_?this._type|=512:this._type&=-513}),$c(0,$_,"bold",function(){return 0!=(2048&this._type)},function($_){$_?this._type|=2048:this._type&=-2049}),$c(0,$_,"weight",function(){return""+this._weight},function($_){var $S=0;switch($_){case"normal":break;case"bold":this.bold=!0,$S=700;break;case"bolder":$S=800;break;case"lighter":$S=100;break;default:$S=parseInt($_)}this._weight=$S,this._text=null}),$c(0,$_,"decoration",function(){return this._decoration?this._decoration.value:null},function($_){var $S=$_.split(" ");switch(this._decoration||(this._decoration={}),$S[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$S[0]}$S[1]&&(this._decoration.color=$L.create($S)),this._decoration.value=$_}),$S.__init__=function(){$S.EMPTY=new $S(null)},$S.EMPTY=null,$S.defaultColor="#000000",$S.defaultSize=12,$S.defaultFamily="Arial",$S.defaultFont="12px Arial",$S._STROKE=[0,"#000000"],$S._ITALIC=512,$S._PASSWORD=1024,$S._BOLD=2048,$S}(),$V=function(){function $_(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $v($_,"laya.display.css.TransformInfo"),$_}(),$s=function(){function $q(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$x.isConchNode){this._nativeObj=new $R._conchGraphics,this.id=this._nativeObj.conchID}}$v($q,"laya.display.Graphics");var $_=$q.prototype;return $_.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$_.clear=function($_){void 0===$_&&($_=!1);var $S=0,$j=0;if($_){var $O=this._one;if(this._cmds){for($j=this._cmds.length,$S=0;$S<$j;$S++)!($O=this._cmds[$S])||$O.callee!==$x._context._drawTexture&&$O.callee!==$x._context._drawTextureWithTransform||($O[0]=null,$q._cache.push($O));this._cmds.length=0}else $O&&(!$O||$O.callee!==$x._context._drawTexture&&$O.callee!==$x._context._drawTextureWithTransform||($O[0]=null,$q._cache.push($O)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($S=0,$j=this._vectorgraphArray.length;$S<$j;$S++)$X.getInstance().deleteShape(this._vectorgraphArray[$S]);this._vectorgraphArray.length=0}},$_._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$_._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $j,this._graphicBounds._graphics=this)},$_._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$_._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$_.getBounds=function($_){return void 0===$_&&($_=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($_)},$_.getBoundPoints=function($_){return void 0===$_&&($_=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($_)},$_._addCmd=function($_){this._cmds=this._cmds||[],$_.callee=$_.shift(),this._cmds.push($_)},$_.setFilters=function($_){this._saveToCmd($x._context._setFilters,$_)},$_.drawTexture=function($_,$S,$j,$O,$V,$M,$R){if(void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$R&&($R=1),!$_||$R<.01)return null;$O||($O=$_.sourceWidth),$V||($V=$_.sourceHeight),$R=$R<0?0:1<$R?1:$R;var $w,$a=!$x.isWebGL&&($m.onFirefox||$m.onEdge||$m.onIE||$m.onSafari)?.5:0,$u=$O/$_.sourceWidth,$c=$V/$_.sourceHeight;return $O=$_.width*$u,$V=$_.height*$c,$_.loaded&&($O<=0||$V<=0)?null:($S+=$_.offsetX*$u,$j+=$_.offsetY*$c,this._sp&&(this._sp._renderType|=512),$S-=$a,$j-=$a,$O+=2*$a,$V+=2*$a,$q._cache.length?(($w=$q._cache.pop())[0]=$_,$w[1]=$S,$w[2]=$j,$w[3]=$O,$w[4]=$V,$w[5]=$M,$w[6]=$R):$w=[$_,$S,$j,$O,$V,$M,$R],$w.callee=$M||1!=$R?$x._context._drawTextureWithTransform:$x._context._drawTexture,null!=this._one||$M||1!=$R?this._saveToCmd($w.callee,$w):(this._one=$w,this._render=this._renderOneImg),$_.loaded||$_.once("loaded",this,this._textureLoaded,[$_,$w]),this._repaint(),$w)},$_.cleanByTexture=function($_,$S,$j,$O,$V){if(void 0===$O&&($O=0),void 0===$V&&($V=0),!$_)return this.clear();if(this._one&&this._render===this._renderOneImg){$O||($O=$_.sourceWidth),$V||($V=$_.sourceHeight);var $M=$O/$_.sourceWidth,$R=$V/$_.sourceHeight;$O=$_.width*$M,$V=$_.height*$R,$S+=$_.offsetX*$M,$j+=$_.offsetY*$R,this._one[0]=$_,this._one[1]=$S,this._one[2]=$j,this._one[3]=$O,this._one[4]=$V,this._repaint()}else this.clear(),$_&&this.drawTexture($_,$S,$j,$O,$V)},$_.drawTextures=function($_,$S){$_&&this._saveToCmd($x._context._drawTextures,[$_,$S])},$_.fillTexture=function($_,$S,$j,$O,$V,$M,$R){if(void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$M&&($M="repeat"),$_){var $w=[$_,$S,$j,$O,$V,$M,$R||$y.EMPTY,{}];$_.loaded||$_.once("loaded",this,this._textureLoaded,[$_,$w]),this._saveToCmd($x._context._fillTexture,$w)}},$_._textureLoaded=function($_,$S){$S[3]=$S[3]||$_.width,$S[4]=$S[4]||$_.height,this._repaint()},$_.fillCircle=function($_,$S,$j,$O,$V,$M,$R){$j.bitmap.enableMerageInAtlas=!1;var $w=new Float32Array(2*($R+1)),$a=new Float32Array(2*($R+1)),$u=new Uint16Array(3*$R),$c=2*Math.PI/$R,$q=0;$w[0]=$O,$w[1]=$V,$a[0]=$O/$j.width,$a[1]=$V/$j.height;for(var $s=2,$C=0;$C<$R;$C++){var $i=$M*Math.cos($q)+$O,$v=$M*Math.sin($q)+$V;$w[$s]=$i,$w[$s+1]=$v,$a[$s]=$i/$j.width,$a[$s+1]=$v/$j.height,$q+=$c,$s+=2}for($C=$s=0;$C<$R;$C++)$u[$s++]=0,$u[$s++]=$C+1,$u[$s++]=$R+1<=$C+2?1:$C+2;this.drawTriangles($j,$_,$S,$w,$a,$u)},$_.drawTriangles=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){void 0===$w&&($w=1),this._saveToCmd($x._context.drawTriangles,[$_,$S,$j,$O,$V,$M,$R,$w,$a,$u])},$_._saveToCmd=function($_,$S){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$S,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($S)),$S.callee=$_,this._repaint(),$S},$_.clipRect=function($_,$S,$j,$O){this._saveToCmd($x._context._clipRect,[$_,$S,$j,$O])},$_.fillText=function($_,$S,$j,$O,$V,$M,$R){void 0===$R&&($R=0),this._saveToCmd($x._context._fillText,[$_,$S,$j,$O||$C.defaultFont,$V,$M])},$_.fillBorderText=function($_,$S,$j,$O,$V,$M,$R,$w){this._saveToCmd($x._context._fillBorderText,[$_,$S,$j,$O||$C.defaultFont,$V,$M,$R,$w])},$_.strokeText=function($_,$S,$j,$O,$V,$M,$R){this._saveToCmd($x._context._strokeText,[$_,$S,$j,$O||$C.defaultFont,$V,$M,$R])},$_.alpha=function($_){$_=$_<0?0:1<$_?1:$_,this._saveToCmd($x._context._alpha,[$_])},$_.setAlpha=function($_){$_=$_<0?0:1<$_?1:$_,this._saveToCmd($x._context._setAlpha,[$_])},$_.transform=function($_,$S,$j){void 0===$S&&($S=0),void 0===$j&&($j=0),this._saveToCmd($x._context._transform,[$_,$S,$j])},$_.rotate=function($_,$S,$j){void 0===$S&&($S=0),void 0===$j&&($j=0),this._saveToCmd($x._context._rotate,[$_,$S,$j])},$_.scale=function($_,$S,$j,$O){void 0===$j&&($j=0),void 0===$O&&($O=0),this._saveToCmd($x._context._scale,[$_,$S,$j,$O])},$_.translate=function($_,$S){this._saveToCmd($x._context._translate,[$_,$S])},$_.save=function(){this._saveToCmd($x._context._save,[])},$_.restore=function(){this._saveToCmd($x._context._restore,[])},$_.replaceText=function($_){this._repaint();var $S=this._cmds;if($S){for(var $j=$S.length-1;-1<$j;$j--)if(this._isTextCmd($S[$j].callee))return $S[$j][0].toUpperCase?$S[$j][0]=$_:$S[$j][0].setText($_),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$_:this._one[0].setText($_),!0;return!1},$_._isTextCmd=function($_){return $_===$x._context._fillText||$_===$x._context._fillBorderText||$_===$x._context._strokeText},$_.replaceTextColor=function($_){this._repaint();var $S=this._cmds;if($S)for(var $j=$S.length-1;-1<$j;$j--)this._isTextCmd($S[$j].callee)&&($S[$j][4]=$_,$S[$j][0].toUpperCase||($S[$j][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$_,this._one[0].toUpperCase||(this._one[0].changed=!0))},$_.loadImage=function($_,$S,$j,$O,$V,$M){var $R=this;void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0);var $w=$w_.getRes($_);function $a($_){$_&&($R.drawTexture($_,$S,$j,$O,$V),null!=$M&&$M.call($R._sp,$_))}$w?$a($w):$f.loader.load($_,$l.create(null,$a),null,"image")},$_._renderEmpty=function($_,$S,$j,$O){},$_._renderAll=function($_,$S,$j,$O){for(var $V,$M=this._cmds,$R=0,$w=$M.length;$R<$w;$R++)($V=$M[$R]).callee.call($S,$j,$O,$V)},$_._renderOne=function($_,$S,$j,$O){this._one.callee.call($S,$j,$O,this._one)},$_._renderOneImg=function($_,$S,$j,$O){this._one.callee.call($S,$j,$O,this._one),2305!==$_._renderType&&($_._renderType|=1)},$_.drawLine=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=1);var $R=0;$x.isWebGL&&($R=$X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($R));var $w=$M%2==0?0:.5,$a=[$_+$w,$S+$w,$j+$w,$O+$w,$V,$M,$R];this._saveToCmd($x._context._drawLine,$a)},$_.drawLines=function($_,$S,$j,$O,$V){void 0===$V&&($V=1);var $M=0;if($j&&!($j.length<4)){$x.isWebGL&&($M=$X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($M));var $R=$V%2==0?0:.5,$w=[$_+$R,$S+$R,$j,$O,$V,$M];this._saveToCmd($x._context._drawLines,$w)}},$_.drawCurves=function($_,$S,$j,$O,$V){void 0===$V&&($V=1);var $M=[$_,$S,$j,$O,$V];this._saveToCmd($x._context._drawCurves,$M)},$_.drawRect=function($_,$S,$j,$O,$V,$M,$R){void 0===$R&&($R=1);var $w=$M?$R/2:0,$a=$M?$R:0,$u=[$_+$w,$S+$w,$j-$a,$O-$a,$V,$M,$R];this._saveToCmd($x._context._drawRect,$u)},$_.drawCircle=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=1);var $R=$V?$M/2:0,$w=0;$x.isWebGL&&($w=$X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($w));var $a=[$_,$S,$j-$R,$O,$V,$M,$w];this._saveToCmd($x._context._drawCircle,$a)},$_.drawPie=function($_,$S,$j,$O,$V,$M,$R,$w){void 0===$w&&($w=1);var $a=$R?$w/2:0,$u=$R?$w:0,$c=0;$x.isWebGL&&($c=$X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($c));var $q=[$_+$a,$S+$a,$j-$u,$O,$V,$M,$R,$w,$c];$q[3]=$K.toRadian($O),$q[4]=$K.toRadian($V),this._saveToCmd($x._context._drawPie,$q)},$_.drawPoly=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=1);var $R=0,$w=!1;$x.isWebGL&&($R=$X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($R),$w=!(6<$j.length));var $a=$V?$M%2==0?0:.5:0,$u=[$_+$a,$S+$a,$j,$O,$V,$M,$R,$w];this._saveToCmd($x._context._drawPoly,$u)},$_.drawPath=function($_,$S,$j,$O,$V){var $M=[$_,$S,$j,$O,$V];this._saveToCmd($x._context._drawPath,$M)},$c(0,$_,"cmds",function(){return this._cmds},function($_){this._sp&&(this._sp._renderType|=512),this._cmds=$_,this._render=this._renderAll,this._repaint()}),$q.__init__=function(){if($x.isConchNode){for(var $_=laya.display.Graphics.prototype,$S=$m.window.ConchGraphics.prototype,$j=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$O=0,$V=$j.length;$O<=$V;$O++){var $M=$j[$O];$_[$M]=$S[$M]}$_._saveToCmd=null,$S.drawImageS&&($_.drawTextures=function($_,$S){if($_&&$_.loaded&&$_.bitmap&&$_.source){var $j=$_.uv,$O=$_.bitmap.width,$V=$_.bitmap.height;this.drawImageS($_.bitmap.source,$j[0]*$O,$j[1]*$V,($j[2]-$j[0])*$O,($j[5]-$j[3])*$V,$_.offsetX,$_.offsetY,$_.width,$_.height,$S)}}),$_.drawTexture=function($_,$S,$j,$O,$V,$M,$R){if(void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$R&&($R=1),$_)if($_.loaded){if($_.loaded&&$_.bitmap&&$_.source&&($O||($O=$_.sourceWidth),$V||($V=$_.sourceHeight),$R=$R<0?0:1<$R?1:$R,$O=$O-$_.sourceWidth+$_.width,$V=$V-$_.sourceHeight+$_.height,!($O<=0||$V<=0))){$S+=$_.offsetX,$j+=$_.offsetY;var $w=$_.uv,$a=$_.bitmap.width,$u=$_.bitmap.height;$w[4]<$w[0]&&$w[5]<$w[1]?this.drawImageM($_.bitmap.source,$w[4]*$a,$w[5]*$u,($w[0]-$w[4])*$a,($w[1]-$w[5])*$u,$S,$j,$O,$V,$M,$R):this.drawImageM($_.bitmap.source,$w[0]*$a,$w[1]*$u,($w[2]-$w[0])*$a,($w[5]-$w[3])*$u,$S,$j,$O,$V,$M,$R),this._repaint()}}else $_.once("loaded",this,function(){this.drawTexture($_,$S,$j,$O,$V,$M)})},$_.fillTexture=function($_,$S,$j,$O,$V,$M,$R){if(void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$M&&($M="repeat"),$_&&$_.loaded){var $w,$a=$x._context.ctx,$u=$_.bitmap.width,$c=$_.bitmap.height,$q=$_.uv;$w=$_.uv!=$c_.DEF_UV?$a.createPattern($_.bitmap.source,$M,$q[0]*$u,$q[1]*$c,($q[2]-$q[0])*$u,($q[5]-$q[3])*$c):$a.createPattern($_.bitmap.source,$M);var $s=0,$C=0;$R&&($S+=$R.x%$_.width,$j+=$R.y%$_.height,$s-=$R.x%$_.width,$C-=$R.y%$_.height),this._fillImage($w,$S,$j,$s,$C,$O,$V)}}}},$q._cache=[],$q}(),$j=function(){function $k(){this._cacheBoundsType=!1}$v($k,"laya.display.GraphicsBounds");var $_=$k.prototype;return $_.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$_.reset=function(){this._temp&&(this._temp.length=0)},$_.getBounds=function($_){return void 0===$_&&($_=!1),(!this._bounds||!this._temp||this._temp.length<1||$_!=this._cacheBoundsType)&&(this._bounds=$P._getWrapRec(this.getBoundPoints($_),this._bounds)),this._cacheBoundsType=$_,this._bounds},$_.getBoundPoints=function($_){return void 0===$_&&($_=!1),(!this._temp||this._temp.length<1||$_!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($_)),this._cacheBoundsType=$_,this._rstBoundPoints=$K.copyArray(this._rstBoundPoints,this._temp)},$_._getCmdPoints=function($_){void 0===$_&&($_=!1);var $S,$j,$O=$x._context,$V=this._graphics.cmds;if(($S=this._temp||(this._temp=[])).length=0,$V||null==this._graphics._one||($k._tempCmds.length=0,$k._tempCmds.push(this._graphics._one),$V=$k._tempCmds),!$V)return $S;($j=$k._tempMatrixArrays).length=0;var $M=$k._initMatrix;$M.identity();for(var $R,$w,$a=$k._tempMatrix,$u=NaN,$c=NaN,$q=NaN,$s=NaN,$C=NaN,$i=NaN,$v=0,$Z=$V.length;$v<$Z;$v++)if(($R=$V[$v]).callee)switch($R.callee){case $O._save:case 7:$j.push($M),$M=$M.clone();break;case $O._restore:case 8:$M=$j.pop();break;case $O._scale:case 5:$a.identity(),$a.translate(-$R[2],-$R[3]),$a.scale($R[0],$R[1]),$a.translate($R[2],$R[3]),this._switchMatrix($M,$a);break;case $O._rotate:case 3:$a.identity(),$a.translate(-$R[1],-$R[2]),$a.rotate($R[0]),$a.translate($R[1],$R[2]),this._switchMatrix($M,$a);break;case $O._translate:case 6:$a.identity(),$a.translate($R[0],$R[1]),this._switchMatrix($M,$a);break;case $O._transform:case 4:$a.identity(),$a.translate(-$R[1],-$R[2]),$a.concat($R[0]),$a.translate($R[1],$R[2]),this._switchMatrix($M,$a);break;case 16:case 24:$k._addPointArrToRst($S,$P._getBoundPointS($R[0],$R[1],$R[2],$R[3]),$M);break;case 17:$M.copyTo($a),$a.concat($R[4]),$k._addPointArrToRst($S,$P._getBoundPointS($R[0],$R[1],$R[2],$R[3]),$a);break;case $O._drawTexture:$w=$R[0],$_?$R[3]&&$R[4]?$k._addPointArrToRst($S,$P._getBoundPointS($R[1],$R[2],$R[3],$R[4]),$M):($w=$R[0],$k._addPointArrToRst($S,$P._getBoundPointS($R[1],$R[2],$w.width,$w.height),$M)):($u=($R[3]||$w.sourceWidth)/$w.width,$c=($R[4]||$w.sourceHeight)/$w.height,$q=$u*$w.sourceWidth,$s=$c*$w.sourceHeight,$C=0<$w.offsetX?$w.offsetX:0,$i=0<$w.offsetY?$w.offsetY:0,$C*=$u,$i*=$c,$k._addPointArrToRst($S,$P._getBoundPointS($R[1]-$C,$R[2]-$i,$q,$s),$M));break;case $O._fillTexture:$R[3]&&$R[4]?$k._addPointArrToRst($S,$P._getBoundPointS($R[1],$R[2],$R[3],$R[4]),$M):($w=$R[0],$k._addPointArrToRst($S,$P._getBoundPointS($R[1],$R[2],$w.width,$w.height),$M));break;case $O._drawTextureWithTransform:var $o;$o=$R[5]?($M.copyTo($a),$a.concat($R[5]),$a):$M,$_?$R[3]&&$R[4]?$k._addPointArrToRst($S,$P._getBoundPointS($R[1],$R[2],$R[3],$R[4]),$o):($w=$R[0],$k._addPointArrToRst($S,$P._getBoundPointS($R[1],$R[2],$w.width,$w.height),$o)):($w=$R[0],$u=($R[3]||$w.sourceWidth)/$w.width,$c=($R[4]||$w.sourceHeight)/$w.height,$q=$u*$w.sourceWidth,$s=$c*$w.sourceHeight,$C=0<$w.offsetX?$w.offsetX:0,$i=0<$w.offsetY?$w.offsetY:0,$C*=$u,$i*=$c,$k._addPointArrToRst($S,$P._getBoundPointS($R[1]-$C,$R[2]-$i,$q,$s),$o));break;case $O._drawRect:case 13:$k._addPointArrToRst($S,$P._getBoundPointS($R[0],$R[1],$R[2],$R[3]),$M);break;case $O._drawCircle:case $O._fillCircle:case 14:$k._addPointArrToRst($S,$P._getBoundPointS($R[0]-$R[2],$R[1]-$R[2],$R[2]+$R[2],$R[2]+$R[2]),$M);break;case $O._drawLine:case 20:$k._tempPoints.length=0;var $l;$l=.5*$R[5],$R[0]==$R[2]?$k._tempPoints.push($R[0]+$l,$R[1],$R[2]+$l,$R[3],$R[0]-$l,$R[1],$R[2]-$l,$R[3]):$R[1]==$R[3]?$k._tempPoints.push($R[0],$R[1]+$l,$R[2],$R[3]+$l,$R[0],$R[1]-$l,$R[2],$R[3]-$l):$k._tempPoints.push($R[0],$R[1],$R[2],$R[3]),$k._addPointArrToRst($S,$k._tempPoints,$M);break;case $O._drawCurves:case 22:$k._addPointArrToRst($S,$z.I.getBezierPoints($R[2]),$M,$R[0],$R[1]);break;case $O._drawPoly:case $O._drawLines:case 18:$k._addPointArrToRst($S,$R[2],$M,$R[0],$R[1]);break;case $O._drawPath:case 19:$k._addPointArrToRst($S,this._getPathPoints($R[2]),$M,$R[0],$R[1]);break;case $O._drawPie:case 15:$k._addPointArrToRst($S,this._getPiePoints($R[0],$R[1],$R[2],$R[3],$R[4]),$M)}return 200<$S.length?$S=$K.copyArray($S,$P._getWrapRec($S)._getBoundPoints()):8<$S.length&&($S=$H.scanPList($S)),$S},$_._switchMatrix=function($_,$S){$S.concat($_),$S.copyTo($_)},$_._getPiePoints=function($_,$S,$j,$O,$V){var $M=$k._tempPoints;$k._tempPoints.length=0,$M.push($_,$S);var $R=($V-$O)%(2*Math.PI)/10,$w=NaN,$a=$O;for($w=0;$w<=10;$w++)$M.push($_+$j*Math.cos($a),$S+$j*Math.sin($a)),$a+=$R;return $M},$_._getPathPoints=function($_){var $S,$j,$O=0,$V=$k._tempPoints;for($V.length=0,$S=$_.length,$O=0;$O<$S;$O++)1<($j=$_[$O]).length&&($V.push($j[1],$j[2]),3<$j.length&&$V.push($j[3],$j[4]));return $V},$k._addPointArrToRst=function($_,$S,$j,$O,$V){void 0===$O&&($O=0),void 0===$V&&($V=0);var $M,$R=0;for($M=$S.length,$R=0;$R<$M;$R+=2)$k._addPointToRst($_,$S[$R]+$O,$S[$R+1]+$V,$j)},$k._addPointToRst=function($_,$S,$j,$O){var $V=$y.TEMP;$V.setTo($S||0,$j||0),$O.transformPoint($V),$_.push($V.x,$V.y)},$k._tempPoints=[],$k._tempMatrixArrays=[],$k._tempCmds=[],$a($k,["_tempMatrix",function(){return this._tempMatrix=new $n},"_initMatrix",function(){return this._initMatrix=new $n}]),$k}(),$M=function(){function $_(){}$v($_,"laya.events.Event");var $S=$_.prototype;return $S.setTo=function($_,$S,$j){return this.type=$_,this.currentTarget=$S,this.target=$j,this},$S.stopPropagation=function(){this._stoped=!0},$c(0,$S,"stageY",function(){return $f.stage.mouseY}),$c(0,$S,"charCode",function(){return this.nativeEvent.charCode}),$c(0,$S,"touches",function(){var $_=this.nativeEvent.touches;if($_)for(var $S=$f.stage,$j=0,$O=$_.length;$j<$O;$j++){var $V=$_[$j],$M=$y.TEMP;$M.setTo($V.clientX,$V.clientY),$S._canvasTransform.invertTransformPoint($M),$S.transform.invertTransformPoint($M),$V.stageX=$M.x,$V.stageY=$M.y}return $_}),$c(0,$S,"keyLocation",function(){return this.nativeEvent.keyLocation}),$c(0,$S,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$c(0,$S,"altKey",function(){return this.nativeEvent.altKey}),$c(0,$S,"shiftKey",function(){return this.nativeEvent.shiftKey}),$c(0,$S,"stageX",function(){return $f.stage.mouseX}),$_.EMPTY=new $_,$_.MOUSE_DOWN="mousedown",$_.MOUSE_UP="mouseup",$_.CLICK="click",$_.RIGHT_MOUSE_DOWN="rightmousedown",$_.RIGHT_MOUSE_UP="rightmouseup",$_.RIGHT_CLICK="rightclick",$_.MOUSE_MOVE="mousemove",$_.MOUSE_OVER="mouseover",$_.MOUSE_OUT="mouseout",$_.MOUSE_WHEEL="mousewheel",$_.ROLL_OVER="mouseover",$_.ROLL_OUT="mouseout",$_.DOUBLE_CLICK="doubleclick",$_.CHANGE="change",$_.CHANGED="changed",$_.RESIZE="resize",$_.ADDED="added",$_.REMOVED="removed",$_.DISPLAY="display",$_.UNDISPLAY="undisplay",$_.ERROR="error",$_.COMPLETE="complete",$_.LOADED="loaded",$_.INITED="inited",$_.PROGRESS="progress",$_.INPUT="input",$_.RENDER="render",$_.OPEN="open",$_.MESSAGE="message",$_.CLOSE="close",$_.KEY_DOWN="keydown",$_.KEY_PRESS="keypress",$_.KEY_UP="keyup",$_.FRAME="enterframe",$_.DRAG_START="dragstart",$_.DRAG_MOVE="dragmove",$_.DRAG_END="dragend",$_.ENTER="enter",$_.SELECT="select",$_.BLUR="blur",$_.FOCUS="focus",$_.VISIBILITY_CHANGE="visibilitychange",$_.FOCUS_CHANGE="focuschange",$_.PLAYED="played",$_.PAUSED="paused",$_.STOPPED="stopped",$_.START="start",$_.END="end",$_.ENABLE_CHANGED="enablechanged",$_.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$_.COMPONENT_ADDED="componentadded",$_.COMPONENT_REMOVED="componentremoved",$_.LAYER_CHANGED="layerchanged",$_.HIERARCHY_LOADED="hierarchyloaded",$_.RECOVERED="recovered",$_.RELEASED="released",$_.LINK="link",$_.LABEL="label",$_.FULL_SCREEN_CHANGE="fullscreenchange",$_.DEVICE_LOST="devicelost",$_.MESH_CHANGED="meshchanged",$_.MATERIAL_CHANGED="materialchanged",$_.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$_.ANIMATION_CHANGED="animationchanged",$_.TRIGGER_ENTER="triggerenter",$_.TRIGGER_STAY="triggerstay",$_.TRIGGER_EXIT="triggerexit",$_.TRAIL_FILTER_CHANGE="trailfilterchange",$_.DOMINO_FILTER_CHANGE="dominofilterchange",$_}(),$q=(function(){function $_(){}$v($_,"laya.events.Keyboard"),$_.NUMBER_0=48,$_.NUMBER_1=49,$_.NUMBER_2=50,$_.NUMBER_3=51,$_.NUMBER_4=52,$_.NUMBER_5=53,$_.NUMBER_6=54,$_.NUMBER_7=55,$_.NUMBER_8=56,$_.NUMBER_9=57,$_.A=65,$_.B=66,$_.C=67,$_.D=68,$_.E=69,$_.F=70,$_.G=71,$_.H=72,$_.I=73,$_.J=74,$_.K=75,$_.L=76,$_.M=77,$_.N=78,$_.O=79,$_.P=80,$_.Q=81,$_.R=82,$_.S=83,$_.T=84,$_.U=85,$_.V=86,$_.W=87,$_.X=88,$_.Y=89,$_.Z=90,$_.F1=112,$_.F2=113,$_.F3=114,$_.F4=115,$_.F5=116,$_.F6=117,$_.F7=118,$_.F8=119,$_.F9=120,$_.F10=121,$_.F11=122,$_.F12=123,$_.F13=124,$_.F14=125,$_.F15=126,$_.NUMPAD=21,$_.NUMPAD_0=96,$_.NUMPAD_1=97,$_.NUMPAD_2=98,$_.NUMPAD_3=99,$_.NUMPAD_4=100,$_.NUMPAD_5=101,$_.NUMPAD_6=102,$_.NUMPAD_7=103,$_.NUMPAD_8=104,$_.NUMPAD_9=105,$_.NUMPAD_ADD=107,$_.NUMPAD_DECIMAL=110,$_.NUMPAD_DIVIDE=111,$_.NUMPAD_ENTER=108,$_.NUMPAD_MULTIPLY=106,$_.NUMPAD_SUBTRACT=109,$_.SEMICOLON=186,$_.EQUAL=187,$_.COMMA=188,$_.MINUS=189,$_.PERIOD=190,$_.SLASH=191,$_.BACKQUOTE=192,$_.LEFTBRACKET=219,$_.BACKSLASH=220,$_.RIGHTBRACKET=221,$_.QUOTE=222,$_.ALTERNATE=18,$_.BACKSPACE=8,$_.CAPS_LOCK=20,$_.COMMAND=15,$_.CONTROL=17,$_.DELETE=46,$_.ENTER=13,$_.ESCAPE=27,$_.PAGE_UP=33,$_.PAGE_DOWN=34,$_.END=35,$_.HOME=36,$_.LEFT=37,$_.UP=38,$_.RIGHT=39,$_.DOWN=40,$_.SHIFT=16,$_.SPACE=32,$_.TAB=9,$_.INSERT=45}(),function(){function $V(){}return $v($V,"laya.events.KeyBoardManager"),$V.__init__=function(){$V._addEvent("keydown"),$V._addEvent("keypress"),$V._addEvent("keyup")},$V._addEvent=function($S){$m.document.addEventListener($S,function($_){laya.events.KeyBoardManager._dispatch($_,$S)},!0)},$V._dispatch=function($_,$S){if($V.enabled){$V._event._stoped=!1,$V._event.nativeEvent=$_,$V._event.keyCode=$_.keyCode||$_.which||$_.charCode,"keydown"===$S?$V._pressKeys[$V._event.keyCode]=!0:"keyup"===$S&&($V._pressKeys[$V._event.keyCode]=null);for(var $j=$f.stage.focus&&null!=$f.stage.focus.event&&$f.stage.focus.displayedInStage?$f.stage.focus:$f.stage,$O=$j;$O;)$O.event($S,$V._event.setTo($S,$O,$j)),$O=$O.parent}},$V.hasKeyDown=function($_){return $V._pressKeys[$_]},$V._pressKeys={},$V.enabled=!0,$a($V,["_event",function(){return this._event=new $M}]),$V}()),$i=(function(){function $_(){}$v($_,"laya.events.KeyLocation"),$_.STANDARD=0,$_.LEFT=1,$_.RIGHT=2,$_.NUM_PAD=3}(),function(){function $c(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$m.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $M,this._matrix=new $n,this._point=new $y,this._rect=new $P,this._prePoint=new $y,this._curTouchID=NaN}$v($c,"laya.events.MouseManager");var $_=$c.prototype;return $_.__init__=function($_,$S){var $j=this;this._stage=$_;var $O=this,$V=this._eventList;$S.oncontextmenu=function($_){if($c.enabled)return!1},$S.addEventListener("mousedown",function($_){$c.enabled&&($m.onIE||$_.preventDefault(),$V.push($_),$O.mouseDownTime=$m.now())}),$S.addEventListener("mouseup",function($_){$c.enabled&&($_.preventDefault(),$V.push($_),$O.mouseDownTime=-$m.now())},!0),$S.addEventListener("mousemove",function($_){if($c.enabled){$_.preventDefault();var $S=$m.now();if($S-$O._lastMoveTimer<10)return;$O._lastMoveTimer=$S,$V.push($_)}},!0),$S.addEventListener("mouseout",function($_){$c.enabled&&$V.push($_)}),$S.addEventListener("mouseover",function($_){$c.enabled&&$V.push($_)}),$S.addEventListener("touchstart",function($_){$c.enabled&&($V.push($_),$c._isFirstTouch||$H_.isInputting||$_.preventDefault(),$O.mouseDownTime=$m.now())}),$S.addEventListener("touchend",function($_){$c.enabled?($c._isFirstTouch||$H_.isInputting||$_.preventDefault(),$c._isFirstTouch=!1,$V.push($_),$O.mouseDownTime=-$m.now()):$j._curTouchID=NaN},!0),$S.addEventListener("touchmove",function($_){$c.enabled&&($_.preventDefault(),$V.push($_))},!0),$S.addEventListener("touchcancel",function($_){$c.enabled?($_.preventDefault(),$V.push($_)):$j._curTouchID=NaN},!0),$S.addEventListener("mousewheel",function($_){$c.enabled&&$V.push($_)}),$S.addEventListener("DOMMouseScroll",function($_){$c.enabled&&$V.push($_)})},$_.initEvent=function($_,$S){var $j;this._event._stoped=!1,this._event.nativeEvent=$S||$_,this._target=null,this._point.setTo($_.pageX||$_.clientX,$_.pageY||$_.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$_.identifier||0,this._tTouchID=this._event.touchId,($j=$Z.I._event)._stoped=!1,$j.nativeEvent=this._event.nativeEvent,$j.touchId=this._event.touchId},$_.checkMouseWheel=function($_){this._event.delta=$_.wheelDelta?.025*$_.wheelDelta:-$_.detail;for(var $S=$Z.I.getLastOvers(),$j=0,$O=$S.length;$j<$O;$j++){var $V=$S[$j];$V.event("mousewheel",this._event.setTo("mousewheel",$V,this._target))}},$_.onMouseMove=function($_){$Z.I.onMouseMove($_,this._tTouchID)},$_.onMouseDown=function($_){if($H_.isInputting&&$f.stage.focus&&$f.stage.focus.focus&&!$f.stage.focus.contains(this._target)){var $S=$f.stage.focus._tf||$f.stage.focus,$j=$_._tf||$_;$j instanceof laya.display.Input&&$j.multiline==$S.multiline?$S._focusOut():$S.focus=!1}$Z.I.onMouseDown($_,this._tTouchID,this._isLeftMouse)},$_.onMouseUp=function($_){$Z.I.onMouseUp($_,this._tTouchID,this._isLeftMouse)},$_.check=function($_,$S,$j,$O){this._point.setTo($S,$j),$_.fromParentPoint(this._point),$S=this._point.x,$j=this._point.y;var $V=$_.scrollRect;if($V&&(this._rect.setTo($V.x,$V.y,$V.width,$V.height),!this._rect.contains($S,$j)))return!1;if(!this.disableMouseEvent){if($_.hitTestPrior&&!$_.mouseThrough&&!this.hitTest($_,$S,$j))return!1;for(var $M=$_._childs.length-1;-1<$M;$M--){var $R=$_._childs[$M];if(!$R.destroyed&&$R.mouseEnabled&&$R.visible&&this.check($R,$S,$j,$O))return!0}}var $w=!(!$_.hitTestPrior||$_.mouseThrough||this.disableMouseEvent)||this.hitTest($_,$S,$j);return $w?(this._target=$_,$O.call(this,$_)):$O===this.onMouseUp&&$_===this._stage&&(this._target=this._stage,$O.call(this,this._target)),$w},$_.hitTest=function($_,$S,$j){var $O=!1;if($_.scrollRect&&($S-=$_.scrollRect.x,$j-=$_.scrollRect.y),$_.hitArea instanceof laya.utils.HitArea)return $_.hitArea.isHit($S,$j);if(0<$_.width&&0<$_.height||$_.mouseThrough||$_.hitArea)if($_.mouseThrough)$O=$_.getGraphicBounds().contains($S,$j);else{var $V=this._rect;$_.hitArea?$V=$_.hitArea:$V.setTo(0,0,$_.width,$_.height),$O=$V.contains($S,$j)}return $O},$_.runEvent=function(){var $_=this._eventList.length;if($_){var $S=this;$S.mouseEventTime=$m.now();var $j,$O=0,$V=0,$M=0;try{for(;$O<$_;){var $R=this._eventList[$O];switch("mousemove"!==$R.type&&(this._prePoint.x=this._prePoint.y=-1e6),$R.type){case"mousedown":this._touchIDs[0]=this._id++,$c._isTouchRespond?$c._isTouchRespond=!1:($S._isLeftMouse=0===$R.button,$S.initEvent($R),$S.check($S._stage,$S.mouseX,$S.mouseY,$S.onMouseDown));break;case"mouseup":$S._isLeftMouse=0===$R.button,$S.initEvent($R),$S.check($S._stage,$S.mouseX,$S.mouseY,$S.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$R.clientX)+Math.abs(this._prePoint.y-$R.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$R.clientX,this._prePoint.y=$R.clientY,$S.initEvent($R),$S.check($S._stage,$S.mouseX,$S.mouseY,$S.onMouseMove));break;case"touchstart":$c._isTouchRespond=!0,$S._isLeftMouse=!0;var $w=$R.changedTouches;for($V=0,$M=$w.length;$V<$M;$V++)$j=$w[$V],($c.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$j.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$j.identifier]=this._id++,$S.initEvent($j,$R),$S.check($S._stage,$S.mouseX,$S.mouseY,$S.onMouseDown));break;case"touchend":case"touchcancel":$c._isTouchRespond=!0,$S._isLeftMouse=!0;var $a=$R.changedTouches;for($V=0,$M=$a.length;$V<$M;$V++)if($j=$a[$V],$c.multiTouchEnabled||$j.identifier==this._curTouchID){this._curTouchID=NaN,$S.initEvent($j,$R);$S.check($S._stage,$S.mouseX,$S.mouseY,$S.onMouseUp)||$S.onMouseUp(null)}break;case"touchmove":var $u=$R.changedTouches;for($V=0,$M=$u.length;$V<$M;$V++)$j=$u[$V],($c.multiTouchEnabled||$j.identifier==this._curTouchID)&&($S.initEvent($j,$R),$S.check($S._stage,$S.mouseX,$S.mouseY,$S.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$S.checkMouseWheel($R);break;case"mouseout":$Z.I.stageMouseOut();break;case"mouseover":$S._stage.event("mouseover",$S._event.setTo("mouseover",$S._stage,$S._stage))}$O++}}catch($_){throw this._eventList.length=0,$_}this._eventList.length=0}},$c.enabled=!0,$c.multiTouchEnabled=!0,$c._isTouchRespond=!1,$c._isFirstTouch=!0,$a($c,["instance",function(){return this.instance=new $c}]),$c}()),$Z=function(){function $i(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $M}$v($i,"laya.events.TouchManager");var $_=$i.prototype;return $_._clearTempArrs=function(){$i._oldArr.length=0,$i._newArr.length=0,$i._tEleArr.length=0},$_.getTouchFromArr=function($_,$S){var $j,$O,$V=0;for($j=$S.length,$V=0;$V<$j;$V++)if(($O=$S[$V]).id==$_)return $O;return null},$_.removeTouchFromArr=function($_,$S){var $j=0;for($j=$S.length-1;0<=$j;$j--)$S[$j].id==$_&&$S.splice($j,1)},$_.createTouchO=function($_,$S){var $j;return($j=$T.getItem("TouchData")||{}).id=$S,$j.tar=$_,$j},$_.onMouseDown=function($_,$S,$j){var $O,$V,$M,$R;(void 0===$j&&($j=!1),this.enable)&&($O=this.getTouchFromArr($S,this.preOvers),$M=this.getEles($_,null,$i._tEleArr),$O?$O.tar=$_:($V=this.createTouchO($_,$S),this.preOvers.push($V)),$m.onMobile&&this.sendEvents($M,"mouseover",$S),$R=$j?this.preDowns:this.preRightDowns,($O=this.getTouchFromArr($S,$R))?$O.tar=$_:($V=this.createTouchO($_,$S),$R.push($V)),this.sendEvents($M,$j?"mousedown":"rightmousedown",$S),this._clearTempArrs())},$_.sendEvents=function($_,$S,$j){void 0===$j&&($j=0);var $O,$V,$M,$R=0;for($O=$_.length,this._event._stoped=!1,$V=$_[0],$R=0;$R<$O;$R++){if(($M=$_[$R]).destroyed)return;if($M.event($S,this._event.setTo($S,$M,$V)),this._event._stoped)break}},$_.getEles=function($_,$S,$j){for($j?$j.length=0:$j=[];$_&&$_!=$S;)$j.push($_),$_=$_.parent;return $j},$_.checkMouseOutAndOverOfMove=function($_,$S,$j){if(void 0===$j&&($j=0),$S!=$_){var $O,$V,$M=0,$R=0;if($S.contains($_))$V=this.getEles($_,$S,$i._tEleArr),this.sendEvents($V,"mouseover",$j);else if($_.contains($S))$V=this.getEles($S,$_,$i._tEleArr),this.sendEvents($V,"mouseout",$j);else{var $w,$a;($V=$i._tEleArr).length=0,$w=this.getEles($S,null,$i._oldArr),$a=this.getEles($_,null,$i._newArr),$R=$w.length;var $u=0;for($M=0;$M<$R;$M++){if($O=$w[$M],0<=($u=$a.indexOf($O))){$a.splice($u,$a.length-$u);break}$V.push($O)}0<$V.length&&this.sendEvents($V,"mouseout",$j),0<$a.length&&this.sendEvents($a,"mouseover",$j)}}},$_.onMouseMove=function($_,$S){var $j,$O;this.enable&&(($j=this.getTouchFromArr($S,this.preOvers))?(this.checkMouseOutAndOverOfMove($_,$j.tar),$j.tar=$_,$O=this.getEles($_,null,$i._tEleArr)):($O=this.getEles($_,null,$i._tEleArr),this.sendEvents($O,"mouseover",$S),this.preOvers.push(this.createTouchO($_,$S))),this.sendEvents($O,"mousemove",$S),this._clearTempArrs())},$_.getLastOvers=function(){return($i._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$i._tEleArr):($i._tEleArr.push($f.stage),$i._tEleArr)},$_.stageMouseOut=function(){var $_;$_=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($_,"mouseout",0)},$_.onMouseUp=function($_,$S,$j){if(void 0===$j&&($j=!1),this.enable){var $O,$V,$M,$R,$w,$a,$u=0,$c=0,$q=$m.onMobile;if($V=this.getEles($_,null,$i._tEleArr),this.sendEvents($V,$j?"mouseup":"rightmouseup",$S),$a=$j?this.preDowns:this.preRightDowns,$O=this.getTouchFromArr($S,$a)){var $s,$C=$m.now();if($s=$C-this._lastClickTime<300,this._lastClickTime=$C,$_==$O.tar)$w=$V;else for($M=this.getEles($O.tar,null,$i._oldArr),($w=$i._newArr).length=0,$c=$M.length,$u=0;$u<$c;$u++)$R=$M[$u],0<=$V.indexOf($R)&&$w.push($R);0<$w.length&&this.sendEvents($w,$j?"click":"rightclick",$S),$j&&$s&&this.sendEvents($w,"doubleclick",$S),this.removeTouchFromArr($S,$a),$O.tar=null,$T.recover("TouchData",$O)}else;($O=this.getTouchFromArr($S,this.preOvers))&&$q&&(($w=this.getEles($O.tar,null,$w))&&0<$w.length&&this.sendEvents($w,"mouseout",$S),this.removeTouchFromArr($S,this.preOvers),$O.tar=null,$T.recover("TouchData",$O)),this._clearTempArrs()}},$i._oldArr=[],$i._newArr=[],$i._tEleArr=[],$a($i,["I",function(){return this.I=new $i}]),$i}(),$o=function(){function $_(){this._action=null}$v($_,"laya.filters.Filter");var $S=$_.prototype;return $f.imps($S,{"laya.filters.IFilter":!0}),$S.callNative=function($_){},$c(0,$S,"type",function(){return-1}),$c(0,$S,"action",function(){return this._action}),$_.BLUR=16,$_.COLOR=32,$_.GLOW=8,$_._filterStart=null,$_._filterEnd=null,$_._EndTarget=null,$_._recycleScope=null,$_._filter=null,$_._useSrc=null,$_._endSrc=null,$_._useOut=null,$_._endOut=null,$_}(),$k=function(){function $_(){this.data=null}$v($_,"laya.filters.ColorFilterAction");var $S=$_.prototype;return $f.imps($S,{"laya.filters.IFilterAction":!0}),$S.apply=function($_){var $S=$_.ctx.ctx,$j=$_.ctx.ctx.canvas;if(0==$j.width||0==$j.height)return $j;for(var $O,$V=$S.getImageData(0,0,$j.width,$j.height),$M=$V.data,$R=0,$w=$M.length;$R<$w;$R+=4)$O=this.getColor($M[$R],$M[$R+1],$M[$R+2],$M[$R+3]),0!=$M[$R+3]&&($M[$R]=$O[0],$M[$R+1]=$O[1],$M[$R+2]=$O[2],$M[$R+3]=$O[3]);return $S.putImageData($V,0,0),$_},$S.getColor=function($_,$S,$j,$O){var $V=[];if(this.data._mat&&this.data._alpha){var $M=this.data._mat,$R=this.data._alpha;$V[0]=$M[0]*$_+$M[1]*$S+$M[2]*$j+$M[3]*$O+$R[0],$V[1]=$M[4]*$_+$M[5]*$S+$M[6]*$j+$M[7]*$O+$R[1],$V[2]=$M[8]*$_+$M[9]*$S+$M[10]*$j+$M[11]*$O+$R[2],$V[3]=$M[12]*$_+$M[13]*$S+$M[14]*$j+$M[15]*$O+$R[3]}return $V},$_}(),$z=(function(){function $_(){}$v($_,"laya.maths.Arith"),$_.formatR=function($_){return $_>Math.PI&&($_-=2*Math.PI),$_<-Math.PI&&($_+=2*Math.PI),$_},$_.isPOT=function($_,$S){return 0<$_&&0==($_&$_-1)&&0<$S&&0==($S&$S-1)},$_.setMatToArray=function($_,$S){$_.a,$_.b,$_.c,$_.d,$_.tx,$_.ty,$S[0]=$_.a,$S[1]=$_.b,$S[4]=$_.c,$S[5]=$_.d,$S[12]=$_.tx,$S[13]=$_.ty}}(),function(){function $_(){this._controlPoints=[new $y,new $y,new $y],this._calFun=this.getPoint2}$v($_,"laya.maths.Bezier");var $S=$_.prototype;return $S._switchPoint=function($_,$S){var $j=this._controlPoints.shift();$j.setTo($_,$S),this._controlPoints.push($j)},$S.getPoint2=function($_,$S){var $j=this._controlPoints[0],$O=this._controlPoints[1],$V=this._controlPoints[2],$M=Math.pow(1-$_,2)*$j.x+2*$_*(1-$_)*$O.x+Math.pow($_,2)*$V.x,$R=Math.pow(1-$_,2)*$j.y+2*$_*(1-$_)*$O.y+Math.pow($_,2)*$V.y;$S.push($M,$R)},$S.getPoint3=function($_,$S){var $j=this._controlPoints[0],$O=this._controlPoints[1],$V=this._controlPoints[2],$M=this._controlPoints[3],$R=Math.pow(1-$_,3)*$j.x+3*$O.x*$_*(1-$_)*(1-$_)+3*$V.x*$_*$_*(1-$_)+$M.x*Math.pow($_,3),$w=Math.pow(1-$_,3)*$j.y+3*$O.y*$_*(1-$_)*(1-$_)+3*$V.y*$_*$_*(1-$_)+$M.y*Math.pow($_,3);$S.push($R,$w)},$S.insertPoints=function($_,$S){var $j,$O=NaN;for($j=1/($_=0<$_?$_:5),$O=0;$O<=1;$O+=$j)this._calFun($O,$S)},$S.getBezierPoints=function($_,$S,$j){void 0===$S&&($S=5),void 0===$j&&($j=2);var $O,$V,$M=0;if(($O=$_.length)<2*($j+1))return[];switch($V=[],$j){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$j;)this._controlPoints.push(new $y);for($M=0;$M<2*$j;$M+=2)this._switchPoint($_[$M],$_[$M+1]);for($M=2*$j;$M<$O;$M+=2)this._switchPoint($_[$M],$_[$M+1]),$M/2%$j==0&&this.insertPoints($S,$V);return $V},$a($_,["I",function(){return this.I=new $_}]),$_}()),$H=function(){function $u(){}return $v($u,"laya.maths.GrahamScan"),$u.multiply=function($_,$S,$j){return($_.x-$j.x)*($S.y-$j.y)-($S.x-$j.x)*($_.y-$j.y)},$u.dis=function($_,$S){return($_.x-$S.x)*($_.x-$S.x)+($_.y-$S.y)*($_.y-$S.y)},$u._getPoints=function($_,$S,$j){for(void 0===$S&&($S=!1),$u._mPointList||($u._mPointList=[]);$u._mPointList.length<$_;)$u._mPointList.push(new $y);return $j||($j=[]),$j.length=0,$S?$u.getFrom($j,$u._mPointList,$_):$u.getFromR($j,$u._mPointList,$_),$j},$u.getFrom=function($_,$S,$j){var $O=0;for($O=0;$O<$j;$O++)$_.push($S[$O]);return $_},$u.getFromR=function($_,$S,$j){var $O=0;for($O=0;$O<$j;$O++)$_.push($S.pop());return $_},$u.pListToPointList=function($_,$S){void 0===$S&&($S=!1);var $j=0,$O=$_.length/2,$V=$u._getPoints($O,$S,$u._tempPointList);for($j=0;$j<$O;$j++)$V[$j].setTo($_[$j+$j],$_[$j+$j+1]);return $V},$u.pointListToPlist=function($_){var $S,$j=0,$O=$_.length,$V=$u._temPList;for($j=$V.length=0;$j<$O;$j++)$S=$_[$j],$V.push($S.x,$S.y);return $V},$u.scanPList=function($_){return $K.copyArray($_,$u.pointListToPlist($u.scan($u.pListToPointList($_,!0))))},$u.scan=function($_){var $S,$j,$O,$V=0,$M=0,$R=0,$w=$_.length,$a={};for(($j=$u._temArr).length=0,$V=($w=$_.length)-1;0<=$V;$V--)$O=($S=$_[$V]).x+"_"+$S.y,$a.hasOwnProperty($O)||($a[$O]=!0,$j.push($S));for($w=$j.length,$K.copyArray($_,$j),$V=1;$V<$w;$V++)($_[$V].y<$_[$R].y||$_[$V].y==$_[$R].y&&$_[$V].x<$_[$R].x)&&($R=$V);for($S=$_[0],$_[0]=$_[$R],$_[$R]=$S,$V=1;$V<$w-1;$V++){for($M=($R=$V)+1;$M<$w;$M++)(0<$u.multiply($_[$M],$_[$R],$_[0])||0==$u.multiply($_[$M],$_[$R],$_[0])&&$u.dis($_[0],$_[$M])<$u.dis($_[0],$_[$R]))&&($R=$M);$S=$_[$V],$_[$V]=$_[$R],$_[$R]=$S}if(($j=$u._temArr).length=0,$_.length<3)return $K.copyArray($j,$_);for($j.push($_[0],$_[1],$_[2]),$V=3;$V<$w;$V++){for(;2<=$j.length&&0<=$u.multiply($_[$V],$j[$j.length-1],$j[$j.length-2]);)$j.pop();$_[$V]&&$j.push($_[$V])}return $j},$u._mPointList=null,$u._tempPointList=[],$u._temPList=[],$u._temArr=[],$u}(),$A=function(){function $V(){}return $v($V,"laya.maths.MathUtil"),$V.subtractVector3=function($_,$S,$j){$j[0]=$_[0]-$S[0],$j[1]=$_[1]-$S[1],$j[2]=$_[2]-$S[2]},$V.lerp=function($_,$S,$j){return $_*(1-$j)+$S*$j},$V.scaleVector3=function($_,$S,$j){$j[0]=$_[0]*$S,$j[1]=$_[1]*$S,$j[2]=$_[2]*$S},$V.lerpVector3=function($_,$S,$j,$O){var $V=$_[0],$M=$_[1],$R=$_[2];$O[0]=$V+$j*($S[0]-$V),$O[1]=$M+$j*($S[1]-$M),$O[2]=$R+$j*($S[2]-$R)},$V.lerpVector4=function($_,$S,$j,$O){var $V=$_[0],$M=$_[1],$R=$_[2],$w=$_[3];$O[0]=$V+$j*($S[0]-$V),$O[1]=$M+$j*($S[1]-$M),$O[2]=$R+$j*($S[2]-$R),$O[3]=$w+$j*($S[3]-$w)},$V.slerpQuaternionArray=function($_,$S,$j,$O,$V,$M,$R){var $w,$a,$u,$c,$q,$s=$_[$S+0],$C=$_[$S+1],$i=$_[$S+2],$v=$_[$S+3],$Z=$j[$O+0],$o=$j[$O+1],$l=$j[$O+2],$k=$j[$O+3];return($a=$s*$Z+$C*$o+$i*$l+$v*$k)<0&&($a=-$a,$Z=-$Z,$o=-$o,$l=-$l,$k=-$k),$q=1e-6<1-$a?($w=Math.acos($a),$u=Math.sin($w),$c=Math.sin((1-$V)*$w)/$u,Math.sin($V*$w)/$u):($c=1-$V,$V),$M[$R+0]=$c*$s+$q*$Z,$M[$R+1]=$c*$C+$q*$o,$M[$R+2]=$c*$i+$q*$l,$M[$R+3]=$c*$v+$q*$k,$M},$V.getRotation=function($_,$S,$j,$O){return Math.atan2($O-$S,$j-$_)/Math.PI*180},$V.sortBigFirst=function($_,$S){return $_==$S?0:$_<$S?1:-1},$V.sortSmallFirst=function($_,$S){return $_==$S?0:$_<$S?-1:1},$V.sortNumBigFirst=function($_,$S){return parseFloat($S)-parseFloat($_)},$V.sortNumSmallFirst=function($_,$S){return parseFloat($_)-parseFloat($S)},$V.sortByKey=function($j,$_,$S){var $O;return void 0===$_&&($_=!1),void 0===$S&&($S=!0),$O=$_?$S?$V.sortNumBigFirst:$V.sortBigFirst:$S?$V.sortNumSmallFirst:$V.sortSmallFirst,function($_,$S){return $O($_[$j],$S[$j])}},$V}(),$n=function(){function $j($_,$S,$j,$O,$V,$M){this.inPool=!1,this.bTransform=!1,void 0===$_&&($_=1),void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=1),void 0===$V&&($V=0),void 0===$M&&($M=0),this.a=$_,this.b=$S,this.c=$j,this.d=$O,this.tx=$V,this.ty=$M,this._checkTransform()}$v($j,"laya.maths.Matrix");var $_=$j.prototype;return $_.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$_._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$_.setTranslate=function($_,$S){return this.tx=$_,this.ty=$S,this},$_.translate=function($_,$S){return this.tx+=$_,this.ty+=$S,this},$_.scale=function($_,$S){this.a*=$_,this.d*=$S,this.c*=$_,this.b*=$S,this.tx*=$_,this.ty*=$S,this.bTransform=!0},$_.rotate=function($_){var $S=Math.cos($_),$j=Math.sin($_),$O=this.a,$V=this.c,$M=this.tx;this.a=$O*$S-this.b*$j,this.b=$O*$j+this.b*$S,this.c=$V*$S-this.d*$j,this.d=$V*$j+this.d*$S,this.tx=$M*$S-this.ty*$j,this.ty=$M*$j+this.ty*$S,this.bTransform=!0},$_.skew=function($_,$S){var $j=Math.tan($_),$O=Math.tan($S),$V=this.a,$M=this.b;return this.a+=$O*this.c,this.b+=$O*this.d,this.c+=$j*$V,this.d+=$j*$M,this},$_.invertTransformPoint=function($_){var $S=this.a,$j=this.b,$O=this.c,$V=this.d,$M=this.tx,$R=$S*$V-$j*$O,$w=$V/$R,$a=-$j/$R,$u=-$O/$R,$c=$S/$R,$q=($O*this.ty-$V*$M)/$R,$s=-($S*this.ty-$j*$M)/$R;return $_.setTo($w*$_.x+$u*$_.y+$q,$a*$_.x+$c*$_.y+$s)},$_.transformPoint=function($_){return $_.setTo(this.a*$_.x+this.c*$_.y+this.tx,this.b*$_.x+this.d*$_.y+this.ty)},$_.transformPointN=function($_){return $_.setTo(this.a*$_.x+this.c*$_.y,this.b*$_.x+this.d*$_.y)},$_.transformPointArray=function($_,$S){for(var $j=$_.length,$O=0;$O<$j;$O+=2){var $V=$_[$O],$M=$_[$O+1];$S[$O]=this.a*$V+this.c*$M+this.tx,$S[$O+1]=this.b*$V+this.d*$M+this.ty}return $S},$_.transformPointArrayScale=function($_,$S){for(var $j=$_.length,$O=0;$O<$j;$O+=2){var $V=$_[$O],$M=$_[$O+1];$S[$O]=this.a*$V+this.c*$M,$S[$O+1]=this.b*$V+this.d*$M}return $S},$_.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$_.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$_.invert=function(){var $_=this.a,$S=this.b,$j=this.c,$O=this.d,$V=this.tx,$M=$_*$O-$S*$j;return this.a=$O/$M,this.b=-$S/$M,this.c=-$j/$M,this.d=$_/$M,this.tx=($j*this.ty-$O*$V)/$M,this.ty=-($_*this.ty-$S*$V)/$M,this},$_.setTo=function($_,$S,$j,$O,$V,$M){return this.a=$_,this.b=$S,this.c=$j,this.d=$O,this.tx=$V,this.ty=$M,this},$_.concat=function($_){var $S=this.a,$j=this.c,$O=this.tx;return this.a=$S*$_.a+this.b*$_.c,this.b=$S*$_.b+this.b*$_.d,this.c=$j*$_.a+this.d*$_.c,this.d=$j*$_.b+this.d*$_.d,this.tx=$O*$_.a+this.ty*$_.c+$_.tx,this.ty=$O*$_.b+this.ty*$_.d+$_.ty,this},$_.scaleEx=function($_,$S){var $j=this.a,$O=this.b,$V=this.c,$M=this.d;0!==$O||0!==$V?(this.a=$_*$j,this.b=$_*$O,this.c=$S*$V):(this.a=$_*$j,this.b=0*$M,this.c=0*$j),this.d=$S*$M,this.bTransform=!0},$_.rotateEx=function($_){var $S=Math.cos($_),$j=Math.sin($_),$O=this.a,$V=this.b,$M=this.c,$R=this.d;0!==$V||0!==$M?(this.a=$S*$O+$j*$M,this.b=$S*$V+$j*$R,this.c=-$j*$O+$S*$M,this.d=-$j*$V+$S*$R):(this.a=$S*$O,this.b=$j*$R,this.c=-$j*$O,this.d=$S*$R),this.bTransform=!0},$_.clone=function(){var $_=$j.create();return $_.a=this.a,$_.b=this.b,$_.c=this.c,$_.d=this.d,$_.tx=this.tx,$_.ty=this.ty,$_.bTransform=this.bTransform,$_},$_.copyTo=function($_){return $_.a=this.a,$_.b=this.b,$_.c=this.c,$_.d=this.d,$_.tx=this.tx,$_.ty=this.ty,$_.bTransform=this.bTransform,$_},$_.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$_.destroy=function(){if(!this.inPool){var $_=$j._cache;this.inPool=!0,$_._length||($_._length=0),($_[$_._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$j.mul=function($_,$S,$j){var $O=$_.a,$V=$_.b,$M=$_.c,$R=$_.d,$w=$_.tx,$a=$_.ty,$u=$S.a,$c=$S.b,$q=$S.c,$s=$S.d,$C=$S.tx,$i=$S.ty;return 0!==$c||0!==$q?($j.a=$O*$u+$V*$q,$j.b=$O*$c+$V*$s,$j.c=$M*$u+$R*$q,$j.d=$M*$c+$R*$s,$j.tx=$u*$w+$q*$a+$C,$j.ty=$c*$w+$s*$a+$i):($j.a=$O*$u,$j.b=$V*$s,$j.c=$M*$u,$j.d=$R*$s,$j.tx=$u*$w+$C,$j.ty=$s*$a+$i),$j},$j.mul16=function($_,$S,$j){var $O=$_.a,$V=$_.b,$M=$_.c,$R=$_.d,$w=$_.tx,$a=$_.ty,$u=$S.a,$c=$S.b,$q=$S.c,$s=$S.d,$C=$S.tx,$i=$S.ty;return 0!==$c||0!==$q?($j[0]=$O*$u+$V*$q,$j[1]=$O*$c+$V*$s,$j[4]=$M*$u+$R*$q,$j[5]=$M*$c+$R*$s,$j[12]=$u*$w+$q*$a+$C,$j[13]=$c*$w+$s*$a+$i):($j[0]=$O*$u,$j[1]=$V*$s,$j[4]=$M*$u,$j[5]=$R*$s,$j[12]=$u*$w+$C,$j[13]=$s*$a+$i),$j},$j.mulPre=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=$_.a,$u=$_.b,$c=$_.c,$q=$_.d,$s=$_.tx,$C=$_.ty;return 0!==$j||0!==$O?($w.a=$a*$S+$u*$O,$w.b=$a*$j+$u*$V,$w.c=$c*$S+$q*$O,$w.d=$c*$j+$q*$V,$w.tx=$S*$s+$O*$C+$M,$w.ty=$j*$s+$V*$C+$R):($w.a=$a*$S,$w.b=$u*$V,$w.c=$c*$S,$w.d=$q*$V,$w.tx=$S*$s+$M,$w.ty=$V*$C+$R),$w},$j.mulPos=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=$_.a,$u=$_.b,$c=$_.c,$q=$_.d,$s=$_.tx,$C=$_.ty;return 0!==$u||0!==$c?($w.a=$S*$a+$j*$c,$w.b=$S*$u+$j*$q,$w.c=$O*$a+$V*$c,$w.d=$O*$u+$V*$q,$w.tx=$a*$M+$c*$R+$s,$w.ty=$u*$M+$q*$R+$C):($w.a=$S*$a,$w.b=$j*$q,$w.c=$O*$a,$w.d=$V*$q,$w.tx=$a*$M+$s,$w.ty=$q*$R+$C),$w},$j.preMul=function($_,$S,$j){var $O=$_.a,$V=$_.b,$M=$_.c,$R=$_.d,$w=$S.a,$a=$S.b,$u=$S.c,$c=$S.d,$q=$S.tx,$s=$S.ty;return $j.a=$w*$O,$j.b=$j.c=0,$j.d=$c*$R,$j.tx=$q*$O+$_.tx,$j.ty=$s*$R+$_.ty,0===$a&&0===$u&&0===$V&&0===$M||($j.a+=$a*$M,$j.d+=$u*$V,$j.b+=$w*$V+$a*$R,$j.c+=$u*$O+$c*$M,$j.tx+=$s*$M,$j.ty+=$q*$V),$j},$j.preMulXY=function($_,$S,$j,$O){var $V=$_.a,$M=$_.b,$R=$_.c,$w=$_.d;return $O.a=$V,$O.b=$M,$O.c=$R,$O.d=$w,$O.tx=$S*$V+$_.tx+$j*$R,$O.ty=$j*$w+$_.ty+$S*$M,$O},$j.create=function(){var $_=$j._cache,$S=$_._length?$_[--$_._length]:new $j;return $S.inPool=!1,$S},$j.EMPTY=new $j,$j.TEMP=new $j,$j._cache=[],$j}(),$y=function(){function $_($_,$S){void 0===$_&&($_=0),void 0===$S&&($S=0),this.x=$_,this.y=$S}$v($_,"laya.maths.Point");var $S=$_.prototype;return $S.setTo=function($_,$S){return this.x=$_,this.y=$S,this},$S.distance=function($_,$S){return Math.sqrt((this.x-$_)*(this.x-$_)+(this.y-$S)*(this.y-$S))},$S.toString=function(){return this.x+","+this.y},$S.normalize=function(){var $_=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$_){var $S=1/$_;this.x*=$S,this.y*=$S}},$_.TEMP=new $_,$_.EMPTY=new $_,$_}(),$P=function(){function $u($_,$S,$j,$O){void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0),this.x=$_,this.y=$S,this.width=$j,this.height=$O}$v($u,"laya.maths.Rectangle");var $_=$u.prototype;return $_.setTo=function($_,$S,$j,$O){return this.x=$_,this.y=$S,this.width=$j,this.height=$O,this},$_.copyFrom=function($_){return this.x=$_.x,this.y=$_.y,this.width=$_.width,this.height=$_.height,this},$_.contains=function($_,$S){return!(this.width<=0||this.height<=0)&&($_>=this.x&&$_<this.right&&$S>=this.y&&$S<this.bottom)},$_.intersects=function($_){return!($_.x>this.x+this.width||$_.x+$_.width<this.x||$_.y>this.y+this.height||$_.y+$_.height<this.y)},$_.intersection=function($_,$S){return this.intersects($_)?($S||($S=new $u),$S.x=Math.max(this.x,$_.x),$S.y=Math.max(this.y,$_.y),$S.width=Math.min(this.right,$_.right)-$S.x,$S.height=Math.min(this.bottom,$_.bottom)-$S.y,$S):null},$_.union=function($_,$S){return $S||($S=new $u),this.clone($S),$_.width<=0||$_.height<=0?$S:($S.addPoint($_.x,$_.y),$S.addPoint($_.right,$_.bottom),this)},$_.clone=function($_){return $_||($_=new $u),$_.x=this.x,$_.y=this.y,$_.width=this.width,$_.height=this.height,$_},$_.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$_.equals=function($_){return!(!$_||$_.x!==this.x||$_.y!==this.y||$_.width!==this.width||$_.height!==this.height)},$_.addPoint=function($_,$S){return this.x>$_&&(this.width+=this.x-$_,this.x=$_),this.y>$S&&(this.height+=this.y-$S,this.y=$S),this.width<$_-this.x&&(this.width=$_-this.x),this.height<$S-this.y&&(this.height=$S-this.y),this},$_._getBoundPoints=function(){var $_=$u._temB;return($_.length=0)==this.width||0==this.height||$_.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$_},$_.isEmpty=function(){return this.width<=0||this.height<=0},$c(0,$_,"right",function(){return this.x+this.width}),$c(0,$_,"bottom",function(){return this.y+this.height}),$u._getBoundPointS=function($_,$S,$j,$O){var $V=$u._temA;return($V.length=0)==$j||0==$O||$V.push($_,$S,$_+$j,$S,$_,$S+$O,$_+$j,$S+$O),$V},$u._getWrapRec=function($_,$S){if(!$_||$_.length<1)return $S?$S.setTo(0,0,0,0):$u.TEMP.setTo(0,0,0,0);$S=$S||new $u;var $j,$O,$V,$M,$R,$w=$_.length,$a=$y.TEMP;for($V=$R=-($O=$M=99999),$j=0;$j<$w;$j+=2)$a.x=$_[$j],$a.y=$_[$j+1],$O=$O<$a.x?$O:$a.x,$M=$M<$a.y?$M:$a.y,$V=$V>$a.x?$V:$a.x,$R=$R>$a.y?$R:$a.y;return $S.setTo($O,$M,$V-$O,$R-$M)},$u.EMPTY=new $u,$u.TEMP=new $u,$u._temB=[],$u._temA=[],$u}(),$$=function(){function $a(){}return $v($a,"laya.media.SoundManager"),$c(1,$a,"useAudioMusic",function(){return $a._useAudioMusic},function($_){$a._useAudioMusic=$_,$a._musicClass=$_?$j_:null}),$c(1,$a,"autoStopMusic",function(){return $a._autoStopMusic},function($_){$f.stage.off("blur",null,$a._stageOnBlur),$f.stage.off("focus",null,$a._stageOnFocus),$f.stage.off("visibilitychange",null,$a._visibilityChange),($a._autoStopMusic=$_)&&($f.stage.on("blur",null,$a._stageOnBlur),$f.stage.on("focus",null,$a._stageOnFocus),$f.stage.on("visibilitychange",null,$a._visibilityChange))}),$c(1,$a,"muted",function(){return $a._muted},function($_){$_!=$a._muted&&($_&&$a.stopAllSound(),$a.musicMuted=$_,$a._muted=$_)}),$c(1,$a,"musicMuted",function(){return $a._musicMuted},function($_){$_!=$a._musicMuted&&($_?($a._tMusic&&$a._musicChannel&&!$a._musicChannel.isStopped?$a._musicChannel.pause():$a._musicChannel=null,$a._musicMuted=$_):($a._musicMuted=$_,$a._tMusic&&$a._musicChannel&&$a._musicChannel.resume()))}),$c(1,$a,"soundMuted",function(){return $a._soundMuted},function($_){$a._soundMuted=$_}),$a.addChannel=function($_){0<=$a._channels.indexOf($_)||($a._channels.push($_),$a.autoReleaseSound&&0!=$a._notUsedCount&&$a._notUsedUrls[$_.url]&&(delete $a._notUsedUrls[$_.url],0==--$a._notUsedCount&&$f.timer.clear($a,$a.disposeSoundIfNotUsed)))},$a.removeChannel=function($_){var $S=$a._channels,$j=$S.indexOf($_);if(-1!=$j&&($S.splice($j,1),$a.autoReleaseSound)){var $O=$_.url,$V=$a.defaultIntervals[$O]||2e4;if(0<$V){var $M=!0;for($j=$S.length-1;0<=$j;$j--)if($S[$j].url==$O){$M=!1;break}$M&&($a._notUsedUrls[$O]=Date.now()+$V,0==$a._notUsedCount++&&$f.timer.loop(1e4,$a,$a.disposeSoundIfNotUsed))}}},$a.disposeSoundIfNotUsed=function(){var $_=$a._notUsedUrls;if(0!=$a._notUsedCount){var $S=Date.now();for(var $j in $_)$S>=$_[$j]&&(delete $_[$j],--$a._notUsedCount,$a.destroySound($j));if(0!=$a._notUsedCount)return}$f.timer.clear($a,$a.disposeSoundIfNotUsed)},$a._visibilityChange=function(){$f.stage.isVisibility?$a._stageOnFocus():$a._stageOnBlur()},$a._stageOnBlur=function(){$a._isActive=!1,$a._musicChannel&&($a._musicChannel.isStopped||($a._blurPaused=!0,$a._musicChannel.pause())),$a.stopAllSound(),$f.stage.once("mousedown",null,$a._stageOnFocus)},$a._recoverWebAudio=function(){$M_.ctx&&"running"!=$M_.ctx.state&&$M_.ctx.resume&&$M_.ctx.resume()},$a._stageOnFocus=function(){if($a._isActive=!0,$a._recoverWebAudio(),$f.stage.off("mousedown",null,$a._stageOnFocus),$a._blurPaused){var $_=$a._musicChannel;$_&&$a._music&&$_.isStopped&&($a._blurPaused=!1,$a._music._disposed?$a.playMusic($_.url,$_.loops,$_.startHandler,$_.completeHandler,$_.startTime):$_.audioBuffer?$_.resume():$a._music.play($_.startTime,$_.loops,$_.startHandler,$_))}},$a.playSound=function($_,$S,$j,$O,$V,$M){if(void 0===$S&&($S=1),void 0===$M&&($M=0),!$_)return null;if($a._muted)return null;if($a._recoverWebAudio(),$_==$a._tMusic){if($a._musicMuted)return null}else{if(!$a._isActive)return null;if($a._soundMuted)return null}var $R,$w=$a._pool[$_];return $V||($V=$a._soundClass),$w||(($w=new $V).load($_),$a._pool[$_]=$w),($R=$w.play($M,$S,$j))?($_==$a._tMusic&&($a._music=$w,$a._isActive||($a._blurPaused=!0,$R.pause())),$R.url=$_,$R.volume=$_==$a._tMusic?$a.musicVolume:$a.soundVolume,$R.completeHandler=$O,$R):null},$a.destroySound=function($_){var $S=$a._pool[$_];$S&&(delete $a._pool[$_],$S.dispose())},$a.playMusic=function($_,$S,$j,$O,$V){return void 0===$S&&($S=0),void 0===$V&&($V=0),$a._tMusic=$_,$a._musicChannel&&$a._musicChannel.stop(),$a._musicChannel=$a.playSound($_,$S,$j,$O,null,$V)},$a.stopSound=function($_){for(var $S,$j=$a._channels.length-1;0<=$j;$j--)($S=$a._channels[$j]).url==$_&&$S.stop()},$a.stopAll=function(){$a._tMusic=null;var $_=0;for($_=$a._channels.length-1;0<=$_;$_--)$a._channels[$_].stop()},$a.stopAllSound=function(){var $_,$S=0;for($S=$a._channels.length-1;0<=$S;$S--)($_=$a._channels[$S]).url!=$a._tMusic&&$_.stop()},$a.stopMusic=function(){$a._musicChannel&&$a._musicChannel.stop(),$a._tMusic=null},$a.setSoundVolume=function($_,$S){if($S)$a._setVolume($S,$_);else{$a.soundVolume=$_;var $j,$O=0;for($O=$a._channels.length-1;0<=$O;$O--)($j=$a._channels[$O]).url!=$a._tMusic&&($j.volume=$_)}},$a.setMusicVolume=function($_){$a.musicVolume=$_,$a._setVolume($a._tMusic,$_)},$a._setVolume=function($_,$S){for(var $j,$O=$a._channels.length-1;0<=$O;$O--)($j=$a._channels[$O]).url==$_&&($j.volume=$S)},$a.musicVolume=1,$a.soundVolume=1,$a.playbackRate=1,$a._useAudioMusic=!0,$a._muted=!1,$a._soundMuted=!1,$a._musicMuted=!1,$a._tMusic=null,$a._musicChannel=null,$a._music=null,$a._channels=[],$a._autoStopMusic=!1,$a._blurPaused=!1,$a._isActive=!0,$a._soundClass=null,$a._musicClass=null,$a.autoReleaseSound=!0,$a._pool={},$a.defaultIntervals={},$a._notUsedUrls={},$a._notUsedCount=0,$a}(),$g=function(){var $_;function $j(){}return $v($j,"laya.net.LocalStorage"),$j.__init__=function(){$j._baseClass||($j._baseClass=$_).init(),$j.items=$j._baseClass.items,$j.support=$j._baseClass.support},$j.setItem=function($_,$S){$j._baseClass.setItem($_,$S)},$j.getItem=function($_){return $j._baseClass.getItem($_)},$j.setJSON=function($_,$S){$j._baseClass.setJSON($_,$S)},$j.getJSON=function($_){return $j._baseClass.getJSON($_)},$j.removeItem=function($_){$j._baseClass.removeItem($_)},$j.clear=function(){$j._baseClass.clear()},$j._baseClass=null,$j.items=null,$j.support=!1,$j.__init$=function(){$_=function(){function $j(){}return $v($j,""),$j.init=function(){try{$j.support=!0,$j.items=$R.localStorage,$j.setItem("laya","1"),$j.removeItem("laya")}catch($_){$j.support=!1}$j.support||console.log("LocalStorage is not supprot or browser is private mode.")},$j.setItem=function($_,$S){try{$j.support&&$j.items.setItem($_,$S)}catch($_){console.warn("set localStorage failed",$_)}},$j.getItem=function($_){return $j.support?$j.items.getItem($_):null},$j.setJSON=function($_,$S){try{$j.support&&$j.items.setItem($_,JSON.stringify($S))}catch($_){console.warn("set localStorage failed",$_)}},$j.getJSON=function($_){return JSON.parse($j.support?$j.items.getItem($_):null)},$j.removeItem=function($_){$j.support&&$j.items.removeItem($_)},$j.clear=function(){$j.support&&$j.items.clear()},$j.items=null,$j.support=!1,$j}()},$j}(),$J=(function(){function $O(){}$v($O,"laya.net.ResourceVersion"),$O.enable=function($_,$S,$j){void 0===$j&&($j=2),laya.net.ResourceVersion.type=$j,$f.loader.load($_,$l.create(null,$O.onManifestLoaded,[$S]),null,"json"),$F.customFormat=$O.addVersionPrefix},$O.onManifestLoaded=function($_,$S){$O.manifest=$S,$_.run(),$S||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$O.addVersionPrefix=function($_){return $O.manifest&&$O.manifest[$_]?2==$O.type?$O.manifest[$_]:$O.manifest[$_]+"/"+$_:$_},$O.FOLDER_VERSION=1,$O.FILENAME_VERSION=2,$O.manifest=null,$O.type=1}(),function(){function $_(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$v($_,"laya.net.TTFLoader");var $S=$_.prototype;return $S.load=function($_){var $S=(this._url=$_).split(".ttf")[0].split("/");this.fontName=$S[$S.length-1],$m.window.conch?this._loadConch():$m.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$S._loadConch=function(){this._http=new $R_,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$S._onHttpLoaded=function($_){$m.window.conch.setFontFaceFromBuffer(this.fontName,$_),this._clearHttp(),this._complete()},$S._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$S._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$S._complete=function(){$f.timer.clear(this,this._complete),$f.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$S._checkComplete=function(){$d.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$S._loadWithFontFace=function(){var $_=new $m.window.FontFace(this.fontName,"url('"+this._url+"')");$m.window.document.fonts.add($_);var $S=this;$_.loaded.then(function(){$S._complete()}),$_.load()},$S._createDiv=function(){this._div=$m.createElement("div"),this._div.innerHTML="laya";var $_=this._div.style;$_.fontFamily=this.fontName,$_.position="absolute",$_.left="-100px",$_.top="-100px",$m.document.body.appendChild(this._div)},$S._loadWithCSS=function(){var $_=this,$S=$m.createElement("style");$S.type="text/css",$m.document.body.appendChild($S),$S.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$d.measureText("LayaTTFFont",this._fontTxt).width;var $j=this;$S.onload=function(){$f.timer.once(1e4,$j,$_._complete)},$f.timer.loop(20,this,this._checkComplete),this._createDiv()},$_._testString="LayaTTFFont",$_}()),$F=function(){function $O($_){this._url=null,this._path=null,this._url=$O.formatURL($_),this._path=$O.getPath($_)}$v($O,"laya.net.URL");var $_=$O.prototype;return $c(0,$_,"path",function(){return this._path}),$c(0,$_,"url",function(){return this._url}),$O.formatURL=function($_,$S){if(!$_)return"null path";if(0<$_.indexOf(":"))return $_;null!=$O.customFormat&&($_=$O.customFormat($_,$S));var $j=$_.charAt(0);if("."===$j)return $O.formatRelativePath(($S||$O.basePath)+$_);if("~"===$j)return $O.rootPath+$_.substring(1);if("d"===$j){if(0===$_.indexOf("data:image"))return $_}else if("/"===$j)return $_;return($S||$O.basePath)+$_},$O.formatRelativePath=function($_){for(var $S=$_.split("/"),$j=0,$O=$S.length;$j<$O;$j++)".."==$S[$j]&&($S.splice($j-1,2),$j-=2);return $S.join("/")},$O.isAbsolute=function($_){return 0<$_.indexOf(":")||"/"==$_.charAt(0)},$O.getPath=function($_){var $S=$_.lastIndexOf("/");return 0<$S?$_.substr(0,$S+1):""},$O.getFileName=function($_){var $S=$_.lastIndexOf("/");return 0<$S?$_.substr($S+1):$_},$O.version={},$O.basePath="",$O.rootPath="",$O.customFormat=function($_){var $S=$O.version[$_];return!$x.isConchApp&&$S&&($_+="?v="+$S),$_},$O}(),$x=function(){function $V($_,$S){this._timeId=0;var $j=$V._mainCanvas.source.style;$j.position="absolute",$j.top=$j.left="0px",$j.background="#000000",$V._mainCanvas.source.id="layaCanvas";var $O=laya.renders.Render.isWebGL;$V._mainCanvas.source.width=$_,$V._mainCanvas.source.height=$S,$O&&$V.WebGL.init($V._mainCanvas,$_,$S),$m.container.appendChild($V._mainCanvas.source),($V._context=new $h($_,$S,$O?null:$V._mainCanvas)).ctx.setIsMainContext(),$m.window.requestAnimationFrame(function $_($S){$m.window.requestAnimationFrame($_);$f.stage._loop()}),$f.stage.on("visibilitychange",this,this._onVisibilitychange)}$v($V,"laya.renders.Render");var $_=$V.prototype;return $_._onVisibilitychange=function(){$f.stage.isVisibility?0!=this._timeId&&$m.window.clearInterval(this._timeId):this._timeId=$m.window.setInterval(this._enterFrame,1e3)},$_._enterFrame=function($_){$f.stage._loop()},$c(1,$V,"context",function(){return $V._context}),$c(1,$V,"canvas",function(){return $V._mainCanvas.source}),$V._context=null,$V._mainCanvas=null,$V.WebGL=null,$V.isConchNode=!1,$V.isConchApp=!1,$V.isConchWebGL=!1,$V.isWebGL=!1,$V.is3DMode=!1,$V.optimizeTextureMemory=function($_,$S){return!0},$V.__init$=function(){$R.ConchRenderType=$R.ConchRenderType||1,$R.ConchRenderType|=$R.conch?4:0,$V.isConchNode=5==(5&$R.ConchRenderType),$V.isConchApp=4==(4&$R.ConchRenderType),$V.isConchWebGL=6==$R.ConchRenderType},$V}(),$h=function(){function $R($_,$S,$j){this.x=0,this.y=0,this._drawTexture=function($_,$S,$j){$j[0].loaded&&this.ctx.drawTexture($j[0],$j[1],$j[2],$j[3],$j[4],$_,$S)},this._fillTexture=function($_,$S,$j){$j[0].loaded&&this.ctx.fillTexture($j[0],$j[1]+$_,$j[2]+$S,$j[3],$j[4],$j[5],$j[6],$j[7])},this._drawTextureWithTransform=function($_,$S,$j){$j[0].loaded&&this.ctx.drawTextureWithTransform($j[0],$j[1],$j[2],$j[3],$j[4],$j[5],$_,$S,$j[6])},this._fillQuadrangle=function($_,$S,$j){this.ctx.fillQuadrangle($j[0],$j[1],$j[2],$j[3],$j[4])},this._drawRect=function($_,$S,$j){var $O=this.ctx;null!=$j[4]&&($O.fillStyle=$j[4],$O.fillRect($_+$j[0],$S+$j[1],$j[2],$j[3],null)),null!=$j[5]&&($O.strokeStyle=$j[5],$O.lineWidth=$j[6],$O.strokeRect($_+$j[0],$S+$j[1],$j[2],$j[3],$j[6]))},this._drawPie=function($_,$S,$j){var $O=this.ctx;$x.isWebGL&&$O.setPathId($j[8]),$O.beginPath(),$x.isWebGL?($O.movePath($j[0]+$_,$j[1]+$S),$O.moveTo(0,0)):$O.moveTo($_+$j[0],$S+$j[1]),$O.arc($_+$j[0],$S+$j[1],$j[2],$j[3],$j[4]),$O.closePath(),this._fillAndStroke($j[5],$j[6],$j[7],!0)},this._clipRect=function($_,$S,$j){this.ctx.clipRect($_+$j[0],$S+$j[1],$j[2],$j[3])},this._fillRect=function($_,$S,$j){this.ctx.fillRect($_+$j[0],$S+$j[1],$j[2],$j[3],$j[4])},this._drawCircle=function($_,$S,$j){var $O=this.ctx;$x.isWebGL&&$O.setPathId($j[6]),$W.drawCall++,$O.beginPath(),$x.isWebGL&&$O.movePath($j[0]+$_,$j[1]+$S),$O.arc($j[0]+$_,$j[1]+$S,$j[2],0,$R.PI2),$O.closePath(),this._fillAndStroke($j[3],$j[4],$j[5],!0)},this._fillCircle=function($_,$S,$j){$W.drawCall++;var $O=this.ctx;$O.beginPath(),$O.fillStyle=$j[3],$O.arc($j[0]+$_,$j[1]+$S,$j[2],0,$R.PI2),$O.fill()},this._setShader=function($_,$S,$j){this.ctx.setShader($j[0])},this._drawLine=function($_,$S,$j){var $O=this.ctx;$x.isWebGL&&$O.setPathId($j[6]),$O.beginPath(),$O.strokeStyle=$j[4],$O.lineWidth=$j[5],$x.isWebGL?($O.movePath($_,$S),$O.moveTo($j[0],$j[1]),$O.lineTo($j[2],$j[3])):($O.moveTo($_+$j[0],$S+$j[1]),$O.lineTo($_+$j[2],$S+$j[3])),$O.stroke()},this._drawLines=function($_,$S,$j){var $O=this.ctx;$x.isWebGL&&$O.setPathId($j[5]),$O.beginPath(),$_+=$j[0],$S+=$j[1],$x.isWebGL&&$O.movePath($_,$S),$O.strokeStyle=$j[3],$O.lineWidth=$j[4];var $V=$j[2],$M=2,$R=$V.length;if($x.isWebGL)for($O.moveTo($V[0],$V[1]);$M<$R;)$O.lineTo($V[$M++],$V[$M++]);else for($O.moveTo($_+$V[0],$S+$V[1]);$M<$R;)$O.lineTo($_+$V[$M++],$S+$V[$M++]);$O.stroke()},this._drawLinesWebGL=function($_,$S,$j){this.ctx.drawLines($_+this.x+$j[0],$S+this.y+$j[1],$j[2],$j[3],$j[4])},this._drawCurves=function($_,$S,$j){this.ctx.drawCurves($_,$S,$j)},this._draw=function($_,$S,$j){$j[0].call(null,this,$_,$S)},this._transformByMatrix=function($_,$S,$j){this.ctx.transformByMatrix($j[0])},this._setTransform=function($_,$S,$j){this.ctx.setTransform($j[0],$j[1],$j[2],$j[3],$j[4],$j[5])},this._setTransformByMatrix=function($_,$S,$j){this.ctx.setTransformByMatrix($j[0])},this._save=function($_,$S,$j){this.ctx.save()},this._restore=function($_,$S,$j){this.ctx.restore()},this._translate=function($_,$S,$j){this.ctx.translate($j[0],$j[1])},this._transform=function($_,$S,$j){this.ctx.translate($j[1]+$_,$j[2]+$S);var $O=$j[0];this.ctx.transform($O.a,$O.b,$O.c,$O.d,$O.tx,$O.ty),this.ctx.translate(-$_-$j[1],-$S-$j[2])},this._rotate=function($_,$S,$j){this.ctx.translate($j[1]+$_,$j[2]+$S),this.ctx.rotate($j[0]),this.ctx.translate(-$_-$j[1],-$S-$j[2])},this._scale=function($_,$S,$j){this.ctx.translate($j[2]+$_,$j[3]+$S),this.ctx.scale($j[0],$j[1]),this.ctx.translate(-$_-$j[2],-$S-$j[3])},this._alpha=function($_,$S,$j){this.ctx.globalAlpha*=$j[0]},this._setAlpha=function($_,$S,$j){this.ctx.globalAlpha=$j[0]},this._fillText=function($_,$S,$j){this.ctx.fillText($j[0],$j[1]+$_,$j[2]+$S,$j[3],$j[4],$j[5])},this._strokeText=function($_,$S,$j){this.ctx.strokeText($j[0],$j[1]+$_,$j[2]+$S,$j[3],$j[4],$j[5],$j[6])},this._fillBorderText=function($_,$S,$j){this.ctx.fillBorderText($j[0],$j[1]+$_,$j[2]+$S,$j[3],$j[4],$j[5],$j[6],$j[7])},this._blendMode=function($_,$S,$j){this.ctx.globalCompositeOperation=$j[0]},this._beginClip=function($_,$S,$j){this.ctx.beginClip&&this.ctx.beginClip($_+$j[0],$S+$j[1],$j[2],$j[3])},this._setIBVB=function($_,$S,$j){this.ctx.setIBVB($j[0]+$_,$j[1]+$S,$j[2],$j[3],$j[4],$j[5],$j[6],$j[7])},this._fillTrangles=function($_,$S,$j){this.ctx.fillTrangles($j[0],$j[1]+$_,$j[2]+$S,$j[3],$j[4])},this._drawPath=function($_,$S,$j){var $O=this.ctx;$x.isWebGL&&$O.setPathId(-1),$O.beginPath(),$_+=$j[0],$S+=$j[1],$x.isWebGL&&$O.movePath($_,$S);for(var $V=$j[2],$M=0,$R=$V.length;$M<$R;$M++){var $w=$V[$M];switch($w[0]){case"moveTo":$x.isWebGL?$O.moveTo($w[1],$w[2]):$O.moveTo($_+$w[1],$S+$w[2]);break;case"lineTo":$x.isWebGL?$O.lineTo($w[1],$w[2]):$O.lineTo($_+$w[1],$S+$w[2]);break;case"arcTo":$x.isWebGL?$O.arcTo($w[1],$w[2],$w[3],$w[4],$w[5]):$O.arcTo($_+$w[1],$S+$w[2],$_+$w[3],$S+$w[4],$w[5]);break;case"closePath":$O.closePath()}}var $a=$j[3];null!=$a&&($O.fillStyle=$a.fillStyle,$O.fill());var $u=$j[4];null!=$u&&($O.strokeStyle=$u.strokeStyle,$O.lineWidth=$u.lineWidth||1,$O.lineJoin=$u.lineJoin,$O.lineCap=$u.lineCap,$O.miterLimit=$u.miterLimit,$O.stroke())},this.drawPoly=function($_,$S,$j){this.ctx.drawPoly($_+this.x+$j[0],$S+this.y+$j[1],$j[2],$j[3],$j[4],$j[5],$j[6])},this._drawPoly=function($_,$S,$j){var $O=this.ctx,$V=$j[2],$M=2,$R=$V.length;if($x.isWebGL)for($O.setPathId($j[6]),$O.beginPath(),$_+=$j[0],$S+=$j[1],$O.movePath($_,$S),$O.moveTo($V[0],$V[1]);$M<$R;)$O.lineTo($V[$M++],$V[$M++]);else for($O.beginPath(),$_+=$j[0],$S+=$j[1],$O.moveTo($_+$V[0],$S+$V[1]);$M<$R;)$O.lineTo($_+$V[$M++],$S+$V[$M++]);$O.closePath(),this._fillAndStroke($j[3],$j[4],$j[5],$j[7])},this._drawSkin=function($_,$S,$j){var $O=$j[0];if($O){var $V=this.ctx;$O.render($V,$_,$S)}},this._drawParticle=function($_,$S,$j){this.ctx.drawParticle($_+this.x,$S+this.y,$j[0])},this._setFilters=function($_,$S,$j){this.ctx.setFilters($j)},$j?this.ctx=$j.getContext("2d"):($j=$k_.create("3D"),this.ctx=$d.createWebGLContext2D($j),$j._setContext(this.ctx)),$j.size($_,$S),this.canvas=$j}$v($R,"laya.renders.RenderContext");var $_=$R.prototype;return $_.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$_.drawTexture=function($_,$S,$j,$O,$V){$_.loaded&&this.ctx.drawTexture($_,$S,$j,$O,$V,this.x,this.y)},$_._drawTextures=function($_,$S,$j){$j[0].loaded&&this.ctx.drawTextures($j[0],$j[1],$_+this.x,$S+this.y)},$_.drawTextureWithTransform=function($_,$S,$j,$O,$V,$M,$R){$_.loaded&&this.ctx.drawTextureWithTransform($_,$S,$j,$O,$V,$M,this.x,this.y,$R)},$_.fillQuadrangle=function($_,$S,$j,$O,$V){this.ctx.fillQuadrangle($_,$S,$j,$O,$V)},$_.drawCanvas=function($_,$S,$j,$O,$V){this.ctx.drawCanvas($_,$S+this.x,$j+this.y,$O,$V)},$_.drawRect=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=1);var $R=this.ctx;$R.strokeStyle=$V,$R.lineWidth=$M,$R.strokeRect($_+this.x,$S+this.y,$j,$O,$M)},$_._fillAndStroke=function($_,$S,$j,$O){void 0===$O&&($O=!1);var $V=this.ctx;null!=$_&&($V.fillStyle=$_,$x.isWebGL?$V.fill($O):$V.fill()),null!=$S&&0<$j&&($V.strokeStyle=$S,$V.lineWidth=$j,$V.stroke())},$_.clipRect=function($_,$S,$j,$O){this.ctx.clipRect($_+this.x,$S+this.y,$j,$O)},$_.fillRect=function($_,$S,$j,$O,$V){this.ctx.fillRect($_+this.x,$S+this.y,$j,$O,$V)},$_.drawCircle=function($_,$S,$j,$O,$V){void 0===$V&&($V=1),$W.drawCall++;var $M=this.ctx;$M.beginPath(),$M.strokeStyle=$O,$M.lineWidth=$V,$M.arc($_+this.x,$S+this.y,$j,0,$R.PI2),$M.stroke()},$_.drawTriangles=function($_,$S,$j){if($x.isWebGL)this.ctx.drawTriangles($j[0],$_+$j[1],$S+$j[2],$j[3],$j[4],$j[5],$j[6],$j[7],$j[8],$j[9]);else{var $O=$j[5],$V=0,$M=$O.length,$R=this.ctx;for($V=0;$V<$M;$V+=3){var $w=2*$O[$V],$a=2*$O[$V+1],$u=2*$O[$V+2];$R.drawTriangle($j[0],$j[3],$j[4],$w,$a,$u,$j[6],!0)}}},$_.fillCircle=function($_,$S,$j,$O){$W.drawCall++;var $V=this.ctx;$V.beginPath(),$V.fillStyle=$O,$V.arc($_+this.x,$S+this.y,$j,0,$R.PI2),$V.fill()},$_.setShader=function($_){this.ctx.setShader($_)},$_.drawLine=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=1);var $R=this.ctx;$R.beginPath(),$R.strokeStyle=$V,$R.lineWidth=$M,$R.moveTo(this.x+$_,this.y+$S),$R.lineTo(this.x+$j,this.y+$O),$R.stroke()},$_.clear=function(){this.ctx.clear()},$_.transformByMatrix=function($_){this.ctx.transformByMatrix($_)},$_.setTransform=function($_,$S,$j,$O,$V,$M){this.ctx.setTransform($_,$S,$j,$O,$V,$M)},$_.setTransformByMatrix=function($_){this.ctx.setTransformByMatrix($_)},$_.save=function(){this.ctx.save()},$_.restore=function(){this.ctx.restore()},$_.translate=function($_,$S){this.ctx.translate($_,$S)},$_.transform=function($_,$S,$j,$O,$V,$M){this.ctx.transform($_,$S,$j,$O,$V,$M)},$_.rotate=function($_){this.ctx.rotate($_)},$_.scale=function($_,$S){this.ctx.scale($_,$S)},$_.alpha=function($_){this.ctx.globalAlpha*=$_},$_.setAlpha=function($_){this.ctx.globalAlpha=$_},$_.fillWords=function($_,$S,$j,$O,$V,$M){void 0===$M&&($M=0),this.ctx.fillWords($_,$S,$j,$O,$V,$M)},$_.fillBorderWords=function($_,$S,$j,$O,$V,$M,$R){this.ctx.fillBorderWords($_,$S,$j,$O,$V,$M,$R)},$_.fillText=function($_,$S,$j,$O,$V,$M){this.ctx.fillText($_,$S+this.x,$j+this.y,$O,$V,$M)},$_.strokeText=function($_,$S,$j,$O,$V,$M,$R){this.ctx.strokeText($_,$S+this.x,$j+this.y,$O,$V,$M,$R)},$_.blendMode=function($_){this.ctx.globalCompositeOperation=$_},$_.flush=function(){this.ctx.flush&&this.ctx.flush()},$_.addRenderObject=function($_){this.ctx.addRenderObject($_)},$_.beginClip=function($_,$S,$j,$O){this.ctx.beginClip&&this.ctx.beginClip($_,$S,$j,$O)},$_.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$_.fillTrangles=function($_,$S,$j){this.ctx.fillTrangles($j[0],$j[1],$j[2],$j[3],4<$j.length?$j[4]:null)},$R.PI2=2*Math.PI,$R}(),$N=function(){function $R($_,$S){switch(this._next=$S||$R.NORENDER,$_){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$o._filter);case 69905:return void(this._fun=$R._initRenderFun)}this.onCreate($_)}$v($R,"laya.renders.RenderSprite");var $_=$R.prototype;return $_.onCreate=function($_){},$_._style=function($_,$S,$j,$O){$_._style.render($_,$S,$j,$O);var $V=this._next;$V._fun.call($V,$_,$S,$j,$O)},$_._no=function($_,$S,$j,$O){},$_._custom=function($_,$S,$j,$O){$_.customRender($S,$j,$O);var $V=$_._style._tf;this._next._fun.call(this._next,$_,$S,$j-$V.translateX,$O-$V.translateY)},$_._clip=function($_,$S,$j,$O){var $V=this._next;if($V!=$R.NORENDER){var $M=$_._style.scrollRect;$S.ctx.save(),$S.ctx.clipRect($j,$O,$M.width,$M.height),$V._fun.call($V,$_,$S,$j-$M.x,$O-$M.y),$S.ctx.restore()}},$_._blend=function($_,$S,$j,$O){var $V=$_._style;$V.blendMode&&($S.ctx.globalCompositeOperation=$V.blendMode);var $M=this._next;$M._fun.call($M,$_,$S,$j,$O),$S.ctx.globalCompositeOperation="source-over"},$_._mask=function($_,$S,$j,$O){var $V=this._next;$V._fun.call($V,$_,$S,$j,$O);var $M=$_.mask;$M&&($S.ctx.globalCompositeOperation="destination-in",(0<$M.numChildren||!$M.graphics._isOnlyOne())&&($M.cacheAsBitmap=!0),$M.render($S,$j-$_.pivotX,$O-$_.pivotY)),$S.ctx.globalCompositeOperation="source-over"},$_._graphics=function($_,$S,$j,$O){var $V=$_._style._tf;$_._graphics&&$_._graphics._render($_,$S,$j-$V.translateX,$O-$V.translateY);var $M=this._next;$M._fun.call($M,$_,$S,$j,$O)},$_._image=function($_,$S,$j,$O){var $V=$_._style;$S.ctx.drawTexture2($j,$O,$V._tf.translateX,$V._tf.translateY,$_.transform,$V.alpha,$V.blendMode,$_._graphics._one)},$_._image2=function($_,$S,$j,$O){var $V=$_._style._tf;$S.ctx.drawTexture2($j,$O,$V.translateX,$V.translateY,$_.transform,1,null,$_._graphics._one)},$_._alpha=function($_,$S,$j,$O){var $V;if(.01<($V=$_._style.alpha)||$_._needRepaint()){var $M=$S.ctx.globalAlpha;$S.ctx.globalAlpha*=$V;var $R=this._next;$R._fun.call($R,$_,$S,$j,$O),$S.ctx.globalAlpha=$M}},$_._transform=function($_,$S,$j,$O){var $V=$_.transform,$M=this._next;$V&&$M!=$R.NORENDER?($S.save(),$S.transform($V.a,$V.b,$V.c,$V.d,$V.tx+$j,$V.ty+$O),$M._fun.call($M,$_,$S,0,0),$S.restore()):$M._fun.call($M,$_,$S,$j,$O)},$_._childs=function($_,$S,$j,$O){var $V=$_._style,$M=$V._tf;if($j=$j-$M.translateX+$V.paddingLeft,$O=$O-$M.translateY+$V.paddingTop,$V._calculation){var $R=$_._getWords();if($R){var $w=$V;$w&&($w.stroke?$S.fillBorderWords($R,$j,$O,$w.font,$w.color,$w.strokeColor,$w.stroke):$S.fillWords($R,$j,$O,$w.font,$w.color,"none"!=$w.textDecoration&&$w.underLine?1:0))}}var $a,$u=$_._childs,$c=$u.length;if($_.viewport||$_.optimizeScrollRect&&$_._style.scrollRect){var $q=$_.viewport||$_._style.scrollRect,$s=$q.x,$C=$q.y,$i=$q.right,$v=$q.bottom,$Z=NaN,$o=NaN;for($l=0;$l<$c;++$l)($a=$u[$l]).visible&&($Z=$a._x)<$i&&$Z+$a.width>$s&&($o=$a._y)<$v&&$o+$a.height>$C&&$a.render($S,$j,$O)}else for(var $l=0;$l<$c;++$l)($a=$u[$l])._style.visible&&$a.render($S,$j,$O)},$_._canvas=function($_,$S,$j,$O){var $V=$_._$P.cacheCanvas;if($V){"bitmap"===$V.type?$W.canvasBitmap++:$W.canvasNormal++;var $M=$V.ctx;if($_._needRepaint()||!$M)this._canvas_repaint($_,$S,$j,$O);else{var $R=$V._cacheRec;$S.drawCanvas($M.canvas,$j+$R.x,$O+$R.y,$R.width,$R.height)}}else this._next._fun.call(this._next,$_,$S,$j,$O)},$_._canvas_repaint=function($_,$S,$j,$O){var $V=$_._$P.cacheCanvas,$M=this._next;if($V){var $R,$w,$a,$u,$c=$V.ctx,$q=$_._needRepaint()||!$c,$s=$V.type;if("bitmap"===$s?$W.canvasBitmap++:$W.canvasNormal++,$q){var $C,$i;$V._cacheRec||($V._cacheRec=new $P),$x.isWebGL&&"bitmap"!==$s?$V._cacheRec.setTo(-$_.pivotX,-$_.pivotY,1,1):(($u=$_.getSelfBounds()).x=$u.x-$_.pivotX,$u.y=$u.y-$_.pivotY,$u.x=$u.x-16,$u.y=$u.y-16,$u.width=$u.width+32,$u.height=$u.height+32,$u.x=Math.floor($u.x+$j)-$j,$u.y=Math.floor($u.y+$O)-$O,$u.width=Math.floor($u.width),$u.height=Math.floor($u.height),$V._cacheRec.copyFrom($u)),$u=$V._cacheRec;var $v,$Z=$x.isWebGL?1:$m.pixelRatio*$f.stage.clientScaleX,$o=$x.isWebGL?1:$m.pixelRatio*$f.stage.clientScaleY;if(!$x.isWebGL){var $l,$k=1,$z=1;for($l=$_;$l&&$l!=$f.stage;)$k*=$l.scaleX,$z*=$l.scaleY,$l=$l.parent;$x.isWebGL?($k<1&&($Z*=$k),$z<1&&($o*=$z)):(1<$k&&($Z*=$k),1<$z&&($o*=$z))}if($_.scrollRect){var $H=$_.scrollRect;$u.x-=$H.x,$u.y-=$H.y}if($C=$u.width*$Z,$i=$u.height*$o,$w=$u.x,$a=$u.y,$x.isWebGL&&"bitmap"===$s&&(2048<$C||2048<$i))return console.warn("cache bitmap size larger than 2048,cache ignored"),$V.ctx&&($T.recover("RenderContext",$V.ctx),$V.ctx.canvas.size(0,0),$V.ctx=null),void $M._fun.call($M,$_,$S,$j,$O);if($c||($c=$V.ctx=$T.getItem("RenderContext")||new $h($C,$i,$k_.create("AUTO"))),$c.ctx.sprite=$_,($R=$c.canvas).clear(),($R.width!=$C||$R.height!=$i)&&$R.size($C,$i),"bitmap"===$s?$R.context.asBitmap=!0:"normal"===$s&&($R.context.asBitmap=!1),1!=$Z||1!=$o){var $A=$c.ctx;$A.save(),$A.scale($Z,$o),!$x.isConchWebGL&&$x.isConchApp&&($v=$_._$P.cf)&&$A.setFilterMatrix&&$A.setFilterMatrix($v._mat,$v._alpha),$M._fun.call($M,$_,$c,-$w,-$a),$A.restore(),$x.isConchApp&&!$x.isConchWebGL||$_._applyFilters()}else $A=$c.ctx,!$x.isConchWebGL&&$x.isConchApp&&($v=$_._$P.cf)&&$A.setFilterMatrix&&$A.setFilterMatrix($v._mat,$v._alpha),$M._fun.call($M,$_,$c,-$w,-$a),$x.isConchApp&&!$x.isConchWebGL||$_._applyFilters();$_._$P.staticCache&&($V.reCache=!1),$W.canvasReCache++}else $w=($u=$V._cacheRec).x,$a=$u.y,$R=$c.canvas;$S.drawCanvas($R,$j+$w,$O+$a,$u.width,$u.height)}else $M._fun.call($M,$_,$c,$j,$O)},$R.__init__=function(){var $_,$S,$j=0;for($S=$d.createRenderSprite(69905,null),$_=$R.renders.length=4096,$j=0;$j<$_;$j++)$R.renders[$j]=$S;$R.renders[0]=$d.createRenderSprite(0,null),function($_,$S){for(var $j=0,$O=0;$O<$_.length;$O++)$j|=$_[$O],$R.renders[$j]=$S}([1,512,4,2],new $R(1,null)),$R.renders[513]=$d.createRenderSprite(513,null),$R.renders[517]=new $R(517,null)},$R._initRenderFun=function($_,$S,$j,$O){var $V=$_._renderType;($R.renders[$V]=$R._getTypeRender($V))._fun($_,$S,$j,$O)},$R._getTypeRender=function($_){for(var $S=null,$j=2048;1<$j;)$j&$_&&($S=$d.createRenderSprite($j,$S)),$j>>=1;return $S},$R.IMAGE=1,$R.ALPHA=2,$R.TRANSFORM=4,$R.BLEND=8,$R.CANVAS=16,$R.FILTERS=32,$R.MASK=64,$R.CLIP=128,$R.STYLE=256,$R.GRAPHICS=512,$R.CUSTOM=1024,$R.CHILDS=2048,$R.INIT=69905,$R.renders=[],$R.NORENDER=new $R(0,null),$R}(),$B=function(){function $w(){this._repaint=!1}$v($w,"laya.resource.Context");var $_=$w.prototype;return $_.replaceReset=function(){var $_,$S,$j=0;for($_=$w.replaceKeys.length,$j=0;$j<$_;$j++)$S=$w.replaceKeys[$j],this[$w.newKeys[$j]]=this[$S]},$_.replaceResotre=function(){this.__restore(),this.__reset()},$_.setIsMainContext=function(){},$_.drawTextures=function($_,$S,$j,$O){$W.drawCall+=$S.length/2;for(var $V=$_.width,$M=$_.height,$R=0,$w=$S.length;$R<$w;$R+=2)this.drawTexture($_,$S[$R],$S[$R+1],$V,$M,$j,$O)},$_.drawCanvas=function($_,$S,$j,$O,$V){$W.drawCall++,this.drawImage($_.source,$S,$j,$O,$V)},$_.fillRect=function($_,$S,$j,$O,$V){$W.drawCall++,$V&&(this.fillStyle=$V),this.__fillRect($_,$S,$j,$O)},$_.fillText=function($_,$S,$j,$O,$V,$M){$W.drawCall++,3<arguments.length&&null!=$O&&(this.font=$O,this.fillStyle=$V,this.textAlign=$M,this.textBaseline="top"),this.__fillText($_,$S,$j)},$_.fillBorderText=function($_,$S,$j,$O,$V,$M,$R,$w){$W.drawCall++,this.font=$O,this.fillStyle=$V,this.textBaseline="top",this.strokeStyle=$M,this.lineWidth=$R,this.textAlign=$w,this.__strokeText($_,$S,$j),this.__fillText($_,$S,$j)},$_.strokeText=function($_,$S,$j,$O,$V,$M,$R){$W.drawCall++,3<arguments.length&&null!=$O&&(this.font=$O,this.strokeStyle=$V,this.lineWidth=$M,this.textAlign=$R,this.textBaseline="top"),this.__strokeText($_,$S,$j)},$_.transformByMatrix=function($_){this.transform($_.a,$_.b,$_.c,$_.d,$_.tx,$_.ty)},$_.setTransformByMatrix=function($_){this.setTransform($_.a,$_.b,$_.c,$_.d,$_.tx,$_.ty)},$_.clipRect=function($_,$S,$j,$O){$W.drawCall++,this.beginPath(),this.rect($_,$S,$j,$O),this.clip()},$_.drawTexture=function($_,$S,$j,$O,$V,$M,$R){$W.drawCall++;var $w=$_.uv,$a=$_.bitmap.width,$u=$_.bitmap.height;this.drawImage($_.source,$w[0]*$a,$w[1]*$u,($w[2]-$w[0])*$a,($w[5]-$w[3])*$u,$S+$M,$j+$R,$O,$V)},$_.drawTextureWithTransform=function($_,$S,$j,$O,$V,$M,$R,$w,$a){$W.drawCall++;var $u=$_.uv,$c=$_.bitmap.width,$q=$_.bitmap.height;this.save(),1!=$a&&(this.globalAlpha*=$a),$M?(this.transform($M.a,$M.b,$M.c,$M.d,$M.tx+$R,$M.ty+$w),this.drawImage($_.source,$u[0]*$c,$u[1]*$q,($u[2]-$u[0])*$c,($u[5]-$u[3])*$q,$S,$j,$O,$V)):this.drawImage($_.source,$u[0]*$c,$u[1]*$q,($u[2]-$u[0])*$c,($u[5]-$u[3])*$q,$S+$R,$j+$w,$O,$V),this.restore()},$_.drawTexture2=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=$w[0];if($a.loaded&&$a.bitmap&&$a.source){$W.drawCall++;var $u=1!==$M;if($u){var $c=this.globalAlpha;this.globalAlpha*=$M}var $q=$a.uv,$s=$a.bitmap.width,$C=$a.bitmap.height;$V?(this.save(),this.transform($V.a,$V.b,$V.c,$V.d,$V.tx+$_,$V.ty+$S),this.drawImage($a.source,$q[0]*$s,$q[1]*$C,($q[2]-$q[0])*$s,($q[5]-$q[3])*$C,$w[1]-$j,$w[2]-$O,$w[3],$w[4]),this.restore()):this.drawImage($a.source,$q[0]*$s,$q[1]*$C,($q[2]-$q[0])*$s,($q[5]-$q[3])*$C,$w[1]-$j+$_,$w[2]-$O+$S,$w[3],$w[4]),$u&&(this.globalAlpha=$c)}},$_.fillTexture=function($_,$S,$j,$O,$V,$M,$R,$w){if(!$w.pat){if($_.uv!=$c_.DEF_UV){var $a=new $k_("2D");$a.getContext("2d"),$a.size($_.width,$_.height),$a.context.drawTexture($_,0,0,$_.width,$_.height,0,0),$_=new $c_($a)}$w.pat=this.createPattern($_.bitmap.source,$M)}var $u=$S,$c=$j,$q=0,$s=0;$R&&($u+=$R.x%$_.width,$c+=$R.y%$_.height,$q-=$R.x%$_.width,$s-=$R.y%$_.height),this.translate($u,$c),this.fillRect($q,$s,$O,$V,$w.pat),this.translate(-$u,-$c)},$_.drawTriangle=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=$_.bitmap,$u=$a.source,$c=$_.width,$q=$_.height,$s=$a.width,$C=$a.height,$i=$j[$O]*$s,$v=$j[$V]*$s,$Z=$j[$M]*$s,$o=$j[$O+1]*$C,$l=$j[$V+1]*$C,$k=$j[$M+1]*$C,$z=$S[$O],$H=$S[$V],$A=$S[$M],$f=$S[$O+1],$y=$S[$V+1],$P=$S[$M+1];if($w){var $g=($z+$H+$A)/3,$E=($f+$y+$P)/3,$$=$z-$g,$d=$f-$E,$n=Math.sqrt($$*$$+$d*$d);$z=$g+$$/$n*($n+1),$f=$E+$d/$n*($n+1),$d=$y-$E,$H=$g+($$=$H-$g)/($n=Math.sqrt($$*$$+$d*$d))*($n+1),$y=$E+$d/$n*($n+1),$d=$P-$E,$A=$g+($$=$A-$g)/($n=Math.sqrt($$*$$+$d*$d))*($n+1),$P=$E+$d/$n*($n+1)}this.save(),$R&&this.transform($R.a,$R.b,$R.c,$R.d,$R.tx,$R.ty),this.beginPath(),this.moveTo($z,$f),this.lineTo($H,$y),this.lineTo($A,$P),this.closePath(),this.clip();var $J=1/($i*$l+$o*$Z+$v*$k-$l*$Z-$o*$v-$i*$k),$F=$z*$l+$o*$A+$H*$k-$l*$A-$o*$H-$z*$k,$x=$i*$H+$z*$Z+$v*$A-$H*$Z-$z*$v-$i*$A,$h=$i*$l*$A+$o*$H*$Z+$z*$v*$k-$z*$l*$Z-$o*$v*$A-$i*$H*$k,$N=$f*$l+$o*$P+$y*$k-$l*$P-$o*$y-$f*$k,$B=$i*$y+$f*$Z+$v*$P-$y*$Z-$f*$v-$i*$P,$t=$i*$l*$P+$o*$y*$Z+$f*$v*$k-$f*$l*$Z-$o*$v*$P-$i*$y*$k;this.transform($F*$J,$N*$J,$x*$J,$B*$J,$h*$J,$t*$J),this.drawImage($u,$_.uv[0]*$s,$_.uv[1]*$C,$c,$q,$_.uv[0]*$s,$_.uv[1]*$C,$c,$q),this.restore()},$_.flush=function(){return 0},$_.fillWords=function($_,$S,$j,$O,$V,$M){$O&&(this.font=$O),$V&&(this.fillStyle=$V);this.textBaseline="top",this.textAlign="left";for(var $R=0,$w=$_.length;$R<$w;$R++){var $a=$_[$R];if(this.__fillText($a.char,$a.x+$S,$a.y+$j),1===$M){var $u=$a.height,$c=.5*$a.style.letterSpacing;$c||($c=0),this.beginPath(),this.strokeStyle=$V,this.lineWidth=1,this.moveTo($S+$a.x-$c+.5,$j+$a.y+$u+.5),this.lineTo($S+$a.x+$a.width+$c+.5,$j+$a.y+$u+.5),this.stroke()}}},$_.fillBorderWords=function($_,$S,$j,$O,$V,$M,$R){$O&&(this.font=$O),$V&&(this.fillStyle=$V),this.textBaseline="top",this.lineWidth=$R,this.textAlign="left",this.strokeStyle=$M;for(var $w=0,$a=$_.length;$w<$a;$w++){var $u=$_[$w];this.__strokeText($u.char,$u.x+$S,$u.y+$j),this.__fillText($u.char,$u.x+$S,$u.y+$j)}},$_.destroy=function(){this.canvas.width=this.canvas.height=0},$_.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$_.drawCurves=function($_,$S,$j){this.beginPath(),this.strokeStyle=$j[3],this.lineWidth=$j[4];var $O=$j[2];$_+=$j[0],$S+=$j[1],this.moveTo($_+$O[0],$S+$O[1]);for(var $V=2,$M=$O.length;$V<$M;)this.quadraticCurveTo($_+$O[$V++],$S+$O[$V++],$_+$O[$V++],$S+$O[$V++]);this.stroke()},$w.__init__=function($S){var $j=laya.resource.Context.prototype;if(!($S=$S||CanvasRenderingContext2D.prototype).inited){$S.inited=!0,$S.__fillText=$S.fillText,$S.__fillRect=$S.fillRect,$S.__strokeText=$S.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($_){$S[$_]=$j[$_]})}},$w.replaceCanvasGetSet=function($_,$S){var $j=Object.getOwnPropertyDescriptor($_,$S);if(!$j||!$j.configurable)return!1;var $O,$V={};for($O in $j)"set"!=$O&&($V[$O]=$j[$O]);var $M=$j.set;return $V.set=function($_){$M.call(this,$_);var $S=this.getContext("2d");$S&&"__reset"in $S&&$S.__reset()},Object.defineProperty($_,$S,$V),!0},$w.replaceGetSet=function($_,$S){var $j=Object.getOwnPropertyDescriptor($_,$S);if(!$j||!$j.configurable)return!1;var $O,$V={};for($O in $j)"set"!=$O&&($V[$O]=$j[$O]);var $M=$j.set,$R="___"+$S+"__";return $w.newKeys.push($R),$V.set=function($_){$_!=this[$R]&&(this[$R]=$_,$M.call(this,$_))},Object.defineProperty($_,$S,$V),!0},$w._default=new $w,$w.newKeys=[],$a($w,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$w}(),$t=function(){function $M($_){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$M._uniqueIDCounter,this._name=$_||"Content Manager",$M._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$M._resourceManagers.push(this),this._resources=[],this._records={}}$v($M,"laya.resource.ResourceManager");var $_=$M.prototype;return $f.imps($_,{"laya.resource.IDispose":!0}),$_.getResourceByIndex=function($_){return this._resources[$_]},$_.getResourcesLength=function(){return this._resources.length},$_.addResource=function($_){return $_.resourceManager&&$_.resourceManager.removeResource($_),-1===this._resources.indexOf($_)&&(($_._resourceManager=this)._resources.push($_),this.addRecord($_.uri,$_.__className,$_.memorySize),this.addSize($_.memorySize),!0)},$_.removeResource=function($_){var $S=this._resources.indexOf($_);return-1!==$S&&(this._resources.splice($S,1),$_._resourceManager=null,this._memorySize-=$_.memorySize,this.addRecord($_.uri,$_.__className,-$_.memorySize),!0)},$_.unload=function(){for(var $_=this._resources.slice(0,this._resources.length),$S=0;$S<$_.length;$S++){$_[$S].destroy()}$_.length=0},$_.dispose=function(){if(this===$M._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$M._resourceManagers.splice($M._resourceManagers.indexOf(this),1),$M._isResourceManagersSorted=!1;for(var $_=this._resources.slice(0,this._resources.length),$S=0;$S<$_.length;$S++){var $j=$_[$S];$j.resourceManager.removeResource($j),$j.destroy()}$_.length=0},$_.addSize=function($_){$_&&(this.autoRelease&&0<$_&&this._memorySize+$_>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$_)},$_.addRecord=function($_,$S,$j){DEBUG&&$j&&!$_&&console.error($_,$S,$j)},$_.garbageCollection=function($_){var $S=this._resources;($S=$S.slice()).sort(function($_,$S){if(!$_||!$S)throw new Error("a或b不能为空！");return $_.released&&$S.released?0:$_.released?1:$S.released?-1:$_._lastUseFrameCount-$S._lastUseFrameCount});for(var $j=$W.loopCount,$O=0,$V=$S.length;$O<$V;$O++){var $M=$S[$O];if(!(1<$j-$M._lastUseFrameCount))return void(this._memorySize>=$_&&(this._isOverflow=!0));if($M.releaseResource(),this._memorySize<$_)return void(this._isOverflow=!1)}},$c(0,$_,"id",function(){return this._id}),$c(0,$_,"name",function(){return this._name},function($_){!$_&&""===$_||this._name===$_||(this._name=$_,$M._isResourceManagersSorted=!1)}),$c(0,$_,"memorySize",function(){return this._memorySize}),$c(0,$_,"records",function(){return this._records}),$c(1,$M,"systemResourceManager",function(){return $M._systemResourceManager}),$M.__init__=function(){$M.currentResourceManager=$M.systemResourceManager},$M.getLoadedResourceManagerByIndex=function($_){return $M._resourceManagers[$_]},$M.getLoadedResourceManagersCount=function(){return $M._resourceManagers.length},$M.recreateContentManagers=function($_){void 0===$_&&($_=!1);for(var $S=$M.currentResourceManager,$j=0;$j<$M._resourceManagers.length;$j++){$M.currentResourceManager=$M._resourceManagers[$j];for(var $O=0;$O<$M.currentResourceManager._resources.length;$O++)$M.currentResourceManager._resources[$O].releaseResource($_),$M.currentResourceManager._resources[$O].activeResource($_)}$M.currentResourceManager=$S},$M.releaseContentManagers=function($_){void 0===$_&&($_=!1);for(var $S=$M.currentResourceManager,$j=0;$j<$M._resourceManagers.length;$j++){$M.currentResourceManager=$M._resourceManagers[$j];for(var $O=0;$O<$M.currentResourceManager._resources.length;$O++){var $V=$M.currentResourceManager._resources[$O];!$V.released&&$V.releaseResource($_)}}$M.currentResourceManager=$S},$M._uniqueIDCounter=0,$M._isResourceManagersSorted=!1,$M._resourceManagers=[],$a($M,["_systemResourceManager",function(){return this._systemResourceManager=new $M("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$M._systemResourceManager}]),$M}(),$m=(function(){function $_(){}$v($_,"laya.system.System"),$_.changeDefinition=function($_,$S){$f[$_]=$S;var $j=$_+"=classObj";$f._runScript($j)},$_.__init__=function(){$x.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $j(){}return $v($j,"laya.utils.Browser"),$c(1,$j,"pixelRatio",function(){return $j.__init__(),-1<$j.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$d.getPixelRatio()}),$c(1,$j,"height",function(){return $j.__init__(),($f.stage&&$f.stage.canvasRotation?$j.clientWidth:$j.clientHeight)*$j.pixelRatio}),$c(1,$j,"clientWidth",function(){return $j.__init__(),$j.window.innerWidth||$j.document.body.clientWidth}),$c(1,$j,"window",function(){return $j.__init__(),$j._window}),$c(1,$j,"clientHeight",function(){return $j.__init__(),$j.window.innerHeight||$j.document.body.clientHeight||$j.document.documentElement.clientHeight}),$c(1,$j,"width",function(){return $j.__init__(),($f.stage&&$f.stage.canvasRotation?$j.clientHeight:$j.clientWidth)*$j.pixelRatio}),$c(1,$j,"container",function(){return $j.__init__(),$j._container||(($j._container=$j.createElement("div")).id="layaContainer",$j.document.body.appendChild($j._container)),$j._container},function($_){$j._container=$_}),$c(1,$j,"document",function(){return $j.__init__(),$j._document}),$j.__init__=function(){if(!$j._window){$j._window=$d.getWindow(),$j._document=$j.window.document,$j._window.addEventListener("message",function($_){laya.utils.Browser._onMessage($_)},!1),$j.document.__createElement=$j.document.createElement,$R.requestAnimationFrame=$R.requestAnimationFrame||$R.webkitRequestAnimationFrame||$R.mozRequestAnimationFrame||$R.oRequestAnimationFrame||$R.msRequestAnimationFrame||function($_){return $R.setTimeout($_,1e3/60)};var $_=$R.document.body.style;$_["-webkit-user-select"]="none",$_["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$j.userAgent=$j.window.navigator.userAgent,$j.onIOS=!!($j.u=$j.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$j.onMobile=-1<$j.u.indexOf("Mobile"),$j.onIPhone=-1<$j.u.indexOf("iPhone"),$j.onMac=-1<$j.u.indexOf("Mac OS X"),$j.onIPad=-1<$j.u.indexOf("iPad"),$j.onAndroid=-1<$j.u.indexOf("Android")||-1<$j.u.indexOf("Adr"),$j.onWP=-1<$j.u.indexOf("Windows Phone"),$j.onQQBrowser=-1<$j.u.indexOf("QQBrowser"),$j.onMQQBrowser=-1<$j.u.indexOf("MQQBrowser")||-1<$j.u.indexOf("Mobile")&&-1<$j.u.indexOf("QQ"),$j.onIE=!!$j.window.ActiveXObject||"ActiveXObject"in $j.window,$j.onWeiXin=-1<$j.u.indexOf("MicroMessenger"),$j.onPC=!$j.onMobile,$j.onSafari=-1<$j.u.indexOf("Safari"),$j.onFirefox=-1<$j.u.indexOf("Firefox"),$j.onEdge=-1<$j.u.indexOf("Edge"),$j.onMiniGame=-1<$j.u.indexOf("MiniGame"),$j.onLimixiu=-1<$j.u.indexOf("limixiu"),$j.httpProtocol="http:"==$j.window.location.protocol,$j.onMiniGame&&null==$j.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$j.webAudioEnabled=!!($j.window.AudioContext||$j.window.webkitAudioContext||$j.window.mozAudioContext),$j.soundType=$j.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$V_=$j.webAudioEnabled?$M_:$j_,$j.webAudioEnabled&&$M_.initWebAudio(),$j_._initMusicAudio(),$j.enableTouch="ontouchstart"in $R||$R.DocumentTouch&&$S instanceof DocumentTouch,$R.focus(),$$._soundClass=$V_,$$._musicClass=$j_,$x._mainCanvas=$x._mainCanvas||$k_.create("2D"),$j.canvas||($j.canvas=$k_.create("2D"),$j.context=$j.canvas.getContext("2d"))}},$j._onMessage=function($_){if($_.data&&"size"==$_.data.name){if($j.window.innerWidth=$_.data.width,$j.window.innerHeight=$_.data.height,$j.window.__innerHeight=$_.data.clientHeight,!$j.document.createEvent)return void console.warn("no document.createEvent");var $S=$j.document.createEvent("HTMLEvents");return $S.initEvent("resize",!1,!1),void $j.window.dispatchEvent($S)}},$j.createElement=function($_){return $j.__init__(),$j.document.__createElement($_)},$j.getElementById=function($_){return $j.__init__(),$j.document.getElementById($_)},$j.removeElement=function($_){$_&&$_.parentNode&&$_.parentNode.removeChild($_)},$j.now=function(){return $d.now()},$j._window=null,$j._document=null,$j._container=null,$j.userAgent=null,$j.u=null,$j.onIOS=!1,$j.onMac=!1,$j.onMobile=!1,$j.onIPhone=!1,$j.onIPad=!1,$j.onAndroid=!1,$j.onWP=!1,$j.onQQBrowser=!1,$j.onMQQBrowser=!1,$j.onSafari=!1,$j.onFirefox=!1,$j.onEdge=!1,$j.onIE=!1,$j.onWeiXin=!1,$j.onMiniGame=!1,$j.onLimixiu=!1,$j.onPC=!1,$j.httpProtocol=!1,$j.webAudioEnabled=!1,$j.soundType=null,$j.enableTouch=!1,$j.canvas=null,$j.context=null,$j.__init$=function(){},$j}()),$e=function(){function $S($_){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$_?(this._u8d_=new Uint8Array($_),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$v($S,"laya.utils.Byte");var $_=$S.prototype;return $_.___resizeBuffer=function($S){try{var $_=new Uint8Array($S);null!=this._u8d_&&(this._u8d_.length<=$S?$_.set(this._u8d_):$_.set(this._u8d_.subarray(0,$S))),this._u8d_=$_,this._d_=new DataView($_.buffer)}catch($_){throw"___resizeBuffer err:"+$S}},$_.getString=function(){return this.rUTF(this.getUint16())},$_.getFloat32Array=function($_,$S){var $j=$_+$S;$j=$j>this._length?this._length:$j;var $O=new Float32Array(this._d_.buffer.slice($_,$j));return this._pos_=$j,$O},$_.getUint8Array=function($_,$S){var $j=$_+$S;$j=$j>this._length?this._length:$j;var $O=new Uint8Array(this._d_.buffer.slice($_,$j));return this._pos_=$j,$O},$_.getInt16Array=function($_,$S){var $j=$_+$S;$j=$j>this._length?this._length:$j;var $O=new Int16Array(this._d_.buffer.slice($_,$j));return this._pos_=$j,$O},$_.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $_=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$_},$_.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $_=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$_},$_.writeFloat32=function($_){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$_,this._xd_),this._pos_+=4},$_.writeFloat64=function($_){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$_,this._xd_),this._pos_+=8},$_.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $_=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$_},$_.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $_=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$_},$_.writeInt32=function($_){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$_,this._xd_),this._pos_+=4},$_.writeUint32=function($_){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$_,this._xd_),this._pos_+=4},$_.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $_=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$_},$_.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $_=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$_},$_.writeUint16=function($_){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$_,this._xd_),this._pos_+=2},$_.writeInt16=function($_){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$_,this._xd_),this._pos_+=2},$_.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$_.writeUint8=function($_){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$_),this._pos_++},$_._getUInt8=function($_){return this._d_.getUint8($_)},$_._getUint16=function($_){return this._d_.getUint16($_,this._xd_)},$_._getMatrix=function(){return new $n(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$_.rUTF=function($_){for(var $S=[],$j=this._pos_+$_,$O=0,$V=0,$M=0,$R=String.fromCharCode,$w=this._u8d_;this._pos_<$j;)($O=$w[this._pos_++])<128?0!=$O&&$S.push($R($O)):$O<224?$S.push($R((63&$O)<<6|127&$w[this._pos_++])):$O<240?($V=$w[this._pos_++],$S.push($R((31&$O)<<12|(127&$V)<<6|127&$w[this._pos_++]))):($V=$w[this._pos_++],$M=$w[this._pos_++],$S.push($R((15&$O)<<18|(127&$V)<<12|$M<<6&127|127&$w[this._pos_++]))),0;return $S.join("")},$_.getCustomString=function($_){for(var $S=[],$j=0,$O=0,$V=0,$M=String.fromCharCode,$R=this._u8d_;0<$_;)if(($O=$R[this._pos_])<128)$S.push($M($O)),this._pos_++,$_--;else for($j=$O-128,this._pos_++,$_-=$j;0<$j;)$O=$R[this._pos_++],$V=$R[this._pos_++],$S.push($M($V<<8|$O)),$j--;return $S.join("")},$_.clear=function(){this._pos_=0,this.length=0},$_.__getBuffer=function(){return this._d_.buffer},$_.writeUTFBytes=function($_){for(var $S=0,$j=($_+="").length;$S<$j;$S++){var $O=$_.charCodeAt($S);$O<=127?this.writeByte($O):$O<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$O>>6,128|63&$O],this._pos_),this._pos_+=2):$O<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$O>>12,128|$O>>6&63,128|63&$O],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$O>>18,128|$O>>12&63,128|$O>>6&63,128|63&$O],this._pos_),this._pos_+=4)}},$_.writeUTFString=function($_){var $S=this.pos;this.writeUint16(1),this.writeUTFBytes($_);var $j=this.pos-$S-2;if(65536<=$j)throw"writeUTFString byte len more than 65536";this._d_.setUint16($S,$j,this._xd_)},$_.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$_.getUTFString=function(){return this.readUTFString()},$_.readUTFBytes=function($_){if(void 0===$_&&($_=-1),0==$_)return"";var $S=this.bytesAvailable;if($S<$_)throw"readUTFBytes error - Out of bounds";return $_=0<$_?$_:$S,this.rUTF($_)},$_.getUTFBytes=function($_){return void 0===$_&&($_=-1),this.readUTFBytes($_)},$_.writeByte=function($_){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$_),this._pos_+=1},$_.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$_.getByte=function(){return this.readByte()},$_.ensureWrite=function($_){this._length<$_&&(this._length=$_),this._allocated_<$_&&(this.length=$_)},$_.writeArrayBuffer=function($_,$S,$j){if(void 0===$S&&($S=0),void 0===$j&&($j=0),$S<0||$j<0)throw"writeArrayBuffer error - Out of bounds";0==$j&&($j=$_.byteLength-$S),this.ensureWrite(this._pos_+$j);var $O=new Uint8Array($_);this._u8d_.set($O.subarray($S,$S+$j),this._pos_),this._pos_+=$j},$c(0,$_,"buffer",function(){var $_=this._d_.buffer;return $_.byteLength==this.length?$_:$_.slice(0,this.length)}),$c(0,$_,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($_){this._xd_="littleEndian"==$_}),$c(0,$_,"length",function(){return this._length},function($_){this._allocated_<$_?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($_,2*this._allocated_))):this._allocated_>$_&&this.___resizeBuffer(this._allocated_=$_),this._length=$_}),$c(0,$_,"pos",function(){return this._pos_},function($_){this._pos_=$_}),$c(0,$_,"bytesAvailable",function(){return this._length-this._pos_}),$S.getSystemEndian=function(){if(!$S._sysEndian){var $_=new ArrayBuffer(2);new DataView($_).setInt16(0,256,!0),$S._sysEndian=256===new Int16Array($_)[0]?"littleEndian":"bigEndian"}return $S._sysEndian},$S.BIG_ENDIAN="bigEndian",$S.LITTLE_ENDIAN="littleEndian",$S._sysEndian=null,$S}(),$G=function(){function $V(){}return $v($V,"laya.utils.CacheManager"),$V.regCacheByFunction=function($_,$S){var $j;$V.unRegCacheByFunction($_,$S),$j={tryDispose:$_,getCacheList:$S},$V._cacheList.push($j)},$V.unRegCacheByFunction=function($_,$S){var $j,$O=0;for($j=$V._cacheList.length,$O=0;$O<$j;$O++)if($V._cacheList[$O].tryDispose==$_&&$V._cacheList[$O].getCacheList==$S)return void $V._cacheList.splice($O,1)},$V.forceDispose=function(){var $_=0,$S=$V._cacheList.length;for($_=0;$_<$S;$_++)$V._cacheList[$_].tryDispose(!0)},$V.beginCheck=function($_){void 0===$_&&($_=15e3),$f.timer.loop($_,null,$V._checkLoop)},$V.stopCheck=function(){$f.timer.clear(null,$V._checkLoop)},$V._checkLoop=function(){var $_=$V._cacheList;if(!($_.length<1)){var $S,$j=$m.now(),$O=0;for($S=$O=$_.length;0<$O&&($_[$V._index=++$V._index%$S].tryDispose(!1),!($m.now()-$j>$V.loopTimeLimit));)$O--}},$V.loopTimeLimit=2,$V._cacheList=[],$V._index=0,$V}(),$D=function(){function $C(){}return $v($C,"laya.utils.ClassUtils"),$C.regClass=function($_,$S){$C._classMap[$_]=$S},$C.getRegClass=function($_){return $C._classMap[$_]},$C.getInstance=function($_){var $S=$C.getClass($_);return $S?new $S:(console.warn("[error] Undefined class:",$_),null)},$C.createByJson=function($_,$S,$j,$O,$V){"string"==typeof $_&&($_=JSON.parse($_));var $M=$_.props;if(!$S&&!($S=$V?$V.runWith($_):$C.getInstance($M.runtime||$_.type)))return null;var $R=$_.child;if($R)for(var $w=0,$a=$R.length;$w<$a;$w++){var $u=$R[$w];if("render"!==$u.props.name&&"render"!==$u.props.renderType||!$S._$set_itemRender)if("Graphic"==$u.type)$C.addGraphicsToSprite($u,$S);else if($C.isDrawType($u.type))$C.addGraphicToSprite($u,$S,!0);else{var $c=$C.createByJson($u,null,$j,$O,$V);"Script"==$u.type?$c.hasOwnProperty("owner")?$c.owner=$S:$c.hasOwnProperty("target")&&($c.target=$S):"mask"==$u.props.renderType?$S.mask=$c:$S.addChild($c)}else $S.itemRender=$u}if($M)for(var $q in $M){var $s=$M[$q];"var"===$q&&$j?$j[$s]=$S:$s instanceof Array&&"function"==typeof $S[$q]?$S[$q].apply($S,$s):$S[$q]=$s}return $O&&$_.customProps&&$O.runWith([$S,$_]),$S.created&&$S.created(),$S},$C.addGraphicsToSprite=function($_,$S){var $j;if(($j=$_.child)&&!($j.length<1)){var $O;$O=$C._getGraphicsFromSprite($_,$S);var $V=0,$M=0;$_.props&&($V=$C._getObjVar($_.props,"x",0),$M=$C._getObjVar($_.props,"y",0)),0!=$V&&0!=$M&&$O.translate($V,$M);var $R,$w=0;for($R=$j.length,$w=0;$w<$R;$w++)$C._addGraphicToGraphics($j[$w],$O);0!=$V&&0!=$M&&$O.translate(-$V,-$M)}},$C.addGraphicToSprite=function($_,$S,$j){var $O;void 0===$j&&($j=!1),$O=$j?$C._getGraphicsFromSprite($_,$S):$S.graphics,$C._addGraphicToGraphics($_,$O)},$C._getGraphicsFromSprite=function($_,$S){var $j,$O;if(!$_||!$_.props)return $S.graphics;switch($O=$_.props.renderType){case"hit":case"unHit":var $V;$S.hitArea||($S.hitArea=new $Y),($V=$S.hitArea)[$O]||($V[$O]=new $s),$j=$V[$O]}return $j||($j=$S.graphics),$j},$C._getTransformData=function($_){var $S;($_.hasOwnProperty("pivotX")||$_.hasOwnProperty("pivotY"))&&($S=$S||new $n).translate(-$C._getObjVar($_,"pivotX",0),-$C._getObjVar($_,"pivotY",0));var $j=$C._getObjVar($_,"scaleX",1),$O=$C._getObjVar($_,"scaleY",1),$V=$C._getObjVar($_,"rotation",0);$C._getObjVar($_,"skewX",0),$C._getObjVar($_,"skewY",0);return 1==$j&&1==$O&&0==$V||(($S=$S||new $n).scale($j,$O),$S.rotate(.0174532922222222*$V)),$S},$C._addGraphicToGraphics=function($_,$S){var $j,$O;if(($j=$_.props)&&($O=$C.DrawTypeDic[$_.type])){var $V,$M;$V=$S;var $R=$C._getParams($j,$O[1],$O[2],$O[3]);(($M=$C._tM)||1!=$C._alpha)&&($V.save(),$M&&$V.transform($M),1!=$C._alpha&&$V.alpha($C._alpha)),$V[$O[0]].apply($V,$R),($M||1!=$C._alpha)&&$V.restore()}},$C._adptLineData=function($_){return $_[2]=parseFloat($_[0])+parseFloat($_[2]),$_[3]=parseFloat($_[1])+parseFloat($_[3]),$_},$C._adptTextureData=function($_){return $_[0]=$w_.getRes($_[0]),$_},$C._adptLinesData=function($_){return $_[2]=$C._getPointListByStr($_[2]),$_},$C.isDrawType=function($_){return"Image"!=$_&&$C.DrawTypeDic.hasOwnProperty($_)},$C._getParams=function($_,$S,$j,$O){var $V;void 0===$j&&($j=0),($V=$C._temParam).length=$S.length;var $M,$R,$w=0;for($M=$S.length,$w=0;$w<$M;$w++)$V[$w]=$C._getObjVar($_,$S[$w][0],$S[$w][1]);return $C._alpha=$C._getObjVar($_,"alpha",1),$R=$C._getTransformData($_),$C._tM=$R?($j||($j=0),$R.translate($V[$j],$V[$j+1]),$V[$j]=$V[$j+1]=0,$R):null,$O&&$C[$O]&&($V=$C[$O]($V)),$V},$C._getPointListByStr=function($_){var $S,$j,$O=0;for($j=($S=$_.split(",")).length,$O=0;$O<$j;$O++)$S[$O]=parseFloat($S[$O]);return $S},$C._getObjVar=function($_,$S,$j){return $_.hasOwnProperty($S)?$_[$S]:$j},$C._temParam=[],$C._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$C.getClass=function($_){var $S=$C._classMap[$_]||$_;return"string"==typeof $S?$f.__classmap[$S]:$S},$C._tM=null,$C._alpha=NaN,$a($C,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$C}(),$L=function(){function $M($_){if(this._color=[],"string"==typeof $_){null===(this.strColor=$_)&&($_="#000000"),"#"==$_.charAt(0)&&($_=$_.substr(1));var $S=$_.length;if(3==$S||4==$S){for(var $j="",$O=0;$O<$S;$O++)$j+=$_[$O]+$_[$O];$_=$j}var $V=this.numColor=parseInt($_,16);if(8==$_.length)return void(this._color=[parseInt($_.substr(0,2),16)/255,((16711680&$V)>>16)/255,((65280&$V)>>8)/255,(255&$V)/255])}else $V=this.numColor=$_,this.strColor=$K.toHexColor($V);this._color=[((16711680&$V)>>16)/255,((65280&$V)>>8)/255,(255&$V)/255,1],this._color.__id=++$M._COLODID}return $v($M,"laya.utils.Color"),$M._initDefault=function(){for(var $_ in $M._DEFAULT={},$M._COLOR_MAP)$M._SAVE[$_]=$M._DEFAULT[$_]=new $M($M._COLOR_MAP[$_]);return $M._DEFAULT},$M._initSaveMap=function(){for(var $_ in $M._SAVE_SIZE=0,$M._SAVE={},$M._DEFAULT)$M._SAVE[$_]=$M._DEFAULT[$_]},$M.create=function($_){var $S=$M._SAVE[$_+""];return null!=$S?$S:($M._SAVE_SIZE<1e3||$M._initSaveMap(),$M._SAVE[$_+""]=new $M($_))},$M._SAVE={},$M._SAVE_SIZE=0,$M._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$M._DEFAULT=$M._initDefault(),$M._COLODID=1,$M}(),$U=(function(){function $_(){this._values=[],this._keys=[]}$v($_,"laya.utils.Dictionary");var $S=$_.prototype;$S.set=function($_,$S){var $j=this.indexOf($_);0<=$j?this._values[$j]=$S:(this._keys.push($_),this._values.push($S))},$S.indexOf=function($_){var $S=this._keys.indexOf($_);return 0<=$S?$S:($_="string"==typeof $_?Number($_):"number"==typeof $_?$_.toString():$_,this._keys.indexOf($_))},$S.get=function($_){var $S=this.indexOf($_);return $S<0?null:this._values[$S]},$S.remove=function($_){var $S=this.indexOf($_);return 0<=$S&&(this._keys.splice($S,1),this._values.splice($S,1),!0)},$S.clear=function(){this._values.length=0,this._keys.length=0},$c(0,$S,"values",function(){return this._values}),$c(0,$S,"keys",function(){return this._keys})}(),function(){function $_(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$v($_,"laya.utils.Dragging");var $S=$_.prototype;return $S.start=function($_,$S,$j,$O,$V,$M,$R,$w){void 0===$w&&($w=.92),this.clearTimer(),this.target=$_,this.area=$S,this.hasInertia=$j,this.elasticDistance=$S?$O:0,this.elasticBackTime=$V,this.data=$M,this._disableMouseEvent=$R,this.ratio=$w,1!=$_.globalScaleX||1!=$_.globalScaleY?this._parent=$_.parent:this._parent=$f.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$f.stage.on("mouseup",this,this.onStageMouseUp),$f.stage.on("mouseout",this,this.onStageMouseUp),$f.timer.frameLoop(1,this,this.loop)},$S.clearTimer=function(){$f.timer.clear(this,this.loop),$f.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$S.stop=function(){this._dragging&&($i.instance.disableMouseEvent=!1,$f.stage.off("mouseup",this,this.onStageMouseUp),$f.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$S.loop=function(){var $_=this._parent.getMousePoint(),$S=$_.x,$j=$_.y,$O=$S-this._lastX,$V=$j-this._lastY;if(this._clickOnly){if(!(1<Math.abs($O*$f.stage._canvasTransform.getScaleX())||1<Math.abs($V*$f.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$i.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($O,$V);0==$O&&0==$V||(this._lastX=$S,this._lastY=$j,this.target.x+=$O*this._elasticRateX,this.target.y+=$V*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$S.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $_=this.area.x-this.target.x;else $_=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$_/this.elasticDistance),this.target.y<this.area.y)var $S=this.area.y-this.target.y;else $S=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$S/this.elasticDistance)}},$S.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$S.onStageMouseUp=function($_){if($i.instance.disableMouseEvent=!1,$f.stage.off("mouseup",this,this.onStageMouseUp),$f.stage.off("mouseout",this,this.onStageMouseUp),$f.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $S=this._offsets.length,$j=Math.min($S,6),$O=this._offsets.length-$j,$V=$S-1;$O<$V;$V--)this._offsetY+=this._offsets[$V--],this._offsetX+=this._offsets[$V];this._offsetX=this._offsetX/$j*2,this._offsetY=this._offsetY/$j*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$f.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$S.checkElastic=function(){var $_=NaN,$S=NaN;if(this.target.x<this.area.x?$_=this.area.x:this.target.x>this.area.x+this.area.width&&($_=this.area.x+this.area.width),this.target.y<this.area.y?$S=this.area.y:this.target.y>this.area.y+this.area.height&&($S=this.area.y+this.area.height),isNaN($_)&&isNaN($S))this.clear();else{var $j={};isNaN($_)||($j.x=$_),isNaN($S)||($j.y=$S),this._tween=$I.to(this.target,$j,this.elasticBackTime,$Q.sineOut,$l.create(this,this.clear),0,!1,!1)}},$S.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($f.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$S.clear=function(){if(this.target){this.clearTimer();var $_=this.target;this.target=null,this._parent=null,$_.event("dragend",this.data)}},$_}()),$Q=function(){function $w(){}return $v($w,"laya.utils.Ease"),$w.linearNone=function($_,$S,$j,$O){return $j*$_/$O+$S},$w.linearIn=function($_,$S,$j,$O){return $j*$_/$O+$S},$w.linearInOut=function($_,$S,$j,$O){return $j*$_/$O+$S},$w.linearOut=function($_,$S,$j,$O){return $j*$_/$O+$S},$w.bounceIn=function($_,$S,$j,$O){return $j-$w.bounceOut($O-$_,0,$j,$O)+$S},$w.bounceInOut=function($_,$S,$j,$O){return $_<.5*$O?.5*$w.bounceIn(2*$_,0,$j,$O)+$S:.5*$w.bounceOut(2*$_-$O,0,$j,$O)+.5*$j+$S},$w.bounceOut=function($_,$S,$j,$O){return($_/=$O)<1/2.75?$j*(7.5625*$_*$_)+$S:$_<2/2.75?$j*(7.5625*($_-=1.5/2.75)*$_+.75)+$S:$_<2.5/2.75?$j*(7.5625*($_-=2.25/2.75)*$_+.9375)+$S:$j*(7.5625*($_-=2.625/2.75)*$_+.984375)+$S},$w.backIn=function($_,$S,$j,$O,$V){return void 0===$V&&($V=1.70158),$j*($_/=$O)*$_*(($V+1)*$_-$V)+$S},$w.backInOut=function($_,$S,$j,$O,$V){return void 0===$V&&($V=1.70158),($_/=.5*$O)<1?.5*$j*($_*$_*((1+($V*=1.525))*$_-$V))+$S:$j/2*(($_-=2)*$_*((1+($V*=1.525))*$_+$V)+2)+$S},$w.backOut=function($_,$S,$j,$O,$V){return void 0===$V&&($V=1.70158),$j*(($_=$_/$O-1)*$_*(($V+1)*$_+$V)+1)+$S},$w.elasticIn=function($_,$S,$j,$O,$V,$M){var $R;return void 0===$V&&($V=0),void 0===$M&&($M=0),0==$_?$S:1==($_/=$O)?$S+$j:($M||($M=.3*$O),$R=!$V||0<$j&&$V<$j||$j<0&&$V<-$j?($V=$j,$M/4):$M/$w.PI2*Math.asin($j/$V),-$V*Math.pow(2,10*($_-=1))*Math.sin(($_*$O-$R)*$w.PI2/$M)+$S)},$w.elasticInOut=function($_,$S,$j,$O,$V,$M){var $R;return void 0===$V&&($V=0),void 0===$M&&($M=0),0==$_?$S:2==($_/=.5*$O)?$S+$j:($M||($M=$O*(.3*1.5)),$R=!$V||0<$j&&$V<$j||$j<0&&$V<-$j?($V=$j,$M/4):$M/$w.PI2*Math.asin($j/$V),$_<1?$V*Math.pow(2,10*($_-=1))*Math.sin(($_*$O-$R)*$w.PI2/$M)*-.5+$S:$V*Math.pow(2,-10*($_-=1))*Math.sin(($_*$O-$R)*$w.PI2/$M)*.5+$j+$S)},$w.elasticOut=function($_,$S,$j,$O,$V,$M){var $R;return void 0===$V&&($V=0),void 0===$M&&($M=0),0==$_?$S:1==($_/=$O)?$S+$j:($M||($M=.3*$O),$R=!$V||0<$j&&$V<$j||$j<0&&$V<-$j?($V=$j,$M/4):$M/$w.PI2*Math.asin($j/$V),$V*Math.pow(2,-10*$_)*Math.sin(($_*$O-$R)*$w.PI2/$M)+$j+$S)},$w.strongIn=function($_,$S,$j,$O){return $j*($_/=$O)*$_*$_*$_*$_+$S},$w.strongInOut=function($_,$S,$j,$O){return($_/=.5*$O)<1?.5*$j*$_*$_*$_*$_*$_+$S:.5*$j*(($_-=2)*$_*$_*$_*$_+2)+$S},$w.strongOut=function($_,$S,$j,$O){return $j*(($_=$_/$O-1)*$_*$_*$_*$_+1)+$S},$w.sineInOut=function($_,$S,$j,$O){return.5*-$j*(Math.cos(Math.PI*$_/$O)-1)+$S},$w.sineIn=function($_,$S,$j,$O){return-$j*Math.cos($_/$O*$w.HALF_PI)+$j+$S},$w.sineOut=function($_,$S,$j,$O){return $j*Math.sin($_/$O*$w.HALF_PI)+$S},$w.quintIn=function($_,$S,$j,$O){return $j*($_/=$O)*$_*$_*$_*$_+$S},$w.quintInOut=function($_,$S,$j,$O){return($_/=.5*$O)<1?.5*$j*$_*$_*$_*$_*$_+$S:.5*$j*(($_-=2)*$_*$_*$_*$_+2)+$S},$w.quintOut=function($_,$S,$j,$O){return $j*(($_=$_/$O-1)*$_*$_*$_*$_+1)+$S},$w.quartIn=function($_,$S,$j,$O){return $j*($_/=$O)*$_*$_*$_+$S},$w.quartInOut=function($_,$S,$j,$O){return($_/=.5*$O)<1?.5*$j*$_*$_*$_*$_+$S:.5*-$j*(($_-=2)*$_*$_*$_-2)+$S},$w.quartOut=function($_,$S,$j,$O){return-$j*(($_=$_/$O-1)*$_*$_*$_-1)+$S},$w.cubicIn=function($_,$S,$j,$O){return $j*($_/=$O)*$_*$_+$S},$w.cubicInOut=function($_,$S,$j,$O){return($_/=.5*$O)<1?.5*$j*$_*$_*$_+$S:.5*$j*(($_-=2)*$_*$_+2)+$S},$w.cubicOut=function($_,$S,$j,$O){return $j*(($_=$_/$O-1)*$_*$_+1)+$S},$w.quadIn=function($_,$S,$j,$O){return $j*($_/=$O)*$_+$S},$w.quadInOut=function($_,$S,$j,$O){return($_/=.5*$O)<1?.5*$j*$_*$_+$S:.5*-$j*(--$_*($_-2)-1)+$S},$w.quadOut=function($_,$S,$j,$O){return-$j*($_/=$O)*($_-2)+$S},$w.expoIn=function($_,$S,$j,$O){return 0==$_?$S:$j*Math.pow(2,10*($_/$O-1))+$S-.001*$j},$w.expoInOut=function($_,$S,$j,$O){return 0==$_?$S:$_==$O?$S+$j:($_/=.5*$O)<1?.5*$j*Math.pow(2,10*($_-1))+$S:.5*$j*(2-Math.pow(2,-10*--$_))+$S},$w.expoOut=function($_,$S,$j,$O){return $_==$O?$S+$j:$j*(1-Math.pow(2,-10*$_/$O))+$S},$w.circIn=function($_,$S,$j,$O){return-$j*(Math.sqrt(1-($_/=$O)*$_)-1)+$S},$w.circInOut=function($_,$S,$j,$O){return($_/=.5*$O)<1?.5*-$j*(Math.sqrt(1-$_*$_)-1)+$S:.5*$j*(Math.sqrt(1-($_-=2)*$_)+1)+$S},$w.circOut=function($_,$S,$j,$O){return $j*Math.sqrt(1-($_=$_/$O-1)*$_)+$S},$w.HALF_PI=.5*Math.PI,$w.PI2=2*Math.PI,$w}(),$Y=function(){function $q(){this._hit=null,this._unHit=null}$v($q,"laya.utils.HitArea");var $_=$q.prototype;return $_.isHit=function($_,$S){return!!$q.isHitGraphic($_,$S,this.hit)&&!$q.isHitGraphic($_,$S,this.unHit)},$_.contains=function($_,$S){return this.isHit($_,$S)},$c(0,$_,"hit",function(){return this._hit||(this._hit=new $s),this._hit},function($_){this._hit=$_}),$c(0,$_,"unHit",function(){return this._unHit||(this._unHit=new $s),this._unHit},function($_){this._unHit=$_}),$q.isHitGraphic=function($_,$S,$j){if(!$j)return!1;var $O;if(!($O=$j.cmds)&&$j._one&&(($O=$q._cmds).length=1,$O[0]=$j._one),!$O)return!1;var $V,$M,$R=0;for($V=$O.length,$R=0;$R<$V;$R++)if($M=$O[$R]){var $w=$x._context;switch($M.callee){case $w._translate:case 6:$_-=$M[0],$S-=$M[1]}if($q.isHitCmd($_,$S,$M))return!0}return!1},$q.isHitCmd=function($_,$S,$j){if(!$j)return!1;var $O=$x._context,$V=!1;switch($j.callee){case $O._drawRect:case 13:$q._rec.setTo($j[0],$j[1],$j[2],$j[3]),$V=$q._rec.contains($_,$S);break;case $O._drawCircle:case $O._fillCircle:case 14:$V=($_-=$j[0])*$_+($S-=$j[1])*$S<$j[2]*$j[2];break;case $O._drawPoly:case 18:$_-=$j[0],$S-=$j[1],$V=$q.ptInPolygon($_,$S,$j[2])}return $V},$q.ptInPolygon=function($_,$S,$j){var $O;($O=$q._ptPoint).setTo($_,$S);var $V,$M=0,$R=NaN,$w=NaN,$a=NaN,$u=NaN;$V=$j.length;for(var $c=0;$c<$V;$c+=2){if($R=$j[$c],$w=$j[$c+1],$a=$j[($c+2)%$V],$w!=($u=$j[($c+3)%$V]))if(!($O.y<Math.min($w,$u)))if(!($O.y>=Math.max($w,$u)))($O.y-$w)*($a-$R)/($u-$w)+$R>$O.x&&$M++}return $M%2==1},$q._cmds=[],$a($q,["_rec",function(){return this._rec=new $P},"_ptPoint",function(){return this._ptPoint=new $y}]),$q}(),$T=(function(){function $V($_,$S,$j,$O){this.char=$_,this.charNum=$_.charCodeAt(0),this._x=this._y=0,this.width=$S,this.height=$j,this.style=$O,this.isWord=!$V._isWordRegExp.test($_)}$v($V,"laya.utils.HTMLChar");var $_=$V.prototype;$f.imps($_,{"laya.display.ILayout":!0}),$_.setSprite=function($_){this._sprite=$_},$_.getSprite=function(){return this._sprite},$_._isChar=function(){return!0},$_._getCSSStyle=function(){return this.style},$c(0,$_,"width",function(){return this._w},function($_){this._w=$_}),$c(0,$_,"x",function(){return this._x},function($_){this._sprite&&(this._sprite.x=$_),this._x=$_}),$c(0,$_,"y",function(){return this._y},function($_){this._sprite&&(this._sprite.y=$_),this._y=$_}),$c(0,$_,"height",function(){return this._h},function($_){this._h=$_}),$V._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $S(){}$v($S,"laya.utils.Log"),$S.enable=function(){$S._logdiv||($S._logdiv=$m.window.document.createElement("div"),$m.window.document.body.appendChild($S._logdiv),$S._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$S.toggle=function(){var $_=$S._logdiv.style;"1px"==$_.width?$_.width=$_.height="50%":$_.width=$_.height="1px"},$S.print=function($_){$S._logdiv&&($S.maxCount<=$S._count&&$S.clear(),$S._count++,$S._logdiv.innerText+=$_+"\n",$S._logdiv.scrollTop=$S._logdiv.scrollHeight)},$S.clear=function(){$S._logdiv.innerText="",$S._count=0},$S._logdiv=null,$S._count=0,$S.maxCount=20}(),function(){function $S(){}$v($S,"laya.utils.Mouse"),$c(1,$S,"cursor",function(){return $S._style.cursor},function($_){$S._style.cursor=$_}),$S.hide=function(){"none"!=$S.cursor&&($S._preCursor=$S.cursor,$S.cursor="none")},$S.show=function(){"none"==$S.cursor&&($S.cursor=$S._preCursor?$S._preCursor:"auto")},$S._preCursor=null,$a($S,["_style",function(){return this._style=$m.document.body.style}])}(),function(){function $M(){}return $v($M,"laya.utils.Pool"),$M.getPoolBySign=function($_){return $M._poolDic[$_]||($M._poolDic[$_]=[])},$M.clearBySign=function($_){$M._poolDic[$_]&&($M._poolDic[$_].length=0)},$M.recover=function($_,$S){$S.__InPool||($S.__InPool=!0,$M.getPoolBySign($_).push($S))},$M.getItemByClass=function($_,$S){var $j=$M.getPoolBySign($_),$O=$j.length?$j.pop():new $S;return $O.__InPool=!1,$O},$M.getItemByCreateFun=function($_,$S,$j){var $O=$M.getPoolBySign($_),$V=$O.length?$O.pop():$S.call($j);return $V.__InPool=!1,$V},$M.getItem=function($_){var $S=$M.getPoolBySign($_),$j=$S.length?$S.pop():null;return $j&&($j.__InPool=!1),$j},$M._poolDic={},$M.InPoolSign="__InPool",$M}()),$W=function(){function $a(){}return $v($a,"laya.utils.Stat"),$c(1,$a,"onclick",null,function($_){$a._sp&&$a._sp.on("click",$a._sp,$_),$a._canvas&&($a._canvas.source.onclick=$_,$a._canvas.source.style.pointerEvents="")}),$a.show=function($_,$S,$j){if(void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),!$x.isConchApp||$x.isConchWebGL){if($x.isConchWebGL||$m.onMiniGame||$m.onLimixiu||($a._useCanvas=!0),$a._show=!0,$a._fpsData.length=60,$a._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$a._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$a._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$a._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$x.isWebGL)if($a._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$x.is3DMode){if($a._view[0].title="FPS(3D)",$a._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$a._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$a._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$j){var $O=8;$a._view[$O++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$a._view[$O++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$a._view[$O++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$j){$O=8;$a._view[$O++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$a._view[$O++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$a._view[$O++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$a._view[$O++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$a._view[$O++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$a._view[$O++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$a._view[$O++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $a._view[0].title="FPS(WebGL)",$a._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $a._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$a._useCanvas?$a.createUIPre($_,$S):$a.createUI($_,$S),$a.enable()}else $m.window.conch.showFPS&&$m.window.conch.showFPS($_,$S)},$a.createUIPre=function($_,$S){var $j=$m.pixelRatio;$a._width=170*$j,$a._vx=75*$j,$a._height=$j*(12*$a._view.length+3*$j)+4,$a._fontSize=12*$j;for(var $O=0;$O<$a._view.length;$O++)$a._view[$O].x=4,$a._view[$O].y=$O*$a._fontSize+2*$j;$a._canvas||(($a._canvas=new $k_("2D")).size($a._width,$a._height),($a._ctx=$a._canvas.getContext("2d")).textBaseline="top",$a._ctx.font=$a._fontSize+"px Sans-serif",$a._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$_+"px;top:"+$S+"px;width:"+$a._width/$j+"px;height:"+$a._height/$j+"px;"),$a._first=!0,$a.loop(),$a._first=!1,$m.container.appendChild($a._canvas.source)},$a.createUI=function($_,$S){var $j=$a._sp,$O=$m.pixelRatio;$j||($j=new $q_,($a._leftText=new $Z_).pos(5,5),$a._leftText.color="#ffffff",$j.addChild($a._leftText),($a._txt=new $Z_).pos(80*$O,5),$a._txt.color="#ffffff",$j.addChild($a._txt),$a._sp=$j),$j.pos($_,$S);for(var $V="",$M=0;$M<$a._view.length;$M++){$V+=$a._view[$M].title+"\n"}$a._leftText.text=$V;var $R=170*$O,$w=$O*(12*$a._view.length+3*$O)+4;$a._txt.fontSize=$a._fontSize*$O,$a._leftText.fontSize=$a._fontSize*$O,$j.size($R,$w),$j.graphics.clear(),$j.graphics.setAlpha(.5),$j.graphics.drawRect(0,0,$R,$w,"#999999"),$j.graphics.setAlpha(1),$a.loop()},$a.enable=function(){$f.timer.frameLoop(1,$a,$a.loop)},$a.hide=function(){$a._show=!1,$f.timer.clear($a,$a.loop),$a._canvas&&$m.removeElement($a._canvas.source)},$a.clear=function(){$a.trianglesFaces=$a.drawCall=$a.shaderCall=$a.spriteCount=$a.spriteRenderUseCacheCount=$a.treeNodeCollision=$a.treeSpriteCollision=$a.canvasNormal=$a.canvasBitmap=$a.canvasReCache=0},$a.loop=function(){$a._count++;var $_=$m.now();if(!($_-$a._timer<1e3)){var $S=$a._count;if($a.FPS=Math.round(1e3*$S/($_-$a._timer)),$a._show){$a.trianglesFaces=Math.round($a.trianglesFaces/$S),$a.spriteCount=$a._useCanvas?($a.drawCall=Math.round($a.drawCall/$S)-2,$a.shaderCall=Math.round($a.shaderCall/$S),Math.round($a.spriteCount/$S)-1):($a.drawCall=Math.round($a.drawCall/$S)-2,$a.shaderCall=Math.round($a.shaderCall/$S)-4,Math.round($a.spriteCount/$S)-4),$a.spriteRenderUseCacheCount=Math.round($a.spriteRenderUseCacheCount/$S),$a.canvasNormal=Math.round($a.canvasNormal/$S),$a.canvasBitmap=Math.round($a.canvasBitmap/$S),$a.canvasReCache=Math.ceil($a.canvasReCache/$S),$a.treeNodeCollision=Math.round($a.treeNodeCollision/$S),$a.treeSpriteCollision=Math.round($a.treeSpriteCollision/$S);var $j=0<$a.FPS?Math.floor(1e3/$a.FPS).toString():" ";$a._fpsStr=$a.FPS+($a.renderSlow?" slow":"")+" "+$j,$a._spriteStr=$a.spriteCount+($a.spriteRenderUseCacheCount?"/"+$a.spriteRenderUseCacheCount:""),$a._canvasStr=$a.canvasReCache+"/"+$a.canvasNormal+"/"+$a.canvasBitmap,$a.currentMemorySize=$t.systemResourceManager.memorySize,$a._useCanvas?$a.renderInfoPre():$a.renderInfo(),$a.clear()}$a._count=0,$a._timer=$_}},$a.renderInfoPre=function(){if($a._canvas){var $_=$a._ctx;$_.clearRect($a._first?0:$a._vx,0,$a._width,$a._height);for(var $S=$x.WebGL.mainContext,$j=0;$j<$a._view.length;$j++){var $O=$a._view[$j];$a._first&&($_.fillStyle="white",$_.fillText($O.title,$O.x,$O.y,null,null,null)),$_.fillStyle=$O.color;var $V=-1;if(($O=$a._view[$j]).varying){if($S)switch($O.varying){case 1:$V=$S.getParameter($S[$O.value]);break;case 2:$V=$S.getExtension($O.value)}}else $V=$a[$O.value];"M"==$O.units&&($V=Math.floor($V/1048576*100)/100+" M"),"K"==$O.units&&($V=Math.floor($V/1024*100)/100+" K"),"string"==$O.units&&($V=$V.match(/\d+\.?\d/i)),$_.fillText($V+"",$O.x+$a._vx,$O.y,null,null,null)}}},$a.renderInfo=function(){for(var $_="",$S=$x.WebGL.mainContext,$j=0;$j<$a._view.length;$j++){var $O=$a._view[$j],$V=-1;if($O.varying){if($S)switch($O.varying){case 1:$V=$S.getParameter($S[$O.value]);break;case 2:$V=$S.getExtension($O.value)}}else $V=$a[$O.value];"M"==$O.units&&($V=Math.floor($V/1048576*100)/100+" M"),"K"==$O.units&&($V=Math.floor($V/1024*100)/100+" K"),"string"==$O.units&&($V=$V.match(/\d+\.?\d/i)),$_+=$V+"\n"}$a._txt.text=$_},$a.FPS=0,$a.loopCount=0,$a.shaderCall=0,$a.drawCall=0,$a.trianglesFaces=0,$a.spriteCount=0,$a.spriteRenderUseCacheCount=0,$a.treeNodeCollision=0,$a.treeSpriteCollision=0,$a.canvasNormal=0,$a.canvasBitmap=0,$a.canvasReCache=0,$a.renderSlow=!1,$a.currentMemorySize=0,$a._fpsStr=null,$a._canvasStr=null,$a._spriteStr=null,$a._fpsData=[],$a._timer=0,$a._count=0,$a._view=[],$a._fontSize=12,$a._txt=null,$a._leftText=null,$a._sp=null,$a._show=!1,$a._useCanvas=!1,$a._canvas=null,$a._ctx=null,$a._first=!1,$a._vx=NaN,$a._width=0,$a._height=100,$a}(),$p=(function(){function $_(){this._strsToID={},this._idToStrs=[],this._length=0}$v($_,"laya.utils.StringKey");var $S=$_.prototype;$S.add=function($_){var $S=this._strsToID[$_];return null!=$S?$S:(this._idToStrs[this._length]=$_,this._strsToID[$_]=this._length++)},$S.getID=function($_){var $S=this._strsToID[$_];return null==$S?-1:$S},$S.getName=function($_){var $S=this._idToStrs[$_];return null==$S?void 0:$S}}(),function(){var $u;function $_(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$v($_,"laya.utils.Timer");var $S=$_.prototype;return $S._init=function(){$f.timer&&$f.timer.frameLoop(1,this,this._update)},$S._now=function(){return Date.now()},$S._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $_=this.currFrame=this.currFrame+this.scale,$S=this._now();this._delta=($S-this._lastTimer)*this.scale;var $j=this.currTimer=this.currTimer+this._delta;$f.isDebug&&6e4<Math.abs($S-this._lastTimer)&&console.error("系统时间错误！"+($S-this._lastTimer)),this._lastTimer=$S;var $O=this._handlers;for($R=this._count=0,$w=$O.length;$R<$w;$R++)if(null!==($a=$O[$R]).method){var $V=$a.userFrame?$_:$j;if($V>=$a.exeTime)if($a.repeat)if($a.jumpFrame)for(;$V>=$a.exeTime;)$a.exeTime+=$a.delay,$a.run(!1);else $a.exeTime+=$a.delay,$a.run(!1),$V>$a.exeTime&&($a.exeTime+=Math.ceil(($V-$a.exeTime)/$a.delay)*$a.delay);else $a.run(!0)}else this._count++;(30<this._count||$_%200==0)&&this._clearHandlers();for(var $M=this._laters,$R=0,$w=$M.length-1;$R<=$w;$R++){var $a=$M[$R];this._isIgnoreRecover($a)||(null!==$a.method&&(delete this._map[$a.key],$a.run(!1)),this._recoverHandler($a)),$R===$w&&($w=$M.length-1)}$M.length=0}},$S._clearHandlers=function(){for(var $_=this._handlers,$S=0,$j=$_.length;$S<$j;$S++){var $O=$_[$S];null!==$O.method?this._temp.push($O):this._isIgnoreRecover($O)?this._temp.push($O):this._recoverHandler($O)}this._handlers=this._temp,this._temp=$_,this._temp.length=0},$S._recoverHandler=function($_){this._map[$_.key]==$_&&delete this._map[$_.key],$_.recover()},$S._create=function($_,$S,$j,$O,$V,$M,$R,$w){if(!$j)return $V.apply($O,$M),null;if($R){var $a=this._getHandler($O,$V);if($a)return $a.repeat=$S,$a.userFrame=$_,$a.delay=$j,$a.ignoreRecover=$w,$a.caller=$O,$a.method=$V,$a.args=$M,$a.exeTime=$j+($_?this.currFrame:this.currTimer+this._now()-this._lastTimer),$a}return($a=$u.create()).repeat=$S,$a.userFrame=$_,$a.delay=$j,$a.ignoreRecover=$w,$a.caller=$O,$a.method=$V,$a.args=$M,$a.exeTime=$j+($_?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($a),this._handlers.push($a),$a},$S._indexHandler=function($_){var $S=$_.caller,$j=$_.method,$O=$S?$S.$_GID||($S.$_GID=$K.getGID()):0,$V=$j.$_TID||($j.$_TID=this._mid++);$_.key=$O+"_"+$V,this._map[$_.key]=$_},$S.once=function($_,$S,$j,$O,$V){void 0===$V&&($V=!0),this._create(!1,!1,$_,$S,$j,$O,$V,!1)},$S.loop=function($_,$S,$j,$O,$V,$M,$R){void 0===$V&&($V=!0),void 0===$M&&($M=!1),void 0===$R&&($R=!1);var $w=this._create(!1,!0,$_,$S,$j,$O,$V,$R);$w&&($w.jumpFrame=$M)},$S.frameOnce=function($_,$S,$j,$O,$V){void 0===$V&&($V=!0),this._create(!0,!1,$_,$S,$j,$O,$V,!1)},$S.frameLoop=function($_,$S,$j,$O,$V,$M){void 0===$V&&($V=!0),void 0===$M&&($M=!1),this._create(!0,!0,$_,$S,$j,$O,$V,$M)},$S.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$u._freeCount},$S.clear=function($_,$S){var $j=this._getHandler($_,$S);return!(!$j||this._isIgnoreRecover($j))&&(delete this._map[$j.key],$j.key=null,$j.clear(),!0)},$S.clearAll=function($_){if($_)for(var $S=0,$j=this._handlers.length;$S<$j;$S++){var $O=this._handlers[$S];$O.caller===$_&&(this._isIgnoreRecover($O)||(delete this._map[$O.key],$O.key=null,$O.clear()))}},$S._getHandler=function($_,$S){var $j=$_?$_.$_GID||($_.$_GID=$K.getGID()):0,$O=$S.$_TID||($S.$_TID=this._mid++);return this._map[$j+"_"+$O]},$S._isIgnoreRecover=function($_){if($_.ignoreRecover||$_.caller&&"IgnoreRecover"==$_.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $S="";try{arguments.propertyIsEnumerable.caller}catch($_){$S=$_.stack}$f.recordError("报错：核心定时器销毁忽略  "+$S)}return!0}return!1},$S.hasHandler=function($_,$S){return this._map[$_.$_GID+"_"+$S.$_TID]},$S.callLater=function($_,$S,$j){if(null==this._getHandler($_,$S)){var $O=$u.create();$O.caller=$_,$O.method=$S,$O.args=$j,this._indexHandler($O),this._laters.push($O)}},$S.runCallLater=function($_,$S){var $j=this._getHandler($_,$S);$j&&null!=$j.method&&(this._isIgnoreRecover($j)||(delete this._map[$j.key],$j.run(!0)))},$S.runTimer=function($_,$S){this.runCallLater($_,$S)},$c(0,$S,"delta",function(){return this._delta}),$_.__init$=function(){$u=function(){function $S(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$v($S,"");var $_=$S.prototype;return $_.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$_.recover=function(){this.clear(),this.args=$S._freeHandler,$S._freeHandler=this,$S._freeCount++},$_.run=function($_){var $S=this.caller;if($S&&$S.destroyed)return this.clear();var $j=this.method,$O=this.args;$_&&this.clear(),null!=$j&&($O?$j.apply($S,$O):$j.call($S))},$S._freeHandler=null,$S._freeCount=0,$S.create=function(){var $_=$S._freeHandler;return $_?($S._freeHandler=$_.args,--$S._freeCount,$_.args=null,$_):new $S},$S}()},$_}()),$I=function(){function $q(){this.gid=0}$v($q,"laya.utils.Tween");var $_=$q.prototype;return $_.to=function($_,$S,$j,$O,$V,$M,$R){return void 0===$M&&($M=0),void 0===$R&&($R=!1),this._create($_,$S,$j,$O,$V,$M,$R,!0,!1,!0)},$_.from=function($_,$S,$j,$O,$V,$M,$R){return void 0===$M&&($M=0),void 0===$R&&($R=!1),this._create($_,$S,$j,$O,$V,$M,$R,!1,!1,!0)},$_._create=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){if(!$_)throw new Error("Tween:target is null");this._target=$_,this._duration=$j,this._ease=$O||$S.ease||$q.easeNone,this._complete=$V||$S.complete,this._delay=$M,this._props=[],this._usedTimer=0,this._startTimer=$m.now(),this._usedPool=$a,this._delayParam=null,this.update=$S.update;var $c=$_.$_GID||($_.$_GID=$K.getGID());return $q.tweenMap[$c]?($R&&$q.clearTween($_),$q.tweenMap[$c].push(this)):$q.tweenMap[$c]=[this],$u?$M<=0?this.firstStart($_,$S,$w):(this._delayParam=[$_,$S,$w],$f.scaleTimer.once($M,this,this.firstStart,this._delayParam)):this._initProps($_,$S,$w),this},$_.firstStart=function($_,$S,$j){this._delayParam=null,$_.destroyed?this.clear():(this._initProps($_,$S,$j),this._beginLoop())},$_._initProps=function($_,$S,$j){for(var $O in $S)if("number"==typeof $_[$O]){var $V=$j?$_[$O]:$S[$O],$M=$j?$S[$O]:$_[$O];this._props.push([$O,$V,$M-$V]),$j||($_[$O]=$V)}},$_._beginLoop=function(){$f.scaleTimer.frameLoop(1,this,this._doEase)},$_._doEase=function(){this._updateEase($m.now())},$_._updateEase=function($_){var $S=this._target;if($S){if($S.destroyed)return $q.clearTween($S);var $j=this._usedTimer=$_-this._startTimer-this._delay;if(!($j<0)){if($j>=this._duration)return this.complete();for(var $O=0<$j?this._ease($j,0,1,this._duration):0,$V=this._props,$M=0,$R=$V.length;$M<$R;$M++){var $w=$V[$M];$S[$w[0]]=$w[1]+$O*$w[2]}this.update&&this.update.run()}}},$_.complete=function(){if(this._target){$f.scaleTimer.runTimer(this,this.firstStart);for(var $_=this._target,$S=this._props,$j=this._complete,$O=0,$V=$S.length;$O<$V;$O++){var $M=$S[$O];$_[$M[0]]=$M[1]+$M[2]}this.update&&this.update.run(),this.clear(),$j&&$j.run()}},$_.pause=function(){$f.scaleTimer.clear(this,this._beginLoop),$f.scaleTimer.clear(this,this._doEase),$f.scaleTimer.clear(this,this.firstStart);var $_;($_=$m.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$_)},$_.setStartTime=function($_){this._startTimer=$_},$_.clear=function(){this._target&&(this._remove(),this._clear())},$_._clear=function(){this.pause(),$f.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$T.recover("tween",this))},$_.recover=function(){this._usedPool=!0,this._clear()},$_._remove=function(){var $_=$q.tweenMap[this._target.$_GID];if($_)for(var $S=0,$j=$_.length;$S<$j;$S++)if($_[$S]===this){$_.splice($S,1);break}},$_.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$m.now(),this._delayParam)$f.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $_=this._props,$S=0,$j=$_.length;$S<$j;$S++){var $O=$_[$S];this._target[$O[0]]=$O[1]}$f.scaleTimer.once(this._delay,this,this._beginLoop)}},$_.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$m.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$f.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$c(0,$_,"progress",null,function($_){var $S=$_*this._duration;this._startTimer=$m.now()-this._delay-$S}),$q.to=function($_,$S,$j,$O,$V,$M,$R,$w){return void 0===$M&&($M=0),void 0===$R&&($R=!1),void 0===$w&&($w=!0),$T.getItemByClass("tween",$q)._create($_,$S,$j,$O,$V,$M,$R,!0,$w,!0)},$q.from=function($_,$S,$j,$O,$V,$M,$R,$w){return void 0===$M&&($M=0),void 0===$R&&($R=!1),void 0===$w&&($w=!0),$T.getItemByClass("tween",$q)._create($_,$S,$j,$O,$V,$M,$R,!1,$w,!0)},$q.clearAll=function($_){if($_&&$_.$_GID){var $S=$q.tweenMap[$_.$_GID];if($S){for(var $j=0,$O=$S.length;$j<$O;$j++)$S[$j]._clear();$S.length=0}}},$q.clear=function($_){$_.clear()},$q.clearTween=function($_){$q.clearAll($_)},$q.easeNone=function($_,$S,$j,$O){return $j*$_/$O+$S},$q.tweenMap={},$q}(),$K=function(){function $w(){}return $v($w,"laya.utils.Utils"),$w.toRadian=function($_){return $_*$w._pi2},$w.toAngle=function($_){return $_*$w._pi},$w.toHexColor=function($_){if($_<0||isNaN($_))return null;for(var $S=$_.toString(16);$S.length<6;)$S="0"+$S;return"#"+$S},$w.getGID=function(){return $w._gid++},$w.concatArray=function($_,$S){if(!$S)return $_;if(!$_)return $S;var $j=0,$O=$S.length;for($j=0;$j<$O;$j++)$_.push($S[$j]);return $_},$w.clearArray=function($_){return $_&&($_.length=0),$_},$w.copyArray=function($_,$S){if($_||($_=[]),!$S)return $_;$_.length=$S.length;var $j=0,$O=$S.length;for($j=0;$j<$O;$j++)$_[$j]=$S[$j];return $_},$w.getGlobalRecByPoints=function($_,$S,$j,$O,$V){var $M,$R;return $M=new $y($S,$j),$M=$_.localToGlobal($M),$R=new $y($O,$V),$R=$_.localToGlobal($R),$P._getWrapRec([$M.x,$M.y,$R.x,$R.y])},$w.getGlobalPosAndScale=function($_){return $w.getGlobalRecByPoints($_,0,0,1,1)},$w.bind=function($_,$S){return $_.bind($S)},$w.measureText=function($_,$S){return $d.measureText($_,$S)},$w.contextMeasureText=function($_){var $S=$m.context.measureText($_);return $S||($S={width:16,height:16}),$S},$w.updateOrder=function($_){if(!$_||$_.length<2)return!1;for(var $S,$j=1,$O=0,$V=$_.length,$M=NaN;$j<$V;){for($S=$_[$O=$j],$M=$_[$O]._zOrder;-1<--$O&&$_[$O]._zOrder>$M;)$_[$O+1]=$_[$O];$_[$O+1]=$S,$j++}var $R=$S.parent.conchModel;if($R)if(null!=$R.updateZOrder)$R.updateZOrder();else{for($j=0;$j<$V;$j++)$R.removeChild($_[$j].conchModel);for($j=0;$j<$V;$j++)$R.addChildAt($_[$j].conchModel,$j)}return!0},$w.transPointList=function($_,$S,$j){var $O=0,$V=$_.length;for($O=0;$O<$V;$O+=2)$_[$O]+=$S,$_[$O+1]+=$j},$w.parseInt=function($_,$S){void 0===$S&&($S=0);var $j=$m.window.parseInt($_,$S);return isNaN($j)?0:$j},$w.getFileExtension=function($_){$w._extReg.lastIndex=$_.lastIndexOf(".");var $S=$w._extReg.exec($_);return $S&&1<$S.length?$S[1].toLowerCase():null},$w.getTransformRelativeToWindow=function($_,$S,$j){var $O=$f.stage,$V=laya.utils.Utils.getGlobalPosAndScale($_),$M=$O._canvasTransform.clone(),$R=$M.tx,$w=$M.ty;$M.rotate(-Math.PI/180*$f.stage.canvasDegree),$M.scale($f.stage.clientScaleX,$f.stage.clientScaleY);var $a=$f.stage.canvasDegree%180!=0,$u=NaN,$c=NaN;$a?($u=$j+$V.y,$c=$S+$V.x,$u*=$M.d,$c*=$M.a,90==$f.stage.canvasDegree?($u=$R-$u,$c+=$w):($u+=$R,$c=$w-$c)):($u=$S+$V.x,$c=$j+$V.y,$u*=$M.a,$c*=$M.d,$u+=$R,$c+=$w);var $q=NaN,$s=NaN;return $s=$a?($q=$M.d*$V.height,$M.a*$V.width):($q=$M.a*$V.width,$M.d*$V.height),{x:$u,y:$c,scaleX:$q,scaleY:$s}},$w.fitDOMElementInArea=function($_,$S,$j,$O,$V,$M){$_._fitLayaAirInitialized||($_._fitLayaAirInitialized=!0,$_.style.transformOrigin=$_.style.webKittransformOrigin="left top",$_.style.position="absolute");var $R=$w.getTransformRelativeToWindow($S,$j,$O);$_.style.transform=$_.style.webkitTransform="scale("+$R.scaleX+","+$R.scaleY+") rotate("+$f.stage.canvasDegree+"deg)",$_.style.width=$V+"px",$_.style.height=$M+"px",$_.style.left=$R.x+"px",$_.style.top=$R.y+"px"},$w.isOkTextureList=function($_){if(!$_)return!1;var $S,$j=0,$O=$_.length;for($j=0;$j<$O;$j++)if(!($S=$_[$j])||!$S.source)return!1;return!0},$w.isOKCmdList=function($_){if(!$_)return!1;var $S,$j,$O=0,$V=$_.length,$M=$x._context;for($O=0;$O<$V;$O++)switch(($S=$_[$O]).callee){case $M._drawTexture:case $M._fillTexture:case $M._drawTextureWithTransform:if(!($j=$S[0])||!$j.source)return!1}return!0},$w._gid=1,$w._pi=180/Math.PI,$w._pi2=Math.PI/180,$w._extReg=/\.(\w+)\??/g,$w.parseXMLFromString=function($_){var $S;if($_=$_.replace(/>\s+</g,"><"),-1<($S=(new DOMParser).parseFromString($_,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($S.firstChild.firstChild.textContent);return $S},$w}(),$X=function(){function $_(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$x.isWebGL&&$G.regCacheByFunction($K.bind(this.startDispose,this),$K.bind(this.getCacheList,this))}$v($_,"laya.utils.VectorGraphManager");var $S=$_.prototype;return $S.getId=function(){return this._id++},$S.addShape=function($_,$S){this.shapeDic[$_]=$S,this.useDic[$_]||(this.useDic[$_]=!0)},$S.addLine=function($_,$S){this.shapeLineDic[$_]=$S,this.shapeLineDic[$_]||(this.shapeLineDic[$_]=!0)},$S.getShape=function($_){this._checkKey&&null!=this.useDic[$_]&&(this.useDic[$_]=!0)},$S.deleteShape=function($_){this.shapeDic[$_]&&(this.shapeDic[$_]=null,delete this.shapeDic[$_]),this.shapeLineDic[$_]&&(this.shapeLineDic[$_]=null,delete this.shapeLineDic[$_]),null!=this.useDic[$_]&&delete this.useDic[$_]},$S.getCacheList=function(){var $_,$S=[];for($_ in this.shapeDic)$S.push(this.shapeDic[$_]);for($_ in this.shapeLineDic)$S.push(this.shapeLineDic[$_]);return $S},$S.startDispose=function($_){var $S;for($S in this.useDic)this.useDic[$S]=!1;this._checkKey=!0},$S.endDispose=function(){if(this._checkKey){var $_;for($_ in this.useDic)this.useDic[$_]||this.deleteShape($_);this._checkKey=!1}},$_.getInstance=function(){return $_.instance=$_.instance||new $_},$_.instance=null,$_}(),$r=function(){function $O(){this._obj=null,this._obj=$O.supportWeakMap?new $m.window.WeakMap:{},$O.supportWeakMap||$O._maps.push(this)}$v($O,"laya.utils.WeakObject");var $_=$O.prototype;return $_.set=function($_,$S){if(null!=$_)if($O.supportWeakMap){var $j=$_;"string"!=typeof $_&&"number"!=typeof $_||($j=$O._keys[$_])||($j=$O._keys[$_]={k:$_}),this._obj.set($j,$S)}else"string"==typeof $_||"number"==typeof $_?this._obj[$_]=$S:($_.$_GID||($_.$_GID=$K.getGID()),this._obj[$_.$_GID]=$S)},$_.get=function($_){if(null==$_)return null;if($O.supportWeakMap){var $S="string"==typeof $_||"number"==typeof $_?$O._keys[$_]:$_;return $S?this._obj.get($S):null}return"string"==typeof $_||"number"==typeof $_?this._obj[$_]:this._obj[$_.$_GID]},$_.del=function($_){if(null!=$_)if($O.supportWeakMap){var $S="string"==typeof $_||"number"==typeof $_?$O._keys[$_]:$_;if(!$S)return;this._obj.delete($S)}else"string"==typeof $_||"number"==typeof $_?delete this._obj[$_]:delete this._obj[this._obj.$_GID]},$_.has=function($_){if(null==$_)return!1;if($O.supportWeakMap){var $S="string"==typeof $_||"number"==typeof $_?$O._keys[$_]:$_;return this._obj.has($S)}return"string"==typeof $_||"number"==typeof $_?null!=this._obj[$_]:null!=this._obj[this._obj.$_GID]},$O.__init__=function(){($O.supportWeakMap=null!=$m.window.WeakMap)||$f.timer.loop($O.delInterval,null,$O.clearCache)},$O.clearCache=function(){for(var $_=0,$S=$O._maps.length;$_<$S;$_++){$O._maps[$_]._obj={}}},$O.supportWeakMap=!1,$O.delInterval=3e5,$O._keys={},$O._maps=[],$a($O,["I",function(){return this.I=new $O}]),$O}(),$b=function(){function $_(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$v($_,"laya.utils.WordText");var $S=$_.prototype;return $S.setText=function($_){this.changed=!0,this._text=$_},$S.toString=function(){return this._text},$S.charCodeAt=function($_){return this._text?this._text.charCodeAt($_):NaN},$S.charAt=function($_){return this._text?this._text.charAt($_):null},$c(0,$S,"length",function(){return this._text?this._text.length:0}),$_}(),$__=function($_){function $R(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$R.__super.call(this),this._childs=$R.ARRAY_EMPTY,this._$P=$R.PROP_EMPTY,this.timer=$f.scaleTimer,this.conchModel=$x.isConchNode?this.createConchModel():null}$v($R,"laya.display.Node",$u);var $S=$R.prototype;return $S._setBit=function($_,$S){1==$_&&(this._getBit($_)!=$S&&this._updateDisplayedInstage());$S?this._bits|=$_:this._bits&=~$_},$S._getBit=function($_){return 0!=(this._bits&$_)},$S._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$S._setUpNoticeType=function($_){var $S=this;for($S._setBit($_,!0),$S=$S.parent;$S;){if($S._getBit($_))return;$S._setBit($_,!0),$S=$S.parent}},$S.on=function($_,$S,$j,$O){return"display"!==$_&&"undisplay"!==$_||this._getBit(1)||this._setUpNoticeType(1),this._createListener($_,$S,$j,$O,!1)},$S.once=function($_,$S,$j,$O){return"display"!==$_&&"undisplay"!==$_||this._getBit(1)||this._setUpNoticeType(1),this._createListener($_,$S,$j,$O,!0)},$S.createConchModel=function(){return null},$S.destroy=function($_){void 0===$_&&($_=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($_?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$S.destroyChildren=function(){if(this._childs)for(var $_=this._childs.length-1;-1<$_;$_--)this._childs[$_].destroy(!0)},$S.addChild=function($_){if(!$_||this.destroyed||$_===this)return $_;if($_.zOrder&&this._set$P("hasZorder",!0),$_._parent===this){var $S=this.getChildIndex($_);$S!==this._childs.length-1&&(this._childs.splice($S,1),this._childs.push($_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,this._childs.length-1)),this._childChanged())}else $_.parent&&$_.parent.removeChild($_),this._childs===$R.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($_),this.conchModel&&this.conchModel.addChildAt($_.conchModel,this._childs.length-1),($_.parent=this)._childChanged();return $_},$S.addChildren=function($_){for(var $S=arguments,$j=0,$O=$S.length;$j<$O;)this.addChild($S[$j++])},$S.addChildAt=function($_,$S){if(!$_||this.destroyed||$_===this)return $_;if($_.zOrder&&this._set$P("hasZorder",!0),0<=$S&&$S<=this._childs.length){if($_._parent===this){var $j=this.getChildIndex($_);this._childs.splice($j,1),this._childs.splice($S,0,$_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,$S)),this._childChanged()}else $_.parent&&$_.parent.removeChild($_),this._childs===$R.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($S,0,$_),this.conchModel&&this.conchModel.addChildAt($_.conchModel,$S),$_.parent=this;return $_}throw new Error("appendChildAt:The index is out of bounds")},$S.getChildIndex=function($_){return this._childs.indexOf($_)},$S.getChildByName=function($_){var $S=this._childs;if($S)for(var $j=0,$O=$S.length;$j<$O;$j++){var $V=$S[$j];if($V.name===$_)return $V}return null},$S._get$P=function($_){return this._$P[$_]},$S._set$P=function($_,$S){return this.destroyed||(this._$P===$R.PROP_EMPTY&&(this._$P={}),this._$P[$_]=$S),$S},$S.getChildAt=function($_){return this._childs[$_]},$S.setChildIndex=function($_,$S){var $j=this._childs;if($S<0||$S>=$j.length)throw new Error("setChildIndex:The index is out of bounds.");var $O=this.getChildIndex($_);if($O<0)throw new Error("setChildIndex:node is must child of this object.");return $j.splice($O,1),$j.splice($S,0,$_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,$S)),this._childChanged(),$_},$S._childChanged=function($_){},$S.removeChild=function($_){if(!this._childs)return $_;var $S=this._childs.indexOf($_);return this.removeChildAt($S)},$S.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$S.removeChildByName=function($_){var $S=this.getChildByName($_);return $S&&this.removeChild($S),$S},$S.removeChildAt=function($_){var $S=this.getChildAt($_);if($S){for(var $j=this._childs.length-1,$O=$_;$O<$j;++$O)this._childs[$O]=this._childs[$O+1];this._childs.length=$j,this.conchModel&&this.conchModel.removeChild($S.conchModel),$S.parent=null}return $S},$S.removeChildren=function($_,$S){if(void 0===$_&&($_=0),void 0===$S&&($S=2147483647),this._childs&&0<this._childs.length){var $j=this._childs;if(0===$_&&$M<=$S){var $O=$j;this._childs=$R.ARRAY_EMPTY}else $O=$j.splice($_,$S-$_);for(var $V=0,$M=$O.length;$V<$M;$V++)$O[$V].parent=null,this.conchModel&&this.conchModel.removeChild($O[$V].conchModel)}return this},$S.replaceChild=function($_,$S){var $j=this._childs.indexOf($S);return-1<$j?(this._childs.splice($j,1,$_),this.conchModel&&(this.conchModel.removeChild($S.conchModel),this.conchModel.addChildAt($_.conchModel,$j)),$S.parent=null,$_.parent=this,$_):null},$S._updateDisplayedInstage=function(){var $_;$_=this;var $S=$f.stage;for(this._displayedInStage=!1;$_;){if($_._getBit(1)){this._displayedInStage=$_._displayedInStage;break}if($_==$S||$_._displayedInStage){this._displayedInStage=!0;break}$_=$_.parent}},$S._setDisplay=function($_){this._displayedInStage!==$_&&((this._displayedInStage=$_)?this.event("display"):this.event("undisplay"))},$S._displayChild=function($_,$S){var $j=$_._childs;if($j)for(var $O=0;$O<$j.length;$O++){var $V=$j[$O];$V&&$V._getBit(1)&&(0<$V._childs.length?this._displayChild($V,$S):$V._setDisplay($S))}$_._setDisplay($S)},$S.contains=function($_){if($_===this)return!0;for(;$_;){if($_.parent===this)return!0;$_=$_.parent}return!1},$S.timerLoop=function($_,$S,$j,$O,$V,$M){void 0===$V&&($V=!0),void 0===$M&&($M=!1),this.timer.loop($_,$S,$j,$O,$V,$M)},$S.timerOnce=function($_,$S,$j,$O,$V){void 0===$V&&($V=!0),this.timer._create(!1,!1,$_,$S,$j,$O,$V)},$S.frameLoop=function($_,$S,$j,$O,$V){void 0===$V&&($V=!0),this.timer._create(!0,!0,$_,$S,$j,$O,$V)},$S.frameOnce=function($_,$S,$j,$O,$V){void 0===$V&&($V=!0),this.timer._create(!0,!1,$_,$S,$j,$O,$V)},$S.clearTimer=function($_,$S){this.timer.clear($_,$S)},$c(0,$S,"numChildren",function(){return this._childs.length}),$c(0,$S,"destroyed",function(){return this._destroyed}),$c(0,$S,"parent",function(){return this._parent},function($_){this._parent!==$_&&($_?(this._parent=$_,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$_.displayedInStage&&this._displayChild(this,!0)),$_._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$_))}),$c(0,$S,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$R.ARRAY_EMPTY=[],$R.PROP_EMPTY={},$R.NOTICE_DISPLAY=1,$R.MOUSEENABLE=2,$R}(),$S_=function($_){function $s($_){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$s.__super.call(this),this._padding=$s._PADDING,this._spacing=$s._SPACING,this._aligns=$s._ALIGNS,this._font=$C.EMPTY,this._ower=$_}$v($s,"laya.display.css.CSSStyle",$_);var $S=$s.prototype;return $S.destroy=function(){this._ower=null,this._font=null,this._rect=null},$S.inherit=function($_){this._font=$_._font,this._spacing=$_._spacing===$s._SPACING?$s._SPACING:$_._spacing.slice(),this.lineHeight=$_.lineHeight},$S._widthAuto=function(){return 0!=(262144&this._type)},$S.widthed=function($_){return 0!=(8&this._type)},$S._calculation=function($_,$S){if($S.indexOf("%")<0)return!1;var $O=this._ower,$V=$O.parent,$M=this._rect;function $R($_,$S,$j){return $_*$j[0]+$S*$j[1]+$j[2]}function $j($_){var $S=$V.width,$j=$O.width;$M.width&&($O.width=$R($S,$j,$M.width)),$M.height&&($O.height=$R($S,$j,$M.height)),$M.left&&($O.x=$R($S,$j,$M.left)),$M.top&&($O.y=$R($S,$j,$M.top))}null===$M&&($V._getCSSStyle()._type|=524288,$V.on("resize",this,$j),this._rect=$M={input:{}});var $w=$S.split(" ");return $w[0]=parseFloat($w[0])/100,1==$w.length?$w[1]=$w[2]=0:($w[1]=parseFloat($w[1])/100,$w[2]=parseFloat($w[2])),$M[$_]=$w,$M.input[$_]=$S,$j(),!0},$S.heighted=function($_){return 0!=(8192&this._type)},$S.size=function($_,$S){var $j=this._ower,$O=!1;-1!==$_&&$_!=this._ower.width&&(this._type|=8,this._ower.width=$_,$O=!0),-1!==$S&&$S!=this._ower.height&&(this._type|=8192,this._ower.height=$S,$O=!0),$O&&($j._layoutLater(),524288&this._type&&$j.event("resize",this))},$S._getAlign=function(){return this._aligns[0]},$S._getValign=function(){return this._aligns[1]},$S._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$S._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $C(this._font))},$S.render=function($_,$S,$j,$O){var $V=$_.width,$M=$_.height;$j-=$_.pivotX,$O-=$_.pivotY,this._bgground&&null!=this._bgground.color&&$S.ctx.fillRect($j,$O,$V,$M,this._bgground.color),this._border&&this._border.color&&$S.drawRect($j,$O,$V,$M,this._border.color.strColor,this._border.size)},$S.getCSSStyle=function(){return this},$S.cssText=function($_){this.attrs($s.parseOneCSS($_,";"))},$S.attrs=function($_){if($_)for(var $S=0,$j=$_.length;$S<$j;$S++){var $O=$_[$S];this[$O[0]]=$O[1]}},$S.setTransform=function($_){"none"===$_?this._tf=$w._TF_EMPTY:this.attrs($s.parseOneCSS($_,","))},$S.translate=function($_,$S){this._tf===$w._TF_EMPTY&&(this._tf=new $V),this._tf.translateX=$_,this._tf.translateY=$S},$S.scale=function($_,$S){this._tf===$w._TF_EMPTY&&(this._tf=new $V),this._tf.scaleX=$_,this._tf.scaleY=$S},$S._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$c(0,$S,"block",$_.prototype._$get_block,function($_){$_?this._type|=1:this._type&=-2}),$c(0,$S,"valign",function(){return $s._valigndef[this._aligns[1]]},function($_){this._aligns===$s._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$s._valigndef[$_]}),$c(0,$S,"height",null,function($_){if(this._type|=8192,"string"==typeof $_){if(this._calculation("height",$_))return;$_=parseInt($_)}this.size(-1,$_)}),$c(0,$S,"width",null,function($_){if(this._type|=8,"string"==typeof $_){var $S=$_.indexOf("auto");if(0<=$S&&(this._type|=262144,$_=$_.substr(0,$S)),this._calculation("width",$_))return;$_=parseInt($_)}this.size($_,-1)}),$c(0,$S,"fontWeight",function(){return this._font.weight},function($_){this._createFont().weight=$_}),$c(0,$S,"left",null,function($_){var $S=this._ower;if("string"==typeof $_){if("center"===$_?$_="50% -50% 0":"right"===$_&&($_="100% -100% 0"),this._calculation("left",$_))return;$_=parseInt($_)}$S.x=$_}),$c(0,$S,"_translate",null,function($_){this.translate($_[0],$_[1])}),$c(0,$S,"absolute",function(){return 0!=(4&this._type)}),$c(0,$S,"top",null,function($_){var $S=this._ower;if("string"==typeof $_){if("middle"===$_?$_="50% -50% 0":"bottom"===$_&&($_="100% -100% 0"),this._calculation("top",$_))return;$_=parseInt($_)}$S.y=$_}),$c(0,$S,"align",function(){return $s._aligndef[this._aligns[0]]},function($_){this._aligns===$s._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$s._aligndef[$_]}),$c(0,$S,"bold",function(){return this._font.bold},function($_){this._createFont().bold=$_}),$c(0,$S,"padding",function(){return this._padding},function($_){this._padding=$_}),$c(0,$S,"leading",function(){return this._spacing[1]},function($_){"string"==typeof $_&&($_=parseInt($_+"")),this._spacing===$s._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$_}),$c(0,$S,"lineElement",function(){return 0!=(65536&this._type)},function($_){$_?this._type|=65536:this._type&=-65537}),$c(0,$S,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($_){this.lineElement=!1,"right"===$_?this._type|=32768:this._type&=-32769}),$c(0,$S,"textDecoration",function(){return this._font.decoration},function($_){this._createFont().decoration=$_}),$c(0,$S,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($_){"nowrap"===$_&&(this._type|=131072),"none"===$_&&(this._type&=-131073)}),$c(0,$S,"background",null,function($_){$_?(this._bgground||(this._bgground={}),this._bgground.color=$_,this._ower.conchModel&&this._ower.conchModel.bgColor($_),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$c(0,$S,"wordWrap",function(){return 0==(131072&this._type)},function($_){$_?this._type&=-131073:this._type|=131072}),$c(0,$S,"color",function(){return this._font.color},function($_){this._createFont().color=$_}),$c(0,$S,"password",function(){return this._font.password},function($_){this._createFont().password=$_}),$c(0,$S,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($_){"none"===$_?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$_),this._ower.conchModel&&this._ower.conchModel.bgColor($_),this._ower._renderType|=256}),$c(0,$S,"font",function(){return this._font.toString()},function($_){this._createFont().set($_)}),$c(0,$S,"weight",null,function($_){this._createFont().weight=$_}),$c(0,$S,"letterSpacing",function(){return this._spacing[0]},function($_){"string"==typeof $_&&($_=parseInt($_+"")),this._spacing===$s._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$_}),$c(0,$S,"fontSize",function(){return this._font.size},function($_){this._createFont().size=$_}),$c(0,$S,"italic",function(){return this._font.italic},function($_){this._createFont().italic=$_}),$c(0,$S,"fontFamily",function(){return this._font.family},function($_){this._createFont().family=$_}),$c(0,$S,"stroke",function(){return this._font.stroke[0]},function($_){this._createFont().stroke===$C._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$_}),$c(0,$S,"strokeColor",function(){return this._font.stroke[1]},function($_){this._createFont().stroke===$C._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$_}),$c(0,$S,"border",function(){return this._border?this._border.value:""},function($_){if("none"!=$_){this._border||(this._border={});var $S=(this._border.value=$_).split(" ");if(this._border.color=$L.create($S[$S.length-1]),1==$S.length)return this._border.size=1,void(this._border.type="solid");var $j=0;0<$S[0].indexOf("px")?(this._border.size=parseInt($S[0]),$j++):this._border.size=1,this._border.type=$S[$j],this._ower._renderType|=256}else this._border=null}),$c(0,$S,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($_){$_?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$_?null:$L.create($_),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$c(0,$S,"position",function(){return 4&this._type?"absolute":""},function($_){"absolute"==$_?this._type|=4:this._type&=-5}),$c(0,$S,"display",null,function($_){switch($_){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$c(0,$S,"paddingLeft",function(){return this.padding[3]}),$c(0,$S,"paddingTop",function(){return this.padding[0]}),$c(0,$S,"_scale",null,function($_){this._ower.scale($_[0],$_[1])}),$c(0,$S,"_rotate",null,function($_){this._ower.rotation=$_}),$s.parseOneCSS=function($_,$S){for(var $j,$O=[],$V=$_.split($S),$M=0,$R=$V.length;$M<$R;$M++){var $w=$V[$M],$a=$w.indexOf(":"),$u=$w.substr(0,$a).replace(/^\s+|\s+$/g,"");if(0!=$u.length){var $c=$w.substr($a+1).replace(/^\s+|\s+$/g,""),$q=[$u,$c];switch($u){case"italic":case"bold":$q[1]="true"==$c;break;case"line-height":$q[0]="lineHeight",$q[1]=parseInt($c);break;case"font-size":$q[0]="fontSize",$q[1]=parseInt($c);break;case"padding":1<($j=$c.split(" ")).length||($j[1]=$j[2]=$j[3]=$j[0]),$q[1]=[parseInt($j[0]),parseInt($j[1]),parseInt($j[2]),parseInt($j[3])];break;case"rotate":$q[0]="_rotate",$q[1]=parseFloat($c);break;case"scale":$j=$c.split(" "),$q[0]="_scale",$q[1]=[parseFloat($j[0]),parseFloat($j[1])];break;case"translate":$j=$c.split(" "),$q[0]="_translate",$q[1]=[parseInt($j[0]),parseInt($j[1])];break;default:($q[0]=$s._CSSTOVALUE[$u])||($q[0]=$u)}$O.push($q)}}return $O},$s.parseCSS=function($_,$S){for(var $j;null!=($j=$s._parseCSSRegExp.exec($_));)$s.styleSheets[$j[1]]=$s.parseOneCSS($j[2],";")},$s.EMPTY=new $s(null),$s._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$s._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$s._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$s._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$s.styleSheets={},$s.ALIGN_CENTER=1,$s.ALIGN_RIGHT=2,$s.VALIGN_MIDDLE=1,$s.VALIGN_BOTTOM=2,$s._CSS_BLOCK=1,$s._DISPLAY_NONE=2,$s._ABSOLUTE=4,$s._WIDTH_SET=8,$s._PADDING=[0,0,0,0],$s._RECT=[-1,-1,-1,-1],$s._SPACING=[0,0],$s._ALIGNS=[0,0,0],$s.ADDLAYOUTED=512,$s._NEWFONT=4096,$s._HEIGHT_SET=8192,$s._BACKGROUND_SET=16384,$s._FLOAT_RIGHT=32768,$s._LINE_ELEMENT=65536,$s._NOWARP=131072,$s._WIDTHAUTO=262144,$s._LISTERRESZIE=524288,$s}($w),$j_=function($_){function $R(){this.url=null,this.audio=null,this.loaded=!1,$R.__super.call(this)}$v($R,"laya.media.h5audio.AudioSound",$u);var $S=$R.prototype;return $S.dispose=function(){var $_=$R._audioCache[this.url];$_&&($_.src="",delete $R._audioCache[this.url])},$S.load=function($_){var $S;if($_=$F.formatURL($_),(this.url=$_)==$$._tMusic?($R._initMusicAudio(),($S=$R._musicAudio).src!=$_&&($R._audioCache[$S.src]=null,$S=null)):$S=$R._audioCache[$_],$S&&2<=$S.readyState)this.event("complete");else{$S||($S=$_==$$._tMusic?($R._initMusicAudio(),$R._musicAudio):$m.createElement("audio"),($R._audioCache[$_]=$S).src=$_),$S.addEventListener("canplaythrough",$O),$S.addEventListener("error",$V);var $j=this;(this.audio=$S).load?$S.load():$V()}function $O(){$M(),$j.loaded=!0,$j.event("complete")}function $V(){$S.load=null,$M(),$j.event("error")}function $M(){$S.removeEventListener("canplaythrough",$O),$S.removeEventListener("error",$V)}},$S.play=function($_,$S,$j){if(void 0===$_&&($_=0),void 0===$S&&($S=0),!this.url)return null;var $O,$V;if(!($O=this.url==$$._tMusic?$R._musicAudio:$R._audioCache[this.url]))return null;$V=$T.getItem("audio:"+this.url),$x.isConchApp?$V||(($V=$m.createElement("audio")).src=this.url):this.url==$$._tMusic?($R._initMusicAudio(),($V=$R._musicAudio).src=this.url):$V=$V||$O.cloneNode(!0);var $M=new $s_($V);return $M.url=this.url,$M.loops=$S,$M.startTime=$_,$M.startHandler=$j,$M.play(!1),$$.addChannel($M),$M},$c(0,$S,"duration",function(){var $_;return($_=$R._audioCache[this.url])?$_.duration:0}),$R._initMusicAudio=function(){$R._musicAudio||($R._musicAudio||($R._musicAudio=$m.createElement("audio")),$x.isConchApp||$m.document.addEventListener("mousedown",$R._makeMusicOK))},$R._makeMusicOK=function(){$m.document.removeEventListener("mousedown",$R._makeMusicOK),$R._musicAudio.src?$R._musicAudio.play():($R._musicAudio.src="",$R._musicAudio.load())},$R._audioCache={},$R._musicAudio=null,$R}(),$O_=function($_){function $S(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$S.__super.call(this)}$v($S,"laya.media.SoundChannel",$u);var $j=$S.prototype;return $j.play=function(){},$j.stop=function(){},$j.pause=function(){},$j.resume=function(){},$j.__runComplete=function($_){$_&&$_.run()},$c(0,$j,"volume",function(){return 1},function($_){}),$c(0,$j,"position",function(){return 0}),$c(0,$j,"duration",function(){return 0}),$S}(),$V_=function($_){function $S(){$S.__super.call(this)}$v($S,"laya.media.Sound",$u);var $j=$S.prototype;return $j.load=function($_){},$j.play=function($_,$S,$j){return void 0===$_&&($_=0),void 0===$S&&($S=0),null},$j.dispose=function(){},$c(0,$j,"duration",function(){return 0}),$S}(),$M_=function($_){function $V(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$V.__super.call(this)}$v($V,"laya.media.webaudio.WebAudioSound",$u);var $S=$V.prototype;return $S.load=function($_){this.url=$_,this.audioBuffer=$V._dataCache[$_],this.audioBuffer?this._loaded(this.audioBuffer):($V.e.on("loaded:"+$_,this,this._loaded),$V.e.on("err:"+$_,this,this._err),$V.__loadingSound[$_]||($V.__loadingSound[$_]=!0,$f.loader.load($_,$l.create(this,this.onloaded),null,$w_.BUFFER,4,!1,null,!0)))},$S.onloaded=function($_){$_||this._err(),this._disposed?this._removeLoadEvents():(this.data=$_,$V.buffs.push({buffer:this.data,url:this.url}),$V.decode())},$S._err=function(){if(this._removeLoadEvents(),$V.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $_,$S,$j,$O=0;for($_=($S=this.__toPlays).length,$O=0;$O<$_;$O++)($j=$S[$O])[3]&&!$j[3].isStopped&&$j[3].event("error");this.__toPlays.length=0}},$S._loaded=function($_){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$_,this.loaded=!0,this.event("complete"))},$S._removeLoadEvents=function(){$V.e.off("loaded:"+this.url,this,this._loaded),$V.e.off("err:"+this.url,this,this._err)},$S.__playAfterLoaded=function(){if(this.__toPlays){var $_,$S,$j,$O=0;for($_=($S=this.__toPlays).length,$O=0;$O<$_;$O++)($j=$S[$O])[3]&&!$j[3].isStopped&&this.play($j[0],$j[1],$j[2],$j[3]);this.__toPlays.length=0}},$S.play=function($_,$S,$j,$O){return void 0===$_&&($_=0),void 0===$S&&($S=0),$O=$O||new $C_,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$_,$S,$j,$O]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$O.url=this.url,$O.loops=$S,$O.audioBuffer=this.audioBuffer,$O.startTime=$_,$O.startHandler=$j,$O.play(!1),$$.addChannel($O),$O},$S.dispose=function(){this._disposed=!0,delete $V._dataCache[this.url],delete $V.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$c(0,$S,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$V.decode=function(){if(!($V.buffs.length<=0||$V.isDecoding))if($V.isDecoding=!0,($V.tInfo=$V.buffs.shift())&&$V.tInfo.buffer&&$V.tInfo.buffer.byteLength)try{$V.ctx.decodeAudioData($V.tInfo.buffer,$V._done,$V._fail)}catch($_){console.error("decodeAudioData error  byteLength:"+$V.tInfo.buffer.byteLength+"  url:"+$V.tInfo.url)}else $V._fail()},$V._done=function($_){$V.e.event("loaded:"+$V.tInfo.url,$_),$V._dataCache[$V.tInfo.url]=$_,$V.isDecoding=!1,$V.decode()},$V._fail=function(){$V.e.event("err:"+$V.tInfo.url,null),$V.isDecoding=!1,$V.decode()},$V._playEmptySound=function(){if(null!=$V.ctx){if($V._emptySource&&($V._emptySource.stop(),$V._emptySource.disconnect(0),!$C_._tryCleanFailed))try{$V._emptySource.buffer=null}catch($_){$C_._tryCleanFailed=!0}var $_=$V.ctx.createBufferSource();$_.buffer=$V._miniBuffer,$_.connect($V.ctx.destination),$_.start(0,0,0),$V._emptySource=$_}},$V._unlock=function(){$V._unlocked||($V._playEmptySound(),"running"==$V.ctx.state?($m.document.removeEventListener("mousedown",$V._unlock,!0),$m.document.removeEventListener("touchend",$V._unlock,!0),$m.document.removeEventListener("touchstart",$V._unlock,!0),$V._unlocked=!0):"suspended"==$V.ctx.state&&$$._recoverWebAudio())},$V.initWebAudio=function(){"running"!=$V.ctx.state&&($V._unlock(),$m.document.addEventListener("mousedown",$V._unlock,!0),$m.document.addEventListener("touchend",$V._unlock,!0),$m.document.addEventListener("touchstart",$V._unlock,!0))},$V._emptySource=null,$V._dataCache={},$V.buffs=[],$V.isDecoding=!1,$V._unlocked=!1,$V.tInfo=null,$V.__loadingSound={},$a($V,["window",function(){return this.window=$m.window},"webAudioEnabled",function(){return this.webAudioEnabled=$V.window.AudioContext||$V.window.webkitAudioContext||$V.window.mozAudioContext},"ctx",function(){return this.ctx=$V.webAudioEnabled?new($V.window.AudioContext||$V.window.webkitAudioContext||$V.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$V.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $u}]),$V}(),$R_=function($_){function $S(){this._responseType=null,this._data=null,$S.__super.call(this),this._http=new $m.window.XMLHttpRequest}$v($S,"laya.net.HttpRequest",$u);var $j=$S.prototype;return $j.send=function($_,$S,$j,$O,$V){void 0===$j&&($j="get"),void 0===$O&&($O="text"),this._responseType=$O,this._data=null;var $M=this,$R=this._http;if($R.open($j,$_,!0),$V)for(var $w=0;$w<$V.length;$w++)$R.setRequestHeader($V[$w++],$V[$w]);else $x.isConchApp||($S&&"string"!=typeof $S?$R.setRequestHeader("Content-Type","application/json"):$R.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$R.responseType="arraybuffer"!==$O?"text":"arraybuffer",$R.onerror=function($_){$M._onError($_)},$R.onabort=function($_){$M._onAbort($_)},$R.onprogress=function($_){$M._onProgress($_)},$R.onload=function($_){$M._onLoad($_)},$R.send($S)},$j._onProgress=function($_){$_&&$_.lengthComputable&&this.event("progress",$_.loaded/$_.total)},$j._onAbort=function($_){this.error("Request was aborted by user")},$j._onError=function($_){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$j._onLoad=function($_){var $S=this._http,$j=void 0!==$S.status?$S.status:200;200===$j||204===$j||0===$j?this.complete():this.error("["+$S.status+"]"+$S.statusText+":"+$S.responseURL)},$j.error=function($_){this.clear(),this.event("error",$_)},$j.complete=function(){this.clear();var $S=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$K.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($_){$S=!1,this.error($_.message)}$S&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$j.clear=function(){var $_=this._http;$_.onerror=$_.onabort=$_.onprogress=$_.onload=null},$c(0,$j,"url",function(){return this._http.responseURL}),$c(0,$j,"http",function(){return this._http}),$c(0,$j,"data",function(){return this._data}),$S}(),$w_=function($_){function $g(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$g.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}$v($g,"laya.net.Loader",$u);var $S=$g.prototype;return $S.load=function($_,$S,$j,$O,$V){if($_&&""!=$_||console.error("Loader 加载的url不合法 "+$_),void 0===$j&&($j=!0),void 0===$V&&($V=!1),this._url=$_,this._base64=!1,0===$_.indexOf("data:image")?(this._base64=!0,this._type=$S="image"):this._type=$S||($S=this.getTypeFromUrl($_)),this._cache=$j,this._data=null,!$V&&$g.loadedMap[$_])return this._data=$g.loadedMap[$_],this.event("progress",1),void this.event("complete",this._data);if($O&&$g.setGroup($_,$O),null!=$g.parserMap[$S])return this._customParse=!0,void($g.parserMap[$S]instanceof laya.utils.Handler?$g.parserMap[$S].runWith(this):$g.parserMap[$S].call(null,this));if("image"===$S||"htmlimage"===$S||"nativeimage"===$S)return this._loadImage($_);if("ttf"===$S)return this._loadTTF($_);switch($S){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$S}$g.preLoadedMap[$_]?this.onLoaded($g.preLoadedMap[$_]):$R.resMgrLoad($_,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$S.getTypeFromUrl=function($_){var $S=$K.getFileExtension($_);return $S?$g.typeMap[$S]:(console.warn("Not recognize the resources suffix",$_),"text")},$S._loadTTF=function($_){$_=$F.formatURL($_);var $S=new $J;$S.complete=$l.create(this,this.onLoaded),$S.load($_)},$S._loadBase64Image=function($S){$S=$F.formatURL($S);var $j,$_=this;function $O(){$j.onload=null,$j.onerror=null,delete $g.imgCache[$S]}function $V(){$O(),$_.onLoaded($j)}function $M(){$O(),$_.event("error","Load image failed")}"nativeimage"===this._type?(($j=new $m.window.Image).crossOrigin="",$j.onload=$V,$j.onerror=$M,$j.src=$S,$g.imgCache[$S]=$j):new $A_.create($S,{onload:$V,onerror:$M,onCreate:function($_){$j=$_,$g.imgCache[$S]=$_}})},$S._loadImage=function($_){this._base64?this._loadBase64Image($_):$R.imgMgrLoad($_,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$S._loadImageComplete=function($_,$S,$j){if(null!=$j)if($j instanceof ArrayBuffer){var $O=new DataView($j),$V=new laya.webgl.resource.WebGLImage(new Uint8Array($j,8),$_,0,!1,$O.getUint32(0),$O.getUint32(4));this.onLoaded($V)}else if($j instanceof $c_)$g.imgMgrSet[$_]=$S,$R.imgMgrLock($_,$g.imgMgrSet[$_]),this._url=$_,this.complete($j);else{var $M=-1!=$_.indexOf(".png",$_.length-4)?6408:6407;$V=new laya.webgl.resource.WebGLImage($j,$_,$M,!1,$j.width,$j.height);this.onLoaded($V)}else this.event("error","Load image failed")},$S.imageCancel=function($_,$S,$j){$R.imgMgrCancel&&$R.imgMgrCancel($_,this._onImageCallback)},$S._loadSound=function($_){var $S=new $$._soundClass,$j=this;function $O(){$S.offAll()}$S.on("complete",this,function(){$O(),$j.onLoaded($S)}),$S.on("error",this,function(){$O(),$S.dispose(),$j.event("error","Load sound failed")}),$S.load($_)},$S.onProgress=function($_){"atlas"===this._type?this.event("progress",.3*$_):this.event("progress",$_)},$S.onError=function($_){this.event("error",$_)},$S._loadedComplete=function($_,$S,$j){if(null!=$j)switch(this._type){case"atlas":case"plf":case"json":var $O=new $e($j);this.onLoaded(JSON.parse($O.readUTFBytes()));break;case"font":$O=new $e($j);this.onLoaded($K.parseXMLFromString($O.readUTFBytes()));break;default:this.onLoaded($j)}else this.event("error",$_)},$S.onLoaded=function($_){var $S=this._type;if("plf"==$S)this.parsePLFData($_),this.complete($_);else if("image"===$S){var $j=new $c_($_);$j.url=this._url,this.complete($j)}else if("sound"===$S||"htmlimage"===$S||"nativeimage"===$S)this.complete($_);else if("atlas"===$S){if(!$_.src&&!$_._setContext){if(!this._data){if((this._data=$_).meta&&$_.meta.image)for(var $O=$_.meta.image.split(","),$V=0<=this._url.indexOf("/")?"/":"\\",$M=this._url.lastIndexOf($V),$R=0<=$M?this._url.substr(0,$M+1):"",$w=0,$a=$O.length;$w<$a;$w++)$O[$w]=$R+$O[$w];else $O=[this._url.replace(".json",".png")];$O.reverse(),$_.toLoads=$O,$_.pics=[]}return this.event("progress",.3+1/$O.length*.6),this._loadImage($O.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($_),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $u=this._data.frames,$c=this._url.split("?")[0],$q=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$c.substring(0,$c.lastIndexOf("."))+"/",$s=this._data.pics,$C=$F.formatURL(this._url),$i=$g.atlasMap[$C]||($g.atlasMap[$C]=[]);$i.dir=$q;var $v=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $Z in $v=parseFloat(this._data.meta.scale),$u){var $o,$l=$u[$Z],$k=$s[$l.frame.idx?$l.frame.idx:0],$z=$F.formatURL($q+$Z);$k.scaleRate=$v,$o=$c_.create($k,$l.frame.x,$l.frame.y,$l.frame.w,$l.frame.h,$l.spriteSourceSize.x,$l.spriteSourceSize.y,$l.sourceSize.w,$l.sourceSize.h),$g.cacheRes($z,$o),$g.keepCache(this._url,$q+$Z),$o.url=$z,$i.push($z)}else for($Z in $u)$k=$s[($l=$u[$Z]).frame.idx?$l.frame.idx:0],$z=$F.formatURL($q+$Z),$g.cacheRes($z,$c_.create($k,$l.frame.x,$l.frame.y,$l.frame.w,$l.frame.h,$l.spriteSourceSize.x,$l.spriteSourceSize.y,$l.sourceSize.w,$l.sourceSize.h)),$g.loadedMap[$z].url=$z,$g.keepCache(this._url,$q+$Z),$i.push($z);delete this._data.pics,this.complete(this._data)}else if("font"==$S){if(!$_.src)return this._data=$_,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $H=new $E;$H.parseFont(this._data,$_);var $A=this._url.split(".fnt")[0].split("/"),$f=$A[$A.length-1];$Z_.registerBitmapFont($f,$H),this._data=$H,this.complete(this._data)}else if("pkm"==$S){var $y=$A_.create($_,this._url),$P=new $c_($y);$P.url=this._url,this.complete($P)}else this.complete($_)},$S.parsePLFData=function($_){var $S,$j,$O;for($S in $_)switch($O=$_[$S],$S){case"json":case"text":for($j in $O)$g.preLoadedMap[$F.formatURL($j)]=$O[$j];break;default:for($j in $O)$g.preLoadedMap[$F.formatURL($j)]=$O[$j]}},$S.complete=function($_){this._data=$_,this._customParse?this.event("loaded",$_ instanceof Array?[$_]:$_):($g._loaders.push(this),$g._isWorking||$g.checkNext())},$S.endLoad=function($_){$_&&(this._data=$_),this._cache&&$g.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$c(0,$S,"url",function(){return this._url}),$c(0,$S,"data",function(){return this._data}),$c(0,$S,"cache",function(){return this._cache}),$c(0,$S,"type",function(){return this._type}),$g.checkNext=function(){$g._isWorking=!0;for(var $_=$m.now();$g._startIndex<$g._loaders.length;)if($m.now(),$g._loaders[$g._startIndex].endLoad(),$g._startIndex++,$m.now()-$_>$g.maxTimeOut)return console.warn("loader callback cost a long time:"+($m.now()-$_)+" url="+$g._loaders[$g._startIndex-1].url),void $f.timer.frameOnce(1,null,$g.checkNext);$g._loaders.length=0,$g._startIndex=0,$g._isWorking=!1},$g.clearRes=function($_,$S){if(null!=$_){void 0===$S&&($S=!1),$_=$F.formatURL($_);var $j=$g.getAtlas($_);if($j){for(var $O=0,$V=$j.length;$O<$V;$O++){var $M=$j[$O],$R=$g.getRes($M);delete $g.loadedMap[$M],$g.clearCache($_.substring($F.basePath.length),$M.substring($F.basePath.length)),$R&&$R.destroy($S)}$j.length=0,delete $g.atlasMap[$_],delete $g.loadedMap[$_]}else{var $w=$g.loadedMap[$_];$w&&(delete $g.loadedMap[$_],$w instanceof laya.resource.Texture&&$w.bitmap&&$w.destroy($S))}}},$g.clearTextureRes=function($_){$_=$F.formatURL($_);var $S=laya.net.Loader.getAtlas($_),$j=$S&&0<$S.length?laya.net.Loader.getRes($S[0]):laya.net.Loader.getRes($_);$j&&$j.bitmap&&($x.isConchApp&&!$x.isConchWebGL?$j.bitmap.source.releaseTexture&&$j.bitmap.source.releaseTexture():null==$j.bitmap._atlaser&&$j.bitmap.releaseResource(!0))},$g.getRes=function($_){return $g.loadedMap[$F.formatURL($_)]},$g.getAtlas=function($_){return $g.atlasMap[$F.formatURL($_)]},$g.cacheRes=function($_,$S){$_=$F.formatURL($_),null!=$g.loadedMap[$_]?console.warn("Resources already exist,is repeated loading:",$_):$g.loadedMap[$_]=$S},$g.setGroup=function($_,$S){$g.groupMap[$S]||($g.groupMap[$S]=[]),$g.groupMap[$S].push($_)},$g.clearResByGroup=function($_){if($g.groupMap[$_]){var $S=$g.groupMap[$_],$j=0,$O=$S.length;for($j=0;$j<$O;$j++)$g.clearRes($S[$j]);$S.length=0}},$g.keepCache=function($_,$S){if($_&&$S){var $j=$g.cacheSet[$S];$j?-1==$j.indexOf($_)&&$j.push($_):$g.cacheSet[$S]=[$_]}},$g.clearCache=function($_,$S){if($_&&$S){var $j=$g.cacheSet[$S];if($j){var $O=$j.indexOf($_);if(-1!==$O){var $V=$j.length-1;0==$V?(delete $g.cacheSet[$S],0<$g.imgMgrSet[$S]?$R.imgMgrFree($S,$g.imgMgrSet[$S]):$g.clearRes($S,!0)):($j[$O]=$j[$V],$j.length=$V)}}}},$g.saveObject=function($_,$S,$j){if($S&&$_){var $O=$g.objectSet[$_];$O?(console.warn("Loader.saveObject: "+$_),$O[0]=$S,$O[1]=$j):$g.objectSet[$_]=[$S,$j,[]]}},$g.findObject=function($_){if($_){var $S=$g.objectSet[$_];if($S)return $S[0]}return null},$g.keepObject=function($_,$S){if($_&&$S){var $j=$g.objectSet[$S];$j&&-1===$j[2].indexOf($_)&&$j[2].push($_)}},$g.clearObject=function($_,$S){if($_&&$S){var $j=$g.objectSet[$S];if($j){var $O=$j[2],$V=$O.indexOf($_);if(-1!==$V){var $M=$O.length-1;0==$M?(delete $g.objectSet[$S],$j[1]&&$j[1].call(null,$j[0])):($O[$V]=$O[$M],$O.length=$M)}}}},$g.TEXT="text",$g.JSON="json",$g.XML="xml",$g.BUFFER="arraybuffer",$g.IMAGE="image",$g.SOUND="sound",$g.ATLAS="atlas",$g.FONT="font",$g.TTF="ttf",$g.PLF="plf",$g.PKM="pkm",$g.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$g.parserMap={},$g.groupMap={},$g.maxTimeOut=100,$g.loadedMap={},$g.preLoadedMap={},$g.atlasMap={},$g._loaders=[],$g._isWorking=!1,$g._startIndex=0,$g.imgCache={},$g.cacheSet={},$g.objectSet={},$g.imgMgrSet={},$g}(),$a_=function($_){var $s;function $C(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$C.__super.call(this);for(var $_=0;$_<this._maxPriority;$_++)this._resInfos[$_]=[]}$v($C,"laya.net.LoaderManager",$u);var $S=$C.prototype;return $S.create=function($_,$j,$S,$O,$V,$M,$R,$w){if(null==$M&&($M=2),null==$R&&($R=!0),$_ instanceof Array){var $a=$_,$u=$a.length,$c=0;if($S)var $q=$l.create($S.caller,$S.method,$S.args,!1);for(var $s=0;$s<$u;$s++){var $C=$a[$s];"string"==typeof $C&&($C=$a[$s]={url:$C}),$C.progress=0}for($s=0;$s<$u;$s++){$C=$a[$s];var $i=$S?$l.create(null,$o,[$C],!1):null,$v=$S||$j?$l.create(null,$Z,[$C]):null;this._create($C.url,$v,$i,$C.clas||$O,$C.params||$V,null!=$C.priority&&0<=$C.priority?$C.priority:$M,$R,$C.group||$w)}function $Z($_,$S){$c++,$_.progress=1,$c===$u&&$j&&$j.run()}function $o($_,$S){$_.progress=$S;for(var $j=0,$O=0;$O<$u;$O++){$j+=$a[$O].progress}var $V=$j/$u;$q.runWith($V)}return!0}return this._create($_,$j,$S,$O,$V,$M,$R,$w)},$S._create=function($S,$j,$_,$O,$V,$M,$R,$w){$S&&""!=$S||console.error("加载的url不合法 "+$S),null==$M&&($M=2),null==$R&&($R=!0);var $a=$F.formatURL($S),$u=this.getRes($a);if($u)!$u.hasOwnProperty("loaded")||$u.loaded?($_&&$_.runWith(1),$j&&$j.run()):$j&&$f.loader._createListener($S,$j.caller,$j.method,$j.args,!0,!1);else{var $c=$K.getFileExtension($S),$q=$C.createMap[$c];if(!$q)throw new Error("LoaderManager:unknown file("+$S+") extension with: "+$c+".");$O||($O=$q[0]);var $s=$q[1];if("atlas"==$c)this.load($S,$j,$_,$s,$M,$R);else{$O===$c_&&($s="htmlimage"),($u=$O?new $O:null).hasOwnProperty("_loaded")&&($u._loaded=!1),$u._setUrl($S),$w&&$u._setGroup($w),this._createLoad($u,$S,$l.create(null,function($_){$u&&!$u.destroyed&&$_&&$u.onAsynLoaded.call($u,$S,$_,$V),$j&&$j.run();$f.loader.event($S)}),$_,$s,$M,!1,$w,!0),$R&&this.cacheRes($a,$u)}}return $u},$S.load=function($_,$S,$j,$O,$V,$M,$R,$w){$_&&""!=$_||console.error("加载的url不合法 "+$_);var $a=this;if(null==$V&&($V=2),null==$M&&($M=!0),void 0===$w&&($w=!1),$_ instanceof Array)return this._loadAssets($_,$S,$j,$O,$V,$M,$R);var $u=$w_.getRes($_);if(null!=$u)$f.timer.frameOnce(1,null,function(){$j&&$j.runWith(1),$S&&$S.runWith($u),$a._loaderCount||$a.event("complete")});else{var $c=$C._resMap[$_];$c?($S&&$c._createListener("complete",$S.caller,$S.method,$S.args,!1,!1),$j&&$c._createListener("progress",$j.caller,$j.method,$j.args,!1,!1)):(($c=this._infoPool.length?this._infoPool.pop():new $s).url=$_,$c.clas=null,$c.type=$O,$c.cache=$M,$c.group=$R,$c.ignoreCache=$w,$c.priority=$V,$S&&$c.on("complete",$S.caller,$S.method,$S.args),$j&&$c.on("progress",$j.caller,$j.method,$j.args),$C._resMap[$_]=$c,$V=$V<this._maxPriority?0<=$V?$V:0:this._maxPriority-1,this._resInfos[$V].push($c),this._next())}return this},$S.cancel=function($_,$S,$j){if($u=$C._resMap[$_]){$S&&$u.off("complete",$S.caller,$S.method,!1),$j&&$u.off("progress",$j.caller,$j.method,!1);var $O=$u.getListener("complete"),$V=$u.getListener("progress");if(!($O&&$O.head||$V&&$V.head)){if($u.loader){var $M=$u.loader;$M.imageCancel($_),$M.offAll(),$M._data=null,$M._customParse=!1,$M._url=null,$M._class=null,$M._type=null,this._loaders.push($M),this._loaderCount--,delete this._loaderMap[$u.url]}for(var $R=0;$R<this._maxPriority;$R++)for(var $w=this._resInfos[$R],$a=$w.length-1;-1<$a;$a--){var $u;($u=$w[$a])&&$u.url===$_&&($w[$a]=null,$u.destroy(),$u.offAll(),this._infoPool.push($u))}delete $C._resMap[$_],this._next()}}},$S._createLoad=function($_,$S,$j,$O,$V,$M,$R,$w,$a){var $u=this;if(null==$M&&($M=2),null==$R&&($R=!0),void 0===$a&&($a=!1),$S instanceof Array)return this._loadAssets($S,$j,$O,$V,$M,$R,$w);var $c=$w_.getRes($S);if(null!=$c)$f.timer.frameOnce(1,null,function(){$O&&$O.runWith(1),$j&&$j.runWith($c),$u._loaderCount||$u.event("complete")});else{var $q=$C._resMap[$S];$q?($j&&$q._createListener("complete",$j.caller,$j.method,$j.args,!1,!1),$O&&$q._createListener("progress",$O.caller,$O.method,$O.args,!1,!1)):(($q=this._infoPool.length?this._infoPool.pop():new $s).url=$S,$q.clas=$_,$q.type=$V,$q.cache=$R,$q.group=$w,$q.ignoreCache=$a,$q.priority=$M,$j&&$q.on("complete",$j.caller,$j.method,$j.args),$O&&$q.on("progress",$O.caller,$O.method,$O.args),$C._resMap[$S]=$q,$M=$M<this._maxPriority?0<=$M?$M:0:this._maxPriority-1,this._resInfos[$M].push($q),this._next())}return this},$S._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $_=0;$_<this._maxPriority;$_++)for(var $S=this._resInfos[$_];0<$S.length;){var $j=$S.shift();if($j)return this._doLoad($j)}this._loaderCount||this.event("complete")}},$S._doLoad=function($S){var $j=this._loaders.length?this._loaders.pop():new $w_;this._loaderCount++,(this._loaderMap[$S.url]=$j).on("complete",null,$V),$j.on("progress",null,function($_){$S.event("progress",$_)}),$j.on("error",null,function($_){$V(null)}),$S.loader=$j;var $O=this;function $V($_){$j.offAll(),$j._data=null,$j._customParse=!1,$j._url=null,$j._class=null,$j._type=null,$O._loaders.push($j),$O._loaderCount--,delete $O._loaderMap[$S.url],$O._endLoad($S,$_ instanceof Array?[$_]:$_),$O._next()}$j._class=$S.clas,1<=$S.priority?($j.priority=$S.priority,$j.realTime=!1):($j.priority=0,$j.realTime=!0),$j.load($S.url,$S.type,$S.cache,$S.group,$S.ignoreCache)},$S._endLoad=function($_,$S){var $j=$_.url;if(null==$S){var $O=this._failRes[$j]||0;if($O<this.retryNum)return console.warn("[warn]Retry to load:",$j),this._failRes[$j]=$O+1,void $f.timer.once(this.retryDelay,this,this._addReTry,[$_],!1);console.warn("[error]Failed to load:",$j),this.event("error",$j)}this._failRes[$j]&&(this._failRes[$j]=0),delete $C._resMap[$j],$_.event("complete",$S),$_.destroy(),$_.offAll(),this._infoPool.push($_)},$S._addReTry=function($_){this._resInfos[this._maxPriority-1].push($_),this._next()},$S.clearRes=function($_,$S){void 0===$S&&($S=!1),$w_.clearRes($_,$S)},$S.getRes=function($_){return $w_.getRes($_)},$S.cacheRes=function($_,$S){$w_.cacheRes($_,$S)},$S.clearTextureRes=function($_){$w_.clearTextureRes($_)},$S.setGroup=function($_,$S){$w_.setGroup($_,$S)},$S.clearResByGroup=function($_){$w_.clearResByGroup($_)},$S.clearUnLoaded=function(){for(var $_=0;$_<this._maxPriority;$_++){for(var $S=this._resInfos[$_],$j=$S.length-1;-1<$j;$j--){var $O=$S[$j];$O&&($O.destroy(),$O.offAll(),this._infoPool.push($O))}$S.length=0}this._loaderCount=0,$C._resMap={}},$S.cancelLoadByUrls=function($_){if($_)for(var $S=0,$j=$_.length;$S<$j;$S++)this.cancelLoadByUrl($_[$S])},$S.cancelLoadByUrl=function($_){for(var $S=0;$S<this._maxPriority;$S++)for(var $j=this._resInfos[$S],$O=$j.length-1;-1<$O;$O--){var $V=$j[$O];$V&&$V.url===$_&&($j[$O]=null,$V.destroy(),$V.offAll(),this._infoPool.push($V))}$C._resMap[$_]&&delete $C._resMap[$_]},$S._loadAssets=function($_,$j,$R,$S,$O,$V,$M){null==$O&&($O=2),null==$V&&($V=!0);for(var $w=$_.length,$a=0,$u=0,$c=[],$q=!0,$s=0;$s<$w;$s++){var $C=$_[$s];if(!$C)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$_);"string"==typeof $C&&($C={url:$C,type:$S,size:1,priority:$O}),$C.size||($C.size=1),$C.progress=0,$u+=$C.size,$c.push($C);var $i=$R?$l.create(null,$o,[$C],!1):null,$v=$j||$R?$l.create(null,$Z,[$C]):null;this.load($C.url,$v,$i,$C.type,null!=$C.priority&&0<=$C.priority?$C.priority:2,$V,$C.group||$M)}function $Z($_,$S){$a++,$_.progress=1,$S||($q=!1),$a===$w&&$j&&$j.runWith($q)}function $o($_,$S){if(null!=$R){$_.progress=$S;for(var $j=0,$O=0;$O<$c.length;$O++){var $V=$c[$O];$j+=$V.size*$V.progress}var $M=$j/$u;$R.runWith($M)}}return this},$C.cacheRes=function($_,$S){$w_.cacheRes($_,$S)},$C._resMap={},$a($C,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$C.__init$=function(){$s=function($_){function $S(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$S.__super.call(this)}return $v($S,"",$u),$S.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$S}()},$C}(),$u_=(function($_){function $V($_){$V.__super.call(this),$_||($_=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $S=0,$j=0,$O=0;$O<20;$O++)$O%5!=4?this._mat[$S++]=$_[$O]:this._alpha[$j++]=$_[$O];this._action=$d.createFilterAction(32),this._action.data=this}$v($V,"laya.filters.ColorFilter",$o);var $S=$V.prototype;$f.imps($S,{"laya.filters.IFilter":!0}),$S.callNative=function($_){$_._$P.cf=this;$_.conchModel&&$_.conchModel.setFilterMatrix&&$_.conchModel.setFilterMatrix(this._mat,this._alpha)},$c(0,$S,"type",function(){return 32}),$c(0,$S,"action",function(){return this._action})}(),function($_){function $O($_,$S,$j){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$S&&($S=0),$O.__super.call(this),this._byteClass=$j||$e,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$_&&0<$S&&$S<65535&&this.connect($_,$S)}$v($O,"laya.net.Socket",$u);var $S=$O.prototype;$S.connect=function($_,$S){var $j="ws://"+$_+":"+$S;$j="https:"==$m.window.location.protocol?"wss://"+$_+":"+$S:"ws://"+$_+":"+$S,this.connectByUrl($j)},$S.connectByUrl=function($_){var $S=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $m.window.WebSocket($_,this.protocols):this._socket=new $m.window.WebSocket($_),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($_){$S._onOpen($_)},this._socket.onmessage=function($_){$S._onMessage($_)},this._socket.onclose=function($_){$S._onClose($_)},this._socket.onerror=function($_){$S._onError($_)}},$S.cleanSocket=function(){try{this._socket.close()}catch($_){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$S.close=function(){if(null!=this._socket)try{this._socket.close()}catch($_){}},$S._onOpen=function($_){this._connected=!0,this.event("open",$_)},$S._onMessage=function($_){if($_&&$_.data){var $S=$_.data;if(this.disableInput&&$S)this.event("message",$S);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $j=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$S&&("string"==typeof $S?this._input.writeUTFBytes($S):this._input.writeArrayBuffer($S),this._addInputPosition=this._input.pos,this._input.pos=$j),this.event("message",$S)}}},$S._onClose=function($_){this._connected=!1,this.event("close",$_)},$S._onError=function($_){this.event("error",$_)},$S.send=function($_){this._socket.send($_)},$S.flush=function(){if(this._output&&0<this._output.length){var $S;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($_){$S=$_}this._output.endian=this.endian,this._output.clear(),$S&&this.event("error",$S)}},$c(0,$S,"input",function(){return this._input}),$c(0,$S,"output",function(){return this._output}),$c(0,$S,"connected",function(){return this._connected}),$c(0,$S,"endian",function(){return this._endian},function($_){this._endian=$_,null!=this._input&&(this._input.endian=$_),null!=this._output&&(this._output.endian=$_)}),$O.LITTLE_ENDIAN="littleEndian",$O.BIG_ENDIAN="bigEndian"}(),function($_){function $w(){$w.__super.call(this),this._$1__id=++$w._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($w._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$t.currentResourceManager&&$t.currentResourceManager.addResource(this)}$v($w,"laya.resource.Resource",$u);var $S=$w.prototype;return $f.imps($S,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$S._setUrl=function($_){var $S;this._url!==$_&&(this._url&&(($S=$w._urlResourcesMap[this._url]).splice($S.indexOf(this),1),0===$S.length&&delete $w._urlResourcesMap[this._url]),$_&&(($S=$w._urlResourcesMap[$_])||($w._urlResourcesMap[$_]=$S=[]),$S.push(this)),this._url=$_)},$S._getGroup=function(){return this._group},$S._setGroup=function($_){var $S;this._group!==$_&&(this._group&&(($S=$w._groupResourcesMap[this._group]).splice($S.indexOf(this),1),0===$S.length&&delete $w._groupResourcesMap[this._group]),$_&&(($S=$w._groupResourcesMap[$_])||($w._groupResourcesMap[$_]=$S=[]),$S.push(this)),this._group=$_)},$S._addReference=function(){this._referenceCount++},$S._removeReference=function(){this._referenceCount--},$S._clearReference=function(){this._referenceCount=0},$S._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$S.recreateResource=function(){this.completeCreate()},$S.disposeResource=function(){},$S.activeResource=function($_){void 0===$_&&($_=!1),this._lastUseFrameCount=$W.loopCount,!this._destroyed&&this.__loaded&&(this._released||$_)&&this.recreateResource()},$S.releaseResource=function($_){return void 0===$_&&($_=!0),!(!$_&&this.lock)&&(!(this._released&&!$_)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$S.onAsynLoaded=function($_,$S,$j){throw new Error("Resource: must override this function!")},$S.destroy=function(){var $_;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $w._idResourcesMap[this.id],this._url&&(($_=$w._urlResourcesMap[this._url])&&($_.splice($_.indexOf(this),1),0===$_.length&&delete $w._urlResourcesMap[this.url]),$w_.clearRes(this._url),this.__loaded||$d.cancelLoadByUrl(this._url)),this._group&&(($_=$w._groupResourcesMap[this._group]).splice($_.indexOf(this),1),0===$_.length&&delete $w._groupResourcesMap[this.url]))},$S.completeCreate=function(){this._released=!1,this.event("recovered",this)},$S.dispose=function(){this.destroy()},$c(0,$S,"memorySize",function(){return this._memorySize},function($_){var $S=$_-this._memorySize;this._memorySize=$_,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$S),this.resourceManager&&this.resourceManager.addSize($S)}),$c(0,$S,"_loaded",null,function($_){this.__loaded=$_}),$c(0,$S,"loaded",function(){return this.__loaded}),$c(0,$S,"id",function(){return this._$1__id}),$c(0,$S,"destroyed",function(){return this._destroyed}),$c(0,$S,"group",function(){return this._getGroup()},function($_){this._setGroup($_)}),$c(0,$S,"resourceManager",function(){return this._resourceManager}),$c(0,$S,"url",function(){return this._url}),$c(0,$S,"released",function(){return this._released}),$c(0,$S,"referenceCount",function(){return this._referenceCount}),$w.getResourceByID=function($_){return $w._idResourcesMap[$_]},$w.getResourceByURL=function($_,$S){return void 0===$S&&($S=0),null==$w._urlResourcesMap[$_]?null:$w._urlResourcesMap[$_][$S]},$w.getResourceCountByURL=function($_){return $w._urlResourcesMap[$_].length},$w.destroyUnusedResources=function($_){var $S;if($_){var $j=$w._groupResourcesMap[$_];if($j)for(var $O=$j.slice(),$V=0,$M=$O.length;$V<$M;$V++)($S=$O[$V]).lock||0!==$S._referenceCount||$S.destroy()}else for(var $R in $w._idResourcesMap)($S=$w._idResourcesMap[$R]).lock||0!==$S._referenceCount||$S.destroy()},$w._uniqueIDCounter=0,$w._idResourcesMap={},$w._urlResourcesMap={},$w._groupResourcesMap={},$w}()),$c_=function($_){function $g($_,$S){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$g.__super.call(this),$_&&null!=$_._addReference&&$_._addReference(),this.setTo($_,$S)}$v($g,"laya.resource.Texture",$u);var $S=$g.prototype;return $S._setUrl=function($_){this.url=$_},$S.setTo=function($_,$S){if($_ instanceof $R.HTMLElement){var $j=$k_.create("2D",$_);this.bitmap=$j}else this.bitmap=$_;if(this.uv=$S||$g.DEF_UV,$_){this._w=$_.width,this._h=$_.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $O=this;if(this._loaded)$d.addToAtlas&&$d.addToAtlas($O);else{var $V=$_;$V instanceof laya.resource.HTMLImage&&$V.image&&$V.image.addEventListener("load",function($_){$d.addToAtlas&&$d.addToAtlas($O)},!1)}}},$S.active=function(){this.bitmap&&this.bitmap.activeResource()},$S.destroy=function($_){if(void 0===$_&&($_=!1),this.alphaTexture&&(this.alphaTexture.destroy($_),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $S=this.bitmap;$_?($x.isConchApp&&$S.source&&$S.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$S.dispose(),$S._clearReference()):($S._removeReference(),0==$S.referenceCount&&($x.isConchApp&&$S.source&&$S.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$S.dispose())),this.url&&this===$f.loader.getRes(this.url)&&$f.loader.clearRes(this.url,$_),this._loaded=!1}},$S.load=function($_){var $S=this;this._loaded=!1,$_=$F.customFormat($_);var $j=this.bitmap||(this.bitmap=$A_.create($_));$j.uri=$_,$j&&$j._addReference();var $O=this;$j.onload=function(){$j.onload=null,$O._loaded=!0,$S.sourceWidth=$S._w=$j.width,$S.sourceHeight=$S._h=$j.height,$O.event("loaded",this),$d.addToAtlas&&$d.addToAtlas($O)}},$S.addTextureToAtlas=function($_){$d.addTextureToAtlas(this)},$S.getPixels=function($_,$S,$j,$O){if($x.isConchApp){var $V=this.bitmap;if($V.source&&$V.source.getImageData){var $M=$V.source.getImageData($_,$S,$j,$O),$R=new Uint8Array($M);return Array.from($R)}return null}return $x.isWebGL?$d.getTexturePixels(this,$_,$S,$j,$O):($m.canvas.size($j,$O),$m.canvas.clear(),$m.context.drawTexture(this,-$_,-$S,this.width,this.height,0,0),$m.context.getImageData(0,0,$j,$O).data)},$S.onAsynLoaded=function($_,$S){if($S){if("function"!=typeof $S._addReference)throw new Error("bitmap._addReference is not a function. "+$S.className+" "+typeof $S._addReference+" "+$S.constructor);$S._addReference()}this.setTo($S,this.uv),this._loaded&&this.event("loaded",this)},$c(0,$S,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$c(0,$S,"loaded",function(){return this._loaded}),$c(0,$S,"released",function(){return!this.bitmap||this.bitmap.released}),$c(0,$S,"width",function(){return this._w?this._w:this.uv&&this.uv!==$g.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($_){this._w=$_,this.sourceWidth||(this.sourceWidth=$_)}),$c(0,$S,"repeat",function(){return!$x.isWebGL||!this.bitmap||this.bitmap.repeat},function($_){$_&&$x.isWebGL&&this.bitmap&&(this.bitmap.repeat=$_)&&(this.bitmap.enableMerageInAtlas=!1)}),$c(0,$S,"height",function(){return this._h?this._h:this.uv&&this.uv!==$g.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($_){this._h=$_,this.sourceHeight||(this.sourceHeight=$_)}),$c(0,$S,"isLinearSampling",function(){return!$x.isWebGL||9728!=this.bitmap.minFifter},function($_){!$_&&$x.isWebGL&&($_||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$g.moveUV=function($_,$S,$j){for(var $O=0;$O<8;$O+=2)$j[$O]+=$_,$j[$O+1]+=$S;return $j},$g.create=function($_,$S,$j,$O,$V,$M,$R,$w,$a){void 0===$M&&($M=0),void 0===$R&&($R=0),void 0===$w&&($w=0),void 0===$a&&($a=0);var $u=$_ instanceof laya.resource.Texture,$c=$u?$_.uv:$g.DEF_UV,$q=$u?$_.bitmap:$_,$s=$d.isAtlas($q);if($s){var $C=$q._atlaser,$i=$_._atlasID;if(-1==$i)throw new Error("create texture error");$q=$C._inAtlasTextureBitmapValue[$i],$c=$C._inAtlasTextureOriUVValue[$i]}var $v=new $g($q,null);$q.width&&$S+$O>$q.width&&($O=$q.width-$S),$q.height&&$j+$V>$q.height&&($V=$q.height-$j),$v.width=$O,$v.height=$V,$v.offsetX=$M,$v.offsetY=$R,$v.sourceWidth=$w||$O,$v.sourceHeight=$a||$V;var $Z=1/$q.width,$o=1/$q.height;$S*=$Z,$j*=$o,$O*=$Z,$V*=$o;var $l=$v.uv[0],$k=$v.uv[1],$z=$v.uv[4],$H=$v.uv[5],$A=$z-$l,$f=$H-$k,$y=$g.moveUV($c[0],$c[1],[$S,$j,$S+$O,$j,$S+$O,$j+$V,$S,$j+$V]);$v.uv=[$l+$y[0]*$A,$k+$y[1]*$f,$z-(1-$y[2])*$A,$k+$y[3]*$f,$z-(1-$y[4])*$A,$H-(1-$y[5])*$f,$l+$y[6]*$A,$H-(1-$y[7])*$f],$s&&$v.addTextureToAtlas();var $P=$q.scaleRate;return $P&&1!=$P?($v.sourceWidth/=$P,$v.sourceHeight/=$P,$v.width/=$P,$v.height/=$P,$v.scaleRate=$P,$v.offsetX/=$P,$v.offsetY/=$P):$v.scaleRate=1,$v},$g.createFromTexture=function($_,$S,$j,$O,$V){var $M=$_.scaleRate;1!=$M&&($S*=$M,$j*=$M,$O*=$M,$V*=$M);var $R=$P.TEMP.setTo($S-$_.offsetX,$j-$_.offsetY,$O,$V),$w=$R.intersection($g._rect1.setTo(0,0,$_.width,$_.height),$g._rect2);if(!$w)return null;var $a=$g.create($_,$w.x,$w.y,$w.width,$w.height,$w.x-$R.x,$w.y-$R.y,$O,$V);if($a.bitmap&&$a.bitmap._removeReference)return $a.bitmap._removeReference(),$a;var $u="bitmap:"+($a.bitmap?$a.bitmap.constructor?$a.bitmap.constructor.name:$a.bitmap.__className:"")+", url:"+($_.url+" | "+($a.bitmap?$a.bitmap.url:$_.url))+", x="+$S+",y="+$j+",width="+$O+",height="+$V+", result="+($w?$w.x+","+$w.y+","+$w.width+","+$w.height:"null")+", rect="+$R.x+","+$R.y+","+$R.width+","+$R.height;throw new Error("报错：bitmap._removeReference is not a function  "+$u)},$g.DEF_UV=[0,0,1,0,1,1,0,1],$g.INV_UV=[0,1,1,1,1,0,0,0],$g._rect1=new $P,$g._rect2=new $P,$g}(),$_=function($_){var $w;function $M(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$M.__super.call(this)}$v($M,"laya.utils.TimeLine",$u);var $S=$M.prototype;return $S.to=function($_,$S,$j,$O,$V){return void 0===$V&&($V=0),this._create($_,$S,$j,$O,$V,!0)},$S.from=function($_,$S,$j,$O,$V){return void 0===$V&&($V=0),this._create($_,$S,$j,$O,$V,!1)},$S._create=function($_,$S,$j,$O,$V,$M){var $R=$T.getItemByClass("tweenData",$w);return $R.isTo=$M,$R.type=0,$R.target=$_,$R.duration=$j,$R.data=$S,$R.startTime=this._startTime+$V,$R.endTime=$R.startTime+$R.duration,$R.ease=$O,this._startTime=Math.max($R.endTime,this._startTime),this._tweenDataList.push($R),this._startTimeSort=!0,this._endTimeSort=!0,this},$S.addLabel=function($_,$S){var $j=$T.getItemByClass("tweenData",$w);return $j.type=1,$j.data=$_,$j.endTime=$j.startTime=this._startTime+$S,this._labelDic||(this._labelDic={}),this._labelDic[$_]=$j,this._tweenDataList.push($j),this},$S.removeLabel=function($_){if(this._labelDic&&this._labelDic[$_]){var $S=this._labelDic[$_];if($S){var $j=this._tweenDataList.indexOf($S);-1<$j&&this._tweenDataList.splice($j,1)}delete this._labelDic[$_]}},$S.gotoTime=function($_){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $S,$j,$O,$V;for(var $M in this._firstTweenDic)if($j=this._firstTweenDic[$M])for(var $R in $j)$j.diyTarget.hasOwnProperty($R)&&($j.diyTarget[$R]=$j[$R]);for($M in this._tweenDic)($S=this._tweenDic[$M]).clear(),delete this._tweenDic[$M];if(this._index=0,this._gidIndex=0,this._currTime=$_,this._lastTime=$m.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$O=this._tweenDataList.concat(),$O.sort(function($_,$S){return $_.endTime>$S.endTime?1:$_.endTime<$S.endTime?-1:0})}else $O=this._endTweenDataList;for(var $w=0,$a=$O.length;$w<$a;$w++)if(0==($V=$O[$w]).type){if(!($_>=$V.endTime))break;this._index=Math.max(this._index,$w+1);var $u=$V.data;if($V.isTo)for(var $c in $u)$V.target[$c]=$u[$c]}for($w=0,$a=this._tweenDataList.length;$w<$a;$w++)0==($V=this._tweenDataList[$w]).type&&$_>=$V.startTime&&$_<$V.endTime&&(this._index=Math.max(this._index,$w+1),this._gidIndex++,($S=$T.getItemByClass("tween",$I))._create($V.target,$V.data,$V.duration,$V.ease,$l.create(this,this._animComplete,[this._gidIndex]),0,!1,$V.isTo,!0,!1),$S.setStartTime(this._currTime-($_-$V.startTime)),$S._updateEase(this._currTime),$S.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$S)}},$S.gotoLabel=function($_){if(null!=this._labelDic){var $S=this._labelDic[$_];$S&&this.gotoTime($S.startTime)}},$S.pause=function(){$f.timer.clear(this,this._update)},$S.resume=function(){this.play(this._currTime,this._loopKey)},$S.play=function($_,$S){if(void 0===$_&&($_=0),void 0===$S&&($S=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($_,$S){return $_.startTime>$S.startTime?1:$_.startTime<$S.startTime?-1:0});for(var $j=0,$O=this._tweenDataList.length;$j<$O;$j++){var $V=this._tweenDataList[$j];if(null!=$V&&0==$V.type){var $M=$V.target,$R=$M.$_GID||($M.$_GID=$K.getGID()),$w=null;for(var $a in null==this._firstTweenDic[$R]?(($w={}).diyTarget=$M,this._firstTweenDic[$R]=$w):$w=this._firstTweenDic[$R],$V.data)null==$w[$a]&&($w[$a]=$M[$a])}}}"string"==typeof $_?this.gotoLabel($_):this.gotoTime($_),this._loopKey=$S,this._lastTime=$m.now(),$f.timer.frameLoop(1,this,this._update)}},$S._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $_ in this._tweenDic)($S=this._tweenDic[$_]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $S,$j=$m.now(),$O=$j-this._lastTime,$V=this._currTime+=$O*this.scale;for($_ in this._lastTime=$j,this._tweenDic)($S=this._tweenDic[$_])._updateEase($V);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $M=this._tweenDataList[this._index];$V>=$M.startTime&&(this._index++,0==$M.type?(this._gidIndex++,($S=$T.getItemByClass("tween",$I))._create($M.target,$M.data,$M.duration,$M.ease,$l.create(this,this._animComplete,[this._gidIndex]),0,!1,$M.isTo,!0,!1),$S.setStartTime($V),$S.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$S)._updateEase($V)):this.event("label",$M.data))}},$S._animComplete=function($_){this._tweenDic[$_]&&delete this._tweenDic[$_]},$S._complete=function(){this.event("complete")},$S.reset=function(){var $_;if(this._labelDic)for($_ in this._labelDic)delete this._labelDic[$_];for($_ in this._tweenDic)this._tweenDic[$_].clear(),delete this._tweenDic[$_];for($_ in this._firstTweenDic)delete this._firstTweenDic[$_];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $S,$j=0;for($S=this._tweenDataList.length,$j=0;$j<$S;$j++)this._tweenDataList[$j]&&this._tweenDataList[$j].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$f.timer.clear(this,this._update)},$S.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$c(0,$S,"index",function(){return this._frameIndex},function($_){this._frameIndex=$_,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$c(0,$S,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$M.to=function($_,$S,$j,$O,$V){return void 0===$V&&($V=0),(new $M).to($_,$S,$j,$O,$V)},$M.from=function($_,$S,$j,$O,$V){return void 0===$V&&($V=0),(new $M).from($_,$S,$j,$O,$V)},$M.__init$=function(){$w=function(){function $_(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $v($_,""),$_.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$T.recover("tweenData",this)},$_}()},$M}(),$q_=function($V){function $j(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$j.__super.call(this),this._style=$w.EMPTY}$v($j,"laya.display.Sprite",$V);var $_=$j.prototype;return $f.imps($_,{"laya.display.ILayout":!0}),$_.createConchModel=function(){return new ConchNode},$_.destroy=function($_){if(void 0===$_&&($_=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $S=this.mask;$S&&(this.mask=null,$S.destroy($_))}$V.prototype.destroy.call(this,$_),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$_.updateZOrder=function(){$K.updateOrder(this._childs)&&this.repaint()},$_.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$_.setBounds=function($_){this._set$P("uBounds",$_)},$_.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $P),$P._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$_.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $P),$P._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$_._boundPointsToParent=function($_){void 0===$_&&($_=!1);var $S=0,$j=0;this._style&&($S=this._style._tf.translateX,$j=this._style._tf.translateY,$_=$_||0!==this._style._tf.rotate,this._style.scrollRect&&($S+=this._style.scrollRect.x,$j+=this._style.scrollRect.y));var $O=this._getBoundPointsM($_);if(!$O||$O.length<1)return $O;if(8!=$O.length&&($O=$_?$H.scanPList($O):$P._getWrapRec($O,$P.TEMP)._getBoundPoints()),!this.transform)return $K.transPointList($O,this._x-$S,this._y-$j),$O;var $V=$y.TEMP,$M=0,$R=$O.length;for($M=0;$M<$R;$M+=2)$V.x=$O[$M],$V.y=$O[$M+1],this.toParentPoint($V),$O[$M]=$V.x,$O[$M+1]=$V.y;return $O},$_.getGraphicBounds=function($_){return void 0===$_&&($_=!1),this._graphics?this._graphics.getBounds($_):$P.TEMP.setTo(0,0,0,0)},$_._getBoundPointsM=function($_){if(void 0===$_&&($_=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $S=$K.clearArray(this._$P.temBM),$j=$P.TEMP;return $j.copyFrom(this.scrollRect),$K.concatArray($S,$j._getBoundPoints()),$S}for(var $O,$V,$M,$R=this._graphics?this._graphics.getBoundPoints():$K.clearArray(this._$P.temBM),$w=0,$a=($M=this._childs).length;$w<$a;$w++)($O=$M[$w])instanceof laya.display.Sprite&&1==$O.visible&&($V=$O._boundPointsToParent($_))&&($R=$R?$K.concatArray($R,$V):$V);return $R},$_.getStyle=function(){return this._style===$w.EMPTY&&(this._style=new $w),this._style},$_.setStyle=function($_){this._style=$_},$_._adjustTransform=function(){this._tfChanged=!1;var $_,$S=this._style._tf,$j=$S.scaleX,$O=$S.scaleY;if($S.rotate||1!==$j||1!==$O||$S.skewX||$S.skewY){($_=this._transform||(this._transform=$n.create())).bTransform=!0;var $V=.0174532922222222*($S.rotate-$S.skewX),$M=.0174532922222222*($S.rotate+$S.skewY),$R=Math.cos($M),$w=Math.sin($M),$a=Math.sin($V),$u=Math.cos($V);return $_.a=$j*$R,$_.b=$j*$w,$_.c=-$O*$a,$_.d=$O*$u,$_.tx=$_.ty=0,$_}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$_},$_.pos=function($_,$S,$j){if(void 0===$j&&($j=!1),this._x!==$_||this._y!==$S){if(this.destroyed)return this;if($j){this._x=$_,this._y=$S,this.conchModel&&this.conchModel.pos(this._x,this._y);var $O=this._parent;$O&&0===$O._repaint&&($O._repaint=1,$O.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$_,this.y=$S}return this},$_.pivot=function($_,$S){return this.pivotX=$_,this.pivotY=$S,this},$_.size=function($_,$S){return this.width=$_,this.height=$S,this},$_.scale=function($_,$S,$j){void 0===$j&&($j=!1);var $O=this.getStyle(),$V=$O._tf;if($V.scaleX!=$_||$V.scaleY!=$S){if(this.destroyed)return this;if($j){$O.setScale($_,$S),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($_,$S),this._renderType|=4;var $M=this._parent;$M&&0===$M._repaint&&($M._repaint=1,$M.parentRepaint())}else this.scaleX=$_,this.scaleY=$S}return this},$_.skew=function($_,$S){return this.skewX=$_,this.skewY=$S,this},$_.render=function($_,$S,$j){$W.spriteCount++,$N.renders[this._renderType]._fun(this,$_,$S+this._x,$j+this._y),this._repaint=0},$_.drawToCanvas=function($_,$S,$j,$O){if($x.isConchNode){var $V=$k_.create("2D");return new $h($_,$S,$V).ctx.setCanvasType(1),this.conchModel.drawToCanvas($V.source,$j,$O),$V}return $d.drawToCanvas(this,this._renderType,$_,$S,$j,$O)},$_.customRender=function($_,$S,$j){this._renderType|=1024},$_._applyFilters=function(){var $_;if(!$x.isWebGL&&(($_=this._$P.filters)&&!($_.length<1)))for(var $S=0,$j=$_.length;$S<$j;$S++)$_[$S].action.apply(this._$P.cacheCanvas)},$_._isHaveGlowFilter=function(){var $_,$S=0;if(this.filters)for($S=0;$S<this.filters.length;$S++)if(8==this.filters[$S].type)return!0;for($S=0,$_=this._childs.length;$S<$_;$S++)if(this._childs[$S]._isHaveGlowFilter())return!0;return!1},$_.localToGlobal=function($_,$S){void 0===$S&&($S=!1),!0===$S&&($_=new $y($_.x,$_.y));for(var $j=this;$j&&$j!=$f.stage;)$_=$j.toParentPoint($_),$j=$j.parent;return $_},$_.globalToLocal=function($_,$S){void 0===$S&&($S=!1),$S&&($_=new $y($_.x,$_.y));for(var $j=this,$O=[];$j&&$j!=$f.stage;)$O.push($j),$j=$j.parent;for(var $V=$O.length-1;0<=$V;)$_=($j=$O[$V]).fromParentPoint($_),$V--;return $_},$_.toParentPoint=function($_){if(!$_)return $_;$_.x-=this.pivotX,$_.y-=this.pivotY,this.transform&&this._transform.transformPoint($_),$_.x+=this._x,$_.y+=this._y;var $S=this._style.scrollRect;return $S&&($_.x-=$S.x,$_.y-=$S.y),$_},$_.fromParentPoint=function($_){if(!$_)return $_;$_.x-=this._x,$_.y-=this._y;var $S=this._style.scrollRect;return $S&&($_.x+=$S.x,$_.y+=$S.y),this.transform&&this._transform.invertTransformPoint($_),$_.x+=this.pivotX,$_.y+=this.pivotY,$_},$_.on=function($_,$S,$j,$O){return 1!==this._mouseEnableState&&this.isMouseEvent($_)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($_,$S,$j,$O,!1)):$V.prototype.on.call(this,$_,$S,$j,$O)},$_.once=function($_,$S,$j,$O){return 1!==this._mouseEnableState&&this.isMouseEvent($_)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($_,$S,$j,$O,!0)):$V.prototype.once.call(this,$_,$S,$j,$O)},$_._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $_=this;for($_=$_.parent;$_&&1!==$_._mouseEnableState&&!$_._getBit(2);)$_.mouseEnabled=!0,$_._setBit(2,!0),$_=$_.parent}},$_.loadImage=function($_,$S,$j,$O,$V,$M){var $R=this;return void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),this.graphics.loadImage($_,$S,$j,$O,$V,function($_){$R.destroyed||($R.size($S+($O||$_.width),$j+($V||$_.height)),$R.repaint(),$M&&$M.runWith($_))}),this},$_.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$_._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$_._childChanged=function($_){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$_&&this._get$P("hasZorder")&&$f.timer.callLater(this,this.updateZOrder),this.repaint()},$_.parentRepaint=function(){var $_=this._parent;$_&&0===$_._repaint&&($_._repaint=1,$_.parentRepaint())},$_.startDrag=function($_,$S,$j,$O,$V,$M,$R){void 0===$S&&($S=!1),void 0===$j&&($j=0),void 0===$O&&($O=300),void 0===$M&&($M=!1),void 0===$R&&($R=.92),this._$P.dragging||this._set$P("dragging",new $U),this._$P.dragging.start(this,$_,$S,$j,$O,$V,$M,$R)},$_.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$_._releaseMem=function(){if(this._$P){var $_=this._$P.cacheCanvas;$_&&$_.ctx&&($T.recover("RenderContext",$_.ctx),$_.ctx.canvas.size(0,0),$_.ctx=null);var $S=this._$P._filterCache;$S&&($S.destroy(),$S.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$_._setDisplay=function($_){$_||this._releaseMem(),$V.prototype._setDisplay.call(this,$_)},$_.hitTestPoint=function($_,$S){var $j=this.globalToLocal($y.TEMP.setTo($_,$S));return $_=$j.x,$S=$j.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$P.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($_,$S)},$_.getMousePoint=function(){return this.globalToLocal($y.TEMP.setTo($f.stage.mouseX,$f.stage.mouseY))},$_._getWords=function(){return null},$_._addChildsToLayout=function($_){var $S=this._getWords();if(null==$S&&0==this._childs.length)return!1;if($S)for(var $j=0,$O=$S.length;$j<$O;$j++)$_.push($S[$j]);$j=0;for(var $V=this._childs.length;$j<$V;++$j){var $M=this._childs[$j];$M._style._enableLayout()&&$M._addToLayout($_)}return!0},$_._addToLayout=function($_){this._style.absolute||(this._style.block?$_.push(this):this._addChildsToLayout($_)&&(this.x=this.y=0))},$_._isChar=function(){return!1},$_._getCSSStyle=function(){return this._style.getCSSStyle()},$_._setAttributes=function($_,$S){switch($_){case"x":this.x=parseFloat($S);break;case"y":this.y=parseFloat($S);break;case"width":this.width=parseFloat($S);break;case"height":this.height=parseFloat($S);break;default:this[$_]=$S}},$_._layoutLater=function(){this.parent&&this.parent._layoutLater()},$c(0,$_,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($_){this._optimizeScrollRect!=$_&&(this._optimizeScrollRect=$_,this.conchModel&&this.conchModel.optimizeScrollRect($_))}),$c(0,$_,"customRenderEnable",null,function($_){if($_&&(this._renderType|=1024,$x.isConchNode)){$j.CustomList.push(this);var $S=new $k_("2d");$S._setContext(new CanvasRenderingContext2D),this.customContext=new $h(0,0,$S),$S.context.setCanvasType&&$S.context.setCanvasType(2),this.conchModel.custom($S.context)}}),$c(0,$_,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($_){this.cacheAs=$_?this._$P.hasFilter?"none":"normal":"none"}),$c(0,$_,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($_){var $S=this._$P.cacheCanvas;if($_!==($S?$S.type:"none")){if("none"!==$_)this._getBit(1)||this._setUpNoticeType(1),$S||($S=this._set$P("cacheCanvas",$T.getItemByClass("cacheCanvas",Object))),$S.type=$_,$S.reCache=!0,this._renderType|=16,"bitmap"==$_&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($S){var $j=$S;$j&&$j.ctx&&($T.recover("RenderContext",$j.ctx),$j.ctx.canvas.size(0,0),$j.ctx=null),$T.recover("cacheCanvas",$S)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$c(0,$_,"zOrder",function(){return this._zOrder},function($_){this._zOrder!=$_&&(this._zOrder=$_,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($_),this._parent&&($_&&this._parent._set$P("hasZorder",!0),$f.timer.callLater(this._parent,this.updateZOrder)))}),$c(0,$_,"rotation",function(){return this._style._tf.rotate},function($_){var $S=this.getStyle();if($S._tf.rotate!==$_){$S.setRotate($_),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($_),this._renderType|=4;var $j=this._parent;$j&&0===$j._repaint&&($j._repaint=1,$j.parentRepaint())}}),$c(0,$_,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($_){this._width!==$_&&(this._width=$_,this.conchModel&&this.conchModel.size($_,this._height),this.repaint())}),$c(0,$_,"x",function(){return this._x},function($_){if(this._x!==$_){if(this.destroyed)return;this._x=$_,this.conchModel&&this.conchModel.pos($_,this._y);var $S=this._parent;$S&&0===$S._repaint&&($S._repaint=1,$S.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$c(0,$_,"globalScaleY",function(){for(var $_=1,$S=this;$S&&$S!==$f.stage;)$_*=$S.scaleY,$S=$S.parent;return $_}),$c(0,$_,"hitArea",function(){return this._$P.hitArea},function($_){this._set$P("hitArea",$_)}),$c(0,$_,"staticCache",function(){return this._$P.staticCache},function($_){this._set$P("staticCache",$_),$_||this.reCache()}),$c(0,$_,"texture",function(){return this._texture},function($_){this._texture!=$_&&(this._texture=$_,this.graphics.cleanByTexture($_,0,0))}),$c(0,$_,"y",function(){return this._y},function($_){if(this._y!==$_){if(this.destroyed)return;this._y=$_,this.conchModel&&this.conchModel.pos(this._x,$_);var $S=this._parent;$S&&0===$S._repaint&&($S._repaint=1,$S.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$c(0,$_,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($_){this._height!==$_&&(this._height=$_,this.conchModel&&this.conchModel.size(this._width,$_),this.repaint())}),$c(0,$_,"blendMode",function(){return this._style.blendMode},function($_){this.getStyle().blendMode=$_,this.conchModel&&this.conchModel.blendMode($_),$_&&"source-over"!=$_?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$c(0,$_,"scaleX",function(){return this._style._tf.scaleX},function($_){var $S=this.getStyle();if($S._tf.scaleX!==$_){$S.setScaleX($_),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($_,$S._tf.scaleY),this._renderType|=4;var $j=this._parent;$j&&0===$j._repaint&&($j._repaint=1,$j.parentRepaint())}}),$c(0,$_,"scaleY",function(){return this._style._tf.scaleY},function($_){var $S=this.getStyle();if($S._tf.scaleY!==$_){$S.setScaleY($_),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($S._tf.scaleX,$_),this._renderType|=4;var $j=this._parent;$j&&0===$j._repaint&&($j._repaint=1,$j.parentRepaint())}}),$c(0,$_,"stage",function(){return $f.stage}),$c(0,$_,"skewX",function(){return this._style._tf.skewX},function($_){var $S=this.getStyle();if($S._tf.skewX!==$_){$S.setSkewX($_),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($_,$S._tf.skewY),this._renderType|=4;var $j=this._parent;$j&&0===$j._repaint&&($j._repaint=1,$j.parentRepaint())}}),$c(0,$_,"scrollRect",function(){return this._style.scrollRect},function($_){this.getStyle().scrollRect=$_,this.repaint(),$_?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($_.x,$_.y,$_.width,$_.height)):(this._renderType&=-129,this.conchModel&&($j.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$c(0,$_,"skewY",function(){return this._style._tf.skewY},function($_){var $S=this.getStyle();if($S._tf.skewY!==$_){$S.setSkewY($_),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($S._tf.skewX,$_),this._renderType|=4;var $j=this._parent;$j&&0===$j._repaint&&($j._repaint=1,$j.parentRepaint())}}),$c(0,$_,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($_){this._tfChanged=!1,(this._transform=$_)&&(this._x=$_.tx,this._y=$_.ty,$_.tx=$_.ty=0,this.conchModel&&this.conchModel.transform($_.a,$_.b,$_.c,$_.d,this._x,this._y)),$_?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$c(0,$_,"pivotX",function(){return this._style._tf.translateX},function($_){this.getStyle().setTranslateX($_),this.conchModel&&this.conchModel.pivot($_,this._style._tf.translateY),this.repaint()}),$c(0,$_,"pivotY",function(){return this._style._tf.translateY},function($_){this.getStyle().setTranslateY($_),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$_),this.repaint()}),$c(0,$_,"alpha",function(){return this._style.alpha},function($_){this._style&&this._style.alpha!==$_&&($_=$_<0?0:1<$_?1:$_,this.getStyle().alpha=$_,this.conchModel&&this.conchModel.alpha($_),1!==$_?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$c(0,$_,"visible",function(){return this._style.visible},function($_){this._style&&this._style.visible!==$_&&(this.getStyle().visible=$_,this.conchModel&&this.conchModel.visible($_),this.parentRepaint())}),$c(0,$_,"graphics",function(){return this._graphics||(this.graphics=$d.createGraphics())},function($_){this._graphics&&(this._graphics._sp=null),(this._graphics=$_)?(this._renderType&=-2,this._renderType|=512,($_._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($j.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$c(0,$_,"filters",function(){return this._$P.filters},function($_){$_&&0===$_.length&&($_=null),this._$P.filters!=$_&&(this._set$P("filters",$_?$_.slice():null),$x.isConchApp&&(this.conchModel&&($j.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$x.isWebGL&&($_&&$_.length?this._renderType|=32:this._renderType&=-33),$_&&0<$_.length?(this._getBit(1)||this._setUpNoticeType(1),$x.isWebGL&&1==$_.length&&$_[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($x.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$c(0,$_,"parent",$V.prototype._$get_parent,function($_){$f.superSet($__,this,"parent",$_),$_&&this._getBit(2)&&this._$2__onDisplay()}),$c(0,$_,"mask",function(){return this._$P._mask},function($_){$_&&this.mask&&this.mask._$P.maskParent||($_?(this.cacheAs="bitmap",this._set$P("_mask",$_),$_._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$_),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($_?$_.conchModel:null),this._renderType|=64,this.parentRepaint())}),$c(0,$_,"mouseEnabled",function(){return 1<this._mouseEnableState},function($_){this._mouseEnableState=$_?2:1}),$c(0,$_,"globalScaleX",function(){for(var $_=1,$S=this;$S&&$S!==$f.stage;)$_*=$S.scaleX,$S=$S.parent;return $_}),$c(0,$_,"mouseX",function(){return this.getMousePoint().x}),$c(0,$_,"mouseY",function(){return this.getMousePoint().y}),$j.fromImage=function($_){return(new $j).loadImage($_)},$j._cachePool=[],$j.CustomList=[],$a($j,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$R.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$j}($__),$s_=function($_){function $S($_){this._audio=null,this._onEnd=null,this._resumePlay=null,$S.__super.call(this),this._onEnd=$K.bind(this.__onEnd,this),this._resumePlay=$K.bind(this.__resumePlay,this),$_.addEventListener("ended",this._onEnd),this._audio=$_}$v($S,"laya.media.h5audio.AudioSoundChannel",$O_);var $j=$S.prototype;return $j.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($f.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$j.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$m.container.appendChild(this._audio),this._audio.play()}catch($_){this.event("error")}},$j.play=function($_){this.isStopped=!1;try{this._audio.playbackRate=$$.playbackRate,this._audio.currentTime=this.startTime}catch($_){return void this._audio.addEventListener("canplay",this._resumePlay)}$$.addChannel(this),$m.container.appendChild(this._audio),!$_&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$j.stop=function(){this.isStopped=!0,$$.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$x.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$m.onIE||this._audio!=$j_._musicAudio&&$T.recover("audio:"+this.url,this._audio),$m.removeElement(this._audio),this._audio=null)},$j.pause=function(){this.isStopped=!0,$$.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$j.resume=function(){this._audio&&(this.isStopped=!1,$$.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$c(0,$j,"position",function(){return this._audio?this._audio.currentTime:0}),$c(0,$j,"duration",function(){return this._audio?this._audio.duration:0}),$c(0,$j,"volume",function(){return this._audio?this._audio.volume:1},function($_){this._audio&&(this._audio.volume=$_)}),$S}(),$C_=function($_){function $S(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$M_.ctx,$S.__super.call(this),this._onPlayEnd=$K.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$v($S,"laya.media.webaudio.WebAudioSoundChannel",$O_);var $j=$S.prototype;return $j.play=function($_){if($$.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $S=this.context,$j=this.gain,$O=$S.createBufferSource();(this.bufferSource=$O).buffer=this.audioBuffer,$O.connect($j),$j&&$j.disconnect(),$j.connect($S.destination),$O.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$m.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($O.loop=!0),$O.playbackRate.setTargetAtTime?$O.playbackRate.setTargetAtTime($$.playbackRate,this.context.currentTime,.1):$O.playbackRate.value=$$.playbackRate,$O.start(0,this.startTime),!$_&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$j.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($f.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$j._clearBufferSource=function(){if(this.bufferSource){var $_=this.bufferSource;$_.stop?$_.stop(0):$_.noteOff(0),$_.disconnect(0),$_.onended=null,$S._tryCleanFailed||this._tryClearBuffer($_),this.bufferSource=null}},$j._tryClearBuffer=function($_){try{$_.buffer=null}catch($_){$S._tryCleanFailed=!0}},$j.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$$.removeChannel(this),this.startHandler=null,this.completeHandler=null},$j.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$$.removeChannel(this)},$j.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$c(0,$j,"position",function(){return this.bufferSource?($m.now()-this._startTime)/1e3+this.startTime:0}),$c(0,$j,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$c(0,$j,"volume",function(){return this._volume},function($_){this.isStopped||(this._volume=$_,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($_,this.context.currentTime,.1):this.gain.gain.value=$_)}),$S._tryCleanFailed=!1,$S}(),$i_=function($_){function $S(){$S.__super.call(this),this._w=0,this._h=0}$v($S,"laya.resource.Bitmap",$u_);var $j=$S.prototype;return $c(0,$j,"width",function(){return this._w}),$c(0,$j,"height",function(){return this._h}),$c(0,$j,"source",function(){return this._source}),$S}(),$v_=function($S){function $_(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$_.__super.call(this),this._interval=$O.animationInterval,this._setUpNoticeType(1)}$v($_,"laya.display.AnimationPlayerBase",$S);var $j=$_.prototype;return $j.play=function($_,$S,$j,$O){void 0===$_&&($_=0),void 0===$S&&($S=!0),void 0===$j&&($j=""),void 0===$O&&($O=!0),this._isPlaying=!0,this.index="string"==typeof $_?this._getFrameByLabel($_):$_,this.loop=$S,this._actionName=$j,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$j._getFrameByLabel=function($_){var $S=0;for($S=0;$S<this._count;$S++)if(this._labels[$S]&&0<=this._labels[$S].indexOf($_))return $S;return 0},$j._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$j._setControlNode=function($_){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$_)&&$_!=this&&($_.on("display",this,this._checkResumePlaying),$_.on("undisplay",this,this._checkResumePlaying))},$j._setDisplay=function($_){$S.prototype._setDisplay.call(this,$_),this._checkResumePlaying()},$j._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$j.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$j.addLabel=function($_,$S){this._labels||(this._labels={}),this._labels[$S]||(this._labels[$S]=[]),this._labels[$S].push($_)},$j.removeLabel=function($_){if($_){if(this._labels)for(var $S in this._labels)this._removeLabelFromLabelList(this._labels[$S],$_)}else this._labels=null},$j._removeLabelFromLabelList=function($_,$S){if($_)for(var $j=$_.length-1;0<=$j;$j--)$_[$j]==$S&&$_.splice($j,1)},$j.gotoAndStop=function($_){this.index="string"==typeof $_?this._getFrameByLabel($_):$_,this.stop()},$j._displayToIndex=function($_){},$j.clear=function(){this.stop(),this._labels=null},$c(0,$j,"interval",function(){return this._interval},function($_){this._interval!=$_&&(this._frameRateChanged=!0,this._interval=$_,this._isPlaying&&0<$_&&this.timerLoop($_,this,this._frameLoop,null,!0,!0))}),$c(0,$j,"isPlaying",function(){return this._isPlaying}),$c(0,$j,"index",function(){return this._index},function($_){if(this._index=$_,this._displayToIndex($_),this._labels&&this._labels[$_])for(var $S=this._labels[$_],$j=0,$O=$S.length;$j<$O;$j++)this.event("label",$S[$j])}),$c(0,$j,"count",function(){return this._count}),$_.WRAP_POSITIVE=0,$_.WRAP_REVERSE=1,$_.WRAP_PINGPONG=2,$_}($q_),$Z_=function($S){function $C(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$C.__super.call(this),this.overflow=$C.VISIBLE,this._style=new $S_(this),this._style.wordWrap=!1}$v($C,"laya.display.Text",$S);var $_=$C.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$_._getBoundPointsM=function($_){void 0===$_&&($_=!1);var $S=$P.TEMP;return $S.setTo(0,0,this.width,this.height),$S._getBoundPoints()},$_.getGraphicBounds=function($_){void 0===$_&&($_=!1);var $S=$P.TEMP;return $S.setTo(0,0,this.width,this.height),$S},$_._getCSSStyle=function(){return this._style},$_.lang=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c){if($_=$C.langPacks&&$C.langPacks[$_]?$C.langPacks[$_]:$_,arguments.length<2)this._text=$_;else{for(var $q=0,$s=arguments.length;$q<$s;$q++)$_=$_.replace("{"+$q+"}",arguments[$q+1]);this._text=$_}},$_._isPassWordMode=function(){var $_=this._style.password;return"prompt"in this&&this.prompt==this._text&&($_=!1),$_},$_._getPassWordTxt=function($_){var $S;$S="";for(var $j=$_.length;0<$j;$j--)$S+="●";return $S},$_.renderText=function($_,$S){var $j=this.graphics;$j.clear(!0);var $O=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($m.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$m.context.font=$O;var $V=this.padding,$M=$V[3],$R="left",$w=this._lines,$a=this.leading+this._charSize.height,$u=this._currBitmapFont;$u&&($a=this.leading+$u.getMaxHeight());var $c=$V[0];if(!$u&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($R="right",$M=this._width-$V[1]):"center"==this.align&&($R="center",$M=.5*this._width+$V[3]-$V[1])),0<this._height){var $q=this._textHeight>this._height?"top":this.valign;"middle"===$q?$c=.5*(this._height-$S*$a)+$V[0]-$V[2]:"bottom"===$q&&($c=this._height-$S*$a-$V[2])}var $s=this._style;if($u&&$u.autoScaleSize)var $C=$u.fontSize/this.fontSize;if(this._clipPoint)if($j.save(),$u&&$u.autoScaleSize){var $i=0,$v=0;$i=this._width?this._width-$V[3]-$V[1]:this._textWidth,$v=this._height?this._height-$V[0]-$V[2]:this._textHeight,$i*=$C,$v*=$C,$j.clipRect($V[3],$V[0],$i,$v)}else $j.clipRect($V[3],$V[0],this._width?this._width-$V[3]-$V[1]:this._textWidth,this._height?this._height-$V[0]-$V[2]:this._textHeight);var $Z=$s.password;"prompt"in this&&this.prompt==this._text&&($Z=!1);for(var $o=0,$l=0,$k=Math.min(this._lines.length,$S+$_)||1,$z=$_;$z<$k;$z++){var $H,$A=$w[$z];if($Z){var $f=$A.length;$A="";for(var $y=$f;0<$y;$y--)$A+="●"}if($o=$M-(this._clipPoint?this._clipPoint.x:0),$l=$c+$a*$z-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($R,$o,$l,$z),$u){var $P=this.width;$u.autoScaleSize&&($P=this.width*$C),$u.drawText($A,this,$o,$l,this.align,$P)}else $x.isWebGL?(this._words||(this._words=[]),($H=this._words.length>$z-$_?this._words[$z-$_]:new $b).setText($A)):$H=$A,$s.stroke?$j.fillBorderText($H,$o,$l,$O,this.color,$s.strokeColor,$s.stroke,$R):$j.fillText($H,$o,$l,$O,this.color,$R)}if($u&&$u.autoScaleSize){var $g=1/$C;this.scale($g,$g)}this._clipPoint&&$j.restore(),this._startX=$M,this._startY=$c},$_.drawUnderline=function($_,$S,$j,$O){var $V=this._lineWidths[$O];switch($_){case"center":$S-=$V/2;break;case"right":$S-=$V}$j+=this._charSize.height,this._graphics.drawLine($S,$j,$S+$V,$j,this.underlineColor||this.color,1)},$_.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$m.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $y(0,0)):this._clipPoint=null;var $_=this._lines.length;if(this.overflow!=$C.VISIBLE){var $S=this.overflow==$C.HIDDEN?Math.floor:Math.ceil;$_=Math.min($_,$S((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $j=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($j,$_),this.repaint()},$_.evalTextSize=function(){var $_,$S=NaN;$_=Math.max.apply(this,this._lineWidths),$S=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$_==this._textWidth&&$S==this._textHeight||(this._textWidth=$_,this._textHeight=$S,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$_.checkEnabledViewportOrNot=function(){return this.overflow==$C.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$_.changeText=function($_){this._text!==$_&&(this.lang($_+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$_.parseLines=function($_){var $S=this.wordWrap||this.overflow==$C.HIDDEN;if($S)var $j=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $O=$K.contextMeasureText($C._testWord);$x.isConchApp&&0===$O.width&&0===$O.height&&($O=$K.contextMeasureText("W")),this._charSize.width=$O.width,this._charSize.height=$O.height||this.fontSize}for(var $V=$_.replace(/\r\n/g,"\n").split("\n"),$M=0,$R=$V.length;$M<$R;$M++){var $w=$V[$M];$S?this.parseLine($w,$j):(this._lineWidths.push(this.getTextWidth($w)),this._lines.push($w))}},$_.parseLine=function($_,$S){$m.context;var $j,$O=this._lines,$V=0,$M=NaN,$R=NaN,$w=0;if(($M=this.getTextWidth($_))<=$S)return $O.push($_),void this._lineWidths.push($M);$M=this._charSize.width,0==($V=Math.floor($S/$M))&&($V=1),$R=$M=this.getTextWidth($_.substring(0,$V));for(var $a=$V,$u=$_.length;$a<$u;$a++)if($S<($R+=$M=this.getTextWidth($_.charAt($a))))if(this.wordWrap){var $c=$_.substring($w,$a);if($c.charCodeAt($c.length-1)<255?($j=/(?:\w|-)+$/.exec($c))&&($a=$j.index+$w,0==$j.index?$a+=$c.length:$c=$_.substring($w,$a)):$C.RightToLeft&&($j=/([\u0600-\u06FF])+$/.exec($c))&&($a=$j.index+$w,0==$j.index?$a+=$c.length:$c=$_.substring($w,$a)),$O.push($c),this._lineWidths.push($R-$M),!(($w=$a)+$V<$u)){$O.push($_.substring($w,$u)),this._lineWidths.push(this.getTextWidth($O[$O.length-1])),$w=-1;break}$a+=$V,$R=$M=this.getTextWidth($_.substring($w,$a)),$a--}else if(this.overflow==$C.HIDDEN)return $O.push($_.substring(0,$a)),void this._lineWidths.push(this.getTextWidth($O[$O.length-1]));this.wordWrap&&-1!=$w&&($O.push($_.substring($w,$u)),this._lineWidths.push(this.getTextWidth($O[$O.length-1])))},$_.getTextWidth=function($_){return this._currBitmapFont?this._currBitmapFont.getTextWidth($_):$K.contextMeasureText($_).width},$_.getWordWrapWidth=function(){var $_=this.padding,$S=NaN;return($S=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($S=this.wordWrap?100:$m.width),$S<=0&&($S=100),$S-$_[3]-$_[1]},$_.getCharPoint=function($_,$S){this._isChanged&&$f.timer.runCallLater(this,this.typeset);for(var $j=0,$O=this._lines,$V=0,$M=0,$R=$O.length;$M<$R;$M++){if($_<($j+=$O[$M].length)){var $w=$M;break}$V=$j}var $a=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$m.context.font=$a;var $u=this.getTextWidth(this._text.substring($V,$_));return($S||new $y).setTo(this._startX+$u-(this._clipPoint?this._clipPoint.x:0),this._startY+$w*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$c(0,$_,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($_){$_!=this._width&&($f.superSet($q_,this,"width",$_),this.isChanged=!0)}),$c(0,$_,"textWidth",function(){return this._isChanged&&$f.timer.runCallLater(this,this.typeset),this._textWidth}),$c(0,$_,"height",function(){return this._height?this._height:this.textHeight},function($_){$_!=this._height&&($f.superSet($q_,this,"height",$_),this.isChanged=!0)}),$c(0,$_,"textHeight",function(){return this._isChanged&&$f.timer.runCallLater(this,this.typeset),this._textHeight}),$c(0,$_,"padding",function(){return this._getCSSStyle().padding},function($_){this._getCSSStyle().padding=$_,this.isChanged=!0}),$c(0,$_,"bold",function(){return this._getCSSStyle().bold},function($_){this._getCSSStyle().bold=$_,this.isChanged=!0}),$c(0,$_,"text",function(){return this._text||""},function($_){this._text!==$_&&(this.lang($_+""),this.isChanged=!0,this.event("change"))}),$c(0,$_,"color",function(){return this._getCSSStyle().color},function($_){this._getCSSStyle().color!=$_&&(this._getCSSStyle().color=$_,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$c(0,$_,"font",function(){return this._getCSSStyle().fontFamily},function($_){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$C._bitmapFonts&&$C._bitmapFonts[$_]&&(this._currBitmapFont=$C._bitmapFonts[$_]),this._getCSSStyle().fontFamily=$_,this.isChanged=!0}),$c(0,$_,"fontSize",function(){return this._getCSSStyle().fontSize},function($_){this._getCSSStyle().fontSize=$_,this.isChanged=!0}),$c(0,$_,"italic",function(){return this._getCSSStyle().italic},function($_){this._getCSSStyle().italic=$_,this.isChanged=!0}),$c(0,$_,"align",function(){return this._getCSSStyle().align},function($_){this._getCSSStyle().align=$_,this.isChanged=!0}),$c(0,$_,"valign",function(){return this._getCSSStyle().valign},function($_){this._getCSSStyle().valign=$_,this.isChanged=!0}),$c(0,$_,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($_){this._getCSSStyle().wordWrap=$_,this.isChanged=!0}),$c(0,$_,"leading",function(){return this._getCSSStyle().leading},function($_){this._getCSSStyle().leading=$_,this.isChanged=!0}),$c(0,$_,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($_){this._getCSSStyle().backgroundColor=$_,this.isChanged=!0}),$c(0,$_,"borderColor",function(){return this._getCSSStyle().borderColor},function($_){this._getCSSStyle().borderColor=$_,this.isChanged=!0}),$c(0,$_,"stroke",function(){return this._getCSSStyle().stroke},function($_){this._getCSSStyle().stroke=$_,this.isChanged=!0}),$c(0,$_,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($_){this._getCSSStyle().strokeColor=$_,this.isChanged=!0}),$c(0,$_,"isChanged",null,function($_){this._isChanged!==$_&&(this._isChanged=$_)&&$f.timer.callLater(this,this.typeset)}),$c(0,$_,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($_){if(!(this.overflow!=$C.SCROLL||this.textWidth<this._width)&&this._clipPoint){$_=$_<this.padding[3]?this.padding[3]:$_;var $S=this._textWidth-this._width;$_=$S<$_?$S:$_;var $j=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$_,this.renderText(this._lastVisibleLineIndex,$j)}}),$c(0,$_,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($_){if(!(this.overflow!=$C.SCROLL||this.textHeight<this._height)&&this._clipPoint){$_=$_<this.padding[0]?this.padding[0]:$_;var $S=this._textHeight-this._height,$j=($_=$S<$_?$S:$_)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$j;var $O=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$_,this.renderText($j,$O)}}),$c(0,$_,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$c(0,$_,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$c(0,$_,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$c(0,$_,"underlineColor",function(){return this._underlineColor},function($_){this._underlineColor=$_,this._isChanged=!0,this.typeset()}),$C.registerBitmapFont=function($_,$S){$C._bitmapFonts||($C._bitmapFonts={}),$C._bitmapFonts[$_]=$S},$C.unregisterBitmapFont=function($_,$S){if(void 0===$S&&($S=!0),$C._bitmapFonts&&$C._bitmapFonts[$_]){var $j=$C._bitmapFonts[$_];$S&&$j.destroy(),delete $C._bitmapFonts[$_]}},$C.setTextRightToLeft=function(){var $_;($_=$m.canvas.source.style).display="none",$_.position="absolute",$_.direction="rtl",$x._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$m.document.body.appendChild($m.canvas.source)},$C.supportFont=function($_){$m.context.font="10px sans-serif";var $S=$K.contextMeasureText("abcji").width;$m.context.font="10px "+$_;var $j=$K.contextMeasureText("abcji").width;return console.log($S,$j),$S!==$j},$C._testWord="游",$C.langPacks=null,$C.VISIBLE="visible",$C.SCROLL="scroll",$C.HIDDEN="hidden",$C.CharacterCache=!0,$C.RightToLeft=!1,$C._bitmapFonts=null,$a($C,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$C}($q_),$o_=function($q){function $R(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$R.__super.call(this),this.offset=new $y,this._canvasTransform=new $n,this._previousOrientation=$m.window.orientation;var $S=this;this.transform=$n.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $_=$m.window,$j=this;$_.addEventListener("focus",function(){$S._isFocused=!0,$j.event("focus"),$j.event("focuschange")}),$_.addEventListener("blur",function(){$S._isFocused=!1,$j.event("blur"),$j.event("focuschange"),$j._isInputting()&&($H_.inputElement.target.focus=!1)});var $O="visibilityState",$V="visibilitychange",$M=$_.document;void 0!==$M.hidden?($V="visibilitychange",$O="visibilityState"):void 0!==$M.mozHidden?($V="mozvisibilitychange",$O="mozVisibilityState"):void 0!==$M.msHidden?($V="msvisibilitychange",$O="msVisibilityState"):void 0!==$M.webkitHidden&&($V="webkitvisibilitychange",$O="webkitVisibilityState"),$_.document.addEventListener($V,function(){"hidden"==$m.document[$O]?$j._setStageVisible(!1):$j._setStageVisible(!0)}),$_.document.addEventListener("qbrowserVisibilityChange",function($_){$j._setStageVisible(!$_.hidden)}),$_.addEventListener("resize",function(){var $_=$m.window.orientation;null!=$_&&$_!=$S._previousOrientation&&$j._isInputting()&&($H_.inputElement.target.focus=!1),$S._previousOrientation=$_,$j._isInputting()||$j._resetCanvas()}),$_.addEventListener("orientationchange",function($_){$j._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$m.onMobile&&this.on("mousedown",this,this._onmouseMove)}$v($R,"laya.display.Stage",$q);var $_=$R.prototype;return $_._setStageVisible=function($_){this._isVisibility!=$_&&(this._isVisibility=$_,this._isVisibility||this._isInputting()&&($H_.inputElement.target.focus=!1),this.event("visibilitychange"))},$_._isInputting=function(){return $m.onMobile&&$H_.isInputting},$_._changeCanvasSize=function(){this.setScreenSize($m.clientWidth*$m.pixelRatio,$m.clientHeight*$m.pixelRatio)},$_._resetCanvas=function(){if(this.screenAdaptationEnabled){var $_=$x._mainCanvas;$_.source.style;$_.size(1,1),$f.timer.once(100,this,this._changeCanvasSize)}},$_.setScreenSize=function($_,$S){var $j=!1;if("none"!==this._screenMode&&($j=($_/$S<1?"vertical":"horizontal")!==this._screenMode)){var $O=$S;$S=$_,$_=$O}this.canvasRotation=$j;var $V=$x._mainCanvas,$M=$V.source.style,$R=this._canvasTransform.identity(),$w=this._scaleMode,$a=$_/this.designWidth,$u=$S/this.designHeight,$c=this.designWidth,$q=this.designHeight,$s=$_,$C=$S,$i=$m.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$w){case"noscale":$a=$u=1,$s=this.designWidth,$C=this.designHeight;break;case"showall":$a=$u=Math.min($a,$u),$c=$s=Math.round(this.designWidth*$a),$q=$C=Math.round(this.designHeight*$u);break;case"noborder":$a=$u=Math.max($a,$u),$s=Math.round(this.designWidth*$a),$C=Math.round(this.designHeight*$u);break;case"full":$a=$u=1,this._width=$c=$_,this._height=$q=$S;break;case"fixedwidth":$u=$a,this._height=$q=Math.round($S/$a);break;case"fixedheight":$a=$u,this._width=$c=Math.round($_/$u);break;case"fixedauto":$_/$S<this.designWidth/this.designHeight?($u=$a,this._height=$q=Math.round($S/$a)):($a=$u,this._width=$c=Math.round($_/$u))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$c=$c+1&2147483646,$q=$q+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$a*=this.scaleX,$u*=this.scaleY,1===$a&&1===$u?this.transform.identity():(this.transform.a=this._formatData($a/($s/$c)),this.transform.d=this._formatData($u/($C/$q)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$V.size($c,$q),$d.changeWebGLSize($c,$q),$R.scale($s/$c/$i,$C/$q/$i),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($_-$s)/$i:this.offset.x=.5*($_-$s)/$i,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($S-$C)/$i:this.offset.y=.5*($S-$C)/$i,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$R.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$j&&("horizontal"===this._screenMode?($R.rotate(Math.PI/2),$R.translate($S/$i,0),this.canvasDegree=90):($R.rotate(-Math.PI/2),$R.translate(0,$_/$i),this.canvasDegree=-90)),$R.a=this._formatData($R.a),$R.d=this._formatData($R.d),$R.tx=this._formatData($R.tx),$R.ty=this._formatData($R.ty),$M.transformOrigin=$M.webkitTransformOrigin=$M.msTransformOrigin=$M.mozTransformOrigin=$M.oTransformOrigin="0px 0px 0px",$M.transform=$M.webkitTransform=$M.msTransform=$M.mozTransform=$M.oTransform="matrix("+$R.toString()+")",$R.translate(parseInt($M.left)||0,parseInt($M.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$_._formatData=function($_){return Math.abs($_)<1e-6?0:Math.abs(1-$_)<.001?0<$_?1:-1:$_},$_.getMousePoint=function(){return $y.TEMP.setTo(this.mouseX,this.mouseY)},$_.repaint=function(){this._repaint=1},$_.parentRepaint=function(){},$_._loop=function(){return this.render($x.context,0,0),!0},$_._onmouseMove=function($_){this._mouseMoveTime=$m.now()},$_.getTimeFromFrameStart=function(){return $m.now()-this._frameStartTime},$_.render=function($_,$S,$j){if("sleep"===this._frameRate&&!$x.isConchApp){var $O=$m.now();if(!(1e3<=$O-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($W.loopCount++,$i.instance.runEvent(),$f.timer._update()));this._frameStartTime=$O}if(this._renderCount++,$x.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$m.now();var $V="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$M=this._renderCount%2==0;if($W.renderSlow=!$V,$V||$M||$x.isConchApp){var $R;$W.loopCount++,$i.instance.runEvent(),$f.timer._update(),$d.update3DLoop();var $w=0,$a=0;if($x.isConchNode)for($w=0,$a=this._scenes.length;$w<$a;$w++)($R=this._scenes[$w])&&$R._updateSceneConch();else for($w=0,$a=this._scenes.length;$w<$a;$w++)($R=this._scenes[$w])&&$R._updateScene();if($x.isConchNode){var $u=$q_.CustomList;for($w=0,$a=$u.length;$w<$a;$w++){var $c=$u[$w];$c.customRender($c.customContext,0,0)}return}}$x.isConchNode||this.renderingEnabled&&($V||!$M||$x.isConchWebGL)&&($x.isWebGL?$x.WebGL.mainContext&&!$x.WebGL.mainContext.isContextLost()&&($_.clear(),$q.prototype.render.call(this,$_,$S,$j),$W._show&&$W._sp&&$W._sp.render($_,$S,$j),$d.clear(this._bgColor),$d.beginFlush(),$_.flush(),$d.endFinish(),$X.instance&&$X.getInstance().endDispose()):($d.clear(this._bgColor),$q.prototype.render.call(this,$_,$S,$j),$W._show&&$W._sp&&$W._sp.render($_,$S,$j)))}else this._renderCount%5==0&&($W.loopCount++,$i.instance.runEvent(),$f.timer._update())},$_._requestFullscreen=function(){var $_=$m.document.documentElement;$_.requestFullscreen?$_.requestFullscreen():$_.mozRequestFullScreen?$_.mozRequestFullScreen():$_.webkitRequestFullscreen?$_.webkitRequestFullscreen():$_.msRequestFullscreen&&$_.msRequestFullscreen()},$_._fullScreenChanged=function(){$f.stage.event("fullscreenchange")},$_.exitFullscreen=function(){var $_=$m.document;$_.exitFullscreen?$_.exitFullscreen():$_.mozCancelFullScreen?$_.mozCancelFullScreen():$_.webkitExitFullscreen&&$_.webkitExitFullscreen()},$c(0,$_,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$c(0,$_,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$c(0,$_,"frameRate",function(){return this._frameRate},function($_){if(this._frameRate=$_,$x.isConchApp)switch(this._frameRate){case"slow":$m.window.conch&&$m.window.conchConfig.setSlowFrame&&$m.window.conchConfig.setSlowFrame(!0);break;case"fast":$m.window.conch&&$m.window.conchConfig.setSlowFrame&&$m.window.conchConfig.setSlowFrame(!1);break;case"mouse":$m.window.conch&&$m.window.conchConfig.setMouseFrame&&$m.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$m.window.conch&&$m.window.conchConfig.setLimitFPS&&$m.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$c(0,$_,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$c(0,$_,"width",$q.prototype._$get_width,function($_){this.designWidth=$_,$f.superSet($q_,this,"width",$_),$f.timer.callLater(this,this._changeCanvasSize)}),$c(0,$_,"alignH",function(){return this._alignH},function($_){this._alignH=$_,$f.timer.callLater(this,this._changeCanvasSize)}),$c(0,$_,"isFocused",function(){return this._isFocused}),$c(0,$_,"height",$q.prototype._$get_height,function($_){this.designHeight=$_,$f.superSet($q_,this,"height",$_),$f.timer.callLater(this,this._changeCanvasSize)}),$c(0,$_,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$n.create()},$q.prototype._$set_transform),$c(0,$_,"isVisibility",function(){return this._isVisibility}),$c(0,$_,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$c(0,$_,"scaleMode",function(){return this._scaleMode},function($_){this._scaleMode=$_,$f.timer.callLater(this,this._changeCanvasSize)}),$c(0,$_,"alignV",function(){return this._alignV},function($_){this._alignV=$_,$f.timer.callLater(this,this._changeCanvasSize)}),$c(0,$_,"bgColor",function(){return this._bgColor},function($_){this._bgColor=$_,this.conchModel&&this.conchModel.bgColor($_),$x.isWebGL&&($_?$R._wgColor=$L.create($_)._color:$m.onMiniGame||($R._wgColor=null)),$m.onLimixiu?$R._wgColor=$L.create($_)._color:$x.canvas.style.background=$_||"none"}),$c(0,$_,"mouseX",function(){return Math.round($i.instance.mouseX/this.clientScaleX)}),$c(0,$_,"mouseY",function(){return Math.round($i.instance.mouseY/this.clientScaleY)}),$c(0,$_,"screenMode",function(){return this._screenMode},function($_){this._screenMode=$_}),$c(0,$_,"visible",$q.prototype._$get_visible,function($_){this.visible!==$_&&($f.superSet($q_,this,"visible",$_),$x._mainCanvas.source.style.visibility=$_?"visible":"hidden")}),$c(0,$_,"fullScreenEnabled",null,function($_){var $S=$m.document,$j=$x.canvas;$_?($j.addEventListener("mousedown",this._requestFullscreen),$j.addEventListener("touchstart",this._requestFullscreen),$S.addEventListener("fullscreenchange",this._fullScreenChanged),$S.addEventListener("mozfullscreenchange",this._fullScreenChanged),$S.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$S.addEventListener("msfullscreenchange",this._fullScreenChanged)):($j.removeEventListener("mousedown",this._requestFullscreen),$j.removeEventListener("touchstart",this._requestFullscreen),$S.removeEventListener("fullscreenchange",this._fullScreenChanged),$S.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$S.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$S.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$R.SCALE_NOSCALE="noscale",$R.SCALE_EXACTFIT="exactfit",$R.SCALE_SHOWALL="showall",$R.SCALE_NOBORDER="noborder",$R.SCALE_FULL="full",$R.SCALE_FIXED_WIDTH="fixedwidth",$R.SCALE_FIXED_HEIGHT="fixedheight",$R.SCALE_FIXED_AUTO="fixedauto",$R.ALIGN_LEFT="left",$R.ALIGN_RIGHT="right",$R.ALIGN_CENTER="center",$R.ALIGN_TOP="top",$R.ALIGN_MIDDLE="middle",$R.ALIGN_BOTTOM="bottom",$R.SCREEN_NONE="none",$R.SCREEN_HORIZONTAL="horizontal",$R.SCREEN_VERTICAL="vertical",$R.FRAME_FAST="fast",$R.FRAME_SLOW="slow",$R.FRAME_MOUSE="mouse",$R.FRAME_SLEEP="sleep",$R.FRAME_MOUSE_THREDHOLD=2e3,$a($R,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$R}($q_),$l_=(function($_){function $S(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$S.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$v($S,"laya.media.SoundNode",$q_);var $j=$S.prototype;$j._onParentChange=function(){this.target=this.parent},$j.play=function($_,$S){void 0===$_&&($_=1),isNaN($_)&&($_=1),this.url&&(this.stop(),this._channel=$$.playSound(this.url,$_,null,$S))},$j.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$j._setPlayAction=function($_,$S,$j,$O){void 0===$O&&($O=!0),this[$j]&&$_&&($O?$_.on($S,this,this[$j]):$_.off($S,this,this[$j]))},$j._setPlayActions=function($_,$S,$j,$O){if(void 0===$O&&($O=!0),$_&&$S){var $V,$M=$S.split(","),$R=0;for($V=$M.length,$R=0;$R<$V;$R++)this._setPlayAction($_,$M[$R],$j,$O)}},$c(0,$j,"playEvent",null,function($_){(this._playEvents=$_)&&this._tar&&this._setPlayActions(this._tar,$_,"play")}),$c(0,$j,"target",null,function($_){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$_,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$c(0,$j,"stopEvent",null,function($_){(this._stopEvents=$_)&&this._tar&&this._setPlayActions(this._tar,$_,"stop")})}(),function($_){function $S(){this._src=null,this._onload=null,this._onerror=null,$S.__super.call(this)}$v($S,"laya.resource.FileBitmap",$i_);var $j=$S.prototype;return $c(0,$j,"src",function(){return this._src},function($_){this._src=$_}),$c(0,$j,"onload",null,function($_){}),$c(0,$j,"onerror",null,function($_){}),$S}()),$k_=function($_){function $j($_,$S){this._is2D=!1,$j.__super.call(this);var $O=this;if(this._source=this,"2D"===$_||"AUTO"===$_&&!$x.isWebGL){this._is2D=!0,this._source=$S||$m.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $V=this;$V.getContext=function($_,$S){if($O._ctx)return $O._ctx;var $j=$O._ctx=$O._source.getContext($_,$S);return $j&&($j._canvas=$V,$x.isFlash||$m.onLimixiu||($j.size=function($_,$S){})),$j}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$v($j,"laya.resource.HTMLCanvas",$i_);var $S=$j.prototype;return $S.clear=function(){this._ctx&&this._ctx.clear()},$S.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$S.release=function(){},$S._setContext=function($_){this._ctx=$_},$S.getContext=function($_,$S){return this._ctx?this._ctx:this._ctx=$j._createContext(this)},$S.getMemSize=function(){return 0},$S.size=function($_,$S){(this._w!=$_||this._h!=$S||this._source&&(this._source.width!=$_||this._source.height!=$S))&&(this._w=$_,this._h=$S,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($_,$S),this._source&&(this._source.height=$S,this._source.width=$_))},$S.getCanvas=function(){return this._source},$S.toBase64=function($_,$S,$j){if(this._source)if($x.isConchApp&&this._source.toBase64)this._source.toBase64($_,$S,$j);else{var $O=this._source.toDataURL($_,$S);$j.call(this,$O)}},$c(0,$S,"context",function(){return this._ctx}),$c(0,$S,"asBitmap",null,function($_){}),$j.create=function($_,$S){return new $j($_,$S)},$j.TYPE2D="2D",$j.TYPE3D="3D",$j.TYPEAUTO="AUTO",$j._createContext=null,$j}(),$z_=(function($_){function $a($_,$S,$j,$O,$V,$M,$R,$w){throw $a.__super.call(this),new Error("不允许new！")}$v($a,"laya.resource.HTMLSubImage",$i_),$a.create=function($_,$S,$j,$O,$V,$M,$R,$w){return void 0===$w&&($w=!1),new $a($_,$S,$j,$O,$V,$M,$R,$w)}}(),function($_){function $q(){this._frames=null,this._url=null,$q.__super.call(this),this._setControlNode(this)}$v($q,"laya.display.Animation",$_);var $S=$q.prototype;$S.destroy=function($_){void 0===$_&&($_=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$_),this._frames=null,this._labels=null},$S.play=function($_,$S,$j,$O){void 0===$_&&($_=0),void 0===$S&&($S=!0),void 0===$j&&($j=""),void 0===$O&&($O=!0),$j&&this._setFramesFromCache($j,$O),this._isPlaying=!0,this.index="string"==typeof $_?this._getFrameByLabel($_):$_,this.loop=$S,this._actionName=$j,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$S._setFramesFromCache=function($_,$S){var $j;return void 0===$S&&($S=!1),this._url&&($_=this._url+"#"+$_),$_&&$q.framesMap[$_]?(($j=$q.framesMap[$_])instanceof Array?(this._frames=$q.framesMap[$_],this._count=this._frames.length):($j.nodeRoot&&($q.framesMap[$_]=this._parseGraphicAnimationByData($j),$j=$q.framesMap[$_]),this._frames=$j.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$j.interval),this._labels=this._copyLabels($j.labels)),!0):($S&&console.log("ani not found:",$_),!1)},$S._copyLabels=function($_){if(!$_)return null;var $S,$j;for($j in $S={},$_)$S[$j]=$K.copyArray([],$_[$j]);return $S},$S._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$_.prototype._frameLoop.call(this)},$S._displayToIndex=function($_){this._frames&&(this.graphics=this._frames[$_])},$S.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$S.loadImages=function($_,$S){return void 0===$S&&($S=""),this._url="",this._setFramesFromCache($S)||(this.frames=$q.framesMap[$S]?$q.framesMap[$S]:$q.createFrames($_,$S)),this},$S.loadAtlas=function($S,$j,$O){void 0===$O&&($O=""),this._url="";var $V=this;function $_($_){$S===$_&&($V.frames=$q.framesMap[$O]?$q.framesMap[$O]:$q.createFrames($S,$O),$j&&$j.run())}return $V._setFramesFromCache($O)||($w_.getAtlas($S)?$_($S):$f.loader.load($S,$l.create(null,$_,[$S]),null,"atlas")),this},$S.loadAnimation=function($_,$S,$j){this._url=$_;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$S&&$S.run()):!$j||$w_.getAtlas($j)?this._loadAnimationData($_,$S,$j):$f.loader.load($j,$l.create(this,this._loadAnimationData,[$_,$S,$j]),null,"atlas"),this},$S._loadAnimationData=function($w,$a,$_){var $u=this;if(!$_||$w_.getAtlas($_)){var $c=this;$w_.getRes($w)?$S($w):$f.loader.load($w,$l.create(null,$S,[$w]),null,"json"),$w_.clearRes($w)}else console.warn("atlas load fail:"+$_);function $S($_){if($w_.getRes($_)&&$w===$_){var $S;if($q.framesMap[$w+"#"])$c._setFramesFromCache($u._actionName,!0),$u.index=0,$u._checkResumePlaying();else{var $j=$c._parseGraphicAnimation($w_.getRes($w));if(!$j)return;var $O,$V=$j.animationList,$M=0,$R=$V.length;for($M=0;$M<$R;$M++)$S=$V[$M],$q.framesMap[$w+"#"+$S.name]=$S,$O||($O=$S);$O&&($q.framesMap[$w+"#"]=$O,$c._setFramesFromCache($u._actionName,!0),$u.index=0),$u._checkResumePlaying()}$a&&$a.run()}}},$S._parseGraphicAnimation=function($_){return $f_.parseAnimationData($_)},$S._parseGraphicAnimationByData=function($_){return $f_.parseAnimationByData($_)},$c(0,$S,"frames",function(){return this._frames},function($_){(this._frames=$_)&&(this._count=$_.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$c(0,$S,"autoPlay",null,function($_){$_?this.play():this.stop()}),$c(0,$S,"source",null,function($_){-1<$_.indexOf(".ani")?this.loadAnimation($_):-1<$_.indexOf(".json")||-1<$_.indexOf("als")||-1<$_.indexOf("atlas")?this.loadAtlas($_):this.loadImages($_.split(","))}),$c(0,$S,"autoAnimation",null,function($_){this.play(0,!0,$_,!1)}),$q.createFrames=function($_,$S){var $j,$O,$V=0,$M=0;if("string"==typeof $_){var $R=$w_.getAtlas($_);if($R&&$R.length)for($j=[],$V=0,$M=$R.length;$V<$M;$V++)($O=new $d.createGraphics).drawTexture($w_.getRes($R[$V]),0,0),$j.push($O)}else if($_ instanceof Array)for($j=[],$V=0,$M=$_.length;$V<$M;$V++)($O=new $d.createGraphics).loadImage($_[$V],0,0),$j.push($O);return $S&&($q.framesMap[$S]=$j),$j},$q.clearCache=function($_){var $S,$j=$q.framesMap,$O=$_+"#";for($S in $j)$S!==$_&&0!=$S.indexOf($O)||delete $q.framesMap[$S]},$q.framesMap={}}($v_),function($_){function $M(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$M.__super.call(this),null==$M._sortIndexFun&&($M._sortIndexFun=$A.sortByKey("index",!1,!0))}$v($M,"laya.display.FrameAnimation",$_);var $S=$M.prototype;return $S._setUp=function($_,$S){this._labels=null,this._animationNewFrames=null,this._targetDic=$_,this._animationData=$S,this.interval=1e3/$S.frameRate,$S.parsed?(this._count=$S.count,this._labels=$S.labels,this._animationNewFrames=$S.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$S.parsed=!0,$S.labels=this._labels,$S.count=this._count,$S.animationNewFrames=this._animationNewFrames},$S.clear=function(){$_.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$S._displayToIndex=function($_){if(this._animationData){$_<0&&($_=0),$_>this._count&&($_=this._count);var $S=this._animationData.nodes,$j=0,$O=$S.length;for($j=0;$j<$O;$j++)this._displayNodeToFrame($S[$j],$_)}},$S._displayNodeToFrame=function($_,$S,$j){$j||($j=this._targetDic);var $O=$j[$_.target];if($O){var $V,$M,$R,$w=$_.frames,$a=$_.keys,$u=0,$c=$a.length;for($u=0;$u<$c;$u++)$R=($M=$w[$V=$a[$u]]).length>$S?$M[$S]:$M[$M.length-1],$O[$V]=$R}},$S._calculateDatas=function(){if(this._animationData){var $_,$S=this._animationData.nodes,$j=0,$O=$S.length;for($j=this._count=0;$j<$O;$j++)$_=$S[$j],this._calculateNodeKeyFrames($_);this._count+=1}},$S._calculateNodeKeyFrames=function($_){var $S,$j,$O=$_.keyframes,$V=$_.target;for($S in $_.frames||($_.frames={}),$_.keys?$_.keys.length=0:$_.keys=[],$_.initValues||($_.initValues={}),$O)$j=$O[$S],$_.frames[$S]||($_.frames[$S]=[]),this._targetDic&&this._targetDic[$V]&&($_.initValues[$S]=this._targetDic[$V][$S]),$j.sort($M._sortIndexFun),$_.keys.push($S),this._calculateNodePropFrames($j,$_.frames[$S],$S,$V)},$S.resetToInitState=function(){if(this._targetDic&&this._animationData){var $_,$S,$j=this._animationData.nodes,$O=0,$V=$j.length;for($O=0;$O<$V;$O++)if($S=($_=$j[$O]).initValues){var $M,$R=this._targetDic[$_.target];if($R)for($M in $S)$R[$M]=$S[$M]}}},$S._calculateNodePropFrames=function($_,$S,$j,$O){var $V=0,$M=$_.length-1;if(0<$M){for($S.length=$_[$M].index+1,$V=0;$V<$M;$V++)this._dealKeyFrame($_[$V]),this._calculateFrameValues($_[$V],$_[$V+1],$S);this._dealKeyFrame($_[$V])}0==$M&&($S[$_[0].index]=$_[0].value,this._animationNewFrames&&(this._animationNewFrames[$_[0].index]=!0))},$S._dealKeyFrame=function($_){$_.label&&""!=$_.label&&this.addLabel($_.label,$_.index)},$S._calculateFrameValues=function($_,$S,$j){var $O,$V=0,$M=$_.index,$R=$S.index,$w=$_.value,$a=$S.value-$_.value,$u=$R-$M;if($R>this._count&&(this._count=$R),$_.tween)for(null==($O=$Q[$_.tweenMethod])&&($O=$Q.linearNone),$V=$M;$V<$R;$V++)$j[$V]=$O($V-$M,$w,$a,$u),this._animationNewFrames&&(this._animationNewFrames[$V]=!0);else for($V=$M;$V<$R;$V++)$j[$V]=$w;this._animationNewFrames&&(this._animationNewFrames[$_.index]=!0,this._animationNewFrames[$S.index]=!0),$j[$S.index]=$S.value},$M._sortIndexFun=null,$M}($v_)),$H_=function($S){function $V(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$V.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$Z_.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$v($V,"laya.display.Input",$S);var $_=$V.prototype;return $_.setSelection=function($_,$S){this.focus=!0,laya.display.Input.inputElement.selectionStart=$_,laya.display.Input.inputElement.selectionEnd=$S},$_._onUnDisplay=function($_){this.focus=!1},$_._onMouseDown=function($_){this.focus=!0},$_._syncInputTransform=function(){var $_=this.nativeInput,$S=$K.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$j=this._width-this.padding[1]-this.padding[3],$O=this._height-this.padding[0]-this.padding[2];$x.isConchApp?($_.setScale($S.scaleX,$S.scaleY),$_.setSize($j,$O),$_.setPos($S.x,$S.y)):($V.inputContainer.style.transform=$V.inputContainer.style.webkitTransform="scale("+$S.scaleX+","+$S.scaleY+") rotate("+$f.stage.canvasDegree+"deg)",$_.style.width=$j+"px",$_.style.height=$O+"px",$V.inputContainer.style.left=$S.x+"px",$V.inputContainer.style.top=$S.y+"px")},$_.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$_._setInputMethod=function(){$V.input.parentElement&&$V.inputContainer.removeChild($V.input),$V.area.parentElement&&$V.inputContainer.removeChild($V.area),$V.inputElement=this._multiline?$V.area:$V.input,$V.inputContainer.appendChild($V.inputElement),$Z_.RightToLeft&&($V.inputElement.style.direction="rtl")},$_._focusIn=function(){laya.display.Input.isInputting=!0;var $_=this.nativeInput;this._focus=!0;var $S=$_.style;$S.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$_.readOnly=!this._editable,$x.isConchApp&&($_.setType(this._type),$_.setForbidEdit(!this._editable)),$_.maxLength=this._maxChars;this.padding;if($_.type=this._type,$_.value=this._content,$_.placeholder=this._prompt,$f.stage.off("keydown",this,this._onKeyDown),$f.stage.on("keydown",this,this._onKeyDown),($f.stage.focus=this).event("focus"),$m.onPC&&$_.focus(),!$m.onMiniGame){this._text;this._text=null}this.typeset(),$_.setColor(this._originColor),$_.setFontSize(this.fontSize),$_.setFontFace($m.onIPhone&&$Z_._fontFamilyMap[this.font]||this.font),$x.isConchApp&&$_.setMultiAble&&$_.setMultiAble(this._multiline),$S.lineHeight=this.leading+this.fontSize+"px",$S.fontStyle=this.italic?"italic":"normal",$S.fontWeight=this.bold?"bold":"normal",$S.textAlign=this.align,$S.padding="0 0",this._syncInputTransform(),!$x.isConchApp&&$m.onPC&&$f.timer.frameLoop(1,this,this._syncInputTransform)},$_._setPromptColor=function(){($V.promptStyleDOM=$m.getElementById("promptStyle"))||(($V.promptStyleDOM=$m.createElement("style")).setAttribute("id","promptStyle"),$m.document.head.appendChild($V.promptStyleDOM)),$V.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$_._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($f.superSet($Z_,this,"text",this._content),$f.superSet($Z_,this,"color",this._originColor)):($f.superSet($Z_,this,"text",this._prompt),$f.superSet($Z_,this,"color",this._promptColor)),$f.stage.off("keydown",this,this._onKeyDown),$f.stage.focus=null,this.event("blur"),$x.isConchApp&&this.nativeInput.blur(),$m.onPC&&$f.timer.clear(this,this._syncInputTransform)},$_._onKeyDown=function($_){13===$_.keyCode&&($m.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$_.changeText=function($_){this._content=$_,this._focus?(this.nativeInput.value=$_||"",this.event("change")):$S.prototype.changeText.call(this,$_)},$c(0,$_,"color",$S.prototype._$get_color,function($_){this._focus&&this.nativeInput.setColor($_),$f.superSet($Z_,this,"color",this._content?$_:this._promptColor),this._originColor=$_}),$c(0,$_,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($_){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$c(0,$_,"multiline",function(){return this._multiline},function($_){this._multiline=$_,this.valign=$_?"top":"middle"}),$c(0,$_,"maxChars",function(){return this._maxChars},function($_){$_<=0&&($_=1e5),this._maxChars=$_}),$c(0,$_,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($_){$f.superSet($Z_,this,"color",this._originColor),$_+="",this._focus?(this.nativeInput.value=$_||"",this.event("change")):(this._multiline||($_=$_.replace(/\r?\n/g,"")),(this._content=$_)?$f.superSet($Z_,this,"text",$_):($f.superSet($Z_,this,"text",this._prompt),$f.superSet($Z_,this,"color",this.promptColor)))}),$c(0,$_,"nativeInput",function(){return this._multiline?$V.area:$V.input}),$c(0,$_,"prompt",function(){return this._prompt},function($_){!this._text&&$_&&$f.superSet($Z_,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$f.superSet($Z_,this,"text",this._text==this._prompt?$_:this._text):$f.superSet($Z_,this,"text",$_),this._prompt=$Z_.langPacks&&$Z_.langPacks[$_]?$Z_.langPacks[$_]:$_}),$c(0,$_,"focus",function(){return this._focus},function($_){var $S=this.nativeInput;this._focus!==$_&&($_?($S.target?$S.target._focusOut():this._setInputMethod(),($S.target=this)._focusIn()):($S.target=null,this._focusOut(),$m.document.body.scrollTop=0,$S.blur(),$x.isConchApp?$S.setPos(-1e4,-1e4):$V.inputContainer.contains($S)&&$V.inputContainer.removeChild($S)))}),$c(0,$_,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($_){$_?(-1<($_="[^"+$_+"]").indexOf("^^")&&($_=$_.replace("^^","")),this._restrictPattern=new RegExp($_,"g")):this._restrictPattern=null}),$c(0,$_,"editable",function(){return this._editable},function($_){this._editable=$_,$x.isConchApp&&$V.input.setForbidEdit(!$_)}),$c(0,$_,"promptColor",function(){return this._promptColor},function($_){this._promptColor=$_,this._content||$f.superSet($Z_,this,"color",$_)}),$c(0,$_,"type",function(){return this._type},function($_){this._getCSSStyle().password="password"==$_,this._type=$_,$x.isConchApp&&this.nativeInput.setType($_)}),$c(0,$_,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($_){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$c(0,$_,"asPassword",function(){return this._getCSSStyle().password},function($_){this._getCSSStyle().password=$_,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$V.__init__=function(){$V._createInputElement(),$m.onMobile&&$x.canvas.addEventListener($V.IOS_IFRAME?$m.onMiniGame?"touchend":"click":"touchend",$V._popupInputMethod)},$V._popupInputMethod=function($_){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$V._createInputElement=function(){$V._initInput($V.area=$m.createElement("textarea")),$V._initInput($V.input=$m.createElement("input")),($V.inputContainer=$m.createElement("div")).style.position="absolute",$V.inputContainer.style.zIndex=1e5,$m.container.appendChild($V.inputContainer),$V.inputContainer.setPos=function($_,$S){$V.inputContainer.style.left=$_+"px",$V.inputContainer.style.top=$S+"px"}},$V._initInput=function($S){var $_=$S.style;$_.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$_.resize="none",$_.backgroundColor="transparent",$_.border="none",$_.outline="none",$_.zIndex=1,$S.addEventListener("input",$V._processInputting),$S.addEventListener("mousemove",$V._stopEvent),$S.addEventListener("mousedown",$V._stopEvent),$S.addEventListener("touchmove",$V._stopEvent),$S.setFontFace=function($_){$S.style.fontFamily=$_},$x.isConchApp||($S.setColor=function($_){$S.style.color=$_},$S.setFontSize=function($_){$S.style.fontSize=$_+"px"})},$V._processInputting=function($_){var $S=laya.display.Input.inputElement.target;if($S){var $j=laya.display.Input.inputElement.value;$S._restrictPattern&&($j=$j.replace(/\u2006|\x27/g,""),$S._restrictPattern.test($j)&&($j=$j.replace($S._restrictPattern,""),laya.display.Input.inputElement.value=$j)),$S._text=$j,$S.event("input")}},$V._stopEvent=function($_){"touchmove"==$_.type&&$_.preventDefault(),$_.stopPropagation&&$_.stopPropagation()},$V.TYPE_TEXT="text",$V.TYPE_PASSWORD="password",$V.TYPE_EMAIL="email",$V.TYPE_URL="url",$V.TYPE_NUMBER="number",$V.TYPE_RANGE="range",$V.TYPE_DATE="date",$V.TYPE_MONTH="month",$V.TYPE_WEEK="week",$V.TYPE_TIME="time",$V.TYPE_DATE_TIME="datetime",$V.TYPE_DATE_TIME_LOCAL="datetime-local",$V.TYPE_SEARCH="search",$V.input=null,$V.area=null,$V.inputElement=null,$V.inputContainer=null,$V.confirmButton=null,$V.promptStyleDOM=null,$V.inputHeight=45,$V.isInputting=!1,$V.stageMatrix=null,$a($V,["IOS_IFRAME",function(){return this.IOS_IFRAME=$m.onIOS&&$m.window.top!=$m.window.self}]),$V}($Z_),$A_=function($_){function $j($_,$S){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$j.__super.call(this),$_&&this._init_($_,$S)}$v($j,"laya.resource.HTMLImage",$l_);var $S=$j.prototype;return $S._init_=function($_,$S){this._src=$_,this._source=new $m.window.Image,$S&&($S.onload&&(this.onload=$S.onload),$S.onerror&&(this.onerror=$S.onerror),$S.onCreate&&$S.onCreate(this)),0!=$_.indexOf("data:image")&&(this._source.crossOrigin=""),$_&&(this._source.src=$_)},$S.recreateResource=function(){var $_=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $S=this;this._source=new $m.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($S._needReleaseAgain)return $S._needReleaseAgain=!1,$S._source.onload=null,void($S._source=null);$S._source.onload=null,$S.memorySize=$_._w*$_._h*4,$S._recreateLock=!1,$S.completeCreate()},this._source.src=this._src}},$S.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$S.onresize=function(){this._w=this._source.width,this._h=this._source.height},$c(0,$S,"onload",null,function($_){var $S=this;this._onload=$_,this._source&&(this._source.onload=null!=this._onload?function(){$S.onresize(),$S._onload()}:null)}),$c(0,$S,"onerror",null,function($_){var $S=this;this._onerror=$_,this._source&&(this._source.onerror=null!=this._onerror?function(){$S._onerror()}:null)}),$c(0,$S,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($_){this._enableMerageInAtlas=$_,$x.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$_)}),$j.create=function($_,$S){return new $j($_,$S)},$j}(),$f_=(function($M){function $_(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$_.__super.call(this)}$v($_,"laya.display.EffectAnimation",$M);var $S=$_.prototype;$S._onOtherBegin=function($_){$_!=this&&this.stop()},$S.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$S._onPlayAction=function(){this.play(0,!1)},$S.play=function($_,$S,$j,$O){void 0===$_&&($_=0),void 0===$S&&($S=!0),void 0===$j&&($j=""),void 0===$O&&($O=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$_,$S,$j,$O))},$S._recordInitData=function(){if(this._aniKeys){var $_,$S,$j=0;for($_=this._aniKeys.length,$j=0;$j<$_;$j++)$S=this._aniKeys[$j],this._initData[$S]=this._target[$S]}},$S._displayToIndex=function($_){if(this._animationData){$_<0&&($_=0),$_>this._count&&($_=this._count);var $S=this._animationData.nodes,$j=0,$O=$S.length;for($O=1<$O?1:$O,$j=0;$j<$O;$j++)this._displayNodeToFrame($S[$j],$_)}},$S._displayNodeToFrame=function($_,$S,$j){if(this._target){var $O;$O=this._target;var $V,$M,$R,$w,$a=$_.frames,$u=$_.keys,$c=0,$q=$u.length;$w=$_.secondFrames;var $s,$C,$i,$v,$Z=0;for($c=0;$c<$q;$c++)$M=$a[$V=$u[$c]],$R=-1==($Z=$w[$V])?this._initData[$V]:$S<$Z?($i=($C=$_.keyframes[$V])[0]).tween?(null==($s=$Q[$i.tweenMethod])&&($s=$Q.linearNone),$v=$C[1],$s($S,this._initData[$V],$v.value-this._initData[$V],$v.index)):this._initData[$V]:$M.length>$S?$M[$S]:$M[$M.length-1],$O[$V]=$R}},$S._calculateNodeKeyFrames=function($_){$M.prototype._calculateNodeKeyFrames.call(this,$_);var $S,$j,$O,$V=$_.keyframes;$_.target;for($S in $O={},$_.secondFrames=$O,$V)($j=$V[$S]).length<=1?$O[$S]=-1:$O[$S]=$j[1].index},$c(0,$S,"target",function(){return this._target},function($_){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$_,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$c(0,$S,"playEvent",null,function($_){(this._playEvents=$_)&&this.addEvent()}),$c(0,$S,"effectData",null,function($_){var $S;$_&&(($S=$_.animations)&&$S[0]&&(this._setUp({},$S[0]),$S[0].nodes&&$S[0].nodes[0]&&(this._aniKeys=$S[0].nodes[0].keys)))}),$c(0,$S,"effectClass",null,function($_){var $S,$j;(this._effectClass=$D.getClass($_),this._effectClass)&&(($S=this._effectClass.uiView)&&($j=$S.animations)&&$j[0]&&(this._setUp({},$j[0]),$j[0].nodes&&$j[0].nodes[0]&&(this._aniKeys=$j[0].nodes[0].keys)))}),$_.EffectAnimationBegin="effectanimationbegin"}($z_),function($S){var $E;function $$(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$$.__super.call(this)}$v($$,"laya.utils.GraphicAnimation",$S);var $_=$$.prototype;return $_._parseNodeList=function($_){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$_.compId]=$_.props,$_.compId&&this._nodeList.push($_.compId);var $S=$_.child;if($S){var $j=0,$O=$S.length;for($j=0;$j<$O;$j++)this._parseNodeList($S[$j])}},$_._calGraphicData=function($_){var $S;if(this._setUp(null,$_),this._createGraphicData(),this._nodeIDAniDic)for($S in this._nodeIDAniDic)this._nodeIDAniDic[$S]=null},$_._createGraphicData=function(){var $_,$S=[],$j=0,$O=this.count,$V=this._animationNewFrames;for($V||($V=[]),$j=0;$j<$O;$j++)!$V[$j]&&$_||($_=this._createFrameGraphic($j)),$S.push($_);this._gList=$S},$_._createFrameGraphic=function($_){var $S=$d.createGraphics();return $$._rootMatrix||($$._rootMatrix=new $n),this._updateNodeGraphic(this._rootNode,$_,$$._rootMatrix,$S),$S},$_._updateNodeGraphic=function($_,$S,$j,$O,$V){var $M;void 0===$V&&($V=1);var $R,$w,$a,$u=($M=this._nodeGDic[$_.compId]=this._getNodeGraphicData($_.compId,$S,this._nodeGDic[$_.compId])).alpha*$V;if(!($u<.01)&&($M.resultTransform||($M.resultTransform=$n.create()),$R=$M.resultTransform,$n.mul($M.transform,$j,$R),$M.skin&&($w=this._getTextureByUrl($M.skin))&&($R._checkTransform()?($O.drawTexture($w,0,0,$M.width,$M.height,$R,$u),$M.resultTransform=null):$O.drawTexture($w,$R.tx,$R.ty,$M.width,$M.height,null,$u)),$a=$_.child)){var $c,$q=0;for($c=$a.length,$q=0;$q<$c;$q++)this._updateNodeGraphic($a[$q],$S,$R,$O,$u)}},$_._updateNoChilds=function($_,$S){if($_.skin){var $j=this._getTextureByUrl($_.skin);if($j){var $O=$_.transform;$O._checkTransform();!$O.bTransform?$S.drawTexture($j,$O.tx,$O.ty,$_.width,$_.height,null,$_.alpha):$S.drawTexture($j,0,0,$_.width,$_.height,$O.clone(),$_.alpha)}}},$_._updateNodeGraphic2=function($_,$S,$j){var $O;if($O=this._nodeGDic[$_.compId]=this._getNodeGraphicData($_.compId,$S,this._nodeGDic[$_.compId]),$_.child){var $V=$O.transform;$V._checkTransform();var $M,$R;$R=($M=!$V.bTransform)&&(0!=$V.tx||0!=$V.ty);var $w,$a,$u;if(($w=$V.bTransform||1!=$O.alpha)&&$j.save(),1!=$O.alpha&&$j.alpha($O.alpha),$M?$R&&$j.translate($V.tx,$V.ty):$j.transform($V.clone()),$a=$_.child,$O.skin&&($u=this._getTextureByUrl($O.skin))&&$j.drawTexture($u,0,0,$O.width,$O.height),$a){var $c,$q=0;for($c=$a.length,$q=0;$q<$c;$q++)this._updateNodeGraphic2($a[$q],$S,$j)}$w?$j.restore():$M?$R&&$j.translate(-$V.tx,-$V.ty):$j.transform($V.clone().invert())}else this._updateNoChilds($O,$j)},$_._calculateNodeKeyFrames=function($_){$S.prototype._calculateNodeKeyFrames.call(this,$_),this._nodeIDAniDic[$_.target]=$_},$_.getNodeDataByID=function($_){return this._nodeIDAniDic[$_]},$_._getParams=function($_,$S,$j,$O){var $V=$$._temParam;$V.length=$S.length;var $M=0,$R=$S.length;for($M=0;$M<$R;$M++)$V[$M]=this._getObjVar($_,$S[$M][0],$j,$S[$M][1],$O);return $V},$_._getObjVar=function($_,$S,$j,$O,$V){if($_.hasOwnProperty($S)){var $M=$_[$S];if($j>=$M.length&&($j=$M.length-1),null!=$_[$S][$j])return $_[$S][$j]}return $V.hasOwnProperty($S)?$V[$S]:$O},$_._getNodeGraphicData=function($_,$S,$j){$j||($j=$E.create()),$j.transform?$j.transform.identity():$j.transform=$n.create();var $O=this.getNodeDataByID($_);if(!$O)return $j;var $V,$M,$R=$O.frames,$w=this._getParams($R,$$._drawTextureCmd,$S,this._nodeDefaultProps[$_]),$a=$w[0],$u=NaN,$c=NaN,$q=$w[5],$s=$w[6],$C=$w[13],$i=$w[14],$v=$w[7],$Z=$w[8],$o=$w[9],$l=$w[11],$k=$w[12];$u=$w[3],$c=$w[4],0!=$u&&0!=$c||($a=null),-1==$u&&($u=0),-1==$c&&($c=0),$j.skin=$a,$j.width=$u,$j.height=$c,$a&&(($V=this._getTextureByUrl($a))?($u||($u=$V.sourceWidth),$c||($c=$V.sourceHeight)):console.warn("lost skin:",$a,",you may load pics first")),$j.alpha=$w[10],$M=$j.transform,0!=$C&&($q=$C*$u),0!=$i&&($s=$i*$c),0==$q&&0==$s||$M.translate(-$q,-$s);var $z=null;if($o||1!==$v||1!==$Z||$l||$k){($z=$$._tempMt).identity(),$z.bTransform=!0;var $H=.0174532922222222*($o-$l),$A=.0174532922222222*($o+$k),$f=Math.cos($A),$y=Math.sin($A),$P=Math.sin($H),$g=Math.cos($H);$z.a=$v*$f,$z.b=$v*$y,$z.c=-$Z*$P,$z.d=$Z*$g,$z.tx=$z.ty=0}return $z&&($M=$n.mul($M,$z,$M)),$M.translate($w[1],$w[2]),$j},$_._getTextureByUrl=function($_){return $w_.getRes($_)},$_.setAniData=function($_,$S){if($_.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$_,this._parseNodeList($_);var $j,$O={},$V=[],$M=$_.animations,$R=0,$w=$M.length;for($R=0;$R<$w;$R++)if($j=$M[$R],this._labels=null,(!$S||$S==$j.name)&&$j){try{this._calGraphicData($j)}catch($_){console.warn("parse animation fail:"+$j.name+",empty animation created"),this._gList=[]}var $a={};$a.interval=1e3/$j.frameRate,$a.frames=this._gList,$a.labels=this._labels,$a.name=$j.name,$V.push($a),$O[$j.name]=$a}this.animationList=$V,this.animationDic=$O}$$._temParam.length=0},$_.parseByData=function($_){var $S,$j;$S=$_.nodeRoot,$j=$_.aniO,delete $_.nodeRoot,delete $_.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$S,this._parseNodeList($S),this._labels=null;try{this._calGraphicData($j)}catch($_){console.warn("parse animation fail:"+$j.name+",empty animation created"),this._gList=[]}var $O=$_;return $O.interval=1e3/$j.frameRate,$O.frames=this._gList,$O.labels=this._labels,$O.name=$j.name,$O},$_.setUpAniData=function($_){if($_.animations){var $S,$j={},$O=[],$V=$_.animations,$M=0,$R=$V.length;for($M=0;$M<$R;$M++)if($S=$V[$M]){var $w={};$w.name=$S.name,$w.aniO=$S,$w.nodeRoot=$_,$O.push($w),$j[$S.name]=$w}this.animationList=$O,this.animationDic=$j}},$_._clear=function(){var $_,$S;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($_ in this._nodeGDic)($S=this._nodeGDic[$_])&&$S.recover();this._nodeGDic=null},$$.parseAnimationByData=function($_){var $S;return $$._I||($$._I=new $$),$S=$$._I.parseByData($_),$$._I._clear(),$S},$$.parseAnimationData=function($_){var $S;return $$._I||($$._I=new $$),$$._I.setUpAniData($_),($S={}).animationList=$$._I.animationList,$S.animationDic=$$._I.animationDic,$$._I._clear(),$S},$$._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$$._temParam=[],$$._I=null,$$._rootMatrix=null,$a($$,["_tempMt",function(){return this._tempMt=new $n}]),$$.__init$=function(){$E=function(){function $_(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $v($_,""),$_.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$T.recover("GraphicNode",this)},$_.create=function(){return $T.getItemByClass("GraphicNode",$_)},$_}()},$$}($z_));$f.__init([$u,$a_,$x,$m,$p,$g,$_,$f_])}(window,document,Laya),function($_,$S,$j){$j.un,$j.uns,$j.static;var $O=$j.class;$j.getset,$j.__newvec;new(function(){function $_(){}return $O($_,"LayaMain"),$_}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($_,$S){"use strict";for(var $j in Object.defineProperty($S,"__esModule",{value:!0}),Laya){var $O=Laya[$j];$O&&$O.__isclass&&($S[$j]=$O)}}),function($_,$S,$A){$A.un,$A.uns;var $R=$A.static,$s=$A.class,$O=$A.getset,$M=$A.__newvec,$c=laya.maths.Arith,$q=laya.maths.Bezier,$j=laya.resource.Bitmap,$C=laya.utils.Browser,$a=laya.utils.Byte,$i=laya.utils.Color,$f=(laya.filters.ColorFilter,$A.Config),$V=laya.resource.Context,$y=(laya.events.Event,laya.filters.Filter),$w=laya.display.Graphics,$u=laya.resource.HTMLCanvas,$v=(laya.utils.HTMLChar,laya.resource.HTMLImage),$Z=laya.resource.HTMLSubImage,$P=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$g=laya.maths.Point,$E=laya.maths.Rectangle,$o=laya.renders.Render,$l=(laya.renders.RenderContext,laya.renders.RenderSprite),$k=laya.resource.Resource,$z=laya.resource.ResourceManager,$H=laya.utils.RunDriver,$$=laya.display.Sprite,$d=laya.display.Stage,$n=laya.utils.Stat,$J=laya.utils.StringKey,$F=(laya.display.css.Style,laya.system.System),$x=laya.display.Text,$h=laya.resource.Texture,$N=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$B=laya.utils.VectorGraphManager;laya.utils.WordText;$A.interface("laya.webgl.shapes.IShape"),$A.interface("laya.webgl.submit.ISubmit"),$A.interface("laya.webgl.text.ICharSegment"),$A.interface("laya.webgl.canvas.save.ISaveData"),$A.interface("laya.webgl.resource.IMergeAtlasBitmap"),$A.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $t=function(){function $_(){}$s($_,"laya.filters.webgl.FilterActionGL");var $S=$_.prototype;return $A.imps($S,{"laya.filters.IFilterActionGL":!0}),$S.setValue=function($_){},$S.setValueMix=function($_){},$S.apply3d=function($_,$S,$j,$O,$V){return null},$S.apply=function($_){return null},$O(0,$S,"typeMix",function(){return 0}),$_}(),$m=function(){function $_(){}return $s($_,"laya.webgl.shader.ShaderValue"),$_}(),$e=function(){var $O,$V;function $_($_,$S,$j){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $V,void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),this._cells=null,this._rowInfo=null,this._init($_,$S),this._atlasID=$j}$s($_,"laya.webgl.atlas.AtlasGrid");var $S=$_.prototype;return $S.getAltasID=function(){return this._atlasID},$S.setAltasID=function($_){0<=$_&&(this._atlasID=$_)},$S.addTex=function($_,$S,$j){var $O=this._get($S,$j);return 0==$O.ret||(this._fill($O.x,$O.y,$S,$j,$_),this._texCount++),$O},$S._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$S._init=function($_,$S){if(this._width=$_,this._height=$S,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$M(this._height);for(var $j=0;$j<this._height;$j++)this._rowInfo[$j]=new $O;return this._clear(),!0},$S._get=function($_,$S){var $j=new $D;if($_>=this._failSize.width&&$S>=this._failSize.height)return $j;for(var $O=-1,$V=-1,$M=this._width,$R=this._height,$w=this._cells,$a=0;$a<$R;$a++)if(!(this._rowInfo[$a].spaceCount<$_))for(var $u=0;$u<$M;){var $c=3*($a*$M+$u);if(0!=$w[$c]||$w[1+$c]<$_||$w[2+$c]<$S)$u+=$w[1+$c];else{$O=$u,$V=$a;for(var $q=0;$q<$_;$q++)if($w[3*$q+$c+2]<$S){$O=-1;break}if(!($O<0))return $j.ret=!0,$j.x=$O,$j.y=$V,$j;$u+=$w[1+$c]}}return $j},$S._fill=function($_,$S,$j,$O,$V){var $M=this._width,$R=this._height;this._check($_+$j<=$M&&$S+$O<=$R);for(var $w=$S;$w<$O+$S;++$w){this._check(this._rowInfo[$w].spaceCount>=$j),this._rowInfo[$w].spaceCount-=$j;for(var $a=0;$a<$j;$a++){var $u=3*($_+$w*$M+$a);this._check(0==this._cells[$u]),this._cells[$u]=$V,this._cells[1+$u]=$j,this._cells[2+$u]=$O}}if(0<$_)for($w=0;$w<$O;++$w){var $c=0;for($a=$_-1;0<=$a&&0==this._cells[3*(($S+$w)*$M+$a)];--$a,++$c);for($a=$c;0<$a;--$a)this._cells[3*(($S+$w)*$M+$_-$a)+1]=$a,this._check(0<$a)}if(0<$S)for($a=$_;$a<$_+$j;++$a){for($c=0,$w=$S-1;0<=$w&&0==this._cells[3*($a+$w*$M)];--$w,$c++);for($w=$c;0<$w;--$w)this._cells[3*($a+($S-$w)*$M)+2]=$w,this._check(0<$w)}},$S._check=function($_){0==$_&&console.log("xtexMerger 错误啦")},$S._clear=function(){for(var $_=this._texCount=0;$_<this._height;$_++)this._rowInfo[$_].spaceCount=this._width;for(var $S=0;$S<this._height;$S++)for(var $j=0;$j<this._width;$j++){var $O=3*($S*this._width+$j);this._cells[$O]=0,this._cells[1+$O]=this._width-$j,this._cells[2+$O]=this._width-$S}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$_.__init$=function(){$O=function(){function $_(){this.spaceCount=0}return $s($_,""),$_}(),$V=function(){function $_(){this.width=0,this.height=0}return $s($_,""),$_}()},$_}(),$G=function(){function $o($_,$S,$j,$O){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$_,this._height=$S,this._gridSize=$j,this._maxAtlaserCount=$O,this._gridNumX=$_/$j,this._gridNumY=$S/$j,this._curAtlasIndex=0,this._atlaserArray=[]}$s($o,"laya.webgl.atlas.AtlasResourceManager");var $_=$o.prototype;return $_.setAtlasParam=function($_,$S,$j,$O){if(1==this._setAtlasParam)return $o._sid_=0,this._width=$_,this._height=$S,this._gridSize=$j,this._maxAtlaserCount=$O,this._gridNumX=$_/$j,this._gridNumY=$S/$j,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$_.pushData=function($_){var $S,$j=$_.bitmap,$O=-1,$V=null,$M=0,$R=0;for($M=0,$S=this._atlaserArray.length;$M<$S&&($R=(this._curAtlasIndex+$M)%$S,-1==($O=($V=this._atlaserArray[$R]).findBitmapIsExist($j)));$M++);if(-1!=$O){var $w=$V.InAtlasWebGLImagesOffsetValue[$O];return $i=$w[0],$v=$w[1],$V.addToAtlas($_,$i,$v),!0}this._setAtlasParam=!1;for(var $a=Math.ceil(($_.bitmap.width+2)/this._gridSize),$u=Math.ceil(($_.bitmap.height+2)/this._gridSize),$c=!1,$q=0;$q<2;$q++){var $s=this._maxAtlaserCount;for($M=0;$M<$s;$M++){$R=(this._curAtlasIndex+$M)%$s,this._atlaserArray.length-1>=$R||this._atlaserArray.push(new $E_(this._gridNumX,this._gridNumY,this._width,this._height,$o._sid_++));var $C=this._atlaserArray[$R],$i=0,$v=0,$Z=$C.addTex(1,$a,$u);if($Z.ret){$i=$Z.x*this._gridSize+1,$v=$Z.y*this._gridSize+1,$j.lock=!0,$C.addToAtlasTexture($j,$i,$v),$C.addToAtlas($_,$i,$v),$c=!0,this._curAtlasIndex=$R;break}}if($c)break;this._atlaserArray.push(new $E_(this._gridNumX,this._gridNumY,this._width,this._height,$o._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $c||console.log(">>>AtlasManager pushData error"),$c},$_.addToAtlas=function($_){laya.webgl.atlas.AtlasResourceManager.instance.pushData($_)},$_.garbageCollection=function(){if(!0===this._needGC){for(var $_=this._atlaserArray.length-this._maxAtlaserCount,$S=0;$S<$_;$S++)this._atlaserArray[$S].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$_),this._atlaserArray.splice(0,$_),this._needGC=!1}return!0},$_.freeAll=function(){for(var $_=0,$S=this._atlaserArray.length;$_<$S;$_++)this._atlaserArray[$_].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$_.getAtlaserCount=function(){return this._atlaserArray.length},$_.getAtlaserByIndex=function($_){return this._atlaserArray[$_]},$O(1,$o,"instance",function(){return $o._Instance||($o._Instance=new $o(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$o._Instance}),$O(1,$o,"enabled",function(){return $f.atlasEnable}),$O(1,$o,"atlasLimitWidth",function(){return $o._atlasLimitWidth},function($_){$o._atlasLimitWidth=$_}),$O(1,$o,"atlasLimitHeight",function(){return $o._atlasLimitHeight},function($_){$o._atlasLimitHeight=$_}),$o._enable=function(){$f.atlasEnable=!0},$o._disable=function(){$f.atlasEnable=!1},$o.__init__=function(){$o.atlasTextureWidth=2048,$o.atlasTextureHeight=2048,$o.maxTextureCount=6,$o.atlasLimitWidth=512,$o.atlasLimitHeight=512},$o._atlasLimitWidth=0,$o._atlasLimitHeight=0,$o.gridSize=16,$o.atlasTextureWidth=0,$o.atlasTextureHeight=0,$o.maxTextureCount=0,$o._atlasRestore=0,$o.BOARDER_TYPE_NO=0,$o.BOARDER_TYPE_RIGHT=1,$o.BOARDER_TYPE_LEFT=2,$o.BOARDER_TYPE_BOTTOM=4,$o.BOARDER_TYPE_TOP=8,$o.BOARDER_TYPE_ALL=15,$o._sid_=0,$o._Instance=null,$o}(),$D=function(){function $_(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $s($_,"laya.webgl.atlas.MergeFillInfo"),$_}(),$L=function(){function $S(){}return $s($S,"laya.webgl.canvas.BlendMode"),$S._init_=function($_){$S.fns=[$S.BlendNormal,$S.BlendAdd,$S.BlendMultiply,$S.BlendScreen,$S.BlendOverlay,$S.BlendLight,$S.BlendMask,$S.BlendDestinationOut],$S.targetFns=[$S.BlendNormalTarget,$S.BlendAddTarget,$S.BlendMultiplyTarget,$S.BlendScreenTarget,$S.BlendOverlayTarget,$S.BlendLightTarget,$S.BlendMask,$S.BlendDestinationOut]},$S.BlendNormal=function($_){$_.blendFunc(1,771)},$S.BlendAdd=function($_){$_.blendFunc(1,772)},$S.BlendMultiply=function($_){$_.blendFunc(774,771)},$S.BlendScreen=function($_){$_.blendFunc(1,1)},$S.BlendOverlay=function($_){$_.blendFunc(1,769)},$S.BlendLight=function($_){$_.blendFunc(1,1)},$S.BlendNormalTarget=function($_){$_.blendFunc(1,771)},$S.BlendAddTarget=function($_){$_.blendFunc(1,772)},$S.BlendMultiplyTarget=function($_){$_.blendFunc(774,771)},$S.BlendScreenTarget=function($_){$_.blendFunc(1,1)},$S.BlendOverlayTarget=function($_){$_.blendFunc(1,769)},$S.BlendLightTarget=function($_){$_.blendFunc(1,1)},$S.BlendMask=function($_){$_.blendFunc(0,770)},$S.BlendDestinationOut=function($_){$_.blendFunc(0,0)},$S.activeBlendFunction=null,$S.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$S.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$S.NORMAL="normal",$S.ADD="add",$S.MULTIPLY="multiply",$S.SCREEN="screen",$S.LIGHT="light",$S.OVERLAY="overlay",$S.DESTINATIONOUT="destination-out",$S.fns=[],$S.targetFns=[],$S}(),$U=function(){function $j($_){this._color=$i.create("black"),this.setValue($_)}$s($j,"laya.webgl.canvas.DrawStyle");var $_=$j.prototype;return $_.setValue=function($_){if($_){if("string"==typeof $_)return void(this._color=$i.create($_));if($_ instanceof laya.utils.Color)return void(this._color=$_)}},$_.reset=function(){this._color=$i.create("black")},$_.equal=function($_){return"string"==typeof $_?this._color.strColor===$_:$_ instanceof laya.utils.Color&&this._color.numColor===$_.numColor},$_.toColorStr=function(){return this._color.strColor},$j.create=function($_){var $S;if($_&&("string"==typeof $_?$S=$i.create($_):$_ instanceof laya.utils.Color&&($S=$_),$S))return $S._drawStyle||($S._drawStyle=new $j($_));return laya.webgl.canvas.DrawStyle.DEFAULT},$R($j,["DEFAULT",function(){return this.DEFAULT=new $j("#000000")}]),$j}(),$Q=function(){function $_(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$z_.mainContext;this.ib=$r_.create(35048),this.vb=$b_.create(5)}$s($_,"laya.webgl.canvas.Path");var $S=$_.prototype;return $S.addPoint=function($_,$S){this.tempArray.push($_,$S)},$S.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$S.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$S.polygon=function($_,$S,$j,$O,$V,$M){var $R;return this.geomatrys.push(this._curGeomatry=$R=new $J_($_,$S,$j,$O,$V,$M)),$O||($R.fill=!1),null==$M&&($R.borderWidth=0),$R},$S.setGeomtry=function($_){this.geomatrys.push(this._curGeomatry=$_)},$S.drawLine=function($_,$S,$j,$O,$V){var $M;return this.closePath?this.geomatrys.push(this._curGeomatry=$M=new $n_($_,$S,$j,$O,$V)):this.geomatrys.push(this._curGeomatry=$M=new $d_($_,$S,$j,$O,$V)),$M.fill=!1,$M},$S.update=function(){var $_=this.ib._byteLength,$S=this.geomatrys.length;this.offset=$_;for(var $j=this.geoStart;$j<$S;$j++)this.geomatrys[$j].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$S,this.count=(this.ib._byteLength-$_)/$v_.BYTES_PIDX},$S.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$S.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$_}(),$Y=function(){function $w(){}$s($w,"laya.webgl.canvas.save.SaveBase");var $_=$w.prototype;return $A.imps($_,{"laya.webgl.canvas.save.ISaveData":!0}),$_.isSaveMark=function(){return!1},$_.restore=function($_){this._dataObj[this._valueName]=this._value,($w._cache[$w._cache._length++]=this)._newSubmit&&($_._curSubmit=$M_.RENDERBASE,$_._renderKey=0)},$w._createArray=function(){var $_=[];return $_._length=0,$_},$w._init=function(){var $_=$w._namemap={};return $_[1]="ALPHA",$_[2]="fillStyle",$_[8]="font",$_[256]="lineWidth",$_[512]="strokeStyle",$_[8192]="_mergeID",$_[1024]=$_[2048]=$_[4096]=[],$_[16384]="textBaseline",$_[32768]="textAlign",$_[65536]="_nBlendType",$_[1048576]="shader",$_[2097152]="filters",$_},$w.save=function($_,$S,$j,$O){if(($_._saveMark._saveuse&$S)!==$S){$_._saveMark._saveuse|=$S;var $V=$w._cache,$M=0<$V._length?$V[--$V._length]:new $w;$M._value=$j[$M._valueName=$w._namemap[$S]],$M._dataObj=$j,$M._newSubmit=$O;var $R=$_._save;$R[$R._length++]=$M}},$w._cache=laya.webgl.canvas.save.SaveBase._createArray(),$w._namemap=$w._init(),$w}(),$T=function(){function $M(){this._clipRect=new $E}$s($M,"laya.webgl.canvas.save.SaveClipRect");var $_=$M.prototype;return $A.imps($_,{"laya.webgl.canvas.save.ISaveData":!0}),$_.isSaveMark=function(){return!1},$_.restore=function($_){$_._clipRect=this._clipSaveRect,($M._cache[$M._cache._length++]=this)._submitScissor.submitLength=$_._submits._length-this._submitScissor.submitIndex,$_._curSubmit=$M_.RENDERBASE,$_._renderKey=0},$M.save=function($_,$S){if(131072!=(131072&$_._saveMark._saveuse)){$_._saveMark._saveuse|=131072;var $j=$M._cache,$O=0<$j._length?$j[--$j._length]:new $M;$O._clipSaveRect=$_._clipRect,$_._clipRect=$O._clipRect.copyFrom($_._clipRect),$O._submitScissor=$S;var $V=$_._save;$V[$V._length++]=$O}},$R($M,["_cache",function(){return this._cache=$Y._createArray()}]),$M}(),$W=function(){function $C(){this._contextX=0,this._contextY=0,this._clipRect=new $E,this._rect=new $E,this._matrix=new $P}$s($C,"laya.webgl.canvas.save.SaveClipRectStencil");var $_=$C.prototype;return $A.imps($_,{"laya.webgl.canvas.save.ISaveData":!0}),$_.isSaveMark=function(){return!1},$_.restore=function($_){$c_.restore($_,this._rect,this._saveMatrix,this._contextX,this._contextY),$_._clipRect=this._clipSaveRect,$_._curMat=this._saveMatrix,$_._x=this._contextX,$_._y=this._contextY,$C._cache[$C._cache._length++]=this,$_._curSubmit=$M_.RENDERBASE},$C.save=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){if(262144!=(262144&$_._saveMark._saveuse)){$_._saveMark._saveuse|=262144;var $c=$C._cache,$q=0<$c._length?$c[--$c._length]:new $C;$q._clipSaveRect=$_._clipRect,$q._clipRect.setTo($R,$w,$a,$u),$_._clipRect=$q._clipRect,$q._rect.x=$j,$q._rect.y=$O,$q._rect.width=$V,$q._rect.height=$M,$q._contextX=$_._x,$q._contextY=$_._y,$q._saveMatrix=$_._curMat,$_._curMat.copyTo($q._matrix),$_._curMat=$q._matrix,$q._submitStencil=$S;var $s=$_._save;$s[$s._length++]=$q}},$R($C,["_cache",function(){return this._cache=$Y._createArray()}]),$C}(),$p=function(){function $O(){this._saveuse=0}$s($O,"laya.webgl.canvas.save.SaveMark");var $_=$O.prototype;return $A.imps($_,{"laya.webgl.canvas.save.ISaveData":!0}),$_.isSaveMark=function(){return!0},$_.restore=function($_){$_._saveMark=this._preSaveMark,$O._no[$O._no._length++]=this},$O.Create=function($_){var $S=$O._no,$j=0<$S._length?$S[--$S._length]:new $O;return $j._saveuse=0,$j._preSaveMark=$_._saveMark,$_._saveMark=$j},$R($O,["_no",function(){return this._no=$Y._createArray()}]),$O}(),$I=function(){function $M(){this._matrix=new $P}$s($M,"laya.webgl.canvas.save.SaveTransform");var $_=$M.prototype;return $A.imps($_,{"laya.webgl.canvas.save.ISaveData":!0}),$_.isSaveMark=function(){return!1},$_.restore=function($_){$_._curMat=this._savematrix,$M._no[$M._no._length++]=this},$M.save=function($_){var $S=$_._saveMark;if(2048!=(2048&$S._saveuse)){$S._saveuse|=2048;var $j=$M._no,$O=0<$j._length?$j[--$j._length]:new $M;$O._savematrix=$_._curMat,$_._curMat=$_._curMat.copyTo($O._matrix);var $V=$_._save;$V[$V._length++]=$O}},$R($M,["_no",function(){return this._no=$Y._createArray()}]),$M}(),$K=function(){function $V(){}$s($V,"laya.webgl.canvas.save.SaveTranslate");var $_=$V.prototype;return $A.imps($_,{"laya.webgl.canvas.save.ISaveData":!0}),$_.isSaveMark=function(){return!1},$_.restore=function($_){$_._curMat;$_._x=this._x,$_._y=this._y,$V._no[$V._no._length++]=this},$V.save=function($_){var $S=$V._no,$j=0<$S._length?$S[--$S._length]:new $V;$j._x=$_._x,$j._y=$_._y;var $O=$_._save;$O[$O._length++]=$j},$R($V,["_no",function(){return this._no=$Y._createArray()}]),$V}(),$X=function(){function $_(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $E}$s($_,"laya.webgl.resource.RenderTargetMAX");var $S=$_.prototype;return $S.setSP=function($_){this._sp=$_},$S.size=function($_,$S){var $j=this;this._width!==$_||this._height!==$S?(this.repaint=!0,this._width=$_,this._height=$S,this.target?this.target.size($_,$S):this.target=$B_.create($_,$S),this.target.hasListener("recovered")||this.target.on("recovered",this,function($_){$A.timer.callLater($j._sp,$j._sp.repaint)})):this.target.size($_,$S)},$S._flushToTarget=function($_,$S){if(!$S._destroy){var $j=$l_.worldScissorTest,$O=$l_.worldClipRect;$l_.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$l_.worldScissorTest=!1,$z_.mainContext.disable(3089);var $V=$l_.worldAlpha,$M=$l_.worldMatrix4,$R=$l_.worldMatrix,$w=$l_.worldFilters,$a=$l_.worldShaderDefines;if($l_.worldMatrix=$P.EMPTY,$l_.restoreTempArray(),$l_.worldMatrix4=$l_.TEMPMAT4_ARRAY,$l_.worldAlpha=1,$l_.worldFilters=null,$l_.worldShaderDefines=null,$N_.activeShader=null,$S.start(),$f.showCanvasMark?$S.clear(0,1,0,.3):$S.clear(0,0,0,0),$_.flush(),$S.end(),$N_.activeShader=null,$l_.worldAlpha=$V,$l_.worldMatrix4=$M,$l_.worldMatrix=$R,$l_.worldFilters=$w,$l_.worldShaderDefines=$a,$l_.worldScissorTest=$j){var $u=$l_.height-$O.y-$O.height;$z_.mainContext.scissor($O.x,$u,$O.width,$O.height),$z_.mainContext.enable(3089)}$l_.worldClipRect=$O}},$S.flush=function($_){this.repaint&&(this._flushToTarget($_,this.target),this.repaint=!1)},$S.drawTo=function($_,$S,$j,$O,$V){$_.drawTexture(this.target.getTexture(),$S,$j,$O,$V,0,0)},$S.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$_}(),$r=function(){function $_(){this.ALPHA=1,this.shaderType=0,this.defines=new $$_}return $s($_,"laya.webgl.shader.d2.Shader2D"),$_.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$_.__init__=function(){var $_,$S;$p_.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$p_.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$p_.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$p_.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$p_.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$p_.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$p_.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$p_.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$_="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$S='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$p_.preCompile2D(0,1,$_,$S,null),$_="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$S='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$p_.preCompile2D(0,2,$_,$S,null),$_="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$S="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$p_.preCompile2D(0,4,$_,$S,null),$_="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$S='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$p_.preCompile2D(0,256,$_,$S,null),$_="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$S="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$p_.preCompile2D(0,512,$_,$S,null)},$_}(),$b=function(){function $S($_,$S,$j){this._value=0,this._name2int=$_,this._int2name=$S,this._int2nameMap=$j}$s($S,"laya.webgl.shader.ShaderDefines");var $_=$S.prototype;return $_.add=function($_){return"string"==typeof $_&&($_=this._name2int[$_]),this._value|=$_,this._value},$_.addInt=function($_){return this._value|=$_,this._value},$_.remove=function($_){return"string"==typeof $_&&($_=this._name2int[$_]),this._value&=~$_,this._value},$_.isDefine=function($_){return(this._value&$_)===$_},$_.getValue=function(){return this._value},$_.setValue=function($_){this._value=$_},$_.toNameDic=function(){var $_=this._int2nameMap[this._value];return $_||$S._toText(this._value,this._int2name,this._int2nameMap)},$S._reg=function($_,$S,$j,$O){$O[$j[$_]=$S]=$_},$S._toText=function($_,$S,$j){var $O=$j[$_];if($O)return $O;for(var $V={},$M=1,$R=0;$R<32&&!($_<($M=1<<$R));$R++)if($_&$M){var $w=$S[$M];$w&&($V[$w]="")}return $j[$_]=$V},$S._toInt=function($_,$S){for(var $j=$_.split("."),$O=0,$V=0,$M=$j.length;$V<$M;$V++){var $R=$S[$j[$V]];if(!$R)throw new Error("Defines to int err:"+$_+"/"+$j[$V]);$O|=$R}return $O},$S}(),$__=function(){function $R(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $P}$s($R,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $_=$R.prototype;return $_.init=function($_,$S,$j){if($S)this._vs=$S;else{this._vs=[];var $O=$_.width,$V=$_.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($O,0,1,0,1,1,1,1),this._vs.push($O,$V,1,1,1,1,1,1),this._vs.push(0,$V,0,1,1,1,1,1)}$j?this._ps=$j:($R._defaultPS||($R._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$R._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$_},$_.init2=function($_,$S,$j,$O,$V){this.transform&&(this.transform=null),$j?this._ps=$j:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$O,this._uvs=$V,this.mEleNum=this._ps.length,this.mTexture=$_,($o.isConchNode||$o.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$_._initMyData=function(){var $_=0,$S=0,$j=4*this._verticles.length;this._vs=$R._tempVS;var $O=!1;if($o.isConchNode||$o.isConchApp?(this._vs.length=$j,$O=!0):this._vs.length<$j&&(this._vs.length=$j,$O=!0),$R._tVSLen=$j,$O)for(;$_<$j;)this._vs[$_]=this._verticles[$S],this._vs[$_+1]=this._verticles[$S+1],this._vs[$_+2]=this._uvs[$S],this._vs[$_+3]=this._uvs[$S+1],this._vs[$_+4]=1,this._vs[$_+5]=1,this._vs[$_+6]=1,this._vs[$_+7]=1,$_+=8,$S+=2;else for(;$_<$j;)this._vs[$_]=this._verticles[$S],this._vs[$_+1]=this._verticles[$S+1],this._vs[$_+2]=this._uvs[$S],this._vs[$_+3]=this._uvs[$S+1],$_+=8,$S+=2},$_.getData2=function($_,$S,$j){var $O;this.mVBBuffer=$_,this.mIBBuffer=$S,this._initMyData(),$_.appendEx2(this._vs,Float32Array,$R._tVSLen,4),this._indexStart=$S._byteLength,($O=$R._tempIB).length<this._ps.length&&($O.length=this._ps.length);for(var $V=0,$M=this._ps.length;$V<$M;$V++)$O[$V]=this._ps[$V]+$j;$S.appendEx2($O,Uint16Array,this._ps.length,2)},$_.getData=function($_,$S,$j){if(this.mVBBuffer=$_,this.mIBBuffer=$S,$_.append(this.mVBData),this._indexStart=$S._byteLength,this.mIBData.start!=$j){for(var $O=0,$V=this._ps.length;$O<$V;$O++)this.mIBData[$O]=this._ps[$O]+$j;this.mIBData.start=$j}$S.append(this.mIBData)},$_.render=function($_,$S,$j){if($o.isWebGL&&this.mTexture){$_._renderKey=0,$_._shader2D.glTexture=null,$S_.getInstance().addSkinMesh(this);var $O=$M_.createShape($_,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$y_.create(512,0));this.transform||(this.transform=$P.EMPTY),this.transform.translate($S,$j),$P.mul(this.transform,$_._curMat,this._tempMatrix),this.transform.translate(-$S,-$j);var $V=$O.shaderValue,$M=$V.u_mmat2||$l_.getMatrArray();$l_.mat2MatArray(this._tempMatrix,$M),$V.textureHost=this.mTexture,$V.offsetX=0,$V.offsetY=0,$V.u_mmat2=$M,$V.ALPHA=$_._shader2D.ALPHA,$_._submits[$_._submits._length++]=$O}else $o.isConchApp&&this.mTexture&&(this.transform||(this.transform=$P.EMPTY),$_.setSkinMesh&&$_.setSkinMesh($S,$j,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$R._tempVS=[],$R._tempIB=[],$R._defaultPS=null,$R._tVSLen=0,$R}(),$S_=function(){function $_(){this.ib=null,this.vb=null;$z_.mainContext;this.ib=$r_.create(35048),this.vb=$b_.create(8)}$s($_,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $S=$_.prototype;return $S.addSkinMesh=function($_){$_.getData2(this.vb,this.ib,this.vb._byteLength/32)},$S.reset=function(){this.vb.clear(),this.ib.clear()},$_.getInstance=function(){return $_.instance=$_.instance||new $_},$_.instance=null,$_}(),$j_=function(){function $_($_,$S,$j,$O,$V,$M,$R,$w,$a){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$a&&($a=0),this.x=$_,this.y=$S,this.width=$j,this.height=$O,this.edges=$V,this.color=$M,this.borderWidth=$R,this.borderColor=$w}$s($_,"laya.webgl.shapes.BasePoly");var $S=$_.prototype;return $A.imps($S,{"laya.webgl.shapes.IShape":!0}),$S.getData=function($_,$S,$j){},$S.rebuild=function($_){},$S.setMatrix=function($_){},$S.needUpdate=function($_){return!0},$S.sector=function($_,$S,$j){var $O=this.x,$V=this.y,$M=this.edges,$R=(this.r1-this.r0)/$M,$w=this.width,$a=this.height,$u=this.color,$c=($u>>16&255)/255,$q=($u>>8&255)/255,$s=(255&$u)/255;$_.push($O,$V,$c,$q,$s);for(var $C=0;$C<$M+1;$C++)$_.push($O+Math.sin($R*$C+this.r0)*$w,$V+Math.cos($R*$C+this.r0)*$a),$_.push($c,$q,$s);for($C=0;$C<$M;$C++)$S.push($j,$j+$C+1,$j+$C+2)},$S.createLine2=function($_,$S,$j,$O,$V,$M){var $R,$w,$a,$u,$c,$q,$s,$C,$i,$v,$Z,$o,$l,$k,$z,$H,$A,$f,$y,$P,$g=$_.concat(),$E=$V,$$=this.borderColor,$d=($$>>16&255)/255,$n=($$>>8&255)/255,$J=(255&$$)/255,$F=$g.length/2,$x=$O,$h=$j/2;$a=$g[0],$u=$g[1],$v=$a-($c=$g[2]),$i=($i=-($u-($q=$g[3])))/($P=Math.sqrt($i*$i+$v*$v))*$h,$v=$v/$P*$h,$E.push($a-$i+this.x,$u-$v+this.y,$d,$n,$J,$a+$i+this.x,$u+$v+this.y,$d,$n,$J);for(var $N=1;$N<$F-1;$N++)$a=$g[2*($N-1)],$u=$g[2*($N-1)+1],$c=$g[2*$N],$q=$g[2*$N+1],$s=$g[2*($N+1)],$C=$g[2*($N+1)+1],$v=$a-$c,$o=$c-$s,$z=(-($i=($i=-($u-$q))/($P=Math.sqrt($i*$i+$v*$v))*$h)+$a)*(-($v=$v/$P*$h)+$q)-(-$i+$c)*(-$v+$u),$f=(-($Z=($Z=-($q-$C))/($P=Math.sqrt($Z*$Z+$o*$o))*$h)+$s)*(-($o=$o/$P*$h)+$q)-(-$Z+$c)*(-$o+$C),$y=($l=-$v+$u-(-$v+$q))*($A=-$Z+$c-(-$Z+$s))-($H=-$o+$C-(-$o+$q))*($k=-$i+$c-(-$i+$a)),Math.abs($y)<.1?($y+=10.1,$E.push($c-$i+this.x,$q-$v+this.y,$d,$n,$J,$c+$i+this.x,$q+$v+this.y,$d,$n,$J)):((($R=($k*$f-$A*$z)/$y)-$c)*($R-$c)+(($w=($H*$z-$l*$f)/$y)-$q)+($w-$q),$E.push($R+this.x,$w+this.y,$d,$n,$J,$c-($R-$c)+this.x,$q-($w-$q)+this.y,$d,$n,$J));$a=$g[$g.length-4],$u=$g[$g.length-3],$v=$a-($c=$g[$g.length-2]),$i=($i=-($u-($q=$g[$g.length-1])))/($P=Math.sqrt($i*$i+$v*$v))*$h,$v=$v/$P*$h,$E.push($c-$i+this.x,$q-$v+this.y,$d,$n,$J,$c+$i+this.x,$q+$v+this.y,$d,$n,$J);var $B=$M;for($N=1;$N<$B;$N++)$S.push($x+2*($N-1),$x+2*($N-1)+1,$x+2*$N+1,$x+2*$N+1,$x+2*$N,$x+2*($N-1));return $E},$S.createLine=function($_,$S,$j,$O){var $V=$_.concat(),$M=$_,$R=this.borderColor,$w=($R>>16&255)/255,$a=($R>>8&255)/255,$u=(255&$R)/255;$V.splice(0,5);var $c,$q,$s,$C,$i,$v,$Z,$o,$l,$k,$z,$H,$A,$f,$y,$P,$g,$E,$$,$d,$n=$V.length/5,$J=$O,$F=$j/2;$s=$V[0],$C=$V[1],$k=$s-($i=$V[5]),$l=($l=-($C-($v=$V[6])))/($d=Math.sqrt($l*$l+$k*$k))*$F,$k=$k/$d*$F,$M.push($s-$l,$C-$k,$w,$a,$u,$s+$l,$C+$k,$w,$a,$u);for(var $x=1;$x<$n-1;$x++)$s=$V[5*($x-1)],$C=$V[5*($x-1)+1],$i=$V[5*$x],$v=$V[5*$x+1],$Z=$V[5*($x+1)],$o=$V[5*($x+1)+1],$k=$s-$i,$H=$i-$Z,$y=(-($l=($l=-($C-$v))/($d=Math.sqrt($l*$l+$k*$k))*$F)+$s)*(-($k=$k/$d*$F)+$v)-(-$l+$i)*(-$k+$C),$E=(-($z=($z=-($v-$o))/($d=Math.sqrt($z*$z+$H*$H))*$F)+$Z)*(-($H=$H/$d*$F)+$v)-(-$z+$i)*(-$H+$o),$$=($A=-$k+$C-(-$k+$v))*($g=-$z+$i-(-$z+$Z))-($P=-$H+$o-(-$H+$v))*($f=-$l+$i-(-$l+$s)),Math.abs($$)<.1?($$+=10.1,$M.push($i-$l,$v-$k,$w,$a,$u,$i+$l,$v+$k,$w,$a,$u)):((($c=($f*$E-$g*$y)/$$)-$i)*($c-$i)+(($q=($P*$y-$A*$E)/$$)-$v)+($q-$v),$M.push($c,$q,$w,$a,$u,$i-($c-$i),$v-($q-$v),$w,$a,$u));$s=$V[$V.length-10],$C=$V[$V.length-9],$k=$s-($i=$V[$V.length-5]),$l=($l=-($C-($v=$V[$V.length-4])))/($d=Math.sqrt($l*$l+$k*$k))*$F,$k=$k/$d*$F,$M.push($i-$l,$v-$k,$w,$a,$u,$i+$l,$v+$k,$w,$a,$u);var $h=this.edges+1;for($x=1;$x<$h;$x++)$S.push($J+2*($x-1),$J+2*($x-1)+1,$J+2*$x+1,$J+2*$x+1,$J+2*$x,$J+2*($x-1));return $M},$S.createLoopLine=function($_,$S,$j,$O,$V,$M){var $R=$_.concat(),$w=$V||$_,$a=this.borderColor,$u=($a>>16&255)/255,$c=($a>>8&255)/255,$q=(255&$a)/255;$R.splice(0,5);var $s=[$R[0],$R[1]],$C=[$R[$R.length-5],$R[$R.length-4]],$i=$C[0]+.5*($s[0]-$C[0]),$v=$C[1]+.5*($s[1]-$C[1]);$R.unshift($i,$v,0,0,0),$R.push($i,$v,0,0,0);var $Z,$o,$l,$k,$z,$H,$A,$f,$y,$P,$g,$E,$$,$d,$n,$J,$F,$x,$h,$N,$B=$R.length/5,$t=$O,$m=$j/2;$l=$R[0],$k=$R[1],$P=$l-($z=$R[5]),$y=($y=-($k-($H=$R[6])))/($N=Math.sqrt($y*$y+$P*$P))*$m,$P=$P/$N*$m,$w.push($l-$y,$k-$P,$u,$c,$q,$l+$y,$k+$P,$u,$c,$q);for(var $e=1;$e<$B-1;$e++)$l=$R[5*($e-1)],$k=$R[5*($e-1)+1],$z=$R[5*$e],$H=$R[5*$e+1],$A=$R[5*($e+1)],$f=$R[5*($e+1)+1],$P=$l-$z,$E=$z-$A,$n=(-($y=($y=-($k-$H))/($N=Math.sqrt($y*$y+$P*$P))*$m)+$l)*(-($P=$P/$N*$m)+$H)-(-$y+$z)*(-$P+$k),$x=(-($g=($g=-($H-$f))/($N=Math.sqrt($g*$g+$E*$E))*$m)+$A)*(-($E=$E/$N*$m)+$H)-(-$g+$z)*(-$E+$f),$h=($$=-$P+$k-(-$P+$H))*($F=-$g+$z-(-$g+$A))-($J=-$E+$f-(-$E+$H))*($d=-$y+$z-(-$y+$l)),Math.abs($h)<.1?($h+=10.1,$w.push($z-$y,$H-$P,$u,$c,$q,$z+$y,$H+$P,$u,$c,$q)):((($Z=($d*$x-$F*$n)/$h)-$z)*($Z-$z)+(($o=($J*$n-$$*$x)/$h)-$H)+($o-$H),$w.push($Z,$o,$u,$c,$q,$z-($Z-$z),$H-($o-$H),$u,$c,$q));$M&&($S=$M);var $G=this.edges+1;for($e=1;$e<$G;$e++)$S.push($t+2*($e-1),$t+2*($e-1)+1,$t+2*$e+1,$t+2*$e+1,$t+2*$e,$t+2*($e-1));return $S.push($t+2*($e-1),$t+2*($e-1)+1,$t+1,$t+1,$t,$t+2*($e-1)),$w},$_}(),$O_=function(){function $v(){}return $s($v,"laya.webgl.shapes.Earcut"),$v.earcut=function($_,$S,$j){$j=$j||2;var $O,$V,$M,$R,$w,$a,$u,$c=$S&&$S.length,$q=$c?$S[0]*$j:$_.length,$s=$v.linkedList($_,0,$q,$j,!0),$C=[];if(!$s)return $C;if($c&&($s=$v.eliminateHoles($_,$S,$s,$j)),$_.length>80*$j){$O=$M=$_[0],$V=$R=$_[1];for(var $i=$j;$i<$q;$i+=$j)($w=$_[$i])<$O&&($O=$w),($a=$_[$i+1])<$V&&($V=$a),$M<$w&&($M=$w),$R<$a&&($R=$a);$u=0!==($u=Math.max($M-$O,$R-$V))?1/$u:0}return $v.earcutLinked($s,$C,$j,$O,$V,$u),$C},$v.linkedList=function($_,$S,$j,$O,$V){var $M,$R;if($V===0<$v.signedArea($_,$S,$j,$O))for($M=$S;$M<$j;$M+=$O)$R=$v.insertNode($M,$_[$M],$_[$M+1],$R);else for($M=$j-$O;$S<=$M;$M-=$O)$R=$v.insertNode($M,$_[$M],$_[$M+1],$R);return $R&&$v.equals($R,$R.next)&&($v.removeNode($R),$R=$R.next),$R},$v.filterPoints=function($_,$S){if(!$_)return $_;$S||($S=$_);var $j,$O=$_;do{if($j=!1,$O.steiner||!$v.equals($O,$O.next)&&0!==$v.area($O.prev,$O,$O.next))$O=$O.next;else{if($v.removeNode($O),($O=$S=$O.prev)===$O.next)break;$j=!0}}while($j||$O!==$S);return $S},$v.earcutLinked=function($_,$S,$j,$O,$V,$M,$R){if($_){!$R&&$M&&$v.indexCurve($_,$O,$V,$M);for(var $w,$a,$u=$_;$_.prev!==$_.next;)if($w=$_.prev,$a=$_.next,$M?$v.isEarHashed($_,$O,$V,$M):$v.isEar($_))$S.push($w.i/$j),$S.push($_.i/$j),$S.push($a.i/$j),$v.removeNode($_),$_=$a.next,$u=$a.next;else if(($_=$a)===$u){$R?1===$R?($_=$v.cureLocalIntersections($_,$S,$j),$v.earcutLinked($_,$S,$j,$O,$V,$M,2)):2===$R&&$v.splitEarcut($_,$S,$j,$O,$V,$M):$v.earcutLinked($v.filterPoints($_,null),$S,$j,$O,$V,$M,1);break}}},$v.isEar=function($_){var $S=$_.prev,$j=$_,$O=$_.next;if(0<=$v.area($S,$j,$O))return!1;for(var $V=$_.next.next;$V!==$_.prev;){if($v.pointInTriangle($S.x,$S.y,$j.x,$j.y,$O.x,$O.y,$V.x,$V.y)&&0<=$v.area($V.prev,$V,$V.next))return!1;$V=$V.next}return!0},$v.isEarHashed=function($_,$S,$j,$O){var $V=$_.prev,$M=$_,$R=$_.next;if(0<=$v.area($V,$M,$R))return!1;for(var $w=$V.x<$M.x?$V.x<$R.x?$V.x:$R.x:$M.x<$R.x?$M.x:$R.x,$a=$V.y<$M.y?$V.y<$R.y?$V.y:$R.y:$M.y<$R.y?$M.y:$R.y,$u=$V.x>$M.x?$V.x>$R.x?$V.x:$R.x:$M.x>$R.x?$M.x:$R.x,$c=$V.y>$M.y?$V.y>$R.y?$V.y:$R.y:$M.y>$R.y?$M.y:$R.y,$q=$v.zOrder($w,$a,$S,$j,$O),$s=$v.zOrder($u,$c,$S,$j,$O),$C=$_.nextZ;$C&&$C.z<=$s;){if($C!==$_.prev&&$C!==$_.next&&$v.pointInTriangle($V.x,$V.y,$M.x,$M.y,$R.x,$R.y,$C.x,$C.y)&&0<=$v.area($C.prev,$C,$C.next))return!1;$C=$C.nextZ}for($C=$_.prevZ;$C&&$C.z>=$q;){if($C!==$_.prev&&$C!==$_.next&&$v.pointInTriangle($V.x,$V.y,$M.x,$M.y,$R.x,$R.y,$C.x,$C.y)&&0<=$v.area($C.prev,$C,$C.next))return!1;$C=$C.prevZ}return!0},$v.cureLocalIntersections=function($_,$S,$j){var $O=$_;do{var $V=$O.prev,$M=$O.next.next;!$v.equals($V,$M)&&$v.intersects($V,$O,$O.next,$M)&&$v.locallyInside($V,$M)&&$v.locallyInside($M,$V)&&($S.push($V.i/$j),$S.push($O.i/$j),$S.push($M.i/$j),$v.removeNode($O),$v.removeNode($O.next),$O=$_=$M),$O=$O.next}while($O!==$_);return $O},$v.splitEarcut=function($_,$S,$j,$O,$V,$M){var $R=$_;do{for(var $w=$R.next.next;$w!==$R.prev;){if($R.i!==$w.i&&$v.isValidDiagonal($R,$w)){var $a=$v.splitPolygon($R,$w);return $R=$v.filterPoints($R,$R.next),$a=$v.filterPoints($a,$a.next),$v.earcutLinked($R,$S,$j,$O,$V,$M),void $v.earcutLinked($a,$S,$j,$O,$V,$M)}$w=$w.next}$R=$R.next}while($R!==$_)},$v.eliminateHoles=function($_,$S,$j,$O){var $V,$M,$R,$w,$a,$u=[];for($V=0,$M=$S.length;$V<$M;$V++)$R=$S[$V]*$O,$w=$V<$M-1?$S[$V+1]*$O:$_.length,($a=$v.linkedList($_,$R,$w,$O,!1))===$a.next&&($a.steiner=!0),$u.push($v.getLeftmost($a));for($u.sort($v.compareX),$V=0;$V<$u.length;$V++)$v.eliminateHole($u[$V],$j),$j=$v.filterPoints($j,$j.next);return $j},$v.compareX=function($_,$S){return $_.x-$S.x},$v.eliminateHole=function($_,$S){if($S=$v.findHoleBridge($_,$S)){var $j=$v.splitPolygon($S,$_);$v.filterPoints($j,$j.next)}},$v.findHoleBridge=function($_,$S){var $j,$O=$S,$V=$_.x,$M=$_.y,$R=-1/0;do{if($M<=$O.y&&$M>=$O.next.y&&$O.next.y!==$O.y){var $w=$O.x+($M-$O.y)*($O.next.x-$O.x)/($O.next.y-$O.y);if($w<=$V&&$R<$w){if(($R=$w)===$V){if($M===$O.y)return $O;if($M===$O.next.y)return $O.next}$j=$O.x<$O.next.x?$O:$O.next}}$O=$O.next}while($O!==$S);if(!$j)return null;if($V===$R)return $j.prev;var $a,$u=$j,$c=$j.x,$q=$j.y,$s=1/0;for($O=$j.next;$O!==$u;)$V>=$O.x&&$O.x>=$c&&$V!==$O.x&&$v.pointInTriangle($M<$q?$V:$R,$M,$c,$q,$M<$q?$R:$V,$M,$O.x,$O.y)&&(($a=Math.abs($M-$O.y)/($V-$O.x))<$s||$a===$s&&$O.x>$j.x)&&$v.locallyInside($O,$_)&&($j=$O,$s=$a),$O=$O.next;return $j},$v.indexCurve=function($_,$S,$j,$O){for(var $V=$_;null===$V.z&&($V.z=$v.zOrder($V.x,$V.y,$S,$j,$O)),$V.prevZ=$V.prev,$V.nextZ=$V.next,($V=$V.next)!==$_;);$V.prevZ.nextZ=null,$V.prevZ=null,$v.sortLinked($V)},$v.sortLinked=function($_){var $S,$j,$O,$V,$M,$R,$w,$a,$u=1;do{for($j=$_,$M=$_=null,$R=0;$j;){for($R++,$O=$j,$S=$w=0;$S<$u&&($w++,$O=$O.nextZ);$S++);for($a=$u;0<$w||0<$a&&$O;)0!==$w&&(0===$a||!$O||$j.z<=$O.z)?($j=($V=$j).nextZ,$w--):($O=($V=$O).nextZ,$a--),$M?$M.nextZ=$V:$_=$V,$V.prevZ=$M,$M=$V;$j=$O}$M.nextZ=null,$u*=2}while(1<$R);return $_},$v.zOrder=function($_,$S,$j,$O,$V){return($_=1431655765&(($_=858993459&(($_=252645135&(($_=16711935&(($_=32767*($_-$j)*$V)|$_<<8))|$_<<4))|$_<<2))|$_<<1))|($S=1431655765&(($S=858993459&(($S=252645135&(($S=16711935&(($S=32767*($S-$O)*$V)|$S<<8))|$S<<4))|$S<<2))|$S<<1))<<1},$v.getLeftmost=function($_){for(var $S=$_,$j=$_;$S.x<$j.x&&($j=$S),($S=$S.next)!==$_;);return $j},$v.pointInTriangle=function($_,$S,$j,$O,$V,$M,$R,$w){return 0<=($V-$R)*($S-$w)-($_-$R)*($M-$w)&&0<=($_-$R)*($O-$w)-($j-$R)*($S-$w)&&0<=($j-$R)*($M-$w)-($V-$R)*($O-$w)},$v.isValidDiagonal=function($_,$S){return $_.next.i!==$S.i&&$_.prev.i!==$S.i&&!$v.intersectsPolygon($_,$S)&&$v.locallyInside($_,$S)&&$v.locallyInside($S,$_)&&$v.middleInside($_,$S)},$v.area=function($_,$S,$j){return($S.y-$_.y)*($j.x-$S.x)-($S.x-$_.x)*($j.y-$S.y)},$v.equals=function($_,$S){return $_.x===$S.x&&$_.y===$S.y},$v.intersects=function($_,$S,$j,$O){return!!($v.equals($_,$S)&&$v.equals($j,$O)||$v.equals($_,$O)&&$v.equals($j,$S))||0<$v.area($_,$S,$j)!=0<$v.area($_,$S,$O)&&0<$v.area($j,$O,$_)!=0<$v.area($j,$O,$S)},$v.intersectsPolygon=function($_,$S){var $j=$_;do{if($j.i!==$_.i&&$j.next.i!==$_.i&&$j.i!==$S.i&&$j.next.i!==$S.i&&$v.intersects($j,$j.next,$_,$S))return!0;$j=$j.next}while($j!==$_);return!1},$v.locallyInside=function($_,$S){return $v.area($_.prev,$_,$_.next)<0?0<=$v.area($_,$S,$_.next)&&0<=$v.area($_,$_.prev,$S):$v.area($_,$S,$_.prev)<0||$v.area($_,$_.next,$S)<0},$v.middleInside=function($_,$S){for(var $j=$_,$O=!1,$V=($_.x+$S.x)/2,$M=($_.y+$S.y)/2;$j.y>$M!=$j.next.y>$M&&$j.next.y!==$j.y&&$V<($j.next.x-$j.x)*($M-$j.y)/($j.next.y-$j.y)+$j.x&&($O=!$O),($j=$j.next)!==$_;);return $O},$v.splitPolygon=function($_,$S){var $j=new $V_($_.i,$_.x,$_.y),$O=new $V_($S.i,$S.x,$S.y),$V=$_.next,$M=$S.prev;return($_.next=$S).prev=$_,($j.next=$V).prev=$j,($O.next=$j).prev=$O,($M.next=$O).prev=$M,$O},$v.insertNode=function($_,$S,$j,$O){var $V=new $V_($_,$S,$j);return $O?($V.next=$O.next,($V.prev=$O).next.prev=$V,$O.next=$V):($V.prev=$V).next=$V,$V},$v.removeNode=function($_){$_.next.prev=$_.prev,$_.prev.next=$_.next,$_.prevZ&&($_.prevZ.nextZ=$_.nextZ),$_.nextZ&&($_.nextZ.prevZ=$_.prevZ)},$v.signedArea=function($_,$S,$j,$O){for(var $V=0,$M=$S,$R=$j-$O;$M<$j;$M+=$O)$V+=($_[$R]-$_[$M])*($_[$M+1]+$_[$R+1]),$R=$M;return $V},$v}(),$V_=function(){function $_($_,$S,$j){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$_,this.x=$S,this.y=$j,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $s($_,"laya.webgl.shapes.EarcutNode"),$_}(),$M_=(function(){function $_($_,$S,$j,$O,$V,$M,$R){this.lineWidth=$_,this.lineColor=$S,this.lineAlpha=$j,this.fillColor=$O,this.fillAlpha=$V,this.shape=$R,this.fill=$M}$s($_,"laya.webgl.shapes.GeometryData");var $S=$_.prototype;$S.clone=function(){return new $_(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$S.getIndexData=function(){return null},$S.getVertexData=function(){return null},$S.destroy=function(){this.shape=null}}(),function(){function $_($_){if($_ instanceof Float32Array)this.points=$_;else if($_ instanceof Array){$_.length;this.points=new Float32Array($_)}}$s($_,"laya.webgl.shapes.Vertex");var $S=$_.prototype;$A.imps($S,{"laya.webgl.shapes.IShape":!0}),$S.getData=function($_,$S,$j){},$S.needUpdate=function($_){return!1},$S.rebuild=function($_){},$S.setMatrix=function($_){}}(),function(){function $a($_){void 0===$_&&($_=1e4),this._renderType=$_}$s($a,"laya.webgl.submit.Submit");var $_=$a.prototype;return $A.imps($_,{"laya.webgl.submit.ISubmit":!0}),$_.releaseRender=function(){var $_=$a._cache;($_[$_._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$_.getRenderType=function(){return this._renderType},$_.renderSubmit=function(){if(0===this._numEle)return 1;var $_=this.shaderValue.textureHost;if($_){var $S=$_.source;if(!$_.bitmap||!$S)return 1;this.shaderValue.texture=$S,$_.alphaTexture&&$_.alphaTexture.source&&(this.shaderValue.texture1=$_.alphaTexture.source)}this._vb.bind_upload(this._ib);var $j=$z_.mainContext;return this.shaderValue.upload(),$L.activeBlendFunction!==this._blendFn&&($j.enable(3042),this._blendFn($j),$L.activeBlendFunction=this._blendFn),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,$j.drawElements(4,this._numEle,5123,this._startIdx),1},$a.__init__=function(){var $_=$a.RENDERBASE=new $a(-1);$_.shaderValue=new $y_(0,0),$_.shaderValue.ALPHA=-1234},$a.createSubmit=function($_,$S,$j,$O,$V){var $M=$a._cache._length?$a._cache[--$a._cache._length]:new $a;null==$j&&(($j=$M._selfVb||($M._selfVb=$b_.create(-1))).clear(),$O=0),$M._ib=$S,$M._vb=$j,$M._startIdx=$O*$v_.BYTES_PIDX,$M._numEle=0;var $R=$_._nBlendType;$M._blendFn=$_._targets?$L.targetFns[$R]:$L.fns[$R],$M.shaderValue=$V,$M.shaderValue.setValue($_._shader2D);var $w=$_._shader2D.filters;return $w&&$M.shaderValue.setFilters($w),$M},$a.createShape=function($_,$S,$j,$O,$V,$M){var $R=$a._cache._length?$a._cache[--$a._cache._length]:new $a;$R._ib=$S,$R._vb=$j,$R._numEle=$O,$R._startIdx=$V,$R.shaderValue=$M,$R.shaderValue.setValue($_._shader2D);var $w=$_._nBlendType;return $R._blendFn=$_._targets?$L.targetFns[$w]:$L.fns[$w],$R},$a.TYPE_2D=1e4,$a.TYPE_CANVAS=10003,$a.TYPE_CMDSETRT=10004,$a.TYPE_CUSTOM=10005,$a.TYPE_BLURRT=10006,$a.TYPE_CMDDESTORYPRERT=10007,$a.TYPE_DISABLESTENCIL=10008,$a.TYPE_OTHERIBVB=10009,$a.TYPE_PRIMITIVE=10010,$a.TYPE_RT=10011,$a.TYPE_BLUR_RT=10012,$a.TYPE_TARGET=10013,$a.TYPE_CHANGE_VALUE=10014,$a.TYPE_SHAPE=10015,$a.TYPE_TEXTURE=10016,$a.TYPE_FILLTEXTURE=10017,$a.RENDERBASE=null,$a._cache=(($a._cache=[])._length=0,$a._cache),$a}()),$R_=function(){function $O(){this.fun=null,this.args=null}$s($O,"laya.webgl.submit.SubmitCMD");var $_=$O.prototype;return $A.imps($_,{"laya.webgl.submit.ISubmit":!0}),$_.renderSubmit=function(){return this.fun.apply(null,this.args),1},$_.getRenderType=function(){return 0},$_.releaseRender=function(){var $_=$O._cache;$_[$_._length++]=this},$O.create=function($_,$S){var $j=$O._cache._length?$O._cache[--$O._cache._length]:new $O;return $j.fun=$S,$j.args=$_,$j},$O._cache=(($O._cache=[])._length=0,$O._cache),$O}(),$w_=function(){function $S(){this.variables={}}$s($S,"laya.webgl.submit.SubmitCMDScope");var $_=$S.prototype;return $_.getValue=function($_){return this.variables[$_]},$_.addValue=function($_,$S){return this.variables[$_]=$S},$_.setValue=function($_,$S){return this.variables.hasOwnProperty($_)?this.variables[$_]=$S:null},$_.clear=function(){for(var $_ in this.variables)delete this.variables[$_]},$_.recycle=function(){this.clear(),$S.POOL.push(this)},$S.create=function(){var $_=$S.POOL.pop();return $_||($_=new $S),$_},$S.POOL=[],$S}(),$a_=function(){function $q(){this.offset=0,this.startIndex=0,this._mat=$P.create()}$s($q,"laya.webgl.submit.SubmitOtherIBVB");var $_=$q.prototype;return $A.imps($_,{"laya.webgl.submit.ISubmit":!0}),$_.releaseRender=function(){var $_=$q._cache;($_[$_._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$_.getRenderType=function(){return 10009},$_.renderSubmit=function(){var $_=this._shaderValue.textureHost;if($_){var $S=$_.source;if(!$_.bitmap||!$S)return 1;this._shaderValue.texture=$S}this._vb.bind_upload(this._ib);var $j=$l_.worldMatrix4,$O=$P.TEMP;$P.mulPre(this._mat,$j[0],$j[1],$j[4],$j[5],$j[12],$j[13],$O);var $V=$l_.worldMatrix4=$q.tempMatrix4;$V[0]=$O.a,$V[1]=$O.b,$V[4]=$O.c,$V[5]=$O.d,$V[12]=$O.tx,$V[13]=$O.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $M=$z_.mainContext;return $L.activeBlendFunction!==this._blendFn&&($M.enable(3042),this._blendFn($M),$L.activeBlendFunction=this._blendFn),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,$M.drawElements(4,this._numEle,5123,this.startIndex),$l_.worldMatrix4=$j,$N_.activeShader=null,1},$q.create=function($_,$S,$j,$O,$V,$M,$R,$w,$a){void 0===$a&&($a=0);var $u=$q._cache._length?$q._cache[--$q._cache._length]:new $q;$u._ib=$j,$u._vb=$S,$u._numEle=$O,$u._shader=$V,$u._shaderValue=$M;var $c=$_._nBlendType;switch($u._blendFn=$_._targets?$L.targetFns[$c]:$L.fns[$c],$a){case 0:$u.offset=0,$u.startIndex=$w/($v_.BYTES_PE*$S.vertexStride)*1.5,$u.startIndex*=$v_.BYTES_PIDX;break;case 1:$u.startIndex=$R,$u.offset=$w}return $u},$q._cache=(($q._cache=[])._length=0,$q._cache),$q.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$q}(),$u_=function(){function $j(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $E,this.screenRect=new $E}$s($j,"laya.webgl.submit.SubmitScissor");var $_=$j.prototype;return $A.imps($_,{"laya.webgl.submit.ISubmit":!0}),$_._scissor=function($_,$S,$j,$O){var $V=$l_.worldMatrix4,$M=$V[0],$R=$V[5],$w=$V[12],$a=$V[13];if($O*=$R,($j*=$M)<1||$O<1)return!1;var $u=($_=$_*$M+$w)+$j,$c=($S=$S*$R+$a)+$O;$_<0&&($j=$u-($_=0)),$S<0&&($O=$c-($S=0));var $q=$l_.worldClipRect;if($_=Math.max($_,$q.x),$S=Math.max($S,$q.y),$j=Math.min($u,$q.right)-$_,$O=Math.min($c,$q.bottom)-$S,$j<1||$O<1)return!1;var $s=$l_.worldScissorTest;return this.screenRect.copyFrom($q),$q.x=$_,$q.y=$S,$q.width=$j,$q.height=$O,$l_.worldScissorTest=!0,$S=$l_.height-$S-$O,$z_.mainContext.scissor($_,$S,$j,$O),$z_.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$s?($S=$l_.height-this.screenRect.y-this.screenRect.height,$z_.mainContext.scissor(this.screenRect.x,$S,this.screenRect.width,this.screenRect.height),$z_.mainContext.enable(3089)):($z_.mainContext.disable(3089),$l_.worldScissorTest=!1),$q.copyFrom(this.screenRect),!0},$_._scissorWithTagart=function($_,$S,$j,$O){if($j<1||$O<1)return!1;var $V=$_+$j,$M=$S+$O;$_<0&&($j=$V-($_=0)),$S<0&&($O=$M-($S=0));var $R=$l_.worldClipRect;if($_=Math.max($_,$R.x),$S=Math.max($S,$R.y),$j=Math.min($V,$R.right)-$_,$O=Math.min($M,$R.bottom)-$S,$j<1||$O<1)return!1;var $w=$l_.worldScissorTest;return this.screenRect.copyFrom($R),$l_.worldScissorTest=!0,$R.x=$_,$R.y=$S,$R.width=$j,$R.height=$O,$S=$l_.height-$S-$O,$z_.mainContext.scissor($_,$S,$j,$O),$z_.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$w?($S=$l_.height-this.screenRect.y-this.screenRect.height,$z_.mainContext.scissor(this.screenRect.x,$S,this.screenRect.width,this.screenRect.height),$z_.mainContext.enable(3089)):($z_.mainContext.disable(3089),$l_.worldScissorTest=!1),$R.copyFrom(this.screenRect),!0},$_.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$_.getRenderType=function(){return 0},$_.releaseRender=function(){var $_=$j._cache;($_[$_._length++]=this).context=null},$j.create=function($_){var $S=$j._cache._length?$j._cache[--$j._cache._length]:new $j;return $S.context=$_,$S},$j._cache=(($j._cache=[])._length=0,$j._cache),$j}(),$c_=function(){function $a(){this.step=0,this.blendMode=null,this.level=0}$s($a,"laya.webgl.submit.SubmitStencil");var $_=$a.prototype;return $A.imps($_,{"laya.webgl.submit.ISubmit":!0}),$_.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$_.getRenderType=function(){return 0},$_.releaseRender=function(){var $_=$a._cache;$_[$_._length++]=this},$_.do1=function(){var $_=$z_.mainContext;$_.enable(2960),$_.clear(1024),$_.colorMask(!1,!1,!1,!1),$_.stencilFunc(514,this.level,255),$_.stencilOp(7680,7680,7682)},$_.do2=function(){var $_=$z_.mainContext;$_.stencilFunc(514,this.level+1,255),$_.colorMask(!0,!0,!0,!0),$_.stencilOp(7680,7680,7680)},$_.do3=function(){var $_=$z_.mainContext;$_.colorMask(!0,!0,!0,!0),$_.stencilOp(7680,7680,7680),$_.clear(1024),$_.disable(2960)},$_.do4=function(){var $_=$z_.mainContext;0==this.level&&($_.enable(2960),$_.clear(1024)),$_.colorMask(!1,!1,!1,!1),$_.stencilFunc(519,0,255),$_.stencilOp(7680,7680,7682)},$_.do5=function(){var $_=$z_.mainContext;$_.stencilFunc(514,this.level,255),$_.colorMask(!0,!0,!0,!0),$_.stencilOp(7680,7680,7680)},$_.do6=function(){var $_=$z_.mainContext;$L.targetFns[$L.TOINT[this.blendMode]]($_)},$_.do7=function(){var $_=$z_.mainContext;$_.colorMask(!1,!1,!1,!1),$_.stencilOp(7680,7680,7683)},$_.do8=function(){var $_=$z_.mainContext;$_.colorMask(!0,!0,!0,!0),$_.stencilFunc(514,this.level,255),$_.stencilOp(7680,7680,7680)},$a.restore=function($_,$S,$j,$O,$V){var $M;if(($_._renderKey=0)<$a._mask&&$a._mask--,0==$a._mask)$M=laya.webgl.submit.SubmitStencil.create(3),$_.addRenderObject($M),$_._curSubmit=$M_.RENDERBASE;else{$M=laya.webgl.submit.SubmitStencil.create(7),$_.addRenderObject($M);var $R=$_._vb;$R._byteLength;if($Z_.fillRectImgVb($R,null,$S.x,$S.y,$S.width,$S.height,$h.DEF_UV,$j,$O,$V,0,0)){$_._shader2D.glTexture=null;var $w=$_._curSubmit=$M_.createSubmit($_,$_._ib,$R,($R._byteLength-64)/32*3,$y_.create(2,0));$w.shaderValue.ALPHA=1,$_._submits[$_._submits._length++]=$w,$_._curSubmit._numEle+=6,$_._curSubmit=$M_.RENDERBASE}else alert("clipRect calc stencil rect error");$M=laya.webgl.submit.SubmitStencil.create(8),$_.addRenderObject($M)}},$a.restore2=function($_,$S){var $j;($_._renderKey=0)<$a._mask&&$a._mask--,0==$a._mask?($j=laya.webgl.submit.SubmitStencil.create(3),$_.addRenderObject($j),$_._curSubmit=$M_.RENDERBASE):($j=laya.webgl.submit.SubmitStencil.create(7),$_.addRenderObject($j),$_._submits[$_._submits._length++]=$S,$j=laya.webgl.submit.SubmitStencil.create(8),$_.addRenderObject($j))},$a.create=function($_){var $S=$a._cache._length?$a._cache[--$a._cache._length]:new $a;return 5==($S.step=$_)&&++$a._mask,$S.level=$a._mask,$S},$a._cache=(($a._cache=[])._length=0,$a._cache),$a._mask=0,$a}(),$q_=function(){function $w(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$s($w,"laya.webgl.submit.SubmitTarget");var $_=$w.prototype;return $A.imps($_,{"laya.webgl.submit.ISubmit":!0}),$_.renderSubmit=function(){this._vb.bind_upload(this._ib);var $_=this.scope.getValue(this.proName);return $_&&(this.shaderValue.texture=$_.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$_.width,$_.height]),this.shaderValue.upload(),this.blend(),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,$z_.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$_.blend=function(){if($L.activeBlendFunction!==$L.fns[this.blendType]){var $_=$z_.mainContext;$_.enable(3042),$L.fns[this.blendType]($_),$L.activeBlendFunction=$L.fns[this.blendType]}},$_.getRenderType=function(){return 0},$_.releaseRender=function(){var $_=$w._cache;($_[$_._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$w.create=function($_,$S,$j,$O,$V,$M){var $R=$w._cache._length?$w._cache[--$w._cache._length]:new $w;return $R._ib=$S,$R._vb=$j,$R.proName=$M,$R._startIdx=$O*$v_.BYTES_PIDX,$R._numEle=0,$R.blendType=$_._nBlendType,$R.shaderValue=$V,$R.shaderValue.setValue($_._shader2D),$R},$w._cache=(($w._cache=[])._length=0,$w._cache),$w}(),$s_=function(){function $_(){this._sourceStr=null}$s($_,"laya.webgl.text.CharSegment");var $S=$_.prototype;return $A.imps($S,{"laya.webgl.text.ICharSegment":!0}),$S.textToSpit=function($_){this._sourceStr=$_},$S.getChar=function($_){return this._sourceStr.charAt($_)},$S.getCharCode=function($_){return this._sourceStr.charCodeAt($_)},$S.length=function(){return this._sourceStr.length},$_}(),$C_=function(){var $_;function $n(){}return $s($n,"laya.webgl.text.DrawText"),$n.__init__=function(){$n._charsTemp=new Array,$n._drawValue=new $_,$n._charSeg=new $s_},$n.customCharSeg=function($_){$n._charSeg=$_},$n.getChar=function($_,$S,$j){var $O=$Y_.createOneChar($_,$j);return-1!=$S&&($n._charsCache[$S]=$O),$O},$n._drawSlow=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q,$s,$C,$i){var $v,$Z,$o=$n._drawValue.value($M,$w,$a,$u,$s,$C,$i),$l=0,$k=0,$z=$n._charsTemp,$H=0,$A=NaN;if($O)for($z.length=$O.length,$l=0,$k=$O.length;$l<$k;$l++)($Z=$O[$l])&&($A=$Z.charNum+$o.txtID,$z[$l]=$v=$n._charsCache[$A]||$n.getChar($Z.char,$A,$o),$v.active());else{var $f=$j instanceof laya.utils.WordText?$j.toString():$j;if($x.CharacterCache){$n._charSeg.textToSpit($f);var $y=$n._charSeg.length();for($l=0,$k=$z.length=$y;$l<$k;$l++)$A=$n._charSeg.getCharCode($l)+$o.txtID,$z[$l]=$v=$n._charsCache[$A]||$n.getChar($n._charSeg.getChar($l),$A,$o),$v.active(),$H+=$v.cw}else $z.length=0,($v=$n.getChar($f,-1,$o)).active(),$H+=$v.cw,$z[0]=$v}var $P=0;null!==$R&&"left"!==$R&&($P=-("center"==$R?$H/2:$H));var $g,$E,$$=NaN,$d=0;if($O)for($l=0,$k=$z.length;$l<$k;$l++)$v=$z[$l],$Z=$O[$l],$v&&$Z&&!$v.isSpace&&($$=$v.borderSize,$g=$v.texture,$S._drawText($g,$c+$P+$Z.x*$s-$$,$q+$Z.y*$C-$$,$g.width,$g.height,$V,0,0,0,0));else{for($l=0,$k=$z.length;$l<$k;$l++)($v=$z[$l])&&!$v.isSpace&&($$=$v.borderSize,$g=$v.texture,$S._drawText($g,$c+$P-$$,$q-$$,$g.width,$g.height,$V,0,0,0,0),$_&&(($E=$_[$d++])||($E=$_[$d-1]=[]),$E[0]=$g,$E[1]=$P-$$,$E[2]=-$$)),$P+=$v.cw;$_&&($_.length=$d)}},$n._drawFast=function($_,$S,$j,$O,$V){for(var $M,$R,$w=0,$a=$_.length;$w<$a;$w++)($M=($R=$_[$w])[0]).active(),$S._drawText($M,$O+$R[1],$V+$R[2],$M.width,$M.height,$j,0,0,0,0)},$n.drawText=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q){if(void 0===$q&&($q=0),!($S&&0===$S.length||$j&&0===$j.length)){var $s=$O.a,$C=$O.d;(0!==$O.b||0!==$O.c)&&($s=$C=1);var $i=1!==$s||1!==$C;if($i&&$A.stage.transform){var $v=$A.stage.transform;$i=$v.a===$s&&$v.d===$C}else $i=!1;if($i){var $Z=($O=$O.copyTo($f_._tmpMatrix)).tx,$o=$O.ty;$O.scale(1/$s,1/$C),$O._checkTransform(),$u*=$s,$c*=$C,$u+=$Z-$O.tx,$c+=$o-$O.ty}else $s=$C=1;if($j)$n._drawSlow(null,$_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$s,$C,$q);else{if(null===$S.toUpperCase){var $l=$s+1e5*$C,$k=$S;return void($k.changed||$k.id!==$l?($k.id=$l,$k.changed=!1,$n._drawSlow($k.save,$_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$s,$C,$q)):$n._drawFast($k.save,$_,$O,$u,$c))}var $z=$S+$V.toString()+$R+$w+$a+$s+$C+$M,$H=$n._textsCache[$z];$x.CharacterCache?$H?$n._drawFast($H,$_,$O,$u,$c):($n._textsCache.__length||($n._textsCache.__length=0),$n._textsCache.__length>$f.WebGLTextCacheCount&&(($n._textsCache={}).__length=0,$n._curPoolIndex=0),$n._textCachesPool[$n._curPoolIndex]?($H=$n._textsCache[$z]=$n._textCachesPool[$n._curPoolIndex]).length=0:$n._textCachesPool[$n._curPoolIndex]=$H=$n._textsCache[$z]=[],$n._textsCache.__length++,$n._curPoolIndex++,$n._drawSlow($H,$_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$s,$C,$q)):$n._drawSlow($H,$_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$s,$C,$q)}}},$n._charsTemp=null,$n._textCachesPool=[],$n._curPoolIndex=0,$n._charsCache={},$n._textsCache={},$n._drawValue=null,$n.d=[],$n._charSeg=null,$n.__init$=function(){$_=function(){function $a(){}return $s($a,""),$a.prototype.value=function($_,$S,$j,$O,$V,$M,$R){this.font=$_,this.fillColor=$S,this.borderColor=$j,this.lineWidth=$O,this.scaleX=$V,this.scaleY=$M,this.underLine=$R;var $w=$_.toString()+$V+$M+$O+($S?$S.toLowerCase():" ")+($j?$j.toLowerCase():" ")+$R;return this.txtID=$a._keymap[$w],this.txtID||(this.txtID=1e-7*++$a._keymapCount,$a._keymap[$w]=this.txtID),this},$a.clear=function(){$a._keymap={},$a._keymapCount=1},$a._keymap={},$a._keymapCount=1,$a}()},$n}(),$i_=function(){function $V($_){this._index=0,this._size=14,this._italic=-2,$V._cache2=$V._cache2||[],this.setFont($_||"14px Arial")}$s($V,"laya.webgl.text.FontInContext");var $_=$V.prototype;return $_.setFont=function($_){var $S=$V._cache2[$_];if($S)this._words=$S[0],this._size=$S[1];else{this._words=$_.split(" ");for(var $j=0,$O=this._words.length;$j<$O;$j++)if(0<this._words[$j].indexOf("px")){this._index=$j;break}this._size=parseInt(this._words[this._index]),$V._cache2[$_]=[this._words,this._size]}this._text=null,this._italic=-2},$_.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$_.hasType=function($_){for(var $S=0,$j=this._words.length;$S<$j;$S++)if(this._words[$S]===$_)return $S;return-1},$_.removeType=function($_){for(var $S=0,$j=this._words.length;$S<$j;$S++)if(this._words[$S]===$_){this._words.splice($S,1),this._index>$S&&this._index--;break}this._text=null,this._italic=-2},$_.copyTo=function($_){return $_._text=this._text,$_._size=this._size,$_._index=this._index,$_._words=this._words.slice(),$_._italic=-2,$_},$_.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$O(0,$_,"size",function(){return this._size},function($_){this._size=$_,this._words[this._index]=$_+"px",this._text=null}),$V.create=function($_){var $S=$V._cache[$_];return $S||($S=$V._cache[$_]=new $V($_))},$V.EMPTY=new $V,$V._cache={},$V._cache2=null,$V}(),$v_=function(){function $_(){}return $s($_,"laya.webgl.utils.CONST3D2D"),$_.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$_.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$_.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$_._TMPARRAY=[],$_._OFFSETX=0,$_._OFFSETY=0,$R($_,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$_}(),$Z_=function(){function $i(){}return $s($i,"laya.webgl.utils.GlUtils"),$i.make2DProjection=function($_,$S,$j){return[2/$_,0,0,0,0,-2/$S,0,0,0,0,2/$j,0,-1,1,0,1]},$i.fillIBQuadrangle=function($_,$S){if(65535/4<$S)throw Error("IBQuadrangle count:"+$S+" must<:"+Math.floor(65535/4));$S=Math.floor($S),$_._resizeBuffer(6*($S+1)*2,!1),$_.byteLength=$_.bufferLength;for(var $j=$_.getUint16Array(),$O=0,$V=0;$V<$S;$V++)$j[$O++]=4*$V,$j[$O++]=4*$V+2,$j[$O++]=4*$V+1,$j[$O++]=4*$V,$j[$O++]=4*$V+3,$j[$O++]=4*$V+2;return $_.setNeedUpload(),!0},$i.expandIBQuadrangle=function($_,$S){$_.bufferLength>=6*$S*2||$i.fillIBQuadrangle($_,$S)},$i.mathCeilPowerOfTwo=function($_){return $_--,$_|=$_>>1,$_|=$_>>2,$_|=$_>>4,$_|=$_>>8,$_|=$_>>16,++$_},$i.fillQuadrangleImgVb=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=16+($_._byteLength>>2);$_.byteLength=$a<<2;var $u=$_.getFloat32Array();$u[($a-=16)+2]=$V[0],$u[$a+3]=$V[1],$u[$a+6]=$V[2],$u[$a+7]=$V[3],$u[$a+10]=$V[4],$u[$a+11]=$V[5],$u[$a+14]=$V[6],$u[$a+15]=$V[7];var $c=$M.a,$q=$M.b,$s=$M.c,$C=$M.d;if(1!==$c||0!==$q||0!==$s||1!==$C){$M.bTransform=!0;var $i=$M.tx+$R,$v=$M.ty+$w;$u[$a]=($O[0]+$S)*$c+($O[1]+$j)*$s+$i,$u[$a+1]=($O[0]+$S)*$q+($O[1]+$j)*$C+$v,$u[$a+4]=($O[2]+$S)*$c+($O[3]+$j)*$s+$i,$u[$a+5]=($O[2]+$S)*$q+($O[3]+$j)*$C+$v,$u[$a+8]=($O[4]+$S)*$c+($O[5]+$j)*$s+$i,$u[$a+9]=($O[4]+$S)*$q+($O[5]+$j)*$C+$v,$u[$a+12]=($O[6]+$S)*$c+($O[7]+$j)*$s+$i,$u[$a+13]=($O[6]+$S)*$q+($O[7]+$j)*$C+$v}else $M.bTransform=!1,$S+=$M.tx+$R,$j+=$M.ty+$w,$u[$a]=$S+$O[0],$u[$a+1]=$j+$O[1],$u[$a+4]=$S+$O[2],$u[$a+5]=$j+$O[3],$u[$a+8]=$S+$O[4],$u[$a+9]=$j+$O[5],$u[$a+12]=$S+$O[6],$u[$a+13]=$j+$O[7];return $_._upload=!0},$i.fillTranglesVB=function($_,$S,$j,$O,$V,$M,$R){var $w=($_._byteLength>>2)+$O.length;$_.byteLength=$w<<2;var $a=$_.getFloat32Array();$w-=$O.length;for(var $u=$O.length,$c=$V.a,$q=$V.b,$s=$V.c,$C=$V.d,$i=0;$i<$u;$i+=4)if($a[$w+$i+2]=$O[$i+2],$a[$w+$i+3]=$O[$i+3],1!==$c||0!==$q||0!==$s||1!==$C){$V.bTransform=!0;var $v=$V.tx+$M,$Z=$V.ty+$R;$a[$w+$i]=($O[$i]+$S)*$c+($O[$i+1]+$j)*$s+$v,$a[$w+$i+1]=($O[$i]+$S)*$q+($O[$i+1]+$j)*$C+$Z}else $V.bTransform=!1,$S+=$V.tx+$M,$j+=$V.ty+$R,$a[$w+$i]=$S+$O[$i],$a[$w+$i+1]=$j+$O[$i+1];return $_._upload=!0},$i.copyPreImgVb=function($_,$S,$j){var $O=$_._byteLength>>2;$_.byteLength=$O+16<<2;for(var $V=$_.getFloat32Array(),$M=0,$R=$O-16;$M<4;$M++)$V[$O]=$V[$R]+$S,++$R,$V[++$O]=$V[$R]+$j,++$R,$V[++$O]=$V[$R],++$R,$V[++$O]=$V[$R],++$O,++$R;$_._upload=!0},$i.fillRectImgVb=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q,$s){void 0===$s&&($s=!1);var $C,$i,$v,$Z,$o,$l,$k,$z,$H,$A,$f,$y,$P,$g,$E,$$,$d=1,$n=$w.a,$J=$w.b,$F=$w.c,$x=$w.d,$h=$S&&$S.width<99999999;if(1!==$n||0!==$J||0!==$F||1!==$x?($w.bTransform=!0,0===$J&&0===$F&&($d=23,$H=$V+$j,$A=$M+$O,$C=$n*$j+($f=$w.tx+$a),$v=$n*$H+$f,$i=$x*$O+($y=$w.ty+$u),$Z=$x*$A+$y)):($d=23,$w.bTransform=!1,$v=($C=$j+$w.tx+$a)+$V,$Z=($i=$O+$w.ty+$u)+$M),$h&&($o=$S.x,$l=$S.y,$k=$S.width+$o,$z=$S.height+$l),1!==$d){if(Math.min($C,$v)>=$k)return!1;if(Math.min($i,$Z)>=$z)return!1;if(Math.max($v,$C)<=$o)return!1;if(Math.max($Z,$i)<=$l)return!1}var $N=$_._byteLength>>2;$_.byteLength=16+$N<<2;var $B=$_.getFloat32Array();switch($B[2+$N]=$R[0],$B[3+$N]=$R[1],$B[6+$N]=$R[2],$B[7+$N]=$R[3],$B[10+$N]=$R[4],$B[11+$N]=$R[5],$B[14+$N]=$R[6],$B[15+$N]=$R[7],$d){case 1:$f=$w.tx+$a,$y=$w.ty+$u;var $t=$n*$j,$m=$F*$O,$e=$x*$O,$G=$J*$j,$D=$n*($H=$V+$j),$L=$F*($A=$M+$O),$U=$x*$A,$Q=$J*$H;$s?($P=$t+$m+$f,$E=Math.round($P)-$P,$g=$e+$G+$y,$$=Math.round($g)-$g,$B[$N]=$P+$E,$B[1+$N]=$g+$$,$B[4+$N]=$D+$m+$f+$E,$B[5+$N]=$e+$Q+$y+$$,$B[8+$N]=$D+$L+$f+$E,$B[9+$N]=$U+$Q+$y+$$,$B[12+$N]=$t+$L+$f+$E,$B[13+$N]=$U+$G+$y+$$):($B[$N]=$t+$m+$f,$B[1+$N]=$e+$G+$y,$B[4+$N]=$D+$m+$f,$B[5+$N]=$e+$Q+$y,$B[8+$N]=$D+$L+$f,$B[9+$N]=$U+$Q+$y,$B[12+$N]=$t+$L+$f,$B[13+$N]=$U+$G+$y);break;case 23:$s?($P=$C+$c,$E=Math.round($P)-$P,$g=$i,$$=Math.round($g)-$g,$B[$N]=$P+$E,$B[1+$N]=$g+$$,$B[4+$N]=$v+$c+$E,$B[5+$N]=$i+$$,$B[8+$N]=$v+$E,$B[9+$N]=$Z+$$,$B[12+$N]=$C+$E,$B[13+$N]=$Z+$$):($B[$N]=$C+$c,$B[1+$N]=$i,$B[4+$N]=$v+$c,$B[5+$N]=$i,$B[8+$N]=$v,$B[9+$N]=$Z,$B[12+$N]=$C,$B[13+$N]=$Z)}return $_._upload=!0},$i.fillLineVb=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=.5*$R,$u=$i._fillLineArray,$c=-($O-$M),$q=$j-$V,$s=Math.sqrt($c*$c+$q*$q);$c/=$s,$q/=$s,$c*=$a,$q*=$a,$u[0]=$j-$c,$u[1]=$O-$q,$u[4]=$j+$c,$u[5]=$O+$q,$u[8]=$V+$c,$u[9]=$M+$q,$u[12]=$V-$c,$u[13]=$M-$q,$w&&$w.transformPointArray($u,$u);var $C=16+($_._byteLength>>2);return $_.byteLength=$C<<2,$_.insertData($u,$C-16),!0},$i._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$i}(),$o_=(function(){function $a(){}$s($a,"laya.webgl.utils.MatirxArray"),$a.ArrayMul=function($_,$S,$j){if($_)if($S)for(var $O=NaN,$V=NaN,$M=NaN,$R=NaN,$w=0;$w<4;$w++)$O=$_[$w],$V=$_[$w+4],$M=$_[$w+8],$R=$_[$w+12],$j[$w]=$O*$S[0]+$V*$S[1]+$M*$S[2]+$R*$S[3],$j[$w+4]=$O*$S[4]+$V*$S[5]+$M*$S[6]+$R*$S[7],$j[$w+8]=$O*$S[8]+$V*$S[9]+$M*$S[10]+$R*$S[11],$j[$w+12]=$O*$S[12]+$V*$S[13]+$M*$S[14]+$R*$S[15];else $a.copyArray($_,$j);else $a.copyArray($S,$j)},$a.copyArray=function($_,$S){if($_&&$S)for(var $j=0;$j<$_.length;$j++)$S[$j]=$_[$j]}}(),function(){function $S($_,$S,$j){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$_,this._vb=new $b_($_,35048),$S&&this._vb._resizeBuffer($S,!1),this._ib=new $r_,$j&&this._ib._resizeBuffer($j,!1)}$s($S,"laya.webgl.utils.Mesh2D");var $_=$S.prototype;return $_.cloneWithNewVB=function(){var $_=new $S(this._stride,0,0);return $_._ib=this._ib,$_._quadNum=this._quadNum,$_._attribInfo=this._attribInfo,$_},$_.cloneWithNewVBIB=function(){var $_=new $S(this._stride,0,0);return $_._attribInfo=this._attribInfo,$_},$_.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$_.getVBR=function(){return this._vb},$_.getIBR=function(){return this._ib},$_.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$_.createQuadIB=function($_){this._quadNum=$_,this._ib._resizeBuffer(6*$_*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $S=this._ib.getUint16Array(),$j=0,$O=0,$V=0;$V<$_;$V++)$S[$j++]=$O,$S[$j++]=$O+2,$S[$j++]=$O+1,$S[$j++]=$O,$S[$j++]=$O+3,$S[$j++]=$O+2,$O+=4;this._ib.setNeedUpload()},$_.setAttributes=function($_){if(this._attribInfo=$_,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$_.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$_.releaseMesh=function(){},$_.destroy=function(){},$_.clearVB=function(){this._vb.clear()},$S._gvaoid=0,$S}()),$l_=function(){function $V(){}return $s($V,"laya.webgl.utils.RenderState2D"),$V.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$V.mat2MatArray=function($_,$S){var $j=$_,$O=$S;return $O[0]=$j.a,$O[1]=$j.b,$O[2]=$V.EMPTYMAT4_ARRAY[2],$O[3]=$V.EMPTYMAT4_ARRAY[3],$O[4]=$j.c,$O[5]=$j.d,$O[6]=$V.EMPTYMAT4_ARRAY[6],$O[7]=$V.EMPTYMAT4_ARRAY[7],$O[8]=$V.EMPTYMAT4_ARRAY[8],$O[9]=$V.EMPTYMAT4_ARRAY[9],$O[10]=$V.EMPTYMAT4_ARRAY[10],$O[11]=$V.EMPTYMAT4_ARRAY[11],$O[12]=$j.tx,$O[13]=$j.ty,$O[14]=$V.EMPTYMAT4_ARRAY[14],$O[15]=$V.EMPTYMAT4_ARRAY[15],$S},$V.restoreTempArray=function(){$V.TEMPMAT4_ARRAY[0]=1,$V.TEMPMAT4_ARRAY[1]=0,$V.TEMPMAT4_ARRAY[4]=0,$V.TEMPMAT4_ARRAY[5]=1,$V.TEMPMAT4_ARRAY[12]=0,$V.TEMPMAT4_ARRAY[13]=0},$V.clear=function(){$V.worldScissorTest=!1,$V.worldShaderDefines=null,$V.worldFilters=null,$V.worldAlpha=1,$V.worldClipRect.x=$V.worldClipRect.y=0,$V.worldClipRect.width=$V.width,$V.worldClipRect.height=$V.height,$V.curRenderTarget=null},$V._MAXSIZE=99999999,$V.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$V.worldMatrix4=$V.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$V.worldAlpha=1,$V.worldScissorTest=!1,$V.worldFilters=null,$V.worldShaderDefines=null,$V.curRenderTarget=null,$V.width=0,$V.height=0,$R($V,["worldMatrix",function(){return this.worldMatrix=new $P},"worldClipRect",function(){return this.worldClipRect=new $E(0,0,99999999,99999999)}]),$V}(),$k_=function(){var $l,$j;function $k($_,$S,$j,$O,$V){var $M=this;function $R($_){var $S=[],$j=new $l($S);return $M._compileToTree($j,$_.split("\n"),0,$S,$V),$j}var $w=$C.now();this._VS=$R($S),this._PS=$R($j),this._nameMap=$O,2<$C.now()-$w&&console.log("ShaderCompile use time:"+($C.now()-$w)+"  size:"+$S.length+"/"+$j.length)}$s($k,"laya.webgl.utils.ShaderCompile");var $_=$k.prototype;return $_._compileToTree=function($_,$S,$j,$O,$V){var $M,$R,$w,$a,$u,$c,$q,$s=0,$C=0,$i=0,$v=0;for($C=$j;$C<$S.length;$C++)if(!(($w=$S[$C]).length<1)&&0!==($s=$w.indexOf("//"))){if(0<=$s&&($w=$w.substr(0,$s)),$M=$q||new $l($O),$q=null,$M.text=$w,$M.noCompile=!0,0<=($s=$w.indexOf("#"))){for($a="#",$v=$s+1,$i=$w.length;$v<$i;$v++){var $Z=$w.charAt($v);if(" "===$Z||"\t"===$Z||"\r"===$Z||"\n"===$Z||"?"===$Z)break;$a+=$Z}switch($M.name=$a){case"#ifdef":case"#ifndef":if($M.src=$w,$M.noCompile=null!=$w.match(/[!&|()=<>]/),$M.noCompile?console.log("function():Boolean{return "+$w.substr($s+$M.name.length)+"}"):($c=$w.replace(/^\s*/,"").split(/\s+/),$M.setCondition($c[1],"#ifdef"===$a?1:2),$M.text="//"+$M.text),$M.setParent($_),$_=$M,$V)for($c=$w.substr($v).split($k._splitToWordExps3),$v=0;$v<$c.length;$v++)($w=$c[$v]).length&&($V[$w]=!0);continue;case"#if":if($M.src=$w,$M.noCompile=!0,$M.setParent($_),$_=$M,$V)for($c=$w.substr($v).split($k._splitToWordExps3),$v=0;$v<$c.length;$v++)($w=$c[$v]).length&&"defined"!=$w&&($V[$w]=!0);continue;case"#else":$M.src=$w,$R=($_=$_.parent).childs[$_.childs.length-1],$M.noCompile=$R.noCompile,$M.noCompile||($M.condition=$R.condition,$M.conditionType=1==$R.conditionType?2:1,$M.text="//"+$M.text+" "+$R.text+" "+$M.conditionType),$M.setParent($_),$_=$M;continue;case"#endif":$R=($_=$_.parent).childs[$_.childs.length-1],$M.noCompile=$R.noCompile,$M.noCompile||($M.text="//"+$M.text),$M.setParent($_);continue;case"#include":$c=$k.splitToWords($w,null);var $o=$k.includes[$c[1]];if(!$o)throw"ShaderCompile error no this include file:"+$c[1];if(($s=$c[0].indexOf("?"))<0){$M.setParent($_),$w=$o.getWith("with"==$c[2]?$c[3]:null),this._compileToTree($M,$w.split("\n"),0,$O,$V),$M.text="";continue}$M.setCondition($c[0].substr($s+1),1),$M.text=$o.getWith("with"==$c[2]?$c[3]:null);break;case"#import":$u=($c=$k.splitToWords($w,null))[1],$O.push({node:$M,file:$k.includes[$u],ofs:$M.text.length});continue}}else{if(($R=$_.childs[$_.childs.length-1])&&!$R.name){0<$O.length&&$k.splitToWords($w,$R),$q=$M,$R.text+="\n"+$w;continue}0<$O.length&&$k.splitToWords($w,$M)}$M.setParent($_)}},$_.createShader=function($_,$S,$j){var $O={},$V="";if($_)for(var $M in $_)$V+="#define "+$M+"\n",$O[$M]=!0;var $R=this._VS.toscript($O,[]),$w=this._PS.toscript($O,[]);return($j||$p_.create)($V+$R.join("\n"),$V+$w.join("\n"),$S,this._nameMap)},$k._parseOne=function($_,$S,$j,$O,$V,$M){var $R={type:$k.shaderParamsMap[$j[$O+1]],name:$j[$O+2],size:isNaN(parseInt($j[$O+3]))?1:parseInt($j[$O+3])};return $M&&("attribute"==$V?$_.push($R):$S.push($R)),":"==$j[$O+3]&&($R.type=$j[$O+4],$O+=2),$O+=2},$k.addInclude=function($_,$S){if(!$S||0===$S.length)throw new Error("add shader include file err:"+$_);if($k.includes[$_])throw new Error("add shader include file err, has add:"+$_);$k.includes[$_]=new $j($S)},$k.preGetParams=function($_,$S){var $j=[$_,$S],$O={},$V=[],$M=[],$R={},$w=[];$O.attributes=$V,$O.uniforms=$M,$O.defines=$R;for(var $a=0,$u=0,$c=0;$c<2;$c++){$j[$c]=$j[$c].replace($k._removeAnnotation,"");var $q,$s=$j[$c].match($k._reg);for($a=0,$u=$s.length;$a<$u;$a++){var $C=$s[$a];if("attribute"==$C||"uniform"==$C)$a=$k._parseOne($V,$M,$s,$a,$C,!0);else{if("#define"==$C){$w[$C=$s[++$a]]=1;continue}if("#ifdef"==$C){$R[$q=$s[++$a]]=$R[$q]||[];for($a++;$a<$u;$a++)if("attribute"==($C=$s[$a])||"uniform"==$C)$a=$k._parseOne($V,$M,$s,$a,$C,$w[$q]);else if("#else"==$C)for($a++;$a<$u;$a++)if("attribute"==($C=$s[$a])||"uniform"==$C)$a=$k._parseOne($V,$M,$s,$a,$C,!$w[$q]);else if("#endif"==$C)break}}}}return $O},$k.splitToWords=function($_,$S){for(var $j,$O,$V=[],$M=-1,$R=0,$w=$_.length;$R<$w;$R++)if($j=$_.charAt($R),0<=" \t=+-*/&%!<>()'\",;".indexOf($j)){if(0<=$M&&1<$R-$M&&($O=$_.substr($M,$R-$M),$V.push($O)),'"'==$j||"'"==$j){var $a=$_.indexOf($j,$R+1);if($a<0)throw"Sharder err:"+$_;$V.push($_.substr($R+1,$a-$R-1)),$R=$a,$M=-1;continue}"("==$j&&$S&&0<$V.length&&($O=$V[$V.length-1]+";","vec4;main;".indexOf($O)<0&&($S.useFuns+=$O)),$M=-1}else $M<0&&($M=$R);return $M<$w&&1<$w-$M&&($O=$_.substr($M,$w-$M),$V.push($O)),$V},$k.IFDEF_NO=0,$k.IFDEF_YES=1,$k.IFDEF_ELSE=2,$k.IFDEF_PARENT=3,$k._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$k._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$k._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$k.includes={},$R($k,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$k.__init$=function(){$l=function(){function $j($_){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$_}$s($j,"");var $_=$j.prototype;return $_.setParent=function($_){$_.childs.push(this),this.z=$_.z+1,this.parent=$_},$_.setCondition=function($_,$S){$_&&(this.conditionType=$S,$_=$_.replace(/(\s*$)/g,""),this.condition=function(){return this[$_]},this.condition.__condition=$_)},$_.toscript=function($_,$S){return this._toscript($_,$S,++$j.__id)},$_._toscript=function($O,$V,$M){if(this.childs.length<1&&!this.text)return $V;$V.length;if(this.condition){var $_=!!this.condition.call($O);if(2===this.conditionType&&($_=!$_),!$_)return $V}if(this.text&&$V.push(this.text),0<this.childs.length&&this.childs.forEach(function($_,$S,$j){$_._toscript($O,$V,$M)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $S,$j=0,$R=this.includefiles.length;$j<$R;$j++)this.includefiles[$j].curUseID!=$M&&0<($S=this.includefiles[$j].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$j].curUseID=$M,$V[0]=$S+$V[0]);return $V},$j.__id=1,$j}(),$j=function(){function $_($_){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$_;for(var $S=0,$j=0,$O=0;!(($S=$_.indexOf("#begin",$S))<0);){for($O=$S+5;!(($O=$_.indexOf("#end",$O))<0)&&"i"===$_.charAt($O+4);)$O+=5;if($O<0)throw"add include err,no #end:"+$_;$j=$_.indexOf("\n",$S);var $V=$k.splitToWords($_.substr($S,$j-$S),null);"code"==$V[1]?this.codes[$V[2]]=$_.substr($j+1,$O-$j-1):"function"==$V[1]&&($j=$_.indexOf("function",$S),$j+="function".length,this.funs[$V[3]]=$_.substr($j+1,$O-$j-1),this.funnames+=$V[3]+";"),$S=$O+1}}$s($_,"");var $S=$_.prototype;return $S.getWith=function($_){var $S=$_?this.codes[$_]:this.script;if(!$S)throw"get with error:"+$_;return $S},$S.getFunsScript=function($_){var $S="";for(var $j in this.funs)0<=$_.indexOf($j+";")&&($S+=this.funs[$j]);return $S},$_}()},$k}(),$z_=function(){function $R(){}return $s($R,"laya.webgl.WebGL"),$R._uint8ArraySlice=function(){for(var $_=this.length,$S=new Uint8Array(this.length),$j=0;$j<$_;$j++)$S[$j]=this[$j];return $S},$R._float32ArraySlice=function(){for(var $_=this.length,$S=new Float32Array(this.length),$j=0;$j<$_;$j++)$S[$j]=this[$j];return $S},$R._uint16ArraySlice=function($_){var $S,$j=arguments,$O=0,$V=0;if(0===$j.length)for($O=this.length,$S=new Uint16Array($O),$V=0;$V<$O;$V++)$S[$V]=this[$V];else if(2===$j.length){var $M=$j[0],$R=$j[1];if($M<$R)for($O=$R-$M,$S=new Uint16Array($O),$V=$M;$V<$R;$V++)$S[$V-$M]=this[$V];else $S=new Uint16Array(0)}return $S},$R.expandContext=function(){var $_=$V.prototype,$S=CanvasRenderingContext2D.prototype;$S.fillTrangles=$_.fillTrangles,$I_.__int__(null),$S.setIBVB=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){void 0===$a&&($a=0),void 0===$u&&($u=0),null===$j&&(this._ib=this._ib||$r_.QuadrangleIB,$j=this._ib,$Z_.expandIBQuadrangle($j,$O._byteLength/64+8)),this._setIBVB($_,$S,$j,$O,$V,$M,$R,$w,$a,$u)},$S.fillTrangles=function($_,$S,$j,$O,$V){this._curMat=this._curMat||$P.create(),this._vb=this._vb||$b_.create(),this._ib||(this._ib=$r_.create(),$Z_.fillIBQuadrangle(this._ib,$R/4));var $M=this._vb,$R=$O.length>>4;$Z_.fillTranglesVB($M,$S,$j,$O,$V||this._curMat,0,0),$Z_.expandIBQuadrangle(this._ib,$M._byteLength/64+8);var $w=new $y_(1,0);$w.textureHost=$_;var $a=new $X_("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$M._vertType=3,this._setIBVB($S,$j,this._ib,$M,6*$R,$V,$a,$w,0,0)}},$R.enable=function(){if($C.__init__(),$o.isConchApp&&!$o.isConchWebGL)return $H.skinAniSprite=function(){return new $__},$R.expandContext(),!1;if($H.getWebGLContext=function($_){for(var $S,$j=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$O=0;$O<$j.length;$O++){try{$S=$_.getContext($j[$O],{stencil:$f.isStencil,alpha:$f.isAlpha,antialias:$f.isAntialias,premultipliedAlpha:$f.premultipliedAlpha,preserveDrawingBuffer:$f.preserveDrawingBuffer})}catch($_){}if($S)return $S}return null},null==($R.mainContext=$R.mainContext||$H.getWebGLContext($o._mainCanvas)))return!1;if($o.isWebGL)return!0;$v.create=function($_,$S){return new $_S($_,$S)},$Z.create=function($_,$S,$j,$O,$V,$M,$R){return new $W_($_,$S,$j,$O,$V,$M,$R)},$o.WebGL=$R,$o.isWebGL=!0,$C_.__init__(),$H.createRenderSprite=function($_,$S){return new $P_($_,$S)},$H.createWebGLContext2D=function($_){return new $f_($_)},$H.changeWebGLSize=function($_,$S){laya.webgl.WebGL.onStageResize($_,$S)},$H.createGraphics=function(){return new $A_};var $_=$H.createFilterAction;return $H.createFilterAction=$_||function($_){return new $g_},$H.clear=function($_){$l_.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $S=$o.context.ctx,$j=0==$S._submits._length||$f.preserveDrawingBuffer?$i.create($_)._color:$d._wgColor;$j&&$S.clearBG($j[0],$j[1],$j[2],$j[3]),$l_.clear()},$H.addToAtlas=function($_,$S){void 0===$S&&($S=!1);var $j=$_.bitmap;$o.optimizeTextureMemory($_.url,$_)?$A.__typeof($j,"laya.webgl.resource.IMergeAtlasBitmap")&&$j.allowMerageInAtlas&&$j.on("recovered",$_,$_.addTextureToAtlas):$j.enableMerageInAtlas=!1},$H.isAtlas=function($_){return $_ instanceof laya.webgl.atlas.AtlasWebGLCanvas},$G._enable(),$H.beginFlush=function(){for(var $_=$G.instance,$S=$_.getAtlaserCount(),$j=0;$j<$S;$j++){var $O=$_.getAtlaserByIndex($j).texture;$O._flashCacheImageNeedFlush&&$H.flashFlushImage($O)}},$H.drawToCanvas=function($_,$S,$j,$O,$V,$M){($j<=0||$O<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$j|=0,$O|=0,$V|=0,$M|=0;var $R=$B_.create($j,$O,6408,5121,0,!1);$R.start(),$R.clear(0,0,0,0),$o.context.clear(),$l.renders[$S]._fun($_,$o.context,$V,$l_.height-$O+$M),$o.context.flush(),$R.end();var $w=$R.getData(0,0,$j,$O);if($R.recycle(),$w.byteLength==$j*$O*4){var $a=new $Q_;$a._canvas=$C.createElement("canvas"),$a.size($j,$O);var $u=$a._canvas.getContext("2d");$C.canvas.size($j,$O);var $c=$C.context,$q=$c.createImageData($j,$O);return $q.data.set(new Uint8ClampedArray($w.buffer)),$a._imgData=$q,$c.putImageData($q,0,0),$u.save(),$u.translate(0,$O),$u.scale(1,-1),$u.drawImage($C.canvas.source,0,0),$u.restore(),$a}console.log("drawToCanvas error: w:"+$j+",h:"+$O+",datalen:"+$w.byteLength)},$H.createFilterAction=function($_){var $S;switch($_){case 32:$S=new $g_}return $S},$H.addTextureToAtlas=function($_){$_._uvID++,$G._atlasRestore++,$_.bitmap.enableMerageInAtlas&&$G.instance.addToAtlas($_)},$H.getTexturePixels=function($_,$S,$j,$O,$V){$o.context.ctx.clear();var $M=new $$;$M.graphics.drawTexture($_,-$S,-$j);var $R=$B_.create($O,$V);$R.start(),$R.clear(0,0,0,0),$M.render($o.context,0,0),$o.context.ctx.flush(),$R.end();for(var $w=$R.getData(0,0,$O,$V),$a=[],$u=0,$c=$V-1;0<=$c;$c--)for(var $q=0;$q<$O;$q++)$u=4*($c*$O+$q),$a.push($w[$u]),$a.push($w[$u+1]),$a.push($w[$u+2]),$a.push($w[$u+3]);return $a},$H.skinAniSprite=function(){return new $__},$u.create=function($_,$S){var $j=new $Q_;return $j._imgData=$S,$j.flipY=!1,$j},$y._filterStart=function($_,$S,$j,$O,$V){var $M=$_.getValue("bounds"),$R=$B_.create($M.width,$M.height);if($R.start(),$R.clear(0,0,0,0),$_.addValue("src",$R),$_.addValue("ScissorTest",$l_.worldScissorTest),$l_.worldScissorTest){var $w=new $E;$w.copyFrom($j.ctx._clipRect),$_.addValue("clipRect",$w),$l_.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$y._filterEnd=function($_,$S,$j,$O,$V){var $M=$_.getValue("bounds");$_.getValue("src").end();var $R=$B_.create($M.width,$M.height);$R.start(),$R.clear(0,0,0,0),$_.addValue("out",$R),$S._set$P("_filterCache",$R),$S._set$P("_isHaveGlowFilter",$_.getValue("_isHaveGlowFilter"))},$y._EndTarget=function($_,$S){if($_.getValue("src").recycle(),$_.getValue("out").end(),$_.getValue("ScissorTest")){$l_.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$S.ctx.save();var $j=$_.getValue("clipRect");$S.ctx.clipRect($j.x,$j.y,$j.width,$j.height)}},$y._useSrc=function($_){var $S=$_.getValue("out");$S.end(),($S=$_.getValue("src")).start(),$S.clear(0,0,0,0)},$y._endSrc=function($_){$_.getValue("src").end()},$y._useOut=function($_){var $S=$_.getValue("src");$S.end(),($S=$_.getValue("out")).start(),$S.clear(0,0,0,0)},$y._endOut=function($_){$_.getValue("out").end()},$y._recycleScope=function($_){$_.recycle()},$y._filter=function($_,$S,$j,$O){var $V=this._next;if($V){var $M,$R,$w=$_.filters,$a=$w.length;if(1==$a&&32==$w[0].type)return $S.ctx.save(),$S.ctx.setFilters([$w[0]]),$V._fun.call($V,$_,$S,$j,$O),void $S.ctx.restore();var $u=$w_.create(),$c=$g.TEMP,$q=$S.ctx._getTransformMatrix(),$s=$P.create();$q.copyTo($s);var $C=0,$i=0,$v=!1,$Z=$_._$P._filterCache?$_._$P._filterCache:null;if(!$Z||$_._repaint){$v=$_._isHaveGlowFilter(),$u.addValue("_isHaveGlowFilter",$v),$v&&($C=50,$i=25),($R=new $E).copyFrom($_.getSelfBounds()),$R.x+=$_.x,$R.y+=$_.y,$R.x-=$_.pivotX+4,$R.y-=$_.pivotY+4;var $o=$R.x,$l=$R.y;if($R.width+=$C+8,$R.height+=$C+8,$c.x=$R.x*$s.a+$R.y*$s.c,$c.y=$R.y*$s.d+$R.x*$s.b,$R.x=$c.x,$R.y=$c.y,$c.x=$R.width*$s.a+$R.height*$s.c,$c.y=$R.height*$s.d+$R.width*$s.b,$R.width=$c.x,$R.height=$c.y,$R.width<=0||$R.height<=0)return;$Z&&$Z.recycle(),$u.addValue("bounds",$R);var $k=$R_.create([$u,$_,$S,0,0],$y._filterStart);$S.addRenderObject($k),$S.ctx._renderKey=0,$S.ctx._shader2D.glTexture=null;var $z=$_.x-$o+$i,$H=$_.y-$l+$i;$V._fun.call($V,$_,$S,$z,$H),$k=$R_.create([$u,$_,$S,0,0],$y._filterEnd),$S.addRenderObject($k);for(var $A=0;$A<$a;$A++){0!=$A&&($k=$R_.create([$u],$y._useSrc),$S.addRenderObject($k),$M=$y_.create(1,0),$P.TEMP.identity(),$S.ctx.drawTarget($u,0,0,$R.width,$R.height,$P.TEMP,"out",$M,null,$L.TOINT.overlay),$k=$R_.create([$u],$y._useOut),$S.addRenderObject($k)),$w[$A].action.apply3d($u,$_,$S,0,0)}$k=$R_.create([$u,$S],$y._EndTarget),$S.addRenderObject($k)}else{if(($v=!!$_._$P._isHaveGlowFilter&&$_._$P._isHaveGlowFilter)&&($C=50,$i=25),($R=$_.getBounds()).width<=0||$R.height<=0)return;$R.width+=$C,$R.height+=$C,$c.x=$R.x*$s.a+$R.y*$s.c,$c.y=$R.y*$s.d+$R.x*$s.b,$R.x=$c.x,$R.y=$c.y,$c.x=$R.width*$s.a+$R.height*$s.c,$c.y=$R.height*$s.d+$R.width*$s.b,$R.width=$c.x,$R.height=$c.y,$u.addValue("out",$Z)}$j=$j-$i-$_.x,$O=$O-$i-$_.y,$c.setTo($j,$O),$s.transformPoint($c),$j=$c.x+$R.x,$O=$c.y+$R.y,$M=$y_.create(1,0),$P.TEMP.identity(),$S.ctx.drawTarget($u,$j,$O,$R.width,$R.height,$P.TEMP,"out",$M,null,$L.TOINT.overlay),$k=$R_.create([$u],$y._recycleScope),$S.addRenderObject($k),$s.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$R._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$R._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$R._uint8ArraySlice),!0},$R.onStageResize=function($_,$S){null!=$R.mainContext&&($R.mainContext.viewport(0,0,$_,$S),$l_.width=$_,$l_.height=$S)},$R.onInvalidGLRes=function(){$G.instance.freeAll(),$z.releaseContentManagers(!0),$R.doNodeRepaint($A.stage),$R.mainContext.viewport(0,0,$l_.width,$l_.height),$A.stage.event("devicelost")},$R.doNodeRepaint=function($_){0==$_.numChildren&&$_.repaint();for(var $S=0;$S<$_.numChildren;$S++)$R.doNodeRepaint($_.getChildAt($S))},$R.init=function($_,$S,$j){$R.mainCanvas=$_,$u._createContext=function($_){return new $f_($_)},$Q_._createContext=function($_){return new $f_($_)};var $O=laya.webgl.WebGL.mainContext;if(null!=$O.getShaderPrecisionFormat){var $V=$O.getShaderPrecisionFormat(35633,36338),$M=$O.getShaderPrecisionFormat(35632,36338);$R.shaderHighPrecision=!(!$V.precision||!$M.precision)}else $R.shaderHighPrecision=!1;if($R.compressAstc=$O.getExtension("WEBGL_compressed_texture_astc"),$R.compressAtc=$O.getExtension("WEBGL_compressed_texture_atc"),$R.compressEtc=$O.getExtension("WEBGL_compressed_texture_etc"),$R.compressEtc1=$O.getExtension("WEBGL_compressed_texture_etc1"),$R.compressPvrtc=$O.getExtension("WEBGL_compressed_texture_pvrtc"),$R.compressS3tc=$O.getExtension("WEBGL_compressed_texture_s3tc"),$R.compressS3tc_srgb=$O.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$R.compressAstc=$R.compressAstc?$R.compressAstc:{},$R.compressAtc=$R.compressAtc?$R.compressAtc:{},$R.compressEtc=$R.compressEtc?$R.compressEtc:{},$R.compressEtc1=$R.compressEtc1?$R.compressEtc1:{},$R.compressPvrtc=$R.compressPvrtc?$R.compressPvrtc:{},$R.compressS3tc=$R.compressS3tc?$R.compressS3tc:{},$R.compressS3tc_srgb=$R.compressS3tc_srgb?$R.compressS3tc_srgb:{},$O.deleteTexture1=$O.deleteTexture,$O.deleteTexture=function($_){$_==$H_.curBindTexValue&&($H_.curBindTexValue=null),$O.deleteTexture1($_)},$R.onStageResize($S,$j),null==$R.mainContext)throw new Error("webGL getContext err!");$F.__init__(),$G.__init__(),$$_.__init__(),$M_.__init__(),$f_.__init__(),$y_.__init__(),$r.__init__(),$I_.__int__($O),$L._init_($O),$o.isConchApp&&conch.setOnInvalidGLRes($R.onInvalidGLRes)},$R.mainCanvas=null,$R.antialias=!0,$R.shaderHighPrecision=!1,$R._bg_null=[0,0,0,0],$R}(),$H_=function(){function $O(){}return $s($O,"laya.webgl.WebGLContext"),$O.UseProgram=function($_){return $O._useProgram!==$_&&($z_.mainContext.useProgram($_),$O._useProgram=$_,!0)},$O.setDepthTest=function($_,$S){$S!==$O._depthTest&&(($O._depthTest=$S)?$_.enable(2929):$_.disable(2929))},$O.setDepthMask=function($_,$S){$S!==$O._depthMask&&($O._depthMask=$S,$_.depthMask($S))},$O.setDepthFunc=function($_,$S){$S!==$O._depthFunc&&($O._depthFunc=$S,$_.depthFunc($S))},$O.setBlend=function($_,$S){$S!==$O._blend&&(($O._blend=$S)?$_.enable(3042):$_.disable(3042))},$O.setBlendFunc=function($_,$S,$j){($S!==$O._sFactor||$j!==$O._dFactor)&&($O._sFactor=$S,$O._dFactor=$j,$_.blendFunc($S,$j))},$O.setCullFace=function($_,$S){$S!==$O._cullFace&&(($O._cullFace=$S)?$_.enable(2884):$_.disable(2884))},$O.setFrontFace=function($_,$S){$S!==$O._frontFace&&($O._frontFace=$S,$_.frontFace($S))},$O.bindTexture=function($_,$S,$j){$_.bindTexture($S,$j),$O.curBindTexTarget=$S,$O.curBindTexValue=$j},$O.DEPTH_BUFFER_BIT=256,$O.STENCIL_BUFFER_BIT=1024,$O.COLOR_BUFFER_BIT=16384,$O.POINTS=0,$O.LINES=1,$O.LINE_LOOP=2,$O.LINE_STRIP=3,$O.TRIANGLES=4,$O.TRIANGLE_STRIP=5,$O.TRIANGLE_FAN=6,$O.ZERO=0,$O.ONE=1,$O.SRC_COLOR=768,$O.ONE_MINUS_SRC_COLOR=769,$O.SRC_ALPHA=770,$O.ONE_MINUS_SRC_ALPHA=771,$O.DST_ALPHA=772,$O.ONE_MINUS_DST_ALPHA=773,$O.DST_COLOR=774,$O.ONE_MINUS_DST_COLOR=775,$O.SRC_ALPHA_SATURATE=776,$O.FUNC_ADD=32774,$O.BLEND_EQUATION=32777,$O.BLEND_EQUATION_RGB=32777,$O.BLEND_EQUATION_ALPHA=34877,$O.FUNC_SUBTRACT=32778,$O.FUNC_REVERSE_SUBTRACT=32779,$O.BLEND_DST_RGB=32968,$O.BLEND_SRC_RGB=32969,$O.BLEND_DST_ALPHA=32970,$O.BLEND_SRC_ALPHA=32971,$O.CONSTANT_COLOR=32769,$O.ONE_MINUS_CONSTANT_COLOR=32770,$O.CONSTANT_ALPHA=32771,$O.ONE_MINUS_CONSTANT_ALPHA=32772,$O.BLEND_COLOR=32773,$O.ARRAY_BUFFER=34962,$O.ELEMENT_ARRAY_BUFFER=34963,$O.ARRAY_BUFFER_BINDING=34964,$O.ELEMENT_ARRAY_BUFFER_BINDING=34965,$O.STREAM_DRAW=35040,$O.STATIC_DRAW=35044,$O.DYNAMIC_DRAW=35048,$O.BUFFER_SIZE=34660,$O.BUFFER_USAGE=34661,$O.CURRENT_VERTEX_ATTRIB=34342,$O.FRONT=1028,$O.BACK=1029,$O.CULL_FACE=2884,$O.FRONT_AND_BACK=1032,$O.BLEND=3042,$O.DITHER=3024,$O.STENCIL_TEST=2960,$O.DEPTH_TEST=2929,$O.SCISSOR_TEST=3089,$O.POLYGON_OFFSET_FILL=32823,$O.SAMPLE_ALPHA_TO_COVERAGE=32926,$O.SAMPLE_COVERAGE=32928,$O.NO_ERROR=0,$O.INVALID_ENUM=1280,$O.INVALID_VALUE=1281,$O.INVALID_OPERATION=1282,$O.OUT_OF_MEMORY=1285,$O.CW=2304,$O.CCW=2305,$O.LINE_WIDTH=2849,$O.ALIASED_POINT_SIZE_RANGE=33901,$O.ALIASED_LINE_WIDTH_RANGE=33902,$O.CULL_FACE_MODE=2885,$O.FRONT_FACE=2886,$O.DEPTH_RANGE=2928,$O.DEPTH_WRITEMASK=2930,$O.DEPTH_CLEAR_VALUE=2931,$O.DEPTH_FUNC=2932,$O.STENCIL_CLEAR_VALUE=2961,$O.STENCIL_FUNC=2962,$O.STENCIL_FAIL=2964,$O.STENCIL_PASS_DEPTH_FAIL=2965,$O.STENCIL_PASS_DEPTH_PASS=2966,$O.STENCIL_REF=2967,$O.STENCIL_VALUE_MASK=2963,$O.STENCIL_WRITEMASK=2968,$O.STENCIL_BACK_FUNC=34816,$O.STENCIL_BACK_FAIL=34817,$O.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$O.STENCIL_BACK_PASS_DEPTH_PASS=34819,$O.STENCIL_BACK_REF=36003,$O.STENCIL_BACK_VALUE_MASK=36004,$O.STENCIL_BACK_WRITEMASK=36005,$O.VIEWPORT=2978,$O.SCISSOR_BOX=3088,$O.COLOR_CLEAR_VALUE=3106,$O.COLOR_WRITEMASK=3107,$O.UNPACK_ALIGNMENT=3317,$O.PACK_ALIGNMENT=3333,$O.MAX_TEXTURE_SIZE=3379,$O.MAX_VIEWPORT_DIMS=3386,$O.SUBPIXEL_BITS=3408,$O.RED_BITS=3410,$O.GREEN_BITS=3411,$O.BLUE_BITS=3412,$O.ALPHA_BITS=3413,$O.DEPTH_BITS=3414,$O.STENCIL_BITS=3415,$O.POLYGON_OFFSET_UNITS=10752,$O.POLYGON_OFFSET_FACTOR=32824,$O.TEXTURE_BINDING_2D=32873,$O.SAMPLE_BUFFERS=32936,$O.SAMPLES=32937,$O.SAMPLE_COVERAGE_VALUE=32938,$O.SAMPLE_COVERAGE_INVERT=32939,$O.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$O.COMPRESSED_TEXTURE_FORMATS=34467,$O.DONT_CARE=4352,$O.FASTEST=4353,$O.NICEST=4354,$O.GENERATE_MIPMAP_HINT=33170,$O.BYTE=5120,$O.UNSIGNED_BYTE=5121,$O.SHORT=5122,$O.UNSIGNED_SHORT=5123,$O.INT=5124,$O.UNSIGNED_INT=5125,$O.FLOAT=5126,$O.DEPTH_COMPONENT=6402,$O.ALPHA=6406,$O.RGB=6407,$O.RGBA=6408,$O.LUMINANCE=6409,$O.LUMINANCE_ALPHA=6410,$O.UNSIGNED_SHORT_4_4_4_4=32819,$O.UNSIGNED_SHORT_5_5_5_1=32820,$O.UNSIGNED_SHORT_5_6_5=33635,$O.FRAGMENT_SHADER=35632,$O.VERTEX_SHADER=35633,$O.MAX_VERTEX_ATTRIBS=34921,$O.MAX_VERTEX_UNIFORM_VECTORS=36347,$O.MAX_VARYING_VECTORS=36348,$O.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$O.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$O.MAX_TEXTURE_IMAGE_UNITS=34930,$O.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$O.SHADER_TYPE=35663,$O.DELETE_STATUS=35712,$O.LINK_STATUS=35714,$O.VALIDATE_STATUS=35715,$O.ATTACHED_SHADERS=35717,$O.ACTIVE_UNIFORMS=35718,$O.ACTIVE_ATTRIBUTES=35721,$O.SHADING_LANGUAGE_VERSION=35724,$O.CURRENT_PROGRAM=35725,$O.NEVER=512,$O.LESS=513,$O.EQUAL=514,$O.LEQUAL=515,$O.GREATER=516,$O.NOTEQUAL=517,$O.GEQUAL=518,$O.ALWAYS=519,$O.KEEP=7680,$O.REPLACE=7681,$O.INCR=7682,$O.DECR=7683,$O.INVERT=5386,$O.INCR_WRAP=34055,$O.DECR_WRAP=34056,$O.VENDOR=7936,$O.RENDERER=7937,$O.VERSION=7938,$O.NEAREST=9728,$O.LINEAR=9729,$O.NEAREST_MIPMAP_NEAREST=9984,$O.LINEAR_MIPMAP_NEAREST=9985,$O.NEAREST_MIPMAP_LINEAR=9986,$O.LINEAR_MIPMAP_LINEAR=9987,$O.TEXTURE_MAG_FILTER=10240,$O.TEXTURE_MIN_FILTER=10241,$O.TEXTURE_WRAP_S=10242,$O.TEXTURE_WRAP_T=10243,$O.TEXTURE_2D=3553,$O.TEXTURE=5890,$O.TEXTURE_CUBE_MAP=34067,$O.TEXTURE_BINDING_CUBE_MAP=34068,$O.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$O.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$O.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$O.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$O.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$O.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$O.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$O.TEXTURE0=33984,$O.TEXTURE1=33985,$O.TEXTURE2=33986,$O.TEXTURE3=33987,$O.TEXTURE4=33988,$O.TEXTURE5=33989,$O.TEXTURE6=33990,$O.TEXTURE7=33991,$O.TEXTURE8=33992,$O.TEXTURE9=33993,$O.TEXTURE10=33994,$O.TEXTURE11=33995,$O.TEXTURE12=33996,$O.TEXTURE13=33997,$O.TEXTURE14=33998,$O.TEXTURE15=33999,$O.TEXTURE16=34e3,$O.TEXTURE17=34001,$O.TEXTURE18=34002,$O.TEXTURE19=34003,$O.TEXTURE20=34004,$O.TEXTURE21=34005,$O.TEXTURE22=34006,$O.TEXTURE23=34007,$O.TEXTURE24=34008,$O.TEXTURE25=34009,$O.TEXTURE26=34010,$O.TEXTURE27=34011,$O.TEXTURE28=34012,$O.TEXTURE29=34013,$O.TEXTURE30=34014,$O.TEXTURE31=34015,$O.ACTIVE_TEXTURE=34016,$O.REPEAT=10497,$O.CLAMP_TO_EDGE=33071,$O.MIRRORED_REPEAT=33648,$O.FLOAT_VEC2=35664,$O.FLOAT_VEC3=35665,$O.FLOAT_VEC4=35666,$O.INT_VEC2=35667,$O.INT_VEC3=35668,$O.INT_VEC4=35669,$O.BOOL=35670,$O.BOOL_VEC2=35671,$O.BOOL_VEC3=35672,$O.BOOL_VEC4=35673,$O.FLOAT_MAT2=35674,$O.FLOAT_MAT3=35675,$O.FLOAT_MAT4=35676,$O.SAMPLER_2D=35678,$O.SAMPLER_CUBE=35680,$O.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$O.VERTEX_ATTRIB_ARRAY_SIZE=34339,$O.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$O.VERTEX_ATTRIB_ARRAY_TYPE=34341,$O.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$O.VERTEX_ATTRIB_ARRAY_POINTER=34373,$O.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$O.COMPILE_STATUS=35713,$O.LOW_FLOAT=36336,$O.MEDIUM_FLOAT=36337,$O.HIGH_FLOAT=36338,$O.LOW_INT=36339,$O.MEDIUM_INT=36340,$O.HIGH_INT=36341,$O.FRAMEBUFFER=36160,$O.RENDERBUFFER=36161,$O.RGBA4=32854,$O.RGB5_A1=32855,$O.RGB565=36194,$O.DEPTH_COMPONENT16=33189,$O.STENCIL_INDEX=6401,$O.STENCIL_INDEX8=36168,$O.DEPTH_STENCIL=34041,$O.RENDERBUFFER_WIDTH=36162,$O.RENDERBUFFER_HEIGHT=36163,$O.RENDERBUFFER_INTERNAL_FORMAT=36164,$O.RENDERBUFFER_RED_SIZE=36176,$O.RENDERBUFFER_GREEN_SIZE=36177,$O.RENDERBUFFER_BLUE_SIZE=36178,$O.RENDERBUFFER_ALPHA_SIZE=36179,$O.RENDERBUFFER_DEPTH_SIZE=36180,$O.RENDERBUFFER_STENCIL_SIZE=36181,$O.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$O.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$O.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$O.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$O.COLOR_ATTACHMENT0=36064,$O.DEPTH_ATTACHMENT=36096,$O.STENCIL_ATTACHMENT=36128,$O.DEPTH_STENCIL_ATTACHMENT=33306,$O.NONE=0,$O.FRAMEBUFFER_COMPLETE=36053,$O.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$O.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$O.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$O.FRAMEBUFFER_UNSUPPORTED=36061,$O.FRAMEBUFFER_BINDING=36006,$O.RENDERBUFFER_BINDING=36007,$O.MAX_RENDERBUFFER_SIZE=34024,$O.INVALID_FRAMEBUFFER_OPERATION=1286,$O.UNPACK_FLIP_Y_WEBGL=37440,$O.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$O.CONTEXT_LOST_WEBGL=37442,$O.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$O.BROWSER_DEFAULT_WEBGL=37444,$O._useProgram=null,$O._depthTest=!0,$O._depthMask=!0,$O._blend=!1,$O._cullFace=!1,$O.curBindTexTarget=null,$O.curBindTexValue=null,$R($O,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$O}(),$A_=function($_){function $S(){$S.__super.call(this)}$s($S,"laya.webgl.display.GraphicsGL",$w);var $j=$S.prototype;return $j.setShader=function($_){this._saveToCmd($o.context._setShader,[$_])},$j.setIBVB=function($_,$S,$j,$O,$V,$M){this._saveToCmd($o.context._setIBVB,[$_,$S,$j,$O,$V,$M])},$j.drawParticle=function($_,$S,$j){var $O=$H.createParticleTemplate2D($j);$O.x=$_,$O.y=$S,this._saveToCmd($o.context._drawParticle,[$O])},$S}(),$f_=function($_){var $j;function $e($_){this._x=0,this._y=0,this._id=++$e._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$e.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$e.MAXCLIPRECT,this.mOutPoint,this._canvas=$_,this._canvas._addReference(),$e._contextcount++,$o.isFlash?(this._ib=$r_.create(35044),$Z_.fillIBQuadrangle(this._ib,16)):this._ib=$r_.QuadrangleIB,this.clear()}$s($e,"laya.webgl.canvas.WebGLContext2D",$V);var $S=$e.prototype;return $S.setIsMainContext=function(){this._isMain=!0},$S.clearBG=function($_,$S,$j,$O){var $V=$z_.mainContext;$V.clearColor($_,$S,$j,$O),$V.clear(16384)},$S._getSubmits=function(){return this._submits},$S._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $_=0,$S=this._submits._length;$_<$S;$_++)this._submits[$_].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$S.destroy=function(){--$e._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$r_.QuadrangleIB&&this._ib.releaseResource()},$S.clear=function(){this._submits||(this._other=$j.DEFAULT,this._curMat=$P.create(),this._vb=$b_.create(-1),this._submits=[],this._save=[$p.Create(this)],this._save.length=10,this._shader2D=new $r,this._triangleMesh=$h_.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$j.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$e.MAXCLIPRECT,this._curSubmit=$M_.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$U.DEFAULT;for(var $_=0,$S=this._submits._length;$_<$S;$_++)this._submits[$_].releaseRender(),this._submits[$_]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$S.size=function($_,$S){if(this._width!=$_||this._height!=$S)if(0==$_||0==$S){0!=this._vb._byteLength&&(this._width=$_,this._height=$S,this._vb.clear(),this._vb.upload());for(var $j=0,$O=this._submits._length;$j<$O;$j++)this._submits[$j].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$_,this._height=$S,this._targets&&this._targets.size($_,$S),this._canvas.memorySize-=this._canvas.memorySize;0===$_&&0===$S&&this._releaseMem()},$S._getTransformMatrix=function(){return this._curMat},$S.translate=function($_,$S){0===$_&&0===$S||($K.save(this),this._curMat.bTransform&&($I.save(this),this._curMat.transformPointN($g.TEMP.setTo($_,$S)),$_=$g.TEMP.x,$S=$g.TEMP.y),this._x+=$_,this._y+=$S)},$S.save=function(){this._save[this._save._length++]=$p.Create(this)},$S.restore=function(){var $_=this._save._length;if(!($_<1))for(var $S=$_-1;0<=$S;$S--){var $j=this._save[$S];if($j.restore(this),$j.isSaveMark())return void(this._save._length=$S)}},$S._fillText=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){void 0===$u&&($u=0);var $c=this._shader2D,$q=this._curSubmit.shaderValue,$s=$V?$i_.create($V):this._other.font;if($G.enabled)$c.ALPHA!==$q.ALPHA&&($c.glTexture=null),$C_.drawText(this,$_,$S,this._curMat,$s,$a||this._other.textAlign,$M,$R,$w,$j,$O,$u);else{this._shader2D.defines.getValue();var $C=$M?$i.create($M)._color:$c.colorAdd;$c.ALPHA===$q.ALPHA&&$C===$c.colorAdd&&$q.colorAdd===$c.colorAdd||($c.glTexture=null,$c.colorAdd=$C),$C_.drawText(this,$_,$S,this._curMat,$s,$a||this._other.textAlign,$M,$R,$w,$j,$O,$u)}},$S.fillWords=function($_,$S,$j,$O,$V,$M){this._fillText(null,$_,$S,$j,$O,$V,null,-1,null,$M)},$S.fillBorderWords=function($_,$S,$j,$O,$V,$M,$R){this._fillBorderText(null,$_,$S,$j,$O,$V,$M,$R,null)},$S.fillText=function($_,$S,$j,$O,$V,$M){this._fillText($_,null,$S,$j,$O,$V,null,-1,$M)},$S.strokeText=function($_,$S,$j,$O,$V,$M,$R){this._fillText($_,null,$S,$j,$O,null,$V,$M||1,$R)},$S.fillBorderText=function($_,$S,$j,$O,$V,$M,$R,$w){this._fillBorderText($_,null,$S,$j,$O,$V,$M,$R,$w)},$S._fillBorderText=function($_,$S,$j,$O,$V,$M,$R,$w,$a){if(!$G.enabled)return this._fillText($_,$S,$j,$O,$V,null,$R,$w||1,$a),void this._fillText($_,$S,$j,$O,$V,$M,null,-1,$a);var $u=this._shader2D,$c=this._curSubmit.shaderValue;$u.ALPHA!==$c.ALPHA&&($u.glTexture=null);var $q=$V?($e._fontTemp.setFont($V),$e._fontTemp):this._other.font;$C_.drawText(this,$_,$S,this._curMat,$q,$a||this._other.textAlign,$M,$R,$w||1,$j,$O,0)},$S.fillRect=function($_,$S,$j,$O,$V){var $M=this._vb;if($Z_.fillRectImgVb($M,this._clipRect,$_,$S,$j,$O,$h.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $R=this._shader2D.fillStyle;$V&&(this._shader2D.fillStyle=$U.create($V));var $w=this._shader2D,$a=this._curSubmit.shaderValue;if($w.fillStyle!==$a.fillStyle||$w.ALPHA!==$a.ALPHA){$w.glTexture=null;var $u=this._curSubmit=$M_.createSubmit(this,this._ib,$M,($M._byteLength-64)/32*3,$y_.create(2,0));$u.shaderValue.color=$w.fillStyle._color._color,$u.shaderValue.ALPHA=$w.ALPHA,this._submits[this._submits._length++]=$u}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$R}},$S.fillTexture=function($_,$S,$j,$O,$V,$M,$R,$w){if($_.loaded&&$_.bitmap&&$_.source){var $a=this._vb,$u=$_.bitmap.width,$c=$_.bitmap.height,$q=$_.uv,$s=$R.x%$_.width,$C=$R.y%$_.height;if($u!=$w.w||$c!=$w.h){if(!$w.w&&!$w.h)switch($w.oy=$w.ox=0,$M){case"repeat":$w.width=$O,$w.height=$V;break;case"repeat-x":$w.width=$O,$C<0?$_.height+$C>$V?$w.height=$V:$w.height=$_.height+$C:($w.oy=$C,$_.height+$C>$V?$w.height=$V-$C:$w.height=$_.height);break;case"repeat-y":$s<0?$_.width+$s>$O?$w.width=$O:$w.width=$_.width+$s:($w.ox=$s,$_.width+$s>$O?$w.width=$O-$s:$w.width=$_.width),$w.height=$V;break;case"no-repeat":$s<0?$_.width+$s>$O?$w.width=$O:$w.width=$_.width+$s:($w.ox=$s,$_.width+$s>$O?$w.width=$O-$s:$w.width=$_.width),$C<0?$_.height+$C>$V?$w.height=$V:$w.height=$_.height+$C:($w.oy=$C,$_.height+$C>$V?$w.height=$V-$C:$w.height=$_.height);break;default:$w.width=$O,$w.height=$V}$w.w=$u,$w.h=$c,$w.uv=[0,0,$w.width/$u,0,$w.width/$u,$w.height/$c,0,$w.height/$c]}if($S+=$w.ox,$j+=$w.oy,$s-=$w.ox,$C-=$w.oy,$Z_.fillRectImgVb($a,this._clipRect,$S,$j,$w.width,$w.height,$w.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $i=$x_.create(this,this._ib,$a,($a._byteLength-64)/32*3,$y_.create(256,0)),$v=(this._submits[this._submits._length++]=$i).shaderValue;$v.textureHost=$_;var $Z=$q[0]*$u,$o=$q[1]*$c,$l=($q[2]-$q[0])*$u,$k=($q[5]-$q[3])*$c,$z=-$s/$u,$H=-$C/$c;$v.u_TexRange[0]=$Z/$u,$v.u_TexRange[1]=$l/$u,$v.u_TexRange[2]=$o/$c,$v.u_TexRange[3]=$k/$c,$v.u_offset[0]=$z,$v.u_offset[1]=$H,$G.enabled&&!this._isMain&&$i.addTexture($_,($a._byteLength>>2)-16),(this._curSubmit=$i)._renderType=10017,$i._numEle+=6}}else this.sprite&&$A.timer.callLater(this,this._repaintSprite)},$S.setShader=function($_){$Y.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$_},$S.setFilters=function($_){$Y.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$_,this._curSubmit=$M_.RENDERBASE,this._renderKey=0,this._drawCount++},$S.drawTexture=function($_,$S,$j,$O,$V,$M,$R){this._drawTextureM($_,$S,$j,$O,$V,$M,$R,null,1)},$S.addTextureVb=function($_,$S,$j){var $O=this._curSubmit._vb||this._vb,$V=$O._byteLength>>2;$O.byteLength=$V+16<<2;for(var $M=$O.getFloat32Array(),$R=0;$R<16;$R+=4)$M[$V++]=$_[$R]+$S,$M[$V++]=$_[$R+1]+$j,$M[$V++]=$_[$R+2],$M[$V++]=$_[$R+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$O._upload=!0},$S.willDrawTexture=function($_,$S){if(!($_.loaded&&$_.bitmap&&$_.source))return this.sprite&&$A.timer.callLater(this,this._repaintSprite),0;var $j=$_.bitmap,$O=$j.id+this._shader2D.ALPHA*$S+10016;if($O==this._renderKey)return $O;var $V=this._shader2D,$M=$V.ALPHA,$R=this._curSubmit.shaderValue;$V.ALPHA*=$S,this._renderKey=$O,this._drawCount++,$V.glTexture=$j;var $w=this._vb,$a=null,$u=$w._byteLength/32*3,$c=$R.textureHost&&$R.textureHost==$_&&$R.textureHost.alphaTexture==$_.alphaTexture;return $a=$x_.create(this,this._ib,$w,$u,$y_.create(1,0)),(this._submits[this._submits._length++]=$a).shaderValue.textureHost=$_,$a._renderType=10016,$a._preIsSameTextureShader=10016===this._curSubmit._renderType&&$V.ALPHA===$R.ALPHA&&$c,this._curSubmit=$a,$V.ALPHA=$M,$O},$S.drawTextures=function($_,$S,$j,$O){if($_.loaded&&$_.bitmap&&$_.source){var $V=this._clipRect;if(this._clipRect=$e.MAXCLIPRECT,this._drawTextureM($_,$S[0],$S[1],$_.width,$_.height,$j,$O,null,1)){if(this._clipRect=$V,$n.drawCall++,!($S.length<4)){for(var $M=this._curSubmit._vb||this._vb,$R=this._curMat.a,$w=this._curMat.d,$a=2,$u=$S.length;$a<$u;$a+=2)$Z_.copyPreImgVb($M,($S[$a]-$S[$a-2])*$R,($S[$a+1]-$S[$a-1])*$w),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$A.timer.callLater(this,this._repaintSprite)},$S._drawTextureM=function($_,$S,$j,$O,$V,$M,$R,$w,$a){if(!$_.loaded||!$_.source)return this.sprite&&$A.timer.callLater(this,this._repaintSprite),!1;var $u=this._curSubmit._vb||this._vb,$c=$_.bitmap;$S+=$M,$j+=$R,this._drawCount++;var $q=$c.id+this._shader2D.ALPHA*$a+10016;if($q!=this._renderKey){this._renderKey=$q;var $s=this._curSubmit.shaderValue,$C=this._shader2D,$i=$C.ALPHA;$C.ALPHA*=$a,$C.glTexture=$c;var $v=this._vb,$Z=null,$o=$v._byteLength/32*3,$l=$s.textureHost&&$s.textureHost==$_&&$s.textureHost.alphaTexture==$_.alphaTexture;$Z=$x_.create(this,this._ib,$v,$o,$y_.create(1,0)),(this._submits[this._submits._length++]=$Z).shaderValue.textureHost=$_,$Z._renderType=10016,$Z._preIsSameTextureShader=10016===this._curSubmit._renderType&&$C.ALPHA===$s.ALPHA&&$l,this._curSubmit=$Z,$u=this._curSubmit._vb||this._vb,$C.ALPHA=$i}return!!$Z_.fillRectImgVb($u,this._clipRect,$S,$j,$O||$_.width,$V||$_.height,$_.uv,$w||this._curMat,this._x,this._y,0,0)&&($G.enabled&&!this._isMain&&this._curSubmit.addTexture($_,($u._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$S._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$S._drawText=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){var $c=$_.bitmap;this._drawCount++;var $q=$c.id+this._shader2D.ALPHA+10016;if($q!=this._renderKey){this._renderKey=$q;var $s=this._curSubmit.shaderValue,$C=this._shader2D;$C.glTexture=$c;var $i=this._vb,$v=null,$Z=$i._byteLength/32*3,$o=$s.textureHost&&$s.textureHost==$_&&$s.textureHost.alphaTexture==$_.alphaTexture;($v=$G.enabled?$x_.create(this,this._ib,$i,$Z,$y_.create(1,0)):$x_.create(this,this._ib,$i,$Z,$K_.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$C.ALPHA===$s.ALPHA&&$o,(this._submits[this._submits._length++]=$v).shaderValue.textureHost=$_,$v._renderType=10016,this._curSubmit=$v}$_.active();var $l=this._curSubmit._vb||this._vb;$Z_.fillRectImgVb($l,this._clipRect,$S+$R,$j+$w,$O||$_.width,$V||$_.height,$_.uv,$M||this._curMat,this._x,this._y,$a,$u,!0)&&($G.enabled&&!this._isMain&&this._curSubmit.addTexture($_,($l._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$S.drawTextureWithTransform=function($_,$S,$j,$O,$V,$M,$R,$w,$a){if($M){var $u=this._curMat,$c=this._x,$q=this._y;(0!==$R||0!==$w)&&(this._x=$R*$u.a+$w*$u.c,this._y=$w*$u.d+$R*$u.b),$M&&$u.bTransform?($P.mul($M,$u,$e._tmpMatrix),($M=$e._tmpMatrix)._checkTransform()):(this._x+=$u.tx,this._y+=$u.ty),this._drawTextureM($_,$S,$j,$O,$V,0,0,$M,$a),this._x=$c,this._y=$q}else this._drawTextureM($_,$S,$j,$O,$V,$R,$w,null,$a)},$S.fillQuadrangle=function($_,$S,$j,$O,$V){var $M=this._curSubmit,$R=this._vb,$w=this._shader2D,$a=$M.shaderValue;if(this._renderKey=0,$_.bitmap){var $u=$_.bitmap;$w.glTexture==$u&&$w.ALPHA===$a.ALPHA||($w.glTexture=$u,($M=this._curSubmit=$M_.createSubmit(this,this._ib,$R,$R._byteLength/32*3,$y_.create(1,0))).shaderValue.glTexture=$u,this._submits[this._submits._length++]=$M),$Z_.fillQuadrangleImgVb($R,$S,$j,$O,$_.uv,$V||this._curMat,this._x,this._y)}else $M.shaderValue.fillStyle&&$M.shaderValue.fillStyle.equal($_)&&$w.ALPHA===$a.ALPHA||($w.glTexture=null,($M=this._curSubmit=$M_.createSubmit(this,this._ib,$R,$R._byteLength/32*3,$y_.create(2,0))).shaderValue.defines.add(2),$M.shaderValue.fillStyle=$U.create($_),this._submits[this._submits._length++]=$M),$Z_.fillQuadrangleImgVb($R,$S,$j,$O,$h.DEF_UV,$V||this._curMat,this._x,this._y);$M._numEle+=6},$S.drawTexture2=function($_,$S,$j,$O,$V,$M,$R,$w){if(0!=$M){var $a=this._curMat;if(this._x=$_*$a.a+$S*$a.c,this._y=$S*$a.d+$_*$a.b,$V&&($V=$a.bTransform||$V.bTransform?($P.mul($V,$a,$e._tmpMatrix),$e._tmpMatrix):(this._x+=$V.tx+$a.tx,this._y+=$V.ty+$a.ty,$P.EMPTY)),1!==$M||$R){var $u=this._shader2D.ALPHA,$c=this._nBlendType;this._shader2D.ALPHA=$M,$R&&(this._nBlendType=$L.TOINT($R)),this._drawTextureM($w[0],$w[1]-$j,$w[2]-$O,$w[3],$w[4],0,0,$V,1),this._shader2D.ALPHA=$u,this._nBlendType=$c}else this._drawTextureM($w[0],$w[1]-$j,$w[2]-$O,$w[3],$w[4],0,0,$V,1);this._x=this._y=0}},$S.drawCanvas=function($_,$S,$j,$O,$V){var $M=$_.context;if(this._renderKey=0,$M._targets)this._submits[this._submits._length++]=$F_.create($M,0,null),this._curSubmit=$M_.RENDERBASE,$M._targets.drawTo(this,$S,$j,$O,$V);else{var $R=this._submits[this._submits._length++]=$F_.create($M,this._shader2D.ALPHA,this._shader2D.filters),$w=$O/$_.width,$a=$V/$_.height,$u=$R._matrix;this._curMat.copyTo($u),1!=$w&&1!=$a&&$u.scale($w,$a);var $c=$u.tx,$q=$u.ty;$u.tx=$u.ty=0,$u.transformPoint($g.TEMP.setTo($S,$j)),$u.translate($g.TEMP.x+$c,$g.TEMP.y+$q),this._curSubmit=$M_.RENDERBASE}$f.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$M._targets?"yellow":"green",this.strokeRect($S-1,$j-1,$O+2,$V+2,1),this.strokeRect($S,$j,$O,$V,1),this.restore())},$S.drawTarget=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){void 0===$u&&($u=-1);var $c=this._vb;if($Z_.fillRectImgVb($c,this._clipRect,$S,$j,$O,$V,$a||$h.DEF_UV,$M||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $q=this._curSubmit=$q_.create(this,this._ib,$c,($c._byteLength-64)/32*3,$w,$R);$q.blendType=-1==$u?this._nBlendType:$u,$q.scope=$_,this._submits[this._submits._length++]=$q,this._curSubmit._numEle+=6}},$S.mixRGBandAlpha=function($_){return this._mixRGBandAlpha($_,this._shader2D.ALPHA)},$S._mixRGBandAlpha=function($_,$S){var $j=(4278190080&$_)>>>24;return 0!=$j?$j*=$S:$j=255*$S,16777215&$_|$j<<24},$S.drawTriangles=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){if(!$_.loaded||!$_.source)return this.sprite&&$A.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$_.bitmap;var $c=this._mixRGBandAlpha(4294967295,$w),$q=($O.length,$M.length);this._renderKey=-1;var $s=this._curSubmit=$x_.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$y_.create(1,0));return $s.shaderValue.textureHost=$_,$s._renderType=10016,this._submits[this._submits._length++]=$s,$R?($e._tmpMatrix.a=$R.a,$e._tmpMatrix.b=$R.b,$e._tmpMatrix.c=$R.c,$e._tmpMatrix.d=$R.d,$e._tmpMatrix.tx=$R.tx+$S,$e._tmpMatrix.ty=$R.ty+$j,$P.mul($e._tmpMatrix,this._curMat,$e._tmpMatrix)):($e._tmpMatrix.a=this._curMat.a,$e._tmpMatrix.b=this._curMat.b,$e._tmpMatrix.c=this._curMat.c,$e._tmpMatrix.d=this._curMat.d,$e._tmpMatrix.tx=this._curMat.tx+$S,$e._tmpMatrix.ty=this._curMat.ty+$j),this._triangleMesh.addData($O,$V,$M,$e._tmpMatrix,$c,this),this._curSubmit._numEle+=$q,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$S.transform=function($_,$S,$j,$O,$V,$M){$I.save(this),$P.mul($P.TEMP.setTo($_,$S,$j,$O,$V,$M),this._curMat,this._curMat),this._curMat._checkTransform()},$S.setTransformByMatrix=function($_){$_.copyTo(this._curMat)},$S.transformByMatrix=function($_){$I.save(this),$P.mul($_,this._curMat,this._curMat),this._curMat._checkTransform()},$S.rotate=function($_){$I.save(this),this._curMat.rotateEx($_)},$S.scale=function($_,$S){$I.save(this),this._curMat.scaleEx($_,$S)},$S.clipRect=function($_,$S,$j,$O){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $V=$c_.create(4);this.addRenderObject($V);var $M=this._vb,$R=$M._byteLength>>2;if($Z_.fillRectImgVb($M,null,$_,$S,$j,$O,$h.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $w=this._curSubmit=$M_.createSubmit(this,this._ib,$M,($M._byteLength-64)/32*3,$y_.create(2,0));$w.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$w,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $a=$c_.create(5);this.addRenderObject($a);var $u=$M.getFloat32Array(),$c=Math.min(Math.min(Math.min($u[0+$R],$u[4+$R]),$u[8+$R]),$u[12+$R]),$q=Math.max(Math.max(Math.max($u[0+$R],$u[4+$R]),$u[8+$R]),$u[12+$R]),$s=Math.min(Math.min(Math.min($u[1+$R],$u[5+$R]),$u[9+$R]),$u[13+$R]),$C=Math.max(Math.max(Math.max($u[1+$R],$u[5+$R]),$u[9+$R]),$u[13+$R]);$W.save(this,$a,$_,$S,$j,$O,$c,$s,$q-$c,$C-$s),this._curSubmit=$M_.RENDERBASE}else{$j*=this._curMat.a,$O*=this._curMat.d;var $i=$g.TEMP;this._curMat.transformPoint($i.setTo($_,$S)),$j<0&&($i.x=$i.x+$j,$j=-$j),$O<0&&($i.y=$i.y+$O,$O=-$O),this._renderKey=0;var $v=this._curSubmit=$u_.create(this);(this._submits[this._submits._length++]=$v).submitIndex=this._submits._length,$v.submitLength=9999999,$T.save(this,$v);var $Z=this._clipRect,$o=$Z.x,$l=$Z.y,$k=$i.x+$j,$z=$i.y+$O;$o<$i.x&&($Z.x=$i.x),$l<$i.y&&($Z.y=$i.y),$Z.width=Math.min($k,$o+$Z.width)-$Z.x,$Z.height=Math.min($z,$l+$Z.height)-$Z.y,this._shader2D.glTexture=null,$v.clipRect.copyFrom($Z),this._curSubmit=$M_.RENDERBASE}},$S.setIBVB=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c){if(void 0===$a&&($a=0),void 0===$u&&($u=0),void 0===$c&&($c=0),null===$j){if($o.isFlash){var $q=$O;$q._selfIB||($q._selfIB=$r_.create(35044)),$q._selfIB.clear(),$j=$q._selfIB}else $j=this._ib;$Z_.expandIBQuadrangle($j,$O._byteLength/(4*$O.vertexStride*4))}if(!$w||!$R)throw Error("setIBVB must input:shader shaderValues");var $s=$a_.create(this,$O,$j,$V,$R,$w,$a,$u,$c);$M||($M=$P.EMPTY),$M.translate($_,$S),$P.mul($M,this._curMat,$s._mat),$M.translate(-$_,-$S),this._submits[this._submits._length++]=$s,this._curSubmit=$M_.RENDERBASE,this._renderKey=0},$S.addRenderObject=function($_){this._submits[this._submits._length++]=$_},$S.fillTrangles=function($_,$S,$j,$O,$V){var $M=this._curSubmit,$R=this._vb,$w=this._shader2D,$a=$M.shaderValue,$u=$O.length>>4,$c=$_.bitmap;this._renderKey=0,$w.glTexture==$c&&$w.ALPHA===$a.ALPHA||(($M=this._curSubmit=$M_.createSubmit(this,this._ib,$R,$R._byteLength/32*3,$y_.create(1,0))).shaderValue.textureHost=$_,this._submits[this._submits._length++]=$M),$Z_.fillTranglesVB($R,$S,$j,$O,$V||this._curMat,this._x,this._y),$M._numEle+=6*$u},$S.submitElement=function($_,$S){var $j=this._submits;for($S<0&&($S=$j._length);$_<$S;)$_+=$j[$_].renderSubmit()},$S.finish=function(){$z_.mainContext.finish()},$S.flush=function(){var $_=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($_>this._ib.bufferLength/12&&$Z_.expandIBQuadrangle(this._ib,$_),!this._isMain&&$G.enabled&&$G._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$G._atlasRestore;for(var $S=this._submits,$j=0,$O=$S._length;$j<$O;$j++){var $V=$S[$j];10016===$V.getRenderType()&&$V.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$S_.instance&&$S_.getInstance().reset();var $M;for($j=0,$M=this.meshlist.length;$j<$M;$j++){var $R=this.meshlist[$j];$R.canReuse?$R.releaseMesh():$R.destroy()}return this.meshlist.length=0,this._curSubmit=$M_.RENDERBASE,this._renderKey=0,this._triangleMesh=$h_.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$S.setPathId=function($_){if(this.mId=$_,-1!=this.mId){this.mHaveKey=!1;var $S=$B.getInstance();$S.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$S.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$S.movePath=function($_,$S){var $j=$_,$O=$S;$_=this._curMat.a*$j+this._curMat.c*$O+this._curMat.tx,$S=this._curMat.b*$j+this._curMat.d*$O+this._curMat.ty,this.mX+=$_,this.mY+=$S},$S.beginPath=function(){var $_=this._getPath();$_.tempArray.length=0,$_.closePath=!1,this.mX=0,this.mY=0},$S.closePath=function(){this._path.closePath=!0},$S.fill=function($_){void 0===$_&&($_=!1);var $S=this._getPath();this.drawPoly(0,0,$S.tempArray,this.fillStyle._color.numColor,0,0,$_)},$S.stroke=function(){var $_=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$_.drawLine(0,0,$_.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $S=$B.getInstance().shapeLineDic[this.mId];$S.rebuild($_.tempArray),$_.setGeomtry($S)}else $B.getInstance().addLine(this.mId,$_.drawLine(0,0,$_.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$_.update();var $j=[this.mX,this.mY],$O=$M_.createShape(this,$_.ib,$_.vb,$_.count,$_.offset,$y_.create(4,0));$O.shaderValue.ALPHA=this._shader2D.ALPHA,$O.shaderValue.u_pos=$j,$O.shaderValue.u_mmat2=$l_.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$O,this._renderKey=-1}},$S.line=function($_,$S,$j,$O,$V,$M){var $R=this._curSubmit,$w=this._vb;if($Z_.fillLineVb($w,this._clipRect,$_,$S,$j,$O,$V,$M)){this._renderKey=0;var $a=this._shader2D,$u=$R.shaderValue;$a.strokeStyle===$u.strokeStyle&&$a.ALPHA===$u.ALPHA||($a.glTexture=null,($R=this._curSubmit=$M_.createSubmit(this,this._ib,$w,($w._byteLength-64)/32*3,$y_.create(2,0))).shaderValue.strokeStyle=$a.strokeStyle,$R.shaderValue.mainID=2,$R.shaderValue.ALPHA=$a.ALPHA,this._submits[this._submits._length++]=$R),$R._numEle+=6}},$S.moveTo=function($_,$S,$j){void 0===$j&&($j=!0);var $O=this._getPath();if($j){var $V=$_,$M=$S;$_=this._curMat.a*$V+this._curMat.c*$M,$S=this._curMat.b*$V+this._curMat.d*$M}$O.addPoint($_,$S)},$S.lineTo=function($_,$S,$j){void 0===$j&&($j=!0);var $O=this._getPath();if($j){var $V=$_,$M=$S;$_=this._curMat.a*$V+this._curMat.c*$M,$S=this._curMat.b*$V+this._curMat.d*$M}$O.addPoint($_,$S)},$S.drawCurves=function($_,$S,$j){this.setPathId(-1),this.beginPath(),this.strokeStyle=$j[3],this.lineWidth=$j[4];var $O=$j[2];$_+=$j[0],$S+=$j[1],this.movePath($_,$S),this.moveTo($O[0],$O[1]);for(var $V=2,$M=$O.length;$V<$M;)this.quadraticCurveTo($O[$V++],$O[$V++],$O[$V++],$O[$V++]);this.stroke()},$S.arcTo=function($_,$S,$j,$O,$V){if(-1==this.mId||!this.mHaveKey){var $M=0,$R=0,$w=0,$a=this._getPath();this._curMat.copyTo($e._tmpMatrix),$e._tmpMatrix.tx=$e._tmpMatrix.ty=0,$e._tempPoint.setTo($a.getEndPointX(),$a.getEndPointY()),$e._tmpMatrix.invertTransformPoint($e._tempPoint);var $u=$e._tempPoint.x-$_,$c=$e._tempPoint.y-$S,$q=Math.sqrt($u*$u+$c*$c);if(!($q<=1e-6)){var $s=$u/$q,$C=$c/$q,$i=$j-$_,$v=$O-$S,$Z=$i*$i+$v*$v,$o=Math.sqrt($Z);if(!($o<=1e-6)){var $l=$i/$o,$k=$v/$o,$z=$s+$l,$H=$C+$k,$A=Math.sqrt($z*$z+$H*$H);if(!($A<=1e-6)){var $f=$z/$A,$y=$H/$A,$P=Math.acos($f*$s+$y*$C),$g=Math.PI/2-$P,$E=($q=$V/Math.tan($g))*$s+$_,$$=$q*$C+$S,$d=Math.sqrt($q*$q+$V*$V),$n=$_+$f*$d,$J=$S+$y*$d,$F=0,$x=0;if(0<=$s*$k-$C*$l){var $h=2*$g/$e.SEGNUM;$F=Math.sin($h),$x=Math.cos($h)}else $h=2*-$g/$e.SEGNUM,$F=Math.sin($h),$x=Math.cos($h);$R=this._curMat.a*$E+this._curMat.c*$$,$w=this._curMat.b*$E+this._curMat.d*$$,$R==this._path.getEndPointX()&&$w==this._path.getEndPointY()||$a.addPoint($R,$w);var $N=$E-$n,$B=$$-$J;for($M=0;$M<$e.SEGNUM;$M++){var $t=$N*$x+$B*$F,$m=-$N*$F+$B*$x;$R=$t+$n,$w=$m+$J,$_=this._curMat.a*$R+this._curMat.c*$w,$w=$S=this._curMat.b*$R+this._curMat.d*$w,($R=$_)==this._path.getEndPointX()&&$w==this._path.getEndPointY()||$a.addPoint($R,$w),$N=$t,$B=$m}}}}}},$S.arc=function($_,$S,$j,$O,$V,$M,$R){if(void 0===$M&&($M=!1),void 0===$R&&($R=!0),-1!=this.mId){var $w=$B.getInstance().shapeDic[this.mId];if($w&&this.mHaveKey&&!$w.needUpdate(this._curMat))return;$S=$_=0}var $a,$u=0,$c=0,$q=0,$s=0,$C=0,$i=0,$v=0;if($c=$V-$O,$M)if(Math.abs($c)>=2*Math.PI)$c=2*-Math.PI;else for(;0<$c;)$c-=2*Math.PI;else if(Math.abs($c)>=2*Math.PI)$c=2*Math.PI;else for(;$c<0;)$c+=2*Math.PI;$a=$c/($v=$j<101?Math.max(10,$c*$j/5):$j<201?Math.max(10,$c*$j/20):Math.max(10,$c*$j/40))/2,$q=Math.abs(4/3*(1-Math.cos($a))/Math.sin($a)),$M&&($q=-$q);var $Z=this._getPath(),$o=NaN,$l=NaN;for($i=0;$i<=$v;$i++)$u=$O+$c*($i/$v),$s=$_+Math.cos($u)*$j,$C=$S+Math.sin($u)*$j,$R&&($o=$s,$l=$C,$s=this._curMat.a*$o+this._curMat.c*$l,$C=this._curMat.b*$o+this._curMat.d*$l),$s==this._path.getEndPointX()&&$C==this._path.getEndPointY()||$Z.addPoint($s,$C);$s=$_+Math.cos($V)*$j,$C=$S+Math.sin($V)*$j,$R&&($o=$s,$l=$C,$s=this._curMat.a*$o+this._curMat.c*$l,$C=this._curMat.b*$o+this._curMat.d*$l),$s==this._path.getEndPointX()&&$C==this._path.getEndPointY()||$Z.addPoint($s,$C)},$S.quadraticCurveTo=function($_,$S,$j,$O){var $V=$q.I,$M=$j,$R=$O;$j=this._curMat.a*$M+this._curMat.c*$R,$O=this._curMat.b*$M+this._curMat.d*$R,$M=$_,$R=$S,$_=this._curMat.a*$M+this._curMat.c*$R,$S=this._curMat.b*$M+this._curMat.d*$R;for(var $w=$V.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$_,$S,$j,$O],30,2),$a=0,$u=$w.length/2;$a<$u;$a++)this.lineTo($w[2*$a],$w[2*$a+1],!1);this.lineTo($j,$O,!1)},$S.rect=function($_,$S,$j,$O){this._other=this._other.make(),this._other.path||(this._other.path=new $Q),this._other.path.rect($_,$S,$j,$O)},$S.strokeRect=function($_,$S,$j,$O,$V){var $M=.5*$V;this.line($_-$M,$S,$_+$j+$M,$S,$V,this._curMat),this.line($_+$j,$S,$_+$j,$S+$O,$V,this._curMat),this.line($_,$S,$_,$S+$O,$V,this._curMat),this.line($_-$M,$S+$O,$_+$j+$M,$S+$O,$V,this._curMat)},$S.clip=function(){},$S.drawPoly=function($_,$S,$j,$O,$V,$M,$R){void 0===$R&&($R=!1),this._renderKey=0,this._shader2D.glTexture=null;var $w=this._getPath();if(-1==this.mId)$w.polygon($_,$S,$j,$O,$V||1,$M);else if(this.mHaveKey){var $a=$B.getInstance().shapeDic[this.mId];$a.setMatrix(this._curMat),$a.rebuild($w.tempArray),$w.setGeomtry($a)}else{var $u=$w.polygon($_,$S,$j,$O,$V||1,$M);$B.getInstance().addShape(this.mId,$u),$u.setMatrix(this._curMat)}$w.update();var $c,$q=[this.mX,this.mY];if(($c=$M_.createShape(this,$w.ib,$w.vb,$w.count,$w.offset,$y_.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$c.shaderValue.u_pos=$q,$c.shaderValue.u_mmat2=$l_.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$c,0<$V){if(this.mHaveLineKey){var $s=$B.getInstance().shapeLineDic[this.mId];$s.rebuild($w.tempArray),$w.setGeomtry($s)}else $B.getInstance().addShape(this.mId,$w.drawLine($_,$S,$j,$V,$M));$w.update(),($c=$M_.createShape(this,$w.ib,$w.vb,$w.count,$w.offset,$y_.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$c.shaderValue.u_mmat2=$l_.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$c}},$S.drawParticle=function($_,$S,$j){$j.x=$_,$j.y=$S,this._submits[this._submits._length++]=$j},$S._getPath=function(){return this._path||(this._path=new $Q)},$O(0,$S,"globalCompositeOperation",function(){return $L.NAMES[this._nBlendType]},function($_){var $S=$L.TOINT[$_];null==$S||this._nBlendType===$S||($Y.save(this,65536,this,!0),this._curSubmit=$M_.RENDERBASE,this._renderKey=0,this._nBlendType=$S)}),$O(0,$S,"strokeStyle",function(){return this._shader2D.strokeStyle},function($_){this._shader2D.strokeStyle.equal($_)||($Y.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$U.create($_))}),$O(0,$S,"globalAlpha",function(){return this._shader2D.ALPHA},function($_){($_=Math.floor(1e3*$_)/1e3)!=this._shader2D.ALPHA&&($Y.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$_)}),$O(0,$S,"asBitmap",null,function($_){if($_){if(this._targets||(this._targets=new $X),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$O(0,$S,"fillStyle",function(){return this._shader2D.fillStyle},function($_){this._shader2D.fillStyle.equal($_)||($Y.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$U.create($_))}),$O(0,$S,"textAlign",function(){return this._other.textAlign},function($_){this._other.textAlign===$_||(this._other=this._other.make(),$Y.save(this,32768,this._other,!1),this._other.textAlign=$_)}),$O(0,$S,"lineWidth",function(){return this._other.lineWidth},function($_){this._other.lineWidth===$_||(this._other=this._other.make(),$Y.save(this,256,this._other,!1),this._other.lineWidth=$_)}),$O(0,$S,"textBaseline",function(){return this._other.textBaseline},function($_){this._other.textBaseline===$_||(this._other=this._other.make(),$Y.save(this,16384,this._other,!1),this._other.textBaseline=$_)}),$O(0,$S,"font",null,function($_){$_!=this._other.font.toString()&&(this._other=this._other.make(),$Y.save(this,8,this._other,!1),this._other.font===$i_.EMPTY?this._other.font=new $i_($_):this._other.font.setFont($_))}),$e.__init__=function(){$j.DEFAULT=new $j},$e._tempPoint=new $g,$e._SUBMITVBSIZE=32e3,$e._MAXSIZE=99999999,$e._RECTVBSIZE=16,$e.MAXCLIPRECT=new $E(0,0,99999999,99999999),$e._COUNT=0,$e._tmpMatrix=new $P,$e.SEGNUM=32,$e._contextcount=0,$R($e,["_fontTemp",function(){return this._fontTemp=new $i_},"_drawStyleTemp",function(){return this._drawStyleTemp=new $U(null)}]),$e.__init$=function(){$j=function(){function $_(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$i_.EMPTY}$s($_,"");var $S=$_.prototype;return $S.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$i_.EMPTY},$S.make=function(){return this===$_.DEFAULT?new $_:this},$_.DEFAULT=null,$_}()},$e}(),$y_=function($_){function $O($_,$S){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$O.__super.call(this),this.defines=new $$_,this.position=$O._POSITION,this.mainID=$_,this.subID=$S,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$_|$S,this._inClassCache=$O._cache[this._cacheID],0<$_&&!this._inClassCache&&(this._inClassCache=$O._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$s($O,"laya.webgl.shader.d2.value.Value2D",$m);var $S=$O.prototype;return $S.setValue=function($_){},$S.refresh=function(){var $_=this.size;return $_[0]=$l_.width,$_[1]=$l_.height,this.alpha=this.ALPHA*$l_.worldAlpha,this.mmat=$l_.worldMatrix4,this},$S._ShaderWithCompile=function(){return $p_.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$X_.create)},$S._withWorldShaderDefines=function(){var $_=$l_.worldShaderDefines,$S=$p_.sharders[this.mainID|this.defines._value|$_.getValue()];if(!$S){var $j,$O={};for($j in this.defines.toNameDic())$O[$j]="";for($j in $_.toNameDic())$O[$j]="";$S=$p_.withCompile2D(0,this.mainID,$O,this.mainID|this.defines._value|$_.getValue(),$X_.create)}var $V=$l_.worldFilters;if(!$V)return $S;for(var $M,$R=$V.length,$w=0;$w<$R;$w++)($M=$V[$w])&&$M.action.setValue(this);return $S},$S.upload=function(){var $_=$l_;this.alpha=this.ALPHA*$_.worldAlpha,$l_.worldMatrix4!==$l_.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$z_.shaderHighPrecision&&this.defines.add(1024);var $S,$j=$_.worldShaderDefines?this._withWorldShaderDefines():$p_.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$_.width,this.size[1]=$_.height,this.mmat=$_.worldMatrix4,$N_.activeShader!==$j?$j._shaderValueWidth!==$_.width||$j._shaderValueHeight!==$_.height?($j._shaderValueWidth=$_.width,$j._shaderValueHeight=$_.height):$S=$j._params2dQuick2||$j._make2dQuick2():$j._shaderValueWidth!==$_.width||$j._shaderValueHeight!==$_.height?($j._shaderValueWidth=$_.width,$j._shaderValueHeight=$_.height):$S=$j._params2dQuick1||$j._make2dQuick1(),$j.upload(this,$S)},$S.setFilters=function($_){if(this.filters=$_)for(var $S,$j=$_.length,$O=0;$O<$j;$O++)($S=$_[$O])&&(this.defines.add($S.type),$S.action.setValue(this))},$S.clear=function(){this.defines.setValue(this.subID)},$S.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$O._initone=function($_,$S){$O._typeClass[$_]=$S,$O._cache[$_]=[],$O._cache[$_]._length=0},$O.__init__=function(){$O._POSITION=[2,5126,!1,4*$v_.BYTES_PE,0],$O._TEXCOORD=[2,5126,!1,4*$v_.BYTES_PE,2*$v_.BYTES_PE],$O._initone(2,$e_),$O._initone(4,$L_),$O._initone(256,$G_),$O._initone(512,$m_),$O._initone(1,$D_),$O._initone(65,$K_),$O._initone(9,$D_)},$O.create=function($_,$S){var $j=$O._cache[$_|$S];return $j._length?$j[--$j._length]:new $O._typeClass[$_|$S]($S)},$O._POSITION=null,$O._TEXCOORD=null,$O._cache=[],$O._typeClass=[],$O.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$O}(),$P_=function($_){function $Z($_,$S){$Z.__super.call(this,$_,$S)}$s($Z,"laya.webgl.utils.RenderSprite3D",$l);var $S=$Z.prototype;return $S.onCreate=function($_){switch($_){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$S._mask=function($_,$S,$j,$O){var $V,$M,$R=this._next,$w=$_.mask;if($w){$S.ctx.save();var $a=$S.ctx.globalCompositeOperation,$u=new $E;if($u.copyFrom($w.getBounds()),$u.width=Math.round($u.width),$u.height=Math.round($u.height),$u.x=Math.round($u.x),$u.y=Math.round($u.y),0<$u.width&&0<$u.height){var $c=$_._style._tf,$q=$w_.create();$q.addValue("bounds",$u),$V=$R_.create([$q,$S],laya.webgl.utils.RenderSprite3D.tmpTarget),$S.addRenderObject($V),$w.render($S,-$u.x,-$u.y),$V=$R_.create([$q],laya.webgl.utils.RenderSprite3D.endTmpTarget),$S.addRenderObject($V),$S.ctx.save(),$S.clipRect($j-$c.translateX+$u.x,$O-$c.translateY+$u.y,$u.width,$u.height),$R._fun.call($R,$_,$S,$j,$O),$S.ctx.restore(),$M=$c_.create(6),$a=$S.ctx.globalCompositeOperation,$M.blendMode="mask",$S.addRenderObject($M),$P.TEMP.identity();var $s=$y_.create(1,0),$C=$h.INV_UV,$i=$u.width,$v=$u.height;($u.width<32||$u.height<32)&&(($C=$Z.tempUV)[0]=0,$C[1]=0,$C[2]=32<=$u.width?1:$u.width/32,$C[3]=0,$C[4]=32<=$u.width?1:$u.width/32,$C[5]=32<=$u.height?1:$u.height/32,$C[6]=0,$C[7]=32<=$u.height?1:$u.height/32,$u.width=32<=$u.width?$u.width:32,$u.height=32<=$u.height?$u.height:32,$C[1]*=-1,$C[3]*=-1,$C[5]*=-1,$C[7]*=-1,$C[1]+=1,$C[3]+=1,$C[5]+=1,$C[7]+=1),$S.ctx.drawTarget($q,$j+$u.x-$c.translateX,$O+$u.y-$c.translateY,$i,$v,$P.TEMP,"tmpTarget",$s,$C,6),$V=$R_.create([$q],laya.webgl.utils.RenderSprite3D.recycleTarget),$S.addRenderObject($V),($M=$c_.create(6)).blendMode=$a,$S.addRenderObject($M)}$S.ctx.restore()}else $R._fun.call($R,$_,$S,$j,$O)},$S._blend=function($_,$S,$j,$O){var $V=$_._style,$M=this._next;$V.blendMode?($S.ctx.save(),$S.ctx.globalCompositeOperation=$V.blendMode,$M._fun.call($M,$_,$S,$j,$O),$S.ctx.restore()):$M._fun.call($M,$_,$S,$j,$O)},$S._transform=function($_,$S,$j,$O){var $V=$_.transform,$M=this._next;if($V&&$M!=$l.NORENDER){var $R=$S.ctx;$_._style;$V.tx=$j,$V.ty=$O;var $w=$R._getTransformMatrix(),$a=$w.clone();$P.mul($V,$w,$w),$w._checkTransform(),$V.tx=$V.ty=0,$M._fun.call($M,$_,$S,0,0),$a.copyTo($w),$a.destroy()}else $M._fun.call($M,$_,$S,$j,$O)},$Z.tmpTarget=function($_,$S){var $j=$_.getValue("bounds"),$O=$B_.create($j.width,$j.height);$O.start(),$O.clear(0,0,0,0),$_.addValue("tmpTarget",$O)},$Z.endTmpTarget=function($_){$_.getValue("tmpTarget").end()},$Z.recycleTarget=function($_){$_.getValue("tmpTarget").recycle(),$_.recycle()},$R($Z,["tempUV",function(){return this.tempUV=new Array(8)}]),$Z}(),$g_=function($_){function $S(){this.data=null,$S.__super.call(this)}$s($S,"laya.filters.webgl.ColorFilterActionGL",$t);var $j=$S.prototype;return $A.imps($j,{"laya.filters.IFilterActionGL":!0}),$j.setValue=function($_){$_.colorMat=this.data._mat,$_.colorAlpha=this.data._alpha},$j.apply3d=function($_,$S,$j,$O,$V){var $M=$_.getValue("bounds"),$R=$y_.create(1,0);$R.setFilters([this.data]);var $w=$P.TEMP;$w.identity(),$j.ctx.drawTarget($_,0,0,$M.width,$M.height,$w,"src",$R)},$S}(),$E_=function($_){function $M($_,$S,$j,$O,$V){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$M.__super.call(this,$_,$S,$V),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $U_,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$j,this._atlasCanvas.height=$O,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$s($M,"laya.webgl.atlas.Atlaser",$e);var $S=$M.prototype;return $S.computeUVinAtlasTexture=function($_,$S,$j,$O){var $V=$G.atlasTextureWidth,$M=$G.atlasTextureHeight,$R=$j/$V,$w=$O/$M,$a=($j+$_.bitmap.width)/$V,$u=($O+$_.bitmap.height)/$M,$c=$_.bitmap.width/$V,$q=$_.bitmap.height/$M;$_.uv=[$R+$S[0]*$c,$w+$S[1]*$q,$a-(1-$S[2])*$c,$w+$S[3]*$q,$a-(1-$S[4])*$c,$u-(1-$S[5])*$q,$R+$S[6]*$c,$u-(1-$S[7])*$q]},$S.findBitmapIsExist=function($_){if($_ instanceof laya.webgl.resource.WebGLImage){var $S=$_,$j=$S.url,$O=this._InAtlasWebGLImagesKey[$j||$S.id];if($O)return $O.offsetInfoID}return-1},$S.addToAtlasTexture=function($_,$S,$j){if($_ instanceof laya.webgl.resource.WebGLImage){var $O=$_,$V=$O.url;this._InAtlasWebGLImagesKey[$V||$O.id]={bitmap:$_,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$S,$j])}this._atlasCanvas.texSubImage2D($S,$j,$_.atlasSource),$_.clearAtlasSource()},$S.addToAtlas=function($_,$S,$j){$_._atlasID=this._inAtlasTextureKey.length;var $O=$_.uv.slice(),$V=$_.bitmap;this._inAtlasTextureKey.push($_),this._inAtlasTextureOriUVValue.push($O),this._inAtlasTextureBitmapValue.push($V),this.computeUVinAtlasTexture($_,$O,$S,$j),$_.bitmap=this._atlasCanvas},$S.clear=function(){for(var $_=0,$S=this._inAtlasTextureKey.length;$_<$S;$_++)this._inAtlasTextureKey[$_].bitmap=this._inAtlasTextureBitmapValue[$_],this._inAtlasTextureKey[$_].uv=this._inAtlasTextureOriUVValue[$_],this._inAtlasTextureKey[$_]._atlasID=-1,this._inAtlasTextureKey[$_].bitmap.lock=!1,this._inAtlasTextureKey[$_].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$S.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$O(0,$S,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$O(0,$S,"texture",function(){return this._atlasCanvas}),$O(0,$S,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$M}(),$$_=function($_){function $j(){$j.__super.call(this,$j.__name2int,$j.__int2name,$j.__int2nameMap)}return $s($j,"laya.webgl.shader.d2.ShaderDefines2D",$b),$j.__init__=function(){$j.reg("TEXTURE2D",1),$j.reg("COLOR2D",2),$j.reg("PRIMITIVE",4),$j.reg("GLOW_FILTER",8),$j.reg("BLUR_FILTER",16),$j.reg("COLOR_FILTER",32),$j.reg("COLOR_ADD",64),$j.reg("WORLDMAT",128),$j.reg("FILLTEXTURE",256),$j.reg("FSHIGHPRECISION",1024),$j.reg("TXTALPHA",2048),$j.reg("TXTCOMPRESS",4096)},$j.reg=function($_,$S){$b._reg($_,$S,$j.__name2int,$j.__int2name)},$j.toText=function($_,$S,$j){return $b._toText($_,$S,$j)},$j.toInt=function($_){return $b._toInt($_,$j.__name2int)},$j.TEXTURE2D=1,$j.COLOR2D=2,$j.PRIMITIVE=4,$j.FILTERGLOW=8,$j.FILTERBLUR=16,$j.FILTERCOLOR=32,$j.COLORADD=64,$j.WORLDMAT=128,$j.FILLTEXTURE=256,$j.SKINMESH=512,$j.SHADERDEFINE_FSHIGHPRECISION=1024,$j.TXTALPHA=2048,$j.TXTCOMPRESS=4096,$j.__name2int={},$j.__int2name=[],$j.__int2nameMap=[],$j}(),$d_=(function($_){function $w($_,$S,$j,$O,$V,$M,$R){$w.__super.call(this,$_,$S,$j,$O,40,$V,$M,$R)}$s($w,"laya.webgl.shapes.Ellipse",$j_)}(),function($_){function $M($_,$S,$j,$O,$V){this._points=[],this.rebuild($j),$M.__super.call(this,$_,$S,0,0,0,$V,$O,$V,0)}$s($M,"laya.webgl.shapes.Line",$j_);var $S=$M.prototype;return $S.rebuild=function($_){var $S=$_.length;$S!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($S/2-1)),this.mFloat32Array=new Float32Array(5*$S)),this._points.length=0;for(var $j=NaN,$O=NaN,$V=-1,$M=-1,$R=$_.length/2,$w=0;$w<$R;$w++)$j=$_[2*$w],$O=$_[2*$w+1],(.01<Math.abs($V-$j)||.01<Math.abs($M-$O))&&this._points.push($j,$O),$V=$j,$M=$O},$S.getData=function($_,$S,$j){var $O=[],$V=[];0<this.borderWidth&&this.createLine2(this._points,$O,this.borderWidth,$j,$V,this._points.length/2),this.mUint16Array.set($O,0),this.mFloat32Array.set($V,0),$_.append(this.mUint16Array),$S.append(this.mFloat32Array)},$M}()),$n_=function($_){function $q($_,$S,$j,$O,$V){this._points=[];for(var $M=NaN,$R=NaN,$w=-1,$a=-1,$u=$j.length/2-1,$c=0;$c<$u;$c++)$M=$j[2*$c],$R=$j[2*$c+1],(.01<Math.abs($w-$M)||.01<Math.abs($a-$R))&&this._points.push($M,$R),$w=$M,$a=$R;$M=$j[2*$u],$R=$j[2*$u+1],$w=this._points[0],$a=this._points[1],(.01<Math.abs($w-$M)||.01<Math.abs($a-$R))&&this._points.push($M,$R),$q.__super.call(this,$_,$S,0,0,this._points.length/2,0,$O,$V)}$s($q,"laya.webgl.shapes.LoopLine",$j_);var $S=$q.prototype;return $S.getData=function($_,$S,$j){if(0<this.borderWidth){for(var $O=this.color,$V=($O>>16&255)/255,$M=($O>>8&255)/255,$R=(255&$O)/255,$w=[],$a=0,$u=0,$c=[],$q=Math.floor(this._points.length/2),$s=0;$s<$q;$s++)$a=this._points[2*$s],$u=this._points[2*$s+1],$w.push(this.x+$a,this.y+$u,$V,$M,$R);this.createLoopLine($w,$c,this.borderWidth,$j+$w.length/5),$_.append(new Uint16Array($c)),$S.append(new Float32Array($w))}},$S.createLoopLine=function($_,$S,$j,$O,$V,$M){$_.length;var $R=$_.concat(),$w=$V||$_,$a=this.borderColor,$u=($a>>16&255)/255,$c=($a>>8&255)/255,$q=(255&$a)/255,$s=[$R[0],$R[1]],$C=[$R[$R.length-5],$R[$R.length-4]],$i=$C[0]+.5*($s[0]-$C[0]),$v=$C[1]+.5*($s[1]-$C[1]);$R.unshift($i,$v,0,0,0),$R.push($i,$v,0,0,0);var $Z,$o,$l,$k,$z,$H,$A,$f,$y,$P,$g,$E,$$,$d,$n,$J,$F,$x,$h,$N,$B=$R.length/5,$t=$O,$m=$j/2;$l=$R[0],$k=$R[1],$P=$l-($z=$R[5]),$y=($y=-($k-($H=$R[6])))/($N=Math.sqrt($y*$y+$P*$P))*$m,$P=$P/$N*$m,$w.push($l-$y,$k-$P,$u,$c,$q,$l+$y,$k+$P,$u,$c,$q);for(var $e=1;$e<$B-1;$e++)$l=$R[5*($e-1)],$k=$R[5*($e-1)+1],$z=$R[5*$e],$H=$R[5*$e+1],$A=$R[5*($e+1)],$f=$R[5*($e+1)+1],$P=$l-$z,$E=$z-$A,$n=(-($y=($y=-($k-$H))/($N=Math.sqrt($y*$y+$P*$P))*$m)+$l)*(-($P=$P/$N*$m)+$H)-(-$y+$z)*(-$P+$k),$x=(-($g=($g=-($H-$f))/($N=Math.sqrt($g*$g+$E*$E))*$m)+$A)*(-($E=$E/$N*$m)+$H)-(-$g+$z)*(-$E+$f),$h=($$=-$P+$k-(-$P+$H))*($F=-$g+$z-(-$g+$A))-($J=-$E+$f-(-$E+$H))*($d=-$y+$z-(-$y+$l)),Math.abs($h)<.1?($h+=10.1,$w.push($z-$y,$H-$P,$u,$c,$q,$z+$y,$H+$P,$u,$c,$q)):((($Z=($d*$x-$F*$n)/$h)-$z)*($Z-$z)+(($o=($J*$n-$$*$x)/$h)-$H)+($o-$H),$w.push($Z,$o,$u,$c,$q,$z-($Z-$z),$H-($o-$H),$u,$c,$q));$M&&($S=$M);var $G=this.edges+1;for($e=1;$e<$G;$e++)$S.push($t+2*($e-1),$t+2*($e-1)+1,$t+2*$e+1,$t+2*$e+1,$t+2*$e,$t+2*($e-1));return $S.push($t+2*($e-1),$t+2*($e-1)+1,$t+1,$t+1,$t,$t+2*($e-1)),$w},$q}(),$J_=function($_){function $R($_,$S,$j,$O,$V,$M){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$P.create(),this._points=$j.slice(0,$j.length),$R.__super.call(this,$_,$S,0,0,this._points.length/2,$O,$V,$M)}$s($R,"laya.webgl.shapes.Polygon",$j_);var $S=$R.prototype;return $S.rebuild=function($_){this._repaint||(this._points.length=0,this._points=this._points.concat($_))},$S.setMatrix=function($_){$_.copyTo(this._mat)},$S.needUpdate=function($_){return this._repaint=this._mat.a==$_.a&&this._mat.b==$_.b&&this._mat.c==$_.c&&this._mat.d==$_.d&&this._mat.tx==$_.tx&&this._mat.ty==$_.ty,!this._repaint},$S.getData=function($_,$S,$j){var $O,$V=0,$M=this._points,$R=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$j){for(this._start=$j,$O=[],$R=this.earcutTriangles.length,$V=0;$V<$R;$V++)$O.push(this.earcutTriangles[$V]+$j);this.mUint16Array=new Uint16Array($O)}}else{this._start=$j,$O=[];var $w=[],$a=[],$u=this.color,$c=($u>>16&255)/255,$q=($u>>8&255)/255,$s=(255&$u)/255;for($R=Math.floor($M.length/2),$V=0;$V<$R;$V++)$w.push(this.x+$M[2*$V],this.y+$M[2*$V+1],$c,$q,$s),$a.push(this.x+$M[2*$V],this.y+$M[2*$V+1]);for(this.earcutTriangles=$O_.earcut($a,null,2),$R=this.earcutTriangles.length,$V=0;$V<$R;$V++)$O.push(this.earcutTriangles[$V]+$j);this.mUint16Array=new Uint16Array($O),this.mFloat32Array=new Float32Array($w)}$_.append(this.mUint16Array),$S.append(this.mFloat32Array)},$R}(),$F_=function($_){function $M(){this._matrix=new $P,this._matrix4=$v_.defaultMatrix4.concat(),$M.__super.call(this,1e4),this.shaderValue=new $y_(0,0)}$s($M,"laya.webgl.submit.SubmitCanvas",$M_);var $S=$M.prototype;return $S.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $_=$l_.worldAlpha,$S=$l_.worldMatrix4,$j=$l_.worldMatrix,$O=$l_.worldFilters,$V=$l_.worldShaderDefines,$M=this.shaderValue,$R=this._matrix,$w=this._matrix4,$a=$P.TEMP;return $P.mul($R,$j,$a),$w[0]=$a.a,$w[1]=$a.b,$w[4]=$a.c,$w[5]=$a.d,$w[12]=$a.tx,$w[13]=$a.ty,$l_.worldMatrix=$a.clone(),$l_.worldMatrix4=$w,$l_.worldAlpha=$l_.worldAlpha*$M.alpha,$M.filters&&$M.filters.length&&($l_.worldFilters=$M.filters,$l_.worldShaderDefines=$M.defines),this._ctx_src.flush(),$l_.worldAlpha=$_,$l_.worldMatrix4=$S,$l_.worldMatrix.destroy(),$l_.worldMatrix=$j,$l_.worldFilters=$O,$l_.worldShaderDefines=$V,1},$S.releaseRender=function(){var $_=$M._cache;this._ctx_src=null,$_[$_._length++]=this},$S.getRenderType=function(){return 10003},$M.create=function($_,$S,$j){var $O=$M._cache._length?$M._cache[--$M._cache._length]:new $M;$O._ctx_src=$_;var $V=$O.shaderValue;return $V.alpha=$S,$V.defines.setValue(0),$j&&$j.length&&$V.setFilters($j),$O},$M._cache=(($M._cache=[])._length=0,$M._cache),$M}(),$x_=function($_){function $u($_){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$_&&($_=1e4),$u.__super.call(this,$_)}$s($u,"laya.webgl.submit.SubmitTexture",$M_);var $S=$u.prototype;return $S.releaseRender=function(){var $_=$u._cache;($_[$_._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$S.addTexture=function($_,$S){this._texsID[this._texs.length]=$_._uvID,this._texs.push($_),this._vbPos.push($S)},$S.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $_=this.shaderValue.textureHost.bitmap;if(null!==$_)for(var $S=this._vb.getFloat32Array(),$j=0,$O=this._texs.length;$j<$O;$j++){var $V=this._texs[$j];$V.active();var $M=$V.uv;if(this._texsID[$j]!==$V._uvID){this._texsID[$j]=$V._uvID;var $R=this._vbPos[$j];$S[$R+2]=$M[0],$S[$R+3]=$M[1],$S[$R+6]=$M[2],$S[$R+7]=$M[3],$S[$R+10]=$M[4],$S[$R+11]=$M[5],$S[$R+14]=$M[6],$S[$R+15]=$M[7],this._vb.setNeedUpload()}$V.bitmap!==$_&&(this._isSameTexture=!1)}}},$S.renderSubmit=function(){if(0===this._numEle)return $u._shaderSet=!1,1;var $_=this.shaderValue.textureHost;if($_){var $S=$_.source;if(!$_.bitmap||!$S)return $u._shaderSet=!1,1;this.shaderValue.texture=$S,$_.alphaTexture&&$_.alphaTexture.source&&(this.shaderValue.texture1=$_.alphaTexture.source)}this._vb.bind_upload(this._ib);var $j=$z_.mainContext;if($L.activeBlendFunction!==this._blendFn&&($j.enable(3042),this._blendFn($j),$L.activeBlendFunction=this._blendFn),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$N_.activeShader&&$u._shaderSet?($N_.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$N_.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$u._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $O=$_.bitmap,$V=0,$M=$N_.activeShader,$R=0,$w=this._texs.length;$R<$w;$R++){var $a=this._texs[$R];$a.bitmap===$O&&$R+1!==$w||($M.uploadTexture2D($a.source),$j.drawElements(4,6*($R-$V+1),5123,this._startIdx+6*$V*$v_.BYTES_PIDX),$O=$a.bitmap,$V=$R)}else $j.drawElements(4,this._numEle,5123,this._startIdx);return 1},$u.create=function($_,$S,$j,$O,$V){var $M=$u._cache._length?$u._cache[--$u._cache._length]:new $u;null==$j&&(($j=$M._selfVb||($M._selfVb=$b_.create(-1))).clear(),$O=0),$M._ib=$S,$M._vb=$j,$M._startIdx=$O*$v_.BYTES_PIDX,$M._numEle=0;var $R=$_._nBlendType;$M._blendFn=$_._targets?$L.targetFns[$R]:$L.fns[$R],$M.shaderValue=$V,$M.shaderValue.setValue($_._shader2D);var $w=$_._shader2D.filters;return $w&&$M.shaderValue.setFilters($w),$M},$u._cache=(($u._cache=[])._length=0,$u._cache),$u._shaderSet=!0,$u}(),$h_=function($_){function $o(){$o.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$s($o,"laya.webgl.utils.MeshTexture",$o_);var $S=$o.prototype;return $S.addData=function($_,$S,$j,$O,$V,$M){for(var $R=$_.length/2,$w=this._vb.needSize($R*$o.const_stride)>>2,$a=this._vb.getFloat32Array(),$u=0,$c=0;$c<$R;$c++){var $q=$_[$u],$s=$_[$u+1],$C=$q*$O.a+$s*$O.c+$O.tx,$i=$q*$O.b+$s*$O.d+$O.ty;$a[$w++]=$C,$a[$w++]=$i,$a[$w++]=$S[$u],$a[$w++]=$S[$u+1],$u+=2}this._vb.setNeedUpload();var $v=this.vertNum;if(0<$v){($R=$j.length)>$o.tmpIdx.length&&($o.tmpIdx=new Uint16Array($R));for(var $Z=0;$Z<$R;$Z++)$o.tmpIdx[$Z]=$j[$Z]+$v;this._ib.appendU16Array($o.tmpIdx,$j.length)}else this._ib.append($j);this._ib.setNeedUpload(),this.vertNum+=$R,this.indexNum+=$j.length},$S.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$S.destroy=function(){this._ib.destroy(),this._vb.destroy()},$o.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $o},$o.const_stride=16,$o._POOL=[],$R($o,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$o}(),$N_=function($_){function $S(){$S.__super.call(this),this.lock=!0}return $s($S,"laya.webgl.shader.BaseShader",$k),$S.activeShader=null,$S.bindShader=null,$S}(),$B_=function($S){function $c($_,$S,$j,$O,$V,$M,$R,$w,$a){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$j&&($j=6408),void 0===$O&&($O=5121),void 0===$V&&($V=34041),void 0===$M&&($M=!1),void 0===$R&&($R=!1),void 0===$w&&($w=-1),void 0===$a&&($a=-1),this._type=1,this._w=$_,this._h=$S,this._surfaceFormat=$j,this._surfaceType=$O,this._depthStencilFormat=$V,$o.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$M,this._repeat=$R,this._minFifter=$w,this._magFifter=$a,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$c.__super.call(this,this.bitmap,$h.INV_UV)}$s($c,"laya.webgl.resource.RenderTarget2D",$S);var $_=$c.prototype;return $A.imps($_,{"laya.resource.IDispose":!0}),$_.getType=function(){return this._type},$_.getTexture=function(){return this},$_.size=function($_,$S){this._w==$_&&this._h==$S||(this._w=$_,this._h=$S,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$_.release=function(){this.destroy()},$_.recycle=function(){$c.POOL.push(this)},$_.start=function(){var $_=$z_.mainContext;return this._preRenderTarget=$l_.curRenderTarget,$l_.curRenderTarget=this,$_.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($_.viewport(0,0,this._w,this._h),this._svWidth=$l_.width,this._svHeight=$l_.height,$l_.width=this._w,$l_.height=this._h,$N_.activeShader=null),this},$_.clear=function($_,$S,$j,$O){void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=1);var $V=$z_.mainContext;$V.clearColor($_,$S,$j,$O);var $M=16384;switch(this._depthStencilFormat){case 33189:$M|=256;break;case 36168:$M|=1024;break;case 34041:$M|=256,$M|=1024}$V.clear($M)},$_.end=function(){var $_=$z_.mainContext;$_.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$l_.curRenderTarget=this._preRenderTarget,1==this._type?($_.viewport(0,0,this._svWidth,this._svHeight),$l_.width=this._svWidth,$l_.height=this._svHeight,$N_.activeShader=null):$_.viewport(0,0,$A.stage.width,$A.stage.height)},$_.getData=function($_,$S,$j,$O){var $V=$z_.mainContext;if($V.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$V.checkFramebufferStatus(36160)))return $V.bindFramebuffer(36160,null),null;var $M=new Uint8Array(this._w*this._h*4);return $V.readPixels($_,$S,$j,$O,this._surfaceFormat,this._surfaceType,$M),$V.bindFramebuffer(36160,null),$M},$_.destroy=function($_){void 0===$_&&($_=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$S.prototype.destroy.call(this))},$_.dispose=function(){},$_._createWebGLRenderTarget=function(){this.bitmap=new $T_(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($_){this.event("recovered")})},$O(0,$_,"surfaceFormat",function(){return this._surfaceFormat}),$O(0,$_,"magFifter",function(){return this._magFifter}),$O(0,$_,"surfaceType",function(){return this._surfaceType}),$O(0,$_,"mipMap",function(){return this._mipMap}),$O(0,$_,"depthStencilFormat",function(){return this._depthStencilFormat}),$O(0,$_,"minFifter",function(){return this._minFifter}),$O(0,$_,"source",function(){return this._alreadyResolved?$A.superGet($h,this,"source"):null}),$c.create=function($_,$S,$j,$O,$V,$M,$R,$w,$a){void 0===$j&&($j=6408),void 0===$O&&($O=5121),void 0===$V&&($V=34041),void 0===$M&&($M=!1),void 0===$R&&($R=!1),void 0===$w&&($w=-1),void 0===$a&&($a=-1);var $u=$c.POOL.pop();return $u||($u=new $c($_,$S)),$u.bitmap&&$u._w==$_&&$u._h==$S&&$u._surfaceFormat==$j&&$u._surfaceType==$O&&$u._depthStencilFormat==$V&&$u._mipMap==$M&&$u._repeat==$R&&$u._minFifter==$w&&$u._magFifter==$a||($u._w=$_,$u._h=$S,$u._surfaceFormat=$j,$u._surfaceType=$O,$u._depthStencilFormat=$V,$o.isConchWebGL&&34041===$u._depthStencilFormat&&($u._depthStencilFormat=33189),$u._mipMap=$M,$u._repeat=$R,$u._minFifter=$w,$u._magFifter=$a,$u.release(),$u._createWebGLRenderTarget()),$u},$c.TYPE2D=1,$c.TYPE3D=2,$c.POOL=[],$c}($h),$t_=function($_){function $S(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$S.__super.call(this),$S._gl=$z_.mainContext}$s($S,"laya.webgl.utils.Buffer",$k);var $j=$S.prototype;return $j._bind=function(){this.activeResource(),$S._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($S._bindVertexBuffer=this._glBuffer),$S._gl.bindBuffer(this._bufferType,$S._bindActive[this._bufferType]=this._glBuffer),$N_.activeShader=null)},$j.recreateResource=function(){this._glBuffer||(this._glBuffer=$S._gl.createBuffer()),this.completeCreate()},$j.disposeResource=function(){this._glBuffer&&($z_.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$O(0,$j,"bufferUsage",function(){return this._bufferUsage}),$S._gl=null,$S._bindActive={},$S._bindVertexBuffer=null,$S._enableAtributes=[],$S}(),$m_=function($_){function $j($_){this.texcoord=null,this.offsetX=300,this.offsetY=0,$j.__super.call(this,512,0);var $S=8*$v_.BYTES_PE;this.position=[2,5126,!1,$S,0],this.texcoord=[2,5126,!1,$S,2*$v_.BYTES_PE],this.color=[4,5126,!1,$S,4*$v_.BYTES_PE]}return $s($j,"laya.webgl.shader.d2.skinAnishader.SkinSV",$y_),$j}(),$e_=function($_){function $S($_){$S.__super.call(this,2,0),this.color=[]}return $s($S,"laya.webgl.shader.d2.value.Color2dSV",$y_),$S.prototype.setValue=function($_){$_.fillStyle&&(this.color=$_.fillStyle._color._color),$_.strokeStyle&&(this.color=$_.strokeStyle._color._color)},$S}(),$G_=function($_){function $S($_){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$y_._TEXCOORD,$S.__super.call(this,256,0)}$s($S,"laya.webgl.shader.d2.value.FillTextureSV",$y_);var $j=$S.prototype;return $j.setValue=function($_){this.ALPHA=$_.ALPHA,$_.filters&&this.setFilters($_.filters)},$j.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$S}(),$D_=function($_){function $S($_){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$y_._TEXCOORD,void 0===$_&&($_=0),$S.__super.call(this,1,$_)}$s($S,"laya.webgl.shader.d2.value.TextureSV",$y_);var $j=$S.prototype;return $j.setValue=function($_){this.ALPHA=$_.ALPHA,$_.filters&&this.setFilters($_.filters)},$j.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$S}(),$L_=function($_){function $S($_){this.a_color=null,this.u_pos=[0,0],$S.__super.call(this,4,0),this.position=[2,5126,!1,5*$v_.BYTES_PE,0],this.a_color=[3,5126,!1,5*$v_.BYTES_PE,2*$v_.BYTES_PE]}return $s($S,"laya.webgl.shader.d2.value.PrimitiveSV",$y_),$S}(),$U_=function($_){function $S(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$S.__super.call(this)}$s($S,"laya.webgl.atlas.AtlasWebGLCanvas",$_);var $j=$S.prototype;return $j.recreateResource=function(){var $_=$z_.mainContext,$S=this._source=$_.createTexture(),$j=$H_.curBindTexTarget,$O=$H_.curBindTexValue;$H_.bindTexture($_,3553,$S),$_.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$_.texParameteri(3553,10241,9729),$_.texParameteri(3553,10240,9729),$_.texParameteri(3553,10242,33071),$_.texParameteri(3553,10243,33071),$j&&$O&&$H_.bindTexture($_,$j,$O),this.memorySize=this._w*this._h*4,this.completeCreate()},$j.disposeResource=function(){this._source&&($z_.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$j.texSubImage2D=function($_,$S,$j){if($o.isFlash){this._flashCacheImage||(this._flashCacheImage=$v.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $O=$j.bitmapdata;this._flashCacheImage._image.copyPixels($O,0,0,$O.width,$O.height,$_,$S),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $V=$z_.mainContext,$M=$H_.curBindTexTarget,$R=$H_.curBindTexValue;$H_.bindTexture($V,3553,this._source),$V.pixelStorei(37441,!0),0<=$_-1&&$V.texSubImage2D(3553,0,$_-1,$S,6408,5121,$j),$_+1<=this._w&&$V.texSubImage2D(3553,0,$_+1,$S,6408,5121,$j),0<=$S-1&&$V.texSubImage2D(3553,0,$_,$S-1,6408,5121,$j),$S+1<=this._h&&$V.texSubImage2D(3553,0,$_,$S+1,6408,5121,$j),$V.texSubImage2D(3553,0,$_,$S,6408,5121,$j),$V.pixelStorei(37441,!1),$M&&$R&&$H_.bindTexture($V,$M,$R)}},$j.texSubImage2DPixel=function($_,$S,$j,$O,$V){var $M=$z_.mainContext,$R=$H_.curBindTexTarget,$w=$H_.curBindTexValue;$H_.bindTexture($M,3553,this._source);var $a=new Uint8Array($V.data);$M.pixelStorei(37441,!0),$M.texSubImage2D(3553,0,$_,$S,$j,$O,6408,5121,$a),$M.pixelStorei(37441,!1),$R&&$w&&$H_.bindTexture($M,$R,$w)},$O(0,$j,"width",$_.prototype._$get_width,function($_){this._w=$_}),$O(0,$j,"height",$_.prototype._$get_height,function($_){this._h=$_}),$S}($j),$Q_=function($_){function $V(){this.flipY=!0,this.alwaysChange=!1,$V.__super.call(this)}$s($V,"laya.webgl.resource.WebGLCanvas",$j);var $S=$V.prototype;return $S.getCanvas=function(){return this._canvas},$S.clear=function(){this._ctx&&this._ctx.clear()},$S.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$S._setContext=function($_){this._ctx=$_},$S.getContext=function($_,$S){return this._ctx?this._ctx:this._ctx=$V._createContext(this)},$S.size=function($_,$S){this._w==$_&&this._h==$S||(this._w=$_,this._h=$S,this._ctx&&this._ctx.size($_,$S),this._canvas&&(this._canvas.height=$S,this._canvas.width=$_))},$S.activeResource=function($_){void 0===$_&&($_=!1),this._source||this.recreateResource()},$S.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$S.disposeResource=function(){this._source&&!this.iscpuSource&&($z_.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$S.createWebGlTexture=function(){var $_=$z_.mainContext;this._canvas;var $S=this._source=$_.createTexture();this.iscpuSource=!1;var $j=$H_.curBindTexTarget,$O=$H_.curBindTexValue;$H_.bindTexture($_,3553,$S),$_.pixelStorei(37440,this.flipY?1:0),$V.premulAlpha&&$_.pixelStorei(37441,!0),$_.texImage2D(3553,0,6408,6408,5121,this._imgData),$V.premulAlpha&&$_.pixelStorei(37441,!1),$_.texParameteri(3553,10240,9729),$_.texParameteri(3553,10241,9729),$_.texParameteri(3553,10242,33071),$_.texParameteri(3553,10243,33071),$_.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$j&&$O&&$H_.bindTexture($_,$j,$O)},$S.reloadCanvasData=function(){var $_=$z_.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $S=$H_.curBindTexTarget,$j=$H_.curBindTexValue;$H_.bindTexture($_,3553,this._source),$V.premulAlpha&&$_.pixelStorei(37441,!0),$_.texImage2D(3553,0,6408,6408,5121,this._imgData),$V.premulAlpha&&$_.pixelStorei(37441,!1),$_.pixelStorei(37440,0),$S&&$j&&$H_.bindTexture($_,$S,$j)},$S.texSubImage2D=function($_,$S,$j){var $O=$z_.mainContext,$V=$H_.curBindTexTarget,$M=$H_.curBindTexValue;$H_.bindTexture($O,3553,this._source),$O.pixelStorei(37441,!0),$O.texSubImage2D(3553,0,$S,$j,6408,5121,$_._source),$O.pixelStorei(37441,!1),$V&&$M&&$H_.bindTexture($O,$V,$M)},$S.toBase64=function($_,$S,$j){var $O=null;this._canvas&&($O=this._canvas.toDataURL($_,$S)),$j.call(this,$O)},$O(0,$S,"context",function(){return this._ctx}),$O(0,$S,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$O(0,$S,"asBitmap",null,function($_){this._ctx&&(this._ctx.asBitmap=$_)}),$V._createContext=null,$V.premulAlpha=!1,$V}(),$Y_=function($_){function $M($_,$S){this.CborderSize=12,$M.__super.call(this),this.char=$_,this.isSpace=" "===$_,this.xs=$S.scaleX,this.ys=$S.scaleY,this.font=$S.font.toString(),this.fontSize=$S.font.size,this.fillColor=$S.fillColor,this.borderColor=$S.borderColor,this.lineWidth=$S.lineWidth,this.underLine=$S.underLine;var $j,$O=$o.isConchApp;$O?(($j=ConchTextCanvas)._source=ConchTextCanvas,$j._source.canvas=ConchTextCanvas):$j=$C.canvas.source,this.canvas=$j,this._enableMerageInAtlas=!0,this._ctx=$O?$j:this.canvas.getContext("2d",void 0);var $V=$N.measureText(this.char,this.font);this.cw=$V.width*this.xs,this.ch=($V.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $h(this)}$s($M,"laya.webgl.resource.WebGLCharImage",$j);var $S=$M.prototype;return $A.imps($S,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$S.active=function(){this.texture.active()},$S.recreateResource=function(){var $_=$o.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$_){var $S=this.fontSize;1==this.xs&&1==this.ys||($S=parseInt($S*(this.xs>this.ys?this.xs:this.ys)+""));var $j="normal 100 "+this.font;$j=$j.replace($M._fontSizeReg,$S),this.borderColor&&($j+=" 1 "+this.borderColor),this._ctx.font=$j,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$x.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $O=this._ctx.measureText(this.char);$O||($O={width:16});var $V=$O.width+1;this._ctx.lineTo($V,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$S.onresize=function($_,$S){this._w=$_,this._h=$S,this._allowMerageInAtlas=!0},$S.clearAtlasSource=function(){},$O(0,$S,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$O(0,$S,"atlasSource",function(){return this.canvas}),$O(0,$S,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($_){this._enableMerageInAtlas=$_}),$M.createOneChar=function($_,$S){return new $M($_,$S)},$M._fontSizeReg=new RegExp("\\d+(?=px)","g"),$M}(),$T_=function($_){function $u($_,$S,$j,$O,$V,$M,$R,$w,$a){void 0===$j&&($j=6408),void 0===$O&&($O=5121),void 0===$V&&($V=34041),void 0===$M&&($M=!1),void 0===$R&&($R=!1),void 0===$w&&($w=-1),void 0===$a&&($a=1),$u.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$_,this._h=$S,this._surfaceFormat=$j,this._surfaceType=$O,this._depthStencilFormat=$V,this._mipMap=$M,this._repeat=$R,this._minFifter=$w,this._magFifter=$a}$s($u,"laya.webgl.resource.WebGLRenderTarget",$j);var $S=$u.prototype;return $S.recreateResource=function(){var $_=$z_.mainContext;this._frameBuffer||(this._frameBuffer=$_.createFramebuffer()),this._source||(this._source=$_.createTexture());var $S=$H_.curBindTexTarget,$j=$H_.curBindTexValue;$H_.bindTexture($_,3553,this._source),$_.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $O=this._minFifter,$V=this._magFifter,$M=this._repeat?10497:33071,$R=$c.isPOT(this._w,this._h);if($R?(this._mipMap?-1!==$O||($O=9987):-1!==$O||($O=9729),-1!==$V||($V=9729),$_.texParameteri(3553,10241,$O),$_.texParameteri(3553,10240,$V),$_.texParameteri(3553,10242,$M),$_.texParameteri(3553,10243,$M),this._mipMap&&$_.generateMipmap(3553)):(-1!==$O||($O=9729),-1!==$V||($V=9729),$_.texParameteri(3553,10241,$O),$_.texParameteri(3553,10240,$V),$_.texParameteri(3553,10242,33071),$_.texParameteri(3553,10243,33071)),$_.bindFramebuffer(36160,this._frameBuffer),$_.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$_.createRenderbuffer()),$_.bindRenderbuffer(36161,this._depthStencilBuffer),$_.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$_.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$_.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$_.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$_.bindFramebuffer(36160,null),$S&&$j&&$H_.bindTexture($_,$S,$j),$_.bindRenderbuffer(36161,null),$R&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$S.disposeResource=function(){this._frameBuffer&&($z_.mainContext.deleteTexture(this._source),$z_.mainContext.deleteFramebuffer(this._frameBuffer),$z_.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$O(0,$S,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$O(0,$S,"frameBuffer",function(){return this._frameBuffer}),$u}(),$W_=function($_){function $w($_,$S,$j,$O,$V,$M,$R){this.offsetX=0,this.offsetY=0,$w.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$M,this.canvas=$_,this._ctx=$_.getContext("2d",void 0),this._w=$O,this._h=$V,this.offsetX=$S,this.offsetY=$j,this.src=$R,this._enableMerageInAtlas=!0,$G.enabled&&this._w<$G.atlasLimitWidth&&this._h<$G.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$s($w,"laya.webgl.resource.WebGLSubImage",$j);var $S=$w.prototype;return $A.imps($S,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$S.size=function($_,$S){this._w=$_,this._h=$S,this._ctx&&this._ctx.size($_,$S),this.canvas&&(this.canvas.height=$S,this.canvas.width=$_)},$S.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$S.createWebGlTexture=function(){var $_=$z_.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $S=this._source=$_.createTexture(),$j=$H_.curBindTexTarget,$O=$H_.curBindTexValue;$H_.bindTexture($_,3553,$S),$_.pixelStorei(37441,!0),$_.texImage2D(3553,0,6408,6408,5121,this.canvas),$_.pixelStorei(37441,!1);var $V=this.minFifter,$M=this.magFifter,$R=this.repeat?10497:33071,$w=$c.isPOT(this.width,this.height);$w?(this.mipmap?-1!==$V||($V=9987):-1!==$V||($V=9729),-1!==$M||($M=9729),$_.texParameteri(3553,10240,$M),$_.texParameteri(3553,10241,$V),$_.texParameteri(3553,10242,$R),$_.texParameteri(3553,10243,$R),this.mipmap&&$_.generateMipmap(3553)):(-1!==$V||($V=9729),-1!==$M||($M=9729),$_.texParameteri(3553,10241,$V),$_.texParameteri(3553,10240,$M),$_.texParameteri(3553,10242,33071),$_.texParameteri(3553,10243,33071)),$j&&$O&&$H_.bindTexture($_,$j,$O),this.canvas=null,$w&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$S.disposeResource=function(){$G.enabled&&this._allowMerageInAtlas||!this._source||($z_.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$S.clearAtlasSource=function(){},$O(0,$S,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$O(0,$S,"atlasSource",function(){return this.canvas}),$O(0,$S,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($_){this._allowMerageInAtlas=$_}),$w}(),$p_=function($_){function $u($_,$S,$j,$O){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$u.__super.call(this),!$_||!$S)throw"Shader Error";this._id=++$u._count,this._vs=$_,this._ps=$S,this._nameMap=$O||{},null!=$j&&($u.sharders[$j]=this)}$s($u,"laya.webgl.shader.Shader",$N_);var $S=$u.prototype;return $S.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$S.disposeResource=function(){$z_.mainContext.deleteShader(this._vshader),$z_.mainContext.deleteShader(this._pshader),$z_.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$S._compile=function(){if(!$z_.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $_=[this._vs,this._ps],$S=$z_.mainContext;if(this._program=$S.createProgram(),this._vshader=$u._createShader($S,$_[0],35633),this._pshader=$u._createShader($S,$_[1],35632),$S.attachShader(this._program,this._vshader),$S.attachShader(this._program,this._pshader),$S.linkProgram(this._program),!$o.isConchApp&&!$S.getProgramParameter(this._program,35714))throw $S.getProgramInfoLog(this._program);var $j,$O,$V=0,$M=0;for($M=$o.isConchApp?$S.getProgramParameterEx(this._vs,this._ps,"",35721):$S.getProgramParameter(this._program,35721),$V=0;$V<$M;$V++){var $R=null;$j={vartype:"attribute",glfun:null,ivartype:0,attrib:$R=$o.isConchApp?$S.getActiveAttribEx(this._vs,this._ps,"",$V):$S.getActiveAttrib(this._program,$V),location:$S.getAttribLocation(this._program,$R.name),name:$R.name,type:$R.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($j)}var $w=0;for($w=$o.isConchApp?$S.getProgramParameterEx(this._vs,this._ps,"",35718):$S.getProgramParameter(this._program,35718),$V=0;$V<$w;$V++){var $a=null;$a=$o.isConchApp?$S.getActiveUniformEx(this._vs,this._ps,"",$V):$S.getActiveUniform(this._program,$V),0<($j={vartype:"uniform",glfun:null,ivartype:1,attrib:$R,location:$S.getUniformLocation(this._program,$a.name),name:$a.name,type:$a.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($j.name=$j.name.substr(0,$j.name.length-3),$j.isArray=!0,$j.location=$S.getUniformLocation(this._program,$j.name)),this._params.push($j)}for($V=0,$O=this._params.length;$V<$O;$V++)if(($j=this._params[$V]).indexOfParams=$V,$j.index=1,$j.value=[$j.location,null],$j.codename=$j.name,$j.name=this._nameMap[$j.codename]?this._nameMap[$j.codename]:$j.codename,(this._paramsMap[$j.name]=$j)._this=this,$j.uploadedValue=[],"attribute"!==$j.vartype)switch($j.type){case 5124:$j.fun=$j.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$j.fun=$j.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$j.fun=$j.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$j.fun=$j.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$j.fun=$j.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$j.fun=this._uniform_sampler2D;break;case 35680:$j.fun=this._uniform_samplerCube;break;case 35676:$j.glfun=$S.uniformMatrix4fv,$j.fun=this._uniformMatrix4fv;break;case 35670:$j.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $j.fun=this._attribute}},$S.getUniform=function($_){return this._paramsMap[$_]},$S._attribute=function($_,$S){var $j=$z_.mainContext,$O=$t_._enableAtributes,$V=$_.location;return $O[$V]||$j.enableVertexAttribArray($V),$j.vertexAttribPointer($V,$S[0],$S[1],$S[2],$S[3],$S[4]+this._offset),$O[$V]=$t_._bindVertexBuffer,1},$S._uniform1f=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S?($z_.mainContext.uniform1f($_.location,$j[0]=$S),1):0},$S._uniform1fv=function($_,$S){if($S.length<4){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($z_.mainContext.uniform1fv($_.location,$S),$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3],1):0}return $z_.mainContext.uniform1fv($_.location,$S),1},$S._uniform_vec2=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]?($z_.mainContext.uniform2f($_.location,$j[0]=$S[0],$j[1]=$S[1]),1):0},$S._uniform_vec2v=function($_,$S){if($S.length<2){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($z_.mainContext.uniform2fv($_.location,$S),$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3],1):0}return $z_.mainContext.uniform2fv($_.location,$S),1},$S._uniform_vec3=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]?($z_.mainContext.uniform3f($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2]),1):0},$S._uniform_vec3v=function($_,$S){return $z_.mainContext.uniform3fv($_.location,$S),1},$S._uniform_vec4=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($z_.mainContext.uniform4f($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3]),1):0},$S._uniform_vec4v=function($_,$S){return $z_.mainContext.uniform4fv($_.location,$S),1},$S._uniformMatrix2fv=function($_,$S){return $z_.mainContext.uniformMatrix2fv($_.location,!1,$S),1},$S._uniformMatrix3fv=function($_,$S){return $z_.mainContext.uniformMatrix3fv($_.location,!1,$S),1},$S._uniformMatrix4fv=function($_,$S){return $z_.mainContext.uniformMatrix4fv($_.location,!1,$S),1},$S._uniform1i=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S?($z_.mainContext.uniform1i($_.location,$j[0]=$S),1):0},$S._uniform1iv=function($_,$S){return $z_.mainContext.uniform1iv($_.location,$S),1},$S._uniform_ivec2=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]?($z_.mainContext.uniform2i($_.location,$j[0]=$S[0],$j[1]=$S[1]),1):0},$S._uniform_ivec2v=function($_,$S){return $z_.mainContext.uniform2iv($_.location,$S),1},$S._uniform_vec3i=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]?($z_.mainContext.uniform3i($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2]),1):0},$S._uniform_vec3vi=function($_,$S){return $z_.mainContext.uniform3iv($_.location,$S),1},$S._uniform_vec4i=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($z_.mainContext.uniform4i($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3]),1):0},$S._uniform_vec4vi=function($_,$S){return $z_.mainContext.uniform4iv($_.location,$S),1},$S._uniform_sampler2D=function($_,$S){var $j=$z_.mainContext,$O=$_.uploadedValue;return null==$O[0]?($O[0]=this._curActTexIndex,$j.uniform1i($_.location,this._curActTexIndex),$j.activeTexture($u._TEXTURES[this._curActTexIndex]),$H_.bindTexture($j,3553,$S),this._curActTexIndex++,1):($j.activeTexture($u._TEXTURES[$O[0]]),$H_.bindTexture($j,3553,$S),0)},$S._uniform_samplerCube=function($_,$S){var $j=$z_.mainContext,$O=$_.uploadedValue;return null==$O[0]?($O[0]=this._curActTexIndex,$j.uniform1i($_.location,this._curActTexIndex),$j.activeTexture($u._TEXTURES[this._curActTexIndex]),$H_.bindTexture($j,34067,$S),this._curActTexIndex++,1):($j.activeTexture($u._TEXTURES[$O[0]]),$H_.bindTexture($j,34067,$S),0)},$S._noSetValue=function($_){console.log("no....:"+$_.name)},$S.uploadOne=function($_,$S){this.activeResource(),$H_.UseProgram(this._program);var $j=this._paramsMap[$_];$j.fun.call(this,$j,$S)},$S.uploadTexture2D=function($_){$n.shaderCall++;var $S=$z_.mainContext;$S.activeTexture(33984),$H_.bindTexture($S,3553,$_)},$S.uploadTexture2D1=function($_){$n.shaderCall++;var $S=$z_.mainContext;$S.activeTexture(33985),$H_.bindTexture($S,3553,$_)},$S.upload=function($_,$S){$N_.activeShader=$N_.bindShader=this,this._lastUseFrameCount===$n.loopCount||this.activeResource(),$H_.UseProgram(this._program),this._reCompile?($S=this._params,this._reCompile=!1):$S=$S||this._params;$z_.mainContext;for(var $j,$O,$V=$S.length,$M=0,$R=0;$R<$V;$R++)null!==($O=$_[($j=$S[$R]).name])&&($M+=$j.fun.call(this,$j,$O));$n.shaderCall+=$M},$S.uploadArray=function($_,$S,$j){$N_.activeShader=this,($N_.bindShader=this).activeResource(),$H_.UseProgram(this._program);this._params;for(var $O,$V,$M=0,$R=$S-2;0<=$R;$R-=2)($V=this._paramsMap[$_[$R]])&&null!=($O=$_[$R+1])&&($j&&$j[$V.name]&&$j[$V.name].bind(),$M+=$V.fun.call(this,$V,$O));$n.shaderCall+=$M},$S.getParams=function(){return this._params},$u.getShader=function($_){return $u.sharders[$_]},$u.create=function($_,$S,$j,$O){return new $u($_,$S,$j,$O)},$u.withCompile=function($_,$S,$j,$O){if($j&&$u.sharders[$j])return $u.sharders[$j];var $V=$u._preCompileShader[2e-4*$_];if(!$V)throw new Error("withCompile shader err!"+$_);return $V.createShader($S,$j,$O)},$u.withCompile2D=function($_,$S,$j,$O,$V){if($O&&$u.sharders[$O])return $u.sharders[$O];var $M=$u._preCompileShader[2e-4*$_+$S];if(!$M)throw new Error("withCompile shader err!"+$_+" "+$S);return $M.createShader($j,$O,$V)},$u.addInclude=function($_,$S){$k_.addInclude($_,$S)},$u.preCompile=function($_,$S,$j,$O){var $V=2e-4*$_;$u._preCompileShader[$V]=new $k_($V,$S,$j,$O)},$u.preCompile2D=function($_,$S,$j,$O,$V){var $M=2e-4*$_+$S;$u._preCompileShader[$M]=new $k_($M,$j,$O,$V)},$u._createShader=function($_,$S,$j){var $O=$_.createShader($j);return $_.shaderSource($O,$S),$_.compileShader($O),$O},$u._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$u._count=0,$u._preCompileShader={},$u.SHADERNAME2ID=2e-4,$u.sharders=(($u.sharders=[]).length=32,$u.sharders),$R($u,["nameKey",function(){return this.nameKey=new $J}]),$u}(),$I_=function($_){function $S(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$S.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$s($S,"laya.webgl.utils.Buffer2D",$_);var $j=$S.prototype;return $j.needSize=function($_){var $S=this._byteLength;if($_){var $j=this._byteLength+$_;$j<=this._buffer.byteLength||this._resizeBuffer($j<<1,!0),this._byteLength=$j}return $S},$j._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$n.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$t_._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$t_._gl.bufferSubData(this._bufferType,0,this._buffer)},$j._bufferSubData=function($_,$S,$j){if(void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$n.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$t_._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$S||$j){var $O=this._buffer.slice($S,$j);$t_._gl.bufferSubData(this._bufferType,$_,$O)}else $t_._gl.bufferSubData(this._bufferType,$_,this._buffer)},$j._checkArrayUse=function(){},$j._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$j._bind_subUpload=function($_,$S,$j){return void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($_,$S,$j),!0)},$j._resizeBuffer=function($_,$S){if($_<this._buffer.byteLength)return this;if(this.memorySize=$_,$S&&this._buffer&&0<this._buffer.byteLength){var $j=new ArrayBuffer($_);new Uint8Array($j).set(new Uint8Array(this._buffer),0),this._buffer=$j}else this._buffer=new ArrayBuffer($_);return this._checkArrayUse(),this._upload=!0,this},$j.append=function($_){this._upload=!0;var $S,$j;$S=$_.byteLength,$_ instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$S,!0),$j=new Uint8Array(this._buffer,this._byteLength)):$_ instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$S,!0),$j=new Uint16Array(this._buffer,this._byteLength)):$_ instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$S,!0),$j=new Float32Array(this._buffer,this._byteLength)),$j.set($_,0),this._byteLength+=$S,this._checkArrayUse()},$j.appendU16Array=function($_,$S){this._resizeBuffer(this._byteLength+2*$S,!0);for(var $j=new Uint16Array(this._buffer,this._byteLength,$S),$O=0;$O<$S;$O++)$j[$O]=$_[$O];this._byteLength+=2*$S,this._checkArrayUse()},$j.appendEx=function($_,$S){this._upload=!0;var $j;$j=$_.byteLength,this._resizeBuffer(this._byteLength+$j,!0),new $S(this._buffer,this._byteLength).set($_,0),this._byteLength+=$j,this._checkArrayUse()},$j.appendEx2=function($_,$S,$j,$O){void 0===$O&&($O=1),this._upload=!0;var $V,$M;$V=$j*$O,this._resizeBuffer(this._byteLength+$V,!0),$M=new $S(this._buffer,this._byteLength);var $R=0;for($R=0;$R<$j;$R++)$M[$R]=$_[$R];this._byteLength+=$V,this._checkArrayUse()},$j.getBuffer=function(){return this._buffer},$j.setNeedUpload=function(){this._upload=!0},$j.getNeedUpload=function(){return this._upload},$j.upload=function(){var $_=this._bind_upload();return $t_._gl.bindBuffer(this._bufferType,null),$t_._bindActive[this._bufferType]=null,$N_.activeShader=null,$_},$j.subUpload=function($_,$S,$j){void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0);var $O=this._bind_subUpload();return $t_._gl.bindBuffer(this._bufferType,null),$t_._bindActive[this._bufferType]=null,$N_.activeShader=null,$O},$j.disposeResource=function(){$_.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$j.clear=function(){this._byteLength=0,this._upload=!0},$O(0,$j,"bufferLength",function(){return this._buffer.byteLength}),$O(0,$j,"byteLength",null,function($_){this._byteLength!==$_&&($_<=this._buffer.byteLength||this._resizeBuffer(2*$_+256,!0),this._byteLength=$_)}),$S.__int__=function($_){$r_.QuadrangleIB=$r_.create(35044),$Z_.fillIBQuadrangle($r_.QuadrangleIB,16)},$S.FLOAT32=4,$S.SHORT=2,$S}($t_),$K_=(function($S){function $j($_){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$j.__super.call(this,9)}$s($j,"laya.webgl.shader.d2.value.GlowSV",$S);var $_=$j.prototype;$_.setValue=function($_){$S.prototype.setValue.call(this,$_)},$_.clear=function(){$S.prototype.clear.call(this)}}($D_),function($_){function $S($_){$S.__super.call(this,64),this.defines.add(64)}$s($S,"laya.webgl.shader.d2.value.TextSV",$_);var $j=$S.prototype;return $j.release=function(){($S.pool[$S._length++]=this).clear()},$j.clear=function(){$_.prototype.clear.call(this)},$S.create=function(){return $S._length?$S.pool[--$S._length]:new $S(null)},$S.pool=[],$S._length=0,$S}($D_)),$X_=function($_){function $V($_,$S,$j,$O){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$V.__super.call(this,$_,$S,$j,$O)}$s($V,"laya.webgl.shader.d2.Shader2X",$_);var $S=$V.prototype;return $S.upload2dQuick1=function($_){this.upload($_,this._params2dQuick1||this._make2dQuick1())},$S._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $_,$S=this._params,$j=0,$O=$S.length;$j<$O;$j++)$_=$S[$j],($o.isFlash||"size"!==$_.name&&"position"!==$_.name&&"texcoord"!==$_.name)&&this._params2dQuick1.push($_)}return this._params2dQuick1},$S.disposeResource=function(){$_.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$S.upload2dQuick2=function($_){this.upload($_,this._params2dQuick2||this._make2dQuick2())},$S._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $_,$S=this._params,$j=0,$O=$S.length;$j<$O;$j++)$_=$S[$j],($o.isFlash||"size"!==$_.name)&&this._params2dQuick2.push($_)}return this._params2dQuick2},$V.create=function($_,$S,$j,$O){return new $V($_,$S,$j,$O)},$V}($p_),$r_=function($_){function $S($_){this._uint8Array=null,this._uint16Array=null,void 0===$_&&($_=35044),$S.__super.call(this),this._bufferUsage=$_,this._bufferType=34963,$o.isFlash||(this._buffer=new ArrayBuffer(8))}$s($S,"laya.webgl.utils.IndexBuffer2D",$I_);var $j=$S.prototype;return $j._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$j.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$j.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$j.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$S.QuadrangleIB=null,$S.create=function($_){return void 0===$_&&($_=35044),new $S($_)},$S}(),$b_=function($_){function $j($_,$S){this._floatArray32=null,this._vertexStride=0,$j.__super.call(this),this._vertexStride=$_,this._bufferUsage=$S,this._bufferType=34962,$o.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$s($j,"laya.webgl.utils.VertexBuffer2D",$_);var $S=$j.prototype;return $S.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$S.bind=function($_){$_&&$_._bind(),this._bind()},$S.insertData=function($_,$S){this.getFloat32Array().set($_,$S),this._upload=!0},$S.bind_upload=function($_){$_._bind_upload()||$_._bind(),this._bind_upload()||this._bind()},$S._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$S.disposeResource=function(){$_.prototype.disposeResource.call(this)},$S.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$O(0,$S,"vertexStride",function(){return this._vertexStride}),$j.create=function($_,$S){return void 0===$S&&($S=35048),new $j($_,$S)},$j}($I_),$_S=function($_){function $w($_,$S,$j,$O,$V,$M){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$j&&($j=6408),void 0===$O&&($O=!0),$w.__super.call(this,$_,$S),$_){if(this._format=$j,this._mipmap=$O,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $_)this._url=$_,this._src=$_,this._image=new $C.window.Image,$S&&($S.onload&&(this.onload=$S.onload),$S.onerror&&(this.onerror=$S.onerror),$S.onCreate&&$S.onCreate(this)),this._image.crossOrigin=$_&&0==$_.indexOf("data:")?null:"",$_&&(this._image.src=$_);else if($_ instanceof ArrayBuffer){this._src=$S,this._url=this._src;var $R=new $a($_);$R.readUTFBytes(4),$R.readUTFBytes(2),$R.getInt16();$R.endian="bigEndian",this._w=$R.getInt16(),this._h=$R.getInt16();$R.getInt16(),$R.getInt16();this._image=new Uint8Array($_,$R.pos),this._format=$z_.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$G.enabled&&this._w<$G.atlasLimitWidth&&this._h<$G.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($_ instanceof Uint8Array))return this._src=$S,this._url=this._src,this._image=$_.source||$_,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$S,this._url=this._src,this._w=$V,this._h=$M,this._image=$_,this._format=0===$j?$_.byteLength/($V*$M)==4?6408:6407:$j}this._$5__enableMerageInAtlas=!0}}$s($w,"laya.webgl.resource.WebGLImage",$v);var $S=$w.prototype;return $A.imps($S,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$S._init_=function($_,$S){},$S._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $_=$z_.mainContext,$S=this._source=$_.createTexture(),$j=$H_.curBindTexTarget,$O=$H_.curBindTexValue;$H_.bindTexture($_,3553,$S);var $V=this.minFifter,$M=this.magFifter,$R=this.repeat?10497:33071,$w=$c.isPOT(this._w,this._h),$a=!1;switch($w?(this.mipmap?-1!==$V||($V=9987):-1!==$V||($V=9729),-1!==$M||($M=9729),$_.texParameteri(3553,10241,$V),$_.texParameteri(3553,10240,$M),$_.texParameteri(3553,10242,$R),$_.texParameteri(3553,10243,$R),this.mipmap&&$_.generateMipmap(3553)):(-1!==$V||($V=9729),-1!==$M||($M=9729),$_.texParameteri(3553,10241,$V),$_.texParameteri(3553,10240,$M),$_.texParameteri(3553,10242,33071),$_.texParameteri(3553,10243,33071)),$_.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$_.pixelStorei($_.UNPACK_ALIGNMENT,1),$_.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$_.pixelStorei($_.UNPACK_ALIGNMENT,1),$_.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$a=!0,$_.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $z_.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$a=!0,$_.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$_.pixelStorei(37441,!1),$j&&$O&&$H_.bindTexture($_,$j,$O),this.uri||(this.uri=this._url),$a?this.memorySize=this._image.length:$w&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$S.recreateResource=function(){var $_=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $S=this;this._image=new $C.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($S._needReleaseAgain)return $S._needReleaseAgain=!1,$S._image.onload=null,void($S._image=null);$S._allowMerageInAtlas&&$S._enableMerageInAtlas?($_.memorySize=0,$_._recreateLock=!1):$S._createWebGlTexture(),$S.completeCreate()},this._image.src=this._src}},$S.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$z_.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$S.onresize=function(){this._w=this._image.width,this._h=this._image.height,$G.enabled&&this._w<$G.atlasLimitWidth&&this._h<$G.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$S.clearAtlasSource=function(){this._image=null},$O(0,$S,"format",function(){return this._format}),$O(0,$S,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($_){this._$5__enableMerageInAtlas=$_}),$O(0,$S,"mipmap",function(){return this._mipmap}),$O(0,$S,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$O(0,$S,"atlasSource",function(){return this._image}),$O(0,$S,"onload",null,function($_){var $S=this;this._onload=$_,this._image&&(this._image.onload=null!=this._onload?function(){$S.onresize(),$S._onload()}:null)}),$O(0,$S,"onerror",null,function($_){var $S=this;this._onerror=$_,this._image&&(this._image.onerror=null!=this._onerror?function(){$S._onerror()}:null)}),$w}();$A.__init([$C_,$e,$f_,$k_])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($_,$S){"use strict";for(var $j in Object.defineProperty($S,"__esModule",{value:!0}),Laya){var $O=Laya[$j];$O&&$O.__isclass&&($S[$j]=$O)}}),function($M,$_,$O){$O.un,$O.uns;var $V=$O.static,$R=$O.class,$w=$O.getset,$a=($O.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$i=laya.utils.ClassUtils,$q=(laya.events.Event,laya.utils.HTMLChar),$u=laya.net.Loader,$c=(laya.display.Node,laya.maths.Rectangle),$s=laya.renders.Render,$C=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$v=laya.utils.Stat,$N=laya.display.Text,$Z=laya.resource.Texture,$o=laya.net.URL,$l=laya.utils.Utils,$k=function(){function $C(){}return $R($C,"laya.html.utils.HTMLParse"),$C.parse=function($_,$S,$j){$S=($S="<root>"+($S=$S.replace(/<br>/g,"<br/>"))+"</root>").replace($C.spacePattern,$C.char255);var $O=$l.parseXMLFromString($S);$C._parseXML($_,$O.childNodes[0].childNodes,$j)},$C._parseXML=function($_,$S,$j,$O){var $V=0,$M=0;if($S.join||$S.item)for($V=0,$M=$S.length;$V<$M;++$V)$C._parseXML($_,$S[$V],$j,$O);else{var $R,$w,$a;if(3==$S.nodeType)return void($_ instanceof laya.html.dom.HTMLDivElement?(null==$S.nodeName&&($S.nodeName="#text"),$w=$S.nodeName.toLowerCase(),0<($a=$S.textContent.replace(/^\s+|\s+$/g,"")).length&&($R=$i.getInstance($w))&&($_.addChild($R),$R.innerTEXT=$a.replace($C.char255AndOneSpacePattern," "))):0<($a=$S.textContent.replace(/^\s+|\s+$/g,"")).length&&($_.innerTEXT=$a.replace($C.char255AndOneSpacePattern," ")));if("#comment"==($w=$S.nodeName.toLowerCase()))return;if($R=$i.getInstance($w)){($R=$_.addChild($R)).URI=$j,$R.href=$O;var $u=$S.attributes;if($u&&0<$u.length)for($V=0,$M=$u.length;$V<$M;++$V){var $c=$u[$V],$q=$c.nodeName,$s=$c.value;$R._setAttributes($q,$s)}$C._parseXML($R,$S.childNodes,$j,$R.href)}else $C._parseXML($_,$S.childNodes,$j,$O)}},$C.char255=String.fromCharCode(255),$C.spacePattern=/&nbsp;|&#160;/g,$C.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$C}(),$z=function(){function $h(){}return $R($h,"laya.html.utils.Layout"),$h.later=function($_){null==$h._will&&($h._will=[],$O.stage.frameLoop(1,null,function(){if(!($h._will.length<1)){for(var $_=0;$_<$h._will.length;$_++)laya.html.utils.Layout.layout($h._will[$_]);$h._will.length=0}})),$h._will.push($_)},$h.layout=function($_){if(!$_||!$_._style)return null;if(0==(512&$_._style._type))return null;$_.getStyle()._type&=-513;var $S=$h._multiLineLayout($_);return $s.isConchApp&&$_.layaoutCallNative&&$_.layaoutCallNative(),$S},$h._multiLineLayout=function($_){if($N.RightToLeft)return $h._multiLineLayout2($_);var $S=new Array;$_._addChildsToLayout($S);var $j,$O,$V,$M,$R,$w=0,$a=$S.length,$u=$_._getCSSStyle(),$c=$u.letterSpacing,$q=$u.leading,$s=$u.lineHeight,$C=$u._widthAuto()||!$u.wordWrap,$i=$C?999999:$_.width,$v=($_.height,0),$Z=$u.italic?$u.fontSize/3:0,$o=$u._getAlign(),$l=$u._getValign(),$k=0!==$l||0!==$o||0!=$s,$z=0,$H=0,$A=0,$f=0,$y=new Array,$P=$y[0]=new $B,$g=!1,$E=!1;$P.h=0,$u.italic&&($i-=$u.fontSize/3);var $$=0,$d=!0;function $n(){$P.y=$H,$H+=$P.h+$q,0==$P.h&&($H+=$s),$P.mWidth=$$,$$=0,$P=new $B,$y.push($P),$P.h=0,$g=!($d=!($z=0))}for($w=0;$w<$a;$w++)if(null!=($j=$S[$w]))if($d=!1,$j instanceof laya.html.dom.HTMLBrElement)$n(),$P.y=$H;else{if($j._isChar()){if(($M=$j).isWord)$g=$E||"\n"===$M.char,$P.wordStartIndex=$P.elements.length;else{if($A=$M.width+$M.style.letterSpacin,0<$y.length&&$i<$z+$A&&0<$P.wordStartIndex){var $J;$J=$P.elements.length-$P.wordStartIndex+1,$P.elements.length=$P.wordStartIndex,$w-=$J,$n();continue}$g=!1,$$+=$M.width}$A=$M.width+$c,$f=$M.height,$E=!1,($g=$g||$i<$z+$A)&&$n(),$P.minTextHeight=Math.min($P.minTextHeight,$j.height)}else $O=$j._getCSSStyle(),$R=$j,$V=$O.padding,0===$O._getCssFloat()||($k=!0),$g=$E||$O.lineElement,$A=$R.width*$R._style._tf.scaleX+$V[1]+$V[3]+$c,$f=$R.height*$R._style._tf.scaleY+$V[0]+$V[2],$E=$O.lineElement,($g=$g||$i<$z+$A&&$O.wordWrap)&&$n();$P.elements.push($j),$P.h=Math.max($P.h,$f),$j.x=$z,$j.y=$H,$z+=$A,$P.w=$z-$c,$P.y=$H,$v=Math.max($z+$Z,$v)}else $d||($z+=$h.DIV_ELEMENT_PADDING),$P.wordStartIndex=$P.elements.length;if($H=$P.y+$P.h,$k){var $F=0,$x=$i;for($C&&0<$_.width&&($x=$_.width),$w=0,$a=$y.length;$w<$a;$w++)$y[$w].updatePos(0,$x,$w,$F,$o,$l,$s),$F+=Math.max($s,$y[$w].h+$q);$H=$F}return $C&&($_.width=$v),$H>$_.height&&($_.height=$H),[$v,$H]},$h._multiLineLayout2=function($_){var $S=new Array;$_._addChildsToLayout($S);var $j,$O,$V,$M,$R,$w=0,$a=$S.length,$u=$_._getCSSStyle(),$c=$u.letterSpacing,$q=$u.leading,$s=$u.lineHeight,$C=$u._widthAuto()||!$u.wordWrap,$i=$C?999999:$_.width,$v=($_.height,0),$Z=$u.italic?$u.fontSize/3:0,$o=2-$u._getAlign(),$l=$u._getValign(),$k=0!==$l||0!=$o||0!=$s,$z=0,$H=0,$A=0,$f=0,$y=new Array,$P=$y[0]=new $B,$g=!1,$E=!1;$P.h=0,$u.italic&&($i-=$u.fontSize/3);var $$=0,$d=!0;function $n(){$P.y=$H,$H+=$P.h+$q,0==$P.h&&($H+=$s),$P.mWidth=$$,$$=0,$P=new $B,$y.push($P),$P.h=0,$g=!($d=!($z=0))}for($w=0;$w<$a;$w++)if(null!=($j=$S[$w]))if($d=!1,$j instanceof laya.html.dom.HTMLBrElement)$n(),$P.y=$H;else{if($j._isChar()){if(($M=$j).isWord)$g=$E||"\n"===$M.char,$P.wordStartIndex=$P.elements.length;else{if(0<$y.length&&$i<$z+$A&&0<$P.wordStartIndex){var $J;$J=$P.elements.length-$P.wordStartIndex+1,$P.elements.length=$P.wordStartIndex,$w-=$J,$n();continue}$g=!1,$$+=$M.width}$A=$M.width+$c,$f=$M.height,$E=!1,($g=$g||$i<$z+$A)&&$n(),$P.minTextHeight=Math.min($P.minTextHeight,$j.height)}else $O=$j._getCSSStyle(),$R=$j,$V=$O.padding,0===$O._getCssFloat()||($k=!0),$g=$E||$O.lineElement,$A=$R.width*$R._style._tf.scaleX+$V[1]+$V[3]+$c,$f=$R.height*$R._style._tf.scaleY+$V[0]+$V[2],$E=$O.lineElement,($g=$g||$i<$z+$A&&$O.wordWrap)&&$n();$P.elements.push($j),$P.h=Math.max($P.h,$f),$j.x=$z,$j.y=$H,$z+=$A,$P.w=$z-$c,$P.y=$H,$v=Math.max($z+$Z,$v)}else $d||($z+=$h.DIV_ELEMENT_PADDING),$P.wordStartIndex=$P.elements.length;if($H=$P.y+$P.h,$k){var $F=0,$x=$i;for($w=0,$a=$y.length;$w<$a;$w++)$y[$w].updatePos(0,$x,$w,$F,$o,$l,$s),$F+=Math.max($s,$y[$w].h+$q);$H=$F}for($C&&($_.width=$v),$H>$_.height&&($_.height=$H),$w=0,$a=$y.length;$w<$a;$w++)$y[$w].revertOrder($i);return[$v,$H]},$h._will=null,$h.DIV_ELEMENT_PADDING=0,$h}(),$B=function(){function $_(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$R($_,"laya.html.utils.LayoutLine");var $S=$_.prototype;return $S.updatePos=function($_,$S,$j,$O,$V,$M,$R){var $w,$a=0;0<this.elements.length&&($a=($w=this.elements[this.elements.length-1]).x+$w.width-this.elements[0].x);var $u=0,$c=NaN;1===$V&&($u=($S-$a)/2),2===$V&&($u=$S-$a),0===$R||0!=$M||($M=1);for(var $q=0,$s=this.elements.length;$q<$s;$q++){var $C=($w=this.elements[$q])._getCSSStyle();switch(0!==$u&&($w.x+=$u),$C._getValign()){case 0:$w.y=$O;break;case 1:var $i=0;99999!=this.minTextHeight&&($i=this.minTextHeight);var $v=($i+$R)/2;$v=Math.max($v,this.h),$c=(laya.html.dom.HTMLImageElement,$O+$v-$w.height),$w.y=$c;break;case 2:$w.y=$O+($R-$w.height)}}},$S.revertOrder=function($_){var $S;if(0<this.elements.length){var $j,$O=0;for($j=this.elements.length,$O=0;$O<$j;$O++)($S=this.elements[$O]).x=$_-$S.x-$S.width}},$_}(),$H=function($j){function $S(){this.URI=null,this._href=null,$S.__super.call(this),this._text=$S._EMPTYTEXT,this.setStyle(new $a(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$R($S,"laya.html.dom.HTMLElement",$j);var $_=$S.prototype;return $_.layaoutCallNative=function(){var $_=0;if(this._childs&&0<($_=this._childs.length))for(var $S=0;$S<$_;$S++)this._childs[$S].layaoutCallNative&&this._childs[$S].layaoutCallNative();var $j=this._getWords();$j?laya.html.dom.HTMLElement.fillWords(this,$j,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$_.appendChild=function($_){return this.addChild($_)},$_._getWords2=function(){var $_=this._text.text;if(!$_||0===$_.length)return null;var $S,$j,$O=0,$V=0;if(this._text.drawWords)$j=this._text.drawWords;else{for($V=($S=$_.split(" ")).length-1,$j=[],$O=0;$O<$V;$O++)$j.push($S[$O]," ");0<=$V&&$j.push($S[$V]),this._text.drawWords=$j}var $M,$R=this._text.words;if($R&&$R.length===$j.length)return $R;null===$R&&(this._text.words=$R=[]),$R.length=$j.length;var $w=this.style,$a=$w.font;for($O=0,$V=$j.length;$O<$V;$O++){$M=$l.measureText($j[$O],$a);var $u=$R[$O]=new $q($j[$O],$M.width,$M.height||$w.fontSize,$w);if(1<$u.char.length&&($u.charNum=$u.char),this.href){var $c=new $C;this.addChild($c),$u.setSprite($c)}}return $R},$_._getWords=function(){if(!$N.CharacterCache)return this._getWords2();var $_=this._text.text;if(!$_||0===$_.length)return null;var $S,$j=this._text.words;if($j&&$j.length===$_.length)return $j;null===$j&&(this._text.words=$j=[]),$j.length=$_.length;for(var $O=this.style,$V=$O.font,$M=0,$R=$_.length;$M<$R;$M++)if($S=$l.measureText($_.charAt($M),$V)){var $w=$j[$M]=new $q($_.charAt($M),$S.width,$S.height||$O.fontSize,$O);if(this.href){var $a=new $C;this.addChild($a),$w.setSprite($a)}}else console.warn("_getWords size is null"+$_.charAt($M),$V);return $j},$_.showLinkSprite=function(){var $_=this._text.words;if($_)for(var $S,$j,$O=[],$V=0;$V<$_.length;$V++)$j=$_[$V],($S=new $C).graphics.drawRect(0,0,$j.width,$j.height,"#ff0000"),$S.width=$j.width,$S.height=$j.height,this.addChild($S),$O.push($S)},$_._layoutLater=function(){var $_=this.style;512&$_._type||($_.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$_.block?($z.later(this),$_._type|=512):this.parent&&this.parent._layoutLater())},$_._setAttributes=function($_,$S){switch($_){case"style":return void this.style.cssText($S);case"class":return void(this.className=$S)}$j.prototype._setAttributes.call(this,$_,$S)},$_.updateHref=function(){if(null!=this._href){var $_=this._getWords();if($_)for(var $S,$j,$O=0;$O<$_.length;$O++)($j=($S=$_[$O]).getSprite())&&($j.size($S.width,$S.height),$j.on("click",this,this.onLinkHandler))}},$_.onLinkHandler=function($_){switch($_.type){case"click":for(var $S=this;$S;)$S.event("link",[this.href]),$S=$S.parent}},$_.formatURL=function($_){return this.URI?$o.formatURL($_,this.URI?this.URI.path:null):$_},$w(0,$_,"href",function(){return this._href},function($_){null!=(this._href=$_)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$w(0,$_,"color",null,function($_){this.style.color=$_}),$w(0,$_,"onClick",null,function($_){$O._runScript("fn=function(event){"+$_+";}"),this.on("click",this,void 0)}),$w(0,$_,"id",null,function($_){$A.document.setElementById($_,this)}),$w(0,$_,"innerTEXT",function(){return this._text.text},function($_){this.text=$_}),$w(0,$_,"style",function(){return this._style}),$w(0,$_,"text",function(){return this._text.text},function($_){this._text==$S._EMPTYTEXT?this._text={text:$_,words:null}:(this._text.text=$_,this._text.words&&(this._text.words.length=0)),$s.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$w(0,$_,"parent",$j.prototype._$get_parent,function($_){if($_ instanceof laya.html.dom.HTMLElement){var $S=$_;this.URI||(this.URI=$S.URI),this.style.inherit($S.style)}$O.superSet($C,this,"parent",$_)}),$w(0,$_,"className",null,function($_){this.style.attrs($A.document.styleSheets["."+$_])}),$S.fillWords=function($_,$S,$j,$O,$V,$M,$R){$_.graphics.clear();for(var $w=0,$a=$S.length;$w<$a;$w++){var $u=$S[$w];$_.graphics.fillText($u.char,$u.x+$j,$u.y+$O,$V,$M,"left",$R)}},$S._EMPTYTEXT={text:null,words:null},$S}($C),$S=(function($_){function $S(){$S.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$R($S,"laya.html.dom.HTMLBrElement",$H)}(),function($_){function $S(){this.contextHeight=NaN,this.contextWidth=NaN,$S.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$R($S,"laya.html.dom.HTMLDivElement",$_);var $j=$S.prototype;return $j.appendHTML=function($_){$k.parse(this,$_,this.URI),this.layout()},$j._addChildsToLayout=function($S){var $_=this._getWords();if(null==$_&&0==this._childs.length)return!1;$_&&$_.forEach(function($_){$S.push($_)});for(var $j=!0,$O=0,$V=this._childs.length;$O<$V;$O++){var $M=this._childs[$O];$j?$j=!1:$S.push(null),$M._addToLayout($S)}return!0},$j._addToLayout=function($_){this.layout()},$j.layout=function(){if(this.style){this.style._type|=512;var $_=$z.layout(this);if($_){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $c);var $S=this._$P.mHtmlBounds;$S.x=$S.y=0,$S.width=this.contextWidth=$_[0],$S.height=this.contextHeight=$_[1],this.setBounds($S)}}},$w(0,$j,"height",function(){return this._height?this._height:this.contextHeight},$_.prototype._$set_height),$w(0,$j,"innerHTML",null,function($_){this.destroyChildren(),this.appendHTML($_)}),$w(0,$j,"width",function(){return this._width?this._width:this.contextWidth},function($_){var $S=!1;$S=0===$_?$_!=this._width:$_!=this.width,$O.superSet($H,this,"width",$_),$S&&this.layout()}),$S}($H)),$A=function($_){function $S(){this.all=new Array,this.styleSheets=$a.styleSheets,$S.__super.call(this)}$R($S,"laya.html.dom.HTMLDocument",$H);var $j=$S.prototype;return $j.getElementById=function($_){return this.all[$_]},$j.setElementById=function($_,$S){this.all[$_]=$S},$V($S,["document",function(){return this.document=new $S}]),$S}();(function($_){function $S(){this._tex=null,this._url=null,this._renderArgs=[],$S.__super.call(this),this.style.block=!0}$R($S,"laya.html.dom.HTMLImageElement",$H);var $j=$S.prototype;$j._addToLayout=function($_){!this._style.absolute&&$_.push(this)},$j.render=function($_,$S,$j){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($v.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$_.ctx.drawTexture2($S,$j,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$j.layaoutCallNative=function(){var $_=0;if(this._childs&&0<($_=this._childs.length))for(var $S=0;$S<$_;$S++)this._childs[$S].layaoutCallNative&&this._childs[$S].layaoutCallNative()},$w(0,$j,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($_){this._width!==$_&&(this._width=$_,this._style.width=$_,this.repaint())}),$w(0,$j,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($_){this._height!==$_&&(this._height=$_,this._style.height=$_,this.repaint())}),$j.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$u.clearCache(this,this._url),this._tex=null),$H.prototype.destroy.call(this)},$j.onloaded=function(){var $_=this._style;$_&&!$_.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$_&&!$_.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$s.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$j._loadImageComplete=function($_,$S,$j){if(!this._destroyed)if(null!=$j)if($j instanceof ArrayBuffer){var $O=new DataView($j);new laya.webgl.resource.WebGLImage(new Uint8Array($j,8),$_,0,!1,$O.getUint32(0),$O.getUint32(4));this.onloaded()}else if($j instanceof $Z)$u.imgMgrSet[$_]=$S,$M.imgMgrLock($_,$u.imgMgrSet[$_]),this._url=$_,this._tex=$j,$u.keepCache(this,$_),$u.cacheRes($_,this._tex),this.onloaded();else{var $V=-1!=$_.indexOf(".png",$_.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($j,$_,$V,!1,$j.width,$j.height);this.onloaded()}else this.event("error","Load image failed")},$w(0,$j,"src",null,function($_){($_=this.formatURL($_),this._url!=$_)&&(null!=this._tex&&($u.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$_,(this._tex=$u.getRes($_))?($u.keepCache(this,$_),this.onloaded()):$M.imgMgrLoad($_,this._loadImageComplete.bind(this),2,!1))})})(),function($_){function $S(){this.type=null,$S.__super.call(this),this.visible=!1}$R($S,"laya.html.dom.HTMLLinkElement",$_);var $j=$S.prototype;$j._onload=function($_){switch(this.type){case"text/css":$a.parseCSS($_,this.URI)}},$w(0,$j,"href",$_.prototype._$get_href,function($_){var $S=this;$_=this.formatURL($_),this.URI=new $o($_);var $j=new $u;$j.once("complete",null,function($_){$S._onload($_)}),$j.load($_,"text")}),$S._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($H),function($_){function $S(){$S.__super.call(this),this.visible=!1}$R($S,"laya.html.dom.HTMLStyleElement",$_),$w(0,$S.prototype,"text",$_.prototype._$get_text,function($_){$a.parseCSS($_,null)})}($H),function($_){function $S(){$S.__super.call(this),this._getCSSStyle().valign="middle"}$R($S,"laya.html.dom.HTMLIframeElement",$_),$w(0,$S.prototype,"href",$_.prototype._$get_href,function($j){var $O=this;$j=this.formatURL($j);var $_=new $u;$_.once("complete",null,function($_){var $S=$O.URI;$O.URI=new $o($j),$O.innerHTML=$_,!$S||($O.URI=$S)}),$_.load($j,"text")})}($S)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($_,$S){"use strict";for(var $j in Object.defineProperty($S,"__esModule",{value:!0}),Laya){var $O=Laya[$j];$O&&$O.__isclass&&($S[$j]=$O)}}),function($V,$_,$v){$v.un,$v.uns;var $O=$v.static,$M=$v.class,$R=$v.getset,$j=($v.__newvec,laya.display.Animation),$Z=(laya.utils.Browser,laya.utils.ClassUtils),$w=laya.filters.ColorFilter,$a=laya.utils.Ease,$u=laya.events.Event,$c=(laya.events.EventDispatcher,laya.display.css.Font),$q=laya.display.FrameAnimation,$S=laya.display.Graphics,$s=laya.utils.Handler,$C=laya.display.Input,$l=laya.net.Loader,$i=(laya.display.Node,laya.maths.Point),$o=laya.maths.Rectangle,$k=laya.renders.Render,$z=laya.display.Sprite,$H=laya.display.Text,$A=laya.resource.Texture,$f=laya.utils.Tween,$y=laya.utils.Utils,$P=laya.utils.WeakObject;$v.interface("laya.ui.IItem"),$v.interface("laya.ui.ISelect"),$v.interface("laya.ui.IRender"),$v.interface("laya.ui.IComponent"),$v.interface("laya.ui.IBox","IComponent");var $g=function(){function $_(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $M($_,"laya.ui.LayoutStyle"),$O($_,["EMPTY",function(){return this.EMPTY=new $_}]),$_}(),$E=function(){function $_(){}return $M($_,"laya.ui.Styles"),$_.labelColor="#000000",$_.buttonStateNum=3,$_.scrollBarMinNum=15,$_.scrollBarDelayTime=500,$O($_,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$_}(),$$=function(){function $V(){}return $M($V,"laya.ui.UIUtils"),$V.fillArray=function($_,$S,$j){var $O=$_.concat();if($S)for(var $V=$S.split(","),$M=0,$R=Math.min($O.length,$V.length);$M<$R;$M++){var $w=$V[$M];$O[$M]="true"==$w||"false"!=$w&&$w,null!=$j&&($O[$M]=$j($w))}return $O},$V.toColor=function($_){return $y.toHexColor($_)},$V.gray=function($_,$S){void 0===$S&&($S=!0),$S?$V.addFilter($_,$V.grayFilter):$V.clearFilter($_,$w)},$V.addFilter=function($_,$S){var $j=$_.filters||[];$j.push($S),$_.filters=$j},$V.clearFilter=function($_,$S){var $j=$_.filters;if(null!=$j&&0<$j.length){for(var $O=$j.length-1;-1<$O;$O--){var $V=$j[$O];$v.__typeof($V,$S)&&$j.splice($O,1)}$_.filters=$j}},$V._getReplaceStr=function($_){return $V.escapeSequence[$_]},$V.adptString=function($_){return $_.replace(/\\(\w)/g,$V._getReplaceStr)},$V.getBindFun=function($_){var $S=$V._funMap.get($_);if(null==$S){var $j='"'+$_+'"',$O="(function(data){if(data==null)return;with(data){try{\nreturn "+($j=$j.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$S=$v._runScript($O),$V._funMap.set($_,$S)}return $S},$O($V,["grayFilter",function(){return this.grayFilter=new $w([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $P}]),$V}(),$d=function(){function $_(){}return $M($_,"UIConfig"),$_.touchScrollEnable=!0,$_.mouseWheelEnable=!0,$_.showButtons=!0,$_.popupBgColor="#000000",$_.popupBgAlpha=.5,$_.closeDialogOnSide=!0,$_}(),$n=function($j){function $o(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$o.__super.call(this),this._weakKeys=[]}$M($o,"laya.ui.AutoBitmap",$j);var $_=$o.prototype;return $_.destroy=function(){if($l.clearObject(this,this._weakKey),this._weakKeys){for(var $_=0,$S=this._weakKeys.length;$_<$S;++$_)$l.clearObject(this,this._weakKeys[$_]);this._weakKeys=null}$j.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$_._setChanged=function(){this._isChanged||(this._isChanged=!0,$v.timer.callLater(this,this.changeSource))},$_.changeSource=function(){this._isChanged=!1;var $_=this._source;if($_&&$_.bitmap){var $S=this.width,$j=this.height,$O=this._sizeGrid,$V=$_.sourceWidth,$M=$_.sourceHeight;if(!$O||$V===$S&&$M===$j)this.cleanByTexture($_,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$S,$j);else{$l.clearObject(this,this._weakKey),$_.$_GID||($_.$_GID=$y.getGID());var $R=$_.$_GID+"."+$S+"."+$j+"."+$O.join("."),$w=$l.findObject($R);if($y.isOKCmdList($w))return this._weakKey=$R,$l.keepObject(this,this._weakKey),void(this.cmds=$w);this.clear();var $a,$u,$c=$O[0],$q=$O[1],$s=$O[2],$C=$O[3],$i=$O[4],$v=!1;if($S==$V&&($C=$q=0),$j==$M&&($c=$s=0),$S<$C+$q){var $Z=$S;$v=!0,$S=$C+$q,this.save(),this.clipRect(0,0,$Z,$j)}$C&&$c&&($a=$o.getTexture($_,0,0,$C,$c),$u=this._weakKeys[0],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[0]=$a.weakKey),this.drawTexture($a,0,0,$C,$c)):($l.clearObject(this,$u),this._weakKeys[0]="")),$q&&$c&&($a=$o.getTexture($_,$V-$q,0,$q,$c),$u=this._weakKeys[1],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[1]=$a.weakKey),this.drawTexture($a,$S-$q,0,$q,$c)):($l.clearObject(this,$u),this._weakKeys[1]="")),$C&&$s&&($a=$o.getTexture($_,0,$M-$s,$C,$s),$u=this._weakKeys[2],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[2]=$a.weakKey),this.drawTexture($a,0,$j-$s,$C,$s)):($l.clearObject(this,$u),this._weakKeys[2]="")),$q&&$s&&($a=$o.getTexture($_,$V-$q,$M-$s,$q,$s),$u=this._weakKeys[3],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[3]=$a.weakKey),this.drawTexture($a,$S-$q,$j-$s,$q,$s)):($l.clearObject(this,$u),this._weakKeys[3]="")),$c&&($a=$o.getTexture($_,$C,0,$V-$C-$q,$c),$u=this._weakKeys[4],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[4]=$a.weakKey),this.drawBitmap($i,$a,$C,0,$S-$C-$q,$c)):($l.clearObject(this,$u),this._weakKeys[4]="")),$s&&($a=$o.getTexture($_,$C,$M-$s,$V-$C-$q,$s),$u=this._weakKeys[5],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[5]=$a.weakKey),this.drawBitmap($i,$a,$C,$j-$s,$S-$C-$q,$s)):($l.clearObject(this,$u),this._weakKeys[5]="")),$C&&($a=$o.getTexture($_,0,$c,$C,$M-$c-$s),$u=this._weakKeys[6],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[6]=$a.weakKey),this.drawBitmap($i,$a,0,$c,$C,$j-$c-$s)):($l.clearObject(this,$u),this._weakKeys[6]="")),$q&&($a=$o.getTexture($_,$V-$q,$c,$q,$M-$c-$s),$u=this._weakKeys[7],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[7]=$a.weakKey),this.drawBitmap($i,$a,$S-$q,$c,$q,$j-$c-$s)):($l.clearObject(this,$u),this._weakKeys[7]="")),$a=$o.getTexture($_,$C,$c,$V-$C-$q,$M-$c-$s),$u=this._weakKeys[8],$a?($u!=$a.weakKey&&($l.clearObject(this,$u),$l.keepObject(this,$a.weakKey),this._weakKeys[8]=$a.weakKey),this.drawBitmap($i,$a,$C,$c,$S-$C-$q,$j-$c-$s)):($l.clearObject(this,$u),this._weakKeys[8]=""),$v&&this.restore(),this.autoCacheCmd&&!$k.isConchApp&&($l.saveObject($R,this.cmds,null),this._weakKey=$R,$l.keepObject(this,this._weakKey))}this._repaint()}},$_.drawBitmap=function($_,$S,$j,$O,$V,$M){void 0===$V&&($V=0),void 0===$M&&($M=0),$V<.1||$M<.1||(!$_||$S.width==$V&&$S.height==$M?this.drawTexture($S,$j,$O,$V,$M):this.fillTexture($S,$j,$O,$V,$M))},$_.clear=function($_){void 0===$_&&($_=!0),$j.prototype.clear.call(this,!1)},$R(0,$_,"sizeGrid",function(){return this._sizeGrid},function($_){this._sizeGrid=$_,this._setChanged()}),$R(0,$_,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($_){this._width!=$_&&(this._width=$_,this._setChanged())}),$R(0,$_,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($_){this._height!=$_&&(this._height=$_,this._setChanged())}),$R(0,$_,"source",function(){return this._source},function($_){$_?(this._source=$_,this._setChanged()):(this._source=null,this.clear())}),$o.getTexture=function($_,$S,$j,$O,$V){$O<=0&&($O=1),$V<=0&&($V=1),$_.$_GID||($_.$_GID=$y.getGID());var $M=$_.$_GID+"."+$S+"."+$j+"."+$O+"."+$V,$R=$l.findObject($M);if((!$R||!$R.source)&&($R=$A.createFromTexture($_,$S,$j,$O,$V))){if($_.alphaTexture){var $w=$_.width/$_.alphaTexture.width;$R.alphaTexture=$A.createFromTexture($_.alphaTexture,$S/$w,$j/$w,$O/$w,$V/$w)}$l.saveObject($M,$R),$R.weakKey=$M}return $R},$o}($S),$J=(function($_){function $S(){$S.__super.call(this)}$M($S,"laya.ui.UIEvent",$u),$S.SHOW_TIP="showtip",$S.HIDE_TIP="hidetip"}(),function($S){function $_(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$_.__super.call(this),this._layout=$g.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$M($_,"laya.ui.Component",$S);var $j=$_.prototype;return $v.imps($j,{"laya.ui.IComponent":!0}),$j.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$j.preinitialize=function(){},$j.createChildren=function(){},$j.initialize=function(){},$j.callLater=function($_,$S){$v.timer.callLater(this,$_,$S)},$j.runCallLater=function($_){$v.timer.runCallLater(this,$_)},$j.commitMeasure=function(){},$j.changeSize=function(){this.event("resize")},$j.getLayout=function(){return this._layout===$g.EMPTY&&(this._layout=new $g),this._layout},$j._setLayoutEnabled=function($_){this._layout&&this._layout.enable!=$_&&(this._layout.enable=$_,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$j.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$j.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$j.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$j.resetLayoutX=function(){var $_=this._layout;if(isNaN($_.anchorX)||(this.pivotX=$_.anchorX*this.width),this.layoutEnabled){var $S=this.parent;$S&&(isNaN($_.centerX)?isNaN($_.left)?isNaN($_.right)||(this.x=Math.round($S.width-this.displayWidth-$_.right+this.pivotX*this.scaleX)):(this.x=Math.round($_.left+this.pivotX*this.scaleX),isNaN($_.right)||(this.width=($S._width-$_.left-$_.right)/(this.scaleX||.01))):this.x=Math.round(.5*($S.width-this.displayWidth)+$_.centerX+this.pivotX*this.scaleX))}},$j.resetLayoutY=function(){var $_=this._layout;if(isNaN($_.anchorY)||(this.pivotY=$_.anchorY*this.height),this.layoutEnabled){var $S=this.parent;$S&&(isNaN($_.centerY)?isNaN($_.top)?isNaN($_.bottom)||(this.y=Math.round($S.height-this.displayHeight-$_.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($_.top+this.pivotY*this.scaleY),isNaN($_.bottom)||(this.height=($S._height-$_.top-$_.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($S.height-this.displayHeight)+$_.centerY+this.pivotY*this.scaleY))}},$j.onMouseOver=function($_){$v.stage.event("showtip",this._toolTip)},$j.onMouseOut=function($_){$v.stage.event("hidetip",this._toolTip)},$R(0,$j,"displayWidth",function(){return this.width*this.scaleX}),$R(0,$j,"width",function(){return this._width?this._width:this.measureWidth},function($_){this._width!=$_&&(this._width=$_,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$R(0,$j,"measureWidth",function(){var $_=0;this.commitMeasure();for(var $S=this.numChildren-1;-1<$S;$S--){var $j=this.getChildAt($S);$j.visible&&($_=Math.max($j.x+$j.width*$j.scaleX,$_))}return $_}),$R(0,$j,"displayHeight",function(){return this.height*this.scaleY}),$R(0,$j,"height",function(){return this._height?this._height:this.measureHeight},function($_){this._height!=$_&&(this._height=$_,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$R(0,$j,"dataSource",function(){return this._dataSource},function($_){for(var $S in this._dataSource=$_,this._dataSource)this.hasOwnProperty($S)&&"function"!=typeof this[$S]&&(this[$S]=this._dataSource[$S])}),$R(0,$j,"scaleY",$S.prototype._$get_scaleY,function($_){$v.superGet($z,this,"scaleY")!=$_&&($v.superSet($z,this,"scaleY",$_),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$R(0,$j,"measureHeight",function(){var $_=0;this.commitMeasure();for(var $S=this.numChildren-1;-1<$S;$S--){var $j=this.getChildAt($S);$j.visible&&($_=Math.max($j.y+$j.height*$j.scaleY,$_))}return $_}),$R(0,$j,"scaleX",$S.prototype._$get_scaleX,function($_){$v.superGet($z,this,"scaleX")!=$_&&($v.superSet($z,this,"scaleX",$_),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$R(0,$j,"top",function(){return this._layout.top},function($_){$_!=this._layout.top&&(this.getLayout().top=$_,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$j,"bottom",function(){return this._layout.bottom},function($_){$_!=this._layout.bottom&&(this.getLayout().bottom=$_,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$j,"left",function(){return this._layout.left},function($_){$_!=this._layout.left&&(this.getLayout().left=$_,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$j,"right",function(){return this._layout.right},function($_){$_!=this._layout.right&&(this.getLayout().right=$_,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$j,"centerX",function(){return this._layout.centerX},function($_){$_!=this._layout.centerX&&(this.getLayout().centerX=$_,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$j,"centerY",function(){return this._layout.centerY},function($_){$_!=this._layout.centerY&&(this.getLayout().centerY=$_,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$j,"anchorX",function(){return this._layout.anchorX},function($_){$_!=this._layout.anchorX&&(this.getLayout().anchorX=$_,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$j,"anchorY",function(){return this._layout.anchorY},function($_){$_!=this._layout.anchorY&&(this.getLayout().anchorY=$_,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$j,"tag",function(){return this._tag},function($_){this._tag=$_}),$R(0,$j,"toolTip",function(){return this._toolTip},function($_){this._toolTip!=$_&&(null!=(this._toolTip=$_)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$R(0,$j,"comXml",function(){return this._comXml},function($_){this._comXml=$_}),$R(0,$j,"gray",function(){return this._gray},function($_){$_!==this._gray&&(this._gray=$_,$$.gray(this,$_))}),$R(0,$j,"disabled",function(){return this._disabled},function($_){$_!==this._disabled&&(this.gray=this._disabled=$_,this.mouseEnabled=!$_)}),$_}($z)),$F=function($_){function $S(){this.lockLayer=null,this.popupEffect=function($_){$_.scale(1,1),$f.from($_,{x:$v.stage.width/2,y:$v.stage.height/2,scaleX:0,scaleY:0},300,$a.backOut,$s.create(this,this.doOpen,[$_]))},this.closeEffect=function($_,$S){$f.to($_,{x:$v.stage.width/2,y:$v.stage.height/2,scaleX:0,scaleY:0},300,$a.strongOut,$s.create(this,this.doClose,[$_,$S]))},$S.__super.call(this),this.maskLayer=new $z,this.popupEffectHandler=$s.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$s.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$v.stage.addChild(this),$v.stage.on("resize",this,this._onResize),$d.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$M($S,"laya.ui.DialogManager",$z);var $j=$S.prototype;return $j._closeOnSide=function(){var $_=this.getChildAt(this.numChildren-1);$_ instanceof laya.ui.Dialog&&$_.close("side")},$j.setLockView=function($_){this.lockLayer||(this.lockLayer=new $x,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($v.stage.width,$v.stage.height)),this.lockLayer.removeChildren(),$_&&($_.centerX=$_.centerY=0,this.lockLayer.addChild($_))},$j._onResize=function($_){var $S=this.maskLayer.width=$v.stage.width,$j=this.maskLayer.height=$v.stage.height;this.lockLayer&&this.lockLayer.size($S,$j),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$S,$j,$d.popupBgColor),this.maskLayer.alpha=$d.popupBgAlpha;for(var $O=this.numChildren-1;-1<$O;$O--){var $V=this.getChildAt($O);$V.popupCenter&&this._centerDialog($V)}},$j._centerDialog=function($_){$_.x=Math.round(($v.stage.width-$_.width>>1)+$_.pivotX),$_.y=Math.round(($v.stage.height-$_.height>>1)+$_.pivotY)},$j.open=function($_,$S,$j){void 0===$S&&($S=!1),void 0===$j&&($j=!1),$S&&this._closeAll(),$_.popupCenter&&this._centerDialog($_),this.addChild($_),($_.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$j&&null!=$_.popupEffect?$_.popupEffect.runWith($_):this.doOpen($_),this.event("open")},$j.doOpen=function($_){$_.onOpened()},$j.lock=function($_){this.lockLayer&&($_?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$j.close=function($_,$S,$j){void 0===$j&&($j=!1),$j&&null!=$_.closeEffect?$_.closeEffect.runWith([$_,$S]):this.doClose($_,$S),this.event("close")},$j.doClose=function($_,$S){$_.removeSelf(),$_.isModal&&this._checkMask(),$_.closeHandler&&$_.closeHandler.runWith($S),$_.onClosed($S)},$j.closeAll=function(){this._closeAll(),this.event("close")},$j._closeAll=function(){for(var $_=this.numChildren-1;-1<$_;$_--){var $S=this.getChildAt($_);$S&&null!=$S.close&&this.doClose($S)}},$j.getDialogsByGroup=function($_){for(var $S=[],$j=this.numChildren-1;-1<$j;$j--){var $O=this.getChildAt($j);$O&&$O.group===$_&&$S.push($O)}return $S},$j.closeByGroup=function($_){for(var $S=[],$j=this.numChildren-1;-1<$j;$j--){var $O=this.getChildAt($j);$O&&$O.group===$_&&($O.close(),$S.push($O))}return $S},$j._checkMask=function(){this.maskLayer.removeSelf();for(var $_=this.numChildren-1;-1<$_;$_--){var $S=this.getChildAt($_);if($S&&$S.isModal)return void this.addChildAt(this.maskLayer,$_)}},$S}(),$x=function($_){function $S(){$S.__super.call(this)}$M($S,"laya.ui.Box",$_);var $j=$S.prototype;return $v.imps($j,{"laya.ui.IBox":!0}),$R(0,$j,"dataSource",$_.prototype._$get_dataSource,function($_){for(var $S in this._dataSource=$_){var $j=this.getChildByName($S);$j?$j.dataSource=$_[$S]:this.hasOwnProperty($S)&&"function"!=typeof this[$S]&&(this[$S]=$_[$S])}}),$S}($J),$h=function($S){function $j($_,$S){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$j.__super.call(this),this._labelColors=$E.buttonLabelColors,this._stateNum=$E.buttonStateNum,void 0===$S&&($S=""),this.skin=$_,this.label=$S}$M($j,"laya.ui.Button",$S);var $_=$j.prototype;return $v.imps($_,{"laya.ui.ISelect":!0}),$_.destroy=function($_){this.clearEvent(),$l.clearCache(this,this._skin),$l.clearObject(this,this._weakKey),void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($_),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$_.clearEvent=function(){this._skin&&$V.atalsNotify&&$V.atalsNotify.off(this._skin,this,this._setBtnSource)},$_.createChildren=function(){this.graphics=this._bitmap=new $n},$_.createText=function(){this._text||(this._text=new $H,this._text.overflow=$H.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$_.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$_.onMouse=function($_){if(!1!==this.toggle||!this._selected)return"click"===$_.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$j.stateMap[$_.type]))},$_.changeClips=function(){var $_=$l.getRes(this._skin);if($_)if(this._skin&&""!=this._skin){$l.clearObject(this,this._weakKey);var $S=$_.sourceWidth,$j=$_.sourceHeight/this._stateNum;$_.$_GID||($_.$_GID=$y.getGID());var $O=$_.$_GID+"-"+this._stateNum,$V=$l.findObject($O);if($y.isOkTextureList($V)||($V=null),$V)this._weakKey=$O,$l.keepObject(this,this._weakKey),this._sources=$V;else{if(this._sources=[],1===this._stateNum)this._sources.push($_);else for(var $M=0;$M<this._stateNum;$M++){var $R=$A.createFromTexture($_,0,$j*$M,$S,$j);if($_.alphaTexture){var $w=$_.width/$_.alphaTexture.width;$R.alphaTexture=$A.createFromTexture($_.alphaTexture,0/$w,$j*$M/$w,$S/$w,$j/$w)}this._sources.push($R)}$l.saveObject($O,this._sources),this._weakKey=$O,$l.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$S,this._bitmap.height=this._height||$j,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$S)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$_.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $_=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$_]),this.label&&(this._text.color=this._labelColors[$_],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$_]))},$_._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$R(0,$_,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($_){this.createText(),this._text.strokeColor=$_}),$R(0,$_,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$R(0,$_,"skin",function(){return this._skin},function($_){if(this._skin!=$_)if(this.clearEvent(),$l.clearCache(this,this._skin),this._skin=$_,$l.keepCache(this,this._skin),$l.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $S=$V.resAtalsObj&&$V.resAtalsObj[this._skin];$S?($V.atalsNotify&&$V.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$S.sourceW),0==this.height&&(this.height=$S.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$_._setBtnSource=function($_,$S){$_===this._skin&&$S&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$R(0,$_,"state",function(){return this._state},function($_){this._state!=$_&&(this._state=$_,this._setStateChanged())}),$R(0,$_,"text",function(){return this.createText(),this._text}),$R(0,$_,"stateNum",function(){return this._stateNum},function($_){"string"==typeof $_&&($_=parseInt($_)),this._stateNum!=$_&&(this._stateNum=$_<1?1:3<$_?3:$_,this.callLater(this.changeClips))}),$R(0,$_,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($_){this._strokeColors=$$.fillArray($E.buttonLabelColors,$_,String),this._setStateChanged()}),$R(0,$_,"labelColors",function(){return this._labelColors.join(",")},function($_){this._labelColors=$$.fillArray($E.buttonLabelColors,$_,String),this._setStateChanged()}),$R(0,$_,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$R(0,$_,"label",function(){return this._text?this._text.text:null},function($_){(this._text||$_)&&(this.createText(),this._text.text!=$_&&($_&&!this._text.parent&&this.addChild(this._text),this._text.text=($_+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$R(0,$_,"selected",function(){return this._selected},function($_){this._selected!=$_&&(this._selected=$_,this.state=this._selected?2:0,this.event("change"))}),$R(0,$_,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($_){this.createText(),this._text.padding=$$.fillArray($E.labelPadding,$_,Number)}),$R(0,$_,"labelSize",function(){return this.createText(),this._text.fontSize},function($_){this.createText(),this._text.fontSize=$_}),$R(0,$_,"labelStroke",function(){return this.createText(),this._text.stroke},function($_){this.createText(),this._text.stroke=$_}),$R(0,$_,"labelBold",function(){return this.createText(),this._text.bold},function($_){this.createText(),this._text.bold=$_}),$R(0,$_,"labelFont",function(){return this.createText(),this._text.font},function($_){this.createText(),this._text.font=$_}),$R(0,$_,"labelAlign",function(){return this.createText(),this._text.align},function($_){this.createText(),this._text.align=$_}),$R(0,$_,"clickHandler",function(){return this._clickHandler},function($_){this._clickHandler=$_}),$R(0,$_,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($_){this._bitmap.sizeGrid=$$.fillArray($E.defaultSizeGrid,$_,Number)}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($J,this,"width",$_),this._autoSize&&(this._bitmap.width=$_,this._text&&(this._text.width=$_))}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($J,this,"height",$_),this._autoSize&&(this._bitmap.height=$_,this._text&&(this._text.height=$_))}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)||"string"==typeof $_?this.label=$_+"":$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($_){this._bitmap._offset=$_?$$.fillArray([1,1],$_,Number):[]}),$O($j,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$j}($J),$N=function($S){function $O($_,$S,$j){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$O.__super.call(this),void 0===$S&&($S=1),void 0===$j&&($j=1),this._clipX=$S,this._clipY=$j,this.skin=$_}$M($O,"laya.ui.Clip",$S);var $_=$O.prototype;return $_.destroy=function($_){this.clearEvent(),this.clearLoad(),$l.clearCache(this,this._skin),$l.clearObject(this,this._weakKey),void 0===$_&&($_=!0),$S.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$_.dispose=function(){this.destroy(!0),$v.loader.clearRes(this._skin)},$_.createChildren=function(){this.graphics=this._bitmap=new $n},$_._onDisplay=function($_){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$_.changeClip=function(){if(this._clipChanged=!1,this._skin){var $_=$l.getRes(this._skin);if($_)this.loadComplete(this._skin,$_);else{if($V.resAtalsObj&&$V.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$s.create(this,this.loadComplete,[this._skin]),this._progress=null,$v.loader.load(this._skin,this._complete,this._progress)}}},$_.loadComplete=function($_,$S){if($_===this._skin&&$S){$l.clearObject(this,this._weakKey);var $j=this._clipWidth||Math.ceil($S.sourceWidth/this._clipX),$O=this._clipHeight||Math.ceil($S.sourceHeight/this._clipY),$V=this._skin+$j+$O,$M=$l.findObject($V);if($y.isOkTextureList($M)||($M=null),$M)this._weakKey=$V,$l.keepObject(this,this._weakKey),this._sources=$M;else{this._sources=[];for(var $R=0;$R<this._clipY;$R++)for(var $w=0;$w<this._clipX;$w++){var $a=$A.createFromTexture($S,$j*$w,$O*$R,$j,$O);if($S.alphaTexture){var $u=$S.width/$S.alphaTexture.width;$a.alphaTexture=$A.createFromTexture($S.alphaTexture,$j*$w/$u,$O*$R/$u,$j/$u,$O/$u)}this._sources.push($a)}$l.saveObject($V,this._sources),this._weakKey=$V,$l.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$_.play=function($_,$S){void 0===$_&&($_=0),void 0===$S&&($S=-1),this._isPlaying=!0,this.index=$_,this._toIndex=$S,this._index++,$v.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$_._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$_.stop=function(){this._isPlaying=!1,$v.timer.clear(this,this._loop),this.event("complete")},$_._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$R(0,$_,"interval",function(){return this._interval},function($_){this._interval!=$_&&(this._interval=$_,this._isPlaying&&this.play())}),$_.clearEvent=function(){this._skin&&$V.atalsNotify&&$V.atalsNotify.off(this._skin,this,this._setBtnSource)},$_.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$v.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$R(0,$_,"skin",function(){return this._skin},function($_){if(this._skin!=$_)if(this.clearLoad(),this.clearEvent(),$l.clearCache(this,this._skin),this._skin=$_){$l.keepCache(this,this._skin);var $S=$l.getRes($_),$j=$V.resAtalsObj&&$V.resAtalsObj[this._skin];!$S&&$j?$V.atalsNotify&&$V.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$_._setBtnSource=function($_,$S){$_===this._skin&&$S&&(this.loadComplete($_,$S),this.clearEvent())},$R(0,$_,"sources",function(){return this._sources},function($_){this._sources=$_,this.index=this._index,this.event("loaded")}),$R(0,$_,"clipX",function(){return this._clipX},function($_){this._clipX=$_||1,this._setClipChanged()}),$R(0,$_,"clipY",function(){return this._clipY},function($_){this._clipY=$_||1,this._setClipChanged()}),$R(0,$_,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$R(0,$_,"clipWidth",function(){return this._clipWidth},function($_){this._clipWidth=$_,this._setClipChanged()}),$R(0,$_,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($_){this._bitmap.sizeGrid=$$.fillArray($E.defaultSizeGrid,$_,Number)}),$R(0,$_,"group",function(){return this._group},function($_){$_&&this._skin&&$l.setGroup(this._skin,$_),this._group=$_}),$R(0,$_,"clipHeight",function(){return this._clipHeight},function($_){this._clipHeight=$_,this._setClipChanged()}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($J,this,"width",$_),this._bitmap.width=$_}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($J,this,"height",$_),this._bitmap.height=$_}),$R(0,$_,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$R(0,$_,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$R(0,$_,"index",function(){return this._index},function($_){this._index=$_,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$_]),this.event("change")}),$R(0,$_,"autoPlay",function(){return this._autoPlay},function($_){this._autoPlay!=$_&&((this._autoPlay=$_)?this.play():this.stop())}),$R(0,$_,"isPlaying",function(){return this._isPlaying},function($_){this._isPlaying=$_}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)&&Math.floor($_)==$_||"string"==typeof $_?this.index=parseInt($_):$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"bitmap",function(){return this._bitmap}),$O}($J),$B=function($S){function $_(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$_.__super.call(this)}$M($_,"laya.ui.ColorPicker",$S);var $j=$_.prototype;return $j.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._colorPanel&&this._colorPanel.destroy($_),this._colorButton&&this._colorButton.destroy($_),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$j.createChildren=function(){this.addChild(this._colorButton=new $h),this._colorPanel=new $x,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $z),this._colorPanel.addChild(this._colorBlock=new $z),this._colorPanel.addChild(this._colorInput=new $C)},$j.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$j.onPanelMouseDown=function($_){$_.stopPropagation()},$j.changePanel=function(){this._panelChanged=!1;var $_=this._colorPanel.graphics;$_.clear(),$_.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($_=this._colorTiles.graphics).clear();for(var $S=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$j=0;$j<12;$j++)for(var $O=0;$O<20;$O++){var $V=0;$V=0===$O?$S[$j]:1===$O?0:51*(((3*$j+$O/6)%3<<0)+3*($j/6<<0))<<16|$O%6*51<<8|($j<<0)%6*51;var $M=$$.toColor($V);this._colors.push($M);var $R=$O*this._gridSize,$w=$j*this._gridSize;$_.drawRect($R,$w,this._gridSize,this._gridSize,$M,"#000000")}},$j.onColorButtonClick=function($_){this._colorPanel.parent?this.close():this.open()},$j.open=function(){var $_=this.localToGlobal(new $i),$S=$_.x+this._colorPanel.width<=$v.stage.width?$_.x:$v.stage.width-this._colorPanel.width,$j=$_.y+this._colorButton.height;$j=$j+this._colorPanel.height<=$v.stage.height?$j:$_.y-this._colorPanel.height,this._colorPanel.pos($S,$j),this._colorPanel.zOrder=1001,$v._currentStage.addChild(this._colorPanel),$v.stage.on("mousedown",this,this.removeColorBox)},$j.close=function(){$v.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$j.removeColorBox=function($_){this.close()},$j.onColorFieldKeyDown=function($_){13==$_.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$_.stopPropagation())},$j.onColorInputChange=function($_){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$j.onColorTilesClick=function($_){this.selectedColor=this.getColorByMouse(),this.close()},$j.onColorTilesMouseMove=function($_){this._colorInput.focus=!1;var $S=this.getColorByMouse();this._colorInput.text=$S,this.drawBlock($S)},$j.getColorByMouse=function(){var $_=this._colorTiles.getMousePoint(),$S=Math.floor($_.x/this._gridSize),$j=Math.floor($_.y/this._gridSize);return this._colors[20*$j+$S]},$j.drawBlock=function($_){var $S=this._colorBlock.graphics;$S.clear();var $j=$_||"#ffffff";$S.drawRect(0,0,50,20,$j,this._borderColor),$_||$S.drawLine(0,0,50,20,"#ff0000")},$j.changeColor=function(){var $_=this.graphics;$_.clear();var $S=this._selectedColor||"#000000";$_.drawRect(0,0,this._colorButton.width,this._colorButton.height,$S)},$j._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$R(0,$j,"inputBgColor",function(){return this._inputBgColor},function($_){this._inputBgColor=$_,this._setPanelChanged()}),$R(0,$j,"selectedColor",function(){return this._selectedColor},function($_){this._selectedColor!=$_&&(this._selectedColor=this._colorInput.text=$_,this.drawBlock($_),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$u.EMPTY.setTo("change",this,this)))}),$R(0,$j,"skin",function(){return this._colorButton.skin},function($_){this._colorButton.skin=$_,this.changeColor()}),$R(0,$j,"bgColor",function(){return this._bgColor},function($_){this._bgColor=$_,this._setPanelChanged()}),$R(0,$j,"borderColor",function(){return this._borderColor},function($_){this._borderColor=$_,this._setPanelChanged()}),$R(0,$j,"inputColor",function(){return this._inputColor},function($_){this._inputColor=$_,this._setPanelChanged()}),$_}($J),$t=function($S){function $j($_,$S){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$j.__super.call(this),this._itemColors=$E.comboBoxItemColors,this.skin=$_,this.labels=$S}$M($j,"laya.ui.ComboBox",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._button&&this._button.destroy($_),this._list&&this._list.destroy($_),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$_.createChildren=function(){this.addChild(this._button=new $h),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$_._createList=function(){this._list=new $W,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$_._setListEvent=function($_){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$s.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$_.onListDown=function($_){$_.stopPropagation()},$_.onScrollBarDown=function($_){$_.stopPropagation()},$_.onButtonMouseDown=function($_){this.callLater(this.switchTo,[!this._isOpen])},$_.changeList=function(){this._listChanged=!1;var $_=this.width-2,$S=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$_,height:this._itemHeight,fontSize:this._itemSize,color:$S}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$_.onlistItemMouse=function($_,$S){var $j=$_.type;if("mouseover"===$j||"mouseout"===$j){if(this._isCustomList)return;var $O=this._list.getCell($S);if(!$O)return;var $V=$O.getChildByName("label");$V&&("mouseover"===$j?($V.bgColor=this._itemColors[0],$V.color=this._itemColors[1]):($V.bgColor=null,$V.color=this._itemColors[2]))}else"click"===$j&&(this.selectedIndex=$S,this.isOpen=!1)},$_.switchTo=function($_){this.isOpen=$_},$_.changeOpen=function(){this.isOpen=!this._isOpen},$_.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $_=this._list.graphics;$_.clear(),$_.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $S=this._list.array||[],$j=$S.length=0,$O=this._labels.length;$j<$O;$j++)$S.push({label:this._labels[$j]});this._list.height=this._listHeight,this._list.array=$S},$_.changeSelected=function(){this._button.label=this.selectedLabel},$_._onStageMouseWheel=function($_){this._list&&!this._list.contains($_.target)&&this.removeList(null)},$_.removeList=function($_){$v.stage.off("mousedown",this,this.removeList),$v.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$R(0,$_,"selectedIndex",function(){return this._selectedIndex},function($_){this._selectedIndex!=$_&&(this._selectedIndex=$_,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$u.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$R(0,$_,"measureHeight",function(){return this._button.height}),$R(0,$_,"skin",function(){return this._button.skin},function($_){this._button.skin!=$_&&(this._button.skin=$_,this._listChanged=!0)}),$R(0,$_,"measureWidth",function(){return this._button.width}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($J,this,"width",$_),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$R(0,$_,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($_){this.selectedIndex=this._labels.indexOf($_)}),$R(0,$_,"labels",function(){return this._labels.join(",")},function($_){0<this._labels.length&&(this.selectedIndex=-1),$_?this._labels=$_.split(","):this._labels.length=0,this._itemChanged=!0}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($J,this,"height",$_),this._button.height=this._height}),$R(0,$_,"selectHandler",function(){return this._selectHandler},function($_){this._selectHandler=$_}),$R(0,$_,"visibleNum",function(){return this._visibleNum},function($_){this._visibleNum=$_,this._listChanged=!0}),$R(0,$_,"labelBold",function(){return this._button.text.bold},function($_){this._button.text.bold=$_}),$R(0,$_,"itemColors",function(){return String(this._itemColors)},function($_){this._itemColors=$$.fillArray(this._itemColors,$_,String),this._listChanged=!0}),$R(0,$_,"itemSize",function(){return this._itemSize},function($_){this._itemSize=$_,this._listChanged=!0}),$R(0,$_,"scrollBar",function(){return this.list.scrollBar}),$R(0,$_,"isOpen",function(){return this._isOpen},function($_){if(this._isOpen!=$_)if(this._isOpen=$_,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $S=this.localToGlobal($i.TEMP.setTo(0,0)),$j=$S.y+this._button.height;$j=$j+this._listHeight<=$v.stage.height?$j:$S.y-this._listHeight,this._list.pos($S.x,$j),this._list.zOrder=1001,$v._currentStage.addChild(this._list),$v.stage.once("mousedown",this,this.removeList),$v.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$R(0,$_,"scrollBarSkin",function(){return this._scrollBarSkin},function($_){this._scrollBarSkin=$_}),$R(0,$_,"sizeGrid",function(){return this._button.sizeGrid},function($_){this._button.sizeGrid=$_}),$R(0,$_,"button",function(){return this._button}),$R(0,$_,"list",function(){return this._list||this._createList(),this._list},function($_){$_&&($_.removeSelf(),this._isCustomList=!0,this._list=$_,this._setListEvent($_),this._itemHeight=$_.getCell(0).height+$_.spaceY)}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)&&Math.floor($_)==$_||"string"==typeof $_?this.selectedIndex=parseInt($_):$_ instanceof Array?this.labels=$_.join(","):$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"labelColors",function(){return this._button.labelColors},function($_){this._button.labelColors!=$_&&(this._button.labelColors=$_)}),$R(0,$_,"labelPadding",function(){return this._button.text.padding.join(",")},function($_){this._button.text.padding=$$.fillArray($E.labelPadding,$_,Number)}),$R(0,$_,"labelSize",function(){return this._button.text.fontSize},function($_){this._button.text.fontSize=$_}),$R(0,$_,"labelFont",function(){return this._button.text.font},function($_){this._button.text.font=$_}),$R(0,$_,"stateNum",function(){return this._button.stateNum},function($_){this._button.stateNum=$_}),$j}($J),$m=function($S){function $j($_){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$j.__super.call(this),this._showButtons=$d.showButtons,this._touchScrollEnable=$d.touchScrollEnable,this._mouseWheelEnable=$d.mouseWheelEnable,this.skin=$_,this.max=1}$M($j,"laya.ui.ScrollBar",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),this.stopScroll(),this.target=null,$S.prototype.destroy.call(this,$_),this.upButton&&this.upButton.destroy($_),this.downButton&&this.downButton.destroy($_),this.slider&&this.slider.destroy($_),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$_.createChildren=function(){this.addChild(this.slider=new $e),this.addChild(this.upButton=new $h),this.addChild(this.downButton=new $h)},$_.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$_.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$_.onButtonMouseDown=function($_){var $S=$_.currentTarget===this.upButton;this.slide($S),$v.timer.once($E.scrollBarDelayTime,this,this.startLoop,[$S]),$v.stage.once("mouseup",this,this.onStageMouseUp)},$_.startLoop=function($_){$v.timer.frameLoop(1,this,this.slide,[$_])},$_.slide=function($_){$_?this.value-=this._scrollSize:this.value+=this._scrollSize},$_.onStageMouseUp=function($_){$v.timer.clear(this,this.startLoop),$v.timer.clear(this,this.slide)},$_.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$_.changeSize=function(){$S.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$_.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$_.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$_.setScroll=function($_,$S,$j){this.runCallLater(this.changeSize),this.slider.setSlider($_,$S,$j),this.slider.bar.visible=0<$S,!this._hide&&this.autoHide&&(this.visible=!1)},$_.onTargetMouseWheel=function($_){this.value-=$_.delta*this._scrollSize,this.target=this._target},$_.onTargetMouseDown=function($_){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $i),this._lastPoint.setTo($v.stage.mouseX,$v.stage.mouseY),$v.timer.clear(this,this.tweenMove),$f.clearTween(this),$v.stage.once("mouseup",this,this.onStageMouseUp2),$v.stage.once("mouseout",this,this.onStageMouseUp2),$v.timer.frameLoop(1,this,this.loop)},$_.loop=function(){var $_=$v.stage.mouseY,$S=$v.stage.mouseX;if(this._lastOffset=this.isVertical?$_-this._lastPoint.y:$S-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$v.stage._canvasTransform.getScaleY():$v.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$S,this._lastPoint.y=$_,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$_.onStageMouseUp2=function($_){if($v.stage.off("mouseup",this,this.onStageMouseUp2),$v.stage.off("mouseout",this,this.onStageMouseUp2),$v.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$f.to(this,{value:this.min},this.elasticBackTime,$a.sineOut,$s.create(this,this.elasticOver)):this._value>this.max&&$f.to(this,{value:this.max},this.elasticBackTime,$a.sineOut,$s.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$v.stage.mouseY-this._lastPoint.y:$v.stage.mouseX-this._lastPoint.x);for(var $S=0,$j=Math.min(this._offsets.length,3),$O=0;$O<$j;$O++)$S+=this._offsets[this._offsets.length-1-$O];if(this._lastOffset=$S/$j,($S=Math.abs(this._lastOffset))<2)return void this.event("end");60<$S&&(this._lastOffset=0<this._lastOffset?60:-60);var $V=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$v.timer.frameLoop(1,this,this.tweenMove,[$V])}},$_.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$f.to(this,{alpha:0},500),this.event("end")},$_.tweenMove=function($_){this._lastOffset*=this.rollRatio;var $S=NaN;if(0<$_&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$S=.5*-(this.min-$_-this.value),this._lastOffset>$S&&(this._lastOffset=$S)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$S=.5*-(this.max+$_-this.value),this._lastOffset<$S&&(this._lastOffset=$S))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($v.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$f.to(this,{value:this.min},this.elasticBackTime,$a.sineOut,$s.create(this,this.elasticOver)):this._value>this.max?$f.to(this,{value:this.max},this.elasticBackTime,$a.sineOut,$s.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$f.to(this,{alpha:0},500)}},$_.stopScroll=function(){this.onStageMouseUp2(null),$v.timer.clear(this,this.tweenMove),$f.clearTween(this)},$R(0,$_,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$R(0,$_,"skin",function(){return this._skin},function($_){this._skin!=$_&&(this._skin=$_,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$R(0,$_,"max",function(){return this.slider.max},function($_){this.slider.max=$_}),$R(0,$_,"showButtons",function(){return this._showButtons},function($_){this._showButtons=$_,this.callLater(this.changeScrollBar)}),$R(0,$_,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$R(0,$_,"min",function(){return this.slider.min},function($_){this.slider.min=$_}),$R(0,$_,"value",function(){return this._value},function($_){$_!==this._value&&(this._value=$_,this._isElastic||(this.slider._value!=$_&&(this.slider._value=$_,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$R(0,$_,"isVertical",function(){return this.slider.isVertical},function($_){this.slider.isVertical=$_}),$R(0,$_,"sizeGrid",function(){return this.slider.sizeGrid},function($_){this.slider.sizeGrid=$_}),$R(0,$_,"scrollSize",function(){return this._scrollSize},function($_){this._scrollSize=$_}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)||"string"==typeof $_?this.value=Number($_):$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"thumbPercent",function(){return this._thumbPercent},function($_){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$_=1<=$_?.99:$_,this._thumbPercent=$_,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$_,$E.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$_,$E.scrollBarMinNum))}),$R(0,$_,"target",function(){return this._target},function($_){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$_)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$R(0,$_,"hide",function(){return this._hide},function($_){this._hide=$_,this.visible=!$_}),$R(0,$_,"touchScrollEnable",function(){return this._touchScrollEnable},function($_){this._touchScrollEnable=$_,this.target=this._target}),$R(0,$_,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($_){this._mouseWheelEnable=$_,this.target=this._target}),$R(0,$_,"tick",function(){return this.slider.tick},function($_){this.slider.tick=$_}),$j}($J),$e=function($S){function $j($_){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$j.__super.call(this),this.skin=$_}$M($j,"laya.ui.Slider",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._bg&&this._bg.destroy($_),this._bar&&this._bar.destroy($_),this._progress&&this._progress.destroy($_),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$_.createChildren=function(){this.addChild(this._bg=new $G),this.addChild(this._bar=new $h)},$_.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$_.onBarMouseDown=function($_){this._globalSacle||(this._globalSacle=new $i),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$v.stage.mouseX,this._ty=$v.stage.mouseY,$v.stage.on("mousemove",this,this.mouseMove),$v.stage.once("mouseup",this,this.mouseUp),$v.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$_.showValueText=function(){if(this.showLabel){var $_=laya.ui.Slider.label;this.addChild($_),$_.textField.changeText(this._value+""),this.isVertical?($_.x=this._bar.x+20,$_.y=.5*(this._bar.height-$_.height)+this._bar.y):($_.y=this._bar.y-20,$_.x=.5*(this._bar.width-$_.width)+this._bar.x)}},$_.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$_.mouseUp=function($_){$v.stage.off("mousemove",this,this.mouseMove),$v.stage.off("mouseup",this,this.mouseUp),$v.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$_.mouseMove=function($_){var $S=this._value;this.isVertical?(this._bar.y+=($v.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($v.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$v.stage.mouseX,this._ty=$v.stage.mouseY;var $j=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$j)/$j,this._value!=$S&&this.sendChangeEvent(),this.showValueText()},$_.sendChangeEvent=function($_){void 0===$_&&($_="change"),this.event($_),this.changeHandler&&this.changeHandler.runWith(this._value)},$_.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$_.changeSize=function(){$S.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$_.setSlider=function($_,$S,$j){this._value=-1,this._min=$_,this._max=$_<$S?$S:$_,this.value=$j<$_?$_:$S<$j?$S:$j},$_.changeValue=function(){var $_=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$_)/$_,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $S=this._max-this._min;0===$S&&($S=1),this.isVertical?(this._bar.y=(this._value-this._min)/$S*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$S*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$_.onBgMouseDown=function($_){var $S=this._bg.getMousePoint();this.isVertical?this.value=$S.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$S.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$R(0,$_,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$R(0,$_,"skin",function(){return this._skin},function($_){if(this._skin!=$_){this._skin=$_,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $S=this._skin.replace(".png","$progress.png");$l.getRes($S)&&(this._progress||(this.addChild(this._progress=new $G),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$S),this.setBarPoint(),this.callLater(this.changeValue)}}),$R(0,$_,"allowClickBack",function(){return this._allowClickBack},function($_){this._allowClickBack!=$_&&((this._allowClickBack=$_)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$R(0,$_,"max",function(){return this._max},function($_){this._max!=$_&&(this._max=$_,this.callLater(this.changeValue))}),$R(0,$_,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$R(0,$_,"tick",function(){return this._tick},function($_){this._tick!=$_&&(this._tick=$_,this.callLater(this.changeValue))}),$R(0,$_,"sizeGrid",function(){return this._bg.sizeGrid},function($_){this._bg.sizeGrid=$_,this._bar.sizeGrid=$_,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$R(0,$_,"min",function(){return this._min},function($_){this._min!=$_&&(this._min=$_,this.callLater(this.changeValue))}),$R(0,$_,"value",function(){return this._value},function($_){if(this._value!=$_){var $S=this._value;this._value=$_,this.changeValue(),this._value!=$S&&this.sendChangeEvent()}}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)||"string"==typeof $_?this.value=Number($_):$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"bar",function(){return this._bar}),$O($j,["label",function(){return this.label=new $D}]),$j}($J),$G=function($S){function $j($_){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$j.__super.call(this),this.skin=$_}$M($j,"laya.ui.Image",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$l.clearCache(this,this._skin)},$_.dispose=function(){this.destroy(!0),$l.clearCache(this,this._skin),this.clearEvent()},$_.createChildren=function(){this.graphics=this._bitmap=new $n},$_.setSource=function($_,$S){this.destroyed||$_===this._skin&&$S&&(this.source=$S,this.onCompResize(),this.clearEvent())},$_.clearEvent=function(){this._skin&&$V.atalsNotify&&$V.atalsNotify.off(this._skin,this,this.setSource)},$_.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$v.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$R(0,$_,"source",function(){return this._bitmap.source},function($_){this._bitmap&&(this._bitmap.source=$_,this.event("loaded"),this.repaint())}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"string"==typeof(this._dataSource=$_)?this.skin=$_:$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"measureHeight",function(){return this._bitmap.height}),$R(0,$_,"skin",function(){return this._skin},function($_){if(this._skin!=$_)if($l.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$_){$l.keepCache(this,this._skin);var $S=$l.getRes($_),$j=$V.resAtalsObj&&$V.resAtalsObj[this._skin];$S?(this.source=$S,this.onCompResize()):$j?($V.atalsNotify&&$V.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$j.sourceW),0==this.height&&(this.height=$j.sourceH)):(this._complete=$s.create(this,this.setSource,[this._skin]),this._progress=null,$v.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$R(0,$_,"group",function(){return this._group},function($_){$_&&this._skin&&$l.setGroup(this._skin,$_),this._group=$_}),$R(0,$_,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($_){this._bitmap.sizeGrid=$$.fillArray($E.defaultSizeGrid,$_,Number)}),$R(0,$_,"measureWidth",function(){return this._bitmap.width}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($J,this,"width",$_),this._bitmap.width=0==$_?1e-7:$_}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($J,this,"height",$_),this._bitmap.height=0==$_?1e-7:$_}),$j}($J),$D=function($S){function $j($_){this._tf=null,$j.__super.call(this),void 0===$_&&($_=""),$c.defaultColor=$E.labelColor,this.text=$_}$M($j,"laya.ui.Label",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._tf=null},$_.createChildren=function(){this.addChild(this._tf=new $H)},$_.changeText=function($_){this._tf.changeText($_)},$R(0,$_,"padding",function(){return this._tf.padding.join(",")},function($_){this._tf.padding=$$.fillArray($E.labelPadding,$_,Number)}),$R(0,$_,"bold",function(){return this._tf.bold},function($_){this._tf.bold=$_}),$R(0,$_,"align",function(){return this._tf.align},function($_){this._tf.align=$_}),$R(0,$_,"text",function(){return this._tf.text},function($_){this._tf.text!=$_&&($_&&($_=$$.adptString($_+"")),this._tf.text=$_,this.event("change"),this._width&&this._height||this.onCompResize())}),$R(0,$_,"italic",function(){return this._tf.italic},function($_){this._tf.italic=$_}),$R(0,$_,"wordWrap",function(){return this._tf.wordWrap},function($_){this._tf.wordWrap=$_}),$R(0,$_,"font",function(){return this._tf.font},function($_){this._tf.font=$_}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)||"string"==typeof $_?this.text=$_+"":$v.superSet($J,this,"dataSource",$_)}),$R(0,$_,"color",function(){return this._tf.color},function($_){this._tf.color=$_}),$R(0,$_,"valign",function(){return this._tf.valign},function($_){this._tf.valign=$_}),$R(0,$_,"leading",function(){return this._tf.leading},function($_){this._tf.leading=$_}),$R(0,$_,"fontSize",function(){return this._tf.fontSize},function($_){this._tf.fontSize=$_}),$R(0,$_,"bgColor",function(){return this._tf.bgColor},function($_){this._tf.bgColor=$_}),$R(0,$_,"borderColor",function(){return this._tf.borderColor},function($_){this._tf.borderColor=$_}),$R(0,$_,"stroke",function(){return this._tf.stroke},function($_){this._tf.stroke=$_}),$R(0,$_,"strokeColor",function(){return this._tf.strokeColor},function($_){this._tf.strokeColor=$_}),$R(0,$_,"textField",function(){return this._tf}),$R(0,$_,"measureWidth",function(){return this._tf.width}),$R(0,$_,"measureHeight",function(){return this._tf.height}),$R(0,$_,"width",function(){return this._width||this._tf.text?$v.superGet($J,this,"width"):0},function($_){$v.superSet($J,this,"width",$_),this._tf.width=$_}),$R(0,$_,"height",function(){return this._height||this._tf.text?$v.superGet($J,this,"height"):0},function($_){$v.superSet($J,this,"height",$_),this._tf.height=$_}),$R(0,$_,"overflow",function(){return this._tf.overflow},function($_){this._tf.overflow=$_}),$R(0,$_,"underline",function(){return this._tf.underline},function($_){this._tf.underline=$_}),$R(0,$_,"underlineColor",function(){return this._tf.underlineColor},function($_){this._tf.underlineColor=$_}),$j}($J),$L=function($S){function $j($_){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$j.__super.call(this),this.skin=$_}$M($j,"laya.ui.ProgressBar",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._bg&&this._bg.destroy($_),this._bar&&this._bar.destroy($_),this._bg=this._bar=null,this.changeHandler=null},$_.createChildren=function(){this.addChild(this._bg=new $G),this.addChild(this._bar=new $G)},$_.changeValue=function(){if(this.sizeGrid){var $_=this.sizeGrid.split(","),$S=Number($_[3]),$j=Number($_[1]),$O=(this.width-$S-$j)*this._value;this._bar.width=$S+$j+$O,this._bar.visible=this._bar.width>$S+$j}else this._bar.width=this.width*this._value},$R(0,$_,"measureHeight",function(){return this._bg.height}),$R(0,$_,"skin",function(){return this._skin},function($_){this._skin!=$_&&(this._skin=$_,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$R(0,$_,"measureWidth",function(){return this._bg.width}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($J,this,"height",$_),this._bg.height=this._height,this._bar.height=this._height}),$R(0,$_,"bar",function(){return this._bar}),$R(0,$_,"value",function(){return this._value},function($_){this._value!=$_&&($_=1<$_?1:$_<0?0:$_,this._value=$_,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($_))}),$R(0,$_,"bg",function(){return this._bg}),$R(0,$_,"sizeGrid",function(){return this._bg.sizeGrid},function($_){this._bg.sizeGrid=this._bar.sizeGrid=$_}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($J,this,"width",$_),this._bg.width=this._width,this.callLater(this.changeValue)}),$R(0,$_,"dataSource",$S.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)||"string"==typeof $_?this.value=Number($_):$v.superSet($J,this,"dataSource",$_)}),$j}($J),$U=(function($_){function $j(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$j.__super.call(this),this._tipBox=new $J,this._tipBox.addChild(this._tipText=new $H),this._tipText.x=this._tipText.y=5,this._tipText.color=$j.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$v.stage.on("showtip",this,this._onStageShowTip),$v.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$M($j,"laya.ui.TipManager",$J);var $S=$j.prototype;$S._onStageHideTip=function($_){$v.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$S._onStageShowTip=function($_){$v.timer.once($j.tipDelay,this,this._showTip,[$_],!0)},$S._showTip=function($_){if("string"==typeof $_){var $S=String($_);Boolean($S)&&this._defaultTipHandler($S)}else $_ instanceof laya.utils.Handler?$_.run():"function"==typeof $_&&$_.apply();$v.stage.on("mousemove",this,this._onStageMouseMove),$v.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$S._onStageMouseDown=function($_){this.closeAll()},$S._onStageMouseMove=function($_){this._showToStage(this,$j.offsetX,$j.offsetY)},$S._showToStage=function($_,$S,$j){void 0===$S&&($S=0),void 0===$j&&($j=0);var $O=$_.getBounds();$_.x=$v.stage.mouseX+$S,$_.y=$v.stage.mouseY+$j,$_.x+$O.width>$v.stage.width&&($_.x-=$O.width+$S),$_.y+$O.height>$v.stage.height&&($_.y-=$O.height+$j)},$S.closeAll=function(){$v.timer.clear(this,this._showTip),$v.stage.off("mousemove",this,this._onStageMouseMove),$v.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$S.showDislayTip=function($_){this.addChild($_),this._showToStage(this),$v._currentStage.addChild(this)},$S._showDefaultTip=function($_){this._tipText.text=$_;var $S=this._tipBox.graphics;$S.clear(),$S.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$j.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$v._currentStage.addChild(this)},$R(0,$S,"defaultTipHandler",function(){return this._defaultTipHandler},function($_){this._defaultTipHandler=$_}),$j.offsetX=10,$j.offsetY=15,$j.tipTextColor="#ffffff",$j.tipBackColor="#111111",$j.tipDelay=200}(),function($_){var $C;function $i(){this._idMap=null,this._aniList=null,this._watchMap={},$i.__super.call(this)}$M($i,"laya.ui.View",$x);var $S=$i.prototype;return $S.createView=function($_){if($_.animations&&!this._idMap&&(this._idMap={}),$i.createComp($_,this,this),$_.animations){var $S,$j,$O=[],$V=$_.animations,$M=0,$R=$V.length;for($M=0;$M<$R;$M++){switch($S=new $q,$j=$V[$M],$S._setUp(this._idMap,$j),(this[$j.name]=$S)._setControlNode(this),$j.action){case 1:$S.play(0,!1);break;case 2:$S.play(0,!0)}$O.push($S)}this._aniList=$O}0<this._width&&null==$_.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$S.onEvent=function($_,$S){},$S.loadUI=function($_){var $S=$i.uiMap[$_];$S&&this.createView($S)},$S.destroy=function($_){void 0===$_&&($_=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$_)},$S.changeData=function($_){var $S=this._watchMap[$_];if($S){console.log("change",$_);for(var $j=0,$O=$S.length;$j<$O;$j++){$S[$j].exe(this)}}},$i._regs=function(){for(var $_ in $i.uiClassMap)$Z.regClass($_,$i.uiClassMap[$_])},$i.createComp=function($_,$S,$j,$O){if(!($S=$S||$i.getCompInstance($_)))return console.warn("can not create:"+$_.type),null;var $V=$_.child;if($V)for(var $M=$S instanceof laya.ui.List,$R=0,$w=$V.length;$R<$w;$R++){var $a=$V[$R];if(!$S.hasOwnProperty("itemRender")||"render"!=$a.props.name&&"render"!==$a.props.renderType)if("Graphic"==$a.type)$Z.addGraphicsToSprite($a,$S);else if($Z.isDrawType($a.type))$Z.addGraphicToSprite($a,$S,!0);else{if($M){var $u=[],$c=$i.createComp($a,null,$j,$u);$u.length&&($c._$bindData=$u)}else $c=$i.createComp($a,null,$j,$O);"Script"==$a.type?"owner"in $c?$c.owner=$S:"target"in $c&&($c.target=$S):"mask"==$a.props.renderType||"mask"==$a.props.name?$S.mask=$c:$c instanceof laya.display.Sprite&&$S.addChild($c)}else $S.itemRender=$a}var $q=$_.props;for(var $s in $q){var $C=$q[$s];$i.eventDic[$s]?$C&&$j&&$S.on($s,$j,$j.onEvent,[$C]):$i.setCompValue($S,$s,$C,$j,$O)}return $v.__typeof($S,"laya.ui.IItem")&&$S.initItems(),$_.compId&&$j&&$j._idMap&&($j._idMap[$_.compId]=$S),$S},$i.setCompValue=function($_,$S,$j,$O,$V){if("string"==typeof $j&&-1<$j.indexOf("${")){if($i._sheet||($i._sheet=$Z.getClass("laya.data.Table")),!$i._sheet)return void console.warn("Can not find class Sheet");if($V)$V.push($_,$S,$j);else if($O){-1==$j.indexOf("].")&&($j=$j.replace(".","[0]."));var $M,$R,$w=new $C($_,$S,$j);$w.exe($O);for(var $a=$j.replace(/\[.*?\]\./g,".");null!=($M=$i._parseWatchData.exec($a));){for(var $u=$M[1];null!=($R=$i._parseKeyWord.exec($u));){var $c=$R[0],$q=$O._watchMap[$c]||($O._watchMap[$c]=[]);$q.push($w),$i._sheet.I.notifer.on($c,$O,$O.changeData,[$c])}($q=$O._watchMap[$u]||($O._watchMap[$u]=[])).push($w),$i._sheet.I.notifer.on($u,$O,$O.changeData,[$u])}}}else if("var"===$S&&$O)$O[$j]=$_;else if("onClick"==$S){var $s=$v._runScript("(function(){"+$j+"})");$_.on("click",$O,$s)}else $_[$S]="true"===$j||"false"!==$j&&$j},$i.getCompInstance=function($_){var $S,$j=$_.props?$_.props.runtime:null;return $S=$j?$i.viewClassMap[$j]||$i.uiClassMap[$j]||$v.__classmap[$j]:$i.uiClassMap[$_.type],$_.props&&$_.props.hasOwnProperty("renderType")&&"instance"==$_.props.renderType?$S.instance:$S?new $S:null},$i.regComponent=function($_,$S){$i.uiClassMap[$_]=$S,$Z.regClass($_,$S)},$i.regViewRuntime=function($_,$S){$i.viewClassMap[$_]=$S},$i.uiMap={},$i.viewClassMap={},$i._sheet=null,$O($i,["uiClassMap",function(){return this.uiClassMap={ViewStack:$__,LinkButton:$h,TextArea:$u_,ColorPicker:$B,Box:$x,Button:$h,CheckBox:$Q,Clip:$N,ComboBox:$t,Component:$J,HScrollBar:$p,HSlider:$K,Image:$G,Label:$D,List:$W,Panel:$I,ProgressBar:$L,Radio:$r,RadioGroup:$w_,ScrollBar:$m,Slider:$e,Tab:$a_,TextInput:$j_,View:$i,VScrollBar:$S_,VSlider:$O_,Tree:$b,HBox:$M_,VBox:$R_,Sprite:$z,Animation:$j,Text:$H,FontClip:$T}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$i.__init$=function(){$i._regs(),$C=function(){function $_($_,$S,$j){this.comp=null,this.prop=null,this.value=null,this.comp=$_,this.prop=$S,this.value=$j}return $M($_,""),$_.prototype.exe=function($_){var $S=$$.getBindFun(this.value);this.comp[this.prop]=$S.call(this,$_)},$_}()},$i}()),$Q=function($_){function $j($_,$S){void 0===$S&&($S=""),$j.__super.call(this,$_,$S)}$M($j,"laya.ui.CheckBox",$_);var $S=$j.prototype;return $S.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$S.initialize=function(){$_.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$R(0,$S,"dataSource",$_.prototype._$get_dataSource,function($_){"boolean"==typeof(this._dataSource=$_)?this.selected=$_:"string"==typeof $_?this.selected="true"===$_:$v.superSet($h,this,"dataSource",$_)}),$j}($h),$Y=function($_){function $S(){this._space=0,this._align="none",this._itemChanged=!1,$S.__super.call(this)}$M($S,"laya.ui.LayoutBox",$x);var $j=$S.prototype;return $j.addChild=function($_){return $_.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$_)},$j.onResize=function($_){this._setItemChanged()},$j.addChildAt=function($_,$S){return $_.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$_,$S)},$j.removeChild=function($_){return $_.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$_)},$j.removeChildAt=function($_){return this.getChildAt($_).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$_)},$j.refresh=function(){this._setItemChanged()},$j.changeItems=function(){this._itemChanged=!1},$j.sortItem=function($_){$_&&$_.sort(function($_,$S){return $_.y-$S.y})},$j._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$R(0,$j,"space",function(){return this._space},function($_){this._space=$_,this._setItemChanged()}),$R(0,$j,"align",function(){return this._align},function($_){this._align=$_,this._setItemChanged()}),$S}(),$T=function($S){function $j($_,$S){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$j.__super.call(this),$_&&(this.skin=$_),$S&&(this.sheet=$S)}$M($j,"laya.ui.FontClip",$S);var $_=$j.prototype;return $_.createChildren=function(){this._bitmap=new $n,this.on("loaded",this,this._onClipLoaded)},$_._onClipLoaded=function(){this.callLater(this.changeValue)},$_.changeValue=function(){var $_;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$_=this._sources[0]))){var $S="horizontal"===this._direction;$S?(this._wordsW=this._valueArr.length*($_.sourceWidth+this.spaceX),this._wordsH=$_.sourceHeight):(this._wordsW=$_.sourceWidth,this._wordsH=($_.sourceHeight+this.spaceY)*this._valueArr.length);var $j=0;if(this._width)switch(this._align){case"center":$j=.5*(this._width-this._wordsW);break;case"right":$j=this._width-this._wordsW;break;default:$j=0}for(var $O=0,$V=this._valueArr.length;$O<$V;$O++){var $M=this._indexMap[this._valueArr.charAt($O)];this.sources[$M]&&($_=this.sources[$M],$S?this.graphics.drawTexture($_,$j+$O*($_.sourceWidth+this.spaceX),0,$_.sourceWidth,$_.sourceHeight):this.graphics.drawTexture($_,0+$j,$O*($_.sourceHeight+this.spaceY),$_.sourceWidth,$_.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$_.destroy=function($_){void 0===$_&&($_=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$S.prototype.destroy.call(this,$_)},$R(0,$_,"sheet",function(){return this._sheet},function($_){$_+="";var $S=(this._sheet=$_).split(" ");this._clipX=String($S[0]).length,this.clipY=$S.length,this._indexMap={};for(var $j=0;$j<this._clipY;$j++)for(var $O=$S[$j].split(""),$V=0,$M=$O.length;$V<$M;$V++)this._indexMap[$O[$V]]=$j*this._clipX+$V}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($N,this,"height",$_),this.callLater(this.changeValue)}),$R(0,$_,"direction",function(){return this._direction},function($_){this._direction=$_,this.callLater(this.changeValue)}),$R(0,$_,"value",function(){return this._valueArr?this._valueArr:""},function($_){$_+="",this._valueArr=$_,this.callLater(this.changeValue)}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($N,this,"width",$_),this.callLater(this.changeValue)}),$R(0,$_,"spaceX",function(){return this._spaceX},function($_){this._spaceX=$_,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$R(0,$_,"spaceY",function(){return this._spaceY},function($_){this._spaceY=$_,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$R(0,$_,"align",function(){return this._align},function($_){this._align=$_,this.callLater(this.changeValue)}),$R(0,$_,"measureWidth",function(){return this._wordsW}),$R(0,$_,"measureHeight",function(){return this._wordsH}),$j}($N),$W=function($_){function $S(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $i,$S.__super.call(this)}$M($S,"laya.ui.List",$_);var $j=$S.prototype;return $v.imps($j,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$j.destroy=function($_){void 0===$_&&($_=!0),this._content&&this._content.destroy($_),this._scrollBar&&this._scrollBar.destroy($_),laya.ui.Component.prototype.destroy.call(this,$_),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$j.createChildren=function(){this.addChild(this._content=new $x)},$j.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$v.superGet($x,this,"cacheAs")),$v.superSet($x,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$j.onScrollEnd=function(){$v.superSet($x,this,"cacheAs",this._$P.cacheAs)},$j._removePreScrollBar=function(){var $_=this.removeChildByName("scrollBar");$_&&$_.destroy(!0)},$j.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $_=this._getOneCell(),$S=$_.width+this._spaceX||1,$j=$_.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$S):Math.ceil(this._width/$S)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$j):Math.round(this._height/$j));var $O=this._width?this._width:$S*this.repeatX-this._spaceX,$V=this._height?this._height:$j*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$j:$S,this._cellOffset=this._isVertical?$j*Math.max(this._repeatY2,this._repeatY)-$V-this._spaceY:$S*Math.max(this._repeatX2,this._repeatX)-$O-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$V:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$O),this.setContentSize($O,$V);var $M=this._isVertical?this.repeatX:this.repeatY,$R=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$M,$R),this._createdLine=$R,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$j._getOneCell=function(){if(0===this._cells.length){var $_=this.createItem();if(this._offset.setTo($_.x,$_.y),this.cacheContent)return $_;this._cells.push($_)}return this._cells[0]},$j._createItems=function($_,$S,$j){var $O=this._content,$V=this._getOneCell(),$M=$V.width+this._spaceX,$R=$V.height+this._spaceY;if(this.cacheContent){var $w=new $x;$w.cacheAsBitmap=!0,$w.pos((this._isVertical?0:$_)*$M,(this._isVertical?$_:0)*$R),this._content.addChild($w),this._content.optimizeScrollRect=!0,$O=$w}else{for(var $a=[],$u=this._cells.length-1;-1<$u;$u--){var $c=this._cells[$u];$c.removeSelf(),$a.push($c)}this._cells.length=0}for(var $q=$_;$q<$j;$q++)for(var $s=0;$s<$S;$s++)($V=$a&&$a.length?$a.pop():this.createItem()).x=(this._isVertical?$s:$q)*$M-$O.x,$V.y=(this._isVertical?$q:$s)*$R-$O.y,$V.name="item"+($q*$S+$s),$O.addChild($V),this.addCell($V)},$j.createItem=function(){var $_=[];if("function"==typeof this._itemRender)var $S=new this._itemRender;else $S=$U.createComp(this._itemRender,null,null,$_);if(0==$_.length&&$S._watchMap){var $j=$S._watchMap;for(var $O in $j)for(var $V=$j[$O],$M=0;$M<$V.length;$M++){var $R=$V[$M];$_.push($R.comp,$R.prop,$R.value)}}return $_.length&&($S._$bindData=$_),$S},$j.addCell=function($_){$_.on("click",this,this.onCellMouse),$_.on("rightclick",this,this.onCellMouse),$_.on("mouseover",this,this.onCellMouse),$_.on("mouseout",this,this.onCellMouse),$_.on("mousedown",this,this.onCellMouse),$_.on("mouseup",this,this.onCellMouse),this._cells.push($_)},$j.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $_=0,$S=$_=0;$S<1e4;$S++){var $j=this.getChildByName("item"+$S);if(!$j)break;this.addCell($j),$_++}this.repeatY=$_}},$j.setContentSize=function($_,$S){this._content.width=$_,this._content.height=$S,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $o),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$_,$S),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$j.onCellMouse=function($_){"mousedown"===$_.type&&(this._isMoved=!1);var $S=$_.currentTarget,$j=this._startIndex+this._cells.indexOf($S);$j<0||("click"===$_.type||"rightclick"===$_.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$j:this.changeCellState($S,!0,0):"mouseover"!==$_.type&&"mouseout"!==$_.type||this._selectedIndex===$j||this.changeCellState($S,"mouseover"===$_.type,0),this.mouseHandler&&this.mouseHandler.runWith([$_,$j]))},$j.changeCellState=function($_,$S,$j){var $O=$_.getChildByName("selectBox");$O&&(this.selectEnable=!0,$O.visible=$S,$O.index=$j)},$j.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$j.onScrollBarChange=function($_){this.runCallLater(this.changeCells);var $S=this._scrollBar.value,$j=this._isVertical?this.repeatX:this.repeatY,$O=this._isVertical?this.repeatY:this.repeatX,$V=Math.floor($S/this._cellSize);if(this.cacheContent)$R=$O+1,this._createdLine-$V<$R&&(this._createItems(this._createdLine,$j,this._createdLine+$R),this.renderItems(this._createdLine*$j,0),this._createdLine+=$R);else{var $M=$V*$j,$R=0;if($M>this._startIndex){$R=$M-this._startIndex;var $w=!0,$a=this._startIndex+$j*($O+1);this._isMoved=!0}else $M<this._startIndex&&($R=this._startIndex-$M,$w=!1,$a=this._startIndex-1,this._isMoved=!0);for(var $u=0;$u<$R;$u++){if($w){var $c=this._cells.shift();this._cells[this._cells.length]=$c;var $q=$a+$u}else $c=this._cells.pop(),this._cells.unshift($c),$q=$a-$u;var $s=Math.floor($q/$j)*this._cellSize;this._isVertical?$c.y=$s:$c.x=$s,this.renderItem($c,$q)}this._startIndex=$M,this.changeSelectStatus()}var $C=this._content.scrollRect;this._isVertical?($C.y=$S-this._offset.y,$C.x=-this._offset.x):($C.y=-this._offset.y,$C.x=$S-this._offset.x),this._content.scrollRect=$C},$j.posCell=function($_,$S){if(this._scrollBar){var $j=this._isVertical?this.repeatX:this.repeatY,$O=(this._isVertical?this.repeatY:this.repeatX,Math.floor($S/$j)*this._cellSize);this._isVertical?$_.y=$O:$_.x=$O}},$j.changeSelectStatus=function(){for(var $_=0,$S=this._cells.length;$_<$S;$_++)this.changeCellState(this._cells[$_],this._selectedIndex===this._startIndex+$_,1)},$j.renderItems=function($_,$S){void 0===$_&&($_=0),void 0===$S&&($S=0);for(var $j=$_,$O=$S||this._cells.length;$j<$O;$j++)this.renderItem(this._cells[$j],this._startIndex+$j);this.changeSelectStatus(),this._twDone=!0},$j.renderItem=function($_,$S){this._array&&0<=$S&&$S<this._array.length?($_.visible=!0,$_._$bindData?($_._dataSource=this._array[$S],this._bindData($_,this._array[$S])):$_.dataSource=this._array[$S],this.cacheContent||this.posCell($_,$S),this.hasListener("render")&&this.event("render",[$_,$S]),this.renderHandler&&this.renderHandler.runWith([$_,$S]),this.renderTwHandler&&this.renderTwHandler.runWith([$_,$S])):($_.visible=!1,$_.dataSource=null)},$j._bindData=function($_,$S){for(var $j=$_._$bindData,$O=0,$V=$j.length;$O<$V;$O++){var $M=$j[$O++],$R=$j[$O++],$w=$j[$O],$a=$$.getBindFun($w);$M[$R]=$a.call(this,$S)}},$j.refresh=function(){this.array=this._array},$j.getItem=function($_){return-1<$_&&$_<this._array.length?this._array[$_]:null},$j.changeItem=function($_,$S){-1<$_&&$_<this._array.length&&(this._array[$_]=$S,$_>=this._startIndex&&$_<this._startIndex+this._cells.length&&this.renderItem(this.getCell($_),$_))},$j.setItem=function($_,$S){this.changeItem($_,$S)},$j.addItem=function($_){this._array.push($_),this.array=this._array},$j.addItemAt=function($_,$S){this._array.splice($S,0,$_),this.array=this._array},$j.deleteItem=function($_){this._array.splice($_,1),this.array=this._array},$j.getCell=function($_){return this.runCallLater(this.changeCells),-1<$_&&this._cells?this._cells[($_-this._startIndex)%this._cells.length]:null},$j.scrollTo=function($_){if(this._scrollBar){var $S=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($_/$S)*this._cellSize}else this.startIndex=$_},$j.tweenTo=function($_,$S,$j){if(void 0===$S&&($S=200),this._scrollBar){var $O=this._isVertical?this.repeatX:this.repeatY;$f.to(this._scrollBar,{value:Math.floor($_/$O)*this._cellSize},$S,null,$j,0,!0)}else this.startIndex=$_,$j&&$j.run()},$j._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$j.commitMeasure=function(){this.runCallLater(this.changeCells)},$R(0,$j,"cacheAs",$_.prototype._$get_cacheAs,function($_){$v.superSet($x,this,"cacheAs",$_),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$_?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$R(0,$j,"content",function(){return this._content}),$R(0,$j,"height",$_.prototype._$get_height,function($_){$_!=this._height&&($v.superSet($x,this,"height",$_),this._setCellChanged())}),$R(0,$j,"itemRender",function(){return this._itemRender},function($_){if(this._itemRender!=$_){this._itemRender=$_;for(var $S=this._cells.length-1;-1<$S;$S--)this._cells[$S].destroy();this._cells.length=0,this._setCellChanged()}}),$R(0,$j,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($_){this._removePreScrollBar();var $S=new $S_;$S.name="scrollBar",$S.right=0,$_&&" "!=$_&&($S.skin=$_),this.scrollBar=$S,this.addChild($S),this._setCellChanged()}),$R(0,$j,"page",function(){return this._page},function($_){this._page=$_,this._array&&(this._page=0<$_?$_:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$R(0,$j,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($_){this._removePreScrollBar();var $S=new $p;$S.name="scrollBar",$S.bottom=0,$_&&" "!=$_&&($S.skin=$_),this.scrollBar=$S,this.addChild($S),this._setCellChanged()}),$R(0,$j,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($_){this._repeatX=$_,this._setCellChanged()}),$R(0,$j,"scrollBar",function(){return this._scrollBar},function($_){this._scrollBar!=$_&&(this._scrollBar=$_)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$R(0,$j,"width",$_.prototype._$get_width,function($_){$_!=this._width&&($v.superSet($x,this,"width",$_),this._setCellChanged())}),$R(0,$j,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($_){this._repeatY=$_,this._setCellChanged()}),$R(0,$j,"spaceX",function(){return this._spaceX},function($_){this._spaceX=$_,this._setCellChanged()}),$R(0,$j,"spaceY",function(){return this._spaceY},function($_){this._spaceY=$_,this._setCellChanged()}),$R(0,$j,"selectedIndex",function(){return this._selectedIndex},function($_){this._selectedIndex!=$_&&(this._selectedIndex=$_,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($_),this.startIndex=this._startIndex)}),$R(0,$j,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($_){this.selectedIndex=this._array.indexOf($_)}),$R(0,$j,"length",function(){return this._array?this._array.length:0}),$R(0,$j,"selection",function(){return this.getCell(this._selectedIndex)},function($_){this.selectedIndex=this._startIndex+this._cells.indexOf($_)}),$R(0,$j,"startIndex",function(){return this._startIndex},function($_){this._startIndex=0<$_?$_:0,this.callLater(this.renderItems)}),$R(0,$j,"twSwitch",function(){return this._twSwitch},function($_){this._twSwitch=$_}),$R(0,$j,"twDone",function(){return this._twDone},function($_){this._twDone=$_}),$R(0,$j,"array",function(){return this._array},function($_){this.runCallLater(this.changeCells),this._array=$_||[];var $S=this._array.length;if(this.totalPage=Math.ceil($S/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$S?this._selectedIndex:$S-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $j=this._isVertical?this.repeatX:this.repeatY,$O=this._isVertical?this.repeatY:this.repeatX,$V=Math.ceil($S/$j);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$O/$V,this._scrollBar.setScroll(0,($V-$O)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$R(0,$j,"dataSource",$_.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)&&Math.floor($_)==$_||"string"==typeof $_?this.selectedIndex=parseInt($_):$_ instanceof Array?this.array=$_:$v.superSet($x,this,"dataSource",$_)}),$R(0,$j,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$S}($x),$p=function($_){function $S(){$S.__super.call(this)}return $M($S,"laya.ui.HScrollBar",$_),$S.prototype.initialize=function(){$_.prototype.initialize.call(this),this.slider.isVertical=!1},$S}($m),$I=function($_){function $S(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$S.__super.call(this),this.width=this.height=100}$M($S,"laya.ui.Panel",$_);var $j=$S.prototype;return $j.destroy=function($_){void 0===$_&&($_=!0),laya.ui.Component.prototype.destroy.call(this,$_),this._content&&this._content.destroy($_),this._vScrollBar&&this._vScrollBar.destroy($_),this._hScrollBar&&this._hScrollBar.destroy($_),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$j.destroyChildren=function(){this._content.destroyChildren()},$j.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $x)},$j.addChild=function($_){return $_.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($_)},$j.onResize=function(){this._setScrollChanged()},$j.addChildAt=function($_,$S){return $_.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($_,$S)},$j.removeChild=function($_){return $_.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($_)},$j.removeChildAt=function($_){return this.getChildAt($_).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($_)},$j.removeChildren=function($_,$S){return void 0===$_&&($_=0),void 0===$S&&($S=2147483647),this._content.removeChildren($_,$S),this._setScrollChanged(),this},$j.getChildAt=function($_){return this._content.getChildAt($_)},$j.getChildByName=function($_){return this._content.getChildByName($_)},$j.getChildIndex=function($_){return this._content.getChildIndex($_)},$j.changeScroll=function(){this._scrollChanged=!1;var $_=this.contentWidth||1,$S=this.contentHeight||1,$j=this._vScrollBar,$O=this._hScrollBar,$V=$j&&$S>this._height,$M=$O&&$_>this._width,$R=$V?this._width-$j.width:this._width,$w=$M?this._height-$O.height:this._height;$j&&($j.x=this._width-$j.width,$j.y=0,$j.height=this._height-($M?$O.height:0),$j.scrollSize=Math.max(.033*this._height,1),$j.thumbPercent=$w/$S,$j.setScroll(0,$S-$w,$j.value)),$O&&($O.x=0,$O.y=this._height-$O.height,$O.width=this._width-($V?$j.width:0),$O.scrollSize=Math.max(.033*this._width,1),$O.thumbPercent=$R/$_,$O.setScroll(0,$_-$R,$O.value))},$j.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$j.setContentSize=function($_,$S){var $j=this._content;$j.width=$_,$j.height=$S,$j.scrollRect||($j.scrollRect=new $o),$j.scrollRect.setTo(0,0,$_,$S),$j.scrollRect=$j.scrollRect},$j.onScrollBarChange=function($_){var $S=this._content.scrollRect;if($S){var $j=Math.round($_.value);$_.isVertical?$S.y=$j:$S.x=$j,this._content.scrollRect=$S}},$j.scrollTo=function($_,$S){void 0===$_&&($_=0),void 0===$S&&($S=0),this.vScrollBar&&(this.vScrollBar.value=$S),this.hScrollBar&&(this.hScrollBar.value=$_)},$j.refresh=function(){this.changeScroll()},$j.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$v.superGet($x,this,"cacheAs")),$v.superSet($x,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$j.onScrollEnd=function(){$v.superSet($x,this,"cacheAs",this._$P.cacheAs)},$j._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$R(0,$j,"numChildren",function(){return this._content.numChildren}),$R(0,$j,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($_){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $p),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$_}),$R(0,$j,"contentWidth",function(){for(var $_=0,$S=this._content.numChildren-1;-1<$S;$S--){var $j=this._content.getChildAt($S);$_=Math.max($j.x+$j.width*$j.scaleX,$_)}return $_}),$R(0,$j,"contentHeight",function(){for(var $_=0,$S=this._content.numChildren-1;-1<$S;$S--){var $j=this._content.getChildAt($S);$_=Math.max($j.y+$j.height*$j.scaleY,$_)}return $_}),$R(0,$j,"width",$_.prototype._$get_width,function($_){$v.superSet($x,this,"width",$_),this._setScrollChanged()}),$R(0,$j,"hScrollBar",function(){return this._hScrollBar}),$R(0,$j,"content",function(){return this._content}),$R(0,$j,"height",$_.prototype._$get_height,function($_){$v.superSet($x,this,"height",$_),this._setScrollChanged()}),$R(0,$j,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($_){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $S_),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$_}),$R(0,$j,"vScrollBar",function(){return this._vScrollBar}),$R(0,$j,"cacheAs",$_.prototype._$get_cacheAs,function($_){$v.superSet($x,this,"cacheAs",$_),this._$P.cacheAs=null,"none"!==$_?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$S}($x),$K=function($_){function $S($_){$S.__super.call(this,$_),this.isVertical=!1}return $M($S,"laya.ui.HSlider",$e),$S}(),$X=function($_){function $j($_,$S){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$j.__super.call(this),this.skin=$S,this.labels=$_}$M($j,"laya.ui.UIGroup",$_);var $S=$j.prototype;return $v.imps($S,{"laya.ui.IItem":!0}),$S.preinitialize=function(){this.mouseEnabled=!0},$S.destroy=function($_){void 0===$_&&($_=!0),laya.ui.Component.prototype.destroy.call(this,$_),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$S.addItem=function($_,$S){void 0===$S&&($S=!0);var $j=$_,$O=this._items.length;if($j.name="item"+$O,this.addChild($j),this.initItems(),$S&&0<$O){var $V=this._items[$O-1];"horizontal"==this._direction?$j.x=$V.x+$V.width+this._space:$j.y=$V.y+$V.height+this._space}else $S&&($j.x=0,$j.y=0);return $O},$S.delItem=function($_,$S){void 0===$S&&($S=!0);var $j=this._items.indexOf($_);if(-1!=$j){var $O=$_;this.removeChild($O);for(var $V=$j+1,$M=this._items.length;$V<$M;$V++){var $R=this._items[$V];$R.name="item"+($V-1),$S&&("horizontal"==this._direction?$R.x-=$O.width+this._space:$R.y-=$O.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $w;$w=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$w}}},$S.initItems=function(){this._items||(this._items=[]);for(var $_=this._items.length=0;$_<1e4;$_++){var $S=this.getChildByName("item"+$_);if(null==$S)break;this._items.push($S),$S.selected=$_===this._selectedIndex,$S.clickHandler=$s.create(this,this.itemClick,[$_],!1)}},$S.itemClick=function($_){this.selectedIndex=$_},$S.setSelect=function($_,$S){this._items&&-1<$_&&$_<this._items.length&&(this._items[$_].selected=$S)},$S.createItem=function($_,$S){return null},$S.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $_=0,$S=0,$j=this._items.length;$S<$j;$S++){var $O=this._items[$S];this._skin&&($O.skin=this._skin),this._labelColors&&($O.labelColors=this._labelColors),this._labelSize&&($O.labelSize=this._labelSize),this._labelStroke&&($O.labelStroke=this._labelStroke),this._labelStrokeColor&&($O.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($O.strokeColors=this._strokeColors),this._labelBold&&($O.labelBold=this._labelBold),this._labelPadding&&($O.labelPadding=this._labelPadding),this._labelAlign&&($O.labelAlign=this._labelAlign),this._stateNum&&($O.stateNum=this._stateNum),this._labelFont&&($O.labelFont=this._labelFont),"horizontal"===this._direction?($O.y=0,$O.x=$_,$_+=$O.width+this._space):($O.x=0,$O.y=$_,$_+=$O.height+this._space)}this.changeSize()},$S.commitMeasure=function(){this.runCallLater(this.changeLabels)},$S._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$R(0,$S,"labelStrokeColor",function(){return this._labelStrokeColor},function($_){this._labelStrokeColor!=$_&&(this._labelStrokeColor=$_,this._setLabelChanged())}),$R(0,$S,"skin",function(){return this._skin},function($_){this._skin!=$_&&(this._skin=$_,this._setLabelChanged())}),$R(0,$S,"selectedIndex",function(){return this._selectedIndex},function($_){this._selectedIndex!=$_&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$_,this.setSelect($_,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$R(0,$S,"labels",function(){return this._labels},function($_){if(this._labels!=$_){if(this._labels=$_,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $S=this._labels.split(","),$j=0,$O=$S.length;$j<$O;$j++){var $V=this.createItem(this._skin,$S[$j]);$V.name="item"+$j,this.addChild($V)}this.initItems()}}),$R(0,$S,"strokeColors",function(){return this._strokeColors},function($_){this._strokeColors!=$_&&(this._strokeColors=$_,this._setLabelChanged())}),$R(0,$S,"labelColors",function(){return this._labelColors},function($_){this._labelColors!=$_&&(this._labelColors=$_,this._setLabelChanged())}),$R(0,$S,"labelStroke",function(){return this._labelStroke},function($_){this._labelStroke!=$_&&(this._labelStroke=$_,this._setLabelChanged())}),$R(0,$S,"labelSize",function(){return this._labelSize},function($_){this._labelSize!=$_&&(this._labelSize=$_,this._setLabelChanged())}),$R(0,$S,"stateNum",function(){return this._stateNum},function($_){this._stateNum!=$_&&(this._stateNum=$_,this._setLabelChanged())}),$R(0,$S,"labelBold",function(){return this._labelBold},function($_){this._labelBold!=$_&&(this._labelBold=$_,this._setLabelChanged())}),$R(0,$S,"labelFont",function(){return this._labelFont},function($_){this._labelFont!=$_&&(this._labelFont=$_,this._setLabelChanged())}),$R(0,$S,"labelPadding",function(){return this._labelPadding},function($_){this._labelPadding!=$_&&(this._labelPadding=$_,this._setLabelChanged())}),$R(0,$S,"direction",function(){return this._direction},function($_){this._direction=$_,this._setLabelChanged()}),$R(0,$S,"space",function(){return this._space},function($_){this._space=$_,this._setLabelChanged()}),$R(0,$S,"items",function(){return this._items}),$R(0,$S,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($_){this.selectedIndex=this._items.indexOf($_)}),$R(0,$S,"dataSource",$_.prototype._$get_dataSource,function($_){"number"==typeof(this._dataSource=$_)&&Math.floor($_)==$_||"string"==typeof $_?this.selectedIndex=parseInt($_):$_ instanceof Array?this.labels=$_.join(","):$v.superSet($x,this,"dataSource",$_)}),$j}($x),$r=function($S){function $j($_,$S){this._value=null,void 0===$S&&($S=""),$j.__super.call(this,$_,$S)}$M($j,"laya.ui.Radio",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._value=null},$_.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$_.initialize=function(){$S.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$_.onClick=function($_){this.selected=!0},$R(0,$_,"value",function(){return null!=this._value?this._value:this.label},function($_){this._value=$_}),$j}($h),$b=function($_){function $S(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$S.__super.call(this),this.width=this.height=200}$M($S,"laya.ui.Tree",$_);var $j=$S.prototype;return $v.imps($j,{"laya.ui.IRender":!0}),$j.destroy=function($_){void 0===$_&&($_=!0),laya.ui.Component.prototype.destroy.call(this,$_),this._list&&this._list.destroy($_),this._list=null,this._source=null,this._renderHandler=null},$j.createChildren=function(){this.addChild(this._list=new $W),this._list.renderHandler=$s.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$j.onListChange=function($_){this.event("change")},$j.getArray=function(){var $_,$S=[];for(var $j in this._source)$_=this._source[$j],this.getParentOpenStatus($_)&&($_.x=this._spaceLeft*this.getDepth($_),$S.push($_));return $S},$j.getDepth=function($_,$S){return void 0===$S&&($S=0),null==$_.nodeParent?$S:this.getDepth($_.nodeParent,$S+1)},$j.getParentOpenStatus=function($_){var $S=$_.nodeParent;return null==$S||!!$S.isOpen&&(null==$S.nodeParent||this.getParentOpenStatus($S))},$j.renderItem=function($_,$S){var $j=$_.dataSource;if($j){$_.left=$j.x;var $O=$_.getChildByName("arrow");$O&&($j.hasChild?($O.visible=!0,$O.index=$j.isOpen?1:0,$O.tag=$S,$O.off("click",this,this.onArrowClick),$O.on("click",this,this.onArrowClick)):$O.visible=!1);var $V=$_.getChildByName("folder");$V&&(2==$V.clipY?$V.index=$j.isDirectory?0:1:$V.index=$j.isDirectory?$j.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$_,$S])}},$j.onArrowClick=function($_){var $S=$_.currentTarget.tag;this._list.array[$S].isOpen=!this._list.array[$S].isOpen,this.event("open"),this._list.array=this.getArray()},$j.setItemState=function($_,$S){this._list.array[$_]&&(this._list.array[$_].isOpen=$S,this._list.array=this.getArray())},$j.fresh=function(){this._list.array=this.getArray(),this.repaint()},$j.parseXml=function($_,$S,$j,$O){var $V,$M=$_.childNodes,$R=$M.length;if(!$O){$V={};var $w,$a=$_.attributes;for(var $u in $a){var $c=($w=$a[$u]).nodeName,$q=$w.nodeValue;$V[$c]="true"==$q||"false"!=$q&&$q}$V.nodeParent=$j,0<$R&&($V.isDirectory=!0),$V.hasChild=0<$R,$S.push($V)}for(var $s=0;$s<$R;$s++){var $C=$M[$s];this.parseXml($C,$S,$V,!1)}},$j.parseOpenStatus=function($_,$S){for(var $j=0,$O=$S.length;$j<$O;$j++){var $V=$S[$j];if($V.isDirectory)for(var $M=0,$R=$_.length;$M<$R;$M++){var $w=$_[$M];if($w.isDirectory&&this.isSameParent($w,$V)&&$V.label==$w.label){$V.isOpen=$w.isOpen;break}}}},$j.isSameParent=function($_,$S){return null==$_.nodeParent&&null==$S.nodeParent||null!=$_.nodeParent&&null!=$S.nodeParent&&($_.nodeParent.label==$S.nodeParent.label&&this.isSameParent($_.nodeParent,$S.nodeParent))},$j.filter=function($_){if(Boolean($_)){var $S=[];this.getFilterSource(this._source,$S,$_),this._list.array=$S}else this._list.array=this.getArray()},$j.getFilterSource=function($_,$S,$j){var $O;for(var $V in $j=$j.toLocaleLowerCase(),$_)!($O=$_[$V]).isDirectory&&-1<String($O.label).toLowerCase().indexOf($j)&&($O.x=0,$S.push($O)),$O.child&&0<$O.child.length&&this.getFilterSource($O.child,$S,$j)},$R(0,$j,"spaceBottom",function(){return this._list.spaceY},function($_){this._list.spaceY=$_}),$R(0,$j,"keepStatus",function(){return this._keepStatus},function($_){this._keepStatus=$_}),$R(0,$j,"itemRender",function(){return this._list.itemRender},function($_){this._list.itemRender=$_}),$R(0,$j,"array",function(){return this._list.array},function($_){this._keepStatus&&this._list.array&&$_&&this.parseOpenStatus(this._list.array,$_),this._source=$_,this._list.array=this.getArray()}),$R(0,$j,"mouseHandler",function(){return this._list.mouseHandler},function($_){this._list.mouseHandler=$_}),$R(0,$j,"dataSource",$_.prototype._$get_dataSource,function($_){this._dataSource=$_,$v.superSet($x,this,"dataSource",$_)}),$R(0,$j,"source",function(){return this._source}),$R(0,$j,"scrollBar",function(){return this._list.scrollBar}),$R(0,$j,"list",function(){return this._list}),$R(0,$j,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($_){this._list.vScrollBarSkin=$_}),$R(0,$j,"renderHandler",function(){return this._renderHandler},function($_){this._renderHandler=$_}),$R(0,$j,"selectedIndex",function(){return this._list.selectedIndex},function($_){this._list.selectedIndex=$_}),$R(0,$j,"spaceLeft",function(){return this._spaceLeft},function($_){this._spaceLeft=$_}),$R(0,$j,"selectedItem",function(){return this._list.selectedItem},function($_){this._list.selectedItem=$_}),$R(0,$j,"width",$_.prototype._$get_width,function($_){$v.superSet($x,this,"width",$_),this._list.width=$_}),$R(0,$j,"height",$_.prototype._$get_height,function($_){$v.superSet($x,this,"height",$_),this._list.height=$_}),$R(0,$j,"xml",null,function($_){var $S=[];this.parseXml($_.childNodes[0],$S,null,!0),this.array=$S}),$R(0,$j,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$S}($x),$__=function($_){function $S(){this._items=null,this._selectedIndex=0,$S.__super.call(this),this._setIndexHandler=$s.create(this,this.setIndex,null,!1)}$M($S,"laya.ui.ViewStack",$_);var $j=$S.prototype;return $v.imps($j,{"laya.ui.IItem":!0}),$j.setItems=function($_){this.removeChildren();for(var $S=0,$j=0,$O=$_.length;$j<$O;$j++){var $V=$_[$j];$V&&($V.name="item"+$S,this.addChild($V),$S++)}this.initItems()},$j.addItem=function($_){$_.name="item"+this._items.length,this.addChild($_),this.initItems()},$j.initItems=function(){this._items=[];for(var $_=0;$_<1e4;$_++){var $S=this.getChildByName("item"+$_);if(null==$S)break;this._items.push($S),$S.visible=$_==this._selectedIndex}},$j.setSelect=function($_,$S){this._items&&-1<$_&&$_<this._items.length&&(this._items[$_].visible=$S)},$j.setIndex=function($_){this.selectedIndex=$_},$R(0,$j,"dataSource",$_.prototype._$get_dataSource,function($_){if("number"==typeof(this._dataSource=$_)&&Math.floor($_)==$_||"string"==typeof $_)this.selectedIndex=parseInt($_);else for(var $S in this._dataSource)this.hasOwnProperty($S)&&(this[$S]=this._dataSource[$S])}),$R(0,$j,"selectedIndex",function(){return this._selectedIndex},function($_){this._selectedIndex!=$_&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$_,this.setSelect(this._selectedIndex,!0))}),$R(0,$j,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($_){this.selectedIndex=this._items.indexOf($_)}),$R(0,$j,"items",function(){return this._items}),$R(0,$j,"setIndexHandler",function(){return this._setIndexHandler},function($_){this._setIndexHandler=$_}),$S}($x),$S_=function($_){function $S(){$S.__super.call(this)}return $M($S,"laya.ui.VScrollBar",$m),$S}(),$j_=function($S){function $j($_){this._bg=null,this._skin=null,$j.__super.call(this),void 0===$_&&($_=""),this.text=$_,this.skin=this.skin}$M($j,"laya.ui.TextInput",$S);var $_=$j.prototype;return $_.preinitialize=function(){this.mouseEnabled=!0},$_.destroy=function($_){$l.clearCache(this,this._skin),void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._bg&&this._bg.destroy(),this._bg=null},$_.createChildren=function(){this.addChild(this._tf=new $C),this._tf.padding=$E.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$_._onFocus=function(){this.event("focus",this)},$_._onBlur=function(){this.event("blur",this)},$_._onInput=function(){this.event("input",this)},$_._onEnter=function(){this.event("enter",this)},$_.initialize=function(){this.width=128,this.height=22},$_.select=function(){this._tf.select()},$_.setSelection=function($_,$S){this._tf.setSelection($_,$S)},$R(0,$_,"text",$S.prototype._$get_text,function($_){this._tf.text!=$_&&($_+="",this._tf.text=$_,this.event("change"))}),$R(0,$_,"bg",function(){return this._bg},function($_){this.graphics=this._bg=$_}),$R(0,$_,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($_){this._tf.inputElementYAdjuster=$_}),$R(0,$_,"multiline",function(){return this._tf.multiline},function($_){this._tf.multiline=$_}),$R(0,$_,"skin",function(){return this._skin},function($_){this._skin!=$_&&($l.clearCache(this,this._skin),this._skin=$_,this._bg||(this.graphics=this._bg=new $n),$l.keepCache(this,this._skin),this._bg.source=$l.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$R(0,$_,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($_){this._bg||(this.graphics=this._bg=new $n),this._bg.sizeGrid=$$.fillArray($E.defaultSizeGrid,$_,Number)}),$R(0,$_,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($_){this._tf.inputElementXAdjuster=$_}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($D,this,"width",$_),this._bg&&(this._bg.width=$_)}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($D,this,"height",$_),this._bg&&(this._bg.height=$_)}),$R(0,$_,"editable",function(){return this._tf.editable},function($_){this._tf.editable=$_}),$R(0,$_,"restrict",function(){return this._tf.restrict},function($_){this._tf.restrict=$_}),$R(0,$_,"prompt",function(){return this._tf.prompt},function($_){this._tf.prompt=$_}),$R(0,$_,"promptColor",function(){return this._tf.promptColor},function($_){this._tf.promptColor=$_}),$R(0,$_,"maxChars",function(){return this._tf.maxChars},function($_){this._tf.maxChars=$_}),$R(0,$_,"focus",function(){return this._tf.focus},function($_){this._tf.focus=$_}),$R(0,$_,"type",function(){return this._tf.type},function($_){this._tf.type=$_}),$R(0,$_,"asPassword",function(){return this._tf.asPassword},function($_){this._tf.asPassword=$_}),$j}($D),$O_=function($_){function $S(){$S.__super.call(this)}return $M($S,"laya.ui.VSlider",$e),$S}(),$V_=function($_){function $O(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$O.__super.call(this)}$M($O,"laya.ui.Dialog",$_);var $S=$O.prototype;return $S.initialize=function(){this.popupEffect=$O.manager.popupEffectHandler,this.closeEffect=$O.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$S._dealDragArea=function(){var $_=this.getChildByName("drag");$_&&(this.dragArea=$_.x+","+$_.y+","+$_.width+","+$_.height,$_.removeSelf())},$S._onClick=function($_){var $S=$_.target;if($S)switch($S.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($S.name)}},$S.show=function($_,$S){void 0===$_&&($_=!1),void 0===$S&&($S=!0),this._open(!1,$_,$S)},$S.popup=function($_,$S){void 0===$_&&($_=!1),void 0===$S&&($S=!0),this._open(!0,$_,$S)},$S._open=function($_,$S,$j){$O.manager.lock(!1),this.isModal=$_,$O.manager.open(this,$S,$j)},$S.onOpened=function(){},$S.close=function($_,$S){void 0===$S&&($S=!0),$O.manager.close(this,$_,$S)},$S.onClosed=function($_){},$S._onMouseDown=function($_){var $S=this.getMousePoint();this._dragArea.contains($S.x,$S.y)?this.startDrag():this.stopDrag()},$R(0,$S,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($_){if($_){var $S=$$.fillArray([0,0,0,0],$_,Number);this._dragArea=new $o($S[0],$S[1],$S[2],$S[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$R(0,$S,"isPopup",function(){return null!=this.parent}),$R(0,$S,"zOrder",$_.prototype._$get_zOrder,function($_){$v.superSet($U,this,"zOrder",$_),$O.manager._checkMask()}),$R(1,$O,"manager",function(){return $O._manager=$O._manager||new $F},function($_){$O._manager=$_}),$O.setLockView=function($_){$O.manager.setLockView($_)},$O.lock=function($_){$O.manager.lock($_)},$O.closeAll=function(){$O.manager.closeAll()},$O.getDialogsByGroup=function($_){return $O.manager.getDialogsByGroup($_)},$O.closeByGroup=function($_){return $O.manager.closeByGroup($_)},$O.CLOSE="close",$O.CANCEL="cancel",$O.SURE="sure",$O.NO="no",$O.OK="ok",$O.YES="yes",$O._manager=null,$O}($U),$M_=function($_){function $S(){$S.__super.call(this)}$M($S,"laya.ui.HBox",$_);var $j=$S.prototype;return $j.sortItem=function($_){$_&&$_.sort(function($_,$S){return $_.x-$S.x})},$j.changeItems=function(){this._itemChanged=!1;for(var $_=[],$S=0,$j=0,$O=this.numChildren;$j<$O;$j++){var $V=this.getChildAt($j);$V&&$V.layoutEnabled&&($_.push($V),$S=this._height?this._height:Math.max($S,$V.height*$V.scaleY))}this.sortItem($_);var $M=0;for($j=0,$O=$_.length;$j<$O;$j++)($V=$_[$j]).x=$M,$M+=$V.width*$V.scaleX+this._space,"top"==this._align?$V.y=0:"middle"==this._align?$V.y=.5*($S-$V.height*$V.scaleY):"bottom"==this._align&&($V.y=$S-$V.height*$V.scaleY);this.changeSize()},$R(0,$j,"height",$_.prototype._$get_height,function($_){this._height!=$_&&($v.superSet($Y,this,"height",$_),this.callLater(this.changeItems))}),$S.NONE="none",$S.TOP="top",$S.MIDDLE="middle",$S.BOTTOM="bottom",$S}($Y),$R_=function($_){function $S(){$S.__super.call(this)}$M($S,"laya.ui.VBox",$_);var $j=$S.prototype;return $j.changeItems=function(){this._itemChanged=!1;for(var $_=[],$S=0,$j=0,$O=this.numChildren;$j<$O;$j++){var $V=this.getChildAt($j);$V&&$V.layoutEnabled&&($_.push($V),$S=this._width?this._width:Math.max($S,$V.width*$V.scaleX))}this.sortItem($_);var $M=0;for($j=0,$O=$_.length;$j<$O;$j++)($V=$_[$j]).y=$M,$M+=$V.height*$V.scaleY+this._space,"left"==this._align?$V.x=0:"center"==this._align?$V.x=.5*($S-$V.width*$V.scaleX):"right"==this._align&&($V.x=$S-$V.width*$V.scaleX);this.changeSize()},$R(0,$j,"width",$_.prototype._$get_width,function($_){this._width!=$_&&($v.superSet($Y,this,"width",$_),this.callLater(this.changeItems))}),$S.NONE="none",$S.LEFT="left",$S.CENTER="center",$S.RIGHT="right",$S}($Y),$w_=function($_){function $S(){$S.__super.call(this)}return $M($S,"laya.ui.RadioGroup",$X),$S.prototype.createItem=function($_,$S){return new $r($_,$S)},$S}(),$a_=function($_){function $S(){$S.__super.call(this)}return $M($S,"laya.ui.Tab",$X),$S.prototype.createItem=function($_,$S){return new $h($_,$S)},$S}(),$u_=function($S){function $j($_){this._vScrollBar=null,this._hScrollBar=null,void 0===$_&&($_=""),$j.__super.call(this,$_)}$M($j,"laya.ui.TextArea",$S);var $_=$j.prototype;return $_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$_.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$_.onVBarChanged=function($_){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$_.onHBarChanged=function($_){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$_.changeScroll=function(){var $_=this._vScrollBar&&0<this._tf.maxScrollY,$S=this._hScrollBar&&0<this._tf.maxScrollX,$j=$_?this._width-this._vScrollBar.width:this._width,$O=$S?this._height-this._hScrollBar.height:this._height,$V=this._tf.padding||$E.labelPadding;this._tf.width=$j,this._tf.height=$O,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$V[2],this._vScrollBar.y=$V[1],this._vScrollBar.height=this._height-($S?this._hScrollBar.height:0)-$V[1]-$V[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$O/Math.max(this._tf.textHeight,$O),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$_),this._hScrollBar&&(this._hScrollBar.x=$V[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$V[3],this._hScrollBar.width=this._width-($_?this._vScrollBar.width:0)-$V[0]-$V[2],this._hScrollBar.scrollSize=Math.max(.033*$j,1),this._hScrollBar.thumbPercent=$j/Math.max(this._tf.textWidth,$j),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$S)},$_.scrollTo=function($_){this.commitMeasure(),this._tf.scrollY=$_},$R(0,$_,"scrollY",function(){return this._tf.scrollY}),$R(0,$_,"width",$S.prototype._$get_width,function($_){$v.superSet($j_,this,"width",$_),this.callLater(this.changeScroll)}),$R(0,$_,"hScrollBar",function(){return this._hScrollBar}),$R(0,$_,"height",$S.prototype._$get_height,function($_){$v.superSet($j_,this,"height",$_),this.callLater(this.changeScroll)}),$R(0,$_,"maxScrollX",function(){return this._tf.maxScrollX}),$R(0,$_,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($_){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $S_),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$_}),$R(0,$_,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($_){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $p),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$_}),$R(0,$_,"vScrollBar",function(){return this._vScrollBar}),$R(0,$_,"maxScrollY",function(){return this._tf.maxScrollY}),$R(0,$_,"scrollX",function(){return this._tf.scrollX}),$j}($j_);!function($_){function $S(){this._uiView=null,this.isCloseOther=!1,$S.__super.call(this)}$M($S,"laya.ui.AsynDialog",$V_);var $j=$S.prototype;$j.createView=function($_){this._uiView=$_},$j._open=function($_,$S,$j){this.isModal=$_,this.isCloseOther=$S,$V_.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$j.onCreated=function(){this.createUI(),this.onOpen()},$j.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$j.onOpen=function(){$V_.manager.open(this,this.isCloseOther),$V_.manager.lock(!1)},$j.close=function($_,$S){void 0===$S&&($S=!0),$V_.manager.close(this),this.onClose()},$j.onClose=function(){},$j.destroy=function($_){void 0===$_&&($_=!0),laya.ui.View.prototype.destroy.call(this,$_),this._uiView=null,this.onDestroy()},$j.onDestroy=function(){}}();$v.__init([$U])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($_,$S){"use strict";for(var $j in Object.defineProperty($S,"__esModule",{value:!0}),Laya){var $O=Laya[$j];$O&&$O.__isclass&&($S[$j]=$O)}}),function($s,$_,$H){$H.un,$H.uns;var $q=$H.static,$C=$H.class,$i=$H.getset,$O=$H.__newvec,$z=laya.maths.Arith,$R=laya.webgl.atlas.AtlasResourceManager,$j=laya.webgl.shader.BaseShader,$J=laya.utils.Browser,$w=laya.webgl.utils.Buffer,$A=laya.utils.Byte,$V=laya.utils.ClassUtils,$a=$H.Config,$M=(laya.events.Event,laya.events.EventDispatcher),$E=laya.utils.Handler,$o=laya.net.Loader,$S=laya.net.LoaderManager,$u=(laya.maths.MathUtil,laya.display.Node),$v=laya.renders.Render,$c=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$Z=laya.resource.Resource,$l=laya.utils.RunDriver,$k=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$f=laya.display.Sprite,$y=laya.utils.Stat,$P=laya.utils.StringKey,$$=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$g=laya.utils.Utils,$d=laya.webgl.WebGL,$n=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$H.interface("laya.d3.core.IClone"),$H.interface("laya.d3.graphics.IVertex"),$H.interface("laya.d3.core.render.IUpdate"),$H.interface("laya.d3.core.scene.ITreeNode"),$H.interface("laya.d3.core.render.IRenderable");(function(){function $h(){}$C($h,"laya.d3.animation.AnimationClipParser01"),$h.READ_DATA=function(){$h._DATA.offset=$h._reader.getUint32(),$h._DATA.size=$h._reader.getUint32()},$h.READ_BLOCK=function(){for(var $_=$h._BLOCK.count=$h._reader.getUint16(),$S=$h._BLOCK.blockStarts=[],$j=$h._BLOCK.blockLengths=[],$O=0;$O<$_;$O++)$S.push($h._reader.getUint32()),$j.push($h._reader.getUint32())},$h.READ_STRINGS=function(){var $_=$h._reader.getUint32(),$S=$h._reader.getUint16(),$j=$h._reader.pos;$h._reader.pos=$_+$h._DATA.offset;for(var $O=0;$O<$S;$O++)$h._strings[$O]=$h._reader.readUTFString();$h._reader.pos=$j},$h.parse=function($_,$S){$h._animationClip=$_;($h._reader=$S).__getBuffer();$h.READ_DATA(),$h.READ_BLOCK(),$h.READ_STRINGS();for(var $j=0,$O=$h._BLOCK.count;$j<$O;$j++){var $V=$S.getUint16(),$M=$h._strings[$V],$R=$h["READ_"+$M];if(null==$R)throw new Error("model file err,no this function:"+$V+" "+$M);$R.call()}},$h.READ_ANIMATIONS=function(){var $_,$S=0,$j=0,$O=$h._reader,$V=$O.__getBuffer(),$M=[],$R=$O.getUint8();for($M.length=$R,$S=0;$S<$R;$S++)$M[$S]=$O.getUint16();var $w=[],$a=$O.getUint16();for($w.length=$a,$S=0;$S<$a;$S++)$w[$S]=$O.getFloat32();var $u=$h._animationClip;$u.name=$h._strings[$O.getUint16()];var $c=$u._duration=$O.getFloat32();$u.islooping=!!$O.getByte(),$u._frameRate=$O.getInt16();var $q=$O.getInt16(),$s=$u._nodes=new Array;$s.length=$q,($u._publicClipDatas=[]).length=$q;var $C=$u._nodesMap={},$i=0,$v=0;for($S=0;$S<$q;$S++){$_=$s[$S]=new $L;var $Z=$O.getUint16(),$o=$_.path=[];for($o.length=$Z,$j=0;$j<$Z;$j++)$o[$j]=$h._strings[$O.getUint16()];var $l=$o.join("/"),$k=$C[$l];$k||($C[$l]=$k=[]),$k.push($_);var $z=$O.getInt16();-1!==$z&&($_.componentType=$h._strings[$z]);var $H=$G._propertyIndexDic[$h._strings[$O.getUint16()]];if(null==$H)throw new Error("AnimationClipParser01:unknown property name.");var $A=$H<4,$f=!$A||$A&&""===$o[0];($_._cacheProperty=$f)?$i++:$v++,$_.propertyNameID=$H;var $y=$M[$O.getUint8()];$_.keyFrameWidth=$y/4;var $P=$_.keyFrames=[],$g=$P.length=$O.getUint16(),$E=null,$$=NaN;for($j=0;$j<$g;$j++){var $d=$P[$j]=new $D;$$=$d.startTime=$w[$O.getUint16()];var $n=$O.pos;$d.inTangent=new Float32Array($V.slice($n,$n+$y)),$O.pos+=$y,$n=$O.pos,$d.outTangent=new Float32Array($V.slice($n,$n+$y)),$O.pos+=$y,$n=$O.pos,$d.data=new Float32Array($V.slice($n,$n+$y)),$O.pos+=$y,$E&&($E.next=$d,$E.duration=$$-$E.startTime),$E=$d}$d.next=null,$d.duration=$c-$$}var $J=$u._nodeToCachePropertyMap=new Int32Array($q),$F=$u._cachePropertyMap=new Int32Array($i),$x=$u._unCachePropertyMap=new Int32Array($v);for($i=$v=0,$S=0;$S<$q;$S++)($_=$s[$S])._cacheProperty?($J[$S]=$i,$F[$i++]=$S):$x[$v++]=$S},$h._animationClip=null,$h._reader=null,$h._strings=[],$q($h,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $m(){}$C($m,"laya.d3.animation.AnimationClipParser02"),$m.READ_DATA=function(){$m._DATA.offset=$m._reader.getUint32(),$m._DATA.size=$m._reader.getUint32()},$m.READ_BLOCK=function(){for(var $_=$m._BLOCK.count=$m._reader.getUint16(),$S=$m._BLOCK.blockStarts=[],$j=$m._BLOCK.blockLengths=[],$O=0;$O<$_;$O++)$S.push($m._reader.getUint32()),$j.push($m._reader.getUint32())},$m.READ_STRINGS=function(){var $_=$m._reader.getUint32(),$S=$m._reader.getUint16(),$j=$m._reader.pos;$m._reader.pos=$_+$m._DATA.offset;for(var $O=0;$O<$S;$O++)$m._strings[$O]=$m._reader.readUTFString();$m._reader.pos=$j},$m.parse=function($_,$S){$m._animationClip=$_;($m._reader=$S).__getBuffer();$m.READ_DATA(),$m.READ_BLOCK(),$m.READ_STRINGS();for(var $j=0,$O=$m._BLOCK.count;$j<$O;$j++){var $V=$S.getUint16(),$M=$m._strings[$V],$R=$m["READ_"+$M];if(null==$R)throw new Error("model file err,no this function:"+$V+" "+$M);$R.call()}},$m.READ_ANIMATIONS=function(){var $_,$S=0,$j=0,$O=$m._reader,$V=$O.__getBuffer(),$M=[],$R=$O.getUint8();for($M.length=$R,$S=0;$S<$R;$S++)$M[$S]=$O.getUint16();var $w=[],$a=$O.getUint16();for($w.length=$a,$S=0;$S<$a;$S++)$w[$S]=$O.getFloat32();var $u=$m._animationClip;$u.name=$m._strings[$O.getUint16()];var $c=$u._duration=$O.getFloat32();$u.islooping=!!$O.getByte(),$u._frameRate=$O.getInt16();var $q=$O.getInt16(),$s=$u._nodes=new Array;$s.length=$q,($u._publicClipDatas=[]).length=$q;var $C=$u._nodesMap={},$i=0,$v=0;for($S=0;$S<$q;$S++){$_=$s[$S]=new $L;var $Z=$O.getUint16(),$o=$_.path=[];for($o.length=$Z,$j=0;$j<$Z;$j++)$o[$j]=$m._strings[$O.getUint16()];var $l=$o.join("/"),$k=$C[$l];$k||($C[$l]=$k=[]),$k.push($_);var $z=$O.getInt16();-1!==$z&&($_.componentType=$m._strings[$z]);var $H=$G._propertyIndexDic[$m._strings[$O.getUint16()]];if(null==$H)throw new Error("AnimationClipParser02:unknown property name.");var $A=$H<4,$f=!$A||$A&&""===$o[0];($_._cacheProperty=$f)?$i++:$v++,$_.propertyNameID=$H;var $y=$M[$O.getUint8()];$_.keyFrameWidth=$y/4;var $P=$_.keyFrames=[],$g=$P.length=$O.getUint16(),$E=null,$$=NaN;for($j=0;$j<$g;$j++){var $d=$P[$j]=new $D;$$=$d.startTime=$w[$O.getUint16()];var $n=$O.pos;$d.inTangent=new Float32Array($V.slice($n,$n+$y)),$O.pos+=$y,$n=$O.pos,$d.outTangent=new Float32Array($V.slice($n,$n+$y)),$O.pos+=$y,$n=$O.pos,$d.data=new Float32Array($V.slice($n,$n+$y)),$O.pos+=$y,$E&&($E.next=$d,$E.duration=$$-$E.startTime),$E=$d}$d.next=null,$d.duration=$c-$$}var $J=$O.getUint16();for($S=0;$S<$J;$S++){var $F,$x=new $e;$x.time=$O.getFloat32(),$x.eventName=$m._strings[$O.getUint16()];var $h=$O.getUint16();for(0<$h&&($x.params=$F=[]),$j=0;$j<$h;$j++){switch($O.getByte()){case 0:$F.push(!!$O.getByte());break;case 1:$F.push($O.getInt32());break;case 2:$F.push($O.getFloat32());break;case 3:$F.push($m._strings[$O.getUint16()]);break;default:throw new Error("unknown type.")}}$u.addEvent($x)}var $N=$u._nodeToCachePropertyMap=new Int32Array($q),$B=$u._cachePropertyMap=new Int32Array($i),$t=$u._unCachePropertyMap=new Int32Array($v);for($i=$v=0,$S=0;$S<$q;$S++)($_=$s[$S])._cacheProperty?($N[$S]=$i,$B[$i++]=$S):$t[$v++]=$S},$m._animationClip=null,$m._reader=null,$m._strings=[],$q($m,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $e=function(){function $_(){this.time=NaN,this.eventName=null,this.params=null}return $C($_,"laya.d3.animation.AnimationEvent"),$_}(),$G=function(){function $O(){this._childs=[],this.transform=new $lS(this)}$C($O,"laya.d3.animation.AnimationNode");var $_=$O.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.addChild=function($_){$_._parent=this,$_.transform.setParent(this.transform),this._childs.push($_)},$_.removeChild=function($_){var $S=this._childs.indexOf($_);-1!==$S&&this._childs.splice($S,1)},$_.getChildByName=function($_){for(var $S=0,$j=this._childs.length;$S<$j;$S++){var $O=this._childs[$S];if($O.name===$_)return $O}return null},$_.getChildByIndex=function($_){return this._childs[$_]},$_.getChildCount=function(){return this._childs.length},$_.cloneTo=function($_){var $S=$_;$S.name=this.name;for(var $j=0,$O=this._childs.length;$j<$O;$j++){var $V=this._childs[$j],$M=$V.clone();$S.addChild($M);var $R=$V.transform,$w=$M.transform;$w.setLocalPosition($R.getLocalPosition()),$w.setLocalRotation($R.getLocalRotation()),$w.setLocalScale($R.getLocalScale()),$w._localRotationEuler=$R._localRotationEuler,$w._setWorldMatrixIgnoreUpdate($R.getWorldMatrix())}},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$O.__init__=function(){$O.registerAnimationNodeProperty("localPosition",$O._getLocalPosition,$O._setLocalPosition),$O.registerAnimationNodeProperty("localRotation",$O._getLocalRotation,$O._setLocalRotation),$O.registerAnimationNodeProperty("localScale",$O._getLocalScale,$O._setLocalScale),$O.registerAnimationNodeProperty("localRotationEuler",$O._getLocalRotationEuler,$O._setLocalRotationEuler),$O.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$O._getParticleRenderSharedMaterialTintColor,$O._setParticleRenderSharedMaterialTintColor),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$O._getMeshRenderSharedMaterialTilingOffset,$O._setMeshRenderSharedMaterialTilingOffset),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$O._getMeshRenderSharedMaterialAlbedo,$O._setMeshRenderSharedMaterialAlbedo),$O.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$O._getSkinnedMeshRenderSharedMaterialTilingOffset,$O._setSkinnedMeshRenderSharedMaterialTilingOffset),$O.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$O._getSkinnedMeshRenderSharedMaterialAlbedo,$O._setSkinnedMeshRenderSharedMaterialAlbedo),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$O._getMeshRenderSharedMaterialAlbedo,$O._setMeshRenderSharedMaterialAlbedo),$O.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$O._getSkinnedMeshRenderSharedMaterialAlbedo,$O._setSkinnedMeshRenderSharedMaterialAlbedo),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$O._getMeshRenderSharedMaterialIntensity,$O._setMeshRenderSharedMaterialIntensity),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$O._getMeshRenderSharedMaterialAlpha,$O._setMeshRenderSharedMaterialAlpha),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$O._getMeshRenderSharedMaterialAlphaColor,$O._setMeshRenderSharedMaterialAlphaColor),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$O._getMeshRenderSharedMaterialBaseColor,$O._setMeshRenderSharedMaterialBaseColor),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$O._getMeshRenderSharedMaterialDissolve,$O._setMeshRenderSharedMaterialDissolve),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$O._getMeshRenderSharedMaterialDissolveSpeed,$O._setMeshRenderSharedMaterialDissolveSpeed),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$O._getMeshRenderSharedMaterialMMultiplier,$O._setMeshRenderSharedMaterialMMultiplier),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$O._getMeshRenderSharedMaterialBaseScrollSpeedX,$O._setMeshRenderSharedMaterialBaseScrollSpeedX),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$O._getMeshRenderSharedMaterialBaseScrollSpeedY,$O._setMeshRenderSharedMaterialBaseScrollSpeedY),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$O._getMeshRenderSharedMaterialSecondScrollSpeedX,$O._setMeshRenderSharedMaterialSecondScrollSpeedX),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$O._getMeshRenderSharedMaterialSecondScrollSpeedY,$O._setMeshRenderSharedMaterialSecondScrollSpeedY),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$O._getMeshRenderSharedMaterialDetailTilingOffset,$O._setMeshRenderSharedMaterialDetailTilingOffset),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$O._getMeshRenderSharedMaterialDissolveTilingOffset,$O._setMeshRenderSharedMaterialDissolveTilingOffset),$O.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$O._getMeshRenderSharedMaterialMaskTilingOffset,$O._setMeshRenderSharedMaterialMaskTilingOffset)},$O.registerAnimationNodeProperty=function($_,$S,$j){if($O._propertyIndexDic[$_])throw new Error("AnimationNode: this propertyName has registered.");$O._propertyIndexDic[$_]=$O._propertyIDCounter,$O._propertyGetFuncs[$O._propertyIDCounter]=$S,$O._propertySetFuncs[$O._propertyIDCounter]=$j,$O._propertyIDCounter++},$O._getLocalPosition=function($_,$S){return $_?$_.transform.getLocalPosition():$S._transform.localPosition.elements},$O._setLocalPosition=function($_,$S,$j){if($_)$_.transform.setLocalPosition($j);else{var $O=$S._transform,$V=$O.localPosition;$V.elements=$j,$O.localPosition=$V}},$O._getLocalRotation=function($_,$S){return $_?$_.transform.getLocalRotation():$S._transform.localRotation.elements},$O._setLocalRotation=function($_,$S,$j){if($_)$_.transform.setLocalRotation($j);else{var $O=$S._transform,$V=$O.localRotation;$V.elements=$j,$O.localRotation=$V}},$O._getLocalScale=function($_,$S){return $_?$_.transform.getLocalScale():$S._transform.localScale.elements},$O._setLocalScale=function($_,$S,$j){if($_)$_.transform.setLocalScale($j);else{var $O=$S._transform,$V=$O.localScale;$V.elements=$j,$O.localScale=$V}},$O._getLocalRotationEuler=function($_,$S){return $_?$_.transform.getLocalRotationEuler():$S._transform.localRotationEuler.elements},$O._setLocalRotationEuler=function($_,$S,$j){if($_)$_.transform.setLocalRotationEuler($j);else{var $O=$S._transform,$V=$O.localRotationEuler;$V.elements=$j,$O.localRotationEuler=$V}},$O._getMeshRenderSharedMaterialTilingOffset=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $S.meshRender.sharedMaterial.tilingOffset.elements},$O._setMeshRenderSharedMaterialTilingOffset=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).tilingOffset).elements=$j,$O.tilingOffset=$V)}else($V=($O=$S.meshRender.material).tilingOffset).elements=$j,$O.tilingOffset=$V},$O._getMeshRenderSharedMaterialAlbedo=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $S.meshRender.sharedMaterial.albedoColor.elements},$O._setMeshRenderSharedMaterialAlbedo=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).albedoColor).elements=$j,$O.albedoColor=$V)}else($V=($O=$S.meshRender.material).albedoColor).elements=$j,$O.albedoColor=$V},$O._getSkinnedMeshRenderSharedMaterialTilingOffset=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $S.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$O._setSkinnedMeshRenderSharedMaterialTilingOffset=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.skinnedMeshRender.material).tilingOffset).elements=$j,$O.tilingOffset=$V)}else($V=($O=$S.skinnedMeshRender.material).tilingOffset).elements=$j,$O.tilingOffset=$V},$O._getSkinnedMeshRenderSharedMaterialAlbedo=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $S.skinnedMeshRender.sharedMaterial.albedoColor.elements},$O._setSkinnedMeshRenderSharedMaterialAlbedo=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.skinnedMeshRender.material).albedoColor).elements=$j,$O.albedoColor=$V)}else($V=($O=$S.skinnedMeshRender.material).albedoColor).elements=$j,$O.albedoColor=$V},$O._getParticleRenderSharedMaterialTintColor=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.particleRender.sharedMaterial.tintColor.elements:null}return $S.particleRender.sharedMaterial.tintColor.elements},$O._setParticleRenderSharedMaterialTintColor=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.particleRender.material).tintColor).elements=$j,$O.tintColor=$V)}else($V=($O=$S.particleRender.material).tintColor).elements=$j,$O.tintColor=$V},$O._getMeshRenderSharedMaterialAlphaColor=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $S.meshRender.sharedMaterial.alphaColor.elements},$O._setMeshRenderSharedMaterialAlphaColor=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).alphaColor).elements=$j,$O.alphaColor=$V)}else($V=($O=$S.meshRender.material).alphaColor).elements=$j,$O.alphaColor=$V},$O._getMeshRenderSharedMaterialBaseColor=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.baseColor.elements:null}return $S.meshRender.sharedMaterial.baseColor.elements},$O._setMeshRenderSharedMaterialBaseColor=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).baseColor).elements=$j,$O.baseColor=$V)}else($V=($O=$S.meshRender.material).baseColor).elements=$j,$O.baseColor=$V},$O._getMeshRenderSharedMaterialDissolve=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.dissolve:0}return $S.meshRender.sharedMaterial.dissolve},$O._setMeshRenderSharedMaterialDissolve=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.dissolve=$j[0])}else $S.meshRender.material.dissolve=$j[0]},$O._getMeshRenderSharedMaterialDissolveSpeed=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $S.meshRender.sharedMaterial.dissolveSpeed},$O._setMeshRenderSharedMaterialDissolveSpeed=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.dissolveSpeed=$j[0])}else $S.meshRender.material.dissolveSpeed=$j[0]},$O._getMeshRenderSharedMaterialMMultiplier=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.mMultiplier:0}return $S.meshRender.sharedMaterial.mMultiplier},$O._setMeshRenderSharedMaterialMMultiplier=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.mMultiplier=$j[0])}else $S.meshRender.material.mMultiplier=$j[0]},$O._getMeshRenderSharedMaterialBaseScrollSpeedX=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $S.meshRender.sharedMaterial.baseScrollSpeedX},$O._setMeshRenderSharedMaterialBaseScrollSpeedX=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.baseScrollSpeedX=$j[0])}else $S.meshRender.material.baseScrollSpeedX=$j[0]},$O._getMeshRenderSharedMaterialBaseScrollSpeedY=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $S.meshRender.sharedMaterial.baseScrollSpeedY},$O._setMeshRenderSharedMaterialBaseScrollSpeedY=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.baseScrollSpeedY=$j[0])}else $S.meshRender.material.baseScrollSpeedY=$j[0]},$O._getMeshRenderSharedMaterialSecondScrollSpeedX=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $S.meshRender.sharedMaterial.secondScrollSpeedX},$O._setMeshRenderSharedMaterialSecondScrollSpeedX=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.secondScrollSpeedX=$j[0])}else $S.meshRender.material.secondScrollSpeedX=$j[0]},$O._getMeshRenderSharedMaterialSecondScrollSpeedY=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $S.meshRender.sharedMaterial.secondScrollSpeedY},$O._setMeshRenderSharedMaterialSecondScrollSpeedY=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.secondScrollSpeedY=$j[0])}else $S.meshRender.material.secondScrollSpeedY=$j[0]},$O._getMeshRenderSharedMaterialAlpha=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.alpha:0}return $S.meshRender.sharedMaterial.alpha},$O._setMeshRenderSharedMaterialAlpha=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.alpha=$j[0])}else $S.meshRender.material.alpha=$j[0]},$O._getMeshRenderSharedMaterialIntensity=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.intensity:0}return $S.meshRender.sharedMaterial.intensity},$O._setMeshRenderSharedMaterialIntensity=function($_,$S,$j){if($_){var $O=$_.transform._entity;$O&&($O.owner.meshRender.material.intensity=$j[0])}else $S.meshRender.material.intensity=$j[0]},$O._getMeshRenderSharedMaterialDetailTilingOffset=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $S.meshRender.sharedMaterial.detailTilingOffset.elements},$O._setMeshRenderSharedMaterialDetailTilingOffset=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).detailTilingOffset).elements=$j,$O.detailTilingOffset=$V)}else($V=($O=$S.meshRender.material).detailTilingOffset).elements=$j,$O.detailTilingOffset=$V},$O._getMeshRenderSharedMaterialDissolveTilingOffset=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $S.meshRender.sharedMaterial.dissolveTilingOffset.elements},$O._setMeshRenderSharedMaterialDissolveTilingOffset=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).dissolveTilingOffset).elements=$j,$O.dissolveTilingOffset=$V)}else($V=($O=$S.meshRender.material).dissolveTilingOffset).elements=$j,$O.dissolveTilingOffset=$V},$O._getMeshRenderSharedMaterialMaskTilingOffset=function($_,$S){if($_){var $j=$_.transform._entity;return $j?$j.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $S.meshRender.sharedMaterial.maskTilingOffset.elements},$O._setMeshRenderSharedMaterialMaskTilingOffset=function($_,$S,$j){var $O,$V;if($_){var $M=$_.transform._entity;$M&&(($V=($O=$M.owner.meshRender.material).maskTilingOffset).elements=$j,$O.maskTilingOffset=$V)}else($V=($O=$S.meshRender.material).maskTilingOffset).elements=$j,$O.maskTilingOffset=$V},$O._propertyIDCounter=0,$O._propertyIndexDic={},$O._propertySetFuncs=[],$O._propertyGetFuncs=[],$O}(),$D=function(){function $_(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $C($_,"laya.d3.animation.Keyframe"),$_}(),$L=function(){function $_(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $C($_,"laya.d3.animation.KeyframeNode"),$_}(),$F=(function(){function $_(){this._tempVector30=new $RS,this._tempVector31=new $RS,this._tempVector32=new $RS,this._a=new $RS,this._b=new $RS,this._c=new $RS,this._d=new $RS}$C($_,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $S=$_.prototype;$S.Init=function($_,$S,$j,$O){$_.cloneTo(this._d),$S.cloneTo(this._c),$RS.scale($_,2,this._a),$RS.scale($j,2,this._tempVector30),$RS.subtract(this._a,this._tempVector30,this._a),$RS.add(this._a,$S,this._a),$RS.add(this._a,$O,this._a),$RS.scale($j,3,this._b),$RS.scale($_,3,this._tempVector30),$RS.subtract(this._b,this._tempVector30,this._b),$RS.subtract(this._b,$O,this._b),$RS.scale($S,2,this._tempVector30),$RS.subtract(this._b,this._tempVector30,this._b)},$S.Slerp=function($_,$S){$RS.scale(this._a,$_*$_*$_,this._tempVector30),$RS.scale(this._b,$_*$_,this._tempVector31),$RS.scale(this._c,$_,this._tempVector32),$RS.add(this._tempVector30,this._tempVector31,$S),$RS.add($S,this._tempVector32,$S),$RS.add($S,this._d,$S)}}(),function(){function $B($_,$S,$j,$O){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$_,this._h=$S,this._minHeight=$j,this._maxHeight=$O}$C($B,"laya.d3.core.HeightMap");var $_=$B.prototype;$_._inBounds=function($_,$S){return 0<=$_&&$_<this._h&&0<=$S&&$S<this._w},$_.getHeight=function($_,$S){return this._inBounds($_,$S)?this._datas[$_][$S]:NaN},$i(0,$_,"width",function(){return this._w}),$i(0,$_,"height",function(){return this._h}),$i(0,$_,"maxHeight",function(){return this._maxHeight}),$i(0,$_,"minHeight",function(){return this._minHeight}),$B.creatFromMesh=function($_,$S,$j,$O){for(var $V=[],$M=[],$R=$_.getSubMeshCount(),$w=0;$w<$R;$w++){for(var $a=$_.getSubMesh($w),$u=$a._getVertexBuffer(),$c=$u.getData(),$q=[],$s=0;$s<$c.length;$s+=$u.vertexDeclaration.vertexStride/4){var $C=new $RS($c[$s+0],$c[$s+1],$c[$s+2]);$q.push($C)}$V.push($q);var $i=$a._getIndexBuffer();$M.push($i.getData())}var $v=$_.boundingBox,$Z=$v.min.x,$o=$v.min.z,$l=$v.max.x,$k=$v.max.z,$z=$v.min.y,$H=$v.max.y,$A=$l-$Z,$f=$k-$o,$y=$O.elements[0]=$A/($S-1),$P=$O.elements[1]=$f/($j-1),$g=new $B($S,$j,$z,$H),$E=$B._tempRay,$$=$E.direction.elements;$$[0]=0,$$[1]=-1,$$[2]=0;var $d=$H+.1;$E.origin.elements[1]=$d;for(var $n=0;$n<$j;$n++){var $J=$o+$n*$P;$g._datas[$n]=[];for(var $F=0;$F<$S;$F++){var $x=$Z+$F*$y,$h=$E.origin.elements;$h[0]=$x,$h[2]=$J;var $N=$B._getPosition($E,$V,$M);$g._datas[$n][$F]=$N===Number.MAX_VALUE?NaN:$d-$N}}return $g},$B.createFromImage=function($_,$S,$j){for(var $O=$_.width,$V=$_.height,$M=new $B($O,$V,$S,$j),$R=($j-$S)/254,$w=$_.getPixels(),$a=0,$u=0;$u<$V;$u++)for(var $c=$M._datas[$u]=[],$q=0;$q<$O;$q++){var $s=$w[$a++],$C=$w[$a++],$i=$w[$a++],$v=$w[$a++];$c[$q]=255==$s&&255==$C&&255==$i&&255==$v?NaN:($s+$C+$i)/3*$R+$S}return $M},$B._getPosition=function($_,$S,$j){for(var $O=Number.MAX_VALUE,$V=0;$V<$S.length;$V++)for(var $M=$S[$V],$R=$j[$V],$w=0;$w<$R.length;$w+=3){var $a=$M[$R[$w+0]],$u=$M[$R[$w+1]],$c=$M[$R[$w+2]],$q=$iS.rayIntersectsTriangle($_,$a,$u,$c);!isNaN($q)&&$q<$O&&($O=$q)}return $O},$q($B,["_tempRay",function(){return this._tempRay=new $VS(new $RS,new $RS)}])}(),function(){function $V(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$C($V,"laya.d3.core.Layer");var $_=$V.prototype;return $_._binarySearchIndex=function(){for(var $_=0,$S=$V._collsionTestList.length-1,$j=0;$_<=$S;){$j=Math.floor(($_+$S)/2);var $O=$V._collsionTestList[$j];if($O==this._number)return $j;$O>this._number?$S=$j-1:$_=$j+1}return $_},$_._addCollider=function($_){0===this._colliders.length&&$V._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$_._isRigidbody?(this._colliders.unshift($_),this._nonRigidbodyOffset++):this._colliders.push($_)},$_._removeCollider=function($_){var $S=this._colliders.indexOf($_);$S<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($S,1),0===this._colliders.length&&$V._collsionTestList.splice($V._collsionTestList.indexOf(this._number),1)},$i(0,$_,"number",function(){return this._number}),$i(0,$_,"visible",function(){return this._visible},function($_){this._visible=$_,$V._visibleLayers=$_?$V._visibleLayers|this.mask:$V._visibleLayers&~this.mask}),$i(0,$_,"mask",function(){return this._mask}),$i(1,$V,"visibleLayers",function(){return $V._visibleLayers},function($_){$V._visibleLayers=$_;for(var $S=0,$j=$V._layerList.length;$S<$j;$S++){var $O=$V._layerList[$S];$O._visible=0!=($O._mask&$V._visibleLayers)}}),$V.__init__=function(){$V._layerList.length=31;for(var $_=0;$_<31;$_++){var $S=new $V;$V._layerList[$_]=$S,0===$_?($S.name="Default Layer",$S.visible=!0):($S.name="Layer-"+$_,$S.visible=!1),$S._number=$_,$S._mask=Math.pow(2,$_)}$V.currentCreationLayer=$V._layerList[0]},$V.getLayerByNumber=function($_){if($_<0||30<$_)throw new Error("无法返回指定Layer，该number超出范围！");return $V._layerList[$_]},$V.getLayerByName=function($_){for(var $S=0;$S<31;$S++)if($V._layerList[$S].name===$_)return $V._layerList[$S];throw new Error("无法返回指定Layer,该name不存在")},$V.isVisible=function($_){return 0!=($_&$V._currentCameraCullingMask&$V._visibleLayers)},$V._layerList=[],$V._visibleLayers=2147483647,$V._collsionTestList=[],$V._currentCameraCullingMask=2147483647,$V.maxCount=31,$V.currentCreationLayer=null,$V}()),$x=(function(){function $_($_,$S,$j){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$_,this._minCount=$S,this._maxCount=$j}$C($_,"laya.d3.core.particleShuriKen.module.Burst");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.cloneTo=function($_){var $S=$_;$S._time=this._time,$S._minCount=this._minCount,$S._maxCount=this._maxCount},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"time",function(){return this._time}),$i(0,$S,"minCount",function(){return this._minCount}),$i(0,$S,"maxCount",function(){return this._maxCount})}(),function(){function $_($_){this._color=null,this.enbale=!1,this._color=$_}$C($_,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $S=$_.prototype;$S.cloneTo=function($_){var $S=$_;this._color.cloneTo($S._color),$S.enbale=this.enbale},$S.clone=function(){var $_;switch(this._color.type){case 0:$_=$N.createByConstant(this._color.constant.clone());break;case 1:$_=$N.createByGradient(this._color.gradient.clone());break;case 2:$_=$N.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$_=$N.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $S=new this.constructor($_);return $S.enbale=this.enbale,$S},$i(0,$S,"color",function(){return this._color})}(),function(){function $_(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$C($_,"laya.d3.core.particleShuriKen.module.Emission");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$S._destroy=function(){this._bursts=null,this._destroyed=!0},$S.getBurstsCount=function(){return this._bursts.length},$S.getBurstByIndex=function($_){return this._bursts[$_]},$S.addBurst=function($_){var $S=this._bursts.length;if(0<$S)for(var $j=0;$j<$S;$j++)this._bursts[$j].time>$_.time&&this._bursts.splice($j,0,$_);this._bursts.push($_)},$S.removeBurst=function($_){var $S=this._bursts.indexOf($_);-1!==$S&&this._bursts.splice($S,1)},$S.removeBurstByIndex=function($_){this._bursts.splice($_,1)},$S.clearBurst=function(){this._bursts.length=0},$S.cloneTo=function($_){var $S=$_,$j=$S._bursts;$j.length=this._bursts.length;for(var $O=0,$V=this._bursts.length;$O<$V;$O++){var $M=$j[$O];$M?this._bursts[$O].cloneTo($M):$j[$O]=this._bursts[$O].clone()}$S._emissionRate=this._emissionRate,$S.enbale=this.enbale},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"destroyed",function(){return this._destroyed}),$i(0,$S,"emissionRate",function(){return this._emissionRate},function($_){if($_<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$_})}(),function(){function $O(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$C($O,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $_=$O.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($_){var $S=$_;$S._type=this._type,$S._constant=this._constant,this._overTime.cloneTo($S._overTime),$S._constantMin=this._constantMin,$S._constantMax=this._constantMax,this._overTimeMin.cloneTo($S._overTimeMin),this._overTimeMax.cloneTo($S._overTimeMax)},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$_,"frameOverTimeData",function(){return this._overTime}),$i(0,$_,"constant",function(){return this._constant}),$i(0,$_,"type",function(){return this._type}),$i(0,$_,"frameOverTimeDataMin",function(){return this._overTimeMin}),$i(0,$_,"constantMin",function(){return this._constantMin}),$i(0,$_,"frameOverTimeDataMax",function(){return this._overTimeMax}),$i(0,$_,"constantMax",function(){return this._constantMax}),$O.createByConstant=function($_){var $S=new $O;return $S._type=0,$S._constant=$_,$S},$O.createByOverTime=function($_){var $S=new $O;return $S._type=1,$S._overTime=$_,$S},$O.createByRandomTwoConstant=function($_,$S){var $j=new $O;return $j._type=2,$j._constantMin=$_,$j._constantMax=$S,$j},$O.createByRandomTwoOverTime=function($_,$S){var $j=new $O;return $j._type=3,$j._overTimeMin=$_,$j._overTimeMax=$S,$j},$O}()),$h=function(){function $u(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$C($u,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $_=$u.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($_){var $S=$_;$S._type=this._type,$S._separateAxes=this._separateAxes,$S._constant=this._constant,this._constantSeparate.cloneTo($S._constantSeparate),this._gradient.cloneTo($S._gradient),this._gradientX.cloneTo($S._gradientX),this._gradientY.cloneTo($S._gradientY),this._gradientZ.cloneTo($S._gradientZ),$S._constantMin=this._constantMin,$S._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($S._constantMinSeparate),this._constantMaxSeparate.cloneTo($S._constantMaxSeparate),this._gradientMin.cloneTo($S._gradientMin),this._gradientMax.cloneTo($S._gradientMax),this._gradientXMin.cloneTo($S._gradientXMin),this._gradientXMax.cloneTo($S._gradientXMax),this._gradientYMin.cloneTo($S._gradientYMin),this._gradientYMax.cloneTo($S._gradientYMax),this._gradientZMin.cloneTo($S._gradientZMin),this._gradientZMax.cloneTo($S._gradientZMax)},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$_,"gradientZ",function(){return this._gradientZ}),$i(0,$_,"constant",function(){return this._constant}),$i(0,$_,"gradient",function(){return this._gradient}),$i(0,$_,"separateAxes",function(){return this._separateAxes}),$i(0,$_,"type",function(){return this._type}),$i(0,$_,"constantSeparate",function(){return this._constantSeparate}),$i(0,$_,"gradientX",function(){return this._gradientX}),$i(0,$_,"gradientY",function(){return this._gradientY}),$i(0,$_,"gradientW",function(){return this._gradientW}),$i(0,$_,"gradientMin",function(){return this._gradientMin}),$i(0,$_,"constantMin",function(){return this._constantMin}),$i(0,$_,"gradientMax",function(){return this._gradientMax}),$i(0,$_,"constantMax",function(){return this._constantMax}),$i(0,$_,"gradientWMin",function(){return this._gradientWMin}),$i(0,$_,"constantMinSeparate",function(){return this._constantMinSeparate}),$i(0,$_,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$i(0,$_,"gradientXMin",function(){return this._gradientXMin}),$i(0,$_,"gradientXMax",function(){return this._gradientXMax}),$i(0,$_,"gradientWMax",function(){return this._gradientWMax}),$i(0,$_,"gradientYMin",function(){return this._gradientYMin}),$i(0,$_,"gradientYMax",function(){return this._gradientYMax}),$i(0,$_,"gradientZMin",function(){return this._gradientZMin}),$i(0,$_,"gradientZMax",function(){return this._gradientZMax}),$u.createByConstant=function($_){var $S=new $u;return $S._type=0,$S._separateAxes=!1,$S._constant=$_,$S},$u.createByConstantSeparate=function($_){var $S=new $u;return $S._type=0,$S._separateAxes=!0,$S._constantSeparate=$_,$S},$u.createByGradient=function($_){var $S=new $u;return $S._type=1,$S._separateAxes=!1,$S._gradient=$_,$S},$u.createByGradientSeparate=function($_,$S,$j,$O){var $V=new $u;return $V._type=1,$V._separateAxes=!0,$V._gradientX=$_,$V._gradientY=$S,$V._gradientZ=$j,$V._gradientW=$O,$V},$u.createByRandomTwoConstant=function($_,$S){var $j=new $u;return $j._type=2,$j._separateAxes=!1,$j._constantMin=$_,$j._constantMax=$S,$j},$u.createByRandomTwoConstantSeparate=function($_,$S){var $j=new $u;return $j._type=2,$j._separateAxes=!0,$j._constantMinSeparate=$_,$j._constantMaxSeparate=$S,$j},$u.createByRandomTwoGradient=function($_,$S){var $j=new $u;return $j._type=3,$j._separateAxes=!1,$j._gradientMin=$_,$j._gradientMax=$S,$j},$u.createByRandomTwoGradientSeparate=function($_,$S,$j,$O,$V,$M,$R,$w){var $a=new $u;return $a._type=3,$a._separateAxes=!0,$a._gradientXMin=$_,$a._gradientXMax=$S,$a._gradientYMin=$j,$a._gradientYMax=$O,$a._gradientZMin=$V,$a._gradientZMax=$M,$a._gradientWMin=$R,$a._gradientWMax=$w,$a},$u}(),$N=function(){function $O(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$C($O,"laya.d3.core.particleShuriKen.module.GradientColor");var $_=$O.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($_){var $S=$_;$S._type=this._type,this._constant.cloneTo($S._constant),this._constantMin.cloneTo($S._constantMin),this._constantMax.cloneTo($S._constantMax),this._gradient.cloneTo($S._gradient),this._gradientMin.cloneTo($S._gradientMin),this._gradientMax.cloneTo($S._gradientMax)},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$_,"gradient",function(){return this._gradient}),$i(0,$_,"constant",function(){return this._constant}),$i(0,$_,"type",function(){return this._type}),$i(0,$_,"gradientMin",function(){return this._gradientMin}),$i(0,$_,"constantMin",function(){return this._constantMin}),$i(0,$_,"gradientMax",function(){return this._gradientMax}),$i(0,$_,"constantMax",function(){return this._constantMax}),$O.createByConstant=function($_){var $S=new $O;return $S._type=0,$S._constant=$_,$S},$O.createByGradient=function($_){var $S=new $O;return $S._type=1,$S._gradient=$_,$S},$O.createByRandomTwoConstant=function($_,$S){var $j=new $O;return $j._type=2,$j._constantMin=$_,$j._constantMax=$S,$j},$O.createByRandomTwoGradient=function($_,$S){var $j=new $O;return $j._type=3,$j._gradientMin=$_,$j._gradientMax=$S,$j},$O}(),$B=(function(){function $_(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$C($_,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.addAlpha=function($_,$S){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$_&&($_=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$_,this._alphaElements[this._alphaCurrentLength++]=$S):DEBUG},$S.addRGB=function($_,$S){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$_&&($_=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$_,this._rgbElements[this._rgbCurrentLength++]=$S.x,this._rgbElements[this._rgbCurrentLength++]=$S.y,this._rgbElements[this._rgbCurrentLength++]=$S.z):DEBUG},$S.cloneTo=function($_){var $S=$_,$j=0,$O=0;$S._alphaCurrentLength=this._alphaCurrentLength;var $V=$S._alphaElements;for($V.length=this._alphaElements.length,$j=0,$O=this._alphaElements.length;$j<$O;$j++)$V[$j]=this._alphaElements[$j];$S._rgbCurrentLength=this._rgbCurrentLength;var $M=$S._rgbElements;for($M.length=this._rgbElements.length,$j=0,$O=this._rgbElements.length;$j<$O;$j++)$M[$j]=this._rgbElements[$j]},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$i(0,$S,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $_(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$C($_,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.add=function($_,$S){this._currentLength<8?(6===this._currentLength&&1!==$_&&($_=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$_,this._elements[this._currentLength++]=$S):console.log("Warning:data count must lessEqual than 4")},$S.cloneTo=function($_){var $S=$_;$S._currentLength=this._currentLength;var $j=$S._elements;$j.length=this._elements.length;for(var $O=0,$V=this._elements.length;$O<$V;$O++)$j[$O]=this._elements[$O]},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"gradientCount",function(){return this._currentLength/2})}(),function(){function $_(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$C($_,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.add=function($_,$S){this._currentLength<8?(6===this._currentLength&&1!==$_&&($_=1,DEBUG),this._elements[this._currentLength++]=$_,this._elements[this._currentLength++]=$S):DEBUG},$S.getKeyByIndex=function($_){return this._elements[2*$_]},$S.getValueByIndex=function($_){return this._elements[2*$_+1]},$S.getAverageValue=function(){for(var $_=0,$S=this._currentLength-2;$_<$S;$_+=2){this._elements[$_+1];this._elements[$_+3],this._elements[$_+2]-this._elements[$_]}return 0},$S.cloneTo=function($_){var $S=$_;$S._currentLength=this._currentLength;var $j=$S._elements;$j.length=this._elements.length;for(var $O=0,$V=this._elements.length;$O<$V;$O++)$j[$O]=this._elements[$O]},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"gradientCount",function(){return this._currentLength/2})}(),function(){function $_(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$C($_,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.add=function($_,$S){this._currentLength<8?(6===this._currentLength&&1!==$_&&($_=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$_,this._elements[this._currentLength++]=$S.x,this._elements[this._currentLength++]=$S.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$S.cloneTo=function($_){var $S=$_;$S._currentLength=this._currentLength;var $j=$S._elements;$j.length=this._elements.length;for(var $O=0,$V=this._elements.length;$O<$V;$O++)$j[$O]=this._elements[$O]},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"gradientCount",function(){return this._currentLength/3})}(),function(){function $w(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$C($w,"laya.d3.core.particleShuriKen.module.GradientSize");var $_=$w.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.getMaxSizeInGradient=function(){var $_=0,$S=0,$j=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($_=0,$S=this._gradientX.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientX.getValueByIndex($_));for($_=0,$S=this._gradientY.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientY.getValueByIndex($_))}else for($_=0,$S=this._gradient.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradient.getValueByIndex($_));break;case 1:$j=this._separateAxes?($j=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$j=Math.max($j,this._constantMinSeparate.y),Math.max($j,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($_=0,$S=this._gradientXMin.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientXMin.getValueByIndex($_));for($_=0,$S=this._gradientXMax.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientXMax.getValueByIndex($_));for($_=0,$S=this._gradientYMin.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientYMin.getValueByIndex($_));for($_=0,$S=this._gradientZMax.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientZMax.getValueByIndex($_))}else{for($_=0,$S=this._gradientMin.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientMin.getValueByIndex($_));for($_=0,$S=this._gradientMax.gradientCount;$_<$S;$_++)$j=Math.max($j,this._gradientMax.getValueByIndex($_))}}return $j},$_.cloneTo=function($_){var $S=$_;$S._type=this._type,$S._separateAxes=this._separateAxes,this._gradient.cloneTo($S._gradient),this._gradientX.cloneTo($S._gradientX),this._gradientY.cloneTo($S._gradientY),this._gradientZ.cloneTo($S._gradientZ),$S._constantMin=this._constantMin,$S._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($S._constantMinSeparate),this._constantMaxSeparate.cloneTo($S._constantMaxSeparate),this._gradientMin.cloneTo($S._gradientMin),this._gradientMax.cloneTo($S._gradientMax),this._gradientXMin.cloneTo($S._gradientXMin),this._gradientXMax.cloneTo($S._gradientXMax),this._gradientYMin.cloneTo($S._gradientYMin),this._gradientYMax.cloneTo($S._gradientYMax),this._gradientZMin.cloneTo($S._gradientZMin),this._gradientZMax.cloneTo($S._gradientZMax)},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$_,"gradientZ",function(){return this._gradientZ}),$i(0,$_,"gradient",function(){return this._gradient}),$i(0,$_,"separateAxes",function(){return this._separateAxes}),$i(0,$_,"type",function(){return this._type}),$i(0,$_,"gradientMin",function(){return this._gradientMin}),$i(0,$_,"constantMin",function(){return this._constantMin}),$i(0,$_,"gradientX",function(){return this._gradientX}),$i(0,$_,"gradientY",function(){return this._gradientY}),$i(0,$_,"gradientMax",function(){return this._gradientMax}),$i(0,$_,"constantMax",function(){return this._constantMax}),$i(0,$_,"constantMinSeparate",function(){return this._constantMinSeparate}),$i(0,$_,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$i(0,$_,"gradientXMin",function(){return this._gradientXMin}),$i(0,$_,"gradientXMax",function(){return this._gradientXMax}),$i(0,$_,"gradientYMin",function(){return this._gradientYMin}),$i(0,$_,"gradientYMax",function(){return this._gradientYMax}),$i(0,$_,"gradientZMin",function(){return this._gradientZMin}),$i(0,$_,"gradientZMax",function(){return this._gradientZMax}),$w.createByGradient=function($_){var $S=new $w;return $S._type=0,$S._separateAxes=!1,$S._gradient=$_,$S},$w.createByGradientSeparate=function($_,$S,$j){var $O=new $w;return $O._type=0,$O._separateAxes=!0,$O._gradientX=$_,$O._gradientY=$S,$O._gradientZ=$j,$O},$w.createByRandomTwoConstant=function($_,$S){var $j=new $w;return $j._type=1,$j._separateAxes=!1,$j._constantMin=$_,$j._constantMax=$S,$j},$w.createByRandomTwoConstantSeparate=function($_,$S){var $j=new $w;return $j._type=1,$j._separateAxes=!0,$j._constantMinSeparate=$_,$j._constantMaxSeparate=$S,$j},$w.createByRandomTwoGradient=function($_,$S){var $j=new $w;return $j._type=2,$j._separateAxes=!1,$j._gradientMin=$_,$j._gradientMax=$S,$j},$w.createByRandomTwoGradientSeparate=function($_,$S,$j,$O,$V,$M){var $R=new $w;return $R._type=2,$R._separateAxes=!0,$R._gradientXMin=$_,$R._gradientXMax=$S,$R._gradientYMin=$j,$R._gradientYMax=$O,$R._gradientZMin=$V,$R._gradientZMax=$M,$R},$w}()),$t=function(){function $w(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$C($w,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $_=$w.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($_){var $S=$_;$S._type=this._type,this._constant.cloneTo($S._constant),this._gradientX.cloneTo($S._gradientX),this._gradientY.cloneTo($S._gradientY),this._gradientZ.cloneTo($S._gradientZ),this._constantMin.cloneTo($S._constantMin),this._constantMax.cloneTo($S._constantMax),this._gradientXMin.cloneTo($S._gradientXMin),this._gradientXMax.cloneTo($S._gradientXMax),this._gradientYMin.cloneTo($S._gradientYMin),this._gradientYMax.cloneTo($S._gradientYMax),this._gradientZMin.cloneTo($S._gradientZMin),this._gradientZMax.cloneTo($S._gradientZMax)},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$_,"gradientZ",function(){return this._gradientZ}),$i(0,$_,"constant",function(){return this._constant}),$i(0,$_,"type",function(){return this._type}),$i(0,$_,"gradientXMax",function(){return this._gradientXMax}),$i(0,$_,"constantMin",function(){return this._constantMin}),$i(0,$_,"gradientX",function(){return this._gradientX}),$i(0,$_,"gradientY",function(){return this._gradientY}),$i(0,$_,"gradientXMin",function(){return this._gradientXMin}),$i(0,$_,"constantMax",function(){return this._constantMax}),$i(0,$_,"gradientYMin",function(){return this._gradientYMin}),$i(0,$_,"gradientYMax",function(){return this._gradientYMax}),$i(0,$_,"gradientZMin",function(){return this._gradientZMin}),$i(0,$_,"gradientZMax",function(){return this._gradientZMax}),$w.createByConstant=function($_){var $S=new $w;return $S._type=0,$S._constant=$_,$S},$w.createByGradient=function($_,$S,$j){var $O=new $w;return $O._type=1,$O._gradientX=$_,$O._gradientY=$S,$O._gradientZ=$j,$O},$w.createByRandomTwoConstant=function($_,$S){var $j=new $w;return $j._type=2,$j._constantMin=$_,$j._constantMax=$S,$j},$w.createByRandomTwoGradient=function($_,$S,$j,$O,$V,$M){var $R=new $w;return $R._type=3,$R._gradientXMin=$_,$R._gradientXMax=$S,$R._gradientYMin=$j,$R._gradientYMax=$O,$R._gradientZMin=$V,$R._gradientZMax=$M,$R},$w}(),$m=(function(){function $_($_){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$_}$C($_,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.cloneTo=function($_){var $S=$_;this._angularVelocity.cloneTo($S._angularVelocity),$S.enbale=this.enbale},$S.clone=function(){var $_;switch(this._angularVelocity.type){case 0:$_=this._angularVelocity.separateAxes?$h.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$h.createByConstant(this._angularVelocity.constant);break;case 1:$_=this._angularVelocity.separateAxes?$h.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$h.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$_=this._angularVelocity.separateAxes?$h.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$h.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$_=this._angularVelocity.separateAxes?$h.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$h.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $S=new this.constructor($_);return $S.enbale=this.enbale,$S},$i(0,$S,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $_(){this.enable=!1,this.randomDirection=!1}$C($_,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $S=$_.prototype;return $H.imps($S,{"laya.d3.core.IClone":!0}),$S._getShapeBoundBox=function($_){throw new Error("BaseShape: must override it.")},$S._getSpeedBoundBox=function($_){throw new Error("BaseShape: must override it.")},$S.generatePositionAndDirection=function($_,$S,$j,$O){throw new Error("BaseShape: must override it.")},$S._calculateProceduralBounds=function($_,$S,$j){this._getShapeBoundBox($_);var $O=$_.min,$V=$_.max;$RS.multiply($O,$S,$O),$RS.multiply($V,$S,$V);var $M=new $I_(new $RS,new $RS);this.randomDirection?($M.min=new $RS(-1,-1,-1),$M.max=new $RS(1,1,1)):this._getSpeedBoundBox($M);var $R=new $I_(new $RS,new $RS),$w=$R.min,$a=$R.max;$RS.scale($M.min,$j.y,$w),$RS.scale($M.max,$j.y,$a),$RS.add($_.min,$w,$w),$RS.add($_.max,$a,$a),$RS.min($_.min,$w,$_.min),$RS.max($_.max,$w,$_.max);var $u=new $I_(new $RS,new $RS),$c=$u.min,$q=$u.max;$RS.scale($M.min,$j.x,$c),$RS.scale($M.max,$j.x,$q),$RS.min($u.min,$q,$w),$RS.max($u.min,$q,$a),$RS.min($_.min,$w,$_.min),$RS.max($_.max,$w,$_.max)},$S.cloneTo=function($_){$_.enable=this.enable},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$_}()),$U=function(){function $M(){}return $C($M,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$M._randomPointUnitArcCircle=function($_,$S,$j){var $O=$S.elements,$V=NaN;$V=$j?$j.getFloat()*$_:Math.random()*$_,$O[0]=Math.cos($V),$O[1]=Math.sin($V)},$M._randomPointInsideUnitArcCircle=function($_,$S,$j){var $O=$S.elements;$M._randomPointUnitArcCircle($_,$S,$j);var $V=NaN;$V=$j?Math.pow($j.getFloat(),.5):Math.pow(Math.random(),.5),$O[0]=$O[0]*$V,$O[1]=$O[1]*$V},$M._randomPointUnitCircle=function($_,$S){var $j=$_.elements,$O=NaN;$O=$S?$S.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$j[0]=Math.cos($O),$j[1]=Math.sin($O)},$M._randomPointInsideUnitCircle=function($_,$S){var $j=$_.elements;$M._randomPointUnitCircle($_);var $O=NaN;$O=$S?Math.pow($S.getFloat(),.5):Math.pow(Math.random(),.5),$j[0]=$j[0]*$O,$j[1]=$j[1]*$O},$M._randomPointUnitSphere=function($_,$S){var $j=$_.elements,$O=NaN,$V=NaN;$V=$S?($O=$j[2]=2*$S.getFloat()-1,$S.getFloat()*Math.PI*2):($O=$j[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $M=Math.sqrt(1-$O*$O);$j[0]=$M*Math.cos($V),$j[1]=$M*Math.sin($V)},$M._randomPointInsideUnitSphere=function($_,$S){var $j=$_.elements;$M._randomPointUnitSphere($_);var $O=NaN;$O=$S?Math.pow($S.getFloat(),1/3):Math.pow(Math.random(),1/3),$j[0]=$j[0]*$O,$j[1]=$j[1]*$O,$j[2]=$j[2]*$O},$M._randomPointInsideHalfUnitBox=function($_,$S){var $j=$_.elements;$S?($j[0]=$S.getFloat()-.5,$j[1]=$S.getFloat()-.5,$j[2]=$S.getFloat()-.5):($j[0]=Math.random()-.5,$j[1]=Math.random()-.5,$j[2]=Math.random()-.5)},$M}(),$Q=(function(){function $_($_){this._size=null,this.enbale=!1,this._size=$_}$C($_,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.cloneTo=function($_){var $S=$_;this._size.cloneTo($S._size),$S.enbale=this.enbale},$S.clone=function(){var $_;switch(this._size.type){case 0:$_=this._size.separateAxes?$B.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$B.createByGradient(this._size.gradient.clone());break;case 1:$_=this._size.separateAxes?$B.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$B.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$_=this._size.separateAxes?$B.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$B.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $S=new this.constructor($_);return $S.enbale=this.enbale,$S},$i(0,$S,"size",function(){return this._size})}(),function(){function $O(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$C($O,"laya.d3.core.particleShuriKen.module.StartFrame");var $_=$O.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.cloneTo=function($_){var $S=$_;$S._type=this._type,$S._constant=this._constant,$S._constantMin=this._constantMin,$S._constantMax=this._constantMax},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$_,"constant",function(){return this._constant}),$i(0,$_,"type",function(){return this._type}),$i(0,$_,"constantMin",function(){return this._constantMin}),$i(0,$_,"constantMax",function(){return this._constantMax}),$O.createByConstant=function($_){var $S=new $O;return $S._type=0,$S._constant=$_,$S},$O.createByRandomTwoConstant=function($_,$S){var $j=new $O;return $j._type=1,$j._constantMin=$_,$j._constantMax=$S,$j},$O}()),$Y=(function(){function $_($_,$S){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $MS(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$_,this._startFrame=$S}$C($_,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.cloneTo=function($_){var $S=$_;this.tiles.cloneTo($S.tiles),$S.type=this.type,$S.randomRow=this.randomRow,this._frame.cloneTo($S._frame),this._startFrame.cloneTo($S._startFrame),$S.cycles=this.cycles,$S.enableUVChannels=this.enableUVChannels,$S.enable=this.enable},$S.clone=function(){var $_,$S;switch(this._frame.type){case 0:$_=$x.createByConstant(this._frame.constant);break;case 1:$_=$x.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$_=$x.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$_=$x.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$S=$Q.createByConstant(this._startFrame.constant);break;case 1:$S=$Q.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $j=new this.constructor($_,$S);return this.tiles.cloneTo($j.tiles),$j.type=this.type,$j.randomRow=this.randomRow,$j.cycles=this.cycles,$j.enableUVChannels=this.enableUVChannels,$j.enable=this.enable,$j},$i(0,$S,"frame",function(){return this._frame}),$i(0,$S,"startFrame",function(){return this._startFrame})}(),function(){function $_($_){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$_}$C($_,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $S=$_.prototype;$H.imps($S,{"laya.d3.core.IClone":!0}),$S.cloneTo=function($_){var $S=$_;this._velocity.cloneTo($S._velocity),$S.enbale=this.enbale,$S.space=this.space},$S.clone=function(){var $_;switch(this._velocity.type){case 0:$_=$t.createByConstant(this._velocity.constant.clone());break;case 1:$_=$t.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$_=$t.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$_=$t.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $S=new this.constructor($_);return $S.enbale=this.enbale,$S.space=this.space,$S},$i(0,$S,"velocity",function(){return this._velocity})}(),function(){function $_(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $sS,this._vb=$mS.create($_._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$tS.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$NS.nameKey.getID("LINE"),this._shaderCompile=$yS._preCompileShader[this._sharderNameID]}$C($_,"laya.d3.core.PhasorSpriter3D");var $S=$_.prototype;return $S.line=function($_,$S,$j,$O){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($_.x,$_.y,$_.z,$S.x,$S.y,$S.z,$S.w),this.addVertex($j.x,$j.y,$j.z,$O.x,$O.y,$O.z,$O.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$S.circle=function($_,$S,$j,$O,$V,$M){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$S,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$S,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$_,Math.cos(this._tempNumver0)*$_,0,$j,$O,$V,$M),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$S.plane=function($_,$S,$j,$O,$V,$M,$R,$w,$a){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$O/2,this._tempNumver1=$V/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($_-this._tempNumver0,$S+this._tempNumver1,$j,$M,$R,$w,$a),this.addVertex($_+this._tempNumver0,$S+this._tempNumver1,$j,$M,$R,$w,$a),this.addVertex($_-this._tempNumver0,$S-this._tempNumver1,$j,$M,$R,$w,$a),this.addVertex($_+this._tempNumver0,$S-this._tempNumver1,$j,$M,$R,$w,$a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$S.box=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$O/2,this._tempNumver1=$V/2,this._tempNumver2=$M/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($_-this._tempNumver0,$S+this._tempNumver1,$j+this._tempNumver2,$R,$w,$a,$u),this.addVertex($_+this._tempNumver0,$S+this._tempNumver1,$j+this._tempNumver2,$R,$w,$a,$u),this.addVertex($_-this._tempNumver0,$S-this._tempNumver1,$j+this._tempNumver2,$R,$w,$a,$u),this.addVertex($_+this._tempNumver0,$S-this._tempNumver1,$j+this._tempNumver2,$R,$w,$a,$u),this.addVertex($_+this._tempNumver0,$S+this._tempNumver1,$j-this._tempNumver2,$R,$w,$a,$u),this.addVertex($_-this._tempNumver0,$S+this._tempNumver1,$j-this._tempNumver2,$R,$w,$a,$u),this.addVertex($_+this._tempNumver0,$S-this._tempNumver1,$j-this._tempNumver2,$R,$w,$a,$u),this.addVertex($_-this._tempNumver0,$S-this._tempNumver1,$j-this._tempNumver2,$R,$w,$a,$u),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$S.cone=function($_,$S,$j,$O,$V,$M,$R){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$j+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$j>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$j,this.addVertexIndex(0,$S,0,$O,$V,$M,$R,this._tempUint0),this.addVertexIndex(0,0,0,$O,$V,$M,$R,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$j;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($_*this._tempNumver2,0,$_*this._tempNumver3,$O,$V,$M,$R,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$j-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($_*this._tempNumver2,0,$_*this._tempNumver3,$O,$V,$M,$R,this._tempUint0+(this._tempInt0+$j)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$j-1?this.addIndexes(this._tempUint1+$j+2):this.addIndexes(this._tempUint1+this._tempInt0+$j+1),this.addIndexes(this._tempUint1+this._tempInt0+$j),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$S.boundingBoxLine=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($_,$V,$M,$R,$w,$a,$u),this.addVertex($O,$V,$M,$R,$w,$a,$u),this.addVertex($_,$S,$M,$R,$w,$a,$u),this.addVertex($O,$S,$M,$R,$w,$a,$u),this.addVertex($O,$V,$j,$R,$w,$a,$u),this.addVertex($_,$V,$j,$R,$w,$a,$u),this.addVertex($O,$S,$j,$R,$w,$a,$u),this.addVertex($_,$S,$j,$R,$w,$a,$u),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$S.addVertex=function($_,$S,$j,$O,$V,$M,$R){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$_,this._vbData[this._posInVBData+1]=$S,this._vbData[this._posInVBData+2]=$j,this._vbData[this._posInVBData+3]=$O,this._vbData[this._posInVBData+4]=$V,this._vbData[this._posInVBData+5]=$M,this._vbData[this._posInVBData+6]=$R,this._posInVBData+=this._floatSizePerVer,this},$S.addVertexIndex=function($_,$S,$j,$O,$V,$M,$R,$w){return this._hasBegun||this.addVertexIndexException(),this._vbData[$w]=$_,this._vbData[$w+1]=$S,this._vbData[$w+2]=$j,this._vbData[$w+3]=$O,this._vbData[$w+4]=$V,this._vbData[$w+5]=$M,this._vbData[$w+6]=$R,($w+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$w),this},$S.addIndexes=function($_){var $S=arguments;this._hasBegun||this.addVertexIndexException();for(var $j=0;$j<$S.length;$j++)this._ibData[this._posInIBData]=$S[$j],this._posInIBData++;return this},$S.begin=function($_,$S){return this._hasBegun&&this.beginException0(),1!==$_&&4!==$_&&this.beginException1(),this._primitiveType=$_,this._camera=$S,this._hasBegun=!0,this},$S.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$S.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($_._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$y.drawCall++,$d.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$S.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$S.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$S.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$S.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$S.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$S.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(28,[new $R_(0,"vector3",0),new $R_(12,"vector4",1)])}]),$_}()),$T=function(){function $_(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$_._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $sS}$C($_,"laya.d3.core.render.RenderElement");var $S=$_.prototype;return $S.getDynamicBatchBakedVertexs=function($_){for(var $S=this._renderObj._getVertexBuffer($_),$j=$S.getData().slice(),$O=$S.vertexDeclaration,$V=$O.getVertexElementByUsage(0).offset/4,$M=$O.getVertexElementByUsage(3).offset/4,$R=this._sprite3D.transform,$w=$R.worldMatrix,$a=$R.rotation,$u=$O.vertexStride/4,$c=0,$q=$j.length;$c<$q;$c+=$u){var $s=$c+$V,$C=$c+$M;$ZS.transformVector3ArrayToVector3ArrayCoordinate($j,$s,$w,$j,$s),$ZS.transformVector3ArrayByQuat($j,$C,$a,$j,$C)}return $j},$S.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$S._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$i(0,$S,"id",function(){return this._id}),$i(0,$S,"renderObj",function(){return this._renderObj},function($_){this._renderObj!==$_&&(this._renderObj=$_)}),$_._uniqueIDCounter=0,$_}(),$W=function(){function $S($_){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$S._uniqueIDCounter,this._needSort=!1,this._scene=$_,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$C($S,"laya.d3.core.render.RenderQueue");var $_=$S.prototype;return $_._sortOpaqueFunc=function($_,$S){if($_._render&&$S._render){var $j=$_._material.renderQueue-$S._material.renderQueue;return 0==$j?$_._render._distanceForSort-$S._render._distanceForSort:$j}return 0},$_._sortAlphaFunc=function($_,$S){if($_._render&&$S._render){var $j=$_._material.renderQueue-$S._material.renderQueue;return 0==$j?$S._render._distanceForSort-$_._render._distanceForSort:$j}return 0},$_._begainRenderElement=function($_,$S,$j){return!!$S._beforeRender($_)},$_._sortAlpha=function($_){$S._cameraPosition=$_,this._finalElements.sort(this._sortAlphaFunc)},$_._sortOpaque=function($_){$S._cameraPosition=$_,this._finalElements.sort(this._sortOpaqueFunc)},$_._preRender=function($_){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$_._render=function($_,$S){for(var $j,$O,$V,$M,$R,$w,$a=$y.loopCount,$u=this._scene,$c=$_.camera,$q=($c.id,!1),$s=0,$C=this._finalElements.length;$s<$C;$s++){var $i,$v,$Z,$o=this._finalElements[$s];if(null!=$o._onPreRenderFunction&&$o._onPreRenderFunction.call($o._sprite3D,$_),0===$o._type){if($_.owner=$Z=$o._sprite3D,$_.renderElement=$o,$Z._preRenderUpdateComponents($_),$i=$o.renderObj,$v=$o._material,this._begainRenderElement($_,$i,$v)){if($j=$i._getVertexBuffers(),!($V=($O=$i._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$O.id]){this._errorRecord[$O.id]=1;var $l="vertexBuffer:"+("("+$O._destroyed+","+$O._released+","+$O._referenceCount+","+$O._buffer+")")+", material:"+($v?$v.__className+"("+$v._destroyed+","+$v._released+")":"null")+", owner:"+($Z?$Z.__className+"("+$Z._destroyed+","+$Z._activeInHierarchy+","+$Z._displayedInStage+")":"null")+", renderObj:"+($i?$i.__className+"("+$i._destroyed+","+$i._released+","+$i._referenceCount+")":"")+", parent:, url:"+($Z?$Z.url:"")+", disposeStack:"+$O.disposeStack;$H.recordError("报错：unknown vertexDeclaration  "+$l)}continue}if($q=($M=$_._shader=$v._getShader($u._shaderDefineValue,$V.shaderDefineValue,$Z._shaderDefineValue)).bind()||$a!==$M._uploadLoopCount,$j){if($M._uploadVertexBuffer!==$j||$q){for(var $k=0;$k<$j.length;$k++){var $z=$j[$k];$M.uploadAttributesX($z.vertexDeclaration.shaderValues.data,$z)}$M._uploadVertexBuffer=$j}}else($M._uploadVertexBuffer!==$O||$q)&&($M.uploadAttributes($V.shaderValues.data,null),$M._uploadVertexBuffer=$O);($M._uploadScene!==$u||$q)&&($M.uploadSceneUniforms($u._shaderValues.data),$M._uploadScene=$u),($c!==$M._uploadCamera||$M._uploadSprite3D!==$Z||$q)&&($M.uploadSpriteUniforms($Z._shaderValues.data),$M._uploadSprite3D=$Z),($c!==$M._uploadCamera||$q)&&($M.uploadCameraUniforms($c._shaderValues.data),$M._uploadCamera=$c),($M._uploadMaterial!==$v||$q)&&($v._upload(),$M._uploadMaterial=$v),$R!==$v?($v._setRenderStateBlendDepth(),$v._setRenderStateFrontFace($S,$Z.transform),$R=$v,$w=$Z):$w!==$Z&&($v._setRenderStateFrontFace($S,$Z.transform),$w=$Z),$i._render($_),$M._uploadLoopCount=$a}$Z._postRenderUpdateComponents($_)}else if(2===$o._type){$o.renderObj;$_.owner=$Z=$o._sprite3D,$_.renderElement=$o,$_._batchIndexStart=$o._tempBatchIndexStart,$_._batchIndexEnd=$o._tempBatchIndexEnd,$i=$o.renderObj,$v=$o._material,this._begainRenderElement($_,$i,$v)&&($V=($O=$i._getVertexBuffer(0)).vertexDeclaration,$q=($M=$_._shader=$v._getShader($u._shaderDefineValue,$V.shaderDefineValue,$Z._shaderDefineValue)).bind()||$a!==$M._uploadLoopCount,($M._uploadVertexBuffer!==$O||$q)&&($M.uploadAttributes($V.shaderValues.data,null),$M._uploadVertexBuffer=$O),($M._uploadScene!==$u||$q)&&($M.uploadSceneUniforms($u._shaderValues.data),$M._uploadScene=$u),($c!==$M._uploadCamera||$M._uploadSprite3D!==$Z||$q)&&($M.uploadSpriteUniforms($Z._shaderValues.data),$M._uploadSprite3D=$Z),($c!==$M._uploadCamera||$q)&&($M.uploadCameraUniforms($c._shaderValues.data),$M._uploadCamera=$c),($M._uploadMaterial!==$v||$q)&&($v._upload(),$M._uploadMaterial=$v),$R!==$v?($v._setRenderStateBlendDepth(),$v._setRenderStateFrontFace($S,$Z.transform),$R=$v,$w=$Z):$w!==$Z&&($v._setRenderStateFrontFace($S,$Z.transform),$w=$Z),$i._render($_),$M._uploadLoopCount=$a)}}},$_._renderShadow=function($_,$S){for(var $j,$O,$V,$M,$R,$w=$y.loopCount,$a=this._scene,$u=$_.camera,$c=!1,$q=0,$s=this._finalElements.length;$q<$s;$q++){var $C,$i,$v,$Z=this._finalElements[$q];0===$Z._type&&($_.owner=$v=$Z._sprite3D,$S||$v._projectionViewWorldUpdateCamera===$u&&$v._projectionViewWorldUpdateLoopCount===$y.loopCount||($v._render._renderUpdate($_._projectionViewMatrix),$v._projectionViewWorldUpdateLoopCount=$y.loopCount,$v._projectionViewWorldUpdateCamera=$u),$_.renderElement=$Z,$v._preRenderUpdateComponents($_),$C=$Z.renderObj,$i=$Z._material,this._begainRenderElement($_,$C,null)&&($O=($j=$C._getVertexBuffer(0)).vertexDeclaration,$c=($V=$_._shader=$i._getShader($a._shaderDefineValue,$O.shaderDefineValue,$v._shaderDefineValue)).bind()||$w!==$V._uploadLoopCount,($V._uploadVertexBuffer!==$j||$c)&&($V.uploadAttributes($O.shaderValues.data,null),$V._uploadVertexBuffer=$j),($u!==$V._uploadCamera||$V._uploadSprite3D!==$v||$c)&&($V.uploadSpriteUniforms($v._shaderValues.data),$V._uploadSprite3D=$v),($u!==$V._uploadCamera||$c)&&($V.uploadCameraUniforms($u._shaderValues.data),$V._uploadCamera=$u),($V._uploadMaterial!==$i||$c)&&($i._upload(),$V._uploadMaterial=$i),$V._uploadRenderElement,$M!==$i?($i._setRenderStateFrontFace(!1,$v.transform),$M=$i,$R=$v):$R!==$v&&($i._setRenderStateFrontFace(!1,$v.transform),$R=$v),$C._render($_),$V._uploadLoopCount=$w),$v._postRenderUpdateComponents($_))}},$_._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$_._addRenderElement=function($_){this._renderElements.push($_),this._needSort=!0},$_._addDynamicBatchElement=function($_){this._dynamicBatchCombineRenderElements.push($_)},$i(0,$_,"id",function(){return this._id}),$S._uniqueIDCounter=0,$S._cameraPosition=null,$S}(),$p=function(){function $_(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $C($_,"laya.d3.core.render.RenderState"),$_.clientWidth=0,$_.clientHeight=0,$_}(),$I=function(){function $R($_,$S){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $X_(new $RS,0),this._corners=[new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS],this._boundingBoxCenter=new $RS,this._children=$O(8),this._objects=[],this._tempBoundBoxCorners=[new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS],this._scene=$_,this._currentDepth=$S}$C($R,"laya.d3.core.scene.OctreeNode");var $_=$R.prototype;return $H.imps($_,{"laya.d3.core.scene.ITreeNode":!0}),$_.init=function($_,$S){var $j=new $RS,$O=new $RS;$RS.scale($S,-.5,$j),$RS.scale($S,.5,$O),$RS.add($j,$_,$j),$RS.add($O,$_,$O),this.exactBox=new $I_($j,$O),this.relaxBox=new $I_($j,$O)},$_.addTreeNode=function($_){1===Collision.boxContainsBox(this._relaxBox,$_.boundingBox)?this.addNodeDown($_,0):this.addObject($_)},$_.addChild=function($_){var $S=this._children[$_];if(null==$S){$S=new $R(this._scene,this._currentDepth+1),(this._children[$_]=$S)._parent=this,$RS.subtract(this._exactBox.max,this._exactBox.min,$R.tempSize),$RS.multiply($R.tempSize,$R._octreeSplit[$_],$R.tempCenter),$RS.add(this._exactBox.min,$R.tempCenter,$R.tempCenter),$RS.scale($R.tempSize,.25,$R.tempSize);var $j=new $RS,$O=new $RS;$RS.subtract($R.tempCenter,$R.tempSize,$j),$RS.add($R.tempCenter,$R.tempSize,$O),$S.exactBox=new $I_($j,$O),$RS.scale($R.tempSize,$R.relax,$R.tempSize);var $V=new $RS,$M=new $RS;$RS.subtract($R.tempCenter,$R.tempSize,$V),$RS.add($R.tempCenter,$R.tempSize,$M),$S.relaxBox=new $I_($V,$M)}return $S},$_.addObject=function($_){($_._treeNode=this)._objects.push($_)},$_.removeObject=function($_){if($_._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $S=this._objects.indexOf($_);return-1!==$S&&(this._objects.splice($S,1),!0)},$_.clearObject=function(){this._objects.length=0},$_.addNodeUp=function($_,$S){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$_.boundingBox)?this._parent.addNodeUp($_,$S-1):this.addNodeDown($_,$S)},$_.addNodeDown=function($_,$S){if($S<this._scene.treeLevel){var $j=this.inChildIndex($_.boundingBoxCenter),$O=this.addChild($j);1===Collision.boxContainsBox($O._relaxBox,$_.boundingBox)?$O.addNodeDown($_,++$S):this.addObject($_)}else this.addObject($_)},$_.inChildIndex=function($_){return 4*($_.z<this._boundingBoxCenter.z?0:1)+2*($_.y<this._boundingBoxCenter.y?0:1)+($_.x<this._boundingBoxCenter.x?0:1)},$_.updateObject=function($_){1===Collision.boxContainsBox(this._relaxBox,$_.boundingBox)?(this.removeObject($_),$_._treeNode=null,this.addNodeDown($_,this._currentDepth)):this._parent&&(this.removeObject($_),$_._treeNode=null,this._parent.addNodeUp($_,this._currentDepth-1))},$_.cullingObjects=function($_,$S,$j,$O,$V){var $M,$R=0,$w=0,$a=0,$u=this._scene._dynamicBatchManager;for($R=0,$M=this._objects.length;$R<$M;$R++){var $c=this._objects[$R];if($F.isVisible($c._owner.layer.mask)&&$c.enable){if($S&&($y.treeSpriteCollision+=1,0===$_.containsBoundSphere($c.boundingSphere)))continue;$c._renderUpdate($V),$c._distanceForSort=$RS.distance($c.boundingSphere.center,$O)+$c.sortingFudge;var $q=$c._renderElements;for($w=0,$a=$q.length;$w<$a;$w++){var $s=$q[$w],$C=$s._staticBatch;if($C&&$C._material===$s._material)$C._addBatchRenderElement($s);else{var $i=$s.renderObj;$i.triangleCount<10&&1===$i._vertexBufferCount&&$i._getIndexBuffer()&&$s._material.renderQueue<2&&$s._canDynamicBatch&&!$c._owner.isStatic?$u._addPrepareRenderElement($s):this._scene.getRenderQueue($s._material.renderQueue)._addRenderElement($s)}}}}for($R=0;$R<8;$R++){var $v=this._children[$R];if(null!=$v){var $Z=$S;if($S){var $o=$_.containsBoundBox($v._relaxBox);if($y.treeNodeCollision+=1,0===$o)continue;$Z=2===$o}$v.cullingObjects($_,$Z,$j,$O,$V)}}},$_.cullingShadowObjects=function($_,$S,$j,$O,$V){var $M,$R=0,$w=0,$a=0;this._scene._dynamicBatchManager;for($R=0,$M=this._objects.length;$R<$M;$R++){var $u=this._objects[$R];if($u.castShadow&&$F.isVisible($u._owner.layer.mask)&&$u.enable){if($j&&0===$_[0].containsBoundSphere($u.boundingSphere))continue;for(var $c=1,$q=$_.length;$c<$q;$c++){var $s=$S[$c-1];if(0!==$_[$c].containsBoundSphere($u.boundingSphere)){var $C=$u._renderElements;for($w=0,$a=$C.length;$w<$a;$w++)$s._addRenderElement($C[$w])}}}}for($R=0;$R<8;$R++){var $i=this._children[$R];if(null!=$i){var $v=$j;if($j){var $Z=$_[0].containsBoundBox($i._relaxBox);if(0===$Z)continue;$v=2===$Z}$i.cullingShadowObjects($_,$S,$v,$O,$V)}}},$_.cullingShadowObjectsOnePSSM=function($_,$S,$j,$O,$V,$M){var $R,$w=$S[0],$a=0,$u=0,$c=0;for($a=0,$R=this._objects.length;$a<$R;$a++){var $q=this._objects[$a];if($q.castShadow&&$F.isVisible($q._owner.layer.mask)&&$q.enable){if($O&&0===$_.containsBoundSphere($q.boundingSphere))continue;$q._renderUpdate($j);var $s=$q._renderElements;for($u=0,$c=$s.length;$u<$c;$u++)$w._addRenderElement($s[$u])}}for($a=0;$a<8;$a++){var $C=this._children[$a];if(null!=$C){var $i=$O;if($O){var $v=$_.containsBoundBox($C._relaxBox);if(0===$v)continue;$i=2===$v}$C.cullingShadowObjectsOnePSSM($_,$S,$j,$i,$V,$M)}}},$_.renderBoudingBox=function($_){this._renderBoudingBox($_);for(var $S=0;$S<8;++$S){var $j=this._children[$S];$j&&$j.renderBoudingBox($_)}},$_.buildAllChild=function($_){if($_<this._scene.treeLevel)for(var $S=0;$S<8;$S++){this.addChild($S).buildAllChild($_+1)}},$_._renderBoudingBox=function($_){},$i(0,$_,"exactBox",function(){return this._exactBox},function($_){this._exactBox=$_,$RS.add($_.min,$_.max,this._boundingBoxCenter),$RS.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$i(0,$_,"relaxBox",function(){return this._relaxBox},function($_){(this._relaxBox=$_).getCorners(this._corners),$X_.createfromPoints(this._corners,this._boundingSphere)}),$R.debugMode=!1,$R.relax=1.15,$R.CHILDNUM=8,$q($R,["tempVector0",function(){return this.tempVector0=new $RS},"tempSize",function(){return this.tempSize=new $RS},"tempCenter",function(){return this.tempCenter=new $RS},"_octreeSplit",function(){return this._octreeSplit=[new $RS(.25,.25,.25),new $RS(.75,.25,.25),new $RS(.25,.75,.25),new $RS(.75,.75,.25),new $RS(.25,.25,.75),new $RS(.75,.25,.75),new $RS(.25,.75,.75),new $RS(.75,.75,.75)]}]),$R}(),$K=(function(){function $_(){}$C($_,"laya.d3.core.scene.SceneManager")}(),function(){function $_($_,$S,$j,$O){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$_&&($_=1),void 0===$S&&($S=1),void 0===$j&&($j=1),void 0===$O&&($O=1),this._r=$_,this._g=$S,this._b=$j,this._a=$O}return $C($_,"laya.d3.core.trail.module.Color",null,"Color$1"),$_.prototype.cloneTo=function($_){$_._r=this._r,$_._g=this._g,$_._b=this._b,$_._a=this._a},$q($_,["RED",function(){return this.RED=new $_(1,0,0,1)},"GREEN",function(){return this.GREEN=new $_(0,1,0,1)},"BLUE",function(){return this.BLUE=new $_(0,0,1,1)},"CYAN",function(){return this.CYAN=new $_(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $_(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $_(1,0,1,1)},"GRAY",function(){return this.GRAY=new $_(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $_(1,1,1,1)},"BLACK",function(){return this.BLACK=new $_(0,0,0,1)}]),$_}()),$X=(function(){function $_(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$C($_,"laya.d3.core.trail.module.Gradient");var $S=$_.prototype;$S.setKeys=function($_,$S){var $j,$O;this._colorKeys=$_;for(var $V=this.index=0;$V<$_.length;$V++){var $M=($j=$_[$V]).color;this._colorKeyData[this.index++]=$M._r,this._colorKeyData[this.index++]=$M._g,this._colorKeyData[this.index++]=$M._b,this._colorKeyData[this.index++]=$j.time}this._alphaKeys=$S;for(var $R=this.index=0;$R<$S.length;$R++)$O=$S[$R],this._alphaKeyData[this.index++]=$O.alpha,this._alphaKeyData[this.index++]=$O.time},$S.cloneTo=function($_){var $S=0,$j=0,$O=this.colorKeys,$V=[];for($S=0,$j=$O.length;$S<$j;$S++){var $M=new $r;$O[$S].cloneTo($M),$V.push($M)}var $R=this.alphaKeys,$w=[];for($S=0,$j=$R.length;$S<$j;$S++){var $a=new $X;$R[$S].cloneTo($a),$w.push($a)}$_.setKeys($V,$w)},$i(0,$S,"mode",function(){return this._mode},function($_){this._mode=$_}),$i(0,$S,"colorKeys",function(){return this._colorKeys},function($_){this._colorKeys=$_;for(var $S=this.index=0;$S<$_.length;$S++){var $j=$_[$S],$O=$j.color;this._colorKeyData[this.index++]=$O._r,this._colorKeyData[this.index++]=$O._g,this._colorKeyData[this.index++]=$O._b,this._colorKeyData[this.index++]=$j.time}}),$i(0,$S,"alphaKeys",function(){return this._alphaKeys},function($_){this._alphaKeys=$_;for(var $S=this.index=0;$S<$_.length;$S++){var $j=$_[$S];this._alphaKeyData[this.index++]=$j.alpha,this._alphaKeyData[this.index++]=$j.time}})}(),function(){function $_($_,$S){this._alpha=NaN,this._time=NaN,void 0===$_&&($_=0),void 0===$S&&($S=0),this._alpha=$_,this._time=$S}$C($_,"laya.d3.core.trail.module.GradientAlphaKey");var $S=$_.prototype;return $S.cloneTo=function($_){$_.alpha=this.alpha,$_.time=this.time},$i(0,$S,"alpha",function(){return this._alpha},function($_){this._alpha=$_}),$i(0,$S,"time",function(){return this._time},function($_){this._time=$_}),$_}()),$r=function(){function $_($_,$S){this._color=null,this._time=NaN,void 0===$S&&($S=0),this._color=$_||new $K,this._time=$S}$C($_,"laya.d3.core.trail.module.GradientColorKey");var $S=$_.prototype;return $S.cloneTo=function($_){this.color.cloneTo($_.color),$_.time=this.time},$i(0,$S,"color",function(){return this._color},function($_){this._color=$_}),$i(0,$S,"time",function(){return this._time},function($_){this._time=$_}),$_}(),$b=(function(){function $_(){}$C($_,"laya.d3.core.trail.module.GradientMode"),$_.Blend=0,$_.Fixed=1}(),function(){function $_(){}$C($_,"laya.d3.core.trail.module.TextureMode"),$_.Stretch=0,$_.Tile=1}(),function(){function $_(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$C($_,"laya.d3.core.trail.module.TrailKeyFrame"),$_.prototype.cloneTo=function($_){$_.time=this.time,$_.inTangent=this.inTangent,$_.outTangent=this.outTangent,$_.value=this.value}}(),function(){function $S($_){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $RS,this._curPosition=new $RS,this._delVector3=new $RS,this._lastFixedVertexPosition=new $RS,this._pointAtoBVector3=new $RS,this._pointA=new $RS,this._pointB=new $RS,this._owner=$_,this._id=$S.renderElementCount++,0==this._id?$_._owner.transform.position.cloneTo(this._lastPosition):$_._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $mS($b.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $mS($b.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$C($S,"laya.d3.core.trail.TrailRenderElement");var $_=$S.prototype;$H.imps($_,{"laya.d3.core.render.IRenderable":!0}),$_._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$_._addTrailByFirstPosition=function($_,$S){$RS.subtract($S,$_,this._delVector3),$RS.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$RS.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$RS.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($_),$_.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$_._addTrailByNextPosition=function($_){$RS.subtract($_,this._lastFixedVertexPosition,this._delVector3),$RS.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$RS.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$RS.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$RS.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$r_.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($_),$_.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($_),this._virtualVerticesCount=2)},$_._updateVerticesByPosition=function($_){this._pointe=$_.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$_._updateVertexBuffer2=function(){var $_,$S=0,$j=0,$O=0;for($O=0,$_=(this._verticesCount+this._virtualVerticesCount)/2;$O<$_;$O++)$j=0==this._owner.textureMode?(this._VerticesToTailLength[$O]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$O],this._vertices2[$S++]=1-$j,this._vertices2[$S++]=1-$j;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$_._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$_._updateDisappear=function(){var $_,$S=0;for($S=this._curDisappearIndex,$_=(this._verticesCount+this._virtualVerticesCount)/2;$S<$_;$S++)this._owner._curtime-this._everyGroupVertexBirthTime[$S]>=this._owner.time+$r_.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$_._beforeRender=function($_){return this._camera=$_.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$RS.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$_._render=function($_){this._isDead||($d.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$y.drawCall++,$y.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$_._getVertexBuffer=function($_){return void 0===$_&&($_=0),0===$_?this._vertexBuffer1:1===$_?this._vertexBuffer2:null},$_._getVertexBuffers=function(){return this._vertexBuffers},$_._getIndexBuffer=function(){return null},$_.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$_._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$i(0,$_,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$i(0,$_,"triangleCount",function(){return 0}),$S.renderElementCount=0}(),function(){function $_(){}$C($_,"laya.d3.core.trail.VertexTrail");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration1}),$i(1,$_,"vertexDeclaration1",function(){return $_._vertexDeclaration1}),$i(1,$_,"vertexDeclaration2",function(){return $_._vertexDeclaration2}),$q($_,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $M_(32,[new $R_(0,"vector3",0),new $R_(12,"vector3",41),new $R_(24,"single",33),new $R_(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $M_(4,[new $R_(0,"single",38)])}]),$_}()),$__=function(){function $z($_){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$_}$C($z,"laya.d3.graphics.DynamicBatch");var $_=$z.prototype;return $H.imps($_,{"laya.d3.core.render.IRenderable":!0}),$_._getVertexBuffer=function($_){return void 0===$_&&($_=0),0===$_?this._vertexBuffer:null},$_._getIndexBuffer=function(){return this._indexBuffer},$_._getCombineRenderElementFromPool=function($_,$S,$j){var $O=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $O||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$O=new $T,$O._sprite3D=new $WS),$O._sprite3D._render._renderUpdate($j),$O},$_._getRenderElement=function($_,$S,$j){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$z.maxVertexCount),this._indexDatas=new Uint16Array($z.maxIndexCount),this._vertexBuffer=$mS.create(this._vertexDeclaration,$z.maxVertexCount,35048),this._indexBuffer=$tS.create("ushort",$z.maxIndexCount,35048));for(var $O=this._merageElements.length=0,$V=0,$M=0,$R=this._combineRenderElements.length;$M<$R;$M++){var $w=this._combineRenderElements[$M],$a=$w.getDynamicBatchBakedVertexs(0),$u=$w.getBakedIndices(),$c=$w._sprite3D.transform._isFrontFaceInvert,$q=$O/(this._vertexDeclaration.vertexStride/4),$s=$V,$C=$s+$u.length;$w._tempBatchIndexStart=$s,$w._tempBatchIndexEnd=$C,this._indexDatas.set($u,$V);var $i=0;if($c)for($i=$s;$i<$C;$i+=3){this._indexDatas[$i]=$q+this._indexDatas[$i];var $v=this._indexDatas[$i+1],$Z=this._indexDatas[$i+2];this._indexDatas[$i+1]=$q+$Z,this._indexDatas[$i+2]=$q+$v}else for($i=$s;$i<$C;$i+=3)this._indexDatas[$i]=$q+this._indexDatas[$i],this._indexDatas[$i+1]=$q+this._indexDatas[$i+1],this._indexDatas[$i+2]=$q+this._indexDatas[$i+2];$V+=$u.length,this._vertexDatas.set($a,$O),$O+=$a.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$M=this._combineRenderElementPoolIndex=0,$R=this._materials.length;$M<$R;$M++){var $o=this._getCombineRenderElementFromPool($_,$S,$j);$o._type=2,$o._staticBatch=null;var $l=($o.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$M]]._tempBatchIndexStart,$k=$M+1===this._materialToRenderElementsOffsets.length?$V:this._combineRenderElements[this._materialToRenderElementsOffsets[$M+1]]._tempBatchIndexStart;$o._tempBatchIndexStart=$l,$o._tempBatchIndexEnd=$k,$o._material=this._materials[$M],this._merageElements.push($o)}},$_._addCombineRenderObjTest=function($_){var $S=$_.renderObj,$j=this._currentCombineIndexCount+$S._getIndexBuffer().indexCount,$O=this._currentCombineVertexCount+$S._getVertexBuffer().vertexCount;return!($z.maxVertexCount<$O||$z.maxIndexCount<$j)},$_._addCombineRenderObj=function($_){var $S=$_.renderObj;this._combineRenderElements.push($_),this._currentCombineIndexCount=this._currentCombineIndexCount+$S._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$S._getVertexBuffer().vertexCount},$_._addCombineMaterial=function($_){this._materials.push($_)},$_._addMaterialToRenderElementOffset=function($_){this._materialToRenderElementsOffsets.push($_)},$_._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$_._addToRenderQueue=function($_,$S,$j,$O){this._getRenderElement($S,$j,$O);for(var $V=0,$M=this._materials.length;$V<$M;$V++)$_.getRenderQueue(this._materials[$V].renderQueue)._addDynamicBatchElement(this._merageElements[$V])},$_._beforeRender=function($_){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$_._render=function($_){var $S=$_._batchIndexEnd-$_._batchIndexStart;$d.mainContext.drawElements(4,$S,5123,2*$_._batchIndexStart),$y.drawCall++,$y.trianglesFaces+=$S/3},$_._getVertexBuffers=function(){return null},$i(0,$_,"_vertexBufferCount",function(){return 1}),$i(0,$_,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$i(0,$_,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$z.maxVertexCount=2e4,$z.maxIndexCount=4e4,$z.maxCombineTriangleCount=10,$z}(),$S_=function(){function $z(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$C($z,"laya.d3.graphics.DynamicBatchManager");var $_=$z.prototype;return $_.getDynamicBatch=function($_,$S){var $j,$O=$_.id.toString()+$S;return this._dynamicBatches[$O]?$j=this._dynamicBatches[$O]:this._dynamicBatches[$O]=$j=new $__($_),$j},$_._garbageCollection=function(){for(var $_ in this._dynamicBatches)0===this._dynamicBatches[$_].combineRenderElementsCount&&delete this._dynamicBatches[$_]},$_._addPrepareRenderElement=function($_){this._prepareDynamicBatchCombineElements.push($_)},$_._finishCombineDynamicBatch=function($_){var $S,$j,$O;this._prepareDynamicBatchCombineElements.sort($z._sortPrepareDynamicBatch);for(var $V,$M,$R,$w,$a,$u=-1,$c=!0,$q=0,$s=-1,$C=0,$i=this._prepareDynamicBatchCombineElements.length;$C<$i;$C++){var $v=($M=this._prepareDynamicBatchCombineElements[$C]).renderObj._getVertexBuffer(0).vertexDeclaration,$Z=$j!==$v;$Z&&($q=0,$j=$v);var $o=$q!==$u;if($o&&($u=$q),($Z||$o)&&($R=this.getDynamicBatch($v,$q),$S=null),$c)if($R._addCombineRenderObjTest($M)){if($S!==($V=$M._material))$w&&($_.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$a=$w=null,$s=-1),$w=$V,$s=$R.combineRenderElementsCount,$a=$M,$S=$V;else if($w){var $l=$a.renderObj,$k=$M.renderObj;$l._getVertexBuffer().vertexCount+$k._getVertexBuffer().vertexCount>$__.maxVertexCount||$l._getIndexBuffer().indexCount+$k._getIndexBuffer().indexCount>$__.maxIndexCount?($_.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$w=$V,$s=$R.combineRenderElementsCount,$a=$M):($R._addCombineMaterial($w),$R._addMaterialToRenderElementOffset($s),$R._addCombineRenderObj($a),$a=$w=null,$s=-1,$R._addCombineRenderObj($M))}else $R._addCombineRenderObj($M);$c=!0}else $w&&($_.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$a=$w=null,$s=-1),$q++,$c=!1;else $O=this._prepareDynamicBatchCombineElements[$C-1],$R._addMaterialToRenderElementOffset($R.combineRenderElementsCount),$S=$O._material,$R._addCombineMaterial($S),$R._addCombineRenderObj($O),$c=!0,$S!==($V=$M._material)?($w=$V,$s=$R.combineRenderElementsCount,$a=$M):$R._addCombineRenderObj($M),$S=$V}$w&&($_.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$a=$w=null,$s=-1),this._prepareDynamicBatchCombineElements.length=0},$_._clearRenderElements=function(){for(var $_ in this._dynamicBatches)this._dynamicBatches[$_]._clearRenderElements()},$_._addToRenderQueue=function($_,$S,$j,$O){for(var $V in this._dynamicBatches){var $M=this._dynamicBatches[$V];0<$M.combineRenderElementsCount&&$M._addToRenderQueue($_,$S,$j,$O)}},$_.dispose=function(){this._dynamicBatches=null},$z._sortPrepareDynamicBatch=function($_,$S){return $_._mainSortID-$S._mainSortID},$z}(),$j_=function(){function $_(){}return $C($_,"laya.d3.graphics.FrustumCulling"),$_.renderShadowObjectCulling=function($_,$S,$j,$O,$V){var $M=0,$R=0,$w=0,$a=0;for($M=0,$w=$j.length;$M<$w;$M++){var $u=$j[$M];$u&&$u._clearRenderElements()}var $c,$q,$s,$C=$_._cullingRenders;if(1<$V){for($M=0,$w=$_._cullingRendersLength;$M<$w;$M++)if(($c=$C[$M]).castShadow&&$F.isVisible($c._owner.layer.mask)&&$c.enable)for(var $i=1,$v=$S.length;$i<$v;$i++)if($q=$j[$i-1],0!==$S[$i].containsBoundSphere($c.boundingSphere))for($R=0,$a=($s=$c._renderElements).length;$R<$a;$R++)$q._addRenderElement($s[$R])}else for($M=0,$w=$_._cullingRendersLength;$M<$w;$M++)if(($c=$C[$M]).castShadow&&$F.isVisible($c._owner.layer.mask)&&$c.enable&&0!==$S[0].containsBoundSphere($c.boundingSphere))for($c._renderUpdate($O),$q=$j[0],$R=0,$a=($s=$c._renderElements).length;$R<$a;$R++)$q._addRenderElement($s[$R])},$_.renderShadowObjectCullingOctree=function($_,$S,$j,$O,$V){for(var $M=0,$R=$j.length;$M<$R;$M++){var $w=$j[$M];$w&&$w._clearRenderElements()}1<$V?$_.treeRoot.cullingShadowObjects($S,$j,!0,0,$_):$_.treeRoot.cullingShadowObjectsOnePSSM($S[0],$j,$O,!0,0,$_)},$_.renderObjectCulling=function($_,$S,$j,$O,$V,$M){var $R=0,$w=0,$a=0,$u=0,$c=$S._quenes,$q=$S._dynamicBatchManager,$s=$S._cullingRenders;for($R=0,$w=$c.length;$R<$w;$R++){var $C=$c[$R];$C&&$C._clearRenderElements()}var $i=$O_._staticBatchManagers;for($R=0,$w=$i.length;$R<$w;$R++)$i[$R]._clearRenderElements();$q._clearRenderElements();var $v=$j.transform.position;for($R=0,$w=$S._cullingRendersLength;$R<$w;$R++){var $Z=$s[$R];if($F.isVisible($Z._owner.layer.mask)&&$Z.enable&&0!==$_.containsBoundSphere($Z.boundingSphere)&&$Z._renderUpdate($M)){$Z._distanceForSort=$RS.distance($Z.boundingSphere.center,$v)+$Z.sortingFudge;var $o=$Z._renderElements;for($a=0,$u=$o.length;$a<$u;$a++){var $l=$o[$a],$k=$l._staticBatch;if($k&&$k._material===$l._material)$k._addBatchRenderElement($l);else{var $z=$l.renderObj;$z.triangleCount<10&&1===$z._vertexBufferCount&&$z._getIndexBuffer()&&$l._material.renderQueue<2&&$l._canDynamicBatch&&!$Z._owner.isStatic?$q._addPrepareRenderElement($l):$S.getRenderQueue($l._material.renderQueue)._addRenderElement($l)}}}}for($R=0,$w=$i.length;$R<$w;$R++)$i[$R]._addToRenderQueue($S,$O,$V,$M);$q._finishCombineDynamicBatch($S),$q._addToRenderQueue($S,$O,$V,$M)},$_.renderObjectCullingOctree=function($_,$S,$j,$O,$V,$M){var $R=0,$w=0,$a=$S._quenes,$u=$S._dynamicBatchManager;for($R=0,$w=$a.length;$R<$w;$R++){var $c=$a[$R];$c&&$c._clearRenderElements()}var $q=$O_._staticBatchManagers;for($R=0,$w=$q.length;$R<$w;$R++)$q[$R]._clearRenderElements();for($u._clearRenderElements(),$S._cullingRenders.length=0,$S.treeRoot.cullingObjects($_,!0,0,$j.transform.position,$M),$R=0,$w=$q.length;$R<$w;$R++)$q[$R]._addToRenderQueue($S,$O,$V,$M);$u._finishCombineDynamicBatch($S),$u._addToRenderQueue($S,$O,$V,$M)},$_.renderObjectCullingNoBoundFrustum=function($_,$S,$j,$O,$V){var $M=0,$R=0,$w=0,$a=0,$u=$_._quenes,$c=$_._dynamicBatchManager,$q=$_._cullingRenders;for($M=0,$R=$u.length;$M<$R;$M++){var $s=$u[$M];$s&&$s._clearRenderElements()}var $C=$O_._staticBatchManagers;for($M=0,$R=$C.length;$M<$R;$M++)$C[$M]._clearRenderElements();$c._clearRenderElements();var $i=$S.transform.position;for($M=0,$R=$_._cullingRendersLength;$M<$R;$M++){var $v=$q[$M];if($F.isVisible($v._owner.layer.mask)&&$v.enable){$v._renderUpdate($V),$v._distanceForSort=$RS.distance($v.boundingSphere.center,$i)+$v.sortingFudge;var $Z=$v._renderElements;for($w=0,$a=$Z.length;$w<$a;$w++){var $o=$Z[$w],$l=$o._staticBatch;if($l&&$l._material===$o._material)$l._addBatchRenderElement($o);else{var $k=$o.renderObj;$k.triangleCount<10&&1===$k._vertexBufferCount&&$k._getIndexBuffer()&&$o._material.renderQueue<2&&$o._canDynamicBatch&&!$v._owner.isStatic?$c._addPrepareRenderElement($o):$_.getRenderQueue($o._material.renderQueue)._addRenderElement($o)}}}}for($M=0,$R=$C.length;$M<$R;$M++)$C[$M]._addToRenderQueue($_,$j,$O,$V);$c._finishCombineDynamicBatch($_),$c._addToRenderQueue($_,$j,$O,$V)},$_}(),$O_=function(){function $M(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$C($M,"laya.d3.graphics.StaticBatchManager");var $_=$M.prototype;return $_._finishInit=function(){for(var $_ in this._staticBatches)this._staticBatches[$_]._finishInit();this._initBatchRenderElements.length=0},$_._initStaticBatchs=function($_){throw new Error("StaticBatchManager:must override this function.")},$_._addInitBatchSprite=function($_){for(var $S=$_._render._renderElements,$j=0,$O=$S.length;$j<$O;$j++)this._initBatchRenderElements.push($S[$j])},$_._clearRenderElements=function(){for(var $_ in this._staticBatches)this._staticBatches[$_]._clearRenderElements()},$_._garbageCollection=function($_){var $S=$_._staticBatch,$j=$S._initBatchRenderElements,$O=$j.indexOf($_);$j.splice($O,1),0===$j.length&&($S.dispose(),delete this._staticBatches[$S._key])},$_._addToRenderQueue=function($_,$S,$j,$O){for(var $V in this._staticBatches){var $M=this._staticBatches[$V];0<$M._batchRenderElements.length&&$M._updateToRenderQueue($_,$O)}},$_.dispose=function(){this._staticBatches=null},$M._addToStaticBatchQueue=function($_){$_ instanceof laya.d3.core.RenderableSprite3D&&$_._addToInitStaticBatchManager();for(var $S=0,$j=$_.numChildren;$S<$j;$S++)$M._addToStaticBatchQueue($_._childs[$S])},$M.combine=function($_,$S){var $j,$O=0,$V=0;if($S)for($O=0,$V=$S.length;$O<$V;$O++){$S[$O]._addToInitStaticBatchManager()}else $_&&$M._addToStaticBatchQueue($_);for($O=0,$V=$M._staticBatchManagers.length;$O<$V;$O++)($j=$M._staticBatchManagers[$O])._initStaticBatchs($_),$j._finishInit()},$M._staticBatchManagers=[],$M}(),$V_=function(){function $_($_,$S,$j){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$_,this._manager=$S,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$j}$C($_,"laya.d3.graphics.StaticBatch");var $S=$_.prototype;return $H.imps($S,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$S._binarySearch=function($_){for(var $S=0,$j=this._batchRenderElements.length-1,$O=0;$S<=$j;)$O=Math.floor(($S+$j)/2),this._compareBatchRenderElement(this._batchRenderElements[$O],$_)?$j=$O-1:$S=$O+1;return $S},$S._compareBatchRenderElement=function($_,$S){throw new Error("StaticBatch:must override this function.")},$S._getVertexDecLightMap=function($_){return $_===$t_.vertexDeclaration?$F_.vertexDeclaration:$_===$B_.vertexDeclaration?$J_.vertexDeclaration:$_===$P_.vertexDeclaration?$z_.vertexDeclaration:$_===$D_.vertexDeclaration?null:$_===$v_.vertexDeclaration?$Z_.vertexDeclaration:$_===$e_.vertexDeclaration?$h_.vertexDeclaration:$_===$d_.vertexDeclaration?$n_.vertexDeclaration:$_===$m_.vertexDeclaration?$x_.vertexDeclaration:$_===$B_.vertexDeclaration?$J_.vertexDeclaration:$_===$g_.vertexDeclaration?$H_.vertexDeclaration:$_===$D_.vertexDeclaration?null:$_===$v_.vertexDeclaration?$Z_.vertexDeclaration:$_===$G_.vertexDeclaration?$N_.vertexDeclaration:$_===$d_.vertexDeclaration?$n_.vertexDeclaration:$_},$S._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$S._addBatchRenderElement=function($_){this._batchRenderElements.splice(this._binarySearch($_),0,$_)},$S._updateToRenderQueue=function($_,$S){this._combineRenderElementPoolIndex=0,this._getRenderElement($_.getRenderQueue(this._material.renderQueue)._renderElements,$_,$S)},$S._getRenderElement=function($_,$S,$j){throw new Error("StaticBatch:must override this function.")},$S._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$S._clearRenderElements=function(){this._batchRenderElements.length=0},$S.dispose=function(){},$S._getVertexBuffer=function($_){return void 0===$_&&($_=0),null},$S._getIndexBuffer=function(){return null},$S._beforeRender=function($_){return!0},$S._render=function($_){},$S._getVertexBuffers=function(){return null},$i(0,$S,"_vertexBufferCount",function(){return 1}),$i(0,$S,"triangleCount",function(){return 0}),$_.combine=function($_){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$O_.combine($_)},$_.maxBatchVertexCount=65535,$_}(),$M_=function(){function $R($_,$S){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$R._uniqueIDCounter,this._id>$R.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$R.maxVertexDeclaration);this._shaderValues=new $sS,this._vertexElementsDic={},this._vertexStride=$_,this._vertexElements=$S;for(var $j=0;$j<$S.length;$j++){var $O=$S[$j],$V=$O.elementUsage;this._vertexElementsDic[$V]=$O;var $M=[$R._getTypeSize($O.elementFormat)/4,5126,!1,this._vertexStride,$O.offset];switch(this._shaderValues.setValue($V,$M),$V){case 1:this._addShaderDefine($yS.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($yS.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($yS.SHADERDEFINE_UV1)}}}$C($R,"laya.d3.graphics.VertexDeclaration");var $_=$R.prototype;return $_._addShaderDefine=function($_){this._shaderDefineValue|=$_},$_._removeShaderDefine=function($_){this._shaderDefineValue&=~$_},$_.getVertexElements=function(){return this._vertexElements.slice()},$_.getVertexElementByUsage=function($_){return this._vertexElementsDic[$_]},$_.unBinding=function(){},$i(0,$_,"shaderDefineValue",function(){return this._shaderDefineValue}),$i(0,$_,"id",function(){return this._id}),$i(0,$_,"vertexStride",function(){return this._vertexStride}),$i(0,$_,"shaderValues",function(){return this._shaderValues}),$R._getTypeSize=function($_){switch($_){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$R.getVertexStride=function($_){for(var $S=0,$j=0;$j<$_.Length;$j++){var $O=$_[$j],$V=$O.offset+$R._getTypeSize($O.elementFormat);$S<$V&&($S=$V)}return $S},$R._maxVertexDeclarationBit=1e3,$R._uniqueIDCounter=1,$q($R,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$R}(),$R_=function(){function $_($_,$S,$j){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$_,this.elementFormat=$S,this.elementUsage=$j}return $C($_,"laya.d3.graphics.VertexElement"),$_}(),$w_=(function(){function $_(){}$C($_,"laya.d3.graphics.VertexElementFormat"),$_.Single="single",$_.Vector2="vector2",$_.Vector3="vector3",$_.Vector4="vector4",$_.Color="color",$_.Byte4="byte4",$_.Short2="short2",$_.Short4="short4",$_.NormalizedShort2="normalizedshort2",$_.NormalizedShort4="normalizedshort4",$_.HalfVector2="halfvector2",$_.HalfVector4="halfvector4"}(),function(){function $_(){}$C($_,"laya.d3.graphics.VertexElementUsage"),$_.POSITION0=0,$_.COLOR0=1,$_.TEXTURECOORDINATE0=2,$_.NORMAL0=3,$_.BINORMAL0=4,$_.TANGENT0=5,$_.BLENDINDICES0=6,$_.BLENDWEIGHT0=7,$_.DEPTH0=8,$_.FOG0=9,$_.POINTSIZE0=10,$_.SAMPLE0=11,$_.TESSELLATEFACTOR0=12,$_.COLOR1=13,$_.NEXTTEXTURECOORDINATE0=14,$_.TEXTURECOORDINATE1=15,$_.NEXTTEXTURECOORDINATE1=16,$_.CORNERTEXTURECOORDINATE0=17,$_.VELOCITY0=18,$_.STARTCOLOR0=19,$_.STARTSIZE=20,$_.AGEADDSCALE0=21,$_.STARTROTATION=22,$_.ENDCOLOR0=23,$_.STARTLIFETIME=24,$_.TIME0=33,$_.SHAPEPOSITIONSTARTLIFETIME=30,$_.DIRECTIONTIME=32,$_.SIZEROTATION0=27,$_.RADIUS0=28,$_.RADIAN0=29,$_.STARTSPEED=31,$_.RANDOM0=34,$_.RANDOM1=35,$_.SIMULATIONWORLDPOSTION=36,$_.SIMULATIONWORLDROTATION=37,$_.TEXTURECOORDINATE0X=38,$_.TEXTURECOORDINATE0X1=39,$_.TEXTURECOORDINATE0Y=40,$_.OFFSETVECTOR=41}(),function(){function $_($_,$S,$j){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$_,this._textureCoordinate0=$S,this._time=$j}$C($_,"laya.d3.graphics.VertexGlitter");var $S=$_.prototype;$H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate0}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"time",function(){return this._time}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(24,[new $R_(0,"vector3",0),new $R_(12,"vector2",2),new $R_(20,"single",33)])}])}(),function(){function $_($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$_,this._position=$S,this._velocity=$j,this._startColor=$O,this._endColor=$V,this._sizeRotation=$M,this._radius=$R,this._radian=$w,this._ageAddScale=$a,this._time=$u}$C($_,"laya.d3.graphics.VertexParticle");var $S=$_.prototype;$H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"endColor",function(){return this._endColor}),$i(0,$S,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$i(0,$S,"sizeRotation",function(){return this._sizeRotation}),$i(0,$S,"velocity",function(){return this._velocity}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"startColor",function(){return this._startColor}),$i(0,$S,"radius",function(){return this._radius}),$i(0,$S,"radian",function(){return this._radian}),$i(0,$S,"ageAddScale",function(){return this._ageAddScale}),$i(0,$S,"time",function(){return this._time}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(116,[new $R_(0,"vector4",17),new $R_(16,"vector3",0),new $R_(28,"vector3",18),new $R_(40,"vector4",19),new $R_(56,"vector4",23),new $R_(72,"vector3",27),new $R_(84,"vector2",28),new $R_(92,"vector4",29),new $R_(108,"single",24),new $R_(112,"single",33)])}])}(),function(){function $_($_){this._position=null,this._position=$_}$C($_,"laya.d3.graphics.VertexPosition");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(12,[new $R_(0,"vector3",0)])}]),$_}()),$a_=function(){function $_($_,$S){this._position=null,this._normal=null,this._position=$_,this._normal=$S}$C($_,"laya.d3.graphics.VertexPositionNormal");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(24,[new $R_(0,"vector3",0),new $R_(12,"vector3",3)])}]),$_}(),$u_=function(){function $_($_,$S,$j){this._position=null,this._normal=null,this._color=null,this._position=$_,this._normal=$S,this._color=$j}$C($_,"laya.d3.graphics.VertexPositionNormalColor");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(40,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1)])}]),$_}(),$c_=function(){function $_($_,$S,$j,$O,$V){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$_,this._normal=$S,this._color=$j,this._blendIndex=$O,this._blendWeight=$V}$C($_,"laya.d3.graphics.VertexPositionNormalColorSkin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(72,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector4",7),new $R_(56,"vector4",6)])}]),$_}(),$q_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._tangent=$O,this._blendIndex=$V,this._blendWeight=$M}$C($_,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(88,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector4",7),new $R_(56,"vector4",6),new $R_(72,"vector4",5)])}]),$_}(),$s_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._tangent=$O,this._blendIndex=$V,this._blendWeight=$M}$C($_,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(84,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector4",7),new $R_(56,"vector4",6),new $R_(72,"vector3",5)])}]),$_}(),$C_=function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._tangent=$O}$C($_,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(56,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector4",5)])}]),$_}(),$i_=function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._tangent=$O}$C($_,"laya.d3.graphics.VertexPositionNormalColorTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(52,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector3",5)])}]),$_}(),$v_=function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate=$O}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(48,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2)])}]),$_}(),$Z_=function(){function $_($_,$S,$j,$O,$V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate0=$O,this._textureCoordinate1=$V}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(56,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector2",15)])}]),$_}(),$o_=function(){function $_($_,$S,$j,$O,$V,$M,$R){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate0=$O,this._textureCoordinate1=$V,this._blendIndex=$M,this._blendWeight=$R}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(88,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector2",15),new $R_(56,"vector4",7),new $R_(72,"vector4",6)])}]),$_}(),$l_=function(){function $_($_,$S,$j,$O,$V,$M,$R,$w){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate0=$O,this._textureCoordinate1=$V,this._tangent=$M,this._blendIndex=$R,this._blendWeight=$w}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(104,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector2",15),new $R_(56,"vector4",7),new $R_(72,"vector4",6),new $R_(88,"vector4",5)])}]),$_}(),$k_=function(){function $_(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$S.VertexPositionNormalColorTexture0SkinTangent=function($_,$S,$j,$O,$V,$M,$R,$w){this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate0=$O,this._textureCoordinate1=$V,this._tangent=$M,this._blendIndex=$R,this._blendWeight=$w},$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(100,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector2",15),new $R_(56,"vector4",7),new $R_(72,"vector4",6),new $R_(88,"vector3",5)])}]),$_}(),$z_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate0=$O,this._textureCoordinate1=$V,this._tangent=$M}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(72,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector2",15),new $R_(56,"vector4",5)])}]),$_}(),$H_=function(){function $_(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$C($_,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$S.VertexPositionNormalColorTexture0Tangent=function($_,$S,$j,$O,$V,$M){this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate0=$O,this._textureCoordinate1=$V,this._tangent=$M},$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(68,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector2",15),new $R_(56,"vector3",5)])}]),$_}(),$A_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate=$O,this._blendIndex=$V,this._blendWeight=$M}$C($_,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(80,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector4",7),new $R_(64,"vector4",6)])}]),$_}(),$f_=function(){function $_($_,$S,$j,$O,$V,$M,$R){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate=$O,this._tangent=$V,this._blendIndex=$M,this._blendWeight=$R}$C($_,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(96,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector4",7),new $R_(64,"vector4",6),new $R_(80,"vector4",5)])}]),$_}(),$y_=function(){function $_($_,$S,$j,$O,$V,$M,$R){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate=$O,this._tangent=$V,this._blendIndex=$M,this._blendWeight=$R}$C($_,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(92,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector4",7),new $R_(64,"vector4",6),new $R_(80,"vector3",5)])}]),$_}(),$P_=function(){function $_($_,$S,$j,$O,$V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate=$O,this._tangent=$V}$C($_,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(64,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector4",5)])}]),$_}(),$g_=function(){function $_($_,$S,$j,$O,$V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$_,this._normal=$S,this._color=$j,this._textureCoordinate=$O,this._tangent=$V}$C($_,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"color",function(){return this._color}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(60,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",1),new $R_(40,"vector2",2),new $R_(48,"vector3",5)])}]),$_}(),$E_=function(){function $_($_,$S,$j){this._position=null,this._normal=null,this._tangent=null,this._position=$_,this._normal=$S,this._tangent=$j}$C($_,"laya.d3.graphics.VertexPositionNormalSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(40,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector4",5)])}]),$_}(),$$_=function(){function $_($_,$S,$j){this._position=null,this._normal=null,this._tangent=null,this._position=$_,this._normal=$S,this._tangent=$j}$C($_,"laya.d3.graphics.VertexPositionNormalTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(36,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector3",5)])}]),$_}(),$d_=function(){function $_($_,$S,$j){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j}$C($_,"laya.d3.graphics.VertexPositionNormalTexture");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(32,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2)])}]),$_}(),$n_=function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$_,this._normal=$S,this._textureCoordinate0=$j,this._textureCoordinate1=$O}$C($_,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(40,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15)])}]),$_}(),$J_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$_,this._normal=$S,this._textureCoordinate0=$j,this._textureCoordinate1=$O,this._blendIndex=$V,this._blendWeight=$M}$C($_,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(72,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15),new $R_(40,"vector4",7),new $R_(56,"vector4",6)])}]),$_}(),$F_=function(){function $_($_,$S,$j,$O,$V,$M,$R){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._textureCoordinate0=$j,this._textureCoordinate1=$O,this._tangent=$V,this._blendIndex=$M,this._blendWeight=$R}$C($_,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(88,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15),new $R_(40,"vector4",7),new $R_(56,"vector4",6),new $R_(72,"vector4",5)])}]),$_}(),$x_=function(){function $_(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$C($_,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$S.VertexPositionNormalTexture0SkinTangent=function($_,$S,$j,$O,$V,$M,$R){this._position=$_,this._normal=$S,this._textureCoordinate0=$j,this._textureCoordinate1=$O,this._tangent=$V,this._blendIndex=$M,this._blendWeight=$R},$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(84,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15),new $R_(40,"vector4",7),new $R_(56,"vector4",6),new $R_(72,"vector3",5)])}]),$_}(),$h_=function(){function $_($_,$S,$j,$O,$V){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$_,this._normal=$S,this._textureCoordinate0=$j,this._textureCoordinate1=$O,this._tangent=$V}$C($_,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(56,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15),new $R_(40,"vector4",5)])}]),$_}(),$N_=function(){function $_(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$C($_,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$S.VertexPositionNormalTexture0Tangent=function($_,$S,$j,$O,$V){this._position=$_,this._normal=$S,this._textureCoordinate0=$j,this._textureCoordinate1=$O,this._tangent=$V},$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(52,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15),new $R_(40,"vector3",5)])}]),$_}(),$B_=function(){function $_($_,$S,$j,$O,$V){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j,this._blendIndex=$O,this._blendWeight=$V}$C($_,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(64,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector4",7),new $R_(48,"vector4",6)])}]),$_}(),$t_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j,this._tangent=$O,this._blendIndex=$V,this._blendWeight=$M}$C($_,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(80,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector4",7),new $R_(48,"vector4",6),new $R_(64,"vector4",5)])}]),$_}(),$m_=function(){function $_($_,$S,$j,$O,$V,$M){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j,this._tangent=$O,this._blendIndex=$V,this._blendWeight=$M}$C($_,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(76,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector4",7),new $R_(48,"vector4",6),new $R_(64,"vector3",5)])}]),$_}(),$e_=function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j,this._tangent=$O}$C($_,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(48,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector4",5)])}]),$_}(),$G_=function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j,this._tangent=$O}$C($_,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(44,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector3",5)])}]),$_}(),$D_=function(){function $_($_,$S,$j){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j}$C($_,"laya.d3.graphics.VertexPositionNTBTexture");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(56,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector3",5),new $R_(36,"vector3",4),new $R_(48,"vector2",2)])}]),$_}(),$L_=function(){function $_($_,$S,$j,$O,$V,$M,$R,$w){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$_,this._normal=$S,this._textureCoordinate0=$O,this._textureCoordinate1=$V,this._tangent=$M,$j=$j,this._blendIndex=$R,this._blendWeight=$w}$C($_,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"tangent",function(){return this._tangent}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(0,$S,"textureCoordinate1",function(){return this._textureCoordinate1}),$i(0,$S,"blendIndex",function(){return this._blendIndex}),$i(0,$S,"blendWeight",function(){return this._blendWeight}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(96,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector3",5),new $R_(36,"vector3",4),new $R_(48,"vector2",2),new $R_(56,"vector2",15),new $R_(64,"vector4",7),new $R_(80,"vector4",6)])}]),$_}(),$U_=function(){function $_($_,$S,$j){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$_,this._normal=$S,this._textureCoordinate=$j}$C($_,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"textureCoordinate",function(){return this._textureCoordinate}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(88,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector3",5),new $R_(36,"vector3",4),new $R_(48,"vector2",2),new $R_(56,"vector4",7),new $R_(72,"vector4",6)])}]),$_}(),$Q_=(function(){function $_($_,$S,$j,$O){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$_,this._normal=$S,this._textureCoord0=$j,this._textureCoord1=$O}$C($_,"laya.d3.graphics.VertexPositionTerrain");var $S=$_.prototype;$H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"normal",function(){return this._normal}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoord0",function(){return this._textureCoord0}),$i(0,$S,"textureCoord1",function(){return this._textureCoord1}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(40,[new $R_(0,"vector3",0),new $R_(12,"vector3",3),new $R_(24,"vector2",2),new $R_(32,"vector2",15)])}])}(),function(){function $_($_,$S){this._position=null,this._textureCoordinate0=null,this._position=$_,this._textureCoordinate0=$S}$C($_,"laya.d3.graphics.VertexPositionTexture0");var $S=$_.prototype;return $H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"position",function(){return this._position}),$i(0,$S,"textureCoordinate0",function(){return this._textureCoordinate0}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(20,[new $R_(0,"vector3",0),new $R_(12,"vector2",2)])}]),$_}()),$Y_=(function(){function $_($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q,$s,$C){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$_,this._positionStartLifeTime=$S,this._velocity=$j,this._startColor=$O,this._startSize=$V,this._startRotation0=$M,this._startRotation1=$R,this._startRotation2=$w,this._startLifeTime=$a,this._time=$u,this._startSpeed=$c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$C}$C($_,"laya.d3.graphics.VertexShurikenParticleBillboard");var $S=$_.prototype;$H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$i(0,$S,"random1",function(){return this._randoms1}),$i(0,$S,"startRotation2",function(){return this._startRotation2}),$i(0,$S,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$i(0,$S,"velocity",function(){return this._velocity}),$i(0,$S,"random0",function(){return this._randoms0}),$i(0,$S,"startSize",function(){return this._startSize}),$i(0,$S,"startColor",function(){return this._startColor}),$i(0,$S,"startRotation0",function(){return this._startRotation0}),$i(0,$S,"startRotation1",function(){return this._startRotation1}),$i(0,$S,"startLifeTime",function(){return this._startLifeTime}),$i(0,$S,"time",function(){return this._time}),$i(0,$S,"startSpeed",function(){return this._startSpeed}),$i(0,$S,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(152,[new $R_(0,"vector4",17),new $R_(16,"vector4",30),new $R_(32,"vector4",32),new $R_(48,"vector4",19),new $R_(64,"vector3",20),new $R_(76,"vector3",22),new $R_(88,"single",31),new $R_(92,"vector4",34),new $R_(108,"vector4",35),new $R_(124,"vector3",36),new $R_(136,"vector4",37)])}])}(),function(){function $_($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q,$s,$C){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$_,this._positionStartLifeTime=$S,this._velocity=$j,this._startColor=$O,this._startSize=$V,this._startRotation0=$M,this._startRotation1=$R,this._startRotation2=$w,this._startLifeTime=$a,this._time=$u,this._startSpeed=$c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$C}$C($_,"laya.d3.graphics.VertexShurikenParticleMesh");var $S=$_.prototype;$H.imps($S,{"laya.d3.graphics.IVertex":!0}),$i(0,$S,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$i(0,$S,"velocity",function(){return this._velocity}),$i(0,$S,"position",function(){return this._positionStartLifeTime}),$i(0,$S,"random0",function(){return this._randoms0}),$i(0,$S,"startSize",function(){return this._startSize}),$i(0,$S,"startColor",function(){return this._startColor}),$i(0,$S,"startRotation0",function(){return this._startRotation0}),$i(0,$S,"startRotation1",function(){return this._startRotation1}),$i(0,$S,"random1",function(){return this._randoms1}),$i(0,$S,"startRotation2",function(){return this._startRotation2}),$i(0,$S,"startLifeTime",function(){return this._startLifeTime}),$i(0,$S,"time",function(){return this._time}),$i(0,$S,"startSpeed",function(){return this._startSpeed}),$i(0,$S,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$i(0,$S,"vertexDeclaration",function(){return $_._vertexDeclaration}),$i(1,$_,"vertexDeclaration",function(){return $_._vertexDeclaration}),$q($_,["_vertexDeclaration",function(){return this._vertexDeclaration=new $M_(172,[new $R_(0,"vector3",0),new $R_(12,"vector4",1),new $R_(28,"vector2",2),new $R_(36,"vector4",30),new $R_(52,"vector4",32),new $R_(68,"vector4",19),new $R_(84,"vector3",20),new $R_(96,"vector3",22),new $R_(108,"single",31),new $R_(112,"vector4",34),new $R_(128,"vector4",35),new $R_(144,"vector3",36),new $R_(156,"vector4",37)])}])}(),function(){function $k($_,$S,$j,$O,$V,$M){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$j,this._materials=$O,this._subMeshes=$V,this._materialMap=$M,this._version=$S,this._onLoaded($_)}$C($k,"laya.d3.loaders.LoadModelV01");var $_=$k.prototype;return $_._onLoaded=function($_){this._readData=$_,this.READ_BLOCK();for(var $S=0;$S<this._BLOCK.count;$S++){var $j=this._readData.getUint16(),$O=this._strings[$j],$V=this["READ_"+$O];if(null==$V)throw new Error("model file err,no this function:"+$j+" "+$O);if(!$V.call(this))break}return this._mesh},$_.onError=function(){},$_._readString=function(){return this._strings[this._readData.getUint16()]},$_.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$_.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$_.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $_=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $S=0;$S<this._STRINGS.size;$S++)this._strings[$S]=this._readData.readUTFString();return this._readData.pos=$_,!0},$_.READ_MATERIAL=function(){var $_=this._readData.getUint16(),$S=(this._readString(),this._readString());return this._materials[$_]="null"!==$S?$o.getRes(this._materialMap[$S]):new $$S,!0},$_.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $_,$S=this._readData.__getBuffer(),$j=0,$O=this._readData.getUint32(),$V=this._readData.getUint32(),$M=(new Float32Array($S.slice($O+this._DATA.offset,$O+this._DATA.offset+$V)),this._readData.getUint32()),$R=this._readData.getUint32(),$w=new Float32Array($S.slice($M+this._DATA.offset,$M+this._DATA.offset+$R));for(this.mesh._inverseBindPoses=[],$j=0,$_=$w.length;$j<$_;$j+=16){var $a=new $_S($w[$j+0],$w[$j+1],$w[$j+2],$w[$j+3],$w[$j+4],$w[$j+5],$w[$j+6],$w[$j+7],$w[$j+8],$w[$j+9],$w[$j+10],$w[$j+11],$w[$j+12],$w[$j+13],$w[$j+14],$w[$j+15]);this.mesh._inverseBindPoses.push($a)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$_.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $_=this._readString();this._shaderAttributes=$_.match($k._attrReg);var $S=this._readData.getUint32(),$j=this._readData.getUint32(),$O=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$V=this._readData.getUint32(),$M=this._readData.getUint32(),$R=this._readData.getUint32(),$w=this._readData.__getBuffer(),$a=new $uS(this._mesh),$u=this._getVertexDeclaration(),$c=$mS.create($u,$V/$u.vertexStride,35044,!0),$q=$O+this._DATA.offset,$s=$w.slice($q,$q+$V);$c.setData(new Float32Array($s));for(var $C=($a._vertexBuffer=$c).vertexDeclaration.getVertexElements(),$i=0;$i<$C.length;$i++)$a._bufferUsage[$C[$i].elementUsage]=$c;var $v=$tS.create("ushort",$j/2,35044,!0),$Z=$S+this._DATA.offset,$o=$w.slice($Z,$Z+$j);$v.setData(new Uint16Array($o)),$a._indexBuffer=$v;var $l=$w.slice($M+this._DATA.offset,$M+this._DATA.offset+$R);return $a._boneIndicesList[0]=new Uint8Array($l),this._subMeshes.push($a),!0},$_.READ_DATAAREA=function(){return!1},$_._getVertexDeclaration=function(){for(var $_,$S=!1,$j=!1,$O=!1,$V=!1,$M=!1,$R=!1,$w=!1,$a=!1,$u=!1,$c=0;$c<this._shaderAttributes.length;$c+=8)switch(this._shaderAttributes[$c]){case"POSITION":$S=!0;break;case"NORMAL":$j=!0;break;case"COLOR":$O=!0;break;case"UV":$V=!0;break;case"UV1":$M=!0;break;case"BLENDWEIGHT":$w=!0;break;case"BLENDINDICES":$a=!0;break;case"TANGENT":$R=!0;break;case"BINORMAL":$u=!0}return $S&&$j&&$O&&$V&&$M&&$w&&$a&&$R?$_=$k_.vertexDeclaration:$S&&$j&&$O&&$V&&$M&&$w&&$a?$_=$o_.vertexDeclaration:$S&&$j&&$V&&$M&&$w&&$a&&$R?$_=$x_.vertexDeclaration:$S&&$j&&$V&&$M&&$w&&$a?$_=$J_.vertexDeclaration:$S&&$j&&$O&&$V&&$w&&$a&&$R?$_=$y_.vertexDeclaration:$S&&$j&&$O&&$V&&$w&&$a?$_=$A_.vertexDeclaration:$S&&$j&&$R&&$u&&$V&&$w&&$a?$_=$U_.vertexDeclaration:$S&&$j&&$V&&$w&&$a&&$R?$_=$m_.vertexDeclaration:$S&&$j&&$V&&$w&&$a?$_=$B_.vertexDeclaration:$S&&$j&&$O&&$w&&$a&&$R?$_=$s_.vertexDeclaration:$S&&$j&&$O&&$w&&$a?$_=$c_.vertexDeclaration:$S&&$j&&$O&&$V&&$M&&$R?$_=$H_.vertexDeclaration:$S&&$j&&$O&&$V&&$M?$_=$Z_.vertexDeclaration:$S&&$j&&$V&&$M&&$R?$_=$N_.vertexDeclaration:$S&&$j&&$V&&$M?$_=$n_.vertexDeclaration:$S&&$j&&$O&&$V&&$R?$_=$g_.vertexDeclaration:$S&&$j&&$V&&$R&&$u?$_=$D_.vertexDeclaration:$S&&$j&&$O&&$V?$_=$v_.vertexDeclaration:$S&&$j&&$V&&$R?$_=$G_.vertexDeclaration:$S&&$j&&$V?$_=$d_.vertexDeclaration:$S&&$j&&$O&&$R?$_=$i_.vertexDeclaration:$S&&$j&&$O&&($_=$u_.vertexDeclaration),$_},$i(0,$_,"mesh",function(){return this._mesh}),$k._attrReg=new RegExp("(\\w+)|([:,;])","g"),$k}()),$T_=function(){function $f(){}return $C($f,"laya.d3.loaders.LoadModelV02"),$f.parse=function($_,$S,$j,$O,$V,$M){$f._mesh=$j,$f._materials=$O,$f._subMeshes=$V,$f._materialMap=$M,$f._version=$S,$f._readData=$_,$f.READ_DATA(),$f.READ_BLOCK(),$f.READ_STRINGS();for(var $R=0,$w=$f._BLOCK.count;$R<$w;$R++){$f._readData.pos=$f._BLOCK.blockStarts[$R];var $a=$f._readData.getUint16(),$u=$f._strings[$a],$c=$f["READ_"+$u];if(null==$c)throw new Error("model file err,no this function:"+$a+" "+$u);$c.call()}$f._strings.length=0,$f._readData=null,$f._version=null,$f._mesh=null,$f._materials=null,$f._subMeshes=null,$f._materialMap=null},$f._readString=function(){return $f._strings[$f._readData.getUint16()]},$f.READ_DATA=function(){$f._DATA.offset=$f._readData.getUint32(),$f._DATA.size=$f._readData.getUint32()},$f.READ_BLOCK=function(){for(var $_=$f._BLOCK.count=$f._readData.getUint16(),$S=$f._BLOCK.blockStarts=[],$j=$f._BLOCK.blockLengths=[],$O=0;$O<$_;$O++)$S.push($f._readData.getUint32()),$j.push($f._readData.getUint32())},$f.READ_STRINGS=function(){var $_=$f._readData.getUint32(),$S=$f._readData.getUint16(),$j=$f._readData.pos;$f._readData.pos=$_+$f._DATA.offset;for(var $O=0;$O<$S;$O++)$f._strings[$O]=$f._readData.readUTFString();$f._readData.pos=$j},$f.READ_MATERIAL=function(){$f._readString(),$f._readString();var $_=$f._readString();return""!==$_&&$f._materials.push($o.getRes($f._materialMap[$_])),!0},$f.READ_MESH=function(){$f._readString();var $_,$S=$f._readData.__getBuffer(),$j=0,$O=$f._readData.getInt16(),$V=$f._DATA.offset;for($j=0;$j<$O;$j++){var $M=$V+$f._readData.getUint32(),$R=$f._readData.getUint32(),$w=new Float32Array($S.slice($M,$M+$R)),$a=$f._readString().match($f._attrReg),$u=$f._getVertexDeclaration($a),$c=$mS.create($u,4*$w.length/$u.vertexStride,35044,!0);$c.setData($w),$f._mesh._vertexBuffers.push($c)}var $q=$V+$f._readData.getUint32(),$s=$f._readData.getUint32(),$C=new Uint16Array($S.slice($q,$q+$s)),$i=$tS.create("ushort",$s/2,35044,!0);$i.setData($C),$f._mesh._indexBuffer=$i;var $v=$f._mesh._boneNames=[],$Z=$f._readData.getUint16();for($v.length=$Z,$j=0;$j<$Z;$j++)$v[$j]=$f._strings[$f._readData.getUint16()];var $o=$f._readData.getUint32(),$l=$f._readData.getUint32(),$k=(new Float32Array($S.slice($V+$o,$V+$o+$l)),$f._readData.getUint32()),$z=$f._readData.getUint32(),$H=new Float32Array($S.slice($V+$k,$V+$k+$z));for($f._mesh._inverseBindPoses=[],$j=0,$_=$H.length;$j<$_;$j+=16){var $A=new $_S($H[$j+0],$H[$j+1],$H[$j+2],$H[$j+3],$H[$j+4],$H[$j+5],$H[$j+6],$H[$j+7],$H[$j+8],$H[$j+9],$H[$j+10],$H[$j+11],$H[$j+12],$H[$j+13],$H[$j+14],$H[$j+15]);$f._mesh._inverseBindPoses.push($A)}return $f._mesh._skinnedDatas=new Float32Array(16*$H.length),!0},$f.READ_SUBMESH=function(){var $_=$f._readData.__getBuffer(),$S=new $uS($f._mesh),$j=$f._readData.getInt16(),$O=$f._readData.getUint32(),$V=$f._readData.getUint32();$S._vertexBuffer=$f._mesh._vertexBuffers[$j],$S._vertexStart=$O,$S._vertexCount=$V;var $M=$f._readData.getUint32(),$R=$f._readData.getUint32(),$w=$f._mesh._indexBuffer;$S._indexBuffer=$w,$S._indexStart=$M,$S._indexCount=$R,$S._indices=new Uint16Array($w.getData().buffer,2*$M,$R);var $a=$f._DATA.offset,$u=$S._subIndexBufferStart,$c=$S._subIndexBufferCount,$q=$S._boneIndicesList,$s=$f._readData.getUint16();$u.length=$s,$c.length=$s,$q.length=$s;for(var $C=0;$C<$s;$C++){$u[$C]=$f._readData.getUint32(),$c[$C]=$f._readData.getUint32();var $i=$f._readData.getUint32(),$v=$f._readData.getUint32();$S._boneIndicesList[$C]=new Uint8Array($_.slice($a+$i,$a+$i+$v))}return $f._subMeshes.push($S),!0},$f._getVertexDeclaration=function($_){for(var $S,$j=!1,$O=!1,$V=!1,$M=!1,$R=!1,$w=!1,$a=!1,$u=!1,$c=!1,$q=0;$q<$_.length;$q++)switch($_[$q]){case"POSITION":$j=!0;break;case"NORMAL":$O=!0;break;case"COLOR":$V=!0;break;case"UV":$M=!0;break;case"UV1":$R=!0;break;case"BLENDWEIGHT":$a=!0;break;case"BLENDINDICES":$u=!0;break;case"TANGENT":$w=!0;break;case"BINORMAL":$c=!0}return $j&&$O&&$V&&$M&&$R&&$a&&$u&&$w?$S=$k_.vertexDeclaration:$j&&$O&&$V&&$M&&$R&&$a&&$u?$S=$o_.vertexDeclaration:$j&&$O&&$M&&$R&&$a&&$u&&$w?$S=$x_.vertexDeclaration:$j&&$O&&$M&&$R&&$a&&$u?$S=$J_.vertexDeclaration:$j&&$O&&$V&&$M&&$a&&$u&&$w?$S=$y_.vertexDeclaration:$j&&$O&&$V&&$M&&$a&&$u?$S=$A_.vertexDeclaration:$j&&$O&&$M&&$a&&$u&&$w?$S=$m_.vertexDeclaration:$j&&$O&&$M&&$a&&$u?$S=$B_.vertexDeclaration:$j&&$O&&$V&&$a&&$u&&$w?$S=$s_.vertexDeclaration:$j&&$O&&$V&&$a&&$u?$S=$c_.vertexDeclaration:$j&&$O&&$V&&$M&&$R&&$w?$S=$H_.vertexDeclaration:$j&&$O&&$V&&$M&&$R?$S=$Z_.vertexDeclaration:$j&&$O&&$M&&$R&&$w?$S=$N_.vertexDeclaration:$j&&$O&&$M&&$R?$S=$n_.vertexDeclaration:$j&&$O&&$V&&$M&&$w?$S=$g_.vertexDeclaration:$j&&$O&&$M&&$w&&$c?$S=$D_.vertexDeclaration:$j&&$O&&$V&&$M?$S=$v_.vertexDeclaration:$j&&$O&&$M&&$w?$S=$G_.vertexDeclaration:$j&&$O&&$M?$S=$d_.vertexDeclaration:$j&&$O&&$V&&$w?$S=$i_.vertexDeclaration:$j&&$O&&$V&&($S=$u_.vertexDeclaration),$S},$f._attrReg=new RegExp("(\\w+)|([:,;])","g"),$f._strings=[],$f._readData=null,$f._version=null,$f._mesh=null,$f._materials=null,$f._subMeshes=null,$f._materialMap=null,$q($f,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$f}(),$W_=function(){function $A(){}return $C($A,"laya.d3.loaders.LoadModelV03"),$A.parse=function($_,$S,$j,$O,$V){$A._mesh=$j,$A._subMeshes=$O,$A._materialMap=$V,$A._version=$S,$A._readData=$_,$A.READ_DATA(),$A.READ_BLOCK(),$A.READ_STRINGS();for(var $M=0,$R=$A._BLOCK.count;$M<$R;$M++){$A._readData.pos=$A._BLOCK.blockStarts[$M];var $w=$A._readData.getUint16(),$a=$A._strings[$w],$u=$A["READ_"+$a];if(null==$u)throw new Error("model file err,no this function:"+$w+" "+$a);$u.call()}$A._strings.length=0,$A._readData=null,$A._version=null,$A._mesh=null,$A._subMeshes=null,$A._materialMap=null},$A._readString=function(){return $A._strings[$A._readData.getUint16()]},$A.READ_DATA=function(){$A._DATA.offset=$A._readData.getUint32(),$A._DATA.size=$A._readData.getUint32()},$A.READ_BLOCK=function(){for(var $_=$A._BLOCK.count=$A._readData.getUint16(),$S=$A._BLOCK.blockStarts=[],$j=$A._BLOCK.blockLengths=[],$O=0;$O<$_;$O++)$S.push($A._readData.getUint32()),$j.push($A._readData.getUint32())},$A.READ_STRINGS=function(){var $_=$A._readData.getUint32(),$S=$A._readData.getUint16(),$j=$A._readData.pos;$A._readData.pos=$_+$A._DATA.offset;for(var $O=0;$O<$S;$O++)$A._strings[$O]=$A._readData.readUTFString();$A._readData.pos=$j},$A.READ_MESH=function(){var $_,$S=$A._readString(),$j=$A._readData.__getBuffer(),$O=0,$V=$A._readData.getInt16(),$M=$A._DATA.offset;for($O=0;$O<$V;$O++){var $R,$w=$M+$A._readData.getUint32(),$a=$A._readData.getUint32(),$u=new Float32Array($j.slice($w,$w+$a)),$c=$A._readString();switch($A._version){case"LAYAMODEL:03":$R=$A._vertexDeclarationMap_Discard[$c];break;case"LAYAMODEL:0301":$R=$A._vertexDeclarationMap[$c];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$R)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$A._version+"  bufferAttribute="+$c+"  name="+$S+"  url="+($A._mesh?$A._mesh.url:"null"));var $q=$mS.create($R,4*$u.length/$R.vertexStride,35044,!0,$A._mesh._url+"_"+$O);$q.setData($u),$A._mesh._vertexBuffers.push($q)}var $s=$M+$A._readData.getUint32(),$C=$A._readData.getUint32(),$i=new Uint16Array($j.slice($s,$s+$C)),$v=$tS.create("ushort",$C/2,35044,!0,$A._mesh._url);$v.setData($i),$A._mesh._indexBuffer=$v;var $Z=$A._mesh._boneNames=[],$o=$A._readData.getUint16();for($Z.length=$o,$O=0;$O<$o;$O++)$Z[$O]=$A._strings[$A._readData.getUint16()];$A._readData.pos+=8;var $l=$A._readData.getUint32(),$k=$A._readData.getUint32(),$z=new Float32Array($j.slice($M+$l,$M+$l+$k));for($A._mesh._inverseBindPoses=[],$O=0,$_=$z.length;$O<$_;$O+=16){var $H=new $_S($z[$O+0],$z[$O+1],$z[$O+2],$z[$O+3],$z[$O+4],$z[$O+5],$z[$O+6],$z[$O+7],$z[$O+8],$z[$O+9],$z[$O+10],$z[$O+11],$z[$O+12],$z[$O+13],$z[$O+14],$z[$O+15]);$A._mesh._inverseBindPoses.push($H)}return $A._mesh._skinnedDatas=new Float32Array(16*$z.length),!0},$A.READ_SUBMESH=function(){var $_=$A._readData.__getBuffer(),$S=new $uS($A._mesh),$j=$A._readData.getInt16(),$O=$A._readData.getUint32(),$V=$A._readData.getUint32();$S._vertexBuffer=$A._mesh._vertexBuffers[$j],$S._vertexStart=$O,$S._vertexCount=$V;var $M=$A._readData.getUint32(),$R=$A._readData.getUint32(),$w=$A._mesh._indexBuffer;$S._indexBuffer=$w,$S._indexStart=$M,$S._indexCount=$R,$S._indices=new Uint16Array($w.getData().buffer,2*$M,$R);var $a=$A._DATA.offset,$u=$S._subIndexBufferStart,$c=$S._subIndexBufferCount,$q=$S._boneIndicesList,$s=$A._readData.getUint16();$u.length=$s,$c.length=$s,$q.length=$s;for(var $C=0;$C<$s;$C++){$u[$C]=$A._readData.getUint32(),$c[$C]=$A._readData.getUint32();var $i=$A._readData.getUint32(),$v=$A._readData.getUint32();$q[$C]=new Uint8Array($_.slice($a+$i,$a+$i+$v))}return $A._subMeshes.push($S),!0},$A._strings=[],$A._readData=null,$A._version=null,$A._mesh=null,$A._subMeshes=null,$A._materialMap=null,$q($A,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$k_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$o_.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$L_.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$x_.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$J_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$y_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$A_.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$m_.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$B_.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$s_.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$c_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$H_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$Z_.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$N_.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$n_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$g_.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$D_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$v_.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$G_.vertexDeclaration,"POSITION,NORMAL,UV":$d_.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$i_.vertexDeclaration,"POSITION,NORMAL,COLOR":$u_.vertexDeclaration,"POSITION,NORMAL,TANGENT":$$_.vertexDeclaration,"POSITION,NORMAL":$a_.vertexDeclaration,"POSITION,UV":$Q_.vertexDeclaration,POSITION:$w_.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$l_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$o_.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$L_.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$F_.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$J_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$f_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$A_.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$t_.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$B_.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$q_.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$c_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$z_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$Z_.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$h_.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$n_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$P_.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$D_.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$v_.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$e_.vertexDeclaration,"POSITION,NORMAL,UV":$d_.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$C_.vertexDeclaration,"POSITION,NORMAL,COLOR":$u_.vertexDeclaration,"POSITION,NORMAL,TANGENT":$E_.vertexDeclaration,"POSITION,NORMAL":$a_.vertexDeclaration,"POSITION,UV":$Q_.vertexDeclaration,POSITION:$w_.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$A}(),$p_=function(){function $w(){}return $C($w,"laya.d3.loaders.MeshReader"),$w.read=function($_,$S,$j,$O,$V){var $M=new $A($_);$M.pos=0;var $R=$M.readUTFString();switch($R){case"LAYAMODEL:01":case"LAYASKINANI:01":$w._readVersion01($M,$R,$S,$j,$O,$V);break;case"LAYAMODEL:02":$T_.parse($M,$R,$S,$j,$O,$V);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$W_.parse($M,$R,$S,$O,$V);break;default:throw new Error("MeshReader: unknown mesh version.")}$S._setSubMeshes($O)},$w._readVersion01=function($_,$S,$j,$O,$V,$M){new $Y_($_,$S,$j,$O,$V,$M)},$w}(),$I_=function(){function $_($_,$S){this.min=null,this.max=null,this.min=$_,this.max=$S}$C($_,"laya.d3.math.BoundBox");var $S=$_.prototype;return $H.imps($S,{"laya.d3.core.IClone":!0}),$S.getCorners=function($_){$_.length=8;var $S=this.min.elements,$j=this.max.elements,$O=$S[0],$V=$S[1],$M=$S[2],$R=$j[0],$w=$j[1],$a=$j[2];$_[0]=new $RS($O,$w,$a),$_[1]=new $RS($R,$w,$a),$_[2]=new $RS($R,$V,$a),$_[3]=new $RS($O,$V,$a),$_[4]=new $RS($O,$w,$M),$_[5]=new $RS($R,$w,$M),$_[6]=new $RS($R,$V,$M),$_[7]=new $RS($O,$V,$M)},$S.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$S.cloneTo=function($_){var $S=$_;this.min.cloneTo($S.min),this.max.cloneTo($S.max)},$S.clone=function(){var $_=new this.constructor(new $RS,new $RS);return this.cloneTo($_),$_},$_.createfromPoints=function($_,$S){if(null==$_)throw new Error("points");var $j=$S.min,$O=$S.max,$V=$j.elements;$V[0]=Number.MAX_VALUE,$V[1]=Number.MAX_VALUE,$V[2]=Number.MAX_VALUE;var $M=$O.elements;$M[0]=-Number.MAX_VALUE,$M[1]=-Number.MAX_VALUE,$M[2]=-Number.MAX_VALUE;for(var $R=0,$w=$_.length;$R<$w;++$R)$RS.min($j,$_[$R],$j),$RS.max($O,$_[$R],$O)},$_.merge=function($_,$S,$j){$RS.min($_.min,$S.min,$j.min),$RS.max($_.max,$S.max,$j.max)},$_}(),$K_=function(){function $u($_){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$_,this._near=new $SS(new $RS),this._far=new $SS(new $RS),this._left=new $SS(new $RS),this._right=new $SS(new $RS),this._top=new $SS(new $RS),this._bottom=new $SS(new $RS),$u._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$C($u,"laya.d3.math.BoundFrustum");var $_=$u.prototype;return $_.equalsBoundFrustum=function($_){return this._matrix.equalsOtherMatrix($_.matrix)},$_.equalsObj=function($_){if($_ instanceof laya.d3.math.BoundFrustum){var $S=$_;return this.equalsBoundFrustum($S)}return!1},$_.getPlane=function($_){switch($_){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$_.getCorners=function($_){$u._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($_[0]),$u._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($_[1]),$u._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($_[2]),$u._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($_[3]),$u._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($_[4]),$u._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($_[5]),$u._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($_[6]),$u._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($_[7])},$_.containsPoint=function($_){for(var $S=$SS.PlaneIntersectionType_Front,$j=$SS.PlaneIntersectionType_Front,$O=0;$O<6;$O++){switch($O){case 0:$j=Collision.intersectsPlaneAndPoint(this._near,$_);break;case 1:$j=Collision.intersectsPlaneAndPoint(this._far,$_);break;case 2:$j=Collision.intersectsPlaneAndPoint(this._left,$_);break;case 3:$j=Collision.intersectsPlaneAndPoint(this._right,$_);break;case 4:$j=Collision.intersectsPlaneAndPoint(this._top,$_);break;case 5:$j=Collision.intersectsPlaneAndPoint(this._bottom,$_)}switch($j){case $SS.PlaneIntersectionType_Back:return 0;case $SS.PlaneIntersectionType_Intersecting:$S=$SS.PlaneIntersectionType_Intersecting}}switch($S){case $SS.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$_.containsBoundBox=function($_){for(var $S,$j=$u._tempV30,$O=$u._tempV31,$V=1,$M=0;$M<6;$M++){if($S=this.getPlane($M),this._getBoxToPlanePVertexNVertex($_,$S.normal,$j,$O),Collision.intersectsPlaneAndPoint($S,$j)===$SS.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($S,$O)===$SS.PlaneIntersectionType_Back&&($V=2)}return $V},$_.containsBoundSphere=function($_){for(var $S=$SS.PlaneIntersectionType_Front,$j=$SS.PlaneIntersectionType_Front,$O=0;$O<6;$O++){switch($O){case 0:$j=Collision.intersectsPlaneAndSphere(this._near,$_);break;case 1:$j=Collision.intersectsPlaneAndSphere(this._far,$_);break;case 2:$j=Collision.intersectsPlaneAndSphere(this._left,$_);break;case 3:$j=Collision.intersectsPlaneAndSphere(this._right,$_);break;case 4:$j=Collision.intersectsPlaneAndSphere(this._top,$_);break;case 5:$j=Collision.intersectsPlaneAndSphere(this._bottom,$_)}switch($j){case $SS.PlaneIntersectionType_Back:return 0;case $SS.PlaneIntersectionType_Intersecting:$S=$SS.PlaneIntersectionType_Intersecting}}switch($S){case $SS.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$_._getBoxToPlanePVertexNVertex=function($_,$S,$j,$O){var $V=$_.min,$M=$V.elements,$R=$_.max,$w=$R.elements,$a=$S.elements,$u=$a[0],$c=$a[1],$q=$a[2];$V.cloneTo($j);var $s=$j.elements;0<=$u&&($s[0]=$w[0]),0<=$c&&($s[1]=$w[1]),0<=$q&&($s[2]=$w[2]),$R.cloneTo($O);var $C=$O.elements;0<=$u&&($C[0]=$M[0]),0<=$c&&($C[1]=$M[1]),0<=$q&&($C[2]=$M[2])},$i(0,$_,"top",function(){return this._top}),$i(0,$_,"matrix",function(){return this._matrix},function($_){this._matrix=$_,$u._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$i(0,$_,"near",function(){return this._near}),$i(0,$_,"far",function(){return this._far}),$i(0,$_,"left",function(){return this._left}),$i(0,$_,"right",function(){return this._right}),$i(0,$_,"bottom",function(){return this._bottom}),$u._getPlanesFromMatrix=function($_,$S,$j,$O,$V,$M,$R){var $w=$_.elements,$a=$w[0],$u=$w[1],$c=$w[2],$q=$w[3],$s=$w[4],$C=$w[5],$i=$w[6],$v=$w[7],$Z=$w[8],$o=$w[9],$l=$w[10],$k=$w[11],$z=$w[12],$H=$w[13],$A=$w[14],$f=$w[15],$y=$S.normal.elements;$y[0]=$q+$c,$y[1]=$v+$i,$y[2]=$k+$l,$S.distance=$f+$A,$S.normalize();var $P=$j.normal.elements;$P[0]=$q-$c,$P[1]=$v-$i,$P[2]=$k-$l,$j.distance=$f-$A,$j.normalize();var $g=$O.normal.elements;$g[0]=$q+$a,$g[1]=$v+$s,$g[2]=$k+$Z,$O.distance=$f+$z,$O.normalize();var $E=$V.normal.elements;$E[0]=$q-$a,$E[1]=$v-$s,$E[2]=$k-$Z,$V.distance=$f-$z,$V.normalize();var $$=$M.normal.elements;$$[0]=$q-$u,$$[1]=$v-$C,$$[2]=$k-$o,$M.distance=$f-$H,$M.normalize();var $d=$R.normal.elements;$d[0]=$q+$u,$d[1]=$v+$C,$d[2]=$k+$o,$R.distance=$f+$H,$R.normalize()},$u._get3PlaneInterPoint=function($_,$S,$j){var $O=$_.normal,$V=$S.normal,$M=$j.normal;$RS.cross($V,$M,$u._tempV30),$RS.cross($M,$O,$u._tempV31),$RS.cross($O,$V,$u._tempV32);var $R=$RS.dot($O,$u._tempV30),$w=$RS.dot($V,$u._tempV31),$a=$RS.dot($M,$u._tempV32);return $RS.scale($u._tempV30,-$_.distance/$R,$u._tempV33),$RS.scale($u._tempV31,-$S.distance/$w,$u._tempV34),$RS.scale($u._tempV32,-$j.distance/$a,$u._tempV35),$RS.add($u._tempV33,$u._tempV34,$u._tempV36),$RS.add($u._tempV35,$u._tempV36,$u._tempV37),$u._tempV37},$q($u,["_tempV30",function(){return this._tempV30=new $RS},"_tempV31",function(){return this._tempV31=new $RS},"_tempV32",function(){return this._tempV32=new $RS},"_tempV33",function(){return this._tempV33=new $RS},"_tempV34",function(){return this._tempV34=new $RS},"_tempV35",function(){return this._tempV35=new $RS},"_tempV36",function(){return this._tempV36=new $RS},"_tempV37",function(){return this._tempV37=new $RS}]),$u}(),$X_=function(){function $c($_,$S){this.center=null,this.radius=NaN,this.center=$_,this.radius=$S}$C($c,"laya.d3.math.BoundSphere");var $_=$c.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.toDefault=function(){this.center.toDefault(),this.radius=0},$_.intersectsRayDistance=function($_){return Collision.intersectsRayAndSphereRD($_,this)},$_.intersectsRayPoint=function($_,$S){return Collision.intersectsRayAndSphereRP($_,this,$S)},$_.cloneTo=function($_){var $S=$_;this.center.cloneTo($S.center),$S.radius=this.radius},$_.clone=function(){var $_=new this.constructor(new $RS,new $RS);return this.cloneTo($_),$_},$c.createFromSubPoints=function($_,$S,$j,$O){if(null==$_)throw new Error("points");if($S<0||$S>=$_.length)throw new Error("start"+$S+"Must be in the range [0, "+($_.length-1)+"]");if($j<0||$S+$j>$_.length)throw new Error("count"+$j+"Must be in the range <= "+$_.length+"}");var $V=$S+$j,$M=$c._tempVector3;$M.elements[0]=0,$M.elements[1]=0,$M.elements[2]=0;for(var $R=$S;$R<$V;++$R)$RS.add($_[$R],$M,$M);var $w=$O.center;$RS.scale($M,1/$j,$w);var $a=0;for($R=$S;$R<$V;++$R){var $u=$RS.distanceSquared($w,$_[$R]);$a<$u&&($a=$u)}$O.radius=Math.sqrt($a)},$c.createfromPoints=function($_,$S){if(null==$_)throw new Error("points");$c.createFromSubPoints($_,0,$_.length,$S)},$q($c,["_tempVector3",function(){return this._tempVector3=new $RS}]),$c}(),$r_=(function(){function $_(){}$C($_,"laya.d3.math.ContainmentType"),$_.Disjoint=0,$_.Contains=1,$_.Intersects=2}(),function(){function $j(){}return $C($j,"laya.d3.math.MathUtils3D"),$j.isZero=function($_){return Math.abs($_)<$j.zeroTolerance},$j.nearEqual=function($_,$S){return!!$j.isZero($_-$S)},$j.fastInvSqrt=function($_){return $j.isZero($_)?$_:1/Math.sqrt($_)},$q($j,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$j}()),$b_=function(){function $a(){var $_=this.elements=new Float32Array(9);$_[0]=1,$_[1]=0,$_[2]=0,$_[3]=0,$_[4]=1,$_[5]=0,$_[6]=0,$_[7]=0,$_[8]=1}$C($a,"laya.d3.math.Matrix3x3");var $_=$a.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.determinant=function(){var $_=this.elements,$S=$_[0],$j=$_[1],$O=$_[2],$V=$_[3],$M=$_[4],$R=$_[5],$w=$_[6],$a=$_[7],$u=$_[8];return $S*($u*$M-$R*$a)+$j*(-$u*$V+$R*$w)+$O*($a*$V-$M*$w)},$_.translate=function($_,$S){var $j=$S.elements,$O=this.elements,$V=$_.elements,$M=$O[0],$R=$O[1],$w=$O[2],$a=$O[3],$u=$O[4],$c=$O[5],$q=$O[6],$s=$O[7],$C=$O[8],$i=$V[0],$v=$V[1];$j[0]=$M,$j[1]=$R,$j[2]=$w,$j[3]=$a,$j[4]=$u,$j[5]=$c,$j[6]=$i*$M+$v*$a+$q,$j[7]=$i*$R+$v*$u+$s,$j[8]=$i*$w+$v*$c+$C},$_.rotate=function($_,$S){var $j=$S.elements,$O=this.elements,$V=$O[0],$M=$O[1],$R=$O[2],$w=$O[3],$a=$O[4],$u=$O[5],$c=$O[6],$q=$O[7],$s=$O[8],$C=Math.sin($_),$i=Math.cos($_);$j[0]=$i*$V+$C*$w,$j[1]=$i*$M+$C*$a,$j[2]=$i*$R+$C*$u,$j[3]=$i*$w-$C*$V,$j[4]=$i*$a-$C*$M,$j[5]=$i*$u-$C*$R,$j[6]=$c,$j[7]=$q,$j[8]=$s},$_.scale=function($_,$S){var $j=$S.elements,$O=this.elements,$V=$_.elements,$M=$V[0],$R=$V[1];$j[0]=$M*$O[0],$j[1]=$M*$O[1],$j[2]=$M*$O[2],$j[3]=$R*$O[3],$j[4]=$R*$O[4],$j[5]=$R*$O[5],$j[6]=$O[6],$j[7]=$O[7],$j[8]=$O[8]},$_.invert=function($_){var $S=$_.elements,$j=this.elements,$O=$j[0],$V=$j[1],$M=$j[2],$R=$j[3],$w=$j[4],$a=$j[5],$u=$j[6],$c=$j[7],$q=$j[8],$s=$q*$w-$a*$c,$C=-$q*$R+$a*$u,$i=$c*$R-$w*$u,$v=$O*$s+$V*$C+$M*$i;$v||($_=null),$v=1/$v,$S[0]=$s*$v,$S[1]=(-$q*$V+$M*$c)*$v,$S[2]=($a*$V-$M*$w)*$v,$S[3]=$C*$v,$S[4]=($q*$O-$M*$u)*$v,$S[5]=(-$a*$O+$M*$R)*$v,$S[6]=$i*$v,$S[7]=(-$c*$O+$V*$u)*$v,$S[8]=($w*$O-$V*$R)*$v},$_.transpose=function($_){var $S=$_.elements,$j=this.elements;if($_===this){var $O=$j[1],$V=$j[2],$M=$j[5];$S[1]=$j[3],$S[2]=$j[6],$S[3]=$O,$S[5]=$j[7],$S[6]=$V,$S[7]=$M}else $S[0]=$j[0],$S[1]=$j[3],$S[2]=$j[6],$S[3]=$j[1],$S[4]=$j[4],$S[5]=$j[7],$S[6]=$j[2],$S[7]=$j[5],$S[8]=$j[8]},$_.identity=function(){var $_=this.elements;$_[0]=1,$_[1]=0,$_[2]=0,$_[3]=0,$_[4]=1,$_[5]=0,$_[6]=0,$_[7]=0,$_[8]=1},$_.cloneTo=function($_){var $S,$j,$O;if(($j=this.elements)!==($O=$_.elements))for($S=0;$S<9;++$S)$O[$S]=$j[$S]},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$a.createFromTranslation=function($_,$S){$S.elements;var $j=$_.elements;$S[0]=1,$S[1]=0,$S[2]=0,$S[3]=0,$S[4]=1,$S[5]=0,$S[6]=$j[0],$S[7]=$j[1],$S[8]=1},$a.createFromRotation=function($_,$S){var $j=$S.elements,$O=Math.sin($_),$V=Math.cos($_);$j[0]=$V,$j[1]=$O,$j[2]=0,$j[3]=-$O,$j[4]=$V,$j[5]=0,$j[6]=0,$j[7]=0,$j[8]=1},$a.createFromScaling=function($_,$S){var $j=$S.elements,$O=$_.elements;$j[0]=$O[0],$j[1]=0,$j[2]=0,$j[3]=0,$j[4]=$O[1],$j[5]=0,$j[6]=0,$j[7]=0,$j[8]=1},$a.createFromMatrix4x4=function($_,$S){$S[0]=$_[0],$S[1]=$_[1],$S[2]=$_[2],$S[3]=$_[4],$S[4]=$_[5],$S[5]=$_[6],$S[6]=$_[8],$S[7]=$_[9],$S[8]=$_[10]},$a.multiply=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements,$R=$V[0],$w=$V[1],$a=$V[2],$u=$V[3],$c=$V[4],$q=$V[5],$s=$V[6],$C=$V[7],$i=$V[8],$v=$M[0],$Z=$M[1],$o=$M[2],$l=$M[3],$k=$M[4],$z=$M[5],$H=$M[6],$A=$M[7],$f=$M[8];$O[0]=$v*$R+$Z*$u+$o*$s,$O[1]=$v*$w+$Z*$c+$o*$C,$O[2]=$v*$a+$Z*$q+$o*$i,$O[3]=$l*$R+$k*$u+$z*$s,$O[4]=$l*$w+$k*$c+$z*$C,$O[5]=$l*$a+$k*$q+$z*$i,$O[6]=$H*$R+$A*$u+$f*$s,$O[7]=$H*$w+$A*$c+$f*$C,$O[8]=$H*$a+$A*$q+$f*$i},$a.lookAt=function($_,$S,$j,$O){$RS.subtract($_,$S,$a._tempV30),$RS.normalize($a._tempV30,$a._tempV30),$RS.cross($j,$a._tempV30,$a._tempV31),$RS.normalize($a._tempV31,$a._tempV31),$RS.cross($a._tempV30,$a._tempV31,$a._tempV32);var $V=$a._tempV30.elements,$M=$a._tempV31.elements,$R=$a._tempV32.elements,$w=$O.elements;$w[0]=$M[0],$w[3]=$M[1],$w[6]=$M[2],$w[1]=$R[0],$w[4]=$R[1],$w[7]=$R[2],$w[2]=$V[0],$w[5]=$V[1],$w[8]=$V[2]},$a.DEFAULT=new $a,$q($a,["_tempV30",function(){return this._tempV30=new $RS},"_tempV31",function(){return this._tempV31=new $RS},"_tempV32",function(){return this._tempV32=new $RS}]),$a}(),$_S=function(){function $P($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q,$s,$C,$i,$v){void 0===$_&&($_=1),void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$M&&($M=1),void 0===$R&&($R=0),void 0===$w&&($w=0),void 0===$a&&($a=0),void 0===$u&&($u=0),void 0===$c&&($c=1),void 0===$q&&($q=0),void 0===$s&&($s=0),void 0===$C&&($C=0),void 0===$i&&($i=0),void 0===$v&&($v=1);var $Z=this.elements=new Float32Array(16);$Z[0]=$_,$Z[1]=$S,$Z[2]=$j,$Z[3]=$O,$Z[4]=$V,$Z[5]=$M,$Z[6]=$R,$Z[7]=$w,$Z[8]=$a,$Z[9]=$u,$Z[10]=$c,$Z[11]=$q,$Z[12]=$s,$Z[13]=$C,$Z[14]=$i,$Z[15]=$v}$C($P,"laya.d3.math.Matrix4x4");var $_=$P.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.getElementByRowColumn=function($_,$S){if($_<0||3<$_)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($S<0||3<$S)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$_+$S]},$_.setElementByRowColumn=function($_,$S,$j){if($_<0||3<$_)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($S<0||3<$S)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$_+$S]=$j},$_.equalsOtherMatrix=function($_){var $S=this.elements,$j=$_.elements;return $r_.nearEqual($S[0],$j[0])&&$r_.nearEqual($S[1],$j[1])&&$r_.nearEqual($S[2],$j[2])&&$r_.nearEqual($S[3],$j[3])&&$r_.nearEqual($S[4],$j[4])&&$r_.nearEqual($S[5],$j[5])&&$r_.nearEqual($S[6],$j[6])&&$r_.nearEqual($S[7],$j[7])&&$r_.nearEqual($S[8],$j[8])&&$r_.nearEqual($S[9],$j[9])&&$r_.nearEqual($S[10],$j[10])&&$r_.nearEqual($S[11],$j[11])&&$r_.nearEqual($S[12],$j[12])&&$r_.nearEqual($S[13],$j[13])&&$r_.nearEqual($S[14],$j[14])&&$r_.nearEqual($S[15],$j[15])},$_.decomposeTransRotScale=function($_,$S,$j){var $O=$P._tempMatrix4x4;return this.decomposeTransRotMatScale($_,$O,$j)?($jS.createFromMatrix4x4($O,$S),!0):($S.identity(),!1)},$_.decomposeTransRotMatScale=function($_,$S,$j){var $O=this.elements,$V=$_.elements,$M=$S.elements,$R=$j.elements;$V[0]=$O[12],$V[1]=$O[13],$V[2]=$O[14];var $w=$O[0],$a=$O[1],$u=$O[2],$c=$O[4],$q=$O[5],$s=$O[6],$C=$O[8],$i=$O[9],$v=$O[10],$Z=$R[0]=Math.sqrt($w*$w+$a*$a+$u*$u),$o=$R[1]=Math.sqrt($c*$c+$q*$q+$s*$s),$l=$R[2]=Math.sqrt($C*$C+$i*$i+$v*$v);if($r_.isZero($Z)||$r_.isZero($o)||$r_.isZero($l))return $M[1]=$M[2]=$M[3]=$M[4]=$M[6]=$M[7]=$M[8]=$M[9]=$M[11]=$M[12]=$M[13]=$M[14]=0,$M[0]=$M[5]=$M[10]=$M[15]=1,!1;var $k=$P._tempVector0,$z=$k.elements;$z[0]=$C/$l,$z[1]=$i/$l,$z[2]=$v/$l;var $H=$P._tempVector1,$A=$H.elements;$A[0]=$w/$Z,$A[1]=$a/$Z,$A[2]=$u/$Z;var $f=$P._tempVector2;$RS.cross($k,$H,$f);var $y=$P._tempVector1;return $RS.cross($f,$k,$y),$M[3]=$M[7]=$M[11]=$M[12]=$M[13]=$M[14]=0,$M[15]=1,$M[0]=$y.x,$M[1]=$y.y,$M[2]=$y.z,$M[4]=$f.x,$M[5]=$f.y,$M[6]=$f.z,$M[8]=$k.x,$M[9]=$k.y,$M[10]=$k.z,$M[0]*$w+$M[1]*$a+$M[2]*$u<0&&($R[0]=-$Z),$M[4]*$c+$M[5]*$q+$M[6]*$s<0&&($R[1]=-$o),$M[8]*$C+$M[9]*$i+$M[10]*$v<0&&($R[2]=-$l),!0},$_.decomposeYawPitchRoll=function($_){var $S=$_.elements,$j=Math.asin(-this.elements[9]);$S[1]=$j,Math.cos($j)>$r_.zeroTolerance?($S[2]=Math.atan2(this.elements[1],this.elements[5]),$S[0]=Math.atan2(this.elements[8],this.elements[10])):($S[2]=Math.atan2(-this.elements[4],this.elements[0]),$S[0]=0)},$_.normalize=function(){var $_=this.elements,$S=$_[0],$j=$_[1],$O=$_[2],$V=Math.sqrt($S*$S+$j*$j+$O*$O);if(!$V)return $_[0]=0,$_[1]=0,void($_[2]=0);1!=$V&&($V=1/$V,$_[0]=$S*$V,$_[1]=$j*$V,$_[2]=$O*$V)},$_.transpose=function(){var $_,$S;return $S=($_=this.elements)[1],$_[1]=$_[4],$_[4]=$S,$S=$_[2],$_[2]=$_[8],$_[8]=$S,$S=$_[3],$_[3]=$_[12],$_[12]=$S,$S=$_[6],$_[6]=$_[9],$_[9]=$S,$S=$_[7],$_[7]=$_[13],$_[13]=$S,$S=$_[11],$_[11]=$_[14],$_[14]=$S,this},$_.invert=function($_){var $S=this.elements,$j=$_.elements,$O=$S[0],$V=$S[1],$M=$S[2],$R=$S[3],$w=$S[4],$a=$S[5],$u=$S[6],$c=$S[7],$q=$S[8],$s=$S[9],$C=$S[10],$i=$S[11],$v=$S[12],$Z=$S[13],$o=$S[14],$l=$S[15],$k=$O*$a-$V*$w,$z=$O*$u-$M*$w,$H=$O*$c-$R*$w,$A=$V*$u-$M*$a,$f=$V*$c-$R*$a,$y=$M*$c-$R*$u,$P=$q*$Z-$s*$v,$g=$q*$o-$C*$v,$E=$q*$l-$i*$v,$$=$s*$o-$C*$Z,$d=$s*$l-$i*$Z,$n=$C*$l-$i*$o,$J=$k*$n-$z*$d+$H*$$+$A*$E-$f*$g+$y*$P;0!==Math.abs($J)&&($J=1/$J,$j[0]=($a*$n-$u*$d+$c*$$)*$J,$j[1]=($M*$d-$V*$n-$R*$$)*$J,$j[2]=($Z*$y-$o*$f+$l*$A)*$J,$j[3]=($C*$f-$s*$y-$i*$A)*$J,$j[4]=($u*$E-$w*$n-$c*$g)*$J,$j[5]=($O*$n-$M*$E+$R*$g)*$J,$j[6]=($o*$H-$v*$y-$l*$z)*$J,$j[7]=($q*$y-$C*$H+$i*$z)*$J,$j[8]=($w*$d-$a*$E+$c*$P)*$J,$j[9]=($V*$E-$O*$d-$R*$P)*$J,$j[10]=($v*$f-$Z*$H+$l*$k)*$J,$j[11]=($s*$H-$q*$f-$i*$k)*$J,$j[12]=($a*$g-$w*$$-$u*$P)*$J,$j[13]=($O*$$-$V*$g+$M*$P)*$J,$j[14]=($Z*$z-$v*$A-$o*$k)*$J,$j[15]=($q*$A-$s*$z+$C*$k)*$J)},$_.identity=function(){var $_=this.elements;$_[1]=$_[2]=$_[3]=$_[4]=$_[6]=$_[7]=$_[8]=$_[9]=$_[11]=$_[12]=$_[13]=$_[14]=0,$_[0]=$_[5]=$_[10]=$_[15]=1},$_.cloneTo=function($_){var $S,$j,$O;if(($j=this.elements)!==($O=$_.elements))for($S=0;$S<16;++$S)$O[$S]=$j[$S]},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$_.getTranslationVector=function($_){var $S=this.elements,$j=$_.elements;$j[0]=$S[12],$j[1]=$S[13],$j[2]=$S[14]},$_.setTranslationVector=function($_){var $S=this.elements,$j=$_.elements;$S[12]=$j[0],$S[13]=$j[1],$S[14]=$j[2]},$_.getForward=function($_){var $S=this.elements,$j=$_.elements;$j[0]=-$S[8],$j[1]=-$S[9],$j[2]=-$S[10]},$_.setForward=function($_){var $S=this.elements,$j=$_.elements;$S[8]=-$j[0],$S[9]=-$j[1],$S[10]=-$j[2]},$P.createRotationX=function($_,$S){var $j=$S.elements,$O=Math.sin($_),$V=Math.cos($_);$j[1]=$j[2]=$j[3]=$j[4]=$j[7]=$j[8]=$j[11]=$j[12]=$j[13]=$j[14]=0,$j[0]=$j[15]=1,$j[5]=$j[10]=$V,$j[6]=$O,$j[9]=-$O},$P.createRotationY=function($_,$S){var $j=$S.elements,$O=Math.sin($_),$V=Math.cos($_);$j[1]=$j[3]=$j[4]=$j[6]=$j[7]=$j[9]=$j[11]=$j[12]=$j[13]=$j[14]=0,$j[5]=$j[15]=1,$j[0]=$j[10]=$V,$j[2]=-$O,$j[8]=$O},$P.createRotationZ=function($_,$S){var $j=$S.elements,$O=Math.sin($_),$V=Math.cos($_);$j[2]=$j[3]=$j[6]=$j[7]=$j[8]=$j[9]=$j[11]=$j[12]=$j[13]=$j[14]=0,$j[10]=$j[15]=1,$j[0]=$j[5]=$V,$j[1]=$O,$j[4]=-$O},$P.createRotationYawPitchRoll=function($_,$S,$j,$O){$jS.createFromYawPitchRoll($_,$S,$j,$P._tempQuaternion),$P.createRotationQuaternion($P._tempQuaternion,$O)},$P.createRotationAxis=function($_,$S,$j){var $O=$_.elements,$V=$O[0],$M=$O[1],$R=$O[2],$w=Math.cos($S),$a=Math.sin($S),$u=$V*$V,$c=$M*$M,$q=$R*$R,$s=$V*$M,$C=$V*$R,$i=$M*$R,$v=$j.elements;$v[3]=$v[7]=$v[11]=$v[12]=$v[13]=$v[14]=0,$v[15]=1,$v[0]=$u+$w*(1-$u),$v[1]=$s-$w*$s+$a*$R,$v[2]=$C-$w*$C-$a*$M,$v[4]=$s-$w*$s-$a*$R,$v[5]=$c+$w*(1-$c),$v[6]=$i-$w*$i+$a*$V,$v[8]=$C-$w*$C+$a*$M,$v[9]=$i-$w*$i-$a*$V,$v[10]=$q+$w*(1-$q)},$P.createRotationQuaternion=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$j[0],$M=$j[1],$R=$j[2],$w=$j[3],$a=$V*$V,$u=$M*$M,$c=$R*$R,$q=$V*$M,$s=$R*$w,$C=$R*$V,$i=$M*$w,$v=$M*$R,$Z=$V*$w;$O[3]=$O[7]=$O[11]=$O[12]=$O[13]=$O[14]=0,$O[15]=1,$O[0]=1-2*($u+$c),$O[1]=2*($q+$s),$O[2]=2*($C-$i),$O[4]=2*($q-$s),$O[5]=1-2*($c+$a),$O[6]=2*($v+$Z),$O[8]=2*($C+$i),$O[9]=2*($v-$Z),$O[10]=1-2*($u+$a)},$P.createTranslate=function($_,$S){var $j=$_.elements,$O=$S.elements;$O[4]=$O[8]=$O[1]=$O[9]=$O[2]=$O[6]=$O[3]=$O[7]=$O[11]=0,$O[0]=$O[5]=$O[10]=$O[15]=1,$O[12]=$j[0],$O[13]=$j[1],$O[14]=$j[2]},$P.createScaling=function($_,$S){var $j=$_.elements,$O=$S.elements;$O[0]=$j[0],$O[5]=$j[1],$O[10]=$j[2],$O[1]=$O[4]=$O[8]=$O[12]=$O[9]=$O[13]=$O[2]=$O[6]=$O[14]=$O[3]=$O[7]=$O[11]=0,$O[15]=1},$P.multiply=function($_,$S,$j){var $O,$V,$M,$R,$w,$a,$u,$c;for($V=$j.elements,$M=$_.elements,$V===($R=$S.elements)&&($R=$R.slice()),$O=0;$O<4;$O++)$w=$M[$O],$a=$M[$O+4],$u=$M[$O+8],$c=$M[$O+12],$V[$O]=$w*$R[0]+$a*$R[1]+$u*$R[2]+$c*$R[3],$V[$O+4]=$w*$R[4]+$a*$R[5]+$u*$R[6]+$c*$R[7],$V[$O+8]=$w*$R[8]+$a*$R[9]+$u*$R[10]+$c*$R[11],$V[$O+12]=$w*$R[12]+$a*$R[13]+$u*$R[14]+$c*$R[15]},$P.createFromQuaternion=function($_,$S){var $j=$S.elements,$O=$_.elements,$V=$O[0],$M=$O[1],$R=$O[2],$w=$O[3],$a=$V+$V,$u=$M+$M,$c=$R+$R,$q=$V*$a,$s=$M*$a,$C=$M*$u,$i=$R*$a,$v=$R*$u,$Z=$R*$c,$o=$w*$a,$l=$w*$u,$k=$w*$c;$j[0]=1-$C-$Z,$j[1]=$s+$k,$j[2]=$i-$l,$j[3]=0,$j[4]=$s-$k,$j[5]=1-$q-$Z,$j[6]=$v+$o,$j[7]=0,$j[8]=$i+$l,$j[9]=$v-$o,$j[10]=1-$q-$C,$j[11]=0,$j[12]=0,$j[13]=0,$j[14]=0,$j[15]=1},$P.createAffineTransformation=function($_,$S,$j,$O){var $V=$_.elements,$M=$S.elements,$R=$j.elements,$w=$O.elements,$a=$M[0],$u=$M[1],$c=$M[2],$q=$M[3],$s=$a+$a,$C=$u+$u,$i=$c+$c,$v=$a*$s,$Z=$a*$C,$o=$a*$i,$l=$u*$C,$k=$u*$i,$z=$c*$i,$H=$q*$s,$A=$q*$C,$f=$q*$i,$y=$R[0],$P=$R[1],$g=$R[2];$w[0]=(1-($l+$z))*$y,$w[1]=($Z+$f)*$y,$w[2]=($o-$A)*$y,$w[3]=0,$w[4]=($Z-$f)*$P,$w[5]=(1-($v+$z))*$P,$w[6]=($k+$H)*$P,$w[7]=0,$w[8]=($o+$A)*$g,$w[9]=($k-$H)*$g,$w[10]=(1-($v+$l))*$g,$w[11]=0,$w[12]=$V[0],$w[13]=$V[1],$w[14]=$V[2],$w[15]=1},$P.createLookAt=function($_,$S,$j,$O){var $V=$O.elements,$M=$P._tempVector0,$R=$P._tempVector1,$w=$P._tempVector2;$RS.subtract($_,$S,$w),$RS.normalize($w,$w),$RS.cross($j,$w,$M),$RS.normalize($M,$M),$RS.cross($w,$M,$R),$O.identity(),$V[0]=$M.x,$V[4]=$M.y,$V[8]=$M.z,$V[1]=$R.x,$V[5]=$R.y,$V[9]=$R.z,$V[2]=$w.x,$V[6]=$w.y,$V[10]=$w.z,$V[12]=-$RS.dot($M,$_),$V[13]=-$RS.dot($R,$_),$V[14]=-$RS.dot($w,$_)},$P.createPerspective=function($_,$S,$j,$O,$V){var $M=$V.elements,$R=1/Math.tan($_/2),$w=1/($j-$O);$M[0]=$R/$S,$M[5]=$R,$M[10]=($O+$j)*$w,$M[11]=-1,$M[14]=2*$O*$j*$w,$M[1]=$M[2]=$M[3]=$M[4]=$M[6]=$M[7]=$M[8]=$M[9]=$M[12]=$M[13]=$M[15]=0},$P.createOrthoOffCenterRH=function($_,$S,$j,$O,$V,$M,$R){var $w=$R.elements,$a=1/($_-$S),$u=1/($j-$O),$c=1/($V-$M);$w[1]=$w[2]=$w[3]=$w[4]=$w[6]=$w[7]=$w[8]=$w[9]=$w[11]=0,$w[15]=1,$w[0]=-2*$a,$w[5]=-2*$u,$w[10]=2*$c,$w[12]=($_+$S)*$a,$w[13]=($O+$j)*$u,$w[14]=($M+$V)*$c},$P.translation=function($_,$S){var $j=$_.elements,$O=$S.elements;$O[0]=$O[5]=$O[10]=$O[15]=1,$O[12]=$j[0],$O[13]=$j[1],$O[14]=$j[2]},$q($P,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $P},"_tempVector0",function(){return this._tempVector0=new $RS},"_tempVector1",function(){return this._tempVector1=new $RS},"_tempVector2",function(){return this._tempVector2=new $RS},"_tempQuaternion",function(){return this._tempQuaternion=new $jS},"DEFAULT",function(){return this.DEFAULT=new $P},"ZERO",function(){return this.ZERO=new $P(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$P}(),$SS=(function(){function $k($_,$S){this.extents=null,this.transformation=null,this.extents=$_,this.transformation=$S}$C($k,"laya.d3.math.OrientedBoundBox");var $_=$k.prototype;$_.getCorners=function($_){var $S=$k._tempV30.elements,$j=$k._tempV31.elements,$O=$k._tempV32.elements,$V=this.extents.elements;$S[0]=$V[0],$S[1]=$S[2]=0,$j[1]=$V[1],$j[0]=$j[2]=0,$O[2]=$V[2],$O[0]=$O[1]=0,$RS.TransformNormal($k._tempV30,this.transformation,$k._tempV30),$RS.TransformNormal($k._tempV31,this.transformation,$k._tempV31),$RS.TransformNormal($k._tempV32,this.transformation,$k._tempV32);var $M=$k._tempV33;this.transformation.getTranslationVector($M),$_.length=8,$RS.add($M,$k._tempV30,$k._tempV34),$RS.add($k._tempV34,$k._tempV31,$k._tempV34),$RS.add($k._tempV34,$k._tempV32,$_[0]),$RS.add($M,$k._tempV30,$k._tempV34),$RS.add($k._tempV34,$k._tempV31,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV32,$_[1]),$RS.subtract($M,$k._tempV30,$k._tempV34),$RS.add($k._tempV34,$k._tempV31,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV32,$_[2]),$RS.subtract($M,$k._tempV30,$k._tempV34),$RS.add($k._tempV34,$k._tempV31,$k._tempV34),$RS.add($k._tempV34,$k._tempV32,$_[3]),$RS.add($M,$k._tempV30,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV31,$k._tempV34),$RS.add($k._tempV34,$k._tempV32,$_[4]),$RS.add($M,$k._tempV30,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV31,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV32,$_[5]),$RS.subtract($M,$k._tempV30,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV31,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV32,$_[6]),$RS.subtract($M,$k._tempV30,$k._tempV34),$RS.subtract($k._tempV34,$k._tempV31,$k._tempV34),$RS.add($k._tempV34,$k._tempV32,$_[7])},$_.transform=function($_){$_S.multiply(this.transformation,$_,this.transformation)},$_.scale=function($_){$RS.multiply(this.extents,$_,this.extents)},$_.translate=function($_){this.transformation.getTranslationVector($k._tempV30),$RS.add($k._tempV30,$_,$k._tempV31),this.transformation.setTranslationVector($k._tempV31)},$_.Size=function($_){$RS.scale(this.extents,2,$_)},$_.getSize=function($_){var $S=this.extents.elements;$k._tempV30.x=$S[0],$k._tempV31.y=$S[1],$k._tempV32.z=$S[2],$RS.TransformNormal($k._tempV30,this.transformation,$k._tempV30),$RS.TransformNormal($k._tempV31,this.transformation,$k._tempV31),$RS.TransformNormal($k._tempV31,this.transformation,$k._tempV32);var $j=$_.elements;$j[0]=$RS.scalarLength($k._tempV30),$j[1]=$RS.scalarLength($k._tempV31),$j[2]=$RS.scalarLength($k._tempV32)},$_.getSizeSquared=function($_){var $S=this.extents.elements;$k._tempV30.x=$S[0],$k._tempV31.y=$S[1],$k._tempV32.z=$S[2],$RS.TransformNormal($k._tempV30,this.transformation,$k._tempV30),$RS.TransformNormal($k._tempV31,this.transformation,$k._tempV31),$RS.TransformNormal($k._tempV31,this.transformation,$k._tempV32);var $j=$_.elements;$j[0]=$RS.scalarLengthSquared($k._tempV30),$j[1]=$RS.scalarLengthSquared($k._tempV31),$j[2]=$RS.scalarLengthSquared($k._tempV32)},$_.getCenter=function($_){this.transformation.getTranslationVector($_)},$_.containsPoint=function($_){var $S=this.extents.elements,$j=$S[0],$O=$S[1],$V=$S[2];this.transformation.invert($k._tempM0),$RS.transformCoordinate($_,$k._tempM0,$k._tempV30);var $M=$k._tempV30.elements,$R=Math.abs($M[0]),$w=Math.abs($M[1]),$a=Math.abs($M[2]);return $r_.nearEqual($R,$j)&&$r_.nearEqual($w,$O)&&$r_.nearEqual($a,$V)?2:$R<$j&&$w<$O&&$a<$V?1:0},$_.containsPoints=function($_){var $S=this.extents.elements,$j=$S[0],$O=$S[1],$V=$S[2];this.transformation.invert($k._tempM0);for(var $M=!0,$R=!1,$w=0;$w<$_.length;$w++){$RS.transformCoordinate($_[$w],$k._tempM0,$k._tempV30);var $a=$k._tempV30.elements,$u=Math.abs($a[0]),$c=Math.abs($a[1]),$q=Math.abs($a[2]);$r_.nearEqual($u,$j)&&$r_.nearEqual($c,$O)&&$r_.nearEqual($q,$V)&&($R=!0),$u<$j&&$c<$O&&$q<$V?$R=!0:$M=!1}return $M?1:$R?2:0},$_.containsSphere=function($_,$S){void 0===$S&&($S=!1);var $j=this.extents.elements,$O=$j[0],$V=$j[1],$M=$j[2],$R=$_.radius;this.transformation.invert($k._tempM0),$RS.transformCoordinate($_.center,$k._tempM0,$k._tempV30);var $w=NaN;if($w=$S?$R:($RS.scale($RS.UnitX,$R,$k._tempV31),$RS.TransformNormal($k._tempV31,$k._tempM0,$k._tempV31),$RS.scalarLength($k._tempV31)),$RS.scale(this.extents,-1,$k._tempV32),$RS.Clamp($k._tempV30,$k._tempV32,this.extents,$k._tempV33),$w*$w<$RS.distanceSquared($k._tempV30,$k._tempV33))return 0;var $a=$k._tempV30.elements,$u=$a[0],$c=$a[1],$q=$a[2],$s=$k._tempV32.elements,$C=$s[0],$i=$s[1],$v=$s[2];return $C+$w<=$u&&$u<=$O-$w&&$w<$O-$C&&$i+$w<=$c&&$c<=$V-$w&&$w<$V-$i&&$v+$w<=$q&&$q<=$M-$w&&$w<$M-$v?1:2},$_.containsOrientedBoundBox=function($_){var $S=0,$j=0;$_.getCorners($k._corners);var $O=this.containsPoints($k._corners);if(0!=$O)return $O;var $V=this.extents.elements;$_.extents.cloneTo($k._tempV35);var $M=$k._tempV35.elements;$k._getRows(this.transformation,$k._rows1),$k._getRows($_.transformation,$k._rows2);var $R=NaN;for($S=0;$S<4;$S++)for($j=0;$j<4;$j++)3==$S||3==$j?($k._tempM0.setElementByRowColumn($S,$j,0),$k._tempM1.setElementByRowColumn($S,$j,0)):($R=$RS.dot($k._rows1[$S],$k._rows2[$j]),$k._tempM0.setElementByRowColumn($S,$j,$R),$k._tempM1.setElementByRowColumn($S,$j,Math.abs($R)));$_.getCenter($k._tempV34),this.getCenter($k._tempV36),$RS.subtract($k._tempV34,$k._tempV36,$k._tempV30);var $w=$k._tempV31.elements;$w[0]=$RS.dot($k._tempV30,$k._rows1[0]),$w[1]=$RS.dot($k._tempV30,$k._rows1[1]),$w[2]=$RS.dot($k._tempV30,$k._rows1[2]);var $a=$k._tempV32.elements,$u=$k._tempV33.elements;for($S=0;$S<3;$S++)if($a[0]=$k._tempM1.getElementByRowColumn($S,0),$a[1]=$k._tempM1.getElementByRowColumn($S,1),$a[2]=$k._tempM1.getElementByRowColumn($S,2),$V[$S]+$RS.dot($k._tempV35,$k._tempV32)<Math.abs($w[$S]))return 0;for($j=0;$j<3;$j++)if($a[0]=$k._tempM1.getElementByRowColumn(0,$j),$a[1]=$k._tempM1.getElementByRowColumn(1,$j),$a[2]=$k._tempM1.getElementByRowColumn(2,$j),$u[0]=$k._tempM0.getElementByRowColumn(0,$j),$u[1]=$k._tempM0.getElementByRowColumn(1,$j),$u[2]=$k._tempM0.getElementByRowColumn(2,$j),$RS.dot(this.extents,$k._tempV32)+$M[$j]<Math.abs($RS.dot($k._tempV31,$k._tempV33)))return 0;for($S=0;$S<3;$S++)for($j=0;$j<3;$j++){var $c=($S+1)%3,$q=($S+2)%3,$s=($j+1)%3,$C=($j+2)%3;if($V[$c]*$k._tempM1.getElementByRowColumn($q,$j)+$V[$q]*$k._tempM1.getElementByRowColumn($c,$j)+($M[$s]*$k._tempM1.getElementByRowColumn($S,$C)+$M[$C]*$k._tempM1.getElementByRowColumn($S,$s))<Math.abs($w[$q]*$k._tempM0.getElementByRowColumn($c,$j)-$w[$c]*$k._tempM0.getElementByRowColumn($q,$j)))return 0}return 2},$_.containsLine=function($_,$S){$k._corners[0]=$_,$k._corners[1]=$S;var $j=this.containsPoints($k._corners);if(0!=$j)return $j;var $O=this.extents.elements,$V=$O[0],$M=$O[1],$R=$O[2];this.transformation.invert($k._tempM0),$RS.transformCoordinate($_,$k._tempM0,$k._tempV30),$RS.transformCoordinate($S,$k._tempM0,$k._tempV31),$RS.add($k._tempV30,$k._tempV31,$k._tempV32),$RS.scale($k._tempV32,.5,$k._tempV32),$RS.subtract($k._tempV30,$k._tempV32,$k._tempV33);var $w=$k._tempV33.elements,$a=$w[0],$u=$w[1],$c=$w[2],$q=$k._tempV34.elements,$s=$q[0]=Math.abs($w[0]),$C=$q[1]=Math.abs($w[1]),$i=$q[2]=Math.abs($w[2]),$v=$k._tempV32.elements,$Z=$v[0],$o=$v[1],$l=$v[2];return Math.abs($Z)>$V+$s?0:Math.abs($o)>$M+$C?0:Math.abs($l)>$R+$i?0:Math.abs($o*$c-$l*$u)>$M*$i+$R*$C?0:Math.abs($Z*$c-$l*$a)>$V*$i+$R*$s?0:Math.abs($Z*$u-$o*$a)>$V*$C+$M*$s?0:2},$_.containsBoundBox=function($_){var $S=0,$j=0,$O=$_.min,$V=$_.max;$_.getCorners($k._corners);var $M=this.containsPoints($k._corners);if(0!=$M)return $M;$RS.subtract($V,$O,$k._tempV30),$RS.scale($k._tempV30,.5,$k._tempV30),$RS.add($O,$k._tempV30,$k._tempV30),$RS.subtract($V,$k._tempV30,$k._tempV31);var $R=this.extents.elements,$w=$k._tempV31.elements;$k._getRows(this.transformation,$k._rows1),this.transformation.invert($k._tempM0);for($S=0;$S<3;$S++)for($j=0;$j<3;$j++)$k._tempM1.setElementByRowColumn($S,$j,Math.abs($k._tempM0.getElementByRowColumn($S,$j)));this.getCenter($k._tempV35),$RS.subtract($k._tempV30,$k._tempV35,$k._tempV32);var $a=$k._tempV31.elements;$a[0]=$RS.dot($k._tempV32,$k._rows1[0]),$a[1]=$RS.dot($k._tempV32,$k._rows1[1]),$a[2]=$RS.dot($k._tempV32,$k._rows1[2]);var $u=$k._tempV33.elements,$c=$k._tempV34.elements;for($S=0;$S<3;$S++)if($u[0]=$k._tempM1.getElementByRowColumn($S,0),$u[1]=$k._tempM1.getElementByRowColumn($S,1),$u[2]=$k._tempM1.getElementByRowColumn($S,2),$R[$S]+$RS.dot($k._tempV31,$k._tempV33)<Math.abs($a[$S]))return 0;for($j=0;$j<3;$j++)if($u[0]=$k._tempM1.getElementByRowColumn(0,$j),$u[1]=$k._tempM1.getElementByRowColumn(1,$j),$u[2]=$k._tempM1.getElementByRowColumn(2,$j),$c[0]=$k._tempM0.getElementByRowColumn(0,$j),$c[1]=$k._tempM0.getElementByRowColumn(1,$j),$c[2]=$k._tempM0.getElementByRowColumn(2,$j),$RS.dot(this.extents,$k._tempV33)+$w[$j]<Math.abs($RS.dot($k._tempV31,$k._tempV34)))return 0;for($S=0;$S<3;$S++)for($j=0;$j<3;$j++){var $q=($S+1)%3,$s=($S+2)%3,$C=($j+1)%3,$i=($j+2)%3;if($R[$q]*$k._tempM1.getElementByRowColumn($s,$j)+$R[$s]*$k._tempM1.getElementByRowColumn($q,$j)+($w[$C]*$k._tempM1.getElementByRowColumn($S,$i)+$w[$i]*$k._tempM1.getElementByRowColumn($S,$C))<Math.abs($a[$s]*$k._tempM0.getElementByRowColumn($q,$j)-$a[$q]*$k._tempM0.getElementByRowColumn($s,$j)))return 0}return 2},$_.intersectsRay=function($_,$S){$RS.scale(this.extents,-1,$k._tempV30),this.transformation.invert($k._tempM0),$RS.TransformNormal($_.direction,$k._tempM0,$k._ray.direction),$RS.transformCoordinate($_.origin,$k._tempM0,$k._ray.origin),$k._boxBound1.min=$k._tempV30,$k._boxBound1.max=this.extents;var $j=Collision.intersectsRayAndBoxRP($k._ray,$k._boxBound1,$S);return-1!==$j&&$RS.transformCoordinate($S,this.transformation,$S),$j},$_._getLocalCorners=function($_){$_.length=8;var $S=this.extents.elements;$k._tempV30.x=$S[0],$k._tempV31.y=$S[1],$k._tempV32.z=$S[2],$RS.add($k._tempV30,$k._tempV31,$k._tempV33),$RS.add($k._tempV33,$k._tempV32,$_[0]),$RS.add($k._tempV30,$k._tempV31,$k._tempV33),$RS.subtract($k._tempV33,$k._tempV32,$_[1]),$RS.subtract($k._tempV31,$k._tempV30,$k._tempV33),$RS.subtract($k._tempV33,$k._tempV30,$_[2]),$RS.subtract($k._tempV31,$k._tempV30,$k._tempV33),$RS.add($k._tempV33,$k._tempV32,$_[3]),$RS.subtract($k._tempV30,$k._tempV31,$k._tempV33),$RS.add($k._tempV33,$k._tempV32,$_[4]),$RS.subtract($k._tempV30,$k._tempV31,$k._tempV33),$RS.subtract($k._tempV33,$k._tempV32,$_[5]),$RS.scale($_[0],-1,$_[6]),$RS.subtract($k._tempV32,$k._tempV30,$k._tempV33),$RS.subtract($k._tempV33,$k._tempV31,$_[7])},$_.equals=function($_){return this.extents==$_.extents&&this.transformation==$_.transformation},$_.cloneTo=function($_){var $S=$_;this.extents.cloneTo($S.extents),this.transformation.cloneTo($S.transformation)},$k.createByBoundBox=function($_,$S){var $j=$_.min,$O=$_.max;$RS.subtract($O,$j,$k._tempV30),$RS.scale($k._tempV30,.5,$k._tempV30),$RS.add($j,$k._tempV30,$k._tempV31),$RS.subtract($O,$k._tempV31,$k._tempV32),$_S.translation($k._tempV31,$k._tempM0);var $V=$k._tempV32.clone(),$M=$k._tempM0.clone();$S.extents=$V,$S.transformation=$M},$k.createByMinAndMaxVertex=function($_,$S){return $RS.subtract($S,$_,$k._tempV30),$RS.scale($k._tempV30,.5,$k._tempV30),$RS.add($_,$k._tempV30,$k._tempV31),$RS.subtract($S,$k._tempV31,$k._tempV32),$_S.translation($k._tempV31,$k._tempM0),new $k($k._tempV32,$k._tempM0)},$k._getRows=function($_,$S){$S.length=3;var $j=$_.elements,$O=$S[0].elements;$O[0]=$j[0],$O[1]=$j[1],$O[2]=$j[2];var $V=$S[1].elements;$V[0]=$j[4],$V[1]=$j[5],$V[2]=$j[6];var $M=$S[2].elements;$M[0]=$j[8],$M[1]=$j[9],$M[2]=$j[10]},$k.getObbtoObbMatrix4x4=function($_,$S,$j,$O){var $V=$_.transformation,$M=$S.transformation;if($j){$k._getRows($V,$k._rows1),$k._getRows($M,$k._rows2);for(var $R=0;$R<3;$R++)for(var $w=0;$w<3;$w++)$O.setElementByRowColumn($R,$w,$RS.dot($k._rows2[$R],$k._rows1[$w]));$S.getCenter($k._tempV30),$_.getCenter($k._tempV31),$RS.subtract($k._tempV30,$k._tempV31,$k._tempV32);var $a=$O.elements;$a[12]=$RS.dot($k._tempV32,$k._rows1[0]),$a[13]=$RS.dot($k._tempV32,$k._rows1[1]),$a[14]=$RS.dot($k._tempV32,$k._rows1[2]),$a[15]=1}else $V.invert($k._tempM0),$_S.multiply($M,$k._tempM0,$O)},$k.merge=function($_,$S,$j){var $O=$_.extents,$V=$_.transformation;$k.getObbtoObbMatrix4x4($_,$S,$j,$k._tempM0),$S._getLocalCorners($k._corners),$RS.transformCoordinate($k._corners[0],$k._tempM0,$k._corners[0]),$RS.transformCoordinate($k._corners[1],$k._tempM0,$k._corners[1]),$RS.transformCoordinate($k._corners[2],$k._tempM0,$k._corners[2]),$RS.transformCoordinate($k._corners[3],$k._tempM0,$k._corners[3]),$RS.transformCoordinate($k._corners[4],$k._tempM0,$k._corners[4]),$RS.transformCoordinate($k._corners[5],$k._tempM0,$k._corners[5]),$RS.transformCoordinate($k._corners[6],$k._tempM0,$k._corners[6]),$RS.transformCoordinate($k._corners[7],$k._tempM0,$k._corners[7]),$RS.scale($O,-1,$k._boxBound1.min),$O.cloneTo($k._boxBound1.max),$I_.createfromPoints($k._corners,$k._boxBound2),$I_.merge($k._boxBound2,$k._boxBound1,$k._boxBound3);var $M=$k._boxBound3.min,$R=$k._boxBound3.max;$RS.subtract($R,$M,$k._tempV30),$RS.scale($k._tempV30,.5,$k._tempV30),$RS.add($M,$k._tempV30,$k._tempV32),$RS.subtract($R,$k._tempV32,$O),$RS.transformCoordinate($k._tempV32,$V,$k._tempV33)},$q($k,["_tempV30",function(){return this._tempV30=new $RS},"_tempV31",function(){return this._tempV31=new $RS},"_tempV32",function(){return this._tempV32=new $RS},"_tempV33",function(){return this._tempV33=new $RS},"_tempV34",function(){return this._tempV34=new $RS},"_tempV35",function(){return this._tempV35=new $RS},"_tempV36",function(){return this._tempV36=new $RS},"_tempM0",function(){return this._tempM0=new $_S},"_tempM1",function(){return this._tempM1=new $_S},"_corners",function(){return this._corners=[new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS]},"_rows1",function(){return this._rows1=[new $RS,new $RS,new $RS]},"_rows2",function(){return this._rows2=[new $RS,new $RS,new $RS]},"_ray",function(){return this._ray=new $VS(new $RS,new $RS)},"_boxBound1",function(){return this._boxBound1=new $I_(new $RS,new $RS)},"_boxBound2",function(){return this._boxBound2=new $I_(new $RS,new $RS)},"_boxBound3",function(){return this._boxBound3=new $I_(new $RS,new $RS)}])}(),function(){function $H($_,$S){this.normal=null,this.distance=NaN,void 0===$S&&($S=0),this.normal=$_,this.distance=$S}return $C($H,"laya.d3.math.Plane"),$H.prototype.normalize=function(){var $_=this.normal.elements,$S=$_[0],$j=$_[1],$O=$_[2],$V=1/Math.sqrt($S*$S+$j*$j+$O*$O);$_[0]=$S*$V,$_[1]=$j*$V,$_[2]=$O*$V,this.distance*=$V},$H.createPlaneBy3P=function($_,$S,$j){var $O=$_.elements,$V=$S.elements,$M=$j.elements,$R=$V[0]-$O[0],$w=$V[1]-$O[1],$a=$V[2]-$O[2],$u=$M[0]-$O[0],$c=$M[1]-$O[1],$q=$M[2]-$O[2],$s=$w*$q-$a*$c,$C=$a*$u-$R*$q,$i=$R*$c-$w*$u,$v=1/Math.sqrt($s*$s+$C*$C+$i*$i),$Z=$s*$v,$o=$C*$v,$l=$i*$v,$k=$H._TEMPVec3.elements;$k[0]=$Z,$k[1]=$o,$k[2]=$l;var $z=-($Z*$O[0]+$o*$O[1]+$l*$O[2]);return new $H($H._TEMPVec3,$z)},$H.PlaneIntersectionType_Back=0,$H.PlaneIntersectionType_Front=1,$H.PlaneIntersectionType_Intersecting=2,$q($H,["_TEMPVec3",function(){return this._TEMPVec3=new $RS}]),$H}()),$jS=function(){function $V($_,$S,$j,$O){this.elements=new Float32Array(4),void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=1),this.elements[0]=$_,this.elements[1]=$S,this.elements[2]=$j,this.elements[3]=$O}$C($V,"laya.d3.math.Quaternion");var $_=$V.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.scaling=function($_,$S){var $j=$S.elements,$O=this.elements;$j[0]=$O[0]*$_,$j[1]=$O[1]*$_,$j[2]=$O[2]*$_,$j[3]=$O[3]*$_},$_.normalize=function($_){var $S=$_.elements,$j=this.elements,$O=$j[0],$V=$j[1],$M=$j[2],$R=$j[3],$w=$O*$O+$V*$V+$M*$M+$R*$R;0<$w&&($w=1/Math.sqrt($w),$S[0]=$O*$w,$S[1]=$V*$w,$S[2]=$M*$w,$S[3]=$R*$w)},$_.length=function(){var $_=this.elements,$S=$_[0],$j=$_[1],$O=$_[2],$V=$_[3];return Math.sqrt($S*$S+$j*$j+$O*$O+$V*$V)},$_.rotateX=function($_,$S){var $j=$S.elements,$O=this.elements;$_*=.5;var $V=$O[0],$M=$O[1],$R=$O[2],$w=$O[3],$a=Math.sin($_),$u=Math.cos($_);$j[0]=$V*$u+$w*$a,$j[1]=$M*$u+$R*$a,$j[2]=$R*$u-$M*$a,$j[3]=$w*$u-$V*$a},$_.rotateY=function($_,$S){var $j=$S.elements,$O=this.elements;$_*=.5;var $V=$O[0],$M=$O[1],$R=$O[2],$w=$O[3],$a=Math.sin($_),$u=Math.cos($_);$j[0]=$V*$u-$R*$a,$j[1]=$M*$u+$w*$a,$j[2]=$R*$u+$V*$a,$j[3]=$w*$u-$M*$a},$_.rotateZ=function($_,$S){var $j=$S.elements,$O=this.elements;$_*=.5;var $V=$O[0],$M=$O[1],$R=$O[2],$w=$O[3],$a=Math.sin($_),$u=Math.cos($_);$j[0]=$V*$u+$M*$a,$j[1]=$M*$u-$V*$a,$j[2]=$R*$u+$w*$a,$j[3]=$w*$u-$R*$a},$_.getYawPitchRoll=function($_){$RS.transformQuat($RS.ForwardRH,this,$V.TEMPVector31),$RS.transformQuat($RS.Up,this,$V.TEMPVector32);var $S=$V.TEMPVector32.elements;$V.angleTo($RS.ZERO,$V.TEMPVector31,$V.TEMPVector33);var $j=$V.TEMPVector33.elements;$j[0]==Math.PI/2?($j[1]=$V.arcTanAngle($S[2],$S[0]),$j[2]=0):$j[0]==-Math.PI/2?($j[1]=$V.arcTanAngle(-$S[2],-$S[0]),$j[2]=0):($_S.createRotationY(-$j[1],$V.TEMPMatrix0),$_S.createRotationX(-$j[0],$V.TEMPMatrix1),$RS.transformCoordinate($V.TEMPVector32,$V.TEMPMatrix0,$V.TEMPVector32),$RS.transformCoordinate($V.TEMPVector32,$V.TEMPMatrix1,$V.TEMPVector32),$j[2]=$V.arcTanAngle($S[1],-$S[0])),$j[1]<=-Math.PI&&($j[1]=Math.PI),$j[2]<=-Math.PI&&($j[2]=Math.PI),$j[1]>=Math.PI&&$j[2]>=Math.PI&&($j[1]=0,$j[2]=0,$j[0]=Math.PI-$j[0]);var $O=$_.elements;$O[0]=$j[1],$O[1]=$j[0],$O[2]=$j[2]},$_.invert=function($_){var $S=$_.elements,$j=this.elements,$O=$j[0],$V=$j[1],$M=$j[2],$R=$j[3],$w=$O*$O+$V*$V+$M*$M+$R*$R,$a=$w?1/$w:0;$S[0]=-$O*$a,$S[1]=-$V*$a,$S[2]=-$M*$a,$S[3]=$R*$a},$_.identity=function(){var $_=this.elements;$_[0]=0,$_[1]=0,$_[2]=0,$_[3]=1},$_.fromArray=function($_,$S){void 0===$S&&($S=0),this.elements[0]=$_[$S+0],this.elements[1]=$_[$S+1],this.elements[2]=$_[$S+2],this.elements[3]=$_[$S+3]},$_.cloneTo=function($_){var $S,$j,$O;if(($j=this.elements)!==($O=$_.elements))for($S=0;$S<4;++$S)$O[$S]=$j[$S]},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$_.equals=function($_){var $S=this.elements,$j=$_.elements;return $r_.nearEqual($S[0],$j[0])&&$r_.nearEqual($S[1],$j[1])&&$r_.nearEqual($S[2],$j[2])&&$r_.nearEqual($S[3],$j[3])},$_.lengthSquared=function(){var $_=this.elements[0],$S=this.elements[1],$j=this.elements[2],$O=this.elements[3];return $_*$_+$S*$S+$j*$j+$O*$O},$i(0,$_,"x",function(){return this.elements[0]}),$i(0,$_,"y",function(){return this.elements[1]}),$i(0,$_,"z",function(){return this.elements[2]}),$i(0,$_,"w",function(){return this.elements[3]}),$V.createFromYawPitchRoll=function($_,$S,$j,$O){var $V=.5*$j,$M=.5*$S,$R=.5*$_,$w=Math.sin($V),$a=Math.cos($V),$u=Math.sin($M),$c=Math.cos($M),$q=Math.sin($R),$s=Math.cos($R),$C=$O.elements;$C[0]=$s*$u*$a+$q*$c*$w,$C[1]=$q*$c*$a-$s*$u*$w,$C[2]=$s*$c*$w-$q*$u*$a,$C[3]=$s*$c*$a+$q*$u*$w},$V.multiply=function($_,$S,$j){var $O=$_.elements,$V=$S.elements,$M=$j.elements,$R=$O[0],$w=$O[1],$a=$O[2],$u=$O[3],$c=$V[0],$q=$V[1],$s=$V[2],$C=$V[3],$i=$w*$s-$a*$q,$v=$a*$c-$R*$s,$Z=$R*$q-$w*$c,$o=$R*$c+$w*$q+$a*$s;$M[0]=$R*$C+$c*$u+$i,$M[1]=$w*$C+$q*$u+$v,$M[2]=$a*$C+$s*$u+$Z,$M[3]=$u*$C-$o},$V.arcTanAngle=function($_,$S){return 0==$_?1==$S?Math.PI/2:-Math.PI/2:0<$_?Math.atan($S/$_):$_<0?0<$S?Math.atan($S/$_)+Math.PI:Math.atan($S/$_)-Math.PI:0},$V.angleTo=function($_,$S,$j){$RS.subtract($S,$_,$V.TEMPVector30),$RS.normalize($V.TEMPVector30,$V.TEMPVector30),$j.elements[0]=Math.asin($V.TEMPVector30.y),$j.elements[1]=$V.arcTanAngle(-$V.TEMPVector30.z,-$V.TEMPVector30.x)},$V.createFromAxisAngle=function($_,$S,$j){var $O=$j.elements,$V=$_.elements;$S*=.5;var $M=Math.sin($S);$O[0]=$M*$V[0],$O[1]=$M*$V[1],$O[2]=$M*$V[2],$O[3]=Math.cos($S)},$V.createFromMatrix3x3=function($_,$S){var $j,$O=$S.elements,$V=$_.elements,$M=$V[0]+$V[4]+$V[8];if(0<$M)$j=Math.sqrt($M+1),$O[3]=.5*$j,$j=.5/$j,$O[0]=($V[5]-$V[7])*$j,$O[1]=($V[6]-$V[2])*$j,$O[2]=($V[1]-$V[3])*$j;else{var $R=0;$V[4]>$V[0]&&($R=1),$V[8]>$V[3*$R+$R]&&($R=2);var $w=($R+1)%3,$a=($R+2)%3;$j=Math.sqrt($V[3*$R+$R]-$V[3*$w+$w]-$V[3*$a+$a]+1),$O[$R]=.5*$j,$j=.5/$j,$O[3]=($V[3*$w+$a]-$V[3*$a+$w])*$j,$O[$w]=($V[3*$w+$R]+$V[3*$R+$w])*$j,$O[$a]=($V[3*$a+$R]+$V[3*$R+$a])*$j}},$V.createFromMatrix4x4=function($_,$S){var $j,$O,$V=$_.elements,$M=$S.elements,$R=$V[0]+$V[5]+$V[10];0<$R?($j=Math.sqrt($R+1),$M[3]=.5*$j,$j=.5/$j,$M[0]=($V[6]-$V[9])*$j,$M[1]=($V[8]-$V[2])*$j,$M[2]=($V[1]-$V[4])*$j):$V[0]>=$V[5]&&$V[0]>=$V[10]?($O=.5/($j=Math.sqrt(1+$V[0]-$V[5]-$V[10])),$M[0]=.5*$j,$M[1]=($V[1]+$V[4])*$O,$M[2]=($V[2]+$V[8])*$O,$M[3]=($V[6]-$V[9])*$O):$V[5]>$V[10]?($O=.5/($j=Math.sqrt(1+$V[5]-$V[0]-$V[10])),$M[0]=($V[4]+$V[1])*$O,$M[1]=.5*$j,$M[2]=($V[9]+$V[6])*$O,$M[3]=($V[8]-$V[2])*$O):($O=.5/($j=Math.sqrt(1+$V[10]-$V[0]-$V[5])),$M[0]=($V[8]+$V[2])*$O,$M[1]=($V[9]+$V[6])*$O,$M[2]=.5*$j,$M[3]=($V[1]-$V[4])*$O)},$V.slerp=function($_,$S,$j,$O){var $V,$M,$R,$w,$a,$u=$_.elements,$c=$S.elements,$q=$O.elements,$s=$u[0],$C=$u[1],$i=$u[2],$v=$u[3],$Z=$c[0],$o=$c[1],$l=$c[2],$k=$c[3];return($M=$s*$Z+$C*$o+$i*$l+$v*$k)<0&&($M=-$M,$Z=-$Z,$o=-$o,$l=-$l,$k=-$k),$a=1e-6<1-$M?($V=Math.acos($M),$R=Math.sin($V),$w=Math.sin((1-$j)*$V)/$R,Math.sin($j*$V)/$R):($w=1-$j,$j),$q[0]=$w*$s+$a*$Z,$q[1]=$w*$C+$a*$o,$q[2]=$w*$i+$a*$l,$q[3]=$w*$v+$a*$k,$q},$V.lerp=function($_,$S,$j,$O){var $V=$O.elements,$M=$_.elements,$R=$S.elements,$w=$M[0],$a=$M[1],$u=$M[2],$c=$M[3];$V[0]=$w+$j*($R[0]-$w),$V[1]=$a+$j*($R[1]-$a),$V[2]=$u+$j*($R[2]-$u),$V[3]=$c+$j*($R[3]-$c)},$V.add=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]+$M[0],$O[1]=$V[1]+$M[1],$O[2]=$V[2]+$M[2],$O[3]=$V[3]+$M[3]},$V.dot=function($_,$S){var $j=$_.elements,$O=$S.elements;return $j[0]*$O[0]+$j[1]*$O[1]+$j[2]*$O[2]+$j[3]*$O[3]},$V.rotationLookAt=function($_,$S,$j){$V.lookAt($RS.ZERO,$_,$S,$j)},$V.lookAt=function($_,$S,$j,$O){$b_.lookAt($_,$S,$j,$V._tempMatrix3x3),$V.rotationMatrix($V._tempMatrix3x3,$O)},$V.invert=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$_.lengthSquared();$r_.isZero($V)||($V=1/$V,$O[0]=-$j[0]*$V,$O[1]=-$j[1]*$V,$O[2]=-$j[2]*$V,$O[3]=$j[3]*$V)},$V.rotationMatrix=function($_,$S){var $j=$_.elements,$O=$j[0],$V=$j[1],$M=$j[2],$R=$j[3],$w=$j[4],$a=$j[5],$u=$j[6],$c=$j[7],$q=$j[8],$s=$S.elements,$C=NaN,$i=NaN,$v=$O+$w+$q;0<$v?($C=Math.sqrt($v+1),$s[3]=.5*$C,$C=.5/$C,$s[0]=($a-$c)*$C,$s[1]=($u-$M)*$C,$s[2]=($V-$R)*$C):$w<=$O&&$q<=$O?($i=.5/($C=Math.sqrt(1+$O-$w-$q)),$s[0]=.5*$C,$s[1]=($V+$R)*$i,$s[2]=($M+$u)*$i,$s[3]=($a-$c)*$i):$q<$w?($i=.5/($C=Math.sqrt(1+$w-$O-$q)),$s[0]=($R+$V)*$i,$s[1]=.5*$C,$s[2]=($c+$a)*$i,$s[3]=($u-$M)*$i):($i=.5/($C=Math.sqrt(1+$q-$O-$w)),$s[0]=($u+$M)*$i,$s[1]=($c+$a)*$i,$s[2]=.5*$C,$s[3]=($V-$R)*$i)},$V.DEFAULT=new $V,$q($V,["TEMPVector30",function(){return this.TEMPVector30=new $RS},"TEMPVector31",function(){return this.TEMPVector31=new $RS},"TEMPVector32",function(){return this.TEMPVector32=new $RS},"TEMPVector33",function(){return this.TEMPVector33=new $RS},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $_S},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $_S},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $b_},"NAN",function(){return this.NAN=new $V(NaN,NaN,NaN,NaN)}]),$V}(),$OS=function(){function $_($_){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$_,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$C($_,"laya.d3.math.Rand");var $S=$_.prototype;return $S.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$S.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$S.getSignedFloat=function(){return 2*this.getFloat()-1},$i(0,$S,"seed",function(){return this.seeds[0]},function($_){this.seeds[0]=$_,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$_.getFloatFromInt=function($_){return 1/8388607*(8388607&$_)},$_.getByteFromInt=function($_){return(8388607&$_)>>>15},$_}(),$VS=(function(){function $V($_){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($_ instanceof Array)||4!==$_.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$_[0],this._state0L=0|$_[1],this._state1U=0|$_[2],this._state1L=0|$_[3]}$C($V,"laya.d3.math.RandX");var $_=$V.prototype;$_.randomint=function(){var $_=this._state0U,$S=this._state0L,$j=this._state1U,$O=this._state1L,$V=($O>>>0)+($S>>>0),$M=$j+$_+($V/2>>>31)>>>0,$R=$V>>>0,$w=0,$a=0;$w=($_^=$w=$_<<23|(-512&$S)>>>9)^(this._state0U=$j),$a=($S^=$a=$S<<23)^(this._state0L=$O);$w^=$_>>>18,$a^=$S>>>18|(262143&$_)<<14;return $w^=$j>>>5,$a^=$O>>>5|(31&$j)<<27,this._state1U=$w,this._state1L=$a,[$M,$R]},$_.random=function(){var $_=this.randomint(),$S=$_[0],$j=1023<<20|$S>>>12,$O=0|($_[1]>>>12|(4095&$S)<<20);return $V._CONVERTION_BUFFER.setUint32(0,$j,!1),$V._CONVERTION_BUFFER.setUint32(4,$O,!1),$OS._CONVERTION_BUFFER.getFloat64(0,!1)-1},$q($V,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $OS([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $_($_,$S){this.origin=null,this.direction=null,this.origin=$_,this.direction=$S}return $C($_,"laya.d3.math.Ray"),$_}()),$MS=function(){function $_($_,$S){this.elements=new Float32Array(2),void 0===$_&&($_=0),void 0===$S&&($S=0);var $j=this.elements;$j[0]=$_,$j[1]=$S}$C($_,"laya.d3.math.Vector2");var $S=$_.prototype;return $H.imps($S,{"laya.d3.core.IClone":!0}),$S.fromArray=function($_,$S){void 0===$S&&($S=0),this.elements[0]=$_[$S+0],this.elements[1]=$_[$S+1]},$S.cloneTo=function($_){var $S=$_.elements,$j=this.elements;$S[0]=$j[0],$S[1]=$j[1]},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"x",function(){return this.elements[0]},function($_){this.elements[0]=$_}),$i(0,$S,"y",function(){return this.elements[1]},function($_){this.elements[1]=$_}),$_.scale=function($_,$S,$j){var $O=$j.elements,$V=$_.elements;$O[0]=$V[0]*$S,$O[1]=$V[1]*$S},$q($_,["ZERO",function(){return this.ZERO=new $_(0,0)},"ONE",function(){return this.ONE=new $_(1,1)}]),$_}(),$RS=function(){function $c($_,$S,$j){this.elements=new Float32Array(3),void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0);var $O=this.elements;$O[0]=$_,$O[1]=$S,$O[2]=$j}$C($c,"laya.d3.math.Vector3");var $_=$c.prototype;return $H.imps($_,{"laya.d3.core.IClone":!0}),$_.fromArray=function($_,$S){void 0===$S&&($S=0),this.elements[0]=$_[$S+0],this.elements[1]=$_[$S+1],this.elements[2]=$_[$S+2]},$_.cloneTo=function($_){var $S=$_.elements,$j=this.elements;$S[0]=$j[0],$S[1]=$j[1],$S[2]=$j[2]},$_.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$_.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$_.reset=function($_,$S,$j){this.elements[0]=$_,this.elements[1]=$S,this.elements[2]=$j},$i(0,$_,"x",function(){return this.elements[0]},function($_){this.elements[0]=$_}),$i(0,$_,"y",function(){return this.elements[1]},function($_){this.elements[1]=$_}),$i(0,$_,"z",function(){return this.elements[2]},function($_){this.elements[2]=$_}),$c.distanceSquared=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$j[0]-$O[0],$M=$j[1]-$O[1],$R=$j[2]-$O[2];return $V*$V+$M*$M+$R*$R},$c.distance=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$j[0]-$O[0],$M=$j[1]-$O[1],$R=$j[2]-$O[2];return Math.sqrt($V*$V+$M*$M+$R*$R)},$c.min=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=Math.min($V[0],$M[0]),$O[1]=Math.min($V[1],$M[1]),$O[2]=Math.min($V[2],$M[2])},$c.max=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=Math.max($V[0],$M[0]),$O[1]=Math.max($V[1],$M[1]),$O[2]=Math.max($V[2],$M[2])},$c.transformQuat=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements,$R=$V[0],$w=$V[1],$a=$V[2],$u=$M[0],$c=$M[1],$q=$M[2],$s=$M[3],$C=$s*$R+$c*$a-$q*$w,$i=$s*$w+$q*$R-$u*$a,$v=$s*$a+$u*$w-$c*$R,$Z=-$u*$R-$c*$w-$q*$a;$O[0]=$C*$s+$Z*-$u+$i*-$q-$v*-$c,$O[1]=$i*$s+$Z*-$c+$v*-$u-$C*-$q,$O[2]=$v*$s+$Z*-$q+$C*-$c-$i*-$u},$c.scalarLength=function($_){var $S=$_.elements,$j=$S[0],$O=$S[1],$V=$S[2];return Math.sqrt($j*$j+$O*$O+$V*$V)},$c.scalarLengthSquared=function($_){var $S=$_.elements,$j=$S[0],$O=$S[1],$V=$S[2];return $j*$j+$O*$O+$V*$V},$c.normalize=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$j[0],$M=$j[1],$R=$j[2],$w=$V*$V+$M*$M+$R*$R;0<$w&&($w=1/Math.sqrt($w),$O[0]=$j[0]*$w,$O[1]=$j[1]*$w,$O[2]=$j[2]*$w)},$c.multiply=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]*$M[0],$O[1]=$V[1]*$M[1],$O[2]=$V[2]*$M[2]},$c.scale=function($_,$S,$j){var $O=$j.elements,$V=$_.elements;$O[0]=$V[0]*$S,$O[1]=$V[1]*$S,$O[2]=$V[2]*$S},$c.lerp=function($_,$S,$j,$O){var $V=$O.elements,$M=$_.elements,$R=$S.elements,$w=$M[0],$a=$M[1],$u=$M[2];$V[0]=$w+$j*($R[0]-$w),$V[1]=$a+$j*($R[1]-$a),$V[2]=$u+$j*($R[2]-$u)},$c.transformV3ToV3=function($_,$S,$j){var $O=$c._tempVector4;$c.transformV3ToV4($_,$S,$O);var $V=$O.elements,$M=$j.elements;$M[0]=$V[0],$M[1]=$V[1],$M[2]=$V[2]},$c.transformV3ToV4=function($_,$S,$j){var $O=$_.elements,$V=$O[0],$M=$O[1],$R=$O[2],$w=$S.elements,$a=$j.elements;$a[0]=$V*$w[0]+$M*$w[4]+$R*$w[8]+$w[12],$a[1]=$V*$w[1]+$M*$w[5]+$R*$w[9]+$w[13],$a[2]=$V*$w[2]+$M*$w[6]+$R*$w[10]+$w[14],$a[3]=$V*$w[3]+$M*$w[7]+$R*$w[11]+$w[15]},$c.TransformNormal=function($_,$S,$j){var $O=$_.elements,$V=$O[0],$M=$O[1],$R=$O[2],$w=$S.elements,$a=$j.elements;$a[0]=$V*$w[0]+$M*$w[4]+$R*$w[8],$a[1]=$V*$w[1]+$M*$w[5]+$R*$w[9],$a[2]=$V*$w[2]+$M*$w[6]+$R*$w[10]},$c.transformCoordinate=function($_,$S,$j){var $O=$c._tempVector4.elements,$V=$_.elements,$M=$V[0],$R=$V[1],$w=$V[2],$a=$S.elements;$O[0]=$M*$a[0]+$R*$a[4]+$w*$a[8]+$a[12],$O[1]=$M*$a[1]+$R*$a[5]+$w*$a[9]+$a[13],$O[2]=$M*$a[2]+$R*$a[6]+$w*$a[10]+$a[14],$O[3]=1/($M*$a[3]+$R*$a[7]+$w*$a[11]+$a[15]);var $u=$j.elements;$u[0]=$O[0]*$O[3],$u[1]=$O[1]*$O[3],$u[2]=$O[2]*$O[3]},$c.Clamp=function($_,$S,$j,$O){var $V=$_.elements,$M=$V[0],$R=$V[1],$w=$V[2],$a=$S.elements,$u=$a[0],$c=$a[1],$q=$a[2],$s=$j.elements,$C=$s[0],$i=$s[1],$v=$s[2],$Z=$O.elements;$M=($M=$C<$M?$C:$M)<$u?$u:$M,$R=($R=$i<$R?$i:$R)<$c?$c:$R,$w=($w=$v<$w?$v:$w)<$q?$q:$w,$Z[0]=$M,$Z[1]=$R,$Z[2]=$w},$c.add=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]+$M[0],$O[1]=$V[1]+$M[1],$O[2]=$V[2]+$M[2]},$c.subtract=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]-$M[0],$O[1]=$V[1]-$M[1],$O[2]=$V[2]-$M[2]},$c.cross=function($_,$S,$j){var $O=$_.elements,$V=$S.elements,$M=$j.elements,$R=$O[0],$w=$O[1],$a=$O[2],$u=$V[0],$c=$V[1],$q=$V[2];$M[0]=$w*$q-$a*$c,$M[1]=$a*$u-$R*$q,$M[2]=$R*$c-$w*$u},$c.dot=function($_,$S){var $j=$_.elements,$O=$S.elements;return $j[0]*$O[0]+$j[1]*$O[1]+$j[2]*$O[2]},$c.equals=function($_,$S){var $j=$_.elements,$O=$S.elements;return $r_.nearEqual(Math.abs($j[0]),Math.abs($O[0]))&&$r_.nearEqual(Math.abs($j[1]),Math.abs($O[1]))&&$r_.nearEqual(Math.abs($j[2]),Math.abs($O[2]))},$c.ZERO=new $c(0,0,0),$c.ONE=new $c(1,1,1),$c.NegativeUnitX=new $c(-1,0,0),$c.UnitX=new $c(1,0,0),$c.UnitY=new $c(0,1,0),$c.UnitZ=new $c(0,0,1),$c.ForwardRH=new $c(0,0,-1),$c.ForwardLH=new $c(0,0,1),$c.Up=new $c(0,1,0),$c.NAN=new $c(NaN,NaN,NaN),$q($c,["_tempVector4",function(){return this._tempVector4=new $wS}]),$c}(),$wS=function(){function $_($_,$S,$j,$O){this.elements=new Float32Array(4),void 0===$_&&($_=0),void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=0);var $V=this.elements;$V[0]=$_,$V[1]=$S,$V[2]=$j,$V[3]=$O}$C($_,"laya.d3.math.Vector4");var $S=$_.prototype;return $H.imps($S,{"laya.d3.core.IClone":!0}),$S.fromArray=function($_,$S){void 0===$S&&($S=0),this.elements[0]=$_[$S+0],this.elements[1]=$_[$S+1],this.elements[2]=$_[$S+2],this.elements[3]=$_[$S+3]},$S.cloneTo=function($_){var $S=$_.elements,$j=this.elements;$S[0]=$j[0],$S[1]=$j[1],$S[2]=$j[2],$S[3]=$j[3]},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$S.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$S.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$i(0,$S,"x",function(){return this.elements[0]},function($_){this.elements[0]=$_}),$i(0,$S,"y",function(){return this.elements[1]},function($_){this.elements[1]=$_}),$i(0,$S,"z",function(){return this.elements[2]},function($_){this.elements[2]=$_}),$i(0,$S,"w",function(){return this.elements[3]},function($_){this.elements[3]=$_}),$_.lerp=function($_,$S,$j,$O){var $V=$O.elements,$M=$_.elements,$R=$S.elements,$w=$M[0],$a=$M[1],$u=$M[2],$c=$M[3];$V[0]=$w+$j*($R[0]-$w),$V[1]=$a+$j*($R[1]-$a),$V[2]=$u+$j*($R[2]-$u),$V[3]=$c+$j*($R[3]-$c)},$_.transformByM4x4=function($_,$S,$j){var $O=$_.elements,$V=$O[0],$M=$O[1],$R=$O[2],$w=$O[3],$a=$S.elements,$u=$j.elements;$u[0]=$V*$a[0]+$M*$a[4]+$R*$a[8]+$w*$a[12],$u[1]=$V*$a[1]+$M*$a[5]+$R*$a[9]+$w*$a[13],$u[2]=$V*$a[2]+$M*$a[6]+$R*$a[10]+$w*$a[14],$u[3]=$V*$a[3]+$M*$a[7]+$R*$a[11]+$w*$a[15]},$_.equals=function($_,$S){var $j=$_.elements,$O=$S.elements;return $r_.nearEqual(Math.abs($j[0]),Math.abs($O[0]))&&$r_.nearEqual(Math.abs($j[1]),Math.abs($O[1]))&&$r_.nearEqual(Math.abs($j[2]),Math.abs($O[2]))&&$r_.nearEqual(Math.abs($j[3]),Math.abs($O[3]))},$_.normalize=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$_.length();0<$V&&($O[0]=$j[0]*$V,$O[1]=$j[1]*$V,$O[2]=$j[2]*$V,$O[3]=$j[3]*$V)},$_.add=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]+$M[0],$O[1]=$V[1]+$M[1],$O[2]=$V[2]+$M[2],$O[3]=$V[3]+$M[3]},$_.subtract=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]-$M[0],$O[1]=$V[1]-$M[1],$O[2]=$V[2]-$M[2],$O[3]=$V[3]-$M[3]},$_.multiply=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=$V[0]*$M[0],$O[1]=$V[1]*$M[1],$O[2]=$V[2]*$M[2],$O[3]=$V[3]*$M[3]},$_.scale=function($_,$S,$j){var $O=$j.elements,$V=$_.elements;$O[0]=$V[0]*$S,$O[1]=$V[1]*$S,$O[2]=$V[2]*$S,$O[3]=$V[3]*$S},$_.Clamp=function($_,$S,$j,$O){var $V=$_.elements,$M=$V[0],$R=$V[1],$w=$V[2],$a=$V[3],$u=$S.elements,$c=$u[0],$q=$u[1],$s=$u[2],$C=$u[3],$i=$j.elements,$v=$i[0],$Z=$i[1],$o=$i[2],$l=$i[3],$k=$O.elements;$M=($M=$v<$M?$v:$M)<$c?$c:$M,$R=($R=$Z<$R?$Z:$R)<$q?$q:$R,$w=($w=$o<$w?$o:$w)<$s?$s:$w,$a=($a=$l<$a?$l:$a)<$C?$C:$a,$k[0]=$M,$k[1]=$R,$k[2]=$w,$k[3]=$a},$_.distanceSquared=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$j[0]-$O[0],$M=$j[1]-$O[1],$R=$j[2]-$O[2],$w=$j[3]-$O[3];return $V*$V+$M*$M+$R*$R+$w*$w},$_.distance=function($_,$S){var $j=$_.elements,$O=$S.elements,$V=$j[0]-$O[0],$M=$j[1]-$O[1],$R=$j[2]-$O[2],$w=$j[3]-$O[3];return Math.sqrt($V*$V+$M*$M+$R*$R+$w*$w)},$_.dot=function($_,$S){var $j=$_.elements,$O=$S.elements;return $j[0]*$O[0]+$j[1]*$O[1]+$j[2]*$O[2]+$j[3]*$O[3]},$_.min=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=Math.min($V[0],$M[0]),$O[1]=Math.min($V[1],$M[1]),$O[2]=Math.min($V[2],$M[2]),$O[3]=Math.min($V[3],$M[3])},$_.max=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S.elements;$O[0]=Math.max($V[0],$M[0]),$O[1]=Math.max($V[1],$M[1]),$O[2]=Math.max($V[2],$M[2]),$O[3]=Math.max($V[3],$M[3])},$q($_,["ZERO",function(){return this.ZERO=new $_},"ONE",function(){return this.ONE=new $_(1,1,1,1)},"UnitX",function(){return this.UnitX=new $_(1,0,0,0)},"UnitY",function(){return this.UnitY=new $_(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $_(0,0,1,0)},"UnitW",function(){return this.UnitW=new $_(0,0,0,1)}]),$_}(),$aS=function(){function $M($_,$S,$j,$O){this.minDepth=0,this.maxDepth=1,this.x=$_,this.y=$S,this.width=$j,this.height=$O}$C($M,"laya.d3.math.Viewport");var $_=$M.prototype;return $_.project=function($_,$S,$j){$RS.transformV3ToV3($_,$S,$j);var $O=$_.elements,$V=$S.elements,$M=$j.elements,$R=$O[0]*$V[3]+$O[1]*$V[7]+$O[2]*$V[11]+$V[15];1!==$R&&($M[0]=$M[0]/$R,$M[1]=$M[1]/$R,$M[2]=$M[2]/$R),$M[0]=.5*($M[0]+1)*this.width+this.x,$M[1]=.5*(1-$M[1])*this.height+this.y,$M[2]=$M[2]*(this.maxDepth-this.minDepth)+this.minDepth},$_.unprojectFromMat=function($_,$S,$j){var $O=$_.elements,$V=$S.elements,$M=$j.elements;$M[0]=($O[0]-this.x)/this.width*2-1,$M[1]=-(($O[1]-this.y)/this.height*2-1);var $R=(this.maxDepth-this.minDepth)/2;$M[2]=($O[2]-this.minDepth-$R)/$R;var $w=$M[0]*$V[3]+$M[1]*$V[7]+$M[2]*$V[11]+$V[15];$RS.transformV3ToV3($j,$S,$j),1!==$w&&($M[0]=$M[0]/$w,$M[1]=$M[1]/$w,$M[2]=$M[2]/$w)},$_.unprojectFromWVP=function($_,$S,$j,$O,$V){$_S.multiply($S,$j,$M._tempMatrix4x4),$O&&$_S.multiply($M._tempMatrix4x4,$O,$M._tempMatrix4x4),$M._tempMatrix4x4.invert($M._tempMatrix4x4),this.unprojectFromMat($_,$M._tempMatrix4x4,$V)},$q($M,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $_S}]),$M}(),$uS=function(){function $$($_){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$_,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$C($$,"laya.d3.resource.models.SubMesh");var $_=$$.prototype;return $H.imps($_,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$_._getVertexBuffer=function($_){return void 0===$_&&($_=0),0===$_?this._vertexBuffer:null},$_._getIndexBuffer=function(){return this._indexBuffer},$_._getStaticBatchBakedVertexs=function($_,$S){var $j,$O,$V=this._vertexBuffer,$M=$V.vertexDeclaration,$R=$M.getVertexElementByUsage(0).offset/4,$w=$M.getVertexElementByUsage(3).offset/4,$a=$S.meshRender.lightmapScaleOffset,$u=0,$c=0,$q=0,$s=0,$C=0,$i=0;if($a)if($O=$M.getVertexElementByUsage(15))$q=$M.vertexStride/4,$j=0<this._vertexCount?$V.getData().slice(this._vertexStart*$q,(this._vertexStart+this._vertexCount)*$q):$V.getData().slice(),$s=$O.offset/4;else{$q=($i=$M.vertexStride/4)+2,$j=this._vertexCount?new Float32Array(this._vertexCount*($V.vertexDeclaration.vertexStride/4+2)):new Float32Array($V.vertexCount*($V.vertexDeclaration.vertexStride/4+2)),$s=($C=$M.getVertexElementByUsage(2).offset/4)+2;var $v=$V.getData();for($u=0,$c=$v.length/$i;$u<$c;$u++){var $Z=0;$Z=0<this._vertexCount?(this._vertexStart+$u)*$i:$u*$i;var $o=$u*$q,$l=0;for($l=0;$l<$s;$l++)$j[$o+$l]=$v[$Z+$l];for($l=$s;$l<$i;$l++)$j[$o+$l+2]=$v[$Z+$l]}}else $q=$M.vertexStride/4,$j=this._vertexCount?$V.getData().slice(this._vertexStart*$q,(this._vertexStart+this._vertexCount)*$q):$V.getData().slice();if($_){var $k=$_.worldMatrix,$z=$$._tempMatrix4x40;$k.invert($z);var $H=$$._tempMatrix4x41,$A=$S.transform.worldMatrix;$_S.multiply($z,$A,$H)}else $H=$S.transform.worldMatrix;var $f=$$._tempQuaternion0;for($H.decomposeTransRotScale($$._tempVector30,$f,$$._tempVector31),$u=0,$c=$j.length/$q;$u<$c;$u++){var $y=$u*$q+$R,$P=$u*$q+$w;if($ZS.transformVector3ArrayToVector3ArrayCoordinate($j,$y,$H,$j,$y),$ZS.transformVector3ArrayByQuat($j,$P,$f,$j,$P),$a){var $g=$u*$q+$s;if($O)$ZS.transformLightingMapTexcoordByUV1Array($j,$g,$a,$j,$g);else{var $E=$u*$i+$C;$ZS.transformLightingMapTexcoordByUV0Array($v,$E,$a,$j,$g)}}}return $j},$_._getVertexBuffers=function(){return null},$_._beforeRender=function($_){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$_._render=function($_){var $S,$j=0,$O=$_.renderElement;if(1<this._indexCount){var $V=this._boneIndicesList.length;if(1<$V){for(var $M=0;$M<$V;$M++)($S=$O._skinAnimationDatas||this._skinAnimationDatas)&&($O._shaderValue.setValue(0,$S[$M]),$_._shader.uploadRenderElementUniforms($O._shaderValue.data)),$d.mainContext.drawElements(4,this._subIndexBufferCount[$M],5123,2*this._subIndexBufferStart[$M]);$y.drawCall+=$V}else($S=$O._skinAnimationDatas||this._skinAnimationDatas)&&($O._shaderValue.setValue(0,$S[0]),$_._shader.uploadRenderElementUniforms($O._shaderValue.data)),$d.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$y.drawCall++;$j=this._indexCount}else $j=this._indexBuffer.indexCount,($S=$O._skinAnimationDatas||this._skinAnimationDatas)&&($O._shaderValue.setValue(0,$S[0]),$_._shader.uploadRenderElementUniforms($O._shaderValue.data)),$d.mainContext.drawElements(4,$j,5123,0),$y.drawCall++;$y.trianglesFaces+=$j/3},$_.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$_.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$i(0,$_,"_vertexBufferCount",function(){return 1}),$i(0,$_,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$q($$,["_tempVector30",function(){return this._tempVector30=new $RS},"_tempVector31",function(){return this._tempVector31=new $RS},"_tempQuaternion0",function(){return this._tempQuaternion0=new $jS},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $_S},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $_S}]),$$}(),$cS=function(){function $_($_){this.defineCounter=0,this.defines=null,$_?(this.defineCounter=$_.defineCounter,this.defines=$_.defines.slice()):(this.defineCounter=0,this.defines=[])}return $C($_,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$_.prototype.registerDefine=function($_){var $S=Math.pow(2,this.defineCounter++);return this.defines[$S]=$_,$S},$_}(),$qS=function(){function $_(){}return $C($_,"laya.d3.shader.ShaderInit3D"),$_.__init__=function(){var $_,$S;$yS._globalRegDefine("HIGHPRECISION",$yS.SHADERDEFINE_HIGHPRECISION),$yS._globalRegDefine("FOG",$yS.SHADERDEFINE_FOG),$yS._globalRegDefine("DIRECTIONLIGHT",$yS.SHADERDEFINE_DIRECTIONLIGHT),$yS._globalRegDefine("POINTLIGHT",$yS.SHADERDEFINE_POINTLIGHT),$yS._globalRegDefine("SPOTLIGHT",$yS.SHADERDEFINE_SPOTLIGHT),$yS._globalRegDefine("UV",$yS.SHADERDEFINE_UV0),$yS._globalRegDefine("COLOR",$yS.SHADERDEFINE_COLOR),$yS._globalRegDefine("UV1",$yS.SHADERDEFINE_UV1),$yS._globalRegDefine("CASTSHADOW",$CS.SHADERDEFINE_CAST_SHADOW),$yS._globalRegDefine("SHADOWMAP_PSSM1",$CS.SHADERDEFINE_SHADOW_PSSM1),$yS._globalRegDefine("SHADOWMAP_PSSM2",$CS.SHADERDEFINE_SHADOW_PSSM2),$yS._globalRegDefine("SHADOWMAP_PSSM3",$CS.SHADERDEFINE_SHADOW_PSSM3),$yS._globalRegDefine("SHADOWMAP_PCF_NO",$CS.SHADERDEFINE_SHADOW_PCF_NO),$yS._globalRegDefine("SHADOWMAP_PCF1",$CS.SHADERDEFINE_SHADOW_PCF1),$yS._globalRegDefine("SHADOWMAP_PCF2",$CS.SHADERDEFINE_SHADOW_PCF2),$yS._globalRegDefine("SHADOWMAP_PCF3",$CS.SHADERDEFINE_SHADOW_PCF3),$yS._globalRegDefine("DEPTHFOG",$yS.SAHDERDEFINE_DEPTHFOG),$NS.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$NS.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$_={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$S={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $j=$NS.nameKey.add("SIMPLE");shaderCompile=$yS.add($j,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$_,$S),$BS.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$BS.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$BS.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$BS.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$BS.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$BS.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$BS.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$BS.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$BS.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$_}(),$sS=function(){function $_(){this._data=null,this._data=[]}$C($_,"laya.d3.shader.ValusArray");var $S=$_.prototype;return $S.setValue=function($_,$S){this._data[$_]=$S},$i(0,$S,"data",function(){return this._data}),$_}(),$CS=function(){function $_(){}return $_.SHADERDEFINE_RECEIVE_SHADOW=1,$_.SHADERDEFINE_CAST_SHADOW=512,$_.SHADERDEFINE_SHADOW_PSSM1=1024,$_.SHADERDEFINE_SHADOW_PSSM2=2048,$_.SHADERDEFINE_SHADOW_PSSM3=4096,$_.SHADERDEFINE_SHADOW_PCF_NO=8192,$_.SHADERDEFINE_SHADOW_PCF1=16384,$_.SHADERDEFINE_SHADOW_PCF2=32768,$_.SHADERDEFINE_SHADOW_PCF3=65536,$_.MAX_PSSM_COUNT=3,$_}(),$iS=function(){function $W(){}return $C($W,"laya.d3.utils.Picker"),$W.calculateCursorRay=function($_,$S,$j,$O,$V,$M){var $R=$_.elements[0],$w=$_.elements[1],$a=$W._tempVector30,$u=$a.elements;$u[0]=$R,$u[1]=$w,$u[2]=$S.minDepth;var $c=$W._tempVector31,$q=$c.elements;$q[0]=$R,$q[1]=$w,$q[2]=$S.maxDepth;var $s=$M.origin,$C=$W._tempVector32;$S.unprojectFromWVP($a,$j,$O,$V,$s),$S.unprojectFromWVP($c,$j,$O,$V,$C);var $i=$M.direction.elements;$i[0]=$C.x-$s.x,$i[1]=$C.y-$s.y,$i[2]=$C.z-$s.z,$RS.normalize($M.direction,$M.direction)},$W.rayIntersectsPositionsAndIndices=function($_,$S,$j,$O,$V){for(var $M=$j.vertexStride/4,$R=$j.getVertexElementByUsage(0).offset/4,$w=Number.MAX_VALUE,$a=-1,$u=-1,$c=-1,$q=0;$q<$O.length;$q+=3){var $s=$W._tempVector35,$C=$s.elements,$i=$O[$q]*$M,$v=$i+$R;$C[0]=$S[$v],$C[1]=$S[1+$v],$C[2]=$S[2+$v];var $Z=$W._tempVector36,$o=$Z.elements,$l=$O[$q+1]*$M,$k=$l+$R;$o[0]=$S[$k],$o[1]=$S[1+$k],$o[2]=$S[2+$k];var $z=$W._tempVector37,$H=$z.elements,$A=$O[$q+2]*$M,$f=$A+$R;$H[0]=$S[$f],$H[1]=$S[1+$f],$H[2]=$S[2+$f];var $y=laya.d3.utils.Picker.rayIntersectsTriangle($_,$s,$Z,$z);!isNaN($y)&&$y<$w&&($w=$y,$a=$i,$u=$l,$c=$A)}if($w===Number.MAX_VALUE)return $V.position.toDefault(),$V.distance=Number.MAX_VALUE,$V.trianglePositions[0].toDefault(),$V.trianglePositions[1].toDefault(),$V.trianglePositions[2].toDefault(),$V.triangleNormals[0].toDefault(),$V.triangleNormals[1].toDefault(),$V.triangleNormals[2].toDefault(),!1;$V.distance=$w,$RS.scale($_.direction,$w,$V.position),$RS.add($_.origin,$V.position,$V.position);var $P=$V.trianglePositions,$g=$P[0],$E=$P[1],$$=$P[2],$d=$g.elements,$n=$E.elements,$J=$$.elements,$F=$a+$R;$d[0]=$S[$F],$d[1]=$S[$F+1],$d[2]=$S[$F+2];var $x=$u+$R;$n[0]=$S[$x],$n[1]=$S[$x+1],$n[2]=$S[$x+2];var $h=$c+$R;$J[0]=$S[$h],$J[1]=$S[$h+1],$J[2]=$S[$h+2];var $N=$j.getVertexElementByUsage(3);if($N){var $B=$N.offset/4,$t=$V.triangleNormals,$m=$t[0],$e=$t[1],$G=$t[2],$D=$m.elements,$L=$e.elements,$U=$G.elements,$Q=$a+$B;$D[0]=$S[$Q],$D[1]=$S[$Q+1],$D[2]=$S[$Q+2];var $Y=$u+$B;$L[0]=$S[$Y],$L[1]=$S[$Y+1],$L[2]=$S[$Y+2];var $T=$c+$B;$U[0]=$S[$T],$U[1]=$S[$T+1],$U[2]=$S[$T+2]}return!0},$W.rayIntersectsTriangle=function($_,$S,$j,$O){var $V=$W._tempVector30,$M=$W._tempVector31;$RS.subtract($j,$S,$V),$RS.subtract($O,$S,$M);var $R,$w=$W._tempVector32;if($RS.cross($_.direction,$M,$w),($R=$RS.dot($V,$w))>-Number.MIN_VALUE&&$R<Number.MIN_VALUE)return Number.NaN;var $a,$u=1/$R,$c=$W._tempVector33;if($RS.subtract($_.origin,$S,$c),$a=$RS.dot($c,$w),($a*=$u)<0||1<$a)return Number.NaN;var $q,$s,$C=$W._tempVector34;return $RS.cross($c,$V,$C),$q=$RS.dot($_.direction,$C),($q*=$u)<0||1<$a+$q?Number.NaN:($s=$RS.dot($M,$C),($s*=$u)<0?Number.NaN:$s)},$q($W,["_tempVector30",function(){return this._tempVector30=new $RS},"_tempVector31",function(){return this._tempVector31=new $RS},"_tempVector32",function(){return this._tempVector32=new $RS},"_tempVector33",function(){return this._tempVector33=new $RS},"_tempVector34",function(){return this._tempVector34=new $RS},"_tempVector35",function(){return this._tempVector35=new $RS},"_tempVector36",function(){return this._tempVector36=new $RS},"_tempVector37",function(){return this._tempVector37=new $RS}]),$W}(),$vS=(function(){function $_(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $RS,new $RS,new $RS],this.trianglePositions.length=3,this.triangleNormals=[new $RS,new $RS,new $RS],this.triangleNormals.length=3,this.position=new $RS}$C($_,"laya.d3.utils.RaycastHit"),$_.prototype.cloneTo=function($_){$_.distance=this.distance,this.trianglePositions[0].cloneTo($_.trianglePositions[0]),this.trianglePositions[1].cloneTo($_.trianglePositions[1]),this.trianglePositions[2].cloneTo($_.trianglePositions[2]),this.triangleNormals[0].cloneTo($_.triangleNormals[0]),this.triangleNormals[1].cloneTo($_.triangleNormals[1]),this.triangleNormals[2].cloneTo($_.triangleNormals[2]),this.position.cloneTo($_.position),$_.sprite3D=this.sprite3D}}(),function(){function $_($_,$S){this._width=0,this._height=0,this._width=$_,this._height=$S}$C($_,"laya.d3.utils.Size");var $S=$_.prototype;return $i(0,$S,"width",function(){return-1===this._width?$p.clientWidth:this._width}),$i(0,$S,"height",function(){return-1===this._height?$p.clientHeight:this._height}),$i(1,$_,"fullScreen",function(){return new $_(-1,-1)}),$_}()),$ZS=function(){function $F(){}return $C($F,"laya.d3.utils.Utils3D"),$F._rotationTransformScaleSkinAnimation=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q){var $s,$C,$i,$v,$Z,$o=$F._tempArray16_0,$l=$F._tempArray16_1,$k=$F._tempArray16_2,$z=$O+$O,$H=$V+$V,$A=$M+$M,$f=$O*$z,$y=$V*$z,$P=$V*$H,$g=$M*$z,$E=$M*$H,$$=$M*$A,$d=$R*$z,$n=$R*$H,$J=$R*$A;for($o[15]=1,$o[0]=1-$P-$$,$o[1]=$y+$J,$o[2]=$g-$n,$o[4]=$y-$J,$o[5]=1-$f-$$,$o[6]=$E+$d,$o[8]=$g+$n,$o[9]=$E-$d,$o[10]=1-$f-$P,$l[15]=1,$l[0]=$w,$l[5]=$a,$l[10]=$u,$s=0;$s<4;$s++)$C=$o[$s],$i=$o[$s+4],$v=$o[$s+8],$Z=$o[$s+12],$k[$s]=$C,$k[$s+4]=$i,$k[$s+8]=$v,$k[$s+12]=$C*$_+$i*$S+$v*$j+$Z;for($s=0;$s<4;$s++)$C=$k[$s],$i=$k[$s+4],$v=$k[$s+8],$Z=$k[$s+12],$c[$s+$q]=$C*$l[0]+$i*$l[1]+$v*$l[2]+$Z*$l[3],$c[$s+$q+4]=$C*$l[4]+$i*$l[5]+$v*$l[6]+$Z*$l[7],$c[$s+$q+8]=$C*$l[8]+$i*$l[9]+$v*$l[10]+$Z*$l[11],$c[$s+$q+12]=$C*$l[12]+$i*$l[13]+$v*$l[14]+$Z*$l[15]},$F._createNodeByJson=function($_,$S,$j,$O){if(!$j)switch($S.type){case"Sprite3D":$j=new $hS;break;case"MeshSprite3D":$j=new $WS;break;case"SkinnedMeshSprite3D":$j=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$j=new ShuriKenParticle3D;break;case"TrailSprite3D":$j=new TrailSprite3D;break;case"Terrain":$j=new Terrain;break;case"Camera":$j=new $TS;break;case"DirectionLight":$j=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $V=$S.props;if($V)for(var $M in $V)$j[$M]=$V[$M];var $R=$S.customProps;$R&&($j instanceof laya.d3.core.Sprite3D?($j._parseBaseCustomProps($R),$j._parseCustomProps($_,$O,$R,$S),$j._parseCustomComponent($_,$O,$S.components)):$j._parseCustomProps($_,$O,$R,$S));var $w=$S.child;if($w)for(var $a=0,$u=$w.length;$a<$u;$a++){var $c=$F._createNodeByJson($_,$w[$a],null,$O);$j.addChild($c)}return $j},$F._computeBoneAndAnimationDatasByBindPoseMatrxix=function($_,$S,$j,$O,$V,$M){var $R,$w,$a=0,$u=0,$c=$_.length;for($R=0;$R<$c;$a+=$_[$R].keyframeWidth,$u+=16,$R++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($S[$a+0],$S[$a+1],$S[$a+2],$S[$a+3],$S[$a+4],$S[$a+5],$S[$a+6],$S[$a+7],$S[$a+8],$S[$a+9],$O,$u),0!=$R&&($w=16*$_[$R].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($O,$w,$O,$u,$O,$u));var $q=$j.length;for($R=0;$R<$q;$R++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($O,16*$M[$R],$j[$R],$V,16*$R)},$F._computeAnimationDatasByArrayAndMatrixFast=function($_,$S,$j,$O){for(var $V=0,$M=$_.length;$V<$M;$V++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($S,16*$O[$V],$_[$V],$j,16*$V)},$F._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($_,$S,$j,$O,$V){var $M,$R,$w=0,$a=0,$u=$_.length;for($M=0;$M<$u;$w+=$_[$M].keyframeWidth,$a+=16,$M++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($S[$w+7],$S[$w+8],$S[$w+9],$S[$w+3],$S[$w+4],$S[$w+5],$S[$w+6],$S[$w+0],$S[$w+1],$S[$w+2],$O,$a),0!=$M&&($R=16*$_[$M].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($O,$R,$O,$a,$O,$a));var $c=$j.length;for($M=0;$M<$c;$M++){var $q=16*$M;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($O,$q,$j[$M],$V,$q)}},$F._computeAnimationDatasByArrayAndMatrixFastOld=function($_,$S,$j){for(var $O=$_.length,$V=0;$V<$O;$V++){var $M=16*$V;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($S,$M,$_[$V],$j,$M)}},$F._computeRootAnimationData=function($_,$S,$j){for(var $O=0,$V=0,$M=0,$R=$_.length;$O<$R;$V+=$_[$O].keyframeWidth,$M+=16,$O++)laya.d3.utils.Utils3D.createAffineTransformationArray($S[$V+0],$S[$V+1],$S[$V+2],$S[$V+3],$S[$V+4],$S[$V+5],$S[$V+6],$S[$V+7],$S[$V+8],$S[$V+9],$j,$M)},$F.transformVector3ArrayByQuat=function($_,$S,$j,$O,$V){var $M=$j.elements,$R=$_[$S],$w=$_[$S+1],$a=$_[$S+2],$u=$M[0],$c=$M[1],$q=$M[2],$s=$M[3],$C=$s*$R+$c*$a-$q*$w,$i=$s*$w+$q*$R-$u*$a,$v=$s*$a+$u*$w-$c*$R,$Z=-$u*$R-$c*$w-$q*$a;$O[$V]=$C*$s+$Z*-$u+$i*-$q-$v*-$c,$O[$V+1]=$i*$s+$Z*-$c+$v*-$u-$C*-$q,$O[$V+2]=$v*$s+$Z*-$q+$C*-$c-$i*-$u},$F.mulMatrixByArray=function($_,$S,$j,$O,$V,$M){var $R,$w,$a,$u,$c;if($V===$j){for($j=$F._tempArray16_3,$R=0;$R<16;++$R)$j[$R]=$V[$M+$R];$O=0}for($R=0;$R<4;$R++)$w=$_[$S+$R],$a=$_[$S+$R+4],$u=$_[$S+$R+8],$c=$_[$S+$R+12],$V[$M+$R]=$w*$j[$O+0]+$a*$j[$O+1]+$u*$j[$O+2]+$c*$j[$O+3],$V[$M+$R+4]=$w*$j[$O+4]+$a*$j[$O+5]+$u*$j[$O+6]+$c*$j[$O+7],$V[$M+$R+8]=$w*$j[$O+8]+$a*$j[$O+9]+$u*$j[$O+10]+$c*$j[$O+11],$V[$M+$R+12]=$w*$j[$O+12]+$a*$j[$O+13]+$u*$j[$O+14]+$c*$j[$O+15]},$F.mulMatrixByArrayFast=function($_,$S,$j,$O,$V,$M){var $R,$w,$a,$u,$c;for($R=0;$R<4;$R++)$w=$_[$S+$R],$a=$_[$S+$R+4],$u=$_[$S+$R+8],$c=$_[$S+$R+12],$V[$M+$R]=$w*$j[$O+0]+$a*$j[$O+1]+$u*$j[$O+2]+$c*$j[$O+3],$V[$M+$R+4]=$w*$j[$O+4]+$a*$j[$O+5]+$u*$j[$O+6]+$c*$j[$O+7],$V[$M+$R+8]=$w*$j[$O+8]+$a*$j[$O+9]+$u*$j[$O+10]+$c*$j[$O+11],$V[$M+$R+12]=$w*$j[$O+12]+$a*$j[$O+13]+$u*$j[$O+14]+$c*$j[$O+15]},$F.mulMatrixByArrayAndMatrixFast=function($_,$S,$j,$O,$V){var $M,$R,$w,$a,$u,$c=$j.elements,$q=$c[0],$s=$c[1],$C=$c[2],$i=$c[3],$v=$c[4],$Z=$c[5],$o=$c[6],$l=$c[7],$k=$c[8],$z=$c[9],$H=$c[10],$A=$c[11],$f=$c[12],$y=$c[13],$P=$c[14],$g=$c[15],$E=$S,$$=$S+4,$d=$S+8,$n=$S+12,$J=$V,$F=$V+4,$x=$V+8,$h=$V+12;for($M=0;$M<4;$M++)$R=$_[$E+$M],$w=$_[$$+$M],$a=$_[$d+$M],$u=$_[$n+$M],$O[$J+$M]=$R*$q+$w*$s+$a*$C+$u*$i,$O[$F+$M]=$R*$v+$w*$Z+$a*$o+$u*$l,$O[$x+$M]=$R*$k+$w*$z+$a*$H+$u*$A,$O[$h+$M]=$R*$f+$w*$y+$a*$P+$u*$g},$F.createAffineTransformationArray=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q){var $s=$O+$O,$C=$V+$V,$i=$M+$M,$v=$O*$s,$Z=$O*$C,$o=$O*$i,$l=$V*$C,$k=$V*$i,$z=$M*$i,$H=$R*$s,$A=$R*$C,$f=$R*$i;$c[$q+0]=(1-($l+$z))*$w,$c[$q+1]=($Z+$f)*$w,$c[$q+2]=($o-$A)*$w,$c[$q+3]=0,$c[$q+4]=($Z-$f)*$a,$c[$q+5]=(1-($v+$z))*$a,$c[$q+6]=($k+$H)*$a,$c[$q+7]=0,$c[$q+8]=($o+$A)*$u,$c[$q+9]=($k-$H)*$u,$c[$q+10]=(1-($v+$l))*$u,$c[$q+11]=0,$c[$q+12]=$_,$c[$q+13]=$S,$c[$q+14]=$j,$c[$q+15]=1},$F.transformVector3ArrayToVector3ArrayCoordinate=function($_,$S,$j,$O,$V){var $M=$F._tempArray4_0,$R=$_[$S+0],$w=$_[$S+1],$a=$_[$S+2],$u=$j.elements;$M[0]=$R*$u[0]+$w*$u[4]+$a*$u[8]+$u[12],$M[1]=$R*$u[1]+$w*$u[5]+$a*$u[9]+$u[13],$M[2]=$R*$u[2]+$w*$u[6]+$a*$u[10]+$u[14],$M[3]=1/($R*$u[3]+$w*$u[7]+$a*$u[11]+$u[15]),$O[$V+0]=$M[0]*$M[3],$O[$V+1]=$M[1]*$M[3],$O[$V+2]=$M[2]*$M[3]},$F.transformLightingMapTexcoordByUV0Array=function($_,$S,$j,$O,$V){var $M=$j.elements;$O[$V+0]=$_[$S+0]*$M[0]+$M[2],$O[$V+1]=($_[$S+1]-1)*$M[1]+$M[3]},$F.transformLightingMapTexcoordByUV1Array=function($_,$S,$j,$O,$V){var $M=$j.elements;$O[$V+0]=$_[$S+0]*$M[0]+$M[2],$O[$V+1]=1+$_[$S+1]*$M[1]+$M[3]},$F.getURLVerion=function($_){var $S=$_.indexOf("?");return 0<=$S?$_.substr($S):null},$F._quaternionCreateFromYawPitchRollArray=function($_,$S,$j,$O){var $V=.5*$j,$M=.5*$S,$R=.5*$_,$w=Math.sin($V),$a=Math.cos($V),$u=Math.sin($M),$c=Math.cos($M),$q=Math.sin($R),$s=Math.cos($R);$O[0]=$s*$u*$a+$q*$c*$w,$O[1]=$q*$c*$a-$s*$u*$w,$O[2]=$s*$c*$w-$q*$u*$a,$O[3]=$s*$c*$a+$q*$u*$w},$F._createAffineTransformationArray=function($_,$S,$j,$O){var $V=$S[0],$M=$S[1],$R=$S[2],$w=$S[3],$a=$V+$V,$u=$M+$M,$c=$R+$R,$q=$V*$a,$s=$V*$u,$C=$V*$c,$i=$M*$u,$v=$M*$c,$Z=$R*$c,$o=$w*$a,$l=$w*$u,$k=$w*$c,$z=$j[0],$H=$j[1],$A=$j[2];$O[0]=(1-($i+$Z))*$z,$O[1]=($s+$k)*$z,$O[2]=($C-$l)*$z,$O[3]=0,$O[4]=($s-$k)*$H,$O[5]=(1-($q+$Z))*$H,$O[6]=($v+$o)*$H,$O[7]=0,$O[8]=($C+$l)*$A,$O[9]=($v-$o)*$A,$O[10]=(1-($q+$i))*$A,$O[11]=0,$O[12]=$_[0],$O[13]=$_[1],$O[14]=$_[2],$O[15]=1},$F._mulMatrixArray=function($_,$S,$j,$O){var $V,$M,$R,$w,$a,$u=$S.elements,$c=$u[0],$q=$u[1],$s=$u[2],$C=$u[3],$i=$u[4],$v=$u[5],$Z=$u[6],$o=$u[7],$l=$u[8],$k=$u[9],$z=$u[10],$H=$u[11],$A=$u[12],$f=$u[13],$y=$u[14],$P=$u[15],$g=$O,$E=$O+4,$$=$O+8,$d=$O+12;for($V=0;$V<4;$V++)$M=$_[$V],$R=$_[$V+4],$w=$_[$V+8],$a=$_[$V+12],$j[$g+$V]=$M*$c+$R*$q+$w*$s+$a*$C,$j[$E+$V]=$M*$i+$R*$v+$w*$Z+$a*$o,$j[$$+$V]=$M*$l+$R*$k+$w*$z+$a*$H,$j[$d+$V]=$M*$A+$R*$f+$w*$y+$a*$P},$F.getYawPitchRoll=function($_,$S){$F.transformQuat($RS.ForwardRH,$_,$jS.TEMPVector31),$F.transformQuat($RS.Up,$_,$jS.TEMPVector32);var $j=$jS.TEMPVector32.elements;$F.angleTo($RS.ZERO,$jS.TEMPVector31,$jS.TEMPVector33);var $O=$jS.TEMPVector33.elements;$O[0]==Math.PI/2?($O[1]=$F.arcTanAngle($j[2],$j[0]),$O[2]=0):$O[0]==-Math.PI/2?($O[1]=$F.arcTanAngle(-$j[2],-$j[0]),$O[2]=0):($_S.createRotationY(-$O[1],$jS.TEMPMatrix0),$_S.createRotationX(-$O[0],$jS.TEMPMatrix1),$RS.transformCoordinate($jS.TEMPVector32,$jS.TEMPMatrix0,$jS.TEMPVector32),$RS.transformCoordinate($jS.TEMPVector32,$jS.TEMPMatrix1,$jS.TEMPVector32),$O[2]=$F.arcTanAngle($j[1],-$j[0])),$O[1]<=-Math.PI&&($O[1]=Math.PI),$O[2]<=-Math.PI&&($O[2]=Math.PI),$O[1]>=Math.PI&&$O[2]>=Math.PI&&($O[1]=0,$O[2]=0,$O[0]=Math.PI-$O[0]),$S[0]=$O[1],$S[1]=$O[0],$S[2]=$O[2]},$F.arcTanAngle=function($_,$S){return 0==$_?1==$S?Math.PI/2:-Math.PI/2:0<$_?Math.atan($S/$_):$_<0?0<$S?Math.atan($S/$_)+Math.PI:Math.atan($S/$_)-Math.PI:0},$F.angleTo=function($_,$S,$j){$RS.subtract($S,$_,$jS.TEMPVector30),$RS.normalize($jS.TEMPVector30,$jS.TEMPVector30),$j.elements[0]=Math.asin($jS.TEMPVector30.y),$j.elements[1]=$F.arcTanAngle(-$jS.TEMPVector30.z,-$jS.TEMPVector30.x)},$F.transformQuat=function($_,$S,$j){var $O=$j.elements,$V=$_.elements,$M=$S,$R=$V[0],$w=$V[1],$a=$V[2],$u=$M[0],$c=$M[1],$q=$M[2],$s=$M[3],$C=$s*$R+$c*$a-$q*$w,$i=$s*$w+$q*$R-$u*$a,$v=$s*$a+$u*$w-$c*$R,$Z=-$u*$R-$c*$w-$q*$a;$O[0]=$C*$s+$Z*-$u+$i*-$q-$v*-$c,$O[1]=$i*$s+$Z*-$c+$v*-$u-$C*-$q,$O[2]=$v*$s+$Z*-$q+$C*-$c-$i*-$u},$F.quaterionNormalize=function($_,$S){var $j=$_[0],$O=$_[1],$V=$_[2],$M=$_[3],$R=$j*$j+$O*$O+$V*$V+$M*$M;0<$R&&($R=1/Math.sqrt($R),$S[0]=$j*$R,$S[1]=$O*$R,$S[2]=$V*$R,$S[3]=$M*$R)},$F.matrix4x4MultiplyFFF=function($_,$S,$j){var $O,$V,$M,$R,$w;if($j===$S)for($S=new Float32Array(16),$O=0;$O<16;++$O)$S[$O]=$j[$O];for($O=0;$O<4;$O++)$V=$_[$O],$M=$_[$O+4],$R=$_[$O+8],$w=$_[$O+12],$j[$O]=$V*$S[0]+$M*$S[1]+$R*$S[2]+$w*$S[3],$j[$O+4]=$V*$S[4]+$M*$S[5]+$R*$S[6]+$w*$S[7],$j[$O+8]=$V*$S[8]+$M*$S[9]+$R*$S[10]+$w*$S[11],$j[$O+12]=$V*$S[12]+$M*$S[13]+$R*$S[14]+$w*$S[15]},$F.matrix4x4MultiplyMFM=function($_,$S,$j){$F.matrix4x4MultiplyFFF($_.elements,$S,$j.elements)},$q($F,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $RS},"_tempVector3_1",function(){return this._tempVector3_1=new $RS},"_tempVector3_2",function(){return this._tempVector3_2=new $RS},"_tempVector3_3",function(){return this._tempVector3_3=new $RS},"_tempVector3_4",function(){return this._tempVector3_4=new $RS},"_tempVector3_5",function(){return this._tempVector3_5=new $RS},"_tempVector3_6",function(){return this._tempVector3_6=new $RS},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$F}(),$oS=function(){function $n(){}return $C($n,"Laya3D"),$n._cancelLoadByUrl=function($_){$H.loader.cancelLoadByUrl($_),$n._innerFirstLevelLoaderManager.cancelLoadByUrl($_),$n._innerSecondLevelLoaderManager.cancelLoadByUrl($_),$n._innerThirdLevelLoaderManager.cancelLoadByUrl($_),$n._innerFourthLevelLoaderManager.cancelLoadByUrl($_)},$n._changeWebGLSize=function($_,$S){$d.onStageResize($_,$S),$p.clientWidth=$_,$p.clientHeight=$S},$n.__init__=function(){var $_=$S.createMap;$_.lh=[$hS,"SPRITE3DHIERARCHY"],$_.ls=[$xS,"SPRITE3DHIERARCHY"],$_.lm=[$DS,"MESH"],$_.lmat=[$BS,"MATERIAL"],$_.jpg=[$US,"nativeimage"],$_.jpeg=[$US,"nativeimage"],$_.png=[$US,"nativeimage"],$_.pkm=[$US,"arraybuffer"],$_.raw=[$eS,"arraybuffer"],$_.mipmaps=[$eS,"arraybuffer"],$o.parserMap.SPRITE3DHIERARCHY=$n._loadHierarchy,$o.parserMap.MESH=$n._loadMesh,$o.parserMap.MATERIAL=$n._loadMaterial,$o.parserMap.TEXTURECUBE=$n._loadTextureCube,$o.parserMap.TERRAIN=$n._loadTerrain,$n._innerFirstLevelLoaderManager.on("error",null,$n._eventLoadManagerError),$n._innerSecondLevelLoaderManager.on("error",null,$n._eventLoadManagerError),$n._innerThirdLevelLoaderManager.on("error",null,$n._eventLoadManagerError),$n._innerFourthLevelLoaderManager.on("error",null,$n._eventLoadManagerError)},$n.READ_BLOCK=function(){return $n._readData.pos+=4,!0},$n.READ_DATA=function(){return $n._DATA.offset=$n._readData.getUint32(),$n._DATA.size=$n._readData.getUint32(),!0},$n.READ_STRINGS=function(){var $_=[],$S={offset:0,size:0};$S.offset=$n._readData.getUint16(),$S.size=$n._readData.getUint16();$n._readData.pos;$n._readData.pos=$S.offset+$n._DATA.offset;for(var $j=0;$j<$S.size;$j++){var $O=$n._readData.readUTFString();-1===$O.lastIndexOf(".lmat")&&-1===$O.lastIndexOf(".lpbr")||$_.push($O)}return $_},$n.formatRelativePath=function($_,$S){var $j;if("."===$S.charAt(0)){for(var $O=($_+$S).split("/"),$V=0,$M=$O.length;$V<$M;$V++)if(".."==$O[$V]){var $R=$V-1;0<$R&&".."!==$O[$R]&&($O.splice($R,2),$V-=2)}$j=$O.join("/")}else $j=$_+$S;return null!=$$.customFormat&&($j=$$.customFormat($j,null)),$j},$n._eventLoadManagerError=function($_){$H.loader.event("error",$_)},$n._addHierarchyInnerUrls=function($_,$S,$j,$O,$V,$M){var $R=$n.formatRelativePath($O,$V);$j&&($R+=$j),$_.push({url:$R,clas:$M}),$S[$V]=$R},$n._getSprite3DHierarchyInnerUrls=function($_,$S,$j,$O,$V,$M,$R){var $w,$a=0,$u=0;switch($_.type){case"Scene":var $c=$_.customProps.lightmaps;for($a=0,$u=$c.length;$a<$u;$a++){var $q=$c[$a].replace(".exr",".png");$n._addHierarchyInnerUrls($O,$V,$M,$R,$q,$US)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $s;if($_.instanceParams)($s=$_.instanceParams.loadPath)&&$n._addHierarchyInnerUrls($S,$V,$M,$R,$s,$DS);else{($s=($w=$_.customProps).meshPath)&&$n._addHierarchyInnerUrls($S,$V,$M,$R,$s,$DS);var $C=$w.materials;if($C)for($a=0,$u=$C.length;$a<$u;$a++){for(var $i=$C[$a],$v=$i.type.split("."),$Z=$J.window,$o=0,$l=$v.length;$o<$l;++$o){$Z=$Z[this.clasPaths[$o]]}if("function"!=typeof $Z)throw"_getSprite3DHierarchyInnerUrls 错误: "+$i.type+" 不是类";$n._addHierarchyInnerUrls($j,$V,$M,$R,$i.path,$Z)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $k=($w=$_.customProps).meshPath;$k&&$n._addHierarchyInnerUrls($S,$V,$M,$R,$k,$DS);var $z=$w.material;if($z){$v=$z.type.split("."),$Z=$J.window;for($o=0,$l=$v.length;$o<$l;++$o){$Z=$Z[this.clasPaths[$o]]}$n._addHierarchyInnerUrls($j,$V,$M,$R,$z.path,$Z)}else{var $H=$w.materialPath;if($H)$n._addHierarchyInnerUrls($j,$V,$M,$R,$H,ShurikenParticleMaterial);else{var $A=$w.texturePath;$A&&$n._addHierarchyInnerUrls($O,$V,$M,$R,$A,$US)}}break;case"Terrain":$n._addHierarchyInnerUrls($O,$V,$M,$R,$_.customProps.dataPath,TerrainRes)}var $f=$_.components;for(var $y in $f){var $P=$f[$y];switch($y){case"Animator":var $g=$P.avatarPath;if($g)$n._addHierarchyInnerUrls($O,$V,$M,$R,$g,Avatar);else{var $E=$P.avatar;$E&&$n._addHierarchyInnerUrls($O,$V,$M,$R,$E.path,Avatar)}var $$=$P.clipPaths;for($a=0,$u=$$.length;$a<$u;$a++)$n._addHierarchyInnerUrls($O,$V,$M,$R,$$[$a],AnimationClip)}}var $d=$_.child;for($a=0,$u=$d.length;$a<$u;$a++)$n._getSprite3DHierarchyInnerUrls($d[$a],$S,$j,$O,$V,$M,$R)},$n._loadHierarchy=function($_){$_.on("loaded",null,$n._onHierarchylhLoaded,[$_,$_._class._getGroup()]),$_.load($_.url,"json",!1,null,!0)},$n._onHierarchylhLoaded=function($_,$S,$j){if($_._class.destroyed)$_.endLoad();else{var $O=$_.url,$V=$ZS.getURLVerion($O),$M=$$.getPath($O),$R=[],$w=[],$a=[],$u={};$n._getSprite3DHierarchyInnerUrls($j,$R,$w,$a,$u,$V,$M);var $c=$R.length+$w.length+$a.length,$q=$c+1,$s=1/$q;if($n._onProcessChange($_,0,$s,1),0<$a.length){var $C=$c/$q,$i=$E.create(null,$n._onProcessChange,[$_,$s,$C],!1);$n._innerFourthLevelLoaderManager.create($a,$E.create(null,$n._onHierarchyInnerForthLevResouLoaded,[$_,$S,$i,$j,$u,$R,$w,$s+$C*$a.length,$C]),$i,null,null,1,!0,$S)}else $n._onHierarchyInnerForthLevResouLoaded($_,$S,null,$j,$u,$R,$w,$s,$C)}},$n._onHierarchyInnerForthLevResouLoaded=function($_,$S,$j,$O,$V,$M,$R,$w,$a){if($_._class.destroyed)$_.endLoad();else if($j&&$j.recover(),0<$R.length){var $u=$E.create(null,$n._onProcessChange,[$_,$w,$a],!1);$n._innerSecondLevelLoaderManager.create($R,$E.create(null,$n._onHierarchyInnerSecondLevResouLoaded,[$_,$S,$u,$O,$V,$M,$w+$a*$R.length,$a]),$j,null,null,1,!0,$S)}else $n._onHierarchyInnerSecondLevResouLoaded($_,$S,null,$O,$V,$M,$w,$a)},$n._onHierarchyInnerSecondLevResouLoaded=function($_,$S,$j,$O,$V,$M,$R,$w){if($_._class.destroyed)$_.endLoad();else if($j&&$j.recover(),0<$M.length){var $a=$E.create(null,$n._onProcessChange,[$_,$R,$w],!1);$n._innerFirstLevelLoaderManager.create($M,$E.create(null,$n._onHierarchyInnerFirstLevResouLoaded,[$_,$a,$O,$V]),$j,null,null,1,!0,$S)}else $n._onHierarchyInnerFirstLevResouLoaded($_,null,$O,$V)},$n._onHierarchyInnerFirstLevResouLoaded=function($_,$S,$j,$O){$S&&$S.recover(),$_.endLoad([$j,$O])},$n._loadTerrain=function($_){$_.on("loaded",null,$n._onTerrainLtLoaded,[$_,$_._class._getGroup()]),$_.load($_.url,"json",!1,null,!0)},$n._onTerrainLtLoaded=function($_,$S,$j){if($_._class.destroyed)$_.endLoad();else{var $O,$V,$M=$_.url,$R=$ZS.getURLVerion($M),$w=$$.getPath($M),$a=[],$u={},$c=0,$q=0,$s=$j.heightData;$O=$s.url,$V=$n.formatRelativePath($w,$O),$R&&($V+=$R),$O=$u[$O]=$V;var $C=$j.detailTexture;for($c=0,$q=$C.length;$c<$q;$c++)$a.push({url:$C[$c].diffuse});var $i=$j.normalMap;for($c=0,$q=$i.length;$c<$q;$c++)$a.push({url:$i[$c]});var $v=$j.alphaMap;for($c=0,$q=$v.length;$c<$q;$c++)$a.push({url:$v[$c],params:[!1,!1,6408,!0]});for($c=0,$q=$a.length;$c<$q;$c++){var $Z=$a[$c].url;$V=$n.formatRelativePath($w,$Z),$R&&($V+=$R),$a[$c].url=$V,$u[$Z]=$V}var $o=$a.length,$l=$o+2,$k=1/$l;$n._onProcessChange($_,0,$k,1);var $z={heightMapLoaded:!1,texturesLoaded:!1},$H=$E.create(null,$n._onProcessChange,[$_,$k,$k],!1);$n._innerFourthLevelLoaderManager.create($O,$E.create(null,$n._onTerrainHeightMapLoaded,[$_,$H,$j,$u,$z]),$H,null,[$s.numX,$s.numZ,$s.bitType,$s.value],1,!0,$S);var $A=$E.create(null,$n._onProcessChange,[$_,2*$k,$o/$l],!1);$n._innerFourthLevelLoaderManager.create($a,$E.create(null,$n._onTerrainTexturesLoaded,[$_,$A,$j,$u,$z]),$A,null,null,1,!0,$S)}},$n._onTerrainHeightMapLoaded=function($_,$S,$j,$O,$V){$V.heightMapLoaded=!0,$V.texturesLoaded&&($_.endLoad([$j,$O]),$S.recover())},$n._onTerrainTexturesLoaded=function($_,$S,$j,$O,$V){$V.texturesLoaded=!0,$V.heightMapLoaded&&($_.endLoad([$j,$O]),$S.recover())},$n._loadMesh=function($_){$_.on("loaded",null,$n._onMeshLmLoaded,[$_,$_._class._getGroup()]),$_.load($_.url,"arraybuffer",!1,null,!0)},$n._onMeshLmLoaded=function($_,$S,$j){if($_._class.destroyed)$_.endLoad();else{var $O,$V,$M,$R=$_.url,$w=$ZS.getURLVerion($R),$a=$$.getPath($R),$u={},$c=0,$q=0;switch(($n._readData=new $A($j)).pos=0,$n._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $s=$n._readData.getUint32();$n._readData.pos=$n._readData.pos+4,$q=$n._readData.getUint16(),$n._readData.pos=$n._readData.pos+8*$q;var $C=$n._readData.getUint32();for($q=$n._readData.getUint16(),$n._readData.pos=$s+$C,$O=[],$c=0;$c<$q;$c++){var $i=$n._readData.readUTFString();-1!==$i.lastIndexOf(".lmat")&&$O.push($i)}break;default:for($n.READ_BLOCK(),$c=0;$c<2;$c++){var $v=$n._readData.getUint16(),$Z=$n._strings[$v],$o=$n["READ_"+$Z];if(null==$o)throw new Error("model file err,no this function:"+$v+" "+$Z);1===$c?$O=$o.call():$o.call()}}for($c=0,$M=$O.length;$c<$M;$c++){var $l=$O[$c];$V=$n.formatRelativePath($a,$l),$w&&($V+=$w),$O[$c]=$V,$u[$l]=$V}if(0<$O.length){$n._onProcessChange($_,0,.5,1);var $k=$E.create(null,$n._onProcessChange,[$_,.5,.5],!1);$n._innerSecondLevelLoaderManager.create($O,$E.create(null,$n._onMeshMateialLoaded,[$_,$k,$j,$u]),$k,null,null,1,!0,$S)}else $_.endLoad([$j,$u])}},$n._onMeshMateialLoaded=function($_,$S,$j,$O){$_.endLoad([$j,$O]),$S.recover()},$n._getMaterialTexturePath=function($_,$S,$j){var $O=$_.length-4;return $_.indexOf(".dds")!=$O&&$_.indexOf(".tga")!=$O&&$_.indexOf(".exr")!=$O&&$_.indexOf(".DDS")!=$O&&$_.indexOf(".TGA")!=$O&&$_.indexOf(".EXR")!=$O||($_=$_.substr(0,$O)+".png"),$_=$n.formatRelativePath($j,$_),$S&&($_+=$S),$_},$n._loadMaterial=function($_){$_.on("loaded",null,$n._onMaterilLmatLoaded,[$_,$_._class._getGroup()]),$_.load($_.url,"json",!1,null,!0)},$n._onMaterilLmatLoaded=function($_,$S,$j){if($_._class.destroyed)$_.endLoad();else{var $O,$V=$_.url,$M=$ZS.getURLVerion($V),$R=$$.getPath($V),$w=[],$a={},$u=$j.customProps,$c=$j.version;if($c)switch($c){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $q=$j.props.textures,$s=0,$C=$q.length;$s<$C;$s++){var $i=$q[$s],$v=$i.path;if($v){var $Z=$v.length-4;$v.indexOf(".exr")!=$Z&&$v.indexOf(".EXR")!=$Z||($v=$v.substr(0,$Z)+".png"),$O=$n.formatRelativePath($R,$v),$M&&($O+=$M),$w.push({url:$O,params:$i.params}),$a[$v]=$O}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $o=$u.diffuseTexture.texture2D;if($o&&($O=$n._getMaterialTexturePath($o,$M,$R),$w.push($O),$a[$o]=$O),$u.normalTexture){var $l=$u.normalTexture.texture2D;$l&&($O=$n._getMaterialTexturePath($l,$M,$R),$w.push($O),$a[$l]=$O)}if($u.specularTexture){var $k=$u.specularTexture.texture2D;$k&&($O=$n._getMaterialTexturePath($k,$M,$R),$w.push($O),$a[$k]=$O)}if($u.emissiveTexture){var $z=$u.emissiveTexture.texture2D;$z&&($O=$n._getMaterialTexturePath($z,$M,$R),$w.push($O),$a[$z]=$O)}if($u.ambientTexture){var $H=$u.ambientTexture.texture2D;$H&&($O=$n._getMaterialTexturePath($H,$M,$R),$w.push($O),$a[$H]=$O)}if($u.reflectTexture){var $A=$u.reflectTexture.texture2D;$A&&($O=$n._getMaterialTexturePath($A,$M,$R),$w.push($O),$a[$A]=$O)}}var $f=$w.length,$y=$f+1,$P=1/$y;if($n._onProcessChange($_,0,$P,1),0<$f){var $g=$E.create(null,$n._onProcessChange,[$_,$P,$f/$y],!1);$n._innerFourthLevelLoaderManager.create($w,$E.create(null,$n._onMateialTexturesLoaded,[$_,$g,$j,$a]),$g,$US,null,1,!0,$S)}else $n._onMateialTexturesLoaded($_,null,$j,null)}},$n._onMateialTexturesLoaded=function($_,$S,$j,$O){$_.endLoad([$j,$O]),$S&&$S.recover()},$n._loadTextureCube=function($_){$_.on("loaded",null,$n._onTextureCubeLtcLoaded,[$_]),$_.load($_.url,"json",!1,null,!0)},$n._onTextureCubeLtcLoaded=function($_,$S){if($_._class.destroyed)$_.endLoad();else{var $j=$$.getPath($_.url),$O=[$n.formatRelativePath($j,$S.px),$n.formatRelativePath($j,$S.nx),$n.formatRelativePath($j,$S.py),$n.formatRelativePath($j,$S.ny),$n.formatRelativePath($j,$S.pz),$n.formatRelativePath($j,$S.nz)];$n._onProcessChange($_,0,1/7,1);var $V=$E.create(null,$n._onProcessChange,[$_,1/7,6/7],!1);$n._innerFourthLevelLoaderManager.load($O,$E.create(null,$n._onTextureCubeImagesLoaded,[$_,$O,$V]),$V,"nativeimage")}},$n._onTextureCubeImagesLoaded=function($_,$S,$j){var $O=[];$O.length=6;for(var $V=0;$V<6;$V++){var $M=$S[$V];$O[$V]=$o.getRes($M),$o.clearRes($M)}$_.endLoad($O),$j.recover()},$n._onProcessChange=function($_,$S,$j,$O){($O=$S+$O*$j)<1&&$_.event("progress",$O)},$n.init=function($_,$S,$j,$O,$V,$M){if(void 0===$j&&($j=!1),void 0===$O&&($O=!1),void 0===$V&&($V=!0),void 0===$M&&($M=!0),$l.update3DLoop=function(){},$l.cancelLoadByUrl=function($_){$n._cancelLoadByUrl($_)},$a.isAntialias=$j,$a.isAlpha=$O,$a.premultipliedAlpha=$V,$a.isStencil=$M,!$d.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$l.changeWebGLSize=$n._changeWebGLSize,$v.is3DMode=!0,$H.init($_,$S),$F.__init__(),$qS.__init__(),$WS.__init__(),$G.__init__(),$n.__init__(),$R.maxTextureCount=2,($n.debugMode||$I.debugMode)&&($n._debugPhasorSprite=new $Y)},$n.HIERARCHY="SPRITE3DHIERARCHY",$n.MESH="MESH",$n.MATERIAL="MATERIAL",$n.PBRMATERIAL="PBRMTL",$n.TEXTURECUBE="TEXTURECUBE",$n.TERRAIN="TERRAIN",$n._readData=null,$n._debugPhasorSprite=null,$n.debugMode=!1,$q($n,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $S},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $S},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $S},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $S}]),$n}(),$lS=function($_){function $V($_){$V.__super.call(this),this._owner=$_,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$C($V,"laya.d3.animation.AnimationTransform3D",$M);var $S=$V.prototype;return $S._getlocalMatrix=function(){return this._localUpdate&&($ZS._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$S._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldTransform()}},$S._setWorldMatrixAndUpdate=function($_){if(this._worldMatrix=$_,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $S=this._getlocalMatrix(),$j=0;$j<16;++$j)this._worldMatrix[$j]=$S[$j];else $ZS.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$S._setWorldMatrixNoUpdate=function($_){this._worldMatrix=$_},$S._setWorldMatrixIgnoreUpdate=function($_){this._worldMatrix=$_,this._worldUpdate=!1},$S.getLocalPosition=function(){return this._localPosition},$S.setLocalPosition=function($_){if(this._parent)this._localPosition=$_,this._localUpdate=!0,this._onWorldTransform();else{var $S=this._entity.owner._transform,$j=this._entity.localPosition,$O=$j.elements;$O[0]=$_[0],$O[1]=$_[1],$O[2]=$_[2],$S.localPosition=$j}},$S.getLocalRotation=function(){if(this._localQuaternionUpdate){var $_=this._localRotationEuler;$ZS._quaternionCreateFromYawPitchRollArray($_[1]/$V._angleToRandin,$_[0]/$V._angleToRandin,$_[2]/$V._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$S.setLocalRotation=function($_){if(this._parent)this._localRotation=$_,$ZS.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $S=this._entity.owner._transform,$j=this._entity.localRotation,$O=$j.elements;$O[0]=$_[0],$O[1]=$_[1],$O[2]=$_[2],$O[3]=$_[3],$S.localRotation=$j}},$S.getLocalScale=function(){return this._localScale},$S.setLocalScale=function($_){if(this._parent)this._localScale=$_,this._localUpdate=!0,this._onWorldTransform();else{var $S=this._entity.owner._transform,$j=this._entity.localScale,$O=$j.elements;$O[0]=$_[0],$O[1]=$_[1],$O[2]=$_[2],$S.localScale=$j}},$S.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$ZS.getYawPitchRoll(this._localRotation,$V._tempVector3);var $_=$V._tempVector3,$S=this._localRotationEuler;$S[0]=$_[1]*$V._angleToRandin,$S[1]=$_[0]*$V._angleToRandin,$S[2]=$_[2]*$V._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$S.setLocalRotationEuler=function($_){if(this._parent)$ZS._quaternionCreateFromYawPitchRollArray($_[1]/$V._angleToRandin,$_[0]/$V._angleToRandin,$_[2]/$V._angleToRandin,this._localRotation),this._localRotationEuler=$_,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $S=this._entity.owner._transform,$j=this._entity.localRotationEuler,$O=$j.elements;$O[0]=$_[0],$O[1]=$_[1],$O[2]=$_[2],$S.localRotationEuler=$j}},$S.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$ZS.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $_=this._getlocalMatrix(),$S=0;$S<16;++$S)this._worldMatrix[$S]=$_[$S];this._worldUpdate=!1}return this._worldMatrix},$S.setParent=function($_){if(this._parent!==$_){if(this._parent){var $S=this._parent._childs,$j=$S.indexOf(this);$S.splice($j,1)}$_&&($_._childs.push(this),$_&&this._onWorldTransform()),this._parent=$_}},$q($V,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$V}(),$kS=function($_){function $S(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$S.__super.call(this),this._destroyed=!1,this._id=$S._uniqueIDCounter,$S._uniqueIDCounter++}$C($S,"laya.d3.component.Component3D",$M);var $j=$S.prototype;return $H.imps($j,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$j._initialize=function($_){this._owner=$_,this._enable=!0,this.started=!1,this._load($_)},$j._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$j._load=function($_){},$j._start=function($_){},$j._update=function($_){},$j._lateUpdate=function($_){},$j._preRenderUpdate=function($_){},$j._postRenderUpdate=function($_){},$j._unload=function($_){this.offAll()},$j._cloneTo=function($_){},$i(0,$j,"id",function(){return this._id}),$i(0,$j,"destroyed",function(){return this._destroyed}),$i(0,$j,"owner",function(){return this._owner}),$i(0,$j,"enable",function(){return this._enable},function($_){this._enable!==$_&&(this._enable=$_,this.event("enablechanged",this._enable))}),$i(0,$j,"isSingleton",function(){return $S._isSingleton}),$S._isSingleton=!0,$S._uniqueIDCounter=1,$S}(),$zS=function($_){function $S(){this._destroyed=!1,$S.__super.call(this),this._destroyed=!1}$C($S,"laya.d3.core.GeometryFilter",$M);var $j=$S.prototype;return $H.imps($j,{"laya.resource.IDestroy":!0}),$j._destroy=function(){this.offAll(),this._destroyed=!0},$i(0,$j,"_isAsyncLoaded",function(){return!0}),$i(0,$j,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$i(0,$j,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$i(0,$j,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$i(0,$j,"destroyed",function(){return this._destroyed}),$S}(),$HS=function($_){function $O($_){$O.__super.call(this),this._id=++$O._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $I_(new $RS,new $RS),this._boundingBoxCenter=new $RS,this._boundingSphere=new $X_(new $RS,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$_,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$C($O,"laya.d3.core.render.BaseRender",$M);var $S=$O.prototype;return $H.imps($S,{"laya.resource.IDestroy":!0}),$S._changeMaterialReference=function($_,$S){$_&&$_._removeReference(),$S._addReference()},$S._getInstanceMaterial=function($_,$S){var $j=new $_.constructor;return $_.cloneTo($j),$j.name=$j.name+"(Instance)",this._materialsInstance[$S]=!0,this._changeMaterialReference(this._materials[$S],$j),this._materials[$S]=$j},$S._setShaderValuelightMap=function($_){this._setShaderValueTexture(3,$_)},$S._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$S._renderRenderableBoundBox=function(){var $_=$oS._debugPhasorSprite,$S=this.boundingBox,$j=$O._tempBoundBoxCorners;$S.getCorners($j),$_.line($j[0],$O._greenColor,$j[1],$O._greenColor),$_.line($j[2],$O._greenColor,$j[3],$O._greenColor),$_.line($j[4],$O._greenColor,$j[5],$O._greenColor),$_.line($j[6],$O._greenColor,$j[7],$O._greenColor),$_.line($j[0],$O._greenColor,$j[3],$O._greenColor),$_.line($j[1],$O._greenColor,$j[2],$O._greenColor),$_.line($j[2],$O._greenColor,$j[6],$O._greenColor),$_.line($j[3],$O._greenColor,$j[7],$O._greenColor),$_.line($j[0],$O._greenColor,$j[4],$O._greenColor),$_.line($j[1],$O._greenColor,$j[5],$O._greenColor),$_.line($j[4],$O._greenColor,$j[7],$O._greenColor),$_.line($j[5],$O._greenColor,$j[6],$O._greenColor)},$S._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$S._calculateBoundingBox=function(){throw"BaseRender: must override it."},$S._setShaderValueTexture=function($_,$S){this._owner._shaderValues.setValue($_,$S)},$S._setShaderValueMatrix4x4=function($_,$S){this._owner._shaderValues.setValue($_,$S?$S.elements:null)},$S._setShaderValueColor=function($_,$S){this._owner._shaderValues.setValue($_,$S?$S.elements:null)},$S._setShaderValueBuffer=function($_,$S){this._owner._shaderValues.setValue($_,$S)},$S._setShaderValueInt=function($_,$S){this._owner._shaderValues.setValue($_,$S)},$S._setShaderValueBool=function($_,$S){this._owner._shaderValues.setValue($_,$S)},$S._setShaderValueNumber=function($_,$S){this._owner._shaderValues.setValue($_,$S)},$S._setShaderValueVector2=function($_,$S){this._owner._shaderValues.setValue($_,$S?$S.elements:null)},$S._addShaderDefine=function($_){this._owner._shaderDefineValue|=$_},$S._removeShaderDefine=function($_){this._owner._shaderDefineValue&=~$_},$S._renderUpdate=function($_){return!0},$S._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $_=this._owner.scene;if($_){var $S=$_.getlightmaps()[this._lightmapIndex];$S?(this._addShaderDefine($YS.SAHDERDEFINE_LIGHTMAP),$S.loaded?this._setShaderValuelightMap($S):$S.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($YS.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($YS.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($YS.SAHDERDEFINE_LIGHTMAP)},$S._updateOctreeNode=function(){var $_=this._treeNode;$_&&this._octreeNodeNeedChange&&($_.updateObject(this),this._octreeNodeNeedChange=!1)},$S._destroy=function(){this.offAll();var $_=0,$S=0;for($_=0,$S=this._renderElements.length;$_<$S;$_++)this._renderElements[$_]._destroy();for($_=0,$S=this._materials.length;$_<$S;$_++)this._materials[$_]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$i(0,$S,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$i(0,$S,"id",function(){return this._id}),$i(0,$S,"material",function(){var $_=this._materials[0];if($_&&!this._materialsInstance[0]){var $S=this._getInstanceMaterial($_,0);this.event("materialchanged",[this,0,$S])}return this._materials[0]},function($_){this.sharedMaterial=$_}),$i(0,$S,"sharedMaterial",function(){return this._materials[0]},function($_){var $S=this._materials[0];$S!==$_&&(this._materials[0]=$_,this._materialsInstance[0]=!1,this._changeMaterialReference($S,$_),this.event("materialchanged",[this,0,$_]))}),$i(0,$S,"lightmapIndex",function(){return this._lightmapIndex},function($_){this._lightmapIndex=$_,this._applyLightMapParams()}),$i(0,$S,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($_){this._lightmapScaleOffset=$_,this._setShaderValueColor(2,$_),this._addShaderDefine($YS.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$i(0,$S,"enable",function(){return this._enable},function($_){this._enable=$_,this.event("enablechanged",[this,$_])}),$i(0,$S,"materials",function(){for(var $_=0,$S=this._materials.length;$_<$S;$_++)if(!this._materialsInstance[$_]){var $j=this._getInstanceMaterial(this._materials[$_],$_);this.event("materialchanged",[this,$_,$j])}return this._materials.slice()},function($_){this.sharedMaterials=$_}),$i(0,$S,"sharedMaterials",function(){return this._materials.slice()},function($_){if(!$_)throw new Error("MeshRender: shadredMaterials value can't be null.");var $S=$_.length;this._materialsInstance.length=$S;for(var $j=0;$j<$S;$j++){var $O=this._materials[$j];$O!==$_[$j]&&(this._materialsInstance[$j]=!1,this._changeMaterialReference($O,$_[$j]),this.event("materialchanged",[this,$j,$_[$j]]))}this._materials=$_}),$i(0,$S,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$i(0,$S,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $_=this.boundingBox;$RS.add($_.min,$_.max,this._boundingBoxCenter),$RS.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$i(0,$S,"receiveShadow",function(){return this._receiveShadow},function($_){this._receiveShadow!==$_&&((this._receiveShadow=$_)?this._addShaderDefine($CS.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($CS.SHADERDEFINE_RECEIVE_SHADOW))}),$i(0,$S,"destroyed",function(){return this._destroyed}),$O._uniqueIDCounter=0,$q($O,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS,new $RS]},"_greenColor",function(){return this._greenColor=new $wS(0,1,0,1)}]),$O}(),$AS=function($_){function $w($_){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$w.__super.call(this),this._localPosition=new $RS,this._localRotation=new $jS(0,0,0,1),this._localScale=new $RS(1,1,1),this._localRotationEuler=new $RS,this._localMatrix=new $_S,this._position=new $RS,this._rotation=new $jS(0,0,0,1),this._scale=new $RS(1,1,1),this._worldMatrix=new $_S,this._forward=new $RS,this._up=new $RS,this._right=new $RS,this._owner=$_,this._childs=[]}$C($w,"laya.d3.core.Transform3D",$M);var $S=$w.prototype;return $S._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$_S.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $_=$w._tempVector30;$RS.multiply(this.pivot,this._localScale,$_);var $S=$w._tempVector31;$RS.subtract($_,this.pivot,$S);var $j=$w._tempVector32,$O=this.localRotation;$RS.transformQuat($_,$O,$j),$RS.subtract($j,$_,$j);var $V=$w._tempVector33;$RS.subtract(this._localPosition,$S,$V),$RS.subtract($V,$j,$V),$_S.createAffineTransformation($V,$O,this._localScale,this._localMatrix)}},$S._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldPositionRotationTransform()}},$S._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldPositionScaleTransform()}},$S._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldPositionTransform()}},$S._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldPositionRotationTransform()}},$S._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldPositionScaleTransform()}},$S._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._onWorldTransform()}},$S.translate=function($_,$S){void 0===$S&&($S=!0),$S?($_S.createFromQuaternion(this.localRotation,$w._tempMatrix0),$RS.transformCoordinate($_,$w._tempMatrix0,$w._tempVector30),$RS.add(this.localPosition,$w._tempVector30,this._localPosition),this.localPosition=this._localPosition):($RS.add(this.position,$_,this._position),this.position=this._position)},$S.rotate=function($_,$S,$j){var $O;void 0===$S&&($S=!0),void 0===$j&&($j=!0),$O=$j?$_:($RS.scale($_,Math.PI/180,$w._tempVector30),$w._tempVector30),$jS.createFromYawPitchRoll($O.y,$O.x,$O.z,$w._tempQuaternion0),$S?($jS.multiply(this._localRotation,$w._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($jS.multiply($w._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$S.lookAt=function($_,$S,$j){void 0===$j&&($j=!1);var $O,$V=$_.elements;if($j){if($O=this._localPosition.elements,Math.abs($O[0]-$V[0])<$r_.zeroTolerance&&Math.abs($O[1]-$V[1])<$r_.zeroTolerance&&Math.abs($O[2]-$V[2])<$r_.zeroTolerance)return;$jS.lookAt(this._localPosition,$_,$S,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $M=this.position;if($O=$M.elements,Math.abs($O[0]-$V[0])<$r_.zeroTolerance&&Math.abs($O[1]-$V[1])<$r_.zeroTolerance&&Math.abs($O[2]-$V[2])<$r_.zeroTolerance)return;$jS.lookAt($M,$_,$S,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$i(0,$S,"_isFrontFaceInvert",function(){var $_=this.scale,$S=$_.x<0;return $_.y<0&&($S=!$S),$_.z<0&&($S=!$S),$S}),$i(0,$S,"owner",function(){return this._owner}),$i(0,$S,"localRotation",function(){if(this._localQuaternionUpdate){var $_=this._localRotationEuler.elements;$jS.createFromYawPitchRoll($_[1]/$w._angleToRandin,$_[0]/$w._angleToRandin,$_[2]/$w._angleToRandin,this._localRotation)}return this._localRotation},function($_){this._localRotation=$_,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$i(0,$S,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$_S.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($_){null===this._parent?$_.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$_S.multiply(this._localMatrix,$_,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$_,this._worldUpdate=!1}),$i(0,$S,"worldNeedUpdate",function(){return this._worldUpdate}),$i(0,$S,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($_){this._localMatrix=$_,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$i(0,$S,"dummy",function(){return this._dummy},function($_){this._dummy!==$_&&(this._dummy&&(this._dummy._entity=null),$_&&($_._entity=this),this._dummy=$_)}),$i(0,$S,"localPosition",function(){return this._localPosition},function($_){this._localPosition=$_,this._localUpdate=!0,this._onWorldPositionTransform()}),$i(0,$S,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $_=this._parent.position;$RS.multiply(this._localPosition,this._parent.scale,$w._tempVector30),$RS.transformQuat($w._tempVector30,this._parent.rotation,$w._tempVector30),$RS.add($_,$w._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($_){if(null!=this._parent){$RS.subtract($_,this._parent.position,this._localPosition);var $S=this._parent.scale.elements,$j=$S[0],$O=$S[1],$V=$S[2];if(1!==$j||1!==$O||1!==$V){var $M=$w._tempVector30,$R=$M.elements;$R[0]=1/$j,$R[1]=1/$O,$R[2]=1/$V,$RS.multiply(this._localPosition,$M,this._localPosition)}this._parent.rotation.invert($w._tempQuaternion0),$RS.transformQuat(this._localPosition,$w._tempQuaternion0,this._localPosition)}else $_.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$_,this._positionUpdate=!1}),$i(0,$S,"localScale",function(){return this._localScale},function($_){this._localScale=$_,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$i(0,$S,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($w._tempVector30);var $_=$w._tempVector30.elements,$S=this._localRotationEuler.elements;$S[0]=$_[1]*$w._angleToRandin,$S[1]=$_[0]*$w._angleToRandin,$S[2]=$_[2]*$w._angleToRandin}return this._localRotationEuler},function($_){this._localRotationEuler=$_,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$i(0,$S,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$jS.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($_){null!=this._parent?(this._parent.rotation.invert($w._tempQuaternion0),$jS.multiply($_,$w._tempQuaternion0,this._localRotation)):$_.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$_,this._rotationUpdate=!1}),$i(0,$S,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$RS.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($_){if(null!==this._parent){var $S=this._parent.scale.elements,$j=$w._tempVector30.elements;$j[0]=1/$S[0],$j[1]=1/$S[1],$j[2]=1/$S[2],$RS.multiply($_,$w._tempVector30,this._localScale)}else $_.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$_,this._scaleUpdate=!1}),$i(0,$S,"rotationEuler",null,function($_){$jS.createFromYawPitchRoll($_.y,$_.x,$_.z,this._rotation),this.rotation=this._rotation}),$i(0,$S,"forward",function(){var $_=this.worldMatrix.elements;return this._forward.elements[0]=-$_[8],this._forward.elements[1]=-$_[9],this._forward.elements[2]=-$_[10],this._forward}),$i(0,$S,"up",function(){var $_=this.worldMatrix.elements;return this._up.elements[0]=$_[4],this._up.elements[1]=$_[5],this._up.elements[2]=$_[6],this._up}),$i(0,$S,"right",function(){var $_=this.worldMatrix.elements;return this._right.elements[0]=$_[0],this._right.elements[1]=$_[1],this._right.elements[2]=$_[2],this._right}),$i(0,$S,"parent",function(){return this._parent},function($_){if(this._parent!==$_){if(this._parent){var $S=this._parent._childs,$j=$S.indexOf(this);$S.splice($j,1)}$_&&($_._childs.push(this),$_&&this._onWorldTransform()),this._parent=$_}}),$q($w,["_tempVector30",function(){return this._tempVector30=new $RS},"_tempVector31",function(){return this._tempVector31=new $RS},"_tempVector32",function(){return this._tempVector32=new $RS},"_tempVector33",function(){return this._tempVector33=new $RS},"_tempQuaternion0",function(){return this._tempQuaternion0=new $jS},"_tempMatrix0",function(){return this._tempMatrix0=new $_S},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$w}(),$fS=(function($_){function $S(){this._rotation=0,this._matNeedUpdte=!1,$S.__super.call(this),this._matrix=new $_S,this._offset=new $MS,this._tiling=new $MS(1,1)}$C($S,"laya.d3.core.TransformUV",$M);var $j=$S.prototype;$H.imps($j,{"laya.d3.core.IClone":!0}),$j._updateMatrix=function(){$S._tempOffsetV3.elements[0]=this._offset.x,$S._tempOffsetV3.elements[1]=this._offset.y,$jS.createFromYawPitchRoll(0,0,this._rotation,$S._tempRotationQua),$S._tempTitlingV3.elements[0]=this._tiling.x,$S._tempTitlingV3.elements[1]=this._tiling.y,$_S.createAffineTransformation($S._tempOffsetV3,$S._tempRotationQua,$S._tempTitlingV3,this._matrix)},$j.cloneTo=function($_){$_._matrix=this._matrix.clone(),$_._offset=this._offset.clone(),$_._rotation=this._rotation,$_._tiling=this._tiling.clone()},$j.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$j,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$i(0,$j,"tiling",function(){return this._tiling},function($_){this._tiling=$_,this._matNeedUpdte=!0}),$i(0,$j,"offset",function(){return this._offset},function($_){this._offset=$_,this._matNeedUpdte=!0}),$i(0,$j,"rotation",function(){return this._rotation},function($_){this._rotation=$_,this._matNeedUpdte=!0}),$q($S,["_tempOffsetV3",function(){return this._tempOffsetV3=new $RS(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $jS},"_tempTitlingV3",function(){return this._tempTitlingV3=new $RS(1,1,1)}])}(),function($j){function $_(){this.x=NaN,this.y=NaN,this.z=NaN,$_.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$C($_,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$j);var $S=$_.prototype;$S._getShapeBoundBox=function($_){var $S=$_.min.elements;$S[0]=.5*-this.x,$S[1]=.5*-this.y,$S[2]=.5*-this.z;var $j=$_.max.elements;$j[0]=.5*this.x,$j[1]=.5*this.y,$j[2]=.5*this.z},$S._getSpeedBoundBox=function($_){var $S=$_.min.elements;$S[0]=0,$S[1]=0,$S[2]=0;var $j=$_.max.elements;$j[0]=0,$j[1]=1,$j[2]=0},$S.generatePositionAndDirection=function($_,$S,$j,$O){var $V=$_.elements,$M=$S.elements;$j?($j.seed=$O[16],$U._randomPointInsideHalfUnitBox($_,$j),$O[16]=$j.seed):$U._randomPointInsideHalfUnitBox($_),$V[0]=this.x*$V[0],$V[1]=this.y*$V[1],$V[2]=this.z*$V[2],this.randomDirection?$j?($j.seed=$O[17],$U._randomPointUnitSphere($S,$j),$O[17]=$j.seed):$U._randomPointUnitSphere($S):($M[0]=0,$M[1]=0,$M[2]=1)},$S.cloneTo=function($_){$j.prototype.cloneTo.call(this,$_);var $S=$_;$S.x=this.x,$S.y=this.y,$S.z=this.z,$S.randomDirection=this.randomDirection}}($m),function($j){function $R(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$R.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$C($R,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$j);var $_=$R.prototype;$_._getShapeBoundBox=function($_){var $S=$_.min.elements;$S[0]=$S[2]=-this.radius,$S[1]=0;var $j=$_.max.elements;$j[0]=$j[2]=this.radius,$j[1]=0},$_._getSpeedBoundBox=function($_){var $S=$_.min.elements;$S[0]=$S[1]=-1,$S[2]=0;var $j=$_.max.elements;$j[0]=$j[1]=1,$j[2]=0},$_.generatePositionAndDirection=function($_,$S,$j,$O){var $V=$_.elements,$M=$R._tempPositionPoint.elements;$j?($j.seed=$O[16],this.emitFromEdge?$U._randomPointUnitArcCircle(this.arc,$R._tempPositionPoint,$j):$U._randomPointInsideUnitArcCircle(this.arc,$R._tempPositionPoint,$j),$O[16]=$j.seed):this.emitFromEdge?$U._randomPointUnitArcCircle(this.arc,$R._tempPositionPoint):$U._randomPointInsideUnitArcCircle(this.arc,$R._tempPositionPoint),$V[0]=-$M[0],$V[1]=$M[1],$V[2]=0,$RS.scale($_,this.radius,$_),this.randomDirection?$j?($j.seed=$O[17],$U._randomPointUnitSphere($S,$j),$O[17]=$j.seed):$U._randomPointUnitSphere($S):$_.cloneTo($S)},$_.cloneTo=function($_){$j.prototype.cloneTo.call(this,$_);var $S=$_;$S.radius=this.radius,$S.arc=this.arc,$S.emitFromEdge=this.emitFromEdge,$S.randomDirection=this.randomDirection},$q($R,["_tempPositionPoint",function(){return this._tempPositionPoint=new $MS}])}($m),function($j){function $s(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$s.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$C($s,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$j);var $_=$s.prototype;$_._getShapeBoundBox=function($_){var $S=this.radius+this.length*Math.sin(this.angle),$j=this.length*Math.cos(this.angle),$O=$_.min.elements;$O[0]=$O[1]=-$S,$O[2]=0;var $V=$_.max.elements;$V[0]=$V[1]=$S,$V[2]=$j},$_._getSpeedBoundBox=function($_){var $S=Math.sin(this.angle),$j=$_.min.elements;$j[0]=$j[1]=-$S,$j[2]=0;var $O=$_.max.elements;$O[0]=$j[1]=$S,$O[2]=1},$_.generatePositionAndDirection=function($_,$S,$j,$O){var $V,$M=$_.elements,$R=$S.elements,$w=$s._tempPositionPoint.elements,$a=NaN,$u=NaN,$c=Math.cos(this.angle),$q=Math.sin(this.angle);switch(this.emitType){case 0:$j?($j.seed=$O[16],$U._randomPointInsideUnitCircle($s._tempPositionPoint,$j),$O[16]=$j.seed):$U._randomPointInsideUnitCircle($s._tempPositionPoint),$a=$w[0],$u=$w[1],$M[0]=$a*this.radius,$M[1]=$u*this.radius,$M[2]=0,this.randomDirection?($j?($j.seed=$O[17],$U._randomPointInsideUnitCircle($s._tempDirectionPoint,$j),$O[17]=$j.seed):$U._randomPointInsideUnitCircle($s._tempDirectionPoint),$V=$s._tempDirectionPoint.elements,$R[0]=$V[0]*$q,$R[1]=$V[1]*$q):($R[0]=$a*$q,$R[1]=$u*$q),$R[2]=$c;break;case 1:$j?($j.seed=$O[16],$U._randomPointUnitCircle($s._tempPositionPoint,$j),$O[16]=$j.seed):$U._randomPointUnitCircle($s._tempPositionPoint),$a=$w[0],$u=$w[1],$M[0]=$a*this.radius,$M[1]=$u*this.radius,$M[2]=0,this.randomDirection?($j?($j.seed=$O[17],$U._randomPointInsideUnitCircle($s._tempDirectionPoint,$j),$O[17]=$j.seed):$U._randomPointInsideUnitCircle($s._tempDirectionPoint),$V=$s._tempDirectionPoint.elements,$R[0]=$V[0]*$q,$R[1]=$V[1]*$q):($R[0]=$a*$q,$R[1]=$u*$q),$R[2]=$c;break;case 2:$j?($j.seed=$O[16],$U._randomPointInsideUnitCircle($s._tempPositionPoint,$j)):$U._randomPointInsideUnitCircle($s._tempPositionPoint),$a=$w[0],$u=$w[1],$M[0]=$a*this.radius,$M[1]=$u*this.radius,$R[$M[2]=0]=$a*$q,$R[1]=$u*$q,$R[2]=$c,$RS.normalize($S,$S),$j?($RS.scale($S,this.length*$j.getFloat(),$S),$O[16]=$j.seed):$RS.scale($S,this.length*Math.random(),$S),$RS.add($_,$S,$_),this.randomDirection&&($j?($j.seed=$O[17],$U._randomPointUnitSphere($S,$j),$O[17]=$j.seed):$U._randomPointUnitSphere($S));break;case 3:$j?($j.seed=$O[16],$U._randomPointUnitCircle($s._tempPositionPoint,$j)):$U._randomPointUnitCircle($s._tempPositionPoint),$a=$w[0],$u=$w[1],$M[0]=$a*this.radius,$M[1]=$u*this.radius,$R[$M[2]=0]=$a*$q,$R[1]=$u*$q,$R[2]=$c,$RS.normalize($S,$S),$j?($RS.scale($S,this.length*$j.getFloat(),$S),$O[16]=$j.seed):$RS.scale($S,this.length*Math.random(),$S),$RS.add($_,$S,$_),this.randomDirection&&($j?($j.seed=$O[17],$U._randomPointUnitSphere($S,$j),$O[17]=$j.seed):$U._randomPointUnitSphere($S));break;default:throw new Error("ConeShape:emitType is invalid.")}},$_.cloneTo=function($_){$j.prototype.cloneTo.call(this,$_);var $S=$_;$S.angle=this.angle,$S.radius=this.radius,$S.length=this.length,$S.emitType=this.emitType,$S.randomDirection=this.randomDirection},$q($s,["_tempPositionPoint",function(){return this._tempPositionPoint=new $MS},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $MS}])}($m),function($j){function $_(){this.radius=NaN,this.emitFromShell=!1,$_.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$C($_,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$j);var $S=$_.prototype;$S._getShapeBoundBox=function($_){var $S=$_.min.elements;$S[0]=$S[1]=$S[2]=-this.radius;var $j=$_.max.elements;$j[0]=$j[1]=this.radius,$j[2]=0},$S._getSpeedBoundBox=function($_){var $S=$_.min.elements;$S[0]=$S[1]=-1,$S[2]=0;var $j=$_.max.elements;$j[0]=$j[1]=$j[2]=1},$S.generatePositionAndDirection=function($_,$S,$j,$O){var $V=$_.elements;$j?($j.seed=$O[16],this.emitFromShell?$U._randomPointUnitSphere($_,$j):$U._randomPointInsideUnitSphere($_,$j),$O[16]=$j.seed):this.emitFromShell?$U._randomPointUnitSphere($_):$U._randomPointInsideUnitSphere($_),$RS.scale($_,this.radius,$_);var $M=$V[2];$M<0&&($V[2]=-1*$M),this.randomDirection?$j?($j.seed=$O[17],$U._randomPointUnitSphere($S,$j),$O[17]=$j.seed):$U._randomPointUnitSphere($S):$_.cloneTo($S)},$S.cloneTo=function($_){$j.prototype.cloneTo.call(this,$_);var $S=$_;$S.radius=this.radius,$S.emitFromShell=this.emitFromShell,$S.randomDirection=this.randomDirection}}($m),function($j){function $_(){this.radius=NaN,this.emitFromShell=!1,$_.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$C($_,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$j);var $S=$_.prototype;$S._getShapeBoundBox=function($_){var $S=$_.min.elements;$S[0]=$S[1]=$S[2]=-this.radius;var $j=$_.max.elements;$j[0]=$j[1]=$j[2]=this.radius},$S._getSpeedBoundBox=function($_){var $S=$_.min.elements;$S[0]=$S[1]=$S[2]=-1;var $j=$_.max.elements;$j[0]=$j[1]=$j[2]=1},$S.generatePositionAndDirection=function($_,$S,$j,$O){$j?($j.seed=$O[16],this.emitFromShell?$U._randomPointUnitSphere($_,$j):$U._randomPointInsideUnitSphere($_,$j),$O[16]=$j.seed):this.emitFromShell?$U._randomPointUnitSphere($_):$U._randomPointInsideUnitSphere($_),$RS.scale($_,this.radius,$_),this.randomDirection?$j?($j.seed=$O[17],$U._randomPointUnitSphere($S,$j),$O[17]=$j.seed):$U._randomPointUnitSphere($S):$_.cloneTo($S)},$S.cloneTo=function($_){$j.prototype.cloneTo.call(this,$_);var $S=$_;$S.radius=this.radius,$S.emitFromShell=this.emitFromShell,$S.randomDirection=this.randomDirection}}($m),function($_){function $S(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$S.__super.call(this)}return $C($S,"laya.d3.core.render.SubMeshRenderElement",$T),$S}()),$yS=function($_){function $Z($_,$S,$j,$O,$V,$M){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$_,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$CS.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$YS.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$YS.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$$S.SHADERDEFINE_ALPHATEST]="ALPHATEST";$Z.__super.call(this,$_,$S,$j,null,{}),this._attributeMap=$O;var $R;for($R in $V){var $w=$V[$R];switch($w[1]){case 0:this._renderElementUniformMap[$R]=$w[0];break;case 1:this._materialUniformMap[$R]=$w[0];break;case 2:this._spriteUniformMap[$R]=$w[0];break;case 3:this._cameraUniformMap[$R]=$w[0];break;case 4:this._sceneUniformMap[$R]=$w[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$C($Z,"laya.d3.shader.ShaderCompile3D",$k);var $S=$Z.prototype;return $S._definesToNameDic=function($_,$S){for(var $j={},$O=1,$V=0;$V<32&&!($_<($O=1<<$V));$V++)if($_&$O){var $M=$S[$O];$M&&($j[$M]="")}return $j},$S.withCompile=function($_,$S,$j,$O){var $V,$M,$R;if($M=this.sharders[$_])if($R=$M[$S]){if($V=$R[$j])return $V}else $R=$M[$S]=[];else $R=($M=this.sharders[$_]=[])[$S]=[];var $w,$a=this._definesToNameDic($_,$Z._globalInt2name),$u=this._definesToNameDic($S,this._spriteInt2name),$c=this._definesToNameDic($j,this._materialInt2name),$q={},$s="";if($a)for($w in $a)$s+="#define "+$w+"\n",$q[$w]=!0;if($u)for($w in $u)$s+="#define "+$w+"\n",$q[$w]=!0;if($c)for($w in $c)$s+="#define "+$w+"\n",$q[$w]=!0;var $C=$NS.nameKey.getName(this._name)+" compile ("+$_+","+$S+","+$j+")",$i=this._VS.toscript($q,[]),$v=this._PS.toscript($q,[]);$J.now();if($V=$NS.create($s+$i.join("\n"),$s+$v.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$O,$C),$R[$j]=$V,laya.d3.shader.ShaderCompile3D.debugMode)$J.now();return $V},$S.precompileShaderWithShaderDefine=function($_,$S,$j){this.withCompile($_,$S,$j,!0)},$S.addMaterialDefines=function($_){var $S=$_.defines;for(var $j in $S){var $O=$S[$j],$V=parseInt($j);this._materialInt2name[$V]=$O,this._materialName2Int[$O]=$V}},$S.addSpriteDefines=function($_){var $S=$_.defines;for(var $j in $S){var $O=$S[$j],$V=parseInt($j);this._spriteInt2name[$V]=$O,this._spriteName2Int[$O]=$V}},$S.getMaterialDefineByName=function($_){return this._materialName2Int[$_]},$S.registerMaterialDefine=function($_){var $S=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$S]=$_,this._materialName2Int[$_]=$S},$S.registerSpriteDefine=function($_){var $S=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$S]=$_,this._spriteName2Int[$_]=$S},$Z._globalRegDefine=function($_,$S){$Z._globalInt2name[$S]=$_},$Z.add=function($_,$S,$j,$O,$V){return laya.d3.shader.ShaderCompile3D._preCompileShader[$_]=new $Z($_,$S,$j,$O,$V,$k.includes)},$Z.get=function($_){return laya.d3.shader.ShaderCompile3D._preCompileShader[$NS.nameKey.getID($_)]},$Z._preCompileShader={},$Z._globalInt2name=[],$Z.debugMode=!1,$Z.SHADERDEFINE_HIGHPRECISION=1,$Z.SHADERDEFINE_FOG=4,$Z.SHADERDEFINE_DIRECTIONLIGHT=8,$Z.SHADERDEFINE_POINTLIGHT=16,$Z.SHADERDEFINE_SPOTLIGHT=32,$Z.SHADERDEFINE_UV0=64,$Z.SHADERDEFINE_COLOR=128,$Z.SHADERDEFINE_UV1=256,$Z.SAHDERDEFINE_DEPTHFOG=131072,$Z}(),$PS=function($_){function $i(){$i.__super.call(this)}$C($i,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$O_);var $S=$i.prototype;return $S._getStaticBatch=function($_,$S,$j,$O){var $V,$M;return $M=$_?$_.id.toString()+$j.id.toString()+$S.id.toString()+$O.toString():$j.id.toString()+$S.id.toString()+$O.toString(),this._staticBatches[$M]?$V=this._staticBatches[$M]:this._staticBatches[$M]=$V=new $gS($M,this,$_,$S,$j),$V},$S._initStaticBatchs=function($_){var $S,$j;this._initBatchRenderElements.sort($i._sortPrepareStaticBatch);for(var $O,$V=!1,$M=0,$R=0,$w=this._initBatchRenderElements.length;$R<$w;$R++){var $a,$u=this._initBatchRenderElements[$R],$c=$u.renderObj._getVertexBuffer(0);$u._sprite3D;if($j===$c.vertexDeclaration&&$S===$u._material)if($V)$O._addCombineBatchRenderObjTest($u)?($a=$u._staticBatch)!==$O&&($a&&$a._deleteCombineBatchRenderObj($u),$O._addCombineBatchRenderObj($u)):($V=!1,$M++);else{var $q=this._initBatchRenderElements[$R-1],$s=$q.renderObj,$C=$u.renderObj;$V=!(65535<$s._getVertexBuffer().vertexCount+$C._getVertexBuffer().vertexCount)&&($O=this._getStaticBatch($_,$j,$S,$M),($a=$q._staticBatch)!==$O&&($a&&$a._deleteCombineBatchRenderObj($q),$O._addCombineBatchRenderObj($q)),($a=$u._staticBatch)!==$O&&($a&&$a._deleteCombineBatchRenderObj($u),$O._addCombineBatchRenderObj($u)),!0)}else $V=!1,$M=0;$S=$u._material,$j=$c.vertexDeclaration}},$i._sortPrepareStaticBatch=function($_,$S){var $j=$_._render,$O=$S._render,$V=$j.lightmapIndex-$O.lightmapIndex;if(0!=$V)return $V;var $M=$j.receiveShadow-$O.receiveShadow;if(0!=$M)return $M;var $R=$_._mainSortID-$S._mainSortID;return 0==$R?$_.renderObj.triangleCount-$S.renderObj.triangleCount:$R},$i}(),$gS=function($_){function $M($_,$S,$j,$O,$V){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$M.__super.call(this,$_,$S,$j),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$O,this._material=$V}$C($M,"laya.d3.graphics.SubMeshStaticBatch",$V_);var $S=$M.prototype;return $S._compareBatchRenderElement=function($_,$S){return $_._batchIndexStart>$S._batchIndexStart},$S._addCombineBatchRenderObjTest=function($_){var $S=$_.renderObj._vertexCount;return!(65535<(0<$S?this._currentCombineVertexCount+$S:this._currentCombineVertexCount+$_.renderObj._getVertexBuffer().vertexCount))},$S._addCombineBatchRenderObj=function($_){var $S=$_.renderObj,$j=$S._vertexCount;this._initBatchRenderElements.push($_),$_._staticBatch=this,0<$j?(this._currentCombineIndexCount+=$S._indexCount,this._currentCombineVertexCount+=$j):(this._currentCombineIndexCount=this._currentCombineIndexCount+$S._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$S._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$S._deleteCombineBatchRenderObj=function($_){var $S=$_.renderObj,$j=this._initBatchRenderElements.indexOf($_);if(-1!==$j){this._initBatchRenderElements.splice($j,1),$_._staticBatch=null;var $O=$S._vertexCount;0<$O?(this._currentCombineIndexCount=this._currentCombineIndexCount-$S._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$O):(this._currentCombineIndexCount=this._currentCombineIndexCount-$S._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$S._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$S._finishInit=function(){if(this._needFinishCombine){var $_=0,$S=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $j=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$O=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$mS.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$tS.create("ushort",this._currentCombineIndexCount,35044);for(var $V=0,$M=this._initBatchRenderElements.length;$V<$M;$V++){var $R=this._initBatchRenderElements[$V],$w=$R.renderObj,$a=$w._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$R._sprite3D),$u=$w.getIndices(),$c=$R._sprite3D.transform._isFrontFaceInvert,$q=$_/(this._vertexDeclaration.vertexStride/4)-$w._vertexStart,$s=$S,$C=$s+$u.length;$R._batchIndexStart=$s,$R._batchIndexEnd=$C,$O.set($u,$S);var $i=0;if($c)for($i=$s;$i<$C;$i+=3){$O[$i]=$q+$O[$i];var $v=$O[$i+1],$Z=$O[$i+2];$O[$i+1]=$q+$Z,$O[$i+2]=$q+$v}else for($i=$s;$i<$C;$i+=3)$O[$i]=$q+$O[$i],$O[$i+1]=$q+$O[$i+1],$O[$i+2]=$q+$O[$i+2];$S+=$u.length,$j.set($a,$_),$_+=$a.length}this._vertexBuffer.setData($j),this._indexBuffer.setData($O),this._needFinishCombine=!1}},$S._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $fS)},$S._getRenderElement=function($_,$S,$j){for(var $O,$V,$M=this._batchRenderElements.length,$R=!0,$w=0;$w<$M;$w++){var $a,$u,$c=($V=this._batchRenderElements[$w])._sprite3D._render;if(0!==$w&&($R=($a=($O=this._batchRenderElements[$w-1])._sprite3D._render).lightmapIndex!==$c.lightmapIndex||$a.receiveShadow!==$c.receiveShadow||$O._batchIndexEnd!==$V._batchIndexStart),$R){($u=this._getCombineRenderElementFromPool()).renderObj=this,$u._material=this._material,$u._batchIndexStart=$V._batchIndexStart,$u._batchIndexEnd=$V._batchIndexEnd;var $q=$c.lightmapIndex,$s=$q+1,$C=this._batchOwnerIndices[$s];$C||($C=this._batchOwnerIndices[$s]=[]);var $i,$v=$C[$V._render.receiveShadow?1:0];void 0===$v?($C[$c.receiveShadow?1:0]=this._batchOwners.length,($i=new $WS(null,"StaticBatchMeshSprite3D"))._scene=$S,$i._transform=this._rootOwner?this._rootOwner._transform:null,$i._render.lightmapIndex=$q,$i._render.receiveShadow=$V._render.receiveShadow,this._batchOwners.push($i)):$i=this._batchOwners[$v],$i._render._renderUpdate($j),$u._sprite3D=$i,$_.push($u)}else $u._batchIndexEnd=$V._batchIndexEnd}},$S._beforeRender=function($_){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$S._render=function($_){var $S=$_.renderElement,$j=$S._batchIndexStart,$O=$S._batchIndexEnd-$j;$d.mainContext.drawElements(4,$O,5123,2*$j),$y.drawCall++,$y.trianglesFaces+=$O/3},$S.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$S._getVertexBuffer=function($_){return void 0===$_&&($_=0),this._vertexBuffer},$M}(),$ES=function($_){function $S(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$S.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$C($S,"laya.d3.core.ComponentNode",$u);var $j=$S.prototype;return $j.addComponent=function($_){var $S,$j=this._componentsMap.indexOf($_);if(-1===$j)$S=[],this._componentsMap.push($_),this._typeComponentsIndices.push($S);else if($S=this._typeComponentsIndices[$j],this._components[$S[0]].isSingleton)throw new Error("无法单实例创建"+$_+"组件，"+$_+"组件已存在！");var $O=$V.getInstance($_);return $S.push(this._components.length),this._components.push($O),$O instanceof laya.d3.component.Script&&this._scripts.push($O),$O._initialize(this),$O},$j._removeComponent=function($_,$S){var $j=this._typeComponentsIndices[$_],$O=$j[$S],$V=this._components[$O];this._components.splice($O,1),$V instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($V),1),$j.splice($S,1),0===$j.length&&(this._typeComponentsIndices.splice($_,1),this._componentsMap.splice($_,1));for(var $M=0,$R=this._componentsMap.length;$M<$R;$M++)for(var $w=($j=this._typeComponentsIndices[$M]).length-1;0<=$w;$w--){var $a=$j[$w];if(!($O<$a))break;$j[$w]=--$a}$V._destroy()},$j.getComponentByType=function($_,$S){void 0===$S&&($S=0);var $j=this._componentsMap.indexOf($_);return-1===$j?null:this._components[this._typeComponentsIndices[$j][$S]]},$j.getComponentsByType=function($_,$S){var $j=this._componentsMap.indexOf($_);if(-1!==$j){var $O=this._typeComponentsIndices[$j],$V=$O.length;$S.length=$V;for(var $M=0;$M<$V;$M++)$S[$M]=this._components[$O[$M]]}else $S.length=0},$j.getComponentByIndex=function($_){return this._components[$_]},$j.removeComponentByType=function($_,$S){void 0===$S&&($S=0);var $j=this._componentsMap.indexOf($_);-1!==$j&&this._removeComponent($j,$S)},$j.removeComponentsByType=function($_){var $S=this._componentsMap.indexOf($_);if(-1!==$S)for(var $j=this._typeComponentsIndices[$S],$O=0,$V=$j.length;$O<$V;$j.length<$V?$V--:$O++)this._removeComponent($S,$O)},$j.removeAllComponent=function(){for(var $_=0,$S=this._componentsMap.length;$_<$S;this._componentsMap.length<$S?$S--:$_++)this.removeComponentsByType(this._componentsMap[$_])},$j._updateComponents=function($_){for(var $S=0,$j=this._components.length;$S<$j;$S++){var $O=this._components[$S];!$O.started&&($O._start($_),$O.started=!0),$O.enable&&$O._update($_)}},$j._lateUpdateComponents=function($_){for(var $S=0;$S<this._components.length;$S++){var $j=this._components[$S];!$j.started&&($j._start($_),$j.started=!0),$j.enable&&$j._lateUpdate($_)}},$j._preRenderUpdateComponents=function($_){for(var $S=0;$S<this._components.length;$S++){var $j=this._components[$S];!$j.started&&($j._start($_),$j.started=!0),$j.enable&&$j._preRenderUpdate($_)}},$j._postRenderUpdateComponents=function($_){for(var $S=0;$S<this._components.length;$S++){var $j=this._components[$S];!$j.started&&($j._start($_),$j.started=!0),$j.enable&&$j._postRenderUpdate($_)}},$S}(),$$S=function($O){function $_(){$_.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $sS,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $wS(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$C($_,"laya.d3.core.material.BaseMaterial",$O);var $S=$_.prototype;return $H.imps($S,{"laya.d3.core.IClone":!0}),$S._addShaderDefine=function($_){this._shaderDefineValue|=$_},$S._removeShaderDefine=function($_){this._shaderDefineValue&=~$_},$S._addDisablePublicShaderDefine=function($_){this._disablePublicShaderDefine|=$_},$S._removeDisablePublicShaderDefine=function($_){this._disablePublicShaderDefine&=~$_},$S._setBuffer=function($_,$S){this._shaderValues.setValue($_,$S),this._values[$_]=$S},$S._getBuffer=function($_){return this._values[$_]},$S._setMatrix4x4=function($_,$S){this._shaderValues.setValue($_,$S?$S.elements:null),this._values[$_]=$S},$S._getMatrix4x4=function($_){return this._values[$_]},$S._setInt=function($_,$S){this._shaderValues.setValue($_,$S),this._values[$_]=$S},$S._getInt=function($_){return this._values[$_]},$S._setNumber=function($_,$S){this._shaderValues.setValue($_,$S),this._values[$_]=$S},$S._getNumber=function($_){return this._values[$_]},$S._setBool=function($_,$S){this._shaderValues.setValue($_,$S),this._values[$_]=$S},$S._getBool=function($_){return this._values[$_]},$S._setVector2=function($_,$S){this._shaderValues.setValue($_,$S?$S.elements:null),this._values[$_]=$S},$S._getVector2=function($_){return this._values[$_]},$S._setColor=function($_,$S){this._shaderValues.setValue($_,$S?$S.elements:null),this._values[$_]=$S},$S._getColor=function($_){return this._values[$_]},$S._setTexture=function($_,$S){var $j=this._values[$_];this._values[$_]=$S,this._shaderValues.setValue($_,$S),0<this.referenceCount&&($j&&$j._removeReference(),$S&&$S._addReference())},$S._getTexture=function($_){return this._values[$_]},$S._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$S._getShader=function($_,$S,$j){var $O=($_|$S)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($O,$j,this._shaderDefineValue),this._shader},$S._setRenderStateBlendDepth=function(){var $_=$d.mainContext;switch($n.setDepthMask($_,this.depthWrite),0===this.depthTest?$n.setDepthTest($_,!1):($n.setDepthTest($_,!0),$n.setDepthFunc($_,this.depthTest)),this.blend){case 0:$n.setBlend($_,!1);break;case 1:$n.setBlend($_,!0),$n.setBlendFunc($_,this.srcBlend,this.dstBlend);break;case 2:$n.setBlend($_,!0)}},$S._setRenderStateFrontFace=function($_,$S){var $j=$d.mainContext,$O=0;switch(this.cull){case 0:$n.setCullFace($j,!1);break;case 1:$n.setCullFace($j,!0),$O=$_?$S&&$S._isFrontFaceInvert?2305:2304:$S&&$S._isFrontFaceInvert?2304:2305,$n.setFrontFace($j,$O);break;case 2:$n.setCullFace($j,!0),$O=$_?$S&&$S._isFrontFaceInvert?2304:2305:$S&&$S._isFrontFaceInvert?2305:2304,$n.setFrontFace($j,$O)}},$S.onAsynLoaded=function($_,$S,$j){var $O=$S[0],$V=$S[1];switch($O.version){case"LAYAMATERIAL:01":var $M=0,$R=0,$w=$O.props;for(var $a in $w)switch($a){case"vectors":var $u=$w[$a];for($M=0,$R=$u.length;$M<$R;$M++){var $c=$u[$M],$q=$c.value;switch($q.length){case 2:this[$c.name]=new $MS($q[0],$q[1]);break;case 3:this[$c.name]=new $RS($q[0],$q[1],$q[2]);break;case 4:this[$c.name]=new $wS($q[0],$q[1],$q[2],$q[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $s=$w[$a];for($M=0,$R=$s.length;$M<$R;$M++){var $C=$s[$M],$i=$C.path;$i&&(this[$C.name]=$o.getRes($V[$i]))}break;case"defines":var $v=$w[$a];for($M=0,$R=$v.length;$M<$R;$M++){var $Z=this._shaderCompile.getMaterialDefineByName($v[$M]);this._addShaderDefine($Z)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$a]=$w[$a];break;case"renderQueue":switch($w[$a]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$a]=$w[$a]}break;case"LAYAMATERIAL:02":for($a in $w=$O.props)switch($a){case"vectors":for($M=0,$R=($u=$w[$a]).length;$M<$R;$M++)switch(($q=($c=$u[$M]).value).length){case 2:this[$c.name]=new $MS($q[0],$q[1]);break;case 3:this[$c.name]=new $RS($q[0],$q[1],$q[2]);break;case 4:this[$c.name]=new $wS($q[0],$q[1],$q[2],$q[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($M=0,$R=($s=$w[$a]).length;$M<$R;$M++)($i=($C=$s[$M]).path)&&(this[$C.name]=$o.getRes($V[$i]));break;case"defines":for($M=0,$R=($v=$w[$a]).length;$M<$R;$M++)$Z=this._shaderCompile.getMaterialDefineByName($v[$M]),this._addShaderDefine($Z);break;default:this[$a]=$w[$a]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$S._addReference=function(){$O.prototype._addReference.call(this);for(var $_=0,$S=this._values.length;$_<$S;$_++){var $j=this._values[$_];$j&&$j instanceof laya.d3.resource.BaseTexture&&$j._addReference()}},$S._removeReference=function(){$O.prototype._removeReference.call(this);for(var $_=0,$S=this._values.length;$_<$S;$_++){var $j=this._values[$_];$j&&$j instanceof laya.d3.resource.BaseTexture&&$j._removeReference()}},$S.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$S.setShaderName=function($_){var $S=$NS.nameKey.getID($_);if(-1===$S)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$yS._preCompileShader[$S]},$S.cloneTo=function($_){var $S=$_;$S.name=this.name,$S.cull=this.cull,$S.blend=this.blend,$S.srcBlend=this.srcBlend,$S.dstBlend=this.dstBlend,$S.srcBlendRGB=this.srcBlendRGB,$S.dstBlendRGB=this.dstBlendRGB,$S.srcBlendAlpha=this.srcBlendAlpha,$S.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($S.blendConstColor),$S.blendEquation=this.blendEquation,$S.blendEquationRGB=this.blendEquationRGB,$S.blendEquationAlpha=this.blendEquationAlpha,$S.depthTest=this.depthTest,$S.depthWrite=this.depthWrite,$S.renderQueue=this.renderQueue,$S._shader=this._shader,$S._disablePublicShaderDefine=this._disablePublicShaderDefine,$S._shaderDefineValue=this._shaderDefineValue;var $j,$O=0,$V=$S._shaderValues;$S._shaderValues.data.length=this._shaderValues.data.length;var $M=this._values.length,$R=$S._values;for($O=0,$j=$R.length=$M;$O<$j;$O++){var $w=this._values[$O];if($w)if("number"==typeof $w)$R[$O]=$w,$V.data[$O]=$w;else if("number"==typeof $w&&Math.floor($w)==$w)$R[$O]=$w,$V.data[$O]=$w;else if("boolean"==typeof $w)$R[$O]=$w,$V.data[$O]=$w;else if($w instanceof laya.d3.math.Vector2){var $a=$R[$O]||($R[$O]=new $MS);$w.cloneTo($a),$V.data[$O]=$a.elements}else if($w instanceof laya.d3.math.Vector3){var $u=$R[$O]||($R[$O]=new $RS);$w.cloneTo($u),$V.data[$O]=$u.elements}else if($w instanceof laya.d3.math.Vector4){var $c=$R[$O]||($R[$O]=new $wS);$w.cloneTo($c),$V.data[$O]=$c.elements}else if($w instanceof laya.d3.math.Matrix4x4){var $q=$R[$O]||($R[$O]=new $_S);$w.cloneTo($q),$V.data[$O]=$q.elements}else $w instanceof laya.d3.resource.BaseTexture&&($R[$O]=$w,$V.data[$O]=$w)}},$S.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$i(0,$S,"alphaTestValue",function(){return this._getNumber(0)},function($_){this._setNumber(0,$_)}),$i(0,$S,"alphaTest",function(){return this._alphaTest},function($_){(this._alphaTest=$_)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$_.__init__=function(){$_.SHADERDEFINE_ALPHATEST=$_.shaderDefines.registerDefine("ALPHATEST")},$_.RENDERQUEUE_OPAQUE=2e3,$_.RENDERQUEUE_ALPHATEST=2450,$_.RENDERQUEUE_TRANSPARENT=3e3,$_.CULL_NONE=0,$_.CULL_FRONT=1,$_.CULL_BACK=2,$_.BLEND_DISABLE=0,$_.BLEND_ENABLE_ALL=1,$_.BLEND_ENABLE_SEPERATE=2,$_.BLENDPARAM_ZERO=0,$_.BLENDPARAM_ONE=1,$_.BLENDPARAM_SRC_COLOR=768,$_.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$_.BLENDPARAM_DST_COLOR=774,$_.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$_.BLENDPARAM_SRC_ALPHA=770,$_.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$_.BLENDPARAM_DST_ALPHA=772,$_.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$_.BLENDPARAM_SRC_ALPHA_SATURATE=776,$_.BLENDEQUATION_ADD=0,$_.BLENDEQUATION_SUBTRACT=1,$_.BLENDEQUATION_REVERSE_SUBTRACT=2,$_.DEPTHTEST_OFF=0,$_.DEPTHTEST_NEVER=512,$_.DEPTHTEST_LESS=513,$_.DEPTHTEST_EQUAL=514,$_.DEPTHTEST_LEQUAL=515,$_.DEPTHTEST_GREATER=516,$_.DEPTHTEST_NOTEQUAL=517,$_.DEPTHTEST_GEQUAL=518,$_.DEPTHTEST_ALWAYS=519,$_.SHADERDEFINE_ALPHATEST=1,$_.ALPHATESTVALUE=0,$q($_,["shaderDefines",function(){return this.shaderDefines=new $cS}]),$_}($Z),$dS=function($_){function $S(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$S.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$C($S,"laya.d3.resource.BaseTexture",$Z);var $j=$S.prototype;return $i(0,$j,"width",function(){return this._width}),$i(0,$j,"repeat",function(){return this._repeat},function($_){if(this._repeat!==$_&&(this._repeat=$_,this._source)){var $S=$d.mainContext;$n.bindTexture($S,this._type,this._source),$z.isPOT(this._width,this._height)&&this._repeat?($S.texParameteri(this._type,10242,10497),$S.texParameteri(this._type,10243,10497)):($S.texParameteri(this._type,10242,33071),$S.texParameteri(this._type,10243,33071))}}),$i(0,$j,"height",function(){return this._height}),$i(0,$j,"magFifter",function(){return this._magFifter},function($_){(this._magFifter=$_)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($_)}),$i(0,$j,"wrapModeV",function(){return this._wrapModeV}),$i(0,$j,"size",function(){return this._size}),$i(0,$j,"wrapModeU",function(){return this._wrapModeU}),$i(0,$j,"mipmap",function(){return this._mipmap},function($_){this._mipmap=$_,this._mipmap!=$_&&this._conchTexture&&this._conchTexture.setMipMap($_)}),$i(0,$j,"minFifter",function(){return this._minFifter},function($_){this._minFifter=$_,this._minFifter!=$_&&this._conchTexture&&this._conchTexture.setMinFifter($_)}),$i(0,$j,"format",function(){return this._format}),$i(0,$j,"source",function(){return this.activeResource(),this._source}),$i(0,$j,"defaulteTexture",function(){return $LS.grayTexture}),$S.WARPMODE_REPEAT=0,$S.WARPMODE_CLAMP=1,$S}(),$nS=function($_){function $S(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$S.__super.call(this),this._boundingBoxCorners=$O(8,null)}$C($S,"laya.d3.resource.models.BaseMesh",$Z);var $j=$S.prototype;return $j._getPositions=function(){throw new Error("未Override,请重载该属性！")},$j._generateBoundingObject=function(){this._boundingSphere=new $X_(new $RS,0),$X_.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $I_(new $RS,new $RS),$I_.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$j.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$j.getRenderElement=function($_){throw new Error("未Override,请重载该属性！")},$i(0,$j,"subMeshCount",function(){return this._subMeshCount}),$i(0,$j,"boundingBox",function(){return this._boundingBox}),$i(0,$j,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$i(0,$j,"boundingSphere",function(){return this._boundingSphere}),$S}(),$JS=(function($_){function $S(){$S.__super.call(this)}$C($S,"laya.d3.component.Script",$kS);var $j=$S.prototype;$j.onTriggerEnter=function($_){},$j.onTriggerExit=function($_){},$j.onTriggerStay=function($_){},$i(0,$j,"isSingleton",function(){return $S._isSingleton}),$S._isSingleton=!1}(),function($_){function $S($_){this._owner=null,this._sharedMesh=null,$S.__super.call(this),this._owner=$_}$C($S,"laya.d3.core.MeshFilter",$_);var $j=$S.prototype;return $j._sharedMeshLoaded=function(){this.event("loaded")},$j._destroy=function(){$_.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$i(0,$j,"sharedMesh",function(){return this._sharedMesh},function($_){var $S=this._sharedMesh;$S&&$S._removeReference(),(this._sharedMesh=$_)._addReference(),this.event("meshchanged",[this,$S,$_]),$_.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$i(0,$j,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$i(0,$j,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$i(0,$j,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$i(0,$j,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$S}($zS)),$FS=function($_){function $S($_){$S.__super.call(this,$_),$_.meshFilter.on("meshchanged",this,this._onMeshChanged)}$C($S,"laya.d3.core.MeshRender",$HS);var $j=$S.prototype;return $j._onMeshChanged=function($_,$S,$j){$j.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$j.once("loaded",this,this._onMeshLoaed)},$j._onMeshLoaed=function($_,$S){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$j._calculateBoundingSphereByInitSphere=function($_){var $S=NaN,$j=this._owner.transform,$O=$j.scale.elements,$V=Math.abs($O[0]),$M=Math.abs($O[1]),$R=Math.abs($O[2]);$S=$M<=$V&&$R<=$V?$V:$R<=$M?$M:$R,$RS.transformCoordinate($_.center,$j.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$_.radius*$S},$j._calculateBoundBoxByInitCorners=function($_){for(var $S=this._owner.transform.worldMatrix,$j=0;$j<8;$j++)$RS.transformCoordinate($_[$j],$S,$HS._tempBoundBoxCorners[$j]);$I_.createfromPoints($HS._tempBoundBoxCorners,this._boundingBox)},$j._calculateBoundingSphere=function(){var $_=this._owner.meshFilter.sharedMesh;null==$_||null==$_.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($_.boundingSphere)},$j._calculateBoundingBox=function(){var $_=this._owner.meshFilter.sharedMesh;null==$_||null==$_.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($_.boundingBoxCorners)},$j._renderUpdate=function($_){var $S=this._owner.transform;if($S){this._setShaderValueMatrix4x4(0,$S.worldMatrix);var $j=this._owner.getProjectionViewWorldMatrix($_);this._setShaderValueMatrix4x4(1,$j)}else this._setShaderValueMatrix4x4(0,$_S.DEFAULT),this._setShaderValueMatrix4x4(1,$_);return $oS.debugMode&&this._renderRenderableBoundBox(),!0},$S}(),$xS=function($S){function $O(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$O.__super.call(this),this._renderState=new $p,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $sS,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $S_,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $RS(.7,.7,.7),this.ambientColor=new $RS(.212,.227,.259),$d.shaderHighPrecision&&this.addShaderDefine($yS.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$C($O,"laya.d3.core.scene.Scene",$S);var $_=$O.prototype;return $H.imps($_,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$_._setUrl=function($_){this._url=$_},$_._getGroup=function(){return this._group},$_._setGroup=function($_){this._group=$_},$_._display=function(){$H.stage._scenes.push(this),$H.stage._scenes.sort($O._sortScenes);for(var $_=0,$S=this._childs.length;$_<$S;$_++){var $j=this._childs[$_];$j.active&&$j._activeHierarchy()}},$_._unDisplay=function(){var $_=$H.stage._scenes;$_.splice($_.indexOf(this),1);for(var $S=0,$j=this._childs.length;$S<$j;$S++){var $O=this._childs[$S];$O.active&&$O._inActiveHierarchy()}},$_._addChild3D=function($_){$_.transform._onWorldTransform(),$_._setBelongScene(this),this.displayedInStage&&$_.active&&$_._activeHierarchy()},$_._removeChild3D=function($_){$_.transform.parent=null,this.displayedInStage&&$_.active&&$_._inActiveHierarchy(),$_._setUnBelongScene()},$_.initOctree=function($_,$S,$j,$O,$V){void 0===$V&&($V=6),this.treeSize=new $RS($_,$S,$j),this.treeLevel=$V,this.treeRoot=new $I(this,0),this.treeRoot.init($O,this.treeSize)},$_._prepareUpdateToRenderState=function($_,$S){$S.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$S.scene=this},$_._prepareSceneToRender=function($_){var $S=this._lights.length;if(0<$S)for(var $j=0,$O=0;$O<$S&&!(this._lights[$O]._prepareToScene($_)&&++$j>=this._enableLightCount);$O++);},$_._updateChilds=function($_){for(var $S=0,$j=this._childs.length;$S<$j;++$S)this._childs[$S]._update($_)},$_._preRenderScene=function($_,$S,$j){var $O,$V=$S._viewMatrix,$M=$S._projectionMatrix,$R=$S._projectionViewMatrix,$w=0,$a=$S.camera;for($a.useOcclusionCulling?this.treeRoot?$j_.renderObjectCullingOctree($j,this,$a,$V,$M,$R):$j_.renderObjectCulling($j,this,$a,$V,$M,$R):$j_.renderObjectCullingNoBoundFrustum(this,$a,$V,$M,$R),$w=0,$O=this._quenes.length;$w<$O;$w++)this._quenes[$w]&&this._quenes[$w]._preRender($S)},$_._clear=function($_,$S){var $j=$S._viewport,$O=$S.camera,$V=$j.x,$M=$O.renderTargetSize.height-$j.y-$j.height,$R=$j.width,$w=$j.height;$_.viewport($V,$M,$R,$w);var $a=256,$u=$O.renderTarget;switch($O.clearFlag){case 0:var $c=$O.clearColor;if($c){$_.enable(3089),$_.scissor($V,$M,$R,$w);var $q=$c.elements;$_.clearColor($q[0],$q[1],$q[2],$q[3]),$a|=16384}if($u)switch($c||($a=16384),$u.depthStencilFormat){case 33189:$a|=256;break;case 36168:$a|=1024;break;case 34041:$a|=256,$a|=1024}$_.clear($a),$c&&$_.disable(3089);break;case 1:case 2:if($u)switch($a=16384,$u.depthStencilFormat){case 33189:$a|=256;break;case 36168:$a|=1024;break;case 34041:$a|=256,$a|=1024}$_.clear($a);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$_._renderScene=function($_,$S){var $j,$O,$V=$S.camera,$M=0;for($M=0;$M<2;$M++)($O=this._quenes[$M])&&($V.renderTarget?$O._render($S,!0):$O._render($S,!1));if(1===$V.clearFlag){var $R=$V.sky;$R&&($n.setCullFace($_,!1),$n.setDepthFunc($_,515),$n.setDepthMask($_,!1),$R._render($S),$n.setDepthFunc($_,513),$n.setDepthMask($_,!0))}for($M=2,$j=this._quenes.length;$M<$j;$M++)($O=this._quenes[$M])&&($O._sortAlpha($S.camera.transform.position),$V.renderTarget?$O._render($S,!0):$O._render($S,!1))},$_._set3DRenderConfig=function($_){$_.disable(3042),$n._blend=!1,$_.blendFunc(770,771),$n._sFactor=770,$n._dFactor=771,$_.disable(2929),$n._depthTest=!1,$_.enable(2884),$n._cullFace=!0,$_.depthMask(1),$n._depthMask=!0,$_.frontFace(2304),$n._frontFace=2304},$_._set2DRenderConfig=function($_){$n.setBlend($_,!0),$n.setBlendFunc($_,1,771),$n.setDepthTest($_,!1),$n.setCullFace($_,!1),$n.setDepthMask($_,!0),$n.setFrontFace($_,2305),$_.viewport(0,0,$c.width,$c.height)},$_._parseCustomProps=function($_,$S,$j,$O){var $V=$O.customProps.lightmaps,$M=$V.length,$R=this._lightmaps;$R.length=$M;for(var $w=0;$w<$M;$w++)$R[$w]=$o.getRes($S[$V[$w].replace(".exr",".png")]);this.setlightmaps($R);var $a=$O.customProps.ambientColor;$a&&(this.ambientColor=new $RS($a[0],$a[1],$a[2]));var $u=$O.customProps.fogColor;$u&&(this.fogColor=new $RS($u[0],$u[1],$u[2]))},$_._addLight=function($_){this._lights.indexOf($_)<0&&this._lights.push($_)},$_._removeLight=function($_){var $S=this._lights.indexOf($_);0<=$S&&this._lights.splice($S,1)},$_._updateScene=function(){var $_=this._renderState;this._prepareUpdateToRenderState($d.mainContext,$_),this._updateComponents($_),this._updateChilds($_),this._lateUpdateComponents($_),this._time+=$_.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$_._updateSceneConch=function(){var $_=this._renderState;this._prepareUpdateToRenderState($d.mainContext,$_),this._updateComponents($_),this._lateUpdateComponents($_),this._prepareSceneToRender($_);for(var $S=0,$j=this._cameraPool.length;$S<$j;$S++){var $O=this._cameraPool[$S];($_.camera=$O)._prepareCameraToRender()}},$_._preRenderShadow=function($_,$S,$j,$O,$V){this.treeRoot?$j_.renderShadowObjectCullingOctree(this,$S,$j,$O,$V):$j_.renderShadowObjectCulling(this,$S,$j,$O,$V);for(var $M=0,$R=$j.length;$M<$R;$M++)$j[$M]&&$j[$M]._preRender($_)},$_._renderShadowMap=function($_,$S,$j){var $O=this.parallelSplitShadowMaps[0];$O._calcAllLightCameraInfo($j);var $V,$M,$R,$w=$O.PSSMNum;if(this._preRenderShadow($S,$O._lightCulling,$O._shadowQuenes,$O._lightVPMatrix[0],$w),this.addShaderDefine($CS.SHADERDEFINE_CAST_SHADOW),1<$w)for(var $a=0;$a<$w;$a++)$V=$O.getRenderTarget($a+1),$O.beginRenderTarget($a+1),$_.clearColor(1,1,1,1),$_.clear(16640),$_.viewport(0,0,$V.width,$V.height),$S.camera=$R=$O.getLightCamera($a),$R._prepareCameraToRender(),$R._prepareCameraViewProject($R.viewMatrix,$R.projectionMatrix),$S._projectionViewMatrix=$O._lightVPMatrix[$a+1],($M=$O._shadowQuenes[$a])._preRender($S),$M._renderShadow($S,!1),$O.endRenderTarget($a+1);else $V=$O.getRenderTarget(1),$O.beginRenderTarget(1),$_.clearColor(1,1,1,1),$_.clear(16640),$_.viewport(0,0,$V.width,$V.height),$S.camera=$R=$O.getLightCamera(0),$R._prepareCameraToRender(),$R._prepareCameraViewProject($R.viewMatrix,$R.projectionMatrix),$S._projectionViewMatrix=$O._lightVPMatrix[0],($M=$O._shadowQuenes[0])._preRender($S),$M._renderShadow($S,!0),$O.endRenderTarget(1);this.removeShaderDefine($CS.SHADERDEFINE_CAST_SHADOW)},$_.addTreeNode=function($_){this.treeRoot.addTreeNode($_)},$_.removeTreeNode=function($_){this.treeSize&&$_._treeNode&&$_._treeNode.removeObject($_)},$_.setlightmaps=function($_){this._lightmaps=$_;for(var $S=0,$j=this._renderableSprite3Ds.length;$S<$j;$S++)this._renderableSprite3Ds[$S]._render._applyLightMapParams()},$_.getlightmaps=function(){return this._lightmaps},$_.addChildAt=function($_,$S){if(!($_ instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($_&&$_.__className));if(!$_||this.destroyed||$_===this)return $_;if($_.zOrder&&this._set$P("hasZorder",!0),0<=$S&&$S<=this._childs.length){if($_._parent===this){var $j=this.getChildIndex($_);this._childs.splice($j,1),this._childs.splice($S,0,$_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,$S)),this._childChanged()}else $_.parent&&$_.parent.removeChild($_),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($S,0,$_),this.conchModel&&this.conchModel.addChildAt($_.conchModel,$S),($_.parent=this)._addChild3D($_);return $_}throw new Error("appendChildAt:The index is out of bounds")},$_.addChild=function($_){if(!($_ instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$_||this.destroyed||$_===this)return $_;if($_.zOrder&&this._set$P("hasZorder",!0),$_._parent===this){var $S=this.getChildIndex($_);$S!==this._childs.length-1&&(this._childs.splice($S,1),this._childs.push($_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,this._childs.length-1)),this._childChanged())}else $_.parent&&$_.parent.removeChild($_),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($_),this.conchModel&&this.conchModel.addChildAt($_.conchModel,this._childs.length-1),($_.parent=this)._childChanged(),this._addChild3D($_);return $_},$_.removeChildAt=function($_){var $S=this.getChildAt($_);return $S&&(this._removeChild3D($S),this._childs.splice($_,1),this.conchModel&&this.conchModel.removeChild($S.conchModel),$S.parent=null),$S},$_.removeChildren=function($_,$S){if(void 0===$_&&($_=0),void 0===$S&&($S=2147483647),this._childs&&0<this._childs.length){var $j=this._childs;if(0===$_&&$M<=$S){var $O=$j;this._childs=$u.ARRAY_EMPTY}else $O=$j.splice($_,$S-$_);for(var $V=0,$M=$O.length;$V<$M;$V++)this._removeChild3D($O[$V]),$O[$V].parent=null,this.conchModel&&this.conchModel.removeChild($O[$V].conchModel)}return this},$_.addFrustumCullingObject=function($_){this.treeRoot?this.addTreeNode($_):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($_):this._cullingRenders[this._cullingRendersLength]=$_,$_._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$_.removeFrustumCullingObject=function($_){if(this.treeRoot)this.removeTreeNode($_);else{this._cullingRendersLength--;var $S=$_._indexInSceneFrustumCullingObjects;if($S!==this._cullingRendersLength){var $j=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$S]=$j)._indexInSceneFrustumCullingObjects=$S,$_._indexInSceneFrustumCullingObjects=-1}}},$_.getRenderQueue=function($_){return $_<3e3?this._quenes[1]||(this._quenes[1]=new $W(this)):this._quenes[2]||(this._quenes[2]=new $W(this))},$_.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $W(this)},$_.addShaderDefine=function($_){this._shaderDefineValue|=$_},$_.removeShaderDefine=function($_){this._shaderDefineValue&=~$_},$_.addScript=function($_){return this._addComponent($_)},$_.getScriptByType=function($_,$S){return void 0===$S&&($S=0),this._getComponentByType($_,$S)},$_.getScriptsByType=function($_,$S){this._getComponentsByType($_,$S)},$_.getScriptByIndex=function($_){return this._getComponentByIndex($_)},$_.removeScriptByType=function($_,$S){void 0===$S&&($S=0),this._removeComponentByType($_,$S)},$_.removeScriptsByType=function($_){this._removeComponentByType($_)},$_.removeAllScript=function(){this._removeAllComponent()},$_.render=function($_,$S,$j){($v._context.ctx._renderKey=0)<this._childs.length&&$_.addRenderObject(this)},$_.renderSubmit=function(){var $_=$d.mainContext,$S=this._renderState;this._set3DRenderConfig($_),this._prepareSceneToRender(this._renderState);var $j,$O=0,$V=0;if($oS.debugMode||$I.debugMode)for($O=0,$V=this._cameraPool.length;$O<$V;$O++)$j=this._cameraPool[$O],$oS._debugPhasorSprite.begin(1,$j),$j.activeInHierarchy&&$j._renderCamera($_,$S,this),$oS._debugPhasorSprite.end();else for($O=0,$V=this._cameraPool.length;$O<$V;$O++)($j=this._cameraPool[$O]).activeInHierarchy&&$j._renderCamera($_,$S,this);return this._set2DRenderConfig($_),1},$_.onAsynLoaded=function($_,$S,$j){var $O=$S[0];if("Scene"!==$O.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $V=$S[1];$ZS._createNodeByJson(this,$O,this,$V),this.event("hierarchyloaded",[this]),this.__loaded=!0},$_.destroy=function($_){void 0===$_&&($_=!0),this.destroyed||($S.prototype.destroy.call(this,$_),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$o.clearRes(this.url),this.loaded||$oS._cancelLoadByUrl(this.url))},$_.getRenderType=function(){return 0},$_.releaseRender=function(){},$_._addComponent=function($_){var $S,$j=this._componentsMap.indexOf($_);if(-1===$j)$S=[],this._componentsMap.push($_),this._typeComponentsIndices.push($S);else if($S=this._typeComponentsIndices[$j],this._components[$S[0]].isSingleton)throw new Error("无法单实例创建"+$_+"组件，"+$_+"组件已存在！");var $O=$V.getInstance($_);$S.push(this._components.length),this._components.push($O);return $O._initialize(this),$O},$_._removeComponent=function($_,$S){var $j=this._typeComponentsIndices[$_],$O=$j[$S],$V=this._components[$O];this._components.splice($O,1),$j.splice($S,1),0===$j.length&&(this._typeComponentsIndices.splice($_,1),this._componentsMap.splice($_,1));for(var $M=0,$R=this._componentsMap.length;$M<$R;$M++)for(var $w=($j=this._typeComponentsIndices[$M]).length-1;0<=$w;$w--){var $a=$j[$w];if(!($O<$a))break;$j[$w]=--$a}$V._destroy()},$_._getComponentByType=function($_,$S){void 0===$S&&($S=0);var $j=this._componentsMap.indexOf($_);return-1===$j?null:this._components[this._typeComponentsIndices[$j][$S]]},$_._getComponentsByType=function($_,$S){var $j=this._componentsMap.indexOf($_);if(-1!==$j){var $O=this._typeComponentsIndices[$j],$V=$O.length;$S.length=$V;for(var $M=0;$M<$V;$M++)$S[$M]=this._components[$O[$M]]}else $S.length=0},$_._getComponentByIndex=function($_){return this._components[$_]},$_._removeComponentByType=function($_,$S){void 0===$S&&($S=0);var $j=this._componentsMap.indexOf($_);-1!==$j&&this._removeComponent($j,$S)},$_._removeComponentsByType=function($_){var $S=this._componentsMap.indexOf($_);if(-1!==$S)for(var $j=this._typeComponentsIndices[$S],$O=0,$V=$j.length;$O<$V;$j.length<$V?$V--:$O++)this._removeComponent($S,$O)},$_._removeAllComponent=function(){for(var $_=0,$S=this._componentsMap.length;$_<$S;this._componentsMap.length<$S?$S--:$_++)this._removeComponentsByType(this._componentsMap[$_])},$_._updateComponents=function($_){for(var $S=0,$j=this._components.length;$S<$j;$S++){var $O=this._components[$S];!$O.started&&($O._start($_),$O.started=!0),$O.enable&&$O._update($_)}},$_._lateUpdateComponents=function($_){for(var $S=0;$S<this._components.length;$S++){var $j=this._components[$S];!$j.started&&($j._start($_),$j.started=!0),$j.enable&&$j._lateUpdate($_)}},$_._preRenderUpdateComponents=function($_){for(var $S=0;$S<this._components.length;$S++){var $j=this._components[$S];!$j.started&&($j._start($_),$j.started=!0),$j.enable&&$j._preRenderUpdate($_)}},$_._postRenderUpdateComponents=function($_){for(var $S=0;$S<this._components.length;$S++){var $j=this._components[$S];!$j.started&&($j._start($_),$j.started=!0),$j.enable&&$j._postRenderUpdate($_)}},$i(0,$_,"_loaded",null,function($_){this.__loaded=$_}),$i(0,$_,"fogColor",function(){return this._fogColor},function($_){this._fogColor=$_,this._shaderValues.setValue(0,$_.elements)}),$i(0,$_,"enableFog",function(){return this._enableFog},function($_){this._enableFog!==$_&&((this._enableFog=$_)?(this.addShaderDefine($yS.SHADERDEFINE_FOG),this.removeShaderDefine($yS.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($yS.SHADERDEFINE_FOG))}),$i(0,$_,"url",function(){return this._url}),$i(0,$_,"loaded",function(){return this.__loaded}),$i(0,$_,"enableDepthFog",function(){return this._enableDepthFog},function($_){this._enableDepthFog!=$_&&((this._enableDepthFog=$_)?(this.addShaderDefine($yS.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($yS.SHADERDEFINE_FOG)):this.removeShaderDefine($yS.SAHDERDEFINE_DEPTHFOG))}),$i(0,$_,"fogStart",function(){return this._fogStart},function($_){this._fogStart=$_,this._shaderValues.setValue(1,$_)}),$i(0,$_,"fogRange",function(){return this._fogRange},function($_){this._fogRange=$_,this._shaderValues.setValue(2,$_)}),$i(0,$_,"ambientColor",function(){return this._ambientColor},function($_){this._ambientColor=$_,this._shaderValues.setValue(21,$_.elements)}),$i(0,$_,"scene",function(){return this}),$i(0,$_,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$O._sortScenes=function($_,$S){if($_.parent!==$H.stage||$S.parent!==$H.stage)return $_.parent!==$H.stage&&$S.parent!==$H.stage?$O._sortScenes($_.parent,$S.parent):$_.parent===$H.stage?-1:1;var $j=$H.stage._childs;return $j.indexOf($_)-$j.indexOf($S)},$O.load=function($_){return $H.loader.create($_,null,null,$O)},$O.FOGCOLOR=0,$O.FOGSTART=1,$O.FOGRANGE=2,$O.LIGHTDIRECTION=3,$O.LIGHTDIRCOLOR=4,$O.POINTLIGHTPOS=5,$O.POINTLIGHTRANGE=6,$O.POINTLIGHTATTENUATION=7,$O.POINTLIGHTCOLOR=8,$O.SPOTLIGHTPOS=9,$O.SPOTLIGHTDIRECTION=10,$O.SPOTLIGHTSPOT=11,$O.SPOTLIGHTRANGE=12,$O.SPOTLIGHTATTENUATION=13,$O.SPOTLIGHTCOLOR=14,$O.SHADOWDISTANCE=15,$O.SHADOWLIGHTVIEWPROJECT=16,$O.SHADOWMAPPCFOFFSET=17,$O.SHADOWMAPTEXTURE1=18,$O.SHADOWMAPTEXTURE2=19,$O.SHADOWMAPTEXTURE3=20,$O.AMBIENTCOLOR=21,$O.TIME=22,$O}($f),$hS=function($_){function $S($_){$S.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $_S,this._shaderValues=new $sS,this._colliders=[],this._id=++$S._uniqueIDCounter,this._transform=new $AS(this),this.name=$_||"Sprite3D-"+$S._nameNumberCounter++,this.layer=$F.currentCreationLayer,this.active=!0}$C($S,"laya.d3.core.Sprite3D",$ES);var $j=$S.prototype;return $H.imps($j,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$j._setUrl=function($_){this._url=$_},$j._getGroup=function(){return this._group},$j._setGroup=function($_){this._group=$_},$j._addChild3D=function($_){$_.transform.parent=this.transform,this._hierarchyAnimator&&(!$_._hierarchyAnimator&&$_._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($_,!0,[$_.name])),this._scene&&($_._setBelongScene(this._scene),this._activeInHierarchy&&$_._active&&$_._activeHierarchy())},$j._removeChild3D=function($_){$_.transform.parent=null,this._scene&&(this._activeInHierarchy&&$_._active&&$_._inActiveHierarchy(),$_._setUnBelongScene()),this._hierarchyAnimator&&($_._hierarchyAnimator==this._hierarchyAnimator&&$_._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($_,!1,[$_.name]))},$j._parseBaseCustomProps=function($_){var $S=this.transform.localPosition;$_.translate?($S.fromArray($_.translate),$S.x*=100,$S.y*=100,$S.z*=100):$S.elements.fill(0),this.transform.localPosition=$S;var $j=this.transform.localRotation;$_.rotation?$j.fromArray($_.rotation):$j.fromArray([0,0,0,-1]),this.transform.localRotation=$j;var $O=this.transform.localScale;$_.scale?$O.fromArray($_.scale):$O.elements.fill(1),this.transform.localScale=$O;var $V=$_.layer;null!=$V&&(this.layer=$F.getLayerByNumber($V))},$j._parseCustomComponent=function($_,$S,$j){for(var $O in $j){var $V=$j[$O];switch($O){case"Animator":var $M=this.addComponent(Animator);if($V.avatarPath)$M.avatar=$o.getRes($S[$V.avatarPath]);else{var $R=$V.avatar;if($R){$M.avatar=$o.getRes($S[$R.path]);var $w=$R.linkSprites;$w&&$_.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$M,$w])}}for(var $a=$V.clipPaths,$u=$a.length,$c=0;$c<$u;$c++)$M.addClip($o.getRes($S[$a[$c]]));$M.clip=$o.getRes($S[$a[0]]);var $q=$V.playOnWake;void 0!==$q&&($M.playOnWake=$q);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $s=this.addComponent(SphereCollider);$s.isTrigger=$V.isTrigger;var $C=$s.center;$C.fromArray($V.center),$s.center=$C,$s.radius=$V.radius;break;case"BoxCollider":var $i=this.addComponent(BoxCollider);$i.isTrigger=$V.isTrigger,$i.center.fromArray($V.center);var $v=$i.size;$v.fromArray($V.size),$i.size=$v;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$j._onRootNodeHierarchyLoaded=function($_,$S){for(var $j in $S){for(var $O=this,$V=$S[$j],$M=0,$R=$V.length;$M<$R;$M++){var $w=$V[$M];if(""===$w)break;if(!($O=$O.getChildByName($w)))break}$O&&$_.linkSprite3DToAvatarNode($j,$O)}},$j._setHierarchyAnimator=function($_,$S){this._changeHierarchyAnimator($_);for(var $j=0,$O=this._childs.length;$j<$O;$j++){var $V=this._childs[$j];$V._hierarchyAnimator==$S&&$V._setHierarchyAnimator($_,$S)}},$j._clearHierarchyAnimator=function($_,$S){this._changeHierarchyAnimator($S);for(var $j=0,$O=this._childs.length;$j<$O;$j++){var $V=this._childs[$j];$V._hierarchyAnimator==$_&&$V._clearHierarchyAnimator($_,$S)}},$j._getAnimatorToLinkSprite3D=function($_,$S,$j){var $O=this.getComponentByType(Animator);if($O&&($O.avatar?$O.avatar._version||$_._setAnimatorToLinkAvatar($O,$S):$_._setAnimatorToLinkSprite3DNoAvatar($O,$S,$j)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$j.unshift(this._parent.name);var $V=this._parent;$V._hierarchyAnimator&&$V._getAnimatorToLinkSprite3D($_,$S,$j)}},$j._setAnimatorToLinkSprite3DNoAvatar=function($_,$S,$j){var $O=0,$V=0;for($O=0,$V=$_.getClipCount();$O<$V;$O++)$_._handleSpriteOwnersBySprite($O,$S,$j,this);for($O=0,$V=this._childs.length;$O<$V;$O++){var $M=this._childs[$O],$R=$j.length;$j.push($M.name),$M._setAnimatorToLinkSprite3DNoAvatar($_,$S,$j),$j.splice($R,1)}},$j._changeHierarchyAnimator=function($_){this._hierarchyAnimator=$_},$j._isLinkSpriteToAnimationNode=function($_,$S,$j){var $O=$_._avatarNodes.indexOf($S),$V=$_._cacheSpriteToNodesMap;if($j)this._transform.dummy=$S.transform,$_._cacheNodesToSpriteMap[$O]=$V.length,$V.push($O);else{this._transform.dummy=null;var $M=$_._cacheNodesToSpriteMap[$O];$_._cacheNodesToSpriteMap[$O]=null,$V.splice($M,1)}},$j._setBelongScene=function($_){this._scene=$_;for(var $S=0,$j=this._childs.length;$S<$j;$S++)this._childs[$S]._setBelongScene($_)},$j._setUnBelongScene=function(){this._scene=null;for(var $_=0,$S=this._childs.length;$_<$S;$_++)this._childs[$_]._setUnBelongScene()},$j._activeHierarchy=function(){var $_=0,$S=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$_=0,$S=this._colliders.length;$_<$S;$_++)this._layer._addCollider(this._colliders[$_]);for(this.event("activeinhierarchychanged",!0),$_=0,$S=this._childs.length;$_<$S;$_++){var $j=this._childs[$_];$j._active&&$j._activeHierarchy()}},$j._inActiveHierarchy=function(){var $_=0,$S=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$_=0,$S=this._colliders.length;$_<$S;$_++){var $j=this._colliders[$_];$j._clearCollsionMap(),this._layer._removeCollider($j)}for(this.event("activeinhierarchychanged",!1),$_=0,$S=this._childs.length;$_<$S;$_++){var $O=this._childs[$_];$O._active&&$O._inActiveHierarchy()}},$j.addComponent=function($_){var $S,$j=this._componentsMap.indexOf($_);if(-1===$j)$S=[],this._componentsMap.push($_),this._typeComponentsIndices.push($S);else if($S=this._typeComponentsIndices[$j],this._components[$S[0]].isSingleton)throw new Error("无法单实例创建"+$_+"组件，"+$_+"组件已存在！");var $O=$V.getInstance($_);return $S.push(this._components.length),this._components.push($O),$O instanceof laya.d3.component.Script&&this._scripts.push($O),$O._initialize(this),$O},$j._removeComponent=function($_,$S){var $j,$O=0,$V=this._typeComponentsIndices[$_],$M=$V[$S],$R=this._components[$M];for($R instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($R),1),$V.splice($S,1),0===$V.length&&(this._typeComponentsIndices.splice($_,1),this._componentsMap.splice($_,1)),$O=0,$j=this._componentsMap.length;$O<$j;$O++)for(var $w=($V=this._typeComponentsIndices[$O]).length-1;0<=$w;$w--){var $a=$V[$w];if(!($M<$a))break;$V[$w]=--$a}$R._destroy()},$j._clearSelfRenderObjects=function(){},$j._addSelfRenderObjects=function(){},$j._parseCustomProps=function($_,$S,$j,$O){},$j._updateChilds=function($_){var $S=this._childs.length;if(0!==$S)for(var $j=0;$j<$S;++$j)this._childs[$j]._update($_)},$j._getSortID=function($_,$S){return 1e3*$S.id+$_._getVertexBuffer().vertexDeclaration.id},$j._update=function($_){($_.owner=this)._activeInHierarchy&&(this._updateComponents($_),this._lateUpdateComponents($_),$y.spriteCount++,this._childs.length&&this._updateChilds($_))},$j.getProjectionViewWorldMatrix=function($_){return $_S.multiply($_,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$j.loadHierarchy=function($_){this.addChild(laya.d3.core.Sprite3D.load($_))},$j.addChildAt=function($_,$S){if(!($_ instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$_||this.destroyed||$_===this)return $_;if($_.zOrder&&this._set$P("hasZorder",!0),0<=$S&&$S<=this._childs.length){if($_._parent===this){var $j=this.getChildIndex($_);this._childs.splice($j,1),this._childs.splice($S,0,$_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,$S)),this._childChanged()}else $_.parent&&$_.parent.removeChild($_),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($S,0,$_),this.conchModel&&this.conchModel.addChildAt($_.conchModel,$S),($_.parent=this)._addChild3D($_);return $_}throw new Error("appendChildAt:The index is out of bounds")},$j.addChild=function($_){if(!($_ instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$_||this.destroyed||$_===this)return $_;if($_.zOrder&&this._set$P("hasZorder",!0),$_._parent===this){var $S=this.getChildIndex($_);$S!==this._childs.length-1&&(this._childs.splice($S,1),this._childs.push($_),this.conchModel&&(this.conchModel.removeChild($_.conchModel),this.conchModel.addChildAt($_.conchModel,this._childs.length-1)),this._childChanged())}else $_.parent&&$_.parent.removeChild($_),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($_),this.conchModel&&this.conchModel.addChildAt($_.conchModel,this._childs.length-1),($_.parent=this)._childChanged(),this._addChild3D($_);return $_},$j.removeChildAt=function($_){var $S=this.getChildAt($_);return $S&&(this._removeChild3D($S),this._childs.splice($_,1),this.conchModel&&this.conchModel.removeChild($S.conchModel),$S.parent=null),$S},$j.removeChildren=function($_,$S){if(void 0===$_&&($_=0),void 0===$S&&($S=2147483647),this._childs&&0<this._childs.length){var $j=this._childs;if(0===$_&&$M<=$S){var $O=$j;this._childs=$u.ARRAY_EMPTY}else $O=$j.splice($_,$S-$_);for(var $V=0,$M=$O.length;$V<$M;$V++)this._removeChild3D($O[$V]),$O[$V].parent=null,this.conchModel&&this.conchModel.removeChild($O[$V].conchModel)}return this},$j.onAsynLoaded=function($_,$S,$j){var $O=$S[0];if("Sprite3D"!==$O.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $V=$S[1];$ZS._createNodeByJson(this,$O,this,$V),this.event("hierarchyloaded",[this]),this.__loaded=!0},$j.cloneTo=function($_){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $S=$_;$S.name=this.name,$S._destroyed=this._destroyed,$S.timer=this.timer,$S._$P=this._$P,$S.active=this._active;var $j=$S.transform.localPosition;this.transform.localPosition.cloneTo($j),$S.transform.localPosition=$j;var $O=$S.transform.localRotation;this.transform.localRotation.cloneTo($O),$S.transform.localRotation=$O;var $V=$S.transform.localScale;this.transform.localScale.cloneTo($V),$S.transform.localScale=$V,$S.isStatic=this.isStatic;var $M=0,$R=0;for($M=0,$R=this._componentsMap.length;$M<$R;$M++){var $w=$S.addComponent(this._componentsMap[$M]);this._components[$M]._cloneTo($w)}for($M=0,$R=this._childs.length;$M<$R;$M++)$S.addChild(this._childs[$M].clone());var $a=$S.getComponentByType(Animator);if($a){var $u=$a._linkSpritesData;if($u)for(var $c in $u){for(var $q=$u[$c],$s=$S,$C=0,$i=$q.length;$C<$i&&($s=$s.getChildByName($q[$C]));$C++);if($s){var $v=$a._avatarNodeMap[$c];$s._isLinkSpriteToAnimationNode($a,$v,!0)}}}},$j.clone=function(){var $_=new this.constructor;return this.cloneTo($_),$_},$j.destroy=function($_){if(void 0===$_&&($_=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$_);var $S,$j=0;for($j=0,$S=this._components.length;$j<$S;$j++)this._components[$j]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$o.clearRes(this.url),this.loaded||$oS._cancelLoadByUrl(this.url)}},$j._handleSpriteToAvatar=function($_,$S){$_._avatarNodes;var $j=$_._avatarNodeMap[this.name];$j&&$j.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($_,$j,$S)},$j._setAnimatorToLinkAvatar=function($_,$S){this._handleSpriteToAvatar($_,$S);for(var $j=0,$O=this._childs.length;$j<$O;$j++){this._childs[$j]._setAnimatorToLinkAvatar($_,$S)}},$i(0,$j,"activeInHierarchy",function(){return this._activeInHierarchy}),$i(0,$j,"_loaded",null,function($_){this.__loaded=$_}),$i(0,$j,"active",function(){return this._active},function($_){this._active!==$_&&(this._active=$_,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($_?this._activeHierarchy():this._inActiveHierarchy()))}),$i(0,$j,"componentsCount",function(){return this._components.length}),$i(0,$j,"loaded",function(){return this.__loaded}),$i(0,$j,"id",function(){return this._id}),$i(0,$j,"url",function(){return this._url}),$i(0,$j,"layer",function(){return this._layer},function($_){if(this._layer!==$_){if(!$_)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $S=0,$j=this._colliders.length;if(this._layer)for($S=0;$S<$j;$S++)this._layer._removeCollider(this._colliders[$S]);for($S=0;$S<$j;$S++)$_._addCollider(this._colliders[$S])}this._layer=$_,this.event("layerchanged",$_)}}),$i(0,$j,"scene",function(){return this._scene}),$i(0,$j,"transform",function(){return this._transform}),$S.instantiate=function($_,$S,$j,$O,$V){void 0===$j&&($j=!0);var $M=$_.clone();$S&&$S.addChild($M);var $R=$M.transform;if($j){var $w=$R.worldMatrix;$_.transform.worldMatrix.cloneTo($w),$R.worldMatrix=$w}else $O&&($R.position=$O),$V&&($R.rotation=$V);return $M},$S.load=function($_){return $H.loader.create($_,null,null,$S)},$S.WORLDMATRIX=0,$S.MVPMATRIX=1,$S._uniqueIDCounter=0,$S._nameNumberCounter=0,$S}(),$NS=function($_){function $c($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$c.__super.call(this),!$_||!$S)throw"Shader Error";this._id=++$c._count,this._vs=$_,this._ps=$S,this._attributeMap=$j,this._sceneUniformMap=$O,this._cameraUniformMap=$V,this._spriteUniformMap=$M,this._materialUniformMap=$R,this._renderElementUniformMap=$w,this._precompile=$a,this._define=$u,this._precompile&&$c.extCompileObj&&$c.extCompileFunc?$c.extCompileFunc.call($c.extCompileObj,$_,$S,$u):this.recreateResource()}$C($c,"laya.d3.shader.Shader3D",$j);var $S=$c.prototype;return $S.recreateResource=function(){$J.now();this._compile(),this.completeCreate(),this.memorySize=0},$S.disposeResource=function(){$d.mainContext.deleteShader(this._vshader),$d.mainContext.deleteShader(this._pshader),$d.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$S._compile=function(){if(!$d.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $_=[this._vs,this._ps],$S=$d.mainContext;if(this._program=$S.createProgram(),this._vshader=$c._createShader($S,$_[0],35633),this._pshader=$c._createShader($S,$_[1],35632),$S.attachShader(this._program,this._vshader),$S.attachShader(this._program,this._pshader),$S.linkProgram(this._program),!$v.isConchApp&&$yS.debugMode&&!$S.getProgramParameter(this._program,35714))throw $S.getProgramInfoLog(this._program);var $j,$O=0,$V=0,$M=0;for($M=$v.isConchApp?$S.getProgramParameterEx(this._vs,this._ps,"",35721):$S.getProgramParameter(this._program,35721),$O=0;$O<$M;$O++){var $R=null;$j={vartype:"attribute",ivartype:0,attrib:$R=$v.isConchApp?$S.getActiveAttribEx(this._vs,this._ps,"",$O):$S.getActiveAttrib(this._program,$O),location:$S.getAttribLocation(this._program,$R.name),name:$R.name,type:$R.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($j)}var $w=0;for($w=$v.isConchApp?$S.getProgramParameterEx(this._vs,this._ps,"",35718):$S.getProgramParameter(this._program,35718),$O=0;$O<$w;$O++){var $a=null;$a=$v.isConchApp?$S.getActiveUniformEx(this._vs,this._ps,"",$O):$S.getActiveUniform(this._program,$O),0<($j={vartype:"uniform",ivartype:1,attrib:$R,location:$S.getUniformLocation(this._program,$a.name),name:$a.name,type:$a.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($j.name=$j.name.substr(0,$j.name.length-3),$j.isArray=!0,$j.location=$S.getUniformLocation(this._program,$j.name)),this._uniformParams.push($j)}for($O=0,$V=this._attributeParams.length;$O<$V;$O++)($j=this._attributeParams[$O]).indexOfParams=$O,$j.index=1,$j.value=[$j.location,null],$j.codename=$j.name,$j.name=null!=this._attributeMap[$j.codename]?this._attributeMap[$j.codename]:$j.codename,this._attributeParamsMap.push($j.name),this._attributeParamsMap.push($j),$j._this=this,$j.uploadedValue=[],$j.fun=this._attribute;for($O=0,$V=this._uniformParams.length;$O<$V;$O++)switch(($j=this._uniformParams[$O]).indexOfParams=$O,$j.index=1,$j.value=[$j.location,null],$j.codename=$j.name,null!=this._sceneUniformMap[$j.codename]?($j.name=this._sceneUniformMap[$j.codename],this._sceneUniformParamsMap.push($j.name),this._sceneUniformParamsMap.push($j)):null!=this._cameraUniformMap[$j.codename]?($j.name=this._cameraUniformMap[$j.codename],this._cameraUniformParamsMap.push($j.name),this._cameraUniformParamsMap.push($j)):null!=this._spriteUniformMap[$j.codename]?($j.name=this._spriteUniformMap[$j.codename],this._spriteUniformParamsMap.push($j.name),this._spriteUniformParamsMap.push($j)):null!=this._materialUniformMap[$j.codename]?($j.name=this._materialUniformMap[$j.codename],this._materialUniformParamsMap.push($j.name),this._materialUniformParamsMap.push($j)):null!=this._renderElementUniformMap[$j.codename]?($j.name=this._renderElementUniformMap[$j.codename],this._renderElementUniformParamsMap.push($j.name),this._renderElementUniformParamsMap.push($j)):console.log("Shader:can't find uinform name:"+$j.codename+" in shader file."),$j._this=this,$j.uploadedValue=[],$j.type){case 5124:$j.fun=$j.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$j.fun=$j.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$j.fun=$j.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$j.fun=$j.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$j.fun=$j.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$j.fun=this._uniform_sampler2D;break;case 35680:$j.fun=this._uniform_samplerCube;break;case 35676:$j.fun=this._uniformMatrix4fv;break;case 35670:$j.fun=this._uniform1i;break;case 35674:$j.fun=this._uinformMatrix2fv;break;case 35675:$j.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$S._attribute=function($_,$S){var $j=$d.mainContext,$O=$w._enableAtributes,$V=$_.location;return $O[$V]||$j.enableVertexAttribArray($V),$j.vertexAttribPointer($V,$S[0],$S[1],$S[2],$S[3],$S[4]),$O[$V]=$w._bindVertexBuffer,1},$S._uniform1f=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S?($d.mainContext.uniform1f($_.location,$j[0]=$S),1):0},$S._uniform1fv=function($_,$S){if($S.length<4){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($d.mainContext.uniform1fv($_.location,$S),$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3],1):0}return $d.mainContext.uniform1fv($_.location,$S),1},$S._uniform_vec2=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]?($d.mainContext.uniform2f($_.location,$j[0]=$S[0],$j[1]=$S[1]),1):0},$S._uniform_vec2v=function($_,$S){if($S.length<2){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($d.mainContext.uniform2fv($_.location,$S),$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3],1):0}return $d.mainContext.uniform2fv($_.location,$S),1},$S._uniform_vec3=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]?($d.mainContext.uniform3f($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2]),1):0},$S._uniform_vec3v=function($_,$S){return $d.mainContext.uniform3fv($_.location,$S),1},$S._uniform_vec4=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($d.mainContext.uniform4f($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3]),1):0},$S._uniform_vec4v=function($_,$S){return $d.mainContext.uniform4fv($_.location,$S),1},$S._uniformMatrix2fv=function($_,$S){return $d.mainContext.uniformMatrix2fv($_.location,!1,$S),1},$S._uniformMatrix3fv=function($_,$S){return $d.mainContext.uniformMatrix3fv($_.location,!1,$S),1},$S._uniformMatrix4fv=function($_,$S){return $d.mainContext.uniformMatrix4fv($_.location,!1,$S),1},$S._uinformMatrix2fv=function($_,$S){return $d.mainContext.uniformMatrix2fv($_.location,!1,$S),1},$S._uinformMatrix3fv=function($_,$S){return $d.mainContext.uniformMatrix3fv($_.location,!1,$S),1},$S._uniform1i=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S?($d.mainContext.uniform1i($_.location,$j[0]=$S),1):0},$S._uniform1iv=function($_,$S){return $d.mainContext.uniform1iv($_.location,$S),1},$S._uniform_ivec2=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]?($d.mainContext.uniform2i($_.location,$j[0]=$S[0],$j[1]=$S[1]),1):0},$S._uniform_ivec2v=function($_,$S){return $d.mainContext.uniform2iv($_.location,$S),1},$S._uniform_vec3i=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]?($d.mainContext.uniform3i($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2]),1):0},$S._uniform_vec3vi=function($_,$S){return $d.mainContext.uniform3iv($_.location,$S),1},$S._uniform_vec4i=function($_,$S){var $j=$_.uploadedValue;return $j[0]!==$S[0]||$j[1]!==$S[1]||$j[2]!==$S[2]||$j[3]!==$S[3]?($d.mainContext.uniform4i($_.location,$j[0]=$S[0],$j[1]=$S[1],$j[2]=$S[2],$j[3]=$S[3]),1):0},$S._uniform_vec4vi=function($_,$S){return $d.mainContext.uniform4iv($_.location,$S),1},$S._uniform_sampler2D=function($_,$S){var $j=$S.source||$S.defaulteTexture.source,$O=$d.mainContext,$V=$_.uploadedValue;if(null!=$V[0])return $O.activeTexture($c._TEXTURES[$V[0]]),$j&&$n.bindTexture($O,3553,$j),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $V[0]=this._curActTexIndex,$O.uniform1i($_.location,this._curActTexIndex),$O.activeTexture($c._TEXTURES[this._curActTexIndex]),$j&&$n.bindTexture($O,3553,$j),this._curActTexIndex++,1},$S._uniform_samplerCube=function($_,$S){var $j=$S.source||$S.defaulteTexture.source,$O=$d.mainContext,$V=$_.uploadedValue;if(null!=$V[0])return $O.activeTexture($c._TEXTURES[$V[0]]),$j?$n.bindTexture($O,34067,$j):$n.bindTexture($O,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $V[0]=this._curActTexIndex,$O.uniform1i($_.location,this._curActTexIndex),$O.activeTexture($c._TEXTURES[this._curActTexIndex]),$j?$n.bindTexture($O,34067,$j):$n.bindTexture($O,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$S._noSetValue=function($_){console.log("no....:"+$_.name)},$S.bind=function(){return $j.activeShader=this,($j.bindShader=this).activeResource(),$n.UseProgram(this._program)},$S.uploadAttributes=function($_,$S){for(var $j,$O,$V=0,$M=0,$R=this._attributeParamsMap.length;$M<$R;$M+=2)$O=this._attributeParamsMap[$M+1],null!=($j=$_[this._attributeParamsMap[$M]])&&($S&&$S[$O.name]&&$S[$O.name].bind(),$V+=$O.fun.call(this,$O,$j));$y.shaderCall+=$V},$S.uploadAttributesX=function($_,$S){for(var $j,$O,$V=0,$M=0,$R=this._attributeParamsMap.length;$M<$R;$M+=2)$O=this._attributeParamsMap[$M+1],null!=($j=$_[this._attributeParamsMap[$M]])&&($S._bind(),$V+=$O.fun.call(this,$O,$j));$y.shaderCall+=$V},$S.uploadSceneUniforms=function($_){for(var $S,$j,$O=0,$V=0,$M=this._sceneUniformParamsMap.length;$V<$M;$V+=2)$j=this._sceneUniformParamsMap[$V+1],null!=($S=$_[this._sceneUniformParamsMap[$V]])&&($O+=$j.fun.call(this,$j,$S));$y.shaderCall+=$O},$S.uploadCameraUniforms=function($_){for(var $S,$j,$O=0,$V=0,$M=this._cameraUniformParamsMap.length;$V<$M;$V+=2)$j=this._cameraUniformParamsMap[$V+1],null!=($S=$_[this._cameraUniformParamsMap[$V]])&&($O+=$j.fun.call(this,$j,$S));$y.shaderCall+=$O},$S.uploadSpriteUniforms=function($_){for(var $S,$j,$O=0,$V=0,$M=this._spriteUniformParamsMap.length;$V<$M;$V+=2)$j=this._spriteUniformParamsMap[$V+1],null!=($S=$_[this._spriteUniformParamsMap[$V]])&&($O+=$j.fun.call(this,$j,$S));$y.shaderCall+=$O},$S.uploadMaterialUniforms=function($_){for(var $S,$j,$O=0,$V=0,$M=this._materialUniformParamsMap.length;$V<$M;$V+=2)$j=this._materialUniformParamsMap[$V+1],null!=($S=$_[this._materialUniformParamsMap[$V]])&&($O+=$j.fun.call(this,$j,$S));$y.shaderCall+=$O},$S.uploadRenderElementUniforms=function($_){for(var $S,$j,$O=0,$V=0,$M=this._renderElementUniformParamsMap.length;$V<$M;$V+=2)$j=this._renderElementUniformParamsMap[$V+1],null!=($S=$_[this._renderElementUniformParamsMap[$V]])&&($O+=$j.fun.call(this,$j,$S));$y.shaderCall+=$O},$c.create=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){return new $c($_,$S,$j,$O,$V,$M,$R,$w,$a,$u)},$c.addInclude=function($_,$S){$k.addInclude($_,$S)},$c._createShader=function($_,$S,$j){var $O=$_.createShader($j);if($_.shaderSource($O,$S),$_.compileShader($O),$yS.debugMode&&!$_.getShaderParameter($O,35713))throw $_.getShaderInfoLog($O);return $O},$c.PERIOD_RENDERELEMENT=0,$c.PERIOD_MATERIAL=1,$c.PERIOD_SPRITE=2,$c.PERIOD_CAMERA=3,$c.PERIOD_SCENE=4,$c._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$c._count=0,$c._preCompile=!1,$c.extCompileFunc=null,$c.extCompileObj=null,$q($c,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $P}]),$c}(),$BS=function($w){function $a(){this._transformUV=null,$a.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $RS(.6,.6,.6)),this._setColor(10,new $RS(1,1,1)),this._setColor(11,new $wS(1,1,1,8)),this._setColor(12,new $RS(1,1,1)),this._setColor(7,new $wS(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $wS(1,1,0,0)),this.renderMode=1}$C($a,"laya.d3.core.material.StandardMaterial",$w);var $_=$a.prototype;return $_.disableLight=function(){this._addDisablePublicShaderDefine($yS.SHADERDEFINE_POINTLIGHT|$yS.SHADERDEFINE_SPOTLIGHT|$yS.SHADERDEFINE_DIRECTIONLIGHT)},$_.disableFog=function(){this._addDisablePublicShaderDefine($yS.SHADERDEFINE_FOG)},$_.onAsynLoaded=function($_,$S,$j){var $O=$S[0];if($O.version)$w.prototype.onAsynLoaded.call(this,$_,$S,$j);else{var $V=$S[1],$M=$O.props;for(var $R in $M)this[$R]=$M[$R];$a._parseStandardMaterial($V,this,$O),this._endLoaded()}},$_.cloneTo=function($_){$w.prototype.cloneTo.call(this,$_);var $S=$_;this._transformUV&&($S._transformUV=this._transformUV.clone())},$i(0,$_,"ambientColor",function(){return this._getColor(9)},function($_){this._setColor(9,$_)}),$i(0,$_,"ambientTexture",function(){return this._getTexture(5)},function($_){$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$_)}),$i(0,$_,"renderMode",null,function($_){switch($_){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($_)}),$i(0,$_,"reflectColor",function(){return this._getColor(12)},function($_){this._setColor(12,$_)}),$i(0,$_,"tilingOffset",function(){return this._getColor(15)},function($_){if($_){var $S=$_.elements;1!=$S[0]||1!=$S[1]||0!=$S[2]||0!=$S[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$_)}),$i(0,$_,"albedo",function(){return this._getColor(7)},function($_){this._setColor(7,$_)}),$i(0,$_,"diffuseColor",function(){return this._getColor(10)},function($_){this._setColor(10,$_)}),$i(0,$_,"albedoColor",function(){return this._getColor(7)},function($_){this._setColor(7,$_)}),$i(0,$_,"specularColor",function(){return this._getColor(11)},function($_){this._setColor(11,$_)}),$i(0,$_,"diffuseTexture",function(){return this._getTexture(1)},function($_){$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$_)}),$i(0,$_,"normalTexture",function(){return this._getTexture(2)},function($_){$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$_)}),$i(0,$_,"specularTexture",function(){return this._getTexture(3)},function($_){$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$_)}),$i(0,$_,"emissiveTexture",function(){return this._getTexture(4)},function($_){$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$_)}),$i(0,$_,"reflectTexture",function(){return this._getTexture(6)},function($_){$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$_)}),$i(0,$_,"transformUV",function(){return this._transformUV},function($_){this._transformUV=$_,this._setMatrix4x4(13,$_.matrix),$_?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$_.matrix.elements,0)}),$a.__init__=function(){$a.SHADERDEFINE_DIFFUSEMAP=$a.shaderDefines.registerDefine("DIFFUSEMAP"),$a.SHADERDEFINE_NORMALMAP=$a.shaderDefines.registerDefine("NORMALMAP"),$a.SHADERDEFINE_SPECULARMAP=$a.shaderDefines.registerDefine("SPECULARMAP"),$a.SHADERDEFINE_EMISSIVEMAP=$a.shaderDefines.registerDefine("EMISSIVEMAP"),$a.SHADERDEFINE_AMBIENTMAP=$a.shaderDefines.registerDefine("AMBIENTMAP"),$a.SHADERDEFINE_REFLECTMAP=$a.shaderDefines.registerDefine("REFLECTMAP"),$a.SHADERDEFINE_UVTRANSFORM=$a.shaderDefines.registerDefine("UVTRANSFORM"),$a.SHADERDEFINE_TILINGOFFSET=$a.shaderDefines.registerDefine("TILINGOFFSET"),$a.SHADERDEFINE_ADDTIVEFOG=$a.shaderDefines.registerDefine("ADDTIVEFOG")},$a.load=function($_){return $H.loader.create($_,null,null,$a)},$a._parseStandardMaterial=function($_,$S,$j){var $O=$j.customProps,$V=$O.ambientColor;$S.ambientColor=new $RS($V[0],$V[1],$V[2]);var $M=$O.diffuseColor;$S.diffuseColor=new $RS($M[0],$M[1],$M[2]);var $R=$O.specularColor;$S.specularColor=new $wS($R[0],$R[1],$R[2],$R[3]);var $w=$O.reflectColor;$S.reflectColor=new $RS($w[0],$w[1],$w[2]);var $a=$O.albedoColor;$a&&($S.albedo=new $wS($a[0],$a[1],$a[2],$a[3]));var $u=$O.diffuseTexture.texture2D;$u&&($S.diffuseTexture=$o.getRes($_[$u]));var $c=$O.normalTexture.texture2D;$c&&($S.normalTexture=$o.getRes($_[$c]));var $q=$O.specularTexture.texture2D;$q&&($S.specularTexture=$o.getRes($_[$q]));var $s=$O.emissiveTexture.texture2D;$s&&($S.emissiveTexture=$o.getRes($_[$s]));var $C=$O.ambientTexture.texture2D;$C&&($S.ambientTexture=$o.getRes($_[$C]));var $i=$O.reflectTexture.texture2D;$i&&($S.reflectTexture=$o.getRes($_[$i]))},$a.RENDERMODE_OPAQUE=1,$a.RENDERMODE_OPAQUEDOUBLEFACE=2,$a.RENDERMODE_CUTOUT=3,$a.RENDERMODE_CUTOUTDOUBLEFACE=4,$a.RENDERMODE_TRANSPARENT=13,$a.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$a.RENDERMODE_ADDTIVE=15,$a.RENDERMODE_ADDTIVEDOUBLEFACE=16,$a.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$a.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$a.RENDERMODE_DEPTHREAD_ADDTIVE=7,$a.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$a.RENDERMODE_NONDEPTH_TRANSPARENT=9,$a.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$a.RENDERMODE_NONDEPTH_ADDTIVE=11,$a.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$a.SHADERDEFINE_DIFFUSEMAP=0,$a.SHADERDEFINE_NORMALMAP=0,$a.SHADERDEFINE_SPECULARMAP=0,$a.SHADERDEFINE_EMISSIVEMAP=0,$a.SHADERDEFINE_AMBIENTMAP=0,$a.SHADERDEFINE_REFLECTMAP=0,$a.SHADERDEFINE_UVTRANSFORM=0,$a.SHADERDEFINE_TILINGOFFSET=0,$a.SHADERDEFINE_ADDTIVEFOG=0,$a.DIFFUSETEXTURE=1,$a.NORMALTEXTURE=2,$a.SPECULARTEXTURE=3,$a.EMISSIVETEXTURE=4,$a.AMBIENTTEXTURE=5,$a.REFLECTTEXTURE=6,$a.ALBEDO=7,$a.UVANIAGE=8,$a.MATERIALAMBIENT=9,$a.MATERIALDIFFUSE=10,$a.MATERIALSPECULAR=11,$a.MATERIALREFLECT=12,$a.UVMATRIX=13,$a.UVAGE=14,$a.TILINGOFFSET=15,$q($a,["defaultMaterial",function(){var $_=new $a;return $_.lock=!0,this.defaultMaterial=$_},"shaderDefines",function(){return this.shaderDefines=new $cS($$S.shaderDefines)}]),$a}($$S),$tS=function($_){function $R($_,$S,$j,$O,$V){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$j&&($j=35044),void 0===$O&&($O=!1),$R.__super.call(this),this._indexType=$_,this._indexCount=$S,this._bufferUsage=$j,this._bufferType=34963,this._canRead=$O;var $M;if("ushort"==$_)this._indexTypeByteCount=2;else{if("ubyte"!=$_)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$M=this._indexTypeByteCount*$S,this._byteLength=$M,this._bind(),$w._gl.bufferData(this._bufferType,$M,this._bufferUsage),this.uri=$V,$O?("ushort"==$_?this._buffer=new Uint16Array($S):"ubyte"==$_&&(this._buffer=new Uint8Array($S)),this.memorySize=2*$M):this.memorySize=$M}$C($R,"laya.d3.graphics.IndexBuffer3D",$_);var $S=$R.prototype;return $S.setData=function($_,$S,$j,$O){void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=4294967295);var $V=0;if("ushort"==this._indexType?($V=2,0===$j&&4294967295===$O||($_=new Uint16Array($_.buffer,$j*$V,$O))):"ubyte"==this._indexType&&($V=1,0===$j&&4294967295===$O||($_=new Uint8Array($_.buffer,$j*$V,$O))),this._bind(),$w._gl.bufferSubData(this._bufferType,$S*$V,$_),this._canRead)if(0!==$S||0!==$j||4294967295!==$O){var $M=this._buffer.length-$S;$M<$O&&($O=$M);for(var $R=0;$R<$O;$R++)this._buffer[$S+$R]=$_[$R]}else this._buffer=$_},$S.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$S.disposeResource=function(){$_.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$i(0,$S,"indexType",function(){return this._indexType}),$i(0,$S,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$i(0,$S,"indexCount",function(){return this._indexCount}),$i(0,$S,"canRead",function(){return this._canRead}),$R.INDEXTYPE_UBYTE="ubyte",$R.INDEXTYPE_USHORT="ushort",$R.create=function($_,$S,$j,$O,$V){return void 0===$j&&($j=35044),void 0===$O&&($O=!1),new $R($_,$S,$j,$O,$V)},$R}($w),$mS=function($M){function $R($_,$S,$j,$O,$V){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$O&&($O=!1),$R.__super.call(this),this._vertexDeclaration=$_,this._vertexCount=$S,this._bufferUsage=$j,this._bufferType=34962,this._canRead=$O,this.uri=$V,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$S,this._bind(),$w._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$O&&(this._buffer=new Float32Array(this._byteLength/4))}$C($R,"laya.d3.graphics.VertexBuffer3D",$M);var $_=$R.prototype;return $_.bindWithIndexBuffer=function($_){$_&&$_._bind(),this._bind()},$_.setData=function($_,$S,$j,$O){if(void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=4294967295),0===$j&&4294967295===$O||($_=new Float32Array($_.buffer,4*$j,$O)),this._bind(),$w._gl.bufferSubData(this._bufferType,4*$S,$_),this._canRead)if(0!==$S||0!==$j||4294967295!==$O){var $V=this._buffer.length-$S;$V<$O&&($O=$V);for(var $M=0;$M<$O;$M++)this._buffer[$S+$M]=$_[$M]}else this._buffer=$_},$_.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$_.disposeResource=function(){for(var $_=$d.mainContext,$S=this._vertexDeclaration.getVertexElements(),$j=$w._enableAtributes,$O=0,$V=$S.length;$O<$V;$O++)$j[$O]===this._glBuffer&&($_.disableVertexAttribArray($O),$j[$O]=null);$M.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$i(0,$_,"vertexDeclaration",function(){return this._vertexDeclaration}),$i(0,$_,"vertexCount",function(){return this._vertexCount}),$i(0,$_,"canRead",function(){return this._canRead}),$R.create=function($_,$S,$j,$O,$V){return void 0===$j&&($j=35044),void 0===$O&&($O=!1),new $R($_,$S,$j,$O,$V)},$R}($w),$eS=function($_){function $k(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$k.__super.call(this),this._type=3553}$C($k,"laya.d3.resource.DataTexture2D",$dS);var $S=$k.prototype;return $S.genDebugMipmaps=function(){var $_=[];return $_.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$_.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$_.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$_.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$_.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$_.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$_.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$_.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$_.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$_.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$_},$S._onTextureLoaded=function($_){},$S._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $_=$d.mainContext,$S=this._source=$_.createTexture(),$j=this._width,$O=this._height,$V=$n.curBindTexTarget,$M=$n.curBindTexValue,$R=!1;if($n.bindTexture($_,this._type,$S),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $w=0;$_.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $a=0;$a<this._mipmaps.length;$a++){if(this._mipmaps[$a].byteLength!=$u*$c*4)throw"mipmap size error  level:"+$a;$_.texSubImage2D(this._type,0,$k.simLodRect[$w++],$k.simLodRect[$w++],$k.simLodRect[$w++],$k.simLodRect[$w++],6408,5121,new Uint8Array(this._mipmaps[$a]))}this.minFifter=9729,this.magFifter=9729}else{var $u=this._width,$c=this._height;for($w=0,$_.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$a=0;$a<this._mipmaps.length;$a++){if(this._mipmaps[$a].byteLength!=$u*$c*4)throw"mipmap size error  level:"+$a;$_.texImage2D(this._type,$a,6408,$u,$c,0,6408,5121,new Uint8Array(this._mipmaps[$a])),($u/=2)<1&&($u=1),($c/=2)<1&&($c=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$_.pixelStorei($_.UNPACK_ALIGNMENT,1),$_.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $q=0,$s=!1,$C=!1;this._buffer.byteLength==4*$j*$O?($q=6408,$s=!0):this._buffer.byteLength==3*$j*$O?($q=6407,$C=!0):$q=this._format,$s||$C?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$C&&$_.pixelStorei($_.UNPACK_ALIGNMENT,1),$_.texImage2D(this._type,0,$q,$j,$O,0,$q,5121,this._buffer)):$_&&$q==$_.ALPHA?($_.texImage2D(3553,0,$q,$j,$O,0,$q,$_.UNSIGNED_BYTE,this._buffer),$R=!0):0!=$q&&($_.compressedTexImage2D(3553,0,$q,$j,$O,0,this._buffer),$R=!0)}var $i=this._minFifter,$v=this._magFifter,$Z=0==this._wrapModeU?10497:33071,$o=0==this._wrapModeV?10497:33071,$l=$z.isPOT($j,$O);$l?(this._mipmap||this._mipmaps?-1!==$i||($i=9987):-1!==$i||($i=9729),-1!==$v||($v=9729),$_.texParameteri(this._type,10241,$i),$_.texParameteri(this._type,10240,$v),$_.texParameteri(this._type,10242,$Z),$_.texParameteri(this._type,10243,$o),this._mipmap&&$_.generateMipmap(this._type)):(-1!==$i||($i=9729),-1!==$v||($v=9729),$_.texParameteri(this._type,10241,$i),$_.texParameteri(this._type,10240,$v),$_.texParameteri(this._type,10242,33071),$_.texParameteri(this._type,10243,33071)),$V&&$M&&$n.bindTexture($_,$V,$M),this.memorySize=$R?this._buffer.length:$l?$j*$O*4*(1+1/3):$j*$O*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$S.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$S.onAsynLoaded=function($_,$S,$j){var $O;$j&&($O=$j[0].call(this,$S)),$O&&(this._width=$O.width,this._height=$O.height,this._buffer=$O.data),this._src=$_,this._size=new $vS(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$S.getPixels=function(){return new Uint8Array(this._buffer)},$S.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($d.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$i(0,$S,"src",function(){return this._src}),$k.create=function($_,$S,$j,$O,$V,$M,$R){if(void 0===$O&&($O=9729),void 0===$V&&($V=9729),void 0===$M&&($M=!0),!$_||$_.byteLength<$S*$j*4)throw"DataTexture2D create error";var $w=new $k;return $w.uri=$R,$w._buffer=$_,$w._width=$S,$w._height=$j,$w._mipmap=$M,$w._magFifter=$O,$w._minFifter=$V,$w._size=new $vS($w._width,$w._height),$w._conchTexture?alert("怎么给runtime传递datatexture数据"):$w.activeResource(),$w},$k.load=function($_,$S,$j,$O,$V){if(void 0===$S&&($S=0),void 0===$j&&($j=0),void 0===$O&&($O=9729),void 0===$V&&($V=9729),"mipmaps"===$g.getFileExtension($_)){var $M=$H.loader.create($_,null,null,$k,[function($_){this._mipmaps=[];var $S=new Uint32Array($_);this._width=$S[0];var $j=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$j=1024),this._width!=$j)throw"现在只支持512x256的环境贴图。当前的是"+$S[0];this._height=$S[1];for(var $O=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$V=this._height,$M=8;;){var $R=$O*$V*4;if($M+$R>$_.byteLength)throw"load mipmaps data size error ";var $w=new Uint8Array($_,$M,$R);if(this._mipmaps.push($w),$M+=$R,1==$O&&1==$V)break;($O/=2)<1&&($O=1),($V/=2)<1&&($V=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$M.simLodInfo=new Float32Array(40);for(var $R=0;$R<$M.simLodInfo.length;)$M.simLodInfo[$R]=($k.simLodRect[$R]+.5)/1024,$R++,$M.simLodInfo[$R]=($k.simLodRect[$R]+.5)/256,$R++,$M.simLodInfo[$R]=Math.max($k.simLodRect[$R]-1,.1)/1024,$R++,$M.simLodInfo[$R]=Math.max($k.simLodRect[$R]-1.5,.1)/256,$R++}return $M}if("number"==typeof $S)return $H.loader.create($_,null,null,$k,[function($_){return this._width=$S,this._height=$j,this._buffer=$_,null}]);if("function"==typeof $S)return $H.loader.create($_,null,null,$k,[$S]);throw new Error("unknown params.")},$k.lodasatlas=!1,$q($k,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$k}(),$GS=function($_){function $S(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$S.__super.call(this)}$C($S,"laya.d3.resource.models.PrimitiveMesh",$nS);var $j=$S.prototype;return $H.imps($j,{"laya.d3.core.render.IRenderable":!0}),$j._getVertexBuffer=function($_){return void 0===$_&&($_=0),0===$_?this._vertexBuffer:null},$j._getVertexBuffers=function(){return null},$j._getIndexBuffer=function(){return this._indexBuffer},$j._getPositions=function(){var $_,$S=[],$j=this._vertexBuffer.vertexDeclaration.getVertexElements(),$O=0;for($O=0;$O<$j.length;$O++){var $V=$j[$O];if("vector3"===$V.elementFormat&&0===$V.elementUsage){$_=$V;break}}var $M=this._vertexBuffer.getData();for($O=0;$O<$M.length;$O+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $R=$O+$_.offset/4,$w=new $RS($M[$R+0],$M[$R+1],$M[$R+2]);$S.push($w)}return $S},$j.getRenderElement=function($_){return this},$j.getRenderElementsCount=function(){return 1},$j.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$j._beforeRender=function($_){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$j._render=function($_){$d.mainContext.drawElements(4,this._numberIndices,5123,0),$y.drawCall++,$y.trianglesFaces+=this._numberIndices/3},$i(0,$j,"_vertexBufferCount",function(){return 1}),$i(0,$j,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$S}(),$DS=function($_){function $S(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$S.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$C($S,"laya.d3.resource.models.Mesh",$nS);var $j=$S.prototype;return $j._getPositions=function(){var $_,$S,$j,$O,$V,$M=[],$R=0,$w=0,$a=0;if(0!==this._vertexBuffers.length){var $u=this._vertexBuffers.length;for($R=0;$R<$u;$R++){for($j=($_=this._vertexBuffers[$R]).vertexDeclaration.getVertexElements(),$w=0;$w<$j.length;$w++)if("vector3"===($O=$j[$w]).elementFormat&&0===$O.elementUsage){$S=$O;break}for($V=$_.getData(),$w=0;$w<$V.length;$w+=$_.vertexDeclaration.vertexStride/4)$a=$w+$S.offset/4,$M.push(new $RS($V[$a+0],$V[$a+1],$V[$a+2]))}}else{var $c=this._subMeshes.length;for($R=0;$R<$c;$R++){for($j=($_=this._subMeshes[$R]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$w=0;$w<$j.length;$w++)if("vector3"===($O=$j[$w]).elementFormat&&0===$O.elementUsage){$S=$O;break}for($V=$_.getData(),$w=0;$w<$V.length;$w+=$_.vertexDeclaration.vertexStride/4)$a=$w+$S.offset/4,$M.push(new $RS($V[$a+0],$V[$a+1],$V[$a+2]))}}return $M},$j._setSubMeshes=function($_){this._subMeshes=$_,this._subMeshCount=$_.length;for(var $S=0;$S<this._subMeshCount;$S++)$_[$S]._indexInMesh=$S;this._positions=this._getPositions(),this._generateBoundingObject()},$j.onAsynLoaded=function($_,$S,$j){var $O=$S[0],$V=$S[1];$p_.read($O,this,this._materials,this._subMeshes,$V),this.completeCreate(),this._endLoaded()},$j.getSubMesh=function($_){return this._subMeshes[$_]},$j.getSubMeshCount=function(){return this._subMeshes.length},$j.getRenderElementsCount=function(){return this._subMeshes.length},$j.getRenderElement=function($_){return this._subMeshes[$_]},$j.disposeResource=function(){for(var $_=0;$_<this._subMeshes.length;$_++)this._subMeshes[$_].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$i(0,$j,"materials",function(){return this._materials.slice()}),$i(0,$j,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$S.load=function($_){return $H.loader.create($_,null,null,$S)},$S}(),$LS=(function($_){function $u($_,$S,$j,$O,$V,$M,$R,$w,$a){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$j&&($j=6408),void 0===$O&&($O=5121),void 0===$V&&($V=33189),void 0===$M&&($M=!1),void 0===$R&&($R=!1),void 0===$w&&($w=-1),void 0===$a&&($a=-1),$u.__super.call(this),this._type=3553,this._width=$_,this._height=$S,this._size=new $vS($_,$S),this._surfaceFormat=$j,this._surfaceType=$O,this._depthStencilFormat=$V,$v.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$M,this._repeat=$R,this._minFifter=$w,this._magFifter=$a,this.activeResource(),this._alreadyResolved=!0}$C($u,"laya.d3.resource.RenderTexture",$dS);var $S=$u.prototype;$S.recreateResource=function(){var $_=$d.mainContext;this._frameBuffer=$_.createFramebuffer(),this._source=$_.createTexture();var $S=$n.curBindTexTarget,$j=$n.curBindTexValue;$n.bindTexture($_,this._type,this._source),$_.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $O=this._minFifter,$V=this._magFifter,$M=this._repeat?10497:33071;if($z.isPOT(this._width,this._height)?(this._mipmap?-1!==$O||($O=9987):-1!==$O||($O=9729),-1!==$V||($V=9729),$_.texParameteri(this._type,10241,$O),$_.texParameteri(this._type,10240,$V),$_.texParameteri(this._type,10242,$M),$_.texParameteri(this._type,10243,$M),this._mipmap&&$_.generateMipmap(this._type)):(-1!==$O||($O=9729),-1!==$V||($V=9729),$_.texParameteri(this._type,10241,$O),$_.texParameteri(this._type,10240,$V),$_.texParameteri(this._type,10242,33071),$_.texParameteri(this._type,10243,33071)),$S&&$j&&$n.bindTexture($_,$S,$j),$_.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$_.createRenderbuffer(),$_.bindRenderbuffer(36161,this._depthStencilBuffer),$_.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$_.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$_.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$_.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$_.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$_.framebufferTexture2D(36160,36064,3553,this._source,0),$_.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$S.start=function(){$d.mainContext.bindFramebuffer(36160,this.frameBuffer),($u._currentRenderTarget=this)._alreadyResolved=!1},$S.end=function(){$d.mainContext.bindFramebuffer(36160,null),$u._currentRenderTarget=null,this._alreadyResolved=!0},$S.getData=function($_,$S,$j,$O){var $V=$d.mainContext;if($V.bindFramebuffer(36160,this._frameBuffer),!(36053===$V.checkFramebufferStatus(36160)))return $V.bindFramebuffer(36160,null),null;var $M=new Uint8Array(this._width*this._height*4);return $V.readPixels($_,$S,$j,$O,this._surfaceFormat,this._surfaceType,$M),$V.bindFramebuffer(36160,null),$M},$S.disposeResource=function(){if(this._frameBuffer){var $_=$d.mainContext;$_.deleteTexture(this._source),$_.deleteFramebuffer(this._frameBuffer),$_.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$i(0,$S,"surfaceFormat",function(){return this._surfaceFormat}),$i(0,$S,"surfaceType",function(){return this._surfaceType}),$i(0,$S,"depthStencilFormat",function(){return this._depthStencilFormat}),$i(0,$S,"source",function(){return this._alreadyResolved?$H.superGet($dS,this,"source"):null}),$i(0,$S,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$i(0,$S,"frameBuffer",function(){return this._frameBuffer}),$u._currentRenderTarget=null}(),function($_){function $S($_){this._color=null,this._pixels=null,$S.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $vS(this.width,this.height),this._color=$_,this._pixels=new Uint8Array([255*$_.x,255*$_.y,255*$_.z,255*$_.w]),this.uri="SolidColorTexture2D_"+this.id}$C($S,"laya.d3.resource.SolidColorTexture2D",$dS);var $j=$S.prototype;return $j._createWebGlTexture=function(){var $_=$d.mainContext,$S=this._source=$_.createTexture(),$j=this._width,$O=this._height,$V=$n.curBindTexTarget,$M=$n.curBindTexValue;$n.bindTexture($_,this._type,$S),$_.texImage2D(this._type,0,6408,$j,$O,0,6408,5121,this._pixels);var $R=this._minFifter,$w=this._magFifter,$a=this._repeat?10497:33071,$u=$z.isPOT($j,$O);$u?(this._mipmap?-1!==$R||($R=9987):-1!==$R||($R=9729),-1!==$w||($w=9729),$_.texParameteri(this._type,10241,$R),$_.texParameteri(this._type,10240,$w),$_.texParameteri(this._type,10242,$a),$_.texParameteri(this._type,10243,$a),this._mipmap&&$_.generateMipmap(this._type)):(-1!==$R||($R=9729),-1!==$w||($w=9729),$_.texParameteri(this._type,10241,$R),$_.texParameteri(this._type,10240,$w),$_.texParameteri(this._type,10242,33071),$_.texParameteri(this._type,10243,33071)),$V&&$M&&$n.bindTexture($_,$V,$M),this.memorySize=$u?$j*$O*4*(1+1/3):$j*$O*4},$j.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$j.disposeResource=function(){this._source&&($d.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$q($S,["magentaTexture",function(){var $_=new $S(new $wS(1,0,1,1));return $_.lock=!0,this.magentaTexture=$_},"grayTexture",function(){var $_=new $S(new $wS(.5,.5,.5,1));return $_.lock=!0,this.grayTexture=$_}]),$S}()),$US=function($_){function $V($_,$S,$j,$O){this._canRead=!1,this._image=null,this._pixels=null,void 0===$_&&($_=!1),void 0===$S&&($S=!0),void 0===$j&&($j=6408),void 0===$O&&($O=!0),$V.__super.call(this),this._type=3553,this._repeat=$S,this._canRead=$_,this._format=$j,this._mipmap=$O}$C($V,"laya.d3.resource.Texture2D",$dS);var $S=$V.prototype;return $S._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $_=$d.mainContext,$S=this._source=$_.createTexture(),$j=this._width,$O=this._height,$V=$n.curBindTexTarget,$M=$n.curBindTexValue;switch($n.bindTexture($_,this._type,$S),this._format){case 6407:case 6408:this._canRead?$_.texImage2D(this._type,0,this._format,$j,$O,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$_.texImage2D(this._type,0,this._image._format,$j,$O,0,this._image._format,5121,this._image.atlasSource):$_.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $d.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$_.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $R=this._minFifter,$w=this._magFifter,$a=this._repeat?10497:33071,$u=0==this._wrapModeU?10497:33071,$c=0==this._wrapModeV?10497:33071,$q=$z.isPOT($j,$O);$q?(this._mipmap?-1!==$R||($R=9987):-1!==$R||($R=9729),-1!==$w||($w=9729),$_.texParameteri(this._type,10241,$R),$_.texParameteri(this._type,10240,$w),$_.texParameteri(this._type,10242,$a),$_.texParameteri(this._type,10243,$a),$_.texParameteri(this._type,10242,$u),$_.texParameteri(this._type,10243,$c),this._mipmap&&$_.generateMipmap(this._type)):(-1!==$R||($R=9729),-1!==$w||($w=9729),$_.texParameteri(this._type,10241,$R),$_.texParameteri(this._type,10240,$w),$_.texParameteri(this._type,10242,33071),$_.texParameteri(this._type,10243,33071)),$V&&$M&&$n.bindTexture($_,$V,$M),this._image.onload=null,this._image=null,this.memorySize=$q?$j*$O*4*(1+1/3):$j*$O*4},$S.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$S.onAsynLoaded=function($_,$S,$j){if($j){var $O=$j[0];void 0!==$O&&(this._canRead=$O);var $V=$j[1];void 0!==$V&&(this._repeat=$V);var $M=$j[2];void 0!==$M&&(this._format=$M);var $R=$j[3];void 0!==$R&&(this._mipmap=$R);var $w=$j.wrapModeU;void 0!==$w&&(this._wrapModeU=$w);var $a=$j.wrapModeV;void 0!==$a&&(this._wrapModeV=$a)}switch(this._format){case 6407:case 6408:var $u=(this._image=$S).width,$c=$S.height;this._width=$u,this._height=$c,this._size=new $vS($u,$c),this._canRead&&($v.isConchApp?$S instanceof $s.HTMLElement&&(this._pixels=new Uint8Array($S.getImageData(0,0,$u,$c))):($J.canvas.size($u,$c),$J.canvas.clear(),$J.context.drawImage($S,0,0,$u,$c),this._pixels=new Uint8Array($J.context.getImageData(0,0,$u,$c).data.buffer)));break;case $d.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $q=new $A($S);$q.readUTFBytes(4),$q.readUTFBytes(2),$q.getInt16();$q.endian="bigEndian",this._width=$q.getInt16(),this._height=$q.getInt16(),this._size=new $vS(this._width,this._height);$q.getInt16(),$q.getInt16();this._image=new Uint8Array($S,$q.pos)}this.recreateResource(),this._endLoaded()},$S.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$S.disposeResource=function(){this._source&&($d.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$i(0,$S,"_src",function(){return this.url}),$i(0,$S,"src",function(){return this.url}),$V.load=function($_){return $H.loader.create($_,null,null,$V)},$V}(),$QS=function($S){function $j($_,$S){$j.__super.call(this),void 0===$_&&($_=.3),void 0===$S&&($S=1e3),this._tempVector3=new $RS,this._position=new $RS,this._up=new $RS,this._forward=new $RS,this._right=new $RS,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$vS.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$_,this._farPlane=$S,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$H.stage.on("resize",this,this._onScreenSizeChanged)}$C($j,"laya.d3.core.BaseCamera",$S);var $_=$j.prototype;return $_._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $_=this.scene._cameraPool,$S=$_.length-1,$j=0;$j<$S;$j++)if($_[$j].renderingOrder>$_[$S].renderingOrder){var $O=$_[$j];$_[$j]=$_[$S],$_[$S]=$O}},$_._calculateProjectionMatrix=function(){},$_._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$_._prepareCameraToRender=function(){$F._currentCameraCullingMask=this.cullingMask;var $_=this._shaderValues;$_.setValue(0,this.transform.position.elements),$_.setValue(5,this.forward.elements),$_.setValue(6,this.up.elements)},$_._prepareCameraViewProject=function($_,$S){var $j=this._shaderValues;$j.setValue(1,$_.elements),$j.setValue(2,$S.elements)},$_._renderCamera=function($_,$S,$j){},$_.addLayer=function($_){29!==$_.number&&30!=$_.number&&(this.cullingMask=this.cullingMask|$_.mask)},$_.removeLayer=function($_){29!==$_.number&&30!=$_.number&&(this.cullingMask=this.cullingMask&~$_.mask)},$_.addAllLayers=function(){this.cullingMask=2147483647},$_.removeAllLayers=function(){this.cullingMask=0|$F.getLayerByNumber(29).mask|$F.getLayerByNumber(30).mask},$_.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$_.moveForward=function($_){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$_,this.transform.translate(this._tempVector3)},$_.moveRight=function($_){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$_,this.transform.translate(this._tempVector3)},$_.moveVertical=function($_){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$_,this.transform.translate(this._tempVector3,!1)},$_._addSelfRenderObjects=function(){var $_=this.scene._cameraPool,$S=$_.length;if(0<$S){for(var $j=$S-1;0<=$j;$j--)if(this.renderingOrder<=$_[$j].renderingOrder){$_.splice($j+1,0,this);break}}else $_.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$_._clearSelfRenderObjects=function(){var $_=this.scene._cameraPool;$_.splice($_.indexOf(this),1)},$_.destroy=function($_){void 0===$_&&($_=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$H.stage.off("resize",this,this._onScreenSizeChanged),$S.prototype.destroy.call(this,$_)},$i(0,$_,"sky",function(){return this._sky},function($_){(this._sky=$_)._ownerCamera=this}),$i(0,$_,"forward",function(){var $_=this.transform.worldMatrix.elements,$S=this._forward.elements;return $S[0]=-$_[8],$S[1]=-$_[9],$S[2]=-$_[10],this._forward}),$i(0,$_,"position",function(){var $_=this.transform.worldMatrix.elements,$S=this._position.elements;return $S[0]=$_[12],$S[1]=$_[13],$S[2]=$_[14],this._position}),$i(0,$_,"renderTarget",function(){return this._renderTarget},function($_){null!=(this._renderTarget=$_)&&(this._renderTargetSize=$_.size)}),$i(0,$_,"up",function(){var $_=this.transform.worldMatrix.elements,$S=this._up.elements;return $S[0]=$_[4],$S[1]=$_[5],$S[2]=$_[6],this._up}),$i(0,$_,"right",function(){var $_=this.transform.worldMatrix.elements,$S=this._right.elements;return $S[0]=$_[0],$S[1]=$_[1],$S[2]=$_[2],this._right}),$i(0,$_,"renderTargetSize",function(){return this._renderTargetSize},function($_){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$_,this._calculateProjectionMatrix()}),$i(0,$_,"fieldOfView",function(){return this._fieldOfView},function($_){this._fieldOfView=$_,this._calculateProjectionMatrix()}),$i(0,$_,"nearPlane",function(){return this._nearPlane},function($_){this._nearPlane=$_,this._calculateProjectionMatrix()}),$i(0,$_,"farPlane",function(){return this._farPlane},function($_){this._farPlane=$_,this._calculateProjectionMatrix()}),$i(0,$_,"orthographic",function(){return this._orthographic},function($_){this._orthographic=$_,this._calculateProjectionMatrix()}),$i(0,$_,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($_){this._orthographicVerticalSize=$_,this._calculateProjectionMatrix()}),$i(0,$_,"renderingOrder",function(){return this._renderingOrder},function($_){this._renderingOrder=$_,this._sortCamerasByRenderingOrder()}),$j.CAMERAPOS=0,$j.VIEWMATRIX=1,$j.PROJECTMATRIX=2,$j.VPMATRIX=3,$j.VPMATRIX_NO_TRANSLATE=4,$j.CAMERADIRECTION=5,$j.CAMERAUP=6,$j.ENVIRONMENTDIFFUSE=7,$j.ENVIRONMENTSPECULAR=8,$j.SIMLODINFO=9,$j.DIFFUSEIRRADMATR=10,$j.DIFFUSEIRRADMATG=11,$j.DIFFUSEIRRADMATB=12,$j.HDREXPOSURE=13,$j.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$j.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$j.CLEARFLAG_SOLIDCOLOR=0,$j.CLEARFLAG_SKY=1,$j.CLEARFLAG_DEPTHONLY=2,$j.CLEARFLAG_NONE=3,$q($j,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $_S(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $_S},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $_S}]),$j}($hS),$YS=function($j){function $S($_){this._render=null,this._geometryFilter=null,$S.__super.call(this,$_)}$C($S,"laya.d3.core.RenderableSprite3D",$j);var $_=$S.prototype;return $_._addToInitStaticBatchManager=function(){},$_._setBelongScene=function($_){$j.prototype._setBelongScene.call(this,$_),$_._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$_._setUnBelongScene=function(){var $_=this._scene._renderableSprite3Ds,$S=$_.indexOf(this);$_.splice($S,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$j.prototype._setUnBelongScene.call(this)},$_._update=function($_){($_.owner=this)._activeInHierarchy&&(this._updateComponents($_),this._render._updateOctreeNode(),this._lateUpdateComponents($_),$y.spriteCount++,this._childs.length&&this._updateChilds($_))},$_.destroy=function($_){void 0===$_&&($_=!0),$j.prototype.destroy.call(this,$_),this._render._destroy(),this._render=null},$S.__init__=function(){$S.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$S.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$S.SAHDERDEFINE_LIGHTMAP=$S.shaderDefines.registerDefine("LIGHTMAP")},$S.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$S.SAHDERDEFINE_LIGHTMAP=4,$S.LIGHTMAPSCALEOFFSET=2,$S.LIGHTMAP=3,$q($S,["shaderDefines",function(){return this.shaderDefines=new $cS}]),$S}($hS),$TS=(function($_){function $O($_,$S,$j){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$_&&($_=1),void 0===$S&&($S=1),void 0===$j&&($j=1),$O.__super.call(this),this._long=$_,this._width=$S,this._height=$j,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$C($O,"laya.d3.resource.models.BoxMesh",$GS);var $S=$O.prototype;$S.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $_=$d_.vertexDeclaration,$S=($_.vertexStride,this._long/2),$j=this._height/2,$O=this._width/2,$V=new Float32Array([-$S,$j,-$O,0,1,0,0,0,$S,$j,-$O,0,1,0,1,0,$S,$j,$O,0,1,0,1,1,-$S,$j,$O,0,1,0,0,1,-$S,-$j,-$O,0,-1,0,0,1,$S,-$j,-$O,0,-1,0,1,1,$S,-$j,$O,0,-1,0,1,0,-$S,-$j,$O,0,-1,0,0,0,-$S,$j,-$O,-1,0,0,0,0,-$S,$j,$O,-1,0,0,1,0,-$S,-$j,$O,-1,0,0,1,1,-$S,-$j,-$O,-1,0,0,0,1,$S,$j,-$O,1,0,0,1,0,$S,$j,$O,1,0,0,0,0,$S,-$j,$O,1,0,0,0,1,$S,-$j,-$O,1,0,0,1,1,-$S,$j,$O,0,0,1,0,0,$S,$j,$O,0,0,1,1,0,$S,-$j,$O,0,0,1,1,1,-$S,-$j,$O,0,0,1,0,1,-$S,$j,-$O,0,0,-1,1,0,$S,$j,-$O,0,0,-1,0,0,$S,-$j,-$O,0,0,-1,0,1,-$S,-$j,-$O,0,0,-1,1,1]),$M=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $mS($_,this._numberVertices,35044,!0),this._indexBuffer=new $tS("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($V),this._indexBuffer.setData($M),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$i(0,$S,"long",function(){return this._long},function($_){this._long!==$_&&(this._long=$_,this.releaseResource(),this.activeResource())}),$i(0,$S,"width",function(){return this._width},function($_){this._width!==$_&&(this._width=$_,this.releaseResource(),this.activeResource())}),$i(0,$S,"height",function(){return this._height},function($_){this._height!==$_&&(this._height=$_,this.releaseResource(),this.activeResource())})}(),function($_){function $V($_,$S,$j,$O){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$_&&($_=10),void 0===$S&&($S=10),void 0===$j&&($j=10),void 0===$O&&($O=10),$V.__super.call(this),this._long=$_,this._width=$S,this._stacks=$j,this._slices=$O,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$C($V,"laya.d3.resource.models.PlaneMesh",$GS);var $S=$V.prototype;$S.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $_=new Uint16Array(this._numberIndices),$S=$d_.vertexDeclaration,$j=$S.vertexStride/4,$O=new Float32Array(this._numberVertices*$j),$V=this._long/2,$M=this._width/2,$R=this._long/this._stacks,$w=this._width/this._slices,$a=0,$u=0;$u<=this._slices;$u++)for(var $c=0;$c<=this._stacks;$c++)$O[$a++]=$c*$R-$V,$O[$a++]=0,$O[$a++]=$u*$w-$M,$O[$a++]=0,$O[$a++]=1,$O[$a++]=0,$O[$a++]=1*$c/this._stacks,$O[$a++]=1*$u/this._slices;var $q=0;for($u=0;$u<this._slices;$u++)for($c=0;$c<this._stacks;$c++)$_[$q++]=($u+1)*(this._stacks+1)+$c,$_[$q++]=$u*(this._stacks+1)+$c,$_[$q++]=($u+1)*(this._stacks+1)+$c+1,$_[$q++]=$u*(this._stacks+1)+$c,$_[$q++]=$u*(this._stacks+1)+$c+1,$_[$q++]=($u+1)*(this._stacks+1)+$c+1;this._vertexBuffer=new $mS($S,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $tS("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($O),this._indexBuffer.setData($_),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$i(0,$S,"long",function(){return this._long},function($_){this._long!==$_&&(this._long=$_,this.releaseResource(),this.activeResource())}),$i(0,$S,"width",function(){return this._width},function($_){this._width!==$_&&(this._width=$_,this.releaseResource(),this.activeResource())}),$i(0,$S,"stacks",function(){return this._stacks},function($_){this._stacks!==$_&&(this._stacks=$_,this.releaseResource(),this.activeResource())}),$i(0,$S,"slices",function(){return this._slices},function($_){this._slices!==$_&&(this._slices=$_,this.releaseResource(),this.activeResource())})}(),function($_){function $R($_,$S,$j){void 0===$_&&($_=0),void 0===$S&&($S=.3),void 0===$j&&($j=1e3),this._viewMatrix=new $_S,this._projectionMatrix=new $_S,this._projectionViewMatrix=new $_S,this._viewport=new $aS(0,0,0,0),this._normalizedViewport=new $aS(0,0,1,1),this._aspectRatio=$_,this._boundFrustumUpdate=!0,this._boundFrustum=new $K_($_S.DEFAULT),$R.__super.call(this,$S,$j),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$C($R,"laya.d3.core.Camera",$QS);var $S=$R.prototype;return $S._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$S._parseCustomProps=function($_,$S,$j,$O){var $V=$j.clearColor;this.clearColor=new $wS($V[0],$V[1],$V[2],$V[3]);var $M=$j.viewport;this.normalizedViewport=new $aS($M[0],$M[1],$M[2],$M[3])},$S._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $_=this.orthographicVerticalSize*this.aspectRatio*.5,$S=.5*this.orthographicVerticalSize;$_S.createOrthoOffCenterRH(-$_,$_,-$S,$S,this.nearPlane,this.farPlane,this._projectionMatrix)}else $_S.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$S._update=function($_){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$_)},$S._renderCamera=function($_,$S,$j){var $O,$V;$j.parallelSplitShadowMaps[0]&&$j._renderShadowMap($_,$S,this),($S.camera=this)._prepareCameraToRender(),$j._preRenderUpdateComponents($S),$O=$S._viewMatrix=this.viewMatrix;var $M=this._renderTarget;$M?($M.start(),$_S.multiply($QS._invertYScaleMatrix,this._projectionMatrix,$QS._invertYProjectionMatrix),$_S.multiply($QS._invertYScaleMatrix,this.projectionViewMatrix,$QS._invertYProjectionViewMatrix),$V=$S._projectionMatrix=$QS._invertYProjectionMatrix,$S._projectionViewMatrix=$QS._invertYProjectionViewMatrix):($V=$S._projectionMatrix=this._projectionMatrix,$S._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($O,$V),$S._viewport=this.viewport,$j._preRenderScene($_,$S,this.boundFrustum),$j._clear($_,$S),$j._renderScene($_,$S),$j._postRenderUpdateComponents($S),$M&&$M.end()},$S.viewportPointToRay=function($_,$S){$iS.calculateCursorRay($_,this.viewport,this._projectionMatrix,this.viewMatrix,null,$S)},$S.normalizedViewportPointToRay=function($_,$S){var $j=$R._tempVector20,$O=this.viewport,$V=$_.elements,$M=$j.elements;$M[0]=$V[0]*$O.width,$M[1]=$V[1]*$O.height,$iS.calculateCursorRay($j,this.viewport,this._projectionMatrix,this.viewMatrix,null,$S)},$S.worldToViewportPoint=function($_,$S){$_S.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($_,this._projectionViewMatrix,$S);var $j=$S.elements;$j[0]=$j[0]/$H.stage.clientScaleX,$j[1]=$j[1]/$H.stage.clientScaleY},$S.worldToNormalizedViewportPoint=function($_,$S){$_S.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($_,this._projectionViewMatrix,$S);var $j=$S.elements;$j[0]=$j[0]/$H.stage.clientScaleX,$j[1]=$j[1]/$H.stage.clientScaleY},$S.convertScreenCoordToOrthographicCoord=function($_,$S){if(this._orthographic){var $j=$p.clientWidth,$O=$p.clientHeight,$V=this.orthographicVerticalSize*this.aspectRatio/$j,$M=this.orthographicVerticalSize/$O,$R=$_.elements,$w=$S.elements;return $w[0]=(-$j/2+$R[0])*$V,$w[1]=($O/2-$R[1])*$M,$w[2]=(this.nearPlane-this.farPlane)*($R[2]+1)/2-this.nearPlane,$RS.transformCoordinate($S,this.transform.worldMatrix,$S),!0}return!1},$i(0,$S,"projectionViewMatrix",function(){return $_S.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$i(0,$S,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $_=this.viewport;return $_.width/$_.height},function($_){if($_<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$_,this._calculateProjectionMatrix()}),$i(0,$S,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$i(0,$S,"needViewport",function(){var $_=this.normalizedViewport;return 0===$_.x&&0===$_.y&&1===$_.width&&1===$_.height}),$i(0,$S,"viewport",function(){if(this._viewportExpressedInClipSpace){var $_=this._normalizedViewport,$S=this.renderTargetSize,$j=$S.width,$O=$S.height;this._viewport.x=$_.x*$j,this._viewport.y=$_.y*$O,this._viewport.width=$_.width*$j,this._viewport.height=$_.height*$O}return this._viewport},function($_){if(null!=this.renderTarget&&($_.x<0||$_.y<0||0==$_.width||0==$_.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$_,this._calculateProjectionMatrix()}),$i(0,$S,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $_=this._viewport,$S=this.renderTargetSize,$j=$S.width,$O=$S.height;this._normalizedViewport.x=$_.x/$j,this._normalizedViewport.y=$_.y/$O,this._normalizedViewport.width=$_.width/$j,this._normalizedViewport.height=$_.height/$O}return this._normalizedViewport},function($_){$_.x<0&&($_.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$_.y<0&&($_.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$_.x+$_.width&&($_.width=1-$_.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$_.y+$_.height&&($_.height=1-$_.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$_,this._calculateProjectionMatrix()}),$i(0,$S,"projectionMatrix",function(){return this._projectionMatrix},function($_){this._projectionMatrix=$_,this._useUserProjectionMatrix=!0}),$i(0,$S,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$q($R,["_tempVector20",function(){return this._tempVector20=new $MS}]),$R}()),$WS=function($j){function $O($_,$S){$O.__super.call(this,$S),this._geometryFilter=new $JS(this),this._render=new $FS(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$_&&(this._geometryFilter.sharedMesh=$_)instanceof laya.d3.resource.models.Mesh&&($_.loaded?this._render.sharedMaterials=$_.materials:$_.once("loaded",this,this._applyMeshMaterials))}$C($O,"laya.d3.core.MeshSprite3D",$j);var $_=$O.prototype;return $_._changeRenderObjectByMesh=function($_){var $S=this._render._renderElements,$j=$S[$_];$j||($j=$S[$_]=new $fS),$j._render=this._render;var $O=this._render.sharedMaterials[$_];$O||($O=$BS.defaultMaterial);var $V=this._geometryFilter.sharedMesh.getRenderElement($_);return $j._mainSortID=this._getSortID($V,$O),$j._sprite3D=this,$j.renderObj=$V,$j._material=$O,$j},$_._changeRenderObjectByMaterial=function($_,$S){var $j=this._render._renderElements[$_];$S||($S=$BS.defaultMaterial);var $O=this._geometryFilter.sharedMesh.getRenderElement($_);return $j._mainSortID=this._getSortID($O,$S),$j._sprite3D=this,$j.renderObj=$O,$j._material=$S,$j},$_._changeRenderObjectsByMesh=function(){var $_=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$_;for(var $S=0;$S<$_;$S++)this._changeRenderObjectByMesh($S)},$_._onMeshChanged=function($_){var $S=$_.sharedMesh;$S.loaded?this._changeRenderObjectsByMesh():$S.once("loaded",this,this._onMeshLoaded)},$_._onMeshLoaded=function($_){$_===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$_._onMaterialChanged=function($_,$S,$j){$S<this._render._renderElements.length&&this._changeRenderObjectByMaterial($S,$j)},$_._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$_._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$_._parseCustomProps=function($_,$S,$j,$O){var $V=this.meshRender,$M=$j.lightmapIndex;null!=$M&&($V.lightmapIndex=$M);var $R,$w,$a=$j.lightmapScaleOffset;if($a&&($V.lightmapScaleOffset=new $wS($a[0],$a[1],$a[2],$a[3])),$O.instanceParams)($R=$O.instanceParams.loadPath)&&($w=$o.getRes($S[$R]),(this.meshFilter.sharedMesh=$w).loaded?$V.sharedMaterials=$w.materials:$w.once("loaded",this,this._applyMeshMaterials));else{($R=$j.meshPath)&&($w=$o.getRes($S[$R]),this.meshFilter.sharedMesh=$w);var $u=$j.materials;if($u){var $c=$V.sharedMaterials,$q=$u.length;$c.length=$q;for(var $s=0;$s<$q;$s++)$c[$s]=$o.getRes($S[$u[$s].path]);$V.sharedMaterials=$c}}},$_._applyMeshMaterials=function($_){for(var $S=this._render.sharedMaterials,$j=$_.materials,$O=0,$V=$j.length;$O<$V;$O++)$S[$O]||($S[$O]=$j[$O]);this._render.sharedMaterials=$S},$_._addToInitStaticBatchManager=function(){$O._staticBatchManager._addInitBatchSprite(this)},$_.cloneTo=function($_){var $S=$_;$S._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $j=this._render,$O=$S._render;$O.enable=$j.enable,$O.sharedMaterials=$j.sharedMaterials,$O.castShadow=$j.castShadow;var $V=$j.lightmapScaleOffset;$V&&($O.lightmapScaleOffset=$V.clone()),$O.lightmapIndex=$j.lightmapIndex,$O.receiveShadow=$j.receiveShadow,$O.sortingFudge=$j.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$_)},$_.destroy=function($_){if(void 0===$_&&($_=!0),!this.destroyed){var $S=this.meshFilter.sharedMesh;null!=$S&&($S.loaded||$S.off("loaded",this,this._applyMeshMaterials)),$j.prototype.destroy.call(this,$_),this._geometryFilter._destroy()}},$i(0,$_,"meshFilter",function(){return this._geometryFilter}),$i(0,$_,"meshRender",function(){return this._render}),$O.__init__=function(){$O_._staticBatchManagers.push($O._staticBatchManager)},$O.load=function($_){return $H.loader.create($_,null,null,$O)},$q($O,["_staticBatchManager",function(){return this._staticBatchManager=new $PS}]),$O}($YS)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($_,$S){"use strict";for(var $j in Object.defineProperty($S,"__esModule",{value:!0}),Laya){var $O=Laya[$j];$O&&$O.__isclass&&($S[$j]=$O)}}),function($_,$S,$V_){$V_.un,$V_.uns;var $j=$V_.static,$O=$V_.class,$M=$V_.getset,$v=$V_.__newvec,$w=laya.maths.Bezier,$q=laya.utils.Browser,$d_=laya.utils.Byte,$V=(laya.events.Event,laya.events.EventDispatcher),$R=laya.display.Graphics,$a=(laya.resource.HTMLCanvas,laya.utils.Handler),$u=laya.net.Loader,$s=laya.maths.MathUtil,$n_=laya.maths.Matrix,$Z=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$c=(laya.renders.RenderContext,laya.resource.Resource),$C=laya.utils.RunDriver,$M_=laya.display.Sprite,$i=laya.utils.Stat,$J_=laya.resource.Texture,$o=(laya.net.URL,laya.utils.Utils),$n=function(){function $_(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $O($_,"laya.ani.AnimationContent"),$_}(),$J=function(){function $_(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $O($_,"laya.ani.AnimationNodeContent"),$_}(),$k=function(){function $_(){}return $O($_,"laya.ani.AnimationParser01"),$_.parse=function($_,$S){var $j=$S.__getBuffer(),$O=0,$V=0,$M=0,$R=0,$w=0,$a=0,$u=0,$c=$S.readUTFString();$_._aniClassName=$c;var $q,$s=$S.readUTFString().split("\n"),$C=$S.getUint8(),$i=$S.getUint32(),$v=$S.getUint32();0<$i&&($q=$j.slice($i,$v));var $Z=new $d_($q);for(0<$v&&($_._publicExtData=$j.slice($v,$j.byteLength)),$_._useParent=!!$S.getUint8(),$_._anis.length=$C,$O=0;$O<$C;$O++){var $o=$_._anis[$O]=new $n;$o.nodes=new Array;var $l=$o.name=$s[$S.getUint16()];$_._aniMap[$l]=$O,$o.bone3DMap={},$o.playTime=$S.getFloat32(),$o.playTime<=0&&console.error("播放时间不能为0  url="+$_.url+" name="+$o.name);var $k=$o.nodes.length=$S.getUint8();for($V=$o.totalKeyframeDatasLength=0;$V<$k;$V++){var $z=$o.nodes[$V]=new $J;$z.childs=[];var $H=$S.getInt16();0<=$H&&($z.name=$s[$H],$o.bone3DMap[$z.name]=$V),$z.keyFrame=new Array,$z.parentIndex=$S.getInt16(),-1==$z.parentIndex?$z.parent=null:$z.parent=$o.nodes[$z.parentIndex],$z.lerpType=$S.getUint8();var $A=$S.getUint32();$Z.pos=$A;var $f=$z.keyframeWidth=$Z.getUint16();if($o.totalKeyframeDatasLength+=$f,0===$z.lerpType||1===$z.lerpType)for($z.interpolationMethod=[],$z.interpolationMethod.length=$f,$M=0;$M<$f;$M++)$z.interpolationMethod[$M]=$h.interpolation[$Z.getUint8()];null!=$z.parent&&$z.parent.childs.push($z);var $y=$S.getUint16();0<$y&&($z.extenData=$j.slice($S.pos,$S.pos+$y),$S.pos+=$y);var $P,$g=$S.getUint16(),$E=0;for($M=0,$R=$z.keyFrame.length=$g;$M<$R;$M++){if(($P=$z.keyFrame[$M]=new $F).duration=$S.getFloat32(),$P.startTime=$E,2===$z.lerpType){$P.interpolationData=[];var $$,$d=$S.getUint8();switch($$=$S.getFloat32()){case 254:for($P.interpolationData.length=$f,$u=0;$u<$f;$u++)$P.interpolationData[$u]=0;break;case 255:for($P.interpolationData.length=$f,$u=0;$u<$f;$u++)$P.interpolationData[$u]=5;break;default:for($P.interpolationData.push($$),$a=1;$a<$d;$a++)$P.interpolationData.push($S.getFloat32())}}for($P.data=new Float32Array($f),$w=0;$w<$f;$w++)$P.data[$w]=$S.getFloat32(),-1e-8<$P.data[$w]&&$P.data[$w]<1e-8&&($P.data[$w]=0);$E+=$P.duration}$P.startTime=$o.playTime,$z.playTime=$o.playTime,$_._calculateKeyFrame($z,$g,$f)}}},$_}(),$z=function(){function $H(){}return $O($H,"laya.ani.AnimationParser02"),$H.READ_DATA=function(){$H._DATA.offset=$H._reader.getUint32(),$H._DATA.size=$H._reader.getUint32()},$H.READ_BLOCK=function(){for(var $_=$H._BLOCK.count=$H._reader.getUint16(),$S=$H._BLOCK.blockStarts=[],$j=$H._BLOCK.blockLengths=[],$O=0;$O<$_;$O++)$S.push($H._reader.getUint32()),$j.push($H._reader.getUint32())},$H.READ_STRINGS=function(){var $_=$H._reader.getUint32(),$S=$H._reader.getUint16(),$j=$H._reader.pos;$H._reader.pos=$_+$H._DATA.offset;for(var $O=0;$O<$S;$O++)$H._strings[$O]=$H._reader.readUTFString();$H._reader.pos=$j},$H.parse=function($_,$S){$H._templet=$_;($H._reader=$S).__getBuffer();$H.READ_DATA(),$H.READ_BLOCK(),$H.READ_STRINGS();for(var $j=0,$O=$H._BLOCK.count;$j<$O;$j++){var $V=$S.getUint16(),$M=$H._strings[$V],$R=$H["READ_"+$M];if(null==$R)throw new Error("model file err,no this function:"+$V+" "+$M);$R.call()}},$H.READ_ANIMATIONS=function(){var $_=$H._reader,$S=$_.__getBuffer(),$j=0,$O=0,$V=0,$M=0,$R=$_.getUint16(),$w=[];for($w.length=$R,$j=0;$j<$R;$j++)$w[$j]=$h.interpolation[$_.getByte()];var $a=$_.getUint8();for($H._templet._anis.length=$a,$j=0;$j<$a;$j++){var $u=$H._templet._anis[$j]={};$u.nodes=new Array;var $c=$u.name=$H._strings[$_.getUint16()];$H._templet._aniMap[$c]=$j,$u.bone3DMap={},$u.playTime=$_.getFloat32();var $q=$u.nodes.length=$_.getInt16();for($O=$u.totalKeyframeDatasLength=0;$O<$q;$O++){var $s=$u.nodes[$O]={};$s.keyframeWidth=$R,$s.childs=[];var $C=$_.getUint16();0<=$C&&($s.name=$H._strings[$C],$u.bone3DMap[$s.name]=$O),$s.keyFrame=new Array,$s.parentIndex=$_.getInt16(),-1==$s.parentIndex?$s.parent=null:$s.parent=$u.nodes[$s.parentIndex],$u.totalKeyframeDatasLength+=$R,$s.interpolationMethod=$w,null!=$s.parent&&$s.parent.childs.push($s);var $i=$_.getUint16(),$v=null,$Z=null;for($V=0,$M=$s.keyFrame.length=$i;$V<$M;$V++){($v=$s.keyFrame[$V]={}).startTime=$_.getFloat32(),$Z&&($Z.duration=$v.startTime-$Z.startTime);var $o=$H._DATA.offset,$l=$_.getUint32(),$k=4*$R,$z=$S.slice($o+$l,$o+$l+$k);$v.data=new Float32Array($z),$Z=$v}$v.duration=0,$s.playTime=$u.playTime,$H._templet._calculateKeyFrame($s,$i,$R)}}},$H._templet=null,$H._reader=null,$H._strings=[],$j($H,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$H}(),$F_=(function(){function $_(){}$O($_,"laya.ani.AnimationState"),$_.stopped=0,$_.paused=1,$_.playing=2}(),function(){function $V(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $Y_,this.resultMatrix=new $n_,this._children=[]}$O($V,"laya.ani.bone.Bone");var $_=$V.prototype;return $_.setTempMatrix=function($_){this._tempMatrix=$_;var $S,$j=0;for($j=0,$S=this._children.length;$j<$S;$j++)this._children[$j].setTempMatrix(this._tempMatrix)},$_.update=function($_){var $S;if(this.rotation=this.transform.skX,$_)$S=this.resultTransform.getMatrix(),$n_.mul($S,$_,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$S=this.resultTransform.getMatrix(),$n_.mul($S,this.parentBone.resultMatrix,this.resultMatrix);else{var $j=this.parentBone,$O=NaN,$V=NaN,$M=NaN,$R=this.parentBone.resultMatrix;$S=this.resultTransform.getMatrix();var $w=$R.a*$S.tx+$R.c*$S.ty+$R.tx,$a=$R.b*$S.tx+$R.d*$S.ty+$R.ty,$u=new $n_;this.inheritRotation?($O=Math.atan2($j.resultMatrix.b,$j.resultMatrix.a),$V=Math.cos($O),$M=Math.sin($O),$u.setTo($V,$M,-$M,$V,0,0),$n_.mul(this._tempMatrix,$u,$n_.TEMP),$n_.TEMP.copyTo($u),$S=this.resultTransform.getMatrix(),$n_.mul($S,$u,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$S=this.resultTransform.getMatrix(),$n_.TEMP.identity(),$n_.TEMP.d=this.d,$n_.mul($S,$n_.TEMP,this.resultMatrix)),this.resultMatrix.tx=$w,this.resultMatrix.ty=$a}else($S=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $c,$q=0;for($q=0,$c=this._children.length;$q<$c;$q++)this._children[$q].update()},$_.updateChild=function(){var $_,$S=0;for($S=0,$_=this._children.length;$S<$_;$S++)this._children[$S].update()},$_.setRotation=function($_){this._sprite&&(this._sprite.rotation=180*$_/Math.PI)},$_.updateDraw=function($_,$S){$V.ShowBones&&!$V.ShowBones[this.name]||(this._sprite||(this._sprite=new $M_,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$V_.stage.addChild(this._sprite)),this._sprite.x=$_+this.resultMatrix.tx,this._sprite.y=$S+this.resultMatrix.ty);var $j,$O=0;for($O=0,$j=this._children.length;$O<$j;$O++)this._children[$O].updateDraw($_,$S)},$_.addChild=function($_){this._children.push($_),$_.parentBone=this},$_.findBone=function($_){if(this.name==$_)return this;var $S,$j,$O=0;for($O=0,$S=this._children.length;$O<$S;$O++)if($j=this._children[$O].findBone($_))return $j;return null},$_.localToWorld=function($_){var $S=$_[0],$j=$_[1];$_[0]=$S*this.resultMatrix.a+$j*this.resultMatrix.c+this.resultMatrix.tx,$_[1]=$S*this.resultMatrix.b+$j*this.resultMatrix.d+this.resultMatrix.ty},$V.ShowBones={},$V}()),$x_=function(){function $v(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$O($v,"laya.ani.bone.BoneSlot");var $_=$v.prototype;return $_.showSlotData=function($_,$S){void 0===$S&&($S=!0),this.currSlotData=$_,$S&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$_.showDisplayByName=function($_){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($_))},$_.replaceDisplayByName=function($_,$S){if(this.currSlotData){var $j;$j=this.currSlotData.getDisplayByName($_);var $O;$O=this.currSlotData.getDisplayByName($S),this.replaceDisplayByIndex($j,$O)}},$_.replaceDisplayByIndex=function($_,$S){this.currSlotData&&(this._replaceDic[$_]=$S,this.displayIndex==$_&&this.showDisplayByIndex($_))},$_.showDisplayByIndex=function($_){if(null!=this._replaceDic[$_]&&($_=this._replaceDic[$_]),this.currSlotData&&-1<$_&&$_<this.currSlotData.displayArr.length){if(this.displayIndex=$_,this.currDisplayData=this.currSlotData.displayArr[$_],this.currDisplayData){var $S=this.currDisplayData.name;this.currTexture=this.templet.getTexture($S),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$Z.isConchApp||$Z.isConchApp&&"0.9.15"<$M_.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$_.replaceSkin=function($_){this._diyTexture=$_,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$_.setParentMatrix=function($_){this._parentMatrix=$_},$_.draw=function($_,$S,$j,$O){if(void 0===$j&&($j=!1),void 0===$O&&($O=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $V,$M=this.currTexture;switch(this._diyTexture&&($M=this._diyTexture),this.currDisplayData.type){case 0:if($_){var $R=this.getDisplayMatrix();if(this._parentMatrix){var $w=!1;if($R){var $a;if($n_.mul($R,this._parentMatrix,$n_.TEMP),$a=$j?(null==this._resultMatrix&&(this._resultMatrix=new $n_),this._resultMatrix):new $n_,!$Z.isWebGL&&this.currDisplayData.uvs||$Z.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $u=$v._tempMatrix;$u.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($u.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($w=!0,$u.rotate(-Math.PI/2)),$n_.mul($u,$n_.TEMP,$a)}else $n_.TEMP.copyTo($a);$w?$_.drawTexture($M,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$a):$_.drawTexture($M,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$a)}}}break;case 1:if(null==($V=$j?(null==this._skinSprite&&(this._skinSprite=$v.createSkinMesh()),this._skinSprite):$v.createSkinMesh()))return;var $c;if(null==this.currDisplayData.bones){var $q,$s=this.currDisplayData.weights;this.deformData&&($s=this.deformData),$q=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$f.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$f.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$s;this.currDisplayData.triangles.length;$c=this.currDisplayData.triangles,$V.init2($M,null,$c,this._mVerticleArr,$q);var $C,$i=this.getDisplayMatrix();if(this._parentMatrix)if($i)$n_.mul($i,this._parentMatrix,$n_.TEMP),$C=$j?(null==this._resultMatrix&&(this._resultMatrix=new $n_),this._resultMatrix):new $n_,$n_.TEMP.copyTo($C),$V.transform=$C}else this.skinMesh($S,$V,$O);$_.drawSkin($V);break;case 2:if(null==($V=$j?(null==this._skinSprite&&(this._skinSprite=$v.createSkinMesh()),this._skinSprite):$v.createSkinMesh()))return;this.skinMesh($S,$V,$O),$_.drawSkin($V)}}},$_.skinMesh=function($_,$S,$j){var $O,$V=this.currTexture,$M=this.currDisplayData.bones;$O=this._diyTexture?($V=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$f.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$f.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $R,$w,$a=this.currDisplayData.weights,$u=this.currDisplayData.triangles,$c=0,$q=0,$s=0,$C=NaN,$i=NaN,$v=0,$Z=0,$o=[],$l=0,$k=0;if(this.deformData&&0<this.deformData.length){var $z=0;for($l=0,$k=$M.length;$l<$k;){for($s=$M[$l++]+$l,$q=$c=0;$l<$s;$l++)$w=$_[$M[$l]],$C=$a[$v]+this.deformData[$z++],$i=$a[$v+1]+this.deformData[$z++],$Z=$a[$v+2],$c+=($C*$w.a+$i*$w.c+$w.tx)*$Z,$q+=($C*$w.b+$i*$w.d+$w.ty)*$Z,$v+=3;$o.push($c,$q)}}else for($l=0,$k=$M.length;$l<$k;){for($s=$M[$l++]+$l,$q=$c=0;$l<$s;$l++)$w=$_[$M[$l]],$C=$a[$v],$i=$a[$v+1],$Z=$a[$v+2],$c+=($C*$w.a+$i*$w.c+$w.tx)*$Z,$q+=($C*$w.b+$i*$w.d+$w.ty)*$Z,$v+=3;$o.push($c,$q)}this._mVerticleArr=$o,$R=$u,$S.init2($V,null,$R,this._mVerticleArr,$O)},$_.drawBonePoint=function($_){$_&&this._parentMatrix&&$_.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$_.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$_.getMatrix=function(){return this._resultMatrix},$_.copy=function(){var $_=new $v;return $_.type="copy",$_.name=this.name,$_.attachmentName=this.attachmentName,$_.srcDisplayIndex=this.srcDisplayIndex,$_.parent=this.parent,$_.displayIndex=this.displayIndex,$_.templet=this.templet,$_.currSlotData=this.currSlotData,$_.currTexture=this.currTexture,$_.currDisplayData=this.currDisplayData,$_},$v.createSkinMesh=function(){return $Z.isWebGL||$Z.isConchApp?$C.skinAniSprite():($Z.isWebGL,null)},$j($v,["_tempMatrix",function(){return this._tempMatrix=new $n_}]),$v}(),$h_=function(){function $_(){this.skinName=null,this.deformSlotDataList=[]}return $O($_,"laya.ani.bone.DeformAniData"),$_}(),$N_=function(){function $_(){this.deformSlotDisplayList=[]}return $O($_,"laya.ani.bone.DeformSlotData"),$_}(),$B_=function(){function $_(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$O($_,"laya.ani.bone.DeformSlotDisplayData");var $S=$_.prototype;return $S.binarySearch1=function($_,$S){var $j=0,$O=$_.length-2;if(0==$O)return 1;for(var $V=$O>>>1;;){if($_[Math.floor($V+1)]<=$S?$j=$V+1:$O=$V,$j==$O)return $j+1;$V=$j+$O>>>1}return 0},$S.apply=function($_,$S,$j){if(void 0===$j&&($j=1),$_+=.05,!(this.timeList.length<=0)){var $O=0;if(!($_<this.timeList[0])){var $V=this.vectices[0].length,$M=[],$R=this.binarySearch1(this.timeList,$_);if(this.frameIndex=$R,$_>=this.timeList[this.timeList.length-1]){var $w=this.vectices[this.vectices.length-1];if($j<1)for($O=0;$O<$V;$O++)$M[$O]+=($w[$O]-$M[$O])*$j;else for($O=0;$O<$V;$O++)$M[$O]=$w[$O];this.deformData=$M}else{this.tweenKeyList[this.frameIndex];var $a=this.vectices[this.frameIndex-1],$u=this.vectices[this.frameIndex],$c=this.timeList[this.frameIndex-1],$q=this.timeList[this.frameIndex];$j=this.tweenKeyList[$R-1]?($_-$c)/($q-$c):0;var $s=NaN;for($O=0;$O<$V;$O++)$s=$a[$O],$M[$O]=$s+($u[$O]-$s)*$j;this.deformData=$M}}}},$_}(),$t_=function(){function $_(){this.time=NaN,this.drawOrder=[]}return $O($_,"laya.ani.bone.DrawOrderData"),$_}(),$m_=function(){function $_(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $O($_,"laya.ani.bone.EventData"),$_}(),$l=function(){function $O_($_,$S){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$_,this._targetBone=$S[$_.targetBoneIndex],this.isSpine=$_.isSpine,null==this._bones&&(this._bones=[]);for(var $j=this._bones.length=0,$O=$_.boneIndexs.length;$j<$O;$j++)this._bones.push($S[$_.boneIndexs[$j]]);this.name=$_.name,this.mix=$_.mix,this.bendDirection=$_.bendDirection}$O($O_,"laya.ani.bone.IkConstraint");var $_=$O_.prototype;return $_.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$_._applyIk1=function($_,$S,$j,$O){var $V=$_.parentBone,$M=1/($V.resultMatrix.a*$V.resultMatrix.d-$V.resultMatrix.b*$V.resultMatrix.c),$R=$S-$V.resultMatrix.tx,$w=$j-$V.resultMatrix.ty,$a=($R*$V.resultMatrix.d-$w*$V.resultMatrix.c)*$M-$_.transform.x,$u=($w*$V.resultMatrix.a-$R*$V.resultMatrix.b)*$M-$_.transform.y,$c=Math.atan2($u,$a)*$O_.radDeg-0-$_.transform.skX;$_.transform.scX<0&&($c+=180),180<$c?$c-=360:$c<-180&&($c+=360),$_.transform.skX=$_.transform.skY=$_.transform.skX+$c*$O,$_.update()},$_.updatePos=function($_,$S){this._sp&&this._sp.pos($_,$S)},$_._applyIk2=function($_,$S,$j,$O,$V,$M){if(0!=$M){var $R=$_.resultTransform.x,$w=$_.resultTransform.y,$a=$_.transform.scX,$u=$_.transform.scY,$c=$S.transform.scX,$q=0,$s=0,$C=0;$C=$a<0?($a=-$a,$q=180,-1):($q=0,1),$u<0&&($u=-$u,$C=-$C),$s=$c<0?($c=-$c,180):0;var $i=$S.resultTransform.x,$v=NaN,$Z=NaN,$o=NaN,$l=$_.resultMatrix.a,$k=$_.resultMatrix.c,$z=$_.resultMatrix.b,$H=$_.resultMatrix.d,$A=Math.abs($a-$u)<=1e-4;$o=$A?($Z=$l*$i+$k*($v=$S.resultTransform.y)+$_.resultMatrix.tx,$z*$i+$H*$v+$_.resultMatrix.ty):($v=0,$Z=$l*$i+$_.resultMatrix.tx,$z*$i+$_.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $M_,$V_.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($j,$O,15,"#ffff00"),this._sp.graphics.drawCircle($Z,$o,15,"#ff00ff")),$_.setRotation(Math.atan2($o-$_.resultMatrix.ty,$Z-$_.resultMatrix.tx));var $f=$_.parentBone;$l=$f.resultMatrix.a,$k=$f.resultMatrix.c,$z=$f.resultMatrix.b;var $y=1/($l*($H=$f.resultMatrix.d)-$k*$z),$P=$j-$f.resultMatrix.tx,$g=$O-$f.resultMatrix.ty,$E=($P*$H-$g*$k)*$y-$R,$$=($g*$l-$P*$z)*$y-$w,$d=(($P=$Z-$f.resultMatrix.tx)*$H-($g=$o-$f.resultMatrix.ty)*$k)*$y-$R,$n=($g*$l-$P*$z)*$y-$w,$J=Math.sqrt($d*$d+$n*$n),$F=$S.length*$c,$x=NaN,$h=NaN;if($A){var $N=($E*$E+$$*$$-$J*$J-($F*=$a)*$F)/(2*$J*$F);$N<-1?$N=-1:1<$N&&($N=1),$h=Math.acos($N)*$V,$l=$J+$F*$N,$k=$F*Math.sin($h),$x=Math.atan2($$*$l-$E*$k,$E*$l+$$*$k)}else{var $B=($l=$a*$F)*$l,$t=($k=$u*$F)*$k,$m=$E*$E+$$*$$,$e=Math.atan2($$,$E),$G=-2*$t*$J,$D=$t-$B;if(0<($H=$G*$G-4*$D*($z=$t*$J*$J+$B*$m-$B*$t))){var $L=Math.sqrt($H);$G<0&&($L=-$L);var $U=($L=-($G+$L)/2)/$D,$Q=$z/$L,$Y=Math.abs($U)<Math.abs($Q)?$U:$Q;$Y*$Y<=$m&&($g=Math.sqrt($m-$Y*$Y)*$V,$x=$e-Math.atan2($g,$Y),$h=Math.atan2($g/$u,($Y-$J)/$a))}var $T=0,$W=Number.MAX_VALUE,$p=0,$I=0,$K=0,$X=0,$r=0,$b=0;$X<($H=($P=$J+$l)*$P)&&($K=0,$X=$H,$r=$P),($H=($P=$J-$l)*$P)<$W&&($T=Math.PI,$W=$H,$p=$P);var $__=Math.acos(-$l*$J/($B-$t));($H=($P=$l*Math.cos($__)+$J)*$P+($g=$k*Math.sin($__))*$g)<$W&&($T=$__,$W=$H,$p=$P,$I=$g),$X<$H&&($K=$__,$X=$H,$r=$P,$b=$g),$h=$m<=($W+$X)/2?($x=$e-Math.atan2($I*$V,$p),$T*$V):($x=$e-Math.atan2($b*$V,$r),$K*$V)}var $S_=Math.atan2($v,$i)*$C,$j_=$_.resultTransform.skX;180<($x=($x-$S_)*$O_.radDeg+$q-$j_)?$x-=360:$x<-180&&($x+=360),$_.resultTransform.x=$R,$_.resultTransform.y=$w,$_.resultTransform.skX=$_.resultTransform.skY=$j_+$x*$M,$j_=$S.resultTransform.skX,180<($h=(($h+$S_)*$O_.radDeg-0)*$C+$s-($j_%=360))?$h-=360:$h<-180&&($h+=360),$S.resultTransform.x=$i,$S.resultTransform.y=$v,$S.resultTransform.skX=$S.resultTransform.skY=$S.resultTransform.skY+$h*$M,$_.update()}},$_._applyIk3=function($_,$S,$j,$O,$V,$M){if(0!=$M){var $R,$w,$a=$S.resultMatrix.a*$S.length,$u=$S.resultMatrix.b*$S.length,$c=$a*$a+$u*$u,$q=Math.sqrt($c),$s=$_.resultMatrix.tx,$C=$_.resultMatrix.ty,$i=$S.resultMatrix.tx,$v=$S.resultMatrix.ty,$Z=$i-$s,$o=$v-$C,$l=$Z*$Z+$o*$o,$k=Math.sqrt($l),$z=($Z=$j-$_.resultMatrix.tx)*$Z+($o=$O-$_.resultMatrix.ty)*$o,$H=Math.sqrt($z);if($q+$k<=$H||$H+$q<=$k||$H+$k<=$q){var $A=NaN;$i=$s+($A=$q+$k<=$H?1:-1)*($j-$s)*$k/$H,$v=$C+$A*($O-$C)*$k/$H}else{var $f=($l-$c+$z)/(2*$z),$y=Math.sqrt($l-$f*$f*$z)/$H,$P=$s+$Z*$f,$g=$C+$o*$f,$E=-$o*$y,$$=$Z*$y;$v=0<$V?($i=$P-$E,$g-$$):($i=$P+$E,$g+$$)}$R=$i,$w=$v,this.isDebug&&(this._sp||(this._sp=new $M_,$V_.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($s,$C,15,"#ff00ff"),this._sp.graphics.drawCircle($j,$O,15,"#ffff00"),this._sp.graphics.drawCircle($R,$w,15,"#ff00ff"));var $d,$n;$d=Math.atan2($w-$_.resultMatrix.ty,$R-$_.resultMatrix.tx),$_.setRotation($d),($n=$O_._tempMatrix).identity(),$n.rotate($d),$n.scale($_.resultMatrix.getScaleX(),$_.resultMatrix.getScaleY()),$n.translate($_.resultMatrix.tx,$_.resultMatrix.ty),$n.copyTo($_.resultMatrix),$_.updateChild();var $J,$F;$J=Math.atan2($O-$w,$j-$R),$S.setRotation($J),($F=$O_._tempMatrix).identity(),$F.rotate($J),$F.scale($S.resultMatrix.getScaleX(),$S.resultMatrix.getScaleY()),$F.translate($R,$w),$n.copyTo($S.resultMatrix),$S.updateChild()}},$j($O_,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $n_}]),$O_}(),$e_=function(){function $_(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $O($_,"laya.ani.bone.IkConstraintData"),$_}(),$H=function(){function $F($_,$S){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$_,this.position=$_.position,this.spacing=$_.spacing,this.rotateMix=$_.rotateMix,this.translateMix=$_.translateMix,this.bones=[];for(var $j=this.data.bones,$O=0,$V=$j.length;$O<$V;$O++)this.bones.push($S[$j[$O]])}$O($F,"laya.ani.bone.PathConstraint");var $_=$F.prototype;return $_.apply=function($_,$S){if(this.target){var $j=this.translateMix,$O=this.translateMix,$V=0<$O,$M=this.data.spacingMode,$R="length"==$M,$w=this.data.rotateMode,$a="tangent"==$w,$u="chainScale"==$w,$c=[],$q=this.bones.length,$s=$a?$q:$q+1,$C=[];(this._spaces=$C)[0]=this.position;var $i=this.spacing;if($u||$R)for(var $v=0,$Z=$s-1;$v<$Z;){var $o=this.bones[$v],$l=$o.length,$k=$l*$o.resultMatrix.a,$z=$l*$o.resultMatrix.b;$l=Math.sqrt($k*$k+$z*$z),$u&&($c[$v]=$l),$C[++$v]=$R?Math.max(0,$l+$i):$i}else for($v=1;$v<$s;$v++)$C[$v]=$i;var $H=this.computeWorldPositions(this.target,$_,$S,$s,$a,"percent"==this.data.positionMode,"percent"==$M);if(this._debugKey){for($v=0;$v<$H.length;$v++)$S.drawCircle($H[$v++],$H[$v++],5,"#00ff00");var $A=[];for($v=0;$v<$H.length;$v++)$A.push($H[$v++],$H[$v++]);$S.drawLines(0,0,$A,"#ff0000")}var $f=$H[0],$y=$H[1],$P=this.data.offsetRotation,$g="chain"==$w&&0==$P,$E=NaN;for($v=0,$E=3;$v<$q;$v++,$E+=3){($o=this.bones[$v]).resultMatrix.tx+=($f-$o.resultMatrix.tx)*$j,$o.resultMatrix.ty+=($y-$o.resultMatrix.ty)*$j;var $$=($k=$H[$E])-$f,$d=($z=$H[$E+1])-$y;if($u&&0!=($l=$c[$v])){var $n=(Math.sqrt($$*$$+$d*$d)/$l-1)*$O+1;$o.resultMatrix.a*=$n,$o.resultMatrix.c*=$n}if($f=$k,$y=$z,$V){var $J=$o.resultMatrix.a,$F=$o.resultMatrix.c,$x=$o.resultMatrix.b,$h=$o.resultMatrix.d,$N=NaN,$B=NaN,$t=NaN;$N=$a?$H[$E-1]:0==$C[$v+1]?$H[$E+2]:Math.atan2($d,$$),$N-=Math.atan2($x,$J)-$P/180*Math.PI,$g&&($B=Math.cos($N),$t=Math.sin($N),$f+=(($l=$o.length)*($B*$J-$t*$x)-$$)*$O,$y+=($l*($t*$J+$B*$x)-$d)*$O),$N>Math.PI?$N-=2*Math.PI:$N<-Math.PI&&($N+=2*Math.PI),$N*=$O,$B=Math.cos($N),$t=Math.sin($N),$o.resultMatrix.a=$B*$J-$t*$x,$o.resultMatrix.c=$B*$F-$t*$h,$o.resultMatrix.b=$t*$J+$B*$x,$o.resultMatrix.d=$t*$F+$B*$h}}}},$_.computeWorldVertices2=function($_,$S,$j,$O,$V,$M){var $R,$w,$a=$_.currDisplayData.bones,$u=$_.currDisplayData.weights,$c=$_.currDisplayData.triangles,$q=0,$s=0,$C=0,$i=0,$v=0,$Z=0,$o=0,$l=0,$k=0,$z=0,$H=0;if(null!=$a){for($q=0;$q<$j;$q+=2)$s+=($i=$a[$s])+1,$C+=$i;var $A=$S;for($v=$M,$Z=3*$C;$v<$O;$v+=2){for($l=$o=0,$i=$a[$s++],$i+=$s;$s<$i;$s++,$Z+=3){$R=$A[$a[$s]].resultMatrix,$k=$u[$Z],$z=$u[$Z+1];var $f=$u[$Z+2];$o+=($k*$R.a+$z*$R.c+$R.tx)*$f,$l+=($k*$R.b+$z*$R.d+$R.ty)*$f}$V[$v]=$o,$V[$v+1]=$l}}else{var $y,$P;if($c||($c=$u),$_.deformData&&($c=$_.deformData),$y=$_.parent,$S)for($H=$S.length,$q=0;$q<$H;$q++)if($S[$q].name==$y){$w=$S[$q];break}$w&&($P=$w.resultMatrix),$P||($P=$F._tempMt);var $g=$P.tx,$E=$P.ty,$$=$P.a,$d=$P.b,$n=$P.c,$J=$P.d;for($w&&($J*=$w.d),$s=$j,$v=$M;$v<$O;$s+=2,$v+=2)$k=$c[$s],$z=$c[$s+1],$V[$v]=$k*$$+$z*$d+$g,$V[$v+1]=-($k*$n+$z*$J+$E)}},$_.computeWorldPositions=function($_,$S,$j,$O,$V,$M,$R){$_.currDisplayData.bones,$_.currDisplayData.weights,$_.currDisplayData.triangles;var $w=[],$a=0,$u=$_.currDisplayData.verLen,$c=this.position,$q=this._spaces,$s=[],$C=[],$i=$u/6,$v=-1,$Z=NaN,$o=0,$l=0,$k=NaN,$z=NaN,$H=NaN,$A=NaN;if($i--,$u-=4,this.computeWorldVertices2($_,$S,2,$u,$w,0),this._debugKey)for($a=0;$a<$w.length;)$j.drawCircle($w[$a++],$w[$a++],10,"#ff0000");$s=$w,this._curves.length=$i;var $f=this._curves,$y=$s[$Z=0],$P=$s[1],$g=0,$E=0,$$=0,$d=0,$n=0,$J=0,$F=NaN,$x=NaN,$h=NaN,$N=NaN,$B=NaN,$t=NaN,$m=NaN,$e=NaN,$G=0;for($a=0,$G=2;$a<$i;$a++,$G+=6)$g=$s[$G],$E=$s[$G+1],$$=$s[$G+2],$d=$s[$G+3],$B=2*($F=.1875*($y-2*$g+$$))+($h=.09375*(3*($g-$$)-$y+($n=$s[$G+4]))),$t=2*($x=.1875*($P-2*$E+$d))+($N=.09375*(3*($E-$d)-$P+($J=$s[$G+5]))),$m=.75*($g-$y)+$F+.16666667*$h,$e=.75*($E-$P)+$x+.16666667*$N,$Z+=Math.sqrt($m*$m+$e*$e),$m+=$B,$e+=$t,$B+=$h,$t+=$N,$Z+=Math.sqrt($m*$m+$e*$e),$m+=$B,$e+=$t,$Z+=Math.sqrt($m*$m+$e*$e),$m+=$B+$h,$e+=$t+$N,$Z+=Math.sqrt($m*$m+$e*$e),$f[$a]=$Z,$y=$n,$P=$J;if($M&&($c*=$Z),$R)for($a=0;$a<$O;$a++)$q[$a]*=$Z;var $D=this._segments,$L=0,$U=0;for($U=$l=$o=$a=0;$a<$O;$a++,$o+=3)if(($k=$c+=$z=$q[$a])<0)this.addBeforePosition($k,$s,0,$C,$o);else if($Z<$k)this.addAfterPosition($k-$Z,$s,$u-4,$C,$o);else{for(;;$l++)if(!(($A=$f[$l])<$k)){0==$l?$k/=$A:$k=($k-($H=$f[$l-1]))/($A-$H);break}if($l!=$v){var $Q=6*($v=$l);for($y=$s[$Q],$P=$s[$Q+1],$g=$s[$Q+2],$E=$s[$Q+3],$$=$s[$Q+4],$d=$s[$Q+5],$B=2*($F=.03*($y-2*$g+$$))+($h=.006*(3*($g-$$)-$y+($n=$s[$Q+6]))),$t=2*($x=.03*($P-2*$E+$d))+($N=.006*(3*($E-$d)-$P+($J=$s[$Q+7]))),$m=.3*($g-$y)+$F+.16666667*$h,$e=.3*($E-$P)+$x+.16666667*$N,$L=Math.sqrt($m*$m+$e*$e),$D[0]=$L,$Q=1;$Q<8;$Q++)$m+=$B,$e+=$t,$B+=$h,$t+=$N,$L+=Math.sqrt($m*$m+$e*$e),$D[$Q]=$L;$m+=$B,$e+=$t,$L+=Math.sqrt($m*$m+$e*$e),$D[8]=$L,$m+=$B+$h,$e+=$t+$N,$L+=Math.sqrt($m*$m+$e*$e),$D[9]=$L,$U=0}for($k*=$L;;$U++)if(!(($A=$D[$U])<$k)){0==$U?$k/=$A:$k=$U+($k-($H=$D[$U-1]))/($A-$H);break}this.addCurvePosition(.1*$k,$y,$P,$g,$E,$$,$d,$n,$J,$C,$o,$V||0<$a&&0==$z)}return $C},$_.addBeforePosition=function($_,$S,$j,$O,$V){var $M=$S[$j],$R=$S[$j+1],$w=$S[$j+2]-$M,$a=$S[$j+3]-$R,$u=Math.atan2($a,$w);$O[$V]=$M+$_*Math.cos($u),$O[$V+1]=$R+$_*Math.sin($u),$O[$V+2]=$u},$_.addAfterPosition=function($_,$S,$j,$O,$V){var $M=$S[$j+2],$R=$S[$j+3],$w=$M-$S[$j],$a=$R-$S[$j+1],$u=Math.atan2($a,$w);$O[$V]=$M+$_*Math.cos($u),$O[$V+1]=$R+$_*Math.sin($u),$O[$V+2]=$u},$_.addCurvePosition=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c,$q){0==$_&&($_=1e-4);var $s=$_*$_,$C=$s*$_,$i=1-$_,$v=$i*$i,$Z=$v*$i,$o=$i*$_,$l=3*$o,$k=$i*$l,$z=$l*$_,$H=$S*$Z+$O*$k+$M*$z+$w*$C,$A=$j*$Z+$V*$k+$R*$z+$a*$C;$u[$c]=$H,$u[$c+1]=$A,$u[$c+2]=$q?Math.atan2($A-($j*$v+$V*$o*2+$R*$s),$H-($S*$v+$O*$o*2+$M*$s)):0},$F.NONE=-1,$F.BEFORE=-2,$F.AFTER=-3,$j($F,["_tempMt",function(){return this._tempMt=new $n_}]),$F}(),$G_=function(){function $_(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $O($_,"laya.ani.bone.PathConstraintData"),$_}(),$D_=function(){function $_(){this.name=null,this.slotArr=[]}return $O($_,"laya.ani.bone.SkinData"),$_}(),$L_=function(){function $_(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$O($_,"laya.ani.bone.SkinSlotDisplayData");var $S=$_.prototype;return $S.createTexture=function($_){return this.texture||(this.texture=new $J_($_.bitmap,this.uvs),$_.bitmap.alphaTexture&&(this.texture.alphaTexture=new $J_($_.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$_.height,this.texture.height=$_.width,this.texture.offsetX=-$_.offsetX,this.texture.offsetY=-$_.offsetY,this.texture.sourceWidth=$_.sourceHeight,this.texture.sourceHeight=$_.sourceWidth):(this.texture.width=$_.width,this.texture.height=$_.height,this.texture.offsetX=-$_.offsetX,this.texture.offsetY=-$_.offsetY,this.texture.sourceWidth=$_.sourceWidth,this.texture.sourceHeight=$_.sourceHeight),$Z.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$S.destory=function(){this.texture&&this.texture.destroy()},$_}(),$U_=function(){function $_(){this.name=null,this.displayArr=[]}return $O($_,"laya.ani.bone.SlotData"),$_.prototype.getDisplayByName=function($_){for(var $S=0,$j=this.displayArr.length;$S<$j;$S++)if(this.displayArr[$S].attachmentName==$_)return $S;return-1},$_}(),$A=function(){function $_($_,$S){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$v(2,0),this._data=$_,null==this._bones&&(this._bones=[]),this.target=$S[$_.targetIndex];var $j,$O=0;for($O=0,$j=$_.boneIndexs.length;$O<$j;$O++)this._bones.push($S[$_.boneIndexs[$O]]);this.rotateMix=$_.rotateMix,this.translateMix=$_.translateMix,this.scaleMix=$_.scaleMix,this.shearMix=$_.shearMix}return $O($_,"laya.ani.bone.TfConstraint"),$_.prototype.apply=function(){for(var $_,$S=this.target.resultMatrix.a,$j=this.target.resultMatrix.b,$O=this.target.resultMatrix.c,$V=this.target.resultMatrix.d,$M=0,$R=this._bones.length;$M<$R;$M++){if($_=this._bones[$M],0<this.rotateMix){var $w=$_.resultMatrix.a,$a=$_.resultMatrix.b,$u=$_.resultMatrix.c,$c=$_.resultMatrix.d,$q=Math.atan2($O,$S)-Math.atan2($u,$w)+this._data.offsetRotation*Math.PI/180;$q>Math.PI?$q-=2*Math.PI:$q<-Math.PI&&($q+=2*Math.PI),$q*=this.rotateMix;var $s=Math.cos($q),$C=Math.sin($q);$_.resultMatrix.a=$s*$w-$C*$u,$_.resultMatrix.b=$s*$a-$C*$c,$_.resultMatrix.c=$C*$w+$s*$u,$_.resultMatrix.d=$C*$a+$s*$c}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$_.resultMatrix.tx+=(this._temp[0]-$_.resultMatrix.tx)*this.translateMix,$_.resultMatrix.ty+=(this._temp[1]-$_.resultMatrix.ty)*this.translateMix,$_.updateChild()),0<this.scaleMix){var $i=Math.sqrt($_.resultMatrix.a*$_.resultMatrix.a+$_.resultMatrix.c*$_.resultMatrix.c),$v=Math.sqrt($S*$S+$O*$O),$Z=1e-5<$i?($i+($v-$i+this._data.offsetScaleX)*this.scaleMix)/$i:0;$_.resultMatrix.a*=$Z,$_.resultMatrix.c*=$Z,$i=Math.sqrt($_.resultMatrix.b*$_.resultMatrix.b+$_.resultMatrix.d*$_.resultMatrix.d),$v=Math.sqrt($j*$j+$V*$V),$Z=1e-5<$i?($i+($v-$i+this._data.offsetScaleY)*this.scaleMix)/$i:0,$_.resultMatrix.b*=$Z,$_.resultMatrix.d*=$Z}if(0<this.shearMix){$a=$_.resultMatrix.b,$c=$_.resultMatrix.d;var $o=Math.atan2($c,$a);($q=Math.atan2($V,$j)-Math.atan2($O,$S)-($o-Math.atan2($_.resultMatrix.c,$_.resultMatrix.a)))>Math.PI?$q-=2*Math.PI:$q<-Math.PI&&($q+=2*Math.PI),$q=$o+($q+this._data.offsetShearY*Math.PI/180)*this.shearMix,$Z=Math.sqrt($a*$a+$c*$c),$_.resultMatrix.b=Math.cos($q)*$Z,$_.resultMatrix.d=Math.sin($q)*$Z}}},$_}(),$Q_=function(){function $_(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $O($_,"laya.ani.bone.TfConstraintData"),$_}(),$Y_=function(){function $_(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$O($_,"laya.ani.bone.Transform");var $S=$_.prototype;return $S.initData=function($_){null!=$_.x&&(this.x=$_.x),null!=$_.y&&(this.y=$_.y),null!=$_.skX&&(this.skX=$_.skX),null!=$_.skY&&(this.skY=$_.skY),null!=$_.scX&&(this.scX=$_.scX),null!=$_.scY&&(this.scY=$_.scY)},$S.getMatrix=function(){var $_;return($_=this.mMatrix?this.mMatrix:this.mMatrix=new $n_).identity(),$_.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($_,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$_.rotate(this.skX*Math.PI/180),$_.translate(this.x,this.y),$_},$S.skew=function($_,$S,$j){var $O=Math.sin($j),$V=Math.cos($j),$M=Math.sin($S),$R=Math.cos($S);return $_.setTo($_.a*$R-$_.b*$O,$_.a*$M+$_.b*$V,$_.c*$R-$_.d*$O,$_.c*$M+$_.d*$V,$_.tx*$R-$_.ty*$O,$_.tx*$M+$_.ty*$V),$_},$_}(),$f=function(){function $_(){}return $O($_,"laya.ani.bone.UVTools"),$_.getRelativeUV=function($_,$S,$j){var $O=$_[0],$V=$_[2]-$_[0],$M=$_[1],$R=$_[5]-$_[1];$j||($j=[]),$j.length=$S.length;var $w,$a=0;$w=$j.length;var $u=1/$V,$c=1/$R;for($a=0;$a<$w;$a+=2)$j[$a]=($S[$a]-$O)*$u,$j[$a+1]=($S[$a+1]-$M)*$c;return $j},$_.getAbsoluteUV=function($_,$S,$j){if(0==$_[0]&&0==$_[1]&&1==$_[4]&&1==$_[5])return $j?($o.copyArray($j,$S),$j):$S;var $O=$_[0],$V=$_[2]-$_[0],$M=$_[1],$R=$_[5]-$_[1];$j||($j=[]),$j.length=$S.length;var $w,$a=0;for($w=$j.length,$a=0;$a<$w;$a+=2)$j[$a]=$S[$a]*$V+$O,$j[$a+1]=$S[$a+1]*$R+$M;return $j},$_}(),$F=function(){function $_(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $O($_,"laya.ani.KeyFramesContent"),$_}(),$y=function(){function $c(){}return $O($c,"laya.ani.math.BezierLerp"),$c.getBezierRate=function($_,$S,$j,$O,$V){var $M=$c._getBezierParamKey($S,$j,$O,$V),$R=100*$M+$_;if($c._bezierResultCache[$R])return $c._bezierResultCache[$R];var $w,$a=$c._getBezierPoints($S,$j,$O,$V,$M),$u=0;for($w=$a.length,$u=0;$u<$w;$u+=2)if($_<=$a[$u])return $c._bezierResultCache[$R]=$a[$u+1],$a[$u+1];return $c._bezierResultCache[$R]=1},$c._getBezierParamKey=function($_,$S,$j,$O){return 100*(100*(100*(100*$_+$S)+$j)+$O)},$c._getBezierPoints=function($_,$S,$j,$O,$V){return $c._bezierPointsCache[$V]?$c._bezierPointsCache[$V]:($M=[0,0,$_,$S,$j,$O,1,1],$R=(new $w).getBezierPoints($M,100,3),$c._bezierPointsCache[$V]=$R);var $M,$R},$c._bezierResultCache={},$c._bezierPointsCache={},$c}(),$P=function($_){function $S(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$S.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$O($S,"laya.ani.AnimationPlayer",$V);var $j=$S.prototype;return $V_.imps($j,{"laya.resource.IDestroy":!0}),$j._onTempletLoadedComputeFullKeyframeIndices=function($_,$S,$j){this._templet===$j&&this._cachePlayRate===$_&&this._cacheFrameRate===$S&&this._computeFullKeyframeIndices()},$j._computeFullKeyframeIndices=function(){for(var $_=this._fullFrames=[],$S=this._templet,$j=this._cacheFrameRateInterval*this._cachePlayRate,$O=0,$V=$S.getAnimationCount();$O<$V;$O++){for(var $M=[],$R=0,$w=$S.getAnimation($O).nodes.length;$R<$w;$R++){for(var $a=$S.getAnimation($O).nodes[$R],$u=Math.floor($a.playTime/$j+.01),$c=new Uint16Array($u+1),$q=-1,$s=0,$C=$a.keyFrame.length;$s<$C;$s++){var $i=$a.keyFrame[$s],$v=$i.startTime,$Z=$v+$i.duration+$j;do{for(var $o=Math.floor($v/$j+.5),$l=$q+1;$l<$o;$l++)$c[$l]=$s;$c[$q=$o]=$s,$v+=$j}while($v<=$Z)}$M.push($c)}$_.push($M)}},$j._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$j._calculatePlayDuration=function(){if(0!==this.state){var $_=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$_),this._playEnd>$_&&(this._playEnd=$_),this._playDuration=this._playEnd-this._playStart}},$j._setPlayParams=function($_,$S){this._currentTime=$_,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$S+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$S},$j._setPlayParamsWhenStop=function($_,$S){this._currentTime=$_,this._currentKeyframeIndex=Math.max(Math.floor($_/$S+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$S,this._currentAnimationClipIndex=-1},$j._update=function($_){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $S=this._cacheFrameRateInterval*this._cachePlayRate,$j=0;this._startUpdateLoopCount!==$i.loopCount&&($j=$_*this.playbackRate,this._elapsedPlaybackTime+=$j);var $O=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$O)return this._setPlayParamsWhenStop($O,$S),void this.event("stopped");if($j+=this._currentTime,0<$O)if($O<=$j)do{if($j-=$O,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($O,$S),this._stopWhenCircleFinish=!1,void this.event("stopped");$j<$O&&(this._setPlayParams($j,$S),this.event("complete"))}while($O<=$j);else this._setPlayParams($j,$S);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($O,$S),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$j._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$j.play=function($_,$S,$j,$O,$V){if(void 0===$_&&($_=0),void 0===$S&&($S=1),void 0===$j&&($j=2147483647),void 0===$O&&($O=0),void 0===$V&&($V=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($j<0||$O<0||$V<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$V&&$V<$O)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$S,this._overallDuration=$j,this._playStart=$O,this._playEnd=$V,this._paused=!1,this._currentAnimationClipIndex=$_,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$i.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$j.playByFrame=function($_,$S,$j,$O,$V,$M){void 0===$_&&($_=0),void 0===$S&&($S=1),void 0===$j&&($j=2147483647),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$M&&($M=30);var $R=1e3/$M;this.play($_,$S,$j,$O*$R,$V*$R)},$j.stop=function($_){void 0===$_&&($_=!0),$_?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$M(0,$j,"playEnd",function(){return this._playEnd}),$M(0,$j,"templet",function(){return this._templet},function($_){0===!this.state&&this.stop(!0),this._templet!==$_&&((this._templet=$_).loaded?this._computeFullKeyframeIndices():$_.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$M(0,$j,"playStart",function(){return this._playStart}),$M(0,$j,"playDuration",function(){return this._playDuration}),$M(0,$j,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$M(0,$j,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$M(0,$j,"overallDuration",function(){return this._overallDuration}),$M(0,$j,"currentFrameTime",function(){return this._currentFrameTime}),$M(0,$j,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$M(0,$j,"currentPlayTime",function(){return this._currentTime+this._playStart}),$M(0,$j,"cachePlayRate",function(){return this._cachePlayRate},function($_){this._cachePlayRate!==$_&&(this._cachePlayRate=$_,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$_,this._cacheFrameRate])))}),$M(0,$j,"cacheFrameRate",function(){return this._cacheFrameRate},function($_){this._cacheFrameRate!==$_&&(this._cacheFrameRate=$_,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$_])))}),$M(0,$j,"currentTime",null,function($_){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($_<this._playStart||$_>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$i.loopCount;var $S=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$_,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$S),0),this._currentFrameTime=this._currentKeyframeIndex*$S}}),$M(0,$j,"paused",function(){return this._paused},function($_){(this._paused=$_)&&this.event("paused")}),$M(0,$j,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$M(0,$j,"destroyed",function(){return this._destroyed}),$S}(),$x=function($_){function $S(){$S.__super.call(this),$Z.isConchNode&&(this.drawSkin=function($_){$_.transform||($_.transform=$n_.EMPTY),this._addCmd([$_]),this.setSkinMesh&&this.setSkinMesh($_._ps,$_.mVBData,$_.mEleNum,0,$_.mTexture,$_.transform)})}return $O($S,"laya.ani.GraphicsAni",$R),$S.prototype.drawSkin=function($_){var $S=[$_];this._saveToCmd($Z._context._drawSkin,$S)},$S.create=function(){return $S._caches.pop()||new $S},$S.recycle=function($_){$_.clear(),$S._caches.push($_)},$S._caches=[],$S}(),$h=function($_){function $l(){this._aniMap={},this.unfixedLastAniIndex=-1,$l.__super.call(this),this._anis=new Array}$O($l,"laya.ani.AnimationTemplet",$c);var $S=$l.prototype;return $S.parse=function($_){var $S=new $d_($_);this._aniVersion=$S.readUTFString(),$k.parse(this,$S)},$S._calculateKeyFrame=function($_,$S,$j){var $O=$_.keyFrame;$O[$S]=$O[0];for(var $V=0;$V<$S;$V++){var $M=$O[$V];$M.nextData=0===$M.duration?$M.data:$O[$V+1].data}$O.length--},$S.onAsynLoaded=function($_,$S,$j){var $O=new $d_($S);switch(this._aniVersion=$O.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$z.parse(this,$O);break;default:$k.parse(this,$O)}this._endLoaded()},$S.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$S.getAnimationCount=function(){return this._anis.length},$S.getAnimation=function($_){return this._anis[$_]},$S.getAniDuration=function($_){return this._anis[$_].playTime},$S.getNodes=function($_){return this._anis[$_].nodes},$S.getNodeIndexWithName=function($_,$S){return this._anis[$_].bone3DMap[$S]},$S.getNodeCount=function($_){return this._anis[$_].nodes.length},$S.getTotalkeyframesLength=function($_){return this._anis[$_].totalKeyframeDatasLength},$S.getPublicExtData=function(){return this._publicExtData},$S.getAnimationDataWithCache=function($_,$S,$j,$O){var $V=$S[$j];if($V){var $M=$V[$_];return $M?$M[$O]:null}return null},$S.setAnimationDataWithCache=function($_,$S,$j,$O,$V){var $M=$S[$j]||($S[$j]={});($M[$_]||($M[$_]=[]))[$O]=$V},$S.getOriginalData=function($_,$S,$j,$O,$V){for(var $M=this._anis[$_].nodes,$R=0,$w=0,$a=$M.length,$u=0;$w<$a;$w++){var $c,$q=$M[$w];$c=$q.keyFrame[$j[$w][$O]],$q.dataOffset=$u;var $s=$V-$c.startTime,$C=$q.lerpType;if($C)switch($C){case 0:case 1:for($R=0;$R<$q.keyframeWidth;)$R+=$q.interpolationMethod[$R]($q,$R,$S,$u+$R,$c.data,$s,null,$c.duration,$c.nextData);break;case 2:var $i=$c.interpolationData,$v=$i.length,$Z=0;for($R=0;$R<$v;){var $o=$i[$R];switch($o){case 6:case 7:$R+=$l.interpolation[$o]($q,$Z,$S,$u+$Z,$c.data,$s,null,$c.duration,$c.nextData,$i,$R+1);break;default:$R+=$l.interpolation[$o]($q,$Z,$S,$u+$Z,$c.data,$s,null,$c.duration,$c.nextData)}$Z++}}else for($R=0;$R<$q.keyframeWidth;)$R+=$q.interpolationMethod[$R]($q,$R,$S,$u+$R,$c.data,$s,null,$c.duration,$c.nextData);$u+=$q.keyframeWidth}},$S.getNodesCurrentFrameIndex=function($_,$S){var $j=this._anis[$_].nodes;$_!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($j.length),this.unfixedCurrentTimes=new Float32Array($j.length),this.unfixedLastAniIndex=$_);for(var $O=0,$V=$j.length;$O<$V;$O++){var $M=$j[$O];for($S<this.unfixedCurrentTimes[$O]&&(this.unfixedCurrentFrameIndexes[$O]=0),this.unfixedCurrentTimes[$O]=$S;this.unfixedCurrentFrameIndexes[$O]<$M.keyFrame.length&&!($M.keyFrame[this.unfixedCurrentFrameIndexes[$O]].startTime>this.unfixedCurrentTimes[$O]);)this.unfixedCurrentFrameIndexes[$O]++;this.unfixedCurrentFrameIndexes[$O]--}return this.unfixedCurrentFrameIndexes},$S.getOriginalDataUnfixedRate=function($_,$S,$j){var $O=this._anis[$_].nodes;$_!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($O.length),this.unfixedCurrentTimes=new Float32Array($O.length),this.unfixedKeyframes=$v($O.length),this.unfixedLastAniIndex=$_);for(var $V=0,$M=0,$R=$O.length,$w=0;$M<$R;$M++){var $a=$O[$M];for($j<this.unfixedCurrentTimes[$M]&&(this.unfixedCurrentFrameIndexes[$M]=0),this.unfixedCurrentTimes[$M]=$j;this.unfixedCurrentFrameIndexes[$M]<$a.keyFrame.length&&!($a.keyFrame[this.unfixedCurrentFrameIndexes[$M]].startTime>this.unfixedCurrentTimes[$M]);)this.unfixedKeyframes[$M]=$a.keyFrame[this.unfixedCurrentFrameIndexes[$M]],this.unfixedCurrentFrameIndexes[$M]++;var $u=this.unfixedKeyframes[$M];$a.dataOffset=$w;var $c=$j-$u.startTime;if($a.lerpType)switch($a.lerpType){case 0:case 1:for($V=0;$V<$a.keyframeWidth;)$V+=$a.interpolationMethod[$V]($a,$V,$S,$w+$V,$u.data,$c,null,$u.duration,$u.nextData);break;case 2:var $q=$u.interpolationData,$s=$q.length,$C=0;for($V=0;$V<$s;){var $i=$q[$V];switch($i){case 6:case 7:$V+=$l.interpolation[$i]($a,$C,$S,$w+$C,$u.data,$c,null,$u.duration,$u.nextData,$q,$V+1);break;default:$V+=$l.interpolation[$i]($a,$C,$S,$w+$C,$u.data,$c,null,$u.duration,$u.nextData)}$C++}}else for($V=0;$V<$a.keyframeWidth;)$V+=$a.interpolationMethod[$V]($a,$V,$S,$w+$V,$u.data,$c,null,$u.duration,$u.nextData);$w+=$a.keyframeWidth}},$l._LinearInterpolation_0=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){var $c=0===$w?0:$M/$w;return $j[$O]=(1-$c)*$V[$S]+$c*$a[$S],1},$l._QuaternionInterpolation_1=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){var $c=0===$w?0:$M/$w;return $s.slerpQuaternionArray($V,$S,$a,$S,$c,$j,$O),4},$l._AngleInterpolation_2=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){return 0},$l._RadiansInterpolation_3=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){return 0},$l._Matrix4x4Interpolation_4=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){for(var $c=0;$c<16;$c++,$S++)$j[$O+$c]=$V[$S]+$M*$R[$S];return 16},$l._NoInterpolation_5=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u){return $j[$O]=$V[$S],1},$l._BezierInterpolation_6=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c){return void 0===$c&&($c=0),$j[$O]=$V[$S]+($a[$S]-$V[$S])*$y.getBezierRate($M/$w,$u[$c],$u[$c+1],$u[$c+2],$u[$c+3]),5},$l._BezierInterpolation_7=function($_,$S,$j,$O,$V,$M,$R,$w,$a,$u,$c){return void 0===$c&&($c=0),$j[$O]=$u[$c+4]+$u[$c+5]*$y.getBezierRate((.001*$M+$u[$c+6])/$u[$c+7],$u[$c],$u[$c+1],$u[$c+2],$u[$c+3]),9},$l.load=function($_){return $V_.loader.create($_,null,null,$l)},$l.interpolation=[$l._LinearInterpolation_0,$l._QuaternionInterpolation_1,$l._AngleInterpolation_2,$l._RadiansInterpolation_3,$l._Matrix4x4Interpolation_4,$l._NoInterpolation_5,$l._BezierInterpolation_6,$l._BezierInterpolation_7],$l}(),$g=function($S){function $j($_,$S){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$j.__super.call(this),void 0===$S&&($S=0),$_&&this.init($_,$S)}$O($j,"laya.ani.bone.Skeleton",$S);var $_=$j.prototype;return $_.init=function($_,$S){void 0===$S&&($S=0);var $j,$O,$V,$M=0,$R=0;if(1==$S)for(this._graphicsCache=[],$M=0,$R=$_.getAnimationCount();$M<$R;$M++)this._graphicsCache.push([]);if(this._yReverseMatrix=$_.yReverseMatrix,this._aniMode=$S,this._templet=$_,this._player=new $P,this._player.cacheFrameRate=$_.rate,this._player.templet=$_,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$_.mBoneArr,this._rootBone=$_.mRootBone,this._aniSectionDic=$_.aniSectionDic,0<$_.ikArr.length)for(this._ikArr=[],$M=0,$R=$_.ikArr.length;$M<$R;$M++)this._ikArr.push(new $l($_.ikArr[$M],this._boneList));if(0<$_.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$M=0,$R=$_.pathArr.length;$M<$R;$M++)$j=$_.pathArr[$M],$O=new $H($j,this._boneList),($V=this._boneSlotDic[$j.name])&&(($O=new $H($j,this._boneList)).target=$V),this._pathDic[$j.name]=$O;if(0<$_.tfArr.length)for(this._tfArr=[],$M=0,$R=$_.tfArr.length;$M<$R;$M++)this._tfArr.push(new $A($_.tfArr[$M],this._boneList));if(0<$_.skinDataArray.length){var $w=this._templet.skinDataArray[this._skinIndex];this._skinName=$w.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$_.load=function($_,$S,$j){},$_._onLoaded=function(){},$_._parseComplete=function(){var $_=$E.TEMPLET_DICTIONARY[this._aniPath];$_&&(this.init($_,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$_._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$_._onPlay=function(){this.event("played")},$_._onStop=function(){var $_,$S=this._templet.eventAniArr[this._aniClipIndex];if($S&&this._eventIndex<$S.length)for(;this._eventIndex<$S.length;this._eventIndex++)($_=$S[this._eventIndex]).time>=this._player.playStart&&$_.time<=this._player.playEnd&&this.event("label",$_);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$_._onPause=function(){this.event("paused")},$_._parseSrcBoneMatrix=function(){var $_=0,$S=0;for($S=this._templet.srcBoneMatrixArr.length,$_=0;$_<$S;$_++)this._boneMatrixArray.push(new $n_);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $j,$O,$V=this._templet.boneSlotArray;for($_=0,$S=$V.length;$_<$S;$_++)$j=$V[$_],null==($O=this._bindBoneBoneSlotDic[$j.parent])&&(this._bindBoneBoneSlotDic[$j.parent]=$O=[]),this._boneSlotDic[$j.name]=$j=$j.copy(),$O.push($j),this._boneSlotArray.push($j)}},$_._emitMissedEvents=function($_,$S,$j){void 0===$j&&($j=0);var $O=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($O){var $V,$M,$R=0;for($V=$O.length,$R=$j;$R<$V;$R++)($M=$O[$R]).time>=this._player.playStart&&$M.time<=this._player.playEnd&&this.event("label",$M)}},$_._update=function($_){if(void 0===$_&&($_=!0),!(this._pause||$_&&this._indexControl)){var $S=this.timer.currTimer,$j=this._player.currentKeyframeIndex,$O=$S-this._lastTime;if($_?this._player._update($O):$j=-1,this._lastTime=$S,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$O&&this._clipIndex==$j&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $V;this._lastUpdateAniClipIndex=this._aniClipIndex,$j>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $M,$R=this._templet.eventAniArr[this._aniClipIndex];if($R&&this._eventIndex<$R.length&&(($V=$R[this._eventIndex]).time>=this._player.playStart&&$V.time<=this._player.playEnd?this._player.currentPlayTime>=$V.time&&(this.event("label",$V),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($M=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$M&&(this.graphics=$M));var $w=0,$a=0;for($a=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$a-1)&&0<$a;)$a--;if($a<this._clipIndex)for($w=$a;$w<this._clipIndex;$w++)this._createGraphics($w)}else if(1==this._aniMode){if($M=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$M&&(this.graphics=$M));for($a=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$a-1)&&0<$a;)$a--;if($a<this._clipIndex)for($w=$a;$w<this._clipIndex;$w++)this._createGraphics($w)}this._createGraphics()}}},$_._createGraphics=function($_){void 0===$_&&($_=-1),-1==$_&&($_=this._clipIndex);var $S,$j,$O=$_*this._player.cacheFrameRateInterval,$V=this._templet.drawOrderAniArr[this._aniClipIndex];if($V&&0<$V.length)for(this._drawOrderIndex=0,$S=$V[this._drawOrderIndex];$O>=$S.time&&(this._drawOrder=$S.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$V.length));)$S=$V[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$x.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$x.create(),$j=this.graphics;var $M=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$_,$O);var $R,$w,$a,$u,$c=this._aniSectionDic[this._aniClipIndex],$q=0,$s=0,$C=0,$i=0,$v=0,$Z=this._templet.srcBoneMatrixArr.length;for($v=$c[$s=0];$s<$Z;$s++)$u=this._boneList[$s],$a=this._templet.srcBoneMatrixArr[$s],$u.resultTransform.scX=$a.scX*this._curOriginalData[$q++],$u.resultTransform.skX=$a.skX+this._curOriginalData[$q++],$u.resultTransform.skY=$a.skY+this._curOriginalData[$q++],$u.resultTransform.scY=$a.scY*this._curOriginalData[$q++],$u.resultTransform.x=$a.x+this._curOriginalData[$q++],$u.resultTransform.y=$a.y+this._curOriginalData[$q++],8===this._templet.tMatrixDataLen&&($u.resultTransform.skewX=$a.skewX+this._curOriginalData[$q++],$u.resultTransform.skewY=$a.skewY+this._curOriginalData[$q++]);var $o,$l={},$k={};for($v+=$c[1];$s<$v;$s++)$l[($o=$M[$s]).name]=this._curOriginalData[$q++],$k[$o.name]=this._curOriginalData[$q++],this._curOriginalData[$q++],this._curOriginalData[$q++],this._curOriginalData[$q++],this._curOriginalData[$q++];var $z,$H,$A={},$f={};for($v+=$c[2];$s<$v;$s++)$A[($o=$M[$s]).name]=this._curOriginalData[$q++],$f[$o.name]=this._curOriginalData[$q++],this._curOriginalData[$q++],this._curOriginalData[$q++],this._curOriginalData[$q++],this._curOriginalData[$q++];if(this._pathDic)for($v+=$c[3];$s<$v;$s++){if($o=$M[$s],$z=this._pathDic[$o.name])switch(new $d_($o.extenData).getByte()){case 1:$z.position=this._curOriginalData[$q++];break;case 2:$z.spacing=this._curOriginalData[$q++];break;case 3:$z.rotateMix=this._curOriginalData[$q++],$z.translateMix=this._curOriginalData[$q++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($n_.TEMP.identity()),this._ikArr)for($s=0,$v=this._ikArr.length;$s<$v;$s++)$H=this._ikArr[$s],$A.hasOwnProperty($H.name)&&($H.bendDirection=$A[$H.name]),$f.hasOwnProperty($H.name)&&($H.mix=$f[$H.name]),$H.apply();if(this._pathDic)for(var $y in this._pathDic)($z=this._pathDic[$y]).apply(this._boneList,$j);if(this._tfArr)for($s=0,$i=this._tfArr.length;$s<$i;$s++)this._tfArr[$s].apply();for($s=0,$i=this._boneList.length;$s<$i;$s++)if($u=this._boneList[$s],$w=this._bindBoneBoneSlotDic[$u.name],$u.resultMatrix.copyTo(this._boneMatrixArray[$s]),$w)for($C=0,$v=$w.length;$C<$v;$C++)($R=$w[$C])&&$R.setParentMatrix($u.resultMatrix);var $P,$g,$E,$$,$d={},$n=this._templet.deformAniArr;if($n&&0<$n.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$s=0,$v=this._boneSlotArray.length;$s<$v;$s++)($R=this._boneSlotArray[$s]).deformData=null;var $J,$F=$n[this._aniClipIndex];for($J in $P=$F.default,this._setDeform($P,$d,this._boneSlotArray,$O),$F)"default"!=$J&&$J!=this._skinName&&($P=$F[$J],this._setDeform($P,$d,this._boneSlotArray,$O));$P=$F[this._skinName],this._setDeform($P,$d,this._boneSlotArray,$O)}if(this._drawOrder)for($s=0,$v=this._drawOrder.length;$s<$v;$s++)$g=$l[($R=this._boneSlotArray[this._drawOrder[$s]]).name],$E=$k[$R.name],isNaN($E)||($j.save(),$j.alpha($E)),isNaN($g)||-2==$g||(this._templet.attachmentNames?$R.showDisplayByName(this._templet.attachmentNames[$g]):$R.showDisplayByIndex($g)),$d[this._drawOrder[$s]]?($$=$d[this._drawOrder[$s]],$R.currDisplayData&&$$[$R.currDisplayData.attachmentName]?$R.deformData=$$[$R.currDisplayData.attachmentName]:$R.deformData=null):$R.deformData=null,isNaN($E)?$R.draw($j,this._boneMatrixArray,2==this._aniMode):$R.draw($j,this._boneMatrixArray,2==this._aniMode,$E),isNaN($E)||$j.restore();else for($s=0,$v=this._boneSlotArray.length;$s<$v;$s++)$g=$l[($R=this._boneSlotArray[$s]).name],$E=$k[$R.name],isNaN($E)||($j.save(),$j.alpha($E)),isNaN($g)||-2==$g||(this._templet.attachmentNames?$R.showDisplayByName(this._templet.attachmentNames[$g]):$R.showDisplayByIndex($g)),$d[$s]?($$=$d[$s],$R.currDisplayData&&$$[$R.currDisplayData.attachmentName]?$R.deformData=$$[$R.currDisplayData.attachmentName]:$R.deformData=null):$R.deformData=null,isNaN($E)?$R.draw($j,this._boneMatrixArray,2==this._aniMode):$R.draw($j,this._boneMatrixArray,2==this._aniMode,$E),isNaN($E)||$j.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$_,$j):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$_,$j)},$_._setDeform=function($_,$S,$j,$O){if($_){var $V,$M,$R,$w=0,$a=0,$u=0;if($_)for($w=0,$a=$_.deformSlotDataList.length;$w<$a;$w++)for($V=$_.deformSlotDataList[$w],$u=0;$u<$V.deformSlotDisplayList.length;$u++)$R=$j[($M=$V.deformSlotDisplayList[$u]).slotIndex],$M.apply($O,$R),$S[$M.slotIndex]||($S[$M.slotIndex]={}),$S[$M.slotIndex][$M.attachment]=$M.deformData}},$_.getAnimNum=function(){return this._templet.getAnimationCount()},$_.getAniNameByIndex=function($_){return this._templet.getAniNameByIndex($_)},$_.getSlotByName=function($_){return this._boneSlotDic[$_]},$_.showSkinByName=function($_,$S){void 0===$S&&($S=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($_),$S)},$_.showSkinByIndex=function($_,$S){void 0===$S&&($S=!0);for(var $j=0;$j<this._boneSlotArray.length;$j++)this._boneSlotArray[$j].showSlotData(null,$S);if(this._templet.showSkinByIndex(this._boneSlotDic,$_,$S)){var $O=this._templet.skinDataArray[$_];this._skinIndex=$_,this._skinName=$O.name}this._clearCache()},$_.showSlotSkinByIndex=function($_,$S){if(0!=this._aniMode){var $j=this.getSlotByName($_);$j&&$j.showDisplayByIndex($S),this._clearCache()}},$_.showSlotSkinByName=function($_,$S){if(0!=this._aniMode){var $j=this.getSlotByName($_);$j&&$j.showDisplayByName($S),this._clearCache()}},$_.replaceSlotSkinName=function($_,$S,$j){if(0!=this._aniMode){var $O=this.getSlotByName($_);$O&&$O.replaceDisplayByName($S,$j),this._clearCache()}},$_.replaceSlotSkinByIndex=function($_,$S,$j){if(0!=this._aniMode){var $O=this.getSlotByName($_);$O&&$O.replaceDisplayByIndex($S,$j),this._clearCache()}},$_.setSlotSkin=function($_,$S){if(0!=this._aniMode){var $j=this.getSlotByName($_);$j&&$j.replaceSkin($S),this._clearCache()}},$_._clearCache=function(){if(1==this._aniMode)for(var $_=0,$S=this._graphicsCache.length;$_<$S;$_++){for(var $j=0,$O=this._graphicsCache[$_].length;$j<$O;$j++){var $V=this._graphicsCache[$_][$j];$V!=this.graphics&&$x.recycle($V)}this._graphicsCache[$_].length=0}},$_.play=function($_,$S,$j,$O,$V,$M){void 0===$j&&($j=!0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$M&&($M=!0),this._indexControl=!1;var $R=-1,$w=NaN;if($w=$S?2147483647:0,"string"==typeof $_)for(var $a=0,$u=this._templet.getAnimationCount();$a<$u;$a++){var $c=this._templet.getAnimation($a);if($c&&$_==$c.name){$R=$a;break}}else $R=$_;-1<$R&&$R<this.getAnimNum()&&(this._aniClipIndex=$R,($j||this._pause||this._currAniIndex!=$R)&&(this._currAniIndex=$R,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($R)),this._drawOrder=null,this._eventIndex=0,this._player.play($R,this._player.playbackRate,$w,$O,$V),$M&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$q.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$_.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$_.playbackRate=function($_){this._player&&(this._player.playbackRate=$_)},$_.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$_.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$q.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$_._getGrahicsDataWithCache=function($_,$S){return this._graphicsCache[$_][$S]},$_._setGrahicsDataWithCache=function($_,$S,$j){this._graphicsCache[$_][$S]=$j},$_.destroy=function($_){void 0===$_&&($_=!0),$S.prototype.destroy.call(this,$_),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$M(0,$_,"url",function(){return this._aniPath},function($_){this.load($_)}),$M(0,$_,"index",function(){return this._index},function($_){this.player&&(this._index=$_,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$M(0,$_,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$M(0,$_,"templet",function(){return this._templet}),$M(0,$_,"player",function(){return this._player}),$j.useSimpleMeshInCanvas=!1,$j}($M_),$E=function($S){function $V(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$V.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$O($V,"laya.ani.bone.Templet",$S);var $_=$V.prototype;return $_.getLoadList=function(){return this._loadList},$_.loadAni=function($_){this._skBufferUrl=$_,$V_.loader.load($_,$a.create(this,this.onComplete),null,"arraybuffer")},$_.onComplete=function($_){if(this._isDestroyed)this.destroy();else{var $S=$u.getRes(this._skBufferUrl);$S?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$S)):this.event("error","load failed:"+this._skBufferUrl)}},$_.parseData=function($_,$S,$j){void 0===$j&&($j=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$_,this._mainTexture&&$Z.isWebGL&&$_.bitmap&&($_.bitmap.enableMerageInAtlas=!1),this._rate=$j,this.parse($S)},$_.buildArmature=function($_){return void 0===$_&&($_=0),new $g(this,$_)},$_.parse=function($_){$S.prototype.parse.call(this,$_),this._endLoaded(),this._aniVersion!=$V.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$V.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$_._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $_=0;this._loadList=[];var $S,$j=new $d_(this.getPublicExtData()),$O=0,$V=0,$M=0,$R=$j.getInt32(),$w=$j.readUTFString(),$a=$w.split("\n");for($_=0;$_<$R;$_++)$S=this._path+$a[2*$_],$w=$a[2*$_+1],$j.getFloat32(),$j.getFloat32(),$O=$j.getFloat32(),$V=$j.getFloat32(),$M=$j.getFloat32(),isNaN($M)?0:$M,$M=$j.getFloat32(),isNaN($M)?0:$M,$M=$j.getFloat32(),isNaN($M)?$O:$M,$M=$j.getFloat32(),isNaN($M)?$V:$M,-1==this._loadList.indexOf($S)&&this._loadList.push($S);this.event("inited",this)}},$_._textureComplete=function(){for(var $_,$S,$j=0,$O=this._loadList.length;$j<$O;$j++)$S=this._loadList[$j],$_=this._textureDic[$S]=$u.getRes($S),$Z.isWebGL&&$_&&$_.bitmap&&($_.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$_._parsePublicExtData=function(){var $_=0,$S=0,$j=0,$O=0,$V=0;for($_=0,$V=this.getAnimationCount();$_<$V;$_++)this._graphicsCache.push([]);var $M;$M="Dragon"!=this._aniClassName;var $R,$w,$a=new $d_(this.getPublicExtData()),$u=0,$c=0,$q=0,$s=0,$C=0,$i=0,$v=0,$Z=0,$o=0,$l=$a.getInt32(),$k=$a.readUTFString(),$z=$k.split("\n");for($_=0;$_<$l;$_++){if($R=this._mainTexture,$w=this._path+$z[2*$_],$k=$z[2*$_+1],null==this._mainTexture&&($R=this._textureDic[$w]),!$R)return this.event("error",this),void(this.isParseFail=!0);$u=$a.getFloat32(),$c=$a.getFloat32(),$q=$a.getFloat32(),$s=$a.getFloat32(),$o=$a.getFloat32(),$C=isNaN($o)?0:$o,$o=$a.getFloat32(),$i=isNaN($o)?0:$o,$o=$a.getFloat32(),$v=isNaN($o)?$q:$o,$o=$a.getFloat32(),$Z=isNaN($o)?$s:$o,this.subTextureDic[$k]=$J_.create($R,$u,$c,$q,$s,-$C,-$i,$v,$Z),$R.alphaTexture&&(this.subTextureDic[$k].alphaTexture=$J_.create($R.alphaTexture,$u,$c,$q,$s,-$C,-$i,$v,$Z))}this._mainTexture=$R;var $H,$A,$f,$y,$P,$g=$a.getUint16();for($_=0;$_<$g;$_++)($H=[]).push($a.getUint16()),$H.push($a.getUint16()),$H.push($a.getUint16()),$H.push($a.getUint16()),this.aniSectionDic[$_]=$H;var $E,$$=$a.getInt16(),$d={};for($_=0;$_<$$;$_++)$A=new $F_,0==$_?$E=$A:$A.root=$E,$A.d=$M?-1:1,$y=$a.readUTFString(),$P=$a.readUTFString(),$A.length=$a.getFloat32(),1==$a.getByte()&&($A.inheritRotation=!1),1==$a.getByte()&&($A.inheritScale=!1),$A.name=$y,$P&&(($f=$d[$P])?$f.addChild($A):this.mRootBone=$A),$d[$y]=$A,this.mBoneArr.push($A);this.tMatrixDataLen=$a.getUint16();var $n,$J,$F=$a.getUint16(),$x=Math.floor($F/this.tMatrixDataLen),$h=this.srcBoneMatrixArr;for($_=0;$_<$x;$_++)($n=new $Y_).scX=$a.getFloat32(),$n.skX=$a.getFloat32(),$n.skY=$a.getFloat32(),$n.scY=$a.getFloat32(),$n.x=$a.getFloat32(),$n.y=$a.getFloat32(),8===this.tMatrixDataLen&&($n.skewX=$a.getFloat32(),$n.skewY=$a.getFloat32()),$h.push($n),($A=this.mBoneArr[$_]).transform=$n;var $N,$B=$a.getUint16(),$t=0;for($_=0;$_<$B;$_++){for($J=new $e_,$t=$a.getUint16(),$S=0;$S<$t;$S++)$J.boneNames.push($a.readUTFString()),$J.boneIndexs.push($a.getInt16());$J.name=$a.readUTFString(),$J.targetBoneName=$a.readUTFString(),$J.targetBoneIndex=$a.getInt16(),$J.bendDirection=$a.getFloat32(),$J.mix=$a.getFloat32(),$J.isSpine=$M,this.ikArr.push($J)}var $m,$e=$a.getUint16(),$G=0;for($_=0;$_<$e;$_++){for($N=new $Q_,$G=$a.getUint16(),$S=0;$S<$G;$S++)$N.boneIndexs.push($a.getInt16());$N.name=$a.getUTFString(),$N.targetIndex=$a.getInt16(),$N.rotateMix=$a.getFloat32(),$N.translateMix=$a.getFloat32(),$N.scaleMix=$a.getFloat32(),$N.shearMix=$a.getFloat32(),$N.offsetRotation=$a.getFloat32(),$N.offsetX=$a.getFloat32(),$N.offsetY=$a.getFloat32(),$N.offsetScaleX=$a.getFloat32(),$N.offsetScaleY=$a.getFloat32(),$N.offsetShearY=$a.getFloat32(),this.tfArr.push($N)}var $D=$a.getUint16(),$L=0;for($_=0;$_<$D;$_++){for(($m=new $G_).name=$a.readUTFString(),$L=$a.getUint16(),$S=0;$S<$L;$S++)$m.bones.push($a.getInt16());$m.target=$a.readUTFString(),$m.positionMode=$a.readUTFString(),$m.spacingMode=$a.readUTFString(),$m.rotateMode=$a.readUTFString(),$m.offsetRotation=$a.getFloat32(),$m.position=$a.getFloat32(),$m.spacing=$a.getFloat32(),$m.rotateMix=$a.getFloat32(),$m.translateMix=$a.getFloat32(),this.pathArr.push($m)}var $U,$Q,$Y,$T,$W,$p=0,$I=0,$K=0,$X=NaN,$r=0,$b=$a.getInt16();for($_=0;$_<$b;$_++){var $__=$a.getUint8(),$S_={};this.deformAniArr.push($S_);for(var $j_=0;$j_<$__;$j_++)for(($U=new $h_).skinName=$a.getUTFString(),$S_[$U.skinName]=$U,$p=$a.getInt16(),$S=0;$S<$p;$S++)for($Q=new $N_,$U.deformSlotDataList.push($Q),$I=$a.getInt16(),$j=0;$j<$I;$j++)for($Y=new $B_,$Q.deformSlotDisplayList.push($Y),$Y.slotIndex=$a.getInt16(),$Y.attachment=$a.getUTFString(),$K=$a.getInt16(),$O=0;$O<$K;$O++)for(1==$a.getByte()?$Y.tweenKeyList.push(!0):$Y.tweenKeyList.push(!1),$X=$a.getFloat32(),$Y.timeList.push($X),$T=[],$Y.vectices.push($T),$r=$a.getInt16(),$V=0;$V<$r;$V++)$T.push($a.getFloat32())}var $O_,$V_,$M_=$a.getInt16(),$R_=0,$w_=0;for($_=0;$_<$M_;$_++){for($R_=$a.getInt16(),$W=[],$S=0;$S<$R_;$S++){for(($O_=new $t_).time=$a.getFloat32(),$w_=$a.getInt16(),$j=0;$j<$w_;$j++)$O_.drawOrder.push($a.getInt16());$W.push($O_)}this.drawOrderAniArr.push($W)}var $a_,$u_=$a.getInt16(),$c_=0;for($_=0;$_<$u_;$_++){for($c_=$a.getInt16(),$V_=[],$S=0;$S<$c_;$S++)($a_=new $m_).name=$a.getUTFString(),$a_.intValue=$a.getInt32(),$a_.floatValue=$a.getFloat32(),$a_.stringValue=$a.getUTFString(),$a_.time=$a.getFloat32(),$V_.push($a_);this.eventAniArr.push($V_)}var $q_=$a.getInt16();if(0<$q_)for(this.attachmentNames=[],$_=0;$_<$q_;$_++)this.attachmentNames.push($a.getUTFString());var $s_,$C_,$i_=$a.getInt16();for($_=0;$_<$i_;$_++)($s_=new $x_).name=$a.readUTFString(),$s_.parent=$a.readUTFString(),$s_.attachmentName=$a.readUTFString(),$s_.srcDisplayIndex=$s_.displayIndex=$a.getInt16(),($s_.templet=this).boneSlotDic[$s_.name]=$s_,null==($C_=this.bindBoneBoneSlotDic[$s_.parent])&&(this.bindBoneBoneSlotDic[$s_.parent]=$C_=[]),$C_.push($s_),this.boneSlotArray.push($s_);var $v_,$Z_,$o_,$l_=$a.readUTFString().split("\n"),$k_=0,$z_=$a.getUint8(),$H_=0,$A_=0,$f_=0,$y_=0,$P_=0,$g_=0,$E_=0;for($_=0;$_<$z_;$_++){for(($v_=new $D_).name=$l_[$k_++],$H_=$a.getUint8(),$S=0;$S<$H_;$S++){for(($Z_=new $U_).name=$l_[$k_++],$s_=this.boneSlotDic[$Z_.name],$A_=$a.getUint8(),$j=0;$j<$A_;$j++){if($o_=new $L_,this.skinSlotDisplayDataArr.push($o_),$o_.name=$l_[$k_++],$o_.attachmentName=$l_[$k_++],$o_.transform=new $Y_,$o_.transform.scX=$a.getFloat32(),$o_.transform.skX=$a.getFloat32(),$o_.transform.skY=$a.getFloat32(),$o_.transform.scY=$a.getFloat32(),$o_.transform.x=$a.getFloat32(),$o_.transform.y=$a.getFloat32(),$Z_.displayArr.push($o_),$o_.width=$a.getFloat32(),$o_.height=$a.getFloat32(),$o_.type=$a.getUint8(),$o_.verLen=$a.getUint16(),0<($$=$a.getUint16()))for($o_.bones=[],$O=0;$O<$$;$O++){var $$_=$a.getUint16();$o_.bones.push($$_)}if(0<($f_=$a.getUint16()))for($o_.uvs=[],$O=0;$O<$f_;$O++)$o_.uvs.push($a.getFloat32());if(0<($y_=$a.getUint16()))for($o_.weights=[],$O=0;$O<$y_;$O++)$o_.weights.push($a.getFloat32());if(0<($P_=$a.getUint16()))for($o_.triangles=[],$O=0;$O<$P_;$O++)$o_.triangles.push($a.getUint16());if(0<($g_=$a.getUint16()))for($o_.vertices=[],$O=0;$O<$g_;$O++)$o_.vertices.push($a.getFloat32());if(0<($E_=$a.getUint16()))for($o_.lengths=[],$O=0;$O<$E_;$O++)$o_.lengths.push($a.getFloat32())}$v_.slotArr.push($Z_)}this.skinDic[$v_.name]=$v_,this.skinDataArray.push($v_)}1==$a.getUint8()?(this.yReverseMatrix=new $n_(1,0,0,-1,0,0),$E&&$E.setTempMatrix(this.yReverseMatrix)):$E&&$E.setTempMatrix(new $n_),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$_.getTexture=function($_){var $S=this.subTextureDic[$_];return $S||($S=this.subTextureDic[$_.substr(0,$_.length-1)]),null==$S?this._mainTexture:$S},$_.showSkinByIndex=function($_,$S,$j){if(void 0===$j&&($j=!0),$S<0&&$S>=this.skinDataArray.length)return!1;var $O,$V,$M=0,$R=0,$w=this.skinDataArray[$S];if($w){for($M=0,$R=$w.slotArr.length;$M<$R;$M++)($V=$w.slotArr[$M])&&($O=$_[$V.name])&&($O.showSlotData($V,$j),$j&&"undefined"!=$O.attachmentName&&"null"!=$O.attachmentName?$O.showDisplayByName($O.attachmentName):$O.showDisplayByIndex($O.displayIndex));return!0}return!1},$_.getSkinIndexByName=function($_){for(var $S=0,$j=this.skinDataArray.length;$S<$j;$S++)if(this.skinDataArray[$S].name==$_)return $S;return-1},$_.getGrahicsDataWithCache=function($_,$S){return this._graphicsCache[$_][$S]},$_.setGrahicsDataWithCache=function($_,$S,$j){this._graphicsCache[$_][$S]=$j},$_.destroy=function(){var $_;for(var $S in this._isDestroyed=!0,this.subTextureDic)($_=this.subTextureDic[$S])&&$_.destroy();for($S in this._textureDic)($_=this._textureDic[$S])&&$_.destroy();for(var $j=0,$O=this.skinSlotDisplayDataArr.length;$j<$O;$j++)this.skinSlotDisplayDataArr[$j].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $V.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$_.getAniNameByIndex=function($_){var $S=this.getAnimation($_);return $S?$S.name:null},$M(0,$_,"rate",function(){return this._rate},function($_){this._rate=$_}),$V.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$V.TEMPLET_DICTIONARY=null,$V}($h)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($_,$S){"use strict";for(var $j in Object.defineProperty($S,"__esModule",{value:!0}),Laya){var $O=Laya[$j];$O&&$O.__isclass&&($S[$j]=$O)}});