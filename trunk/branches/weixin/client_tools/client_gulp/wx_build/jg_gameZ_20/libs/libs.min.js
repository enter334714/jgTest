var Laya=window.Laya=function($A,$t){var $q={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($t,$H){return 1==arguments.length?$q.__presubstr.call(this,$t):$q.__presubstr.call(this,$t,0<$H?$H:this.length+$H)},__init:function($t){$t.forEach(function($t){$t.__init$&&$t.__init$()})},__isClass:function($t){return $t&&($t.__isclass||$t==Object||$t==String||$t==Array)},__newvec:function($t,$H){var $I=[];$I.length=$t;for(var $T=0;$T<$t;$T++)$I[$T]=$H;return $I},__extend:function($t,$H){for(var $I in $H)if($H.hasOwnProperty($I)){var $T=Object.getOwnPropertyDescriptor($H,$I),$K=$T.get,$_=$T.set;$K||$_?$K&&$_?Object.defineProperty($t,$I,$T):($K&&Object.defineProperty($t,$I,$K),$_&&Object.defineProperty($t,$I,$_)):$t[$I]=$H[$I]}function $V(){$q.un(this,"constructor",$t)}$V.prototype=$H.prototype,$t.prototype=new $V,$q.un($t.prototype,"__imps",$q.__copy({},$H.prototype.__imps))},__copy:function($t,$H){if(!$H)return null;for(var $I in $t=$t||{},$H)$t[$I]=$H[$I];return $t},__package:function($t,$H){if(!$q.__packages[$t]){$q.__packages[$t]=!0;var $I=$A,$T=$t.split(".");if(1<$T.length)for(var $K=0,$_=$T.length-1;$K<$_;$K++){var $V=$I[$T[$K]];$I=$V||($I[$T[$K]]={})}$I[$T[$T.length-1]]||($I[$T[$T.length-1]]=$H||{})}},__hasOwnProperty:function($t,$H){return $H=$H||this,Object.hasOwnProperty.call($H,$t)||function $t($H,$I){if(Object.hasOwnProperty.call($I.prototype,$H))return!0;var $T=$I.prototype.__super;return null==$T?null:$t($H,$T)}($t,$H.__class)},__typeof:function($t,$H){if(!$t||!$H)return!1;if($H===String)return"string"==typeof $t;if($H===Number)return"number"==typeof $t;if($H.__interface__)$H=$H.__interface__;else if("string"!=typeof $H)return $t instanceof $H;return $t.__imps&&$t.__imps[$H]||$t.__class==$H},__as:function($t,$H){return this.__typeof($t,$H)?$t:null},__int:function($t){return $t?parseInt($t):0},interface:function($t,$H){$q.__package($t,{});var $I=$q.__internals,$T=$I[$t]=$I[$t]||{self:$t};if($H){var $K=$H.split(",");$T.extend=[];for(var $_=0;$_<$K.length;$_++){var $V=$K[$_];$I[$V]=$I[$V]||{self:$V},$T.extend.push($I[$V])}}var $e=$A,$R=$t.split(".");for($_=0;$_<$R.length-1;$_++)$e=$e[$R[$_]];$e[$R[$R.length-1]]={__interface__:$t}},class:function($t,$H,$I,$T){if($I&&$q.__extend($t,$I),$H)if($q.__package($H,$t),$q.__classmap[$H]=$t,0<$H.indexOf(".")){if(0==$H.indexOf("laya.")){var $K=$H.split(".");$T=$T||$K[$K.length-1],$q[$T]&&console.log("Warning!,this class["+$T+"] already exist:",$q[$T]),$q[$T]=$t}}else"Main"==$H?$A.Main=$t:"MainWX"==$H?$A.MainWX=$t:($q[$H]&&console.log("Error!,this class["+$H+"] already exist:",$q[$H]),$q[$H]=$t);var $_=$q.un,$V=$t.prototype;$_($V,"hasOwnProperty",$q.__hasOwnProperty),$_($V,"__class",$t),$_($V,"__super",$I),$_($V,"__className",$H),$_($t,"__super",$I),$_($t,"__className",$H),$_($t,"__isclass",!0),$_($t,"super",function($t){this.__super.call($t)})},imps:function($t,$H){if(!$H)return null;var $K=$t.__imps||$q.un($t,"__imps",{});function $_($t){var $H,$I;if(($H=$q.__internals[$t])&&($K[$t]=!0,$I=$H.extend))for(var $T=0;$T<$I.length;$T++)$_($I[$T].self)}for(var $I in $H)$_($I)},superSet:function($t,$H,$I,$T){var $K=$t.prototype["_$set_"+$I];$K&&$K.call($H,$T)},superGet:function($t,$H,$I){var $T=$t.prototype["_$get_"+$I];return $T?$T.call($H):null},getset:function($t,$H,$I,$T,$K){$t?($T&&($H["_$GET_"+$I]=$T),$K&&($H["_$SET_"+$I]=$K)):($T&&$q.un($H,"_$get_"+$I,$T),$K&&$q.un($H,"_$set_"+$I,$K)),$T&&$K?Object.defineProperty($H,$I,{get:$T,set:$K,enumerable:!1,configurable:!0}):($T&&Object.defineProperty($H,$I,{get:$T,enumerable:!1,configurable:!0}),$K&&Object.defineProperty($H,$I,{set:$K,enumerable:!1,configurable:!0}))},static:function($I,$T){for(var $K=0,$t=$T.length;$K<$t;$K+=2)if("length"==$T[$K])$I.length=$T[$K+1].call($I);else{function $H(){var $H=$T[$K],$t=$T[$K+1];Object.defineProperty($I,$H,{get:function(){return delete this[$H],this[$H]=$t.call(this)},set:function($t){delete this[$H],this[$H]=$t},enumerable:!0,configurable:!0})}$H()}},un:function($t,$H,$I){return $I||($I=$t[$H]),$q.__propun.value=$I,Object.defineProperty($t,$H,$q.__propun),$I},uns:function($H,$t){$t.forEach(function($t){$q.un($H,$t)})}};return $A.console=$A.console||{log:function(){}},$A.trace=$A.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$q}(window,document);!function($t,$H,$I){$I.un,$I.uns,$I.static,$I.class,$I.getset,$I.__newvec}(window,document,Laya),function($V,$H,$W){$W.un,$W.uns;var $R=$W.static,$M=$W.class,$q=$W.getset;$W.__newvec;$W.interface("laya.runtime.IMarket"),$W.interface("laya.filters.IFilter"),$W.interface("laya.display.ILayout"),$W.interface("laya.resource.IDispose"),$W.interface("laya.runtime.IPlatform"),$W.interface("laya.resource.IDestroy"),$W.interface("laya.runtime.IConchNode"),$W.interface("laya.filters.IFilterAction"),$W.interface("laya.runtime.ICPlatformClass"),$W.interface("laya.resource.ICreateResource"),$W.interface("laya.runtime.IConchRenderObject"),$W.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $x=function(){function $_(){}return $M($_,"laya.utils.RunDriver"),$_.FILTER_ACTIONS=[],$_.pixelRatio=-1,$_._charSizeTestDiv=null,$_.now=function(){return Date.now()},$_.getWindow=function(){return $V},$_.getPixelRatio=function(){if($_.pixelRatio<0){var $t=$h.context,$H=$t.backingStorePixelRatio||$t.webkitBackingStorePixelRatio||$t.mozBackingStorePixelRatio||$t.msBackingStorePixelRatio||$t.oBackingStorePixelRatio||$t.backingStorePixelRatio||1;($_.pixelRatio=($h.window.devicePixelRatio||1)/$H)<1&&($_.pixelRatio=1)}return $_.pixelRatio},$_.getIncludeStr=function($t){return null},$_.createShaderCondition=function($t){var $H="(function() {return "+$t+";})";return $W._runScript($H)},$_.fontMap=[],$_.measureText=function($t,$H){var $I=$_.hanzi.test($t);if($I&&$_.fontMap[$H])return $_.fontMap[$H];var $T=$h.context;$T.font=$H;var $K=$T.measureText($t);return $K||($K={width:16,height:16}),$I&&($_.fontMap[$H]=$K),$K},$_.getWebGLContext=function($t){},$_.beginFlush=function(){},$_.endFinish=function(){},$_.addToAtlas=null,$_.flashFlushImage=function($t){},$_.drawToCanvas=function($t,$H,$I,$T,$K,$_){var $V=$Ut.create("2D"),$e=new $l($I,$T,$V);return $v.renders[$H]._fun($t,$e,$K,$_),$V},$_.createParticleTemplate2D=null,$_.createGLTextur=null,$_.createWebGLContext2D=null,$_.changeWebGLSize=function($t,$H){},$_.createRenderSprite=function($t,$H){return new $v($t,$H)},$_.createFilterAction=function($t){return new $U},$_.createGraphics=function(){return new $b},$_.clear=function($t){$g._context.ctx.clear()},$_.cancelLoadByUrl=function($t){},$_.clearAtlas=function($t){},$_.isAtlas=function($t){return!1},$_.addTextureToAtlas=function($t){},$_.getTexturePixels=function($t,$H,$I,$T,$K){return null},$_.skinAniSprite=function(){return null},$_.update3DLoop=function(){},$R($_,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$_}(),$T=($q(1,$W,"alertGlobalError",null,function($t){var $_=0;$h.window.onerror=$t?function($t,$H,$I,$T,$K){$_++<5&&$K&&alert($K.stack||$K)}:null}),$W.init=function($t,$H,$I){for(var $T=[],$K=2,$_=arguments.length;$K<$_;$K++)$T.push(arguments[$K]);if(!$W._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$W._arrayBufferSlice),$W._isinit=!0,$h.__init__(),$y.__init__(),$b.__init__(),$W.timer=new $F,$W.scaleTimer=new $F,$W.loader=new $Rt,$d.__init__(),$K=0;for(var $V=$T.length;$K<$V;$K++)$T[$K].enable&&$T[$K].enable();return $L.__init__(),$e.__init__(),$E.__init__(),$B.beginCheck(),$W._currentStage=$W.stage=new $Jt,$W.stage.conchModel&&$W.stage.conchModel.setRootNode(),$W._getUrlPath(),$W.render=new $g(0,0),$W.stage.size($t,$H),$v.__init__(),$f.__init__(),$G.instance.__init__($W.stage,$g.canvas),$Nt.__init__(),$r.autoStopMusic=!0,$P.__init__(),$g.canvas}},$W._getUrlPath=function(){var $t=$h.window.location,$H=$t.pathname;$H=$H&&":"==$H.charAt(2)?$H.substring(1):$H,$p.rootPath=$p.basePath=$p.getPath("file:"==$t.protocol?$H:$t.protocol+"//"+$t.host+$t.pathname)},$W._arrayBufferSlice=function($t,$H){var $I=new Uint8Array(this,$t,$H-$t),$T=new Uint8Array($I.length);return $T.set($I),$T.buffer},$W._runScript=function($t){return $h.window[$W._evcode]($t)},$W.stage=null,$W.timer=null,$W.scaleTimer=null,$W.loader=null,$W.version="1.8.6",$W.render=null,$W._currentStage=null,$W._isinit=!1,$W.isDebug=!1,$W.MiniAdpter={init:function(){$V.navigator&&$V.navigator.userAgent&&-1<$V.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$R($W,["conchMarket",function(){return this.conchMarket=$V.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$V.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $t(){}return $M($t,"Config"),$t.WebGLTextCacheCount=500,$t.atlasEnable=!1,$t.showCanvasMark=!1,$t.animationInterval=50,$t.isAntialias=!1,$t.isAlpha=!1,$t.premultipliedAlpha=!0,$t.isStencil=!0,$t.preserveDrawingBuffer=!1,$t}()),$A=function(){function $A(){this._events=null}$M($A,"laya.events.EventDispatcher");var $t=$A.prototype;return $t.hasListener=function($t){return!!(this._events&&this._events[$t])},$t.getListener=function($t){return this._events?this._events[$t]:null},$t.event=function($t,$H){if(!this._events||!this._events[$t])return!1;var $I=this._events[$t];if($I.lock)$I.queue||($I.queue=[]),$I.queue.push($H);else{var $T;for($I.lock=!0,$I.cursor=$I.head;$I.cursor;)($T=$I.cursor).recover?($I.head=$I.tail=$I.cursor=null,console.error("node is recover："+$T.id)):($I.cursor=$T.next,$T.once&&$A.delNode($I,$T),$T.method&&(null!=$H?$T.args?$T.method.apply($T.caller,$T.args.concat($H)):$H instanceof Array?$T.method.apply($T.caller,$H):$T.caller?$T.method.call($T.caller,$H):$W.recordError("事件派发错误","node.caller:"+$T.caller+"node.method:"+$T.method+"data:"+$H+"node.prev"+$T.prev):$T.method.apply($T.caller,$T.args)),$T.once&&$A.recoverHandler($T));$I.lock=!1,!$I.head&&this._events&&this._events[$t]==$I&&delete this._events[$t],$I.queue&&$I.queue.length&&this.event($t,$I.queue.shift())}return!0},$t.on=function($t,$H,$I,$T){return this._createListener($t,$H,$I,$T,!1)},$t.once=function($t,$H,$I,$T){return this._createListener($t,$H,$I,$T,!0)},$t._createListener=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=!0),$_&&this.off($t,$H,$I,$K);var $V=$A.createHandler($H||this,$I,$T,$K);this._events||(this._events={});var $e=this._events,$R=$e[$t];return $R?$R.tail?($V.prev=$R.tail,$R.tail.next=$V,$R.tail=$V):$R.head=$R.tail=$V:$e[$t]={head:$V,tail:$V,cursor:null,lock:!1},this},$t.off=function($t,$H,$I,$T){if(void 0===$T&&($T=!1),!this._events||!this._events[$t])return this;for(var $K=this._events[$t],$_=$K.head;$_;){if((!$H||$_.caller===$H)&&$_.method===$I&&(!$T||$_.once)){$A.delNode($K,$_),$K.cursor==$_&&($K.cursor=$_.next),$A.recoverHandler($_);break}$_=$_.next}return this},$t.offAll=function($t){var $H=this._events;if(!$H)return this;if($t)this._recoverHandlers($H[$t]),delete $H[$t];else{for(var $I in $H)this._recoverHandlers($H[$I]);this._events=null}return this},$t._recoverHandlers=function($t){if($t){for(var $H=$t.head;$H;){$A.delNode($t,$H);var $I=$H.next;$A.recoverHandler($H),$H=$I}$t.cursor=null}},$t.isMouseEvent=function($t){return $A.MOUSE_EVENTS[$t]},$A.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$A.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$A.delNode=function($t,$H){$H.prev?$H.prev.next=$H.next:$t.head=$H.next,$H.next?$H.next.prev=$H.prev:$t.tail=$H.prev},$A.createHandler=function($t,$H,$I,$T){var $K=500<$A._freeHandler.length?$A._freeHandler.shift():null;if($K)if($K.recover)$K.recover=!1,$K.caller=$t,$K.method=$H,$K.args=$I,$K.once=$T;else{var $_="";try{arguments.propertyIsEnumerable.caller}catch($t){$_=$t.stack}var $V=$K.caller?($K.caller.__proto__&&$K.caller.__proto__.constructor&&$K.caller.__proto__.constructor.name)+"|"+$K.caller.__className+"|"+$K.caller.name:"",$e=$K.method?$K.method.name:"";$W.recordError("EventDispatcher重复创建","caller="+$V+"  method="+$e+"  stack="+$_),$K={id:++$A._nodeCount,caller:$t,method:$H,args:$I,once:$T,recover:!1}}else $K={id:++$A._nodeCount,caller:$t,method:$H,args:$I,once:$T,recover:!1};return $K.prev=$K.next=null,$K},$A.recoverHandler=function($t){if($t.recover){if($A._errorCount<5){$A._errorCount++;var $H="";try{arguments.propertyIsEnumerable.caller}catch($t){$H=$t.stack}var $I=$t.caller?($t.caller.__proto__&&$t.caller.__proto__.constructor&&$t.caller.__proto__.constructor.name)+"|"+$t.caller.__className+"|"+$t.caller.name:"",$T=$t.method?$t.method.name:"";$W.recordError("EventDispatcher重复回收","id="+$t.id+"  caller="+$I+"  method="+$T+"  stack="+$H)}$t.caller=$t.method=$t.args=$t.prev=null}else $t.recover=!0,$t.caller=$t.method=$t.args=$t.prev=$t.next=null,$A._freeHandler&&$A._freeHandler.length<3e3&&$A._freeHandler.push($t)},$A._freeHandler=[],$A._nodeCount=0,$A._errorCount=0,$A}(),$S=function(){function $K($t,$H,$I,$T){this.once=!1,void(this._id=0)===$T&&($T=!1),this.setTo($t,$H,$I,$T)}$M($K,"laya.utils.Handler");var $t=$K.prototype;return $t.setTo=function($t,$H,$I,$T){return this._id=$K._gid++,this.caller=$t,this.method=$H,this.args=$I,this.once=$T,this},$t.run=function(){if(null==this.method)return null;var $t=this._id,$H=this.method.apply(this.caller,this.args);return this._id===$t&&this.once&&this.recover(),$H},$t.runWith=function($t){if(null==this.method)return null;var $H=this._id;if(null==$t)var $I=this.method.apply(this.caller,this.args);else $I=this.args||$t.unshift?this.args?this.method.apply(this.caller,this.args.concat($t)):this.method.apply(this.caller,$t):this.method.call(this.caller,$t);return this._id===$H&&this.once&&this.recover(),$I},$t.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$t.recover=function(){0<this._id&&(this._id=0,this.clear())},$K.create=function($t,$H,$I,$T){return void 0===$T&&($T=!0),new $K($t,$H,$I,$T)},$K._gid=1,$K}(),$k=function(){function $t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$M($t,"laya.display.BitmapFont");var $H=$t.prototype;return $H.loadFont=function($t,$H){this._path=$t,this._complete=$H,$W.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$S.create(this,this.onLoaded))},$H.onLoaded=function(){this.parseFont($et.getRes(this._path),$et.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$H.parseFont=function($t,$H){if(null!=$t&&null!=$H){this._texture=$H;var $I=$t.getElementsByTagName("info");if(!$I[0].getAttributeNode)return this.parseFont2($t,$H);this.fontSize=parseInt($I[0].getAttributeNode("size").nodeValue);var $T,$K=$I[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($K[0]),parseInt($K[1]),parseInt($K[2]),parseInt($K[3])],$T=$t.getElementsByTagName("char");var $_=0;for($_=0;$_<$T.length;$_++){var $V=$T[$_],$e=parseInt($V.getAttributeNode("id").nodeValue),$R=parseInt($V.getAttributeNode("xoffset").nodeValue)/1,$A=parseInt($V.getAttributeNode("yoffset").nodeValue)/1,$q=parseInt($V.getAttributeNode("xadvance").nodeValue)/1,$f=new $z;$f.x=parseInt($V.getAttributeNode("x").nodeValue),$f.y=parseInt($V.getAttributeNode("y").nodeValue),$f.width=parseInt($V.getAttributeNode("width").nodeValue),$f.height=parseInt($V.getAttributeNode("height").nodeValue);var $b=$qt.create($H,$f.x,$f.y,$f.width,$f.height,$R,$A);this._maxWidth=Math.max(this._maxWidth,$q+this.letterSpacing),this._fontCharDic[$e]=$b,this._fontWidthMap[$e]=$q}}},$H.parseFont2=function($t,$H){if(null!=$t&&null!=$H){this._texture=$H;var $I=$t.getElementsByTagName("info");this.fontSize=parseInt($I[0].attributes.size.nodeValue);var $T=$I[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($T[0]),parseInt($T[1]),parseInt($T[2]),parseInt($T[3])];var $K=$t.getElementsByTagName("char"),$_=0;for($_=0;$_<$K.length;$_++){var $V=$K[$_].attributes,$e=parseInt($V.id.nodeValue),$R=parseInt($V.xoffset.nodeValue)/1,$A=parseInt($V.yoffset.nodeValue)/1,$q=parseInt($V.xadvance.nodeValue)/1,$f=new $z;$f.x=parseInt($V.x.nodeValue),$f.y=parseInt($V.y.nodeValue),$f.width=parseInt($V.width.nodeValue),$f.height=parseInt($V.height.nodeValue);var $b=$qt.create($H,$f.x,$f.y,$f.width,$f.height,$R,$A);this._maxWidth=Math.max(this._maxWidth,$q+this.letterSpacing),this._fontCharDic[$e]=$b,this._fontWidthMap[$e]=$q}}},$H.getCharTexture=function($t){return this._fontCharDic[$t.charCodeAt(0)]},$H.destroy=function(){if(this._texture){for(var $t in this._fontCharDic){var $H=this._fontCharDic[$t];$H&&$H.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$H.setSpaceWidth=function($t){this._spaceWidth=$t},$H.getCharWidth=function($t){var $H=$t.charCodeAt(0);return this._fontWidthMap[$H]?this._fontWidthMap[$H]+this.letterSpacing:" "==$t?this._spaceWidth+this.letterSpacing:0},$H.getTextWidth=function($t){for(var $H=0,$I=0,$T=$t.length;$I<$T;$I++)$H+=this.getCharWidth($t.charAt($I));return $H},$H.getMaxWidth=function(){return this._maxWidth},$H.getMaxHeight=function(){return this.fontSize},$H.drawText=function($t,$H,$I,$T,$K,$_){var $V,$e=this.getTextWidth($t),$R=0;"center"===$K&&($R=($_-$e)/2),"right"===$K&&($R=$_-$e);for(var $A=0,$q=0,$f=$t.length;$q<$f;$q++)($V=this.getCharTexture($t.charAt($q)))&&($H.graphics.drawTexture($V,$I+$A+$R,$T),$A+=this.getCharWidth($t.charAt($q)))},$t}(),$e=function(){function $I(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$I._TF_EMPTY}$M($I,"laya.display.css.Style");var $t=$I.prototype;return $t.getTransform=function(){return this._tf},$t.setTransform=function($t){this._tf="none"!==$t&&$t?$t:$I._TF_EMPTY},$t.setTranslateX=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.translateX=$t},$t.setTranslateY=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.translateY=$t},$t.setScaleX=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.scaleX=$t},$t.setScale=function($t,$H){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.scaleX=$t,this._tf.scaleY=$H},$t.setScaleY=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.scaleY=$t},$t.setRotate=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.rotate=$t},$t.setSkewX=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.skewX=$t},$t.setSkewY=function($t){this._tf===$I._TF_EMPTY&&(this._tf=new $K),this._tf.skewY=$t},$t.destroy=function(){this.scrollRect=null},$t.render=function($t,$H,$I,$T){},$t.getCSSStyle=function(){return $Ht.EMPTY},$t._enableLayout=function(){return!1},$q(0,$t,"scaleX",function(){return this._tf.scaleX},function($t){this.setScaleX($t)}),$q(0,$t,"transform",function(){return this.getTransform()},function($t){this.setTransform($t)}),$q(0,$t,"translateX",function(){return this._tf.translateX},function($t){this.setTranslateX($t)}),$q(0,$t,"translateY",function(){return this._tf.translateY},function($t){this.setTranslateY($t)}),$q(0,$t,"scaleY",function(){return this._tf.scaleY},function($t){this.setScaleY($t)}),$q(0,$t,"block",function(){return 0!=(1&this._type)}),$q(0,$t,"skewY",function(){return this._tf.skewY},function($t){this.setSkewY($t)}),$q(0,$t,"rotate",function(){return this._tf.rotate},function($t){this.setRotate($t)}),$q(0,$t,"skewX",function(){return this._tf.skewX},function($t){this.setSkewX($t)}),$q(0,$t,"paddingLeft",function(){return 0}),$q(0,$t,"paddingTop",function(){return 0}),$q(0,$t,"absolute",function(){return!0}),$I.__init__=function(){$I._TF_EMPTY=new $K,$I.EMPTY=new $I},$I.EMPTY=null,$I._TF_EMPTY=null,$I}(),$L=function(){function $H($t){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$u.create($H.defaultColor),this.family=$H.defaultFamily,this.stroke=$H._STROKE,this.size=$H.defaultSize,$t&&$t!==$H.EMPTY&&$t.copyTo(this)}$M($H,"laya.display.css.Font");var $t=$H.prototype;return $t.set=function($t){this._text=null;for(var $H=$t.split(" "),$I=0,$T=$H.length;$I<$T;$I++){var $K=$H[$I];switch($K){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$K.indexOf("px")&&(this.size=parseInt($K),this.family=$H[$I+1],$I++)}},$t.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$t.copyTo=function($t){$t._type=this._type,$t._text=this._text,$t._weight=this._weight,$t._color=this._color,$t.family=this.family,$t.stroke=this.stroke!=$H._STROKE?this.stroke.slice():$H._STROKE,$t.indent=this.indent,$t.size=this.size},$q(0,$t,"password",function(){return 0!=(1024&this._type)},function($t){$t?this._type|=1024:this._type&=-1025}),$q(0,$t,"color",function(){return this._color.strColor},function($t){this._color=$u.create($t)}),$q(0,$t,"italic",function(){return 0!=(512&this._type)},function($t){$t?this._type|=512:this._type&=-513}),$q(0,$t,"bold",function(){return 0!=(2048&this._type)},function($t){$t?this._type|=2048:this._type&=-2049}),$q(0,$t,"weight",function(){return""+this._weight},function($t){var $H=0;switch($t){case"normal":break;case"bold":this.bold=!0,$H=700;break;case"bolder":$H=800;break;case"lighter":$H=100;break;default:$H=parseInt($t)}this._weight=$H,this._text=null}),$q(0,$t,"decoration",function(){return this._decoration?this._decoration.value:null},function($t){var $H=$t.split(" ");switch(this._decoration||(this._decoration={}),$H[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$H[0]}$H[1]&&(this._decoration.color=$u.create($H)),this._decoration.value=$t}),$H.__init__=function(){$H.EMPTY=new $H(null)},$H.EMPTY=null,$H.defaultColor="#000000",$H.defaultSize=12,$H.defaultFamily="Arial",$H.defaultFont="12px Arial",$H._STROKE=[0,"#000000"],$H._ITALIC=512,$H._PASSWORD=1024,$H._BOLD=2048,$H}(),$K=function(){function $t(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $M($t,"laya.display.css.TransformInfo"),$t}(),$b=function(){function $f(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$g.isConchNode){this._nativeObj=new $V._conchGraphics,this.id=this._nativeObj.conchID}}$M($f,"laya.display.Graphics");var $t=$f.prototype;return $t.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$t.clear=function($t){void 0===$t&&($t=!1);var $H=0,$I=0;if($t){var $T=this._one;if(this._cmds){for($I=this._cmds.length,$H=0;$H<$I;$H++)!($T=this._cmds[$H])||$T.callee!==$g._context._drawTexture&&$T.callee!==$g._context._drawTextureWithTransform||($T[0]=null,$f._cache.push($T));this._cmds.length=0}else $T&&(!$T||$T.callee!==$g._context._drawTexture&&$T.callee!==$g._context._drawTextureWithTransform||($T[0]=null,$f._cache.push($T)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($H=0,$I=this._vectorgraphArray.length;$H<$I;$H++)$j.getInstance().deleteShape(this._vectorgraphArray[$H]);this._vectorgraphArray.length=0}},$t._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$t._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $I,this._graphicBounds._graphics=this)},$t._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$t._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$t.getBounds=function($t){return void 0===$t&&($t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($t)},$t.getBoundPoints=function($t){return void 0===$t&&($t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($t)},$t._addCmd=function($t){this._cmds=this._cmds||[],$t.callee=$t.shift(),this._cmds.push($t)},$t.setFilters=function($t){this._saveToCmd($g._context._setFilters,$t)},$t.drawTexture=function($t,$H,$I,$T,$K,$_,$V){if(void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$V&&($V=1),!$t||$V<.01)return null;$T||($T=$t.sourceWidth),$K||($K=$t.sourceHeight),$V=$V<0?0:1<$V?1:$V;var $e,$R=!$g.isWebGL&&($h.onFirefox||$h.onEdge||$h.onIE||$h.onSafari)?.5:0,$A=$T/$t.sourceWidth,$q=$K/$t.sourceHeight;return $T=$t.width*$A,$K=$t.height*$q,$t.loaded&&($T<=0||$K<=0)?null:($H+=$t.offsetX*$A,$I+=$t.offsetY*$q,this._sp&&(this._sp._renderType|=512),$H-=$R,$I-=$R,$T+=2*$R,$K+=2*$R,$f._cache.length?(($e=$f._cache.pop())[0]=$t,$e[1]=$H,$e[2]=$I,$e[3]=$T,$e[4]=$K,$e[5]=$_,$e[6]=$V):$e=[$t,$H,$I,$T,$K,$_,$V],$e.callee=$_||1!=$V?$g._context._drawTextureWithTransform:$g._context._drawTexture,null!=this._one||$_||1!=$V?this._saveToCmd($e.callee,$e):(this._one=$e,this._render=this._renderOneImg),$t.loaded||$t.once("loaded",this,this._textureLoaded,[$t,$e]),this._repaint(),$e)},$t.cleanByTexture=function($t,$H,$I,$T,$K){if(void 0===$T&&($T=0),void 0===$K&&($K=0),!$t)return this.clear();if(this._one&&this._render===this._renderOneImg){$T||($T=$t.sourceWidth),$K||($K=$t.sourceHeight);var $_=$T/$t.sourceWidth,$V=$K/$t.sourceHeight;$T=$t.width*$_,$K=$t.height*$V,$H+=$t.offsetX*$_,$I+=$t.offsetY*$V,this._one[0]=$t,this._one[1]=$H,this._one[2]=$I,this._one[3]=$T,this._one[4]=$K,this._repaint()}else this.clear(),$t&&this.drawTexture($t,$H,$I,$T,$K)},$t.drawTextures=function($t,$H){$t&&this._saveToCmd($g._context._drawTextures,[$t,$H])},$t.fillTexture=function($t,$H,$I,$T,$K,$_,$V){if(void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$_&&($_="repeat"),$t){var $e=[$t,$H,$I,$T,$K,$_,$V||$s.EMPTY,{}];$t.loaded||$t.once("loaded",this,this._textureLoaded,[$t,$e]),this._saveToCmd($g._context._fillTexture,$e)}},$t._textureLoaded=function($t,$H){$H[3]=$H[3]||$t.width,$H[4]=$H[4]||$t.height,this._repaint()},$t.fillCircle=function($t,$H,$I,$T,$K,$_,$V){$I.bitmap.enableMerageInAtlas=!1;var $e=new Float32Array(2*($V+1)),$R=new Float32Array(2*($V+1)),$A=new Uint16Array(3*$V),$q=2*Math.PI/$V,$f=0;$e[0]=$T,$e[1]=$K,$R[0]=$T/$I.width,$R[1]=$K/$I.height;for(var $b=2,$L=0;$L<$V;$L++){var $G=$_*Math.cos($f)+$T,$M=$_*Math.sin($f)+$K;$e[$b]=$G,$e[$b+1]=$M,$R[$b]=$G/$I.width,$R[$b+1]=$M/$I.height,$f+=$q,$b+=2}for($L=$b=0;$L<$V;$L++)$A[$b++]=0,$A[$b++]=$L+1,$A[$b++]=$V+1<=$L+2?1:$L+2;this.drawTriangles($I,$t,$H,$e,$R,$A)},$t.drawTriangles=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){void 0===$e&&($e=1),this._saveToCmd($g._context.drawTriangles,[$t,$H,$I,$T,$K,$_,$V,$e,$R,$A])},$t._saveToCmd=function($t,$H){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$H,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($H)),$H.callee=$t,this._repaint(),$H},$t.clipRect=function($t,$H,$I,$T){this._saveToCmd($g._context._clipRect,[$t,$H,$I,$T])},$t.fillText=function($t,$H,$I,$T,$K,$_,$V){void 0===$V&&($V=0),this._saveToCmd($g._context._fillText,[$t,$H,$I,$T||$L.defaultFont,$K,$_])},$t.fillBorderText=function($t,$H,$I,$T,$K,$_,$V,$e){this._saveToCmd($g._context._fillBorderText,[$t,$H,$I,$T||$L.defaultFont,$K,$_,$V,$e])},$t.strokeText=function($t,$H,$I,$T,$K,$_,$V){this._saveToCmd($g._context._strokeText,[$t,$H,$I,$T||$L.defaultFont,$K,$_,$V])},$t.alpha=function($t){$t=$t<0?0:1<$t?1:$t,this._saveToCmd($g._context._alpha,[$t])},$t.setAlpha=function($t){$t=$t<0?0:1<$t?1:$t,this._saveToCmd($g._context._setAlpha,[$t])},$t.transform=function($t,$H,$I){void 0===$H&&($H=0),void 0===$I&&($I=0),this._saveToCmd($g._context._transform,[$t,$H,$I])},$t.rotate=function($t,$H,$I){void 0===$H&&($H=0),void 0===$I&&($I=0),this._saveToCmd($g._context._rotate,[$t,$H,$I])},$t.scale=function($t,$H,$I,$T){void 0===$I&&($I=0),void 0===$T&&($T=0),this._saveToCmd($g._context._scale,[$t,$H,$I,$T])},$t.translate=function($t,$H){this._saveToCmd($g._context._translate,[$t,$H])},$t.save=function(){this._saveToCmd($g._context._save,[])},$t.restore=function(){this._saveToCmd($g._context._restore,[])},$t.replaceText=function($t){this._repaint();var $H=this._cmds;if($H){for(var $I=$H.length-1;-1<$I;$I--)if(this._isTextCmd($H[$I].callee))return $H[$I][0].toUpperCase?$H[$I][0]=$t:$H[$I][0].setText($t),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$t:this._one[0].setText($t),!0;return!1},$t._isTextCmd=function($t){return $t===$g._context._fillText||$t===$g._context._fillBorderText||$t===$g._context._strokeText},$t.replaceTextColor=function($t){this._repaint();var $H=this._cmds;if($H)for(var $I=$H.length-1;-1<$I;$I--)this._isTextCmd($H[$I].callee)&&($H[$I][4]=$t,$H[$I][0].toUpperCase||($H[$I][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$t,this._one[0].toUpperCase||(this._one[0].changed=!0))},$t.loadImage=function($t,$H,$I,$T,$K,$_){var $V=this;void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0),void 0===$K&&($K=0);var $e=$et.getRes($t);function $R($t){$t&&($V.drawTexture($t,$H,$I,$T,$K),null!=$_&&$_.call($V._sp,$t))}$e?$R($e):$W.loader.load($t,$S.create(null,$R),null,"image")},$t._renderEmpty=function($t,$H,$I,$T){},$t._renderAll=function($t,$H,$I,$T){for(var $K,$_=this._cmds,$V=0,$e=$_.length;$V<$e;$V++)($K=$_[$V]).callee.call($H,$I,$T,$K)},$t._renderOne=function($t,$H,$I,$T){this._one.callee.call($H,$I,$T,this._one)},$t._renderOneImg=function($t,$H,$I,$T){this._one.callee.call($H,$I,$T,this._one),2305!==$t._renderType&&($t._renderType|=1)},$t.drawLine=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=1);var $V=0;$g.isWebGL&&($V=$j.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($V));var $e=$_%2==0?0:.5,$R=[$t+$e,$H+$e,$I+$e,$T+$e,$K,$_,$V];this._saveToCmd($g._context._drawLine,$R)},$t.drawLines=function($t,$H,$I,$T,$K){void 0===$K&&($K=1);var $_=0;if($I&&!($I.length<4)){$g.isWebGL&&($_=$j.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($_));var $V=$K%2==0?0:.5,$e=[$t+$V,$H+$V,$I,$T,$K,$_];this._saveToCmd($g._context._drawLines,$e)}},$t.drawCurves=function($t,$H,$I,$T,$K){void 0===$K&&($K=1);var $_=[$t,$H,$I,$T,$K];this._saveToCmd($g._context._drawCurves,$_)},$t.drawRect=function($t,$H,$I,$T,$K,$_,$V){void 0===$V&&($V=1);var $e=$_?$V/2:0,$R=$_?$V:0,$A=[$t+$e,$H+$e,$I-$R,$T-$R,$K,$_,$V];this._saveToCmd($g._context._drawRect,$A)},$t.drawCircle=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=1);var $V=$K?$_/2:0,$e=0;$g.isWebGL&&($e=$j.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($e));var $R=[$t,$H,$I-$V,$T,$K,$_,$e];this._saveToCmd($g._context._drawCircle,$R)},$t.drawPie=function($t,$H,$I,$T,$K,$_,$V,$e){void 0===$e&&($e=1);var $R=$V?$e/2:0,$A=$V?$e:0,$q=0;$g.isWebGL&&($q=$j.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($q));var $f=[$t+$R,$H+$R,$I-$A,$T,$K,$_,$V,$e,$q];$f[3]=$i.toRadian($T),$f[4]=$i.toRadian($K),this._saveToCmd($g._context._drawPie,$f)},$t.drawPoly=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=1);var $V=0,$e=!1;$g.isWebGL&&($V=$j.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($V),$e=!(6<$I.length));var $R=$K?$_%2==0?0:.5:0,$A=[$t+$R,$H+$R,$I,$T,$K,$_,$V,$e];this._saveToCmd($g._context._drawPoly,$A)},$t.drawPath=function($t,$H,$I,$T,$K){var $_=[$t,$H,$I,$T,$K];this._saveToCmd($g._context._drawPath,$_)},$q(0,$t,"cmds",function(){return this._cmds},function($t){this._sp&&(this._sp._renderType|=512),this._cmds=$t,this._render=this._renderAll,this._repaint()}),$f.__init__=function(){if($g.isConchNode){for(var $t=laya.display.Graphics.prototype,$H=$h.window.ConchGraphics.prototype,$I=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$T=0,$K=$I.length;$T<=$K;$T++){var $_=$I[$T];$t[$_]=$H[$_]}$t._saveToCmd=null,$H.drawImageS&&($t.drawTextures=function($t,$H){if($t&&$t.loaded&&$t.bitmap&&$t.source){var $I=$t.uv,$T=$t.bitmap.width,$K=$t.bitmap.height;this.drawImageS($t.bitmap.source,$I[0]*$T,$I[1]*$K,($I[2]-$I[0])*$T,($I[5]-$I[3])*$K,$t.offsetX,$t.offsetY,$t.width,$t.height,$H)}}),$t.drawTexture=function($t,$H,$I,$T,$K,$_,$V){if(void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$V&&($V=1),$t)if($t.loaded){if($t.loaded&&$t.bitmap&&$t.source&&($T||($T=$t.sourceWidth),$K||($K=$t.sourceHeight),$V=$V<0?0:1<$V?1:$V,$T=$T-$t.sourceWidth+$t.width,$K=$K-$t.sourceHeight+$t.height,!($T<=0||$K<=0))){$H+=$t.offsetX,$I+=$t.offsetY;var $e=$t.uv,$R=$t.bitmap.width,$A=$t.bitmap.height;$e[4]<$e[0]&&$e[5]<$e[1]?this.drawImageM($t.bitmap.source,$e[4]*$R,$e[5]*$A,($e[0]-$e[4])*$R,($e[1]-$e[5])*$A,$H,$I,$T,$K,$_,$V):this.drawImageM($t.bitmap.source,$e[0]*$R,$e[1]*$A,($e[2]-$e[0])*$R,($e[5]-$e[3])*$A,$H,$I,$T,$K,$_,$V),this._repaint()}}else $t.once("loaded",this,function(){this.drawTexture($t,$H,$I,$T,$K,$_)})},$t.fillTexture=function($t,$H,$I,$T,$K,$_,$V){if(void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$_&&($_="repeat"),$t&&$t.loaded){var $e,$R=$g._context.ctx,$A=$t.bitmap.width,$q=$t.bitmap.height,$f=$t.uv;$e=$t.uv!=$qt.DEF_UV?$R.createPattern($t.bitmap.source,$_,$f[0]*$A,$f[1]*$q,($f[2]-$f[0])*$A,($f[5]-$f[3])*$q):$R.createPattern($t.bitmap.source,$_);var $b=0,$L=0;$V&&($H+=$V.x%$t.width,$I+=$V.y%$t.height,$b-=$V.x%$t.width,$L-=$V.y%$t.height),this._fillImage($e,$H,$I,$b,$L,$T,$K)}}}},$f._cache=[],$f}(),$I=function(){function $U(){this._cacheBoundsType=!1}$M($U,"laya.display.GraphicsBounds");var $t=$U.prototype;return $t.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$t.reset=function(){this._temp&&(this._temp.length=0)},$t.getBounds=function($t){return void 0===$t&&($t=!1),(!this._bounds||!this._temp||this._temp.length<1||$t!=this._cacheBoundsType)&&(this._bounds=$z._getWrapRec(this.getBoundPoints($t),this._bounds)),this._cacheBoundsType=$t,this._bounds},$t.getBoundPoints=function($t){return void 0===$t&&($t=!1),(!this._temp||this._temp.length<1||$t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($t)),this._cacheBoundsType=$t,this._rstBoundPoints=$i.copyArray(this._rstBoundPoints,this._temp)},$t._getCmdPoints=function($t){void 0===$t&&($t=!1);var $H,$I,$T=$g._context,$K=this._graphics.cmds;if(($H=this._temp||(this._temp=[])).length=0,$K||null==this._graphics._one||($U._tempCmds.length=0,$U._tempCmds.push(this._graphics._one),$K=$U._tempCmds),!$K)return $H;($I=$U._tempMatrixArrays).length=0;var $_=$U._initMatrix;$_.identity();for(var $V,$e,$R=$U._tempMatrix,$A=NaN,$q=NaN,$f=NaN,$b=NaN,$L=NaN,$G=NaN,$M=0,$O=$K.length;$M<$O;$M++)if(($V=$K[$M]).callee)switch($V.callee){case $T._save:case 7:$I.push($_),$_=$_.clone();break;case $T._restore:case 8:$_=$I.pop();break;case $T._scale:case 5:$R.identity(),$R.translate(-$V[2],-$V[3]),$R.scale($V[0],$V[1]),$R.translate($V[2],$V[3]),this._switchMatrix($_,$R);break;case $T._rotate:case 3:$R.identity(),$R.translate(-$V[1],-$V[2]),$R.rotate($V[0]),$R.translate($V[1],$V[2]),this._switchMatrix($_,$R);break;case $T._translate:case 6:$R.identity(),$R.translate($V[0],$V[1]),this._switchMatrix($_,$R);break;case $T._transform:case 4:$R.identity(),$R.translate(-$V[1],-$V[2]),$R.concat($V[0]),$R.translate($V[1],$V[2]),this._switchMatrix($_,$R);break;case 16:case 24:$U._addPointArrToRst($H,$z._getBoundPointS($V[0],$V[1],$V[2],$V[3]),$_);break;case 17:$_.copyTo($R),$R.concat($V[4]),$U._addPointArrToRst($H,$z._getBoundPointS($V[0],$V[1],$V[2],$V[3]),$R);break;case $T._drawTexture:$e=$V[0],$t?$V[3]&&$V[4]?$U._addPointArrToRst($H,$z._getBoundPointS($V[1],$V[2],$V[3],$V[4]),$_):($e=$V[0],$U._addPointArrToRst($H,$z._getBoundPointS($V[1],$V[2],$e.width,$e.height),$_)):($A=($V[3]||$e.sourceWidth)/$e.width,$q=($V[4]||$e.sourceHeight)/$e.height,$f=$A*$e.sourceWidth,$b=$q*$e.sourceHeight,$L=0<$e.offsetX?$e.offsetX:0,$G=0<$e.offsetY?$e.offsetY:0,$L*=$A,$G*=$q,$U._addPointArrToRst($H,$z._getBoundPointS($V[1]-$L,$V[2]-$G,$f,$b),$_));break;case $T._fillTexture:$V[3]&&$V[4]?$U._addPointArrToRst($H,$z._getBoundPointS($V[1],$V[2],$V[3],$V[4]),$_):($e=$V[0],$U._addPointArrToRst($H,$z._getBoundPointS($V[1],$V[2],$e.width,$e.height),$_));break;case $T._drawTextureWithTransform:var $J;$J=$V[5]?($_.copyTo($R),$R.concat($V[5]),$R):$_,$t?$V[3]&&$V[4]?$U._addPointArrToRst($H,$z._getBoundPointS($V[1],$V[2],$V[3],$V[4]),$J):($e=$V[0],$U._addPointArrToRst($H,$z._getBoundPointS($V[1],$V[2],$e.width,$e.height),$J)):($e=$V[0],$A=($V[3]||$e.sourceWidth)/$e.width,$q=($V[4]||$e.sourceHeight)/$e.height,$f=$A*$e.sourceWidth,$b=$q*$e.sourceHeight,$L=0<$e.offsetX?$e.offsetX:0,$G=0<$e.offsetY?$e.offsetY:0,$L*=$A,$G*=$q,$U._addPointArrToRst($H,$z._getBoundPointS($V[1]-$L,$V[2]-$G,$f,$b),$J));break;case $T._drawRect:case 13:$U._addPointArrToRst($H,$z._getBoundPointS($V[0],$V[1],$V[2],$V[3]),$_);break;case $T._drawCircle:case $T._fillCircle:case 14:$U._addPointArrToRst($H,$z._getBoundPointS($V[0]-$V[2],$V[1]-$V[2],$V[2]+$V[2],$V[2]+$V[2]),$_);break;case $T._drawLine:case 20:$U._tempPoints.length=0;var $S;$S=.5*$V[5],$V[0]==$V[2]?$U._tempPoints.push($V[0]+$S,$V[1],$V[2]+$S,$V[3],$V[0]-$S,$V[1],$V[2]-$S,$V[3]):$V[1]==$V[3]?$U._tempPoints.push($V[0],$V[1]+$S,$V[2],$V[3]+$S,$V[0],$V[1]-$S,$V[2],$V[3]-$S):$U._tempPoints.push($V[0],$V[1],$V[2],$V[3]),$U._addPointArrToRst($H,$U._tempPoints,$_);break;case $T._drawCurves:case 22:$U._addPointArrToRst($H,$C.I.getBezierPoints($V[2]),$_,$V[0],$V[1]);break;case $T._drawPoly:case $T._drawLines:case 18:$U._addPointArrToRst($H,$V[2],$_,$V[0],$V[1]);break;case $T._drawPath:case 19:$U._addPointArrToRst($H,this._getPathPoints($V[2]),$_,$V[0],$V[1]);break;case $T._drawPie:case 15:$U._addPointArrToRst($H,this._getPiePoints($V[0],$V[1],$V[2],$V[3],$V[4]),$_)}return 200<$H.length?$H=$i.copyArray($H,$z._getWrapRec($H)._getBoundPoints()):8<$H.length&&($H=$N.scanPList($H)),$H},$t._switchMatrix=function($t,$H){$H.concat($t),$H.copyTo($t)},$t._getPiePoints=function($t,$H,$I,$T,$K){var $_=$U._tempPoints;$U._tempPoints.length=0,$_.push($t,$H);var $V=($K-$T)%(2*Math.PI)/10,$e=NaN,$R=$T;for($e=0;$e<=10;$e++)$_.push($t+$I*Math.cos($R),$H+$I*Math.sin($R)),$R+=$V;return $_},$t._getPathPoints=function($t){var $H,$I,$T=0,$K=$U._tempPoints;for($K.length=0,$H=$t.length,$T=0;$T<$H;$T++)1<($I=$t[$T]).length&&($K.push($I[1],$I[2]),3<$I.length&&$K.push($I[3],$I[4]));return $K},$U._addPointArrToRst=function($t,$H,$I,$T,$K){void 0===$T&&($T=0),void 0===$K&&($K=0);var $_,$V=0;for($_=$H.length,$V=0;$V<$_;$V+=2)$U._addPointToRst($t,$H[$V]+$T,$H[$V+1]+$K,$I)},$U._addPointToRst=function($t,$H,$I,$T){var $K=$s.TEMP;$K.setTo($H||0,$I||0),$T.transformPoint($K),$t.push($K.x,$K.y)},$U._tempPoints=[],$U._tempMatrixArrays=[],$U._tempCmds=[],$R($U,["_tempMatrix",function(){return this._tempMatrix=new $Y},"_initMatrix",function(){return this._initMatrix=new $Y}]),$U}(),$_=function(){function $t(){}$M($t,"laya.events.Event");var $H=$t.prototype;return $H.setTo=function($t,$H,$I){return this.type=$t,this.currentTarget=$H,this.target=$I,this},$H.stopPropagation=function(){this._stoped=!0},$q(0,$H,"stageY",function(){return $W.stage.mouseY}),$q(0,$H,"charCode",function(){return this.nativeEvent.charCode}),$q(0,$H,"touches",function(){var $t=this.nativeEvent.touches;if($t)for(var $H=$W.stage,$I=0,$T=$t.length;$I<$T;$I++){var $K=$t[$I],$_=$s.TEMP;$_.setTo($K.clientX,$K.clientY),$H._canvasTransform.invertTransformPoint($_),$H.transform.invertTransformPoint($_),$K.stageX=$_.x,$K.stageY=$_.y}return $t}),$q(0,$H,"keyLocation",function(){return this.nativeEvent.keyLocation}),$q(0,$H,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$q(0,$H,"altKey",function(){return this.nativeEvent.altKey}),$q(0,$H,"shiftKey",function(){return this.nativeEvent.shiftKey}),$q(0,$H,"stageX",function(){return $W.stage.mouseX}),$t.EMPTY=new $t,$t.MOUSE_DOWN="mousedown",$t.MOUSE_UP="mouseup",$t.CLICK="click",$t.RIGHT_MOUSE_DOWN="rightmousedown",$t.RIGHT_MOUSE_UP="rightmouseup",$t.RIGHT_CLICK="rightclick",$t.MOUSE_MOVE="mousemove",$t.MOUSE_OVER="mouseover",$t.MOUSE_OUT="mouseout",$t.MOUSE_WHEEL="mousewheel",$t.ROLL_OVER="mouseover",$t.ROLL_OUT="mouseout",$t.DOUBLE_CLICK="doubleclick",$t.CHANGE="change",$t.CHANGED="changed",$t.RESIZE="resize",$t.ADDED="added",$t.REMOVED="removed",$t.DISPLAY="display",$t.UNDISPLAY="undisplay",$t.ERROR="error",$t.COMPLETE="complete",$t.LOADED="loaded",$t.INITED="inited",$t.PROGRESS="progress",$t.INPUT="input",$t.RENDER="render",$t.OPEN="open",$t.MESSAGE="message",$t.CLOSE="close",$t.KEY_DOWN="keydown",$t.KEY_PRESS="keypress",$t.KEY_UP="keyup",$t.FRAME="enterframe",$t.DRAG_START="dragstart",$t.DRAG_MOVE="dragmove",$t.DRAG_END="dragend",$t.ENTER="enter",$t.SELECT="select",$t.BLUR="blur",$t.FOCUS="focus",$t.VISIBILITY_CHANGE="visibilitychange",$t.FOCUS_CHANGE="focuschange",$t.PLAYED="played",$t.PAUSED="paused",$t.STOPPED="stopped",$t.START="start",$t.END="end",$t.ENABLE_CHANGED="enablechanged",$t.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$t.COMPONENT_ADDED="componentadded",$t.COMPONENT_REMOVED="componentremoved",$t.LAYER_CHANGED="layerchanged",$t.HIERARCHY_LOADED="hierarchyloaded",$t.RECOVERED="recovered",$t.RELEASED="released",$t.LINK="link",$t.LABEL="label",$t.FULL_SCREEN_CHANGE="fullscreenchange",$t.DEVICE_LOST="devicelost",$t.MESH_CHANGED="meshchanged",$t.MATERIAL_CHANGED="materialchanged",$t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$t.ANIMATION_CHANGED="animationchanged",$t.TRIGGER_ENTER="triggerenter",$t.TRIGGER_STAY="triggerstay",$t.TRIGGER_EXIT="triggerexit",$t.TRAIL_FILTER_CHANGE="trailfilterchange",$t.DOMINO_FILTER_CHANGE="dominofilterchange",$t}(),$f=(function(){function $t(){}$M($t,"laya.events.Keyboard"),$t.NUMBER_0=48,$t.NUMBER_1=49,$t.NUMBER_2=50,$t.NUMBER_3=51,$t.NUMBER_4=52,$t.NUMBER_5=53,$t.NUMBER_6=54,$t.NUMBER_7=55,$t.NUMBER_8=56,$t.NUMBER_9=57,$t.A=65,$t.B=66,$t.C=67,$t.D=68,$t.E=69,$t.F=70,$t.G=71,$t.H=72,$t.I=73,$t.J=74,$t.K=75,$t.L=76,$t.M=77,$t.N=78,$t.O=79,$t.P=80,$t.Q=81,$t.R=82,$t.S=83,$t.T=84,$t.U=85,$t.V=86,$t.W=87,$t.X=88,$t.Y=89,$t.Z=90,$t.F1=112,$t.F2=113,$t.F3=114,$t.F4=115,$t.F5=116,$t.F6=117,$t.F7=118,$t.F8=119,$t.F9=120,$t.F10=121,$t.F11=122,$t.F12=123,$t.F13=124,$t.F14=125,$t.F15=126,$t.NUMPAD=21,$t.NUMPAD_0=96,$t.NUMPAD_1=97,$t.NUMPAD_2=98,$t.NUMPAD_3=99,$t.NUMPAD_4=100,$t.NUMPAD_5=101,$t.NUMPAD_6=102,$t.NUMPAD_7=103,$t.NUMPAD_8=104,$t.NUMPAD_9=105,$t.NUMPAD_ADD=107,$t.NUMPAD_DECIMAL=110,$t.NUMPAD_DIVIDE=111,$t.NUMPAD_ENTER=108,$t.NUMPAD_MULTIPLY=106,$t.NUMPAD_SUBTRACT=109,$t.SEMICOLON=186,$t.EQUAL=187,$t.COMMA=188,$t.MINUS=189,$t.PERIOD=190,$t.SLASH=191,$t.BACKQUOTE=192,$t.LEFTBRACKET=219,$t.BACKSLASH=220,$t.RIGHTBRACKET=221,$t.QUOTE=222,$t.ALTERNATE=18,$t.BACKSPACE=8,$t.CAPS_LOCK=20,$t.COMMAND=15,$t.CONTROL=17,$t.DELETE=46,$t.ENTER=13,$t.ESCAPE=27,$t.PAGE_UP=33,$t.PAGE_DOWN=34,$t.END=35,$t.HOME=36,$t.LEFT=37,$t.UP=38,$t.RIGHT=39,$t.DOWN=40,$t.SHIFT=16,$t.SPACE=32,$t.TAB=9,$t.INSERT=45}(),function(){function $K(){}return $M($K,"laya.events.KeyBoardManager"),$K.__init__=function(){$K._addEvent("keydown"),$K._addEvent("keypress"),$K._addEvent("keyup")},$K._addEvent=function($H){$h.document.addEventListener($H,function($t){laya.events.KeyBoardManager._dispatch($t,$H)},!0)},$K._dispatch=function($t,$H){if($K.enabled){$K._event._stoped=!1,$K._event.nativeEvent=$t,$K._event.keyCode=$t.keyCode||$t.which||$t.charCode,"keydown"===$H?$K._pressKeys[$K._event.keyCode]=!0:"keyup"===$H&&($K._pressKeys[$K._event.keyCode]=null);for(var $I=$W.stage.focus&&null!=$W.stage.focus.event&&$W.stage.focus.displayedInStage?$W.stage.focus:$W.stage,$T=$I;$T;)$T.event($H,$K._event.setTo($H,$T,$I)),$T=$T.parent}},$K.hasKeyDown=function($t){return $K._pressKeys[$t]},$K._pressKeys={},$K.enabled=!0,$R($K,["_event",function(){return this._event=new $_}]),$K}()),$G=(function(){function $t(){}$M($t,"laya.events.KeyLocation"),$t.STANDARD=0,$t.LEFT=1,$t.RIGHT=2,$t.NUM_PAD=3}(),function(){function $q(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$h.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $_,this._matrix=new $Y,this._point=new $s,this._rect=new $z,this._prePoint=new $s,this._curTouchID=NaN}$M($q,"laya.events.MouseManager");var $t=$q.prototype;return $t.__init__=function($t,$H){var $I=this;this._stage=$t;var $T=this,$K=this._eventList;$H.oncontextmenu=function($t){if($q.enabled)return!1},$H.addEventListener("mousedown",function($t){$q.enabled&&($h.onIE||$t.preventDefault(),$K.push($t),$T.mouseDownTime=$h.now())}),$H.addEventListener("mouseup",function($t){$q.enabled&&($t.preventDefault(),$K.push($t),$T.mouseDownTime=-$h.now())},!0),$H.addEventListener("mousemove",function($t){if($q.enabled){$t.preventDefault();var $H=$h.now();if($H-$T._lastMoveTimer<10)return;$T._lastMoveTimer=$H,$K.push($t)}},!0),$H.addEventListener("mouseout",function($t){$q.enabled&&$K.push($t)}),$H.addEventListener("mouseover",function($t){$q.enabled&&$K.push($t)}),$H.addEventListener("touchstart",function($t){$q.enabled&&($K.push($t),$q._isFirstTouch||$Nt.isInputting||$t.preventDefault(),$T.mouseDownTime=$h.now())}),$H.addEventListener("touchend",function($t){$q.enabled?($q._isFirstTouch||$Nt.isInputting||$t.preventDefault(),$q._isFirstTouch=!1,$K.push($t),$T.mouseDownTime=-$h.now()):$I._curTouchID=NaN},!0),$H.addEventListener("touchmove",function($t){$q.enabled&&($t.preventDefault(),$K.push($t))},!0),$H.addEventListener("touchcancel",function($t){$q.enabled?($t.preventDefault(),$K.push($t)):$I._curTouchID=NaN},!0),$H.addEventListener("mousewheel",function($t){$q.enabled&&$K.push($t)}),$H.addEventListener("DOMMouseScroll",function($t){$q.enabled&&$K.push($t)})},$t.initEvent=function($t,$H){var $I;this._event._stoped=!1,this._event.nativeEvent=$H||$t,this._target=null,this._point.setTo($t.pageX||$t.clientX,$t.pageY||$t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$t.identifier||0,this._tTouchID=this._event.touchId,($I=$O.I._event)._stoped=!1,$I.nativeEvent=this._event.nativeEvent,$I.touchId=this._event.touchId},$t.checkMouseWheel=function($t){this._event.delta=$t.wheelDelta?.025*$t.wheelDelta:-$t.detail;for(var $H=$O.I.getLastOvers(),$I=0,$T=$H.length;$I<$T;$I++){var $K=$H[$I];$K.event("mousewheel",this._event.setTo("mousewheel",$K,this._target))}},$t.onMouseMove=function($t){$O.I.onMouseMove($t,this._tTouchID)},$t.onMouseDown=function($t){if($Nt.isInputting&&$W.stage.focus&&$W.stage.focus.focus&&!$W.stage.focus.contains(this._target)){var $H=$W.stage.focus._tf||$W.stage.focus,$I=$t._tf||$t;$I instanceof laya.display.Input&&$I.multiline==$H.multiline?$H._focusOut():$H.focus=!1}$O.I.onMouseDown($t,this._tTouchID,this._isLeftMouse)},$t.onMouseUp=function($t){$O.I.onMouseUp($t,this._tTouchID,this._isLeftMouse)},$t.check=function($t,$H,$I,$T){this._point.setTo($H,$I),$t.fromParentPoint(this._point),$H=this._point.x,$I=this._point.y;var $K=$t.scrollRect;if($K&&(this._rect.setTo($K.x,$K.y,$K.width,$K.height),!this._rect.contains($H,$I)))return!1;if(!this.disableMouseEvent){if($t.hitTestPrior&&!$t.mouseThrough&&!this.hitTest($t,$H,$I))return!1;for(var $_=$t._childs.length-1;-1<$_;$_--){var $V=$t._childs[$_];if(!$V.destroyed&&$V.mouseEnabled&&$V.visible&&this.check($V,$H,$I,$T))return!0}}var $e=!(!$t.hitTestPrior||$t.mouseThrough||this.disableMouseEvent)||this.hitTest($t,$H,$I);return $e?(this._target=$t,$T.call(this,$t)):$T===this.onMouseUp&&$t===this._stage&&(this._target=this._stage,$T.call(this,this._target)),$e},$t.hitTest=function($t,$H,$I){var $T=!1;if($t.scrollRect&&($H-=$t.scrollRect.x,$I-=$t.scrollRect.y),$t.hitArea instanceof laya.utils.HitArea)return $t.hitArea.isHit($H,$I);if(0<$t.width&&0<$t.height||$t.mouseThrough||$t.hitArea)if($t.mouseThrough)$T=$t.getGraphicBounds().contains($H,$I);else{var $K=this._rect;$t.hitArea?$K=$t.hitArea:$K.setTo(0,0,$t.width,$t.height),$T=$K.contains($H,$I)}return $T},$t.runEvent=function(){var $t=this._eventList.length;if($t){var $H=this;$H.mouseEventTime=$h.now();var $I,$T=0,$K=0,$_=0;try{for(;$T<$t;){var $V=this._eventList[$T];switch("mousemove"!==$V.type&&(this._prePoint.x=this._prePoint.y=-1e6),$V.type){case"mousedown":this._touchIDs[0]=this._id++,$q._isTouchRespond?$q._isTouchRespond=!1:($H._isLeftMouse=0===$V.button,$H.initEvent($V),$H.check($H._stage,$H.mouseX,$H.mouseY,$H.onMouseDown));break;case"mouseup":$H._isLeftMouse=0===$V.button,$H.initEvent($V),$H.check($H._stage,$H.mouseX,$H.mouseY,$H.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$V.clientX)+Math.abs(this._prePoint.y-$V.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$V.clientX,this._prePoint.y=$V.clientY,$H.initEvent($V),$H.check($H._stage,$H.mouseX,$H.mouseY,$H.onMouseMove));break;case"touchstart":$q._isTouchRespond=!0,$H._isLeftMouse=!0;var $e=$V.changedTouches;for($K=0,$_=$e.length;$K<$_;$K++)$I=$e[$K],($q.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$I.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$I.identifier]=this._id++,$H.initEvent($I,$V),$H.check($H._stage,$H.mouseX,$H.mouseY,$H.onMouseDown));break;case"touchend":case"touchcancel":$q._isTouchRespond=!0,$H._isLeftMouse=!0;var $R=$V.changedTouches;for($K=0,$_=$R.length;$K<$_;$K++)if($I=$R[$K],$q.multiTouchEnabled||$I.identifier==this._curTouchID){this._curTouchID=NaN,$H.initEvent($I,$V);$H.check($H._stage,$H.mouseX,$H.mouseY,$H.onMouseUp)||$H.onMouseUp(null)}break;case"touchmove":var $A=$V.changedTouches;for($K=0,$_=$A.length;$K<$_;$K++)$I=$A[$K],($q.multiTouchEnabled||$I.identifier==this._curTouchID)&&($H.initEvent($I,$V),$H.check($H._stage,$H.mouseX,$H.mouseY,$H.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$H.checkMouseWheel($V);break;case"mouseout":$O.I.stageMouseOut();break;case"mouseover":$H._stage.event("mouseover",$H._event.setTo("mouseover",$H._stage,$H._stage))}$T++}}catch($t){throw this._eventList.length=0,$t}this._eventList.length=0}},$q.enabled=!0,$q.multiTouchEnabled=!0,$q._isTouchRespond=!1,$q._isFirstTouch=!0,$R($q,["instance",function(){return this.instance=new $q}]),$q}()),$O=function(){function $G(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $_}$M($G,"laya.events.TouchManager");var $t=$G.prototype;return $t._clearTempArrs=function(){$G._oldArr.length=0,$G._newArr.length=0,$G._tEleArr.length=0},$t.getTouchFromArr=function($t,$H){var $I,$T,$K=0;for($I=$H.length,$K=0;$K<$I;$K++)if(($T=$H[$K]).id==$t)return $T;return null},$t.removeTouchFromArr=function($t,$H){var $I=0;for($I=$H.length-1;0<=$I;$I--)$H[$I].id==$t&&$H.splice($I,1)},$t.createTouchO=function($t,$H){var $I;return($I=$o.getItem("TouchData")||{}).id=$H,$I.tar=$t,$I},$t.onMouseDown=function($t,$H,$I){var $T,$K,$_,$V;(void 0===$I&&($I=!1),this.enable)&&($T=this.getTouchFromArr($H,this.preOvers),$_=this.getEles($t,null,$G._tEleArr),$T?$T.tar=$t:($K=this.createTouchO($t,$H),this.preOvers.push($K)),$h.onMobile&&this.sendEvents($_,"mouseover",$H),$V=$I?this.preDowns:this.preRightDowns,($T=this.getTouchFromArr($H,$V))?$T.tar=$t:($K=this.createTouchO($t,$H),$V.push($K)),this.sendEvents($_,$I?"mousedown":"rightmousedown",$H),this._clearTempArrs())},$t.sendEvents=function($t,$H,$I){void 0===$I&&($I=0);var $T,$K,$_,$V=0;for($T=$t.length,this._event._stoped=!1,$K=$t[0],$V=0;$V<$T;$V++){if(($_=$t[$V]).destroyed)return;if($_.event($H,this._event.setTo($H,$_,$K)),this._event._stoped)break}},$t.getEles=function($t,$H,$I){for($I?$I.length=0:$I=[];$t&&$t!=$H;)$I.push($t),$t=$t.parent;return $I},$t.checkMouseOutAndOverOfMove=function($t,$H,$I){if(void 0===$I&&($I=0),$H!=$t){var $T,$K,$_=0,$V=0;if($H.contains($t))$K=this.getEles($t,$H,$G._tEleArr),this.sendEvents($K,"mouseover",$I);else if($t.contains($H))$K=this.getEles($H,$t,$G._tEleArr),this.sendEvents($K,"mouseout",$I);else{var $e,$R;($K=$G._tEleArr).length=0,$e=this.getEles($H,null,$G._oldArr),$R=this.getEles($t,null,$G._newArr),$V=$e.length;var $A=0;for($_=0;$_<$V;$_++){if($T=$e[$_],0<=($A=$R.indexOf($T))){$R.splice($A,$R.length-$A);break}$K.push($T)}0<$K.length&&this.sendEvents($K,"mouseout",$I),0<$R.length&&this.sendEvents($R,"mouseover",$I)}}},$t.onMouseMove=function($t,$H){var $I,$T;this.enable&&(($I=this.getTouchFromArr($H,this.preOvers))?(this.checkMouseOutAndOverOfMove($t,$I.tar),$I.tar=$t,$T=this.getEles($t,null,$G._tEleArr)):($T=this.getEles($t,null,$G._tEleArr),this.sendEvents($T,"mouseover",$H),this.preOvers.push(this.createTouchO($t,$H))),this.sendEvents($T,"mousemove",$H),this._clearTempArrs())},$t.getLastOvers=function(){return($G._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$G._tEleArr):($G._tEleArr.push($W.stage),$G._tEleArr)},$t.stageMouseOut=function(){var $t;$t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($t,"mouseout",0)},$t.onMouseUp=function($t,$H,$I){if(void 0===$I&&($I=!1),this.enable){var $T,$K,$_,$V,$e,$R,$A=0,$q=0,$f=$h.onMobile;if($K=this.getEles($t,null,$G._tEleArr),this.sendEvents($K,$I?"mouseup":"rightmouseup",$H),$R=$I?this.preDowns:this.preRightDowns,$T=this.getTouchFromArr($H,$R)){var $b,$L=$h.now();if($b=$L-this._lastClickTime<300,this._lastClickTime=$L,$t==$T.tar)$e=$K;else for($_=this.getEles($T.tar,null,$G._oldArr),($e=$G._newArr).length=0,$q=$_.length,$A=0;$A<$q;$A++)$V=$_[$A],0<=$K.indexOf($V)&&$e.push($V);0<$e.length&&this.sendEvents($e,$I?"click":"rightclick",$H),$I&&$b&&this.sendEvents($e,"doubleclick",$H),this.removeTouchFromArr($H,$R),$T.tar=null,$o.recover("TouchData",$T)}else;($T=this.getTouchFromArr($H,this.preOvers))&&$f&&(($e=this.getEles($T.tar,null,$e))&&0<$e.length&&this.sendEvents($e,"mouseout",$H),this.removeTouchFromArr($H,this.preOvers),$T.tar=null,$o.recover("TouchData",$T)),this._clearTempArrs()}},$G._oldArr=[],$G._newArr=[],$G._tEleArr=[],$R($G,["I",function(){return this.I=new $G}]),$G}(),$J=function(){function $t(){this._action=null}$M($t,"laya.filters.Filter");var $H=$t.prototype;return $W.imps($H,{"laya.filters.IFilter":!0}),$H.callNative=function($t){},$q(0,$H,"type",function(){return-1}),$q(0,$H,"action",function(){return this._action}),$t.BLUR=16,$t.COLOR=32,$t.GLOW=8,$t._filterStart=null,$t._filterEnd=null,$t._EndTarget=null,$t._recycleScope=null,$t._filter=null,$t._useSrc=null,$t._endSrc=null,$t._useOut=null,$t._endOut=null,$t}(),$U=function(){function $t(){this.data=null}$M($t,"laya.filters.ColorFilterAction");var $H=$t.prototype;return $W.imps($H,{"laya.filters.IFilterAction":!0}),$H.apply=function($t){var $H=$t.ctx.ctx,$I=$t.ctx.ctx.canvas;if(0==$I.width||0==$I.height)return $I;for(var $T,$K=$H.getImageData(0,0,$I.width,$I.height),$_=$K.data,$V=0,$e=$_.length;$V<$e;$V+=4)$T=this.getColor($_[$V],$_[$V+1],$_[$V+2],$_[$V+3]),0!=$_[$V+3]&&($_[$V]=$T[0],$_[$V+1]=$T[1],$_[$V+2]=$T[2],$_[$V+3]=$T[3]);return $H.putImageData($K,0,0),$t},$H.getColor=function($t,$H,$I,$T){var $K=[];if(this.data._mat&&this.data._alpha){var $_=this.data._mat,$V=this.data._alpha;$K[0]=$_[0]*$t+$_[1]*$H+$_[2]*$I+$_[3]*$T+$V[0],$K[1]=$_[4]*$t+$_[5]*$H+$_[6]*$I+$_[7]*$T+$V[1],$K[2]=$_[8]*$t+$_[9]*$H+$_[10]*$I+$_[11]*$T+$V[2],$K[3]=$_[12]*$t+$_[13]*$H+$_[14]*$I+$_[15]*$T+$V[3]}return $K},$t}(),$C=(function(){function $t(){}$M($t,"laya.maths.Arith"),$t.formatR=function($t){return $t>Math.PI&&($t-=2*Math.PI),$t<-Math.PI&&($t+=2*Math.PI),$t},$t.isPOT=function($t,$H){return 0<$t&&0==($t&$t-1)&&0<$H&&0==($H&$H-1)},$t.setMatToArray=function($t,$H){$t.a,$t.b,$t.c,$t.d,$t.tx,$t.ty,$H[0]=$t.a,$H[1]=$t.b,$H[4]=$t.c,$H[5]=$t.d,$H[12]=$t.tx,$H[13]=$t.ty}}(),function(){function $t(){this._controlPoints=[new $s,new $s,new $s],this._calFun=this.getPoint2}$M($t,"laya.maths.Bezier");var $H=$t.prototype;return $H._switchPoint=function($t,$H){var $I=this._controlPoints.shift();$I.setTo($t,$H),this._controlPoints.push($I)},$H.getPoint2=function($t,$H){var $I=this._controlPoints[0],$T=this._controlPoints[1],$K=this._controlPoints[2],$_=Math.pow(1-$t,2)*$I.x+2*$t*(1-$t)*$T.x+Math.pow($t,2)*$K.x,$V=Math.pow(1-$t,2)*$I.y+2*$t*(1-$t)*$T.y+Math.pow($t,2)*$K.y;$H.push($_,$V)},$H.getPoint3=function($t,$H){var $I=this._controlPoints[0],$T=this._controlPoints[1],$K=this._controlPoints[2],$_=this._controlPoints[3],$V=Math.pow(1-$t,3)*$I.x+3*$T.x*$t*(1-$t)*(1-$t)+3*$K.x*$t*$t*(1-$t)+$_.x*Math.pow($t,3),$e=Math.pow(1-$t,3)*$I.y+3*$T.y*$t*(1-$t)*(1-$t)+3*$K.y*$t*$t*(1-$t)+$_.y*Math.pow($t,3);$H.push($V,$e)},$H.insertPoints=function($t,$H){var $I,$T=NaN;for($I=1/($t=0<$t?$t:5),$T=0;$T<=1;$T+=$I)this._calFun($T,$H)},$H.getBezierPoints=function($t,$H,$I){void 0===$H&&($H=5),void 0===$I&&($I=2);var $T,$K,$_=0;if(($T=$t.length)<2*($I+1))return[];switch($K=[],$I){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$I;)this._controlPoints.push(new $s);for($_=0;$_<2*$I;$_+=2)this._switchPoint($t[$_],$t[$_+1]);for($_=2*$I;$_<$T;$_+=2)this._switchPoint($t[$_],$t[$_+1]),$_/2%$I==0&&this.insertPoints($H,$K);return $K},$R($t,["I",function(){return this.I=new $t}]),$t}()),$N=function(){function $A(){}return $M($A,"laya.maths.GrahamScan"),$A.multiply=function($t,$H,$I){return($t.x-$I.x)*($H.y-$I.y)-($H.x-$I.x)*($t.y-$I.y)},$A.dis=function($t,$H){return($t.x-$H.x)*($t.x-$H.x)+($t.y-$H.y)*($t.y-$H.y)},$A._getPoints=function($t,$H,$I){for(void 0===$H&&($H=!1),$A._mPointList||($A._mPointList=[]);$A._mPointList.length<$t;)$A._mPointList.push(new $s);return $I||($I=[]),$I.length=0,$H?$A.getFrom($I,$A._mPointList,$t):$A.getFromR($I,$A._mPointList,$t),$I},$A.getFrom=function($t,$H,$I){var $T=0;for($T=0;$T<$I;$T++)$t.push($H[$T]);return $t},$A.getFromR=function($t,$H,$I){var $T=0;for($T=0;$T<$I;$T++)$t.push($H.pop());return $t},$A.pListToPointList=function($t,$H){void 0===$H&&($H=!1);var $I=0,$T=$t.length/2,$K=$A._getPoints($T,$H,$A._tempPointList);for($I=0;$I<$T;$I++)$K[$I].setTo($t[$I+$I],$t[$I+$I+1]);return $K},$A.pointListToPlist=function($t){var $H,$I=0,$T=$t.length,$K=$A._temPList;for($I=$K.length=0;$I<$T;$I++)$H=$t[$I],$K.push($H.x,$H.y);return $K},$A.scanPList=function($t){return $i.copyArray($t,$A.pointListToPlist($A.scan($A.pListToPointList($t,!0))))},$A.scan=function($t){var $H,$I,$T,$K=0,$_=0,$V=0,$e=$t.length,$R={};for(($I=$A._temArr).length=0,$K=($e=$t.length)-1;0<=$K;$K--)$T=($H=$t[$K]).x+"_"+$H.y,$R.hasOwnProperty($T)||($R[$T]=!0,$I.push($H));for($e=$I.length,$i.copyArray($t,$I),$K=1;$K<$e;$K++)($t[$K].y<$t[$V].y||$t[$K].y==$t[$V].y&&$t[$K].x<$t[$V].x)&&($V=$K);for($H=$t[0],$t[0]=$t[$V],$t[$V]=$H,$K=1;$K<$e-1;$K++){for($_=($V=$K)+1;$_<$e;$_++)(0<$A.multiply($t[$_],$t[$V],$t[0])||0==$A.multiply($t[$_],$t[$V],$t[0])&&$A.dis($t[0],$t[$_])<$A.dis($t[0],$t[$V]))&&($V=$_);$H=$t[$K],$t[$K]=$t[$V],$t[$V]=$H}if(($I=$A._temArr).length=0,$t.length<3)return $i.copyArray($I,$t);for($I.push($t[0],$t[1],$t[2]),$K=3;$K<$e;$K++){for(;2<=$I.length&&0<=$A.multiply($t[$K],$I[$I.length-1],$I[$I.length-2]);)$I.pop();$t[$K]&&$I.push($t[$K])}return $I},$A._mPointList=null,$A._tempPointList=[],$A._temPList=[],$A._temArr=[],$A}(),$w=function(){function $K(){}return $M($K,"laya.maths.MathUtil"),$K.subtractVector3=function($t,$H,$I){$I[0]=$t[0]-$H[0],$I[1]=$t[1]-$H[1],$I[2]=$t[2]-$H[2]},$K.lerp=function($t,$H,$I){return $t*(1-$I)+$H*$I},$K.scaleVector3=function($t,$H,$I){$I[0]=$t[0]*$H,$I[1]=$t[1]*$H,$I[2]=$t[2]*$H},$K.lerpVector3=function($t,$H,$I,$T){var $K=$t[0],$_=$t[1],$V=$t[2];$T[0]=$K+$I*($H[0]-$K),$T[1]=$_+$I*($H[1]-$_),$T[2]=$V+$I*($H[2]-$V)},$K.lerpVector4=function($t,$H,$I,$T){var $K=$t[0],$_=$t[1],$V=$t[2],$e=$t[3];$T[0]=$K+$I*($H[0]-$K),$T[1]=$_+$I*($H[1]-$_),$T[2]=$V+$I*($H[2]-$V),$T[3]=$e+$I*($H[3]-$e)},$K.slerpQuaternionArray=function($t,$H,$I,$T,$K,$_,$V){var $e,$R,$A,$q,$f,$b=$t[$H+0],$L=$t[$H+1],$G=$t[$H+2],$M=$t[$H+3],$O=$I[$T+0],$J=$I[$T+1],$S=$I[$T+2],$U=$I[$T+3];return($R=$b*$O+$L*$J+$G*$S+$M*$U)<0&&($R=-$R,$O=-$O,$J=-$J,$S=-$S,$U=-$U),$f=1e-6<1-$R?($e=Math.acos($R),$A=Math.sin($e),$q=Math.sin((1-$K)*$e)/$A,Math.sin($K*$e)/$A):($q=1-$K,$K),$_[$V+0]=$q*$b+$f*$O,$_[$V+1]=$q*$L+$f*$J,$_[$V+2]=$q*$G+$f*$S,$_[$V+3]=$q*$M+$f*$U,$_},$K.getRotation=function($t,$H,$I,$T){return Math.atan2($T-$H,$I-$t)/Math.PI*180},$K.sortBigFirst=function($t,$H){return $t==$H?0:$t<$H?1:-1},$K.sortSmallFirst=function($t,$H){return $t==$H?0:$t<$H?-1:1},$K.sortNumBigFirst=function($t,$H){return parseFloat($H)-parseFloat($t)},$K.sortNumSmallFirst=function($t,$H){return parseFloat($t)-parseFloat($H)},$K.sortByKey=function($I,$t,$H){var $T;return void 0===$t&&($t=!1),void 0===$H&&($H=!0),$T=$t?$H?$K.sortNumBigFirst:$K.sortBigFirst:$H?$K.sortNumSmallFirst:$K.sortSmallFirst,function($t,$H){return $T($t[$I],$H[$I])}},$K}(),$Y=function(){function $I($t,$H,$I,$T,$K,$_){this.inPool=!1,this.bTransform=!1,void 0===$t&&($t=1),void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=1),void 0===$K&&($K=0),void 0===$_&&($_=0),this.a=$t,this.b=$H,this.c=$I,this.d=$T,this.tx=$K,this.ty=$_,this._checkTransform()}$M($I,"laya.maths.Matrix");var $t=$I.prototype;return $t.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$t._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$t.setTranslate=function($t,$H){return this.tx=$t,this.ty=$H,this},$t.translate=function($t,$H){return this.tx+=$t,this.ty+=$H,this},$t.scale=function($t,$H){this.a*=$t,this.d*=$H,this.c*=$t,this.b*=$H,this.tx*=$t,this.ty*=$H,this.bTransform=!0},$t.rotate=function($t){var $H=Math.cos($t),$I=Math.sin($t),$T=this.a,$K=this.c,$_=this.tx;this.a=$T*$H-this.b*$I,this.b=$T*$I+this.b*$H,this.c=$K*$H-this.d*$I,this.d=$K*$I+this.d*$H,this.tx=$_*$H-this.ty*$I,this.ty=$_*$I+this.ty*$H,this.bTransform=!0},$t.skew=function($t,$H){var $I=Math.tan($t),$T=Math.tan($H),$K=this.a,$_=this.b;return this.a+=$T*this.c,this.b+=$T*this.d,this.c+=$I*$K,this.d+=$I*$_,this},$t.invertTransformPoint=function($t){var $H=this.a,$I=this.b,$T=this.c,$K=this.d,$_=this.tx,$V=$H*$K-$I*$T,$e=$K/$V,$R=-$I/$V,$A=-$T/$V,$q=$H/$V,$f=($T*this.ty-$K*$_)/$V,$b=-($H*this.ty-$I*$_)/$V;return $t.setTo($e*$t.x+$A*$t.y+$f,$R*$t.x+$q*$t.y+$b)},$t.transformPoint=function($t){return $t.setTo(this.a*$t.x+this.c*$t.y+this.tx,this.b*$t.x+this.d*$t.y+this.ty)},$t.transformPointN=function($t){return $t.setTo(this.a*$t.x+this.c*$t.y,this.b*$t.x+this.d*$t.y)},$t.transformPointArray=function($t,$H){for(var $I=$t.length,$T=0;$T<$I;$T+=2){var $K=$t[$T],$_=$t[$T+1];$H[$T]=this.a*$K+this.c*$_+this.tx,$H[$T+1]=this.b*$K+this.d*$_+this.ty}return $H},$t.transformPointArrayScale=function($t,$H){for(var $I=$t.length,$T=0;$T<$I;$T+=2){var $K=$t[$T],$_=$t[$T+1];$H[$T]=this.a*$K+this.c*$_,$H[$T+1]=this.b*$K+this.d*$_}return $H},$t.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$t.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$t.invert=function(){var $t=this.a,$H=this.b,$I=this.c,$T=this.d,$K=this.tx,$_=$t*$T-$H*$I;return this.a=$T/$_,this.b=-$H/$_,this.c=-$I/$_,this.d=$t/$_,this.tx=($I*this.ty-$T*$K)/$_,this.ty=-($t*this.ty-$H*$K)/$_,this},$t.setTo=function($t,$H,$I,$T,$K,$_){return this.a=$t,this.b=$H,this.c=$I,this.d=$T,this.tx=$K,this.ty=$_,this},$t.concat=function($t){var $H=this.a,$I=this.c,$T=this.tx;return this.a=$H*$t.a+this.b*$t.c,this.b=$H*$t.b+this.b*$t.d,this.c=$I*$t.a+this.d*$t.c,this.d=$I*$t.b+this.d*$t.d,this.tx=$T*$t.a+this.ty*$t.c+$t.tx,this.ty=$T*$t.b+this.ty*$t.d+$t.ty,this},$t.scaleEx=function($t,$H){var $I=this.a,$T=this.b,$K=this.c,$_=this.d;0!==$T||0!==$K?(this.a=$t*$I,this.b=$t*$T,this.c=$H*$K):(this.a=$t*$I,this.b=0*$_,this.c=0*$I),this.d=$H*$_,this.bTransform=!0},$t.rotateEx=function($t){var $H=Math.cos($t),$I=Math.sin($t),$T=this.a,$K=this.b,$_=this.c,$V=this.d;0!==$K||0!==$_?(this.a=$H*$T+$I*$_,this.b=$H*$K+$I*$V,this.c=-$I*$T+$H*$_,this.d=-$I*$K+$H*$V):(this.a=$H*$T,this.b=$I*$V,this.c=-$I*$T,this.d=$H*$V),this.bTransform=!0},$t.clone=function(){var $t=$I.create();return $t.a=this.a,$t.b=this.b,$t.c=this.c,$t.d=this.d,$t.tx=this.tx,$t.ty=this.ty,$t.bTransform=this.bTransform,$t},$t.copyTo=function($t){return $t.a=this.a,$t.b=this.b,$t.c=this.c,$t.d=this.d,$t.tx=this.tx,$t.ty=this.ty,$t.bTransform=this.bTransform,$t},$t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$t.destroy=function(){if(!this.inPool){var $t=$I._cache;this.inPool=!0,$t._length||($t._length=0),($t[$t._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$I.mul=function($t,$H,$I){var $T=$t.a,$K=$t.b,$_=$t.c,$V=$t.d,$e=$t.tx,$R=$t.ty,$A=$H.a,$q=$H.b,$f=$H.c,$b=$H.d,$L=$H.tx,$G=$H.ty;return 0!==$q||0!==$f?($I.a=$T*$A+$K*$f,$I.b=$T*$q+$K*$b,$I.c=$_*$A+$V*$f,$I.d=$_*$q+$V*$b,$I.tx=$A*$e+$f*$R+$L,$I.ty=$q*$e+$b*$R+$G):($I.a=$T*$A,$I.b=$K*$b,$I.c=$_*$A,$I.d=$V*$b,$I.tx=$A*$e+$L,$I.ty=$b*$R+$G),$I},$I.mul16=function($t,$H,$I){var $T=$t.a,$K=$t.b,$_=$t.c,$V=$t.d,$e=$t.tx,$R=$t.ty,$A=$H.a,$q=$H.b,$f=$H.c,$b=$H.d,$L=$H.tx,$G=$H.ty;return 0!==$q||0!==$f?($I[0]=$T*$A+$K*$f,$I[1]=$T*$q+$K*$b,$I[4]=$_*$A+$V*$f,$I[5]=$_*$q+$V*$b,$I[12]=$A*$e+$f*$R+$L,$I[13]=$q*$e+$b*$R+$G):($I[0]=$T*$A,$I[1]=$K*$b,$I[4]=$_*$A,$I[5]=$V*$b,$I[12]=$A*$e+$L,$I[13]=$b*$R+$G),$I},$I.mulPre=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=$t.a,$A=$t.b,$q=$t.c,$f=$t.d,$b=$t.tx,$L=$t.ty;return 0!==$I||0!==$T?($e.a=$R*$H+$A*$T,$e.b=$R*$I+$A*$K,$e.c=$q*$H+$f*$T,$e.d=$q*$I+$f*$K,$e.tx=$H*$b+$T*$L+$_,$e.ty=$I*$b+$K*$L+$V):($e.a=$R*$H,$e.b=$A*$K,$e.c=$q*$H,$e.d=$f*$K,$e.tx=$H*$b+$_,$e.ty=$K*$L+$V),$e},$I.mulPos=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=$t.a,$A=$t.b,$q=$t.c,$f=$t.d,$b=$t.tx,$L=$t.ty;return 0!==$A||0!==$q?($e.a=$H*$R+$I*$q,$e.b=$H*$A+$I*$f,$e.c=$T*$R+$K*$q,$e.d=$T*$A+$K*$f,$e.tx=$R*$_+$q*$V+$b,$e.ty=$A*$_+$f*$V+$L):($e.a=$H*$R,$e.b=$I*$f,$e.c=$T*$R,$e.d=$K*$f,$e.tx=$R*$_+$b,$e.ty=$f*$V+$L),$e},$I.preMul=function($t,$H,$I){var $T=$t.a,$K=$t.b,$_=$t.c,$V=$t.d,$e=$H.a,$R=$H.b,$A=$H.c,$q=$H.d,$f=$H.tx,$b=$H.ty;return $I.a=$e*$T,$I.b=$I.c=0,$I.d=$q*$V,$I.tx=$f*$T+$t.tx,$I.ty=$b*$V+$t.ty,0===$R&&0===$A&&0===$K&&0===$_||($I.a+=$R*$_,$I.d+=$A*$K,$I.b+=$e*$K+$R*$V,$I.c+=$A*$T+$q*$_,$I.tx+=$b*$_,$I.ty+=$f*$K),$I},$I.preMulXY=function($t,$H,$I,$T){var $K=$t.a,$_=$t.b,$V=$t.c,$e=$t.d;return $T.a=$K,$T.b=$_,$T.c=$V,$T.d=$e,$T.tx=$H*$K+$t.tx+$I*$V,$T.ty=$I*$e+$t.ty+$H*$_,$T},$I.create=function(){var $t=$I._cache,$H=$t._length?$t[--$t._length]:new $I;return $H.inPool=!1,$H},$I.EMPTY=new $I,$I.TEMP=new $I,$I._cache=[],$I}(),$s=function(){function $t($t,$H){void 0===$t&&($t=0),void 0===$H&&($H=0),this.x=$t,this.y=$H}$M($t,"laya.maths.Point");var $H=$t.prototype;return $H.setTo=function($t,$H){return this.x=$t,this.y=$H,this},$H.distance=function($t,$H){return Math.sqrt((this.x-$t)*(this.x-$t)+(this.y-$H)*(this.y-$H))},$H.toString=function(){return this.x+","+this.y},$H.normalize=function(){var $t=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$t){var $H=1/$t;this.x*=$H,this.y*=$H}},$t.TEMP=new $t,$t.EMPTY=new $t,$t}(),$z=function(){function $A($t,$H,$I,$T){void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0),this.x=$t,this.y=$H,this.width=$I,this.height=$T}$M($A,"laya.maths.Rectangle");var $t=$A.prototype;return $t.setTo=function($t,$H,$I,$T){return this.x=$t,this.y=$H,this.width=$I,this.height=$T,this},$t.copyFrom=function($t){return this.x=$t.x,this.y=$t.y,this.width=$t.width,this.height=$t.height,this},$t.contains=function($t,$H){return!(this.width<=0||this.height<=0)&&($t>=this.x&&$t<this.right&&$H>=this.y&&$H<this.bottom)},$t.intersects=function($t){return!($t.x>this.x+this.width||$t.x+$t.width<this.x||$t.y>this.y+this.height||$t.y+$t.height<this.y)},$t.intersection=function($t,$H){return this.intersects($t)?($H||($H=new $A),$H.x=Math.max(this.x,$t.x),$H.y=Math.max(this.y,$t.y),$H.width=Math.min(this.right,$t.right)-$H.x,$H.height=Math.min(this.bottom,$t.bottom)-$H.y,$H):null},$t.union=function($t,$H){return $H||($H=new $A),this.clone($H),$t.width<=0||$t.height<=0?$H:($H.addPoint($t.x,$t.y),$H.addPoint($t.right,$t.bottom),this)},$t.clone=function($t){return $t||($t=new $A),$t.x=this.x,$t.y=this.y,$t.width=this.width,$t.height=this.height,$t},$t.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$t.equals=function($t){return!(!$t||$t.x!==this.x||$t.y!==this.y||$t.width!==this.width||$t.height!==this.height)},$t.addPoint=function($t,$H){return this.x>$t&&(this.width+=this.x-$t,this.x=$t),this.y>$H&&(this.height+=this.y-$H,this.y=$H),this.width<$t-this.x&&(this.width=$t-this.x),this.height<$H-this.y&&(this.height=$H-this.y),this},$t._getBoundPoints=function(){var $t=$A._temB;return($t.length=0)==this.width||0==this.height||$t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$t},$t.isEmpty=function(){return this.width<=0||this.height<=0},$q(0,$t,"right",function(){return this.x+this.width}),$q(0,$t,"bottom",function(){return this.y+this.height}),$A._getBoundPointS=function($t,$H,$I,$T){var $K=$A._temA;return($K.length=0)==$I||0==$T||$K.push($t,$H,$t+$I,$H,$t,$H+$T,$t+$I,$H+$T),$K},$A._getWrapRec=function($t,$H){if(!$t||$t.length<1)return $H?$H.setTo(0,0,0,0):$A.TEMP.setTo(0,0,0,0);$H=$H||new $A;var $I,$T,$K,$_,$V,$e=$t.length,$R=$s.TEMP;for($K=$V=-($T=$_=99999),$I=0;$I<$e;$I+=2)$R.x=$t[$I],$R.y=$t[$I+1],$T=$T<$R.x?$T:$R.x,$_=$_<$R.y?$_:$R.y,$K=$K>$R.x?$K:$R.x,$V=$V>$R.y?$V:$R.y;return $H.setTo($T,$_,$K-$T,$V-$_)},$A.EMPTY=new $A,$A.TEMP=new $A,$A._temB=[],$A._temA=[],$A}(),$r=function(){function $R(){}return $M($R,"laya.media.SoundManager"),$q(1,$R,"useAudioMusic",function(){return $R._useAudioMusic},function($t){$R._useAudioMusic=$t,$R._musicClass=$t?$It:null}),$q(1,$R,"autoStopMusic",function(){return $R._autoStopMusic},function($t){$W.stage.off("blur",null,$R._stageOnBlur),$W.stage.off("focus",null,$R._stageOnFocus),$W.stage.off("visibilitychange",null,$R._visibilityChange),($R._autoStopMusic=$t)&&($W.stage.on("blur",null,$R._stageOnBlur),$W.stage.on("focus",null,$R._stageOnFocus),$W.stage.on("visibilitychange",null,$R._visibilityChange))}),$q(1,$R,"muted",function(){return $R._muted},function($t){$t!=$R._muted&&($t&&$R.stopAllSound(),$R.musicMuted=$t,$R._muted=$t)}),$q(1,$R,"musicMuted",function(){return $R._musicMuted},function($t){$t!=$R._musicMuted&&($t?($R._tMusic&&$R._musicChannel&&!$R._musicChannel.isStopped?$R._musicChannel.pause():$R._musicChannel=null,$R._musicMuted=$t):($R._musicMuted=$t,$R._tMusic&&$R._musicChannel&&$R._musicChannel.resume()))}),$q(1,$R,"soundMuted",function(){return $R._soundMuted},function($t){$R._soundMuted=$t}),$R.addChannel=function($t){0<=$R._channels.indexOf($t)||($R._channels.push($t),$R.autoReleaseSound&&0!=$R._notUsedCount&&$R._notUsedUrls[$t.url]&&(delete $R._notUsedUrls[$t.url],0==--$R._notUsedCount&&$W.timer.clear($R,$R.disposeSoundIfNotUsed)))},$R.removeChannel=function($t){var $H=$R._channels,$I=$H.indexOf($t);if(-1!=$I&&($H.splice($I,1),$R.autoReleaseSound)){var $T=$t.url,$K=$R.defaultIntervals[$T]||2e4;if(0<$K){var $_=!0;for($I=$H.length-1;0<=$I;$I--)if($H[$I].url==$T){$_=!1;break}$_&&($R._notUsedUrls[$T]=Date.now()+$K,0==$R._notUsedCount++&&$W.timer.loop(1e4,$R,$R.disposeSoundIfNotUsed))}}},$R.disposeSoundIfNotUsed=function(){var $t=$R._notUsedUrls;if(0!=$R._notUsedCount){var $H=Date.now();for(var $I in $t)$H>=$t[$I]&&(delete $t[$I],--$R._notUsedCount,$R.destroySound($I));if(0!=$R._notUsedCount)return}$W.timer.clear($R,$R.disposeSoundIfNotUsed)},$R._visibilityChange=function(){$W.stage.isVisibility?$R._stageOnFocus():$R._stageOnBlur()},$R._stageOnBlur=function(){$R._isActive=!1,$R._musicChannel&&($R._musicChannel.isStopped||($R._blurPaused=!0,$R._musicChannel.pause())),$R.stopAllSound(),$W.stage.once("mousedown",null,$R._stageOnFocus)},$R._recoverWebAudio=function(){$_t.ctx&&"running"!=$_t.ctx.state&&$_t.ctx.resume&&$_t.ctx.resume()},$R._stageOnFocus=function(){if($R._isActive=!0,$R._recoverWebAudio(),$W.stage.off("mousedown",null,$R._stageOnFocus),$R._blurPaused){var $t=$R._musicChannel;$t&&$R._music&&$t.isStopped&&($R._blurPaused=!1,$R._music._disposed?$R.playMusic($t.url,$t.loops,$t.startHandler,$t.completeHandler,$t.startTime):$t.audioBuffer?$t.resume():$R._music.play($t.startTime,$t.loops,$t.startHandler,$t))}},$R.playSound=function($t,$H,$I,$T,$K,$_){if(void 0===$H&&($H=1),void 0===$_&&($_=0),!$t)return null;if($R._muted)return null;if($R._recoverWebAudio(),$t==$R._tMusic){if($R._musicMuted)return null}else{if(!$R._isActive)return null;if($R._soundMuted)return null}var $V,$e=$R._pool[$t];return $K||($K=$R._soundClass),$e||(($e=new $K).load($t),$R._pool[$t]=$e),($V=$e.play($_,$H,$I))?($t==$R._tMusic&&($R._music=$e,$R._isActive||($R._blurPaused=!0,$V.pause())),$V.url=$t,$V.volume=$t==$R._tMusic?$R.musicVolume:$R.soundVolume,$V.completeHandler=$T,$V):null},$R.destroySound=function($t){var $H=$R._pool[$t];$H&&(delete $R._pool[$t],$H.dispose())},$R.playMusic=function($t,$H,$I,$T,$K){return void 0===$H&&($H=0),void 0===$K&&($K=0),$R._tMusic=$t,$R._musicChannel&&$R._musicChannel.stop(),$R._musicChannel=$R.playSound($t,$H,$I,$T,null,$K)},$R.stopSound=function($t){for(var $H,$I=$R._channels.length-1;0<=$I;$I--)($H=$R._channels[$I]).url==$t&&$H.stop()},$R.stopAll=function(){$R._tMusic=null;var $t=0;for($t=$R._channels.length-1;0<=$t;$t--)$R._channels[$t].stop()},$R.stopAllSound=function(){var $t,$H=0;for($H=$R._channels.length-1;0<=$H;$H--)($t=$R._channels[$H]).url!=$R._tMusic&&$t.stop()},$R.stopMusic=function(){$R._musicChannel&&$R._musicChannel.stop(),$R._tMusic=null},$R.setSoundVolume=function($t,$H){if($H)$R._setVolume($H,$t);else{$R.soundVolume=$t;var $I,$T=0;for($T=$R._channels.length-1;0<=$T;$T--)($I=$R._channels[$T]).url!=$R._tMusic&&($I.volume=$t)}},$R.setMusicVolume=function($t){$R.musicVolume=$t,$R._setVolume($R._tMusic,$t)},$R._setVolume=function($t,$H){for(var $I,$T=$R._channels.length-1;0<=$T;$T--)($I=$R._channels[$T]).url==$t&&($I.volume=$H)},$R.musicVolume=1,$R.soundVolume=1,$R.playbackRate=1,$R._useAudioMusic=!0,$R._muted=!1,$R._soundMuted=!1,$R._musicMuted=!1,$R._tMusic=null,$R._musicChannel=null,$R._music=null,$R._channels=[],$R._autoStopMusic=!1,$R._blurPaused=!1,$R._isActive=!0,$R._soundClass=null,$R._musicClass=null,$R.autoReleaseSound=!0,$R._pool={},$R.defaultIntervals={},$R._notUsedUrls={},$R._notUsedCount=0,$R}(),$P=function(){var $t;function $I(){}return $M($I,"laya.net.LocalStorage"),$I.__init__=function(){$I._baseClass||($I._baseClass=$t).init(),$I.items=$I._baseClass.items,$I.support=$I._baseClass.support},$I.setItem=function($t,$H){$I._baseClass.setItem($t,$H)},$I.getItem=function($t){return $I._baseClass.getItem($t)},$I.setJSON=function($t,$H){$I._baseClass.setJSON($t,$H)},$I.getJSON=function($t){return $I._baseClass.getJSON($t)},$I.removeItem=function($t){$I._baseClass.removeItem($t)},$I.clear=function(){$I._baseClass.clear()},$I._baseClass=null,$I.items=null,$I.support=!1,$I.__init$=function(){$t=function(){function $I(){}return $M($I,""),$I.init=function(){try{$I.support=!0,$I.items=$V.localStorage,$I.setItem("laya","1"),$I.removeItem("laya")}catch($t){$I.support=!1}$I.support||console.log("LocalStorage is not supprot or browser is private mode.")},$I.setItem=function($t,$H){try{$I.support&&$I.items.setItem($t,$H)}catch($t){console.warn("set localStorage failed",$t)}},$I.getItem=function($t){return $I.support?$I.items.getItem($t):null},$I.setJSON=function($t,$H){try{$I.support&&$I.items.setItem($t,JSON.stringify($H))}catch($t){console.warn("set localStorage failed",$t)}},$I.getJSON=function($t){return JSON.parse($I.support?$I.items.getItem($t):null)},$I.removeItem=function($t){$I.support&&$I.items.removeItem($t)},$I.clear=function(){$I.support&&$I.items.clear()},$I.items=null,$I.support=!1,$I}()},$I}(),$D=(function(){function $T(){}$M($T,"laya.net.ResourceVersion"),$T.enable=function($t,$H,$I){void 0===$I&&($I=2),laya.net.ResourceVersion.type=$I,$W.loader.load($t,$S.create(null,$T.onManifestLoaded,[$H]),null,"json"),$p.customFormat=$T.addVersionPrefix},$T.onManifestLoaded=function($t,$H){$T.manifest=$H,$t.run(),$H||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$T.addVersionPrefix=function($t){return $T.manifest&&$T.manifest[$t]?2==$T.type?$T.manifest[$t]:$T.manifest[$t]+"/"+$t:$t},$T.FOLDER_VERSION=1,$T.FILENAME_VERSION=2,$T.manifest=null,$T.type=1}(),function(){function $t(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$M($t,"laya.net.TTFLoader");var $H=$t.prototype;return $H.load=function($t){var $H=(this._url=$t).split(".ttf")[0].split("/");this.fontName=$H[$H.length-1],$h.window.conch?this._loadConch():$h.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$H._loadConch=function(){this._http=new $Vt,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$H._onHttpLoaded=function($t){$h.window.conch.setFontFaceFromBuffer(this.fontName,$t),this._clearHttp(),this._complete()},$H._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$H._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$H._complete=function(){$W.timer.clear(this,this._complete),$W.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$H._checkComplete=function(){$x.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$H._loadWithFontFace=function(){var $t=new $h.window.FontFace(this.fontName,"url('"+this._url+"')");$h.window.document.fonts.add($t);var $H=this;$t.loaded.then(function(){$H._complete()}),$t.load()},$H._createDiv=function(){this._div=$h.createElement("div"),this._div.innerHTML="laya";var $t=this._div.style;$t.fontFamily=this.fontName,$t.position="absolute",$t.left="-100px",$t.top="-100px",$h.document.body.appendChild(this._div)},$H._loadWithCSS=function(){var $t=this,$H=$h.createElement("style");$H.type="text/css",$h.document.body.appendChild($H),$H.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$x.measureText("LayaTTFFont",this._fontTxt).width;var $I=this;$H.onload=function(){$W.timer.once(1e4,$I,$t._complete)},$W.timer.loop(20,this,this._checkComplete),this._createDiv()},$t._testString="LayaTTFFont",$t}()),$p=function(){function $T($t){this._url=null,this._path=null,this._url=$T.formatURL($t),this._path=$T.getPath($t)}$M($T,"laya.net.URL");var $t=$T.prototype;return $q(0,$t,"path",function(){return this._path}),$q(0,$t,"url",function(){return this._url}),$T.formatURL=function($t,$H){if(!$t)return"null path";if(0<$t.indexOf(":"))return $t;null!=$T.customFormat&&($t=$T.customFormat($t,$H));var $I=$t.charAt(0);if("."===$I)return $T.formatRelativePath(($H||$T.basePath)+$t);if("~"===$I)return $T.rootPath+$t.substring(1);if("d"===$I){if(0===$t.indexOf("data:image"))return $t}else if("/"===$I)return $t;return($H||$T.basePath)+$t},$T.formatRelativePath=function($t){for(var $H=$t.split("/"),$I=0,$T=$H.length;$I<$T;$I++)".."==$H[$I]&&($H.splice($I-1,2),$I-=2);return $H.join("/")},$T.isAbsolute=function($t){return 0<$t.indexOf(":")||"/"==$t.charAt(0)},$T.getPath=function($t){var $H=$t.lastIndexOf("/");return 0<$H?$t.substr(0,$H+1):""},$T.getFileName=function($t){var $H=$t.lastIndexOf("/");return 0<$H?$t.substr($H+1):$t},$T.version={},$T.basePath="",$T.rootPath="",$T.customFormat=function($t){var $H=$T.version[$t];return!$g.isConchApp&&$H&&($t+="?v="+$H),$t},$T}(),$g=function(){function $K($t,$H){this._timeId=0;var $I=$K._mainCanvas.source.style;$I.position="absolute",$I.top=$I.left="0px",$I.background="#000000",$K._mainCanvas.source.id="layaCanvas";var $T=laya.renders.Render.isWebGL;$K._mainCanvas.source.width=$t,$K._mainCanvas.source.height=$H,$T&&$K.WebGL.init($K._mainCanvas,$t,$H),$h.container.appendChild($K._mainCanvas.source),($K._context=new $l($t,$H,$T?null:$K._mainCanvas)).ctx.setIsMainContext(),$h.window.requestAnimationFrame(function $t($H){$h.window.requestAnimationFrame($t);$W.stage._loop()}),$W.stage.on("visibilitychange",this,this._onVisibilitychange)}$M($K,"laya.renders.Render");var $t=$K.prototype;return $t._onVisibilitychange=function(){$W.stage.isVisibility?0!=this._timeId&&$h.window.clearInterval(this._timeId):this._timeId=$h.window.setInterval(this._enterFrame,1e3)},$t._enterFrame=function($t){$W.stage._loop()},$q(1,$K,"context",function(){return $K._context}),$q(1,$K,"canvas",function(){return $K._mainCanvas.source}),$K._context=null,$K._mainCanvas=null,$K.WebGL=null,$K.isConchNode=!1,$K.isConchApp=!1,$K.isConchWebGL=!1,$K.isWebGL=!1,$K.is3DMode=!1,$K.optimizeTextureMemory=function($t,$H){return!0},$K.__init$=function(){$V.ConchRenderType=$V.ConchRenderType||1,$V.ConchRenderType|=$V.conch?4:0,$K.isConchNode=5==(5&$V.ConchRenderType),$K.isConchApp=4==(4&$V.ConchRenderType),$K.isConchWebGL=6==$V.ConchRenderType},$K}(),$l=function(){function $V($t,$H,$I){this.x=0,this.y=0,this._drawTexture=function($t,$H,$I){$I[0].loaded&&this.ctx.drawTexture($I[0],$I[1],$I[2],$I[3],$I[4],$t,$H)},this._fillTexture=function($t,$H,$I){$I[0].loaded&&this.ctx.fillTexture($I[0],$I[1]+$t,$I[2]+$H,$I[3],$I[4],$I[5],$I[6],$I[7])},this._drawTextureWithTransform=function($t,$H,$I){$I[0].loaded&&this.ctx.drawTextureWithTransform($I[0],$I[1],$I[2],$I[3],$I[4],$I[5],$t,$H,$I[6])},this._fillQuadrangle=function($t,$H,$I){this.ctx.fillQuadrangle($I[0],$I[1],$I[2],$I[3],$I[4])},this._drawRect=function($t,$H,$I){var $T=this.ctx;null!=$I[4]&&($T.fillStyle=$I[4],$T.fillRect($t+$I[0],$H+$I[1],$I[2],$I[3],null)),null!=$I[5]&&($T.strokeStyle=$I[5],$T.lineWidth=$I[6],$T.strokeRect($t+$I[0],$H+$I[1],$I[2],$I[3],$I[6]))},this._drawPie=function($t,$H,$I){var $T=this.ctx;$g.isWebGL&&$T.setPathId($I[8]),$T.beginPath(),$g.isWebGL?($T.movePath($I[0]+$t,$I[1]+$H),$T.moveTo(0,0)):$T.moveTo($t+$I[0],$H+$I[1]),$T.arc($t+$I[0],$H+$I[1],$I[2],$I[3],$I[4]),$T.closePath(),this._fillAndStroke($I[5],$I[6],$I[7],!0)},this._clipRect=function($t,$H,$I){this.ctx.clipRect($t+$I[0],$H+$I[1],$I[2],$I[3])},this._fillRect=function($t,$H,$I){this.ctx.fillRect($t+$I[0],$H+$I[1],$I[2],$I[3],$I[4])},this._drawCircle=function($t,$H,$I){var $T=this.ctx;$g.isWebGL&&$T.setPathId($I[6]),$n.drawCall++,$T.beginPath(),$g.isWebGL&&$T.movePath($I[0]+$t,$I[1]+$H),$T.arc($I[0]+$t,$I[1]+$H,$I[2],0,$V.PI2),$T.closePath(),this._fillAndStroke($I[3],$I[4],$I[5],!0)},this._fillCircle=function($t,$H,$I){$n.drawCall++;var $T=this.ctx;$T.beginPath(),$T.fillStyle=$I[3],$T.arc($I[0]+$t,$I[1]+$H,$I[2],0,$V.PI2),$T.fill()},this._setShader=function($t,$H,$I){this.ctx.setShader($I[0])},this._drawLine=function($t,$H,$I){var $T=this.ctx;$g.isWebGL&&$T.setPathId($I[6]),$T.beginPath(),$T.strokeStyle=$I[4],$T.lineWidth=$I[5],$g.isWebGL?($T.movePath($t,$H),$T.moveTo($I[0],$I[1]),$T.lineTo($I[2],$I[3])):($T.moveTo($t+$I[0],$H+$I[1]),$T.lineTo($t+$I[2],$H+$I[3])),$T.stroke()},this._drawLines=function($t,$H,$I){var $T=this.ctx;$g.isWebGL&&$T.setPathId($I[5]),$T.beginPath(),$t+=$I[0],$H+=$I[1],$g.isWebGL&&$T.movePath($t,$H),$T.strokeStyle=$I[3],$T.lineWidth=$I[4];var $K=$I[2],$_=2,$V=$K.length;if($g.isWebGL)for($T.moveTo($K[0],$K[1]);$_<$V;)$T.lineTo($K[$_++],$K[$_++]);else for($T.moveTo($t+$K[0],$H+$K[1]);$_<$V;)$T.lineTo($t+$K[$_++],$H+$K[$_++]);$T.stroke()},this._drawLinesWebGL=function($t,$H,$I){this.ctx.drawLines($t+this.x+$I[0],$H+this.y+$I[1],$I[2],$I[3],$I[4])},this._drawCurves=function($t,$H,$I){this.ctx.drawCurves($t,$H,$I)},this._draw=function($t,$H,$I){$I[0].call(null,this,$t,$H)},this._transformByMatrix=function($t,$H,$I){this.ctx.transformByMatrix($I[0])},this._setTransform=function($t,$H,$I){this.ctx.setTransform($I[0],$I[1],$I[2],$I[3],$I[4],$I[5])},this._setTransformByMatrix=function($t,$H,$I){this.ctx.setTransformByMatrix($I[0])},this._save=function($t,$H,$I){this.ctx.save()},this._restore=function($t,$H,$I){this.ctx.restore()},this._translate=function($t,$H,$I){this.ctx.translate($I[0],$I[1])},this._transform=function($t,$H,$I){this.ctx.translate($I[1]+$t,$I[2]+$H);var $T=$I[0];this.ctx.transform($T.a,$T.b,$T.c,$T.d,$T.tx,$T.ty),this.ctx.translate(-$t-$I[1],-$H-$I[2])},this._rotate=function($t,$H,$I){this.ctx.translate($I[1]+$t,$I[2]+$H),this.ctx.rotate($I[0]),this.ctx.translate(-$t-$I[1],-$H-$I[2])},this._scale=function($t,$H,$I){this.ctx.translate($I[2]+$t,$I[3]+$H),this.ctx.scale($I[0],$I[1]),this.ctx.translate(-$t-$I[2],-$H-$I[3])},this._alpha=function($t,$H,$I){this.ctx.globalAlpha*=$I[0]},this._setAlpha=function($t,$H,$I){this.ctx.globalAlpha=$I[0]},this._fillText=function($t,$H,$I){this.ctx.fillText($I[0],$I[1]+$t,$I[2]+$H,$I[3],$I[4],$I[5])},this._strokeText=function($t,$H,$I){this.ctx.strokeText($I[0],$I[1]+$t,$I[2]+$H,$I[3],$I[4],$I[5],$I[6])},this._fillBorderText=function($t,$H,$I){this.ctx.fillBorderText($I[0],$I[1]+$t,$I[2]+$H,$I[3],$I[4],$I[5],$I[6],$I[7])},this._blendMode=function($t,$H,$I){this.ctx.globalCompositeOperation=$I[0]},this._beginClip=function($t,$H,$I){this.ctx.beginClip&&this.ctx.beginClip($t+$I[0],$H+$I[1],$I[2],$I[3])},this._setIBVB=function($t,$H,$I){this.ctx.setIBVB($I[0]+$t,$I[1]+$H,$I[2],$I[3],$I[4],$I[5],$I[6],$I[7])},this._fillTrangles=function($t,$H,$I){this.ctx.fillTrangles($I[0],$I[1]+$t,$I[2]+$H,$I[3],$I[4])},this._drawPath=function($t,$H,$I){var $T=this.ctx;$g.isWebGL&&$T.setPathId(-1),$T.beginPath(),$t+=$I[0],$H+=$I[1],$g.isWebGL&&$T.movePath($t,$H);for(var $K=$I[2],$_=0,$V=$K.length;$_<$V;$_++){var $e=$K[$_];switch($e[0]){case"moveTo":$g.isWebGL?$T.moveTo($e[1],$e[2]):$T.moveTo($t+$e[1],$H+$e[2]);break;case"lineTo":$g.isWebGL?$T.lineTo($e[1],$e[2]):$T.lineTo($t+$e[1],$H+$e[2]);break;case"arcTo":$g.isWebGL?$T.arcTo($e[1],$e[2],$e[3],$e[4],$e[5]):$T.arcTo($t+$e[1],$H+$e[2],$t+$e[3],$H+$e[4],$e[5]);break;case"closePath":$T.closePath()}}var $R=$I[3];null!=$R&&($T.fillStyle=$R.fillStyle,$T.fill());var $A=$I[4];null!=$A&&($T.strokeStyle=$A.strokeStyle,$T.lineWidth=$A.lineWidth||1,$T.lineJoin=$A.lineJoin,$T.lineCap=$A.lineCap,$T.miterLimit=$A.miterLimit,$T.stroke())},this.drawPoly=function($t,$H,$I){this.ctx.drawPoly($t+this.x+$I[0],$H+this.y+$I[1],$I[2],$I[3],$I[4],$I[5],$I[6])},this._drawPoly=function($t,$H,$I){var $T=this.ctx,$K=$I[2],$_=2,$V=$K.length;if($g.isWebGL)for($T.setPathId($I[6]),$T.beginPath(),$t+=$I[0],$H+=$I[1],$T.movePath($t,$H),$T.moveTo($K[0],$K[1]);$_<$V;)$T.lineTo($K[$_++],$K[$_++]);else for($T.beginPath(),$t+=$I[0],$H+=$I[1],$T.moveTo($t+$K[0],$H+$K[1]);$_<$V;)$T.lineTo($t+$K[$_++],$H+$K[$_++]);$T.closePath(),this._fillAndStroke($I[3],$I[4],$I[5],$I[7])},this._drawSkin=function($t,$H,$I){var $T=$I[0];if($T){var $K=this.ctx;$T.render($K,$t,$H)}},this._drawParticle=function($t,$H,$I){this.ctx.drawParticle($t+this.x,$H+this.y,$I[0])},this._setFilters=function($t,$H,$I){this.ctx.setFilters($I)},$I?this.ctx=$I.getContext("2d"):($I=$Ut.create("3D"),this.ctx=$x.createWebGLContext2D($I),$I._setContext(this.ctx)),$I.size($t,$H),this.canvas=$I}$M($V,"laya.renders.RenderContext");var $t=$V.prototype;return $t.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$t.drawTexture=function($t,$H,$I,$T,$K){$t.loaded&&this.ctx.drawTexture($t,$H,$I,$T,$K,this.x,this.y)},$t._drawTextures=function($t,$H,$I){$I[0].loaded&&this.ctx.drawTextures($I[0],$I[1],$t+this.x,$H+this.y)},$t.drawTextureWithTransform=function($t,$H,$I,$T,$K,$_,$V){$t.loaded&&this.ctx.drawTextureWithTransform($t,$H,$I,$T,$K,$_,this.x,this.y,$V)},$t.fillQuadrangle=function($t,$H,$I,$T,$K){this.ctx.fillQuadrangle($t,$H,$I,$T,$K)},$t.drawCanvas=function($t,$H,$I,$T,$K){this.ctx.drawCanvas($t,$H+this.x,$I+this.y,$T,$K)},$t.drawRect=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=1);var $V=this.ctx;$V.strokeStyle=$K,$V.lineWidth=$_,$V.strokeRect($t+this.x,$H+this.y,$I,$T,$_)},$t._fillAndStroke=function($t,$H,$I,$T){void 0===$T&&($T=!1);var $K=this.ctx;null!=$t&&($K.fillStyle=$t,$g.isWebGL?$K.fill($T):$K.fill()),null!=$H&&0<$I&&($K.strokeStyle=$H,$K.lineWidth=$I,$K.stroke())},$t.clipRect=function($t,$H,$I,$T){this.ctx.clipRect($t+this.x,$H+this.y,$I,$T)},$t.fillRect=function($t,$H,$I,$T,$K){this.ctx.fillRect($t+this.x,$H+this.y,$I,$T,$K)},$t.drawCircle=function($t,$H,$I,$T,$K){void 0===$K&&($K=1),$n.drawCall++;var $_=this.ctx;$_.beginPath(),$_.strokeStyle=$T,$_.lineWidth=$K,$_.arc($t+this.x,$H+this.y,$I,0,$V.PI2),$_.stroke()},$t.drawTriangles=function($t,$H,$I){if($g.isWebGL)this.ctx.drawTriangles($I[0],$t+$I[1],$H+$I[2],$I[3],$I[4],$I[5],$I[6],$I[7],$I[8],$I[9]);else{var $T=$I[5],$K=0,$_=$T.length,$V=this.ctx;for($K=0;$K<$_;$K+=3){var $e=2*$T[$K],$R=2*$T[$K+1],$A=2*$T[$K+2];$V.drawTriangle($I[0],$I[3],$I[4],$e,$R,$A,$I[6],!0)}}},$t.fillCircle=function($t,$H,$I,$T){$n.drawCall++;var $K=this.ctx;$K.beginPath(),$K.fillStyle=$T,$K.arc($t+this.x,$H+this.y,$I,0,$V.PI2),$K.fill()},$t.setShader=function($t){this.ctx.setShader($t)},$t.drawLine=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=1);var $V=this.ctx;$V.beginPath(),$V.strokeStyle=$K,$V.lineWidth=$_,$V.moveTo(this.x+$t,this.y+$H),$V.lineTo(this.x+$I,this.y+$T),$V.stroke()},$t.clear=function(){this.ctx.clear()},$t.transformByMatrix=function($t){this.ctx.transformByMatrix($t)},$t.setTransform=function($t,$H,$I,$T,$K,$_){this.ctx.setTransform($t,$H,$I,$T,$K,$_)},$t.setTransformByMatrix=function($t){this.ctx.setTransformByMatrix($t)},$t.save=function(){this.ctx.save()},$t.restore=function(){this.ctx.restore()},$t.translate=function($t,$H){this.ctx.translate($t,$H)},$t.transform=function($t,$H,$I,$T,$K,$_){this.ctx.transform($t,$H,$I,$T,$K,$_)},$t.rotate=function($t){this.ctx.rotate($t)},$t.scale=function($t,$H){this.ctx.scale($t,$H)},$t.alpha=function($t){this.ctx.globalAlpha*=$t},$t.setAlpha=function($t){this.ctx.globalAlpha=$t},$t.fillWords=function($t,$H,$I,$T,$K,$_){void 0===$_&&($_=0),this.ctx.fillWords($t,$H,$I,$T,$K,$_)},$t.fillBorderWords=function($t,$H,$I,$T,$K,$_,$V){this.ctx.fillBorderWords($t,$H,$I,$T,$K,$_,$V)},$t.fillText=function($t,$H,$I,$T,$K,$_){this.ctx.fillText($t,$H+this.x,$I+this.y,$T,$K,$_)},$t.strokeText=function($t,$H,$I,$T,$K,$_,$V){this.ctx.strokeText($t,$H+this.x,$I+this.y,$T,$K,$_,$V)},$t.blendMode=function($t){this.ctx.globalCompositeOperation=$t},$t.flush=function(){this.ctx.flush&&this.ctx.flush()},$t.addRenderObject=function($t){this.ctx.addRenderObject($t)},$t.beginClip=function($t,$H,$I,$T){this.ctx.beginClip&&this.ctx.beginClip($t,$H,$I,$T)},$t.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$t.fillTrangles=function($t,$H,$I){this.ctx.fillTrangles($I[0],$I[1],$I[2],$I[3],4<$I.length?$I[4]:null)},$V.PI2=2*Math.PI,$V}(),$v=function(){function $V($t,$H){switch(this._next=$H||$V.NORENDER,$t){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$J._filter);case 69905:return void(this._fun=$V._initRenderFun)}this.onCreate($t)}$M($V,"laya.renders.RenderSprite");var $t=$V.prototype;return $t.onCreate=function($t){},$t._style=function($t,$H,$I,$T){$t._style.render($t,$H,$I,$T);var $K=this._next;$K._fun.call($K,$t,$H,$I,$T)},$t._no=function($t,$H,$I,$T){},$t._custom=function($t,$H,$I,$T){$t.customRender($H,$I,$T);var $K=$t._style._tf;this._next._fun.call(this._next,$t,$H,$I-$K.translateX,$T-$K.translateY)},$t._clip=function($t,$H,$I,$T){var $K=this._next;if($K!=$V.NORENDER){var $_=$t._style.scrollRect;$H.ctx.save(),$H.ctx.clipRect($I,$T,$_.width,$_.height),$K._fun.call($K,$t,$H,$I-$_.x,$T-$_.y),$H.ctx.restore()}},$t._blend=function($t,$H,$I,$T){var $K=$t._style;$K.blendMode&&($H.ctx.globalCompositeOperation=$K.blendMode);var $_=this._next;$_._fun.call($_,$t,$H,$I,$T),$H.ctx.globalCompositeOperation="source-over"},$t._mask=function($t,$H,$I,$T){var $K=this._next;$K._fun.call($K,$t,$H,$I,$T);var $_=$t.mask;$_&&($H.ctx.globalCompositeOperation="destination-in",(0<$_.numChildren||!$_.graphics._isOnlyOne())&&($_.cacheAsBitmap=!0),$_.render($H,$I-$t.pivotX,$T-$t.pivotY)),$H.ctx.globalCompositeOperation="source-over"},$t._graphics=function($t,$H,$I,$T){var $K=$t._style._tf;$t._graphics&&$t._graphics._render($t,$H,$I-$K.translateX,$T-$K.translateY);var $_=this._next;$_._fun.call($_,$t,$H,$I,$T)},$t._image=function($t,$H,$I,$T){var $K=$t._style;$H.ctx.drawTexture2($I,$T,$K._tf.translateX,$K._tf.translateY,$t.transform,$K.alpha,$K.blendMode,$t._graphics._one)},$t._image2=function($t,$H,$I,$T){var $K=$t._style._tf;$H.ctx.drawTexture2($I,$T,$K.translateX,$K.translateY,$t.transform,1,null,$t._graphics._one)},$t._alpha=function($t,$H,$I,$T){var $K;if(.01<($K=$t._style.alpha)||$t._needRepaint()){var $_=$H.ctx.globalAlpha;$H.ctx.globalAlpha*=$K;var $V=this._next;$V._fun.call($V,$t,$H,$I,$T),$H.ctx.globalAlpha=$_}},$t._transform=function($t,$H,$I,$T){var $K=$t.transform,$_=this._next;$K&&$_!=$V.NORENDER?($H.save(),$H.transform($K.a,$K.b,$K.c,$K.d,$K.tx+$I,$K.ty+$T),$_._fun.call($_,$t,$H,0,0),$H.restore()):$_._fun.call($_,$t,$H,$I,$T)},$t._childs=function($t,$H,$I,$T){var $K=$t._style,$_=$K._tf;if($I=$I-$_.translateX+$K.paddingLeft,$T=$T-$_.translateY+$K.paddingTop,$K._calculation){var $V=$t._getWords();if($V){var $e=$K;$e&&($e.stroke?$H.fillBorderWords($V,$I,$T,$e.font,$e.color,$e.strokeColor,$e.stroke):$H.fillWords($V,$I,$T,$e.font,$e.color,"none"!=$e.textDecoration&&$e.underLine?1:0))}}var $R,$A=$t._childs,$q=$A.length;if($t.viewport||$t.optimizeScrollRect&&$t._style.scrollRect){var $f=$t.viewport||$t._style.scrollRect,$b=$f.x,$L=$f.y,$G=$f.right,$M=$f.bottom,$O=NaN,$J=NaN;for($S=0;$S<$q;++$S)($R=$A[$S]).visible&&($O=$R._x)<$G&&$O+$R.width>$b&&($J=$R._y)<$M&&$J+$R.height>$L&&$R.render($H,$I,$T)}else for(var $S=0;$S<$q;++$S)($R=$A[$S])._style.visible&&$R.render($H,$I,$T)},$t._canvas=function($t,$H,$I,$T){var $K=$t._$P.cacheCanvas;if($K){"bitmap"===$K.type?$n.canvasBitmap++:$n.canvasNormal++;var $_=$K.ctx;if($t._needRepaint()||!$_)this._canvas_repaint($t,$H,$I,$T);else{var $V=$K._cacheRec;$H.drawCanvas($_.canvas,$I+$V.x,$T+$V.y,$V.width,$V.height)}}else this._next._fun.call(this._next,$t,$H,$I,$T)},$t._canvas_repaint=function($t,$H,$I,$T){var $K=$t._$P.cacheCanvas,$_=this._next;if($K){var $V,$e,$R,$A,$q=$K.ctx,$f=$t._needRepaint()||!$q,$b=$K.type;if("bitmap"===$b?$n.canvasBitmap++:$n.canvasNormal++,$f){var $L,$G;$K._cacheRec||($K._cacheRec=new $z),$g.isWebGL&&"bitmap"!==$b?$K._cacheRec.setTo(-$t.pivotX,-$t.pivotY,1,1):(($A=$t.getSelfBounds()).x=$A.x-$t.pivotX,$A.y=$A.y-$t.pivotY,$A.x=$A.x-16,$A.y=$A.y-16,$A.width=$A.width+32,$A.height=$A.height+32,$A.x=Math.floor($A.x+$I)-$I,$A.y=Math.floor($A.y+$T)-$T,$A.width=Math.floor($A.width),$A.height=Math.floor($A.height),$K._cacheRec.copyFrom($A)),$A=$K._cacheRec;var $M,$O=$g.isWebGL?1:$h.pixelRatio*$W.stage.clientScaleX,$J=$g.isWebGL?1:$h.pixelRatio*$W.stage.clientScaleY;if(!$g.isWebGL){var $S,$U=1,$C=1;for($S=$t;$S&&$S!=$W.stage;)$U*=$S.scaleX,$C*=$S.scaleY,$S=$S.parent;$g.isWebGL?($U<1&&($O*=$U),$C<1&&($J*=$C)):(1<$U&&($O*=$U),1<$C&&($J*=$C))}if($t.scrollRect){var $N=$t.scrollRect;$A.x-=$N.x,$A.y-=$N.y}if($L=$A.width*$O,$G=$A.height*$J,$e=$A.x,$R=$A.y,$g.isWebGL&&"bitmap"===$b&&(2048<$L||2048<$G))return console.warn("cache bitmap size larger than 2048,cache ignored"),$K.ctx&&($o.recover("RenderContext",$K.ctx),$K.ctx.canvas.size(0,0),$K.ctx=null),void $_._fun.call($_,$t,$H,$I,$T);if($q||($q=$K.ctx=$o.getItem("RenderContext")||new $l($L,$G,$Ut.create("AUTO"))),$q.ctx.sprite=$t,($V=$q.canvas).clear(),($V.width!=$L||$V.height!=$G)&&$V.size($L,$G),"bitmap"===$b?$V.context.asBitmap=!0:"normal"===$b&&($V.context.asBitmap=!1),1!=$O||1!=$J){var $w=$q.ctx;$w.save(),$w.scale($O,$J),!$g.isConchWebGL&&$g.isConchApp&&($M=$t._$P.cf)&&$w.setFilterMatrix&&$w.setFilterMatrix($M._mat,$M._alpha),$_._fun.call($_,$t,$q,-$e,-$R),$w.restore(),$g.isConchApp&&!$g.isConchWebGL||$t._applyFilters()}else $w=$q.ctx,!$g.isConchWebGL&&$g.isConchApp&&($M=$t._$P.cf)&&$w.setFilterMatrix&&$w.setFilterMatrix($M._mat,$M._alpha),$_._fun.call($_,$t,$q,-$e,-$R),$g.isConchApp&&!$g.isConchWebGL||$t._applyFilters();$t._$P.staticCache&&($K.reCache=!1),$n.canvasReCache++}else $e=($A=$K._cacheRec).x,$R=$A.y,$V=$q.canvas;$H.drawCanvas($V,$I+$e,$T+$R,$A.width,$A.height)}else $_._fun.call($_,$t,$q,$I,$T)},$V.__init__=function(){var $t,$H,$I=0;for($H=$x.createRenderSprite(69905,null),$t=$V.renders.length=4096,$I=0;$I<$t;$I++)$V.renders[$I]=$H;$V.renders[0]=$x.createRenderSprite(0,null),function($t,$H){for(var $I=0,$T=0;$T<$t.length;$T++)$I|=$t[$T],$V.renders[$I]=$H}([1,512,4,2],new $V(1,null)),$V.renders[513]=$x.createRenderSprite(513,null),$V.renders[517]=new $V(517,null)},$V._initRenderFun=function($t,$H,$I,$T){var $K=$t._renderType;($V.renders[$K]=$V._getTypeRender($K))._fun($t,$H,$I,$T)},$V._getTypeRender=function($t){for(var $H=null,$I=2048;1<$I;)$I&$t&&($H=$x.createRenderSprite($I,$H)),$I>>=1;return $H},$V.IMAGE=1,$V.ALPHA=2,$V.TRANSFORM=4,$V.BLEND=8,$V.CANVAS=16,$V.FILTERS=32,$V.MASK=64,$V.CLIP=128,$V.STYLE=256,$V.GRAPHICS=512,$V.CUSTOM=1024,$V.CHILDS=2048,$V.INIT=69905,$V.renders=[],$V.NORENDER=new $V(0,null),$V}(),$y=function(){function $e(){this._repaint=!1}$M($e,"laya.resource.Context");var $t=$e.prototype;return $t.replaceReset=function(){var $t,$H,$I=0;for($t=$e.replaceKeys.length,$I=0;$I<$t;$I++)$H=$e.replaceKeys[$I],this[$e.newKeys[$I]]=this[$H]},$t.replaceResotre=function(){this.__restore(),this.__reset()},$t.setIsMainContext=function(){},$t.drawTextures=function($t,$H,$I,$T){$n.drawCall+=$H.length/2;for(var $K=$t.width,$_=$t.height,$V=0,$e=$H.length;$V<$e;$V+=2)this.drawTexture($t,$H[$V],$H[$V+1],$K,$_,$I,$T)},$t.drawCanvas=function($t,$H,$I,$T,$K){$n.drawCall++,this.drawImage($t.source,$H,$I,$T,$K)},$t.fillRect=function($t,$H,$I,$T,$K){$n.drawCall++,$K&&(this.fillStyle=$K),this.__fillRect($t,$H,$I,$T)},$t.fillText=function($t,$H,$I,$T,$K,$_){$n.drawCall++,3<arguments.length&&null!=$T&&(this.font=$T,this.fillStyle=$K,this.textAlign=$_,this.textBaseline="top"),this.__fillText($t,$H,$I)},$t.fillBorderText=function($t,$H,$I,$T,$K,$_,$V,$e){$n.drawCall++,this.font=$T,this.fillStyle=$K,this.textBaseline="top",this.strokeStyle=$_,this.lineWidth=$V,this.textAlign=$e,this.__strokeText($t,$H,$I),this.__fillText($t,$H,$I)},$t.strokeText=function($t,$H,$I,$T,$K,$_,$V){$n.drawCall++,3<arguments.length&&null!=$T&&(this.font=$T,this.strokeStyle=$K,this.lineWidth=$_,this.textAlign=$V,this.textBaseline="top"),this.__strokeText($t,$H,$I)},$t.transformByMatrix=function($t){this.transform($t.a,$t.b,$t.c,$t.d,$t.tx,$t.ty)},$t.setTransformByMatrix=function($t){this.setTransform($t.a,$t.b,$t.c,$t.d,$t.tx,$t.ty)},$t.clipRect=function($t,$H,$I,$T){$n.drawCall++,this.beginPath(),this.rect($t,$H,$I,$T),this.clip()},$t.drawTexture=function($t,$H,$I,$T,$K,$_,$V){$n.drawCall++;var $e=$t.uv,$R=$t.bitmap.width,$A=$t.bitmap.height;this.drawImage($t.source,$e[0]*$R,$e[1]*$A,($e[2]-$e[0])*$R,($e[5]-$e[3])*$A,$H+$_,$I+$V,$T,$K)},$t.drawTextureWithTransform=function($t,$H,$I,$T,$K,$_,$V,$e,$R){$n.drawCall++;var $A=$t.uv,$q=$t.bitmap.width,$f=$t.bitmap.height;this.save(),1!=$R&&(this.globalAlpha*=$R),$_?(this.transform($_.a,$_.b,$_.c,$_.d,$_.tx+$V,$_.ty+$e),this.drawImage($t.source,$A[0]*$q,$A[1]*$f,($A[2]-$A[0])*$q,($A[5]-$A[3])*$f,$H,$I,$T,$K)):this.drawImage($t.source,$A[0]*$q,$A[1]*$f,($A[2]-$A[0])*$q,($A[5]-$A[3])*$f,$H+$V,$I+$e,$T,$K),this.restore()},$t.drawTexture2=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=$e[0];if($R.loaded&&$R.bitmap&&$R.source){$n.drawCall++;var $A=1!==$_;if($A){var $q=this.globalAlpha;this.globalAlpha*=$_}var $f=$R.uv,$b=$R.bitmap.width,$L=$R.bitmap.height;$K?(this.save(),this.transform($K.a,$K.b,$K.c,$K.d,$K.tx+$t,$K.ty+$H),this.drawImage($R.source,$f[0]*$b,$f[1]*$L,($f[2]-$f[0])*$b,($f[5]-$f[3])*$L,$e[1]-$I,$e[2]-$T,$e[3],$e[4]),this.restore()):this.drawImage($R.source,$f[0]*$b,$f[1]*$L,($f[2]-$f[0])*$b,($f[5]-$f[3])*$L,$e[1]-$I+$t,$e[2]-$T+$H,$e[3],$e[4]),$A&&(this.globalAlpha=$q)}},$t.fillTexture=function($t,$H,$I,$T,$K,$_,$V,$e){if(!$e.pat){if($t.uv!=$qt.DEF_UV){var $R=new $Ut("2D");$R.getContext("2d"),$R.size($t.width,$t.height),$R.context.drawTexture($t,0,0,$t.width,$t.height,0,0),$t=new $qt($R)}$e.pat=this.createPattern($t.bitmap.source,$_)}var $A=$H,$q=$I,$f=0,$b=0;$V&&($A+=$V.x%$t.width,$q+=$V.y%$t.height,$f-=$V.x%$t.width,$b-=$V.y%$t.height),this.translate($A,$q),this.fillRect($f,$b,$T,$K,$e.pat),this.translate(-$A,-$q)},$t.drawTriangle=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=$t.bitmap,$A=$R.source,$q=$t.width,$f=$t.height,$b=$R.width,$L=$R.height,$G=$I[$T]*$b,$M=$I[$K]*$b,$O=$I[$_]*$b,$J=$I[$T+1]*$L,$S=$I[$K+1]*$L,$U=$I[$_+1]*$L,$C=$H[$T],$N=$H[$K],$w=$H[$_],$W=$H[$T+1],$s=$H[$K+1],$z=$H[$_+1];if($e){var $P=($C+$N+$w)/3,$k=($W+$s+$z)/3,$r=$C-$P,$x=$W-$k,$Y=Math.sqrt($r*$r+$x*$x);$C=$P+$r/$Y*($Y+1),$W=$k+$x/$Y*($Y+1),$x=$s-$k,$N=$P+($r=$N-$P)/($Y=Math.sqrt($r*$r+$x*$x))*($Y+1),$s=$k+$x/$Y*($Y+1),$x=$z-$k,$w=$P+($r=$w-$P)/($Y=Math.sqrt($r*$r+$x*$x))*($Y+1),$z=$k+$x/$Y*($Y+1)}this.save(),$V&&this.transform($V.a,$V.b,$V.c,$V.d,$V.tx,$V.ty),this.beginPath(),this.moveTo($C,$W),this.lineTo($N,$s),this.lineTo($w,$z),this.closePath(),this.clip();var $D=1/($G*$S+$J*$O+$M*$U-$S*$O-$J*$M-$G*$U),$p=$C*$S+$J*$w+$N*$U-$S*$w-$J*$N-$C*$U,$g=$G*$N+$C*$O+$M*$w-$N*$O-$C*$M-$G*$w,$l=$G*$S*$w+$J*$N*$O+$C*$M*$U-$C*$S*$O-$J*$M*$w-$G*$N*$U,$v=$W*$S+$J*$z+$s*$U-$S*$z-$J*$s-$W*$U,$y=$G*$s+$W*$O+$M*$z-$s*$O-$W*$M-$G*$z,$E=$G*$S*$z+$J*$s*$O+$W*$M*$U-$W*$S*$O-$J*$M*$z-$G*$s*$U;this.transform($p*$D,$v*$D,$g*$D,$y*$D,$l*$D,$E*$D),this.drawImage($A,$t.uv[0]*$b,$t.uv[1]*$L,$q,$f,$t.uv[0]*$b,$t.uv[1]*$L,$q,$f),this.restore()},$t.flush=function(){return 0},$t.fillWords=function($t,$H,$I,$T,$K,$_){$T&&(this.font=$T),$K&&(this.fillStyle=$K);this.textBaseline="top",this.textAlign="left";for(var $V=0,$e=$t.length;$V<$e;$V++){var $R=$t[$V];if(this.__fillText($R.char,$R.x+$H,$R.y+$I),1===$_){var $A=$R.height,$q=.5*$R.style.letterSpacing;$q||($q=0),this.beginPath(),this.strokeStyle=$K,this.lineWidth=1,this.moveTo($H+$R.x-$q+.5,$I+$R.y+$A+.5),this.lineTo($H+$R.x+$R.width+$q+.5,$I+$R.y+$A+.5),this.stroke()}}},$t.fillBorderWords=function($t,$H,$I,$T,$K,$_,$V){$T&&(this.font=$T),$K&&(this.fillStyle=$K),this.textBaseline="top",this.lineWidth=$V,this.textAlign="left",this.strokeStyle=$_;for(var $e=0,$R=$t.length;$e<$R;$e++){var $A=$t[$e];this.__strokeText($A.char,$A.x+$H,$A.y+$I),this.__fillText($A.char,$A.x+$H,$A.y+$I)}},$t.destroy=function(){this.canvas.width=this.canvas.height=0},$t.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$t.drawCurves=function($t,$H,$I){this.beginPath(),this.strokeStyle=$I[3],this.lineWidth=$I[4];var $T=$I[2];$t+=$I[0],$H+=$I[1],this.moveTo($t+$T[0],$H+$T[1]);for(var $K=2,$_=$T.length;$K<$_;)this.quadraticCurveTo($t+$T[$K++],$H+$T[$K++],$t+$T[$K++],$H+$T[$K++]);this.stroke()},$e.__init__=function($H){var $I=laya.resource.Context.prototype;if(!($H=$H||CanvasRenderingContext2D.prototype).inited){$H.inited=!0,$H.__fillText=$H.fillText,$H.__fillRect=$H.fillRect,$H.__strokeText=$H.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($t){$H[$t]=$I[$t]})}},$e.replaceCanvasGetSet=function($t,$H){var $I=Object.getOwnPropertyDescriptor($t,$H);if(!$I||!$I.configurable)return!1;var $T,$K={};for($T in $I)"set"!=$T&&($K[$T]=$I[$T]);var $_=$I.set;return $K.set=function($t){$_.call(this,$t);var $H=this.getContext("2d");$H&&"__reset"in $H&&$H.__reset()},Object.defineProperty($t,$H,$K),!0},$e.replaceGetSet=function($t,$H){var $I=Object.getOwnPropertyDescriptor($t,$H);if(!$I||!$I.configurable)return!1;var $T,$K={};for($T in $I)"set"!=$T&&($K[$T]=$I[$T]);var $_=$I.set,$V="___"+$H+"__";return $e.newKeys.push($V),$K.set=function($t){$t!=this[$V]&&(this[$V]=$t,$_.call(this,$t))},Object.defineProperty($t,$H,$K),!0},$e._default=new $e,$e.newKeys=[],$R($e,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$e}(),$E=function(){function $_($t){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$_._uniqueIDCounter,this._name=$t||"Content Manager",$_._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$_._resourceManagers.push(this),this._resources=[],this._records={}}$M($_,"laya.resource.ResourceManager");var $t=$_.prototype;return $W.imps($t,{"laya.resource.IDispose":!0}),$t.getResourceByIndex=function($t){return this._resources[$t]},$t.getResourcesLength=function(){return this._resources.length},$t.addResource=function($t){return $t.resourceManager&&$t.resourceManager.removeResource($t),-1===this._resources.indexOf($t)&&(($t._resourceManager=this)._resources.push($t),this.addRecord($t.uri,$t.__className,$t.memorySize),this.addSize($t.memorySize),!0)},$t.removeResource=function($t){var $H=this._resources.indexOf($t);return-1!==$H&&(this._resources.splice($H,1),$t._resourceManager=null,this._memorySize-=$t.memorySize,this.addRecord($t.uri,$t.__className,-$t.memorySize),!0)},$t.unload=function(){for(var $t=this._resources.slice(0,this._resources.length),$H=0;$H<$t.length;$H++){$t[$H].destroy()}$t.length=0},$t.dispose=function(){if(this===$_._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$_._resourceManagers.splice($_._resourceManagers.indexOf(this),1),$_._isResourceManagersSorted=!1;for(var $t=this._resources.slice(0,this._resources.length),$H=0;$H<$t.length;$H++){var $I=$t[$H];$I.resourceManager.removeResource($I),$I.destroy()}$t.length=0},$t.addSize=function($t){$t&&(this.autoRelease&&0<$t&&this._memorySize+$t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$t)},$t.addRecord=function($t,$H,$I){DEBUG&&$I&&!$t&&console.error($t,$H,$I)},$t.garbageCollection=function($t){var $H=this._resources;($H=$H.slice()).sort(function($t,$H){if(!$t||!$H)throw new Error("a或b不能为空！");return $t.released&&$H.released?0:$t.released?1:$H.released?-1:$t._lastUseFrameCount-$H._lastUseFrameCount});for(var $I=$n.loopCount,$T=0,$K=$H.length;$T<$K;$T++){var $_=$H[$T];if(!(1<$I-$_._lastUseFrameCount))return void(this._memorySize>=$t&&(this._isOverflow=!0));if($_.releaseResource(),this._memorySize<$t)return void(this._isOverflow=!1)}},$q(0,$t,"id",function(){return this._id}),$q(0,$t,"name",function(){return this._name},function($t){!$t&&""===$t||this._name===$t||(this._name=$t,$_._isResourceManagersSorted=!1)}),$q(0,$t,"memorySize",function(){return this._memorySize}),$q(0,$t,"records",function(){return this._records}),$q(1,$_,"systemResourceManager",function(){return $_._systemResourceManager}),$_.__init__=function(){$_.currentResourceManager=$_.systemResourceManager},$_.getLoadedResourceManagerByIndex=function($t){return $_._resourceManagers[$t]},$_.getLoadedResourceManagersCount=function(){return $_._resourceManagers.length},$_.recreateContentManagers=function($t){void 0===$t&&($t=!1);for(var $H=$_.currentResourceManager,$I=0;$I<$_._resourceManagers.length;$I++){$_.currentResourceManager=$_._resourceManagers[$I];for(var $T=0;$T<$_.currentResourceManager._resources.length;$T++)$_.currentResourceManager._resources[$T].releaseResource($t),$_.currentResourceManager._resources[$T].activeResource($t)}$_.currentResourceManager=$H},$_.releaseContentManagers=function($t){void 0===$t&&($t=!1);for(var $H=$_.currentResourceManager,$I=0;$I<$_._resourceManagers.length;$I++){$_.currentResourceManager=$_._resourceManagers[$I];for(var $T=0;$T<$_.currentResourceManager._resources.length;$T++){var $K=$_.currentResourceManager._resources[$T];!$K.released&&$K.releaseResource($t)}}$_.currentResourceManager=$H},$_._uniqueIDCounter=0,$_._isResourceManagersSorted=!1,$_._resourceManagers=[],$R($_,["_systemResourceManager",function(){return this._systemResourceManager=new $_("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$_._systemResourceManager}]),$_}(),$h=(function(){function $t(){}$M($t,"laya.system.System"),$t.changeDefinition=function($t,$H){$W[$t]=$H;var $I=$t+"=classObj";$W._runScript($I)},$t.__init__=function(){$g.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $I(){}return $M($I,"laya.utils.Browser"),$q(1,$I,"pixelRatio",function(){return $I.__init__(),-1<$I.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$x.getPixelRatio()}),$q(1,$I,"height",function(){return $I.__init__(),($W.stage&&$W.stage.canvasRotation?$I.clientWidth:$I.clientHeight)*$I.pixelRatio}),$q(1,$I,"clientWidth",function(){return $I.__init__(),$I.window.innerWidth||$I.document.body.clientWidth}),$q(1,$I,"window",function(){return $I.__init__(),$I._window}),$q(1,$I,"clientHeight",function(){return $I.__init__(),$I.window.innerHeight||$I.document.body.clientHeight||$I.document.documentElement.clientHeight}),$q(1,$I,"width",function(){return $I.__init__(),($W.stage&&$W.stage.canvasRotation?$I.clientHeight:$I.clientWidth)*$I.pixelRatio}),$q(1,$I,"container",function(){return $I.__init__(),$I._container||(($I._container=$I.createElement("div")).id="layaContainer",$I.document.body.appendChild($I._container)),$I._container},function($t){$I._container=$t}),$q(1,$I,"document",function(){return $I.__init__(),$I._document}),$I.__init__=function(){if(!$I._window){$I._window=$x.getWindow(),$I._document=$I.window.document,$I._window.addEventListener("message",function($t){laya.utils.Browser._onMessage($t)},!1),$I.document.__createElement=$I.document.createElement,$V.requestAnimationFrame=$V.requestAnimationFrame||$V.webkitRequestAnimationFrame||$V.mozRequestAnimationFrame||$V.oRequestAnimationFrame||$V.msRequestAnimationFrame||function($t){return $V.setTimeout($t,1e3/60)};var $t=$V.document.body.style;$t["-webkit-user-select"]="none",$t["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$I.userAgent=$I.window.navigator.userAgent,$I.onIOS=!!($I.u=$I.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$I.onMobile=-1<$I.u.indexOf("Mobile"),$I.onIPhone=-1<$I.u.indexOf("iPhone"),$I.onMac=-1<$I.u.indexOf("Mac OS X"),$I.onIPad=-1<$I.u.indexOf("iPad"),$I.onAndroid=-1<$I.u.indexOf("Android")||-1<$I.u.indexOf("Adr"),$I.onWP=-1<$I.u.indexOf("Windows Phone"),$I.onQQBrowser=-1<$I.u.indexOf("QQBrowser"),$I.onMQQBrowser=-1<$I.u.indexOf("MQQBrowser")||-1<$I.u.indexOf("Mobile")&&-1<$I.u.indexOf("QQ"),$I.onIE=!!$I.window.ActiveXObject||"ActiveXObject"in $I.window,$I.onWeiXin=-1<$I.u.indexOf("MicroMessenger"),$I.onPC=!$I.onMobile,$I.onSafari=-1<$I.u.indexOf("Safari"),$I.onFirefox=-1<$I.u.indexOf("Firefox"),$I.onEdge=-1<$I.u.indexOf("Edge"),$I.onMiniGame=-1<$I.u.indexOf("MiniGame"),$I.onLimixiu=-1<$I.u.indexOf("limixiu"),$I.httpProtocol="http:"==$I.window.location.protocol,$I.onMiniGame&&null==$I.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$I.webAudioEnabled=!!($I.window.AudioContext||$I.window.webkitAudioContext||$I.window.mozAudioContext),$I.soundType=$I.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$Kt=$I.webAudioEnabled?$_t:$It,$I.webAudioEnabled&&$_t.initWebAudio(),$It._initMusicAudio(),$I.enableTouch="ontouchstart"in $V||$V.DocumentTouch&&$H instanceof DocumentTouch,$V.focus(),$r._soundClass=$Kt,$r._musicClass=$It,$g._mainCanvas=$g._mainCanvas||$Ut.create("2D"),$I.canvas||($I.canvas=$Ut.create("2D"),$I.context=$I.canvas.getContext("2d"))}},$I._onMessage=function($t){if($t.data&&"size"==$t.data.name){if($I.window.innerWidth=$t.data.width,$I.window.innerHeight=$t.data.height,$I.window.__innerHeight=$t.data.clientHeight,!$I.document.createEvent)return void console.warn("no document.createEvent");var $H=$I.document.createEvent("HTMLEvents");return $H.initEvent("resize",!1,!1),void $I.window.dispatchEvent($H)}},$I.createElement=function($t){return $I.__init__(),$I.document.__createElement($t)},$I.getElementById=function($t){return $I.__init__(),$I.document.getElementById($t)},$I.removeElement=function($t){$t&&$t.parentNode&&$t.parentNode.removeChild($t)},$I.now=function(){return $x.now()},$I._window=null,$I._document=null,$I._container=null,$I.userAgent=null,$I.u=null,$I.onIOS=!1,$I.onMac=!1,$I.onMobile=!1,$I.onIPhone=!1,$I.onIPad=!1,$I.onAndroid=!1,$I.onWP=!1,$I.onQQBrowser=!1,$I.onMQQBrowser=!1,$I.onSafari=!1,$I.onFirefox=!1,$I.onEdge=!1,$I.onIE=!1,$I.onWeiXin=!1,$I.onMiniGame=!1,$I.onLimixiu=!1,$I.onPC=!1,$I.httpProtocol=!1,$I.webAudioEnabled=!1,$I.soundType=null,$I.enableTouch=!1,$I.canvas=null,$I.context=null,$I.__init$=function(){},$I}()),$X=function(){function $H($t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$t?(this._u8d_=new Uint8Array($t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$M($H,"laya.utils.Byte");var $t=$H.prototype;return $t.___resizeBuffer=function($H){try{var $t=new Uint8Array($H);null!=this._u8d_&&(this._u8d_.length<=$H?$t.set(this._u8d_):$t.set(this._u8d_.subarray(0,$H))),this._u8d_=$t,this._d_=new DataView($t.buffer)}catch($t){throw"___resizeBuffer err:"+$H}},$t.getString=function(){return this.rUTF(this.getUint16())},$t.getFloat32Array=function($t,$H){var $I=$t+$H;$I=$I>this._length?this._length:$I;var $T=new Float32Array(this._d_.buffer.slice($t,$I));return this._pos_=$I,$T},$t.getUint8Array=function($t,$H){var $I=$t+$H;$I=$I>this._length?this._length:$I;var $T=new Uint8Array(this._d_.buffer.slice($t,$I));return this._pos_=$I,$T},$t.getInt16Array=function($t,$H){var $I=$t+$H;$I=$I>this._length?this._length:$I;var $T=new Int16Array(this._d_.buffer.slice($t,$I));return this._pos_=$I,$T},$t.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$t},$t.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$t},$t.writeFloat32=function($t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$t,this._xd_),this._pos_+=4},$t.writeFloat64=function($t){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$t,this._xd_),this._pos_+=8},$t.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$t},$t.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$t},$t.writeInt32=function($t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$t,this._xd_),this._pos_+=4},$t.writeUint32=function($t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$t,this._xd_),this._pos_+=4},$t.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$t},$t.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$t},$t.writeUint16=function($t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$t,this._xd_),this._pos_+=2},$t.writeInt16=function($t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$t,this._xd_),this._pos_+=2},$t.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$t.writeUint8=function($t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$t),this._pos_++},$t._getUInt8=function($t){return this._d_.getUint8($t)},$t._getUint16=function($t){return this._d_.getUint16($t,this._xd_)},$t._getMatrix=function(){return new $Y(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$t.rUTF=function($t){for(var $H=[],$I=this._pos_+$t,$T=0,$K=0,$_=0,$V=String.fromCharCode,$e=this._u8d_;this._pos_<$I;)($T=$e[this._pos_++])<128?0!=$T&&$H.push($V($T)):$T<224?$H.push($V((63&$T)<<6|127&$e[this._pos_++])):$T<240?($K=$e[this._pos_++],$H.push($V((31&$T)<<12|(127&$K)<<6|127&$e[this._pos_++]))):($K=$e[this._pos_++],$_=$e[this._pos_++],$H.push($V((15&$T)<<18|(127&$K)<<12|$_<<6&127|127&$e[this._pos_++]))),0;return $H.join("")},$t.getCustomString=function($t){for(var $H=[],$I=0,$T=0,$K=0,$_=String.fromCharCode,$V=this._u8d_;0<$t;)if(($T=$V[this._pos_])<128)$H.push($_($T)),this._pos_++,$t--;else for($I=$T-128,this._pos_++,$t-=$I;0<$I;)$T=$V[this._pos_++],$K=$V[this._pos_++],$H.push($_($K<<8|$T)),$I--;return $H.join("")},$t.clear=function(){this._pos_=0,this.length=0},$t.__getBuffer=function(){return this._d_.buffer},$t.writeUTFBytes=function($t){for(var $H=0,$I=($t+="").length;$H<$I;$H++){var $T=$t.charCodeAt($H);$T<=127?this.writeByte($T):$T<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$T>>6,128|63&$T],this._pos_),this._pos_+=2):$T<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$T>>12,128|$T>>6&63,128|63&$T],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$T>>18,128|$T>>12&63,128|$T>>6&63,128|63&$T],this._pos_),this._pos_+=4)}},$t.writeUTFString=function($t){var $H=this.pos;this.writeUint16(1),this.writeUTFBytes($t);var $I=this.pos-$H-2;if(65536<=$I)throw"writeUTFString byte len more than 65536";this._d_.setUint16($H,$I,this._xd_)},$t.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$t.getUTFString=function(){return this.readUTFString()},$t.readUTFBytes=function($t){if(void 0===$t&&($t=-1),0==$t)return"";var $H=this.bytesAvailable;if($H<$t)throw"readUTFBytes error - Out of bounds";return $t=0<$t?$t:$H,this.rUTF($t)},$t.getUTFBytes=function($t){return void 0===$t&&($t=-1),this.readUTFBytes($t)},$t.writeByte=function($t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$t),this._pos_+=1},$t.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$t.getByte=function(){return this.readByte()},$t.ensureWrite=function($t){this._length<$t&&(this._length=$t),this._allocated_<$t&&(this.length=$t)},$t.writeArrayBuffer=function($t,$H,$I){if(void 0===$H&&($H=0),void 0===$I&&($I=0),$H<0||$I<0)throw"writeArrayBuffer error - Out of bounds";0==$I&&($I=$t.byteLength-$H),this.ensureWrite(this._pos_+$I);var $T=new Uint8Array($t);this._u8d_.set($T.subarray($H,$H+$I),this._pos_),this._pos_+=$I},$q(0,$t,"buffer",function(){var $t=this._d_.buffer;return $t.byteLength==this.length?$t:$t.slice(0,this.length)}),$q(0,$t,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($t){this._xd_="littleEndian"==$t}),$q(0,$t,"length",function(){return this._length},function($t){this._allocated_<$t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($t,2*this._allocated_))):this._allocated_>$t&&this.___resizeBuffer(this._allocated_=$t),this._length=$t}),$q(0,$t,"pos",function(){return this._pos_},function($t){this._pos_=$t}),$q(0,$t,"bytesAvailable",function(){return this._length-this._pos_}),$H.getSystemEndian=function(){if(!$H._sysEndian){var $t=new ArrayBuffer(2);new DataView($t).setInt16(0,256,!0),$H._sysEndian=256===new Int16Array($t)[0]?"littleEndian":"bigEndian"}return $H._sysEndian},$H.BIG_ENDIAN="bigEndian",$H.LITTLE_ENDIAN="littleEndian",$H._sysEndian=null,$H}(),$B=function(){function $K(){}return $M($K,"laya.utils.CacheManager"),$K.regCacheByFunction=function($t,$H){var $I;$K.unRegCacheByFunction($t,$H),$I={tryDispose:$t,getCacheList:$H},$K._cacheList.push($I)},$K.unRegCacheByFunction=function($t,$H){var $I,$T=0;for($I=$K._cacheList.length,$T=0;$T<$I;$T++)if($K._cacheList[$T].tryDispose==$t&&$K._cacheList[$T].getCacheList==$H)return void $K._cacheList.splice($T,1)},$K.forceDispose=function(){var $t=0,$H=$K._cacheList.length;for($t=0;$t<$H;$t++)$K._cacheList[$t].tryDispose(!0)},$K.beginCheck=function($t){void 0===$t&&($t=15e3),$W.timer.loop($t,null,$K._checkLoop)},$K.stopCheck=function(){$W.timer.clear(null,$K._checkLoop)},$K._checkLoop=function(){var $t=$K._cacheList;if(!($t.length<1)){var $H,$I=$h.now(),$T=0;for($H=$T=$t.length;0<$T&&($t[$K._index=++$K._index%$H].tryDispose(!1),!($h.now()-$I>$K.loopTimeLimit));)$T--}},$K.loopTimeLimit=2,$K._cacheList=[],$K._index=0,$K}(),$a=function(){function $L(){}return $M($L,"laya.utils.ClassUtils"),$L.regClass=function($t,$H){$L._classMap[$t]=$H},$L.getRegClass=function($t){return $L._classMap[$t]},$L.getInstance=function($t){var $H=$L.getClass($t);return $H?new $H:(console.warn("[error] Undefined class:",$t),null)},$L.createByJson=function($t,$H,$I,$T,$K){"string"==typeof $t&&($t=JSON.parse($t));var $_=$t.props;if(!$H&&!($H=$K?$K.runWith($t):$L.getInstance($_.runtime||$t.type)))return null;var $V=$t.child;if($V)for(var $e=0,$R=$V.length;$e<$R;$e++){var $A=$V[$e];if("render"!==$A.props.name&&"render"!==$A.props.renderType||!$H._$set_itemRender)if("Graphic"==$A.type)$L.addGraphicsToSprite($A,$H);else if($L.isDrawType($A.type))$L.addGraphicToSprite($A,$H,!0);else{var $q=$L.createByJson($A,null,$I,$T,$K);"Script"==$A.type?$q.hasOwnProperty("owner")?$q.owner=$H:$q.hasOwnProperty("target")&&($q.target=$H):"mask"==$A.props.renderType?$H.mask=$q:$H.addChild($q)}else $H.itemRender=$A}if($_)for(var $f in $_){var $b=$_[$f];"var"===$f&&$I?$I[$b]=$H:$b instanceof Array&&"function"==typeof $H[$f]?$H[$f].apply($H,$b):$H[$f]=$b}return $T&&$t.customProps&&$T.runWith([$H,$t]),$H.created&&$H.created(),$H},$L.addGraphicsToSprite=function($t,$H){var $I;if(($I=$t.child)&&!($I.length<1)){var $T;$T=$L._getGraphicsFromSprite($t,$H);var $K=0,$_=0;$t.props&&($K=$L._getObjVar($t.props,"x",0),$_=$L._getObjVar($t.props,"y",0)),0!=$K&&0!=$_&&$T.translate($K,$_);var $V,$e=0;for($V=$I.length,$e=0;$e<$V;$e++)$L._addGraphicToGraphics($I[$e],$T);0!=$K&&0!=$_&&$T.translate(-$K,-$_)}},$L.addGraphicToSprite=function($t,$H,$I){var $T;void 0===$I&&($I=!1),$T=$I?$L._getGraphicsFromSprite($t,$H):$H.graphics,$L._addGraphicToGraphics($t,$T)},$L._getGraphicsFromSprite=function($t,$H){var $I,$T;if(!$t||!$t.props)return $H.graphics;switch($T=$t.props.renderType){case"hit":case"unHit":var $K;$H.hitArea||($H.hitArea=new $m),($K=$H.hitArea)[$T]||($K[$T]=new $b),$I=$K[$T]}return $I||($I=$H.graphics),$I},$L._getTransformData=function($t){var $H;($t.hasOwnProperty("pivotX")||$t.hasOwnProperty("pivotY"))&&($H=$H||new $Y).translate(-$L._getObjVar($t,"pivotX",0),-$L._getObjVar($t,"pivotY",0));var $I=$L._getObjVar($t,"scaleX",1),$T=$L._getObjVar($t,"scaleY",1),$K=$L._getObjVar($t,"rotation",0);$L._getObjVar($t,"skewX",0),$L._getObjVar($t,"skewY",0);return 1==$I&&1==$T&&0==$K||(($H=$H||new $Y).scale($I,$T),$H.rotate(.0174532922222222*$K)),$H},$L._addGraphicToGraphics=function($t,$H){var $I,$T;if(($I=$t.props)&&($T=$L.DrawTypeDic[$t.type])){var $K,$_;$K=$H;var $V=$L._getParams($I,$T[1],$T[2],$T[3]);(($_=$L._tM)||1!=$L._alpha)&&($K.save(),$_&&$K.transform($_),1!=$L._alpha&&$K.alpha($L._alpha)),$K[$T[0]].apply($K,$V),($_||1!=$L._alpha)&&$K.restore()}},$L._adptLineData=function($t){return $t[2]=parseFloat($t[0])+parseFloat($t[2]),$t[3]=parseFloat($t[1])+parseFloat($t[3]),$t},$L._adptTextureData=function($t){return $t[0]=$et.getRes($t[0]),$t},$L._adptLinesData=function($t){return $t[2]=$L._getPointListByStr($t[2]),$t},$L.isDrawType=function($t){return"Image"!=$t&&$L.DrawTypeDic.hasOwnProperty($t)},$L._getParams=function($t,$H,$I,$T){var $K;void 0===$I&&($I=0),($K=$L._temParam).length=$H.length;var $_,$V,$e=0;for($_=$H.length,$e=0;$e<$_;$e++)$K[$e]=$L._getObjVar($t,$H[$e][0],$H[$e][1]);return $L._alpha=$L._getObjVar($t,"alpha",1),$V=$L._getTransformData($t),$L._tM=$V?($I||($I=0),$V.translate($K[$I],$K[$I+1]),$K[$I]=$K[$I+1]=0,$V):null,$T&&$L[$T]&&($K=$L[$T]($K)),$K},$L._getPointListByStr=function($t){var $H,$I,$T=0;for($I=($H=$t.split(",")).length,$T=0;$T<$I;$T++)$H[$T]=parseFloat($H[$T]);return $H},$L._getObjVar=function($t,$H,$I){return $t.hasOwnProperty($H)?$t[$H]:$I},$L._temParam=[],$L._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$L.getClass=function($t){var $H=$L._classMap[$t]||$t;return"string"==typeof $H?$W.__classmap[$H]:$H},$L._tM=null,$L._alpha=NaN,$R($L,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$L}(),$u=function(){function $_($t){if(this._color=[],"string"==typeof $t){null===(this.strColor=$t)&&($t="#000000"),"#"==$t.charAt(0)&&($t=$t.substr(1));var $H=$t.length;if(3==$H||4==$H){for(var $I="",$T=0;$T<$H;$T++)$I+=$t[$T]+$t[$T];$t=$I}var $K=this.numColor=parseInt($t,16);if(8==$t.length)return void(this._color=[parseInt($t.substr(0,2),16)/255,((16711680&$K)>>16)/255,((65280&$K)>>8)/255,(255&$K)/255])}else $K=this.numColor=$t,this.strColor=$i.toHexColor($K);this._color=[((16711680&$K)>>16)/255,((65280&$K)>>8)/255,(255&$K)/255,1],this._color.__id=++$_._COLODID}return $M($_,"laya.utils.Color"),$_._initDefault=function(){for(var $t in $_._DEFAULT={},$_._COLOR_MAP)$_._SAVE[$t]=$_._DEFAULT[$t]=new $_($_._COLOR_MAP[$t]);return $_._DEFAULT},$_._initSaveMap=function(){for(var $t in $_._SAVE_SIZE=0,$_._SAVE={},$_._DEFAULT)$_._SAVE[$t]=$_._DEFAULT[$t]},$_.create=function($t){var $H=$_._SAVE[$t+""];return null!=$H?$H:($_._SAVE_SIZE<1e3||$_._initSaveMap(),$_._SAVE[$t+""]=new $_($t))},$_._SAVE={},$_._SAVE_SIZE=0,$_._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$_._DEFAULT=$_._initDefault(),$_._COLODID=1,$_}(),$$=(function(){function $t(){this._values=[],this._keys=[]}$M($t,"laya.utils.Dictionary");var $H=$t.prototype;$H.set=function($t,$H){var $I=this.indexOf($t);0<=$I?this._values[$I]=$H:(this._keys.push($t),this._values.push($H))},$H.indexOf=function($t){var $H=this._keys.indexOf($t);return 0<=$H?$H:($t="string"==typeof $t?Number($t):"number"==typeof $t?$t.toString():$t,this._keys.indexOf($t))},$H.get=function($t){var $H=this.indexOf($t);return $H<0?null:this._values[$H]},$H.remove=function($t){var $H=this.indexOf($t);return 0<=$H&&(this._keys.splice($H,1),this._values.splice($H,1),!0)},$H.clear=function(){this._values.length=0,this._keys.length=0},$q(0,$H,"values",function(){return this._values}),$q(0,$H,"keys",function(){return this._keys})}(),function(){function $t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$M($t,"laya.utils.Dragging");var $H=$t.prototype;return $H.start=function($t,$H,$I,$T,$K,$_,$V,$e){void 0===$e&&($e=.92),this.clearTimer(),this.target=$t,this.area=$H,this.hasInertia=$I,this.elasticDistance=$H?$T:0,this.elasticBackTime=$K,this.data=$_,this._disableMouseEvent=$V,this.ratio=$e,1!=$t.globalScaleX||1!=$t.globalScaleY?this._parent=$t.parent:this._parent=$W.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$W.stage.on("mouseup",this,this.onStageMouseUp),$W.stage.on("mouseout",this,this.onStageMouseUp),$W.timer.frameLoop(1,this,this.loop)},$H.clearTimer=function(){$W.timer.clear(this,this.loop),$W.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$H.stop=function(){this._dragging&&($G.instance.disableMouseEvent=!1,$W.stage.off("mouseup",this,this.onStageMouseUp),$W.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$H.loop=function(){var $t=this._parent.getMousePoint(),$H=$t.x,$I=$t.y,$T=$H-this._lastX,$K=$I-this._lastY;if(this._clickOnly){if(!(1<Math.abs($T*$W.stage._canvasTransform.getScaleX())||1<Math.abs($K*$W.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$G.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($T,$K);0==$T&&0==$K||(this._lastX=$H,this._lastY=$I,this.target.x+=$T*this._elasticRateX,this.target.y+=$K*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$H.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $t=this.area.x-this.target.x;else $t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$t/this.elasticDistance),this.target.y<this.area.y)var $H=this.area.y-this.target.y;else $H=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$H/this.elasticDistance)}},$H.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$H.onStageMouseUp=function($t){if($G.instance.disableMouseEvent=!1,$W.stage.off("mouseup",this,this.onStageMouseUp),$W.stage.off("mouseout",this,this.onStageMouseUp),$W.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $H=this._offsets.length,$I=Math.min($H,6),$T=this._offsets.length-$I,$K=$H-1;$T<$K;$K--)this._offsetY+=this._offsets[$K--],this._offsetX+=this._offsets[$K];this._offsetX=this._offsetX/$I*2,this._offsetY=this._offsetY/$I*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$W.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$H.checkElastic=function(){var $t=NaN,$H=NaN;if(this.target.x<this.area.x?$t=this.area.x:this.target.x>this.area.x+this.area.width&&($t=this.area.x+this.area.width),this.target.y<this.area.y?$H=this.area.y:this.target.y>this.area.y+this.area.height&&($H=this.area.y+this.area.height),isNaN($t)&&isNaN($H))this.clear();else{var $I={};isNaN($t)||($I.x=$t),isNaN($H)||($I.y=$H),this._tween=$c.to(this.target,$I,this.elasticBackTime,$Q.sineOut,$S.create(this,this.clear),0,!1,!1)}},$H.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($W.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$H.clear=function(){if(this.target){this.clearTimer();var $t=this.target;this.target=null,this._parent=null,$t.event("dragend",this.data)}},$t}()),$Q=function(){function $e(){}return $M($e,"laya.utils.Ease"),$e.linearNone=function($t,$H,$I,$T){return $I*$t/$T+$H},$e.linearIn=function($t,$H,$I,$T){return $I*$t/$T+$H},$e.linearInOut=function($t,$H,$I,$T){return $I*$t/$T+$H},$e.linearOut=function($t,$H,$I,$T){return $I*$t/$T+$H},$e.bounceIn=function($t,$H,$I,$T){return $I-$e.bounceOut($T-$t,0,$I,$T)+$H},$e.bounceInOut=function($t,$H,$I,$T){return $t<.5*$T?.5*$e.bounceIn(2*$t,0,$I,$T)+$H:.5*$e.bounceOut(2*$t-$T,0,$I,$T)+.5*$I+$H},$e.bounceOut=function($t,$H,$I,$T){return($t/=$T)<1/2.75?$I*(7.5625*$t*$t)+$H:$t<2/2.75?$I*(7.5625*($t-=1.5/2.75)*$t+.75)+$H:$t<2.5/2.75?$I*(7.5625*($t-=2.25/2.75)*$t+.9375)+$H:$I*(7.5625*($t-=2.625/2.75)*$t+.984375)+$H},$e.backIn=function($t,$H,$I,$T,$K){return void 0===$K&&($K=1.70158),$I*($t/=$T)*$t*(($K+1)*$t-$K)+$H},$e.backInOut=function($t,$H,$I,$T,$K){return void 0===$K&&($K=1.70158),($t/=.5*$T)<1?.5*$I*($t*$t*((1+($K*=1.525))*$t-$K))+$H:$I/2*(($t-=2)*$t*((1+($K*=1.525))*$t+$K)+2)+$H},$e.backOut=function($t,$H,$I,$T,$K){return void 0===$K&&($K=1.70158),$I*(($t=$t/$T-1)*$t*(($K+1)*$t+$K)+1)+$H},$e.elasticIn=function($t,$H,$I,$T,$K,$_){var $V;return void 0===$K&&($K=0),void 0===$_&&($_=0),0==$t?$H:1==($t/=$T)?$H+$I:($_||($_=.3*$T),$V=!$K||0<$I&&$K<$I||$I<0&&$K<-$I?($K=$I,$_/4):$_/$e.PI2*Math.asin($I/$K),-$K*Math.pow(2,10*($t-=1))*Math.sin(($t*$T-$V)*$e.PI2/$_)+$H)},$e.elasticInOut=function($t,$H,$I,$T,$K,$_){var $V;return void 0===$K&&($K=0),void 0===$_&&($_=0),0==$t?$H:2==($t/=.5*$T)?$H+$I:($_||($_=$T*(.3*1.5)),$V=!$K||0<$I&&$K<$I||$I<0&&$K<-$I?($K=$I,$_/4):$_/$e.PI2*Math.asin($I/$K),$t<1?$K*Math.pow(2,10*($t-=1))*Math.sin(($t*$T-$V)*$e.PI2/$_)*-.5+$H:$K*Math.pow(2,-10*($t-=1))*Math.sin(($t*$T-$V)*$e.PI2/$_)*.5+$I+$H)},$e.elasticOut=function($t,$H,$I,$T,$K,$_){var $V;return void 0===$K&&($K=0),void 0===$_&&($_=0),0==$t?$H:1==($t/=$T)?$H+$I:($_||($_=.3*$T),$V=!$K||0<$I&&$K<$I||$I<0&&$K<-$I?($K=$I,$_/4):$_/$e.PI2*Math.asin($I/$K),$K*Math.pow(2,-10*$t)*Math.sin(($t*$T-$V)*$e.PI2/$_)+$I+$H)},$e.strongIn=function($t,$H,$I,$T){return $I*($t/=$T)*$t*$t*$t*$t+$H},$e.strongInOut=function($t,$H,$I,$T){return($t/=.5*$T)<1?.5*$I*$t*$t*$t*$t*$t+$H:.5*$I*(($t-=2)*$t*$t*$t*$t+2)+$H},$e.strongOut=function($t,$H,$I,$T){return $I*(($t=$t/$T-1)*$t*$t*$t*$t+1)+$H},$e.sineInOut=function($t,$H,$I,$T){return.5*-$I*(Math.cos(Math.PI*$t/$T)-1)+$H},$e.sineIn=function($t,$H,$I,$T){return-$I*Math.cos($t/$T*$e.HALF_PI)+$I+$H},$e.sineOut=function($t,$H,$I,$T){return $I*Math.sin($t/$T*$e.HALF_PI)+$H},$e.quintIn=function($t,$H,$I,$T){return $I*($t/=$T)*$t*$t*$t*$t+$H},$e.quintInOut=function($t,$H,$I,$T){return($t/=.5*$T)<1?.5*$I*$t*$t*$t*$t*$t+$H:.5*$I*(($t-=2)*$t*$t*$t*$t+2)+$H},$e.quintOut=function($t,$H,$I,$T){return $I*(($t=$t/$T-1)*$t*$t*$t*$t+1)+$H},$e.quartIn=function($t,$H,$I,$T){return $I*($t/=$T)*$t*$t*$t+$H},$e.quartInOut=function($t,$H,$I,$T){return($t/=.5*$T)<1?.5*$I*$t*$t*$t*$t+$H:.5*-$I*(($t-=2)*$t*$t*$t-2)+$H},$e.quartOut=function($t,$H,$I,$T){return-$I*(($t=$t/$T-1)*$t*$t*$t-1)+$H},$e.cubicIn=function($t,$H,$I,$T){return $I*($t/=$T)*$t*$t+$H},$e.cubicInOut=function($t,$H,$I,$T){return($t/=.5*$T)<1?.5*$I*$t*$t*$t+$H:.5*$I*(($t-=2)*$t*$t+2)+$H},$e.cubicOut=function($t,$H,$I,$T){return $I*(($t=$t/$T-1)*$t*$t+1)+$H},$e.quadIn=function($t,$H,$I,$T){return $I*($t/=$T)*$t+$H},$e.quadInOut=function($t,$H,$I,$T){return($t/=.5*$T)<1?.5*$I*$t*$t+$H:.5*-$I*(--$t*($t-2)-1)+$H},$e.quadOut=function($t,$H,$I,$T){return-$I*($t/=$T)*($t-2)+$H},$e.expoIn=function($t,$H,$I,$T){return 0==$t?$H:$I*Math.pow(2,10*($t/$T-1))+$H-.001*$I},$e.expoInOut=function($t,$H,$I,$T){return 0==$t?$H:$t==$T?$H+$I:($t/=.5*$T)<1?.5*$I*Math.pow(2,10*($t-1))+$H:.5*$I*(2-Math.pow(2,-10*--$t))+$H},$e.expoOut=function($t,$H,$I,$T){return $t==$T?$H+$I:$I*(1-Math.pow(2,-10*$t/$T))+$H},$e.circIn=function($t,$H,$I,$T){return-$I*(Math.sqrt(1-($t/=$T)*$t)-1)+$H},$e.circInOut=function($t,$H,$I,$T){return($t/=.5*$T)<1?.5*-$I*(Math.sqrt(1-$t*$t)-1)+$H:.5*$I*(Math.sqrt(1-($t-=2)*$t)+1)+$H},$e.circOut=function($t,$H,$I,$T){return $I*Math.sqrt(1-($t=$t/$T-1)*$t)+$H},$e.HALF_PI=.5*Math.PI,$e.PI2=2*Math.PI,$e}(),$m=function(){function $f(){this._hit=null,this._unHit=null}$M($f,"laya.utils.HitArea");var $t=$f.prototype;return $t.isHit=function($t,$H){return!!$f.isHitGraphic($t,$H,this.hit)&&!$f.isHitGraphic($t,$H,this.unHit)},$t.contains=function($t,$H){return this.isHit($t,$H)},$q(0,$t,"hit",function(){return this._hit||(this._hit=new $b),this._hit},function($t){this._hit=$t}),$q(0,$t,"unHit",function(){return this._unHit||(this._unHit=new $b),this._unHit},function($t){this._unHit=$t}),$f.isHitGraphic=function($t,$H,$I){if(!$I)return!1;var $T;if(!($T=$I.cmds)&&$I._one&&(($T=$f._cmds).length=1,$T[0]=$I._one),!$T)return!1;var $K,$_,$V=0;for($K=$T.length,$V=0;$V<$K;$V++)if($_=$T[$V]){var $e=$g._context;switch($_.callee){case $e._translate:case 6:$t-=$_[0],$H-=$_[1]}if($f.isHitCmd($t,$H,$_))return!0}return!1},$f.isHitCmd=function($t,$H,$I){if(!$I)return!1;var $T=$g._context,$K=!1;switch($I.callee){case $T._drawRect:case 13:$f._rec.setTo($I[0],$I[1],$I[2],$I[3]),$K=$f._rec.contains($t,$H);break;case $T._drawCircle:case $T._fillCircle:case 14:$K=($t-=$I[0])*$t+($H-=$I[1])*$H<$I[2]*$I[2];break;case $T._drawPoly:case 18:$t-=$I[0],$H-=$I[1],$K=$f.ptInPolygon($t,$H,$I[2])}return $K},$f.ptInPolygon=function($t,$H,$I){var $T;($T=$f._ptPoint).setTo($t,$H);var $K,$_=0,$V=NaN,$e=NaN,$R=NaN,$A=NaN;$K=$I.length;for(var $q=0;$q<$K;$q+=2){if($V=$I[$q],$e=$I[$q+1],$R=$I[($q+2)%$K],$e!=($A=$I[($q+3)%$K]))if(!($T.y<Math.min($e,$A)))if(!($T.y>=Math.max($e,$A)))($T.y-$e)*($R-$V)/($A-$e)+$V>$T.x&&$_++}return $_%2==1},$f._cmds=[],$R($f,["_rec",function(){return this._rec=new $z},"_ptPoint",function(){return this._ptPoint=new $s}]),$f}(),$o=(function(){function $K($t,$H,$I,$T){this.char=$t,this.charNum=$t.charCodeAt(0),this._x=this._y=0,this.width=$H,this.height=$I,this.style=$T,this.isWord=!$K._isWordRegExp.test($t)}$M($K,"laya.utils.HTMLChar");var $t=$K.prototype;$W.imps($t,{"laya.display.ILayout":!0}),$t.setSprite=function($t){this._sprite=$t},$t.getSprite=function(){return this._sprite},$t._isChar=function(){return!0},$t._getCSSStyle=function(){return this.style},$q(0,$t,"width",function(){return this._w},function($t){this._w=$t}),$q(0,$t,"x",function(){return this._x},function($t){this._sprite&&(this._sprite.x=$t),this._x=$t}),$q(0,$t,"y",function(){return this._y},function($t){this._sprite&&(this._sprite.y=$t),this._y=$t}),$q(0,$t,"height",function(){return this._h},function($t){this._h=$t}),$K._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $H(){}$M($H,"laya.utils.Log"),$H.enable=function(){$H._logdiv||($H._logdiv=$h.window.document.createElement("div"),$h.window.document.body.appendChild($H._logdiv),$H._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$H.toggle=function(){var $t=$H._logdiv.style;"1px"==$t.width?$t.width=$t.height="50%":$t.width=$t.height="1px"},$H.print=function($t){$H._logdiv&&($H.maxCount<=$H._count&&$H.clear(),$H._count++,$H._logdiv.innerText+=$t+"\n",$H._logdiv.scrollTop=$H._logdiv.scrollHeight)},$H.clear=function(){$H._logdiv.innerText="",$H._count=0},$H._logdiv=null,$H._count=0,$H.maxCount=20}(),function(){function $H(){}$M($H,"laya.utils.Mouse"),$q(1,$H,"cursor",function(){return $H._style.cursor},function($t){$H._style.cursor=$t}),$H.hide=function(){"none"!=$H.cursor&&($H._preCursor=$H.cursor,$H.cursor="none")},$H.show=function(){"none"==$H.cursor&&($H.cursor=$H._preCursor?$H._preCursor:"auto")},$H._preCursor=null,$R($H,["_style",function(){return this._style=$h.document.body.style}])}(),function(){function $_(){}return $M($_,"laya.utils.Pool"),$_.getPoolBySign=function($t){return $_._poolDic[$t]||($_._poolDic[$t]=[])},$_.clearBySign=function($t){$_._poolDic[$t]&&($_._poolDic[$t].length=0)},$_.recover=function($t,$H){$H.__InPool||($H.__InPool=!0,$_.getPoolBySign($t).push($H))},$_.getItemByClass=function($t,$H){var $I=$_.getPoolBySign($t),$T=$I.length?$I.pop():new $H;return $T.__InPool=!1,$T},$_.getItemByCreateFun=function($t,$H,$I){var $T=$_.getPoolBySign($t),$K=$T.length?$T.pop():$H.call($I);return $K.__InPool=!1,$K},$_.getItem=function($t){var $H=$_.getPoolBySign($t),$I=$H.length?$H.pop():null;return $I&&($I.__InPool=!1),$I},$_._poolDic={},$_.InPoolSign="__InPool",$_}()),$n=function(){function $R(){}return $M($R,"laya.utils.Stat"),$q(1,$R,"onclick",null,function($t){$R._sp&&$R._sp.on("click",$R._sp,$t),$R._canvas&&($R._canvas.source.onclick=$t,$R._canvas.source.style.pointerEvents="")}),$R.show=function($t,$H,$I){if(void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),!$g.isConchApp||$g.isConchWebGL){if($g.isConchWebGL||$h.onMiniGame||$h.onLimixiu||($R._useCanvas=!0),$R._show=!0,$R._fpsData.length=60,$R._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$R._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$R._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$R._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$g.isWebGL)if($R._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$g.is3DMode){if($R._view[0].title="FPS(3D)",$R._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$R._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$R._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$I){var $T=8;$R._view[$T++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$R._view[$T++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$R._view[$T++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$I){$T=8;$R._view[$T++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$R._view[$T++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$R._view[$T++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$R._view[$T++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$R._view[$T++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$R._view[$T++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$R._view[$T++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $R._view[0].title="FPS(WebGL)",$R._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $R._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$R._useCanvas?$R.createUIPre($t,$H):$R.createUI($t,$H),$R.enable()}else $h.window.conch.showFPS&&$h.window.conch.showFPS($t,$H)},$R.createUIPre=function($t,$H){var $I=$h.pixelRatio;$R._width=170*$I,$R._vx=75*$I,$R._height=$I*(12*$R._view.length+3*$I)+4,$R._fontSize=12*$I;for(var $T=0;$T<$R._view.length;$T++)$R._view[$T].x=4,$R._view[$T].y=$T*$R._fontSize+2*$I;$R._canvas||(($R._canvas=new $Ut("2D")).size($R._width,$R._height),($R._ctx=$R._canvas.getContext("2d")).textBaseline="top",$R._ctx.font=$R._fontSize+"px Sans-serif",$R._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$t+"px;top:"+$H+"px;width:"+$R._width/$I+"px;height:"+$R._height/$I+"px;"),$R._first=!0,$R.loop(),$R._first=!1,$h.container.appendChild($R._canvas.source)},$R.createUI=function($t,$H){var $I=$R._sp,$T=$h.pixelRatio;$I||($I=new $ft,($R._leftText=new $Ot).pos(5,5),$R._leftText.color="#ffffff",$I.addChild($R._leftText),($R._txt=new $Ot).pos(80*$T,5),$R._txt.color="#ffffff",$I.addChild($R._txt),$R._sp=$I),$I.pos($t,$H);for(var $K="",$_=0;$_<$R._view.length;$_++){$K+=$R._view[$_].title+"\n"}$R._leftText.text=$K;var $V=170*$T,$e=$T*(12*$R._view.length+3*$T)+4;$R._txt.fontSize=$R._fontSize*$T,$R._leftText.fontSize=$R._fontSize*$T,$I.size($V,$e),$I.graphics.clear(),$I.graphics.setAlpha(.5),$I.graphics.drawRect(0,0,$V,$e,"#999999"),$I.graphics.setAlpha(1),$R.loop()},$R.enable=function(){$W.timer.frameLoop(1,$R,$R.loop)},$R.hide=function(){$R._show=!1,$W.timer.clear($R,$R.loop),$R._canvas&&$h.removeElement($R._canvas.source)},$R.clear=function(){$R.trianglesFaces=$R.drawCall=$R.shaderCall=$R.spriteCount=$R.spriteRenderUseCacheCount=$R.treeNodeCollision=$R.treeSpriteCollision=$R.canvasNormal=$R.canvasBitmap=$R.canvasReCache=0},$R.loop=function(){$R._count++;var $t=$h.now();if(!($t-$R._timer<1e3)){var $H=$R._count;if($R.FPS=Math.round(1e3*$H/($t-$R._timer)),$R._show){$R.trianglesFaces=Math.round($R.trianglesFaces/$H),$R.spriteCount=$R._useCanvas?($R.drawCall=Math.round($R.drawCall/$H)-2,$R.shaderCall=Math.round($R.shaderCall/$H),Math.round($R.spriteCount/$H)-1):($R.drawCall=Math.round($R.drawCall/$H)-2,$R.shaderCall=Math.round($R.shaderCall/$H)-4,Math.round($R.spriteCount/$H)-4),$R.spriteRenderUseCacheCount=Math.round($R.spriteRenderUseCacheCount/$H),$R.canvasNormal=Math.round($R.canvasNormal/$H),$R.canvasBitmap=Math.round($R.canvasBitmap/$H),$R.canvasReCache=Math.ceil($R.canvasReCache/$H),$R.treeNodeCollision=Math.round($R.treeNodeCollision/$H),$R.treeSpriteCollision=Math.round($R.treeSpriteCollision/$H);var $I=0<$R.FPS?Math.floor(1e3/$R.FPS).toString():" ";$R._fpsStr=$R.FPS+($R.renderSlow?" slow":"")+" "+$I,$R._spriteStr=$R.spriteCount+($R.spriteRenderUseCacheCount?"/"+$R.spriteRenderUseCacheCount:""),$R._canvasStr=$R.canvasReCache+"/"+$R.canvasNormal+"/"+$R.canvasBitmap,$R.currentMemorySize=$E.systemResourceManager.memorySize,$R._useCanvas?$R.renderInfoPre():$R.renderInfo(),$R.clear()}$R._count=0,$R._timer=$t}},$R.renderInfoPre=function(){if($R._canvas){var $t=$R._ctx;$t.clearRect($R._first?0:$R._vx,0,$R._width,$R._height);for(var $H=$g.WebGL.mainContext,$I=0;$I<$R._view.length;$I++){var $T=$R._view[$I];$R._first&&($t.fillStyle="white",$t.fillText($T.title,$T.x,$T.y,null,null,null)),$t.fillStyle=$T.color;var $K=-1;if(($T=$R._view[$I]).varying){if($H)switch($T.varying){case 1:$K=$H.getParameter($H[$T.value]);break;case 2:$K=$H.getExtension($T.value)}}else $K=$R[$T.value];"M"==$T.units&&($K=Math.floor($K/1048576*100)/100+" M"),"K"==$T.units&&($K=Math.floor($K/1024*100)/100+" K"),"string"==$T.units&&($K=$K.match(/\d+\.?\d/i)),$t.fillText($K+"",$T.x+$R._vx,$T.y,null,null,null)}}},$R.renderInfo=function(){for(var $t="",$H=$g.WebGL.mainContext,$I=0;$I<$R._view.length;$I++){var $T=$R._view[$I],$K=-1;if($T.varying){if($H)switch($T.varying){case 1:$K=$H.getParameter($H[$T.value]);break;case 2:$K=$H.getExtension($T.value)}}else $K=$R[$T.value];"M"==$T.units&&($K=Math.floor($K/1048576*100)/100+" M"),"K"==$T.units&&($K=Math.floor($K/1024*100)/100+" K"),"string"==$T.units&&($K=$K.match(/\d+\.?\d/i)),$t+=$K+"\n"}$R._txt.text=$t},$R.FPS=0,$R.loopCount=0,$R.shaderCall=0,$R.drawCall=0,$R.trianglesFaces=0,$R.spriteCount=0,$R.spriteRenderUseCacheCount=0,$R.treeNodeCollision=0,$R.treeSpriteCollision=0,$R.canvasNormal=0,$R.canvasBitmap=0,$R.canvasReCache=0,$R.renderSlow=!1,$R.currentMemorySize=0,$R._fpsStr=null,$R._canvasStr=null,$R._spriteStr=null,$R._fpsData=[],$R._timer=0,$R._count=0,$R._view=[],$R._fontSize=12,$R._txt=null,$R._leftText=null,$R._sp=null,$R._show=!1,$R._useCanvas=!1,$R._canvas=null,$R._ctx=null,$R._first=!1,$R._vx=NaN,$R._width=0,$R._height=100,$R}(),$F=(function(){function $t(){this._strsToID={},this._idToStrs=[],this._length=0}$M($t,"laya.utils.StringKey");var $H=$t.prototype;$H.add=function($t){var $H=this._strsToID[$t];return null!=$H?$H:(this._idToStrs[this._length]=$t,this._strsToID[$t]=this._length++)},$H.getID=function($t){var $H=this._strsToID[$t];return null==$H?-1:$H},$H.getName=function($t){var $H=this._idToStrs[$t];return null==$H?void 0:$H}}(),function(){var $A;function $t(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$M($t,"laya.utils.Timer");var $H=$t.prototype;return $H._init=function(){$W.timer&&$W.timer.frameLoop(1,this,this._update)},$H._now=function(){return Date.now()},$H._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $t=this.currFrame=this.currFrame+this.scale,$H=this._now();this._delta=($H-this._lastTimer)*this.scale;var $I=this.currTimer=this.currTimer+this._delta;$W.isDebug&&6e4<Math.abs($H-this._lastTimer)&&console.error("系统时间错误！"+($H-this._lastTimer)),this._lastTimer=$H;var $T=this._handlers;for($V=this._count=0,$e=$T.length;$V<$e;$V++)if(null!==($R=$T[$V]).method){var $K=$R.userFrame?$t:$I;if($K>=$R.exeTime)if($R.repeat)if($R.jumpFrame)for(;$K>=$R.exeTime;)$R.exeTime+=$R.delay,$R.run(!1);else $R.exeTime+=$R.delay,$R.run(!1),$K>$R.exeTime&&($R.exeTime+=Math.ceil(($K-$R.exeTime)/$R.delay)*$R.delay);else $R.run(!0)}else this._count++;(30<this._count||$t%200==0)&&this._clearHandlers();for(var $_=this._laters,$V=0,$e=$_.length-1;$V<=$e;$V++){var $R=$_[$V];this._isIgnoreRecover($R)||(null!==$R.method&&(delete this._map[$R.key],$R.run(!1)),this._recoverHandler($R)),$V===$e&&($e=$_.length-1)}$_.length=0}},$H._clearHandlers=function(){for(var $t=this._handlers,$H=0,$I=$t.length;$H<$I;$H++){var $T=$t[$H];null!==$T.method?this._temp.push($T):this._isIgnoreRecover($T)?this._temp.push($T):this._recoverHandler($T)}this._handlers=this._temp,this._temp=$t,this._temp.length=0},$H._recoverHandler=function($t){this._map[$t.key]==$t&&delete this._map[$t.key],$t.recover()},$H._create=function($t,$H,$I,$T,$K,$_,$V,$e){if(!$I)return $K.apply($T,$_),null;if($V){var $R=this._getHandler($T,$K);if($R)return $R.repeat=$H,$R.userFrame=$t,$R.delay=$I,$R.ignoreRecover=$e,$R.caller=$T,$R.method=$K,$R.args=$_,$R.exeTime=$I+($t?this.currFrame:this.currTimer+this._now()-this._lastTimer),$R}return($R=$A.create()).repeat=$H,$R.userFrame=$t,$R.delay=$I,$R.ignoreRecover=$e,$R.caller=$T,$R.method=$K,$R.args=$_,$R.exeTime=$I+($t?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($R),this._handlers.push($R),$R},$H._indexHandler=function($t){var $H=$t.caller,$I=$t.method,$T=$H?$H.$_GID||($H.$_GID=$i.getGID()):0,$K=$I.$_TID||($I.$_TID=this._mid++);$t.key=$T+"_"+$K,this._map[$t.key]=$t},$H.once=function($t,$H,$I,$T,$K){void 0===$K&&($K=!0),this._create(!1,!1,$t,$H,$I,$T,$K,!1)},$H.loop=function($t,$H,$I,$T,$K,$_,$V){void 0===$K&&($K=!0),void 0===$_&&($_=!1),void 0===$V&&($V=!1);var $e=this._create(!1,!0,$t,$H,$I,$T,$K,$V);$e&&($e.jumpFrame=$_)},$H.frameOnce=function($t,$H,$I,$T,$K){void 0===$K&&($K=!0),this._create(!0,!1,$t,$H,$I,$T,$K,!1)},$H.frameLoop=function($t,$H,$I,$T,$K,$_){void 0===$K&&($K=!0),void 0===$_&&($_=!1),this._create(!0,!0,$t,$H,$I,$T,$K,$_)},$H.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$A._freeCount},$H.clear=function($t,$H){var $I=this._getHandler($t,$H);return!(!$I||this._isIgnoreRecover($I))&&(delete this._map[$I.key],$I.key=null,$I.clear(),!0)},$H.clearAll=function($t){if($t)for(var $H=0,$I=this._handlers.length;$H<$I;$H++){var $T=this._handlers[$H];$T.caller===$t&&(this._isIgnoreRecover($T)||(delete this._map[$T.key],$T.key=null,$T.clear()))}},$H._getHandler=function($t,$H){var $I=$t?$t.$_GID||($t.$_GID=$i.getGID()):0,$T=$H.$_TID||($H.$_TID=this._mid++);return this._map[$I+"_"+$T]},$H._isIgnoreRecover=function($t){if($t.ignoreRecover||$t.caller&&"IgnoreRecover"==$t.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $H="";try{arguments.propertyIsEnumerable.caller}catch($t){$H=$t.stack}$W.recordError("报错：核心定时器销毁忽略  "+$H)}return!0}return!1},$H.hasHandler=function($t,$H){return this._map[$t.$_GID+"_"+$H.$_TID]},$H.callLater=function($t,$H,$I){if(null==this._getHandler($t,$H)){var $T=$A.create();$T.caller=$t,$T.method=$H,$T.args=$I,this._indexHandler($T),this._laters.push($T)}},$H.runCallLater=function($t,$H){var $I=this._getHandler($t,$H);$I&&null!=$I.method&&(this._isIgnoreRecover($I)||(delete this._map[$I.key],$I.run(!0)))},$H.runTimer=function($t,$H){this.runCallLater($t,$H)},$q(0,$H,"delta",function(){return this._delta}),$t.__init$=function(){$A=function(){function $H(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$M($H,"");var $t=$H.prototype;return $t.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$t.recover=function(){this.clear(),this.args=$H._freeHandler,$H._freeHandler=this,$H._freeCount++},$t.run=function($t){var $H=this.caller;if($H&&$H.destroyed)return this.clear();var $I=this.method,$T=this.args;$t&&this.clear(),null!=$I&&($T?$I.apply($H,$T):$I.call($H))},$H._freeHandler=null,$H._freeCount=0,$H.create=function(){var $t=$H._freeHandler;return $t?($H._freeHandler=$t.args,--$H._freeCount,$t.args=null,$t):new $H},$H}()},$t}()),$c=function(){function $f(){this.gid=0}$M($f,"laya.utils.Tween");var $t=$f.prototype;return $t.to=function($t,$H,$I,$T,$K,$_,$V){return void 0===$_&&($_=0),void 0===$V&&($V=!1),this._create($t,$H,$I,$T,$K,$_,$V,!0,!1,!0)},$t.from=function($t,$H,$I,$T,$K,$_,$V){return void 0===$_&&($_=0),void 0===$V&&($V=!1),this._create($t,$H,$I,$T,$K,$_,$V,!1,!1,!0)},$t._create=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){if(!$t)throw new Error("Tween:target is null");this._target=$t,this._duration=$I,this._ease=$T||$H.ease||$f.easeNone,this._complete=$K||$H.complete,this._delay=$_,this._props=[],this._usedTimer=0,this._startTimer=$h.now(),this._usedPool=$R,this._delayParam=null,this.update=$H.update;var $q=$t.$_GID||($t.$_GID=$i.getGID());return $f.tweenMap[$q]?($V&&$f.clearTween($t),$f.tweenMap[$q].push(this)):$f.tweenMap[$q]=[this],$A?$_<=0?this.firstStart($t,$H,$e):(this._delayParam=[$t,$H,$e],$W.scaleTimer.once($_,this,this.firstStart,this._delayParam)):this._initProps($t,$H,$e),this},$t.firstStart=function($t,$H,$I){this._delayParam=null,$t.destroyed?this.clear():(this._initProps($t,$H,$I),this._beginLoop())},$t._initProps=function($t,$H,$I){for(var $T in $H)if("number"==typeof $t[$T]){var $K=$I?$t[$T]:$H[$T],$_=$I?$H[$T]:$t[$T];this._props.push([$T,$K,$_-$K]),$I||($t[$T]=$K)}},$t._beginLoop=function(){$W.scaleTimer.frameLoop(1,this,this._doEase)},$t._doEase=function(){this._updateEase($h.now())},$t._updateEase=function($t){var $H=this._target;if($H){if($H.destroyed)return $f.clearTween($H);var $I=this._usedTimer=$t-this._startTimer-this._delay;if(!($I<0)){if($I>=this._duration)return this.complete();for(var $T=0<$I?this._ease($I,0,1,this._duration):0,$K=this._props,$_=0,$V=$K.length;$_<$V;$_++){var $e=$K[$_];$H[$e[0]]=$e[1]+$T*$e[2]}this.update&&this.update.run()}}},$t.complete=function(){if(this._target){$W.scaleTimer.runTimer(this,this.firstStart);for(var $t=this._target,$H=this._props,$I=this._complete,$T=0,$K=$H.length;$T<$K;$T++){var $_=$H[$T];$t[$_[0]]=$_[1]+$_[2]}this.update&&this.update.run(),this.clear(),$I&&$I.run()}},$t.pause=function(){$W.scaleTimer.clear(this,this._beginLoop),$W.scaleTimer.clear(this,this._doEase),$W.scaleTimer.clear(this,this.firstStart);var $t;($t=$h.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$t)},$t.setStartTime=function($t){this._startTimer=$t},$t.clear=function(){this._target&&(this._remove(),this._clear())},$t._clear=function(){this.pause(),$W.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$o.recover("tween",this))},$t.recover=function(){this._usedPool=!0,this._clear()},$t._remove=function(){var $t=$f.tweenMap[this._target.$_GID];if($t)for(var $H=0,$I=$t.length;$H<$I;$H++)if($t[$H]===this){$t.splice($H,1);break}},$t.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$h.now(),this._delayParam)$W.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $t=this._props,$H=0,$I=$t.length;$H<$I;$H++){var $T=$t[$H];this._target[$T[0]]=$T[1]}$W.scaleTimer.once(this._delay,this,this._beginLoop)}},$t.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$h.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$W.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$q(0,$t,"progress",null,function($t){var $H=$t*this._duration;this._startTimer=$h.now()-this._delay-$H}),$f.to=function($t,$H,$I,$T,$K,$_,$V,$e){return void 0===$_&&($_=0),void 0===$V&&($V=!1),void 0===$e&&($e=!0),$o.getItemByClass("tween",$f)._create($t,$H,$I,$T,$K,$_,$V,!0,$e,!0)},$f.from=function($t,$H,$I,$T,$K,$_,$V,$e){return void 0===$_&&($_=0),void 0===$V&&($V=!1),void 0===$e&&($e=!0),$o.getItemByClass("tween",$f)._create($t,$H,$I,$T,$K,$_,$V,!1,$e,!0)},$f.clearAll=function($t){if($t&&$t.$_GID){var $H=$f.tweenMap[$t.$_GID];if($H){for(var $I=0,$T=$H.length;$I<$T;$I++)$H[$I]._clear();$H.length=0}}},$f.clear=function($t){$t.clear()},$f.clearTween=function($t){$f.clearAll($t)},$f.easeNone=function($t,$H,$I,$T){return $I*$t/$T+$H},$f.tweenMap={},$f}(),$i=function(){function $e(){}return $M($e,"laya.utils.Utils"),$e.toRadian=function($t){return $t*$e._pi2},$e.toAngle=function($t){return $t*$e._pi},$e.toHexColor=function($t){if($t<0||isNaN($t))return null;for(var $H=$t.toString(16);$H.length<6;)$H="0"+$H;return"#"+$H},$e.getGID=function(){return $e._gid++},$e.concatArray=function($t,$H){if(!$H)return $t;if(!$t)return $H;var $I=0,$T=$H.length;for($I=0;$I<$T;$I++)$t.push($H[$I]);return $t},$e.clearArray=function($t){return $t&&($t.length=0),$t},$e.copyArray=function($t,$H){if($t||($t=[]),!$H)return $t;$t.length=$H.length;var $I=0,$T=$H.length;for($I=0;$I<$T;$I++)$t[$I]=$H[$I];return $t},$e.getGlobalRecByPoints=function($t,$H,$I,$T,$K){var $_,$V;return $_=new $s($H,$I),$_=$t.localToGlobal($_),$V=new $s($T,$K),$V=$t.localToGlobal($V),$z._getWrapRec([$_.x,$_.y,$V.x,$V.y])},$e.getGlobalPosAndScale=function($t){return $e.getGlobalRecByPoints($t,0,0,1,1)},$e.bind=function($t,$H){return $t.bind($H)},$e.measureText=function($t,$H){return $x.measureText($t,$H)},$e.contextMeasureText=function($t){var $H=$h.context.measureText($t);return $H||($H={width:16,height:16}),$H},$e.updateOrder=function($t){if(!$t||$t.length<2)return!1;for(var $H,$I=1,$T=0,$K=$t.length,$_=NaN;$I<$K;){for($H=$t[$T=$I],$_=$t[$T]._zOrder;-1<--$T&&$t[$T]._zOrder>$_;)$t[$T+1]=$t[$T];$t[$T+1]=$H,$I++}var $V=$H.parent.conchModel;if($V)if(null!=$V.updateZOrder)$V.updateZOrder();else{for($I=0;$I<$K;$I++)$V.removeChild($t[$I].conchModel);for($I=0;$I<$K;$I++)$V.addChildAt($t[$I].conchModel,$I)}return!0},$e.transPointList=function($t,$H,$I){var $T=0,$K=$t.length;for($T=0;$T<$K;$T+=2)$t[$T]+=$H,$t[$T+1]+=$I},$e.parseInt=function($t,$H){void 0===$H&&($H=0);var $I=$h.window.parseInt($t,$H);return isNaN($I)?0:$I},$e.getFileExtension=function($t){$e._extReg.lastIndex=$t.lastIndexOf(".");var $H=$e._extReg.exec($t);return $H&&1<$H.length?$H[1].toLowerCase():null},$e.getTransformRelativeToWindow=function($t,$H,$I){var $T=$W.stage,$K=laya.utils.Utils.getGlobalPosAndScale($t),$_=$T._canvasTransform.clone(),$V=$_.tx,$e=$_.ty;$_.rotate(-Math.PI/180*$W.stage.canvasDegree),$_.scale($W.stage.clientScaleX,$W.stage.clientScaleY);var $R=$W.stage.canvasDegree%180!=0,$A=NaN,$q=NaN;$R?($A=$I+$K.y,$q=$H+$K.x,$A*=$_.d,$q*=$_.a,90==$W.stage.canvasDegree?($A=$V-$A,$q+=$e):($A+=$V,$q=$e-$q)):($A=$H+$K.x,$q=$I+$K.y,$A*=$_.a,$q*=$_.d,$A+=$V,$q+=$e);var $f=NaN,$b=NaN;return $b=$R?($f=$_.d*$K.height,$_.a*$K.width):($f=$_.a*$K.width,$_.d*$K.height),{x:$A,y:$q,scaleX:$f,scaleY:$b}},$e.fitDOMElementInArea=function($t,$H,$I,$T,$K,$_){$t._fitLayaAirInitialized||($t._fitLayaAirInitialized=!0,$t.style.transformOrigin=$t.style.webKittransformOrigin="left top",$t.style.position="absolute");var $V=$e.getTransformRelativeToWindow($H,$I,$T);$t.style.transform=$t.style.webkitTransform="scale("+$V.scaleX+","+$V.scaleY+") rotate("+$W.stage.canvasDegree+"deg)",$t.style.width=$K+"px",$t.style.height=$_+"px",$t.style.left=$V.x+"px",$t.style.top=$V.y+"px"},$e.isOkTextureList=function($t){if(!$t)return!1;var $H,$I=0,$T=$t.length;for($I=0;$I<$T;$I++)if(!($H=$t[$I])||!$H.source)return!1;return!0},$e.isOKCmdList=function($t){if(!$t)return!1;var $H,$I,$T=0,$K=$t.length,$_=$g._context;for($T=0;$T<$K;$T++)switch(($H=$t[$T]).callee){case $_._drawTexture:case $_._fillTexture:case $_._drawTextureWithTransform:if(!($I=$H[0])||!$I.source)return!1}return!0},$e._gid=1,$e._pi=180/Math.PI,$e._pi2=Math.PI/180,$e._extReg=/\.(\w+)\??/g,$e.parseXMLFromString=function($t){var $H;if($t=$t.replace(/>\s+</g,"><"),-1<($H=(new DOMParser).parseFromString($t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($H.firstChild.firstChild.textContent);return $H},$e}(),$j=function(){function $t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$g.isWebGL&&$B.regCacheByFunction($i.bind(this.startDispose,this),$i.bind(this.getCacheList,this))}$M($t,"laya.utils.VectorGraphManager");var $H=$t.prototype;return $H.getId=function(){return this._id++},$H.addShape=function($t,$H){this.shapeDic[$t]=$H,this.useDic[$t]||(this.useDic[$t]=!0)},$H.addLine=function($t,$H){this.shapeLineDic[$t]=$H,this.shapeLineDic[$t]||(this.shapeLineDic[$t]=!0)},$H.getShape=function($t){this._checkKey&&null!=this.useDic[$t]&&(this.useDic[$t]=!0)},$H.deleteShape=function($t){this.shapeDic[$t]&&(this.shapeDic[$t]=null,delete this.shapeDic[$t]),this.shapeLineDic[$t]&&(this.shapeLineDic[$t]=null,delete this.shapeLineDic[$t]),null!=this.useDic[$t]&&delete this.useDic[$t]},$H.getCacheList=function(){var $t,$H=[];for($t in this.shapeDic)$H.push(this.shapeDic[$t]);for($t in this.shapeLineDic)$H.push(this.shapeLineDic[$t]);return $H},$H.startDispose=function($t){var $H;for($H in this.useDic)this.useDic[$H]=!1;this._checkKey=!0},$H.endDispose=function(){if(this._checkKey){var $t;for($t in this.useDic)this.useDic[$t]||this.deleteShape($t);this._checkKey=!1}},$t.getInstance=function(){return $t.instance=$t.instance||new $t},$t.instance=null,$t}(),$d=function(){function $T(){this._obj=null,this._obj=$T.supportWeakMap?new $h.window.WeakMap:{},$T.supportWeakMap||$T._maps.push(this)}$M($T,"laya.utils.WeakObject");var $t=$T.prototype;return $t.set=function($t,$H){if(null!=$t)if($T.supportWeakMap){var $I=$t;"string"!=typeof $t&&"number"!=typeof $t||($I=$T._keys[$t])||($I=$T._keys[$t]={k:$t}),this._obj.set($I,$H)}else"string"==typeof $t||"number"==typeof $t?this._obj[$t]=$H:($t.$_GID||($t.$_GID=$i.getGID()),this._obj[$t.$_GID]=$H)},$t.get=function($t){if(null==$t)return null;if($T.supportWeakMap){var $H="string"==typeof $t||"number"==typeof $t?$T._keys[$t]:$t;return $H?this._obj.get($H):null}return"string"==typeof $t||"number"==typeof $t?this._obj[$t]:this._obj[$t.$_GID]},$t.del=function($t){if(null!=$t)if($T.supportWeakMap){var $H="string"==typeof $t||"number"==typeof $t?$T._keys[$t]:$t;if(!$H)return;this._obj.delete($H)}else"string"==typeof $t||"number"==typeof $t?delete this._obj[$t]:delete this._obj[this._obj.$_GID]},$t.has=function($t){if(null==$t)return!1;if($T.supportWeakMap){var $H="string"==typeof $t||"number"==typeof $t?$T._keys[$t]:$t;return this._obj.has($H)}return"string"==typeof $t||"number"==typeof $t?null!=this._obj[$t]:null!=this._obj[this._obj.$_GID]},$T.__init__=function(){($T.supportWeakMap=null!=$h.window.WeakMap)||$W.timer.loop($T.delInterval,null,$T.clearCache)},$T.clearCache=function(){for(var $t=0,$H=$T._maps.length;$t<$H;$t++){$T._maps[$t]._obj={}}},$T.supportWeakMap=!1,$T.delInterval=3e5,$T._keys={},$T._maps=[],$R($T,["I",function(){return this.I=new $T}]),$T}(),$Z=function(){function $t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$M($t,"laya.utils.WordText");var $H=$t.prototype;return $H.setText=function($t){this.changed=!0,this._text=$t},$H.toString=function(){return this._text},$H.charCodeAt=function($t){return this._text?this._text.charCodeAt($t):NaN},$H.charAt=function($t){return this._text?this._text.charAt($t):null},$q(0,$H,"length",function(){return this._text?this._text.length:0}),$t}(),$tt=function($t){function $V(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$V.__super.call(this),this._childs=$V.ARRAY_EMPTY,this._$P=$V.PROP_EMPTY,this.timer=$W.scaleTimer,this.conchModel=$g.isConchNode?this.createConchModel():null}$M($V,"laya.display.Node",$A);var $H=$V.prototype;return $H._setBit=function($t,$H){1==$t&&(this._getBit($t)!=$H&&this._updateDisplayedInstage());$H?this._bits|=$t:this._bits&=~$t},$H._getBit=function($t){return 0!=(this._bits&$t)},$H._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$H._setUpNoticeType=function($t){var $H=this;for($H._setBit($t,!0),$H=$H.parent;$H;){if($H._getBit($t))return;$H._setBit($t,!0),$H=$H.parent}},$H.on=function($t,$H,$I,$T){return"display"!==$t&&"undisplay"!==$t||this._getBit(1)||this._setUpNoticeType(1),this._createListener($t,$H,$I,$T,!1)},$H.once=function($t,$H,$I,$T){return"display"!==$t&&"undisplay"!==$t||this._getBit(1)||this._setUpNoticeType(1),this._createListener($t,$H,$I,$T,!0)},$H.createConchModel=function(){return null},$H.destroy=function($t){void 0===$t&&($t=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$H.destroyChildren=function(){if(this._childs)for(var $t=this._childs.length-1;-1<$t;$t--)this._childs[$t].destroy(!0)},$H.addChild=function($t){if(!$t||this.destroyed||$t===this)return $t;if($t.zOrder&&this._set$P("hasZorder",!0),$t._parent===this){var $H=this.getChildIndex($t);$H!==this._childs.length-1&&(this._childs.splice($H,1),this._childs.push($t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,this._childs.length-1)),this._childChanged())}else $t.parent&&$t.parent.removeChild($t),this._childs===$V.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($t),this.conchModel&&this.conchModel.addChildAt($t.conchModel,this._childs.length-1),($t.parent=this)._childChanged();return $t},$H.addChildren=function($t){for(var $H=arguments,$I=0,$T=$H.length;$I<$T;)this.addChild($H[$I++])},$H.addChildAt=function($t,$H){if(!$t||this.destroyed||$t===this)return $t;if($t.zOrder&&this._set$P("hasZorder",!0),0<=$H&&$H<=this._childs.length){if($t._parent===this){var $I=this.getChildIndex($t);this._childs.splice($I,1),this._childs.splice($H,0,$t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,$H)),this._childChanged()}else $t.parent&&$t.parent.removeChild($t),this._childs===$V.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($H,0,$t),this.conchModel&&this.conchModel.addChildAt($t.conchModel,$H),$t.parent=this;return $t}throw new Error("appendChildAt:The index is out of bounds")},$H.getChildIndex=function($t){return this._childs.indexOf($t)},$H.getChildByName=function($t){var $H=this._childs;if($H)for(var $I=0,$T=$H.length;$I<$T;$I++){var $K=$H[$I];if($K.name===$t)return $K}return null},$H._get$P=function($t){return this._$P[$t]},$H._set$P=function($t,$H){return this.destroyed||(this._$P===$V.PROP_EMPTY&&(this._$P={}),this._$P[$t]=$H),$H},$H.getChildAt=function($t){return this._childs[$t]},$H.setChildIndex=function($t,$H){var $I=this._childs;if($H<0||$H>=$I.length)throw new Error("setChildIndex:The index is out of bounds.");var $T=this.getChildIndex($t);if($T<0)throw new Error("setChildIndex:node is must child of this object.");return $I.splice($T,1),$I.splice($H,0,$t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,$H)),this._childChanged(),$t},$H._childChanged=function($t){},$H.removeChild=function($t){if(!this._childs)return $t;var $H=this._childs.indexOf($t);return this.removeChildAt($H)},$H.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$H.removeChildByName=function($t){var $H=this.getChildByName($t);return $H&&this.removeChild($H),$H},$H.removeChildAt=function($t){var $H=this.getChildAt($t);if($H){for(var $I=this._childs.length-1,$T=$t;$T<$I;++$T)this._childs[$T]=this._childs[$T+1];this._childs.length=$I,this.conchModel&&this.conchModel.removeChild($H.conchModel),$H.parent=null}return $H},$H.removeChildren=function($t,$H){if(void 0===$t&&($t=0),void 0===$H&&($H=2147483647),this._childs&&0<this._childs.length){var $I=this._childs;if(0===$t&&$_<=$H){var $T=$I;this._childs=$V.ARRAY_EMPTY}else $T=$I.splice($t,$H-$t);for(var $K=0,$_=$T.length;$K<$_;$K++)$T[$K].parent=null,this.conchModel&&this.conchModel.removeChild($T[$K].conchModel)}return this},$H.replaceChild=function($t,$H){var $I=this._childs.indexOf($H);return-1<$I?(this._childs.splice($I,1,$t),this.conchModel&&(this.conchModel.removeChild($H.conchModel),this.conchModel.addChildAt($t.conchModel,$I)),$H.parent=null,$t.parent=this,$t):null},$H._updateDisplayedInstage=function(){var $t;$t=this;var $H=$W.stage;for(this._displayedInStage=!1;$t;){if($t._getBit(1)){this._displayedInStage=$t._displayedInStage;break}if($t==$H||$t._displayedInStage){this._displayedInStage=!0;break}$t=$t.parent}},$H._setDisplay=function($t){this._displayedInStage!==$t&&((this._displayedInStage=$t)?this.event("display"):this.event("undisplay"))},$H._displayChild=function($t,$H){var $I=$t._childs;if($I)for(var $T=0;$T<$I.length;$T++){var $K=$I[$T];$K&&$K._getBit(1)&&(0<$K._childs.length?this._displayChild($K,$H):$K._setDisplay($H))}$t._setDisplay($H)},$H.contains=function($t){if($t===this)return!0;for(;$t;){if($t.parent===this)return!0;$t=$t.parent}return!1},$H.timerLoop=function($t,$H,$I,$T,$K,$_){void 0===$K&&($K=!0),void 0===$_&&($_=!1),this.timer.loop($t,$H,$I,$T,$K,$_)},$H.timerOnce=function($t,$H,$I,$T,$K){void 0===$K&&($K=!0),this.timer._create(!1,!1,$t,$H,$I,$T,$K)},$H.frameLoop=function($t,$H,$I,$T,$K){void 0===$K&&($K=!0),this.timer._create(!0,!0,$t,$H,$I,$T,$K)},$H.frameOnce=function($t,$H,$I,$T,$K){void 0===$K&&($K=!0),this.timer._create(!0,!1,$t,$H,$I,$T,$K)},$H.clearTimer=function($t,$H){this.timer.clear($t,$H)},$q(0,$H,"numChildren",function(){return this._childs.length}),$q(0,$H,"destroyed",function(){return this._destroyed}),$q(0,$H,"parent",function(){return this._parent},function($t){this._parent!==$t&&($t?(this._parent=$t,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$t.displayedInStage&&this._displayChild(this,!0)),$t._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$t))}),$q(0,$H,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$V.ARRAY_EMPTY=[],$V.PROP_EMPTY={},$V.NOTICE_DISPLAY=1,$V.MOUSEENABLE=2,$V}(),$Ht=function($t){function $b($t){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$b.__super.call(this),this._padding=$b._PADDING,this._spacing=$b._SPACING,this._aligns=$b._ALIGNS,this._font=$L.EMPTY,this._ower=$t}$M($b,"laya.display.css.CSSStyle",$t);var $H=$b.prototype;return $H.destroy=function(){this._ower=null,this._font=null,this._rect=null},$H.inherit=function($t){this._font=$t._font,this._spacing=$t._spacing===$b._SPACING?$b._SPACING:$t._spacing.slice(),this.lineHeight=$t.lineHeight},$H._widthAuto=function(){return 0!=(262144&this._type)},$H.widthed=function($t){return 0!=(8&this._type)},$H._calculation=function($t,$H){if($H.indexOf("%")<0)return!1;var $T=this._ower,$K=$T.parent,$_=this._rect;function $V($t,$H,$I){return $t*$I[0]+$H*$I[1]+$I[2]}function $I($t){var $H=$K.width,$I=$T.width;$_.width&&($T.width=$V($H,$I,$_.width)),$_.height&&($T.height=$V($H,$I,$_.height)),$_.left&&($T.x=$V($H,$I,$_.left)),$_.top&&($T.y=$V($H,$I,$_.top))}null===$_&&($K._getCSSStyle()._type|=524288,$K.on("resize",this,$I),this._rect=$_={input:{}});var $e=$H.split(" ");return $e[0]=parseFloat($e[0])/100,1==$e.length?$e[1]=$e[2]=0:($e[1]=parseFloat($e[1])/100,$e[2]=parseFloat($e[2])),$_[$t]=$e,$_.input[$t]=$H,$I(),!0},$H.heighted=function($t){return 0!=(8192&this._type)},$H.size=function($t,$H){var $I=this._ower,$T=!1;-1!==$t&&$t!=this._ower.width&&(this._type|=8,this._ower.width=$t,$T=!0),-1!==$H&&$H!=this._ower.height&&(this._type|=8192,this._ower.height=$H,$T=!0),$T&&($I._layoutLater(),524288&this._type&&$I.event("resize",this))},$H._getAlign=function(){return this._aligns[0]},$H._getValign=function(){return this._aligns[1]},$H._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$H._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $L(this._font))},$H.render=function($t,$H,$I,$T){var $K=$t.width,$_=$t.height;$I-=$t.pivotX,$T-=$t.pivotY,this._bgground&&null!=this._bgground.color&&$H.ctx.fillRect($I,$T,$K,$_,this._bgground.color),this._border&&this._border.color&&$H.drawRect($I,$T,$K,$_,this._border.color.strColor,this._border.size)},$H.getCSSStyle=function(){return this},$H.cssText=function($t){this.attrs($b.parseOneCSS($t,";"))},$H.attrs=function($t){if($t)for(var $H=0,$I=$t.length;$H<$I;$H++){var $T=$t[$H];this[$T[0]]=$T[1]}},$H.setTransform=function($t){"none"===$t?this._tf=$e._TF_EMPTY:this.attrs($b.parseOneCSS($t,","))},$H.translate=function($t,$H){this._tf===$e._TF_EMPTY&&(this._tf=new $K),this._tf.translateX=$t,this._tf.translateY=$H},$H.scale=function($t,$H){this._tf===$e._TF_EMPTY&&(this._tf=new $K),this._tf.scaleX=$t,this._tf.scaleY=$H},$H._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$q(0,$H,"block",$t.prototype._$get_block,function($t){$t?this._type|=1:this._type&=-2}),$q(0,$H,"valign",function(){return $b._valigndef[this._aligns[1]]},function($t){this._aligns===$b._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$b._valigndef[$t]}),$q(0,$H,"height",null,function($t){if(this._type|=8192,"string"==typeof $t){if(this._calculation("height",$t))return;$t=parseInt($t)}this.size(-1,$t)}),$q(0,$H,"width",null,function($t){if(this._type|=8,"string"==typeof $t){var $H=$t.indexOf("auto");if(0<=$H&&(this._type|=262144,$t=$t.substr(0,$H)),this._calculation("width",$t))return;$t=parseInt($t)}this.size($t,-1)}),$q(0,$H,"fontWeight",function(){return this._font.weight},function($t){this._createFont().weight=$t}),$q(0,$H,"left",null,function($t){var $H=this._ower;if("string"==typeof $t){if("center"===$t?$t="50% -50% 0":"right"===$t&&($t="100% -100% 0"),this._calculation("left",$t))return;$t=parseInt($t)}$H.x=$t}),$q(0,$H,"_translate",null,function($t){this.translate($t[0],$t[1])}),$q(0,$H,"absolute",function(){return 0!=(4&this._type)}),$q(0,$H,"top",null,function($t){var $H=this._ower;if("string"==typeof $t){if("middle"===$t?$t="50% -50% 0":"bottom"===$t&&($t="100% -100% 0"),this._calculation("top",$t))return;$t=parseInt($t)}$H.y=$t}),$q(0,$H,"align",function(){return $b._aligndef[this._aligns[0]]},function($t){this._aligns===$b._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$b._aligndef[$t]}),$q(0,$H,"bold",function(){return this._font.bold},function($t){this._createFont().bold=$t}),$q(0,$H,"padding",function(){return this._padding},function($t){this._padding=$t}),$q(0,$H,"leading",function(){return this._spacing[1]},function($t){"string"==typeof $t&&($t=parseInt($t+"")),this._spacing===$b._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$t}),$q(0,$H,"lineElement",function(){return 0!=(65536&this._type)},function($t){$t?this._type|=65536:this._type&=-65537}),$q(0,$H,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($t){this.lineElement=!1,"right"===$t?this._type|=32768:this._type&=-32769}),$q(0,$H,"textDecoration",function(){return this._font.decoration},function($t){this._createFont().decoration=$t}),$q(0,$H,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($t){"nowrap"===$t&&(this._type|=131072),"none"===$t&&(this._type&=-131073)}),$q(0,$H,"background",null,function($t){$t?(this._bgground||(this._bgground={}),this._bgground.color=$t,this._ower.conchModel&&this._ower.conchModel.bgColor($t),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$q(0,$H,"wordWrap",function(){return 0==(131072&this._type)},function($t){$t?this._type&=-131073:this._type|=131072}),$q(0,$H,"color",function(){return this._font.color},function($t){this._createFont().color=$t}),$q(0,$H,"password",function(){return this._font.password},function($t){this._createFont().password=$t}),$q(0,$H,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($t){"none"===$t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$t),this._ower.conchModel&&this._ower.conchModel.bgColor($t),this._ower._renderType|=256}),$q(0,$H,"font",function(){return this._font.toString()},function($t){this._createFont().set($t)}),$q(0,$H,"weight",null,function($t){this._createFont().weight=$t}),$q(0,$H,"letterSpacing",function(){return this._spacing[0]},function($t){"string"==typeof $t&&($t=parseInt($t+"")),this._spacing===$b._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$t}),$q(0,$H,"fontSize",function(){return this._font.size},function($t){this._createFont().size=$t}),$q(0,$H,"italic",function(){return this._font.italic},function($t){this._createFont().italic=$t}),$q(0,$H,"fontFamily",function(){return this._font.family},function($t){this._createFont().family=$t}),$q(0,$H,"stroke",function(){return this._font.stroke[0]},function($t){this._createFont().stroke===$L._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$t}),$q(0,$H,"strokeColor",function(){return this._font.stroke[1]},function($t){this._createFont().stroke===$L._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$t}),$q(0,$H,"border",function(){return this._border?this._border.value:""},function($t){if("none"!=$t){this._border||(this._border={});var $H=(this._border.value=$t).split(" ");if(this._border.color=$u.create($H[$H.length-1]),1==$H.length)return this._border.size=1,void(this._border.type="solid");var $I=0;0<$H[0].indexOf("px")?(this._border.size=parseInt($H[0]),$I++):this._border.size=1,this._border.type=$H[$I],this._ower._renderType|=256}else this._border=null}),$q(0,$H,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($t){$t?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$t?null:$u.create($t),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$q(0,$H,"position",function(){return 4&this._type?"absolute":""},function($t){"absolute"==$t?this._type|=4:this._type&=-5}),$q(0,$H,"display",null,function($t){switch($t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$q(0,$H,"paddingLeft",function(){return this.padding[3]}),$q(0,$H,"paddingTop",function(){return this.padding[0]}),$q(0,$H,"_scale",null,function($t){this._ower.scale($t[0],$t[1])}),$q(0,$H,"_rotate",null,function($t){this._ower.rotation=$t}),$b.parseOneCSS=function($t,$H){for(var $I,$T=[],$K=$t.split($H),$_=0,$V=$K.length;$_<$V;$_++){var $e=$K[$_],$R=$e.indexOf(":"),$A=$e.substr(0,$R).replace(/^\s+|\s+$/g,"");if(0!=$A.length){var $q=$e.substr($R+1).replace(/^\s+|\s+$/g,""),$f=[$A,$q];switch($A){case"italic":case"bold":$f[1]="true"==$q;break;case"line-height":$f[0]="lineHeight",$f[1]=parseInt($q);break;case"font-size":$f[0]="fontSize",$f[1]=parseInt($q);break;case"padding":1<($I=$q.split(" ")).length||($I[1]=$I[2]=$I[3]=$I[0]),$f[1]=[parseInt($I[0]),parseInt($I[1]),parseInt($I[2]),parseInt($I[3])];break;case"rotate":$f[0]="_rotate",$f[1]=parseFloat($q);break;case"scale":$I=$q.split(" "),$f[0]="_scale",$f[1]=[parseFloat($I[0]),parseFloat($I[1])];break;case"translate":$I=$q.split(" "),$f[0]="_translate",$f[1]=[parseInt($I[0]),parseInt($I[1])];break;default:($f[0]=$b._CSSTOVALUE[$A])||($f[0]=$A)}$T.push($f)}}return $T},$b.parseCSS=function($t,$H){for(var $I;null!=($I=$b._parseCSSRegExp.exec($t));)$b.styleSheets[$I[1]]=$b.parseOneCSS($I[2],";")},$b.EMPTY=new $b(null),$b._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$b._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$b._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$b._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$b.styleSheets={},$b.ALIGN_CENTER=1,$b.ALIGN_RIGHT=2,$b.VALIGN_MIDDLE=1,$b.VALIGN_BOTTOM=2,$b._CSS_BLOCK=1,$b._DISPLAY_NONE=2,$b._ABSOLUTE=4,$b._WIDTH_SET=8,$b._PADDING=[0,0,0,0],$b._RECT=[-1,-1,-1,-1],$b._SPACING=[0,0],$b._ALIGNS=[0,0,0],$b.ADDLAYOUTED=512,$b._NEWFONT=4096,$b._HEIGHT_SET=8192,$b._BACKGROUND_SET=16384,$b._FLOAT_RIGHT=32768,$b._LINE_ELEMENT=65536,$b._NOWARP=131072,$b._WIDTHAUTO=262144,$b._LISTERRESZIE=524288,$b}($e),$It=function($t){function $V(){this.url=null,this.audio=null,this.loaded=!1,$V.__super.call(this)}$M($V,"laya.media.h5audio.AudioSound",$A);var $H=$V.prototype;return $H.dispose=function(){var $t=$V._audioCache[this.url];$t&&($t.src="",delete $V._audioCache[this.url])},$H.load=function($t){var $H;if($t=$p.formatURL($t),(this.url=$t)==$r._tMusic?($V._initMusicAudio(),($H=$V._musicAudio).src!=$t&&($V._audioCache[$H.src]=null,$H=null)):$H=$V._audioCache[$t],$H&&2<=$H.readyState)this.event("complete");else{$H||($H=$t==$r._tMusic?($V._initMusicAudio(),$V._musicAudio):$h.createElement("audio"),($V._audioCache[$t]=$H).src=$t),$H.addEventListener("canplaythrough",$T),$H.addEventListener("error",$K);var $I=this;(this.audio=$H).load?$H.load():$K()}function $T(){$_(),$I.loaded=!0,$I.event("complete")}function $K(){$H.load=null,$_(),$I.event("error")}function $_(){$H.removeEventListener("canplaythrough",$T),$H.removeEventListener("error",$K)}},$H.play=function($t,$H,$I){if(void 0===$t&&($t=0),void 0===$H&&($H=0),!this.url)return null;var $T,$K;if(!($T=this.url==$r._tMusic?$V._musicAudio:$V._audioCache[this.url]))return null;$K=$o.getItem("audio:"+this.url),$g.isConchApp?$K||(($K=$h.createElement("audio")).src=this.url):this.url==$r._tMusic?($V._initMusicAudio(),($K=$V._musicAudio).src=this.url):$K=$K||$T.cloneNode(!0);var $_=new $bt($K);return $_.url=this.url,$_.loops=$H,$_.startTime=$t,$_.startHandler=$I,$_.play(!1),$r.addChannel($_),$_},$q(0,$H,"duration",function(){var $t;return($t=$V._audioCache[this.url])?$t.duration:0}),$V._initMusicAudio=function(){$V._musicAudio||($V._musicAudio||($V._musicAudio=$h.createElement("audio")),$g.isConchApp||$h.document.addEventListener("mousedown",$V._makeMusicOK))},$V._makeMusicOK=function(){$h.document.removeEventListener("mousedown",$V._makeMusicOK),$V._musicAudio.src?$V._musicAudio.play():($V._musicAudio.src="",$V._musicAudio.load())},$V._audioCache={},$V._musicAudio=null,$V}(),$Tt=function($t){function $H(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$H.__super.call(this)}$M($H,"laya.media.SoundChannel",$A);var $I=$H.prototype;return $I.play=function(){},$I.stop=function(){},$I.pause=function(){},$I.resume=function(){},$I.__runComplete=function($t){$t&&$t.run()},$q(0,$I,"volume",function(){return 1},function($t){}),$q(0,$I,"position",function(){return 0}),$q(0,$I,"duration",function(){return 0}),$H}(),$Kt=function($t){function $H(){$H.__super.call(this)}$M($H,"laya.media.Sound",$A);var $I=$H.prototype;return $I.load=function($t){},$I.play=function($t,$H,$I){return void 0===$t&&($t=0),void 0===$H&&($H=0),null},$I.dispose=function(){},$q(0,$I,"duration",function(){return 0}),$H}(),$_t=function($t){function $K(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$K.__super.call(this)}$M($K,"laya.media.webaudio.WebAudioSound",$A);var $H=$K.prototype;return $H.load=function($t){this.url=$t,this.audioBuffer=$K._dataCache[$t],this.audioBuffer?this._loaded(this.audioBuffer):($K.e.on("loaded:"+$t,this,this._loaded),$K.e.on("err:"+$t,this,this._err),$K.__loadingSound[$t]||($K.__loadingSound[$t]=!0,$W.loader.load($t,$S.create(this,this.onloaded),null,$et.BUFFER,4,!1,null,!0)))},$H.onloaded=function($t){$t||this._err(),this._disposed?this._removeLoadEvents():(this.data=$t,$K.buffs.push({buffer:this.data,url:this.url}),$K.decode())},$H._err=function(){if(this._removeLoadEvents(),$K.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $t,$H,$I,$T=0;for($t=($H=this.__toPlays).length,$T=0;$T<$t;$T++)($I=$H[$T])[3]&&!$I[3].isStopped&&$I[3].event("error");this.__toPlays.length=0}},$H._loaded=function($t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$t,this.loaded=!0,this.event("complete"))},$H._removeLoadEvents=function(){$K.e.off("loaded:"+this.url,this,this._loaded),$K.e.off("err:"+this.url,this,this._err)},$H.__playAfterLoaded=function(){if(this.__toPlays){var $t,$H,$I,$T=0;for($t=($H=this.__toPlays).length,$T=0;$T<$t;$T++)($I=$H[$T])[3]&&!$I[3].isStopped&&this.play($I[0],$I[1],$I[2],$I[3]);this.__toPlays.length=0}},$H.play=function($t,$H,$I,$T){return void 0===$t&&($t=0),void 0===$H&&($H=0),$T=$T||new $Lt,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$t,$H,$I,$T]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$T.url=this.url,$T.loops=$H,$T.audioBuffer=this.audioBuffer,$T.startTime=$t,$T.startHandler=$I,$T.play(!1),$r.addChannel($T),$T},$H.dispose=function(){this._disposed=!0,delete $K._dataCache[this.url],delete $K.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$q(0,$H,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$K.decode=function(){if(!($K.buffs.length<=0||$K.isDecoding))if($K.isDecoding=!0,($K.tInfo=$K.buffs.shift())&&$K.tInfo.buffer&&$K.tInfo.buffer.byteLength)try{$K.ctx.decodeAudioData($K.tInfo.buffer,$K._done,$K._fail)}catch($t){console.error("decodeAudioData error  byteLength:"+$K.tInfo.buffer.byteLength+"  url:"+$K.tInfo.url)}else $K._fail()},$K._done=function($t){$K.e.event("loaded:"+$K.tInfo.url,$t),$K._dataCache[$K.tInfo.url]=$t,$K.isDecoding=!1,$K.decode()},$K._fail=function(){$K.e.event("err:"+$K.tInfo.url,null),$K.isDecoding=!1,$K.decode()},$K._playEmptySound=function(){if(null!=$K.ctx){if($K._emptySource&&($K._emptySource.stop(),$K._emptySource.disconnect(0),!$Lt._tryCleanFailed))try{$K._emptySource.buffer=null}catch($t){$Lt._tryCleanFailed=!0}var $t=$K.ctx.createBufferSource();$t.buffer=$K._miniBuffer,$t.connect($K.ctx.destination),$t.start(0,0,0),$K._emptySource=$t}},$K._unlock=function(){$K._unlocked||($K._playEmptySound(),"running"==$K.ctx.state?($h.document.removeEventListener("mousedown",$K._unlock,!0),$h.document.removeEventListener("touchend",$K._unlock,!0),$h.document.removeEventListener("touchstart",$K._unlock,!0),$K._unlocked=!0):"suspended"==$K.ctx.state&&$r._recoverWebAudio())},$K.initWebAudio=function(){"running"!=$K.ctx.state&&($K._unlock(),$h.document.addEventListener("mousedown",$K._unlock,!0),$h.document.addEventListener("touchend",$K._unlock,!0),$h.document.addEventListener("touchstart",$K._unlock,!0))},$K._emptySource=null,$K._dataCache={},$K.buffs=[],$K.isDecoding=!1,$K._unlocked=!1,$K.tInfo=null,$K.__loadingSound={},$R($K,["window",function(){return this.window=$h.window},"webAudioEnabled",function(){return this.webAudioEnabled=$K.window.AudioContext||$K.window.webkitAudioContext||$K.window.mozAudioContext},"ctx",function(){return this.ctx=$K.webAudioEnabled?new($K.window.AudioContext||$K.window.webkitAudioContext||$K.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$K.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $A}]),$K}(),$Vt=function($t){function $H(){this._responseType=null,this._data=null,$H.__super.call(this),this._http=new $h.window.XMLHttpRequest}$M($H,"laya.net.HttpRequest",$A);var $I=$H.prototype;return $I.send=function($t,$H,$I,$T,$K){void 0===$I&&($I="get"),void 0===$T&&($T="text"),this._responseType=$T,this._data=null;var $_=this,$V=this._http;if($V.open($I,$t,!0),$K)for(var $e=0;$e<$K.length;$e++)$V.setRequestHeader($K[$e++],$K[$e]);else $g.isConchApp||($H&&"string"!=typeof $H?$V.setRequestHeader("Content-Type","application/json"):$V.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$V.responseType="arraybuffer"!==$T?"text":"arraybuffer",$V.onerror=function($t){$_._onError($t)},$V.onabort=function($t){$_._onAbort($t)},$V.onprogress=function($t){$_._onProgress($t)},$V.onload=function($t){$_._onLoad($t)},$V.send($H)},$I._onProgress=function($t){$t&&$t.lengthComputable&&this.event("progress",$t.loaded/$t.total)},$I._onAbort=function($t){this.error("Request was aborted by user")},$I._onError=function($t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$I._onLoad=function($t){var $H=this._http,$I=void 0!==$H.status?$H.status:200;200===$I||204===$I||0===$I?this.complete():this.error("["+$H.status+"]"+$H.statusText+":"+$H.responseURL)},$I.error=function($t){this.clear(),this.event("error",$t)},$I.complete=function(){this.clear();var $H=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$i.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($t){$H=!1,this.error($t.message)}$H&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$I.clear=function(){var $t=this._http;$t.onerror=$t.onabort=$t.onprogress=$t.onload=null},$q(0,$I,"url",function(){return this._http.responseURL}),$q(0,$I,"http",function(){return this._http}),$q(0,$I,"data",function(){return this._data}),$H}(),$et=function($t){function $P(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$P.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}$M($P,"laya.net.Loader",$A);var $H=$P.prototype;return $H.load=function($t,$H,$I,$T,$K){if($t&&""!=$t||console.error("Loader 加载的url不合法 "+$t),void 0===$I&&($I=!0),void 0===$K&&($K=!1),0===(this._url=$t).indexOf("data:image")?this._type=$H="image":this._type=$H||($H=this.getTypeFromUrl($t)),this._cache=$I,this._data=null,!$K&&$P.loadedMap[$t])return this._data=$P.loadedMap[$t],this.event("progress",1),void this.event("complete",this._data);if($T&&$P.setGroup($t,$T),null!=$P.parserMap[$H])return this._customParse=!0,void($P.parserMap[$H]instanceof laya.utils.Handler?$P.parserMap[$H].runWith(this):$P.parserMap[$H].call(null,this));if("image"===$H||"htmlimage"===$H||"nativeimage"===$H)return this._loadImage($t);if("ttf"===$H)return this._loadTTF($t);switch($H){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$H}$P.preLoadedMap[$t]?this.onLoaded($P.preLoadedMap[$t]):$V.resMgrLoad($t,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$H.getTypeFromUrl=function($t){var $H=$i.getFileExtension($t);return $H?$P.typeMap[$H]:(console.warn("Not recognize the resources suffix",$t),"text")},$H._loadTTF=function($t){$t=$p.formatURL($t);var $H=new $D;$H.complete=$S.create(this,this.onLoaded),$H.load($t)},$H._loadImage=function($t){$V.imgMgrLoad($t,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$H._loadImageComplete=function($t,$H,$I){if(null!=$I)if($I instanceof ArrayBuffer){var $T=new DataView($I),$K=new laya.webgl.resource.WebGLImage(new Uint8Array($I,8),$t,0,!1,$T.getUint32(0),$T.getUint32(4));this.onLoaded($K)}else if($I instanceof $qt)$P.imgMgrSet[$t]=$H,$V.imgMgrLock($t,$P.imgMgrSet[$t]),this._url=$t,this.complete($I);else{var $_=-1!=$t.indexOf(".png",$t.length-4)?6408:6407;$K=new laya.webgl.resource.WebGLImage($I,$t,$_,!1,$I.width,$I.height);this.onLoaded($K)}else this.event("error","Load image failed")},$H.imageCancel=function($t,$H,$I){$V.imgMgrCancel&&$V.imgMgrCancel($t,this._onImageCallback)},$H._loadSound=function($t){var $H=new $r._soundClass,$I=this;function $T(){$H.offAll()}$H.on("complete",this,function(){$T(),$I.onLoaded($H)}),$H.on("error",this,function(){$T(),$H.dispose(),$I.event("error","Load sound failed")}),$H.load($t)},$H.onProgress=function($t){"atlas"===this._type?this.event("progress",.3*$t):this.event("progress",$t)},$H.onError=function($t){this.event("error",$t)},$H._loadedComplete=function($t,$H,$I){if(null!=$I)switch(this._type){case"atlas":case"plf":case"json":var $T=new $X($I);this.onLoaded(JSON.parse($T.readUTFBytes()));break;case"font":$T=new $X($I);this.onLoaded($i.parseXMLFromString($T.readUTFBytes()));break;default:this.onLoaded($I)}else this.event("error",$t)},$H.onLoaded=function($t){var $H=this._type;if("plf"==$H)this.parsePLFData($t),this.complete($t);else if("image"===$H){var $I=new $qt($t);$I.url=this._url,this.complete($I)}else if("sound"===$H||"htmlimage"===$H||"nativeimage"===$H)this.complete($t);else if("atlas"===$H){if(!$t.src&&!$t._setContext){if(!this._data){if((this._data=$t).meta&&$t.meta.image)for(var $T=$t.meta.image.split(","),$K=0<=this._url.indexOf("/")?"/":"\\",$_=this._url.lastIndexOf($K),$V=0<=$_?this._url.substr(0,$_+1):"",$e=0,$R=$T.length;$e<$R;$e++)$T[$e]=$V+$T[$e];else $T=[this._url.replace(".json",".png")];$T.reverse(),$t.toLoads=$T,$t.pics=[]}return this.event("progress",.3+1/$T.length*.6),this._loadImage($T.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($t),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $A=this._data.frames,$q=this._url.split("?")[0],$f=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$q.substring(0,$q.lastIndexOf("."))+"/",$b=this._data.pics,$L=$p.formatURL(this._url),$G=$P.atlasMap[$L]||($P.atlasMap[$L]=[]);$G.dir=$f;var $M=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $O in $M=parseFloat(this._data.meta.scale),$A){var $J,$S=$A[$O],$U=$b[$S.frame.idx?$S.frame.idx:0],$C=$p.formatURL($f+$O);$U.scaleRate=$M,$J=$qt.create($U,$S.frame.x,$S.frame.y,$S.frame.w,$S.frame.h,$S.spriteSourceSize.x,$S.spriteSourceSize.y,$S.sourceSize.w,$S.sourceSize.h),$P.cacheRes($C,$J),$P.keepCache(this._url,$f+$O),$J.url=$C,$G.push($C)}else for($O in $A)$U=$b[($S=$A[$O]).frame.idx?$S.frame.idx:0],$C=$p.formatURL($f+$O),$P.cacheRes($C,$qt.create($U,$S.frame.x,$S.frame.y,$S.frame.w,$S.frame.h,$S.spriteSourceSize.x,$S.spriteSourceSize.y,$S.sourceSize.w,$S.sourceSize.h)),$P.loadedMap[$C].url=$C,$P.keepCache(this._url,$f+$O),$G.push($C);delete this._data.pics,this.complete(this._data)}else if("font"==$H){if(!$t.src)return this._data=$t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $N=new $k;$N.parseFont(this._data,$t);var $w=this._url.split(".fnt")[0].split("/"),$W=$w[$w.length-1];$Ot.registerBitmapFont($W,$N),this._data=$N,this.complete(this._data)}else if("pkm"==$H){var $s=$wt.create($t,this._url),$z=new $qt($s);$z.url=this._url,this.complete($z)}else this.complete($t)},$H.parsePLFData=function($t){var $H,$I,$T;for($H in $t)switch($T=$t[$H],$H){case"json":case"text":for($I in $T)$P.preLoadedMap[$p.formatURL($I)]=$T[$I];break;default:for($I in $T)$P.preLoadedMap[$p.formatURL($I)]=$T[$I]}},$H.complete=function($t){this._data=$t,this._customParse?this.event("loaded",$t instanceof Array?[$t]:$t):($P._loaders.push(this),$P._isWorking||$P.checkNext())},$H.endLoad=function($t){$t&&(this._data=$t),this._cache&&$P.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$q(0,$H,"url",function(){return this._url}),$q(0,$H,"data",function(){return this._data}),$q(0,$H,"cache",function(){return this._cache}),$q(0,$H,"type",function(){return this._type}),$P.checkNext=function(){$P._isWorking=!0;for(var $t=$h.now();$P._startIndex<$P._loaders.length;)if($h.now(),$P._loaders[$P._startIndex].endLoad(),$P._startIndex++,$h.now()-$t>$P.maxTimeOut)return console.warn("loader callback cost a long time:"+($h.now()-$t)+" url="+$P._loaders[$P._startIndex-1].url),void $W.timer.frameOnce(1,null,$P.checkNext);$P._loaders.length=0,$P._startIndex=0,$P._isWorking=!1},$P.clearRes=function($t,$H){if(null!=$t){void 0===$H&&($H=!1),$t=$p.formatURL($t);var $I=$P.getAtlas($t);if($I){for(var $T=0,$K=$I.length;$T<$K;$T++){var $_=$I[$T],$V=$P.getRes($_);delete $P.loadedMap[$_],$P.clearCache($t.substring($p.basePath.length),$_.substring($p.basePath.length)),$V&&$V.destroy($H)}$I.length=0,delete $P.atlasMap[$t],delete $P.loadedMap[$t]}else{var $e=$P.loadedMap[$t];$e&&(delete $P.loadedMap[$t],$e instanceof laya.resource.Texture&&$e.bitmap&&$e.destroy($H))}}},$P.clearTextureRes=function($t){$t=$p.formatURL($t);var $H=laya.net.Loader.getAtlas($t),$I=$H&&0<$H.length?laya.net.Loader.getRes($H[0]):laya.net.Loader.getRes($t);$I&&$I.bitmap&&($g.isConchApp&&!$g.isConchWebGL?$I.bitmap.source.releaseTexture&&$I.bitmap.source.releaseTexture():null==$I.bitmap._atlaser&&$I.bitmap.releaseResource(!0))},$P.getRes=function($t){return $P.loadedMap[$p.formatURL($t)]},$P.getAtlas=function($t){return $P.atlasMap[$p.formatURL($t)]},$P.cacheRes=function($t,$H){$t=$p.formatURL($t),null!=$P.loadedMap[$t]?console.warn("Resources already exist,is repeated loading:",$t):$P.loadedMap[$t]=$H},$P.setGroup=function($t,$H){$P.groupMap[$H]||($P.groupMap[$H]=[]),$P.groupMap[$H].push($t)},$P.clearResByGroup=function($t){if($P.groupMap[$t]){var $H=$P.groupMap[$t],$I=0,$T=$H.length;for($I=0;$I<$T;$I++)$P.clearRes($H[$I]);$H.length=0}},$P.keepCache=function($t,$H){if($t&&$H){var $I=$P.cacheSet[$H];$I?-1==$I.indexOf($t)&&$I.push($t):$P.cacheSet[$H]=[$t]}},$P.clearCache=function($t,$H){if($t&&$H){var $I=$P.cacheSet[$H];if($I){var $T=$I.indexOf($t);if(-1!==$T){var $K=$I.length-1;0==$K?(delete $P.cacheSet[$H],0<$P.imgMgrSet[$H]?$V.imgMgrFree($H,$P.imgMgrSet[$H]):$P.clearRes($H,!0)):($I[$T]=$I[$K],$I.length=$K)}}}},$P.saveObject=function($t,$H,$I){if($H&&$t){var $T=$P.objectSet[$t];$T?(console.warn("Loader.saveObject: "+$t),$T[0]=$H,$T[1]=$I):$P.objectSet[$t]=[$H,$I,[]]}},$P.findObject=function($t){if($t){var $H=$P.objectSet[$t];if($H)return $H[0]}return null},$P.keepObject=function($t,$H){if($t&&$H){var $I=$P.objectSet[$H];$I&&-1===$I[2].indexOf($t)&&$I[2].push($t)}},$P.clearObject=function($t,$H){if($t&&$H){var $I=$P.objectSet[$H];if($I){var $T=$I[2],$K=$T.indexOf($t);if(-1!==$K){var $_=$T.length-1;0==$_?(delete $P.objectSet[$H],$I[1]&&$I[1].call(null,$I[0])):($T[$K]=$T[$_],$T.length=$_)}}}},$P.TEXT="text",$P.JSON="json",$P.XML="xml",$P.BUFFER="arraybuffer",$P.IMAGE="image",$P.SOUND="sound",$P.ATLAS="atlas",$P.FONT="font",$P.TTF="ttf",$P.PLF="plf",$P.PKM="pkm",$P.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$P.parserMap={},$P.groupMap={},$P.maxTimeOut=100,$P.loadedMap={},$P.preLoadedMap={},$P.atlasMap={},$P._loaders=[],$P._isWorking=!1,$P._startIndex=0,$P.imgCache={},$P.cacheSet={},$P.objectSet={},$P.imgMgrSet={},$P}(),$Rt=function($t){var $b;function $L(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$L.__super.call(this);for(var $t=0;$t<this._maxPriority;$t++)this._resInfos[$t]=[]}$M($L,"laya.net.LoaderManager",$A);var $H=$L.prototype;return $H.create=function($t,$I,$H,$T,$K,$_,$V,$e){if(null==$_&&($_=2),null==$V&&($V=!0),$t instanceof Array){var $R=$t,$A=$R.length,$q=0;if($H)var $f=$S.create($H.caller,$H.method,$H.args,!1);for(var $b=0;$b<$A;$b++){var $L=$R[$b];"string"==typeof $L&&($L=$R[$b]={url:$L}),$L.progress=0}for($b=0;$b<$A;$b++){$L=$R[$b];var $G=$H?$S.create(null,$J,[$L],!1):null,$M=$H||$I?$S.create(null,$O,[$L]):null;this._create($L.url,$M,$G,$L.clas||$T,$L.params||$K,null!=$L.priority&&0<=$L.priority?$L.priority:$_,$V,$L.group||$e)}function $O($t,$H){$q++,$t.progress=1,$q===$A&&$I&&$I.run()}function $J($t,$H){$t.progress=$H;for(var $I=0,$T=0;$T<$A;$T++){$I+=$R[$T].progress}var $K=$I/$A;$f.runWith($K)}return!0}return this._create($t,$I,$H,$T,$K,$_,$V,$e)},$H._create=function($H,$I,$t,$T,$K,$_,$V,$e){$H&&""!=$H||console.error("加载的url不合法 "+$H),null==$_&&($_=2),null==$V&&($V=!0);var $R=$p.formatURL($H),$A=this.getRes($R);if($A)!$A.hasOwnProperty("loaded")||$A.loaded?($t&&$t.runWith(1),$I&&$I.run()):$I&&$W.loader._createListener($H,$I.caller,$I.method,$I.args,!0,!1);else{var $q=$i.getFileExtension($H),$f=$L.createMap[$q];if(!$f)throw new Error("LoaderManager:unknown file("+$H+") extension with: "+$q+".");$T||($T=$f[0]);var $b=$f[1];if("atlas"==$q)this.load($H,$I,$t,$b,$_,$V);else{$T===$qt&&($b="htmlimage"),($A=$T?new $T:null).hasOwnProperty("_loaded")&&($A._loaded=!1),$A._setUrl($H),$e&&$A._setGroup($e),this._createLoad($A,$H,$S.create(null,function($t){$A&&!$A.destroyed&&$t&&$A.onAsynLoaded.call($A,$H,$t,$K),$I&&$I.run();$W.loader.event($H)}),$t,$b,$_,!1,$e,!0),$V&&this.cacheRes($R,$A)}}return $A},$H.load=function($t,$H,$I,$T,$K,$_,$V,$e){$t&&""!=$t||console.error("加载的url不合法 "+$t);var $R=this;if(null==$K&&($K=2),null==$_&&($_=!0),void 0===$e&&($e=!1),$t instanceof Array)return this._loadAssets($t,$H,$I,$T,$K,$_,$V);var $A=$et.getRes($t);if(null!=$A)$W.timer.frameOnce(1,null,function(){$I&&$I.runWith(1),$H&&$H.runWith($A),$R._loaderCount||$R.event("complete")});else{var $q=$L._resMap[$t];$q?($H&&$q._createListener("complete",$H.caller,$H.method,$H.args,!1,!1),$I&&$q._createListener("progress",$I.caller,$I.method,$I.args,!1,!1)):(($q=this._infoPool.length?this._infoPool.pop():new $b).url=$t,$q.clas=null,$q.type=$T,$q.cache=$_,$q.group=$V,$q.ignoreCache=$e,$q.priority=$K,$H&&$q.on("complete",$H.caller,$H.method,$H.args),$I&&$q.on("progress",$I.caller,$I.method,$I.args),$L._resMap[$t]=$q,$K=$K<this._maxPriority?0<=$K?$K:0:this._maxPriority-1,this._resInfos[$K].push($q),this._next())}return this},$H.cancel=function($t,$H,$I){if($A=$L._resMap[$t]){$H&&$A.off("complete",$H.caller,$H.method,!1),$I&&$A.off("progress",$I.caller,$I.method,!1);var $T=$A.getListener("complete"),$K=$A.getListener("progress");if(!($T&&$T.head||$K&&$K.head)){if($A.loader){var $_=$A.loader;$_.imageCancel($t),$_.offAll(),$_._data=null,$_._customParse=!1,$_._url=null,$_._class=null,$_._type=null,this._loaders.push($_),this._loaderCount--,delete this._loaderMap[$A.url]}for(var $V=0;$V<this._maxPriority;$V++)for(var $e=this._resInfos[$V],$R=$e.length-1;-1<$R;$R--){var $A;($A=$e[$R])&&$A.url===$t&&($e[$R]=null,$A.destroy(),$A.offAll(),this._infoPool.push($A))}delete $L._resMap[$t],this._next()}}},$H._createLoad=function($t,$H,$I,$T,$K,$_,$V,$e,$R){var $A=this;if(null==$_&&($_=2),null==$V&&($V=!0),void 0===$R&&($R=!1),$H instanceof Array)return this._loadAssets($H,$I,$T,$K,$_,$V,$e);var $q=$et.getRes($H);if(null!=$q)$W.timer.frameOnce(1,null,function(){$T&&$T.runWith(1),$I&&$I.runWith($q),$A._loaderCount||$A.event("complete")});else{var $f=$L._resMap[$H];$f?($I&&$f._createListener("complete",$I.caller,$I.method,$I.args,!1,!1),$T&&$f._createListener("progress",$T.caller,$T.method,$T.args,!1,!1)):(($f=this._infoPool.length?this._infoPool.pop():new $b).url=$H,$f.clas=$t,$f.type=$K,$f.cache=$V,$f.group=$e,$f.ignoreCache=$R,$f.priority=$_,$I&&$f.on("complete",$I.caller,$I.method,$I.args),$T&&$f.on("progress",$T.caller,$T.method,$T.args),$L._resMap[$H]=$f,$_=$_<this._maxPriority?0<=$_?$_:0:this._maxPriority-1,this._resInfos[$_].push($f),this._next())}return this},$H._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $t=0;$t<this._maxPriority;$t++)for(var $H=this._resInfos[$t];0<$H.length;){var $I=$H.shift();if($I)return this._doLoad($I)}this._loaderCount||this.event("complete")}},$H._doLoad=function($H){var $I=this._loaders.length?this._loaders.pop():new $et;this._loaderCount++,(this._loaderMap[$H.url]=$I).on("complete",null,$K),$I.on("progress",null,function($t){$H.event("progress",$t)}),$I.on("error",null,function($t){$K(null)}),$H.loader=$I;var $T=this;function $K($t){$I.offAll(),$I._data=null,$I._customParse=!1,$I._url=null,$I._class=null,$I._type=null,$T._loaders.push($I),$T._loaderCount--,delete $T._loaderMap[$H.url],$T._endLoad($H,$t instanceof Array?[$t]:$t),$T._next()}$I._class=$H.clas,1<=$H.priority?($I.priority=$H.priority,$I.realTime=!1):($I.priority=0,$I.realTime=!0),$I.load($H.url,$H.type,$H.cache,$H.group,$H.ignoreCache)},$H._endLoad=function($t,$H){var $I=$t.url;if(null==$H){var $T=this._failRes[$I]||0;if($T<this.retryNum)return console.warn("[warn]Retry to load:",$I),this._failRes[$I]=$T+1,void $W.timer.once(this.retryDelay,this,this._addReTry,[$t],!1);console.warn("[error]Failed to load:",$I),this.event("error",$I)}this._failRes[$I]&&(this._failRes[$I]=0),delete $L._resMap[$I],$t.event("complete",$H),$t.destroy(),$t.offAll(),this._infoPool.push($t)},$H._addReTry=function($t){this._resInfos[this._maxPriority-1].push($t),this._next()},$H.clearRes=function($t,$H){void 0===$H&&($H=!1),$et.clearRes($t,$H)},$H.getRes=function($t){return $et.getRes($t)},$H.cacheRes=function($t,$H){$et.cacheRes($t,$H)},$H.clearTextureRes=function($t){$et.clearTextureRes($t)},$H.setGroup=function($t,$H){$et.setGroup($t,$H)},$H.clearResByGroup=function($t){$et.clearResByGroup($t)},$H.clearUnLoaded=function(){for(var $t=0;$t<this._maxPriority;$t++){for(var $H=this._resInfos[$t],$I=$H.length-1;-1<$I;$I--){var $T=$H[$I];$T&&($T.destroy(),$T.offAll(),this._infoPool.push($T))}$H.length=0}this._loaderCount=0,$L._resMap={}},$H.cancelLoadByUrls=function($t){if($t)for(var $H=0,$I=$t.length;$H<$I;$H++)this.cancelLoadByUrl($t[$H])},$H.cancelLoadByUrl=function($t){for(var $H=0;$H<this._maxPriority;$H++)for(var $I=this._resInfos[$H],$T=$I.length-1;-1<$T;$T--){var $K=$I[$T];$K&&$K.url===$t&&($I[$T]=null,$K.destroy(),$K.offAll(),this._infoPool.push($K))}$L._resMap[$t]&&delete $L._resMap[$t]},$H._loadAssets=function($t,$I,$V,$H,$T,$K,$_){null==$T&&($T=2),null==$K&&($K=!0);for(var $e=$t.length,$R=0,$A=0,$q=[],$f=!0,$b=0;$b<$e;$b++){var $L=$t[$b];if(!$L)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$t);"string"==typeof $L&&($L={url:$L,type:$H,size:1,priority:$T}),$L.size||($L.size=1),$L.progress=0,$A+=$L.size,$q.push($L);var $G=$V?$S.create(null,$J,[$L],!1):null,$M=$I||$V?$S.create(null,$O,[$L]):null;this.load($L.url,$M,$G,$L.type,null!=$L.priority&&0<=$L.priority?$L.priority:2,$K,$L.group||$_)}function $O($t,$H){$R++,$t.progress=1,$H||($f=!1),$R===$e&&$I&&$I.runWith($f)}function $J($t,$H){if(null!=$V){$t.progress=$H;for(var $I=0,$T=0;$T<$q.length;$T++){var $K=$q[$T];$I+=$K.size*$K.progress}var $_=$I/$A;$V.runWith($_)}}return this},$L.cacheRes=function($t,$H){$et.cacheRes($t,$H)},$L._resMap={},$R($L,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$L.__init$=function(){$b=function($t){function $H(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$H.__super.call(this)}return $M($H,"",$A),$H.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$H}()},$L}(),$At=(function($t){function $K($t){$K.__super.call(this),$t||($t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $H=0,$I=0,$T=0;$T<20;$T++)$T%5!=4?this._mat[$H++]=$t[$T]:this._alpha[$I++]=$t[$T];this._action=$x.createFilterAction(32),this._action.data=this}$M($K,"laya.filters.ColorFilter",$J);var $H=$K.prototype;$W.imps($H,{"laya.filters.IFilter":!0}),$H.callNative=function($t){$t._$P.cf=this;$t.conchModel&&$t.conchModel.setFilterMatrix&&$t.conchModel.setFilterMatrix(this._mat,this._alpha)},$q(0,$H,"type",function(){return 32}),$q(0,$H,"action",function(){return this._action})}(),function($t){function $T($t,$H,$I){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$H&&($H=0),$T.__super.call(this),this._byteClass=$I||$X,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$t&&0<$H&&$H<65535&&this.connect($t,$H)}$M($T,"laya.net.Socket",$A);var $H=$T.prototype;$H.connect=function($t,$H){var $I="ws://"+$t+":"+$H;$I="https:"==$h.window.location.protocol?"wss://"+$t+":"+$H:"ws://"+$t+":"+$H,this.connectByUrl($I)},$H.connectByUrl=function($t){var $H=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $h.window.WebSocket($t,this.protocols):this._socket=new $h.window.WebSocket($t),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($t){$H._onOpen($t)},this._socket.onmessage=function($t){$H._onMessage($t)},this._socket.onclose=function($t){$H._onClose($t)},this._socket.onerror=function($t){$H._onError($t)}},$H.cleanSocket=function(){try{this._socket.close()}catch($t){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$H.close=function(){if(null!=this._socket)try{this._socket.close()}catch($t){}},$H._onOpen=function($t){this._connected=!0,this.event("open",$t)},$H._onMessage=function($t){if($t&&$t.data){var $H=$t.data;if(this.disableInput&&$H)this.event("message",$H);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $I=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$H&&("string"==typeof $H?this._input.writeUTFBytes($H):this._input.writeArrayBuffer($H),this._addInputPosition=this._input.pos,this._input.pos=$I),this.event("message",$H)}}},$H._onClose=function($t){this._connected=!1,this.event("close",$t)},$H._onError=function($t){this.event("error",$t)},$H.send=function($t){this._socket.send($t)},$H.flush=function(){if(this._output&&0<this._output.length){var $H;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($t){$H=$t}this._output.endian=this.endian,this._output.clear(),$H&&this.event("error",$H)}},$q(0,$H,"input",function(){return this._input}),$q(0,$H,"output",function(){return this._output}),$q(0,$H,"connected",function(){return this._connected}),$q(0,$H,"endian",function(){return this._endian},function($t){this._endian=$t,null!=this._input&&(this._input.endian=$t),null!=this._output&&(this._output.endian=$t)}),$T.LITTLE_ENDIAN="littleEndian",$T.BIG_ENDIAN="bigEndian"}(),function($t){function $e(){$e.__super.call(this),this._$1__id=++$e._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($e._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$E.currentResourceManager&&$E.currentResourceManager.addResource(this)}$M($e,"laya.resource.Resource",$A);var $H=$e.prototype;return $W.imps($H,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$H._setUrl=function($t){var $H;this._url!==$t&&(this._url&&(($H=$e._urlResourcesMap[this._url]).splice($H.indexOf(this),1),0===$H.length&&delete $e._urlResourcesMap[this._url]),$t&&(($H=$e._urlResourcesMap[$t])||($e._urlResourcesMap[$t]=$H=[]),$H.push(this)),this._url=$t)},$H._getGroup=function(){return this._group},$H._setGroup=function($t){var $H;this._group!==$t&&(this._group&&(($H=$e._groupResourcesMap[this._group]).splice($H.indexOf(this),1),0===$H.length&&delete $e._groupResourcesMap[this._group]),$t&&(($H=$e._groupResourcesMap[$t])||($e._groupResourcesMap[$t]=$H=[]),$H.push(this)),this._group=$t)},$H._addReference=function(){this._referenceCount++},$H._removeReference=function(){this._referenceCount--},$H._clearReference=function(){this._referenceCount=0},$H._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$H.recreateResource=function(){this.completeCreate()},$H.disposeResource=function(){},$H.activeResource=function($t){void 0===$t&&($t=!1),this._lastUseFrameCount=$n.loopCount,!this._destroyed&&this.__loaded&&(this._released||$t)&&this.recreateResource()},$H.releaseResource=function($t){return void 0===$t&&($t=!0),!(!$t&&this.lock)&&(!(this._released&&!$t)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$H.onAsynLoaded=function($t,$H,$I){throw new Error("Resource: must override this function!")},$H.destroy=function(){var $t;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $e._idResourcesMap[this.id],this._url&&(($t=$e._urlResourcesMap[this._url])&&($t.splice($t.indexOf(this),1),0===$t.length&&delete $e._urlResourcesMap[this.url]),$et.clearRes(this._url),this.__loaded||$x.cancelLoadByUrl(this._url)),this._group&&(($t=$e._groupResourcesMap[this._group]).splice($t.indexOf(this),1),0===$t.length&&delete $e._groupResourcesMap[this.url]))},$H.completeCreate=function(){this._released=!1,this.event("recovered",this)},$H.dispose=function(){this.destroy()},$q(0,$H,"memorySize",function(){return this._memorySize},function($t){var $H=$t-this._memorySize;this._memorySize=$t,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$H),this.resourceManager&&this.resourceManager.addSize($H)}),$q(0,$H,"_loaded",null,function($t){this.__loaded=$t}),$q(0,$H,"loaded",function(){return this.__loaded}),$q(0,$H,"id",function(){return this._$1__id}),$q(0,$H,"destroyed",function(){return this._destroyed}),$q(0,$H,"group",function(){return this._getGroup()},function($t){this._setGroup($t)}),$q(0,$H,"resourceManager",function(){return this._resourceManager}),$q(0,$H,"url",function(){return this._url}),$q(0,$H,"released",function(){return this._released}),$q(0,$H,"referenceCount",function(){return this._referenceCount}),$e.getResourceByID=function($t){return $e._idResourcesMap[$t]},$e.getResourceByURL=function($t,$H){return void 0===$H&&($H=0),null==$e._urlResourcesMap[$t]?null:$e._urlResourcesMap[$t][$H]},$e.getResourceCountByURL=function($t){return $e._urlResourcesMap[$t].length},$e.destroyUnusedResources=function($t){var $H;if($t){var $I=$e._groupResourcesMap[$t];if($I)for(var $T=$I.slice(),$K=0,$_=$T.length;$K<$_;$K++)($H=$T[$K]).lock||0!==$H._referenceCount||$H.destroy()}else for(var $V in $e._idResourcesMap)($H=$e._idResourcesMap[$V]).lock||0!==$H._referenceCount||$H.destroy()},$e._uniqueIDCounter=0,$e._idResourcesMap={},$e._urlResourcesMap={},$e._groupResourcesMap={},$e}()),$qt=function($t){function $P($t,$H){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$P.__super.call(this),$t&&null!=$t._addReference&&$t._addReference(),this.setTo($t,$H)}$M($P,"laya.resource.Texture",$A);var $H=$P.prototype;return $H._setUrl=function($t){this.url=$t},$H.setTo=function($t,$H){if($t instanceof $V.HTMLElement){var $I=$Ut.create("2D",$t);this.bitmap=$I}else this.bitmap=$t;if(this.uv=$H||$P.DEF_UV,$t){this._w=$t.width,this._h=$t.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $T=this;if(this._loaded)$x.addToAtlas&&$x.addToAtlas($T);else{var $K=$t;$K instanceof laya.resource.HTMLImage&&$K.image&&$K.image.addEventListener("load",function($t){$x.addToAtlas&&$x.addToAtlas($T)},!1)}}},$H.active=function(){this.bitmap&&this.bitmap.activeResource()},$H.destroy=function($t){if(void 0===$t&&($t=!1),this.alphaTexture&&(this.alphaTexture.destroy($t),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $H=this.bitmap;$t?($g.isConchApp&&$H.source&&$H.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$H.dispose(),$H._clearReference()):($H._removeReference(),0==$H.referenceCount&&($g.isConchApp&&$H.source&&$H.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$H.dispose())),this.url&&this===$W.loader.getRes(this.url)&&$W.loader.clearRes(this.url,$t),this._loaded=!1}},$H.load=function($t){var $H=this;this._loaded=!1,$t=$p.customFormat($t);var $I=this.bitmap||(this.bitmap=$wt.create($t));$I.uri=$t,$I&&$I._addReference();var $T=this;$I.onload=function(){$I.onload=null,$T._loaded=!0,$H.sourceWidth=$H._w=$I.width,$H.sourceHeight=$H._h=$I.height,$T.event("loaded",this),$x.addToAtlas&&$x.addToAtlas($T)}},$H.addTextureToAtlas=function($t){$x.addTextureToAtlas(this)},$H.getPixels=function($t,$H,$I,$T){if($g.isConchApp){var $K=this.bitmap;if($K.source&&$K.source.getImageData){var $_=$K.source.getImageData($t,$H,$I,$T),$V=new Uint8Array($_);return Array.from($V)}return null}return $g.isWebGL?$x.getTexturePixels(this,$t,$H,$I,$T):($h.canvas.size($I,$T),$h.canvas.clear(),$h.context.drawTexture(this,-$t,-$H,this.width,this.height,0,0),$h.context.getImageData(0,0,$I,$T).data)},$H.onAsynLoaded=function($t,$H){if($H){if("function"!=typeof $H._addReference)throw new Error("bitmap._addReference is not a function. "+$H.className+" "+typeof $H._addReference+" "+$H.constructor);$H._addReference()}this.setTo($H,this.uv),this._loaded&&this.event("loaded",this)},$q(0,$H,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$q(0,$H,"loaded",function(){return this._loaded}),$q(0,$H,"released",function(){return!this.bitmap||this.bitmap.released}),$q(0,$H,"width",function(){return this._w?this._w:this.uv&&this.uv!==$P.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($t){this._w=$t,this.sourceWidth||(this.sourceWidth=$t)}),$q(0,$H,"repeat",function(){return!$g.isWebGL||!this.bitmap||this.bitmap.repeat},function($t){$t&&$g.isWebGL&&this.bitmap&&(this.bitmap.repeat=$t)&&(this.bitmap.enableMerageInAtlas=!1)}),$q(0,$H,"height",function(){return this._h?this._h:this.uv&&this.uv!==$P.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($t){this._h=$t,this.sourceHeight||(this.sourceHeight=$t)}),$q(0,$H,"isLinearSampling",function(){return!$g.isWebGL||9728!=this.bitmap.minFifter},function($t){!$t&&$g.isWebGL&&($t||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$P.moveUV=function($t,$H,$I){for(var $T=0;$T<8;$T+=2)$I[$T]+=$t,$I[$T+1]+=$H;return $I},$P.create=function($t,$H,$I,$T,$K,$_,$V,$e,$R){void 0===$_&&($_=0),void 0===$V&&($V=0),void 0===$e&&($e=0),void 0===$R&&($R=0);var $A=$t instanceof laya.resource.Texture,$q=$A?$t.uv:$P.DEF_UV,$f=$A?$t.bitmap:$t,$b=$x.isAtlas($f);if($b){var $L=$f._atlaser,$G=$t._atlasID;if(-1==$G)throw new Error("create texture error");$f=$L._inAtlasTextureBitmapValue[$G],$q=$L._inAtlasTextureOriUVValue[$G]}var $M=new $P($f,null);$f.width&&$H+$T>$f.width&&($T=$f.width-$H),$f.height&&$I+$K>$f.height&&($K=$f.height-$I),$M.width=$T,$M.height=$K,$M.offsetX=$_,$M.offsetY=$V,$M.sourceWidth=$e||$T,$M.sourceHeight=$R||$K;var $O=1/$f.width,$J=1/$f.height;$H*=$O,$I*=$J,$T*=$O,$K*=$J;var $S=$M.uv[0],$U=$M.uv[1],$C=$M.uv[4],$N=$M.uv[5],$w=$C-$S,$W=$N-$U,$s=$P.moveUV($q[0],$q[1],[$H,$I,$H+$T,$I,$H+$T,$I+$K,$H,$I+$K]);$M.uv=[$S+$s[0]*$w,$U+$s[1]*$W,$C-(1-$s[2])*$w,$U+$s[3]*$W,$C-(1-$s[4])*$w,$N-(1-$s[5])*$W,$S+$s[6]*$w,$N-(1-$s[7])*$W],$b&&$M.addTextureToAtlas();var $z=$f.scaleRate;return $z&&1!=$z?($M.sourceWidth/=$z,$M.sourceHeight/=$z,$M.width/=$z,$M.height/=$z,$M.scaleRate=$z,$M.offsetX/=$z,$M.offsetY/=$z):$M.scaleRate=1,$M},$P.createFromTexture=function($t,$H,$I,$T,$K){var $_=$t.scaleRate;1!=$_&&($H*=$_,$I*=$_,$T*=$_,$K*=$_);var $V=$z.TEMP.setTo($H-$t.offsetX,$I-$t.offsetY,$T,$K),$e=$V.intersection($P._rect1.setTo(0,0,$t.width,$t.height),$P._rect2);if(!$e)return null;var $R=$P.create($t,$e.x,$e.y,$e.width,$e.height,$e.x-$V.x,$e.y-$V.y,$T,$K);if($R.bitmap&&$R.bitmap._removeReference)return $R.bitmap._removeReference(),$R;var $A="bitmap:"+($R.bitmap?$R.bitmap.constructor?$R.bitmap.constructor.name:$R.bitmap.__className:"")+", url:"+($t.url+" | "+($R.bitmap?$R.bitmap.url:$t.url))+", x="+$H+",y="+$I+",width="+$T+",height="+$K+", result="+($e?$e.x+","+$e.y+","+$e.width+","+$e.height:"null")+", rect="+$V.x+","+$V.y+","+$V.width+","+$V.height;throw new Error("报错：bitmap._removeReference is not a function  "+$A)},$P.DEF_UV=[0,0,1,0,1,1,0,1],$P.INV_UV=[0,1,1,1,1,0,0,0],$P._rect1=new $z,$P._rect2=new $z,$P}(),$t=function($t){var $e;function $_(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$_.__super.call(this)}$M($_,"laya.utils.TimeLine",$A);var $H=$_.prototype;return $H.to=function($t,$H,$I,$T,$K){return void 0===$K&&($K=0),this._create($t,$H,$I,$T,$K,!0)},$H.from=function($t,$H,$I,$T,$K){return void 0===$K&&($K=0),this._create($t,$H,$I,$T,$K,!1)},$H._create=function($t,$H,$I,$T,$K,$_){var $V=$o.getItemByClass("tweenData",$e);return $V.isTo=$_,$V.type=0,$V.target=$t,$V.duration=$I,$V.data=$H,$V.startTime=this._startTime+$K,$V.endTime=$V.startTime+$V.duration,$V.ease=$T,this._startTime=Math.max($V.endTime,this._startTime),this._tweenDataList.push($V),this._startTimeSort=!0,this._endTimeSort=!0,this},$H.addLabel=function($t,$H){var $I=$o.getItemByClass("tweenData",$e);return $I.type=1,$I.data=$t,$I.endTime=$I.startTime=this._startTime+$H,this._labelDic||(this._labelDic={}),this._labelDic[$t]=$I,this._tweenDataList.push($I),this},$H.removeLabel=function($t){if(this._labelDic&&this._labelDic[$t]){var $H=this._labelDic[$t];if($H){var $I=this._tweenDataList.indexOf($H);-1<$I&&this._tweenDataList.splice($I,1)}delete this._labelDic[$t]}},$H.gotoTime=function($t){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $H,$I,$T,$K;for(var $_ in this._firstTweenDic)if($I=this._firstTweenDic[$_])for(var $V in $I)$I.diyTarget.hasOwnProperty($V)&&($I.diyTarget[$V]=$I[$V]);for($_ in this._tweenDic)($H=this._tweenDic[$_]).clear(),delete this._tweenDic[$_];if(this._index=0,this._gidIndex=0,this._currTime=$t,this._lastTime=$h.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$T=this._tweenDataList.concat(),$T.sort(function($t,$H){return $t.endTime>$H.endTime?1:$t.endTime<$H.endTime?-1:0})}else $T=this._endTweenDataList;for(var $e=0,$R=$T.length;$e<$R;$e++)if(0==($K=$T[$e]).type){if(!($t>=$K.endTime))break;this._index=Math.max(this._index,$e+1);var $A=$K.data;if($K.isTo)for(var $q in $A)$K.target[$q]=$A[$q]}for($e=0,$R=this._tweenDataList.length;$e<$R;$e++)0==($K=this._tweenDataList[$e]).type&&$t>=$K.startTime&&$t<$K.endTime&&(this._index=Math.max(this._index,$e+1),this._gidIndex++,($H=$o.getItemByClass("tween",$c))._create($K.target,$K.data,$K.duration,$K.ease,$S.create(this,this._animComplete,[this._gidIndex]),0,!1,$K.isTo,!0,!1),$H.setStartTime(this._currTime-($t-$K.startTime)),$H._updateEase(this._currTime),$H.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$H)}},$H.gotoLabel=function($t){if(null!=this._labelDic){var $H=this._labelDic[$t];$H&&this.gotoTime($H.startTime)}},$H.pause=function(){$W.timer.clear(this,this._update)},$H.resume=function(){this.play(this._currTime,this._loopKey)},$H.play=function($t,$H){if(void 0===$t&&($t=0),void 0===$H&&($H=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($t,$H){return $t.startTime>$H.startTime?1:$t.startTime<$H.startTime?-1:0});for(var $I=0,$T=this._tweenDataList.length;$I<$T;$I++){var $K=this._tweenDataList[$I];if(null!=$K&&0==$K.type){var $_=$K.target,$V=$_.$_GID||($_.$_GID=$i.getGID()),$e=null;for(var $R in null==this._firstTweenDic[$V]?(($e={}).diyTarget=$_,this._firstTweenDic[$V]=$e):$e=this._firstTweenDic[$V],$K.data)null==$e[$R]&&($e[$R]=$_[$R])}}}"string"==typeof $t?this.gotoLabel($t):this.gotoTime($t),this._loopKey=$H,this._lastTime=$h.now(),$W.timer.frameLoop(1,this,this._update)}},$H._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $t in this._tweenDic)($H=this._tweenDic[$t]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $H,$I=$h.now(),$T=$I-this._lastTime,$K=this._currTime+=$T*this.scale;for($t in this._lastTime=$I,this._tweenDic)($H=this._tweenDic[$t])._updateEase($K);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $_=this._tweenDataList[this._index];$K>=$_.startTime&&(this._index++,0==$_.type?(this._gidIndex++,($H=$o.getItemByClass("tween",$c))._create($_.target,$_.data,$_.duration,$_.ease,$S.create(this,this._animComplete,[this._gidIndex]),0,!1,$_.isTo,!0,!1),$H.setStartTime($K),$H.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$H)._updateEase($K)):this.event("label",$_.data))}},$H._animComplete=function($t){this._tweenDic[$t]&&delete this._tweenDic[$t]},$H._complete=function(){this.event("complete")},$H.reset=function(){var $t;if(this._labelDic)for($t in this._labelDic)delete this._labelDic[$t];for($t in this._tweenDic)this._tweenDic[$t].clear(),delete this._tweenDic[$t];for($t in this._firstTweenDic)delete this._firstTweenDic[$t];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $H,$I=0;for($H=this._tweenDataList.length,$I=0;$I<$H;$I++)this._tweenDataList[$I]&&this._tweenDataList[$I].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$W.timer.clear(this,this._update)},$H.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$q(0,$H,"index",function(){return this._frameIndex},function($t){this._frameIndex=$t,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$q(0,$H,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$_.to=function($t,$H,$I,$T,$K){return void 0===$K&&($K=0),(new $_).to($t,$H,$I,$T,$K)},$_.from=function($t,$H,$I,$T,$K){return void 0===$K&&($K=0),(new $_).from($t,$H,$I,$T,$K)},$_.__init$=function(){$e=function(){function $t(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $M($t,""),$t.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$o.recover("tweenData",this)},$t}()},$_}(),$ft=function($K){function $I(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$I.__super.call(this),this._style=$e.EMPTY}$M($I,"laya.display.Sprite",$K);var $t=$I.prototype;return $W.imps($t,{"laya.display.ILayout":!0}),$t.createConchModel=function(){return new ConchNode},$t.destroy=function($t){if(void 0===$t&&($t=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $H=this.mask;$H&&(this.mask=null,$H.destroy($t))}$K.prototype.destroy.call(this,$t),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$t.updateZOrder=function(){$i.updateOrder(this._childs)&&this.repaint()},$t.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$t.setBounds=function($t){this._set$P("uBounds",$t)},$t.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $z),$z._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$t.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $z),$z._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$t._boundPointsToParent=function($t){void 0===$t&&($t=!1);var $H=0,$I=0;this._style&&($H=this._style._tf.translateX,$I=this._style._tf.translateY,$t=$t||0!==this._style._tf.rotate,this._style.scrollRect&&($H+=this._style.scrollRect.x,$I+=this._style.scrollRect.y));var $T=this._getBoundPointsM($t);if(!$T||$T.length<1)return $T;if(8!=$T.length&&($T=$t?$N.scanPList($T):$z._getWrapRec($T,$z.TEMP)._getBoundPoints()),!this.transform)return $i.transPointList($T,this._x-$H,this._y-$I),$T;var $K=$s.TEMP,$_=0,$V=$T.length;for($_=0;$_<$V;$_+=2)$K.x=$T[$_],$K.y=$T[$_+1],this.toParentPoint($K),$T[$_]=$K.x,$T[$_+1]=$K.y;return $T},$t.getGraphicBounds=function($t){return void 0===$t&&($t=!1),this._graphics?this._graphics.getBounds($t):$z.TEMP.setTo(0,0,0,0)},$t._getBoundPointsM=function($t){if(void 0===$t&&($t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $H=$i.clearArray(this._$P.temBM),$I=$z.TEMP;return $I.copyFrom(this.scrollRect),$i.concatArray($H,$I._getBoundPoints()),$H}for(var $T,$K,$_,$V=this._graphics?this._graphics.getBoundPoints():$i.clearArray(this._$P.temBM),$e=0,$R=($_=this._childs).length;$e<$R;$e++)($T=$_[$e])instanceof laya.display.Sprite&&1==$T.visible&&($K=$T._boundPointsToParent($t))&&($V=$V?$i.concatArray($V,$K):$K);return $V},$t.getStyle=function(){return this._style===$e.EMPTY&&(this._style=new $e),this._style},$t.setStyle=function($t){this._style=$t},$t._adjustTransform=function(){this._tfChanged=!1;var $t,$H=this._style._tf,$I=$H.scaleX,$T=$H.scaleY;if($H.rotate||1!==$I||1!==$T||$H.skewX||$H.skewY){($t=this._transform||(this._transform=$Y.create())).bTransform=!0;var $K=.0174532922222222*($H.rotate-$H.skewX),$_=.0174532922222222*($H.rotate+$H.skewY),$V=Math.cos($_),$e=Math.sin($_),$R=Math.sin($K),$A=Math.cos($K);return $t.a=$I*$V,$t.b=$I*$e,$t.c=-$T*$R,$t.d=$T*$A,$t.tx=$t.ty=0,$t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$t},$t.pos=function($t,$H,$I){if(void 0===$I&&($I=!1),this._x!==$t||this._y!==$H){if(this.destroyed)return this;if($I){this._x=$t,this._y=$H,this.conchModel&&this.conchModel.pos(this._x,this._y);var $T=this._parent;$T&&0===$T._repaint&&($T._repaint=1,$T.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$t,this.y=$H}return this},$t.pivot=function($t,$H){return this.pivotX=$t,this.pivotY=$H,this},$t.size=function($t,$H){return this.width=$t,this.height=$H,this},$t.scale=function($t,$H,$I){void 0===$I&&($I=!1);var $T=this.getStyle(),$K=$T._tf;if($K.scaleX!=$t||$K.scaleY!=$H){if(this.destroyed)return this;if($I){$T.setScale($t,$H),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($t,$H),this._renderType|=4;var $_=this._parent;$_&&0===$_._repaint&&($_._repaint=1,$_.parentRepaint())}else this.scaleX=$t,this.scaleY=$H}return this},$t.skew=function($t,$H){return this.skewX=$t,this.skewY=$H,this},$t.render=function($t,$H,$I){$n.spriteCount++,$v.renders[this._renderType]._fun(this,$t,$H+this._x,$I+this._y),this._repaint=0},$t.drawToCanvas=function($t,$H,$I,$T){if($g.isConchNode){var $K=$Ut.create("2D");return new $l($t,$H,$K).ctx.setCanvasType(1),this.conchModel.drawToCanvas($K.source,$I,$T),$K}return $x.drawToCanvas(this,this._renderType,$t,$H,$I,$T)},$t.customRender=function($t,$H,$I){this._renderType|=1024},$t._applyFilters=function(){var $t;if(!$g.isWebGL&&(($t=this._$P.filters)&&!($t.length<1)))for(var $H=0,$I=$t.length;$H<$I;$H++)$t[$H].action.apply(this._$P.cacheCanvas)},$t._isHaveGlowFilter=function(){var $t,$H=0;if(this.filters)for($H=0;$H<this.filters.length;$H++)if(8==this.filters[$H].type)return!0;for($H=0,$t=this._childs.length;$H<$t;$H++)if(this._childs[$H]._isHaveGlowFilter())return!0;return!1},$t.localToGlobal=function($t,$H){void 0===$H&&($H=!1),!0===$H&&($t=new $s($t.x,$t.y));for(var $I=this;$I&&$I!=$W.stage;)$t=$I.toParentPoint($t),$I=$I.parent;return $t},$t.globalToLocal=function($t,$H){void 0===$H&&($H=!1),$H&&($t=new $s($t.x,$t.y));for(var $I=this,$T=[];$I&&$I!=$W.stage;)$T.push($I),$I=$I.parent;for(var $K=$T.length-1;0<=$K;)$t=($I=$T[$K]).fromParentPoint($t),$K--;return $t},$t.toParentPoint=function($t){if(!$t)return $t;$t.x-=this.pivotX,$t.y-=this.pivotY,this.transform&&this._transform.transformPoint($t),$t.x+=this._x,$t.y+=this._y;var $H=this._style.scrollRect;return $H&&($t.x-=$H.x,$t.y-=$H.y),$t},$t.fromParentPoint=function($t){if(!$t)return $t;$t.x-=this._x,$t.y-=this._y;var $H=this._style.scrollRect;return $H&&($t.x+=$H.x,$t.y+=$H.y),this.transform&&this._transform.invertTransformPoint($t),$t.x+=this.pivotX,$t.y+=this.pivotY,$t},$t.on=function($t,$H,$I,$T){return 1!==this._mouseEnableState&&this.isMouseEvent($t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($t,$H,$I,$T,!1)):$K.prototype.on.call(this,$t,$H,$I,$T)},$t.once=function($t,$H,$I,$T){return 1!==this._mouseEnableState&&this.isMouseEvent($t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($t,$H,$I,$T,!0)):$K.prototype.once.call(this,$t,$H,$I,$T)},$t._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $t=this;for($t=$t.parent;$t&&1!==$t._mouseEnableState&&!$t._getBit(2);)$t.mouseEnabled=!0,$t._setBit(2,!0),$t=$t.parent}},$t.loadImage=function($t,$H,$I,$T,$K,$_){var $V=this;return void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0),void 0===$K&&($K=0),this.graphics.loadImage($t,$H,$I,$T,$K,function($t){$V.destroyed||($V.size($H+($T||$t.width),$I+($K||$t.height)),$V.repaint(),$_&&$_.runWith($t))}),this},$t.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$t._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$t._childChanged=function($t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$t&&this._get$P("hasZorder")&&$W.timer.callLater(this,this.updateZOrder),this.repaint()},$t.parentRepaint=function(){var $t=this._parent;$t&&0===$t._repaint&&($t._repaint=1,$t.parentRepaint())},$t.startDrag=function($t,$H,$I,$T,$K,$_,$V){void 0===$H&&($H=!1),void 0===$I&&($I=0),void 0===$T&&($T=300),void 0===$_&&($_=!1),void 0===$V&&($V=.92),this._$P.dragging||this._set$P("dragging",new $$),this._$P.dragging.start(this,$t,$H,$I,$T,$K,$_,$V)},$t.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$t._releaseMem=function(){if(this._$P){var $t=this._$P.cacheCanvas;$t&&$t.ctx&&($o.recover("RenderContext",$t.ctx),$t.ctx.canvas.size(0,0),$t.ctx=null);var $H=this._$P._filterCache;$H&&($H.destroy(),$H.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$t._setDisplay=function($t){$t||this._releaseMem(),$K.prototype._setDisplay.call(this,$t)},$t.hitTestPoint=function($t,$H){var $I=this.globalToLocal($s.TEMP.setTo($t,$H));return $t=$I.x,$H=$I.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$z.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($t,$H)},$t.getMousePoint=function(){return this.globalToLocal($s.TEMP.setTo($W.stage.mouseX,$W.stage.mouseY))},$t._getWords=function(){return null},$t._addChildsToLayout=function($t){var $H=this._getWords();if(null==$H&&0==this._childs.length)return!1;if($H)for(var $I=0,$T=$H.length;$I<$T;$I++)$t.push($H[$I]);$I=0;for(var $K=this._childs.length;$I<$K;++$I){var $_=this._childs[$I];$_._style._enableLayout()&&$_._addToLayout($t)}return!0},$t._addToLayout=function($t){this._style.absolute||(this._style.block?$t.push(this):this._addChildsToLayout($t)&&(this.x=this.y=0))},$t._isChar=function(){return!1},$t._getCSSStyle=function(){return this._style.getCSSStyle()},$t._setAttributes=function($t,$H){switch($t){case"x":this.x=parseFloat($H);break;case"y":this.y=parseFloat($H);break;case"width":this.width=parseFloat($H);break;case"height":this.height=parseFloat($H);break;default:this[$t]=$H}},$t._layoutLater=function(){this.parent&&this.parent._layoutLater()},$q(0,$t,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($t){this._optimizeScrollRect!=$t&&(this._optimizeScrollRect=$t,this.conchModel&&this.conchModel.optimizeScrollRect($t))}),$q(0,$t,"customRenderEnable",null,function($t){if($t&&(this._renderType|=1024,$g.isConchNode)){$I.CustomList.push(this);var $H=new $Ut("2d");$H._setContext(new CanvasRenderingContext2D),this.customContext=new $l(0,0,$H),$H.context.setCanvasType&&$H.context.setCanvasType(2),this.conchModel.custom($H.context)}}),$q(0,$t,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($t){this.cacheAs=$t?this._$P.hasFilter?"none":"normal":"none"}),$q(0,$t,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($t){var $H=this._$P.cacheCanvas;if($t!==($H?$H.type:"none")){if("none"!==$t)this._getBit(1)||this._setUpNoticeType(1),$H||($H=this._set$P("cacheCanvas",$o.getItemByClass("cacheCanvas",Object))),$H.type=$t,$H.reCache=!0,this._renderType|=16,"bitmap"==$t&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($H){var $I=$H;$I&&$I.ctx&&($o.recover("RenderContext",$I.ctx),$I.ctx.canvas.size(0,0),$I.ctx=null),$o.recover("cacheCanvas",$H)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$q(0,$t,"zOrder",function(){return this._zOrder},function($t){this._zOrder!=$t&&(this._zOrder=$t,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($t),this._parent&&($t&&this._parent._set$P("hasZorder",!0),$W.timer.callLater(this._parent,this.updateZOrder)))}),$q(0,$t,"rotation",function(){return this._style._tf.rotate},function($t){var $H=this.getStyle();if($H._tf.rotate!==$t){$H.setRotate($t),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($t),this._renderType|=4;var $I=this._parent;$I&&0===$I._repaint&&($I._repaint=1,$I.parentRepaint())}}),$q(0,$t,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($t){this._width!==$t&&(this._width=$t,this.conchModel&&this.conchModel.size($t,this._height),this.repaint())}),$q(0,$t,"x",function(){return this._x},function($t){if(this._x!==$t){if(this.destroyed)return;this._x=$t,this.conchModel&&this.conchModel.pos($t,this._y);var $H=this._parent;$H&&0===$H._repaint&&($H._repaint=1,$H.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$q(0,$t,"globalScaleY",function(){for(var $t=1,$H=this;$H&&$H!==$W.stage;)$t*=$H.scaleY,$H=$H.parent;return $t}),$q(0,$t,"hitArea",function(){return this._$P.hitArea},function($t){this._set$P("hitArea",$t)}),$q(0,$t,"staticCache",function(){return this._$P.staticCache},function($t){this._set$P("staticCache",$t),$t||this.reCache()}),$q(0,$t,"texture",function(){return this._texture},function($t){this._texture!=$t&&(this._texture=$t,this.graphics.cleanByTexture($t,0,0))}),$q(0,$t,"y",function(){return this._y},function($t){if(this._y!==$t){if(this.destroyed)return;this._y=$t,this.conchModel&&this.conchModel.pos(this._x,$t);var $H=this._parent;$H&&0===$H._repaint&&($H._repaint=1,$H.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$q(0,$t,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($t){this._height!==$t&&(this._height=$t,this.conchModel&&this.conchModel.size(this._width,$t),this.repaint())}),$q(0,$t,"blendMode",function(){return this._style.blendMode},function($t){this.getStyle().blendMode=$t,this.conchModel&&this.conchModel.blendMode($t),$t&&"source-over"!=$t?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$q(0,$t,"scaleX",function(){return this._style._tf.scaleX},function($t){var $H=this.getStyle();if($H._tf.scaleX!==$t){$H.setScaleX($t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($t,$H._tf.scaleY),this._renderType|=4;var $I=this._parent;$I&&0===$I._repaint&&($I._repaint=1,$I.parentRepaint())}}),$q(0,$t,"scaleY",function(){return this._style._tf.scaleY},function($t){var $H=this.getStyle();if($H._tf.scaleY!==$t){$H.setScaleY($t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($H._tf.scaleX,$t),this._renderType|=4;var $I=this._parent;$I&&0===$I._repaint&&($I._repaint=1,$I.parentRepaint())}}),$q(0,$t,"stage",function(){return $W.stage}),$q(0,$t,"skewX",function(){return this._style._tf.skewX},function($t){var $H=this.getStyle();if($H._tf.skewX!==$t){$H.setSkewX($t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($t,$H._tf.skewY),this._renderType|=4;var $I=this._parent;$I&&0===$I._repaint&&($I._repaint=1,$I.parentRepaint())}}),$q(0,$t,"scrollRect",function(){return this._style.scrollRect},function($t){this.getStyle().scrollRect=$t,this.repaint(),$t?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($t.x,$t.y,$t.width,$t.height)):(this._renderType&=-129,this.conchModel&&($I.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$q(0,$t,"skewY",function(){return this._style._tf.skewY},function($t){var $H=this.getStyle();if($H._tf.skewY!==$t){$H.setSkewY($t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($H._tf.skewX,$t),this._renderType|=4;var $I=this._parent;$I&&0===$I._repaint&&($I._repaint=1,$I.parentRepaint())}}),$q(0,$t,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($t){this._tfChanged=!1,(this._transform=$t)&&(this._x=$t.tx,this._y=$t.ty,$t.tx=$t.ty=0,this.conchModel&&this.conchModel.transform($t.a,$t.b,$t.c,$t.d,this._x,this._y)),$t?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$q(0,$t,"pivotX",function(){return this._style._tf.translateX},function($t){this.getStyle().setTranslateX($t),this.conchModel&&this.conchModel.pivot($t,this._style._tf.translateY),this.repaint()}),$q(0,$t,"pivotY",function(){return this._style._tf.translateY},function($t){this.getStyle().setTranslateY($t),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$t),this.repaint()}),$q(0,$t,"alpha",function(){return this._style.alpha},function($t){this._style&&this._style.alpha!==$t&&($t=$t<0?0:1<$t?1:$t,this.getStyle().alpha=$t,this.conchModel&&this.conchModel.alpha($t),1!==$t?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$q(0,$t,"visible",function(){return this._style.visible},function($t){this._style&&this._style.visible!==$t&&(this.getStyle().visible=$t,this.conchModel&&this.conchModel.visible($t),this.parentRepaint())}),$q(0,$t,"graphics",function(){return this._graphics||(this.graphics=$x.createGraphics())},function($t){this._graphics&&(this._graphics._sp=null),(this._graphics=$t)?(this._renderType&=-2,this._renderType|=512,($t._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($I.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$q(0,$t,"filters",function(){return this._$P.filters},function($t){$t&&0===$t.length&&($t=null),this._$P.filters!=$t&&(this._set$P("filters",$t?$t.slice():null),$g.isConchApp&&(this.conchModel&&($I.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$g.isWebGL&&($t&&$t.length?this._renderType|=32:this._renderType&=-33),$t&&0<$t.length?(this._getBit(1)||this._setUpNoticeType(1),$g.isWebGL&&1==$t.length&&$t[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($g.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$q(0,$t,"parent",$K.prototype._$get_parent,function($t){$W.superSet($tt,this,"parent",$t),$t&&this._getBit(2)&&this._$2__onDisplay()}),$q(0,$t,"mask",function(){return this._$P._mask},function($t){$t&&this.mask&&this.mask._$P.maskParent||($t?(this.cacheAs="bitmap",this._set$P("_mask",$t),$t._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$t),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($t?$t.conchModel:null),this._renderType|=64,this.parentRepaint())}),$q(0,$t,"mouseEnabled",function(){return 1<this._mouseEnableState},function($t){this._mouseEnableState=$t?2:1}),$q(0,$t,"globalScaleX",function(){for(var $t=1,$H=this;$H&&$H!==$W.stage;)$t*=$H.scaleX,$H=$H.parent;return $t}),$q(0,$t,"mouseX",function(){return this.getMousePoint().x}),$q(0,$t,"mouseY",function(){return this.getMousePoint().y}),$I.fromImage=function($t){return(new $I).loadImage($t)},$I._cachePool=[],$I.CustomList=[],$R($I,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$V.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$I}($tt),$bt=function($t){function $H($t){this._audio=null,this._onEnd=null,this._resumePlay=null,$H.__super.call(this),this._onEnd=$i.bind(this.__onEnd,this),this._resumePlay=$i.bind(this.__resumePlay,this),$t.addEventListener("ended",this._onEnd),this._audio=$t}$M($H,"laya.media.h5audio.AudioSoundChannel",$Tt);var $I=$H.prototype;return $I.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($W.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$I.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$h.container.appendChild(this._audio),this._audio.play()}catch($t){this.event("error")}},$I.play=function($t){this.isStopped=!1;try{this._audio.playbackRate=$r.playbackRate,this._audio.currentTime=this.startTime}catch($t){return void this._audio.addEventListener("canplay",this._resumePlay)}$r.addChannel(this),$h.container.appendChild(this._audio),!$t&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$I.stop=function(){this.isStopped=!0,$r.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$g.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$h.onIE||this._audio!=$It._musicAudio&&$o.recover("audio:"+this.url,this._audio),$h.removeElement(this._audio),this._audio=null)},$I.pause=function(){this.isStopped=!0,$r.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$I.resume=function(){this._audio&&(this.isStopped=!1,$r.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$q(0,$I,"position",function(){return this._audio?this._audio.currentTime:0}),$q(0,$I,"duration",function(){return this._audio?this._audio.duration:0}),$q(0,$I,"volume",function(){return this._audio?this._audio.volume:1},function($t){this._audio&&(this._audio.volume=$t)}),$H}(),$Lt=function($t){function $H(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$_t.ctx,$H.__super.call(this),this._onPlayEnd=$i.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$M($H,"laya.media.webaudio.WebAudioSoundChannel",$Tt);var $I=$H.prototype;return $I.play=function($t){if($r.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $H=this.context,$I=this.gain,$T=$H.createBufferSource();(this.bufferSource=$T).buffer=this.audioBuffer,$T.connect($I),$I&&$I.disconnect(),$I.connect($H.destination),$T.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$h.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($T.loop=!0),$T.playbackRate.setTargetAtTime?$T.playbackRate.setTargetAtTime($r.playbackRate,this.context.currentTime,.1):$T.playbackRate.value=$r.playbackRate,$T.start(0,this.startTime),!$t&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$I.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($W.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$I._clearBufferSource=function(){if(this.bufferSource){var $t=this.bufferSource;$t.stop?$t.stop(0):$t.noteOff(0),$t.disconnect(0),$t.onended=null,$H._tryCleanFailed||this._tryClearBuffer($t),this.bufferSource=null}},$I._tryClearBuffer=function($t){try{$t.buffer=null}catch($t){$H._tryCleanFailed=!0}},$I.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$r.removeChannel(this),this.startHandler=null,this.completeHandler=null},$I.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$r.removeChannel(this)},$I.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$q(0,$I,"position",function(){return this.bufferSource?($h.now()-this._startTime)/1e3+this.startTime:0}),$q(0,$I,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$q(0,$I,"volume",function(){return this._volume},function($t){this.isStopped||(this._volume=$t,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($t,this.context.currentTime,.1):this.gain.gain.value=$t)}),$H._tryCleanFailed=!1,$H}(),$Gt=function($t){function $H(){$H.__super.call(this),this._w=0,this._h=0}$M($H,"laya.resource.Bitmap",$At);var $I=$H.prototype;return $q(0,$I,"width",function(){return this._w}),$q(0,$I,"height",function(){return this._h}),$q(0,$I,"source",function(){return this._source}),$H}(),$Mt=function($H){function $t(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$t.__super.call(this),this._interval=$T.animationInterval,this._setUpNoticeType(1)}$M($t,"laya.display.AnimationPlayerBase",$H);var $I=$t.prototype;return $I.play=function($t,$H,$I,$T){void 0===$t&&($t=0),void 0===$H&&($H=!0),void 0===$I&&($I=""),void 0===$T&&($T=!0),this._isPlaying=!0,this.index="string"==typeof $t?this._getFrameByLabel($t):$t,this.loop=$H,this._actionName=$I,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$I._getFrameByLabel=function($t){var $H=0;for($H=0;$H<this._count;$H++)if(this._labels[$H]&&0<=this._labels[$H].indexOf($t))return $H;return 0},$I._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$I._setControlNode=function($t){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$t)&&$t!=this&&($t.on("display",this,this._checkResumePlaying),$t.on("undisplay",this,this._checkResumePlaying))},$I._setDisplay=function($t){$H.prototype._setDisplay.call(this,$t),this._checkResumePlaying()},$I._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$I.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$I.addLabel=function($t,$H){this._labels||(this._labels={}),this._labels[$H]||(this._labels[$H]=[]),this._labels[$H].push($t)},$I.removeLabel=function($t){if($t){if(this._labels)for(var $H in this._labels)this._removeLabelFromLabelList(this._labels[$H],$t)}else this._labels=null},$I._removeLabelFromLabelList=function($t,$H){if($t)for(var $I=$t.length-1;0<=$I;$I--)$t[$I]==$H&&$t.splice($I,1)},$I.gotoAndStop=function($t){this.index="string"==typeof $t?this._getFrameByLabel($t):$t,this.stop()},$I._displayToIndex=function($t){},$I.clear=function(){this.stop(),this._labels=null},$q(0,$I,"interval",function(){return this._interval},function($t){this._interval!=$t&&(this._frameRateChanged=!0,this._interval=$t,this._isPlaying&&0<$t&&this.timerLoop($t,this,this._frameLoop,null,!0,!0))}),$q(0,$I,"isPlaying",function(){return this._isPlaying}),$q(0,$I,"index",function(){return this._index},function($t){if(this._index=$t,this._displayToIndex($t),this._labels&&this._labels[$t])for(var $H=this._labels[$t],$I=0,$T=$H.length;$I<$T;$I++)this.event("label",$H[$I])}),$q(0,$I,"count",function(){return this._count}),$t.WRAP_POSITIVE=0,$t.WRAP_REVERSE=1,$t.WRAP_PINGPONG=2,$t}($ft),$Ot=function($H){function $L(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$L.__super.call(this),this.overflow=$L.VISIBLE,this._style=new $Ht(this),this._style.wordWrap=!1}$M($L,"laya.display.Text",$H);var $t=$L.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$t._getBoundPointsM=function($t){void 0===$t&&($t=!1);var $H=$z.TEMP;return $H.setTo(0,0,this.width,this.height),$H._getBoundPoints()},$t.getGraphicBounds=function($t){void 0===$t&&($t=!1);var $H=$z.TEMP;return $H.setTo(0,0,this.width,this.height),$H},$t._getCSSStyle=function(){return this._style},$t.lang=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q){if($t=$L.langPacks&&$L.langPacks[$t]?$L.langPacks[$t]:$t,arguments.length<2)this._text=$t;else{for(var $f=0,$b=arguments.length;$f<$b;$f++)$t=$t.replace("{"+$f+"}",arguments[$f+1]);this._text=$t}},$t._isPassWordMode=function(){var $t=this._style.password;return"prompt"in this&&this.prompt==this._text&&($t=!1),$t},$t._getPassWordTxt=function($t){var $H;$H="";for(var $I=$t.length;0<$I;$I--)$H+="●";return $H},$t.renderText=function($t,$H){var $I=this.graphics;$I.clear(!0);var $T=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($h.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$h.context.font=$T;var $K=this.padding,$_=$K[3],$V="left",$e=this._lines,$R=this.leading+this._charSize.height,$A=this._currBitmapFont;$A&&($R=this.leading+$A.getMaxHeight());var $q=$K[0];if(!$A&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($V="right",$_=this._width-$K[1]):"center"==this.align&&($V="center",$_=.5*this._width+$K[3]-$K[1])),0<this._height){var $f=this._textHeight>this._height?"top":this.valign;"middle"===$f?$q=.5*(this._height-$H*$R)+$K[0]-$K[2]:"bottom"===$f&&($q=this._height-$H*$R-$K[2])}var $b=this._style;if($A&&$A.autoScaleSize)var $L=$A.fontSize/this.fontSize;if(this._clipPoint)if($I.save(),$A&&$A.autoScaleSize){var $G=0,$M=0;$G=this._width?this._width-$K[3]-$K[1]:this._textWidth,$M=this._height?this._height-$K[0]-$K[2]:this._textHeight,$G*=$L,$M*=$L,$I.clipRect($K[3],$K[0],$G,$M)}else $I.clipRect($K[3],$K[0],this._width?this._width-$K[3]-$K[1]:this._textWidth,this._height?this._height-$K[0]-$K[2]:this._textHeight);var $O=$b.password;"prompt"in this&&this.prompt==this._text&&($O=!1);for(var $J=0,$S=0,$U=Math.min(this._lines.length,$H+$t)||1,$C=$t;$C<$U;$C++){var $N,$w=$e[$C];if($O){var $W=$w.length;$w="";for(var $s=$W;0<$s;$s--)$w+="●"}if($J=$_-(this._clipPoint?this._clipPoint.x:0),$S=$q+$R*$C-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($V,$J,$S,$C),$A){var $z=this.width;$A.autoScaleSize&&($z=this.width*$L),$A.drawText($w,this,$J,$S,this.align,$z)}else $g.isWebGL?(this._words||(this._words=[]),($N=this._words.length>$C-$t?this._words[$C-$t]:new $Z).setText($w)):$N=$w,$b.stroke?$I.fillBorderText($N,$J,$S,$T,this.color,$b.strokeColor,$b.stroke,$V):$I.fillText($N,$J,$S,$T,this.color,$V)}if($A&&$A.autoScaleSize){var $P=1/$L;this.scale($P,$P)}this._clipPoint&&$I.restore(),this._startX=$_,this._startY=$q},$t.drawUnderline=function($t,$H,$I,$T){var $K=this._lineWidths[$T];switch($t){case"center":$H-=$K/2;break;case"right":$H-=$K}$I+=this._charSize.height,this._graphics.drawLine($H,$I,$H+$K,$I,this.underlineColor||this.color,1)},$t.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$h.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $s(0,0)):this._clipPoint=null;var $t=this._lines.length;if(this.overflow!=$L.VISIBLE){var $H=this.overflow==$L.HIDDEN?Math.floor:Math.ceil;$t=Math.min($t,$H((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $I=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($I,$t),this.repaint()},$t.evalTextSize=function(){var $t,$H=NaN;$t=Math.max.apply(this,this._lineWidths),$H=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$t==this._textWidth&&$H==this._textHeight||(this._textWidth=$t,this._textHeight=$H,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$t.checkEnabledViewportOrNot=function(){return this.overflow==$L.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$t.changeText=function($t){this._text!==$t&&(this.lang($t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$t.parseLines=function($t){var $H=this.wordWrap||this.overflow==$L.HIDDEN;if($H)var $I=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $T=$i.contextMeasureText($L._testWord);$g.isConchApp&&0===$T.width&&0===$T.height&&($T=$i.contextMeasureText("W")),this._charSize.width=$T.width,this._charSize.height=$T.height||this.fontSize}for(var $K=$t.replace(/\r\n/g,"\n").split("\n"),$_=0,$V=$K.length;$_<$V;$_++){var $e=$K[$_];$H?this.parseLine($e,$I):(this._lineWidths.push(this.getTextWidth($e)),this._lines.push($e))}},$t.parseLine=function($t,$H){$h.context;var $I,$T=this._lines,$K=0,$_=NaN,$V=NaN,$e=0;if(($_=this.getTextWidth($t))<=$H)return $T.push($t),void this._lineWidths.push($_);$_=this._charSize.width,0==($K=Math.floor($H/$_))&&($K=1),$V=$_=this.getTextWidth($t.substring(0,$K));for(var $R=$K,$A=$t.length;$R<$A;$R++)if($H<($V+=$_=this.getTextWidth($t.charAt($R))))if(this.wordWrap){var $q=$t.substring($e,$R);if($q.charCodeAt($q.length-1)<255?($I=/(?:\w|-)+$/.exec($q))&&($R=$I.index+$e,0==$I.index?$R+=$q.length:$q=$t.substring($e,$R)):$L.RightToLeft&&($I=/([\u0600-\u06FF])+$/.exec($q))&&($R=$I.index+$e,0==$I.index?$R+=$q.length:$q=$t.substring($e,$R)),$T.push($q),this._lineWidths.push($V-$_),!(($e=$R)+$K<$A)){$T.push($t.substring($e,$A)),this._lineWidths.push(this.getTextWidth($T[$T.length-1])),$e=-1;break}$R+=$K,$V=$_=this.getTextWidth($t.substring($e,$R)),$R--}else if(this.overflow==$L.HIDDEN)return $T.push($t.substring(0,$R)),void this._lineWidths.push(this.getTextWidth($T[$T.length-1]));this.wordWrap&&-1!=$e&&($T.push($t.substring($e,$A)),this._lineWidths.push(this.getTextWidth($T[$T.length-1])))},$t.getTextWidth=function($t){return this._currBitmapFont?this._currBitmapFont.getTextWidth($t):$i.contextMeasureText($t).width},$t.getWordWrapWidth=function(){var $t=this.padding,$H=NaN;return($H=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($H=this.wordWrap?100:$h.width),$H<=0&&($H=100),$H-$t[3]-$t[1]},$t.getCharPoint=function($t,$H){this._isChanged&&$W.timer.runCallLater(this,this.typeset);for(var $I=0,$T=this._lines,$K=0,$_=0,$V=$T.length;$_<$V;$_++){if($t<($I+=$T[$_].length)){var $e=$_;break}$K=$I}var $R=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$h.context.font=$R;var $A=this.getTextWidth(this._text.substring($K,$t));return($H||new $s).setTo(this._startX+$A-(this._clipPoint?this._clipPoint.x:0),this._startY+$e*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$q(0,$t,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($t){$t!=this._width&&($W.superSet($ft,this,"width",$t),this.isChanged=!0)}),$q(0,$t,"textWidth",function(){return this._isChanged&&$W.timer.runCallLater(this,this.typeset),this._textWidth}),$q(0,$t,"height",function(){return this._height?this._height:this.textHeight},function($t){$t!=this._height&&($W.superSet($ft,this,"height",$t),this.isChanged=!0)}),$q(0,$t,"textHeight",function(){return this._isChanged&&$W.timer.runCallLater(this,this.typeset),this._textHeight}),$q(0,$t,"padding",function(){return this._getCSSStyle().padding},function($t){this._getCSSStyle().padding=$t,this.isChanged=!0}),$q(0,$t,"bold",function(){return this._getCSSStyle().bold},function($t){this._getCSSStyle().bold=$t,this.isChanged=!0}),$q(0,$t,"text",function(){return this._text||""},function($t){this._text!==$t&&(this.lang($t+""),this.isChanged=!0,this.event("change"))}),$q(0,$t,"color",function(){return this._getCSSStyle().color},function($t){this._getCSSStyle().color!=$t&&(this._getCSSStyle().color=$t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$q(0,$t,"font",function(){return this._getCSSStyle().fontFamily},function($t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$L._bitmapFonts&&$L._bitmapFonts[$t]&&(this._currBitmapFont=$L._bitmapFonts[$t]),this._getCSSStyle().fontFamily=$t,this.isChanged=!0}),$q(0,$t,"fontSize",function(){return this._getCSSStyle().fontSize},function($t){this._getCSSStyle().fontSize=$t,this.isChanged=!0}),$q(0,$t,"italic",function(){return this._getCSSStyle().italic},function($t){this._getCSSStyle().italic=$t,this.isChanged=!0}),$q(0,$t,"align",function(){return this._getCSSStyle().align},function($t){this._getCSSStyle().align=$t,this.isChanged=!0}),$q(0,$t,"valign",function(){return this._getCSSStyle().valign},function($t){this._getCSSStyle().valign=$t,this.isChanged=!0}),$q(0,$t,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($t){this._getCSSStyle().wordWrap=$t,this.isChanged=!0}),$q(0,$t,"leading",function(){return this._getCSSStyle().leading},function($t){this._getCSSStyle().leading=$t,this.isChanged=!0}),$q(0,$t,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($t){this._getCSSStyle().backgroundColor=$t,this.isChanged=!0}),$q(0,$t,"borderColor",function(){return this._getCSSStyle().borderColor},function($t){this._getCSSStyle().borderColor=$t,this.isChanged=!0}),$q(0,$t,"stroke",function(){return this._getCSSStyle().stroke},function($t){this._getCSSStyle().stroke=$t,this.isChanged=!0}),$q(0,$t,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($t){this._getCSSStyle().strokeColor=$t,this.isChanged=!0}),$q(0,$t,"isChanged",null,function($t){this._isChanged!==$t&&(this._isChanged=$t)&&$W.timer.callLater(this,this.typeset)}),$q(0,$t,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($t){if(!(this.overflow!=$L.SCROLL||this.textWidth<this._width)&&this._clipPoint){$t=$t<this.padding[3]?this.padding[3]:$t;var $H=this._textWidth-this._width;$t=$H<$t?$H:$t;var $I=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$t,this.renderText(this._lastVisibleLineIndex,$I)}}),$q(0,$t,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($t){if(!(this.overflow!=$L.SCROLL||this.textHeight<this._height)&&this._clipPoint){$t=$t<this.padding[0]?this.padding[0]:$t;var $H=this._textHeight-this._height,$I=($t=$H<$t?$H:$t)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$I;var $T=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$t,this.renderText($I,$T)}}),$q(0,$t,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$q(0,$t,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$q(0,$t,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$q(0,$t,"underlineColor",function(){return this._underlineColor},function($t){this._underlineColor=$t,this._isChanged=!0,this.typeset()}),$L.registerBitmapFont=function($t,$H){$L._bitmapFonts||($L._bitmapFonts={}),$L._bitmapFonts[$t]=$H},$L.unregisterBitmapFont=function($t,$H){if(void 0===$H&&($H=!0),$L._bitmapFonts&&$L._bitmapFonts[$t]){var $I=$L._bitmapFonts[$t];$H&&$I.destroy(),delete $L._bitmapFonts[$t]}},$L.setTextRightToLeft=function(){var $t;($t=$h.canvas.source.style).display="none",$t.position="absolute",$t.direction="rtl",$g._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$h.document.body.appendChild($h.canvas.source)},$L.supportFont=function($t){$h.context.font="10px sans-serif";var $H=$i.contextMeasureText("abcji").width;$h.context.font="10px "+$t;var $I=$i.contextMeasureText("abcji").width;return console.log($H,$I),$H!==$I},$L._testWord="游",$L.langPacks=null,$L.VISIBLE="visible",$L.SCROLL="scroll",$L.HIDDEN="hidden",$L.CharacterCache=!0,$L.RightToLeft=!1,$L._bitmapFonts=null,$R($L,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$L}($ft),$Jt=function($f){function $V(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$V.__super.call(this),this.offset=new $s,this._canvasTransform=new $Y,this._previousOrientation=$h.window.orientation;var $H=this;this.transform=$Y.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $t=$h.window,$I=this;$t.addEventListener("focus",function(){$H._isFocused=!0,$I.event("focus"),$I.event("focuschange")}),$t.addEventListener("blur",function(){$H._isFocused=!1,$I.event("blur"),$I.event("focuschange"),$I._isInputting()&&($Nt.inputElement.target.focus=!1)});var $T="visibilityState",$K="visibilitychange",$_=$t.document;void 0!==$_.hidden?($K="visibilitychange",$T="visibilityState"):void 0!==$_.mozHidden?($K="mozvisibilitychange",$T="mozVisibilityState"):void 0!==$_.msHidden?($K="msvisibilitychange",$T="msVisibilityState"):void 0!==$_.webkitHidden&&($K="webkitvisibilitychange",$T="webkitVisibilityState"),$t.document.addEventListener($K,function(){"hidden"==$h.document[$T]?$I._setStageVisible(!1):$I._setStageVisible(!0)}),$t.document.addEventListener("qbrowserVisibilityChange",function($t){$I._setStageVisible(!$t.hidden)}),$t.addEventListener("resize",function(){var $t=$h.window.orientation;null!=$t&&$t!=$H._previousOrientation&&$I._isInputting()&&($Nt.inputElement.target.focus=!1),$H._previousOrientation=$t,$I._isInputting()||$I._resetCanvas()}),$t.addEventListener("orientationchange",function($t){$I._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$h.onMobile&&this.on("mousedown",this,this._onmouseMove)}$M($V,"laya.display.Stage",$f);var $t=$V.prototype;return $t._setStageVisible=function($t){this._isVisibility!=$t&&(this._isVisibility=$t,this._isVisibility||this._isInputting()&&($Nt.inputElement.target.focus=!1),this.event("visibilitychange"))},$t._isInputting=function(){return $h.onMobile&&$Nt.isInputting},$t._changeCanvasSize=function(){this.setScreenSize($h.clientWidth*$h.pixelRatio,$h.clientHeight*$h.pixelRatio)},$t._resetCanvas=function(){if(this.screenAdaptationEnabled){var $t=$g._mainCanvas;$t.source.style;$t.size(1,1),$W.timer.once(100,this,this._changeCanvasSize)}},$t.setScreenSize=function($t,$H){var $I=!1;if("none"!==this._screenMode&&($I=($t/$H<1?"vertical":"horizontal")!==this._screenMode)){var $T=$H;$H=$t,$t=$T}this.canvasRotation=$I;var $K=$g._mainCanvas,$_=$K.source.style,$V=this._canvasTransform.identity(),$e=this._scaleMode,$R=$t/this.designWidth,$A=$H/this.designHeight,$q=this.designWidth,$f=this.designHeight,$b=$t,$L=$H,$G=$h.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$e){case"noscale":$R=$A=1,$b=this.designWidth,$L=this.designHeight;break;case"showall":$R=$A=Math.min($R,$A),$q=$b=Math.round(this.designWidth*$R),$f=$L=Math.round(this.designHeight*$A);break;case"noborder":$R=$A=Math.max($R,$A),$b=Math.round(this.designWidth*$R),$L=Math.round(this.designHeight*$A);break;case"full":$R=$A=1,this._width=$q=$t,this._height=$f=$H;break;case"fixedwidth":$A=$R,this._height=$f=Math.round($H/$R);break;case"fixedheight":$R=$A,this._width=$q=Math.round($t/$A);break;case"fixedauto":$t/$H<this.designWidth/this.designHeight?($A=$R,this._height=$f=Math.round($H/$R)):($R=$A,this._width=$q=Math.round($t/$A))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$q=$q+1&2147483646,$f=$f+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$R*=this.scaleX,$A*=this.scaleY,1===$R&&1===$A?this.transform.identity():(this.transform.a=this._formatData($R/($b/$q)),this.transform.d=this._formatData($A/($L/$f)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$K.size($q,$f),$x.changeWebGLSize($q,$f),$V.scale($b/$q/$G,$L/$f/$G),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($t-$b)/$G:this.offset.x=.5*($t-$b)/$G,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($H-$L)/$G:this.offset.y=.5*($H-$L)/$G,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$V.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$I&&("horizontal"===this._screenMode?($V.rotate(Math.PI/2),$V.translate($H/$G,0),this.canvasDegree=90):($V.rotate(-Math.PI/2),$V.translate(0,$t/$G),this.canvasDegree=-90)),$V.a=this._formatData($V.a),$V.d=this._formatData($V.d),$V.tx=this._formatData($V.tx),$V.ty=this._formatData($V.ty),$_.transformOrigin=$_.webkitTransformOrigin=$_.msTransformOrigin=$_.mozTransformOrigin=$_.oTransformOrigin="0px 0px 0px",$_.transform=$_.webkitTransform=$_.msTransform=$_.mozTransform=$_.oTransform="matrix("+$V.toString()+")",$V.translate(parseInt($_.left)||0,parseInt($_.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$t._formatData=function($t){return Math.abs($t)<1e-6?0:Math.abs(1-$t)<.001?0<$t?1:-1:$t},$t.getMousePoint=function(){return $s.TEMP.setTo(this.mouseX,this.mouseY)},$t.repaint=function(){this._repaint=1},$t.parentRepaint=function(){},$t._loop=function(){return this.render($g.context,0,0),!0},$t._onmouseMove=function($t){this._mouseMoveTime=$h.now()},$t.getTimeFromFrameStart=function(){return $h.now()-this._frameStartTime},$t.render=function($t,$H,$I){if("sleep"===this._frameRate&&!$g.isConchApp){var $T=$h.now();if(!(1e3<=$T-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($n.loopCount++,$G.instance.runEvent(),$W.timer._update()));this._frameStartTime=$T}if(this._renderCount++,$g.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$h.now();var $K="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$_=this._renderCount%2==0;if($n.renderSlow=!$K,$K||$_||$g.isConchApp){var $V;$n.loopCount++,$G.instance.runEvent(),$W.timer._update(),$x.update3DLoop();var $e=0,$R=0;if($g.isConchNode)for($e=0,$R=this._scenes.length;$e<$R;$e++)($V=this._scenes[$e])&&$V._updateSceneConch();else for($e=0,$R=this._scenes.length;$e<$R;$e++)($V=this._scenes[$e])&&$V._updateScene();if($g.isConchNode){var $A=$ft.CustomList;for($e=0,$R=$A.length;$e<$R;$e++){var $q=$A[$e];$q.customRender($q.customContext,0,0)}return}}$g.isConchNode||this.renderingEnabled&&($K||!$_||$g.isConchWebGL)&&($g.isWebGL?$g.WebGL.mainContext&&!$g.WebGL.mainContext.isContextLost()&&($t.clear(),$f.prototype.render.call(this,$t,$H,$I),$n._show&&$n._sp&&$n._sp.render($t,$H,$I),$x.clear(this._bgColor),$x.beginFlush(),$t.flush(),$x.endFinish(),$j.instance&&$j.getInstance().endDispose()):($x.clear(this._bgColor),$f.prototype.render.call(this,$t,$H,$I),$n._show&&$n._sp&&$n._sp.render($t,$H,$I)))}else this._renderCount%5==0&&($n.loopCount++,$G.instance.runEvent(),$W.timer._update())},$t._requestFullscreen=function(){var $t=$h.document.documentElement;$t.requestFullscreen?$t.requestFullscreen():$t.mozRequestFullScreen?$t.mozRequestFullScreen():$t.webkitRequestFullscreen?$t.webkitRequestFullscreen():$t.msRequestFullscreen&&$t.msRequestFullscreen()},$t._fullScreenChanged=function(){$W.stage.event("fullscreenchange")},$t.exitFullscreen=function(){var $t=$h.document;$t.exitFullscreen?$t.exitFullscreen():$t.mozCancelFullScreen?$t.mozCancelFullScreen():$t.webkitExitFullscreen&&$t.webkitExitFullscreen()},$q(0,$t,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$q(0,$t,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$q(0,$t,"frameRate",function(){return this._frameRate},function($t){if(this._frameRate=$t,$g.isConchApp)switch(this._frameRate){case"slow":$h.window.conch&&$h.window.conchConfig.setSlowFrame&&$h.window.conchConfig.setSlowFrame(!0);break;case"fast":$h.window.conch&&$h.window.conchConfig.setSlowFrame&&$h.window.conchConfig.setSlowFrame(!1);break;case"mouse":$h.window.conch&&$h.window.conchConfig.setMouseFrame&&$h.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$h.window.conch&&$h.window.conchConfig.setLimitFPS&&$h.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$q(0,$t,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$q(0,$t,"width",$f.prototype._$get_width,function($t){this.designWidth=$t,$W.superSet($ft,this,"width",$t),$W.timer.callLater(this,this._changeCanvasSize)}),$q(0,$t,"alignH",function(){return this._alignH},function($t){this._alignH=$t,$W.timer.callLater(this,this._changeCanvasSize)}),$q(0,$t,"isFocused",function(){return this._isFocused}),$q(0,$t,"height",$f.prototype._$get_height,function($t){this.designHeight=$t,$W.superSet($ft,this,"height",$t),$W.timer.callLater(this,this._changeCanvasSize)}),$q(0,$t,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$Y.create()},$f.prototype._$set_transform),$q(0,$t,"isVisibility",function(){return this._isVisibility}),$q(0,$t,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$q(0,$t,"scaleMode",function(){return this._scaleMode},function($t){this._scaleMode=$t,$W.timer.callLater(this,this._changeCanvasSize)}),$q(0,$t,"alignV",function(){return this._alignV},function($t){this._alignV=$t,$W.timer.callLater(this,this._changeCanvasSize)}),$q(0,$t,"bgColor",function(){return this._bgColor},function($t){this._bgColor=$t,this.conchModel&&this.conchModel.bgColor($t),$g.isWebGL&&($t?$V._wgColor=$u.create($t)._color:$h.onMiniGame||($V._wgColor=null)),$h.onLimixiu?$V._wgColor=$u.create($t)._color:$g.canvas.style.background=$t||"none"}),$q(0,$t,"mouseX",function(){return Math.round($G.instance.mouseX/this.clientScaleX)}),$q(0,$t,"mouseY",function(){return Math.round($G.instance.mouseY/this.clientScaleY)}),$q(0,$t,"screenMode",function(){return this._screenMode},function($t){this._screenMode=$t}),$q(0,$t,"visible",$f.prototype._$get_visible,function($t){this.visible!==$t&&($W.superSet($ft,this,"visible",$t),$g._mainCanvas.source.style.visibility=$t?"visible":"hidden")}),$q(0,$t,"fullScreenEnabled",null,function($t){var $H=$h.document,$I=$g.canvas;$t?($I.addEventListener("mousedown",this._requestFullscreen),$I.addEventListener("touchstart",this._requestFullscreen),$H.addEventListener("fullscreenchange",this._fullScreenChanged),$H.addEventListener("mozfullscreenchange",this._fullScreenChanged),$H.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$H.addEventListener("msfullscreenchange",this._fullScreenChanged)):($I.removeEventListener("mousedown",this._requestFullscreen),$I.removeEventListener("touchstart",this._requestFullscreen),$H.removeEventListener("fullscreenchange",this._fullScreenChanged),$H.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$H.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$H.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$V.SCALE_NOSCALE="noscale",$V.SCALE_EXACTFIT="exactfit",$V.SCALE_SHOWALL="showall",$V.SCALE_NOBORDER="noborder",$V.SCALE_FULL="full",$V.SCALE_FIXED_WIDTH="fixedwidth",$V.SCALE_FIXED_HEIGHT="fixedheight",$V.SCALE_FIXED_AUTO="fixedauto",$V.ALIGN_LEFT="left",$V.ALIGN_RIGHT="right",$V.ALIGN_CENTER="center",$V.ALIGN_TOP="top",$V.ALIGN_MIDDLE="middle",$V.ALIGN_BOTTOM="bottom",$V.SCREEN_NONE="none",$V.SCREEN_HORIZONTAL="horizontal",$V.SCREEN_VERTICAL="vertical",$V.FRAME_FAST="fast",$V.FRAME_SLOW="slow",$V.FRAME_MOUSE="mouse",$V.FRAME_SLEEP="sleep",$V.FRAME_MOUSE_THREDHOLD=2e3,$R($V,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$V}($ft),$St=(function($t){function $H(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$H.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$M($H,"laya.media.SoundNode",$ft);var $I=$H.prototype;$I._onParentChange=function(){this.target=this.parent},$I.play=function($t,$H){void 0===$t&&($t=1),isNaN($t)&&($t=1),this.url&&(this.stop(),this._channel=$r.playSound(this.url,$t,null,$H))},$I.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$I._setPlayAction=function($t,$H,$I,$T){void 0===$T&&($T=!0),this[$I]&&$t&&($T?$t.on($H,this,this[$I]):$t.off($H,this,this[$I]))},$I._setPlayActions=function($t,$H,$I,$T){if(void 0===$T&&($T=!0),$t&&$H){var $K,$_=$H.split(","),$V=0;for($K=$_.length,$V=0;$V<$K;$V++)this._setPlayAction($t,$_[$V],$I,$T)}},$q(0,$I,"playEvent",null,function($t){(this._playEvents=$t)&&this._tar&&this._setPlayActions(this._tar,$t,"play")}),$q(0,$I,"target",null,function($t){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$t,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$q(0,$I,"stopEvent",null,function($t){(this._stopEvents=$t)&&this._tar&&this._setPlayActions(this._tar,$t,"stop")})}(),function($t){function $H(){this._src=null,this._onload=null,this._onerror=null,$H.__super.call(this)}$M($H,"laya.resource.FileBitmap",$Gt);var $I=$H.prototype;return $q(0,$I,"src",function(){return this._src},function($t){this._src=$t}),$q(0,$I,"onload",null,function($t){}),$q(0,$I,"onerror",null,function($t){}),$H}()),$Ut=function($t){function $I($t,$H){this._is2D=!1,$I.__super.call(this);var $T=this;if(this._source=this,"2D"===$t||"AUTO"===$t&&!$g.isWebGL){this._is2D=!0,this._source=$H||$h.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $K=this;$K.getContext=function($t,$H){if($T._ctx)return $T._ctx;var $I=$T._ctx=$T._source.getContext($t,$H);return $I&&($I._canvas=$K,$g.isFlash||$h.onLimixiu||($I.size=function($t,$H){})),$I}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$M($I,"laya.resource.HTMLCanvas",$Gt);var $H=$I.prototype;return $H.clear=function(){this._ctx&&this._ctx.clear()},$H.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$H.release=function(){},$H._setContext=function($t){this._ctx=$t},$H.getContext=function($t,$H){return this._ctx?this._ctx:this._ctx=$I._createContext(this)},$H.getMemSize=function(){return 0},$H.size=function($t,$H){(this._w!=$t||this._h!=$H||this._source&&(this._source.width!=$t||this._source.height!=$H))&&(this._w=$t,this._h=$H,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($t,$H),this._source&&(this._source.height=$H,this._source.width=$t))},$H.getCanvas=function(){return this._source},$H.toBase64=function($t,$H,$I){if(this._source)if($g.isConchApp&&this._source.toBase64)this._source.toBase64($t,$H,$I);else{var $T=this._source.toDataURL($t,$H);$I.call(this,$T)}},$q(0,$H,"context",function(){return this._ctx}),$q(0,$H,"asBitmap",null,function($t){}),$I.create=function($t,$H){return new $I($t,$H)},$I.TYPE2D="2D",$I.TYPE3D="3D",$I.TYPEAUTO="AUTO",$I._createContext=null,$I}(),$Ct=(function($t){function $R($t,$H,$I,$T,$K,$_,$V,$e){throw $R.__super.call(this),new Error("不允许new！")}$M($R,"laya.resource.HTMLSubImage",$Gt),$R.create=function($t,$H,$I,$T,$K,$_,$V,$e){return void 0===$e&&($e=!1),new $R($t,$H,$I,$T,$K,$_,$V,$e)}}(),function($t){function $f(){this._frames=null,this._url=null,$f.__super.call(this),this._setControlNode(this)}$M($f,"laya.display.Animation",$t);var $H=$f.prototype;$H.destroy=function($t){void 0===$t&&($t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$t),this._frames=null,this._labels=null},$H.play=function($t,$H,$I,$T){void 0===$t&&($t=0),void 0===$H&&($H=!0),void 0===$I&&($I=""),void 0===$T&&($T=!0),$I&&this._setFramesFromCache($I,$T),this._isPlaying=!0,this.index="string"==typeof $t?this._getFrameByLabel($t):$t,this.loop=$H,this._actionName=$I,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$H._setFramesFromCache=function($t,$H){var $I;return void 0===$H&&($H=!1),this._url&&($t=this._url+"#"+$t),$t&&$f.framesMap[$t]?(($I=$f.framesMap[$t])instanceof Array?(this._frames=$f.framesMap[$t],this._count=this._frames.length):($I.nodeRoot&&($f.framesMap[$t]=this._parseGraphicAnimationByData($I),$I=$f.framesMap[$t]),this._frames=$I.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$I.interval),this._labels=this._copyLabels($I.labels)),!0):($H&&console.log("ani not found:",$t),!1)},$H._copyLabels=function($t){if(!$t)return null;var $H,$I;for($I in $H={},$t)$H[$I]=$i.copyArray([],$t[$I]);return $H},$H._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$t.prototype._frameLoop.call(this)},$H._displayToIndex=function($t){this._frames&&(this.graphics=this._frames[$t])},$H.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$H.loadImages=function($t,$H){return void 0===$H&&($H=""),this._url="",this._setFramesFromCache($H)||(this.frames=$f.framesMap[$H]?$f.framesMap[$H]:$f.createFrames($t,$H)),this},$H.loadAtlas=function($H,$I,$T){void 0===$T&&($T=""),this._url="";var $K=this;function $t($t){$H===$t&&($K.frames=$f.framesMap[$T]?$f.framesMap[$T]:$f.createFrames($H,$T),$I&&$I.run())}return $K._setFramesFromCache($T)||($et.getAtlas($H)?$t($H):$W.loader.load($H,$S.create(null,$t,[$H]),null,"atlas")),this},$H.loadAnimation=function($t,$H,$I){this._url=$t;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$H&&$H.run()):!$I||$et.getAtlas($I)?this._loadAnimationData($t,$H,$I):$W.loader.load($I,$S.create(this,this._loadAnimationData,[$t,$H,$I]),null,"atlas"),this},$H._loadAnimationData=function($e,$R,$t){var $A=this;if(!$t||$et.getAtlas($t)){var $q=this;$et.getRes($e)?$H($e):$W.loader.load($e,$S.create(null,$H,[$e]),null,"json"),$et.clearRes($e)}else console.warn("atlas load fail:"+$t);function $H($t){if($et.getRes($t)&&$e===$t){var $H;if($f.framesMap[$e+"#"])$q._setFramesFromCache($A._actionName,!0),$A.index=0,$A._checkResumePlaying();else{var $I=$q._parseGraphicAnimation($et.getRes($e));if(!$I)return;var $T,$K=$I.animationList,$_=0,$V=$K.length;for($_=0;$_<$V;$_++)$H=$K[$_],$f.framesMap[$e+"#"+$H.name]=$H,$T||($T=$H);$T&&($f.framesMap[$e+"#"]=$T,$q._setFramesFromCache($A._actionName,!0),$A.index=0),$A._checkResumePlaying()}$R&&$R.run()}}},$H._parseGraphicAnimation=function($t){return $Wt.parseAnimationData($t)},$H._parseGraphicAnimationByData=function($t){return $Wt.parseAnimationByData($t)},$q(0,$H,"frames",function(){return this._frames},function($t){(this._frames=$t)&&(this._count=$t.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$q(0,$H,"autoPlay",null,function($t){$t?this.play():this.stop()}),$q(0,$H,"source",null,function($t){-1<$t.indexOf(".ani")?this.loadAnimation($t):-1<$t.indexOf(".json")||-1<$t.indexOf("als")||-1<$t.indexOf("atlas")?this.loadAtlas($t):this.loadImages($t.split(","))}),$q(0,$H,"autoAnimation",null,function($t){this.play(0,!0,$t,!1)}),$f.createFrames=function($t,$H){var $I,$T,$K=0,$_=0;if("string"==typeof $t){var $V=$et.getAtlas($t);if($V&&$V.length)for($I=[],$K=0,$_=$V.length;$K<$_;$K++)($T=new $x.createGraphics).drawTexture($et.getRes($V[$K]),0,0),$I.push($T)}else if($t instanceof Array)for($I=[],$K=0,$_=$t.length;$K<$_;$K++)($T=new $x.createGraphics).loadImage($t[$K],0,0),$I.push($T);return $H&&($f.framesMap[$H]=$I),$I},$f.clearCache=function($t){var $H,$I=$f.framesMap,$T=$t+"#";for($H in $I)$H!==$t&&0!=$H.indexOf($T)||delete $f.framesMap[$H]},$f.framesMap={}}($Mt),function($t){function $_(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$_.__super.call(this),null==$_._sortIndexFun&&($_._sortIndexFun=$w.sortByKey("index",!1,!0))}$M($_,"laya.display.FrameAnimation",$t);var $H=$_.prototype;return $H._setUp=function($t,$H){this._labels=null,this._animationNewFrames=null,this._targetDic=$t,this._animationData=$H,this.interval=1e3/$H.frameRate,$H.parsed?(this._count=$H.count,this._labels=$H.labels,this._animationNewFrames=$H.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$H.parsed=!0,$H.labels=this._labels,$H.count=this._count,$H.animationNewFrames=this._animationNewFrames},$H.clear=function(){$t.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$H._displayToIndex=function($t){if(this._animationData){$t<0&&($t=0),$t>this._count&&($t=this._count);var $H=this._animationData.nodes,$I=0,$T=$H.length;for($I=0;$I<$T;$I++)this._displayNodeToFrame($H[$I],$t)}},$H._displayNodeToFrame=function($t,$H,$I){$I||($I=this._targetDic);var $T=$I[$t.target];if($T){var $K,$_,$V,$e=$t.frames,$R=$t.keys,$A=0,$q=$R.length;for($A=0;$A<$q;$A++)$V=($_=$e[$K=$R[$A]]).length>$H?$_[$H]:$_[$_.length-1],$T[$K]=$V}},$H._calculateDatas=function(){if(this._animationData){var $t,$H=this._animationData.nodes,$I=0,$T=$H.length;for($I=this._count=0;$I<$T;$I++)$t=$H[$I],this._calculateNodeKeyFrames($t);this._count+=1}},$H._calculateNodeKeyFrames=function($t){var $H,$I,$T=$t.keyframes,$K=$t.target;for($H in $t.frames||($t.frames={}),$t.keys?$t.keys.length=0:$t.keys=[],$t.initValues||($t.initValues={}),$T)$I=$T[$H],$t.frames[$H]||($t.frames[$H]=[]),this._targetDic&&this._targetDic[$K]&&($t.initValues[$H]=this._targetDic[$K][$H]),$I.sort($_._sortIndexFun),$t.keys.push($H),this._calculateNodePropFrames($I,$t.frames[$H],$H,$K)},$H.resetToInitState=function(){if(this._targetDic&&this._animationData){var $t,$H,$I=this._animationData.nodes,$T=0,$K=$I.length;for($T=0;$T<$K;$T++)if($H=($t=$I[$T]).initValues){var $_,$V=this._targetDic[$t.target];if($V)for($_ in $H)$V[$_]=$H[$_]}}},$H._calculateNodePropFrames=function($t,$H,$I,$T){var $K=0,$_=$t.length-1;if(0<$_){for($H.length=$t[$_].index+1,$K=0;$K<$_;$K++)this._dealKeyFrame($t[$K]),this._calculateFrameValues($t[$K],$t[$K+1],$H);this._dealKeyFrame($t[$K])}0==$_&&($H[$t[0].index]=$t[0].value,this._animationNewFrames&&(this._animationNewFrames[$t[0].index]=!0))},$H._dealKeyFrame=function($t){$t.label&&""!=$t.label&&this.addLabel($t.label,$t.index)},$H._calculateFrameValues=function($t,$H,$I){var $T,$K=0,$_=$t.index,$V=$H.index,$e=$t.value,$R=$H.value-$t.value,$A=$V-$_;if($V>this._count&&(this._count=$V),$t.tween)for(null==($T=$Q[$t.tweenMethod])&&($T=$Q.linearNone),$K=$_;$K<$V;$K++)$I[$K]=$T($K-$_,$e,$R,$A),this._animationNewFrames&&(this._animationNewFrames[$K]=!0);else for($K=$_;$K<$V;$K++)$I[$K]=$e;this._animationNewFrames&&(this._animationNewFrames[$t.index]=!0,this._animationNewFrames[$H.index]=!0),$I[$H.index]=$H.value},$_._sortIndexFun=null,$_}($Mt)),$Nt=function($H){function $K(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$K.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$Ot.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$M($K,"laya.display.Input",$H);var $t=$K.prototype;return $t.setSelection=function($t,$H){this.focus=!0,laya.display.Input.inputElement.selectionStart=$t,laya.display.Input.inputElement.selectionEnd=$H},$t._onUnDisplay=function($t){this.focus=!1},$t._onMouseDown=function($t){this.focus=!0},$t._syncInputTransform=function(){var $t=this.nativeInput,$H=$i.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$I=this._width-this.padding[1]-this.padding[3],$T=this._height-this.padding[0]-this.padding[2];$g.isConchApp?($t.setScale($H.scaleX,$H.scaleY),$t.setSize($I,$T),$t.setPos($H.x,$H.y)):($K.iframeInput&&$K._showIOSInput(),$K.inputContainer.style.transform=$K.inputContainer.style.webkitTransform="scale("+$H.scaleX+","+$H.scaleY+") rotate("+$W.stage.canvasDegree+"deg)",$t.style.width=$I+"px",$t.style.height=$T+"px",$K.inputContainer.style.left=$H.x+"px",$K.inputContainer.style.top=$H.y+"px")},$t.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$t._setInputMethod=function(){$K.input.parentElement&&$K.inputContainer.removeChild($K.input),$K.area.parentElement&&$K.inputContainer.removeChild($K.area),$K.inputElement=this.nativeInput,$K.inputContainer.appendChild($K.inputElement),$Ot.RightToLeft&&($K.inputElement.style.direction="rtl")},$t._focusIn=function(){laya.display.Input.isInputting=!0;var $t=this.nativeInput;this._focus=!0;var $H=$t.style;$H.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$t.readOnly=!this._editable,$g.isConchApp&&($t.setType(this._type),$t.setForbidEdit(!this._editable)),$t.maxLength=this._maxChars;this.padding;if($t.type=this._type,$t.value=this._content,$t.placeholder=this._prompt,$W.stage.off("keydown",this,this._onKeyDown),$W.stage.on("keydown",this,this._onKeyDown),($W.stage.focus=this).event("focus"),$h.onPC&&$t.focus(),!$h.onMiniGame){this._text;this._text=null}this.typeset(),$t.setColor(this._originColor),$t.setFontSize(this.fontSize),$t.setFontFace($h.onIPhone&&$Ot._fontFamilyMap[this.font]||this.font),$g.isConchApp&&$t.setMultiAble&&$t.setMultiAble(this._multiline),$H.lineHeight=this.leading+this.fontSize+"px",$H.fontStyle=this.italic?"italic":"normal",$H.fontWeight=this.bold?"bold":"normal",$H.textAlign=this.align,$H.padding="0 0",this._syncInputTransform(),!$g.isConchApp&&$h.onPC&&$W.timer.frameLoop(1,this,this._syncInputTransform)},$t._setPromptColor=function(){($K.promptStyleDOM=$h.getElementById("promptStyle"))||(($K.promptStyleDOM=$h.createElement("style")).setAttribute("id","promptStyle"),$h.document.head.appendChild($K.promptStyleDOM)),$K.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$t._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($W.superSet($Ot,this,"text",this._content),$W.superSet($Ot,this,"color",this._originColor)):($W.superSet($Ot,this,"text",this._prompt),$W.superSet($Ot,this,"color",this._promptColor)),$W.stage.off("keydown",this,this._onKeyDown),$W.stage.focus=null,this.event("blur"),$g.isConchApp&&this.nativeInput.blur(),$h.onPC&&$W.timer.clear(this,this._syncInputTransform)},$t._onKeyDown=function($t){13===$t.keyCode&&($h.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$t.changeText=function($t){this._content=$t,this._focus?(this.nativeInput.value=$t||"",this.event("change")):$H.prototype.changeText.call(this,$t)},$q(0,$t,"color",$H.prototype._$get_color,function($t){this._focus&&this.nativeInput.setColor($t),$W.superSet($Ot,this,"color",this._content?$t:this._promptColor),this._originColor=$t}),$q(0,$t,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$q(0,$t,"multiline",function(){return this._multiline},function($t){this._multiline=$t,this.valign=$t?"top":"middle"}),$q(0,$t,"maxChars",function(){return this._maxChars},function($t){$t<=0&&($t=1e5),this._maxChars=$t}),$q(0,$t,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($t){$W.superSet($Ot,this,"color",this._originColor),$t+="",this._focus?(this.nativeInput.value=$t||"",this.event("change")):(this._multiline||($t=$t.replace(/\r?\n/g,"")),(this._content=$t)?$W.superSet($Ot,this,"text",$t):($W.superSet($Ot,this,"text",this._prompt),$W.superSet($Ot,this,"color",this.promptColor)))}),$q(0,$t,"nativeInput",function(){return $K.iframeInput?$K.iframeInput:this._multiline?$K.area:$K.input}),$q(0,$t,"prompt",function(){return this._prompt},function($t){!this._text&&$t&&$W.superSet($Ot,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$W.superSet($Ot,this,"text",this._text==this._prompt?$t:this._text):$W.superSet($Ot,this,"text",$t),this._prompt=$Ot.langPacks&&$Ot.langPacks[$t]?$Ot.langPacks[$t]:$t}),$q(0,$t,"focus",function(){return this._focus},function($t){var $H=this.nativeInput;this._focus!==$t&&($t?($H.target?$H.target._focusOut():this._setInputMethod(),($H.target=this)._focusIn()):($H.target=null,this._focusOut(),$h.document.body.scrollTop=0,$H.blur(),$g.isConchApp?$H.setPos(-1e4,-1e4):$K.inputContainer.contains($H)&&$K.inputContainer.removeChild($H)))}),$q(0,$t,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($t){$t?(-1<($t="[^"+$t+"]").indexOf("^^")&&($t=$t.replace("^^","")),this._restrictPattern=new RegExp($t,"g")):this._restrictPattern=null}),$q(0,$t,"editable",function(){return this._editable},function($t){this._editable=$t,$g.isConchApp&&$K.input.setForbidEdit(!$t)}),$q(0,$t,"promptColor",function(){return this._promptColor},function($t){this._promptColor=$t,this._content||$W.superSet($Ot,this,"color",$t)}),$q(0,$t,"type",function(){return this._type},function($t){this._getCSSStyle().password="password"==$t,this._type=$t,$g.isConchApp&&this.nativeInput.setType($t)}),$q(0,$t,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$q(0,$t,"asPassword",function(){return this._getCSSStyle().password},function($t){this._getCSSStyle().password=$t,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$K.__init__=function(){$K._createInputElement(),$h.onMobile&&$g.canvas.addEventListener($K.IOS_IFRAME?$h.onMiniGame?"touchend":"click":"touchend",$K._popupInputMethod)},$K._popupInputMethod=function($t){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$K._createInputElement=function(){$K._initInput($K.area=$h.createElement("textarea")),$K._initInput($K.input=$h.createElement("input")),$K._createIOSInputElement(),($K.inputContainer=$h.createElement("div")).style.position="absolute",$K.inputContainer.style.zIndex=1e5,$h.container.appendChild($K.inputContainer),$K.inputContainer.setPos=function($t,$H){$K.inputContainer.style.left=$t+"px",$K.inputContainer.style.top=$H+"px"}},$K._createIOSInputElement=function(){if($K.IS_IOS){if($h.getElementById("inputIframe"))return;var $H=$h.createElement("iframe");$H.id="inputIframe",$H.onload=function(){$H.style="position: none; width: 0%; height: 0%;";var $t=$H.contentDocument.getElementsByTagName("input");$t=$t?$t[0]:null,($K.iframeInput=$t)&&$K._initInput($t)},$h.container.appendChild($H),$H.src="./input.html"}},$K._reLoadIOSInputElement=function(){var $t=$h.getElementById("inputIframe");$t&&($K.iframeInput.target&&($K.iframeInput.target.focus=!1),$K.iframeInput.onblur=null,$K.iframeInput.onload=null,$t.src="./input.html")},$K._showIOSInput=function(){$h.getElementById("inputIframe")&&($K.iframeInput.value=$K.iframeInput.target.text,$K.iframeInput.onblur=function(){$K._reLoadIOSInputElement()})},$K._initInput=function($H){var $t=$H.style;$t.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$t.resize="none",$t.backgroundColor="transparent",$t.border="none",$t.outline="none",$t.zIndex=1,$H.addEventListener("input",$K._processInputting),$H.addEventListener("mousemove",$K._stopEvent),$H.addEventListener("mousedown",$K._stopEvent),$H.addEventListener("touchmove",$K._stopEvent),$H.setFontFace=function($t){$H.style.fontFamily=$t},$g.isConchApp||($H.setColor=function($t){$H.style.color=$t},$H.setFontSize=function($t){$H.style.fontSize=$t+"px"})},$K._processInputting=function($t){var $H=laya.display.Input.inputElement.target;if($H){var $I=laya.display.Input.inputElement.value;$H._restrictPattern&&($I=$I.replace(/\u2006|\x27/g,""),$H._restrictPattern.test($I)&&($I=$I.replace($H._restrictPattern,""),laya.display.Input.inputElement.value=$I)),$H._text=$I,$H.event("input")}},$K._stopEvent=function($t){"touchmove"==$t.type&&$t.preventDefault(),$t.stopPropagation&&$t.stopPropagation()},$K.TYPE_TEXT="text",$K.TYPE_PASSWORD="password",$K.TYPE_EMAIL="email",$K.TYPE_URL="url",$K.TYPE_NUMBER="number",$K.TYPE_RANGE="range",$K.TYPE_DATE="date",$K.TYPE_MONTH="month",$K.TYPE_WEEK="week",$K.TYPE_TIME="time",$K.TYPE_DATE_TIME="datetime",$K.TYPE_DATE_TIME_LOCAL="datetime-local",$K.TYPE_SEARCH="search",$K.input=null,$K.area=null,$K.inputElement=null,$K.inputContainer=null,$K.confirmButton=null,$K.promptStyleDOM=null,$K.inputHeight=45,$K.isInputting=!1,$K.stageMatrix=null,$R($K,["IOS_IFRAME",function(){return this.IOS_IFRAME=$h.onIOS&&$h.window.top!=$h.window.self}]),$R($K,["IS_IOS",function(){return this.IS_IOS=!1}]),$K}($Ot),$wt=function($t){function $I($t,$H){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$I.__super.call(this),$t&&this._init_($t,$H)}$M($I,"laya.resource.HTMLImage",$St);var $H=$I.prototype;return $H._init_=function($t,$H){this._src=$t,this._source=new $h.window.Image,$H&&($H.onload&&(this.onload=$H.onload),$H.onerror&&(this.onerror=$H.onerror),$H.onCreate&&$H.onCreate(this)),0!=$t.indexOf("data:image")&&(this._source.crossOrigin=""),$t&&(this._source.src=$t)},$H.recreateResource=function(){var $t=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $H=this;this._source=new $h.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($H._needReleaseAgain)return $H._needReleaseAgain=!1,$H._source.onload=null,void($H._source=null);$H._source.onload=null,$H.memorySize=$t._w*$t._h*4,$H._recreateLock=!1,$H.completeCreate()},this._source.src=this._src}},$H.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$H.onresize=function(){this._w=this._source.width,this._h=this._source.height},$q(0,$H,"onload",null,function($t){var $H=this;this._onload=$t,this._source&&(this._source.onload=null!=this._onload?function(){$H.onresize(),$H._onload()}:null)}),$q(0,$H,"onerror",null,function($t){var $H=this;this._onerror=$t,this._source&&(this._source.onerror=null!=this._onerror?function(){$H._onerror()}:null)}),$q(0,$H,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($t){this._enableMerageInAtlas=$t,$g.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$t)}),$I.create=function($t,$H){return new $I($t,$H)},$I}(),$Wt=(function($_){function $t(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$t.__super.call(this)}$M($t,"laya.display.EffectAnimation",$_);var $H=$t.prototype;$H._onOtherBegin=function($t){$t!=this&&this.stop()},$H.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$H._onPlayAction=function(){this.play(0,!1)},$H.play=function($t,$H,$I,$T){void 0===$t&&($t=0),void 0===$H&&($H=!0),void 0===$I&&($I=""),void 0===$T&&($T=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$t,$H,$I,$T))},$H._recordInitData=function(){if(this._aniKeys){var $t,$H,$I=0;for($t=this._aniKeys.length,$I=0;$I<$t;$I++)$H=this._aniKeys[$I],this._initData[$H]=this._target[$H]}},$H._displayToIndex=function($t){if(this._animationData){$t<0&&($t=0),$t>this._count&&($t=this._count);var $H=this._animationData.nodes,$I=0,$T=$H.length;for($T=1<$T?1:$T,$I=0;$I<$T;$I++)this._displayNodeToFrame($H[$I],$t)}},$H._displayNodeToFrame=function($t,$H,$I){if(this._target){var $T;$T=this._target;var $K,$_,$V,$e,$R=$t.frames,$A=$t.keys,$q=0,$f=$A.length;$e=$t.secondFrames;var $b,$L,$G,$M,$O=0;for($q=0;$q<$f;$q++)$_=$R[$K=$A[$q]],$V=-1==($O=$e[$K])?this._initData[$K]:$H<$O?($G=($L=$t.keyframes[$K])[0]).tween?(null==($b=$Q[$G.tweenMethod])&&($b=$Q.linearNone),$M=$L[1],$b($H,this._initData[$K],$M.value-this._initData[$K],$M.index)):this._initData[$K]:$_.length>$H?$_[$H]:$_[$_.length-1],$T[$K]=$V}},$H._calculateNodeKeyFrames=function($t){$_.prototype._calculateNodeKeyFrames.call(this,$t);var $H,$I,$T,$K=$t.keyframes;$t.target;for($H in $T={},$t.secondFrames=$T,$K)($I=$K[$H]).length<=1?$T[$H]=-1:$T[$H]=$I[1].index},$q(0,$H,"target",function(){return this._target},function($t){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$t,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$q(0,$H,"playEvent",null,function($t){(this._playEvents=$t)&&this.addEvent()}),$q(0,$H,"effectData",null,function($t){var $H;$t&&(($H=$t.animations)&&$H[0]&&(this._setUp({},$H[0]),$H[0].nodes&&$H[0].nodes[0]&&(this._aniKeys=$H[0].nodes[0].keys)))}),$q(0,$H,"effectClass",null,function($t){var $H,$I;(this._effectClass=$a.getClass($t),this._effectClass)&&(($H=this._effectClass.uiView)&&($I=$H.animations)&&$I[0]&&(this._setUp({},$I[0]),$I[0].nodes&&$I[0].nodes[0]&&(this._aniKeys=$I[0].nodes[0].keys)))}),$t.EffectAnimationBegin="effectanimationbegin"}($Ct),function($H){var $k;function $r(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$r.__super.call(this)}$M($r,"laya.utils.GraphicAnimation",$H);var $t=$r.prototype;return $t._parseNodeList=function($t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$t.compId]=$t.props,$t.compId&&this._nodeList.push($t.compId);var $H=$t.child;if($H){var $I=0,$T=$H.length;for($I=0;$I<$T;$I++)this._parseNodeList($H[$I])}},$t._calGraphicData=function($t){var $H;if(this._setUp(null,$t),this._createGraphicData(),this._nodeIDAniDic)for($H in this._nodeIDAniDic)this._nodeIDAniDic[$H]=null},$t._createGraphicData=function(){var $t,$H=[],$I=0,$T=this.count,$K=this._animationNewFrames;for($K||($K=[]),$I=0;$I<$T;$I++)!$K[$I]&&$t||($t=this._createFrameGraphic($I)),$H.push($t);this._gList=$H},$t._createFrameGraphic=function($t){var $H=$x.createGraphics();return $r._rootMatrix||($r._rootMatrix=new $Y),this._updateNodeGraphic(this._rootNode,$t,$r._rootMatrix,$H),$H},$t._updateNodeGraphic=function($t,$H,$I,$T,$K){var $_;void 0===$K&&($K=1);var $V,$e,$R,$A=($_=this._nodeGDic[$t.compId]=this._getNodeGraphicData($t.compId,$H,this._nodeGDic[$t.compId])).alpha*$K;if(!($A<.01)&&($_.resultTransform||($_.resultTransform=$Y.create()),$V=$_.resultTransform,$Y.mul($_.transform,$I,$V),$_.skin&&($e=this._getTextureByUrl($_.skin))&&($V._checkTransform()?($T.drawTexture($e,0,0,$_.width,$_.height,$V,$A),$_.resultTransform=null):$T.drawTexture($e,$V.tx,$V.ty,$_.width,$_.height,null,$A)),$R=$t.child)){var $q,$f=0;for($q=$R.length,$f=0;$f<$q;$f++)this._updateNodeGraphic($R[$f],$H,$V,$T,$A)}},$t._updateNoChilds=function($t,$H){if($t.skin){var $I=this._getTextureByUrl($t.skin);if($I){var $T=$t.transform;$T._checkTransform();!$T.bTransform?$H.drawTexture($I,$T.tx,$T.ty,$t.width,$t.height,null,$t.alpha):$H.drawTexture($I,0,0,$t.width,$t.height,$T.clone(),$t.alpha)}}},$t._updateNodeGraphic2=function($t,$H,$I){var $T;if($T=this._nodeGDic[$t.compId]=this._getNodeGraphicData($t.compId,$H,this._nodeGDic[$t.compId]),$t.child){var $K=$T.transform;$K._checkTransform();var $_,$V;$V=($_=!$K.bTransform)&&(0!=$K.tx||0!=$K.ty);var $e,$R,$A;if(($e=$K.bTransform||1!=$T.alpha)&&$I.save(),1!=$T.alpha&&$I.alpha($T.alpha),$_?$V&&$I.translate($K.tx,$K.ty):$I.transform($K.clone()),$R=$t.child,$T.skin&&($A=this._getTextureByUrl($T.skin))&&$I.drawTexture($A,0,0,$T.width,$T.height),$R){var $q,$f=0;for($q=$R.length,$f=0;$f<$q;$f++)this._updateNodeGraphic2($R[$f],$H,$I)}$e?$I.restore():$_?$V&&$I.translate(-$K.tx,-$K.ty):$I.transform($K.clone().invert())}else this._updateNoChilds($T,$I)},$t._calculateNodeKeyFrames=function($t){$H.prototype._calculateNodeKeyFrames.call(this,$t),this._nodeIDAniDic[$t.target]=$t},$t.getNodeDataByID=function($t){return this._nodeIDAniDic[$t]},$t._getParams=function($t,$H,$I,$T){var $K=$r._temParam;$K.length=$H.length;var $_=0,$V=$H.length;for($_=0;$_<$V;$_++)$K[$_]=this._getObjVar($t,$H[$_][0],$I,$H[$_][1],$T);return $K},$t._getObjVar=function($t,$H,$I,$T,$K){if($t.hasOwnProperty($H)){var $_=$t[$H];if($I>=$_.length&&($I=$_.length-1),null!=$t[$H][$I])return $t[$H][$I]}return $K.hasOwnProperty($H)?$K[$H]:$T},$t._getNodeGraphicData=function($t,$H,$I){$I||($I=$k.create()),$I.transform?$I.transform.identity():$I.transform=$Y.create();var $T=this.getNodeDataByID($t);if(!$T)return $I;var $K,$_,$V=$T.frames,$e=this._getParams($V,$r._drawTextureCmd,$H,this._nodeDefaultProps[$t]),$R=$e[0],$A=NaN,$q=NaN,$f=$e[5],$b=$e[6],$L=$e[13],$G=$e[14],$M=$e[7],$O=$e[8],$J=$e[9],$S=$e[11],$U=$e[12];$A=$e[3],$q=$e[4],0!=$A&&0!=$q||($R=null),-1==$A&&($A=0),-1==$q&&($q=0),$I.skin=$R,$I.width=$A,$I.height=$q,$R&&(($K=this._getTextureByUrl($R))?($A||($A=$K.sourceWidth),$q||($q=$K.sourceHeight)):console.warn("lost skin:",$R,",you may load pics first")),$I.alpha=$e[10],$_=$I.transform,0!=$L&&($f=$L*$A),0!=$G&&($b=$G*$q),0==$f&&0==$b||$_.translate(-$f,-$b);var $C=null;if($J||1!==$M||1!==$O||$S||$U){($C=$r._tempMt).identity(),$C.bTransform=!0;var $N=.0174532922222222*($J-$S),$w=.0174532922222222*($J+$U),$W=Math.cos($w),$s=Math.sin($w),$z=Math.sin($N),$P=Math.cos($N);$C.a=$M*$W,$C.b=$M*$s,$C.c=-$O*$z,$C.d=$O*$P,$C.tx=$C.ty=0}return $C&&($_=$Y.mul($_,$C,$_)),$_.translate($e[1],$e[2]),$I},$t._getTextureByUrl=function($t){return $et.getRes($t)},$t.setAniData=function($t,$H){if($t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$t,this._parseNodeList($t);var $I,$T={},$K=[],$_=$t.animations,$V=0,$e=$_.length;for($V=0;$V<$e;$V++)if($I=$_[$V],this._labels=null,(!$H||$H==$I.name)&&$I){try{this._calGraphicData($I)}catch($t){console.warn("parse animation fail:"+$I.name+",empty animation created"),this._gList=[]}var $R={};$R.interval=1e3/$I.frameRate,$R.frames=this._gList,$R.labels=this._labels,$R.name=$I.name,$K.push($R),$T[$I.name]=$R}this.animationList=$K,this.animationDic=$T}$r._temParam.length=0},$t.parseByData=function($t){var $H,$I;$H=$t.nodeRoot,$I=$t.aniO,delete $t.nodeRoot,delete $t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$H,this._parseNodeList($H),this._labels=null;try{this._calGraphicData($I)}catch($t){console.warn("parse animation fail:"+$I.name+",empty animation created"),this._gList=[]}var $T=$t;return $T.interval=1e3/$I.frameRate,$T.frames=this._gList,$T.labels=this._labels,$T.name=$I.name,$T},$t.setUpAniData=function($t){if($t.animations){var $H,$I={},$T=[],$K=$t.animations,$_=0,$V=$K.length;for($_=0;$_<$V;$_++)if($H=$K[$_]){var $e={};$e.name=$H.name,$e.aniO=$H,$e.nodeRoot=$t,$T.push($e),$I[$H.name]=$e}this.animationList=$T,this.animationDic=$I}},$t._clear=function(){var $t,$H;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($t in this._nodeGDic)($H=this._nodeGDic[$t])&&$H.recover();this._nodeGDic=null},$r.parseAnimationByData=function($t){var $H;return $r._I||($r._I=new $r),$H=$r._I.parseByData($t),$r._I._clear(),$H},$r.parseAnimationData=function($t){var $H;return $r._I||($r._I=new $r),$r._I.setUpAniData($t),($H={}).animationList=$r._I.animationList,$H.animationDic=$r._I.animationDic,$r._I._clear(),$H},$r._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$r._temParam=[],$r._I=null,$r._rootMatrix=null,$R($r,["_tempMt",function(){return this._tempMt=new $Y}]),$r.__init$=function(){$k=function(){function $t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $M($t,""),$t.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$o.recover("GraphicNode",this)},$t.create=function(){return $o.getItemByClass("GraphicNode",$t)},$t}()},$r}($Ct));$W.__init([$A,$Rt,$g,$h,$F,$P,$t,$Wt])}(window,document,Laya),function($t,$H,$I){$I.un,$I.uns,$I.static;var $T=$I.class;$I.getset,$I.__newvec;new(function(){function $t(){}return $T($t,"LayaMain"),$t}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($t,$H){"use strict";for(var $I in Object.defineProperty($H,"__esModule",{value:!0}),Laya){var $T=Laya[$I];$T&&$T.__isclass&&($H[$I]=$T)}}),function($t,$H,$w){$w.un,$w.uns;var $V=$w.static,$b=$w.class,$T=$w.getset,$_=$w.__newvec,$q=laya.maths.Arith,$f=laya.maths.Bezier,$I=laya.resource.Bitmap,$L=laya.utils.Browser,$R=laya.utils.Byte,$G=laya.utils.Color,$W=(laya.filters.ColorFilter,$w.Config),$K=laya.resource.Context,$s=(laya.events.Event,laya.filters.Filter),$e=laya.display.Graphics,$A=laya.resource.HTMLCanvas,$M=(laya.utils.HTMLChar,laya.resource.HTMLImage),$O=laya.resource.HTMLSubImage,$z=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$P=laya.maths.Point,$k=laya.maths.Rectangle,$J=laya.renders.Render,$S=(laya.renders.RenderContext,laya.renders.RenderSprite),$U=laya.resource.Resource,$C=laya.resource.ResourceManager,$N=laya.utils.RunDriver,$r=laya.display.Sprite,$x=laya.display.Stage,$Y=laya.utils.Stat,$D=laya.utils.StringKey,$p=(laya.display.css.Style,laya.system.System),$g=laya.display.Text,$l=laya.resource.Texture,$v=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$y=laya.utils.VectorGraphManager;laya.utils.WordText;$w.interface("laya.webgl.shapes.IShape"),$w.interface("laya.webgl.submit.ISubmit"),$w.interface("laya.webgl.text.ICharSegment"),$w.interface("laya.webgl.canvas.save.ISaveData"),$w.interface("laya.webgl.resource.IMergeAtlasBitmap"),$w.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $E=function(){function $t(){}$b($t,"laya.filters.webgl.FilterActionGL");var $H=$t.prototype;return $w.imps($H,{"laya.filters.IFilterActionGL":!0}),$H.setValue=function($t){},$H.setValueMix=function($t){},$H.apply3d=function($t,$H,$I,$T,$K){return null},$H.apply=function($t){return null},$T(0,$H,"typeMix",function(){return 0}),$t}(),$h=function(){function $t(){}return $b($t,"laya.webgl.shader.ShaderValue"),$t}(),$X=function(){var $T,$K;function $t($t,$H,$I){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $K,void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),this._cells=null,this._rowInfo=null,this._init($t,$H),this._atlasID=$I}$b($t,"laya.webgl.atlas.AtlasGrid");var $H=$t.prototype;return $H.getAltasID=function(){return this._atlasID},$H.setAltasID=function($t){0<=$t&&(this._atlasID=$t)},$H.addTex=function($t,$H,$I){var $T=this._get($H,$I);return 0==$T.ret||(this._fill($T.x,$T.y,$H,$I,$t),this._texCount++),$T},$H._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$H._init=function($t,$H){if(this._width=$t,this._height=$H,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$_(this._height);for(var $I=0;$I<this._height;$I++)this._rowInfo[$I]=new $T;return this._clear(),!0},$H._get=function($t,$H){var $I=new $a;if($t>=this._failSize.width&&$H>=this._failSize.height)return $I;for(var $T=-1,$K=-1,$_=this._width,$V=this._height,$e=this._cells,$R=0;$R<$V;$R++)if(!(this._rowInfo[$R].spaceCount<$t))for(var $A=0;$A<$_;){var $q=3*($R*$_+$A);if(0!=$e[$q]||$e[1+$q]<$t||$e[2+$q]<$H)$A+=$e[1+$q];else{$T=$A,$K=$R;for(var $f=0;$f<$t;$f++)if($e[3*$f+$q+2]<$H){$T=-1;break}if(!($T<0))return $I.ret=!0,$I.x=$T,$I.y=$K,$I;$A+=$e[1+$q]}}return $I},$H._fill=function($t,$H,$I,$T,$K){var $_=this._width,$V=this._height;this._check($t+$I<=$_&&$H+$T<=$V);for(var $e=$H;$e<$T+$H;++$e){this._check(this._rowInfo[$e].spaceCount>=$I),this._rowInfo[$e].spaceCount-=$I;for(var $R=0;$R<$I;$R++){var $A=3*($t+$e*$_+$R);this._check(0==this._cells[$A]),this._cells[$A]=$K,this._cells[1+$A]=$I,this._cells[2+$A]=$T}}if(0<$t)for($e=0;$e<$T;++$e){var $q=0;for($R=$t-1;0<=$R&&0==this._cells[3*(($H+$e)*$_+$R)];--$R,++$q);for($R=$q;0<$R;--$R)this._cells[3*(($H+$e)*$_+$t-$R)+1]=$R,this._check(0<$R)}if(0<$H)for($R=$t;$R<$t+$I;++$R){for($q=0,$e=$H-1;0<=$e&&0==this._cells[3*($R+$e*$_)];--$e,$q++);for($e=$q;0<$e;--$e)this._cells[3*($R+($H-$e)*$_)+2]=$e,this._check(0<$e)}},$H._check=function($t){0==$t&&console.log("xtexMerger 错误啦")},$H._clear=function(){for(var $t=this._texCount=0;$t<this._height;$t++)this._rowInfo[$t].spaceCount=this._width;for(var $H=0;$H<this._height;$H++)for(var $I=0;$I<this._width;$I++){var $T=3*($H*this._width+$I);this._cells[$T]=0,this._cells[1+$T]=this._width-$I,this._cells[2+$T]=this._width-$H}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$t.__init$=function(){$T=function(){function $t(){this.spaceCount=0}return $b($t,""),$t}(),$K=function(){function $t(){this.width=0,this.height=0}return $b($t,""),$t}()},$t}(),$B=function(){function $J($t,$H,$I,$T){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$t,this._height=$H,this._gridSize=$I,this._maxAtlaserCount=$T,this._gridNumX=$t/$I,this._gridNumY=$H/$I,this._curAtlasIndex=0,this._atlaserArray=[]}$b($J,"laya.webgl.atlas.AtlasResourceManager");var $t=$J.prototype;return $t.setAtlasParam=function($t,$H,$I,$T){if(1==this._setAtlasParam)return $J._sid_=0,this._width=$t,this._height=$H,this._gridSize=$I,this._maxAtlaserCount=$T,this._gridNumX=$t/$I,this._gridNumY=$H/$I,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$t.pushData=function($t){var $H,$I=$t.bitmap,$T=-1,$K=null,$_=0,$V=0;for($_=0,$H=this._atlaserArray.length;$_<$H&&($V=(this._curAtlasIndex+$_)%$H,-1==($T=($K=this._atlaserArray[$V]).findBitmapIsExist($I)));$_++);if(-1!=$T){var $e=$K.InAtlasWebGLImagesOffsetValue[$T];return $G=$e[0],$M=$e[1],$K.addToAtlas($t,$G,$M),!0}this._setAtlasParam=!1;for(var $R=Math.ceil(($t.bitmap.width+2)/this._gridSize),$A=Math.ceil(($t.bitmap.height+2)/this._gridSize),$q=!1,$f=0;$f<2;$f++){var $b=this._maxAtlaserCount;for($_=0;$_<$b;$_++){$V=(this._curAtlasIndex+$_)%$b,this._atlaserArray.length-1>=$V||this._atlaserArray.push(new $kt(this._gridNumX,this._gridNumY,this._width,this._height,$J._sid_++));var $L=this._atlaserArray[$V],$G=0,$M=0,$O=$L.addTex(1,$R,$A);if($O.ret){$G=$O.x*this._gridSize+1,$M=$O.y*this._gridSize+1,$I.lock=!0,$L.addToAtlasTexture($I,$G,$M),$L.addToAtlas($t,$G,$M),$q=!0,this._curAtlasIndex=$V;break}}if($q)break;this._atlaserArray.push(new $kt(this._gridNumX,this._gridNumY,this._width,this._height,$J._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $q||console.log(">>>AtlasManager pushData error"),$q},$t.addToAtlas=function($t){laya.webgl.atlas.AtlasResourceManager.instance.pushData($t)},$t.garbageCollection=function(){if(!0===this._needGC){for(var $t=this._atlaserArray.length-this._maxAtlaserCount,$H=0;$H<$t;$H++)this._atlaserArray[$H].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$t),this._atlaserArray.splice(0,$t),this._needGC=!1}return!0},$t.freeAll=function(){for(var $t=0,$H=this._atlaserArray.length;$t<$H;$t++)this._atlaserArray[$t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$t.getAtlaserCount=function(){return this._atlaserArray.length},$t.getAtlaserByIndex=function($t){return this._atlaserArray[$t]},$T(1,$J,"instance",function(){return $J._Instance||($J._Instance=new $J(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$J._Instance}),$T(1,$J,"enabled",function(){return $W.atlasEnable}),$T(1,$J,"atlasLimitWidth",function(){return $J._atlasLimitWidth},function($t){$J._atlasLimitWidth=$t}),$T(1,$J,"atlasLimitHeight",function(){return $J._atlasLimitHeight},function($t){$J._atlasLimitHeight=$t}),$J._enable=function(){$W.atlasEnable=!0},$J._disable=function(){$W.atlasEnable=!1},$J.__init__=function(){$J.atlasTextureWidth=2048,$J.atlasTextureHeight=2048,$J.maxTextureCount=6,$J.atlasLimitWidth=512,$J.atlasLimitHeight=512},$J._atlasLimitWidth=0,$J._atlasLimitHeight=0,$J.gridSize=16,$J.atlasTextureWidth=0,$J.atlasTextureHeight=0,$J.maxTextureCount=0,$J._atlasRestore=0,$J.BOARDER_TYPE_NO=0,$J.BOARDER_TYPE_RIGHT=1,$J.BOARDER_TYPE_LEFT=2,$J.BOARDER_TYPE_BOTTOM=4,$J.BOARDER_TYPE_TOP=8,$J.BOARDER_TYPE_ALL=15,$J._sid_=0,$J._Instance=null,$J}(),$a=function(){function $t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $b($t,"laya.webgl.atlas.MergeFillInfo"),$t}(),$u=function(){function $H(){}return $b($H,"laya.webgl.canvas.BlendMode"),$H._init_=function($t){$H.fns=[$H.BlendNormal,$H.BlendAdd,$H.BlendMultiply,$H.BlendScreen,$H.BlendOverlay,$H.BlendLight,$H.BlendMask,$H.BlendDestinationOut],$H.targetFns=[$H.BlendNormalTarget,$H.BlendAddTarget,$H.BlendMultiplyTarget,$H.BlendScreenTarget,$H.BlendOverlayTarget,$H.BlendLightTarget,$H.BlendMask,$H.BlendDestinationOut]},$H.BlendNormal=function($t){$t.blendFunc(1,771)},$H.BlendAdd=function($t){$t.blendFunc(1,772)},$H.BlendMultiply=function($t){$t.blendFunc(774,771)},$H.BlendScreen=function($t){$t.blendFunc(1,1)},$H.BlendOverlay=function($t){$t.blendFunc(1,769)},$H.BlendLight=function($t){$t.blendFunc(1,1)},$H.BlendNormalTarget=function($t){$t.blendFunc(1,771)},$H.BlendAddTarget=function($t){$t.blendFunc(1,772)},$H.BlendMultiplyTarget=function($t){$t.blendFunc(774,771)},$H.BlendScreenTarget=function($t){$t.blendFunc(1,1)},$H.BlendOverlayTarget=function($t){$t.blendFunc(1,769)},$H.BlendLightTarget=function($t){$t.blendFunc(1,1)},$H.BlendMask=function($t){$t.blendFunc(0,770)},$H.BlendDestinationOut=function($t){$t.blendFunc(0,0)},$H.activeBlendFunction=null,$H.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$H.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$H.NORMAL="normal",$H.ADD="add",$H.MULTIPLY="multiply",$H.SCREEN="screen",$H.LIGHT="light",$H.OVERLAY="overlay",$H.DESTINATIONOUT="destination-out",$H.fns=[],$H.targetFns=[],$H}(),$$=function(){function $I($t){this._color=$G.create("black"),this.setValue($t)}$b($I,"laya.webgl.canvas.DrawStyle");var $t=$I.prototype;return $t.setValue=function($t){if($t){if("string"==typeof $t)return void(this._color=$G.create($t));if($t instanceof laya.utils.Color)return void(this._color=$t)}},$t.reset=function(){this._color=$G.create("black")},$t.equal=function($t){return"string"==typeof $t?this._color.strColor===$t:$t instanceof laya.utils.Color&&this._color.numColor===$t.numColor},$t.toColorStr=function(){return this._color.strColor},$I.create=function($t){var $H;if($t&&("string"==typeof $t?$H=$G.create($t):$t instanceof laya.utils.Color&&($H=$t),$H))return $H._drawStyle||($H._drawStyle=new $I($t));return laya.webgl.canvas.DrawStyle.DEFAULT},$V($I,["DEFAULT",function(){return this.DEFAULT=new $I("#000000")}]),$I}(),$Q=function(){function $t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$Ct.mainContext;this.ib=$dt.create(35048),this.vb=$Zt.create(5)}$b($t,"laya.webgl.canvas.Path");var $H=$t.prototype;return $H.addPoint=function($t,$H){this.tempArray.push($t,$H)},$H.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$H.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$H.polygon=function($t,$H,$I,$T,$K,$_){var $V;return this.geomatrys.push(this._curGeomatry=$V=new $Dt($t,$H,$I,$T,$K,$_)),$T||($V.fill=!1),null==$_&&($V.borderWidth=0),$V},$H.setGeomtry=function($t){this.geomatrys.push(this._curGeomatry=$t)},$H.drawLine=function($t,$H,$I,$T,$K){var $_;return this.closePath?this.geomatrys.push(this._curGeomatry=$_=new $Yt($t,$H,$I,$T,$K)):this.geomatrys.push(this._curGeomatry=$_=new $xt($t,$H,$I,$T,$K)),$_.fill=!1,$_},$H.update=function(){var $t=this.ib._byteLength,$H=this.geomatrys.length;this.offset=$t;for(var $I=this.geoStart;$I<$H;$I++)this.geomatrys[$I].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$H,this.count=(this.ib._byteLength-$t)/$Mt.BYTES_PIDX},$H.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$H.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$t}(),$m=function(){function $e(){}$b($e,"laya.webgl.canvas.save.SaveBase");var $t=$e.prototype;return $w.imps($t,{"laya.webgl.canvas.save.ISaveData":!0}),$t.isSaveMark=function(){return!1},$t.restore=function($t){this._dataObj[this._valueName]=this._value,($e._cache[$e._cache._length++]=this)._newSubmit&&($t._curSubmit=$_t.RENDERBASE,$t._renderKey=0)},$e._createArray=function(){var $t=[];return $t._length=0,$t},$e._init=function(){var $t=$e._namemap={};return $t[1]="ALPHA",$t[2]="fillStyle",$t[8]="font",$t[256]="lineWidth",$t[512]="strokeStyle",$t[8192]="_mergeID",$t[1024]=$t[2048]=$t[4096]=[],$t[16384]="textBaseline",$t[32768]="textAlign",$t[65536]="_nBlendType",$t[1048576]="shader",$t[2097152]="filters",$t},$e.save=function($t,$H,$I,$T){if(($t._saveMark._saveuse&$H)!==$H){$t._saveMark._saveuse|=$H;var $K=$e._cache,$_=0<$K._length?$K[--$K._length]:new $e;$_._value=$I[$_._valueName=$e._namemap[$H]],$_._dataObj=$I,$_._newSubmit=$T;var $V=$t._save;$V[$V._length++]=$_}},$e._cache=laya.webgl.canvas.save.SaveBase._createArray(),$e._namemap=$e._init(),$e}(),$o=function(){function $_(){this._clipRect=new $k}$b($_,"laya.webgl.canvas.save.SaveClipRect");var $t=$_.prototype;return $w.imps($t,{"laya.webgl.canvas.save.ISaveData":!0}),$t.isSaveMark=function(){return!1},$t.restore=function($t){$t._clipRect=this._clipSaveRect,($_._cache[$_._cache._length++]=this)._submitScissor.submitLength=$t._submits._length-this._submitScissor.submitIndex,$t._curSubmit=$_t.RENDERBASE,$t._renderKey=0},$_.save=function($t,$H){if(131072!=(131072&$t._saveMark._saveuse)){$t._saveMark._saveuse|=131072;var $I=$_._cache,$T=0<$I._length?$I[--$I._length]:new $_;$T._clipSaveRect=$t._clipRect,$t._clipRect=$T._clipRect.copyFrom($t._clipRect),$T._submitScissor=$H;var $K=$t._save;$K[$K._length++]=$T}},$V($_,["_cache",function(){return this._cache=$m._createArray()}]),$_}(),$n=function(){function $L(){this._contextX=0,this._contextY=0,this._clipRect=new $k,this._rect=new $k,this._matrix=new $z}$b($L,"laya.webgl.canvas.save.SaveClipRectStencil");var $t=$L.prototype;return $w.imps($t,{"laya.webgl.canvas.save.ISaveData":!0}),$t.isSaveMark=function(){return!1},$t.restore=function($t){$qt.restore($t,this._rect,this._saveMatrix,this._contextX,this._contextY),$t._clipRect=this._clipSaveRect,$t._curMat=this._saveMatrix,$t._x=this._contextX,$t._y=this._contextY,$L._cache[$L._cache._length++]=this,$t._curSubmit=$_t.RENDERBASE},$L.save=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){if(262144!=(262144&$t._saveMark._saveuse)){$t._saveMark._saveuse|=262144;var $q=$L._cache,$f=0<$q._length?$q[--$q._length]:new $L;$f._clipSaveRect=$t._clipRect,$f._clipRect.setTo($V,$e,$R,$A),$t._clipRect=$f._clipRect,$f._rect.x=$I,$f._rect.y=$T,$f._rect.width=$K,$f._rect.height=$_,$f._contextX=$t._x,$f._contextY=$t._y,$f._saveMatrix=$t._curMat,$t._curMat.copyTo($f._matrix),$t._curMat=$f._matrix,$f._submitStencil=$H;var $b=$t._save;$b[$b._length++]=$f}},$V($L,["_cache",function(){return this._cache=$m._createArray()}]),$L}(),$F=function(){function $T(){this._saveuse=0}$b($T,"laya.webgl.canvas.save.SaveMark");var $t=$T.prototype;return $w.imps($t,{"laya.webgl.canvas.save.ISaveData":!0}),$t.isSaveMark=function(){return!0},$t.restore=function($t){$t._saveMark=this._preSaveMark,$T._no[$T._no._length++]=this},$T.Create=function($t){var $H=$T._no,$I=0<$H._length?$H[--$H._length]:new $T;return $I._saveuse=0,$I._preSaveMark=$t._saveMark,$t._saveMark=$I},$V($T,["_no",function(){return this._no=$m._createArray()}]),$T}(),$c=function(){function $_(){this._matrix=new $z}$b($_,"laya.webgl.canvas.save.SaveTransform");var $t=$_.prototype;return $w.imps($t,{"laya.webgl.canvas.save.ISaveData":!0}),$t.isSaveMark=function(){return!1},$t.restore=function($t){$t._curMat=this._savematrix,$_._no[$_._no._length++]=this},$_.save=function($t){var $H=$t._saveMark;if(2048!=(2048&$H._saveuse)){$H._saveuse|=2048;var $I=$_._no,$T=0<$I._length?$I[--$I._length]:new $_;$T._savematrix=$t._curMat,$t._curMat=$t._curMat.copyTo($T._matrix);var $K=$t._save;$K[$K._length++]=$T}},$V($_,["_no",function(){return this._no=$m._createArray()}]),$_}(),$i=function(){function $K(){}$b($K,"laya.webgl.canvas.save.SaveTranslate");var $t=$K.prototype;return $w.imps($t,{"laya.webgl.canvas.save.ISaveData":!0}),$t.isSaveMark=function(){return!1},$t.restore=function($t){$t._curMat;$t._x=this._x,$t._y=this._y,$K._no[$K._no._length++]=this},$K.save=function($t){var $H=$K._no,$I=0<$H._length?$H[--$H._length]:new $K;$I._x=$t._x,$I._y=$t._y;var $T=$t._save;$T[$T._length++]=$I},$V($K,["_no",function(){return this._no=$m._createArray()}]),$K}(),$j=function(){function $t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $k}$b($t,"laya.webgl.resource.RenderTargetMAX");var $H=$t.prototype;return $H.setSP=function($t){this._sp=$t},$H.size=function($t,$H){var $I=this;this._width!==$t||this._height!==$H?(this.repaint=!0,this._width=$t,this._height=$H,this.target?this.target.size($t,$H):this.target=$yt.create($t,$H),this.target.hasListener("recovered")||this.target.on("recovered",this,function($t){$w.timer.callLater($I._sp,$I._sp.repaint)})):this.target.size($t,$H)},$H._flushToTarget=function($t,$H){if(!$H._destroy){var $I=$St.worldScissorTest,$T=$St.worldClipRect;$St.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$St.worldScissorTest=!1,$Ct.mainContext.disable(3089);var $K=$St.worldAlpha,$_=$St.worldMatrix4,$V=$St.worldMatrix,$e=$St.worldFilters,$R=$St.worldShaderDefines;if($St.worldMatrix=$z.EMPTY,$St.restoreTempArray(),$St.worldMatrix4=$St.TEMPMAT4_ARRAY,$St.worldAlpha=1,$St.worldFilters=null,$St.worldShaderDefines=null,$vt.activeShader=null,$H.start(),$W.showCanvasMark?$H.clear(0,1,0,.3):$H.clear(0,0,0,0),$t.flush(),$H.end(),$vt.activeShader=null,$St.worldAlpha=$K,$St.worldMatrix4=$_,$St.worldMatrix=$V,$St.worldFilters=$e,$St.worldShaderDefines=$R,$St.worldScissorTest=$I){var $A=$St.height-$T.y-$T.height;$Ct.mainContext.scissor($T.x,$A,$T.width,$T.height),$Ct.mainContext.enable(3089)}$St.worldClipRect=$T}},$H.flush=function($t){this.repaint&&(this._flushToTarget($t,this.target),this.repaint=!1)},$H.drawTo=function($t,$H,$I,$T,$K){$t.drawTexture(this.target.getTexture(),$H,$I,$T,$K,0,0)},$H.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$t}(),$d=function(){function $t(){this.ALPHA=1,this.shaderType=0,this.defines=new $rt}return $b($t,"laya.webgl.shader.d2.Shader2D"),$t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$t.__init__=function(){var $t,$H;$Ft.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$Ft.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$Ft.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$Ft.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$Ft.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$Ft.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$Ft.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$Ft.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$H='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$Ft.preCompile2D(0,1,$t,$H,null),$t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$H='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$Ft.preCompile2D(0,2,$t,$H,null),$t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$H="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$Ft.preCompile2D(0,4,$t,$H,null),$t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$H='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$Ft.preCompile2D(0,256,$t,$H,null),$t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$H="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$Ft.preCompile2D(0,512,$t,$H,null)},$t}(),$Z=function(){function $H($t,$H,$I){this._value=0,this._name2int=$t,this._int2name=$H,this._int2nameMap=$I}$b($H,"laya.webgl.shader.ShaderDefines");var $t=$H.prototype;return $t.add=function($t){return"string"==typeof $t&&($t=this._name2int[$t]),this._value|=$t,this._value},$t.addInt=function($t){return this._value|=$t,this._value},$t.remove=function($t){return"string"==typeof $t&&($t=this._name2int[$t]),this._value&=~$t,this._value},$t.isDefine=function($t){return(this._value&$t)===$t},$t.getValue=function(){return this._value},$t.setValue=function($t){this._value=$t},$t.toNameDic=function(){var $t=this._int2nameMap[this._value];return $t||$H._toText(this._value,this._int2name,this._int2nameMap)},$H._reg=function($t,$H,$I,$T){$T[$I[$t]=$H]=$t},$H._toText=function($t,$H,$I){var $T=$I[$t];if($T)return $T;for(var $K={},$_=1,$V=0;$V<32&&!($t<($_=1<<$V));$V++)if($t&$_){var $e=$H[$_];$e&&($K[$e]="")}return $I[$t]=$K},$H._toInt=function($t,$H){for(var $I=$t.split("."),$T=0,$K=0,$_=$I.length;$K<$_;$K++){var $V=$H[$I[$K]];if(!$V)throw new Error("Defines to int err:"+$t+"/"+$I[$K]);$T|=$V}return $T},$H}(),$tt=function(){function $V(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $z}$b($V,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $t=$V.prototype;return $t.init=function($t,$H,$I){if($H)this._vs=$H;else{this._vs=[];var $T=$t.width,$K=$t.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($T,0,1,0,1,1,1,1),this._vs.push($T,$K,1,1,1,1,1,1),this._vs.push(0,$K,0,1,1,1,1,1)}$I?this._ps=$I:($V._defaultPS||($V._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$V._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$t},$t.init2=function($t,$H,$I,$T,$K){this.transform&&(this.transform=null),$I?this._ps=$I:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$T,this._uvs=$K,this.mEleNum=this._ps.length,this.mTexture=$t,($J.isConchNode||$J.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$t._initMyData=function(){var $t=0,$H=0,$I=4*this._verticles.length;this._vs=$V._tempVS;var $T=!1;if($J.isConchNode||$J.isConchApp?(this._vs.length=$I,$T=!0):this._vs.length<$I&&(this._vs.length=$I,$T=!0),$V._tVSLen=$I,$T)for(;$t<$I;)this._vs[$t]=this._verticles[$H],this._vs[$t+1]=this._verticles[$H+1],this._vs[$t+2]=this._uvs[$H],this._vs[$t+3]=this._uvs[$H+1],this._vs[$t+4]=1,this._vs[$t+5]=1,this._vs[$t+6]=1,this._vs[$t+7]=1,$t+=8,$H+=2;else for(;$t<$I;)this._vs[$t]=this._verticles[$H],this._vs[$t+1]=this._verticles[$H+1],this._vs[$t+2]=this._uvs[$H],this._vs[$t+3]=this._uvs[$H+1],$t+=8,$H+=2},$t.getData2=function($t,$H,$I){var $T;this.mVBBuffer=$t,this.mIBBuffer=$H,this._initMyData(),$t.appendEx2(this._vs,Float32Array,$V._tVSLen,4),this._indexStart=$H._byteLength,($T=$V._tempIB).length<this._ps.length&&($T.length=this._ps.length);for(var $K=0,$_=this._ps.length;$K<$_;$K++)$T[$K]=this._ps[$K]+$I;$H.appendEx2($T,Uint16Array,this._ps.length,2)},$t.getData=function($t,$H,$I){if(this.mVBBuffer=$t,this.mIBBuffer=$H,$t.append(this.mVBData),this._indexStart=$H._byteLength,this.mIBData.start!=$I){for(var $T=0,$K=this._ps.length;$T<$K;$T++)this.mIBData[$T]=this._ps[$T]+$I;this.mIBData.start=$I}$H.append(this.mIBData)},$t.render=function($t,$H,$I){if($J.isWebGL&&this.mTexture){$t._renderKey=0,$t._shader2D.glTexture=null,$Ht.getInstance().addSkinMesh(this);var $T=$_t.createShape($t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$st.create(512,0));this.transform||(this.transform=$z.EMPTY),this.transform.translate($H,$I),$z.mul(this.transform,$t._curMat,this._tempMatrix),this.transform.translate(-$H,-$I);var $K=$T.shaderValue,$_=$K.u_mmat2||$St.getMatrArray();$St.mat2MatArray(this._tempMatrix,$_),$K.textureHost=this.mTexture,$K.offsetX=0,$K.offsetY=0,$K.u_mmat2=$_,$K.ALPHA=$t._shader2D.ALPHA,$t._submits[$t._submits._length++]=$T}else $J.isConchApp&&this.mTexture&&(this.transform||(this.transform=$z.EMPTY),$t.setSkinMesh&&$t.setSkinMesh($H,$I,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$V._tempVS=[],$V._tempIB=[],$V._defaultPS=null,$V._tVSLen=0,$V}(),$Ht=function(){function $t(){this.ib=null,this.vb=null;$Ct.mainContext;this.ib=$dt.create(35048),this.vb=$Zt.create(8)}$b($t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $H=$t.prototype;return $H.addSkinMesh=function($t){$t.getData2(this.vb,this.ib,this.vb._byteLength/32)},$H.reset=function(){this.vb.clear(),this.ib.clear()},$t.getInstance=function(){return $t.instance=$t.instance||new $t},$t.instance=null,$t}(),$It=function(){function $t($t,$H,$I,$T,$K,$_,$V,$e,$R){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$R&&($R=0),this.x=$t,this.y=$H,this.width=$I,this.height=$T,this.edges=$K,this.color=$_,this.borderWidth=$V,this.borderColor=$e}$b($t,"laya.webgl.shapes.BasePoly");var $H=$t.prototype;return $w.imps($H,{"laya.webgl.shapes.IShape":!0}),$H.getData=function($t,$H,$I){},$H.rebuild=function($t){},$H.setMatrix=function($t){},$H.needUpdate=function($t){return!0},$H.sector=function($t,$H,$I){var $T=this.x,$K=this.y,$_=this.edges,$V=(this.r1-this.r0)/$_,$e=this.width,$R=this.height,$A=this.color,$q=($A>>16&255)/255,$f=($A>>8&255)/255,$b=(255&$A)/255;$t.push($T,$K,$q,$f,$b);for(var $L=0;$L<$_+1;$L++)$t.push($T+Math.sin($V*$L+this.r0)*$e,$K+Math.cos($V*$L+this.r0)*$R),$t.push($q,$f,$b);for($L=0;$L<$_;$L++)$H.push($I,$I+$L+1,$I+$L+2)},$H.createLine2=function($t,$H,$I,$T,$K,$_){var $V,$e,$R,$A,$q,$f,$b,$L,$G,$M,$O,$J,$S,$U,$C,$N,$w,$W,$s,$z,$P=$t.concat(),$k=$K,$r=this.borderColor,$x=($r>>16&255)/255,$Y=($r>>8&255)/255,$D=(255&$r)/255,$p=$P.length/2,$g=$T,$l=$I/2;$R=$P[0],$A=$P[1],$M=$R-($q=$P[2]),$G=($G=-($A-($f=$P[3])))/($z=Math.sqrt($G*$G+$M*$M))*$l,$M=$M/$z*$l,$k.push($R-$G+this.x,$A-$M+this.y,$x,$Y,$D,$R+$G+this.x,$A+$M+this.y,$x,$Y,$D);for(var $v=1;$v<$p-1;$v++)$R=$P[2*($v-1)],$A=$P[2*($v-1)+1],$q=$P[2*$v],$f=$P[2*$v+1],$b=$P[2*($v+1)],$L=$P[2*($v+1)+1],$M=$R-$q,$J=$q-$b,$C=(-($G=($G=-($A-$f))/($z=Math.sqrt($G*$G+$M*$M))*$l)+$R)*(-($M=$M/$z*$l)+$f)-(-$G+$q)*(-$M+$A),$W=(-($O=($O=-($f-$L))/($z=Math.sqrt($O*$O+$J*$J))*$l)+$b)*(-($J=$J/$z*$l)+$f)-(-$O+$q)*(-$J+$L),$s=($S=-$M+$A-(-$M+$f))*($w=-$O+$q-(-$O+$b))-($N=-$J+$L-(-$J+$f))*($U=-$G+$q-(-$G+$R)),Math.abs($s)<.1?($s+=10.1,$k.push($q-$G+this.x,$f-$M+this.y,$x,$Y,$D,$q+$G+this.x,$f+$M+this.y,$x,$Y,$D)):((($V=($U*$W-$w*$C)/$s)-$q)*($V-$q)+(($e=($N*$C-$S*$W)/$s)-$f)+($e-$f),$k.push($V+this.x,$e+this.y,$x,$Y,$D,$q-($V-$q)+this.x,$f-($e-$f)+this.y,$x,$Y,$D));$R=$P[$P.length-4],$A=$P[$P.length-3],$M=$R-($q=$P[$P.length-2]),$G=($G=-($A-($f=$P[$P.length-1])))/($z=Math.sqrt($G*$G+$M*$M))*$l,$M=$M/$z*$l,$k.push($q-$G+this.x,$f-$M+this.y,$x,$Y,$D,$q+$G+this.x,$f+$M+this.y,$x,$Y,$D);var $y=$_;for($v=1;$v<$y;$v++)$H.push($g+2*($v-1),$g+2*($v-1)+1,$g+2*$v+1,$g+2*$v+1,$g+2*$v,$g+2*($v-1));return $k},$H.createLine=function($t,$H,$I,$T){var $K=$t.concat(),$_=$t,$V=this.borderColor,$e=($V>>16&255)/255,$R=($V>>8&255)/255,$A=(255&$V)/255;$K.splice(0,5);var $q,$f,$b,$L,$G,$M,$O,$J,$S,$U,$C,$N,$w,$W,$s,$z,$P,$k,$r,$x,$Y=$K.length/5,$D=$T,$p=$I/2;$b=$K[0],$L=$K[1],$U=$b-($G=$K[5]),$S=($S=-($L-($M=$K[6])))/($x=Math.sqrt($S*$S+$U*$U))*$p,$U=$U/$x*$p,$_.push($b-$S,$L-$U,$e,$R,$A,$b+$S,$L+$U,$e,$R,$A);for(var $g=1;$g<$Y-1;$g++)$b=$K[5*($g-1)],$L=$K[5*($g-1)+1],$G=$K[5*$g],$M=$K[5*$g+1],$O=$K[5*($g+1)],$J=$K[5*($g+1)+1],$U=$b-$G,$N=$G-$O,$s=(-($S=($S=-($L-$M))/($x=Math.sqrt($S*$S+$U*$U))*$p)+$b)*(-($U=$U/$x*$p)+$M)-(-$S+$G)*(-$U+$L),$k=(-($C=($C=-($M-$J))/($x=Math.sqrt($C*$C+$N*$N))*$p)+$O)*(-($N=$N/$x*$p)+$M)-(-$C+$G)*(-$N+$J),$r=($w=-$U+$L-(-$U+$M))*($P=-$C+$G-(-$C+$O))-($z=-$N+$J-(-$N+$M))*($W=-$S+$G-(-$S+$b)),Math.abs($r)<.1?($r+=10.1,$_.push($G-$S,$M-$U,$e,$R,$A,$G+$S,$M+$U,$e,$R,$A)):((($q=($W*$k-$P*$s)/$r)-$G)*($q-$G)+(($f=($z*$s-$w*$k)/$r)-$M)+($f-$M),$_.push($q,$f,$e,$R,$A,$G-($q-$G),$M-($f-$M),$e,$R,$A));$b=$K[$K.length-10],$L=$K[$K.length-9],$U=$b-($G=$K[$K.length-5]),$S=($S=-($L-($M=$K[$K.length-4])))/($x=Math.sqrt($S*$S+$U*$U))*$p,$U=$U/$x*$p,$_.push($G-$S,$M-$U,$e,$R,$A,$G+$S,$M+$U,$e,$R,$A);var $l=this.edges+1;for($g=1;$g<$l;$g++)$H.push($D+2*($g-1),$D+2*($g-1)+1,$D+2*$g+1,$D+2*$g+1,$D+2*$g,$D+2*($g-1));return $_},$H.createLoopLine=function($t,$H,$I,$T,$K,$_){var $V=$t.concat(),$e=$K||$t,$R=this.borderColor,$A=($R>>16&255)/255,$q=($R>>8&255)/255,$f=(255&$R)/255;$V.splice(0,5);var $b=[$V[0],$V[1]],$L=[$V[$V.length-5],$V[$V.length-4]],$G=$L[0]+.5*($b[0]-$L[0]),$M=$L[1]+.5*($b[1]-$L[1]);$V.unshift($G,$M,0,0,0),$V.push($G,$M,0,0,0);var $O,$J,$S,$U,$C,$N,$w,$W,$s,$z,$P,$k,$r,$x,$Y,$D,$p,$g,$l,$v,$y=$V.length/5,$E=$T,$h=$I/2;$S=$V[0],$U=$V[1],$z=$S-($C=$V[5]),$s=($s=-($U-($N=$V[6])))/($v=Math.sqrt($s*$s+$z*$z))*$h,$z=$z/$v*$h,$e.push($S-$s,$U-$z,$A,$q,$f,$S+$s,$U+$z,$A,$q,$f);for(var $X=1;$X<$y-1;$X++)$S=$V[5*($X-1)],$U=$V[5*($X-1)+1],$C=$V[5*$X],$N=$V[5*$X+1],$w=$V[5*($X+1)],$W=$V[5*($X+1)+1],$z=$S-$C,$k=$C-$w,$Y=(-($s=($s=-($U-$N))/($v=Math.sqrt($s*$s+$z*$z))*$h)+$S)*(-($z=$z/$v*$h)+$N)-(-$s+$C)*(-$z+$U),$g=(-($P=($P=-($N-$W))/($v=Math.sqrt($P*$P+$k*$k))*$h)+$w)*(-($k=$k/$v*$h)+$N)-(-$P+$C)*(-$k+$W),$l=($r=-$z+$U-(-$z+$N))*($p=-$P+$C-(-$P+$w))-($D=-$k+$W-(-$k+$N))*($x=-$s+$C-(-$s+$S)),Math.abs($l)<.1?($l+=10.1,$e.push($C-$s,$N-$z,$A,$q,$f,$C+$s,$N+$z,$A,$q,$f)):((($O=($x*$g-$p*$Y)/$l)-$C)*($O-$C)+(($J=($D*$Y-$r*$g)/$l)-$N)+($J-$N),$e.push($O,$J,$A,$q,$f,$C-($O-$C),$N-($J-$N),$A,$q,$f));$_&&($H=$_);var $B=this.edges+1;for($X=1;$X<$B;$X++)$H.push($E+2*($X-1),$E+2*($X-1)+1,$E+2*$X+1,$E+2*$X+1,$E+2*$X,$E+2*($X-1));return $H.push($E+2*($X-1),$E+2*($X-1)+1,$E+1,$E+1,$E,$E+2*($X-1)),$e},$t}(),$Tt=function(){function $M(){}return $b($M,"laya.webgl.shapes.Earcut"),$M.earcut=function($t,$H,$I){$I=$I||2;var $T,$K,$_,$V,$e,$R,$A,$q=$H&&$H.length,$f=$q?$H[0]*$I:$t.length,$b=$M.linkedList($t,0,$f,$I,!0),$L=[];if(!$b)return $L;if($q&&($b=$M.eliminateHoles($t,$H,$b,$I)),$t.length>80*$I){$T=$_=$t[0],$K=$V=$t[1];for(var $G=$I;$G<$f;$G+=$I)($e=$t[$G])<$T&&($T=$e),($R=$t[$G+1])<$K&&($K=$R),$_<$e&&($_=$e),$V<$R&&($V=$R);$A=0!==($A=Math.max($_-$T,$V-$K))?1/$A:0}return $M.earcutLinked($b,$L,$I,$T,$K,$A),$L},$M.linkedList=function($t,$H,$I,$T,$K){var $_,$V;if($K===0<$M.signedArea($t,$H,$I,$T))for($_=$H;$_<$I;$_+=$T)$V=$M.insertNode($_,$t[$_],$t[$_+1],$V);else for($_=$I-$T;$H<=$_;$_-=$T)$V=$M.insertNode($_,$t[$_],$t[$_+1],$V);return $V&&$M.equals($V,$V.next)&&($M.removeNode($V),$V=$V.next),$V},$M.filterPoints=function($t,$H){if(!$t)return $t;$H||($H=$t);var $I,$T=$t;do{if($I=!1,$T.steiner||!$M.equals($T,$T.next)&&0!==$M.area($T.prev,$T,$T.next))$T=$T.next;else{if($M.removeNode($T),($T=$H=$T.prev)===$T.next)break;$I=!0}}while($I||$T!==$H);return $H},$M.earcutLinked=function($t,$H,$I,$T,$K,$_,$V){if($t){!$V&&$_&&$M.indexCurve($t,$T,$K,$_);for(var $e,$R,$A=$t;$t.prev!==$t.next;)if($e=$t.prev,$R=$t.next,$_?$M.isEarHashed($t,$T,$K,$_):$M.isEar($t))$H.push($e.i/$I),$H.push($t.i/$I),$H.push($R.i/$I),$M.removeNode($t),$t=$R.next,$A=$R.next;else if(($t=$R)===$A){$V?1===$V?($t=$M.cureLocalIntersections($t,$H,$I),$M.earcutLinked($t,$H,$I,$T,$K,$_,2)):2===$V&&$M.splitEarcut($t,$H,$I,$T,$K,$_):$M.earcutLinked($M.filterPoints($t,null),$H,$I,$T,$K,$_,1);break}}},$M.isEar=function($t){var $H=$t.prev,$I=$t,$T=$t.next;if(0<=$M.area($H,$I,$T))return!1;for(var $K=$t.next.next;$K!==$t.prev;){if($M.pointInTriangle($H.x,$H.y,$I.x,$I.y,$T.x,$T.y,$K.x,$K.y)&&0<=$M.area($K.prev,$K,$K.next))return!1;$K=$K.next}return!0},$M.isEarHashed=function($t,$H,$I,$T){var $K=$t.prev,$_=$t,$V=$t.next;if(0<=$M.area($K,$_,$V))return!1;for(var $e=$K.x<$_.x?$K.x<$V.x?$K.x:$V.x:$_.x<$V.x?$_.x:$V.x,$R=$K.y<$_.y?$K.y<$V.y?$K.y:$V.y:$_.y<$V.y?$_.y:$V.y,$A=$K.x>$_.x?$K.x>$V.x?$K.x:$V.x:$_.x>$V.x?$_.x:$V.x,$q=$K.y>$_.y?$K.y>$V.y?$K.y:$V.y:$_.y>$V.y?$_.y:$V.y,$f=$M.zOrder($e,$R,$H,$I,$T),$b=$M.zOrder($A,$q,$H,$I,$T),$L=$t.nextZ;$L&&$L.z<=$b;){if($L!==$t.prev&&$L!==$t.next&&$M.pointInTriangle($K.x,$K.y,$_.x,$_.y,$V.x,$V.y,$L.x,$L.y)&&0<=$M.area($L.prev,$L,$L.next))return!1;$L=$L.nextZ}for($L=$t.prevZ;$L&&$L.z>=$f;){if($L!==$t.prev&&$L!==$t.next&&$M.pointInTriangle($K.x,$K.y,$_.x,$_.y,$V.x,$V.y,$L.x,$L.y)&&0<=$M.area($L.prev,$L,$L.next))return!1;$L=$L.prevZ}return!0},$M.cureLocalIntersections=function($t,$H,$I){var $T=$t;do{var $K=$T.prev,$_=$T.next.next;!$M.equals($K,$_)&&$M.intersects($K,$T,$T.next,$_)&&$M.locallyInside($K,$_)&&$M.locallyInside($_,$K)&&($H.push($K.i/$I),$H.push($T.i/$I),$H.push($_.i/$I),$M.removeNode($T),$M.removeNode($T.next),$T=$t=$_),$T=$T.next}while($T!==$t);return $T},$M.splitEarcut=function($t,$H,$I,$T,$K,$_){var $V=$t;do{for(var $e=$V.next.next;$e!==$V.prev;){if($V.i!==$e.i&&$M.isValidDiagonal($V,$e)){var $R=$M.splitPolygon($V,$e);return $V=$M.filterPoints($V,$V.next),$R=$M.filterPoints($R,$R.next),$M.earcutLinked($V,$H,$I,$T,$K,$_),void $M.earcutLinked($R,$H,$I,$T,$K,$_)}$e=$e.next}$V=$V.next}while($V!==$t)},$M.eliminateHoles=function($t,$H,$I,$T){var $K,$_,$V,$e,$R,$A=[];for($K=0,$_=$H.length;$K<$_;$K++)$V=$H[$K]*$T,$e=$K<$_-1?$H[$K+1]*$T:$t.length,($R=$M.linkedList($t,$V,$e,$T,!1))===$R.next&&($R.steiner=!0),$A.push($M.getLeftmost($R));for($A.sort($M.compareX),$K=0;$K<$A.length;$K++)$M.eliminateHole($A[$K],$I),$I=$M.filterPoints($I,$I.next);return $I},$M.compareX=function($t,$H){return $t.x-$H.x},$M.eliminateHole=function($t,$H){if($H=$M.findHoleBridge($t,$H)){var $I=$M.splitPolygon($H,$t);$M.filterPoints($I,$I.next)}},$M.findHoleBridge=function($t,$H){var $I,$T=$H,$K=$t.x,$_=$t.y,$V=-1/0;do{if($_<=$T.y&&$_>=$T.next.y&&$T.next.y!==$T.y){var $e=$T.x+($_-$T.y)*($T.next.x-$T.x)/($T.next.y-$T.y);if($e<=$K&&$V<$e){if(($V=$e)===$K){if($_===$T.y)return $T;if($_===$T.next.y)return $T.next}$I=$T.x<$T.next.x?$T:$T.next}}$T=$T.next}while($T!==$H);if(!$I)return null;if($K===$V)return $I.prev;var $R,$A=$I,$q=$I.x,$f=$I.y,$b=1/0;for($T=$I.next;$T!==$A;)$K>=$T.x&&$T.x>=$q&&$K!==$T.x&&$M.pointInTriangle($_<$f?$K:$V,$_,$q,$f,$_<$f?$V:$K,$_,$T.x,$T.y)&&(($R=Math.abs($_-$T.y)/($K-$T.x))<$b||$R===$b&&$T.x>$I.x)&&$M.locallyInside($T,$t)&&($I=$T,$b=$R),$T=$T.next;return $I},$M.indexCurve=function($t,$H,$I,$T){for(var $K=$t;null===$K.z&&($K.z=$M.zOrder($K.x,$K.y,$H,$I,$T)),$K.prevZ=$K.prev,$K.nextZ=$K.next,($K=$K.next)!==$t;);$K.prevZ.nextZ=null,$K.prevZ=null,$M.sortLinked($K)},$M.sortLinked=function($t){var $H,$I,$T,$K,$_,$V,$e,$R,$A=1;do{for($I=$t,$_=$t=null,$V=0;$I;){for($V++,$T=$I,$H=$e=0;$H<$A&&($e++,$T=$T.nextZ);$H++);for($R=$A;0<$e||0<$R&&$T;)0!==$e&&(0===$R||!$T||$I.z<=$T.z)?($I=($K=$I).nextZ,$e--):($T=($K=$T).nextZ,$R--),$_?$_.nextZ=$K:$t=$K,$K.prevZ=$_,$_=$K;$I=$T}$_.nextZ=null,$A*=2}while(1<$V);return $t},$M.zOrder=function($t,$H,$I,$T,$K){return($t=1431655765&(($t=858993459&(($t=252645135&(($t=16711935&(($t=32767*($t-$I)*$K)|$t<<8))|$t<<4))|$t<<2))|$t<<1))|($H=1431655765&(($H=858993459&(($H=252645135&(($H=16711935&(($H=32767*($H-$T)*$K)|$H<<8))|$H<<4))|$H<<2))|$H<<1))<<1},$M.getLeftmost=function($t){for(var $H=$t,$I=$t;$H.x<$I.x&&($I=$H),($H=$H.next)!==$t;);return $I},$M.pointInTriangle=function($t,$H,$I,$T,$K,$_,$V,$e){return 0<=($K-$V)*($H-$e)-($t-$V)*($_-$e)&&0<=($t-$V)*($T-$e)-($I-$V)*($H-$e)&&0<=($I-$V)*($_-$e)-($K-$V)*($T-$e)},$M.isValidDiagonal=function($t,$H){return $t.next.i!==$H.i&&$t.prev.i!==$H.i&&!$M.intersectsPolygon($t,$H)&&$M.locallyInside($t,$H)&&$M.locallyInside($H,$t)&&$M.middleInside($t,$H)},$M.area=function($t,$H,$I){return($H.y-$t.y)*($I.x-$H.x)-($H.x-$t.x)*($I.y-$H.y)},$M.equals=function($t,$H){return $t.x===$H.x&&$t.y===$H.y},$M.intersects=function($t,$H,$I,$T){return!!($M.equals($t,$H)&&$M.equals($I,$T)||$M.equals($t,$T)&&$M.equals($I,$H))||0<$M.area($t,$H,$I)!=0<$M.area($t,$H,$T)&&0<$M.area($I,$T,$t)!=0<$M.area($I,$T,$H)},$M.intersectsPolygon=function($t,$H){var $I=$t;do{if($I.i!==$t.i&&$I.next.i!==$t.i&&$I.i!==$H.i&&$I.next.i!==$H.i&&$M.intersects($I,$I.next,$t,$H))return!0;$I=$I.next}while($I!==$t);return!1},$M.locallyInside=function($t,$H){return $M.area($t.prev,$t,$t.next)<0?0<=$M.area($t,$H,$t.next)&&0<=$M.area($t,$t.prev,$H):$M.area($t,$H,$t.prev)<0||$M.area($t,$t.next,$H)<0},$M.middleInside=function($t,$H){for(var $I=$t,$T=!1,$K=($t.x+$H.x)/2,$_=($t.y+$H.y)/2;$I.y>$_!=$I.next.y>$_&&$I.next.y!==$I.y&&$K<($I.next.x-$I.x)*($_-$I.y)/($I.next.y-$I.y)+$I.x&&($T=!$T),($I=$I.next)!==$t;);return $T},$M.splitPolygon=function($t,$H){var $I=new $Kt($t.i,$t.x,$t.y),$T=new $Kt($H.i,$H.x,$H.y),$K=$t.next,$_=$H.prev;return($t.next=$H).prev=$t,($I.next=$K).prev=$I,($T.next=$I).prev=$T,($_.next=$T).prev=$_,$T},$M.insertNode=function($t,$H,$I,$T){var $K=new $Kt($t,$H,$I);return $T?($K.next=$T.next,($K.prev=$T).next.prev=$K,$T.next=$K):($K.prev=$K).next=$K,$K},$M.removeNode=function($t){$t.next.prev=$t.prev,$t.prev.next=$t.next,$t.prevZ&&($t.prevZ.nextZ=$t.nextZ),$t.nextZ&&($t.nextZ.prevZ=$t.prevZ)},$M.signedArea=function($t,$H,$I,$T){for(var $K=0,$_=$H,$V=$I-$T;$_<$I;$_+=$T)$K+=($t[$V]-$t[$_])*($t[$_+1]+$t[$V+1]),$V=$_;return $K},$M}(),$Kt=function(){function $t($t,$H,$I){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$t,this.x=$H,this.y=$I,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $b($t,"laya.webgl.shapes.EarcutNode"),$t}(),$_t=(function(){function $t($t,$H,$I,$T,$K,$_,$V){this.lineWidth=$t,this.lineColor=$H,this.lineAlpha=$I,this.fillColor=$T,this.fillAlpha=$K,this.shape=$V,this.fill=$_}$b($t,"laya.webgl.shapes.GeometryData");var $H=$t.prototype;$H.clone=function(){return new $t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$H.getIndexData=function(){return null},$H.getVertexData=function(){return null},$H.destroy=function(){this.shape=null}}(),function(){function $t($t){if($t instanceof Float32Array)this.points=$t;else if($t instanceof Array){$t.length;this.points=new Float32Array($t)}}$b($t,"laya.webgl.shapes.Vertex");var $H=$t.prototype;$w.imps($H,{"laya.webgl.shapes.IShape":!0}),$H.getData=function($t,$H,$I){},$H.needUpdate=function($t){return!1},$H.rebuild=function($t){},$H.setMatrix=function($t){}}(),function(){function $R($t){void 0===$t&&($t=1e4),this._renderType=$t}$b($R,"laya.webgl.submit.Submit");var $t=$R.prototype;return $w.imps($t,{"laya.webgl.submit.ISubmit":!0}),$t.releaseRender=function(){var $t=$R._cache;($t[$t._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$t.getRenderType=function(){return this._renderType},$t.renderSubmit=function(){if(0===this._numEle)return 1;var $t=this.shaderValue.textureHost;if($t){var $H=$t.source;if(!$t.bitmap||!$H)return 1;this.shaderValue.texture=$H,$t.alphaTexture&&$t.alphaTexture.source&&(this.shaderValue.texture1=$t.alphaTexture.source)}this._vb.bind_upload(this._ib);var $I=$Ct.mainContext;return this.shaderValue.upload(),$u.activeBlendFunction!==this._blendFn&&($I.enable(3042),this._blendFn($I),$u.activeBlendFunction=this._blendFn),$Y.drawCall++,$Y.trianglesFaces+=this._numEle/3,$I.drawElements(4,this._numEle,5123,this._startIdx),1},$R.__init__=function(){var $t=$R.RENDERBASE=new $R(-1);$t.shaderValue=new $st(0,0),$t.shaderValue.ALPHA=-1234},$R.createSubmit=function($t,$H,$I,$T,$K){var $_=$R._cache._length?$R._cache[--$R._cache._length]:new $R;null==$I&&(($I=$_._selfVb||($_._selfVb=$Zt.create(-1))).clear(),$T=0),$_._ib=$H,$_._vb=$I,$_._startIdx=$T*$Mt.BYTES_PIDX,$_._numEle=0;var $V=$t._nBlendType;$_._blendFn=$t._targets?$u.targetFns[$V]:$u.fns[$V],$_.shaderValue=$K,$_.shaderValue.setValue($t._shader2D);var $e=$t._shader2D.filters;return $e&&$_.shaderValue.setFilters($e),$_},$R.createShape=function($t,$H,$I,$T,$K,$_){var $V=$R._cache._length?$R._cache[--$R._cache._length]:new $R;$V._ib=$H,$V._vb=$I,$V._numEle=$T,$V._startIdx=$K,$V.shaderValue=$_,$V.shaderValue.setValue($t._shader2D);var $e=$t._nBlendType;return $V._blendFn=$t._targets?$u.targetFns[$e]:$u.fns[$e],$V},$R.TYPE_2D=1e4,$R.TYPE_CANVAS=10003,$R.TYPE_CMDSETRT=10004,$R.TYPE_CUSTOM=10005,$R.TYPE_BLURRT=10006,$R.TYPE_CMDDESTORYPRERT=10007,$R.TYPE_DISABLESTENCIL=10008,$R.TYPE_OTHERIBVB=10009,$R.TYPE_PRIMITIVE=10010,$R.TYPE_RT=10011,$R.TYPE_BLUR_RT=10012,$R.TYPE_TARGET=10013,$R.TYPE_CHANGE_VALUE=10014,$R.TYPE_SHAPE=10015,$R.TYPE_TEXTURE=10016,$R.TYPE_FILLTEXTURE=10017,$R.RENDERBASE=null,$R._cache=(($R._cache=[])._length=0,$R._cache),$R}()),$Vt=function(){function $T(){this.fun=null,this.args=null}$b($T,"laya.webgl.submit.SubmitCMD");var $t=$T.prototype;return $w.imps($t,{"laya.webgl.submit.ISubmit":!0}),$t.renderSubmit=function(){return this.fun.apply(null,this.args),1},$t.getRenderType=function(){return 0},$t.releaseRender=function(){var $t=$T._cache;$t[$t._length++]=this},$T.create=function($t,$H){var $I=$T._cache._length?$T._cache[--$T._cache._length]:new $T;return $I.fun=$H,$I.args=$t,$I},$T._cache=(($T._cache=[])._length=0,$T._cache),$T}(),$et=function(){function $H(){this.variables={}}$b($H,"laya.webgl.submit.SubmitCMDScope");var $t=$H.prototype;return $t.getValue=function($t){return this.variables[$t]},$t.addValue=function($t,$H){return this.variables[$t]=$H},$t.setValue=function($t,$H){return this.variables.hasOwnProperty($t)?this.variables[$t]=$H:null},$t.clear=function(){for(var $t in this.variables)delete this.variables[$t]},$t.recycle=function(){this.clear(),$H.POOL.push(this)},$H.create=function(){var $t=$H.POOL.pop();return $t||($t=new $H),$t},$H.POOL=[],$H}(),$Rt=function(){function $f(){this.offset=0,this.startIndex=0,this._mat=$z.create()}$b($f,"laya.webgl.submit.SubmitOtherIBVB");var $t=$f.prototype;return $w.imps($t,{"laya.webgl.submit.ISubmit":!0}),$t.releaseRender=function(){var $t=$f._cache;($t[$t._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$t.getRenderType=function(){return 10009},$t.renderSubmit=function(){var $t=this._shaderValue.textureHost;if($t){var $H=$t.source;if(!$t.bitmap||!$H)return 1;this._shaderValue.texture=$H}this._vb.bind_upload(this._ib);var $I=$St.worldMatrix4,$T=$z.TEMP;$z.mulPre(this._mat,$I[0],$I[1],$I[4],$I[5],$I[12],$I[13],$T);var $K=$St.worldMatrix4=$f.tempMatrix4;$K[0]=$T.a,$K[1]=$T.b,$K[4]=$T.c,$K[5]=$T.d,$K[12]=$T.tx,$K[13]=$T.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $_=$Ct.mainContext;return $u.activeBlendFunction!==this._blendFn&&($_.enable(3042),this._blendFn($_),$u.activeBlendFunction=this._blendFn),$Y.drawCall++,$Y.trianglesFaces+=this._numEle/3,$_.drawElements(4,this._numEle,5123,this.startIndex),$St.worldMatrix4=$I,$vt.activeShader=null,1},$f.create=function($t,$H,$I,$T,$K,$_,$V,$e,$R){void 0===$R&&($R=0);var $A=$f._cache._length?$f._cache[--$f._cache._length]:new $f;$A._ib=$I,$A._vb=$H,$A._numEle=$T,$A._shader=$K,$A._shaderValue=$_;var $q=$t._nBlendType;switch($A._blendFn=$t._targets?$u.targetFns[$q]:$u.fns[$q],$R){case 0:$A.offset=0,$A.startIndex=$e/($Mt.BYTES_PE*$H.vertexStride)*1.5,$A.startIndex*=$Mt.BYTES_PIDX;break;case 1:$A.startIndex=$V,$A.offset=$e}return $A},$f._cache=(($f._cache=[])._length=0,$f._cache),$f.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$f}(),$At=function(){function $I(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $k,this.screenRect=new $k}$b($I,"laya.webgl.submit.SubmitScissor");var $t=$I.prototype;return $w.imps($t,{"laya.webgl.submit.ISubmit":!0}),$t._scissor=function($t,$H,$I,$T){var $K=$St.worldMatrix4,$_=$K[0],$V=$K[5],$e=$K[12],$R=$K[13];if($T*=$V,($I*=$_)<1||$T<1)return!1;var $A=($t=$t*$_+$e)+$I,$q=($H=$H*$V+$R)+$T;$t<0&&($I=$A-($t=0)),$H<0&&($T=$q-($H=0));var $f=$St.worldClipRect;if($t=Math.max($t,$f.x),$H=Math.max($H,$f.y),$I=Math.min($A,$f.right)-$t,$T=Math.min($q,$f.bottom)-$H,$I<1||$T<1)return!1;var $b=$St.worldScissorTest;return this.screenRect.copyFrom($f),$f.x=$t,$f.y=$H,$f.width=$I,$f.height=$T,$St.worldScissorTest=!0,$H=$St.height-$H-$T,$Ct.mainContext.scissor($t,$H,$I,$T),$Ct.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$b?($H=$St.height-this.screenRect.y-this.screenRect.height,$Ct.mainContext.scissor(this.screenRect.x,$H,this.screenRect.width,this.screenRect.height),$Ct.mainContext.enable(3089)):($Ct.mainContext.disable(3089),$St.worldScissorTest=!1),$f.copyFrom(this.screenRect),!0},$t._scissorWithTagart=function($t,$H,$I,$T){if($I<1||$T<1)return!1;var $K=$t+$I,$_=$H+$T;$t<0&&($I=$K-($t=0)),$H<0&&($T=$_-($H=0));var $V=$St.worldClipRect;if($t=Math.max($t,$V.x),$H=Math.max($H,$V.y),$I=Math.min($K,$V.right)-$t,$T=Math.min($_,$V.bottom)-$H,$I<1||$T<1)return!1;var $e=$St.worldScissorTest;return this.screenRect.copyFrom($V),$St.worldScissorTest=!0,$V.x=$t,$V.y=$H,$V.width=$I,$V.height=$T,$H=$St.height-$H-$T,$Ct.mainContext.scissor($t,$H,$I,$T),$Ct.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$e?($H=$St.height-this.screenRect.y-this.screenRect.height,$Ct.mainContext.scissor(this.screenRect.x,$H,this.screenRect.width,this.screenRect.height),$Ct.mainContext.enable(3089)):($Ct.mainContext.disable(3089),$St.worldScissorTest=!1),$V.copyFrom(this.screenRect),!0},$t.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$t.getRenderType=function(){return 0},$t.releaseRender=function(){var $t=$I._cache;($t[$t._length++]=this).context=null},$I.create=function($t){var $H=$I._cache._length?$I._cache[--$I._cache._length]:new $I;return $H.context=$t,$H},$I._cache=(($I._cache=[])._length=0,$I._cache),$I}(),$qt=function(){function $R(){this.step=0,this.blendMode=null,this.level=0}$b($R,"laya.webgl.submit.SubmitStencil");var $t=$R.prototype;return $w.imps($t,{"laya.webgl.submit.ISubmit":!0}),$t.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$t.getRenderType=function(){return 0},$t.releaseRender=function(){var $t=$R._cache;$t[$t._length++]=this},$t.do1=function(){var $t=$Ct.mainContext;$t.enable(2960),$t.clear(1024),$t.colorMask(!1,!1,!1,!1),$t.stencilFunc(514,this.level,255),$t.stencilOp(7680,7680,7682)},$t.do2=function(){var $t=$Ct.mainContext;$t.stencilFunc(514,this.level+1,255),$t.colorMask(!0,!0,!0,!0),$t.stencilOp(7680,7680,7680)},$t.do3=function(){var $t=$Ct.mainContext;$t.colorMask(!0,!0,!0,!0),$t.stencilOp(7680,7680,7680),$t.clear(1024),$t.disable(2960)},$t.do4=function(){var $t=$Ct.mainContext;0==this.level&&($t.enable(2960),$t.clear(1024)),$t.colorMask(!1,!1,!1,!1),$t.stencilFunc(519,0,255),$t.stencilOp(7680,7680,7682)},$t.do5=function(){var $t=$Ct.mainContext;$t.stencilFunc(514,this.level,255),$t.colorMask(!0,!0,!0,!0),$t.stencilOp(7680,7680,7680)},$t.do6=function(){var $t=$Ct.mainContext;$u.targetFns[$u.TOINT[this.blendMode]]($t)},$t.do7=function(){var $t=$Ct.mainContext;$t.colorMask(!1,!1,!1,!1),$t.stencilOp(7680,7680,7683)},$t.do8=function(){var $t=$Ct.mainContext;$t.colorMask(!0,!0,!0,!0),$t.stencilFunc(514,this.level,255),$t.stencilOp(7680,7680,7680)},$R.restore=function($t,$H,$I,$T,$K){var $_;if(($t._renderKey=0)<$R._mask&&$R._mask--,0==$R._mask)$_=laya.webgl.submit.SubmitStencil.create(3),$t.addRenderObject($_),$t._curSubmit=$_t.RENDERBASE;else{$_=laya.webgl.submit.SubmitStencil.create(7),$t.addRenderObject($_);var $V=$t._vb;$V._byteLength;if($Ot.fillRectImgVb($V,null,$H.x,$H.y,$H.width,$H.height,$l.DEF_UV,$I,$T,$K,0,0)){$t._shader2D.glTexture=null;var $e=$t._curSubmit=$_t.createSubmit($t,$t._ib,$V,($V._byteLength-64)/32*3,$st.create(2,0));$e.shaderValue.ALPHA=1,$t._submits[$t._submits._length++]=$e,$t._curSubmit._numEle+=6,$t._curSubmit=$_t.RENDERBASE}else alert("clipRect calc stencil rect error");$_=laya.webgl.submit.SubmitStencil.create(8),$t.addRenderObject($_)}},$R.restore2=function($t,$H){var $I;($t._renderKey=0)<$R._mask&&$R._mask--,0==$R._mask?($I=laya.webgl.submit.SubmitStencil.create(3),$t.addRenderObject($I),$t._curSubmit=$_t.RENDERBASE):($I=laya.webgl.submit.SubmitStencil.create(7),$t.addRenderObject($I),$t._submits[$t._submits._length++]=$H,$I=laya.webgl.submit.SubmitStencil.create(8),$t.addRenderObject($I))},$R.create=function($t){var $H=$R._cache._length?$R._cache[--$R._cache._length]:new $R;return 5==($H.step=$t)&&++$R._mask,$H.level=$R._mask,$H},$R._cache=(($R._cache=[])._length=0,$R._cache),$R._mask=0,$R}(),$ft=function(){function $e(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$b($e,"laya.webgl.submit.SubmitTarget");var $t=$e.prototype;return $w.imps($t,{"laya.webgl.submit.ISubmit":!0}),$t.renderSubmit=function(){this._vb.bind_upload(this._ib);var $t=this.scope.getValue(this.proName);return $t&&(this.shaderValue.texture=$t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$t.width,$t.height]),this.shaderValue.upload(),this.blend(),$Y.drawCall++,$Y.trianglesFaces+=this._numEle/3,$Ct.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$t.blend=function(){if($u.activeBlendFunction!==$u.fns[this.blendType]){var $t=$Ct.mainContext;$t.enable(3042),$u.fns[this.blendType]($t),$u.activeBlendFunction=$u.fns[this.blendType]}},$t.getRenderType=function(){return 0},$t.releaseRender=function(){var $t=$e._cache;($t[$t._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$e.create=function($t,$H,$I,$T,$K,$_){var $V=$e._cache._length?$e._cache[--$e._cache._length]:new $e;return $V._ib=$H,$V._vb=$I,$V.proName=$_,$V._startIdx=$T*$Mt.BYTES_PIDX,$V._numEle=0,$V.blendType=$t._nBlendType,$V.shaderValue=$K,$V.shaderValue.setValue($t._shader2D),$V},$e._cache=(($e._cache=[])._length=0,$e._cache),$e}(),$bt=function(){function $t(){this._sourceStr=null}$b($t,"laya.webgl.text.CharSegment");var $H=$t.prototype;return $w.imps($H,{"laya.webgl.text.ICharSegment":!0}),$H.textToSpit=function($t){this._sourceStr=$t},$H.getChar=function($t){return this._sourceStr.charAt($t)},$H.getCharCode=function($t){return this._sourceStr.charCodeAt($t)},$H.length=function(){return this._sourceStr.length},$t}(),$Lt=function(){var $t;function $Y(){}return $b($Y,"laya.webgl.text.DrawText"),$Y.__init__=function(){$Y._charsTemp=new Array,$Y._drawValue=new $t,$Y._charSeg=new $bt},$Y.customCharSeg=function($t){$Y._charSeg=$t},$Y.getChar=function($t,$H,$I){var $T=$mt.createOneChar($t,$I);return-1!=$H&&($Y._charsCache[$H]=$T),$T},$Y._drawSlow=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f,$b,$L,$G){var $M,$O,$J=$Y._drawValue.value($_,$e,$R,$A,$b,$L,$G),$S=0,$U=0,$C=$Y._charsTemp,$N=0,$w=NaN;if($T)for($C.length=$T.length,$S=0,$U=$T.length;$S<$U;$S++)($O=$T[$S])&&($w=$O.charNum+$J.txtID,$C[$S]=$M=$Y._charsCache[$w]||$Y.getChar($O.char,$w,$J),$M.active());else{var $W=$I instanceof laya.utils.WordText?$I.toString():$I;if($g.CharacterCache){$Y._charSeg.textToSpit($W);var $s=$Y._charSeg.length();for($S=0,$U=$C.length=$s;$S<$U;$S++)$w=$Y._charSeg.getCharCode($S)+$J.txtID,$C[$S]=$M=$Y._charsCache[$w]||$Y.getChar($Y._charSeg.getChar($S),$w,$J),$M.active(),$N+=$M.cw}else $C.length=0,($M=$Y.getChar($W,-1,$J)).active(),$N+=$M.cw,$C[0]=$M}var $z=0;null!==$V&&"left"!==$V&&($z=-("center"==$V?$N/2:$N));var $P,$k,$r=NaN,$x=0;if($T)for($S=0,$U=$C.length;$S<$U;$S++)$M=$C[$S],$O=$T[$S],$M&&$O&&!$M.isSpace&&($r=$M.borderSize,$P=$M.texture,$H._drawText($P,$q+$z+$O.x*$b-$r,$f+$O.y*$L-$r,$P.width,$P.height,$K,0,0,0,0));else{for($S=0,$U=$C.length;$S<$U;$S++)($M=$C[$S])&&!$M.isSpace&&($r=$M.borderSize,$P=$M.texture,$H._drawText($P,$q+$z-$r,$f-$r,$P.width,$P.height,$K,0,0,0,0),$t&&(($k=$t[$x++])||($k=$t[$x-1]=[]),$k[0]=$P,$k[1]=$z-$r,$k[2]=-$r)),$z+=$M.cw;$t&&($t.length=$x)}},$Y._drawFast=function($t,$H,$I,$T,$K){for(var $_,$V,$e=0,$R=$t.length;$e<$R;$e++)($_=($V=$t[$e])[0]).active(),$H._drawText($_,$T+$V[1],$K+$V[2],$_.width,$_.height,$I,0,0,0,0)},$Y.drawText=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f){if(void 0===$f&&($f=0),!($H&&0===$H.length||$I&&0===$I.length)){var $b=$T.a,$L=$T.d;(0!==$T.b||0!==$T.c)&&($b=$L=1);var $G=1!==$b||1!==$L;if($G&&$w.stage.transform){var $M=$w.stage.transform;$G=$M.a===$b&&$M.d===$L}else $G=!1;if($G){var $O=($T=$T.copyTo($Wt._tmpMatrix)).tx,$J=$T.ty;$T.scale(1/$b,1/$L),$T._checkTransform(),$A*=$b,$q*=$L,$A+=$O-$T.tx,$q+=$J-$T.ty}else $b=$L=1;if($I)$Y._drawSlow(null,$t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$b,$L,$f);else{if(null===$H.toUpperCase){var $S=$b+1e5*$L,$U=$H;return void($U.changed||$U.id!==$S?($U.id=$S,$U.changed=!1,$Y._drawSlow($U.save,$t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$b,$L,$f)):$Y._drawFast($U.save,$t,$T,$A,$q))}var $C=$H+$K.toString()+$V+$e+$R+$b+$L+$_,$N=$Y._textsCache[$C];$g.CharacterCache?$N?$Y._drawFast($N,$t,$T,$A,$q):($Y._textsCache.__length||($Y._textsCache.__length=0),$Y._textsCache.__length>$W.WebGLTextCacheCount&&(($Y._textsCache={}).__length=0,$Y._curPoolIndex=0),$Y._textCachesPool[$Y._curPoolIndex]?($N=$Y._textsCache[$C]=$Y._textCachesPool[$Y._curPoolIndex]).length=0:$Y._textCachesPool[$Y._curPoolIndex]=$N=$Y._textsCache[$C]=[],$Y._textsCache.__length++,$Y._curPoolIndex++,$Y._drawSlow($N,$t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$b,$L,$f)):$Y._drawSlow($N,$t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$b,$L,$f)}}},$Y._charsTemp=null,$Y._textCachesPool=[],$Y._curPoolIndex=0,$Y._charsCache={},$Y._textsCache={},$Y._drawValue=null,$Y.d=[],$Y._charSeg=null,$Y.__init$=function(){$t=function(){function $R(){}return $b($R,""),$R.prototype.value=function($t,$H,$I,$T,$K,$_,$V){this.font=$t,this.fillColor=$H,this.borderColor=$I,this.lineWidth=$T,this.scaleX=$K,this.scaleY=$_,this.underLine=$V;var $e=$t.toString()+$K+$_+$T+($H?$H.toLowerCase():" ")+($I?$I.toLowerCase():" ")+$V;return this.txtID=$R._keymap[$e],this.txtID||(this.txtID=1e-7*++$R._keymapCount,$R._keymap[$e]=this.txtID),this},$R.clear=function(){$R._keymap={},$R._keymapCount=1},$R._keymap={},$R._keymapCount=1,$R}()},$Y}(),$Gt=function(){function $K($t){this._index=0,this._size=14,this._italic=-2,$K._cache2=$K._cache2||[],this.setFont($t||"14px Arial")}$b($K,"laya.webgl.text.FontInContext");var $t=$K.prototype;return $t.setFont=function($t){var $H=$K._cache2[$t];if($H)this._words=$H[0],this._size=$H[1];else{this._words=$t.split(" ");for(var $I=0,$T=this._words.length;$I<$T;$I++)if(0<this._words[$I].indexOf("px")){this._index=$I;break}this._size=parseInt(this._words[this._index]),$K._cache2[$t]=[this._words,this._size]}this._text=null,this._italic=-2},$t.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$t.hasType=function($t){for(var $H=0,$I=this._words.length;$H<$I;$H++)if(this._words[$H]===$t)return $H;return-1},$t.removeType=function($t){for(var $H=0,$I=this._words.length;$H<$I;$H++)if(this._words[$H]===$t){this._words.splice($H,1),this._index>$H&&this._index--;break}this._text=null,this._italic=-2},$t.copyTo=function($t){return $t._text=this._text,$t._size=this._size,$t._index=this._index,$t._words=this._words.slice(),$t._italic=-2,$t},$t.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$T(0,$t,"size",function(){return this._size},function($t){this._size=$t,this._words[this._index]=$t+"px",this._text=null}),$K.create=function($t){var $H=$K._cache[$t];return $H||($H=$K._cache[$t]=new $K($t))},$K.EMPTY=new $K,$K._cache={},$K._cache2=null,$K}(),$Mt=function(){function $t(){}return $b($t,"laya.webgl.utils.CONST3D2D"),$t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$t._TMPARRAY=[],$t._OFFSETX=0,$t._OFFSETY=0,$V($t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$t}(),$Ot=function(){function $G(){}return $b($G,"laya.webgl.utils.GlUtils"),$G.make2DProjection=function($t,$H,$I){return[2/$t,0,0,0,0,-2/$H,0,0,0,0,2/$I,0,-1,1,0,1]},$G.fillIBQuadrangle=function($t,$H){if(65535/4<$H)throw Error("IBQuadrangle count:"+$H+" must<:"+Math.floor(65535/4));$H=Math.floor($H),$t._resizeBuffer(6*($H+1)*2,!1),$t.byteLength=$t.bufferLength;for(var $I=$t.getUint16Array(),$T=0,$K=0;$K<$H;$K++)$I[$T++]=4*$K,$I[$T++]=4*$K+2,$I[$T++]=4*$K+1,$I[$T++]=4*$K,$I[$T++]=4*$K+3,$I[$T++]=4*$K+2;return $t.setNeedUpload(),!0},$G.expandIBQuadrangle=function($t,$H){$t.bufferLength>=6*$H*2||$G.fillIBQuadrangle($t,$H)},$G.mathCeilPowerOfTwo=function($t){return $t--,$t|=$t>>1,$t|=$t>>2,$t|=$t>>4,$t|=$t>>8,$t|=$t>>16,++$t},$G.fillQuadrangleImgVb=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=16+($t._byteLength>>2);$t.byteLength=$R<<2;var $A=$t.getFloat32Array();$A[($R-=16)+2]=$K[0],$A[$R+3]=$K[1],$A[$R+6]=$K[2],$A[$R+7]=$K[3],$A[$R+10]=$K[4],$A[$R+11]=$K[5],$A[$R+14]=$K[6],$A[$R+15]=$K[7];var $q=$_.a,$f=$_.b,$b=$_.c,$L=$_.d;if(1!==$q||0!==$f||0!==$b||1!==$L){$_.bTransform=!0;var $G=$_.tx+$V,$M=$_.ty+$e;$A[$R]=($T[0]+$H)*$q+($T[1]+$I)*$b+$G,$A[$R+1]=($T[0]+$H)*$f+($T[1]+$I)*$L+$M,$A[$R+4]=($T[2]+$H)*$q+($T[3]+$I)*$b+$G,$A[$R+5]=($T[2]+$H)*$f+($T[3]+$I)*$L+$M,$A[$R+8]=($T[4]+$H)*$q+($T[5]+$I)*$b+$G,$A[$R+9]=($T[4]+$H)*$f+($T[5]+$I)*$L+$M,$A[$R+12]=($T[6]+$H)*$q+($T[7]+$I)*$b+$G,$A[$R+13]=($T[6]+$H)*$f+($T[7]+$I)*$L+$M}else $_.bTransform=!1,$H+=$_.tx+$V,$I+=$_.ty+$e,$A[$R]=$H+$T[0],$A[$R+1]=$I+$T[1],$A[$R+4]=$H+$T[2],$A[$R+5]=$I+$T[3],$A[$R+8]=$H+$T[4],$A[$R+9]=$I+$T[5],$A[$R+12]=$H+$T[6],$A[$R+13]=$I+$T[7];return $t._upload=!0},$G.fillTranglesVB=function($t,$H,$I,$T,$K,$_,$V){var $e=($t._byteLength>>2)+$T.length;$t.byteLength=$e<<2;var $R=$t.getFloat32Array();$e-=$T.length;for(var $A=$T.length,$q=$K.a,$f=$K.b,$b=$K.c,$L=$K.d,$G=0;$G<$A;$G+=4)if($R[$e+$G+2]=$T[$G+2],$R[$e+$G+3]=$T[$G+3],1!==$q||0!==$f||0!==$b||1!==$L){$K.bTransform=!0;var $M=$K.tx+$_,$O=$K.ty+$V;$R[$e+$G]=($T[$G]+$H)*$q+($T[$G+1]+$I)*$b+$M,$R[$e+$G+1]=($T[$G]+$H)*$f+($T[$G+1]+$I)*$L+$O}else $K.bTransform=!1,$H+=$K.tx+$_,$I+=$K.ty+$V,$R[$e+$G]=$H+$T[$G],$R[$e+$G+1]=$I+$T[$G+1];return $t._upload=!0},$G.copyPreImgVb=function($t,$H,$I){var $T=$t._byteLength>>2;$t.byteLength=$T+16<<2;for(var $K=$t.getFloat32Array(),$_=0,$V=$T-16;$_<4;$_++)$K[$T]=$K[$V]+$H,++$V,$K[++$T]=$K[$V]+$I,++$V,$K[++$T]=$K[$V],++$V,$K[++$T]=$K[$V],++$T,++$V;$t._upload=!0},$G.fillRectImgVb=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f,$b){void 0===$b&&($b=!1);var $L,$G,$M,$O,$J,$S,$U,$C,$N,$w,$W,$s,$z,$P,$k,$r,$x=1,$Y=$e.a,$D=$e.b,$p=$e.c,$g=$e.d,$l=$H&&$H.width<99999999;if(1!==$Y||0!==$D||0!==$p||1!==$g?($e.bTransform=!0,0===$D&&0===$p&&($x=23,$N=$K+$I,$w=$_+$T,$L=$Y*$I+($W=$e.tx+$R),$M=$Y*$N+$W,$G=$g*$T+($s=$e.ty+$A),$O=$g*$w+$s)):($x=23,$e.bTransform=!1,$M=($L=$I+$e.tx+$R)+$K,$O=($G=$T+$e.ty+$A)+$_),$l&&($J=$H.x,$S=$H.y,$U=$H.width+$J,$C=$H.height+$S),1!==$x){if(Math.min($L,$M)>=$U)return!1;if(Math.min($G,$O)>=$C)return!1;if(Math.max($M,$L)<=$J)return!1;if(Math.max($O,$G)<=$S)return!1}var $v=$t._byteLength>>2;$t.byteLength=16+$v<<2;var $y=$t.getFloat32Array();switch($y[2+$v]=$V[0],$y[3+$v]=$V[1],$y[6+$v]=$V[2],$y[7+$v]=$V[3],$y[10+$v]=$V[4],$y[11+$v]=$V[5],$y[14+$v]=$V[6],$y[15+$v]=$V[7],$x){case 1:$W=$e.tx+$R,$s=$e.ty+$A;var $E=$Y*$I,$h=$p*$T,$X=$g*$T,$B=$D*$I,$a=$Y*($N=$K+$I),$u=$p*($w=$_+$T),$$=$g*$w,$Q=$D*$N;$b?($z=$E+$h+$W,$k=Math.round($z)-$z,$P=$X+$B+$s,$r=Math.round($P)-$P,$y[$v]=$z+$k,$y[1+$v]=$P+$r,$y[4+$v]=$a+$h+$W+$k,$y[5+$v]=$X+$Q+$s+$r,$y[8+$v]=$a+$u+$W+$k,$y[9+$v]=$$+$Q+$s+$r,$y[12+$v]=$E+$u+$W+$k,$y[13+$v]=$$+$B+$s+$r):($y[$v]=$E+$h+$W,$y[1+$v]=$X+$B+$s,$y[4+$v]=$a+$h+$W,$y[5+$v]=$X+$Q+$s,$y[8+$v]=$a+$u+$W,$y[9+$v]=$$+$Q+$s,$y[12+$v]=$E+$u+$W,$y[13+$v]=$$+$B+$s);break;case 23:$b?($z=$L+$q,$k=Math.round($z)-$z,$P=$G,$r=Math.round($P)-$P,$y[$v]=$z+$k,$y[1+$v]=$P+$r,$y[4+$v]=$M+$q+$k,$y[5+$v]=$G+$r,$y[8+$v]=$M+$k,$y[9+$v]=$O+$r,$y[12+$v]=$L+$k,$y[13+$v]=$O+$r):($y[$v]=$L+$q,$y[1+$v]=$G,$y[4+$v]=$M+$q,$y[5+$v]=$G,$y[8+$v]=$M,$y[9+$v]=$O,$y[12+$v]=$L,$y[13+$v]=$O)}return $t._upload=!0},$G.fillLineVb=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=.5*$V,$A=$G._fillLineArray,$q=-($T-$_),$f=$I-$K,$b=Math.sqrt($q*$q+$f*$f);$q/=$b,$f/=$b,$q*=$R,$f*=$R,$A[0]=$I-$q,$A[1]=$T-$f,$A[4]=$I+$q,$A[5]=$T+$f,$A[8]=$K+$q,$A[9]=$_+$f,$A[12]=$K-$q,$A[13]=$_-$f,$e&&$e.transformPointArray($A,$A);var $L=16+($t._byteLength>>2);return $t.byteLength=$L<<2,$t.insertData($A,$L-16),!0},$G._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$G}(),$Jt=(function(){function $R(){}$b($R,"laya.webgl.utils.MatirxArray"),$R.ArrayMul=function($t,$H,$I){if($t)if($H)for(var $T=NaN,$K=NaN,$_=NaN,$V=NaN,$e=0;$e<4;$e++)$T=$t[$e],$K=$t[$e+4],$_=$t[$e+8],$V=$t[$e+12],$I[$e]=$T*$H[0]+$K*$H[1]+$_*$H[2]+$V*$H[3],$I[$e+4]=$T*$H[4]+$K*$H[5]+$_*$H[6]+$V*$H[7],$I[$e+8]=$T*$H[8]+$K*$H[9]+$_*$H[10]+$V*$H[11],$I[$e+12]=$T*$H[12]+$K*$H[13]+$_*$H[14]+$V*$H[15];else $R.copyArray($t,$I);else $R.copyArray($H,$I)},$R.copyArray=function($t,$H){if($t&&$H)for(var $I=0;$I<$t.length;$I++)$H[$I]=$t[$I]}}(),function(){function $H($t,$H,$I){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$t,this._vb=new $Zt($t,35048),$H&&this._vb._resizeBuffer($H,!1),this._ib=new $dt,$I&&this._ib._resizeBuffer($I,!1)}$b($H,"laya.webgl.utils.Mesh2D");var $t=$H.prototype;return $t.cloneWithNewVB=function(){var $t=new $H(this._stride,0,0);return $t._ib=this._ib,$t._quadNum=this._quadNum,$t._attribInfo=this._attribInfo,$t},$t.cloneWithNewVBIB=function(){var $t=new $H(this._stride,0,0);return $t._attribInfo=this._attribInfo,$t},$t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$t.getVBR=function(){return this._vb},$t.getIBR=function(){return this._ib},$t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$t.createQuadIB=function($t){this._quadNum=$t,this._ib._resizeBuffer(6*$t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $H=this._ib.getUint16Array(),$I=0,$T=0,$K=0;$K<$t;$K++)$H[$I++]=$T,$H[$I++]=$T+2,$H[$I++]=$T+1,$H[$I++]=$T,$H[$I++]=$T+3,$H[$I++]=$T+2,$T+=4;this._ib.setNeedUpload()},$t.setAttributes=function($t){if(this._attribInfo=$t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$t.releaseMesh=function(){},$t.destroy=function(){},$t.clearVB=function(){this._vb.clear()},$H._gvaoid=0,$H}()),$St=function(){function $K(){}return $b($K,"laya.webgl.utils.RenderState2D"),$K.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$K.mat2MatArray=function($t,$H){var $I=$t,$T=$H;return $T[0]=$I.a,$T[1]=$I.b,$T[2]=$K.EMPTYMAT4_ARRAY[2],$T[3]=$K.EMPTYMAT4_ARRAY[3],$T[4]=$I.c,$T[5]=$I.d,$T[6]=$K.EMPTYMAT4_ARRAY[6],$T[7]=$K.EMPTYMAT4_ARRAY[7],$T[8]=$K.EMPTYMAT4_ARRAY[8],$T[9]=$K.EMPTYMAT4_ARRAY[9],$T[10]=$K.EMPTYMAT4_ARRAY[10],$T[11]=$K.EMPTYMAT4_ARRAY[11],$T[12]=$I.tx,$T[13]=$I.ty,$T[14]=$K.EMPTYMAT4_ARRAY[14],$T[15]=$K.EMPTYMAT4_ARRAY[15],$H},$K.restoreTempArray=function(){$K.TEMPMAT4_ARRAY[0]=1,$K.TEMPMAT4_ARRAY[1]=0,$K.TEMPMAT4_ARRAY[4]=0,$K.TEMPMAT4_ARRAY[5]=1,$K.TEMPMAT4_ARRAY[12]=0,$K.TEMPMAT4_ARRAY[13]=0},$K.clear=function(){$K.worldScissorTest=!1,$K.worldShaderDefines=null,$K.worldFilters=null,$K.worldAlpha=1,$K.worldClipRect.x=$K.worldClipRect.y=0,$K.worldClipRect.width=$K.width,$K.worldClipRect.height=$K.height,$K.curRenderTarget=null},$K._MAXSIZE=99999999,$K.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$K.worldMatrix4=$K.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$K.worldAlpha=1,$K.worldScissorTest=!1,$K.worldFilters=null,$K.worldShaderDefines=null,$K.curRenderTarget=null,$K.width=0,$K.height=0,$V($K,["worldMatrix",function(){return this.worldMatrix=new $z},"worldClipRect",function(){return this.worldClipRect=new $k(0,0,99999999,99999999)}]),$K}(),$Ut=function(){var $S,$I;function $U($t,$H,$I,$T,$K){var $_=this;function $V($t){var $H=[],$I=new $S($H);return $_._compileToTree($I,$t.split("\n"),0,$H,$K),$I}var $e=$L.now();this._VS=$V($H),this._PS=$V($I),this._nameMap=$T,2<$L.now()-$e&&console.log("ShaderCompile use time:"+($L.now()-$e)+"  size:"+$H.length+"/"+$I.length)}$b($U,"laya.webgl.utils.ShaderCompile");var $t=$U.prototype;return $t._compileToTree=function($t,$H,$I,$T,$K){var $_,$V,$e,$R,$A,$q,$f,$b=0,$L=0,$G=0,$M=0;for($L=$I;$L<$H.length;$L++)if(!(($e=$H[$L]).length<1)&&0!==($b=$e.indexOf("//"))){if(0<=$b&&($e=$e.substr(0,$b)),$_=$f||new $S($T),$f=null,$_.text=$e,$_.noCompile=!0,0<=($b=$e.indexOf("#"))){for($R="#",$M=$b+1,$G=$e.length;$M<$G;$M++){var $O=$e.charAt($M);if(" "===$O||"\t"===$O||"\r"===$O||"\n"===$O||"?"===$O)break;$R+=$O}switch($_.name=$R){case"#ifdef":case"#ifndef":if($_.src=$e,$_.noCompile=null!=$e.match(/[!&|()=<>]/),$_.noCompile?console.log("function():Boolean{return "+$e.substr($b+$_.name.length)+"}"):($q=$e.replace(/^\s*/,"").split(/\s+/),$_.setCondition($q[1],"#ifdef"===$R?1:2),$_.text="//"+$_.text),$_.setParent($t),$t=$_,$K)for($q=$e.substr($M).split($U._splitToWordExps3),$M=0;$M<$q.length;$M++)($e=$q[$M]).length&&($K[$e]=!0);continue;case"#if":if($_.src=$e,$_.noCompile=!0,$_.setParent($t),$t=$_,$K)for($q=$e.substr($M).split($U._splitToWordExps3),$M=0;$M<$q.length;$M++)($e=$q[$M]).length&&"defined"!=$e&&($K[$e]=!0);continue;case"#else":$_.src=$e,$V=($t=$t.parent).childs[$t.childs.length-1],$_.noCompile=$V.noCompile,$_.noCompile||($_.condition=$V.condition,$_.conditionType=1==$V.conditionType?2:1,$_.text="//"+$_.text+" "+$V.text+" "+$_.conditionType),$_.setParent($t),$t=$_;continue;case"#endif":$V=($t=$t.parent).childs[$t.childs.length-1],$_.noCompile=$V.noCompile,$_.noCompile||($_.text="//"+$_.text),$_.setParent($t);continue;case"#include":$q=$U.splitToWords($e,null);var $J=$U.includes[$q[1]];if(!$J)throw"ShaderCompile error no this include file:"+$q[1];if(($b=$q[0].indexOf("?"))<0){$_.setParent($t),$e=$J.getWith("with"==$q[2]?$q[3]:null),this._compileToTree($_,$e.split("\n"),0,$T,$K),$_.text="";continue}$_.setCondition($q[0].substr($b+1),1),$_.text=$J.getWith("with"==$q[2]?$q[3]:null);break;case"#import":$A=($q=$U.splitToWords($e,null))[1],$T.push({node:$_,file:$U.includes[$A],ofs:$_.text.length});continue}}else{if(($V=$t.childs[$t.childs.length-1])&&!$V.name){0<$T.length&&$U.splitToWords($e,$V),$f=$_,$V.text+="\n"+$e;continue}0<$T.length&&$U.splitToWords($e,$_)}$_.setParent($t)}},$t.createShader=function($t,$H,$I){var $T={},$K="";if($t)for(var $_ in $t)$K+="#define "+$_+"\n",$T[$_]=!0;var $V=this._VS.toscript($T,[]),$e=this._PS.toscript($T,[]);return($I||$Ft.create)($K+$V.join("\n"),$K+$e.join("\n"),$H,this._nameMap)},$U._parseOne=function($t,$H,$I,$T,$K,$_){var $V={type:$U.shaderParamsMap[$I[$T+1]],name:$I[$T+2],size:isNaN(parseInt($I[$T+3]))?1:parseInt($I[$T+3])};return $_&&("attribute"==$K?$t.push($V):$H.push($V)),":"==$I[$T+3]&&($V.type=$I[$T+4],$T+=2),$T+=2},$U.addInclude=function($t,$H){if(!$H||0===$H.length)throw new Error("add shader include file err:"+$t);if($U.includes[$t])throw new Error("add shader include file err, has add:"+$t);$U.includes[$t]=new $I($H)},$U.preGetParams=function($t,$H){var $I=[$t,$H],$T={},$K=[],$_=[],$V={},$e=[];$T.attributes=$K,$T.uniforms=$_,$T.defines=$V;for(var $R=0,$A=0,$q=0;$q<2;$q++){$I[$q]=$I[$q].replace($U._removeAnnotation,"");var $f,$b=$I[$q].match($U._reg);for($R=0,$A=$b.length;$R<$A;$R++){var $L=$b[$R];if("attribute"==$L||"uniform"==$L)$R=$U._parseOne($K,$_,$b,$R,$L,!0);else{if("#define"==$L){$e[$L=$b[++$R]]=1;continue}if("#ifdef"==$L){$V[$f=$b[++$R]]=$V[$f]||[];for($R++;$R<$A;$R++)if("attribute"==($L=$b[$R])||"uniform"==$L)$R=$U._parseOne($K,$_,$b,$R,$L,$e[$f]);else if("#else"==$L)for($R++;$R<$A;$R++)if("attribute"==($L=$b[$R])||"uniform"==$L)$R=$U._parseOne($K,$_,$b,$R,$L,!$e[$f]);else if("#endif"==$L)break}}}}return $T},$U.splitToWords=function($t,$H){for(var $I,$T,$K=[],$_=-1,$V=0,$e=$t.length;$V<$e;$V++)if($I=$t.charAt($V),0<=" \t=+-*/&%!<>()'\",;".indexOf($I)){if(0<=$_&&1<$V-$_&&($T=$t.substr($_,$V-$_),$K.push($T)),'"'==$I||"'"==$I){var $R=$t.indexOf($I,$V+1);if($R<0)throw"Sharder err:"+$t;$K.push($t.substr($V+1,$R-$V-1)),$V=$R,$_=-1;continue}"("==$I&&$H&&0<$K.length&&($T=$K[$K.length-1]+";","vec4;main;".indexOf($T)<0&&($H.useFuns+=$T)),$_=-1}else $_<0&&($_=$V);return $_<$e&&1<$e-$_&&($T=$t.substr($_,$e-$_),$K.push($T)),$K},$U.IFDEF_NO=0,$U.IFDEF_YES=1,$U.IFDEF_ELSE=2,$U.IFDEF_PARENT=3,$U._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$U._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$U._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$U.includes={},$V($U,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$U.__init$=function(){$S=function(){function $I($t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$t}$b($I,"");var $t=$I.prototype;return $t.setParent=function($t){$t.childs.push(this),this.z=$t.z+1,this.parent=$t},$t.setCondition=function($t,$H){$t&&(this.conditionType=$H,$t=$t.replace(/(\s*$)/g,""),this.condition=function(){return this[$t]},this.condition.__condition=$t)},$t.toscript=function($t,$H){return this._toscript($t,$H,++$I.__id)},$t._toscript=function($T,$K,$_){if(this.childs.length<1&&!this.text)return $K;$K.length;if(this.condition){var $t=!!this.condition.call($T);if(2===this.conditionType&&($t=!$t),!$t)return $K}if(this.text&&$K.push(this.text),0<this.childs.length&&this.childs.forEach(function($t,$H,$I){$t._toscript($T,$K,$_)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $H,$I=0,$V=this.includefiles.length;$I<$V;$I++)this.includefiles[$I].curUseID!=$_&&0<($H=this.includefiles[$I].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$I].curUseID=$_,$K[0]=$H+$K[0]);return $K},$I.__id=1,$I}(),$I=function(){function $t($t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$t;for(var $H=0,$I=0,$T=0;!(($H=$t.indexOf("#begin",$H))<0);){for($T=$H+5;!(($T=$t.indexOf("#end",$T))<0)&&"i"===$t.charAt($T+4);)$T+=5;if($T<0)throw"add include err,no #end:"+$t;$I=$t.indexOf("\n",$H);var $K=$U.splitToWords($t.substr($H,$I-$H),null);"code"==$K[1]?this.codes[$K[2]]=$t.substr($I+1,$T-$I-1):"function"==$K[1]&&($I=$t.indexOf("function",$H),$I+="function".length,this.funs[$K[3]]=$t.substr($I+1,$T-$I-1),this.funnames+=$K[3]+";"),$H=$T+1}}$b($t,"");var $H=$t.prototype;return $H.getWith=function($t){var $H=$t?this.codes[$t]:this.script;if(!$H)throw"get with error:"+$t;return $H},$H.getFunsScript=function($t){var $H="";for(var $I in this.funs)0<=$t.indexOf($I+";")&&($H+=this.funs[$I]);return $H},$t}()},$U}(),$Ct=function(){function $V(){}return $b($V,"laya.webgl.WebGL"),$V._uint8ArraySlice=function(){for(var $t=this.length,$H=new Uint8Array(this.length),$I=0;$I<$t;$I++)$H[$I]=this[$I];return $H},$V._float32ArraySlice=function(){for(var $t=this.length,$H=new Float32Array(this.length),$I=0;$I<$t;$I++)$H[$I]=this[$I];return $H},$V._uint16ArraySlice=function($t){var $H,$I=arguments,$T=0,$K=0;if(0===$I.length)for($T=this.length,$H=new Uint16Array($T),$K=0;$K<$T;$K++)$H[$K]=this[$K];else if(2===$I.length){var $_=$I[0],$V=$I[1];if($_<$V)for($T=$V-$_,$H=new Uint16Array($T),$K=$_;$K<$V;$K++)$H[$K-$_]=this[$K];else $H=new Uint16Array(0)}return $H},$V.expandContext=function(){var $t=$K.prototype,$H=CanvasRenderingContext2D.prototype;$H.fillTrangles=$t.fillTrangles,$ct.__int__(null),$H.setIBVB=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){void 0===$R&&($R=0),void 0===$A&&($A=0),null===$I&&(this._ib=this._ib||$dt.QuadrangleIB,$I=this._ib,$Ot.expandIBQuadrangle($I,$T._byteLength/64+8)),this._setIBVB($t,$H,$I,$T,$K,$_,$V,$e,$R,$A)},$H.fillTrangles=function($t,$H,$I,$T,$K){this._curMat=this._curMat||$z.create(),this._vb=this._vb||$Zt.create(),this._ib||(this._ib=$dt.create(),$Ot.fillIBQuadrangle(this._ib,$V/4));var $_=this._vb,$V=$T.length>>4;$Ot.fillTranglesVB($_,$H,$I,$T,$K||this._curMat,0,0),$Ot.expandIBQuadrangle(this._ib,$_._byteLength/64+8);var $e=new $st(1,0);$e.textureHost=$t;var $R=new $jt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$_._vertType=3,this._setIBVB($H,$I,this._ib,$_,6*$V,$K,$R,$e,0,0)}},$V.enable=function(){if($L.__init__(),$J.isConchApp&&!$J.isConchWebGL)return $N.skinAniSprite=function(){return new $tt},$V.expandContext(),!1;if($N.getWebGLContext=function($t){for(var $H,$I=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$T=0;$T<$I.length;$T++){try{$H=$t.getContext($I[$T],{stencil:$W.isStencil,alpha:$W.isAlpha,antialias:$W.isAntialias,premultipliedAlpha:$W.premultipliedAlpha,preserveDrawingBuffer:$W.preserveDrawingBuffer})}catch($t){}if($H)return $H}return null},null==($V.mainContext=$V.mainContext||$N.getWebGLContext($J._mainCanvas)))return!1;if($J.isWebGL)return!0;$M.create=function($t,$H){return new $tH($t,$H)},$O.create=function($t,$H,$I,$T,$K,$_,$V){return new $nt($t,$H,$I,$T,$K,$_,$V)},$J.WebGL=$V,$J.isWebGL=!0,$Lt.__init__(),$N.createRenderSprite=function($t,$H){return new $zt($t,$H)},$N.createWebGLContext2D=function($t){return new $Wt($t)},$N.changeWebGLSize=function($t,$H){laya.webgl.WebGL.onStageResize($t,$H)},$N.createGraphics=function(){return new $wt};var $t=$N.createFilterAction;return $N.createFilterAction=$t||function($t){return new $Pt},$N.clear=function($t){$St.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $H=$J.context.ctx,$I=0==$H._submits._length||$W.preserveDrawingBuffer?$G.create($t)._color:$x._wgColor;$I&&$H.clearBG($I[0],$I[1],$I[2],$I[3]),$St.clear()},$N.addToAtlas=function($t,$H){void 0===$H&&($H=!1);var $I=$t.bitmap;$J.optimizeTextureMemory($t.url,$t)?$w.__typeof($I,"laya.webgl.resource.IMergeAtlasBitmap")&&$I.allowMerageInAtlas&&$I.on("recovered",$t,$t.addTextureToAtlas):$I.enableMerageInAtlas=!1},$N.isAtlas=function($t){return $t instanceof laya.webgl.atlas.AtlasWebGLCanvas},$B._enable(),$N.beginFlush=function(){for(var $t=$B.instance,$H=$t.getAtlaserCount(),$I=0;$I<$H;$I++){var $T=$t.getAtlaserByIndex($I).texture;$T._flashCacheImageNeedFlush&&$N.flashFlushImage($T)}},$N.drawToCanvas=function($t,$H,$I,$T,$K,$_){($I<=0||$T<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$I|=0,$T|=0,$K|=0,$_|=0;var $V=$yt.create($I,$T,6408,5121,0,!1);$V.start(),$V.clear(0,0,0,0),$J.context.clear(),$S.renders[$H]._fun($t,$J.context,$K,$St.height-$T+$_),$J.context.flush(),$V.end();var $e=$V.getData(0,0,$I,$T);if($V.recycle(),$e.byteLength==$I*$T*4){var $R=new $Qt;$R._canvas=$L.createElement("canvas"),$R.size($I,$T);var $A=$R._canvas.getContext("2d");$L.canvas.size($I,$T);var $q=$L.context,$f=$q.createImageData($I,$T);return $f.data.set(new Uint8ClampedArray($e.buffer)),$R._imgData=$f,$q.putImageData($f,0,0),$A.save(),$A.translate(0,$T),$A.scale(1,-1),$A.drawImage($L.canvas.source,0,0),$A.restore(),$R}console.log("drawToCanvas error: w:"+$I+",h:"+$T+",datalen:"+$e.byteLength)},$N.createFilterAction=function($t){var $H;switch($t){case 32:$H=new $Pt}return $H},$N.addTextureToAtlas=function($t){$t._uvID++,$B._atlasRestore++,$t.bitmap.enableMerageInAtlas&&$B.instance.addToAtlas($t)},$N.getTexturePixels=function($t,$H,$I,$T,$K){$J.context.ctx.clear();var $_=new $r;$_.graphics.drawTexture($t,-$H,-$I);var $V=$yt.create($T,$K);$V.start(),$V.clear(0,0,0,0),$_.render($J.context,0,0),$J.context.ctx.flush(),$V.end();for(var $e=$V.getData(0,0,$T,$K),$R=[],$A=0,$q=$K-1;0<=$q;$q--)for(var $f=0;$f<$T;$f++)$A=4*($q*$T+$f),$R.push($e[$A]),$R.push($e[$A+1]),$R.push($e[$A+2]),$R.push($e[$A+3]);return $R},$N.skinAniSprite=function(){return new $tt},$A.create=function($t,$H){var $I=new $Qt;return $I._imgData=$H,$I.flipY=!1,$I},$s._filterStart=function($t,$H,$I,$T,$K){var $_=$t.getValue("bounds"),$V=$yt.create($_.width,$_.height);if($V.start(),$V.clear(0,0,0,0),$t.addValue("src",$V),$t.addValue("ScissorTest",$St.worldScissorTest),$St.worldScissorTest){var $e=new $k;$e.copyFrom($I.ctx._clipRect),$t.addValue("clipRect",$e),$St.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$s._filterEnd=function($t,$H,$I,$T,$K){var $_=$t.getValue("bounds");$t.getValue("src").end();var $V=$yt.create($_.width,$_.height);$V.start(),$V.clear(0,0,0,0),$t.addValue("out",$V),$H._set$P("_filterCache",$V),$H._set$P("_isHaveGlowFilter",$t.getValue("_isHaveGlowFilter"))},$s._EndTarget=function($t,$H){if($t.getValue("src").recycle(),$t.getValue("out").end(),$t.getValue("ScissorTest")){$St.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$H.ctx.save();var $I=$t.getValue("clipRect");$H.ctx.clipRect($I.x,$I.y,$I.width,$I.height)}},$s._useSrc=function($t){var $H=$t.getValue("out");$H.end(),($H=$t.getValue("src")).start(),$H.clear(0,0,0,0)},$s._endSrc=function($t){$t.getValue("src").end()},$s._useOut=function($t){var $H=$t.getValue("src");$H.end(),($H=$t.getValue("out")).start(),$H.clear(0,0,0,0)},$s._endOut=function($t){$t.getValue("out").end()},$s._recycleScope=function($t){$t.recycle()},$s._filter=function($t,$H,$I,$T){var $K=this._next;if($K){var $_,$V,$e=$t.filters,$R=$e.length;if(1==$R&&32==$e[0].type)return $H.ctx.save(),$H.ctx.setFilters([$e[0]]),$K._fun.call($K,$t,$H,$I,$T),void $H.ctx.restore();var $A=$et.create(),$q=$P.TEMP,$f=$H.ctx._getTransformMatrix(),$b=$z.create();$f.copyTo($b);var $L=0,$G=0,$M=!1,$O=$t._$P._filterCache?$t._$P._filterCache:null;if(!$O||$t._repaint){$M=$t._isHaveGlowFilter(),$A.addValue("_isHaveGlowFilter",$M),$M&&($L=50,$G=25),($V=new $k).copyFrom($t.getSelfBounds()),$V.x+=$t.x,$V.y+=$t.y,$V.x-=$t.pivotX+4,$V.y-=$t.pivotY+4;var $J=$V.x,$S=$V.y;if($V.width+=$L+8,$V.height+=$L+8,$q.x=$V.x*$b.a+$V.y*$b.c,$q.y=$V.y*$b.d+$V.x*$b.b,$V.x=$q.x,$V.y=$q.y,$q.x=$V.width*$b.a+$V.height*$b.c,$q.y=$V.height*$b.d+$V.width*$b.b,$V.width=$q.x,$V.height=$q.y,$V.width<=0||$V.height<=0)return;$O&&$O.recycle(),$A.addValue("bounds",$V);var $U=$Vt.create([$A,$t,$H,0,0],$s._filterStart);$H.addRenderObject($U),$H.ctx._renderKey=0,$H.ctx._shader2D.glTexture=null;var $C=$t.x-$J+$G,$N=$t.y-$S+$G;$K._fun.call($K,$t,$H,$C,$N),$U=$Vt.create([$A,$t,$H,0,0],$s._filterEnd),$H.addRenderObject($U);for(var $w=0;$w<$R;$w++){0!=$w&&($U=$Vt.create([$A],$s._useSrc),$H.addRenderObject($U),$_=$st.create(1,0),$z.TEMP.identity(),$H.ctx.drawTarget($A,0,0,$V.width,$V.height,$z.TEMP,"out",$_,null,$u.TOINT.overlay),$U=$Vt.create([$A],$s._useOut),$H.addRenderObject($U)),$e[$w].action.apply3d($A,$t,$H,0,0)}$U=$Vt.create([$A,$H],$s._EndTarget),$H.addRenderObject($U)}else{if(($M=!!$t._$P._isHaveGlowFilter&&$t._$P._isHaveGlowFilter)&&($L=50,$G=25),($V=$t.getBounds()).width<=0||$V.height<=0)return;$V.width+=$L,$V.height+=$L,$q.x=$V.x*$b.a+$V.y*$b.c,$q.y=$V.y*$b.d+$V.x*$b.b,$V.x=$q.x,$V.y=$q.y,$q.x=$V.width*$b.a+$V.height*$b.c,$q.y=$V.height*$b.d+$V.width*$b.b,$V.width=$q.x,$V.height=$q.y,$A.addValue("out",$O)}$I=$I-$G-$t.x,$T=$T-$G-$t.y,$q.setTo($I,$T),$b.transformPoint($q),$I=$q.x+$V.x,$T=$q.y+$V.y,$_=$st.create(1,0),$z.TEMP.identity(),$H.ctx.drawTarget($A,$I,$T,$V.width,$V.height,$z.TEMP,"out",$_,null,$u.TOINT.overlay),$U=$Vt.create([$A],$s._recycleScope),$H.addRenderObject($U),$b.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$V._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$V._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$V._uint8ArraySlice),!0},$V.onStageResize=function($t,$H){null!=$V.mainContext&&($V.mainContext.viewport(0,0,$t,$H),$St.width=$t,$St.height=$H)},$V.onInvalidGLRes=function(){$B.instance.freeAll(),$C.releaseContentManagers(!0),$V.doNodeRepaint($w.stage),$V.mainContext.viewport(0,0,$St.width,$St.height),$w.stage.event("devicelost")},$V.doNodeRepaint=function($t){0==$t.numChildren&&$t.repaint();for(var $H=0;$H<$t.numChildren;$H++)$V.doNodeRepaint($t.getChildAt($H))},$V.init=function($t,$H,$I){$V.mainCanvas=$t,$A._createContext=function($t){return new $Wt($t)},$Qt._createContext=function($t){return new $Wt($t)};var $T=laya.webgl.WebGL.mainContext;if(null!=$T.getShaderPrecisionFormat){var $K=$T.getShaderPrecisionFormat(35633,36338),$_=$T.getShaderPrecisionFormat(35632,36338);$V.shaderHighPrecision=!(!$K.precision||!$_.precision)}else $V.shaderHighPrecision=!1;if($V.compressAstc=$T.getExtension("WEBGL_compressed_texture_astc"),$V.compressAtc=$T.getExtension("WEBGL_compressed_texture_atc"),$V.compressEtc=$T.getExtension("WEBGL_compressed_texture_etc"),$V.compressEtc1=$T.getExtension("WEBGL_compressed_texture_etc1"),$V.compressPvrtc=$T.getExtension("WEBGL_compressed_texture_pvrtc"),$V.compressS3tc=$T.getExtension("WEBGL_compressed_texture_s3tc"),$V.compressS3tc_srgb=$T.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$V.compressAstc=$V.compressAstc?$V.compressAstc:{},$V.compressAtc=$V.compressAtc?$V.compressAtc:{},$V.compressEtc=$V.compressEtc?$V.compressEtc:{},$V.compressEtc1=$V.compressEtc1?$V.compressEtc1:{},$V.compressPvrtc=$V.compressPvrtc?$V.compressPvrtc:{},$V.compressS3tc=$V.compressS3tc?$V.compressS3tc:{},$V.compressS3tc_srgb=$V.compressS3tc_srgb?$V.compressS3tc_srgb:{},$T.deleteTexture1=$T.deleteTexture,$T.deleteTexture=function($t){$t==$Nt.curBindTexValue&&($Nt.curBindTexValue=null),$T.deleteTexture1($t)},$V.onStageResize($H,$I),null==$V.mainContext)throw new Error("webGL getContext err!");$p.__init__(),$B.__init__(),$rt.__init__(),$_t.__init__(),$Wt.__init__(),$st.__init__(),$d.__init__(),$ct.__int__($T),$u._init_($T),$J.isConchApp&&conch.setOnInvalidGLRes($V.onInvalidGLRes)},$V.mainCanvas=null,$V.antialias=!0,$V.shaderHighPrecision=!1,$V._bg_null=[0,0,0,0],$V}(),$Nt=function(){function $T(){}return $b($T,"laya.webgl.WebGLContext"),$T.UseProgram=function($t){return $T._useProgram!==$t&&($Ct.mainContext.useProgram($t),$T._useProgram=$t,!0)},$T.setDepthTest=function($t,$H){$H!==$T._depthTest&&(($T._depthTest=$H)?$t.enable(2929):$t.disable(2929))},$T.setDepthMask=function($t,$H){$H!==$T._depthMask&&($T._depthMask=$H,$t.depthMask($H))},$T.setDepthFunc=function($t,$H){$H!==$T._depthFunc&&($T._depthFunc=$H,$t.depthFunc($H))},$T.setBlend=function($t,$H){$H!==$T._blend&&(($T._blend=$H)?$t.enable(3042):$t.disable(3042))},$T.setBlendFunc=function($t,$H,$I){($H!==$T._sFactor||$I!==$T._dFactor)&&($T._sFactor=$H,$T._dFactor=$I,$t.blendFunc($H,$I))},$T.setCullFace=function($t,$H){$H!==$T._cullFace&&(($T._cullFace=$H)?$t.enable(2884):$t.disable(2884))},$T.setFrontFace=function($t,$H){$H!==$T._frontFace&&($T._frontFace=$H,$t.frontFace($H))},$T.bindTexture=function($t,$H,$I){$t.bindTexture($H,$I),$T.curBindTexTarget=$H,$T.curBindTexValue=$I},$T.DEPTH_BUFFER_BIT=256,$T.STENCIL_BUFFER_BIT=1024,$T.COLOR_BUFFER_BIT=16384,$T.POINTS=0,$T.LINES=1,$T.LINE_LOOP=2,$T.LINE_STRIP=3,$T.TRIANGLES=4,$T.TRIANGLE_STRIP=5,$T.TRIANGLE_FAN=6,$T.ZERO=0,$T.ONE=1,$T.SRC_COLOR=768,$T.ONE_MINUS_SRC_COLOR=769,$T.SRC_ALPHA=770,$T.ONE_MINUS_SRC_ALPHA=771,$T.DST_ALPHA=772,$T.ONE_MINUS_DST_ALPHA=773,$T.DST_COLOR=774,$T.ONE_MINUS_DST_COLOR=775,$T.SRC_ALPHA_SATURATE=776,$T.FUNC_ADD=32774,$T.BLEND_EQUATION=32777,$T.BLEND_EQUATION_RGB=32777,$T.BLEND_EQUATION_ALPHA=34877,$T.FUNC_SUBTRACT=32778,$T.FUNC_REVERSE_SUBTRACT=32779,$T.BLEND_DST_RGB=32968,$T.BLEND_SRC_RGB=32969,$T.BLEND_DST_ALPHA=32970,$T.BLEND_SRC_ALPHA=32971,$T.CONSTANT_COLOR=32769,$T.ONE_MINUS_CONSTANT_COLOR=32770,$T.CONSTANT_ALPHA=32771,$T.ONE_MINUS_CONSTANT_ALPHA=32772,$T.BLEND_COLOR=32773,$T.ARRAY_BUFFER=34962,$T.ELEMENT_ARRAY_BUFFER=34963,$T.ARRAY_BUFFER_BINDING=34964,$T.ELEMENT_ARRAY_BUFFER_BINDING=34965,$T.STREAM_DRAW=35040,$T.STATIC_DRAW=35044,$T.DYNAMIC_DRAW=35048,$T.BUFFER_SIZE=34660,$T.BUFFER_USAGE=34661,$T.CURRENT_VERTEX_ATTRIB=34342,$T.FRONT=1028,$T.BACK=1029,$T.CULL_FACE=2884,$T.FRONT_AND_BACK=1032,$T.BLEND=3042,$T.DITHER=3024,$T.STENCIL_TEST=2960,$T.DEPTH_TEST=2929,$T.SCISSOR_TEST=3089,$T.POLYGON_OFFSET_FILL=32823,$T.SAMPLE_ALPHA_TO_COVERAGE=32926,$T.SAMPLE_COVERAGE=32928,$T.NO_ERROR=0,$T.INVALID_ENUM=1280,$T.INVALID_VALUE=1281,$T.INVALID_OPERATION=1282,$T.OUT_OF_MEMORY=1285,$T.CW=2304,$T.CCW=2305,$T.LINE_WIDTH=2849,$T.ALIASED_POINT_SIZE_RANGE=33901,$T.ALIASED_LINE_WIDTH_RANGE=33902,$T.CULL_FACE_MODE=2885,$T.FRONT_FACE=2886,$T.DEPTH_RANGE=2928,$T.DEPTH_WRITEMASK=2930,$T.DEPTH_CLEAR_VALUE=2931,$T.DEPTH_FUNC=2932,$T.STENCIL_CLEAR_VALUE=2961,$T.STENCIL_FUNC=2962,$T.STENCIL_FAIL=2964,$T.STENCIL_PASS_DEPTH_FAIL=2965,$T.STENCIL_PASS_DEPTH_PASS=2966,$T.STENCIL_REF=2967,$T.STENCIL_VALUE_MASK=2963,$T.STENCIL_WRITEMASK=2968,$T.STENCIL_BACK_FUNC=34816,$T.STENCIL_BACK_FAIL=34817,$T.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$T.STENCIL_BACK_PASS_DEPTH_PASS=34819,$T.STENCIL_BACK_REF=36003,$T.STENCIL_BACK_VALUE_MASK=36004,$T.STENCIL_BACK_WRITEMASK=36005,$T.VIEWPORT=2978,$T.SCISSOR_BOX=3088,$T.COLOR_CLEAR_VALUE=3106,$T.COLOR_WRITEMASK=3107,$T.UNPACK_ALIGNMENT=3317,$T.PACK_ALIGNMENT=3333,$T.MAX_TEXTURE_SIZE=3379,$T.MAX_VIEWPORT_DIMS=3386,$T.SUBPIXEL_BITS=3408,$T.RED_BITS=3410,$T.GREEN_BITS=3411,$T.BLUE_BITS=3412,$T.ALPHA_BITS=3413,$T.DEPTH_BITS=3414,$T.STENCIL_BITS=3415,$T.POLYGON_OFFSET_UNITS=10752,$T.POLYGON_OFFSET_FACTOR=32824,$T.TEXTURE_BINDING_2D=32873,$T.SAMPLE_BUFFERS=32936,$T.SAMPLES=32937,$T.SAMPLE_COVERAGE_VALUE=32938,$T.SAMPLE_COVERAGE_INVERT=32939,$T.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$T.COMPRESSED_TEXTURE_FORMATS=34467,$T.DONT_CARE=4352,$T.FASTEST=4353,$T.NICEST=4354,$T.GENERATE_MIPMAP_HINT=33170,$T.BYTE=5120,$T.UNSIGNED_BYTE=5121,$T.SHORT=5122,$T.UNSIGNED_SHORT=5123,$T.INT=5124,$T.UNSIGNED_INT=5125,$T.FLOAT=5126,$T.DEPTH_COMPONENT=6402,$T.ALPHA=6406,$T.RGB=6407,$T.RGBA=6408,$T.LUMINANCE=6409,$T.LUMINANCE_ALPHA=6410,$T.UNSIGNED_SHORT_4_4_4_4=32819,$T.UNSIGNED_SHORT_5_5_5_1=32820,$T.UNSIGNED_SHORT_5_6_5=33635,$T.FRAGMENT_SHADER=35632,$T.VERTEX_SHADER=35633,$T.MAX_VERTEX_ATTRIBS=34921,$T.MAX_VERTEX_UNIFORM_VECTORS=36347,$T.MAX_VARYING_VECTORS=36348,$T.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$T.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$T.MAX_TEXTURE_IMAGE_UNITS=34930,$T.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$T.SHADER_TYPE=35663,$T.DELETE_STATUS=35712,$T.LINK_STATUS=35714,$T.VALIDATE_STATUS=35715,$T.ATTACHED_SHADERS=35717,$T.ACTIVE_UNIFORMS=35718,$T.ACTIVE_ATTRIBUTES=35721,$T.SHADING_LANGUAGE_VERSION=35724,$T.CURRENT_PROGRAM=35725,$T.NEVER=512,$T.LESS=513,$T.EQUAL=514,$T.LEQUAL=515,$T.GREATER=516,$T.NOTEQUAL=517,$T.GEQUAL=518,$T.ALWAYS=519,$T.KEEP=7680,$T.REPLACE=7681,$T.INCR=7682,$T.DECR=7683,$T.INVERT=5386,$T.INCR_WRAP=34055,$T.DECR_WRAP=34056,$T.VENDOR=7936,$T.RENDERER=7937,$T.VERSION=7938,$T.NEAREST=9728,$T.LINEAR=9729,$T.NEAREST_MIPMAP_NEAREST=9984,$T.LINEAR_MIPMAP_NEAREST=9985,$T.NEAREST_MIPMAP_LINEAR=9986,$T.LINEAR_MIPMAP_LINEAR=9987,$T.TEXTURE_MAG_FILTER=10240,$T.TEXTURE_MIN_FILTER=10241,$T.TEXTURE_WRAP_S=10242,$T.TEXTURE_WRAP_T=10243,$T.TEXTURE_2D=3553,$T.TEXTURE=5890,$T.TEXTURE_CUBE_MAP=34067,$T.TEXTURE_BINDING_CUBE_MAP=34068,$T.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$T.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$T.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$T.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$T.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$T.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$T.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$T.TEXTURE0=33984,$T.TEXTURE1=33985,$T.TEXTURE2=33986,$T.TEXTURE3=33987,$T.TEXTURE4=33988,$T.TEXTURE5=33989,$T.TEXTURE6=33990,$T.TEXTURE7=33991,$T.TEXTURE8=33992,$T.TEXTURE9=33993,$T.TEXTURE10=33994,$T.TEXTURE11=33995,$T.TEXTURE12=33996,$T.TEXTURE13=33997,$T.TEXTURE14=33998,$T.TEXTURE15=33999,$T.TEXTURE16=34e3,$T.TEXTURE17=34001,$T.TEXTURE18=34002,$T.TEXTURE19=34003,$T.TEXTURE20=34004,$T.TEXTURE21=34005,$T.TEXTURE22=34006,$T.TEXTURE23=34007,$T.TEXTURE24=34008,$T.TEXTURE25=34009,$T.TEXTURE26=34010,$T.TEXTURE27=34011,$T.TEXTURE28=34012,$T.TEXTURE29=34013,$T.TEXTURE30=34014,$T.TEXTURE31=34015,$T.ACTIVE_TEXTURE=34016,$T.REPEAT=10497,$T.CLAMP_TO_EDGE=33071,$T.MIRRORED_REPEAT=33648,$T.FLOAT_VEC2=35664,$T.FLOAT_VEC3=35665,$T.FLOAT_VEC4=35666,$T.INT_VEC2=35667,$T.INT_VEC3=35668,$T.INT_VEC4=35669,$T.BOOL=35670,$T.BOOL_VEC2=35671,$T.BOOL_VEC3=35672,$T.BOOL_VEC4=35673,$T.FLOAT_MAT2=35674,$T.FLOAT_MAT3=35675,$T.FLOAT_MAT4=35676,$T.SAMPLER_2D=35678,$T.SAMPLER_CUBE=35680,$T.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$T.VERTEX_ATTRIB_ARRAY_SIZE=34339,$T.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$T.VERTEX_ATTRIB_ARRAY_TYPE=34341,$T.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$T.VERTEX_ATTRIB_ARRAY_POINTER=34373,$T.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$T.COMPILE_STATUS=35713,$T.LOW_FLOAT=36336,$T.MEDIUM_FLOAT=36337,$T.HIGH_FLOAT=36338,$T.LOW_INT=36339,$T.MEDIUM_INT=36340,$T.HIGH_INT=36341,$T.FRAMEBUFFER=36160,$T.RENDERBUFFER=36161,$T.RGBA4=32854,$T.RGB5_A1=32855,$T.RGB565=36194,$T.DEPTH_COMPONENT16=33189,$T.STENCIL_INDEX=6401,$T.STENCIL_INDEX8=36168,$T.DEPTH_STENCIL=34041,$T.RENDERBUFFER_WIDTH=36162,$T.RENDERBUFFER_HEIGHT=36163,$T.RENDERBUFFER_INTERNAL_FORMAT=36164,$T.RENDERBUFFER_RED_SIZE=36176,$T.RENDERBUFFER_GREEN_SIZE=36177,$T.RENDERBUFFER_BLUE_SIZE=36178,$T.RENDERBUFFER_ALPHA_SIZE=36179,$T.RENDERBUFFER_DEPTH_SIZE=36180,$T.RENDERBUFFER_STENCIL_SIZE=36181,$T.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$T.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$T.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$T.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$T.COLOR_ATTACHMENT0=36064,$T.DEPTH_ATTACHMENT=36096,$T.STENCIL_ATTACHMENT=36128,$T.DEPTH_STENCIL_ATTACHMENT=33306,$T.NONE=0,$T.FRAMEBUFFER_COMPLETE=36053,$T.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$T.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$T.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$T.FRAMEBUFFER_UNSUPPORTED=36061,$T.FRAMEBUFFER_BINDING=36006,$T.RENDERBUFFER_BINDING=36007,$T.MAX_RENDERBUFFER_SIZE=34024,$T.INVALID_FRAMEBUFFER_OPERATION=1286,$T.UNPACK_FLIP_Y_WEBGL=37440,$T.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$T.CONTEXT_LOST_WEBGL=37442,$T.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$T.BROWSER_DEFAULT_WEBGL=37444,$T._useProgram=null,$T._depthTest=!0,$T._depthMask=!0,$T._blend=!1,$T._cullFace=!1,$T.curBindTexTarget=null,$T.curBindTexValue=null,$V($T,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$T}(),$wt=function($t){function $H(){$H.__super.call(this)}$b($H,"laya.webgl.display.GraphicsGL",$e);var $I=$H.prototype;return $I.setShader=function($t){this._saveToCmd($J.context._setShader,[$t])},$I.setIBVB=function($t,$H,$I,$T,$K,$_){this._saveToCmd($J.context._setIBVB,[$t,$H,$I,$T,$K,$_])},$I.drawParticle=function($t,$H,$I){var $T=$N.createParticleTemplate2D($I);$T.x=$t,$T.y=$H,this._saveToCmd($J.context._drawParticle,[$T])},$H}(),$Wt=function($t){var $I;function $X($t){this._x=0,this._y=0,this._id=++$X._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$X.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$X.MAXCLIPRECT,this.mOutPoint,this._canvas=$t,this._canvas._addReference(),$X._contextcount++,$J.isFlash?(this._ib=$dt.create(35044),$Ot.fillIBQuadrangle(this._ib,16)):this._ib=$dt.QuadrangleIB,this.clear()}$b($X,"laya.webgl.canvas.WebGLContext2D",$K);var $H=$X.prototype;return $H.setIsMainContext=function(){this._isMain=!0},$H.clearBG=function($t,$H,$I,$T){var $K=$Ct.mainContext;$K.clearColor($t,$H,$I,$T),$K.clear(16384)},$H._getSubmits=function(){return this._submits},$H._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $t=0,$H=this._submits._length;$t<$H;$t++)this._submits[$t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$H.destroy=function(){--$X._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$dt.QuadrangleIB&&this._ib.releaseResource()},$H.clear=function(){this._submits||(this._other=$I.DEFAULT,this._curMat=$z.create(),this._vb=$Zt.create(-1),this._submits=[],this._save=[$F.Create(this)],this._save.length=10,this._shader2D=new $d,this._triangleMesh=$lt.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$I.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$X.MAXCLIPRECT,this._curSubmit=$_t.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$$.DEFAULT;for(var $t=0,$H=this._submits._length;$t<$H;$t++)this._submits[$t].releaseRender(),this._submits[$t]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$H.size=function($t,$H){if(this._width!=$t||this._height!=$H)if(0==$t||0==$H){0!=this._vb._byteLength&&(this._width=$t,this._height=$H,this._vb.clear(),this._vb.upload());for(var $I=0,$T=this._submits._length;$I<$T;$I++)this._submits[$I].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$t,this._height=$H,this._targets&&this._targets.size($t,$H),this._canvas.memorySize-=this._canvas.memorySize;0===$t&&0===$H&&this._releaseMem()},$H._getTransformMatrix=function(){return this._curMat},$H.translate=function($t,$H){0===$t&&0===$H||($i.save(this),this._curMat.bTransform&&($c.save(this),this._curMat.transformPointN($P.TEMP.setTo($t,$H)),$t=$P.TEMP.x,$H=$P.TEMP.y),this._x+=$t,this._y+=$H)},$H.save=function(){this._save[this._save._length++]=$F.Create(this)},$H.restore=function(){var $t=this._save._length;if(!($t<1))for(var $H=$t-1;0<=$H;$H--){var $I=this._save[$H];if($I.restore(this),$I.isSaveMark())return void(this._save._length=$H)}},$H._fillText=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){void 0===$A&&($A=0);var $q=this._shader2D,$f=this._curSubmit.shaderValue,$b=$K?$Gt.create($K):this._other.font;if($B.enabled)$q.ALPHA!==$f.ALPHA&&($q.glTexture=null),$Lt.drawText(this,$t,$H,this._curMat,$b,$R||this._other.textAlign,$_,$V,$e,$I,$T,$A);else{this._shader2D.defines.getValue();var $L=$_?$G.create($_)._color:$q.colorAdd;$q.ALPHA===$f.ALPHA&&$L===$q.colorAdd&&$f.colorAdd===$q.colorAdd||($q.glTexture=null,$q.colorAdd=$L),$Lt.drawText(this,$t,$H,this._curMat,$b,$R||this._other.textAlign,$_,$V,$e,$I,$T,$A)}},$H.fillWords=function($t,$H,$I,$T,$K,$_){this._fillText(null,$t,$H,$I,$T,$K,null,-1,null,$_)},$H.fillBorderWords=function($t,$H,$I,$T,$K,$_,$V){this._fillBorderText(null,$t,$H,$I,$T,$K,$_,$V,null)},$H.fillText=function($t,$H,$I,$T,$K,$_){this._fillText($t,null,$H,$I,$T,$K,null,-1,$_)},$H.strokeText=function($t,$H,$I,$T,$K,$_,$V){this._fillText($t,null,$H,$I,$T,null,$K,$_||1,$V)},$H.fillBorderText=function($t,$H,$I,$T,$K,$_,$V,$e){this._fillBorderText($t,null,$H,$I,$T,$K,$_,$V,$e)},$H._fillBorderText=function($t,$H,$I,$T,$K,$_,$V,$e,$R){if(!$B.enabled)return this._fillText($t,$H,$I,$T,$K,null,$V,$e||1,$R),void this._fillText($t,$H,$I,$T,$K,$_,null,-1,$R);var $A=this._shader2D,$q=this._curSubmit.shaderValue;$A.ALPHA!==$q.ALPHA&&($A.glTexture=null);var $f=$K?($X._fontTemp.setFont($K),$X._fontTemp):this._other.font;$Lt.drawText(this,$t,$H,this._curMat,$f,$R||this._other.textAlign,$_,$V,$e||1,$I,$T,0)},$H.fillRect=function($t,$H,$I,$T,$K){var $_=this._vb;if($Ot.fillRectImgVb($_,this._clipRect,$t,$H,$I,$T,$l.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $V=this._shader2D.fillStyle;$K&&(this._shader2D.fillStyle=$$.create($K));var $e=this._shader2D,$R=this._curSubmit.shaderValue;if($e.fillStyle!==$R.fillStyle||$e.ALPHA!==$R.ALPHA){$e.glTexture=null;var $A=this._curSubmit=$_t.createSubmit(this,this._ib,$_,($_._byteLength-64)/32*3,$st.create(2,0));$A.shaderValue.color=$e.fillStyle._color._color,$A.shaderValue.ALPHA=$e.ALPHA,this._submits[this._submits._length++]=$A}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$V}},$H.fillTexture=function($t,$H,$I,$T,$K,$_,$V,$e){if($t.loaded&&$t.bitmap&&$t.source){var $R=this._vb,$A=$t.bitmap.width,$q=$t.bitmap.height,$f=$t.uv,$b=$V.x%$t.width,$L=$V.y%$t.height;if($A!=$e.w||$q!=$e.h){if(!$e.w&&!$e.h)switch($e.oy=$e.ox=0,$_){case"repeat":$e.width=$T,$e.height=$K;break;case"repeat-x":$e.width=$T,$L<0?$t.height+$L>$K?$e.height=$K:$e.height=$t.height+$L:($e.oy=$L,$t.height+$L>$K?$e.height=$K-$L:$e.height=$t.height);break;case"repeat-y":$b<0?$t.width+$b>$T?$e.width=$T:$e.width=$t.width+$b:($e.ox=$b,$t.width+$b>$T?$e.width=$T-$b:$e.width=$t.width),$e.height=$K;break;case"no-repeat":$b<0?$t.width+$b>$T?$e.width=$T:$e.width=$t.width+$b:($e.ox=$b,$t.width+$b>$T?$e.width=$T-$b:$e.width=$t.width),$L<0?$t.height+$L>$K?$e.height=$K:$e.height=$t.height+$L:($e.oy=$L,$t.height+$L>$K?$e.height=$K-$L:$e.height=$t.height);break;default:$e.width=$T,$e.height=$K}$e.w=$A,$e.h=$q,$e.uv=[0,0,$e.width/$A,0,$e.width/$A,$e.height/$q,0,$e.height/$q]}if($H+=$e.ox,$I+=$e.oy,$b-=$e.ox,$L-=$e.oy,$Ot.fillRectImgVb($R,this._clipRect,$H,$I,$e.width,$e.height,$e.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $G=$gt.create(this,this._ib,$R,($R._byteLength-64)/32*3,$st.create(256,0)),$M=(this._submits[this._submits._length++]=$G).shaderValue;$M.textureHost=$t;var $O=$f[0]*$A,$J=$f[1]*$q,$S=($f[2]-$f[0])*$A,$U=($f[5]-$f[3])*$q,$C=-$b/$A,$N=-$L/$q;$M.u_TexRange[0]=$O/$A,$M.u_TexRange[1]=$S/$A,$M.u_TexRange[2]=$J/$q,$M.u_TexRange[3]=$U/$q,$M.u_offset[0]=$C,$M.u_offset[1]=$N,$B.enabled&&!this._isMain&&$G.addTexture($t,($R._byteLength>>2)-16),(this._curSubmit=$G)._renderType=10017,$G._numEle+=6}}else this.sprite&&$w.timer.callLater(this,this._repaintSprite)},$H.setShader=function($t){$m.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$t},$H.setFilters=function($t){$m.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$t,this._curSubmit=$_t.RENDERBASE,this._renderKey=0,this._drawCount++},$H.drawTexture=function($t,$H,$I,$T,$K,$_,$V){this._drawTextureM($t,$H,$I,$T,$K,$_,$V,null,1)},$H.addTextureVb=function($t,$H,$I){var $T=this._curSubmit._vb||this._vb,$K=$T._byteLength>>2;$T.byteLength=$K+16<<2;for(var $_=$T.getFloat32Array(),$V=0;$V<16;$V+=4)$_[$K++]=$t[$V]+$H,$_[$K++]=$t[$V+1]+$I,$_[$K++]=$t[$V+2],$_[$K++]=$t[$V+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$T._upload=!0},$H.willDrawTexture=function($t,$H){if(!($t.loaded&&$t.bitmap&&$t.source))return this.sprite&&$w.timer.callLater(this,this._repaintSprite),0;var $I=$t.bitmap,$T=$I.id+this._shader2D.ALPHA*$H+10016;if($T==this._renderKey)return $T;var $K=this._shader2D,$_=$K.ALPHA,$V=this._curSubmit.shaderValue;$K.ALPHA*=$H,this._renderKey=$T,this._drawCount++,$K.glTexture=$I;var $e=this._vb,$R=null,$A=$e._byteLength/32*3,$q=$V.textureHost&&$V.textureHost==$t&&$V.textureHost.alphaTexture==$t.alphaTexture;return $R=$gt.create(this,this._ib,$e,$A,$st.create(1,0)),(this._submits[this._submits._length++]=$R).shaderValue.textureHost=$t,$R._renderType=10016,$R._preIsSameTextureShader=10016===this._curSubmit._renderType&&$K.ALPHA===$V.ALPHA&&$q,this._curSubmit=$R,$K.ALPHA=$_,$T},$H.drawTextures=function($t,$H,$I,$T){if($t.loaded&&$t.bitmap&&$t.source){var $K=this._clipRect;if(this._clipRect=$X.MAXCLIPRECT,this._drawTextureM($t,$H[0],$H[1],$t.width,$t.height,$I,$T,null,1)){if(this._clipRect=$K,$Y.drawCall++,!($H.length<4)){for(var $_=this._curSubmit._vb||this._vb,$V=this._curMat.a,$e=this._curMat.d,$R=2,$A=$H.length;$R<$A;$R+=2)$Ot.copyPreImgVb($_,($H[$R]-$H[$R-2])*$V,($H[$R+1]-$H[$R-1])*$e),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$w.timer.callLater(this,this._repaintSprite)},$H._drawTextureM=function($t,$H,$I,$T,$K,$_,$V,$e,$R){if(!$t.loaded||!$t.source)return this.sprite&&$w.timer.callLater(this,this._repaintSprite),!1;var $A=this._curSubmit._vb||this._vb,$q=$t.bitmap;$H+=$_,$I+=$V,this._drawCount++;var $f=$q.id+this._shader2D.ALPHA*$R+10016;if($f!=this._renderKey){this._renderKey=$f;var $b=this._curSubmit.shaderValue,$L=this._shader2D,$G=$L.ALPHA;$L.ALPHA*=$R,$L.glTexture=$q;var $M=this._vb,$O=null,$J=$M._byteLength/32*3,$S=$b.textureHost&&$b.textureHost==$t&&$b.textureHost.alphaTexture==$t.alphaTexture;$O=$gt.create(this,this._ib,$M,$J,$st.create(1,0)),(this._submits[this._submits._length++]=$O).shaderValue.textureHost=$t,$O._renderType=10016,$O._preIsSameTextureShader=10016===this._curSubmit._renderType&&$L.ALPHA===$b.ALPHA&&$S,this._curSubmit=$O,$A=this._curSubmit._vb||this._vb,$L.ALPHA=$G}return!!$Ot.fillRectImgVb($A,this._clipRect,$H,$I,$T||$t.width,$K||$t.height,$t.uv,$e||this._curMat,this._x,this._y,0,0)&&($B.enabled&&!this._isMain&&this._curSubmit.addTexture($t,($A._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$H._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$H._drawText=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){var $q=$t.bitmap;this._drawCount++;var $f=$q.id+this._shader2D.ALPHA+10016;if($f!=this._renderKey){this._renderKey=$f;var $b=this._curSubmit.shaderValue,$L=this._shader2D;$L.glTexture=$q;var $G=this._vb,$M=null,$O=$G._byteLength/32*3,$J=$b.textureHost&&$b.textureHost==$t&&$b.textureHost.alphaTexture==$t.alphaTexture;($M=$B.enabled?$gt.create(this,this._ib,$G,$O,$st.create(1,0)):$gt.create(this,this._ib,$G,$O,$it.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$L.ALPHA===$b.ALPHA&&$J,(this._submits[this._submits._length++]=$M).shaderValue.textureHost=$t,$M._renderType=10016,this._curSubmit=$M}$t.active();var $S=this._curSubmit._vb||this._vb;$Ot.fillRectImgVb($S,this._clipRect,$H+$V,$I+$e,$T||$t.width,$K||$t.height,$t.uv,$_||this._curMat,this._x,this._y,$R,$A,!0)&&($B.enabled&&!this._isMain&&this._curSubmit.addTexture($t,($S._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$H.drawTextureWithTransform=function($t,$H,$I,$T,$K,$_,$V,$e,$R){if($_){var $A=this._curMat,$q=this._x,$f=this._y;(0!==$V||0!==$e)&&(this._x=$V*$A.a+$e*$A.c,this._y=$e*$A.d+$V*$A.b),$_&&$A.bTransform?($z.mul($_,$A,$X._tmpMatrix),($_=$X._tmpMatrix)._checkTransform()):(this._x+=$A.tx,this._y+=$A.ty),this._drawTextureM($t,$H,$I,$T,$K,0,0,$_,$R),this._x=$q,this._y=$f}else this._drawTextureM($t,$H,$I,$T,$K,$V,$e,null,$R)},$H.fillQuadrangle=function($t,$H,$I,$T,$K){var $_=this._curSubmit,$V=this._vb,$e=this._shader2D,$R=$_.shaderValue;if(this._renderKey=0,$t.bitmap){var $A=$t.bitmap;$e.glTexture==$A&&$e.ALPHA===$R.ALPHA||($e.glTexture=$A,($_=this._curSubmit=$_t.createSubmit(this,this._ib,$V,$V._byteLength/32*3,$st.create(1,0))).shaderValue.glTexture=$A,this._submits[this._submits._length++]=$_),$Ot.fillQuadrangleImgVb($V,$H,$I,$T,$t.uv,$K||this._curMat,this._x,this._y)}else $_.shaderValue.fillStyle&&$_.shaderValue.fillStyle.equal($t)&&$e.ALPHA===$R.ALPHA||($e.glTexture=null,($_=this._curSubmit=$_t.createSubmit(this,this._ib,$V,$V._byteLength/32*3,$st.create(2,0))).shaderValue.defines.add(2),$_.shaderValue.fillStyle=$$.create($t),this._submits[this._submits._length++]=$_),$Ot.fillQuadrangleImgVb($V,$H,$I,$T,$l.DEF_UV,$K||this._curMat,this._x,this._y);$_._numEle+=6},$H.drawTexture2=function($t,$H,$I,$T,$K,$_,$V,$e){if(0!=$_){var $R=this._curMat;if(this._x=$t*$R.a+$H*$R.c,this._y=$H*$R.d+$t*$R.b,$K&&($K=$R.bTransform||$K.bTransform?($z.mul($K,$R,$X._tmpMatrix),$X._tmpMatrix):(this._x+=$K.tx+$R.tx,this._y+=$K.ty+$R.ty,$z.EMPTY)),1!==$_||$V){var $A=this._shader2D.ALPHA,$q=this._nBlendType;this._shader2D.ALPHA=$_,$V&&(this._nBlendType=$u.TOINT($V)),this._drawTextureM($e[0],$e[1]-$I,$e[2]-$T,$e[3],$e[4],0,0,$K,1),this._shader2D.ALPHA=$A,this._nBlendType=$q}else this._drawTextureM($e[0],$e[1]-$I,$e[2]-$T,$e[3],$e[4],0,0,$K,1);this._x=this._y=0}},$H.drawCanvas=function($t,$H,$I,$T,$K){var $_=$t.context;if(this._renderKey=0,$_._targets)this._submits[this._submits._length++]=$pt.create($_,0,null),this._curSubmit=$_t.RENDERBASE,$_._targets.drawTo(this,$H,$I,$T,$K);else{var $V=this._submits[this._submits._length++]=$pt.create($_,this._shader2D.ALPHA,this._shader2D.filters),$e=$T/$t.width,$R=$K/$t.height,$A=$V._matrix;this._curMat.copyTo($A),1!=$e&&1!=$R&&$A.scale($e,$R);var $q=$A.tx,$f=$A.ty;$A.tx=$A.ty=0,$A.transformPoint($P.TEMP.setTo($H,$I)),$A.translate($P.TEMP.x+$q,$P.TEMP.y+$f),this._curSubmit=$_t.RENDERBASE}$W.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$_._targets?"yellow":"green",this.strokeRect($H-1,$I-1,$T+2,$K+2,1),this.strokeRect($H,$I,$T,$K,1),this.restore())},$H.drawTarget=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){void 0===$A&&($A=-1);var $q=this._vb;if($Ot.fillRectImgVb($q,this._clipRect,$H,$I,$T,$K,$R||$l.DEF_UV,$_||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $f=this._curSubmit=$ft.create(this,this._ib,$q,($q._byteLength-64)/32*3,$e,$V);$f.blendType=-1==$A?this._nBlendType:$A,$f.scope=$t,this._submits[this._submits._length++]=$f,this._curSubmit._numEle+=6}},$H.mixRGBandAlpha=function($t){return this._mixRGBandAlpha($t,this._shader2D.ALPHA)},$H._mixRGBandAlpha=function($t,$H){var $I=(4278190080&$t)>>>24;return 0!=$I?$I*=$H:$I=255*$H,16777215&$t|$I<<24},$H.drawTriangles=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){if(!$t.loaded||!$t.source)return this.sprite&&$w.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$t.bitmap;var $q=this._mixRGBandAlpha(4294967295,$e),$f=($T.length,$_.length);this._renderKey=-1;var $b=this._curSubmit=$gt.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$st.create(1,0));return $b.shaderValue.textureHost=$t,$b._renderType=10016,this._submits[this._submits._length++]=$b,$V?($X._tmpMatrix.a=$V.a,$X._tmpMatrix.b=$V.b,$X._tmpMatrix.c=$V.c,$X._tmpMatrix.d=$V.d,$X._tmpMatrix.tx=$V.tx+$H,$X._tmpMatrix.ty=$V.ty+$I,$z.mul($X._tmpMatrix,this._curMat,$X._tmpMatrix)):($X._tmpMatrix.a=this._curMat.a,$X._tmpMatrix.b=this._curMat.b,$X._tmpMatrix.c=this._curMat.c,$X._tmpMatrix.d=this._curMat.d,$X._tmpMatrix.tx=this._curMat.tx+$H,$X._tmpMatrix.ty=this._curMat.ty+$I),this._triangleMesh.addData($T,$K,$_,$X._tmpMatrix,$q,this),this._curSubmit._numEle+=$f,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$H.transform=function($t,$H,$I,$T,$K,$_){$c.save(this),$z.mul($z.TEMP.setTo($t,$H,$I,$T,$K,$_),this._curMat,this._curMat),this._curMat._checkTransform()},$H.setTransformByMatrix=function($t){$t.copyTo(this._curMat)},$H.transformByMatrix=function($t){$c.save(this),$z.mul($t,this._curMat,this._curMat),this._curMat._checkTransform()},$H.rotate=function($t){$c.save(this),this._curMat.rotateEx($t)},$H.scale=function($t,$H){$c.save(this),this._curMat.scaleEx($t,$H)},$H.clipRect=function($t,$H,$I,$T){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $K=$qt.create(4);this.addRenderObject($K);var $_=this._vb,$V=$_._byteLength>>2;if($Ot.fillRectImgVb($_,null,$t,$H,$I,$T,$l.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $e=this._curSubmit=$_t.createSubmit(this,this._ib,$_,($_._byteLength-64)/32*3,$st.create(2,0));$e.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$e,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $R=$qt.create(5);this.addRenderObject($R);var $A=$_.getFloat32Array(),$q=Math.min(Math.min(Math.min($A[0+$V],$A[4+$V]),$A[8+$V]),$A[12+$V]),$f=Math.max(Math.max(Math.max($A[0+$V],$A[4+$V]),$A[8+$V]),$A[12+$V]),$b=Math.min(Math.min(Math.min($A[1+$V],$A[5+$V]),$A[9+$V]),$A[13+$V]),$L=Math.max(Math.max(Math.max($A[1+$V],$A[5+$V]),$A[9+$V]),$A[13+$V]);$n.save(this,$R,$t,$H,$I,$T,$q,$b,$f-$q,$L-$b),this._curSubmit=$_t.RENDERBASE}else{$I*=this._curMat.a,$T*=this._curMat.d;var $G=$P.TEMP;this._curMat.transformPoint($G.setTo($t,$H)),$I<0&&($G.x=$G.x+$I,$I=-$I),$T<0&&($G.y=$G.y+$T,$T=-$T),this._renderKey=0;var $M=this._curSubmit=$At.create(this);(this._submits[this._submits._length++]=$M).submitIndex=this._submits._length,$M.submitLength=9999999,$o.save(this,$M);var $O=this._clipRect,$J=$O.x,$S=$O.y,$U=$G.x+$I,$C=$G.y+$T;$J<$G.x&&($O.x=$G.x),$S<$G.y&&($O.y=$G.y),$O.width=Math.min($U,$J+$O.width)-$O.x,$O.height=Math.min($C,$S+$O.height)-$O.y,this._shader2D.glTexture=null,$M.clipRect.copyFrom($O),this._curSubmit=$_t.RENDERBASE}},$H.setIBVB=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q){if(void 0===$R&&($R=0),void 0===$A&&($A=0),void 0===$q&&($q=0),null===$I){if($J.isFlash){var $f=$T;$f._selfIB||($f._selfIB=$dt.create(35044)),$f._selfIB.clear(),$I=$f._selfIB}else $I=this._ib;$Ot.expandIBQuadrangle($I,$T._byteLength/(4*$T.vertexStride*4))}if(!$e||!$V)throw Error("setIBVB must input:shader shaderValues");var $b=$Rt.create(this,$T,$I,$K,$V,$e,$R,$A,$q);$_||($_=$z.EMPTY),$_.translate($t,$H),$z.mul($_,this._curMat,$b._mat),$_.translate(-$t,-$H),this._submits[this._submits._length++]=$b,this._curSubmit=$_t.RENDERBASE,this._renderKey=0},$H.addRenderObject=function($t){this._submits[this._submits._length++]=$t},$H.fillTrangles=function($t,$H,$I,$T,$K){var $_=this._curSubmit,$V=this._vb,$e=this._shader2D,$R=$_.shaderValue,$A=$T.length>>4,$q=$t.bitmap;this._renderKey=0,$e.glTexture==$q&&$e.ALPHA===$R.ALPHA||(($_=this._curSubmit=$_t.createSubmit(this,this._ib,$V,$V._byteLength/32*3,$st.create(1,0))).shaderValue.textureHost=$t,this._submits[this._submits._length++]=$_),$Ot.fillTranglesVB($V,$H,$I,$T,$K||this._curMat,this._x,this._y),$_._numEle+=6*$A},$H.submitElement=function($t,$H){var $I=this._submits;for($H<0&&($H=$I._length);$t<$H;)$t+=$I[$t].renderSubmit()},$H.finish=function(){$Ct.mainContext.finish()},$H.flush=function(){var $t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($t>this._ib.bufferLength/12&&$Ot.expandIBQuadrangle(this._ib,$t),!this._isMain&&$B.enabled&&$B._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$B._atlasRestore;for(var $H=this._submits,$I=0,$T=$H._length;$I<$T;$I++){var $K=$H[$I];10016===$K.getRenderType()&&$K.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$Ht.instance&&$Ht.getInstance().reset();var $_;for($I=0,$_=this.meshlist.length;$I<$_;$I++){var $V=this.meshlist[$I];$V.canReuse?$V.releaseMesh():$V.destroy()}return this.meshlist.length=0,this._curSubmit=$_t.RENDERBASE,this._renderKey=0,this._triangleMesh=$lt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$H.setPathId=function($t){if(this.mId=$t,-1!=this.mId){this.mHaveKey=!1;var $H=$y.getInstance();$H.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$H.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$H.movePath=function($t,$H){var $I=$t,$T=$H;$t=this._curMat.a*$I+this._curMat.c*$T+this._curMat.tx,$H=this._curMat.b*$I+this._curMat.d*$T+this._curMat.ty,this.mX+=$t,this.mY+=$H},$H.beginPath=function(){var $t=this._getPath();$t.tempArray.length=0,$t.closePath=!1,this.mX=0,this.mY=0},$H.closePath=function(){this._path.closePath=!0},$H.fill=function($t){void 0===$t&&($t=!1);var $H=this._getPath();this.drawPoly(0,0,$H.tempArray,this.fillStyle._color.numColor,0,0,$t)},$H.stroke=function(){var $t=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$t.drawLine(0,0,$t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $H=$y.getInstance().shapeLineDic[this.mId];$H.rebuild($t.tempArray),$t.setGeomtry($H)}else $y.getInstance().addLine(this.mId,$t.drawLine(0,0,$t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$t.update();var $I=[this.mX,this.mY],$T=$_t.createShape(this,$t.ib,$t.vb,$t.count,$t.offset,$st.create(4,0));$T.shaderValue.ALPHA=this._shader2D.ALPHA,$T.shaderValue.u_pos=$I,$T.shaderValue.u_mmat2=$St.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$T,this._renderKey=-1}},$H.line=function($t,$H,$I,$T,$K,$_){var $V=this._curSubmit,$e=this._vb;if($Ot.fillLineVb($e,this._clipRect,$t,$H,$I,$T,$K,$_)){this._renderKey=0;var $R=this._shader2D,$A=$V.shaderValue;$R.strokeStyle===$A.strokeStyle&&$R.ALPHA===$A.ALPHA||($R.glTexture=null,($V=this._curSubmit=$_t.createSubmit(this,this._ib,$e,($e._byteLength-64)/32*3,$st.create(2,0))).shaderValue.strokeStyle=$R.strokeStyle,$V.shaderValue.mainID=2,$V.shaderValue.ALPHA=$R.ALPHA,this._submits[this._submits._length++]=$V),$V._numEle+=6}},$H.moveTo=function($t,$H,$I){void 0===$I&&($I=!0);var $T=this._getPath();if($I){var $K=$t,$_=$H;$t=this._curMat.a*$K+this._curMat.c*$_,$H=this._curMat.b*$K+this._curMat.d*$_}$T.addPoint($t,$H)},$H.lineTo=function($t,$H,$I){void 0===$I&&($I=!0);var $T=this._getPath();if($I){var $K=$t,$_=$H;$t=this._curMat.a*$K+this._curMat.c*$_,$H=this._curMat.b*$K+this._curMat.d*$_}$T.addPoint($t,$H)},$H.drawCurves=function($t,$H,$I){this.setPathId(-1),this.beginPath(),this.strokeStyle=$I[3],this.lineWidth=$I[4];var $T=$I[2];$t+=$I[0],$H+=$I[1],this.movePath($t,$H),this.moveTo($T[0],$T[1]);for(var $K=2,$_=$T.length;$K<$_;)this.quadraticCurveTo($T[$K++],$T[$K++],$T[$K++],$T[$K++]);this.stroke()},$H.arcTo=function($t,$H,$I,$T,$K){if(-1==this.mId||!this.mHaveKey){var $_=0,$V=0,$e=0,$R=this._getPath();this._curMat.copyTo($X._tmpMatrix),$X._tmpMatrix.tx=$X._tmpMatrix.ty=0,$X._tempPoint.setTo($R.getEndPointX(),$R.getEndPointY()),$X._tmpMatrix.invertTransformPoint($X._tempPoint);var $A=$X._tempPoint.x-$t,$q=$X._tempPoint.y-$H,$f=Math.sqrt($A*$A+$q*$q);if(!($f<=1e-6)){var $b=$A/$f,$L=$q/$f,$G=$I-$t,$M=$T-$H,$O=$G*$G+$M*$M,$J=Math.sqrt($O);if(!($J<=1e-6)){var $S=$G/$J,$U=$M/$J,$C=$b+$S,$N=$L+$U,$w=Math.sqrt($C*$C+$N*$N);if(!($w<=1e-6)){var $W=$C/$w,$s=$N/$w,$z=Math.acos($W*$b+$s*$L),$P=Math.PI/2-$z,$k=($f=$K/Math.tan($P))*$b+$t,$r=$f*$L+$H,$x=Math.sqrt($f*$f+$K*$K),$Y=$t+$W*$x,$D=$H+$s*$x,$p=0,$g=0;if(0<=$b*$U-$L*$S){var $l=2*$P/$X.SEGNUM;$p=Math.sin($l),$g=Math.cos($l)}else $l=2*-$P/$X.SEGNUM,$p=Math.sin($l),$g=Math.cos($l);$V=this._curMat.a*$k+this._curMat.c*$r,$e=this._curMat.b*$k+this._curMat.d*$r,$V==this._path.getEndPointX()&&$e==this._path.getEndPointY()||$R.addPoint($V,$e);var $v=$k-$Y,$y=$r-$D;for($_=0;$_<$X.SEGNUM;$_++){var $E=$v*$g+$y*$p,$h=-$v*$p+$y*$g;$V=$E+$Y,$e=$h+$D,$t=this._curMat.a*$V+this._curMat.c*$e,$e=$H=this._curMat.b*$V+this._curMat.d*$e,($V=$t)==this._path.getEndPointX()&&$e==this._path.getEndPointY()||$R.addPoint($V,$e),$v=$E,$y=$h}}}}}},$H.arc=function($t,$H,$I,$T,$K,$_,$V){if(void 0===$_&&($_=!1),void 0===$V&&($V=!0),-1!=this.mId){var $e=$y.getInstance().shapeDic[this.mId];if($e&&this.mHaveKey&&!$e.needUpdate(this._curMat))return;$H=$t=0}var $R,$A=0,$q=0,$f=0,$b=0,$L=0,$G=0,$M=0;if($q=$K-$T,$_)if(Math.abs($q)>=2*Math.PI)$q=2*-Math.PI;else for(;0<$q;)$q-=2*Math.PI;else if(Math.abs($q)>=2*Math.PI)$q=2*Math.PI;else for(;$q<0;)$q+=2*Math.PI;$R=$q/($M=$I<101?Math.max(10,$q*$I/5):$I<201?Math.max(10,$q*$I/20):Math.max(10,$q*$I/40))/2,$f=Math.abs(4/3*(1-Math.cos($R))/Math.sin($R)),$_&&($f=-$f);var $O=this._getPath(),$J=NaN,$S=NaN;for($G=0;$G<=$M;$G++)$A=$T+$q*($G/$M),$b=$t+Math.cos($A)*$I,$L=$H+Math.sin($A)*$I,$V&&($J=$b,$S=$L,$b=this._curMat.a*$J+this._curMat.c*$S,$L=this._curMat.b*$J+this._curMat.d*$S),$b==this._path.getEndPointX()&&$L==this._path.getEndPointY()||$O.addPoint($b,$L);$b=$t+Math.cos($K)*$I,$L=$H+Math.sin($K)*$I,$V&&($J=$b,$S=$L,$b=this._curMat.a*$J+this._curMat.c*$S,$L=this._curMat.b*$J+this._curMat.d*$S),$b==this._path.getEndPointX()&&$L==this._path.getEndPointY()||$O.addPoint($b,$L)},$H.quadraticCurveTo=function($t,$H,$I,$T){var $K=$f.I,$_=$I,$V=$T;$I=this._curMat.a*$_+this._curMat.c*$V,$T=this._curMat.b*$_+this._curMat.d*$V,$_=$t,$V=$H,$t=this._curMat.a*$_+this._curMat.c*$V,$H=this._curMat.b*$_+this._curMat.d*$V;for(var $e=$K.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$t,$H,$I,$T],30,2),$R=0,$A=$e.length/2;$R<$A;$R++)this.lineTo($e[2*$R],$e[2*$R+1],!1);this.lineTo($I,$T,!1)},$H.rect=function($t,$H,$I,$T){this._other=this._other.make(),this._other.path||(this._other.path=new $Q),this._other.path.rect($t,$H,$I,$T)},$H.strokeRect=function($t,$H,$I,$T,$K){var $_=.5*$K;this.line($t-$_,$H,$t+$I+$_,$H,$K,this._curMat),this.line($t+$I,$H,$t+$I,$H+$T,$K,this._curMat),this.line($t,$H,$t,$H+$T,$K,this._curMat),this.line($t-$_,$H+$T,$t+$I+$_,$H+$T,$K,this._curMat)},$H.clip=function(){},$H.drawPoly=function($t,$H,$I,$T,$K,$_,$V){void 0===$V&&($V=!1),this._renderKey=0,this._shader2D.glTexture=null;var $e=this._getPath();if(-1==this.mId)$e.polygon($t,$H,$I,$T,$K||1,$_);else if(this.mHaveKey){var $R=$y.getInstance().shapeDic[this.mId];$R.setMatrix(this._curMat),$R.rebuild($e.tempArray),$e.setGeomtry($R)}else{var $A=$e.polygon($t,$H,$I,$T,$K||1,$_);$y.getInstance().addShape(this.mId,$A),$A.setMatrix(this._curMat)}$e.update();var $q,$f=[this.mX,this.mY];if(($q=$_t.createShape(this,$e.ib,$e.vb,$e.count,$e.offset,$st.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$q.shaderValue.u_pos=$f,$q.shaderValue.u_mmat2=$St.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$q,0<$K){if(this.mHaveLineKey){var $b=$y.getInstance().shapeLineDic[this.mId];$b.rebuild($e.tempArray),$e.setGeomtry($b)}else $y.getInstance().addShape(this.mId,$e.drawLine($t,$H,$I,$K,$_));$e.update(),($q=$_t.createShape(this,$e.ib,$e.vb,$e.count,$e.offset,$st.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$q.shaderValue.u_mmat2=$St.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$q}},$H.drawParticle=function($t,$H,$I){$I.x=$t,$I.y=$H,this._submits[this._submits._length++]=$I},$H._getPath=function(){return this._path||(this._path=new $Q)},$T(0,$H,"globalCompositeOperation",function(){return $u.NAMES[this._nBlendType]},function($t){var $H=$u.TOINT[$t];null==$H||this._nBlendType===$H||($m.save(this,65536,this,!0),this._curSubmit=$_t.RENDERBASE,this._renderKey=0,this._nBlendType=$H)}),$T(0,$H,"strokeStyle",function(){return this._shader2D.strokeStyle},function($t){this._shader2D.strokeStyle.equal($t)||($m.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$$.create($t))}),$T(0,$H,"globalAlpha",function(){return this._shader2D.ALPHA},function($t){($t=Math.floor(1e3*$t)/1e3)!=this._shader2D.ALPHA&&($m.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$t)}),$T(0,$H,"asBitmap",null,function($t){if($t){if(this._targets||(this._targets=new $j),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$T(0,$H,"fillStyle",function(){return this._shader2D.fillStyle},function($t){this._shader2D.fillStyle.equal($t)||($m.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$$.create($t))}),$T(0,$H,"textAlign",function(){return this._other.textAlign},function($t){this._other.textAlign===$t||(this._other=this._other.make(),$m.save(this,32768,this._other,!1),this._other.textAlign=$t)}),$T(0,$H,"lineWidth",function(){return this._other.lineWidth},function($t){this._other.lineWidth===$t||(this._other=this._other.make(),$m.save(this,256,this._other,!1),this._other.lineWidth=$t)}),$T(0,$H,"textBaseline",function(){return this._other.textBaseline},function($t){this._other.textBaseline===$t||(this._other=this._other.make(),$m.save(this,16384,this._other,!1),this._other.textBaseline=$t)}),$T(0,$H,"font",null,function($t){$t!=this._other.font.toString()&&(this._other=this._other.make(),$m.save(this,8,this._other,!1),this._other.font===$Gt.EMPTY?this._other.font=new $Gt($t):this._other.font.setFont($t))}),$X.__init__=function(){$I.DEFAULT=new $I},$X._tempPoint=new $P,$X._SUBMITVBSIZE=32e3,$X._MAXSIZE=99999999,$X._RECTVBSIZE=16,$X.MAXCLIPRECT=new $k(0,0,99999999,99999999),$X._COUNT=0,$X._tmpMatrix=new $z,$X.SEGNUM=32,$X._contextcount=0,$V($X,["_fontTemp",function(){return this._fontTemp=new $Gt},"_drawStyleTemp",function(){return this._drawStyleTemp=new $$(null)}]),$X.__init$=function(){$I=function(){function $t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$Gt.EMPTY}$b($t,"");var $H=$t.prototype;return $H.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$Gt.EMPTY},$H.make=function(){return this===$t.DEFAULT?new $t:this},$t.DEFAULT=null,$t}()},$X}(),$st=function($t){function $T($t,$H){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$T.__super.call(this),this.defines=new $rt,this.position=$T._POSITION,this.mainID=$t,this.subID=$H,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$t|$H,this._inClassCache=$T._cache[this._cacheID],0<$t&&!this._inClassCache&&(this._inClassCache=$T._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$b($T,"laya.webgl.shader.d2.value.Value2D",$h);var $H=$T.prototype;return $H.setValue=function($t){},$H.refresh=function(){var $t=this.size;return $t[0]=$St.width,$t[1]=$St.height,this.alpha=this.ALPHA*$St.worldAlpha,this.mmat=$St.worldMatrix4,this},$H._ShaderWithCompile=function(){return $Ft.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$jt.create)},$H._withWorldShaderDefines=function(){var $t=$St.worldShaderDefines,$H=$Ft.sharders[this.mainID|this.defines._value|$t.getValue()];if(!$H){var $I,$T={};for($I in this.defines.toNameDic())$T[$I]="";for($I in $t.toNameDic())$T[$I]="";$H=$Ft.withCompile2D(0,this.mainID,$T,this.mainID|this.defines._value|$t.getValue(),$jt.create)}var $K=$St.worldFilters;if(!$K)return $H;for(var $_,$V=$K.length,$e=0;$e<$V;$e++)($_=$K[$e])&&$_.action.setValue(this);return $H},$H.upload=function(){var $t=$St;this.alpha=this.ALPHA*$t.worldAlpha,$St.worldMatrix4!==$St.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$Ct.shaderHighPrecision&&this.defines.add(1024);var $H,$I=$t.worldShaderDefines?this._withWorldShaderDefines():$Ft.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$t.width,this.size[1]=$t.height,this.mmat=$t.worldMatrix4,$vt.activeShader!==$I?$I._shaderValueWidth!==$t.width||$I._shaderValueHeight!==$t.height?($I._shaderValueWidth=$t.width,$I._shaderValueHeight=$t.height):$H=$I._params2dQuick2||$I._make2dQuick2():$I._shaderValueWidth!==$t.width||$I._shaderValueHeight!==$t.height?($I._shaderValueWidth=$t.width,$I._shaderValueHeight=$t.height):$H=$I._params2dQuick1||$I._make2dQuick1(),$I.upload(this,$H)},$H.setFilters=function($t){if(this.filters=$t)for(var $H,$I=$t.length,$T=0;$T<$I;$T++)($H=$t[$T])&&(this.defines.add($H.type),$H.action.setValue(this))},$H.clear=function(){this.defines.setValue(this.subID)},$H.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$T._initone=function($t,$H){$T._typeClass[$t]=$H,$T._cache[$t]=[],$T._cache[$t]._length=0},$T.__init__=function(){$T._POSITION=[2,5126,!1,4*$Mt.BYTES_PE,0],$T._TEXCOORD=[2,5126,!1,4*$Mt.BYTES_PE,2*$Mt.BYTES_PE],$T._initone(2,$Xt),$T._initone(4,$ut),$T._initone(256,$Bt),$T._initone(512,$ht),$T._initone(1,$at),$T._initone(65,$it),$T._initone(9,$at)},$T.create=function($t,$H){var $I=$T._cache[$t|$H];return $I._length?$I[--$I._length]:new $T._typeClass[$t|$H]($H)},$T._POSITION=null,$T._TEXCOORD=null,$T._cache=[],$T._typeClass=[],$T.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$T}(),$zt=function($t){function $O($t,$H){$O.__super.call(this,$t,$H)}$b($O,"laya.webgl.utils.RenderSprite3D",$S);var $H=$O.prototype;return $H.onCreate=function($t){switch($t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$H._mask=function($t,$H,$I,$T){var $K,$_,$V=this._next,$e=$t.mask;if($e){$H.ctx.save();var $R=$H.ctx.globalCompositeOperation,$A=new $k;if($A.copyFrom($e.getBounds()),$A.width=Math.round($A.width),$A.height=Math.round($A.height),$A.x=Math.round($A.x),$A.y=Math.round($A.y),0<$A.width&&0<$A.height){var $q=$t._style._tf,$f=$et.create();$f.addValue("bounds",$A),$K=$Vt.create([$f,$H],laya.webgl.utils.RenderSprite3D.tmpTarget),$H.addRenderObject($K),$e.render($H,-$A.x,-$A.y),$K=$Vt.create([$f],laya.webgl.utils.RenderSprite3D.endTmpTarget),$H.addRenderObject($K),$H.ctx.save(),$H.clipRect($I-$q.translateX+$A.x,$T-$q.translateY+$A.y,$A.width,$A.height),$V._fun.call($V,$t,$H,$I,$T),$H.ctx.restore(),$_=$qt.create(6),$R=$H.ctx.globalCompositeOperation,$_.blendMode="mask",$H.addRenderObject($_),$z.TEMP.identity();var $b=$st.create(1,0),$L=$l.INV_UV,$G=$A.width,$M=$A.height;($A.width<32||$A.height<32)&&(($L=$O.tempUV)[0]=0,$L[1]=0,$L[2]=32<=$A.width?1:$A.width/32,$L[3]=0,$L[4]=32<=$A.width?1:$A.width/32,$L[5]=32<=$A.height?1:$A.height/32,$L[6]=0,$L[7]=32<=$A.height?1:$A.height/32,$A.width=32<=$A.width?$A.width:32,$A.height=32<=$A.height?$A.height:32,$L[1]*=-1,$L[3]*=-1,$L[5]*=-1,$L[7]*=-1,$L[1]+=1,$L[3]+=1,$L[5]+=1,$L[7]+=1),$H.ctx.drawTarget($f,$I+$A.x-$q.translateX,$T+$A.y-$q.translateY,$G,$M,$z.TEMP,"tmpTarget",$b,$L,6),$K=$Vt.create([$f],laya.webgl.utils.RenderSprite3D.recycleTarget),$H.addRenderObject($K),($_=$qt.create(6)).blendMode=$R,$H.addRenderObject($_)}$H.ctx.restore()}else $V._fun.call($V,$t,$H,$I,$T)},$H._blend=function($t,$H,$I,$T){var $K=$t._style,$_=this._next;$K.blendMode?($H.ctx.save(),$H.ctx.globalCompositeOperation=$K.blendMode,$_._fun.call($_,$t,$H,$I,$T),$H.ctx.restore()):$_._fun.call($_,$t,$H,$I,$T)},$H._transform=function($t,$H,$I,$T){var $K=$t.transform,$_=this._next;if($K&&$_!=$S.NORENDER){var $V=$H.ctx;$t._style;$K.tx=$I,$K.ty=$T;var $e=$V._getTransformMatrix(),$R=$e.clone();$z.mul($K,$e,$e),$e._checkTransform(),$K.tx=$K.ty=0,$_._fun.call($_,$t,$H,0,0),$R.copyTo($e),$R.destroy()}else $_._fun.call($_,$t,$H,$I,$T)},$O.tmpTarget=function($t,$H){var $I=$t.getValue("bounds"),$T=$yt.create($I.width,$I.height);$T.start(),$T.clear(0,0,0,0),$t.addValue("tmpTarget",$T)},$O.endTmpTarget=function($t){$t.getValue("tmpTarget").end()},$O.recycleTarget=function($t){$t.getValue("tmpTarget").recycle(),$t.recycle()},$V($O,["tempUV",function(){return this.tempUV=new Array(8)}]),$O}(),$Pt=function($t){function $H(){this.data=null,$H.__super.call(this)}$b($H,"laya.filters.webgl.ColorFilterActionGL",$E);var $I=$H.prototype;return $w.imps($I,{"laya.filters.IFilterActionGL":!0}),$I.setValue=function($t){$t.colorMat=this.data._mat,$t.colorAlpha=this.data._alpha},$I.apply3d=function($t,$H,$I,$T,$K){var $_=$t.getValue("bounds"),$V=$st.create(1,0);$V.setFilters([this.data]);var $e=$z.TEMP;$e.identity(),$I.ctx.drawTarget($t,0,0,$_.width,$_.height,$e,"src",$V)},$H}(),$kt=function($t){function $_($t,$H,$I,$T,$K){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$_.__super.call(this,$t,$H,$K),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $$t,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$I,this._atlasCanvas.height=$T,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$b($_,"laya.webgl.atlas.Atlaser",$X);var $H=$_.prototype;return $H.computeUVinAtlasTexture=function($t,$H,$I,$T){var $K=$B.atlasTextureWidth,$_=$B.atlasTextureHeight,$V=$I/$K,$e=$T/$_,$R=($I+$t.bitmap.width)/$K,$A=($T+$t.bitmap.height)/$_,$q=$t.bitmap.width/$K,$f=$t.bitmap.height/$_;$t.uv=[$V+$H[0]*$q,$e+$H[1]*$f,$R-(1-$H[2])*$q,$e+$H[3]*$f,$R-(1-$H[4])*$q,$A-(1-$H[5])*$f,$V+$H[6]*$q,$A-(1-$H[7])*$f]},$H.findBitmapIsExist=function($t){if($t instanceof laya.webgl.resource.WebGLImage){var $H=$t,$I=$H.url,$T=this._InAtlasWebGLImagesKey[$I||$H.id];if($T)return $T.offsetInfoID}return-1},$H.addToAtlasTexture=function($t,$H,$I){if($t instanceof laya.webgl.resource.WebGLImage){var $T=$t,$K=$T.url;this._InAtlasWebGLImagesKey[$K||$T.id]={bitmap:$t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$H,$I])}this._atlasCanvas.texSubImage2D($H,$I,$t.atlasSource),$t.clearAtlasSource()},$H.addToAtlas=function($t,$H,$I){$t._atlasID=this._inAtlasTextureKey.length;var $T=$t.uv.slice(),$K=$t.bitmap;this._inAtlasTextureKey.push($t),this._inAtlasTextureOriUVValue.push($T),this._inAtlasTextureBitmapValue.push($K),this.computeUVinAtlasTexture($t,$T,$H,$I),$t.bitmap=this._atlasCanvas},$H.clear=function(){for(var $t=0,$H=this._inAtlasTextureKey.length;$t<$H;$t++)this._inAtlasTextureKey[$t].bitmap=this._inAtlasTextureBitmapValue[$t],this._inAtlasTextureKey[$t].uv=this._inAtlasTextureOriUVValue[$t],this._inAtlasTextureKey[$t]._atlasID=-1,this._inAtlasTextureKey[$t].bitmap.lock=!1,this._inAtlasTextureKey[$t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$H.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$T(0,$H,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$T(0,$H,"texture",function(){return this._atlasCanvas}),$T(0,$H,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$_}(),$rt=function($t){function $I(){$I.__super.call(this,$I.__name2int,$I.__int2name,$I.__int2nameMap)}return $b($I,"laya.webgl.shader.d2.ShaderDefines2D",$Z),$I.__init__=function(){$I.reg("TEXTURE2D",1),$I.reg("COLOR2D",2),$I.reg("PRIMITIVE",4),$I.reg("GLOW_FILTER",8),$I.reg("BLUR_FILTER",16),$I.reg("COLOR_FILTER",32),$I.reg("COLOR_ADD",64),$I.reg("WORLDMAT",128),$I.reg("FILLTEXTURE",256),$I.reg("FSHIGHPRECISION",1024),$I.reg("TXTALPHA",2048),$I.reg("TXTCOMPRESS",4096)},$I.reg=function($t,$H){$Z._reg($t,$H,$I.__name2int,$I.__int2name)},$I.toText=function($t,$H,$I){return $Z._toText($t,$H,$I)},$I.toInt=function($t){return $Z._toInt($t,$I.__name2int)},$I.TEXTURE2D=1,$I.COLOR2D=2,$I.PRIMITIVE=4,$I.FILTERGLOW=8,$I.FILTERBLUR=16,$I.FILTERCOLOR=32,$I.COLORADD=64,$I.WORLDMAT=128,$I.FILLTEXTURE=256,$I.SKINMESH=512,$I.SHADERDEFINE_FSHIGHPRECISION=1024,$I.TXTALPHA=2048,$I.TXTCOMPRESS=4096,$I.__name2int={},$I.__int2name=[],$I.__int2nameMap=[],$I}(),$xt=(function($t){function $e($t,$H,$I,$T,$K,$_,$V){$e.__super.call(this,$t,$H,$I,$T,40,$K,$_,$V)}$b($e,"laya.webgl.shapes.Ellipse",$It)}(),function($t){function $_($t,$H,$I,$T,$K){this._points=[],this.rebuild($I),$_.__super.call(this,$t,$H,0,0,0,$K,$T,$K,0)}$b($_,"laya.webgl.shapes.Line",$It);var $H=$_.prototype;return $H.rebuild=function($t){var $H=$t.length;$H!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($H/2-1)),this.mFloat32Array=new Float32Array(5*$H)),this._points.length=0;for(var $I=NaN,$T=NaN,$K=-1,$_=-1,$V=$t.length/2,$e=0;$e<$V;$e++)$I=$t[2*$e],$T=$t[2*$e+1],(.01<Math.abs($K-$I)||.01<Math.abs($_-$T))&&this._points.push($I,$T),$K=$I,$_=$T},$H.getData=function($t,$H,$I){var $T=[],$K=[];0<this.borderWidth&&this.createLine2(this._points,$T,this.borderWidth,$I,$K,this._points.length/2),this.mUint16Array.set($T,0),this.mFloat32Array.set($K,0),$t.append(this.mUint16Array),$H.append(this.mFloat32Array)},$_}()),$Yt=function($t){function $f($t,$H,$I,$T,$K){this._points=[];for(var $_=NaN,$V=NaN,$e=-1,$R=-1,$A=$I.length/2-1,$q=0;$q<$A;$q++)$_=$I[2*$q],$V=$I[2*$q+1],(.01<Math.abs($e-$_)||.01<Math.abs($R-$V))&&this._points.push($_,$V),$e=$_,$R=$V;$_=$I[2*$A],$V=$I[2*$A+1],$e=this._points[0],$R=this._points[1],(.01<Math.abs($e-$_)||.01<Math.abs($R-$V))&&this._points.push($_,$V),$f.__super.call(this,$t,$H,0,0,this._points.length/2,0,$T,$K)}$b($f,"laya.webgl.shapes.LoopLine",$It);var $H=$f.prototype;return $H.getData=function($t,$H,$I){if(0<this.borderWidth){for(var $T=this.color,$K=($T>>16&255)/255,$_=($T>>8&255)/255,$V=(255&$T)/255,$e=[],$R=0,$A=0,$q=[],$f=Math.floor(this._points.length/2),$b=0;$b<$f;$b++)$R=this._points[2*$b],$A=this._points[2*$b+1],$e.push(this.x+$R,this.y+$A,$K,$_,$V);this.createLoopLine($e,$q,this.borderWidth,$I+$e.length/5),$t.append(new Uint16Array($q)),$H.append(new Float32Array($e))}},$H.createLoopLine=function($t,$H,$I,$T,$K,$_){$t.length;var $V=$t.concat(),$e=$K||$t,$R=this.borderColor,$A=($R>>16&255)/255,$q=($R>>8&255)/255,$f=(255&$R)/255,$b=[$V[0],$V[1]],$L=[$V[$V.length-5],$V[$V.length-4]],$G=$L[0]+.5*($b[0]-$L[0]),$M=$L[1]+.5*($b[1]-$L[1]);$V.unshift($G,$M,0,0,0),$V.push($G,$M,0,0,0);var $O,$J,$S,$U,$C,$N,$w,$W,$s,$z,$P,$k,$r,$x,$Y,$D,$p,$g,$l,$v,$y=$V.length/5,$E=$T,$h=$I/2;$S=$V[0],$U=$V[1],$z=$S-($C=$V[5]),$s=($s=-($U-($N=$V[6])))/($v=Math.sqrt($s*$s+$z*$z))*$h,$z=$z/$v*$h,$e.push($S-$s,$U-$z,$A,$q,$f,$S+$s,$U+$z,$A,$q,$f);for(var $X=1;$X<$y-1;$X++)$S=$V[5*($X-1)],$U=$V[5*($X-1)+1],$C=$V[5*$X],$N=$V[5*$X+1],$w=$V[5*($X+1)],$W=$V[5*($X+1)+1],$z=$S-$C,$k=$C-$w,$Y=(-($s=($s=-($U-$N))/($v=Math.sqrt($s*$s+$z*$z))*$h)+$S)*(-($z=$z/$v*$h)+$N)-(-$s+$C)*(-$z+$U),$g=(-($P=($P=-($N-$W))/($v=Math.sqrt($P*$P+$k*$k))*$h)+$w)*(-($k=$k/$v*$h)+$N)-(-$P+$C)*(-$k+$W),$l=($r=-$z+$U-(-$z+$N))*($p=-$P+$C-(-$P+$w))-($D=-$k+$W-(-$k+$N))*($x=-$s+$C-(-$s+$S)),Math.abs($l)<.1?($l+=10.1,$e.push($C-$s,$N-$z,$A,$q,$f,$C+$s,$N+$z,$A,$q,$f)):((($O=($x*$g-$p*$Y)/$l)-$C)*($O-$C)+(($J=($D*$Y-$r*$g)/$l)-$N)+($J-$N),$e.push($O,$J,$A,$q,$f,$C-($O-$C),$N-($J-$N),$A,$q,$f));$_&&($H=$_);var $B=this.edges+1;for($X=1;$X<$B;$X++)$H.push($E+2*($X-1),$E+2*($X-1)+1,$E+2*$X+1,$E+2*$X+1,$E+2*$X,$E+2*($X-1));return $H.push($E+2*($X-1),$E+2*($X-1)+1,$E+1,$E+1,$E,$E+2*($X-1)),$e},$f}(),$Dt=function($t){function $V($t,$H,$I,$T,$K,$_){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$z.create(),this._points=$I.slice(0,$I.length),$V.__super.call(this,$t,$H,0,0,this._points.length/2,$T,$K,$_)}$b($V,"laya.webgl.shapes.Polygon",$It);var $H=$V.prototype;return $H.rebuild=function($t){this._repaint||(this._points.length=0,this._points=this._points.concat($t))},$H.setMatrix=function($t){$t.copyTo(this._mat)},$H.needUpdate=function($t){return this._repaint=this._mat.a==$t.a&&this._mat.b==$t.b&&this._mat.c==$t.c&&this._mat.d==$t.d&&this._mat.tx==$t.tx&&this._mat.ty==$t.ty,!this._repaint},$H.getData=function($t,$H,$I){var $T,$K=0,$_=this._points,$V=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$I){for(this._start=$I,$T=[],$V=this.earcutTriangles.length,$K=0;$K<$V;$K++)$T.push(this.earcutTriangles[$K]+$I);this.mUint16Array=new Uint16Array($T)}}else{this._start=$I,$T=[];var $e=[],$R=[],$A=this.color,$q=($A>>16&255)/255,$f=($A>>8&255)/255,$b=(255&$A)/255;for($V=Math.floor($_.length/2),$K=0;$K<$V;$K++)$e.push(this.x+$_[2*$K],this.y+$_[2*$K+1],$q,$f,$b),$R.push(this.x+$_[2*$K],this.y+$_[2*$K+1]);for(this.earcutTriangles=$Tt.earcut($R,null,2),$V=this.earcutTriangles.length,$K=0;$K<$V;$K++)$T.push(this.earcutTriangles[$K]+$I);this.mUint16Array=new Uint16Array($T),this.mFloat32Array=new Float32Array($e)}$t.append(this.mUint16Array),$H.append(this.mFloat32Array)},$V}(),$pt=function($t){function $_(){this._matrix=new $z,this._matrix4=$Mt.defaultMatrix4.concat(),$_.__super.call(this,1e4),this.shaderValue=new $st(0,0)}$b($_,"laya.webgl.submit.SubmitCanvas",$_t);var $H=$_.prototype;return $H.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $t=$St.worldAlpha,$H=$St.worldMatrix4,$I=$St.worldMatrix,$T=$St.worldFilters,$K=$St.worldShaderDefines,$_=this.shaderValue,$V=this._matrix,$e=this._matrix4,$R=$z.TEMP;return $z.mul($V,$I,$R),$e[0]=$R.a,$e[1]=$R.b,$e[4]=$R.c,$e[5]=$R.d,$e[12]=$R.tx,$e[13]=$R.ty,$St.worldMatrix=$R.clone(),$St.worldMatrix4=$e,$St.worldAlpha=$St.worldAlpha*$_.alpha,$_.filters&&$_.filters.length&&($St.worldFilters=$_.filters,$St.worldShaderDefines=$_.defines),this._ctx_src.flush(),$St.worldAlpha=$t,$St.worldMatrix4=$H,$St.worldMatrix.destroy(),$St.worldMatrix=$I,$St.worldFilters=$T,$St.worldShaderDefines=$K,1},$H.releaseRender=function(){var $t=$_._cache;this._ctx_src=null,$t[$t._length++]=this},$H.getRenderType=function(){return 10003},$_.create=function($t,$H,$I){var $T=$_._cache._length?$_._cache[--$_._cache._length]:new $_;$T._ctx_src=$t;var $K=$T.shaderValue;return $K.alpha=$H,$K.defines.setValue(0),$I&&$I.length&&$K.setFilters($I),$T},$_._cache=(($_._cache=[])._length=0,$_._cache),$_}(),$gt=function($t){function $A($t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$t&&($t=1e4),$A.__super.call(this,$t)}$b($A,"laya.webgl.submit.SubmitTexture",$_t);var $H=$A.prototype;return $H.releaseRender=function(){var $t=$A._cache;($t[$t._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$H.addTexture=function($t,$H){this._texsID[this._texs.length]=$t._uvID,this._texs.push($t),this._vbPos.push($H)},$H.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $t=this.shaderValue.textureHost.bitmap;if(null!==$t)for(var $H=this._vb.getFloat32Array(),$I=0,$T=this._texs.length;$I<$T;$I++){var $K=this._texs[$I];$K.active();var $_=$K.uv;if(this._texsID[$I]!==$K._uvID){this._texsID[$I]=$K._uvID;var $V=this._vbPos[$I];$H[$V+2]=$_[0],$H[$V+3]=$_[1],$H[$V+6]=$_[2],$H[$V+7]=$_[3],$H[$V+10]=$_[4],$H[$V+11]=$_[5],$H[$V+14]=$_[6],$H[$V+15]=$_[7],this._vb.setNeedUpload()}$K.bitmap!==$t&&(this._isSameTexture=!1)}}},$H.renderSubmit=function(){if(0===this._numEle)return $A._shaderSet=!1,1;var $t=this.shaderValue.textureHost;if($t){var $H=$t.source;if(!$t.bitmap||!$H)return $A._shaderSet=!1,1;this.shaderValue.texture=$H,$t.alphaTexture&&$t.alphaTexture.source&&(this.shaderValue.texture1=$t.alphaTexture.source)}this._vb.bind_upload(this._ib);var $I=$Ct.mainContext;if($u.activeBlendFunction!==this._blendFn&&($I.enable(3042),this._blendFn($I),$u.activeBlendFunction=this._blendFn),$Y.drawCall++,$Y.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$vt.activeShader&&$A._shaderSet?($vt.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$vt.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$A._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $T=$t.bitmap,$K=0,$_=$vt.activeShader,$V=0,$e=this._texs.length;$V<$e;$V++){var $R=this._texs[$V];$R.bitmap===$T&&$V+1!==$e||($_.uploadTexture2D($R.source),$I.drawElements(4,6*($V-$K+1),5123,this._startIdx+6*$K*$Mt.BYTES_PIDX),$T=$R.bitmap,$K=$V)}else $I.drawElements(4,this._numEle,5123,this._startIdx);return 1},$A.create=function($t,$H,$I,$T,$K){var $_=$A._cache._length?$A._cache[--$A._cache._length]:new $A;null==$I&&(($I=$_._selfVb||($_._selfVb=$Zt.create(-1))).clear(),$T=0),$_._ib=$H,$_._vb=$I,$_._startIdx=$T*$Mt.BYTES_PIDX,$_._numEle=0;var $V=$t._nBlendType;$_._blendFn=$t._targets?$u.targetFns[$V]:$u.fns[$V],$_.shaderValue=$K,$_.shaderValue.setValue($t._shader2D);var $e=$t._shader2D.filters;return $e&&$_.shaderValue.setFilters($e),$_},$A._cache=(($A._cache=[])._length=0,$A._cache),$A._shaderSet=!0,$A}(),$lt=function($t){function $J(){$J.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$b($J,"laya.webgl.utils.MeshTexture",$Jt);var $H=$J.prototype;return $H.addData=function($t,$H,$I,$T,$K,$_){for(var $V=$t.length/2,$e=this._vb.needSize($V*$J.const_stride)>>2,$R=this._vb.getFloat32Array(),$A=0,$q=0;$q<$V;$q++){var $f=$t[$A],$b=$t[$A+1],$L=$f*$T.a+$b*$T.c+$T.tx,$G=$f*$T.b+$b*$T.d+$T.ty;$R[$e++]=$L,$R[$e++]=$G,$R[$e++]=$H[$A],$R[$e++]=$H[$A+1],$A+=2}this._vb.setNeedUpload();var $M=this.vertNum;if(0<$M){($V=$I.length)>$J.tmpIdx.length&&($J.tmpIdx=new Uint16Array($V));for(var $O=0;$O<$V;$O++)$J.tmpIdx[$O]=$I[$O]+$M;this._ib.appendU16Array($J.tmpIdx,$I.length)}else this._ib.append($I);this._ib.setNeedUpload(),this.vertNum+=$V,this.indexNum+=$I.length},$H.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$H.destroy=function(){this._ib.destroy(),this._vb.destroy()},$J.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $J},$J.const_stride=16,$J._POOL=[],$V($J,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$J}(),$vt=function($t){function $H(){$H.__super.call(this),this.lock=!0}return $b($H,"laya.webgl.shader.BaseShader",$U),$H.activeShader=null,$H.bindShader=null,$H}(),$yt=function($H){function $q($t,$H,$I,$T,$K,$_,$V,$e,$R){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$I&&($I=6408),void 0===$T&&($T=5121),void 0===$K&&($K=34041),void 0===$_&&($_=!1),void 0===$V&&($V=!1),void 0===$e&&($e=-1),void 0===$R&&($R=-1),this._type=1,this._w=$t,this._h=$H,this._surfaceFormat=$I,this._surfaceType=$T,this._depthStencilFormat=$K,$J.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$_,this._repeat=$V,this._minFifter=$e,this._magFifter=$R,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$q.__super.call(this,this.bitmap,$l.INV_UV)}$b($q,"laya.webgl.resource.RenderTarget2D",$H);var $t=$q.prototype;return $w.imps($t,{"laya.resource.IDispose":!0}),$t.getType=function(){return this._type},$t.getTexture=function(){return this},$t.size=function($t,$H){this._w==$t&&this._h==$H||(this._w=$t,this._h=$H,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$t.release=function(){this.destroy()},$t.recycle=function(){$q.POOL.push(this)},$t.start=function(){var $t=$Ct.mainContext;return this._preRenderTarget=$St.curRenderTarget,$St.curRenderTarget=this,$t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($t.viewport(0,0,this._w,this._h),this._svWidth=$St.width,this._svHeight=$St.height,$St.width=this._w,$St.height=this._h,$vt.activeShader=null),this},$t.clear=function($t,$H,$I,$T){void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=1);var $K=$Ct.mainContext;$K.clearColor($t,$H,$I,$T);var $_=16384;switch(this._depthStencilFormat){case 33189:$_|=256;break;case 36168:$_|=1024;break;case 34041:$_|=256,$_|=1024}$K.clear($_)},$t.end=function(){var $t=$Ct.mainContext;$t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$St.curRenderTarget=this._preRenderTarget,1==this._type?($t.viewport(0,0,this._svWidth,this._svHeight),$St.width=this._svWidth,$St.height=this._svHeight,$vt.activeShader=null):$t.viewport(0,0,$w.stage.width,$w.stage.height)},$t.getData=function($t,$H,$I,$T){var $K=$Ct.mainContext;if($K.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$K.checkFramebufferStatus(36160)))return $K.bindFramebuffer(36160,null),null;var $_=new Uint8Array(this._w*this._h*4);return $K.readPixels($t,$H,$I,$T,this._surfaceFormat,this._surfaceType,$_),$K.bindFramebuffer(36160,null),$_},$t.destroy=function($t){void 0===$t&&($t=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$H.prototype.destroy.call(this))},$t.dispose=function(){},$t._createWebGLRenderTarget=function(){this.bitmap=new $ot(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($t){this.event("recovered")})},$T(0,$t,"surfaceFormat",function(){return this._surfaceFormat}),$T(0,$t,"magFifter",function(){return this._magFifter}),$T(0,$t,"surfaceType",function(){return this._surfaceType}),$T(0,$t,"mipMap",function(){return this._mipMap}),$T(0,$t,"depthStencilFormat",function(){return this._depthStencilFormat}),$T(0,$t,"minFifter",function(){return this._minFifter}),$T(0,$t,"source",function(){return this._alreadyResolved?$w.superGet($l,this,"source"):null}),$q.create=function($t,$H,$I,$T,$K,$_,$V,$e,$R){void 0===$I&&($I=6408),void 0===$T&&($T=5121),void 0===$K&&($K=34041),void 0===$_&&($_=!1),void 0===$V&&($V=!1),void 0===$e&&($e=-1),void 0===$R&&($R=-1);var $A=$q.POOL.pop();return $A||($A=new $q($t,$H)),$A.bitmap&&$A._w==$t&&$A._h==$H&&$A._surfaceFormat==$I&&$A._surfaceType==$T&&$A._depthStencilFormat==$K&&$A._mipMap==$_&&$A._repeat==$V&&$A._minFifter==$e&&$A._magFifter==$R||($A._w=$t,$A._h=$H,$A._surfaceFormat=$I,$A._surfaceType=$T,$A._depthStencilFormat=$K,$J.isConchWebGL&&34041===$A._depthStencilFormat&&($A._depthStencilFormat=33189),$A._mipMap=$_,$A._repeat=$V,$A._minFifter=$e,$A._magFifter=$R,$A.release(),$A._createWebGLRenderTarget()),$A},$q.TYPE2D=1,$q.TYPE3D=2,$q.POOL=[],$q}($l),$Et=function($t){function $H(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$H.__super.call(this),$H._gl=$Ct.mainContext}$b($H,"laya.webgl.utils.Buffer",$U);var $I=$H.prototype;return $I._bind=function(){this.activeResource(),$H._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($H._bindVertexBuffer=this._glBuffer),$H._gl.bindBuffer(this._bufferType,$H._bindActive[this._bufferType]=this._glBuffer),$vt.activeShader=null)},$I.recreateResource=function(){this._glBuffer||(this._glBuffer=$H._gl.createBuffer()),this.completeCreate()},$I.disposeResource=function(){this._glBuffer&&($Ct.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$T(0,$I,"bufferUsage",function(){return this._bufferUsage}),$H._gl=null,$H._bindActive={},$H._bindVertexBuffer=null,$H._enableAtributes=[],$H}(),$ht=function($t){function $I($t){this.texcoord=null,this.offsetX=300,this.offsetY=0,$I.__super.call(this,512,0);var $H=8*$Mt.BYTES_PE;this.position=[2,5126,!1,$H,0],this.texcoord=[2,5126,!1,$H,2*$Mt.BYTES_PE],this.color=[4,5126,!1,$H,4*$Mt.BYTES_PE]}return $b($I,"laya.webgl.shader.d2.skinAnishader.SkinSV",$st),$I}(),$Xt=function($t){function $H($t){$H.__super.call(this,2,0),this.color=[]}return $b($H,"laya.webgl.shader.d2.value.Color2dSV",$st),$H.prototype.setValue=function($t){$t.fillStyle&&(this.color=$t.fillStyle._color._color),$t.strokeStyle&&(this.color=$t.strokeStyle._color._color)},$H}(),$Bt=function($t){function $H($t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$st._TEXCOORD,$H.__super.call(this,256,0)}$b($H,"laya.webgl.shader.d2.value.FillTextureSV",$st);var $I=$H.prototype;return $I.setValue=function($t){this.ALPHA=$t.ALPHA,$t.filters&&this.setFilters($t.filters)},$I.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$H}(),$at=function($t){function $H($t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$st._TEXCOORD,void 0===$t&&($t=0),$H.__super.call(this,1,$t)}$b($H,"laya.webgl.shader.d2.value.TextureSV",$st);var $I=$H.prototype;return $I.setValue=function($t){this.ALPHA=$t.ALPHA,$t.filters&&this.setFilters($t.filters)},$I.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$H}(),$ut=function($t){function $H($t){this.a_color=null,this.u_pos=[0,0],$H.__super.call(this,4,0),this.position=[2,5126,!1,5*$Mt.BYTES_PE,0],this.a_color=[3,5126,!1,5*$Mt.BYTES_PE,2*$Mt.BYTES_PE]}return $b($H,"laya.webgl.shader.d2.value.PrimitiveSV",$st),$H}(),$$t=function($t){function $H(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$H.__super.call(this)}$b($H,"laya.webgl.atlas.AtlasWebGLCanvas",$t);var $I=$H.prototype;return $I.recreateResource=function(){var $t=$Ct.mainContext,$H=this._source=$t.createTexture(),$I=$Nt.curBindTexTarget,$T=$Nt.curBindTexValue;$Nt.bindTexture($t,3553,$H),$t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$t.texParameteri(3553,10241,9729),$t.texParameteri(3553,10240,9729),$t.texParameteri(3553,10242,33071),$t.texParameteri(3553,10243,33071),$I&&$T&&$Nt.bindTexture($t,$I,$T),this.memorySize=this._w*this._h*4,this.completeCreate()},$I.disposeResource=function(){this._source&&($Ct.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$I.texSubImage2D=function($t,$H,$I){if($J.isFlash){this._flashCacheImage||(this._flashCacheImage=$M.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $T=$I.bitmapdata;this._flashCacheImage._image.copyPixels($T,0,0,$T.width,$T.height,$t,$H),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $K=$Ct.mainContext,$_=$Nt.curBindTexTarget,$V=$Nt.curBindTexValue;$Nt.bindTexture($K,3553,this._source),$K.pixelStorei(37441,!0),0<=$t-1&&$K.texSubImage2D(3553,0,$t-1,$H,6408,5121,$I),$t+1<=this._w&&$K.texSubImage2D(3553,0,$t+1,$H,6408,5121,$I),0<=$H-1&&$K.texSubImage2D(3553,0,$t,$H-1,6408,5121,$I),$H+1<=this._h&&$K.texSubImage2D(3553,0,$t,$H+1,6408,5121,$I),$K.texSubImage2D(3553,0,$t,$H,6408,5121,$I),$K.pixelStorei(37441,!1),$_&&$V&&$Nt.bindTexture($K,$_,$V)}},$I.texSubImage2DPixel=function($t,$H,$I,$T,$K){var $_=$Ct.mainContext,$V=$Nt.curBindTexTarget,$e=$Nt.curBindTexValue;$Nt.bindTexture($_,3553,this._source);var $R=new Uint8Array($K.data);$_.pixelStorei(37441,!0),$_.texSubImage2D(3553,0,$t,$H,$I,$T,6408,5121,$R),$_.pixelStorei(37441,!1),$V&&$e&&$Nt.bindTexture($_,$V,$e)},$T(0,$I,"width",$t.prototype._$get_width,function($t){this._w=$t}),$T(0,$I,"height",$t.prototype._$get_height,function($t){this._h=$t}),$H}($I),$Qt=function($t){function $K(){this.flipY=!0,this.alwaysChange=!1,$K.__super.call(this)}$b($K,"laya.webgl.resource.WebGLCanvas",$I);var $H=$K.prototype;return $H.getCanvas=function(){return this._canvas},$H.clear=function(){this._ctx&&this._ctx.clear()},$H.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$H._setContext=function($t){this._ctx=$t},$H.getContext=function($t,$H){return this._ctx?this._ctx:this._ctx=$K._createContext(this)},$H.size=function($t,$H){this._w==$t&&this._h==$H||(this._w=$t,this._h=$H,this._ctx&&this._ctx.size($t,$H),this._canvas&&(this._canvas.height=$H,this._canvas.width=$t))},$H.activeResource=function($t){void 0===$t&&($t=!1),this._source||this.recreateResource()},$H.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$H.disposeResource=function(){this._source&&!this.iscpuSource&&($Ct.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$H.createWebGlTexture=function(){var $t=$Ct.mainContext;this._canvas;var $H=this._source=$t.createTexture();this.iscpuSource=!1;var $I=$Nt.curBindTexTarget,$T=$Nt.curBindTexValue;$Nt.bindTexture($t,3553,$H),$t.pixelStorei(37440,this.flipY?1:0),$K.premulAlpha&&$t.pixelStorei(37441,!0),$t.texImage2D(3553,0,6408,6408,5121,this._imgData),$K.premulAlpha&&$t.pixelStorei(37441,!1),$t.texParameteri(3553,10240,9729),$t.texParameteri(3553,10241,9729),$t.texParameteri(3553,10242,33071),$t.texParameteri(3553,10243,33071),$t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$I&&$T&&$Nt.bindTexture($t,$I,$T)},$H.reloadCanvasData=function(){var $t=$Ct.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $H=$Nt.curBindTexTarget,$I=$Nt.curBindTexValue;$Nt.bindTexture($t,3553,this._source),$K.premulAlpha&&$t.pixelStorei(37441,!0),$t.texImage2D(3553,0,6408,6408,5121,this._imgData),$K.premulAlpha&&$t.pixelStorei(37441,!1),$t.pixelStorei(37440,0),$H&&$I&&$Nt.bindTexture($t,$H,$I)},$H.texSubImage2D=function($t,$H,$I){var $T=$Ct.mainContext,$K=$Nt.curBindTexTarget,$_=$Nt.curBindTexValue;$Nt.bindTexture($T,3553,this._source),$T.pixelStorei(37441,!0),$T.texSubImage2D(3553,0,$H,$I,6408,5121,$t._source),$T.pixelStorei(37441,!1),$K&&$_&&$Nt.bindTexture($T,$K,$_)},$H.toBase64=function($t,$H,$I){var $T=null;this._canvas&&($T=this._canvas.toDataURL($t,$H)),$I.call(this,$T)},$T(0,$H,"context",function(){return this._ctx}),$T(0,$H,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$T(0,$H,"asBitmap",null,function($t){this._ctx&&(this._ctx.asBitmap=$t)}),$K._createContext=null,$K.premulAlpha=!1,$K}(),$mt=function($t){function $_($t,$H){this.CborderSize=12,$_.__super.call(this),this.char=$t,this.isSpace=" "===$t,this.xs=$H.scaleX,this.ys=$H.scaleY,this.font=$H.font.toString(),this.fontSize=$H.font.size,this.fillColor=$H.fillColor,this.borderColor=$H.borderColor,this.lineWidth=$H.lineWidth,this.underLine=$H.underLine;var $I,$T=$J.isConchApp;$T?(($I=ConchTextCanvas)._source=ConchTextCanvas,$I._source.canvas=ConchTextCanvas):$I=$L.canvas.source,this.canvas=$I,this._enableMerageInAtlas=!0,this._ctx=$T?$I:this.canvas.getContext("2d",void 0);var $K=$v.measureText(this.char,this.font);this.cw=$K.width*this.xs,this.ch=($K.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $l(this)}$b($_,"laya.webgl.resource.WebGLCharImage",$I);var $H=$_.prototype;return $w.imps($H,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$H.active=function(){this.texture.active()},$H.recreateResource=function(){var $t=$J.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$t){var $H=this.fontSize;1==this.xs&&1==this.ys||($H=parseInt($H*(this.xs>this.ys?this.xs:this.ys)+""));var $I="normal 100 "+this.font;$I=$I.replace($_._fontSizeReg,$H),this.borderColor&&($I+=" 1 "+this.borderColor),this._ctx.font=$I,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$g.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $T=this._ctx.measureText(this.char);$T||($T={width:16});var $K=$T.width+1;this._ctx.lineTo($K,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$H.onresize=function($t,$H){this._w=$t,this._h=$H,this._allowMerageInAtlas=!0},$H.clearAtlasSource=function(){},$T(0,$H,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$T(0,$H,"atlasSource",function(){return this.canvas}),$T(0,$H,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($t){this._enableMerageInAtlas=$t}),$_.createOneChar=function($t,$H){return new $_($t,$H)},$_._fontSizeReg=new RegExp("\\d+(?=px)","g"),$_}(),$ot=function($t){function $A($t,$H,$I,$T,$K,$_,$V,$e,$R){void 0===$I&&($I=6408),void 0===$T&&($T=5121),void 0===$K&&($K=34041),void 0===$_&&($_=!1),void 0===$V&&($V=!1),void 0===$e&&($e=-1),void 0===$R&&($R=1),$A.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$t,this._h=$H,this._surfaceFormat=$I,this._surfaceType=$T,this._depthStencilFormat=$K,this._mipMap=$_,this._repeat=$V,this._minFifter=$e,this._magFifter=$R}$b($A,"laya.webgl.resource.WebGLRenderTarget",$I);var $H=$A.prototype;return $H.recreateResource=function(){var $t=$Ct.mainContext;this._frameBuffer||(this._frameBuffer=$t.createFramebuffer()),this._source||(this._source=$t.createTexture());var $H=$Nt.curBindTexTarget,$I=$Nt.curBindTexValue;$Nt.bindTexture($t,3553,this._source),$t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $T=this._minFifter,$K=this._magFifter,$_=this._repeat?10497:33071,$V=$q.isPOT(this._w,this._h);if($V?(this._mipMap?-1!==$T||($T=9987):-1!==$T||($T=9729),-1!==$K||($K=9729),$t.texParameteri(3553,10241,$T),$t.texParameteri(3553,10240,$K),$t.texParameteri(3553,10242,$_),$t.texParameteri(3553,10243,$_),this._mipMap&&$t.generateMipmap(3553)):(-1!==$T||($T=9729),-1!==$K||($K=9729),$t.texParameteri(3553,10241,$T),$t.texParameteri(3553,10240,$K),$t.texParameteri(3553,10242,33071),$t.texParameteri(3553,10243,33071)),$t.bindFramebuffer(36160,this._frameBuffer),$t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$t.createRenderbuffer()),$t.bindRenderbuffer(36161,this._depthStencilBuffer),$t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$t.bindFramebuffer(36160,null),$H&&$I&&$Nt.bindTexture($t,$H,$I),$t.bindRenderbuffer(36161,null),$V&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$H.disposeResource=function(){this._frameBuffer&&($Ct.mainContext.deleteTexture(this._source),$Ct.mainContext.deleteFramebuffer(this._frameBuffer),$Ct.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$T(0,$H,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$T(0,$H,"frameBuffer",function(){return this._frameBuffer}),$A}(),$nt=function($t){function $e($t,$H,$I,$T,$K,$_,$V){this.offsetX=0,this.offsetY=0,$e.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$_,this.canvas=$t,this._ctx=$t.getContext("2d",void 0),this._w=$T,this._h=$K,this.offsetX=$H,this.offsetY=$I,this.src=$V,this._enableMerageInAtlas=!0,$B.enabled&&this._w<$B.atlasLimitWidth&&this._h<$B.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$b($e,"laya.webgl.resource.WebGLSubImage",$I);var $H=$e.prototype;return $w.imps($H,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$H.size=function($t,$H){this._w=$t,this._h=$H,this._ctx&&this._ctx.size($t,$H),this.canvas&&(this.canvas.height=$H,this.canvas.width=$t)},$H.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$H.createWebGlTexture=function(){var $t=$Ct.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $H=this._source=$t.createTexture(),$I=$Nt.curBindTexTarget,$T=$Nt.curBindTexValue;$Nt.bindTexture($t,3553,$H),$t.pixelStorei(37441,!0),$t.texImage2D(3553,0,6408,6408,5121,this.canvas),$t.pixelStorei(37441,!1);var $K=this.minFifter,$_=this.magFifter,$V=this.repeat?10497:33071,$e=$q.isPOT(this.width,this.height);$e?(this.mipmap?-1!==$K||($K=9987):-1!==$K||($K=9729),-1!==$_||($_=9729),$t.texParameteri(3553,10240,$_),$t.texParameteri(3553,10241,$K),$t.texParameteri(3553,10242,$V),$t.texParameteri(3553,10243,$V),this.mipmap&&$t.generateMipmap(3553)):(-1!==$K||($K=9729),-1!==$_||($_=9729),$t.texParameteri(3553,10241,$K),$t.texParameteri(3553,10240,$_),$t.texParameteri(3553,10242,33071),$t.texParameteri(3553,10243,33071)),$I&&$T&&$Nt.bindTexture($t,$I,$T),this.canvas=null,$e&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$H.disposeResource=function(){$B.enabled&&this._allowMerageInAtlas||!this._source||($Ct.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$H.clearAtlasSource=function(){},$T(0,$H,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$T(0,$H,"atlasSource",function(){return this.canvas}),$T(0,$H,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($t){this._allowMerageInAtlas=$t}),$e}(),$Ft=function($t){function $A($t,$H,$I,$T){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$A.__super.call(this),!$t||!$H)throw"Shader Error";this._id=++$A._count,this._vs=$t,this._ps=$H,this._nameMap=$T||{},null!=$I&&($A.sharders[$I]=this)}$b($A,"laya.webgl.shader.Shader",$vt);var $H=$A.prototype;return $H.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$H.disposeResource=function(){$Ct.mainContext.deleteShader(this._vshader),$Ct.mainContext.deleteShader(this._pshader),$Ct.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$H._compile=function(){if(!$Ct.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $t=[this._vs,this._ps],$H=$Ct.mainContext;if(this._program=$H.createProgram(),this._vshader=$A._createShader($H,$t[0],35633),this._pshader=$A._createShader($H,$t[1],35632),$H.attachShader(this._program,this._vshader),$H.attachShader(this._program,this._pshader),$H.linkProgram(this._program),!$J.isConchApp&&!$H.getProgramParameter(this._program,35714))throw $H.getProgramInfoLog(this._program);var $I,$T,$K=0,$_=0;for($_=$J.isConchApp?$H.getProgramParameterEx(this._vs,this._ps,"",35721):$H.getProgramParameter(this._program,35721),$K=0;$K<$_;$K++){var $V=null;$I={vartype:"attribute",glfun:null,ivartype:0,attrib:$V=$J.isConchApp?$H.getActiveAttribEx(this._vs,this._ps,"",$K):$H.getActiveAttrib(this._program,$K),location:$H.getAttribLocation(this._program,$V.name),name:$V.name,type:$V.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($I)}var $e=0;for($e=$J.isConchApp?$H.getProgramParameterEx(this._vs,this._ps,"",35718):$H.getProgramParameter(this._program,35718),$K=0;$K<$e;$K++){var $R=null;$R=$J.isConchApp?$H.getActiveUniformEx(this._vs,this._ps,"",$K):$H.getActiveUniform(this._program,$K),0<($I={vartype:"uniform",glfun:null,ivartype:1,attrib:$V,location:$H.getUniformLocation(this._program,$R.name),name:$R.name,type:$R.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($I.name=$I.name.substr(0,$I.name.length-3),$I.isArray=!0,$I.location=$H.getUniformLocation(this._program,$I.name)),this._params.push($I)}for($K=0,$T=this._params.length;$K<$T;$K++)if(($I=this._params[$K]).indexOfParams=$K,$I.index=1,$I.value=[$I.location,null],$I.codename=$I.name,$I.name=this._nameMap[$I.codename]?this._nameMap[$I.codename]:$I.codename,(this._paramsMap[$I.name]=$I)._this=this,$I.uploadedValue=[],"attribute"!==$I.vartype)switch($I.type){case 5124:$I.fun=$I.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$I.fun=$I.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$I.fun=$I.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$I.fun=$I.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$I.fun=$I.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$I.fun=this._uniform_sampler2D;break;case 35680:$I.fun=this._uniform_samplerCube;break;case 35676:$I.glfun=$H.uniformMatrix4fv,$I.fun=this._uniformMatrix4fv;break;case 35670:$I.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $I.fun=this._attribute}},$H.getUniform=function($t){return this._paramsMap[$t]},$H._attribute=function($t,$H){var $I=$Ct.mainContext,$T=$Et._enableAtributes,$K=$t.location;return $T[$K]||$I.enableVertexAttribArray($K),$I.vertexAttribPointer($K,$H[0],$H[1],$H[2],$H[3],$H[4]+this._offset),$T[$K]=$Et._bindVertexBuffer,1},$H._uniform1f=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H?($Ct.mainContext.uniform1f($t.location,$I[0]=$H),1):0},$H._uniform1fv=function($t,$H){if($H.length<4){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($Ct.mainContext.uniform1fv($t.location,$H),$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3],1):0}return $Ct.mainContext.uniform1fv($t.location,$H),1},$H._uniform_vec2=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]?($Ct.mainContext.uniform2f($t.location,$I[0]=$H[0],$I[1]=$H[1]),1):0},$H._uniform_vec2v=function($t,$H){if($H.length<2){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($Ct.mainContext.uniform2fv($t.location,$H),$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3],1):0}return $Ct.mainContext.uniform2fv($t.location,$H),1},$H._uniform_vec3=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]?($Ct.mainContext.uniform3f($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2]),1):0},$H._uniform_vec3v=function($t,$H){return $Ct.mainContext.uniform3fv($t.location,$H),1},$H._uniform_vec4=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($Ct.mainContext.uniform4f($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3]),1):0},$H._uniform_vec4v=function($t,$H){return $Ct.mainContext.uniform4fv($t.location,$H),1},$H._uniformMatrix2fv=function($t,$H){return $Ct.mainContext.uniformMatrix2fv($t.location,!1,$H),1},$H._uniformMatrix3fv=function($t,$H){return $Ct.mainContext.uniformMatrix3fv($t.location,!1,$H),1},$H._uniformMatrix4fv=function($t,$H){return $Ct.mainContext.uniformMatrix4fv($t.location,!1,$H),1},$H._uniform1i=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H?($Ct.mainContext.uniform1i($t.location,$I[0]=$H),1):0},$H._uniform1iv=function($t,$H){return $Ct.mainContext.uniform1iv($t.location,$H),1},$H._uniform_ivec2=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]?($Ct.mainContext.uniform2i($t.location,$I[0]=$H[0],$I[1]=$H[1]),1):0},$H._uniform_ivec2v=function($t,$H){return $Ct.mainContext.uniform2iv($t.location,$H),1},$H._uniform_vec3i=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]?($Ct.mainContext.uniform3i($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2]),1):0},$H._uniform_vec3vi=function($t,$H){return $Ct.mainContext.uniform3iv($t.location,$H),1},$H._uniform_vec4i=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($Ct.mainContext.uniform4i($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3]),1):0},$H._uniform_vec4vi=function($t,$H){return $Ct.mainContext.uniform4iv($t.location,$H),1},$H._uniform_sampler2D=function($t,$H){var $I=$Ct.mainContext,$T=$t.uploadedValue;return null==$T[0]?($T[0]=this._curActTexIndex,$I.uniform1i($t.location,this._curActTexIndex),$I.activeTexture($A._TEXTURES[this._curActTexIndex]),$Nt.bindTexture($I,3553,$H),this._curActTexIndex++,1):($I.activeTexture($A._TEXTURES[$T[0]]),$Nt.bindTexture($I,3553,$H),0)},$H._uniform_samplerCube=function($t,$H){var $I=$Ct.mainContext,$T=$t.uploadedValue;return null==$T[0]?($T[0]=this._curActTexIndex,$I.uniform1i($t.location,this._curActTexIndex),$I.activeTexture($A._TEXTURES[this._curActTexIndex]),$Nt.bindTexture($I,34067,$H),this._curActTexIndex++,1):($I.activeTexture($A._TEXTURES[$T[0]]),$Nt.bindTexture($I,34067,$H),0)},$H._noSetValue=function($t){console.log("no....:"+$t.name)},$H.uploadOne=function($t,$H){this.activeResource(),$Nt.UseProgram(this._program);var $I=this._paramsMap[$t];$I.fun.call(this,$I,$H)},$H.uploadTexture2D=function($t){$Y.shaderCall++;var $H=$Ct.mainContext;$H.activeTexture(33984),$Nt.bindTexture($H,3553,$t)},$H.uploadTexture2D1=function($t){$Y.shaderCall++;var $H=$Ct.mainContext;$H.activeTexture(33985),$Nt.bindTexture($H,3553,$t)},$H.upload=function($t,$H){$vt.activeShader=$vt.bindShader=this,this._lastUseFrameCount===$Y.loopCount||this.activeResource(),$Nt.UseProgram(this._program),this._reCompile?($H=this._params,this._reCompile=!1):$H=$H||this._params;$Ct.mainContext;for(var $I,$T,$K=$H.length,$_=0,$V=0;$V<$K;$V++)null!==($T=$t[($I=$H[$V]).name])&&($_+=$I.fun.call(this,$I,$T));$Y.shaderCall+=$_},$H.uploadArray=function($t,$H,$I){$vt.activeShader=this,($vt.bindShader=this).activeResource(),$Nt.UseProgram(this._program);this._params;for(var $T,$K,$_=0,$V=$H-2;0<=$V;$V-=2)($K=this._paramsMap[$t[$V]])&&null!=($T=$t[$V+1])&&($I&&$I[$K.name]&&$I[$K.name].bind(),$_+=$K.fun.call(this,$K,$T));$Y.shaderCall+=$_},$H.getParams=function(){return this._params},$A.getShader=function($t){return $A.sharders[$t]},$A.create=function($t,$H,$I,$T){return new $A($t,$H,$I,$T)},$A.withCompile=function($t,$H,$I,$T){if($I&&$A.sharders[$I])return $A.sharders[$I];var $K=$A._preCompileShader[2e-4*$t];if(!$K)throw new Error("withCompile shader err!"+$t);return $K.createShader($H,$I,$T)},$A.withCompile2D=function($t,$H,$I,$T,$K){if($T&&$A.sharders[$T])return $A.sharders[$T];var $_=$A._preCompileShader[2e-4*$t+$H];if(!$_)throw new Error("withCompile shader err!"+$t+" "+$H);return $_.createShader($I,$T,$K)},$A.addInclude=function($t,$H){$Ut.addInclude($t,$H)},$A.preCompile=function($t,$H,$I,$T){var $K=2e-4*$t;$A._preCompileShader[$K]=new $Ut($K,$H,$I,$T)},$A.preCompile2D=function($t,$H,$I,$T,$K){var $_=2e-4*$t+$H;$A._preCompileShader[$_]=new $Ut($_,$I,$T,$K)},$A._createShader=function($t,$H,$I){var $T=$t.createShader($I);return $t.shaderSource($T,$H),$t.compileShader($T),$T},$A._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$A._count=0,$A._preCompileShader={},$A.SHADERNAME2ID=2e-4,$A.sharders=(($A.sharders=[]).length=32,$A.sharders),$V($A,["nameKey",function(){return this.nameKey=new $D}]),$A}(),$ct=function($t){function $H(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$H.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$b($H,"laya.webgl.utils.Buffer2D",$t);var $I=$H.prototype;return $I.needSize=function($t){var $H=this._byteLength;if($t){var $I=this._byteLength+$t;$I<=this._buffer.byteLength||this._resizeBuffer($I<<1,!0),this._byteLength=$I}return $H},$I._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$Y.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$Et._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$Et._gl.bufferSubData(this._bufferType,0,this._buffer)},$I._bufferSubData=function($t,$H,$I){if(void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$Y.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$Et._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$H||$I){var $T=this._buffer.slice($H,$I);$Et._gl.bufferSubData(this._bufferType,$t,$T)}else $Et._gl.bufferSubData(this._bufferType,$t,this._buffer)},$I._checkArrayUse=function(){},$I._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$I._bind_subUpload=function($t,$H,$I){return void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($t,$H,$I),!0)},$I._resizeBuffer=function($t,$H){if($t<this._buffer.byteLength)return this;if(this.memorySize=$t,$H&&this._buffer&&0<this._buffer.byteLength){var $I=new ArrayBuffer($t);new Uint8Array($I).set(new Uint8Array(this._buffer),0),this._buffer=$I}else this._buffer=new ArrayBuffer($t);return this._checkArrayUse(),this._upload=!0,this},$I.append=function($t){this._upload=!0;var $H,$I;$H=$t.byteLength,$t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$H,!0),$I=new Uint8Array(this._buffer,this._byteLength)):$t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$H,!0),$I=new Uint16Array(this._buffer,this._byteLength)):$t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$H,!0),$I=new Float32Array(this._buffer,this._byteLength)),$I.set($t,0),this._byteLength+=$H,this._checkArrayUse()},$I.appendU16Array=function($t,$H){this._resizeBuffer(this._byteLength+2*$H,!0);for(var $I=new Uint16Array(this._buffer,this._byteLength,$H),$T=0;$T<$H;$T++)$I[$T]=$t[$T];this._byteLength+=2*$H,this._checkArrayUse()},$I.appendEx=function($t,$H){this._upload=!0;var $I;$I=$t.byteLength,this._resizeBuffer(this._byteLength+$I,!0),new $H(this._buffer,this._byteLength).set($t,0),this._byteLength+=$I,this._checkArrayUse()},$I.appendEx2=function($t,$H,$I,$T){void 0===$T&&($T=1),this._upload=!0;var $K,$_;$K=$I*$T,this._resizeBuffer(this._byteLength+$K,!0),$_=new $H(this._buffer,this._byteLength);var $V=0;for($V=0;$V<$I;$V++)$_[$V]=$t[$V];this._byteLength+=$K,this._checkArrayUse()},$I.getBuffer=function(){return this._buffer},$I.setNeedUpload=function(){this._upload=!0},$I.getNeedUpload=function(){return this._upload},$I.upload=function(){var $t=this._bind_upload();return $Et._gl.bindBuffer(this._bufferType,null),$Et._bindActive[this._bufferType]=null,$vt.activeShader=null,$t},$I.subUpload=function($t,$H,$I){void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0);var $T=this._bind_subUpload();return $Et._gl.bindBuffer(this._bufferType,null),$Et._bindActive[this._bufferType]=null,$vt.activeShader=null,$T},$I.disposeResource=function(){$t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$I.clear=function(){this._byteLength=0,this._upload=!0},$T(0,$I,"bufferLength",function(){return this._buffer.byteLength}),$T(0,$I,"byteLength",null,function($t){this._byteLength!==$t&&($t<=this._buffer.byteLength||this._resizeBuffer(2*$t+256,!0),this._byteLength=$t)}),$H.__int__=function($t){$dt.QuadrangleIB=$dt.create(35044),$Ot.fillIBQuadrangle($dt.QuadrangleIB,16)},$H.FLOAT32=4,$H.SHORT=2,$H}($Et),$it=(function($H){function $I($t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$I.__super.call(this,9)}$b($I,"laya.webgl.shader.d2.value.GlowSV",$H);var $t=$I.prototype;$t.setValue=function($t){$H.prototype.setValue.call(this,$t)},$t.clear=function(){$H.prototype.clear.call(this)}}($at),function($t){function $H($t){$H.__super.call(this,64),this.defines.add(64)}$b($H,"laya.webgl.shader.d2.value.TextSV",$t);var $I=$H.prototype;return $I.release=function(){($H.pool[$H._length++]=this).clear()},$I.clear=function(){$t.prototype.clear.call(this)},$H.create=function(){return $H._length?$H.pool[--$H._length]:new $H(null)},$H.pool=[],$H._length=0,$H}($at)),$jt=function($t){function $K($t,$H,$I,$T){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$K.__super.call(this,$t,$H,$I,$T)}$b($K,"laya.webgl.shader.d2.Shader2X",$t);var $H=$K.prototype;return $H.upload2dQuick1=function($t){this.upload($t,this._params2dQuick1||this._make2dQuick1())},$H._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $t,$H=this._params,$I=0,$T=$H.length;$I<$T;$I++)$t=$H[$I],($J.isFlash||"size"!==$t.name&&"position"!==$t.name&&"texcoord"!==$t.name)&&this._params2dQuick1.push($t)}return this._params2dQuick1},$H.disposeResource=function(){$t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$H.upload2dQuick2=function($t){this.upload($t,this._params2dQuick2||this._make2dQuick2())},$H._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $t,$H=this._params,$I=0,$T=$H.length;$I<$T;$I++)$t=$H[$I],($J.isFlash||"size"!==$t.name)&&this._params2dQuick2.push($t)}return this._params2dQuick2},$K.create=function($t,$H,$I,$T){return new $K($t,$H,$I,$T)},$K}($Ft),$dt=function($t){function $H($t){this._uint8Array=null,this._uint16Array=null,void 0===$t&&($t=35044),$H.__super.call(this),this._bufferUsage=$t,this._bufferType=34963,$J.isFlash||(this._buffer=new ArrayBuffer(8))}$b($H,"laya.webgl.utils.IndexBuffer2D",$ct);var $I=$H.prototype;return $I._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$I.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$I.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$I.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$H.QuadrangleIB=null,$H.create=function($t){return void 0===$t&&($t=35044),new $H($t)},$H}(),$Zt=function($t){function $I($t,$H){this._floatArray32=null,this._vertexStride=0,$I.__super.call(this),this._vertexStride=$t,this._bufferUsage=$H,this._bufferType=34962,$J.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$b($I,"laya.webgl.utils.VertexBuffer2D",$t);var $H=$I.prototype;return $H.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$H.bind=function($t){$t&&$t._bind(),this._bind()},$H.insertData=function($t,$H){this.getFloat32Array().set($t,$H),this._upload=!0},$H.bind_upload=function($t){$t._bind_upload()||$t._bind(),this._bind_upload()||this._bind()},$H._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$H.disposeResource=function(){$t.prototype.disposeResource.call(this)},$H.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$T(0,$H,"vertexStride",function(){return this._vertexStride}),$I.create=function($t,$H){return void 0===$H&&($H=35048),new $I($t,$H)},$I}($ct),$tH=function($t){function $e($t,$H,$I,$T,$K,$_){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$I&&($I=6408),void 0===$T&&($T=!0),$e.__super.call(this,$t,$H),$t){if(this._format=$I,this._mipmap=$T,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $t)this._url=$t,this._src=$t,this._image=new $L.window.Image,$H&&($H.onload&&(this.onload=$H.onload),$H.onerror&&(this.onerror=$H.onerror),$H.onCreate&&$H.onCreate(this)),this._image.crossOrigin=$t&&0==$t.indexOf("data:")?null:"",$t&&(this._image.src=$t);else if($t instanceof ArrayBuffer){this._src=$H,this._url=this._src;var $V=new $R($t);$V.readUTFBytes(4),$V.readUTFBytes(2),$V.getInt16();$V.endian="bigEndian",this._w=$V.getInt16(),this._h=$V.getInt16();$V.getInt16(),$V.getInt16();this._image=new Uint8Array($t,$V.pos),this._format=$Ct.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$B.enabled&&this._w<$B.atlasLimitWidth&&this._h<$B.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($t instanceof Uint8Array))return this._src=$H,this._url=this._src,this._image=$t.source||$t,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$H,this._url=this._src,this._w=$K,this._h=$_,this._image=$t,this._format=0===$I?$t.byteLength/($K*$_)==4?6408:6407:$I}this._$5__enableMerageInAtlas=!0}}$b($e,"laya.webgl.resource.WebGLImage",$M);var $H=$e.prototype;return $w.imps($H,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$H._init_=function($t,$H){},$H._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $t=$Ct.mainContext,$H=this._source=$t.createTexture(),$I=$Nt.curBindTexTarget,$T=$Nt.curBindTexValue;$Nt.bindTexture($t,3553,$H);var $K=this.minFifter,$_=this.magFifter,$V=this.repeat?10497:33071,$e=$q.isPOT(this._w,this._h),$R=!1;switch($e?(this.mipmap?-1!==$K||($K=9987):-1!==$K||($K=9729),-1!==$_||($_=9729),$t.texParameteri(3553,10241,$K),$t.texParameteri(3553,10240,$_),$t.texParameteri(3553,10242,$V),$t.texParameteri(3553,10243,$V),this.mipmap&&$t.generateMipmap(3553)):(-1!==$K||($K=9729),-1!==$_||($_=9729),$t.texParameteri(3553,10241,$K),$t.texParameteri(3553,10240,$_),$t.texParameteri(3553,10242,33071),$t.texParameteri(3553,10243,33071)),$t.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$t.pixelStorei($t.UNPACK_ALIGNMENT,1),$t.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$t.pixelStorei($t.UNPACK_ALIGNMENT,1),$t.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$R=!0,$t.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $Ct.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$R=!0,$t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$t.pixelStorei(37441,!1),$I&&$T&&$Nt.bindTexture($t,$I,$T),this.uri||(this.uri=this._url),$R?this.memorySize=this._image.length:$e&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$H.recreateResource=function(){var $t=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $H=this;this._image=new $L.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($H._needReleaseAgain)return $H._needReleaseAgain=!1,$H._image.onload=null,void($H._image=null);$H._allowMerageInAtlas&&$H._enableMerageInAtlas?($t.memorySize=0,$t._recreateLock=!1):$H._createWebGlTexture(),$H.completeCreate()},this._image.src=this._src}},$H.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$Ct.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$H.onresize=function(){this._w=this._image.width,this._h=this._image.height,$B.enabled&&this._w<$B.atlasLimitWidth&&this._h<$B.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$H.clearAtlasSource=function(){this._image=null},$T(0,$H,"format",function(){return this._format}),$T(0,$H,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($t){this._$5__enableMerageInAtlas=$t}),$T(0,$H,"mipmap",function(){return this._mipmap}),$T(0,$H,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$T(0,$H,"atlasSource",function(){return this._image}),$T(0,$H,"onload",null,function($t){var $H=this;this._onload=$t,this._image&&(this._image.onload=null!=this._onload?function(){$H.onresize(),$H._onload()}:null)}),$T(0,$H,"onerror",null,function($t){var $H=this;this._onerror=$t,this._image&&(this._image.onerror=null!=this._onerror?function(){$H._onerror()}:null)}),$e}();$w.__init([$Lt,$X,$Wt,$Ut])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($t,$H){"use strict";for(var $I in Object.defineProperty($H,"__esModule",{value:!0}),Laya){var $T=Laya[$I];$T&&$T.__isclass&&($H[$I]=$T)}}),function($_,$t,$T){$T.un,$T.uns;var $K=$T.static,$V=$T.class,$e=$T.getset,$R=($T.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$G=laya.utils.ClassUtils,$f=(laya.events.Event,laya.utils.HTMLChar),$A=laya.net.Loader,$q=(laya.display.Node,laya.maths.Rectangle),$b=laya.renders.Render,$L=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$M=laya.utils.Stat,$v=laya.display.Text,$O=laya.resource.Texture,$J=laya.net.URL,$S=laya.utils.Utils,$U=function(){function $L(){}return $V($L,"laya.html.utils.HTMLParse"),$L.parse=function($t,$H,$I){$H=($H="<root>"+($H=$H.replace(/<br>/g,"<br/>"))+"</root>").replace($L.spacePattern,$L.char255);var $T=$S.parseXMLFromString($H);$L._parseXML($t,$T.childNodes[0].childNodes,$I)},$L._parseXML=function($t,$H,$I,$T){var $K=0,$_=0;if($H.join||$H.item)for($K=0,$_=$H.length;$K<$_;++$K)$L._parseXML($t,$H[$K],$I,$T);else{var $V,$e,$R;if(3==$H.nodeType)return void($t instanceof laya.html.dom.HTMLDivElement?(null==$H.nodeName&&($H.nodeName="#text"),$e=$H.nodeName.toLowerCase(),0<($R=$H.textContent.replace(/^\s+|\s+$/g,"")).length&&($V=$G.getInstance($e))&&($t.addChild($V),$V.innerTEXT=$R.replace($L.char255AndOneSpacePattern," "))):0<($R=$H.textContent.replace(/^\s+|\s+$/g,"")).length&&($t.innerTEXT=$R.replace($L.char255AndOneSpacePattern," ")));if("#comment"==($e=$H.nodeName.toLowerCase()))return;if($V=$G.getInstance($e)){($V=$t.addChild($V)).URI=$I,$V.href=$T;var $A=$H.attributes;if($A&&0<$A.length)for($K=0,$_=$A.length;$K<$_;++$K){var $q=$A[$K],$f=$q.nodeName,$b=$q.value;$V._setAttributes($f,$b)}$L._parseXML($V,$H.childNodes,$I,$V.href)}else $L._parseXML($t,$H.childNodes,$I,$T)}},$L.char255=String.fromCharCode(255),$L.spacePattern=/&nbsp;|&#160;/g,$L.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$L}(),$C=function(){function $l(){}return $V($l,"laya.html.utils.Layout"),$l.later=function($t){null==$l._will&&($l._will=[],$T.stage.frameLoop(1,null,function(){if(!($l._will.length<1)){for(var $t=0;$t<$l._will.length;$t++)laya.html.utils.Layout.layout($l._will[$t]);$l._will.length=0}})),$l._will.push($t)},$l.layout=function($t){if(!$t||!$t._style)return null;if(0==(512&$t._style._type))return null;$t.getStyle()._type&=-513;var $H=$l._multiLineLayout($t);return $b.isConchApp&&$t.layaoutCallNative&&$t.layaoutCallNative(),$H},$l._multiLineLayout=function($t){if($v.RightToLeft)return $l._multiLineLayout2($t);var $H=new Array;$t._addChildsToLayout($H);var $I,$T,$K,$_,$V,$e=0,$R=$H.length,$A=$t._getCSSStyle(),$q=$A.letterSpacing,$f=$A.leading,$b=$A.lineHeight,$L=$A._widthAuto()||!$A.wordWrap,$G=$L?999999:$t.width,$M=($t.height,0),$O=$A.italic?$A.fontSize/3:0,$J=$A._getAlign(),$S=$A._getValign(),$U=0!==$S||0!==$J||0!=$b,$C=0,$N=0,$w=0,$W=0,$s=new Array,$z=$s[0]=new $y,$P=!1,$k=!1;$z.h=0,$A.italic&&($G-=$A.fontSize/3);var $r=0,$x=!0;function $Y(){$z.y=$N,$N+=$z.h+$f,0==$z.h&&($N+=$b),$z.mWidth=$r,$r=0,$z=new $y,$s.push($z),$z.h=0,$P=!($x=!($C=0))}for($e=0;$e<$R;$e++)if(null!=($I=$H[$e]))if($x=!1,$I instanceof laya.html.dom.HTMLBrElement)$Y(),$z.y=$N;else{if($I._isChar()){if(($_=$I).isWord)$P=$k||"\n"===$_.char,$z.wordStartIndex=$z.elements.length;else{if($w=$_.width+$_.style.letterSpacin,0<$s.length&&$G<$C+$w&&0<$z.wordStartIndex){var $D;$D=$z.elements.length-$z.wordStartIndex+1,$z.elements.length=$z.wordStartIndex,$e-=$D,$Y();continue}$P=!1,$r+=$_.width}$w=$_.width+$q,$W=$_.height,$k=!1,($P=$P||$G<$C+$w)&&$Y(),$z.minTextHeight=Math.min($z.minTextHeight,$I.height)}else $T=$I._getCSSStyle(),$V=$I,$K=$T.padding,0===$T._getCssFloat()||($U=!0),$P=$k||$T.lineElement,$w=$V.width*$V._style._tf.scaleX+$K[1]+$K[3]+$q,$W=$V.height*$V._style._tf.scaleY+$K[0]+$K[2],$k=$T.lineElement,($P=$P||$G<$C+$w&&$T.wordWrap)&&$Y();$z.elements.push($I),$z.h=Math.max($z.h,$W),$I.x=$C,$I.y=$N,$C+=$w,$z.w=$C-$q,$z.y=$N,$M=Math.max($C+$O,$M)}else $x||($C+=$l.DIV_ELEMENT_PADDING),$z.wordStartIndex=$z.elements.length;if($N=$z.y+$z.h,$U){var $p=0,$g=$G;for($L&&0<$t.width&&($g=$t.width),$e=0,$R=$s.length;$e<$R;$e++)$s[$e].updatePos(0,$g,$e,$p,$J,$S,$b),$p+=Math.max($b,$s[$e].h+$f);$N=$p}return $L&&($t.width=$M),$N>$t.height&&($t.height=$N),[$M,$N]},$l._multiLineLayout2=function($t){var $H=new Array;$t._addChildsToLayout($H);var $I,$T,$K,$_,$V,$e=0,$R=$H.length,$A=$t._getCSSStyle(),$q=$A.letterSpacing,$f=$A.leading,$b=$A.lineHeight,$L=$A._widthAuto()||!$A.wordWrap,$G=$L?999999:$t.width,$M=($t.height,0),$O=$A.italic?$A.fontSize/3:0,$J=2-$A._getAlign(),$S=$A._getValign(),$U=0!==$S||0!=$J||0!=$b,$C=0,$N=0,$w=0,$W=0,$s=new Array,$z=$s[0]=new $y,$P=!1,$k=!1;$z.h=0,$A.italic&&($G-=$A.fontSize/3);var $r=0,$x=!0;function $Y(){$z.y=$N,$N+=$z.h+$f,0==$z.h&&($N+=$b),$z.mWidth=$r,$r=0,$z=new $y,$s.push($z),$z.h=0,$P=!($x=!($C=0))}for($e=0;$e<$R;$e++)if(null!=($I=$H[$e]))if($x=!1,$I instanceof laya.html.dom.HTMLBrElement)$Y(),$z.y=$N;else{if($I._isChar()){if(($_=$I).isWord)$P=$k||"\n"===$_.char,$z.wordStartIndex=$z.elements.length;else{if(0<$s.length&&$G<$C+$w&&0<$z.wordStartIndex){var $D;$D=$z.elements.length-$z.wordStartIndex+1,$z.elements.length=$z.wordStartIndex,$e-=$D,$Y();continue}$P=!1,$r+=$_.width}$w=$_.width+$q,$W=$_.height,$k=!1,($P=$P||$G<$C+$w)&&$Y(),$z.minTextHeight=Math.min($z.minTextHeight,$I.height)}else $T=$I._getCSSStyle(),$V=$I,$K=$T.padding,0===$T._getCssFloat()||($U=!0),$P=$k||$T.lineElement,$w=$V.width*$V._style._tf.scaleX+$K[1]+$K[3]+$q,$W=$V.height*$V._style._tf.scaleY+$K[0]+$K[2],$k=$T.lineElement,($P=$P||$G<$C+$w&&$T.wordWrap)&&$Y();$z.elements.push($I),$z.h=Math.max($z.h,$W),$I.x=$C,$I.y=$N,$C+=$w,$z.w=$C-$q,$z.y=$N,$M=Math.max($C+$O,$M)}else $x||($C+=$l.DIV_ELEMENT_PADDING),$z.wordStartIndex=$z.elements.length;if($N=$z.y+$z.h,$U){var $p=0,$g=$G;for($e=0,$R=$s.length;$e<$R;$e++)$s[$e].updatePos(0,$g,$e,$p,$J,$S,$b),$p+=Math.max($b,$s[$e].h+$f);$N=$p}for($L&&($t.width=$M),$N>$t.height&&($t.height=$N),$e=0,$R=$s.length;$e<$R;$e++)$s[$e].revertOrder($G);return[$M,$N]},$l._will=null,$l.DIV_ELEMENT_PADDING=0,$l}(),$y=function(){function $t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$V($t,"laya.html.utils.LayoutLine");var $H=$t.prototype;return $H.updatePos=function($t,$H,$I,$T,$K,$_,$V){var $e,$R=0;0<this.elements.length&&($R=($e=this.elements[this.elements.length-1]).x+$e.width-this.elements[0].x);var $A=0,$q=NaN;1===$K&&($A=($H-$R)/2),2===$K&&($A=$H-$R),0===$V||0!=$_||($_=1);for(var $f=0,$b=this.elements.length;$f<$b;$f++){var $L=($e=this.elements[$f])._getCSSStyle();switch(0!==$A&&($e.x+=$A),$L._getValign()){case 0:$e.y=$T;break;case 1:var $G=0;99999!=this.minTextHeight&&($G=this.minTextHeight);var $M=($G+$V)/2;$M=Math.max($M,this.h),$q=(laya.html.dom.HTMLImageElement,$T+$M-$e.height),$e.y=$q;break;case 2:$e.y=$T+($V-$e.height)}}},$H.revertOrder=function($t){var $H;if(0<this.elements.length){var $I,$T=0;for($I=this.elements.length,$T=0;$T<$I;$T++)($H=this.elements[$T]).x=$t-$H.x-$H.width}},$t}(),$N=function($I){function $H(){this.URI=null,this._href=null,$H.__super.call(this),this._text=$H._EMPTYTEXT,this.setStyle(new $R(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$V($H,"laya.html.dom.HTMLElement",$I);var $t=$H.prototype;return $t.layaoutCallNative=function(){var $t=0;if(this._childs&&0<($t=this._childs.length))for(var $H=0;$H<$t;$H++)this._childs[$H].layaoutCallNative&&this._childs[$H].layaoutCallNative();var $I=this._getWords();$I?laya.html.dom.HTMLElement.fillWords(this,$I,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$t.appendChild=function($t){return this.addChild($t)},$t._getWords2=function(){var $t=this._text.text;if(!$t||0===$t.length)return null;var $H,$I,$T=0,$K=0;if(this._text.drawWords)$I=this._text.drawWords;else{for($K=($H=$t.split(" ")).length-1,$I=[],$T=0;$T<$K;$T++)$I.push($H[$T]," ");0<=$K&&$I.push($H[$K]),this._text.drawWords=$I}var $_,$V=this._text.words;if($V&&$V.length===$I.length)return $V;null===$V&&(this._text.words=$V=[]),$V.length=$I.length;var $e=this.style,$R=$e.font;for($T=0,$K=$I.length;$T<$K;$T++){$_=$S.measureText($I[$T],$R);var $A=$V[$T]=new $f($I[$T],$_.width,$_.height||$e.fontSize,$e);if(1<$A.char.length&&($A.charNum=$A.char),this.href){var $q=new $L;this.addChild($q),$A.setSprite($q)}}return $V},$t._getWords=function(){if(!$v.CharacterCache)return this._getWords2();var $t=this._text.text;if(!$t||0===$t.length)return null;var $H,$I=this._text.words;if($I&&$I.length===$t.length)return $I;null===$I&&(this._text.words=$I=[]),$I.length=$t.length;for(var $T=this.style,$K=$T.font,$_=0,$V=$t.length;$_<$V;$_++)if($H=$S.measureText($t.charAt($_),$K)){var $e=$I[$_]=new $f($t.charAt($_),$H.width,$H.height||$T.fontSize,$T);if(this.href){var $R=new $L;this.addChild($R),$e.setSprite($R)}}else console.warn("_getWords size is null"+$t.charAt($_),$K);return $I},$t.showLinkSprite=function(){var $t=this._text.words;if($t)for(var $H,$I,$T=[],$K=0;$K<$t.length;$K++)$I=$t[$K],($H=new $L).graphics.drawRect(0,0,$I.width,$I.height,"#ff0000"),$H.width=$I.width,$H.height=$I.height,this.addChild($H),$T.push($H)},$t._layoutLater=function(){var $t=this.style;512&$t._type||($t.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$t.block?($C.later(this),$t._type|=512):this.parent&&this.parent._layoutLater())},$t._setAttributes=function($t,$H){switch($t){case"style":return void this.style.cssText($H);case"class":return void(this.className=$H)}$I.prototype._setAttributes.call(this,$t,$H)},$t.updateHref=function(){if(null!=this._href){var $t=this._getWords();if($t)for(var $H,$I,$T=0;$T<$t.length;$T++)($I=($H=$t[$T]).getSprite())&&($I.size($H.width,$H.height),$I.on("click",this,this.onLinkHandler))}},$t.onLinkHandler=function($t){switch($t.type){case"click":for(var $H=this;$H;)$H.event("link",[this.href]),$H=$H.parent}},$t.formatURL=function($t){return this.URI?$J.formatURL($t,this.URI?this.URI.path:null):$t},$e(0,$t,"href",function(){return this._href},function($t){null!=(this._href=$t)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$e(0,$t,"color",null,function($t){this.style.color=$t}),$e(0,$t,"onClick",null,function($t){$T._runScript("fn=function(event){"+$t+";}"),this.on("click",this,void 0)}),$e(0,$t,"id",null,function($t){$w.document.setElementById($t,this)}),$e(0,$t,"innerTEXT",function(){return this._text.text},function($t){this.text=$t}),$e(0,$t,"style",function(){return this._style}),$e(0,$t,"text",function(){return this._text.text},function($t){this._text==$H._EMPTYTEXT?this._text={text:$t,words:null}:(this._text.text=$t,this._text.words&&(this._text.words.length=0)),$b.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$e(0,$t,"parent",$I.prototype._$get_parent,function($t){if($t instanceof laya.html.dom.HTMLElement){var $H=$t;this.URI||(this.URI=$H.URI),this.style.inherit($H.style)}$T.superSet($L,this,"parent",$t)}),$e(0,$t,"className",null,function($t){this.style.attrs($w.document.styleSheets["."+$t])}),$H.fillWords=function($t,$H,$I,$T,$K,$_,$V){$t.graphics.clear();for(var $e=0,$R=$H.length;$e<$R;$e++){var $A=$H[$e];$t.graphics.fillText($A.char,$A.x+$I,$A.y+$T,$K,$_,"left",$V)}},$H._EMPTYTEXT={text:null,words:null},$H}($L),$H=(function($t){function $H(){$H.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$V($H,"laya.html.dom.HTMLBrElement",$N)}(),function($t){function $H(){this.contextHeight=NaN,this.contextWidth=NaN,$H.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$V($H,"laya.html.dom.HTMLDivElement",$t);var $I=$H.prototype;return $I.appendHTML=function($t){$U.parse(this,$t,this.URI),this.layout()},$I._addChildsToLayout=function($H){var $t=this._getWords();if(null==$t&&0==this._childs.length)return!1;$t&&$t.forEach(function($t){$H.push($t)});for(var $I=!0,$T=0,$K=this._childs.length;$T<$K;$T++){var $_=this._childs[$T];$I?$I=!1:$H.push(null),$_._addToLayout($H)}return!0},$I._addToLayout=function($t){this.layout()},$I.layout=function(){if(this.style){this.style._type|=512;var $t=$C.layout(this);if($t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $q);var $H=this._$P.mHtmlBounds;$H.x=$H.y=0,$H.width=this.contextWidth=$t[0],$H.height=this.contextHeight=$t[1],this.setBounds($H)}}},$e(0,$I,"height",function(){return this._height?this._height:this.contextHeight},$t.prototype._$set_height),$e(0,$I,"innerHTML",null,function($t){this.destroyChildren(),this.appendHTML($t)}),$e(0,$I,"width",function(){return this._width?this._width:this.contextWidth},function($t){var $H=!1;$H=0===$t?$t!=this._width:$t!=this.width,$T.superSet($N,this,"width",$t),$H&&this.layout()}),$H}($N)),$w=function($t){function $H(){this.all=new Array,this.styleSheets=$R.styleSheets,$H.__super.call(this)}$V($H,"laya.html.dom.HTMLDocument",$N);var $I=$H.prototype;return $I.getElementById=function($t){return this.all[$t]},$I.setElementById=function($t,$H){this.all[$t]=$H},$K($H,["document",function(){return this.document=new $H}]),$H}();(function($t){function $H(){this._tex=null,this._url=null,this._renderArgs=[],$H.__super.call(this),this.style.block=!0}$V($H,"laya.html.dom.HTMLImageElement",$N);var $I=$H.prototype;$I._addToLayout=function($t){!this._style.absolute&&$t.push(this)},$I.render=function($t,$H,$I){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($M.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$t.ctx.drawTexture2($H,$I,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$I.layaoutCallNative=function(){var $t=0;if(this._childs&&0<($t=this._childs.length))for(var $H=0;$H<$t;$H++)this._childs[$H].layaoutCallNative&&this._childs[$H].layaoutCallNative()},$e(0,$I,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($t){this._width!==$t&&(this._width=$t,this._style.width=$t,this.repaint())}),$e(0,$I,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($t){this._height!==$t&&(this._height=$t,this._style.height=$t,this.repaint())}),$I.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$A.clearCache(this,this._url),this._tex=null),$N.prototype.destroy.call(this)},$I.onloaded=function(){var $t=this._style;$t&&!$t.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$t&&!$t.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$b.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$I._loadImageComplete=function($t,$H,$I){if(!this._destroyed)if(null!=$I)if($I instanceof ArrayBuffer){var $T=new DataView($I);new laya.webgl.resource.WebGLImage(new Uint8Array($I,8),$t,0,!1,$T.getUint32(0),$T.getUint32(4));this.onloaded()}else if($I instanceof $O)$A.imgMgrSet[$t]=$H,$_.imgMgrLock($t,$A.imgMgrSet[$t]),this._url=$t,this._tex=$I,$A.keepCache(this,$t),$A.cacheRes($t,this._tex),this.onloaded();else{var $K=-1!=$t.indexOf(".png",$t.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($I,$t,$K,!1,$I.width,$I.height);this.onloaded()}else this.event("error","Load image failed")},$e(0,$I,"src",null,function($t){($t=this.formatURL($t),this._url!=$t)&&(null!=this._tex&&($A.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$t,(this._tex=$A.getRes($t))?($A.keepCache(this,$t),this.onloaded()):$_.imgMgrLoad($t,this._loadImageComplete.bind(this),2,!1))})})(),function($t){function $H(){this.type=null,$H.__super.call(this),this.visible=!1}$V($H,"laya.html.dom.HTMLLinkElement",$t);var $I=$H.prototype;$I._onload=function($t){switch(this.type){case"text/css":$R.parseCSS($t,this.URI)}},$e(0,$I,"href",$t.prototype._$get_href,function($t){var $H=this;$t=this.formatURL($t),this.URI=new $J($t);var $I=new $A;$I.once("complete",null,function($t){$H._onload($t)}),$I.load($t,"text")}),$H._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($N),function($t){function $H(){$H.__super.call(this),this.visible=!1}$V($H,"laya.html.dom.HTMLStyleElement",$t),$e(0,$H.prototype,"text",$t.prototype._$get_text,function($t){$R.parseCSS($t,null)})}($N),function($t){function $H(){$H.__super.call(this),this._getCSSStyle().valign="middle"}$V($H,"laya.html.dom.HTMLIframeElement",$t),$e(0,$H.prototype,"href",$t.prototype._$get_href,function($I){var $T=this;$I=this.formatURL($I);var $t=new $A;$t.once("complete",null,function($t){var $H=$T.URI;$T.URI=new $J($I),$T.innerHTML=$t,!$H||($T.URI=$H)}),$t.load($I,"text")})}($H)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($t,$H){"use strict";for(var $I in Object.defineProperty($H,"__esModule",{value:!0}),Laya){var $T=Laya[$I];$T&&$T.__isclass&&($H[$I]=$T)}}),function($K,$t,$M){$M.un,$M.uns;var $T=$M.static,$_=$M.class,$V=$M.getset,$I=($M.__newvec,laya.display.Animation),$O=(laya.utils.Browser,laya.utils.ClassUtils),$e=laya.filters.ColorFilter,$R=laya.utils.Ease,$A=laya.events.Event,$q=(laya.events.EventDispatcher,laya.display.css.Font),$f=laya.display.FrameAnimation,$H=laya.display.Graphics,$b=laya.utils.Handler,$L=laya.display.Input,$S=laya.net.Loader,$G=(laya.display.Node,laya.maths.Point),$J=laya.maths.Rectangle,$U=laya.renders.Render,$C=laya.display.Sprite,$N=laya.display.Text,$w=laya.resource.Texture,$W=laya.utils.Tween,$s=laya.utils.Utils,$z=laya.utils.WeakObject;$M.interface("laya.ui.IItem"),$M.interface("laya.ui.ISelect"),$M.interface("laya.ui.IRender"),$M.interface("laya.ui.IComponent"),$M.interface("laya.ui.IBox","IComponent");var $P=function(){function $t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $_($t,"laya.ui.LayoutStyle"),$T($t,["EMPTY",function(){return this.EMPTY=new $t}]),$t}(),$k=function(){function $t(){}return $_($t,"laya.ui.Styles"),$t.labelColor="#000000",$t.buttonStateNum=3,$t.scrollBarMinNum=15,$t.scrollBarDelayTime=500,$T($t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$t}(),$r=function(){function $K(){}return $_($K,"laya.ui.UIUtils"),$K.fillArray=function($t,$H,$I){var $T=$t.concat();if($H)for(var $K=$H.split(","),$_=0,$V=Math.min($T.length,$K.length);$_<$V;$_++){var $e=$K[$_];$T[$_]="true"==$e||"false"!=$e&&$e,null!=$I&&($T[$_]=$I($e))}return $T},$K.toColor=function($t){return $s.toHexColor($t)},$K.gray=function($t,$H){void 0===$H&&($H=!0),$H?$K.addFilter($t,$K.grayFilter):$K.clearFilter($t,$e)},$K.addFilter=function($t,$H){var $I=$t.filters||[];$I.push($H),$t.filters=$I},$K.clearFilter=function($t,$H){var $I=$t.filters;if(null!=$I&&0<$I.length){for(var $T=$I.length-1;-1<$T;$T--){var $K=$I[$T];$M.__typeof($K,$H)&&$I.splice($T,1)}$t.filters=$I}},$K._getReplaceStr=function($t){return $K.escapeSequence[$t]},$K.adptString=function($t){return $t.replace(/\\(\w)/g,$K._getReplaceStr)},$K.getBindFun=function($t){var $H=$K._funMap.get($t);if(null==$H){var $I='"'+$t+'"',$T="(function(data){if(data==null)return;with(data){try{\nreturn "+($I=$I.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$H=$M._runScript($T),$K._funMap.set($t,$H)}return $H},$T($K,["grayFilter",function(){return this.grayFilter=new $e([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $z}]),$K}(),$x=function(){function $t(){}return $_($t,"UIConfig"),$t.touchScrollEnable=!0,$t.mouseWheelEnable=!0,$t.showButtons=!0,$t.popupBgColor="#000000",$t.popupBgAlpha=.5,$t.closeDialogOnSide=!0,$t}(),$Y=function($I){function $J(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$J.__super.call(this),this._weakKeys=[]}$_($J,"laya.ui.AutoBitmap",$I);var $t=$J.prototype;return $t.destroy=function(){if($S.clearObject(this,this._weakKey),this._weakKeys){for(var $t=0,$H=this._weakKeys.length;$t<$H;++$t)$S.clearObject(this,this._weakKeys[$t]);this._weakKeys=null}$I.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$t._setChanged=function(){this._isChanged||(this._isChanged=!0,$M.timer.callLater(this,this.changeSource))},$t.changeSource=function(){this._isChanged=!1;var $t=this._source;if($t&&$t.bitmap){var $H=this.width,$I=this.height,$T=this._sizeGrid,$K=$t.sourceWidth,$_=$t.sourceHeight;if(!$T||$K===$H&&$_===$I)this.cleanByTexture($t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$H,$I);else{$S.clearObject(this,this._weakKey),$t.$_GID||($t.$_GID=$s.getGID());var $V=$t.$_GID+"."+$H+"."+$I+"."+$T.join("."),$e=$S.findObject($V);if($s.isOKCmdList($e))return this._weakKey=$V,$S.keepObject(this,this._weakKey),void(this.cmds=$e);this.clear();var $R,$A,$q=$T[0],$f=$T[1],$b=$T[2],$L=$T[3],$G=$T[4],$M=!1;if($H==$K&&($L=$f=0),$I==$_&&($q=$b=0),$H<$L+$f){var $O=$H;$M=!0,$H=$L+$f,this.save(),this.clipRect(0,0,$O,$I)}$L&&$q&&($R=$J.getTexture($t,0,0,$L,$q),$A=this._weakKeys[0],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[0]=$R.weakKey),this.drawTexture($R,0,0,$L,$q)):($S.clearObject(this,$A),this._weakKeys[0]="")),$f&&$q&&($R=$J.getTexture($t,$K-$f,0,$f,$q),$A=this._weakKeys[1],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[1]=$R.weakKey),this.drawTexture($R,$H-$f,0,$f,$q)):($S.clearObject(this,$A),this._weakKeys[1]="")),$L&&$b&&($R=$J.getTexture($t,0,$_-$b,$L,$b),$A=this._weakKeys[2],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[2]=$R.weakKey),this.drawTexture($R,0,$I-$b,$L,$b)):($S.clearObject(this,$A),this._weakKeys[2]="")),$f&&$b&&($R=$J.getTexture($t,$K-$f,$_-$b,$f,$b),$A=this._weakKeys[3],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[3]=$R.weakKey),this.drawTexture($R,$H-$f,$I-$b,$f,$b)):($S.clearObject(this,$A),this._weakKeys[3]="")),$q&&($R=$J.getTexture($t,$L,0,$K-$L-$f,$q),$A=this._weakKeys[4],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[4]=$R.weakKey),this.drawBitmap($G,$R,$L,0,$H-$L-$f,$q)):($S.clearObject(this,$A),this._weakKeys[4]="")),$b&&($R=$J.getTexture($t,$L,$_-$b,$K-$L-$f,$b),$A=this._weakKeys[5],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[5]=$R.weakKey),this.drawBitmap($G,$R,$L,$I-$b,$H-$L-$f,$b)):($S.clearObject(this,$A),this._weakKeys[5]="")),$L&&($R=$J.getTexture($t,0,$q,$L,$_-$q-$b),$A=this._weakKeys[6],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[6]=$R.weakKey),this.drawBitmap($G,$R,0,$q,$L,$I-$q-$b)):($S.clearObject(this,$A),this._weakKeys[6]="")),$f&&($R=$J.getTexture($t,$K-$f,$q,$f,$_-$q-$b),$A=this._weakKeys[7],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[7]=$R.weakKey),this.drawBitmap($G,$R,$H-$f,$q,$f,$I-$q-$b)):($S.clearObject(this,$A),this._weakKeys[7]="")),$R=$J.getTexture($t,$L,$q,$K-$L-$f,$_-$q-$b),$A=this._weakKeys[8],$R?($A!=$R.weakKey&&($S.clearObject(this,$A),$S.keepObject(this,$R.weakKey),this._weakKeys[8]=$R.weakKey),this.drawBitmap($G,$R,$L,$q,$H-$L-$f,$I-$q-$b)):($S.clearObject(this,$A),this._weakKeys[8]=""),$M&&this.restore(),this.autoCacheCmd&&!$U.isConchApp&&($S.saveObject($V,this.cmds,null),this._weakKey=$V,$S.keepObject(this,this._weakKey))}this._repaint()}},$t.drawBitmap=function($t,$H,$I,$T,$K,$_){void 0===$K&&($K=0),void 0===$_&&($_=0),$K<.1||$_<.1||(!$t||$H.width==$K&&$H.height==$_?this.drawTexture($H,$I,$T,$K,$_):this.fillTexture($H,$I,$T,$K,$_))},$t.clear=function($t){void 0===$t&&($t=!0),$I.prototype.clear.call(this,!1)},$V(0,$t,"sizeGrid",function(){return this._sizeGrid},function($t){this._sizeGrid=$t,this._setChanged()}),$V(0,$t,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($t){this._width!=$t&&(this._width=$t,this._setChanged())}),$V(0,$t,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($t){this._height!=$t&&(this._height=$t,this._setChanged())}),$V(0,$t,"source",function(){return this._source},function($t){$t?(this._source=$t,this._setChanged()):(this._source=null,this.clear())}),$J.getTexture=function($t,$H,$I,$T,$K){$T<=0&&($T=1),$K<=0&&($K=1),$t.$_GID||($t.$_GID=$s.getGID());var $_=$t.$_GID+"."+$H+"."+$I+"."+$T+"."+$K,$V=$S.findObject($_);if((!$V||!$V.source)&&($V=$w.createFromTexture($t,$H,$I,$T,$K))){if($t.alphaTexture){var $e=$t.width/$t.alphaTexture.width;$V.alphaTexture=$w.createFromTexture($t.alphaTexture,$H/$e,$I/$e,$T/$e,$K/$e)}$S.saveObject($_,$V),$V.weakKey=$_}return $V},$J}($H),$D=(function($t){function $H(){$H.__super.call(this)}$_($H,"laya.ui.UIEvent",$A),$H.SHOW_TIP="showtip",$H.HIDE_TIP="hidetip"}(),function($H){function $t(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$t.__super.call(this),this._layout=$P.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$_($t,"laya.ui.Component",$H);var $I=$t.prototype;return $M.imps($I,{"laya.ui.IComponent":!0}),$I.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$I.preinitialize=function(){},$I.createChildren=function(){},$I.initialize=function(){},$I.callLater=function($t,$H){$M.timer.callLater(this,$t,$H)},$I.runCallLater=function($t){$M.timer.runCallLater(this,$t)},$I.commitMeasure=function(){},$I.changeSize=function(){this.event("resize")},$I.getLayout=function(){return this._layout===$P.EMPTY&&(this._layout=new $P),this._layout},$I._setLayoutEnabled=function($t){this._layout&&this._layout.enable!=$t&&(this._layout.enable=$t,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$I.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$I.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$I.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$I.resetLayoutX=function(){var $t=this._layout;if(isNaN($t.anchorX)||(this.pivotX=$t.anchorX*this.width),this.layoutEnabled){var $H=this.parent;$H&&(isNaN($t.centerX)?isNaN($t.left)?isNaN($t.right)||(this.x=Math.round($H.width-this.displayWidth-$t.right+this.pivotX*this.scaleX)):(this.x=Math.round($t.left+this.pivotX*this.scaleX),isNaN($t.right)||(this.width=($H._width-$t.left-$t.right)/(this.scaleX||.01))):this.x=Math.round(.5*($H.width-this.displayWidth)+$t.centerX+this.pivotX*this.scaleX))}},$I.resetLayoutY=function(){var $t=this._layout;if(isNaN($t.anchorY)||(this.pivotY=$t.anchorY*this.height),this.layoutEnabled){var $H=this.parent;$H&&(isNaN($t.centerY)?isNaN($t.top)?isNaN($t.bottom)||(this.y=Math.round($H.height-this.displayHeight-$t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($t.top+this.pivotY*this.scaleY),isNaN($t.bottom)||(this.height=($H._height-$t.top-$t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($H.height-this.displayHeight)+$t.centerY+this.pivotY*this.scaleY))}},$I.onMouseOver=function($t){$M.stage.event("showtip",this._toolTip)},$I.onMouseOut=function($t){$M.stage.event("hidetip",this._toolTip)},$V(0,$I,"displayWidth",function(){return this.width*this.scaleX}),$V(0,$I,"width",function(){return this._width?this._width:this.measureWidth},function($t){this._width!=$t&&(this._width=$t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$V(0,$I,"measureWidth",function(){var $t=0;this.commitMeasure();for(var $H=this.numChildren-1;-1<$H;$H--){var $I=this.getChildAt($H);$I.visible&&($t=Math.max($I.x+$I.width*$I.scaleX,$t))}return $t}),$V(0,$I,"displayHeight",function(){return this.height*this.scaleY}),$V(0,$I,"height",function(){return this._height?this._height:this.measureHeight},function($t){this._height!=$t&&(this._height=$t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$V(0,$I,"dataSource",function(){return this._dataSource},function($t){for(var $H in this._dataSource=$t,this._dataSource)this.hasOwnProperty($H)&&"function"!=typeof this[$H]&&(this[$H]=this._dataSource[$H])}),$V(0,$I,"scaleY",$H.prototype._$get_scaleY,function($t){$M.superGet($C,this,"scaleY")!=$t&&($M.superSet($C,this,"scaleY",$t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$V(0,$I,"measureHeight",function(){var $t=0;this.commitMeasure();for(var $H=this.numChildren-1;-1<$H;$H--){var $I=this.getChildAt($H);$I.visible&&($t=Math.max($I.y+$I.height*$I.scaleY,$t))}return $t}),$V(0,$I,"scaleX",$H.prototype._$get_scaleX,function($t){$M.superGet($C,this,"scaleX")!=$t&&($M.superSet($C,this,"scaleX",$t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$V(0,$I,"top",function(){return this._layout.top},function($t){$t!=this._layout.top&&(this.getLayout().top=$t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$V(0,$I,"bottom",function(){return this._layout.bottom},function($t){$t!=this._layout.bottom&&(this.getLayout().bottom=$t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$V(0,$I,"left",function(){return this._layout.left},function($t){$t!=this._layout.left&&(this.getLayout().left=$t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$V(0,$I,"right",function(){return this._layout.right},function($t){$t!=this._layout.right&&(this.getLayout().right=$t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$V(0,$I,"centerX",function(){return this._layout.centerX},function($t){$t!=this._layout.centerX&&(this.getLayout().centerX=$t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$V(0,$I,"centerY",function(){return this._layout.centerY},function($t){$t!=this._layout.centerY&&(this.getLayout().centerY=$t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$V(0,$I,"anchorX",function(){return this._layout.anchorX},function($t){$t!=this._layout.anchorX&&(this.getLayout().anchorX=$t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$V(0,$I,"anchorY",function(){return this._layout.anchorY},function($t){$t!=this._layout.anchorY&&(this.getLayout().anchorY=$t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$V(0,$I,"tag",function(){return this._tag},function($t){this._tag=$t}),$V(0,$I,"toolTip",function(){return this._toolTip},function($t){this._toolTip!=$t&&(null!=(this._toolTip=$t)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$V(0,$I,"comXml",function(){return this._comXml},function($t){this._comXml=$t}),$V(0,$I,"gray",function(){return this._gray},function($t){$t!==this._gray&&(this._gray=$t,$r.gray(this,$t))}),$V(0,$I,"disabled",function(){return this._disabled},function($t){$t!==this._disabled&&(this.gray=this._disabled=$t,this.mouseEnabled=!$t)}),$t}($C)),$p=function($t){function $H(){this.lockLayer=null,this.popupEffect=function($t){$t.scale(1,1),$W.from($t,{x:$M.stage.width/2,y:$M.stage.height/2,scaleX:0,scaleY:0},300,$R.backOut,$b.create(this,this.doOpen,[$t]))},this.closeEffect=function($t,$H){$W.to($t,{x:$M.stage.width/2,y:$M.stage.height/2,scaleX:0,scaleY:0},300,$R.strongOut,$b.create(this,this.doClose,[$t,$H]))},$H.__super.call(this),this.maskLayer=new $C,this.popupEffectHandler=$b.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$b.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$M.stage.addChild(this),$M.stage.on("resize",this,this._onResize),$x.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$_($H,"laya.ui.DialogManager",$C);var $I=$H.prototype;return $I._closeOnSide=function(){var $t=this.getChildAt(this.numChildren-1);$t instanceof laya.ui.Dialog&&$t.close("side")},$I.setLockView=function($t){this.lockLayer||(this.lockLayer=new $g,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($M.stage.width,$M.stage.height)),this.lockLayer.removeChildren(),$t&&($t.centerX=$t.centerY=0,this.lockLayer.addChild($t))},$I._onResize=function($t){var $H=this.maskLayer.width=$M.stage.width,$I=this.maskLayer.height=$M.stage.height;this.lockLayer&&this.lockLayer.size($H,$I),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$H,$I,$x.popupBgColor),this.maskLayer.alpha=$x.popupBgAlpha;for(var $T=this.numChildren-1;-1<$T;$T--){var $K=this.getChildAt($T);$K.popupCenter&&this._centerDialog($K)}},$I._centerDialog=function($t){$t.x=Math.round(($M.stage.width-$t.width>>1)+$t.pivotX),$t.y=Math.round(($M.stage.height-$t.height>>1)+$t.pivotY)},$I.open=function($t,$H,$I){void 0===$H&&($H=!1),void 0===$I&&($I=!1),$H&&this._closeAll(),$t.popupCenter&&this._centerDialog($t),this.addChild($t),($t.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$I&&null!=$t.popupEffect?$t.popupEffect.runWith($t):this.doOpen($t),this.event("open")},$I.doOpen=function($t){$t.onOpened()},$I.lock=function($t){this.lockLayer&&($t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$I.close=function($t,$H,$I){void 0===$I&&($I=!1),$I&&null!=$t.closeEffect?$t.closeEffect.runWith([$t,$H]):this.doClose($t,$H),this.event("close")},$I.doClose=function($t,$H){$t.removeSelf(),$t.isModal&&this._checkMask(),$t.closeHandler&&$t.closeHandler.runWith($H),$t.onClosed($H)},$I.closeAll=function(){this._closeAll(),this.event("close")},$I._closeAll=function(){for(var $t=this.numChildren-1;-1<$t;$t--){var $H=this.getChildAt($t);$H&&null!=$H.close&&this.doClose($H)}},$I.getDialogsByGroup=function($t){for(var $H=[],$I=this.numChildren-1;-1<$I;$I--){var $T=this.getChildAt($I);$T&&$T.group===$t&&$H.push($T)}return $H},$I.closeByGroup=function($t){for(var $H=[],$I=this.numChildren-1;-1<$I;$I--){var $T=this.getChildAt($I);$T&&$T.group===$t&&($T.close(),$H.push($T))}return $H},$I._checkMask=function(){this.maskLayer.removeSelf();for(var $t=this.numChildren-1;-1<$t;$t--){var $H=this.getChildAt($t);if($H&&$H.isModal)return void this.addChildAt(this.maskLayer,$t)}},$H}(),$g=function($t){function $H(){$H.__super.call(this)}$_($H,"laya.ui.Box",$t);var $I=$H.prototype;return $M.imps($I,{"laya.ui.IBox":!0}),$V(0,$I,"dataSource",$t.prototype._$get_dataSource,function($t){for(var $H in this._dataSource=$t){var $I=this.getChildByName($H);$I?$I.dataSource=$t[$H]:this.hasOwnProperty($H)&&"function"!=typeof this[$H]&&(this[$H]=$t[$H])}}),$H}($D),$l=function($H){function $I($t,$H){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$I.__super.call(this),this._labelColors=$k.buttonLabelColors,this._stateNum=$k.buttonStateNum,void 0===$H&&($H=""),this.skin=$t,this.label=$H}$_($I,"laya.ui.Button",$H);var $t=$I.prototype;return $M.imps($t,{"laya.ui.ISelect":!0}),$t.destroy=function($t){this.clearEvent(),$S.clearCache(this,this._skin),$S.clearObject(this,this._weakKey),void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($t),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$t.clearEvent=function(){this._skin&&$K.atalsNotify&&$K.atalsNotify.off(this._skin,this,this._setBtnSource)},$t.createChildren=function(){this.graphics=this._bitmap=new $Y},$t.createText=function(){this._text||(this._text=new $N,this._text.overflow=$N.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$t.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$t.onMouse=function($t){if(!1!==this.toggle||!this._selected)return"click"===$t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$I.stateMap[$t.type]))},$t.changeClips=function(){var $t=$S.getRes(this._skin);if($t)if(this._skin&&""!=this._skin){$S.clearObject(this,this._weakKey);var $H=$t.sourceWidth,$I=$t.sourceHeight/this._stateNum;$t.$_GID||($t.$_GID=$s.getGID());var $T=$t.$_GID+"-"+this._stateNum,$K=$S.findObject($T);if($s.isOkTextureList($K)||($K=null),$K)this._weakKey=$T,$S.keepObject(this,this._weakKey),this._sources=$K;else{if(this._sources=[],1===this._stateNum)this._sources.push($t);else for(var $_=0;$_<this._stateNum;$_++){var $V=$w.createFromTexture($t,0,$I*$_,$H,$I);if($t.alphaTexture){var $e=$t.width/$t.alphaTexture.width;$V.alphaTexture=$w.createFromTexture($t.alphaTexture,0/$e,$I*$_/$e,$H/$e,$I/$e)}this._sources.push($V)}$S.saveObject($T,this._sources),this._weakKey=$T,$S.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$H,this._bitmap.height=this._height||$I,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$H)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$t.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$t]),this.label&&(this._text.color=this._labelColors[$t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$t]))},$t._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$V(0,$t,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($t){this.createText(),this._text.strokeColor=$t}),$V(0,$t,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$V(0,$t,"skin",function(){return this._skin},function($t){if(this._skin!=$t)if(this.clearEvent(),$S.clearCache(this,this._skin),this._skin=$t,$S.keepCache(this,this._skin),$S.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $H=$K.resAtalsObj&&$K.resAtalsObj[this._skin];$H?($K.atalsNotify&&$K.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$H.sourceW),0==this.height&&(this.height=$H.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$t._setBtnSource=function($t,$H){$t===this._skin&&$H&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$V(0,$t,"state",function(){return this._state},function($t){this._state!=$t&&(this._state=$t,this._setStateChanged())}),$V(0,$t,"text",function(){return this.createText(),this._text}),$V(0,$t,"stateNum",function(){return this._stateNum},function($t){"string"==typeof $t&&($t=parseInt($t)),this._stateNum!=$t&&(this._stateNum=$t<1?1:3<$t?3:$t,this.callLater(this.changeClips))}),$V(0,$t,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($t){this._strokeColors=$r.fillArray($k.buttonLabelColors,$t,String),this._setStateChanged()}),$V(0,$t,"labelColors",function(){return this._labelColors.join(",")},function($t){this._labelColors=$r.fillArray($k.buttonLabelColors,$t,String),this._setStateChanged()}),$V(0,$t,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$V(0,$t,"label",function(){return this._text?this._text.text:null},function($t){(this._text||$t)&&(this.createText(),this._text.text!=$t&&($t&&!this._text.parent&&this.addChild(this._text),this._text.text=($t+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$V(0,$t,"selected",function(){return this._selected},function($t){this._selected!=$t&&(this._selected=$t,this.state=this._selected?2:0,this.event("change"))}),$V(0,$t,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($t){this.createText(),this._text.padding=$r.fillArray($k.labelPadding,$t,Number)}),$V(0,$t,"labelSize",function(){return this.createText(),this._text.fontSize},function($t){this.createText(),this._text.fontSize=$t}),$V(0,$t,"labelStroke",function(){return this.createText(),this._text.stroke},function($t){this.createText(),this._text.stroke=$t}),$V(0,$t,"labelBold",function(){return this.createText(),this._text.bold},function($t){this.createText(),this._text.bold=$t}),$V(0,$t,"labelFont",function(){return this.createText(),this._text.font},function($t){this.createText(),this._text.font=$t}),$V(0,$t,"labelAlign",function(){return this.createText(),this._text.align},function($t){this.createText(),this._text.align=$t}),$V(0,$t,"clickHandler",function(){return this._clickHandler},function($t){this._clickHandler=$t}),$V(0,$t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($t){this._bitmap.sizeGrid=$r.fillArray($k.defaultSizeGrid,$t,Number)}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($D,this,"width",$t),this._autoSize&&(this._bitmap.width=$t,this._text&&(this._text.width=$t))}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($D,this,"height",$t),this._autoSize&&(this._bitmap.height=$t,this._text&&(this._text.height=$t))}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)||"string"==typeof $t?this.label=$t+"":$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($t){this._bitmap._offset=$t?$r.fillArray([1,1],$t,Number):[]}),$T($I,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$I}($D),$v=function($H){function $T($t,$H,$I){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$T.__super.call(this),void 0===$H&&($H=1),void 0===$I&&($I=1),this._clipX=$H,this._clipY=$I,this.skin=$t}$_($T,"laya.ui.Clip",$H);var $t=$T.prototype;return $t.destroy=function($t){this.clearEvent(),this.clearLoad(),$S.clearCache(this,this._skin),$S.clearObject(this,this._weakKey),void 0===$t&&($t=!0),$H.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$t.dispose=function(){this.destroy(!0),$M.loader.clearRes(this._skin)},$t.createChildren=function(){this.graphics=this._bitmap=new $Y},$t._onDisplay=function($t){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$t.changeClip=function(){if(this._clipChanged=!1,this._skin){var $t=$S.getRes(this._skin);if($t)this.loadComplete(this._skin,$t);else{if($K.resAtalsObj&&$K.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$b.create(this,this.loadComplete,[this._skin]),this._progress=null,$M.loader.load(this._skin,this._complete,this._progress)}}},$t.loadComplete=function($t,$H){if($t===this._skin&&$H){$S.clearObject(this,this._weakKey);var $I=this._clipWidth||Math.ceil($H.sourceWidth/this._clipX),$T=this._clipHeight||Math.ceil($H.sourceHeight/this._clipY),$K=this._skin+$I+$T,$_=$S.findObject($K);if($s.isOkTextureList($_)||($_=null),$_)this._weakKey=$K,$S.keepObject(this,this._weakKey),this._sources=$_;else{this._sources=[];for(var $V=0;$V<this._clipY;$V++)for(var $e=0;$e<this._clipX;$e++){var $R=$w.createFromTexture($H,$I*$e,$T*$V,$I,$T);if($H.alphaTexture){var $A=$H.width/$H.alphaTexture.width;$R.alphaTexture=$w.createFromTexture($H.alphaTexture,$I*$e/$A,$T*$V/$A,$I/$A,$T/$A)}this._sources.push($R)}$S.saveObject($K,this._sources),this._weakKey=$K,$S.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$t.play=function($t,$H){void 0===$t&&($t=0),void 0===$H&&($H=-1),this._isPlaying=!0,this.index=$t,this._toIndex=$H,this._index++,$M.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$t._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$t.stop=function(){this._isPlaying=!1,$M.timer.clear(this,this._loop),this.event("complete")},$t._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$V(0,$t,"interval",function(){return this._interval},function($t){this._interval!=$t&&(this._interval=$t,this._isPlaying&&this.play())}),$t.clearEvent=function(){this._skin&&$K.atalsNotify&&$K.atalsNotify.off(this._skin,this,this._setBtnSource)},$t.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$M.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$V(0,$t,"skin",function(){return this._skin},function($t){if(this._skin!=$t)if(this.clearLoad(),this.clearEvent(),$S.clearCache(this,this._skin),this._skin=$t){$S.keepCache(this,this._skin);var $H=$S.getRes($t),$I=$K.resAtalsObj&&$K.resAtalsObj[this._skin];!$H&&$I?$K.atalsNotify&&$K.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$t._setBtnSource=function($t,$H){$t===this._skin&&$H&&(this.loadComplete($t,$H),this.clearEvent())},$V(0,$t,"sources",function(){return this._sources},function($t){this._sources=$t,this.index=this._index,this.event("loaded")}),$V(0,$t,"clipX",function(){return this._clipX},function($t){this._clipX=$t||1,this._setClipChanged()}),$V(0,$t,"clipY",function(){return this._clipY},function($t){this._clipY=$t||1,this._setClipChanged()}),$V(0,$t,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$V(0,$t,"clipWidth",function(){return this._clipWidth},function($t){this._clipWidth=$t,this._setClipChanged()}),$V(0,$t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($t){this._bitmap.sizeGrid=$r.fillArray($k.defaultSizeGrid,$t,Number)}),$V(0,$t,"group",function(){return this._group},function($t){$t&&this._skin&&$S.setGroup(this._skin,$t),this._group=$t}),$V(0,$t,"clipHeight",function(){return this._clipHeight},function($t){this._clipHeight=$t,this._setClipChanged()}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($D,this,"width",$t),this._bitmap.width=$t}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($D,this,"height",$t),this._bitmap.height=$t}),$V(0,$t,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$V(0,$t,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$V(0,$t,"index",function(){return this._index},function($t){this._index=$t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$t]),this.event("change")}),$V(0,$t,"autoPlay",function(){return this._autoPlay},function($t){this._autoPlay!=$t&&((this._autoPlay=$t)?this.play():this.stop())}),$V(0,$t,"isPlaying",function(){return this._isPlaying},function($t){this._isPlaying=$t}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)&&Math.floor($t)==$t||"string"==typeof $t?this.index=parseInt($t):$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"bitmap",function(){return this._bitmap}),$T}($D),$y=function($H){function $t(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$t.__super.call(this)}$_($t,"laya.ui.ColorPicker",$H);var $I=$t.prototype;return $I.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._colorPanel&&this._colorPanel.destroy($t),this._colorButton&&this._colorButton.destroy($t),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$I.createChildren=function(){this.addChild(this._colorButton=new $l),this._colorPanel=new $g,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $C),this._colorPanel.addChild(this._colorBlock=new $C),this._colorPanel.addChild(this._colorInput=new $L)},$I.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$I.onPanelMouseDown=function($t){$t.stopPropagation()},$I.changePanel=function(){this._panelChanged=!1;var $t=this._colorPanel.graphics;$t.clear(),$t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($t=this._colorTiles.graphics).clear();for(var $H=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$I=0;$I<12;$I++)for(var $T=0;$T<20;$T++){var $K=0;$K=0===$T?$H[$I]:1===$T?0:51*(((3*$I+$T/6)%3<<0)+3*($I/6<<0))<<16|$T%6*51<<8|($I<<0)%6*51;var $_=$r.toColor($K);this._colors.push($_);var $V=$T*this._gridSize,$e=$I*this._gridSize;$t.drawRect($V,$e,this._gridSize,this._gridSize,$_,"#000000")}},$I.onColorButtonClick=function($t){this._colorPanel.parent?this.close():this.open()},$I.open=function(){var $t=this.localToGlobal(new $G),$H=$t.x+this._colorPanel.width<=$M.stage.width?$t.x:$M.stage.width-this._colorPanel.width,$I=$t.y+this._colorButton.height;$I=$I+this._colorPanel.height<=$M.stage.height?$I:$t.y-this._colorPanel.height,this._colorPanel.pos($H,$I),this._colorPanel.zOrder=1001,$M._currentStage.addChild(this._colorPanel),$M.stage.on("mousedown",this,this.removeColorBox)},$I.close=function(){$M.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$I.removeColorBox=function($t){this.close()},$I.onColorFieldKeyDown=function($t){13==$t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$t.stopPropagation())},$I.onColorInputChange=function($t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$I.onColorTilesClick=function($t){this.selectedColor=this.getColorByMouse(),this.close()},$I.onColorTilesMouseMove=function($t){this._colorInput.focus=!1;var $H=this.getColorByMouse();this._colorInput.text=$H,this.drawBlock($H)},$I.getColorByMouse=function(){var $t=this._colorTiles.getMousePoint(),$H=Math.floor($t.x/this._gridSize),$I=Math.floor($t.y/this._gridSize);return this._colors[20*$I+$H]},$I.drawBlock=function($t){var $H=this._colorBlock.graphics;$H.clear();var $I=$t||"#ffffff";$H.drawRect(0,0,50,20,$I,this._borderColor),$t||$H.drawLine(0,0,50,20,"#ff0000")},$I.changeColor=function(){var $t=this.graphics;$t.clear();var $H=this._selectedColor||"#000000";$t.drawRect(0,0,this._colorButton.width,this._colorButton.height,$H)},$I._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$V(0,$I,"inputBgColor",function(){return this._inputBgColor},function($t){this._inputBgColor=$t,this._setPanelChanged()}),$V(0,$I,"selectedColor",function(){return this._selectedColor},function($t){this._selectedColor!=$t&&(this._selectedColor=this._colorInput.text=$t,this.drawBlock($t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$A.EMPTY.setTo("change",this,this)))}),$V(0,$I,"skin",function(){return this._colorButton.skin},function($t){this._colorButton.skin=$t,this.changeColor()}),$V(0,$I,"bgColor",function(){return this._bgColor},function($t){this._bgColor=$t,this._setPanelChanged()}),$V(0,$I,"borderColor",function(){return this._borderColor},function($t){this._borderColor=$t,this._setPanelChanged()}),$V(0,$I,"inputColor",function(){return this._inputColor},function($t){this._inputColor=$t,this._setPanelChanged()}),$t}($D),$E=function($H){function $I($t,$H){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$I.__super.call(this),this._itemColors=$k.comboBoxItemColors,this.skin=$t,this.labels=$H}$_($I,"laya.ui.ComboBox",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._button&&this._button.destroy($t),this._list&&this._list.destroy($t),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$t.createChildren=function(){this.addChild(this._button=new $l),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$t._createList=function(){this._list=new $n,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$t._setListEvent=function($t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$b.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$t.onListDown=function($t){$t.stopPropagation()},$t.onScrollBarDown=function($t){$t.stopPropagation()},$t.onButtonMouseDown=function($t){this.callLater(this.switchTo,[!this._isOpen])},$t.changeList=function(){this._listChanged=!1;var $t=this.width-2,$H=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$t,height:this._itemHeight,fontSize:this._itemSize,color:$H}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$t.onlistItemMouse=function($t,$H){var $I=$t.type;if("mouseover"===$I||"mouseout"===$I){if(this._isCustomList)return;var $T=this._list.getCell($H);if(!$T)return;var $K=$T.getChildByName("label");$K&&("mouseover"===$I?($K.bgColor=this._itemColors[0],$K.color=this._itemColors[1]):($K.bgColor=null,$K.color=this._itemColors[2]))}else"click"===$I&&(this.selectedIndex=$H,this.isOpen=!1)},$t.switchTo=function($t){this.isOpen=$t},$t.changeOpen=function(){this.isOpen=!this._isOpen},$t.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $t=this._list.graphics;$t.clear(),$t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $H=this._list.array||[],$I=$H.length=0,$T=this._labels.length;$I<$T;$I++)$H.push({label:this._labels[$I]});this._list.height=this._listHeight,this._list.array=$H},$t.changeSelected=function(){this._button.label=this.selectedLabel},$t._onStageMouseWheel=function($t){this._list&&!this._list.contains($t.target)&&this.removeList(null)},$t.removeList=function($t){$M.stage.off("mousedown",this,this.removeList),$M.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$V(0,$t,"selectedIndex",function(){return this._selectedIndex},function($t){this._selectedIndex!=$t&&(this._selectedIndex=$t,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$A.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$V(0,$t,"measureHeight",function(){return this._button.height}),$V(0,$t,"skin",function(){return this._button.skin},function($t){this._button.skin!=$t&&(this._button.skin=$t,this._listChanged=!0)}),$V(0,$t,"measureWidth",function(){return this._button.width}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($D,this,"width",$t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$V(0,$t,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($t){this.selectedIndex=this._labels.indexOf($t)}),$V(0,$t,"labels",function(){return this._labels.join(",")},function($t){0<this._labels.length&&(this.selectedIndex=-1),$t?this._labels=$t.split(","):this._labels.length=0,this._itemChanged=!0}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($D,this,"height",$t),this._button.height=this._height}),$V(0,$t,"selectHandler",function(){return this._selectHandler},function($t){this._selectHandler=$t}),$V(0,$t,"visibleNum",function(){return this._visibleNum},function($t){this._visibleNum=$t,this._listChanged=!0}),$V(0,$t,"labelBold",function(){return this._button.text.bold},function($t){this._button.text.bold=$t}),$V(0,$t,"itemColors",function(){return String(this._itemColors)},function($t){this._itemColors=$r.fillArray(this._itemColors,$t,String),this._listChanged=!0}),$V(0,$t,"itemSize",function(){return this._itemSize},function($t){this._itemSize=$t,this._listChanged=!0}),$V(0,$t,"scrollBar",function(){return this.list.scrollBar}),$V(0,$t,"isOpen",function(){return this._isOpen},function($t){if(this._isOpen!=$t)if(this._isOpen=$t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $H=this.localToGlobal($G.TEMP.setTo(0,0)),$I=$H.y+this._button.height;$I=$I+this._listHeight<=$M.stage.height?$I:$H.y-this._listHeight,this._list.pos($H.x,$I),this._list.zOrder=1001,$M._currentStage.addChild(this._list),$M.stage.once("mousedown",this,this.removeList),$M.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$V(0,$t,"scrollBarSkin",function(){return this._scrollBarSkin},function($t){this._scrollBarSkin=$t}),$V(0,$t,"sizeGrid",function(){return this._button.sizeGrid},function($t){this._button.sizeGrid=$t}),$V(0,$t,"button",function(){return this._button}),$V(0,$t,"list",function(){return this._list||this._createList(),this._list},function($t){$t&&($t.removeSelf(),this._isCustomList=!0,this._list=$t,this._setListEvent($t),this._itemHeight=$t.getCell(0).height+$t.spaceY)}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)&&Math.floor($t)==$t||"string"==typeof $t?this.selectedIndex=parseInt($t):$t instanceof Array?this.labels=$t.join(","):$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"labelColors",function(){return this._button.labelColors},function($t){this._button.labelColors!=$t&&(this._button.labelColors=$t)}),$V(0,$t,"labelPadding",function(){return this._button.text.padding.join(",")},function($t){this._button.text.padding=$r.fillArray($k.labelPadding,$t,Number)}),$V(0,$t,"labelSize",function(){return this._button.text.fontSize},function($t){this._button.text.fontSize=$t}),$V(0,$t,"labelFont",function(){return this._button.text.font},function($t){this._button.text.font=$t}),$V(0,$t,"stateNum",function(){return this._button.stateNum},function($t){this._button.stateNum=$t}),$I}($D),$h=function($H){function $I($t){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$I.__super.call(this),this._showButtons=$x.showButtons,this._touchScrollEnable=$x.touchScrollEnable,this._mouseWheelEnable=$x.mouseWheelEnable,this.skin=$t,this.max=1}$_($I,"laya.ui.ScrollBar",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),this.stopScroll(),this.target=null,$H.prototype.destroy.call(this,$t),this.upButton&&this.upButton.destroy($t),this.downButton&&this.downButton.destroy($t),this.slider&&this.slider.destroy($t),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$t.createChildren=function(){this.addChild(this.slider=new $X),this.addChild(this.upButton=new $l),this.addChild(this.downButton=new $l)},$t.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$t.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$t.onButtonMouseDown=function($t){var $H=$t.currentTarget===this.upButton;this.slide($H),$M.timer.once($k.scrollBarDelayTime,this,this.startLoop,[$H]),$M.stage.once("mouseup",this,this.onStageMouseUp)},$t.startLoop=function($t){$M.timer.frameLoop(1,this,this.slide,[$t])},$t.slide=function($t){$t?this.value-=this._scrollSize:this.value+=this._scrollSize},$t.onStageMouseUp=function($t){$M.timer.clear(this,this.startLoop),$M.timer.clear(this,this.slide)},$t.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$t.changeSize=function(){$H.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$t.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$t.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$t.setScroll=function($t,$H,$I){this.runCallLater(this.changeSize),this.slider.setSlider($t,$H,$I),this.slider.bar.visible=0<$H,!this._hide&&this.autoHide&&(this.visible=!1)},$t.onTargetMouseWheel=function($t){this.value-=$t.delta*this._scrollSize,this.target=this._target},$t.onTargetMouseDown=function($t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $G),this._lastPoint.setTo($M.stage.mouseX,$M.stage.mouseY),$M.timer.clear(this,this.tweenMove),$W.clearTween(this),$M.stage.once("mouseup",this,this.onStageMouseUp2),$M.stage.once("mouseout",this,this.onStageMouseUp2),$M.timer.frameLoop(1,this,this.loop)},$t.loop=function(){var $t=$M.stage.mouseY,$H=$M.stage.mouseX;if(this._lastOffset=this.isVertical?$t-this._lastPoint.y:$H-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$M.stage._canvasTransform.getScaleY():$M.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$H,this._lastPoint.y=$t,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$t.onStageMouseUp2=function($t){if($M.stage.off("mouseup",this,this.onStageMouseUp2),$M.stage.off("mouseout",this,this.onStageMouseUp2),$M.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$W.to(this,{value:this.min},this.elasticBackTime,$R.sineOut,$b.create(this,this.elasticOver)):this._value>this.max&&$W.to(this,{value:this.max},this.elasticBackTime,$R.sineOut,$b.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$M.stage.mouseY-this._lastPoint.y:$M.stage.mouseX-this._lastPoint.x);for(var $H=0,$I=Math.min(this._offsets.length,3),$T=0;$T<$I;$T++)$H+=this._offsets[this._offsets.length-1-$T];if(this._lastOffset=$H/$I,($H=Math.abs(this._lastOffset))<2)return void this.event("end");60<$H&&(this._lastOffset=0<this._lastOffset?60:-60);var $K=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$M.timer.frameLoop(1,this,this.tweenMove,[$K])}},$t.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$W.to(this,{alpha:0},500),this.event("end")},$t.tweenMove=function($t){this._lastOffset*=this.rollRatio;var $H=NaN;if(0<$t&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$H=.5*-(this.min-$t-this.value),this._lastOffset>$H&&(this._lastOffset=$H)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$H=.5*-(this.max+$t-this.value),this._lastOffset<$H&&(this._lastOffset=$H))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($M.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$W.to(this,{value:this.min},this.elasticBackTime,$R.sineOut,$b.create(this,this.elasticOver)):this._value>this.max?$W.to(this,{value:this.max},this.elasticBackTime,$R.sineOut,$b.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$W.to(this,{alpha:0},500)}},$t.stopScroll=function(){this.onStageMouseUp2(null),$M.timer.clear(this,this.tweenMove),$W.clearTween(this)},$V(0,$t,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$V(0,$t,"skin",function(){return this._skin},function($t){this._skin!=$t&&(this._skin=$t,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$V(0,$t,"max",function(){return this.slider.max},function($t){this.slider.max=$t}),$V(0,$t,"showButtons",function(){return this._showButtons},function($t){this._showButtons=$t,this.callLater(this.changeScrollBar)}),$V(0,$t,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$V(0,$t,"min",function(){return this.slider.min},function($t){this.slider.min=$t}),$V(0,$t,"value",function(){return this._value},function($t){$t!==this._value&&(this._value=$t,this._isElastic||(this.slider._value!=$t&&(this.slider._value=$t,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$V(0,$t,"isVertical",function(){return this.slider.isVertical},function($t){this.slider.isVertical=$t}),$V(0,$t,"sizeGrid",function(){return this.slider.sizeGrid},function($t){this.slider.sizeGrid=$t}),$V(0,$t,"scrollSize",function(){return this._scrollSize},function($t){this._scrollSize=$t}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)||"string"==typeof $t?this.value=Number($t):$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"thumbPercent",function(){return this._thumbPercent},function($t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$t=1<=$t?.99:$t,this._thumbPercent=$t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$t,$k.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$t,$k.scrollBarMinNum))}),$V(0,$t,"target",function(){return this._target},function($t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$t)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$V(0,$t,"hide",function(){return this._hide},function($t){this._hide=$t,this.visible=!$t}),$V(0,$t,"touchScrollEnable",function(){return this._touchScrollEnable},function($t){this._touchScrollEnable=$t,this.target=this._target}),$V(0,$t,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($t){this._mouseWheelEnable=$t,this.target=this._target}),$V(0,$t,"tick",function(){return this.slider.tick},function($t){this.slider.tick=$t}),$I}($D),$X=function($H){function $I($t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$I.__super.call(this),this.skin=$t}$_($I,"laya.ui.Slider",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._bg&&this._bg.destroy($t),this._bar&&this._bar.destroy($t),this._progress&&this._progress.destroy($t),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$t.createChildren=function(){this.addChild(this._bg=new $B),this.addChild(this._bar=new $l)},$t.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$t.onBarMouseDown=function($t){this._globalSacle||(this._globalSacle=new $G),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$M.stage.mouseX,this._ty=$M.stage.mouseY,$M.stage.on("mousemove",this,this.mouseMove),$M.stage.once("mouseup",this,this.mouseUp),$M.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$t.showValueText=function(){if(this.showLabel){var $t=laya.ui.Slider.label;this.addChild($t),$t.textField.changeText(this._value+""),this.isVertical?($t.x=this._bar.x+20,$t.y=.5*(this._bar.height-$t.height)+this._bar.y):($t.y=this._bar.y-20,$t.x=.5*(this._bar.width-$t.width)+this._bar.x)}},$t.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$t.mouseUp=function($t){$M.stage.off("mousemove",this,this.mouseMove),$M.stage.off("mouseup",this,this.mouseUp),$M.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$t.mouseMove=function($t){var $H=this._value;this.isVertical?(this._bar.y+=($M.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($M.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$M.stage.mouseX,this._ty=$M.stage.mouseY;var $I=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$I)/$I,this._value!=$H&&this.sendChangeEvent(),this.showValueText()},$t.sendChangeEvent=function($t){void 0===$t&&($t="change"),this.event($t),this.changeHandler&&this.changeHandler.runWith(this._value)},$t.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$t.changeSize=function(){$H.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$t.setSlider=function($t,$H,$I){this._value=-1,this._min=$t,this._max=$t<$H?$H:$t,this.value=$I<$t?$t:$H<$I?$H:$I},$t.changeValue=function(){var $t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$t)/$t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $H=this._max-this._min;0===$H&&($H=1),this.isVertical?(this._bar.y=(this._value-this._min)/$H*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$H*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$t.onBgMouseDown=function($t){var $H=this._bg.getMousePoint();this.isVertical?this.value=$H.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$H.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$V(0,$t,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$V(0,$t,"skin",function(){return this._skin},function($t){if(this._skin!=$t){this._skin=$t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $H=this._skin.replace(".png","$progress.png");$S.getRes($H)&&(this._progress||(this.addChild(this._progress=new $B),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$H),this.setBarPoint(),this.callLater(this.changeValue)}}),$V(0,$t,"allowClickBack",function(){return this._allowClickBack},function($t){this._allowClickBack!=$t&&((this._allowClickBack=$t)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$V(0,$t,"max",function(){return this._max},function($t){this._max!=$t&&(this._max=$t,this.callLater(this.changeValue))}),$V(0,$t,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$V(0,$t,"tick",function(){return this._tick},function($t){this._tick!=$t&&(this._tick=$t,this.callLater(this.changeValue))}),$V(0,$t,"sizeGrid",function(){return this._bg.sizeGrid},function($t){this._bg.sizeGrid=$t,this._bar.sizeGrid=$t,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$V(0,$t,"min",function(){return this._min},function($t){this._min!=$t&&(this._min=$t,this.callLater(this.changeValue))}),$V(0,$t,"value",function(){return this._value},function($t){if(this._value!=$t){var $H=this._value;this._value=$t,this.changeValue(),this._value!=$H&&this.sendChangeEvent()}}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)||"string"==typeof $t?this.value=Number($t):$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"bar",function(){return this._bar}),$T($I,["label",function(){return this.label=new $a}]),$I}($D),$B=function($H){function $I($t){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$I.__super.call(this),this.skin=$t}$_($I,"laya.ui.Image",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$S.clearCache(this,this._skin)},$t.dispose=function(){this.destroy(!0),$S.clearCache(this,this._skin),this.clearEvent()},$t.createChildren=function(){this.graphics=this._bitmap=new $Y},$t.setSource=function($t,$H){this.destroyed||$t===this._skin&&$H&&(this.source=$H,this.onCompResize(),this.clearEvent())},$t.clearEvent=function(){this._skin&&$K.atalsNotify&&$K.atalsNotify.off(this._skin,this,this.setSource)},$t.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$M.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$V(0,$t,"source",function(){return this._bitmap.source},function($t){this._bitmap&&(this._bitmap.source=$t,this.event("loaded"),this.repaint())}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"string"==typeof(this._dataSource=$t)?this.skin=$t:$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"measureHeight",function(){return this._bitmap.height}),$V(0,$t,"skin",function(){return this._skin},function($t){if(this._skin!=$t)if($S.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$t){$S.keepCache(this,this._skin);var $H=$S.getRes($t),$I=$K.resAtalsObj&&$K.resAtalsObj[this._skin];$H?(this.source=$H,this.onCompResize()):$I?($K.atalsNotify&&$K.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$I.sourceW),0==this.height&&(this.height=$I.sourceH)):(this._complete=$b.create(this,this.setSource,[this._skin]),this._progress=null,$M.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$V(0,$t,"group",function(){return this._group},function($t){$t&&this._skin&&$S.setGroup(this._skin,$t),this._group=$t}),$V(0,$t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($t){this._bitmap.sizeGrid=$r.fillArray($k.defaultSizeGrid,$t,Number)}),$V(0,$t,"measureWidth",function(){return this._bitmap.width}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($D,this,"width",$t),this._bitmap.width=0==$t?1e-7:$t}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($D,this,"height",$t),this._bitmap.height=0==$t?1e-7:$t}),$I}($D),$a=function($H){function $I($t){this._tf=null,$I.__super.call(this),void 0===$t&&($t=""),$q.defaultColor=$k.labelColor,this.text=$t}$_($I,"laya.ui.Label",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._tf=null},$t.createChildren=function(){this.addChild(this._tf=new $N)},$t.changeText=function($t){this._tf.changeText($t)},$V(0,$t,"padding",function(){return this._tf.padding.join(",")},function($t){this._tf.padding=$r.fillArray($k.labelPadding,$t,Number)}),$V(0,$t,"bold",function(){return this._tf.bold},function($t){this._tf.bold=$t}),$V(0,$t,"align",function(){return this._tf.align},function($t){this._tf.align=$t}),$V(0,$t,"text",function(){return this._tf.text},function($t){this._tf.text!=$t&&($t&&($t=$r.adptString($t+"")),this._tf.text=$t,this.event("change"),this._width&&this._height||this.onCompResize())}),$V(0,$t,"italic",function(){return this._tf.italic},function($t){this._tf.italic=$t}),$V(0,$t,"wordWrap",function(){return this._tf.wordWrap},function($t){this._tf.wordWrap=$t}),$V(0,$t,"font",function(){return this._tf.font},function($t){this._tf.font=$t}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)||"string"==typeof $t?this.text=$t+"":$M.superSet($D,this,"dataSource",$t)}),$V(0,$t,"color",function(){return this._tf.color},function($t){this._tf.color=$t}),$V(0,$t,"valign",function(){return this._tf.valign},function($t){this._tf.valign=$t}),$V(0,$t,"leading",function(){return this._tf.leading},function($t){this._tf.leading=$t}),$V(0,$t,"fontSize",function(){return this._tf.fontSize},function($t){this._tf.fontSize=$t}),$V(0,$t,"bgColor",function(){return this._tf.bgColor},function($t){this._tf.bgColor=$t}),$V(0,$t,"borderColor",function(){return this._tf.borderColor},function($t){this._tf.borderColor=$t}),$V(0,$t,"stroke",function(){return this._tf.stroke},function($t){this._tf.stroke=$t}),$V(0,$t,"strokeColor",function(){return this._tf.strokeColor},function($t){this._tf.strokeColor=$t}),$V(0,$t,"textField",function(){return this._tf}),$V(0,$t,"measureWidth",function(){return this._tf.width}),$V(0,$t,"measureHeight",function(){return this._tf.height}),$V(0,$t,"width",function(){return this._width||this._tf.text?$M.superGet($D,this,"width"):0},function($t){$M.superSet($D,this,"width",$t),this._tf.width=$t}),$V(0,$t,"height",function(){return this._height||this._tf.text?$M.superGet($D,this,"height"):0},function($t){$M.superSet($D,this,"height",$t),this._tf.height=$t}),$V(0,$t,"overflow",function(){return this._tf.overflow},function($t){this._tf.overflow=$t}),$V(0,$t,"underline",function(){return this._tf.underline},function($t){this._tf.underline=$t}),$V(0,$t,"underlineColor",function(){return this._tf.underlineColor},function($t){this._tf.underlineColor=$t}),$I}($D),$u=function($H){function $I($t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$I.__super.call(this),this.skin=$t}$_($I,"laya.ui.ProgressBar",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._bg&&this._bg.destroy($t),this._bar&&this._bar.destroy($t),this._bg=this._bar=null,this.changeHandler=null},$t.createChildren=function(){this.addChild(this._bg=new $B),this.addChild(this._bar=new $B)},$t.changeValue=function(){if(this.sizeGrid){var $t=this.sizeGrid.split(","),$H=Number($t[3]),$I=Number($t[1]),$T=(this.width-$H-$I)*this._value;this._bar.width=$H+$I+$T,this._bar.visible=this._bar.width>$H+$I}else this._bar.width=this.width*this._value},$V(0,$t,"measureHeight",function(){return this._bg.height}),$V(0,$t,"skin",function(){return this._skin},function($t){this._skin!=$t&&(this._skin=$t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$V(0,$t,"measureWidth",function(){return this._bg.width}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($D,this,"height",$t),this._bg.height=this._height,this._bar.height=this._height}),$V(0,$t,"bar",function(){return this._bar}),$V(0,$t,"value",function(){return this._value},function($t){this._value!=$t&&($t=1<$t?1:$t<0?0:$t,this._value=$t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($t))}),$V(0,$t,"bg",function(){return this._bg}),$V(0,$t,"sizeGrid",function(){return this._bg.sizeGrid},function($t){this._bg.sizeGrid=this._bar.sizeGrid=$t}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($D,this,"width",$t),this._bg.width=this._width,this.callLater(this.changeValue)}),$V(0,$t,"dataSource",$H.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)||"string"==typeof $t?this.value=Number($t):$M.superSet($D,this,"dataSource",$t)}),$I}($D),$$=(function($t){function $I(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$I.__super.call(this),this._tipBox=new $D,this._tipBox.addChild(this._tipText=new $N),this._tipText.x=this._tipText.y=5,this._tipText.color=$I.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$M.stage.on("showtip",this,this._onStageShowTip),$M.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$_($I,"laya.ui.TipManager",$D);var $H=$I.prototype;$H._onStageHideTip=function($t){$M.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$H._onStageShowTip=function($t){$M.timer.once($I.tipDelay,this,this._showTip,[$t],!0)},$H._showTip=function($t){if("string"==typeof $t){var $H=String($t);Boolean($H)&&this._defaultTipHandler($H)}else $t instanceof laya.utils.Handler?$t.run():"function"==typeof $t&&$t.apply();$M.stage.on("mousemove",this,this._onStageMouseMove),$M.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$H._onStageMouseDown=function($t){this.closeAll()},$H._onStageMouseMove=function($t){this._showToStage(this,$I.offsetX,$I.offsetY)},$H._showToStage=function($t,$H,$I){void 0===$H&&($H=0),void 0===$I&&($I=0);var $T=$t.getBounds();$t.x=$M.stage.mouseX+$H,$t.y=$M.stage.mouseY+$I,$t.x+$T.width>$M.stage.width&&($t.x-=$T.width+$H),$t.y+$T.height>$M.stage.height&&($t.y-=$T.height+$I)},$H.closeAll=function(){$M.timer.clear(this,this._showTip),$M.stage.off("mousemove",this,this._onStageMouseMove),$M.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$H.showDislayTip=function($t){this.addChild($t),this._showToStage(this),$M._currentStage.addChild(this)},$H._showDefaultTip=function($t){this._tipText.text=$t;var $H=this._tipBox.graphics;$H.clear(),$H.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$I.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$M._currentStage.addChild(this)},$V(0,$H,"defaultTipHandler",function(){return this._defaultTipHandler},function($t){this._defaultTipHandler=$t}),$I.offsetX=10,$I.offsetY=15,$I.tipTextColor="#ffffff",$I.tipBackColor="#111111",$I.tipDelay=200}(),function($t){var $L;function $G(){this._idMap=null,this._aniList=null,this._watchMap={},$G.__super.call(this)}$_($G,"laya.ui.View",$g);var $H=$G.prototype;return $H.createView=function($t){if($t.animations&&!this._idMap&&(this._idMap={}),$G.createComp($t,this,this),$t.animations){var $H,$I,$T=[],$K=$t.animations,$_=0,$V=$K.length;for($_=0;$_<$V;$_++){switch($H=new $f,$I=$K[$_],$H._setUp(this._idMap,$I),(this[$I.name]=$H)._setControlNode(this),$I.action){case 1:$H.play(0,!1);break;case 2:$H.play(0,!0)}$T.push($H)}this._aniList=$T}0<this._width&&null==$t.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$H.onEvent=function($t,$H){},$H.loadUI=function($t){var $H=$G.uiMap[$t];$H&&this.createView($H)},$H.destroy=function($t){void 0===$t&&($t=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$t)},$H.changeData=function($t){var $H=this._watchMap[$t];if($H){console.log("change",$t);for(var $I=0,$T=$H.length;$I<$T;$I++){$H[$I].exe(this)}}},$G._regs=function(){for(var $t in $G.uiClassMap)$O.regClass($t,$G.uiClassMap[$t])},$G.createComp=function($t,$H,$I,$T){if(!($H=$H||$G.getCompInstance($t)))return console.warn("can not create:"+$t.type),null;var $K=$t.child;if($K)for(var $_=$H instanceof laya.ui.List,$V=0,$e=$K.length;$V<$e;$V++){var $R=$K[$V];if(!$H.hasOwnProperty("itemRender")||"render"!=$R.props.name&&"render"!==$R.props.renderType)if("Graphic"==$R.type)$O.addGraphicsToSprite($R,$H);else if($O.isDrawType($R.type))$O.addGraphicToSprite($R,$H,!0);else{if($_){var $A=[],$q=$G.createComp($R,null,$I,$A);$A.length&&($q._$bindData=$A)}else $q=$G.createComp($R,null,$I,$T);"Script"==$R.type?"owner"in $q?$q.owner=$H:"target"in $q&&($q.target=$H):"mask"==$R.props.renderType||"mask"==$R.props.name?$H.mask=$q:$q instanceof laya.display.Sprite&&$H.addChild($q)}else $H.itemRender=$R}var $f=$t.props;for(var $b in $f){var $L=$f[$b];$G.eventDic[$b]?$L&&$I&&$H.on($b,$I,$I.onEvent,[$L]):$G.setCompValue($H,$b,$L,$I,$T)}return $M.__typeof($H,"laya.ui.IItem")&&$H.initItems(),$t.compId&&$I&&$I._idMap&&($I._idMap[$t.compId]=$H),$H},$G.setCompValue=function($t,$H,$I,$T,$K){if("string"==typeof $I&&-1<$I.indexOf("${")){if($G._sheet||($G._sheet=$O.getClass("laya.data.Table")),!$G._sheet)return void console.warn("Can not find class Sheet");if($K)$K.push($t,$H,$I);else if($T){-1==$I.indexOf("].")&&($I=$I.replace(".","[0]."));var $_,$V,$e=new $L($t,$H,$I);$e.exe($T);for(var $R=$I.replace(/\[.*?\]\./g,".");null!=($_=$G._parseWatchData.exec($R));){for(var $A=$_[1];null!=($V=$G._parseKeyWord.exec($A));){var $q=$V[0],$f=$T._watchMap[$q]||($T._watchMap[$q]=[]);$f.push($e),$G._sheet.I.notifer.on($q,$T,$T.changeData,[$q])}($f=$T._watchMap[$A]||($T._watchMap[$A]=[])).push($e),$G._sheet.I.notifer.on($A,$T,$T.changeData,[$A])}}}else if("var"===$H&&$T)$T[$I]=$t;else if("onClick"==$H){var $b=$M._runScript("(function(){"+$I+"})");$t.on("click",$T,$b)}else $t[$H]="true"===$I||"false"!==$I&&$I},$G.getCompInstance=function($t){var $H,$I=$t.props?$t.props.runtime:null;return $H=$I?$G.viewClassMap[$I]||$G.uiClassMap[$I]||$M.__classmap[$I]:$G.uiClassMap[$t.type],$t.props&&$t.props.hasOwnProperty("renderType")&&"instance"==$t.props.renderType?$H.instance:$H?new $H:null},$G.regComponent=function($t,$H){$G.uiClassMap[$t]=$H,$O.regClass($t,$H)},$G.regViewRuntime=function($t,$H){$G.viewClassMap[$t]=$H},$G.uiMap={},$G.viewClassMap={},$G._sheet=null,$T($G,["uiClassMap",function(){return this.uiClassMap={ViewStack:$tt,LinkButton:$l,TextArea:$At,ColorPicker:$y,Box:$g,Button:$l,CheckBox:$Q,Clip:$v,ComboBox:$E,Component:$D,HScrollBar:$F,HSlider:$i,Image:$B,Label:$a,List:$n,Panel:$c,ProgressBar:$u,Radio:$d,RadioGroup:$et,ScrollBar:$h,Slider:$X,Tab:$Rt,TextInput:$It,View:$G,VScrollBar:$Ht,VSlider:$Tt,Tree:$Z,HBox:$_t,VBox:$Vt,Sprite:$C,Animation:$I,Text:$N,FontClip:$o}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$G.__init$=function(){$G._regs(),$L=function(){function $t($t,$H,$I){this.comp=null,this.prop=null,this.value=null,this.comp=$t,this.prop=$H,this.value=$I}return $_($t,""),$t.prototype.exe=function($t){var $H=$r.getBindFun(this.value);this.comp[this.prop]=$H.call(this,$t)},$t}()},$G}()),$Q=function($t){function $I($t,$H){void 0===$H&&($H=""),$I.__super.call(this,$t,$H)}$_($I,"laya.ui.CheckBox",$t);var $H=$I.prototype;return $H.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$H.initialize=function(){$t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$V(0,$H,"dataSource",$t.prototype._$get_dataSource,function($t){"boolean"==typeof(this._dataSource=$t)?this.selected=$t:"string"==typeof $t?this.selected="true"===$t:$M.superSet($l,this,"dataSource",$t)}),$I}($l),$m=function($t){function $H(){this._space=0,this._align="none",this._itemChanged=!1,$H.__super.call(this)}$_($H,"laya.ui.LayoutBox",$g);var $I=$H.prototype;return $I.addChild=function($t){return $t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$t)},$I.onResize=function($t){this._setItemChanged()},$I.addChildAt=function($t,$H){return $t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$t,$H)},$I.removeChild=function($t){return $t.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$t)},$I.removeChildAt=function($t){return this.getChildAt($t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$t)},$I.refresh=function(){this._setItemChanged()},$I.changeItems=function(){this._itemChanged=!1},$I.sortItem=function($t){$t&&$t.sort(function($t,$H){return $t.y-$H.y})},$I._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$V(0,$I,"space",function(){return this._space},function($t){this._space=$t,this._setItemChanged()}),$V(0,$I,"align",function(){return this._align},function($t){this._align=$t,this._setItemChanged()}),$H}(),$o=function($H){function $I($t,$H){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$I.__super.call(this),$t&&(this.skin=$t),$H&&(this.sheet=$H)}$_($I,"laya.ui.FontClip",$H);var $t=$I.prototype;return $t.createChildren=function(){this._bitmap=new $Y,this.on("loaded",this,this._onClipLoaded)},$t._onClipLoaded=function(){this.callLater(this.changeValue)},$t.changeValue=function(){var $t;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$t=this._sources[0]))){var $H="horizontal"===this._direction;$H?(this._wordsW=this._valueArr.length*($t.sourceWidth+this.spaceX),this._wordsH=$t.sourceHeight):(this._wordsW=$t.sourceWidth,this._wordsH=($t.sourceHeight+this.spaceY)*this._valueArr.length);var $I=0;if(this._width)switch(this._align){case"center":$I=.5*(this._width-this._wordsW);break;case"right":$I=this._width-this._wordsW;break;default:$I=0}for(var $T=0,$K=this._valueArr.length;$T<$K;$T++){var $_=this._indexMap[this._valueArr.charAt($T)];this.sources[$_]&&($t=this.sources[$_],$H?this.graphics.drawTexture($t,$I+$T*($t.sourceWidth+this.spaceX),0,$t.sourceWidth,$t.sourceHeight):this.graphics.drawTexture($t,0+$I,$T*($t.sourceHeight+this.spaceY),$t.sourceWidth,$t.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$t.destroy=function($t){void 0===$t&&($t=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$H.prototype.destroy.call(this,$t)},$V(0,$t,"sheet",function(){return this._sheet},function($t){$t+="";var $H=(this._sheet=$t).split(" ");this._clipX=String($H[0]).length,this.clipY=$H.length,this._indexMap={};for(var $I=0;$I<this._clipY;$I++)for(var $T=$H[$I].split(""),$K=0,$_=$T.length;$K<$_;$K++)this._indexMap[$T[$K]]=$I*this._clipX+$K}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($v,this,"height",$t),this.callLater(this.changeValue)}),$V(0,$t,"direction",function(){return this._direction},function($t){this._direction=$t,this.callLater(this.changeValue)}),$V(0,$t,"value",function(){return this._valueArr?this._valueArr:""},function($t){$t+="",this._valueArr=$t,this.callLater(this.changeValue)}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($v,this,"width",$t),this.callLater(this.changeValue)}),$V(0,$t,"spaceX",function(){return this._spaceX},function($t){this._spaceX=$t,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$V(0,$t,"spaceY",function(){return this._spaceY},function($t){this._spaceY=$t,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$V(0,$t,"align",function(){return this._align},function($t){this._align=$t,this.callLater(this.changeValue)}),$V(0,$t,"measureWidth",function(){return this._wordsW}),$V(0,$t,"measureHeight",function(){return this._wordsH}),$I}($v),$n=function($t){function $H(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $G,$H.__super.call(this)}$_($H,"laya.ui.List",$t);var $I=$H.prototype;return $M.imps($I,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$I.destroy=function($t){void 0===$t&&($t=!0),this._content&&this._content.destroy($t),this._scrollBar&&this._scrollBar.destroy($t),laya.ui.Component.prototype.destroy.call(this,$t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$I.createChildren=function(){this.addChild(this._content=new $g)},$I.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$M.superGet($g,this,"cacheAs")),$M.superSet($g,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$I.onScrollEnd=function(){$M.superSet($g,this,"cacheAs",this._$P.cacheAs)},$I._removePreScrollBar=function(){var $t=this.removeChildByName("scrollBar");$t&&$t.destroy(!0)},$I.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $t=this._getOneCell(),$H=$t.width+this._spaceX||1,$I=$t.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$H):Math.ceil(this._width/$H)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$I):Math.round(this._height/$I));var $T=this._width?this._width:$H*this.repeatX-this._spaceX,$K=this._height?this._height:$I*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$I:$H,this._cellOffset=this._isVertical?$I*Math.max(this._repeatY2,this._repeatY)-$K-this._spaceY:$H*Math.max(this._repeatX2,this._repeatX)-$T-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$K:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$T),this.setContentSize($T,$K);var $_=this._isVertical?this.repeatX:this.repeatY,$V=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$_,$V),this._createdLine=$V,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$I._getOneCell=function(){if(0===this._cells.length){var $t=this.createItem();if(this._offset.setTo($t.x,$t.y),this.cacheContent)return $t;this._cells.push($t)}return this._cells[0]},$I._createItems=function($t,$H,$I){var $T=this._content,$K=this._getOneCell(),$_=$K.width+this._spaceX,$V=$K.height+this._spaceY;if(this.cacheContent){var $e=new $g;$e.cacheAsBitmap=!0,$e.pos((this._isVertical?0:$t)*$_,(this._isVertical?$t:0)*$V),this._content.addChild($e),this._content.optimizeScrollRect=!0,$T=$e}else{for(var $R=[],$A=this._cells.length-1;-1<$A;$A--){var $q=this._cells[$A];$q.removeSelf(),$R.push($q)}this._cells.length=0}for(var $f=$t;$f<$I;$f++)for(var $b=0;$b<$H;$b++)($K=$R&&$R.length?$R.pop():this.createItem()).x=(this._isVertical?$b:$f)*$_-$T.x,$K.y=(this._isVertical?$f:$b)*$V-$T.y,$K.name="item"+($f*$H+$b),$T.addChild($K),this.addCell($K)},$I.createItem=function(){var $t=[];if("function"==typeof this._itemRender)var $H=new this._itemRender;else $H=$$.createComp(this._itemRender,null,null,$t);if(0==$t.length&&$H._watchMap){var $I=$H._watchMap;for(var $T in $I)for(var $K=$I[$T],$_=0;$_<$K.length;$_++){var $V=$K[$_];$t.push($V.comp,$V.prop,$V.value)}}return $t.length&&($H._$bindData=$t),$H},$I.addCell=function($t){$t.on("click",this,this.onCellMouse),$t.on("rightclick",this,this.onCellMouse),$t.on("mouseover",this,this.onCellMouse),$t.on("mouseout",this,this.onCellMouse),$t.on("mousedown",this,this.onCellMouse),$t.on("mouseup",this,this.onCellMouse),this._cells.push($t)},$I.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $t=0,$H=$t=0;$H<1e4;$H++){var $I=this.getChildByName("item"+$H);if(!$I)break;this.addCell($I),$t++}this.repeatY=$t}},$I.setContentSize=function($t,$H){this._content.width=$t,this._content.height=$H,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $J),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$t,$H),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$I.onCellMouse=function($t){"mousedown"===$t.type&&(this._isMoved=!1);var $H=$t.currentTarget,$I=this._startIndex+this._cells.indexOf($H);$I<0||("click"===$t.type||"rightclick"===$t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$I:this.changeCellState($H,!0,0):"mouseover"!==$t.type&&"mouseout"!==$t.type||this._selectedIndex===$I||this.changeCellState($H,"mouseover"===$t.type,0),this.mouseHandler&&this.mouseHandler.runWith([$t,$I]))},$I.changeCellState=function($t,$H,$I){var $T=$t.getChildByName("selectBox");$T&&(this.selectEnable=!0,$T.visible=$H,$T.index=$I)},$I.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$I.onScrollBarChange=function($t){this.runCallLater(this.changeCells);var $H=this._scrollBar.value,$I=this._isVertical?this.repeatX:this.repeatY,$T=this._isVertical?this.repeatY:this.repeatX,$K=Math.floor($H/this._cellSize);if(this.cacheContent)$V=$T+1,this._createdLine-$K<$V&&(this._createItems(this._createdLine,$I,this._createdLine+$V),this.renderItems(this._createdLine*$I,0),this._createdLine+=$V);else{var $_=$K*$I,$V=0;if($_>this._startIndex){$V=$_-this._startIndex;var $e=!0,$R=this._startIndex+$I*($T+1);this._isMoved=!0}else $_<this._startIndex&&($V=this._startIndex-$_,$e=!1,$R=this._startIndex-1,this._isMoved=!0);for(var $A=0;$A<$V;$A++){if($e){var $q=this._cells.shift();this._cells[this._cells.length]=$q;var $f=$R+$A}else $q=this._cells.pop(),this._cells.unshift($q),$f=$R-$A;var $b=Math.floor($f/$I)*this._cellSize;this._isVertical?$q.y=$b:$q.x=$b,this.renderItem($q,$f)}this._startIndex=$_,this.changeSelectStatus()}var $L=this._content.scrollRect;this._isVertical?($L.y=$H-this._offset.y,$L.x=-this._offset.x):($L.y=-this._offset.y,$L.x=$H-this._offset.x),this._content.scrollRect=$L},$I.posCell=function($t,$H){if(this._scrollBar){var $I=this._isVertical?this.repeatX:this.repeatY,$T=(this._isVertical?this.repeatY:this.repeatX,Math.floor($H/$I)*this._cellSize);this._isVertical?$t.y=$T:$t.x=$T}},$I.changeSelectStatus=function(){for(var $t=0,$H=this._cells.length;$t<$H;$t++)this.changeCellState(this._cells[$t],this._selectedIndex===this._startIndex+$t,1)},$I.renderItems=function($t,$H){void 0===$t&&($t=0),void 0===$H&&($H=0);for(var $I=$t,$T=$H||this._cells.length;$I<$T;$I++)this.renderItem(this._cells[$I],this._startIndex+$I);this.changeSelectStatus(),this._twDone=!0},$I.renderItem=function($t,$H){this._array&&0<=$H&&$H<this._array.length?($t.visible=!0,$t._$bindData?($t._dataSource=this._array[$H],this._bindData($t,this._array[$H])):$t.dataSource=this._array[$H],this.cacheContent||this.posCell($t,$H),this.hasListener("render")&&this.event("render",[$t,$H]),this.renderHandler&&this.renderHandler.runWith([$t,$H]),this.renderTwHandler&&this.renderTwHandler.runWith([$t,$H])):($t.visible=!1,$t.dataSource=null)},$I._bindData=function($t,$H){for(var $I=$t._$bindData,$T=0,$K=$I.length;$T<$K;$T++){var $_=$I[$T++],$V=$I[$T++],$e=$I[$T],$R=$r.getBindFun($e);$_[$V]=$R.call(this,$H)}},$I.refresh=function(){this.array=this._array},$I.getItem=function($t){return-1<$t&&$t<this._array.length?this._array[$t]:null},$I.changeItem=function($t,$H){-1<$t&&$t<this._array.length&&(this._array[$t]=$H,$t>=this._startIndex&&$t<this._startIndex+this._cells.length&&this.renderItem(this.getCell($t),$t))},$I.setItem=function($t,$H){this.changeItem($t,$H)},$I.addItem=function($t){this._array.push($t),this.array=this._array},$I.addItemAt=function($t,$H){this._array.splice($H,0,$t),this.array=this._array},$I.deleteItem=function($t){this._array.splice($t,1),this.array=this._array},$I.getCell=function($t){return this.runCallLater(this.changeCells),-1<$t&&this._cells?this._cells[($t-this._startIndex)%this._cells.length]:null},$I.scrollTo=function($t){if(this._scrollBar){var $H=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($t/$H)*this._cellSize}else this.startIndex=$t},$I.tweenTo=function($t,$H,$I){if(void 0===$H&&($H=200),this._scrollBar){var $T=this._isVertical?this.repeatX:this.repeatY;$W.to(this._scrollBar,{value:Math.floor($t/$T)*this._cellSize},$H,null,$I,0,!0)}else this.startIndex=$t,$I&&$I.run()},$I._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$I.commitMeasure=function(){this.runCallLater(this.changeCells)},$V(0,$I,"cacheAs",$t.prototype._$get_cacheAs,function($t){$M.superSet($g,this,"cacheAs",$t),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$t?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$V(0,$I,"content",function(){return this._content}),$V(0,$I,"height",$t.prototype._$get_height,function($t){$t!=this._height&&($M.superSet($g,this,"height",$t),this._setCellChanged())}),$V(0,$I,"itemRender",function(){return this._itemRender},function($t){if(this._itemRender!=$t){this._itemRender=$t;for(var $H=this._cells.length-1;-1<$H;$H--)this._cells[$H].destroy();this._cells.length=0,this._setCellChanged()}}),$V(0,$I,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($t){this._removePreScrollBar();var $H=new $Ht;$H.name="scrollBar",$H.right=0,$t&&" "!=$t&&($H.skin=$t),this.scrollBar=$H,this.addChild($H),this._setCellChanged()}),$V(0,$I,"page",function(){return this._page},function($t){this._page=$t,this._array&&(this._page=0<$t?$t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$V(0,$I,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($t){this._removePreScrollBar();var $H=new $F;$H.name="scrollBar",$H.bottom=0,$t&&" "!=$t&&($H.skin=$t),this.scrollBar=$H,this.addChild($H),this._setCellChanged()}),$V(0,$I,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($t){this._repeatX=$t,this._setCellChanged()}),$V(0,$I,"scrollBar",function(){return this._scrollBar},function($t){this._scrollBar!=$t&&(this._scrollBar=$t)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$V(0,$I,"width",$t.prototype._$get_width,function($t){$t!=this._width&&($M.superSet($g,this,"width",$t),this._setCellChanged())}),$V(0,$I,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($t){this._repeatY=$t,this._setCellChanged()}),$V(0,$I,"spaceX",function(){return this._spaceX},function($t){this._spaceX=$t,this._setCellChanged()}),$V(0,$I,"spaceY",function(){return this._spaceY},function($t){this._spaceY=$t,this._setCellChanged()}),$V(0,$I,"selectedIndex",function(){return this._selectedIndex},function($t){this._selectedIndex!=$t&&(this._selectedIndex=$t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($t),this.startIndex=this._startIndex)}),$V(0,$I,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($t){this.selectedIndex=this._array.indexOf($t)}),$V(0,$I,"length",function(){return this._array?this._array.length:0}),$V(0,$I,"selection",function(){return this.getCell(this._selectedIndex)},function($t){this.selectedIndex=this._startIndex+this._cells.indexOf($t)}),$V(0,$I,"startIndex",function(){return this._startIndex},function($t){this._startIndex=0<$t?$t:0,this.callLater(this.renderItems)}),$V(0,$I,"twSwitch",function(){return this._twSwitch},function($t){this._twSwitch=$t}),$V(0,$I,"twDone",function(){return this._twDone},function($t){this._twDone=$t}),$V(0,$I,"array",function(){return this._array},function($t){this.runCallLater(this.changeCells),this._array=$t||[];var $H=this._array.length;if(this.totalPage=Math.ceil($H/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$H?this._selectedIndex:$H-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $I=this._isVertical?this.repeatX:this.repeatY,$T=this._isVertical?this.repeatY:this.repeatX,$K=Math.ceil($H/$I);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$T/$K,this._scrollBar.setScroll(0,($K-$T)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$V(0,$I,"dataSource",$t.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)&&Math.floor($t)==$t||"string"==typeof $t?this.selectedIndex=parseInt($t):$t instanceof Array?this.array=$t:$M.superSet($g,this,"dataSource",$t)}),$V(0,$I,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$H}($g),$F=function($t){function $H(){$H.__super.call(this)}return $_($H,"laya.ui.HScrollBar",$t),$H.prototype.initialize=function(){$t.prototype.initialize.call(this),this.slider.isVertical=!1},$H}($h),$c=function($t){function $H(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$H.__super.call(this),this.width=this.height=100}$_($H,"laya.ui.Panel",$t);var $I=$H.prototype;return $I.destroy=function($t){void 0===$t&&($t=!0),laya.ui.Component.prototype.destroy.call(this,$t),this._content&&this._content.destroy($t),this._vScrollBar&&this._vScrollBar.destroy($t),this._hScrollBar&&this._hScrollBar.destroy($t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$I.destroyChildren=function(){this._content.destroyChildren()},$I.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $g)},$I.addChild=function($t){return $t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($t)},$I.onResize=function(){this._setScrollChanged()},$I.addChildAt=function($t,$H){return $t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($t,$H)},$I.removeChild=function($t){return $t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($t)},$I.removeChildAt=function($t){return this.getChildAt($t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($t)},$I.removeChildren=function($t,$H){return void 0===$t&&($t=0),void 0===$H&&($H=2147483647),this._content.removeChildren($t,$H),this._setScrollChanged(),this},$I.getChildAt=function($t){return this._content.getChildAt($t)},$I.getChildByName=function($t){return this._content.getChildByName($t)},$I.getChildIndex=function($t){return this._content.getChildIndex($t)},$I.changeScroll=function(){this._scrollChanged=!1;var $t=this.contentWidth||1,$H=this.contentHeight||1,$I=this._vScrollBar,$T=this._hScrollBar,$K=$I&&$H>this._height,$_=$T&&$t>this._width,$V=$K?this._width-$I.width:this._width,$e=$_?this._height-$T.height:this._height;$I&&($I.x=this._width-$I.width,$I.y=0,$I.height=this._height-($_?$T.height:0),$I.scrollSize=Math.max(.033*this._height,1),$I.thumbPercent=$e/$H,$I.setScroll(0,$H-$e,$I.value)),$T&&($T.x=0,$T.y=this._height-$T.height,$T.width=this._width-($K?$I.width:0),$T.scrollSize=Math.max(.033*this._width,1),$T.thumbPercent=$V/$t,$T.setScroll(0,$t-$V,$T.value))},$I.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$I.setContentSize=function($t,$H){var $I=this._content;$I.width=$t,$I.height=$H,$I.scrollRect||($I.scrollRect=new $J),$I.scrollRect.setTo(0,0,$t,$H),$I.scrollRect=$I.scrollRect},$I.onScrollBarChange=function($t){var $H=this._content.scrollRect;if($H){var $I=Math.round($t.value);$t.isVertical?$H.y=$I:$H.x=$I,this._content.scrollRect=$H}},$I.scrollTo=function($t,$H){void 0===$t&&($t=0),void 0===$H&&($H=0),this.vScrollBar&&(this.vScrollBar.value=$H),this.hScrollBar&&(this.hScrollBar.value=$t)},$I.refresh=function(){this.changeScroll()},$I.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$M.superGet($g,this,"cacheAs")),$M.superSet($g,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$I.onScrollEnd=function(){$M.superSet($g,this,"cacheAs",this._$P.cacheAs)},$I._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$V(0,$I,"numChildren",function(){return this._content.numChildren}),$V(0,$I,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $F),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$t}),$V(0,$I,"contentWidth",function(){for(var $t=0,$H=this._content.numChildren-1;-1<$H;$H--){var $I=this._content.getChildAt($H);$t=Math.max($I.x+$I.width*$I.scaleX,$t)}return $t}),$V(0,$I,"contentHeight",function(){for(var $t=0,$H=this._content.numChildren-1;-1<$H;$H--){var $I=this._content.getChildAt($H);$t=Math.max($I.y+$I.height*$I.scaleY,$t)}return $t}),$V(0,$I,"width",$t.prototype._$get_width,function($t){$M.superSet($g,this,"width",$t),this._setScrollChanged()}),$V(0,$I,"hScrollBar",function(){return this._hScrollBar}),$V(0,$I,"content",function(){return this._content}),$V(0,$I,"height",$t.prototype._$get_height,function($t){$M.superSet($g,this,"height",$t),this._setScrollChanged()}),$V(0,$I,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $Ht),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$t}),$V(0,$I,"vScrollBar",function(){return this._vScrollBar}),$V(0,$I,"cacheAs",$t.prototype._$get_cacheAs,function($t){$M.superSet($g,this,"cacheAs",$t),this._$P.cacheAs=null,"none"!==$t?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$H}($g),$i=function($t){function $H($t){$H.__super.call(this,$t),this.isVertical=!1}return $_($H,"laya.ui.HSlider",$X),$H}(),$j=function($t){function $I($t,$H){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$I.__super.call(this),this.skin=$H,this.labels=$t}$_($I,"laya.ui.UIGroup",$t);var $H=$I.prototype;return $M.imps($H,{"laya.ui.IItem":!0}),$H.preinitialize=function(){this.mouseEnabled=!0},$H.destroy=function($t){void 0===$t&&($t=!0),laya.ui.Component.prototype.destroy.call(this,$t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$H.addItem=function($t,$H){void 0===$H&&($H=!0);var $I=$t,$T=this._items.length;if($I.name="item"+$T,this.addChild($I),this.initItems(),$H&&0<$T){var $K=this._items[$T-1];"horizontal"==this._direction?$I.x=$K.x+$K.width+this._space:$I.y=$K.y+$K.height+this._space}else $H&&($I.x=0,$I.y=0);return $T},$H.delItem=function($t,$H){void 0===$H&&($H=!0);var $I=this._items.indexOf($t);if(-1!=$I){var $T=$t;this.removeChild($T);for(var $K=$I+1,$_=this._items.length;$K<$_;$K++){var $V=this._items[$K];$V.name="item"+($K-1),$H&&("horizontal"==this._direction?$V.x-=$T.width+this._space:$V.y-=$T.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $e;$e=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$e}}},$H.initItems=function(){this._items||(this._items=[]);for(var $t=this._items.length=0;$t<1e4;$t++){var $H=this.getChildByName("item"+$t);if(null==$H)break;this._items.push($H),$H.selected=$t===this._selectedIndex,$H.clickHandler=$b.create(this,this.itemClick,[$t],!1)}},$H.itemClick=function($t){this.selectedIndex=$t},$H.setSelect=function($t,$H){this._items&&-1<$t&&$t<this._items.length&&(this._items[$t].selected=$H)},$H.createItem=function($t,$H){return null},$H.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $t=0,$H=0,$I=this._items.length;$H<$I;$H++){var $T=this._items[$H];this._skin&&($T.skin=this._skin),this._labelColors&&($T.labelColors=this._labelColors),this._labelSize&&($T.labelSize=this._labelSize),this._labelStroke&&($T.labelStroke=this._labelStroke),this._labelStrokeColor&&($T.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($T.strokeColors=this._strokeColors),this._labelBold&&($T.labelBold=this._labelBold),this._labelPadding&&($T.labelPadding=this._labelPadding),this._labelAlign&&($T.labelAlign=this._labelAlign),this._stateNum&&($T.stateNum=this._stateNum),this._labelFont&&($T.labelFont=this._labelFont),"horizontal"===this._direction?($T.y=0,$T.x=$t,$t+=$T.width+this._space):($T.x=0,$T.y=$t,$t+=$T.height+this._space)}this.changeSize()},$H.commitMeasure=function(){this.runCallLater(this.changeLabels)},$H._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$V(0,$H,"labelStrokeColor",function(){return this._labelStrokeColor},function($t){this._labelStrokeColor!=$t&&(this._labelStrokeColor=$t,this._setLabelChanged())}),$V(0,$H,"skin",function(){return this._skin},function($t){this._skin!=$t&&(this._skin=$t,this._setLabelChanged())}),$V(0,$H,"selectedIndex",function(){return this._selectedIndex},function($t){this._selectedIndex!=$t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$t,this.setSelect($t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$V(0,$H,"labels",function(){return this._labels},function($t){if(this._labels!=$t){if(this._labels=$t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $H=this._labels.split(","),$I=0,$T=$H.length;$I<$T;$I++){var $K=this.createItem(this._skin,$H[$I]);$K.name="item"+$I,this.addChild($K)}this.initItems()}}),$V(0,$H,"strokeColors",function(){return this._strokeColors},function($t){this._strokeColors!=$t&&(this._strokeColors=$t,this._setLabelChanged())}),$V(0,$H,"labelColors",function(){return this._labelColors},function($t){this._labelColors!=$t&&(this._labelColors=$t,this._setLabelChanged())}),$V(0,$H,"labelStroke",function(){return this._labelStroke},function($t){this._labelStroke!=$t&&(this._labelStroke=$t,this._setLabelChanged())}),$V(0,$H,"labelSize",function(){return this._labelSize},function($t){this._labelSize!=$t&&(this._labelSize=$t,this._setLabelChanged())}),$V(0,$H,"stateNum",function(){return this._stateNum},function($t){this._stateNum!=$t&&(this._stateNum=$t,this._setLabelChanged())}),$V(0,$H,"labelBold",function(){return this._labelBold},function($t){this._labelBold!=$t&&(this._labelBold=$t,this._setLabelChanged())}),$V(0,$H,"labelFont",function(){return this._labelFont},function($t){this._labelFont!=$t&&(this._labelFont=$t,this._setLabelChanged())}),$V(0,$H,"labelPadding",function(){return this._labelPadding},function($t){this._labelPadding!=$t&&(this._labelPadding=$t,this._setLabelChanged())}),$V(0,$H,"direction",function(){return this._direction},function($t){this._direction=$t,this._setLabelChanged()}),$V(0,$H,"space",function(){return this._space},function($t){this._space=$t,this._setLabelChanged()}),$V(0,$H,"items",function(){return this._items}),$V(0,$H,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($t){this.selectedIndex=this._items.indexOf($t)}),$V(0,$H,"dataSource",$t.prototype._$get_dataSource,function($t){"number"==typeof(this._dataSource=$t)&&Math.floor($t)==$t||"string"==typeof $t?this.selectedIndex=parseInt($t):$t instanceof Array?this.labels=$t.join(","):$M.superSet($g,this,"dataSource",$t)}),$I}($g),$d=function($H){function $I($t,$H){this._value=null,void 0===$H&&($H=""),$I.__super.call(this,$t,$H)}$_($I,"laya.ui.Radio",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._value=null},$t.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$t.initialize=function(){$H.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$t.onClick=function($t){this.selected=!0},$V(0,$t,"value",function(){return null!=this._value?this._value:this.label},function($t){this._value=$t}),$I}($l),$Z=function($t){function $H(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$H.__super.call(this),this.width=this.height=200}$_($H,"laya.ui.Tree",$t);var $I=$H.prototype;return $M.imps($I,{"laya.ui.IRender":!0}),$I.destroy=function($t){void 0===$t&&($t=!0),laya.ui.Component.prototype.destroy.call(this,$t),this._list&&this._list.destroy($t),this._list=null,this._source=null,this._renderHandler=null},$I.createChildren=function(){this.addChild(this._list=new $n),this._list.renderHandler=$b.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$I.onListChange=function($t){this.event("change")},$I.getArray=function(){var $t,$H=[];for(var $I in this._source)$t=this._source[$I],this.getParentOpenStatus($t)&&($t.x=this._spaceLeft*this.getDepth($t),$H.push($t));return $H},$I.getDepth=function($t,$H){return void 0===$H&&($H=0),null==$t.nodeParent?$H:this.getDepth($t.nodeParent,$H+1)},$I.getParentOpenStatus=function($t){var $H=$t.nodeParent;return null==$H||!!$H.isOpen&&(null==$H.nodeParent||this.getParentOpenStatus($H))},$I.renderItem=function($t,$H){var $I=$t.dataSource;if($I){$t.left=$I.x;var $T=$t.getChildByName("arrow");$T&&($I.hasChild?($T.visible=!0,$T.index=$I.isOpen?1:0,$T.tag=$H,$T.off("click",this,this.onArrowClick),$T.on("click",this,this.onArrowClick)):$T.visible=!1);var $K=$t.getChildByName("folder");$K&&(2==$K.clipY?$K.index=$I.isDirectory?0:1:$K.index=$I.isDirectory?$I.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$t,$H])}},$I.onArrowClick=function($t){var $H=$t.currentTarget.tag;this._list.array[$H].isOpen=!this._list.array[$H].isOpen,this.event("open"),this._list.array=this.getArray()},$I.setItemState=function($t,$H){this._list.array[$t]&&(this._list.array[$t].isOpen=$H,this._list.array=this.getArray())},$I.fresh=function(){this._list.array=this.getArray(),this.repaint()},$I.parseXml=function($t,$H,$I,$T){var $K,$_=$t.childNodes,$V=$_.length;if(!$T){$K={};var $e,$R=$t.attributes;for(var $A in $R){var $q=($e=$R[$A]).nodeName,$f=$e.nodeValue;$K[$q]="true"==$f||"false"!=$f&&$f}$K.nodeParent=$I,0<$V&&($K.isDirectory=!0),$K.hasChild=0<$V,$H.push($K)}for(var $b=0;$b<$V;$b++){var $L=$_[$b];this.parseXml($L,$H,$K,!1)}},$I.parseOpenStatus=function($t,$H){for(var $I=0,$T=$H.length;$I<$T;$I++){var $K=$H[$I];if($K.isDirectory)for(var $_=0,$V=$t.length;$_<$V;$_++){var $e=$t[$_];if($e.isDirectory&&this.isSameParent($e,$K)&&$K.label==$e.label){$K.isOpen=$e.isOpen;break}}}},$I.isSameParent=function($t,$H){return null==$t.nodeParent&&null==$H.nodeParent||null!=$t.nodeParent&&null!=$H.nodeParent&&($t.nodeParent.label==$H.nodeParent.label&&this.isSameParent($t.nodeParent,$H.nodeParent))},$I.filter=function($t){if(Boolean($t)){var $H=[];this.getFilterSource(this._source,$H,$t),this._list.array=$H}else this._list.array=this.getArray()},$I.getFilterSource=function($t,$H,$I){var $T;for(var $K in $I=$I.toLocaleLowerCase(),$t)!($T=$t[$K]).isDirectory&&-1<String($T.label).toLowerCase().indexOf($I)&&($T.x=0,$H.push($T)),$T.child&&0<$T.child.length&&this.getFilterSource($T.child,$H,$I)},$V(0,$I,"spaceBottom",function(){return this._list.spaceY},function($t){this._list.spaceY=$t}),$V(0,$I,"keepStatus",function(){return this._keepStatus},function($t){this._keepStatus=$t}),$V(0,$I,"itemRender",function(){return this._list.itemRender},function($t){this._list.itemRender=$t}),$V(0,$I,"array",function(){return this._list.array},function($t){this._keepStatus&&this._list.array&&$t&&this.parseOpenStatus(this._list.array,$t),this._source=$t,this._list.array=this.getArray()}),$V(0,$I,"mouseHandler",function(){return this._list.mouseHandler},function($t){this._list.mouseHandler=$t}),$V(0,$I,"dataSource",$t.prototype._$get_dataSource,function($t){this._dataSource=$t,$M.superSet($g,this,"dataSource",$t)}),$V(0,$I,"source",function(){return this._source}),$V(0,$I,"scrollBar",function(){return this._list.scrollBar}),$V(0,$I,"list",function(){return this._list}),$V(0,$I,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($t){this._list.vScrollBarSkin=$t}),$V(0,$I,"renderHandler",function(){return this._renderHandler},function($t){this._renderHandler=$t}),$V(0,$I,"selectedIndex",function(){return this._list.selectedIndex},function($t){this._list.selectedIndex=$t}),$V(0,$I,"spaceLeft",function(){return this._spaceLeft},function($t){this._spaceLeft=$t}),$V(0,$I,"selectedItem",function(){return this._list.selectedItem},function($t){this._list.selectedItem=$t}),$V(0,$I,"width",$t.prototype._$get_width,function($t){$M.superSet($g,this,"width",$t),this._list.width=$t}),$V(0,$I,"height",$t.prototype._$get_height,function($t){$M.superSet($g,this,"height",$t),this._list.height=$t}),$V(0,$I,"xml",null,function($t){var $H=[];this.parseXml($t.childNodes[0],$H,null,!0),this.array=$H}),$V(0,$I,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$H}($g),$tt=function($t){function $H(){this._items=null,this._selectedIndex=0,$H.__super.call(this),this._setIndexHandler=$b.create(this,this.setIndex,null,!1)}$_($H,"laya.ui.ViewStack",$t);var $I=$H.prototype;return $M.imps($I,{"laya.ui.IItem":!0}),$I.setItems=function($t){this.removeChildren();for(var $H=0,$I=0,$T=$t.length;$I<$T;$I++){var $K=$t[$I];$K&&($K.name="item"+$H,this.addChild($K),$H++)}this.initItems()},$I.addItem=function($t){$t.name="item"+this._items.length,this.addChild($t),this.initItems()},$I.initItems=function(){this._items=[];for(var $t=0;$t<1e4;$t++){var $H=this.getChildByName("item"+$t);if(null==$H)break;this._items.push($H),$H.visible=$t==this._selectedIndex}},$I.setSelect=function($t,$H){this._items&&-1<$t&&$t<this._items.length&&(this._items[$t].visible=$H)},$I.setIndex=function($t){this.selectedIndex=$t},$V(0,$I,"dataSource",$t.prototype._$get_dataSource,function($t){if("number"==typeof(this._dataSource=$t)&&Math.floor($t)==$t||"string"==typeof $t)this.selectedIndex=parseInt($t);else for(var $H in this._dataSource)this.hasOwnProperty($H)&&(this[$H]=this._dataSource[$H])}),$V(0,$I,"selectedIndex",function(){return this._selectedIndex},function($t){this._selectedIndex!=$t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$t,this.setSelect(this._selectedIndex,!0))}),$V(0,$I,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($t){this.selectedIndex=this._items.indexOf($t)}),$V(0,$I,"items",function(){return this._items}),$V(0,$I,"setIndexHandler",function(){return this._setIndexHandler},function($t){this._setIndexHandler=$t}),$H}($g),$Ht=function($t){function $H(){$H.__super.call(this)}return $_($H,"laya.ui.VScrollBar",$h),$H}(),$It=function($H){function $I($t){this._bg=null,this._skin=null,$I.__super.call(this),void 0===$t&&($t=""),this.text=$t,this.skin=this.skin}$_($I,"laya.ui.TextInput",$H);var $t=$I.prototype;return $t.preinitialize=function(){this.mouseEnabled=!0},$t.destroy=function($t){$S.clearCache(this,this._skin),void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._bg&&this._bg.destroy(),this._bg=null},$t.createChildren=function(){this.addChild(this._tf=new $L),this._tf.padding=$k.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$t._onFocus=function(){this.event("focus",this)},$t._onBlur=function(){this.event("blur",this)},$t._onInput=function(){this.event("input",this)},$t._onEnter=function(){this.event("enter",this)},$t.initialize=function(){this.width=128,this.height=22},$t.select=function(){this._tf.select()},$t.setSelection=function($t,$H){this._tf.setSelection($t,$H)},$V(0,$t,"text",$H.prototype._$get_text,function($t){this._tf.text!=$t&&($t+="",this._tf.text=$t,this.event("change"))}),$V(0,$t,"bg",function(){return this._bg},function($t){this.graphics=this._bg=$t}),$V(0,$t,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($t){this._tf.inputElementYAdjuster=$t}),$V(0,$t,"multiline",function(){return this._tf.multiline},function($t){this._tf.multiline=$t}),$V(0,$t,"skin",function(){return this._skin},function($t){this._skin!=$t&&($S.clearCache(this,this._skin),this._skin=$t,this._bg||(this.graphics=this._bg=new $Y),$S.keepCache(this,this._skin),this._bg.source=$S.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$V(0,$t,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($t){this._bg||(this.graphics=this._bg=new $Y),this._bg.sizeGrid=$r.fillArray($k.defaultSizeGrid,$t,Number)}),$V(0,$t,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($t){this._tf.inputElementXAdjuster=$t}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($a,this,"width",$t),this._bg&&(this._bg.width=$t)}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($a,this,"height",$t),this._bg&&(this._bg.height=$t)}),$V(0,$t,"editable",function(){return this._tf.editable},function($t){this._tf.editable=$t}),$V(0,$t,"restrict",function(){return this._tf.restrict},function($t){this._tf.restrict=$t}),$V(0,$t,"prompt",function(){return this._tf.prompt},function($t){this._tf.prompt=$t}),$V(0,$t,"promptColor",function(){return this._tf.promptColor},function($t){this._tf.promptColor=$t}),$V(0,$t,"maxChars",function(){return this._tf.maxChars},function($t){this._tf.maxChars=$t}),$V(0,$t,"focus",function(){return this._tf.focus},function($t){this._tf.focus=$t}),$V(0,$t,"type",function(){return this._tf.type},function($t){this._tf.type=$t}),$V(0,$t,"asPassword",function(){return this._tf.asPassword},function($t){this._tf.asPassword=$t}),$I}($a),$Tt=function($t){function $H(){$H.__super.call(this)}return $_($H,"laya.ui.VSlider",$X),$H}(),$Kt=function($t){function $T(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$T.__super.call(this)}$_($T,"laya.ui.Dialog",$t);var $H=$T.prototype;return $H.initialize=function(){this.popupEffect=$T.manager.popupEffectHandler,this.closeEffect=$T.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$H._dealDragArea=function(){var $t=this.getChildByName("drag");$t&&(this.dragArea=$t.x+","+$t.y+","+$t.width+","+$t.height,$t.removeSelf())},$H._onClick=function($t){var $H=$t.target;if($H)switch($H.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($H.name)}},$H.show=function($t,$H){void 0===$t&&($t=!1),void 0===$H&&($H=!0),this._open(!1,$t,$H)},$H.popup=function($t,$H){void 0===$t&&($t=!1),void 0===$H&&($H=!0),this._open(!0,$t,$H)},$H._open=function($t,$H,$I){$T.manager.lock(!1),this.isModal=$t,$T.manager.open(this,$H,$I)},$H.onOpened=function(){},$H.close=function($t,$H){void 0===$H&&($H=!0),$T.manager.close(this,$t,$H)},$H.onClosed=function($t){},$H._onMouseDown=function($t){var $H=this.getMousePoint();this._dragArea.contains($H.x,$H.y)?this.startDrag():this.stopDrag()},$V(0,$H,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($t){if($t){var $H=$r.fillArray([0,0,0,0],$t,Number);this._dragArea=new $J($H[0],$H[1],$H[2],$H[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$V(0,$H,"isPopup",function(){return null!=this.parent}),$V(0,$H,"zOrder",$t.prototype._$get_zOrder,function($t){$M.superSet($$,this,"zOrder",$t),$T.manager._checkMask()}),$V(1,$T,"manager",function(){return $T._manager=$T._manager||new $p},function($t){$T._manager=$t}),$T.setLockView=function($t){$T.manager.setLockView($t)},$T.lock=function($t){$T.manager.lock($t)},$T.closeAll=function(){$T.manager.closeAll()},$T.getDialogsByGroup=function($t){return $T.manager.getDialogsByGroup($t)},$T.closeByGroup=function($t){return $T.manager.closeByGroup($t)},$T.CLOSE="close",$T.CANCEL="cancel",$T.SURE="sure",$T.NO="no",$T.OK="ok",$T.YES="yes",$T._manager=null,$T}($$),$_t=function($t){function $H(){$H.__super.call(this)}$_($H,"laya.ui.HBox",$t);var $I=$H.prototype;return $I.sortItem=function($t){$t&&$t.sort(function($t,$H){return $t.x-$H.x})},$I.changeItems=function(){this._itemChanged=!1;for(var $t=[],$H=0,$I=0,$T=this.numChildren;$I<$T;$I++){var $K=this.getChildAt($I);$K&&$K.layoutEnabled&&($t.push($K),$H=this._height?this._height:Math.max($H,$K.height*$K.scaleY))}this.sortItem($t);var $_=0;for($I=0,$T=$t.length;$I<$T;$I++)($K=$t[$I]).x=$_,$_+=$K.width*$K.scaleX+this._space,"top"==this._align?$K.y=0:"middle"==this._align?$K.y=.5*($H-$K.height*$K.scaleY):"bottom"==this._align&&($K.y=$H-$K.height*$K.scaleY);this.changeSize()},$V(0,$I,"height",$t.prototype._$get_height,function($t){this._height!=$t&&($M.superSet($m,this,"height",$t),this.callLater(this.changeItems))}),$H.NONE="none",$H.TOP="top",$H.MIDDLE="middle",$H.BOTTOM="bottom",$H}($m),$Vt=function($t){function $H(){$H.__super.call(this)}$_($H,"laya.ui.VBox",$t);var $I=$H.prototype;return $I.changeItems=function(){this._itemChanged=!1;for(var $t=[],$H=0,$I=0,$T=this.numChildren;$I<$T;$I++){var $K=this.getChildAt($I);$K&&$K.layoutEnabled&&($t.push($K),$H=this._width?this._width:Math.max($H,$K.width*$K.scaleX))}this.sortItem($t);var $_=0;for($I=0,$T=$t.length;$I<$T;$I++)($K=$t[$I]).y=$_,$_+=$K.height*$K.scaleY+this._space,"left"==this._align?$K.x=0:"center"==this._align?$K.x=.5*($H-$K.width*$K.scaleX):"right"==this._align&&($K.x=$H-$K.width*$K.scaleX);this.changeSize()},$V(0,$I,"width",$t.prototype._$get_width,function($t){this._width!=$t&&($M.superSet($m,this,"width",$t),this.callLater(this.changeItems))}),$H.NONE="none",$H.LEFT="left",$H.CENTER="center",$H.RIGHT="right",$H}($m),$et=function($t){function $H(){$H.__super.call(this)}return $_($H,"laya.ui.RadioGroup",$j),$H.prototype.createItem=function($t,$H){return new $d($t,$H)},$H}(),$Rt=function($t){function $H(){$H.__super.call(this)}return $_($H,"laya.ui.Tab",$j),$H.prototype.createItem=function($t,$H){return new $l($t,$H)},$H}(),$At=function($H){function $I($t){this._vScrollBar=null,this._hScrollBar=null,void 0===$t&&($t=""),$I.__super.call(this,$t)}$_($I,"laya.ui.TextArea",$H);var $t=$I.prototype;return $t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$t.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$t.onVBarChanged=function($t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$t.onHBarChanged=function($t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$t.changeScroll=function(){var $t=this._vScrollBar&&0<this._tf.maxScrollY,$H=this._hScrollBar&&0<this._tf.maxScrollX,$I=$t?this._width-this._vScrollBar.width:this._width,$T=$H?this._height-this._hScrollBar.height:this._height,$K=this._tf.padding||$k.labelPadding;this._tf.width=$I,this._tf.height=$T,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$K[2],this._vScrollBar.y=$K[1],this._vScrollBar.height=this._height-($H?this._hScrollBar.height:0)-$K[1]-$K[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$T/Math.max(this._tf.textHeight,$T),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$t),this._hScrollBar&&(this._hScrollBar.x=$K[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$K[3],this._hScrollBar.width=this._width-($t?this._vScrollBar.width:0)-$K[0]-$K[2],this._hScrollBar.scrollSize=Math.max(.033*$I,1),this._hScrollBar.thumbPercent=$I/Math.max(this._tf.textWidth,$I),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$H)},$t.scrollTo=function($t){this.commitMeasure(),this._tf.scrollY=$t},$V(0,$t,"scrollY",function(){return this._tf.scrollY}),$V(0,$t,"width",$H.prototype._$get_width,function($t){$M.superSet($It,this,"width",$t),this.callLater(this.changeScroll)}),$V(0,$t,"hScrollBar",function(){return this._hScrollBar}),$V(0,$t,"height",$H.prototype._$get_height,function($t){$M.superSet($It,this,"height",$t),this.callLater(this.changeScroll)}),$V(0,$t,"maxScrollX",function(){return this._tf.maxScrollX}),$V(0,$t,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $Ht),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$t}),$V(0,$t,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $F),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$t}),$V(0,$t,"vScrollBar",function(){return this._vScrollBar}),$V(0,$t,"maxScrollY",function(){return this._tf.maxScrollY}),$V(0,$t,"scrollX",function(){return this._tf.scrollX}),$I}($It);!function($t){function $H(){this._uiView=null,this.isCloseOther=!1,$H.__super.call(this)}$_($H,"laya.ui.AsynDialog",$Kt);var $I=$H.prototype;$I.createView=function($t){this._uiView=$t},$I._open=function($t,$H,$I){this.isModal=$t,this.isCloseOther=$H,$Kt.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$I.onCreated=function(){this.createUI(),this.onOpen()},$I.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$I.onOpen=function(){$Kt.manager.open(this,this.isCloseOther),$Kt.manager.lock(!1)},$I.close=function($t,$H){void 0===$H&&($H=!0),$Kt.manager.close(this),this.onClose()},$I.onClose=function(){},$I.destroy=function($t){void 0===$t&&($t=!0),laya.ui.View.prototype.destroy.call(this,$t),this._uiView=null,this.onDestroy()},$I.onDestroy=function(){}}();$M.__init([$$])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($t,$H){"use strict";for(var $I in Object.defineProperty($H,"__esModule",{value:!0}),Laya){var $T=Laya[$I];$T&&$T.__isclass&&($H[$I]=$T)}}),function($b,$t,$N){$N.un,$N.uns;var $f=$N.static,$L=$N.class,$G=$N.getset,$T=$N.__newvec,$C=laya.maths.Arith,$V=laya.webgl.atlas.AtlasResourceManager,$I=laya.webgl.shader.BaseShader,$D=laya.utils.Browser,$e=laya.webgl.utils.Buffer,$w=laya.utils.Byte,$K=laya.utils.ClassUtils,$R=$N.Config,$_=(laya.events.Event,laya.events.EventDispatcher),$k=laya.utils.Handler,$J=laya.net.Loader,$H=laya.net.LoaderManager,$A=(laya.maths.MathUtil,laya.display.Node),$M=laya.renders.Render,$q=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$O=laya.resource.Resource,$S=laya.utils.RunDriver,$U=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$W=laya.display.Sprite,$s=laya.utils.Stat,$z=laya.utils.StringKey,$r=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$P=laya.utils.Utils,$x=laya.webgl.WebGL,$Y=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$N.interface("laya.d3.core.IClone"),$N.interface("laya.d3.graphics.IVertex"),$N.interface("laya.d3.core.render.IUpdate"),$N.interface("laya.d3.core.scene.ITreeNode"),$N.interface("laya.d3.core.render.IRenderable");(function(){function $l(){}$L($l,"laya.d3.animation.AnimationClipParser01"),$l.READ_DATA=function(){$l._DATA.offset=$l._reader.getUint32(),$l._DATA.size=$l._reader.getUint32()},$l.READ_BLOCK=function(){for(var $t=$l._BLOCK.count=$l._reader.getUint16(),$H=$l._BLOCK.blockStarts=[],$I=$l._BLOCK.blockLengths=[],$T=0;$T<$t;$T++)$H.push($l._reader.getUint32()),$I.push($l._reader.getUint32())},$l.READ_STRINGS=function(){var $t=$l._reader.getUint32(),$H=$l._reader.getUint16(),$I=$l._reader.pos;$l._reader.pos=$t+$l._DATA.offset;for(var $T=0;$T<$H;$T++)$l._strings[$T]=$l._reader.readUTFString();$l._reader.pos=$I},$l.parse=function($t,$H){$l._animationClip=$t;($l._reader=$H).__getBuffer();$l.READ_DATA(),$l.READ_BLOCK(),$l.READ_STRINGS();for(var $I=0,$T=$l._BLOCK.count;$I<$T;$I++){var $K=$H.getUint16(),$_=$l._strings[$K],$V=$l["READ_"+$_];if(null==$V)throw new Error("model file err,no this function:"+$K+" "+$_);$V.call()}},$l.READ_ANIMATIONS=function(){var $t,$H=0,$I=0,$T=$l._reader,$K=$T.__getBuffer(),$_=[],$V=$T.getUint8();for($_.length=$V,$H=0;$H<$V;$H++)$_[$H]=$T.getUint16();var $e=[],$R=$T.getUint16();for($e.length=$R,$H=0;$H<$R;$H++)$e[$H]=$T.getFloat32();var $A=$l._animationClip;$A.name=$l._strings[$T.getUint16()];var $q=$A._duration=$T.getFloat32();$A.islooping=!!$T.getByte(),$A._frameRate=$T.getInt16();var $f=$T.getInt16(),$b=$A._nodes=new Array;$b.length=$f,($A._publicClipDatas=[]).length=$f;var $L=$A._nodesMap={},$G=0,$M=0;for($H=0;$H<$f;$H++){$t=$b[$H]=new $u;var $O=$T.getUint16(),$J=$t.path=[];for($J.length=$O,$I=0;$I<$O;$I++)$J[$I]=$l._strings[$T.getUint16()];var $S=$J.join("/"),$U=$L[$S];$U||($L[$S]=$U=[]),$U.push($t);var $C=$T.getInt16();-1!==$C&&($t.componentType=$l._strings[$C]);var $N=$B._propertyIndexDic[$l._strings[$T.getUint16()]];if(null==$N)throw new Error("AnimationClipParser01:unknown property name.");var $w=$N<4,$W=!$w||$w&&""===$J[0];($t._cacheProperty=$W)?$G++:$M++,$t.propertyNameID=$N;var $s=$_[$T.getUint8()];$t.keyFrameWidth=$s/4;var $z=$t.keyFrames=[],$P=$z.length=$T.getUint16(),$k=null,$r=NaN;for($I=0;$I<$P;$I++){var $x=$z[$I]=new $a;$r=$x.startTime=$e[$T.getUint16()];var $Y=$T.pos;$x.inTangent=new Float32Array($K.slice($Y,$Y+$s)),$T.pos+=$s,$Y=$T.pos,$x.outTangent=new Float32Array($K.slice($Y,$Y+$s)),$T.pos+=$s,$Y=$T.pos,$x.data=new Float32Array($K.slice($Y,$Y+$s)),$T.pos+=$s,$k&&($k.next=$x,$k.duration=$r-$k.startTime),$k=$x}$x.next=null,$x.duration=$q-$r}var $D=$A._nodeToCachePropertyMap=new Int32Array($f),$p=$A._cachePropertyMap=new Int32Array($G),$g=$A._unCachePropertyMap=new Int32Array($M);for($G=$M=0,$H=0;$H<$f;$H++)($t=$b[$H])._cacheProperty?($D[$H]=$G,$p[$G++]=$H):$g[$M++]=$H},$l._animationClip=null,$l._reader=null,$l._strings=[],$f($l,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $h(){}$L($h,"laya.d3.animation.AnimationClipParser02"),$h.READ_DATA=function(){$h._DATA.offset=$h._reader.getUint32(),$h._DATA.size=$h._reader.getUint32()},$h.READ_BLOCK=function(){for(var $t=$h._BLOCK.count=$h._reader.getUint16(),$H=$h._BLOCK.blockStarts=[],$I=$h._BLOCK.blockLengths=[],$T=0;$T<$t;$T++)$H.push($h._reader.getUint32()),$I.push($h._reader.getUint32())},$h.READ_STRINGS=function(){var $t=$h._reader.getUint32(),$H=$h._reader.getUint16(),$I=$h._reader.pos;$h._reader.pos=$t+$h._DATA.offset;for(var $T=0;$T<$H;$T++)$h._strings[$T]=$h._reader.readUTFString();$h._reader.pos=$I},$h.parse=function($t,$H){$h._animationClip=$t;($h._reader=$H).__getBuffer();$h.READ_DATA(),$h.READ_BLOCK(),$h.READ_STRINGS();for(var $I=0,$T=$h._BLOCK.count;$I<$T;$I++){var $K=$H.getUint16(),$_=$h._strings[$K],$V=$h["READ_"+$_];if(null==$V)throw new Error("model file err,no this function:"+$K+" "+$_);$V.call()}},$h.READ_ANIMATIONS=function(){var $t,$H=0,$I=0,$T=$h._reader,$K=$T.__getBuffer(),$_=[],$V=$T.getUint8();for($_.length=$V,$H=0;$H<$V;$H++)$_[$H]=$T.getUint16();var $e=[],$R=$T.getUint16();for($e.length=$R,$H=0;$H<$R;$H++)$e[$H]=$T.getFloat32();var $A=$h._animationClip;$A.name=$h._strings[$T.getUint16()];var $q=$A._duration=$T.getFloat32();$A.islooping=!!$T.getByte(),$A._frameRate=$T.getInt16();var $f=$T.getInt16(),$b=$A._nodes=new Array;$b.length=$f,($A._publicClipDatas=[]).length=$f;var $L=$A._nodesMap={},$G=0,$M=0;for($H=0;$H<$f;$H++){$t=$b[$H]=new $u;var $O=$T.getUint16(),$J=$t.path=[];for($J.length=$O,$I=0;$I<$O;$I++)$J[$I]=$h._strings[$T.getUint16()];var $S=$J.join("/"),$U=$L[$S];$U||($L[$S]=$U=[]),$U.push($t);var $C=$T.getInt16();-1!==$C&&($t.componentType=$h._strings[$C]);var $N=$B._propertyIndexDic[$h._strings[$T.getUint16()]];if(null==$N)throw new Error("AnimationClipParser02:unknown property name.");var $w=$N<4,$W=!$w||$w&&""===$J[0];($t._cacheProperty=$W)?$G++:$M++,$t.propertyNameID=$N;var $s=$_[$T.getUint8()];$t.keyFrameWidth=$s/4;var $z=$t.keyFrames=[],$P=$z.length=$T.getUint16(),$k=null,$r=NaN;for($I=0;$I<$P;$I++){var $x=$z[$I]=new $a;$r=$x.startTime=$e[$T.getUint16()];var $Y=$T.pos;$x.inTangent=new Float32Array($K.slice($Y,$Y+$s)),$T.pos+=$s,$Y=$T.pos,$x.outTangent=new Float32Array($K.slice($Y,$Y+$s)),$T.pos+=$s,$Y=$T.pos,$x.data=new Float32Array($K.slice($Y,$Y+$s)),$T.pos+=$s,$k&&($k.next=$x,$k.duration=$r-$k.startTime),$k=$x}$x.next=null,$x.duration=$q-$r}var $D=$T.getUint16();for($H=0;$H<$D;$H++){var $p,$g=new $X;$g.time=$T.getFloat32(),$g.eventName=$h._strings[$T.getUint16()];var $l=$T.getUint16();for(0<$l&&($g.params=$p=[]),$I=0;$I<$l;$I++){switch($T.getByte()){case 0:$p.push(!!$T.getByte());break;case 1:$p.push($T.getInt32());break;case 2:$p.push($T.getFloat32());break;case 3:$p.push($h._strings[$T.getUint16()]);break;default:throw new Error("unknown type.")}}$A.addEvent($g)}var $v=$A._nodeToCachePropertyMap=new Int32Array($f),$y=$A._cachePropertyMap=new Int32Array($G),$E=$A._unCachePropertyMap=new Int32Array($M);for($G=$M=0,$H=0;$H<$f;$H++)($t=$b[$H])._cacheProperty?($v[$H]=$G,$y[$G++]=$H):$E[$M++]=$H},$h._animationClip=null,$h._reader=null,$h._strings=[],$f($h,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $X=function(){function $t(){this.time=NaN,this.eventName=null,this.params=null}return $L($t,"laya.d3.animation.AnimationEvent"),$t}(),$B=function(){function $T(){this._childs=[],this.transform=new $SH(this)}$L($T,"laya.d3.animation.AnimationNode");var $t=$T.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.addChild=function($t){$t._parent=this,$t.transform.setParent(this.transform),this._childs.push($t)},$t.removeChild=function($t){var $H=this._childs.indexOf($t);-1!==$H&&this._childs.splice($H,1)},$t.getChildByName=function($t){for(var $H=0,$I=this._childs.length;$H<$I;$H++){var $T=this._childs[$H];if($T.name===$t)return $T}return null},$t.getChildByIndex=function($t){return this._childs[$t]},$t.getChildCount=function(){return this._childs.length},$t.cloneTo=function($t){var $H=$t;$H.name=this.name;for(var $I=0,$T=this._childs.length;$I<$T;$I++){var $K=this._childs[$I],$_=$K.clone();$H.addChild($_);var $V=$K.transform,$e=$_.transform;$e.setLocalPosition($V.getLocalPosition()),$e.setLocalRotation($V.getLocalRotation()),$e.setLocalScale($V.getLocalScale()),$e._localRotationEuler=$V._localRotationEuler,$e._setWorldMatrixIgnoreUpdate($V.getWorldMatrix())}},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$T.__init__=function(){$T.registerAnimationNodeProperty("localPosition",$T._getLocalPosition,$T._setLocalPosition),$T.registerAnimationNodeProperty("localRotation",$T._getLocalRotation,$T._setLocalRotation),$T.registerAnimationNodeProperty("localScale",$T._getLocalScale,$T._setLocalScale),$T.registerAnimationNodeProperty("localRotationEuler",$T._getLocalRotationEuler,$T._setLocalRotationEuler),$T.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$T._getParticleRenderSharedMaterialTintColor,$T._setParticleRenderSharedMaterialTintColor),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$T._getMeshRenderSharedMaterialTilingOffset,$T._setMeshRenderSharedMaterialTilingOffset),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$T._getMeshRenderSharedMaterialAlbedo,$T._setMeshRenderSharedMaterialAlbedo),$T.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$T._getSkinnedMeshRenderSharedMaterialTilingOffset,$T._setSkinnedMeshRenderSharedMaterialTilingOffset),$T.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$T._getSkinnedMeshRenderSharedMaterialAlbedo,$T._setSkinnedMeshRenderSharedMaterialAlbedo),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$T._getMeshRenderSharedMaterialAlbedo,$T._setMeshRenderSharedMaterialAlbedo),$T.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$T._getSkinnedMeshRenderSharedMaterialAlbedo,$T._setSkinnedMeshRenderSharedMaterialAlbedo),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$T._getMeshRenderSharedMaterialIntensity,$T._setMeshRenderSharedMaterialIntensity),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$T._getMeshRenderSharedMaterialAlpha,$T._setMeshRenderSharedMaterialAlpha),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$T._getMeshRenderSharedMaterialAlphaColor,$T._setMeshRenderSharedMaterialAlphaColor),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$T._getMeshRenderSharedMaterialBaseColor,$T._setMeshRenderSharedMaterialBaseColor),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$T._getMeshRenderSharedMaterialDissolve,$T._setMeshRenderSharedMaterialDissolve),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$T._getMeshRenderSharedMaterialDissolveSpeed,$T._setMeshRenderSharedMaterialDissolveSpeed),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$T._getMeshRenderSharedMaterialMMultiplier,$T._setMeshRenderSharedMaterialMMultiplier),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$T._getMeshRenderSharedMaterialBaseScrollSpeedX,$T._setMeshRenderSharedMaterialBaseScrollSpeedX),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$T._getMeshRenderSharedMaterialBaseScrollSpeedY,$T._setMeshRenderSharedMaterialBaseScrollSpeedY),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$T._getMeshRenderSharedMaterialSecondScrollSpeedX,$T._setMeshRenderSharedMaterialSecondScrollSpeedX),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$T._getMeshRenderSharedMaterialSecondScrollSpeedY,$T._setMeshRenderSharedMaterialSecondScrollSpeedY),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$T._getMeshRenderSharedMaterialDetailTilingOffset,$T._setMeshRenderSharedMaterialDetailTilingOffset),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$T._getMeshRenderSharedMaterialDissolveTilingOffset,$T._setMeshRenderSharedMaterialDissolveTilingOffset),$T.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$T._getMeshRenderSharedMaterialMaskTilingOffset,$T._setMeshRenderSharedMaterialMaskTilingOffset)},$T.registerAnimationNodeProperty=function($t,$H,$I){if($T._propertyIndexDic[$t])throw new Error("AnimationNode: this propertyName has registered.");$T._propertyIndexDic[$t]=$T._propertyIDCounter,$T._propertyGetFuncs[$T._propertyIDCounter]=$H,$T._propertySetFuncs[$T._propertyIDCounter]=$I,$T._propertyIDCounter++},$T._getLocalPosition=function($t,$H){return $t?$t.transform.getLocalPosition():$H._transform.localPosition.elements},$T._setLocalPosition=function($t,$H,$I){if($t)$t.transform.setLocalPosition($I);else{var $T=$H._transform,$K=$T.localPosition;$K.elements=$I,$T.localPosition=$K}},$T._getLocalRotation=function($t,$H){return $t?$t.transform.getLocalRotation():$H._transform.localRotation.elements},$T._setLocalRotation=function($t,$H,$I){if($t)$t.transform.setLocalRotation($I);else{var $T=$H._transform,$K=$T.localRotation;$K.elements=$I,$T.localRotation=$K}},$T._getLocalScale=function($t,$H){return $t?$t.transform.getLocalScale():$H._transform.localScale.elements},$T._setLocalScale=function($t,$H,$I){if($t)$t.transform.setLocalScale($I);else{var $T=$H._transform,$K=$T.localScale;$K.elements=$I,$T.localScale=$K}},$T._getLocalRotationEuler=function($t,$H){return $t?$t.transform.getLocalRotationEuler():$H._transform.localRotationEuler.elements},$T._setLocalRotationEuler=function($t,$H,$I){if($t)$t.transform.setLocalRotationEuler($I);else{var $T=$H._transform,$K=$T.localRotationEuler;$K.elements=$I,$T.localRotationEuler=$K}},$T._getMeshRenderSharedMaterialTilingOffset=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $H.meshRender.sharedMaterial.tilingOffset.elements},$T._setMeshRenderSharedMaterialTilingOffset=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).tilingOffset).elements=$I,$T.tilingOffset=$K)}else($K=($T=$H.meshRender.material).tilingOffset).elements=$I,$T.tilingOffset=$K},$T._getMeshRenderSharedMaterialAlbedo=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $H.meshRender.sharedMaterial.albedoColor.elements},$T._setMeshRenderSharedMaterialAlbedo=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).albedoColor).elements=$I,$T.albedoColor=$K)}else($K=($T=$H.meshRender.material).albedoColor).elements=$I,$T.albedoColor=$K},$T._getSkinnedMeshRenderSharedMaterialTilingOffset=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $H.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$T._setSkinnedMeshRenderSharedMaterialTilingOffset=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.skinnedMeshRender.material).tilingOffset).elements=$I,$T.tilingOffset=$K)}else($K=($T=$H.skinnedMeshRender.material).tilingOffset).elements=$I,$T.tilingOffset=$K},$T._getSkinnedMeshRenderSharedMaterialAlbedo=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $H.skinnedMeshRender.sharedMaterial.albedoColor.elements},$T._setSkinnedMeshRenderSharedMaterialAlbedo=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.skinnedMeshRender.material).albedoColor).elements=$I,$T.albedoColor=$K)}else($K=($T=$H.skinnedMeshRender.material).albedoColor).elements=$I,$T.albedoColor=$K},$T._getParticleRenderSharedMaterialTintColor=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.particleRender.sharedMaterial.tintColor.elements:null}return $H.particleRender.sharedMaterial.tintColor.elements},$T._setParticleRenderSharedMaterialTintColor=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.particleRender.material).tintColor).elements=$I,$T.tintColor=$K)}else($K=($T=$H.particleRender.material).tintColor).elements=$I,$T.tintColor=$K},$T._getMeshRenderSharedMaterialAlphaColor=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $H.meshRender.sharedMaterial.alphaColor.elements},$T._setMeshRenderSharedMaterialAlphaColor=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).alphaColor).elements=$I,$T.alphaColor=$K)}else($K=($T=$H.meshRender.material).alphaColor).elements=$I,$T.alphaColor=$K},$T._getMeshRenderSharedMaterialBaseColor=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.baseColor.elements:null}return $H.meshRender.sharedMaterial.baseColor.elements},$T._setMeshRenderSharedMaterialBaseColor=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).baseColor).elements=$I,$T.baseColor=$K)}else($K=($T=$H.meshRender.material).baseColor).elements=$I,$T.baseColor=$K},$T._getMeshRenderSharedMaterialDissolve=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.dissolve:0}return $H.meshRender.sharedMaterial.dissolve},$T._setMeshRenderSharedMaterialDissolve=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.dissolve=$I[0])}else $H.meshRender.material.dissolve=$I[0]},$T._getMeshRenderSharedMaterialDissolveSpeed=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $H.meshRender.sharedMaterial.dissolveSpeed},$T._setMeshRenderSharedMaterialDissolveSpeed=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.dissolveSpeed=$I[0])}else $H.meshRender.material.dissolveSpeed=$I[0]},$T._getMeshRenderSharedMaterialMMultiplier=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.mMultiplier:0}return $H.meshRender.sharedMaterial.mMultiplier},$T._setMeshRenderSharedMaterialMMultiplier=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.mMultiplier=$I[0])}else $H.meshRender.material.mMultiplier=$I[0]},$T._getMeshRenderSharedMaterialBaseScrollSpeedX=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $H.meshRender.sharedMaterial.baseScrollSpeedX},$T._setMeshRenderSharedMaterialBaseScrollSpeedX=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.baseScrollSpeedX=$I[0])}else $H.meshRender.material.baseScrollSpeedX=$I[0]},$T._getMeshRenderSharedMaterialBaseScrollSpeedY=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $H.meshRender.sharedMaterial.baseScrollSpeedY},$T._setMeshRenderSharedMaterialBaseScrollSpeedY=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.baseScrollSpeedY=$I[0])}else $H.meshRender.material.baseScrollSpeedY=$I[0]},$T._getMeshRenderSharedMaterialSecondScrollSpeedX=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $H.meshRender.sharedMaterial.secondScrollSpeedX},$T._setMeshRenderSharedMaterialSecondScrollSpeedX=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.secondScrollSpeedX=$I[0])}else $H.meshRender.material.secondScrollSpeedX=$I[0]},$T._getMeshRenderSharedMaterialSecondScrollSpeedY=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $H.meshRender.sharedMaterial.secondScrollSpeedY},$T._setMeshRenderSharedMaterialSecondScrollSpeedY=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.secondScrollSpeedY=$I[0])}else $H.meshRender.material.secondScrollSpeedY=$I[0]},$T._getMeshRenderSharedMaterialAlpha=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.alpha:0}return $H.meshRender.sharedMaterial.alpha},$T._setMeshRenderSharedMaterialAlpha=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.alpha=$I[0])}else $H.meshRender.material.alpha=$I[0]},$T._getMeshRenderSharedMaterialIntensity=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.intensity:0}return $H.meshRender.sharedMaterial.intensity},$T._setMeshRenderSharedMaterialIntensity=function($t,$H,$I){if($t){var $T=$t.transform._entity;$T&&($T.owner.meshRender.material.intensity=$I[0])}else $H.meshRender.material.intensity=$I[0]},$T._getMeshRenderSharedMaterialDetailTilingOffset=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $H.meshRender.sharedMaterial.detailTilingOffset.elements},$T._setMeshRenderSharedMaterialDetailTilingOffset=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).detailTilingOffset).elements=$I,$T.detailTilingOffset=$K)}else($K=($T=$H.meshRender.material).detailTilingOffset).elements=$I,$T.detailTilingOffset=$K},$T._getMeshRenderSharedMaterialDissolveTilingOffset=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $H.meshRender.sharedMaterial.dissolveTilingOffset.elements},$T._setMeshRenderSharedMaterialDissolveTilingOffset=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).dissolveTilingOffset).elements=$I,$T.dissolveTilingOffset=$K)}else($K=($T=$H.meshRender.material).dissolveTilingOffset).elements=$I,$T.dissolveTilingOffset=$K},$T._getMeshRenderSharedMaterialMaskTilingOffset=function($t,$H){if($t){var $I=$t.transform._entity;return $I?$I.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $H.meshRender.sharedMaterial.maskTilingOffset.elements},$T._setMeshRenderSharedMaterialMaskTilingOffset=function($t,$H,$I){var $T,$K;if($t){var $_=$t.transform._entity;$_&&(($K=($T=$_.owner.meshRender.material).maskTilingOffset).elements=$I,$T.maskTilingOffset=$K)}else($K=($T=$H.meshRender.material).maskTilingOffset).elements=$I,$T.maskTilingOffset=$K},$T._propertyIDCounter=0,$T._propertyIndexDic={},$T._propertySetFuncs=[],$T._propertyGetFuncs=[],$T}(),$a=function(){function $t(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $L($t,"laya.d3.animation.Keyframe"),$t}(),$u=function(){function $t(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $L($t,"laya.d3.animation.KeyframeNode"),$t}(),$p=(function(){function $t(){this._tempVector30=new $VH,this._tempVector31=new $VH,this._tempVector32=new $VH,this._a=new $VH,this._b=new $VH,this._c=new $VH,this._d=new $VH}$L($t,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $H=$t.prototype;$H.Init=function($t,$H,$I,$T){$t.cloneTo(this._d),$H.cloneTo(this._c),$VH.scale($t,2,this._a),$VH.scale($I,2,this._tempVector30),$VH.subtract(this._a,this._tempVector30,this._a),$VH.add(this._a,$H,this._a),$VH.add(this._a,$T,this._a),$VH.scale($I,3,this._b),$VH.scale($t,3,this._tempVector30),$VH.subtract(this._b,this._tempVector30,this._b),$VH.subtract(this._b,$T,this._b),$VH.scale($H,2,this._tempVector30),$VH.subtract(this._b,this._tempVector30,this._b)},$H.Slerp=function($t,$H){$VH.scale(this._a,$t*$t*$t,this._tempVector30),$VH.scale(this._b,$t*$t,this._tempVector31),$VH.scale(this._c,$t,this._tempVector32),$VH.add(this._tempVector30,this._tempVector31,$H),$VH.add($H,this._tempVector32,$H),$VH.add($H,this._d,$H)}}(),function(){function $y($t,$H,$I,$T){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$t,this._h=$H,this._minHeight=$I,this._maxHeight=$T}$L($y,"laya.d3.core.HeightMap");var $t=$y.prototype;$t._inBounds=function($t,$H){return 0<=$t&&$t<this._h&&0<=$H&&$H<this._w},$t.getHeight=function($t,$H){return this._inBounds($t,$H)?this._datas[$t][$H]:NaN},$G(0,$t,"width",function(){return this._w}),$G(0,$t,"height",function(){return this._h}),$G(0,$t,"maxHeight",function(){return this._maxHeight}),$G(0,$t,"minHeight",function(){return this._minHeight}),$y.creatFromMesh=function($t,$H,$I,$T){for(var $K=[],$_=[],$V=$t.getSubMeshCount(),$e=0;$e<$V;$e++){for(var $R=$t.getSubMesh($e),$A=$R._getVertexBuffer(),$q=$A.getData(),$f=[],$b=0;$b<$q.length;$b+=$A.vertexDeclaration.vertexStride/4){var $L=new $VH($q[$b+0],$q[$b+1],$q[$b+2]);$f.push($L)}$K.push($f);var $G=$R._getIndexBuffer();$_.push($G.getData())}var $M=$t.boundingBox,$O=$M.min.x,$J=$M.min.z,$S=$M.max.x,$U=$M.max.z,$C=$M.min.y,$N=$M.max.y,$w=$S-$O,$W=$U-$J,$s=$T.elements[0]=$w/($H-1),$z=$T.elements[1]=$W/($I-1),$P=new $y($H,$I,$C,$N),$k=$y._tempRay,$r=$k.direction.elements;$r[0]=0,$r[1]=-1,$r[2]=0;var $x=$N+.1;$k.origin.elements[1]=$x;for(var $Y=0;$Y<$I;$Y++){var $D=$J+$Y*$z;$P._datas[$Y]=[];for(var $p=0;$p<$H;$p++){var $g=$O+$p*$s,$l=$k.origin.elements;$l[0]=$g,$l[2]=$D;var $v=$y._getPosition($k,$K,$_);$P._datas[$Y][$p]=$v===Number.MAX_VALUE?NaN:$x-$v}}return $P},$y.createFromImage=function($t,$H,$I){for(var $T=$t.width,$K=$t.height,$_=new $y($T,$K,$H,$I),$V=($I-$H)/254,$e=$t.getPixels(),$R=0,$A=0;$A<$K;$A++)for(var $q=$_._datas[$A]=[],$f=0;$f<$T;$f++){var $b=$e[$R++],$L=$e[$R++],$G=$e[$R++],$M=$e[$R++];$q[$f]=255==$b&&255==$L&&255==$G&&255==$M?NaN:($b+$L+$G)/3*$V+$H}return $_},$y._getPosition=function($t,$H,$I){for(var $T=Number.MAX_VALUE,$K=0;$K<$H.length;$K++)for(var $_=$H[$K],$V=$I[$K],$e=0;$e<$V.length;$e+=3){var $R=$_[$V[$e+0]],$A=$_[$V[$e+1]],$q=$_[$V[$e+2]],$f=$GH.rayIntersectsTriangle($t,$R,$A,$q);!isNaN($f)&&$f<$T&&($T=$f)}return $T},$f($y,["_tempRay",function(){return this._tempRay=new $KH(new $VH,new $VH)}])}(),function(){function $K(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$L($K,"laya.d3.core.Layer");var $t=$K.prototype;return $t._binarySearchIndex=function(){for(var $t=0,$H=$K._collsionTestList.length-1,$I=0;$t<=$H;){$I=Math.floor(($t+$H)/2);var $T=$K._collsionTestList[$I];if($T==this._number)return $I;$T>this._number?$H=$I-1:$t=$I+1}return $t},$t._addCollider=function($t){0===this._colliders.length&&$K._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$t._isRigidbody?(this._colliders.unshift($t),this._nonRigidbodyOffset++):this._colliders.push($t)},$t._removeCollider=function($t){var $H=this._colliders.indexOf($t);$H<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($H,1),0===this._colliders.length&&$K._collsionTestList.splice($K._collsionTestList.indexOf(this._number),1)},$G(0,$t,"number",function(){return this._number}),$G(0,$t,"visible",function(){return this._visible},function($t){this._visible=$t,$K._visibleLayers=$t?$K._visibleLayers|this.mask:$K._visibleLayers&~this.mask}),$G(0,$t,"mask",function(){return this._mask}),$G(1,$K,"visibleLayers",function(){return $K._visibleLayers},function($t){$K._visibleLayers=$t;for(var $H=0,$I=$K._layerList.length;$H<$I;$H++){var $T=$K._layerList[$H];$T._visible=0!=($T._mask&$K._visibleLayers)}}),$K.__init__=function(){$K._layerList.length=31;for(var $t=0;$t<31;$t++){var $H=new $K;$K._layerList[$t]=$H,0===$t?($H.name="Default Layer",$H.visible=!0):($H.name="Layer-"+$t,$H.visible=!1),$H._number=$t,$H._mask=Math.pow(2,$t)}$K.currentCreationLayer=$K._layerList[0]},$K.getLayerByNumber=function($t){if($t<0||30<$t)throw new Error("无法返回指定Layer，该number超出范围！");return $K._layerList[$t]},$K.getLayerByName=function($t){for(var $H=0;$H<31;$H++)if($K._layerList[$H].name===$t)return $K._layerList[$H];throw new Error("无法返回指定Layer,该name不存在")},$K.isVisible=function($t){return 0!=($t&$K._currentCameraCullingMask&$K._visibleLayers)},$K._layerList=[],$K._visibleLayers=2147483647,$K._collsionTestList=[],$K._currentCameraCullingMask=2147483647,$K.maxCount=31,$K.currentCreationLayer=null,$K}()),$g=(function(){function $t($t,$H,$I){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$t,this._minCount=$H,this._maxCount=$I}$L($t,"laya.d3.core.particleShuriKen.module.Burst");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.cloneTo=function($t){var $H=$t;$H._time=this._time,$H._minCount=this._minCount,$H._maxCount=this._maxCount},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"time",function(){return this._time}),$G(0,$H,"minCount",function(){return this._minCount}),$G(0,$H,"maxCount",function(){return this._maxCount})}(),function(){function $t($t){this._color=null,this.enbale=!1,this._color=$t}$L($t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $H=$t.prototype;$H.cloneTo=function($t){var $H=$t;this._color.cloneTo($H._color),$H.enbale=this.enbale},$H.clone=function(){var $t;switch(this._color.type){case 0:$t=$v.createByConstant(this._color.constant.clone());break;case 1:$t=$v.createByGradient(this._color.gradient.clone());break;case 2:$t=$v.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$t=$v.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $H=new this.constructor($t);return $H.enbale=this.enbale,$H},$G(0,$H,"color",function(){return this._color})}(),function(){function $t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$L($t,"laya.d3.core.particleShuriKen.module.Emission");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$H._destroy=function(){this._bursts=null,this._destroyed=!0},$H.getBurstsCount=function(){return this._bursts.length},$H.getBurstByIndex=function($t){return this._bursts[$t]},$H.addBurst=function($t){var $H=this._bursts.length;if(0<$H)for(var $I=0;$I<$H;$I++)this._bursts[$I].time>$t.time&&this._bursts.splice($I,0,$t);this._bursts.push($t)},$H.removeBurst=function($t){var $H=this._bursts.indexOf($t);-1!==$H&&this._bursts.splice($H,1)},$H.removeBurstByIndex=function($t){this._bursts.splice($t,1)},$H.clearBurst=function(){this._bursts.length=0},$H.cloneTo=function($t){var $H=$t,$I=$H._bursts;$I.length=this._bursts.length;for(var $T=0,$K=this._bursts.length;$T<$K;$T++){var $_=$I[$T];$_?this._bursts[$T].cloneTo($_):$I[$T]=this._bursts[$T].clone()}$H._emissionRate=this._emissionRate,$H.enbale=this.enbale},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"destroyed",function(){return this._destroyed}),$G(0,$H,"emissionRate",function(){return this._emissionRate},function($t){if($t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$t})}(),function(){function $T(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$L($T,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $t=$T.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.cloneTo=function($t){var $H=$t;$H._type=this._type,$H._constant=this._constant,this._overTime.cloneTo($H._overTime),$H._constantMin=this._constantMin,$H._constantMax=this._constantMax,this._overTimeMin.cloneTo($H._overTimeMin),this._overTimeMax.cloneTo($H._overTimeMax)},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$t,"frameOverTimeData",function(){return this._overTime}),$G(0,$t,"constant",function(){return this._constant}),$G(0,$t,"type",function(){return this._type}),$G(0,$t,"frameOverTimeDataMin",function(){return this._overTimeMin}),$G(0,$t,"constantMin",function(){return this._constantMin}),$G(0,$t,"frameOverTimeDataMax",function(){return this._overTimeMax}),$G(0,$t,"constantMax",function(){return this._constantMax}),$T.createByConstant=function($t){var $H=new $T;return $H._type=0,$H._constant=$t,$H},$T.createByOverTime=function($t){var $H=new $T;return $H._type=1,$H._overTime=$t,$H},$T.createByRandomTwoConstant=function($t,$H){var $I=new $T;return $I._type=2,$I._constantMin=$t,$I._constantMax=$H,$I},$T.createByRandomTwoOverTime=function($t,$H){var $I=new $T;return $I._type=3,$I._overTimeMin=$t,$I._overTimeMax=$H,$I},$T}()),$l=function(){function $A(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$L($A,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $t=$A.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.cloneTo=function($t){var $H=$t;$H._type=this._type,$H._separateAxes=this._separateAxes,$H._constant=this._constant,this._constantSeparate.cloneTo($H._constantSeparate),this._gradient.cloneTo($H._gradient),this._gradientX.cloneTo($H._gradientX),this._gradientY.cloneTo($H._gradientY),this._gradientZ.cloneTo($H._gradientZ),$H._constantMin=this._constantMin,$H._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($H._constantMinSeparate),this._constantMaxSeparate.cloneTo($H._constantMaxSeparate),this._gradientMin.cloneTo($H._gradientMin),this._gradientMax.cloneTo($H._gradientMax),this._gradientXMin.cloneTo($H._gradientXMin),this._gradientXMax.cloneTo($H._gradientXMax),this._gradientYMin.cloneTo($H._gradientYMin),this._gradientYMax.cloneTo($H._gradientYMax),this._gradientZMin.cloneTo($H._gradientZMin),this._gradientZMax.cloneTo($H._gradientZMax)},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$t,"gradientZ",function(){return this._gradientZ}),$G(0,$t,"constant",function(){return this._constant}),$G(0,$t,"gradient",function(){return this._gradient}),$G(0,$t,"separateAxes",function(){return this._separateAxes}),$G(0,$t,"type",function(){return this._type}),$G(0,$t,"constantSeparate",function(){return this._constantSeparate}),$G(0,$t,"gradientX",function(){return this._gradientX}),$G(0,$t,"gradientY",function(){return this._gradientY}),$G(0,$t,"gradientW",function(){return this._gradientW}),$G(0,$t,"gradientMin",function(){return this._gradientMin}),$G(0,$t,"constantMin",function(){return this._constantMin}),$G(0,$t,"gradientMax",function(){return this._gradientMax}),$G(0,$t,"constantMax",function(){return this._constantMax}),$G(0,$t,"gradientWMin",function(){return this._gradientWMin}),$G(0,$t,"constantMinSeparate",function(){return this._constantMinSeparate}),$G(0,$t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$G(0,$t,"gradientXMin",function(){return this._gradientXMin}),$G(0,$t,"gradientXMax",function(){return this._gradientXMax}),$G(0,$t,"gradientWMax",function(){return this._gradientWMax}),$G(0,$t,"gradientYMin",function(){return this._gradientYMin}),$G(0,$t,"gradientYMax",function(){return this._gradientYMax}),$G(0,$t,"gradientZMin",function(){return this._gradientZMin}),$G(0,$t,"gradientZMax",function(){return this._gradientZMax}),$A.createByConstant=function($t){var $H=new $A;return $H._type=0,$H._separateAxes=!1,$H._constant=$t,$H},$A.createByConstantSeparate=function($t){var $H=new $A;return $H._type=0,$H._separateAxes=!0,$H._constantSeparate=$t,$H},$A.createByGradient=function($t){var $H=new $A;return $H._type=1,$H._separateAxes=!1,$H._gradient=$t,$H},$A.createByGradientSeparate=function($t,$H,$I,$T){var $K=new $A;return $K._type=1,$K._separateAxes=!0,$K._gradientX=$t,$K._gradientY=$H,$K._gradientZ=$I,$K._gradientW=$T,$K},$A.createByRandomTwoConstant=function($t,$H){var $I=new $A;return $I._type=2,$I._separateAxes=!1,$I._constantMin=$t,$I._constantMax=$H,$I},$A.createByRandomTwoConstantSeparate=function($t,$H){var $I=new $A;return $I._type=2,$I._separateAxes=!0,$I._constantMinSeparate=$t,$I._constantMaxSeparate=$H,$I},$A.createByRandomTwoGradient=function($t,$H){var $I=new $A;return $I._type=3,$I._separateAxes=!1,$I._gradientMin=$t,$I._gradientMax=$H,$I},$A.createByRandomTwoGradientSeparate=function($t,$H,$I,$T,$K,$_,$V,$e){var $R=new $A;return $R._type=3,$R._separateAxes=!0,$R._gradientXMin=$t,$R._gradientXMax=$H,$R._gradientYMin=$I,$R._gradientYMax=$T,$R._gradientZMin=$K,$R._gradientZMax=$_,$R._gradientWMin=$V,$R._gradientWMax=$e,$R},$A}(),$v=function(){function $T(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$L($T,"laya.d3.core.particleShuriKen.module.GradientColor");var $t=$T.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.cloneTo=function($t){var $H=$t;$H._type=this._type,this._constant.cloneTo($H._constant),this._constantMin.cloneTo($H._constantMin),this._constantMax.cloneTo($H._constantMax),this._gradient.cloneTo($H._gradient),this._gradientMin.cloneTo($H._gradientMin),this._gradientMax.cloneTo($H._gradientMax)},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$t,"gradient",function(){return this._gradient}),$G(0,$t,"constant",function(){return this._constant}),$G(0,$t,"type",function(){return this._type}),$G(0,$t,"gradientMin",function(){return this._gradientMin}),$G(0,$t,"constantMin",function(){return this._constantMin}),$G(0,$t,"gradientMax",function(){return this._gradientMax}),$G(0,$t,"constantMax",function(){return this._constantMax}),$T.createByConstant=function($t){var $H=new $T;return $H._type=0,$H._constant=$t,$H},$T.createByGradient=function($t){var $H=new $T;return $H._type=1,$H._gradient=$t,$H},$T.createByRandomTwoConstant=function($t,$H){var $I=new $T;return $I._type=2,$I._constantMin=$t,$I._constantMax=$H,$I},$T.createByRandomTwoGradient=function($t,$H){var $I=new $T;return $I._type=3,$I._gradientMin=$t,$I._gradientMax=$H,$I},$T}(),$y=(function(){function $t(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$L($t,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.addAlpha=function($t,$H){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$t&&($t=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$t,this._alphaElements[this._alphaCurrentLength++]=$H):DEBUG},$H.addRGB=function($t,$H){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$t&&($t=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$t,this._rgbElements[this._rgbCurrentLength++]=$H.x,this._rgbElements[this._rgbCurrentLength++]=$H.y,this._rgbElements[this._rgbCurrentLength++]=$H.z):DEBUG},$H.cloneTo=function($t){var $H=$t,$I=0,$T=0;$H._alphaCurrentLength=this._alphaCurrentLength;var $K=$H._alphaElements;for($K.length=this._alphaElements.length,$I=0,$T=this._alphaElements.length;$I<$T;$I++)$K[$I]=this._alphaElements[$I];$H._rgbCurrentLength=this._rgbCurrentLength;var $_=$H._rgbElements;for($_.length=this._rgbElements.length,$I=0,$T=this._rgbElements.length;$I<$T;$I++)$_[$I]=this._rgbElements[$I]},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$G(0,$H,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$L($t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.add=function($t,$H){this._currentLength<8?(6===this._currentLength&&1!==$t&&($t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$t,this._elements[this._currentLength++]=$H):console.log("Warning:data count must lessEqual than 4")},$H.cloneTo=function($t){var $H=$t;$H._currentLength=this._currentLength;var $I=$H._elements;$I.length=this._elements.length;for(var $T=0,$K=this._elements.length;$T<$K;$T++)$I[$T]=this._elements[$T]},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"gradientCount",function(){return this._currentLength/2})}(),function(){function $t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$L($t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.add=function($t,$H){this._currentLength<8?(6===this._currentLength&&1!==$t&&($t=1,DEBUG),this._elements[this._currentLength++]=$t,this._elements[this._currentLength++]=$H):DEBUG},$H.getKeyByIndex=function($t){return this._elements[2*$t]},$H.getValueByIndex=function($t){return this._elements[2*$t+1]},$H.getAverageValue=function(){for(var $t=0,$H=this._currentLength-2;$t<$H;$t+=2){this._elements[$t+1];this._elements[$t+3],this._elements[$t+2]-this._elements[$t]}return 0},$H.cloneTo=function($t){var $H=$t;$H._currentLength=this._currentLength;var $I=$H._elements;$I.length=this._elements.length;for(var $T=0,$K=this._elements.length;$T<$K;$T++)$I[$T]=this._elements[$T]},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"gradientCount",function(){return this._currentLength/2})}(),function(){function $t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$L($t,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.add=function($t,$H){this._currentLength<8?(6===this._currentLength&&1!==$t&&($t=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$t,this._elements[this._currentLength++]=$H.x,this._elements[this._currentLength++]=$H.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$H.cloneTo=function($t){var $H=$t;$H._currentLength=this._currentLength;var $I=$H._elements;$I.length=this._elements.length;for(var $T=0,$K=this._elements.length;$T<$K;$T++)$I[$T]=this._elements[$T]},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"gradientCount",function(){return this._currentLength/3})}(),function(){function $e(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$L($e,"laya.d3.core.particleShuriKen.module.GradientSize");var $t=$e.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.getMaxSizeInGradient=function(){var $t=0,$H=0,$I=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($t=0,$H=this._gradientX.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientX.getValueByIndex($t));for($t=0,$H=this._gradientY.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientY.getValueByIndex($t))}else for($t=0,$H=this._gradient.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradient.getValueByIndex($t));break;case 1:$I=this._separateAxes?($I=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$I=Math.max($I,this._constantMinSeparate.y),Math.max($I,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($t=0,$H=this._gradientXMin.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientXMin.getValueByIndex($t));for($t=0,$H=this._gradientXMax.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientXMax.getValueByIndex($t));for($t=0,$H=this._gradientYMin.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientYMin.getValueByIndex($t));for($t=0,$H=this._gradientZMax.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientZMax.getValueByIndex($t))}else{for($t=0,$H=this._gradientMin.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientMin.getValueByIndex($t));for($t=0,$H=this._gradientMax.gradientCount;$t<$H;$t++)$I=Math.max($I,this._gradientMax.getValueByIndex($t))}}return $I},$t.cloneTo=function($t){var $H=$t;$H._type=this._type,$H._separateAxes=this._separateAxes,this._gradient.cloneTo($H._gradient),this._gradientX.cloneTo($H._gradientX),this._gradientY.cloneTo($H._gradientY),this._gradientZ.cloneTo($H._gradientZ),$H._constantMin=this._constantMin,$H._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($H._constantMinSeparate),this._constantMaxSeparate.cloneTo($H._constantMaxSeparate),this._gradientMin.cloneTo($H._gradientMin),this._gradientMax.cloneTo($H._gradientMax),this._gradientXMin.cloneTo($H._gradientXMin),this._gradientXMax.cloneTo($H._gradientXMax),this._gradientYMin.cloneTo($H._gradientYMin),this._gradientYMax.cloneTo($H._gradientYMax),this._gradientZMin.cloneTo($H._gradientZMin),this._gradientZMax.cloneTo($H._gradientZMax)},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$t,"gradientZ",function(){return this._gradientZ}),$G(0,$t,"gradient",function(){return this._gradient}),$G(0,$t,"separateAxes",function(){return this._separateAxes}),$G(0,$t,"type",function(){return this._type}),$G(0,$t,"gradientMin",function(){return this._gradientMin}),$G(0,$t,"constantMin",function(){return this._constantMin}),$G(0,$t,"gradientX",function(){return this._gradientX}),$G(0,$t,"gradientY",function(){return this._gradientY}),$G(0,$t,"gradientMax",function(){return this._gradientMax}),$G(0,$t,"constantMax",function(){return this._constantMax}),$G(0,$t,"constantMinSeparate",function(){return this._constantMinSeparate}),$G(0,$t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$G(0,$t,"gradientXMin",function(){return this._gradientXMin}),$G(0,$t,"gradientXMax",function(){return this._gradientXMax}),$G(0,$t,"gradientYMin",function(){return this._gradientYMin}),$G(0,$t,"gradientYMax",function(){return this._gradientYMax}),$G(0,$t,"gradientZMin",function(){return this._gradientZMin}),$G(0,$t,"gradientZMax",function(){return this._gradientZMax}),$e.createByGradient=function($t){var $H=new $e;return $H._type=0,$H._separateAxes=!1,$H._gradient=$t,$H},$e.createByGradientSeparate=function($t,$H,$I){var $T=new $e;return $T._type=0,$T._separateAxes=!0,$T._gradientX=$t,$T._gradientY=$H,$T._gradientZ=$I,$T},$e.createByRandomTwoConstant=function($t,$H){var $I=new $e;return $I._type=1,$I._separateAxes=!1,$I._constantMin=$t,$I._constantMax=$H,$I},$e.createByRandomTwoConstantSeparate=function($t,$H){var $I=new $e;return $I._type=1,$I._separateAxes=!0,$I._constantMinSeparate=$t,$I._constantMaxSeparate=$H,$I},$e.createByRandomTwoGradient=function($t,$H){var $I=new $e;return $I._type=2,$I._separateAxes=!1,$I._gradientMin=$t,$I._gradientMax=$H,$I},$e.createByRandomTwoGradientSeparate=function($t,$H,$I,$T,$K,$_){var $V=new $e;return $V._type=2,$V._separateAxes=!0,$V._gradientXMin=$t,$V._gradientXMax=$H,$V._gradientYMin=$I,$V._gradientYMax=$T,$V._gradientZMin=$K,$V._gradientZMax=$_,$V},$e}()),$E=function(){function $e(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$L($e,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $t=$e.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.cloneTo=function($t){var $H=$t;$H._type=this._type,this._constant.cloneTo($H._constant),this._gradientX.cloneTo($H._gradientX),this._gradientY.cloneTo($H._gradientY),this._gradientZ.cloneTo($H._gradientZ),this._constantMin.cloneTo($H._constantMin),this._constantMax.cloneTo($H._constantMax),this._gradientXMin.cloneTo($H._gradientXMin),this._gradientXMax.cloneTo($H._gradientXMax),this._gradientYMin.cloneTo($H._gradientYMin),this._gradientYMax.cloneTo($H._gradientYMax),this._gradientZMin.cloneTo($H._gradientZMin),this._gradientZMax.cloneTo($H._gradientZMax)},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$t,"gradientZ",function(){return this._gradientZ}),$G(0,$t,"constant",function(){return this._constant}),$G(0,$t,"type",function(){return this._type}),$G(0,$t,"gradientXMax",function(){return this._gradientXMax}),$G(0,$t,"constantMin",function(){return this._constantMin}),$G(0,$t,"gradientX",function(){return this._gradientX}),$G(0,$t,"gradientY",function(){return this._gradientY}),$G(0,$t,"gradientXMin",function(){return this._gradientXMin}),$G(0,$t,"constantMax",function(){return this._constantMax}),$G(0,$t,"gradientYMin",function(){return this._gradientYMin}),$G(0,$t,"gradientYMax",function(){return this._gradientYMax}),$G(0,$t,"gradientZMin",function(){return this._gradientZMin}),$G(0,$t,"gradientZMax",function(){return this._gradientZMax}),$e.createByConstant=function($t){var $H=new $e;return $H._type=0,$H._constant=$t,$H},$e.createByGradient=function($t,$H,$I){var $T=new $e;return $T._type=1,$T._gradientX=$t,$T._gradientY=$H,$T._gradientZ=$I,$T},$e.createByRandomTwoConstant=function($t,$H){var $I=new $e;return $I._type=2,$I._constantMin=$t,$I._constantMax=$H,$I},$e.createByRandomTwoGradient=function($t,$H,$I,$T,$K,$_){var $V=new $e;return $V._type=3,$V._gradientXMin=$t,$V._gradientXMax=$H,$V._gradientYMin=$I,$V._gradientYMax=$T,$V._gradientZMin=$K,$V._gradientZMax=$_,$V},$e}(),$h=(function(){function $t($t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$t}$L($t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.cloneTo=function($t){var $H=$t;this._angularVelocity.cloneTo($H._angularVelocity),$H.enbale=this.enbale},$H.clone=function(){var $t;switch(this._angularVelocity.type){case 0:$t=this._angularVelocity.separateAxes?$l.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$l.createByConstant(this._angularVelocity.constant);break;case 1:$t=this._angularVelocity.separateAxes?$l.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$l.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$t=this._angularVelocity.separateAxes?$l.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$l.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$t=this._angularVelocity.separateAxes?$l.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$l.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $H=new this.constructor($t);return $H.enbale=this.enbale,$H},$G(0,$H,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $t(){this.enable=!1,this.randomDirection=!1}$L($t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $H=$t.prototype;return $N.imps($H,{"laya.d3.core.IClone":!0}),$H._getShapeBoundBox=function($t){throw new Error("BaseShape: must override it.")},$H._getSpeedBoundBox=function($t){throw new Error("BaseShape: must override it.")},$H.generatePositionAndDirection=function($t,$H,$I,$T){throw new Error("BaseShape: must override it.")},$H._calculateProceduralBounds=function($t,$H,$I){this._getShapeBoundBox($t);var $T=$t.min,$K=$t.max;$VH.multiply($T,$H,$T),$VH.multiply($K,$H,$K);var $_=new $ct(new $VH,new $VH);this.randomDirection?($_.min=new $VH(-1,-1,-1),$_.max=new $VH(1,1,1)):this._getSpeedBoundBox($_);var $V=new $ct(new $VH,new $VH),$e=$V.min,$R=$V.max;$VH.scale($_.min,$I.y,$e),$VH.scale($_.max,$I.y,$R),$VH.add($t.min,$e,$e),$VH.add($t.max,$R,$R),$VH.min($t.min,$e,$t.min),$VH.max($t.max,$e,$t.max);var $A=new $ct(new $VH,new $VH),$q=$A.min,$f=$A.max;$VH.scale($_.min,$I.x,$q),$VH.scale($_.max,$I.x,$f),$VH.min($A.min,$f,$e),$VH.max($A.min,$f,$R),$VH.min($t.min,$e,$t.min),$VH.max($t.max,$e,$t.max)},$H.cloneTo=function($t){$t.enable=this.enable},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$t}()),$$=function(){function $_(){}return $L($_,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$_._randomPointUnitArcCircle=function($t,$H,$I){var $T=$H.elements,$K=NaN;$K=$I?$I.getFloat()*$t:Math.random()*$t,$T[0]=Math.cos($K),$T[1]=Math.sin($K)},$_._randomPointInsideUnitArcCircle=function($t,$H,$I){var $T=$H.elements;$_._randomPointUnitArcCircle($t,$H,$I);var $K=NaN;$K=$I?Math.pow($I.getFloat(),.5):Math.pow(Math.random(),.5),$T[0]=$T[0]*$K,$T[1]=$T[1]*$K},$_._randomPointUnitCircle=function($t,$H){var $I=$t.elements,$T=NaN;$T=$H?$H.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$I[0]=Math.cos($T),$I[1]=Math.sin($T)},$_._randomPointInsideUnitCircle=function($t,$H){var $I=$t.elements;$_._randomPointUnitCircle($t);var $T=NaN;$T=$H?Math.pow($H.getFloat(),.5):Math.pow(Math.random(),.5),$I[0]=$I[0]*$T,$I[1]=$I[1]*$T},$_._randomPointUnitSphere=function($t,$H){var $I=$t.elements,$T=NaN,$K=NaN;$K=$H?($T=$I[2]=2*$H.getFloat()-1,$H.getFloat()*Math.PI*2):($T=$I[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $_=Math.sqrt(1-$T*$T);$I[0]=$_*Math.cos($K),$I[1]=$_*Math.sin($K)},$_._randomPointInsideUnitSphere=function($t,$H){var $I=$t.elements;$_._randomPointUnitSphere($t);var $T=NaN;$T=$H?Math.pow($H.getFloat(),1/3):Math.pow(Math.random(),1/3),$I[0]=$I[0]*$T,$I[1]=$I[1]*$T,$I[2]=$I[2]*$T},$_._randomPointInsideHalfUnitBox=function($t,$H){var $I=$t.elements;$H?($I[0]=$H.getFloat()-.5,$I[1]=$H.getFloat()-.5,$I[2]=$H.getFloat()-.5):($I[0]=Math.random()-.5,$I[1]=Math.random()-.5,$I[2]=Math.random()-.5)},$_}(),$Q=(function(){function $t($t){this._size=null,this.enbale=!1,this._size=$t}$L($t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.cloneTo=function($t){var $H=$t;this._size.cloneTo($H._size),$H.enbale=this.enbale},$H.clone=function(){var $t;switch(this._size.type){case 0:$t=this._size.separateAxes?$y.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$y.createByGradient(this._size.gradient.clone());break;case 1:$t=this._size.separateAxes?$y.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$y.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$t=this._size.separateAxes?$y.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$y.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $H=new this.constructor($t);return $H.enbale=this.enbale,$H},$G(0,$H,"size",function(){return this._size})}(),function(){function $T(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$L($T,"laya.d3.core.particleShuriKen.module.StartFrame");var $t=$T.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.cloneTo=function($t){var $H=$t;$H._type=this._type,$H._constant=this._constant,$H._constantMin=this._constantMin,$H._constantMax=this._constantMax},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$t,"constant",function(){return this._constant}),$G(0,$t,"type",function(){return this._type}),$G(0,$t,"constantMin",function(){return this._constantMin}),$G(0,$t,"constantMax",function(){return this._constantMax}),$T.createByConstant=function($t){var $H=new $T;return $H._type=0,$H._constant=$t,$H},$T.createByRandomTwoConstant=function($t,$H){var $I=new $T;return $I._type=1,$I._constantMin=$t,$I._constantMax=$H,$I},$T}()),$m=(function(){function $t($t,$H){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $_H(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$t,this._startFrame=$H}$L($t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.cloneTo=function($t){var $H=$t;this.tiles.cloneTo($H.tiles),$H.type=this.type,$H.randomRow=this.randomRow,this._frame.cloneTo($H._frame),this._startFrame.cloneTo($H._startFrame),$H.cycles=this.cycles,$H.enableUVChannels=this.enableUVChannels,$H.enable=this.enable},$H.clone=function(){var $t,$H;switch(this._frame.type){case 0:$t=$g.createByConstant(this._frame.constant);break;case 1:$t=$g.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$t=$g.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$t=$g.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$H=$Q.createByConstant(this._startFrame.constant);break;case 1:$H=$Q.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $I=new this.constructor($t,$H);return this.tiles.cloneTo($I.tiles),$I.type=this.type,$I.randomRow=this.randomRow,$I.cycles=this.cycles,$I.enableUVChannels=this.enableUVChannels,$I.enable=this.enable,$I},$G(0,$H,"frame",function(){return this._frame}),$G(0,$H,"startFrame",function(){return this._startFrame})}(),function(){function $t($t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$t}$L($t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $H=$t.prototype;$N.imps($H,{"laya.d3.core.IClone":!0}),$H.cloneTo=function($t){var $H=$t;this._velocity.cloneTo($H._velocity),$H.enbale=this.enbale,$H.space=this.space},$H.clone=function(){var $t;switch(this._velocity.type){case 0:$t=$E.createByConstant(this._velocity.constant.clone());break;case 1:$t=$E.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$t=$E.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$t=$E.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $H=new this.constructor($t);return $H.enbale=this.enbale,$H.space=this.space,$H},$G(0,$H,"velocity",function(){return this._velocity})}(),function(){function $t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $bH,this._vb=$hH.create($t._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$EH.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$vH.nameKey.getID("LINE"),this._shaderCompile=$sH._preCompileShader[this._sharderNameID]}$L($t,"laya.d3.core.PhasorSpriter3D");var $H=$t.prototype;return $H.line=function($t,$H,$I,$T){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($t.x,$t.y,$t.z,$H.x,$H.y,$H.z,$H.w),this.addVertex($I.x,$I.y,$I.z,$T.x,$T.y,$T.z,$T.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$H.circle=function($t,$H,$I,$T,$K,$_){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$H,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$H,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$t,Math.cos(this._tempNumver0)*$t,0,$I,$T,$K,$_),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$H.plane=function($t,$H,$I,$T,$K,$_,$V,$e,$R){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$T/2,this._tempNumver1=$K/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($t-this._tempNumver0,$H+this._tempNumver1,$I,$_,$V,$e,$R),this.addVertex($t+this._tempNumver0,$H+this._tempNumver1,$I,$_,$V,$e,$R),this.addVertex($t-this._tempNumver0,$H-this._tempNumver1,$I,$_,$V,$e,$R),this.addVertex($t+this._tempNumver0,$H-this._tempNumver1,$I,$_,$V,$e,$R),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$H.box=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$T/2,this._tempNumver1=$K/2,this._tempNumver2=$_/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($t-this._tempNumver0,$H+this._tempNumver1,$I+this._tempNumver2,$V,$e,$R,$A),this.addVertex($t+this._tempNumver0,$H+this._tempNumver1,$I+this._tempNumver2,$V,$e,$R,$A),this.addVertex($t-this._tempNumver0,$H-this._tempNumver1,$I+this._tempNumver2,$V,$e,$R,$A),this.addVertex($t+this._tempNumver0,$H-this._tempNumver1,$I+this._tempNumver2,$V,$e,$R,$A),this.addVertex($t+this._tempNumver0,$H+this._tempNumver1,$I-this._tempNumver2,$V,$e,$R,$A),this.addVertex($t-this._tempNumver0,$H+this._tempNumver1,$I-this._tempNumver2,$V,$e,$R,$A),this.addVertex($t+this._tempNumver0,$H-this._tempNumver1,$I-this._tempNumver2,$V,$e,$R,$A),this.addVertex($t-this._tempNumver0,$H-this._tempNumver1,$I-this._tempNumver2,$V,$e,$R,$A),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$H.cone=function($t,$H,$I,$T,$K,$_,$V){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$I+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$I>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$I,this.addVertexIndex(0,$H,0,$T,$K,$_,$V,this._tempUint0),this.addVertexIndex(0,0,0,$T,$K,$_,$V,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$I;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($t*this._tempNumver2,0,$t*this._tempNumver3,$T,$K,$_,$V,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$I-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($t*this._tempNumver2,0,$t*this._tempNumver3,$T,$K,$_,$V,this._tempUint0+(this._tempInt0+$I)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$I-1?this.addIndexes(this._tempUint1+$I+2):this.addIndexes(this._tempUint1+this._tempInt0+$I+1),this.addIndexes(this._tempUint1+this._tempInt0+$I),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$H.boundingBoxLine=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($t,$K,$_,$V,$e,$R,$A),this.addVertex($T,$K,$_,$V,$e,$R,$A),this.addVertex($t,$H,$_,$V,$e,$R,$A),this.addVertex($T,$H,$_,$V,$e,$R,$A),this.addVertex($T,$K,$I,$V,$e,$R,$A),this.addVertex($t,$K,$I,$V,$e,$R,$A),this.addVertex($T,$H,$I,$V,$e,$R,$A),this.addVertex($t,$H,$I,$V,$e,$R,$A),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$H.addVertex=function($t,$H,$I,$T,$K,$_,$V){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$t,this._vbData[this._posInVBData+1]=$H,this._vbData[this._posInVBData+2]=$I,this._vbData[this._posInVBData+3]=$T,this._vbData[this._posInVBData+4]=$K,this._vbData[this._posInVBData+5]=$_,this._vbData[this._posInVBData+6]=$V,this._posInVBData+=this._floatSizePerVer,this},$H.addVertexIndex=function($t,$H,$I,$T,$K,$_,$V,$e){return this._hasBegun||this.addVertexIndexException(),this._vbData[$e]=$t,this._vbData[$e+1]=$H,this._vbData[$e+2]=$I,this._vbData[$e+3]=$T,this._vbData[$e+4]=$K,this._vbData[$e+5]=$_,this._vbData[$e+6]=$V,($e+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$e),this},$H.addIndexes=function($t){var $H=arguments;this._hasBegun||this.addVertexIndexException();for(var $I=0;$I<$H.length;$I++)this._ibData[this._posInIBData]=$H[$I],this._posInIBData++;return this},$H.begin=function($t,$H){return this._hasBegun&&this.beginException0(),1!==$t&&4!==$t&&this.beginException1(),this._primitiveType=$t,this._camera=$H,this._hasBegun=!0,this},$H.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$H.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($t._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$s.drawCall++,$x.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$H.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$H.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$H.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$H.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$H.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$H.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(28,[new $Vt(0,"vector3",0),new $Vt(12,"vector4",1)])}]),$t}()),$o=function(){function $t(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$t._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $bH}$L($t,"laya.d3.core.render.RenderElement");var $H=$t.prototype;return $H.getDynamicBatchBakedVertexs=function($t){for(var $H=this._renderObj._getVertexBuffer($t),$I=$H.getData().slice(),$T=$H.vertexDeclaration,$K=$T.getVertexElementByUsage(0).offset/4,$_=$T.getVertexElementByUsage(3).offset/4,$V=this._sprite3D.transform,$e=$V.worldMatrix,$R=$V.rotation,$A=$T.vertexStride/4,$q=0,$f=$I.length;$q<$f;$q+=$A){var $b=$q+$K,$L=$q+$_;$OH.transformVector3ArrayToVector3ArrayCoordinate($I,$b,$e,$I,$b),$OH.transformVector3ArrayByQuat($I,$L,$R,$I,$L)}return $I},$H.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$H._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$G(0,$H,"id",function(){return this._id}),$G(0,$H,"renderObj",function(){return this._renderObj},function($t){this._renderObj!==$t&&(this._renderObj=$t)}),$t._uniqueIDCounter=0,$t}(),$n=function(){function $H($t){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$H._uniqueIDCounter,this._needSort=!1,this._scene=$t,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$L($H,"laya.d3.core.render.RenderQueue");var $t=$H.prototype;return $t._sortOpaqueFunc=function($t,$H){if($t._render&&$H._render){var $I=$t._material.renderQueue-$H._material.renderQueue;return 0==$I?$t._render._distanceForSort-$H._render._distanceForSort:$I}return 0},$t._sortAlphaFunc=function($t,$H){if($t._render&&$H._render){var $I=$t._material.renderQueue-$H._material.renderQueue;return 0==$I?$H._render._distanceForSort-$t._render._distanceForSort:$I}return 0},$t._begainRenderElement=function($t,$H,$I){return!!$H._beforeRender($t)},$t._sortAlpha=function($t){$H._cameraPosition=$t,this._finalElements.sort(this._sortAlphaFunc)},$t._sortOpaque=function($t){$H._cameraPosition=$t,this._finalElements.sort(this._sortOpaqueFunc)},$t._preRender=function($t){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$t._render=function($t,$H){for(var $I,$T,$K,$_,$V,$e,$R=$s.loopCount,$A=this._scene,$q=$t.camera,$f=($q.id,!1),$b=0,$L=this._finalElements.length;$b<$L;$b++){var $G,$M,$O,$J=this._finalElements[$b];if(null!=$J._onPreRenderFunction&&$J._onPreRenderFunction.call($J._sprite3D,$t),0===$J._type){if($t.owner=$O=$J._sprite3D,$t.renderElement=$J,$O._preRenderUpdateComponents($t),$G=$J.renderObj,$M=$J._material,this._begainRenderElement($t,$G,$M)){if($I=$G._getVertexBuffers(),!($K=($T=$G._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$T.id]){this._errorRecord[$T.id]=1;var $S="vertexBuffer:"+("("+$T._destroyed+","+$T._released+","+$T._referenceCount+","+$T._buffer+")")+", material:"+($M?$M.__className+"("+$M._destroyed+","+$M._released+")":"null")+", owner:"+($O?$O.__className+"("+$O._destroyed+","+$O._activeInHierarchy+","+$O._displayedInStage+")":"null")+", renderObj:"+($G?$G.__className+"("+$G._destroyed+","+$G._released+","+$G._referenceCount+")":"")+", parent:, url:"+($O?$O.url:"")+", disposeStack:"+$T.disposeStack;$N.recordError("报错：unknown vertexDeclaration  "+$S)}continue}if($f=($_=$t._shader=$M._getShader($A._shaderDefineValue,$K.shaderDefineValue,$O._shaderDefineValue)).bind()||$R!==$_._uploadLoopCount,$I){if($_._uploadVertexBuffer!==$I||$f){for(var $U=0;$U<$I.length;$U++){var $C=$I[$U];$_.uploadAttributesX($C.vertexDeclaration.shaderValues.data,$C)}$_._uploadVertexBuffer=$I}}else($_._uploadVertexBuffer!==$T||$f)&&($_.uploadAttributes($K.shaderValues.data,null),$_._uploadVertexBuffer=$T);($_._uploadScene!==$A||$f)&&($_.uploadSceneUniforms($A._shaderValues.data),$_._uploadScene=$A),($q!==$_._uploadCamera||$_._uploadSprite3D!==$O||$f)&&($_.uploadSpriteUniforms($O._shaderValues.data),$_._uploadSprite3D=$O),($q!==$_._uploadCamera||$f)&&($_.uploadCameraUniforms($q._shaderValues.data),$_._uploadCamera=$q),($_._uploadMaterial!==$M||$f)&&($M._upload(),$_._uploadMaterial=$M),$V!==$M?($M._setRenderStateBlendDepth(),$M._setRenderStateFrontFace($H,$O.transform),$V=$M,$e=$O):$e!==$O&&($M._setRenderStateFrontFace($H,$O.transform),$e=$O),$G._render($t),$_._uploadLoopCount=$R}$O._postRenderUpdateComponents($t)}else if(2===$J._type){$J.renderObj;$t.owner=$O=$J._sprite3D,$t.renderElement=$J,$t._batchIndexStart=$J._tempBatchIndexStart,$t._batchIndexEnd=$J._tempBatchIndexEnd,$G=$J.renderObj,$M=$J._material,this._begainRenderElement($t,$G,$M)&&($K=($T=$G._getVertexBuffer(0)).vertexDeclaration,$f=($_=$t._shader=$M._getShader($A._shaderDefineValue,$K.shaderDefineValue,$O._shaderDefineValue)).bind()||$R!==$_._uploadLoopCount,($_._uploadVertexBuffer!==$T||$f)&&($_.uploadAttributes($K.shaderValues.data,null),$_._uploadVertexBuffer=$T),($_._uploadScene!==$A||$f)&&($_.uploadSceneUniforms($A._shaderValues.data),$_._uploadScene=$A),($q!==$_._uploadCamera||$_._uploadSprite3D!==$O||$f)&&($_.uploadSpriteUniforms($O._shaderValues.data),$_._uploadSprite3D=$O),($q!==$_._uploadCamera||$f)&&($_.uploadCameraUniforms($q._shaderValues.data),$_._uploadCamera=$q),($_._uploadMaterial!==$M||$f)&&($M._upload(),$_._uploadMaterial=$M),$V!==$M?($M._setRenderStateBlendDepth(),$M._setRenderStateFrontFace($H,$O.transform),$V=$M,$e=$O):$e!==$O&&($M._setRenderStateFrontFace($H,$O.transform),$e=$O),$G._render($t),$_._uploadLoopCount=$R)}}},$t._renderShadow=function($t,$H){for(var $I,$T,$K,$_,$V,$e=$s.loopCount,$R=this._scene,$A=$t.camera,$q=!1,$f=0,$b=this._finalElements.length;$f<$b;$f++){var $L,$G,$M,$O=this._finalElements[$f];0===$O._type&&($t.owner=$M=$O._sprite3D,$H||$M._projectionViewWorldUpdateCamera===$A&&$M._projectionViewWorldUpdateLoopCount===$s.loopCount||($M._render._renderUpdate($t._projectionViewMatrix),$M._projectionViewWorldUpdateLoopCount=$s.loopCount,$M._projectionViewWorldUpdateCamera=$A),$t.renderElement=$O,$M._preRenderUpdateComponents($t),$L=$O.renderObj,$G=$O._material,this._begainRenderElement($t,$L,null)&&($T=($I=$L._getVertexBuffer(0)).vertexDeclaration,$q=($K=$t._shader=$G._getShader($R._shaderDefineValue,$T.shaderDefineValue,$M._shaderDefineValue)).bind()||$e!==$K._uploadLoopCount,($K._uploadVertexBuffer!==$I||$q)&&($K.uploadAttributes($T.shaderValues.data,null),$K._uploadVertexBuffer=$I),($A!==$K._uploadCamera||$K._uploadSprite3D!==$M||$q)&&($K.uploadSpriteUniforms($M._shaderValues.data),$K._uploadSprite3D=$M),($A!==$K._uploadCamera||$q)&&($K.uploadCameraUniforms($A._shaderValues.data),$K._uploadCamera=$A),($K._uploadMaterial!==$G||$q)&&($G._upload(),$K._uploadMaterial=$G),$K._uploadRenderElement,$_!==$G?($G._setRenderStateFrontFace(!1,$M.transform),$_=$G,$V=$M):$V!==$M&&($G._setRenderStateFrontFace(!1,$M.transform),$V=$M),$L._render($t),$K._uploadLoopCount=$e),$M._postRenderUpdateComponents($t))}},$t._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$t._addRenderElement=function($t){this._renderElements.push($t),this._needSort=!0},$t._addDynamicBatchElement=function($t){this._dynamicBatchCombineRenderElements.push($t)},$G(0,$t,"id",function(){return this._id}),$H._uniqueIDCounter=0,$H._cameraPosition=null,$H}(),$F=function(){function $t(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $L($t,"laya.d3.core.render.RenderState"),$t.clientWidth=0,$t.clientHeight=0,$t}(),$c=function(){function $V($t,$H){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $jt(new $VH,0),this._corners=[new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH],this._boundingBoxCenter=new $VH,this._children=$T(8),this._objects=[],this._tempBoundBoxCorners=[new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH],this._scene=$t,this._currentDepth=$H}$L($V,"laya.d3.core.scene.OctreeNode");var $t=$V.prototype;return $N.imps($t,{"laya.d3.core.scene.ITreeNode":!0}),$t.init=function($t,$H){var $I=new $VH,$T=new $VH;$VH.scale($H,-.5,$I),$VH.scale($H,.5,$T),$VH.add($I,$t,$I),$VH.add($T,$t,$T),this.exactBox=new $ct($I,$T),this.relaxBox=new $ct($I,$T)},$t.addTreeNode=function($t){1===Collision.boxContainsBox(this._relaxBox,$t.boundingBox)?this.addNodeDown($t,0):this.addObject($t)},$t.addChild=function($t){var $H=this._children[$t];if(null==$H){$H=new $V(this._scene,this._currentDepth+1),(this._children[$t]=$H)._parent=this,$VH.subtract(this._exactBox.max,this._exactBox.min,$V.tempSize),$VH.multiply($V.tempSize,$V._octreeSplit[$t],$V.tempCenter),$VH.add(this._exactBox.min,$V.tempCenter,$V.tempCenter),$VH.scale($V.tempSize,.25,$V.tempSize);var $I=new $VH,$T=new $VH;$VH.subtract($V.tempCenter,$V.tempSize,$I),$VH.add($V.tempCenter,$V.tempSize,$T),$H.exactBox=new $ct($I,$T),$VH.scale($V.tempSize,$V.relax,$V.tempSize);var $K=new $VH,$_=new $VH;$VH.subtract($V.tempCenter,$V.tempSize,$K),$VH.add($V.tempCenter,$V.tempSize,$_),$H.relaxBox=new $ct($K,$_)}return $H},$t.addObject=function($t){($t._treeNode=this)._objects.push($t)},$t.removeObject=function($t){if($t._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $H=this._objects.indexOf($t);return-1!==$H&&(this._objects.splice($H,1),!0)},$t.clearObject=function(){this._objects.length=0},$t.addNodeUp=function($t,$H){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$t.boundingBox)?this._parent.addNodeUp($t,$H-1):this.addNodeDown($t,$H)},$t.addNodeDown=function($t,$H){if($H<this._scene.treeLevel){var $I=this.inChildIndex($t.boundingBoxCenter),$T=this.addChild($I);1===Collision.boxContainsBox($T._relaxBox,$t.boundingBox)?$T.addNodeDown($t,++$H):this.addObject($t)}else this.addObject($t)},$t.inChildIndex=function($t){return 4*($t.z<this._boundingBoxCenter.z?0:1)+2*($t.y<this._boundingBoxCenter.y?0:1)+($t.x<this._boundingBoxCenter.x?0:1)},$t.updateObject=function($t){1===Collision.boxContainsBox(this._relaxBox,$t.boundingBox)?(this.removeObject($t),$t._treeNode=null,this.addNodeDown($t,this._currentDepth)):this._parent&&(this.removeObject($t),$t._treeNode=null,this._parent.addNodeUp($t,this._currentDepth-1))},$t.cullingObjects=function($t,$H,$I,$T,$K){var $_,$V=0,$e=0,$R=0,$A=this._scene._dynamicBatchManager;for($V=0,$_=this._objects.length;$V<$_;$V++){var $q=this._objects[$V];if($p.isVisible($q._owner.layer.mask)&&$q.enable){if($H&&($s.treeSpriteCollision+=1,0===$t.containsBoundSphere($q.boundingSphere)))continue;$q._renderUpdate($K),$q._distanceForSort=$VH.distance($q.boundingSphere.center,$T)+$q.sortingFudge;var $f=$q._renderElements;for($e=0,$R=$f.length;$e<$R;$e++){var $b=$f[$e],$L=$b._staticBatch;if($L&&$L._material===$b._material)$L._addBatchRenderElement($b);else{var $G=$b.renderObj;$G.triangleCount<10&&1===$G._vertexBufferCount&&$G._getIndexBuffer()&&$b._material.renderQueue<2&&$b._canDynamicBatch&&!$q._owner.isStatic?$A._addPrepareRenderElement($b):this._scene.getRenderQueue($b._material.renderQueue)._addRenderElement($b)}}}}for($V=0;$V<8;$V++){var $M=this._children[$V];if(null!=$M){var $O=$H;if($H){var $J=$t.containsBoundBox($M._relaxBox);if($s.treeNodeCollision+=1,0===$J)continue;$O=2===$J}$M.cullingObjects($t,$O,$I,$T,$K)}}},$t.cullingShadowObjects=function($t,$H,$I,$T,$K){var $_,$V=0,$e=0,$R=0;this._scene._dynamicBatchManager;for($V=0,$_=this._objects.length;$V<$_;$V++){var $A=this._objects[$V];if($A.castShadow&&$p.isVisible($A._owner.layer.mask)&&$A.enable){if($I&&0===$t[0].containsBoundSphere($A.boundingSphere))continue;for(var $q=1,$f=$t.length;$q<$f;$q++){var $b=$H[$q-1];if(0!==$t[$q].containsBoundSphere($A.boundingSphere)){var $L=$A._renderElements;for($e=0,$R=$L.length;$e<$R;$e++)$b._addRenderElement($L[$e])}}}}for($V=0;$V<8;$V++){var $G=this._children[$V];if(null!=$G){var $M=$I;if($I){var $O=$t[0].containsBoundBox($G._relaxBox);if(0===$O)continue;$M=2===$O}$G.cullingShadowObjects($t,$H,$M,$T,$K)}}},$t.cullingShadowObjectsOnePSSM=function($t,$H,$I,$T,$K,$_){var $V,$e=$H[0],$R=0,$A=0,$q=0;for($R=0,$V=this._objects.length;$R<$V;$R++){var $f=this._objects[$R];if($f.castShadow&&$p.isVisible($f._owner.layer.mask)&&$f.enable){if($T&&0===$t.containsBoundSphere($f.boundingSphere))continue;$f._renderUpdate($I);var $b=$f._renderElements;for($A=0,$q=$b.length;$A<$q;$A++)$e._addRenderElement($b[$A])}}for($R=0;$R<8;$R++){var $L=this._children[$R];if(null!=$L){var $G=$T;if($T){var $M=$t.containsBoundBox($L._relaxBox);if(0===$M)continue;$G=2===$M}$L.cullingShadowObjectsOnePSSM($t,$H,$I,$G,$K,$_)}}},$t.renderBoudingBox=function($t){this._renderBoudingBox($t);for(var $H=0;$H<8;++$H){var $I=this._children[$H];$I&&$I.renderBoudingBox($t)}},$t.buildAllChild=function($t){if($t<this._scene.treeLevel)for(var $H=0;$H<8;$H++){this.addChild($H).buildAllChild($t+1)}},$t._renderBoudingBox=function($t){},$G(0,$t,"exactBox",function(){return this._exactBox},function($t){this._exactBox=$t,$VH.add($t.min,$t.max,this._boundingBoxCenter),$VH.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$G(0,$t,"relaxBox",function(){return this._relaxBox},function($t){(this._relaxBox=$t).getCorners(this._corners),$jt.createfromPoints(this._corners,this._boundingSphere)}),$V.debugMode=!1,$V.relax=1.15,$V.CHILDNUM=8,$f($V,["tempVector0",function(){return this.tempVector0=new $VH},"tempSize",function(){return this.tempSize=new $VH},"tempCenter",function(){return this.tempCenter=new $VH},"_octreeSplit",function(){return this._octreeSplit=[new $VH(.25,.25,.25),new $VH(.75,.25,.25),new $VH(.25,.75,.25),new $VH(.75,.75,.25),new $VH(.25,.25,.75),new $VH(.75,.25,.75),new $VH(.25,.75,.75),new $VH(.75,.75,.75)]}]),$V}(),$i=(function(){function $t(){}$L($t,"laya.d3.core.scene.SceneManager")}(),function(){function $t($t,$H,$I,$T){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$t&&($t=1),void 0===$H&&($H=1),void 0===$I&&($I=1),void 0===$T&&($T=1),this._r=$t,this._g=$H,this._b=$I,this._a=$T}return $L($t,"laya.d3.core.trail.module.Color",null,"Color$1"),$t.prototype.cloneTo=function($t){$t._r=this._r,$t._g=this._g,$t._b=this._b,$t._a=this._a},$f($t,["RED",function(){return this.RED=new $t(1,0,0,1)},"GREEN",function(){return this.GREEN=new $t(0,1,0,1)},"BLUE",function(){return this.BLUE=new $t(0,0,1,1)},"CYAN",function(){return this.CYAN=new $t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $t(1,0,1,1)},"GRAY",function(){return this.GRAY=new $t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $t(1,1,1,1)},"BLACK",function(){return this.BLACK=new $t(0,0,0,1)}]),$t}()),$j=(function(){function $t(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$L($t,"laya.d3.core.trail.module.Gradient");var $H=$t.prototype;$H.setKeys=function($t,$H){var $I,$T;this._colorKeys=$t;for(var $K=this.index=0;$K<$t.length;$K++){var $_=($I=$t[$K]).color;this._colorKeyData[this.index++]=$_._r,this._colorKeyData[this.index++]=$_._g,this._colorKeyData[this.index++]=$_._b,this._colorKeyData[this.index++]=$I.time}this._alphaKeys=$H;for(var $V=this.index=0;$V<$H.length;$V++)$T=$H[$V],this._alphaKeyData[this.index++]=$T.alpha,this._alphaKeyData[this.index++]=$T.time},$H.cloneTo=function($t){var $H=0,$I=0,$T=this.colorKeys,$K=[];for($H=0,$I=$T.length;$H<$I;$H++){var $_=new $d;$T[$H].cloneTo($_),$K.push($_)}var $V=this.alphaKeys,$e=[];for($H=0,$I=$V.length;$H<$I;$H++){var $R=new $j;$V[$H].cloneTo($R),$e.push($R)}$t.setKeys($K,$e)},$G(0,$H,"mode",function(){return this._mode},function($t){this._mode=$t}),$G(0,$H,"colorKeys",function(){return this._colorKeys},function($t){this._colorKeys=$t;for(var $H=this.index=0;$H<$t.length;$H++){var $I=$t[$H],$T=$I.color;this._colorKeyData[this.index++]=$T._r,this._colorKeyData[this.index++]=$T._g,this._colorKeyData[this.index++]=$T._b,this._colorKeyData[this.index++]=$I.time}}),$G(0,$H,"alphaKeys",function(){return this._alphaKeys},function($t){this._alphaKeys=$t;for(var $H=this.index=0;$H<$t.length;$H++){var $I=$t[$H];this._alphaKeyData[this.index++]=$I.alpha,this._alphaKeyData[this.index++]=$I.time}})}(),function(){function $t($t,$H){this._alpha=NaN,this._time=NaN,void 0===$t&&($t=0),void 0===$H&&($H=0),this._alpha=$t,this._time=$H}$L($t,"laya.d3.core.trail.module.GradientAlphaKey");var $H=$t.prototype;return $H.cloneTo=function($t){$t.alpha=this.alpha,$t.time=this.time},$G(0,$H,"alpha",function(){return this._alpha},function($t){this._alpha=$t}),$G(0,$H,"time",function(){return this._time},function($t){this._time=$t}),$t}()),$d=function(){function $t($t,$H){this._color=null,this._time=NaN,void 0===$H&&($H=0),this._color=$t||new $i,this._time=$H}$L($t,"laya.d3.core.trail.module.GradientColorKey");var $H=$t.prototype;return $H.cloneTo=function($t){this.color.cloneTo($t.color),$t.time=this.time},$G(0,$H,"color",function(){return this._color},function($t){this._color=$t}),$G(0,$H,"time",function(){return this._time},function($t){this._time=$t}),$t}(),$Z=(function(){function $t(){}$L($t,"laya.d3.core.trail.module.GradientMode"),$t.Blend=0,$t.Fixed=1}(),function(){function $t(){}$L($t,"laya.d3.core.trail.module.TextureMode"),$t.Stretch=0,$t.Tile=1}(),function(){function $t(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$L($t,"laya.d3.core.trail.module.TrailKeyFrame"),$t.prototype.cloneTo=function($t){$t.time=this.time,$t.inTangent=this.inTangent,$t.outTangent=this.outTangent,$t.value=this.value}}(),function(){function $H($t){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $VH,this._curPosition=new $VH,this._delVector3=new $VH,this._lastFixedVertexPosition=new $VH,this._pointAtoBVector3=new $VH,this._pointA=new $VH,this._pointB=new $VH,this._owner=$t,this._id=$H.renderElementCount++,0==this._id?$t._owner.transform.position.cloneTo(this._lastPosition):$t._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $hH($Z.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $hH($Z.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$L($H,"laya.d3.core.trail.TrailRenderElement");var $t=$H.prototype;$N.imps($t,{"laya.d3.core.render.IRenderable":!0}),$t._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$t._addTrailByFirstPosition=function($t,$H){$VH.subtract($H,$t,this._delVector3),$VH.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$VH.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$VH.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($t),$t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$t._addTrailByNextPosition=function($t){$VH.subtract($t,this._lastFixedVertexPosition,this._delVector3),$VH.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$VH.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$VH.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$VH.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$dt.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($t),$t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($t),this._virtualVerticesCount=2)},$t._updateVerticesByPosition=function($t){this._pointe=$t.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$t._updateVertexBuffer2=function(){var $t,$H=0,$I=0,$T=0;for($T=0,$t=(this._verticesCount+this._virtualVerticesCount)/2;$T<$t;$T++)$I=0==this._owner.textureMode?(this._VerticesToTailLength[$T]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$T],this._vertices2[$H++]=1-$I,this._vertices2[$H++]=1-$I;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$t._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$t._updateDisappear=function(){var $t,$H=0;for($H=this._curDisappearIndex,$t=(this._verticesCount+this._virtualVerticesCount)/2;$H<$t;$H++)this._owner._curtime-this._everyGroupVertexBirthTime[$H]>=this._owner.time+$dt.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$t._beforeRender=function($t){return this._camera=$t.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$VH.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$t._render=function($t){this._isDead||($x.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$s.drawCall++,$s.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$t._getVertexBuffer=function($t){return void 0===$t&&($t=0),0===$t?this._vertexBuffer1:1===$t?this._vertexBuffer2:null},$t._getVertexBuffers=function(){return this._vertexBuffers},$t._getIndexBuffer=function(){return null},$t.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$t._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$G(0,$t,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$G(0,$t,"triangleCount",function(){return 0}),$H.renderElementCount=0}(),function(){function $t(){}$L($t,"laya.d3.core.trail.VertexTrail");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration1}),$G(1,$t,"vertexDeclaration1",function(){return $t._vertexDeclaration1}),$G(1,$t,"vertexDeclaration2",function(){return $t._vertexDeclaration2}),$f($t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $_t(32,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",41),new $Vt(24,"single",33),new $Vt(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $_t(4,[new $Vt(0,"single",38)])}]),$t}()),$tt=function(){function $C($t){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$t}$L($C,"laya.d3.graphics.DynamicBatch");var $t=$C.prototype;return $N.imps($t,{"laya.d3.core.render.IRenderable":!0}),$t._getVertexBuffer=function($t){return void 0===$t&&($t=0),0===$t?this._vertexBuffer:null},$t._getIndexBuffer=function(){return this._indexBuffer},$t._getCombineRenderElementFromPool=function($t,$H,$I){var $T=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $T||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$T=new $o,$T._sprite3D=new $nH),$T._sprite3D._render._renderUpdate($I),$T},$t._getRenderElement=function($t,$H,$I){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$C.maxVertexCount),this._indexDatas=new Uint16Array($C.maxIndexCount),this._vertexBuffer=$hH.create(this._vertexDeclaration,$C.maxVertexCount,35048),this._indexBuffer=$EH.create("ushort",$C.maxIndexCount,35048));for(var $T=this._merageElements.length=0,$K=0,$_=0,$V=this._combineRenderElements.length;$_<$V;$_++){var $e=this._combineRenderElements[$_],$R=$e.getDynamicBatchBakedVertexs(0),$A=$e.getBakedIndices(),$q=$e._sprite3D.transform._isFrontFaceInvert,$f=$T/(this._vertexDeclaration.vertexStride/4),$b=$K,$L=$b+$A.length;$e._tempBatchIndexStart=$b,$e._tempBatchIndexEnd=$L,this._indexDatas.set($A,$K);var $G=0;if($q)for($G=$b;$G<$L;$G+=3){this._indexDatas[$G]=$f+this._indexDatas[$G];var $M=this._indexDatas[$G+1],$O=this._indexDatas[$G+2];this._indexDatas[$G+1]=$f+$O,this._indexDatas[$G+2]=$f+$M}else for($G=$b;$G<$L;$G+=3)this._indexDatas[$G]=$f+this._indexDatas[$G],this._indexDatas[$G+1]=$f+this._indexDatas[$G+1],this._indexDatas[$G+2]=$f+this._indexDatas[$G+2];$K+=$A.length,this._vertexDatas.set($R,$T),$T+=$R.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$_=this._combineRenderElementPoolIndex=0,$V=this._materials.length;$_<$V;$_++){var $J=this._getCombineRenderElementFromPool($t,$H,$I);$J._type=2,$J._staticBatch=null;var $S=($J.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$_]]._tempBatchIndexStart,$U=$_+1===this._materialToRenderElementsOffsets.length?$K:this._combineRenderElements[this._materialToRenderElementsOffsets[$_+1]]._tempBatchIndexStart;$J._tempBatchIndexStart=$S,$J._tempBatchIndexEnd=$U,$J._material=this._materials[$_],this._merageElements.push($J)}},$t._addCombineRenderObjTest=function($t){var $H=$t.renderObj,$I=this._currentCombineIndexCount+$H._getIndexBuffer().indexCount,$T=this._currentCombineVertexCount+$H._getVertexBuffer().vertexCount;return!($C.maxVertexCount<$T||$C.maxIndexCount<$I)},$t._addCombineRenderObj=function($t){var $H=$t.renderObj;this._combineRenderElements.push($t),this._currentCombineIndexCount=this._currentCombineIndexCount+$H._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$H._getVertexBuffer().vertexCount},$t._addCombineMaterial=function($t){this._materials.push($t)},$t._addMaterialToRenderElementOffset=function($t){this._materialToRenderElementsOffsets.push($t)},$t._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$t._addToRenderQueue=function($t,$H,$I,$T){this._getRenderElement($H,$I,$T);for(var $K=0,$_=this._materials.length;$K<$_;$K++)$t.getRenderQueue(this._materials[$K].renderQueue)._addDynamicBatchElement(this._merageElements[$K])},$t._beforeRender=function($t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$t._render=function($t){var $H=$t._batchIndexEnd-$t._batchIndexStart;$x.mainContext.drawElements(4,$H,5123,2*$t._batchIndexStart),$s.drawCall++,$s.trianglesFaces+=$H/3},$t._getVertexBuffers=function(){return null},$G(0,$t,"_vertexBufferCount",function(){return 1}),$G(0,$t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$G(0,$t,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$C.maxVertexCount=2e4,$C.maxIndexCount=4e4,$C.maxCombineTriangleCount=10,$C}(),$Ht=function(){function $C(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$L($C,"laya.d3.graphics.DynamicBatchManager");var $t=$C.prototype;return $t.getDynamicBatch=function($t,$H){var $I,$T=$t.id.toString()+$H;return this._dynamicBatches[$T]?$I=this._dynamicBatches[$T]:this._dynamicBatches[$T]=$I=new $tt($t),$I},$t._garbageCollection=function(){for(var $t in this._dynamicBatches)0===this._dynamicBatches[$t].combineRenderElementsCount&&delete this._dynamicBatches[$t]},$t._addPrepareRenderElement=function($t){this._prepareDynamicBatchCombineElements.push($t)},$t._finishCombineDynamicBatch=function($t){var $H,$I,$T;this._prepareDynamicBatchCombineElements.sort($C._sortPrepareDynamicBatch);for(var $K,$_,$V,$e,$R,$A=-1,$q=!0,$f=0,$b=-1,$L=0,$G=this._prepareDynamicBatchCombineElements.length;$L<$G;$L++){var $M=($_=this._prepareDynamicBatchCombineElements[$L]).renderObj._getVertexBuffer(0).vertexDeclaration,$O=$I!==$M;$O&&($f=0,$I=$M);var $J=$f!==$A;if($J&&($A=$f),($O||$J)&&($V=this.getDynamicBatch($M,$f),$H=null),$q)if($V._addCombineRenderObjTest($_)){if($H!==($K=$_._material))$e&&($t.getRenderQueue($R._material.renderQueue)._addRenderElement($R),$R=$e=null,$b=-1),$e=$K,$b=$V.combineRenderElementsCount,$R=$_,$H=$K;else if($e){var $S=$R.renderObj,$U=$_.renderObj;$S._getVertexBuffer().vertexCount+$U._getVertexBuffer().vertexCount>$tt.maxVertexCount||$S._getIndexBuffer().indexCount+$U._getIndexBuffer().indexCount>$tt.maxIndexCount?($t.getRenderQueue($R._material.renderQueue)._addRenderElement($R),$e=$K,$b=$V.combineRenderElementsCount,$R=$_):($V._addCombineMaterial($e),$V._addMaterialToRenderElementOffset($b),$V._addCombineRenderObj($R),$R=$e=null,$b=-1,$V._addCombineRenderObj($_))}else $V._addCombineRenderObj($_);$q=!0}else $e&&($t.getRenderQueue($R._material.renderQueue)._addRenderElement($R),$R=$e=null,$b=-1),$f++,$q=!1;else $T=this._prepareDynamicBatchCombineElements[$L-1],$V._addMaterialToRenderElementOffset($V.combineRenderElementsCount),$H=$T._material,$V._addCombineMaterial($H),$V._addCombineRenderObj($T),$q=!0,$H!==($K=$_._material)?($e=$K,$b=$V.combineRenderElementsCount,$R=$_):$V._addCombineRenderObj($_),$H=$K}$e&&($t.getRenderQueue($R._material.renderQueue)._addRenderElement($R),$R=$e=null,$b=-1),this._prepareDynamicBatchCombineElements.length=0},$t._clearRenderElements=function(){for(var $t in this._dynamicBatches)this._dynamicBatches[$t]._clearRenderElements()},$t._addToRenderQueue=function($t,$H,$I,$T){for(var $K in this._dynamicBatches){var $_=this._dynamicBatches[$K];0<$_.combineRenderElementsCount&&$_._addToRenderQueue($t,$H,$I,$T)}},$t.dispose=function(){this._dynamicBatches=null},$C._sortPrepareDynamicBatch=function($t,$H){return $t._mainSortID-$H._mainSortID},$C}(),$It=function(){function $t(){}return $L($t,"laya.d3.graphics.FrustumCulling"),$t.renderShadowObjectCulling=function($t,$H,$I,$T,$K){var $_=0,$V=0,$e=0,$R=0;for($_=0,$e=$I.length;$_<$e;$_++){var $A=$I[$_];$A&&$A._clearRenderElements()}var $q,$f,$b,$L=$t._cullingRenders;if(1<$K){for($_=0,$e=$t._cullingRendersLength;$_<$e;$_++)if(($q=$L[$_]).castShadow&&$p.isVisible($q._owner.layer.mask)&&$q.enable)for(var $G=1,$M=$H.length;$G<$M;$G++)if($f=$I[$G-1],0!==$H[$G].containsBoundSphere($q.boundingSphere))for($V=0,$R=($b=$q._renderElements).length;$V<$R;$V++)$f._addRenderElement($b[$V])}else for($_=0,$e=$t._cullingRendersLength;$_<$e;$_++)if(($q=$L[$_]).castShadow&&$p.isVisible($q._owner.layer.mask)&&$q.enable&&0!==$H[0].containsBoundSphere($q.boundingSphere))for($q._renderUpdate($T),$f=$I[0],$V=0,$R=($b=$q._renderElements).length;$V<$R;$V++)$f._addRenderElement($b[$V])},$t.renderShadowObjectCullingOctree=function($t,$H,$I,$T,$K){for(var $_=0,$V=$I.length;$_<$V;$_++){var $e=$I[$_];$e&&$e._clearRenderElements()}1<$K?$t.treeRoot.cullingShadowObjects($H,$I,!0,0,$t):$t.treeRoot.cullingShadowObjectsOnePSSM($H[0],$I,$T,!0,0,$t)},$t.renderObjectCulling=function($t,$H,$I,$T,$K,$_){var $V=0,$e=0,$R=0,$A=0,$q=$H._quenes,$f=$H._dynamicBatchManager,$b=$H._cullingRenders;for($V=0,$e=$q.length;$V<$e;$V++){var $L=$q[$V];$L&&$L._clearRenderElements()}var $G=$Tt._staticBatchManagers;for($V=0,$e=$G.length;$V<$e;$V++)$G[$V]._clearRenderElements();$f._clearRenderElements();var $M=$I.transform.position;for($V=0,$e=$H._cullingRendersLength;$V<$e;$V++){var $O=$b[$V];if($p.isVisible($O._owner.layer.mask)&&$O.enable&&0!==$t.containsBoundSphere($O.boundingSphere)&&$O._renderUpdate($_)){$O._distanceForSort=$VH.distance($O.boundingSphere.center,$M)+$O.sortingFudge;var $J=$O._renderElements;for($R=0,$A=$J.length;$R<$A;$R++){var $S=$J[$R],$U=$S._staticBatch;if($U&&$U._material===$S._material)$U._addBatchRenderElement($S);else{var $C=$S.renderObj;$C.triangleCount<10&&1===$C._vertexBufferCount&&$C._getIndexBuffer()&&$S._material.renderQueue<2&&$S._canDynamicBatch&&!$O._owner.isStatic?$f._addPrepareRenderElement($S):$H.getRenderQueue($S._material.renderQueue)._addRenderElement($S)}}}}for($V=0,$e=$G.length;$V<$e;$V++)$G[$V]._addToRenderQueue($H,$T,$K,$_);$f._finishCombineDynamicBatch($H),$f._addToRenderQueue($H,$T,$K,$_)},$t.renderObjectCullingOctree=function($t,$H,$I,$T,$K,$_){var $V=0,$e=0,$R=$H._quenes,$A=$H._dynamicBatchManager;for($V=0,$e=$R.length;$V<$e;$V++){var $q=$R[$V];$q&&$q._clearRenderElements()}var $f=$Tt._staticBatchManagers;for($V=0,$e=$f.length;$V<$e;$V++)$f[$V]._clearRenderElements();for($A._clearRenderElements(),$H._cullingRenders.length=0,$H.treeRoot.cullingObjects($t,!0,0,$I.transform.position,$_),$V=0,$e=$f.length;$V<$e;$V++)$f[$V]._addToRenderQueue($H,$T,$K,$_);$A._finishCombineDynamicBatch($H),$A._addToRenderQueue($H,$T,$K,$_)},$t.renderObjectCullingNoBoundFrustum=function($t,$H,$I,$T,$K){var $_=0,$V=0,$e=0,$R=0,$A=$t._quenes,$q=$t._dynamicBatchManager,$f=$t._cullingRenders;for($_=0,$V=$A.length;$_<$V;$_++){var $b=$A[$_];$b&&$b._clearRenderElements()}var $L=$Tt._staticBatchManagers;for($_=0,$V=$L.length;$_<$V;$_++)$L[$_]._clearRenderElements();$q._clearRenderElements();var $G=$H.transform.position;for($_=0,$V=$t._cullingRendersLength;$_<$V;$_++){var $M=$f[$_];if($p.isVisible($M._owner.layer.mask)&&$M.enable){$M._renderUpdate($K),$M._distanceForSort=$VH.distance($M.boundingSphere.center,$G)+$M.sortingFudge;var $O=$M._renderElements;for($e=0,$R=$O.length;$e<$R;$e++){var $J=$O[$e],$S=$J._staticBatch;if($S&&$S._material===$J._material)$S._addBatchRenderElement($J);else{var $U=$J.renderObj;$U.triangleCount<10&&1===$U._vertexBufferCount&&$U._getIndexBuffer()&&$J._material.renderQueue<2&&$J._canDynamicBatch&&!$M._owner.isStatic?$q._addPrepareRenderElement($J):$t.getRenderQueue($J._material.renderQueue)._addRenderElement($J)}}}}for($_=0,$V=$L.length;$_<$V;$_++)$L[$_]._addToRenderQueue($t,$I,$T,$K);$q._finishCombineDynamicBatch($t),$q._addToRenderQueue($t,$I,$T,$K)},$t}(),$Tt=function(){function $_(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$L($_,"laya.d3.graphics.StaticBatchManager");var $t=$_.prototype;return $t._finishInit=function(){for(var $t in this._staticBatches)this._staticBatches[$t]._finishInit();this._initBatchRenderElements.length=0},$t._initStaticBatchs=function($t){throw new Error("StaticBatchManager:must override this function.")},$t._addInitBatchSprite=function($t){for(var $H=$t._render._renderElements,$I=0,$T=$H.length;$I<$T;$I++)this._initBatchRenderElements.push($H[$I])},$t._clearRenderElements=function(){for(var $t in this._staticBatches)this._staticBatches[$t]._clearRenderElements()},$t._garbageCollection=function($t){var $H=$t._staticBatch,$I=$H._initBatchRenderElements,$T=$I.indexOf($t);$I.splice($T,1),0===$I.length&&($H.dispose(),delete this._staticBatches[$H._key])},$t._addToRenderQueue=function($t,$H,$I,$T){for(var $K in this._staticBatches){var $_=this._staticBatches[$K];0<$_._batchRenderElements.length&&$_._updateToRenderQueue($t,$T)}},$t.dispose=function(){this._staticBatches=null},$_._addToStaticBatchQueue=function($t){$t instanceof laya.d3.core.RenderableSprite3D&&$t._addToInitStaticBatchManager();for(var $H=0,$I=$t.numChildren;$H<$I;$H++)$_._addToStaticBatchQueue($t._childs[$H])},$_.combine=function($t,$H){var $I,$T=0,$K=0;if($H)for($T=0,$K=$H.length;$T<$K;$T++){$H[$T]._addToInitStaticBatchManager()}else $t&&$_._addToStaticBatchQueue($t);for($T=0,$K=$_._staticBatchManagers.length;$T<$K;$T++)($I=$_._staticBatchManagers[$T])._initStaticBatchs($t),$I._finishInit()},$_._staticBatchManagers=[],$_}(),$Kt=function(){function $t($t,$H,$I){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$t,this._manager=$H,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$I}$L($t,"laya.d3.graphics.StaticBatch");var $H=$t.prototype;return $N.imps($H,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$H._binarySearch=function($t){for(var $H=0,$I=this._batchRenderElements.length-1,$T=0;$H<=$I;)$T=Math.floor(($H+$I)/2),this._compareBatchRenderElement(this._batchRenderElements[$T],$t)?$I=$T-1:$H=$T+1;return $H},$H._compareBatchRenderElement=function($t,$H){throw new Error("StaticBatch:must override this function.")},$H._getVertexDecLightMap=function($t){return $t===$Et.vertexDeclaration?$pt.vertexDeclaration:$t===$yt.vertexDeclaration?$Dt.vertexDeclaration:$t===$zt.vertexDeclaration?$Ct.vertexDeclaration:$t===$at.vertexDeclaration?null:$t===$Mt.vertexDeclaration?$Ot.vertexDeclaration:$t===$Xt.vertexDeclaration?$lt.vertexDeclaration:$t===$xt.vertexDeclaration?$Yt.vertexDeclaration:$t===$ht.vertexDeclaration?$gt.vertexDeclaration:$t===$yt.vertexDeclaration?$Dt.vertexDeclaration:$t===$Pt.vertexDeclaration?$Nt.vertexDeclaration:$t===$at.vertexDeclaration?null:$t===$Mt.vertexDeclaration?$Ot.vertexDeclaration:$t===$Bt.vertexDeclaration?$vt.vertexDeclaration:$t===$xt.vertexDeclaration?$Yt.vertexDeclaration:$t},$H._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$H._addBatchRenderElement=function($t){this._batchRenderElements.splice(this._binarySearch($t),0,$t)},$H._updateToRenderQueue=function($t,$H){this._combineRenderElementPoolIndex=0,this._getRenderElement($t.getRenderQueue(this._material.renderQueue)._renderElements,$t,$H)},$H._getRenderElement=function($t,$H,$I){throw new Error("StaticBatch:must override this function.")},$H._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$H._clearRenderElements=function(){this._batchRenderElements.length=0},$H.dispose=function(){},$H._getVertexBuffer=function($t){return void 0===$t&&($t=0),null},$H._getIndexBuffer=function(){return null},$H._beforeRender=function($t){return!0},$H._render=function($t){},$H._getVertexBuffers=function(){return null},$G(0,$H,"_vertexBufferCount",function(){return 1}),$G(0,$H,"triangleCount",function(){return 0}),$t.combine=function($t){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$Tt.combine($t)},$t.maxBatchVertexCount=65535,$t}(),$_t=function(){function $V($t,$H){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$V._uniqueIDCounter,this._id>$V.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$V.maxVertexDeclaration);this._shaderValues=new $bH,this._vertexElementsDic={},this._vertexStride=$t,this._vertexElements=$H;for(var $I=0;$I<$H.length;$I++){var $T=$H[$I],$K=$T.elementUsage;this._vertexElementsDic[$K]=$T;var $_=[$V._getTypeSize($T.elementFormat)/4,5126,!1,this._vertexStride,$T.offset];switch(this._shaderValues.setValue($K,$_),$K){case 1:this._addShaderDefine($sH.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($sH.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($sH.SHADERDEFINE_UV1)}}}$L($V,"laya.d3.graphics.VertexDeclaration");var $t=$V.prototype;return $t._addShaderDefine=function($t){this._shaderDefineValue|=$t},$t._removeShaderDefine=function($t){this._shaderDefineValue&=~$t},$t.getVertexElements=function(){return this._vertexElements.slice()},$t.getVertexElementByUsage=function($t){return this._vertexElementsDic[$t]},$t.unBinding=function(){},$G(0,$t,"shaderDefineValue",function(){return this._shaderDefineValue}),$G(0,$t,"id",function(){return this._id}),$G(0,$t,"vertexStride",function(){return this._vertexStride}),$G(0,$t,"shaderValues",function(){return this._shaderValues}),$V._getTypeSize=function($t){switch($t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$V.getVertexStride=function($t){for(var $H=0,$I=0;$I<$t.Length;$I++){var $T=$t[$I],$K=$T.offset+$V._getTypeSize($T.elementFormat);$H<$K&&($H=$K)}return $H},$V._maxVertexDeclarationBit=1e3,$V._uniqueIDCounter=1,$f($V,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$V}(),$Vt=function(){function $t($t,$H,$I){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$t,this.elementFormat=$H,this.elementUsage=$I}return $L($t,"laya.d3.graphics.VertexElement"),$t}(),$et=(function(){function $t(){}$L($t,"laya.d3.graphics.VertexElementFormat"),$t.Single="single",$t.Vector2="vector2",$t.Vector3="vector3",$t.Vector4="vector4",$t.Color="color",$t.Byte4="byte4",$t.Short2="short2",$t.Short4="short4",$t.NormalizedShort2="normalizedshort2",$t.NormalizedShort4="normalizedshort4",$t.HalfVector2="halfvector2",$t.HalfVector4="halfvector4"}(),function(){function $t(){}$L($t,"laya.d3.graphics.VertexElementUsage"),$t.POSITION0=0,$t.COLOR0=1,$t.TEXTURECOORDINATE0=2,$t.NORMAL0=3,$t.BINORMAL0=4,$t.TANGENT0=5,$t.BLENDINDICES0=6,$t.BLENDWEIGHT0=7,$t.DEPTH0=8,$t.FOG0=9,$t.POINTSIZE0=10,$t.SAMPLE0=11,$t.TESSELLATEFACTOR0=12,$t.COLOR1=13,$t.NEXTTEXTURECOORDINATE0=14,$t.TEXTURECOORDINATE1=15,$t.NEXTTEXTURECOORDINATE1=16,$t.CORNERTEXTURECOORDINATE0=17,$t.VELOCITY0=18,$t.STARTCOLOR0=19,$t.STARTSIZE=20,$t.AGEADDSCALE0=21,$t.STARTROTATION=22,$t.ENDCOLOR0=23,$t.STARTLIFETIME=24,$t.TIME0=33,$t.SHAPEPOSITIONSTARTLIFETIME=30,$t.DIRECTIONTIME=32,$t.SIZEROTATION0=27,$t.RADIUS0=28,$t.RADIAN0=29,$t.STARTSPEED=31,$t.RANDOM0=34,$t.RANDOM1=35,$t.SIMULATIONWORLDPOSTION=36,$t.SIMULATIONWORLDROTATION=37,$t.TEXTURECOORDINATE0X=38,$t.TEXTURECOORDINATE0X1=39,$t.TEXTURECOORDINATE0Y=40,$t.OFFSETVECTOR=41}(),function(){function $t($t,$H,$I){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$t,this._textureCoordinate0=$H,this._time=$I}$L($t,"laya.d3.graphics.VertexGlitter");var $H=$t.prototype;$N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate0}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"time",function(){return this._time}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(24,[new $Vt(0,"vector3",0),new $Vt(12,"vector2",2),new $Vt(20,"single",33)])}])}(),function(){function $t($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$t,this._position=$H,this._velocity=$I,this._startColor=$T,this._endColor=$K,this._sizeRotation=$_,this._radius=$V,this._radian=$e,this._ageAddScale=$R,this._time=$A}$L($t,"laya.d3.graphics.VertexParticle");var $H=$t.prototype;$N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"endColor",function(){return this._endColor}),$G(0,$H,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$G(0,$H,"sizeRotation",function(){return this._sizeRotation}),$G(0,$H,"velocity",function(){return this._velocity}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"startColor",function(){return this._startColor}),$G(0,$H,"radius",function(){return this._radius}),$G(0,$H,"radian",function(){return this._radian}),$G(0,$H,"ageAddScale",function(){return this._ageAddScale}),$G(0,$H,"time",function(){return this._time}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(116,[new $Vt(0,"vector4",17),new $Vt(16,"vector3",0),new $Vt(28,"vector3",18),new $Vt(40,"vector4",19),new $Vt(56,"vector4",23),new $Vt(72,"vector3",27),new $Vt(84,"vector2",28),new $Vt(92,"vector4",29),new $Vt(108,"single",24),new $Vt(112,"single",33)])}])}(),function(){function $t($t){this._position=null,this._position=$t}$L($t,"laya.d3.graphics.VertexPosition");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(12,[new $Vt(0,"vector3",0)])}]),$t}()),$Rt=function(){function $t($t,$H){this._position=null,this._normal=null,this._position=$t,this._normal=$H}$L($t,"laya.d3.graphics.VertexPositionNormal");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(24,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3)])}]),$t}(),$At=function(){function $t($t,$H,$I){this._position=null,this._normal=null,this._color=null,this._position=$t,this._normal=$H,this._color=$I}$L($t,"laya.d3.graphics.VertexPositionNormalColor");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(40,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1)])}]),$t}(),$qt=function(){function $t($t,$H,$I,$T,$K){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$t,this._normal=$H,this._color=$I,this._blendIndex=$T,this._blendWeight=$K}$L($t,"laya.d3.graphics.VertexPositionNormalColorSkin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(72,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector4",7),new $Vt(56,"vector4",6)])}]),$t}(),$ft=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._tangent=$T,this._blendIndex=$K,this._blendWeight=$_}$L($t,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(88,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector4",7),new $Vt(56,"vector4",6),new $Vt(72,"vector4",5)])}]),$t}(),$bt=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._tangent=$T,this._blendIndex=$K,this._blendWeight=$_}$L($t,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(84,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector4",7),new $Vt(56,"vector4",6),new $Vt(72,"vector3",5)])}]),$t}(),$Lt=function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._tangent=$T}$L($t,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(56,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector4",5)])}]),$t}(),$Gt=function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._tangent=$T}$L($t,"laya.d3.graphics.VertexPositionNormalColorTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(52,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector3",5)])}]),$t}(),$Mt=function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate=$T}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(48,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2)])}]),$t}(),$Ot=function(){function $t($t,$H,$I,$T,$K){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate0=$T,this._textureCoordinate1=$K}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(56,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector2",15)])}]),$t}(),$Jt=function(){function $t($t,$H,$I,$T,$K,$_,$V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate0=$T,this._textureCoordinate1=$K,this._blendIndex=$_,this._blendWeight=$V}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(88,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector2",15),new $Vt(56,"vector4",7),new $Vt(72,"vector4",6)])}]),$t}(),$St=function(){function $t($t,$H,$I,$T,$K,$_,$V,$e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate0=$T,this._textureCoordinate1=$K,this._tangent=$_,this._blendIndex=$V,this._blendWeight=$e}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(104,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector2",15),new $Vt(56,"vector4",7),new $Vt(72,"vector4",6),new $Vt(88,"vector4",5)])}]),$t}(),$Ut=function(){function $t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$H.VertexPositionNormalColorTexture0SkinTangent=function($t,$H,$I,$T,$K,$_,$V,$e){this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate0=$T,this._textureCoordinate1=$K,this._tangent=$_,this._blendIndex=$V,this._blendWeight=$e},$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(100,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector2",15),new $Vt(56,"vector4",7),new $Vt(72,"vector4",6),new $Vt(88,"vector3",5)])}]),$t}(),$Ct=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate0=$T,this._textureCoordinate1=$K,this._tangent=$_}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(72,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector2",15),new $Vt(56,"vector4",5)])}]),$t}(),$Nt=function(){function $t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$L($t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$H.VertexPositionNormalColorTexture0Tangent=function($t,$H,$I,$T,$K,$_){this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate0=$T,this._textureCoordinate1=$K,this._tangent=$_},$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(68,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector2",15),new $Vt(56,"vector3",5)])}]),$t}(),$wt=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate=$T,this._blendIndex=$K,this._blendWeight=$_}$L($t,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(80,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector4",7),new $Vt(64,"vector4",6)])}]),$t}(),$Wt=function(){function $t($t,$H,$I,$T,$K,$_,$V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate=$T,this._tangent=$K,this._blendIndex=$_,this._blendWeight=$V}$L($t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(96,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector4",7),new $Vt(64,"vector4",6),new $Vt(80,"vector4",5)])}]),$t}(),$st=function(){function $t($t,$H,$I,$T,$K,$_,$V){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate=$T,this._tangent=$K,this._blendIndex=$_,this._blendWeight=$V}$L($t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(92,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector4",7),new $Vt(64,"vector4",6),new $Vt(80,"vector3",5)])}]),$t}(),$zt=function(){function $t($t,$H,$I,$T,$K){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate=$T,this._tangent=$K}$L($t,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(64,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector4",5)])}]),$t}(),$Pt=function(){function $t($t,$H,$I,$T,$K){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$t,this._normal=$H,this._color=$I,this._textureCoordinate=$T,this._tangent=$K}$L($t,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"color",function(){return this._color}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(60,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",1),new $Vt(40,"vector2",2),new $Vt(48,"vector3",5)])}]),$t}(),$kt=function(){function $t($t,$H,$I){this._position=null,this._normal=null,this._tangent=null,this._position=$t,this._normal=$H,this._tangent=$I}$L($t,"laya.d3.graphics.VertexPositionNormalSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(40,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector4",5)])}]),$t}(),$rt=function(){function $t($t,$H,$I){this._position=null,this._normal=null,this._tangent=null,this._position=$t,this._normal=$H,this._tangent=$I}$L($t,"laya.d3.graphics.VertexPositionNormalTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(36,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector3",5)])}]),$t}(),$xt=function(){function $t($t,$H,$I){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I}$L($t,"laya.d3.graphics.VertexPositionNormalTexture");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(32,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2)])}]),$t}(),$Yt=function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$t,this._normal=$H,this._textureCoordinate0=$I,this._textureCoordinate1=$T}$L($t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(40,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15)])}]),$t}(),$Dt=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$t,this._normal=$H,this._textureCoordinate0=$I,this._textureCoordinate1=$T,this._blendIndex=$K,this._blendWeight=$_}$L($t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(72,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15),new $Vt(40,"vector4",7),new $Vt(56,"vector4",6)])}]),$t}(),$pt=function(){function $t($t,$H,$I,$T,$K,$_,$V){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._textureCoordinate0=$I,this._textureCoordinate1=$T,this._tangent=$K,this._blendIndex=$_,this._blendWeight=$V}$L($t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(88,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15),new $Vt(40,"vector4",7),new $Vt(56,"vector4",6),new $Vt(72,"vector4",5)])}]),$t}(),$gt=function(){function $t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$L($t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$H.VertexPositionNormalTexture0SkinTangent=function($t,$H,$I,$T,$K,$_,$V){this._position=$t,this._normal=$H,this._textureCoordinate0=$I,this._textureCoordinate1=$T,this._tangent=$K,this._blendIndex=$_,this._blendWeight=$V},$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(84,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15),new $Vt(40,"vector4",7),new $Vt(56,"vector4",6),new $Vt(72,"vector3",5)])}]),$t}(),$lt=function(){function $t($t,$H,$I,$T,$K){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$t,this._normal=$H,this._textureCoordinate0=$I,this._textureCoordinate1=$T,this._tangent=$K}$L($t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(56,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15),new $Vt(40,"vector4",5)])}]),$t}(),$vt=function(){function $t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$L($t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$H.VertexPositionNormalTexture0Tangent=function($t,$H,$I,$T,$K){this._position=$t,this._normal=$H,this._textureCoordinate0=$I,this._textureCoordinate1=$T,this._tangent=$K},$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(52,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15),new $Vt(40,"vector3",5)])}]),$t}(),$yt=function(){function $t($t,$H,$I,$T,$K){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I,this._blendIndex=$T,this._blendWeight=$K}$L($t,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(64,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector4",7),new $Vt(48,"vector4",6)])}]),$t}(),$Et=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I,this._tangent=$T,this._blendIndex=$K,this._blendWeight=$_}$L($t,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(80,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector4",7),new $Vt(48,"vector4",6),new $Vt(64,"vector4",5)])}]),$t}(),$ht=function(){function $t($t,$H,$I,$T,$K,$_){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I,this._tangent=$T,this._blendIndex=$K,this._blendWeight=$_}$L($t,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(76,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector4",7),new $Vt(48,"vector4",6),new $Vt(64,"vector3",5)])}]),$t}(),$Xt=function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I,this._tangent=$T}$L($t,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(48,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector4",5)])}]),$t}(),$Bt=function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I,this._tangent=$T}$L($t,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(44,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector3",5)])}]),$t}(),$at=function(){function $t($t,$H,$I){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I}$L($t,"laya.d3.graphics.VertexPositionNTBTexture");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(56,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector3",5),new $Vt(36,"vector3",4),new $Vt(48,"vector2",2)])}]),$t}(),$ut=function(){function $t($t,$H,$I,$T,$K,$_,$V,$e){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$t,this._normal=$H,this._textureCoordinate0=$T,this._textureCoordinate1=$K,this._tangent=$_,$I=$I,this._blendIndex=$V,this._blendWeight=$e}$L($t,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"tangent",function(){return this._tangent}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(0,$H,"textureCoordinate1",function(){return this._textureCoordinate1}),$G(0,$H,"blendIndex",function(){return this._blendIndex}),$G(0,$H,"blendWeight",function(){return this._blendWeight}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(96,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector3",5),new $Vt(36,"vector3",4),new $Vt(48,"vector2",2),new $Vt(56,"vector2",15),new $Vt(64,"vector4",7),new $Vt(80,"vector4",6)])}]),$t}(),$$t=function(){function $t($t,$H,$I){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$t,this._normal=$H,this._textureCoordinate=$I}$L($t,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"textureCoordinate",function(){return this._textureCoordinate}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(88,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector3",5),new $Vt(36,"vector3",4),new $Vt(48,"vector2",2),new $Vt(56,"vector4",7),new $Vt(72,"vector4",6)])}]),$t}(),$Qt=(function(){function $t($t,$H,$I,$T){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$t,this._normal=$H,this._textureCoord0=$I,this._textureCoord1=$T}$L($t,"laya.d3.graphics.VertexPositionTerrain");var $H=$t.prototype;$N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"normal",function(){return this._normal}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoord0",function(){return this._textureCoord0}),$G(0,$H,"textureCoord1",function(){return this._textureCoord1}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(40,[new $Vt(0,"vector3",0),new $Vt(12,"vector3",3),new $Vt(24,"vector2",2),new $Vt(32,"vector2",15)])}])}(),function(){function $t($t,$H){this._position=null,this._textureCoordinate0=null,this._position=$t,this._textureCoordinate0=$H}$L($t,"laya.d3.graphics.VertexPositionTexture0");var $H=$t.prototype;return $N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"position",function(){return this._position}),$G(0,$H,"textureCoordinate0",function(){return this._textureCoordinate0}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(20,[new $Vt(0,"vector3",0),new $Vt(12,"vector2",2)])}]),$t}()),$mt=(function(){function $t($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f,$b,$L){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$t,this._positionStartLifeTime=$H,this._velocity=$I,this._startColor=$T,this._startSize=$K,this._startRotation0=$_,this._startRotation1=$V,this._startRotation2=$e,this._startLifeTime=$R,this._time=$A,this._startSpeed=$q,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$L}$L($t,"laya.d3.graphics.VertexShurikenParticleBillboard");var $H=$t.prototype;$N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$G(0,$H,"random1",function(){return this._randoms1}),$G(0,$H,"startRotation2",function(){return this._startRotation2}),$G(0,$H,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$G(0,$H,"velocity",function(){return this._velocity}),$G(0,$H,"random0",function(){return this._randoms0}),$G(0,$H,"startSize",function(){return this._startSize}),$G(0,$H,"startColor",function(){return this._startColor}),$G(0,$H,"startRotation0",function(){return this._startRotation0}),$G(0,$H,"startRotation1",function(){return this._startRotation1}),$G(0,$H,"startLifeTime",function(){return this._startLifeTime}),$G(0,$H,"time",function(){return this._time}),$G(0,$H,"startSpeed",function(){return this._startSpeed}),$G(0,$H,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(152,[new $Vt(0,"vector4",17),new $Vt(16,"vector4",30),new $Vt(32,"vector4",32),new $Vt(48,"vector4",19),new $Vt(64,"vector3",20),new $Vt(76,"vector3",22),new $Vt(88,"single",31),new $Vt(92,"vector4",34),new $Vt(108,"vector4",35),new $Vt(124,"vector3",36),new $Vt(136,"vector4",37)])}])}(),function(){function $t($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f,$b,$L){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$t,this._positionStartLifeTime=$H,this._velocity=$I,this._startColor=$T,this._startSize=$K,this._startRotation0=$_,this._startRotation1=$V,this._startRotation2=$e,this._startLifeTime=$R,this._time=$A,this._startSpeed=$q,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$L}$L($t,"laya.d3.graphics.VertexShurikenParticleMesh");var $H=$t.prototype;$N.imps($H,{"laya.d3.graphics.IVertex":!0}),$G(0,$H,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$G(0,$H,"velocity",function(){return this._velocity}),$G(0,$H,"position",function(){return this._positionStartLifeTime}),$G(0,$H,"random0",function(){return this._randoms0}),$G(0,$H,"startSize",function(){return this._startSize}),$G(0,$H,"startColor",function(){return this._startColor}),$G(0,$H,"startRotation0",function(){return this._startRotation0}),$G(0,$H,"startRotation1",function(){return this._startRotation1}),$G(0,$H,"random1",function(){return this._randoms1}),$G(0,$H,"startRotation2",function(){return this._startRotation2}),$G(0,$H,"startLifeTime",function(){return this._startLifeTime}),$G(0,$H,"time",function(){return this._time}),$G(0,$H,"startSpeed",function(){return this._startSpeed}),$G(0,$H,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$G(0,$H,"vertexDeclaration",function(){return $t._vertexDeclaration}),$G(1,$t,"vertexDeclaration",function(){return $t._vertexDeclaration}),$f($t,["_vertexDeclaration",function(){return this._vertexDeclaration=new $_t(172,[new $Vt(0,"vector3",0),new $Vt(12,"vector4",1),new $Vt(28,"vector2",2),new $Vt(36,"vector4",30),new $Vt(52,"vector4",32),new $Vt(68,"vector4",19),new $Vt(84,"vector3",20),new $Vt(96,"vector3",22),new $Vt(108,"single",31),new $Vt(112,"vector4",34),new $Vt(128,"vector4",35),new $Vt(144,"vector3",36),new $Vt(156,"vector4",37)])}])}(),function(){function $U($t,$H,$I,$T,$K,$_){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$I,this._materials=$T,this._subMeshes=$K,this._materialMap=$_,this._version=$H,this._onLoaded($t)}$L($U,"laya.d3.loaders.LoadModelV01");var $t=$U.prototype;return $t._onLoaded=function($t){this._readData=$t,this.READ_BLOCK();for(var $H=0;$H<this._BLOCK.count;$H++){var $I=this._readData.getUint16(),$T=this._strings[$I],$K=this["READ_"+$T];if(null==$K)throw new Error("model file err,no this function:"+$I+" "+$T);if(!$K.call(this))break}return this._mesh},$t.onError=function(){},$t._readString=function(){return this._strings[this._readData.getUint16()]},$t.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$t.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$t.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $t=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $H=0;$H<this._STRINGS.size;$H++)this._strings[$H]=this._readData.readUTFString();return this._readData.pos=$t,!0},$t.READ_MATERIAL=function(){var $t=this._readData.getUint16(),$H=(this._readString(),this._readString());return this._materials[$t]="null"!==$H?$J.getRes(this._materialMap[$H]):new $rH,!0},$t.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $t,$H=this._readData.__getBuffer(),$I=0,$T=this._readData.getUint32(),$K=this._readData.getUint32(),$_=(new Float32Array($H.slice($T+this._DATA.offset,$T+this._DATA.offset+$K)),this._readData.getUint32()),$V=this._readData.getUint32(),$e=new Float32Array($H.slice($_+this._DATA.offset,$_+this._DATA.offset+$V));for(this.mesh._inverseBindPoses=[],$I=0,$t=$e.length;$I<$t;$I+=16){var $R=new $tH($e[$I+0],$e[$I+1],$e[$I+2],$e[$I+3],$e[$I+4],$e[$I+5],$e[$I+6],$e[$I+7],$e[$I+8],$e[$I+9],$e[$I+10],$e[$I+11],$e[$I+12],$e[$I+13],$e[$I+14],$e[$I+15]);this.mesh._inverseBindPoses.push($R)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$t.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $t=this._readString();this._shaderAttributes=$t.match($U._attrReg);var $H=this._readData.getUint32(),$I=this._readData.getUint32(),$T=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$K=this._readData.getUint32(),$_=this._readData.getUint32(),$V=this._readData.getUint32(),$e=this._readData.__getBuffer(),$R=new $AH(this._mesh),$A=this._getVertexDeclaration(),$q=$hH.create($A,$K/$A.vertexStride,35044,!0),$f=$T+this._DATA.offset,$b=$e.slice($f,$f+$K);$q.setData(new Float32Array($b));for(var $L=($R._vertexBuffer=$q).vertexDeclaration.getVertexElements(),$G=0;$G<$L.length;$G++)$R._bufferUsage[$L[$G].elementUsage]=$q;var $M=$EH.create("ushort",$I/2,35044,!0),$O=$H+this._DATA.offset,$J=$e.slice($O,$O+$I);$M.setData(new Uint16Array($J)),$R._indexBuffer=$M;var $S=$e.slice($_+this._DATA.offset,$_+this._DATA.offset+$V);return $R._boneIndicesList[0]=new Uint8Array($S),this._subMeshes.push($R),!0},$t.READ_DATAAREA=function(){return!1},$t._getVertexDeclaration=function(){for(var $t,$H=!1,$I=!1,$T=!1,$K=!1,$_=!1,$V=!1,$e=!1,$R=!1,$A=!1,$q=0;$q<this._shaderAttributes.length;$q+=8)switch(this._shaderAttributes[$q]){case"POSITION":$H=!0;break;case"NORMAL":$I=!0;break;case"COLOR":$T=!0;break;case"UV":$K=!0;break;case"UV1":$_=!0;break;case"BLENDWEIGHT":$e=!0;break;case"BLENDINDICES":$R=!0;break;case"TANGENT":$V=!0;break;case"BINORMAL":$A=!0}return $H&&$I&&$T&&$K&&$_&&$e&&$R&&$V?$t=$Ut.vertexDeclaration:$H&&$I&&$T&&$K&&$_&&$e&&$R?$t=$Jt.vertexDeclaration:$H&&$I&&$K&&$_&&$e&&$R&&$V?$t=$gt.vertexDeclaration:$H&&$I&&$K&&$_&&$e&&$R?$t=$Dt.vertexDeclaration:$H&&$I&&$T&&$K&&$e&&$R&&$V?$t=$st.vertexDeclaration:$H&&$I&&$T&&$K&&$e&&$R?$t=$wt.vertexDeclaration:$H&&$I&&$V&&$A&&$K&&$e&&$R?$t=$$t.vertexDeclaration:$H&&$I&&$K&&$e&&$R&&$V?$t=$ht.vertexDeclaration:$H&&$I&&$K&&$e&&$R?$t=$yt.vertexDeclaration:$H&&$I&&$T&&$e&&$R&&$V?$t=$bt.vertexDeclaration:$H&&$I&&$T&&$e&&$R?$t=$qt.vertexDeclaration:$H&&$I&&$T&&$K&&$_&&$V?$t=$Nt.vertexDeclaration:$H&&$I&&$T&&$K&&$_?$t=$Ot.vertexDeclaration:$H&&$I&&$K&&$_&&$V?$t=$vt.vertexDeclaration:$H&&$I&&$K&&$_?$t=$Yt.vertexDeclaration:$H&&$I&&$T&&$K&&$V?$t=$Pt.vertexDeclaration:$H&&$I&&$K&&$V&&$A?$t=$at.vertexDeclaration:$H&&$I&&$T&&$K?$t=$Mt.vertexDeclaration:$H&&$I&&$K&&$V?$t=$Bt.vertexDeclaration:$H&&$I&&$K?$t=$xt.vertexDeclaration:$H&&$I&&$T&&$V?$t=$Gt.vertexDeclaration:$H&&$I&&$T&&($t=$At.vertexDeclaration),$t},$G(0,$t,"mesh",function(){return this._mesh}),$U._attrReg=new RegExp("(\\w+)|([:,;])","g"),$U}()),$ot=function(){function $W(){}return $L($W,"laya.d3.loaders.LoadModelV02"),$W.parse=function($t,$H,$I,$T,$K,$_){$W._mesh=$I,$W._materials=$T,$W._subMeshes=$K,$W._materialMap=$_,$W._version=$H,$W._readData=$t,$W.READ_DATA(),$W.READ_BLOCK(),$W.READ_STRINGS();for(var $V=0,$e=$W._BLOCK.count;$V<$e;$V++){$W._readData.pos=$W._BLOCK.blockStarts[$V];var $R=$W._readData.getUint16(),$A=$W._strings[$R],$q=$W["READ_"+$A];if(null==$q)throw new Error("model file err,no this function:"+$R+" "+$A);$q.call()}$W._strings.length=0,$W._readData=null,$W._version=null,$W._mesh=null,$W._materials=null,$W._subMeshes=null,$W._materialMap=null},$W._readString=function(){return $W._strings[$W._readData.getUint16()]},$W.READ_DATA=function(){$W._DATA.offset=$W._readData.getUint32(),$W._DATA.size=$W._readData.getUint32()},$W.READ_BLOCK=function(){for(var $t=$W._BLOCK.count=$W._readData.getUint16(),$H=$W._BLOCK.blockStarts=[],$I=$W._BLOCK.blockLengths=[],$T=0;$T<$t;$T++)$H.push($W._readData.getUint32()),$I.push($W._readData.getUint32())},$W.READ_STRINGS=function(){var $t=$W._readData.getUint32(),$H=$W._readData.getUint16(),$I=$W._readData.pos;$W._readData.pos=$t+$W._DATA.offset;for(var $T=0;$T<$H;$T++)$W._strings[$T]=$W._readData.readUTFString();$W._readData.pos=$I},$W.READ_MATERIAL=function(){$W._readString(),$W._readString();var $t=$W._readString();return""!==$t&&$W._materials.push($J.getRes($W._materialMap[$t])),!0},$W.READ_MESH=function(){$W._readString();var $t,$H=$W._readData.__getBuffer(),$I=0,$T=$W._readData.getInt16(),$K=$W._DATA.offset;for($I=0;$I<$T;$I++){var $_=$K+$W._readData.getUint32(),$V=$W._readData.getUint32(),$e=new Float32Array($H.slice($_,$_+$V)),$R=$W._readString().match($W._attrReg),$A=$W._getVertexDeclaration($R),$q=$hH.create($A,4*$e.length/$A.vertexStride,35044,!0);$q.setData($e),$W._mesh._vertexBuffers.push($q)}var $f=$K+$W._readData.getUint32(),$b=$W._readData.getUint32(),$L=new Uint16Array($H.slice($f,$f+$b)),$G=$EH.create("ushort",$b/2,35044,!0);$G.setData($L),$W._mesh._indexBuffer=$G;var $M=$W._mesh._boneNames=[],$O=$W._readData.getUint16();for($M.length=$O,$I=0;$I<$O;$I++)$M[$I]=$W._strings[$W._readData.getUint16()];var $J=$W._readData.getUint32(),$S=$W._readData.getUint32(),$U=(new Float32Array($H.slice($K+$J,$K+$J+$S)),$W._readData.getUint32()),$C=$W._readData.getUint32(),$N=new Float32Array($H.slice($K+$U,$K+$U+$C));for($W._mesh._inverseBindPoses=[],$I=0,$t=$N.length;$I<$t;$I+=16){var $w=new $tH($N[$I+0],$N[$I+1],$N[$I+2],$N[$I+3],$N[$I+4],$N[$I+5],$N[$I+6],$N[$I+7],$N[$I+8],$N[$I+9],$N[$I+10],$N[$I+11],$N[$I+12],$N[$I+13],$N[$I+14],$N[$I+15]);$W._mesh._inverseBindPoses.push($w)}return $W._mesh._skinnedDatas=new Float32Array(16*$N.length),!0},$W.READ_SUBMESH=function(){var $t=$W._readData.__getBuffer(),$H=new $AH($W._mesh),$I=$W._readData.getInt16(),$T=$W._readData.getUint32(),$K=$W._readData.getUint32();$H._vertexBuffer=$W._mesh._vertexBuffers[$I],$H._vertexStart=$T,$H._vertexCount=$K;var $_=$W._readData.getUint32(),$V=$W._readData.getUint32(),$e=$W._mesh._indexBuffer;$H._indexBuffer=$e,$H._indexStart=$_,$H._indexCount=$V,$H._indices=new Uint16Array($e.getData().buffer,2*$_,$V);var $R=$W._DATA.offset,$A=$H._subIndexBufferStart,$q=$H._subIndexBufferCount,$f=$H._boneIndicesList,$b=$W._readData.getUint16();$A.length=$b,$q.length=$b,$f.length=$b;for(var $L=0;$L<$b;$L++){$A[$L]=$W._readData.getUint32(),$q[$L]=$W._readData.getUint32();var $G=$W._readData.getUint32(),$M=$W._readData.getUint32();$H._boneIndicesList[$L]=new Uint8Array($t.slice($R+$G,$R+$G+$M))}return $W._subMeshes.push($H),!0},$W._getVertexDeclaration=function($t){for(var $H,$I=!1,$T=!1,$K=!1,$_=!1,$V=!1,$e=!1,$R=!1,$A=!1,$q=!1,$f=0;$f<$t.length;$f++)switch($t[$f]){case"POSITION":$I=!0;break;case"NORMAL":$T=!0;break;case"COLOR":$K=!0;break;case"UV":$_=!0;break;case"UV1":$V=!0;break;case"BLENDWEIGHT":$R=!0;break;case"BLENDINDICES":$A=!0;break;case"TANGENT":$e=!0;break;case"BINORMAL":$q=!0}return $I&&$T&&$K&&$_&&$V&&$R&&$A&&$e?$H=$Ut.vertexDeclaration:$I&&$T&&$K&&$_&&$V&&$R&&$A?$H=$Jt.vertexDeclaration:$I&&$T&&$_&&$V&&$R&&$A&&$e?$H=$gt.vertexDeclaration:$I&&$T&&$_&&$V&&$R&&$A?$H=$Dt.vertexDeclaration:$I&&$T&&$K&&$_&&$R&&$A&&$e?$H=$st.vertexDeclaration:$I&&$T&&$K&&$_&&$R&&$A?$H=$wt.vertexDeclaration:$I&&$T&&$_&&$R&&$A&&$e?$H=$ht.vertexDeclaration:$I&&$T&&$_&&$R&&$A?$H=$yt.vertexDeclaration:$I&&$T&&$K&&$R&&$A&&$e?$H=$bt.vertexDeclaration:$I&&$T&&$K&&$R&&$A?$H=$qt.vertexDeclaration:$I&&$T&&$K&&$_&&$V&&$e?$H=$Nt.vertexDeclaration:$I&&$T&&$K&&$_&&$V?$H=$Ot.vertexDeclaration:$I&&$T&&$_&&$V&&$e?$H=$vt.vertexDeclaration:$I&&$T&&$_&&$V?$H=$Yt.vertexDeclaration:$I&&$T&&$K&&$_&&$e?$H=$Pt.vertexDeclaration:$I&&$T&&$_&&$e&&$q?$H=$at.vertexDeclaration:$I&&$T&&$K&&$_?$H=$Mt.vertexDeclaration:$I&&$T&&$_&&$e?$H=$Bt.vertexDeclaration:$I&&$T&&$_?$H=$xt.vertexDeclaration:$I&&$T&&$K&&$e?$H=$Gt.vertexDeclaration:$I&&$T&&$K&&($H=$At.vertexDeclaration),$H},$W._attrReg=new RegExp("(\\w+)|([:,;])","g"),$W._strings=[],$W._readData=null,$W._version=null,$W._mesh=null,$W._materials=null,$W._subMeshes=null,$W._materialMap=null,$f($W,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$W}(),$nt=function(){function $w(){}return $L($w,"laya.d3.loaders.LoadModelV03"),$w.parse=function($t,$H,$I,$T,$K){$w._mesh=$I,$w._subMeshes=$T,$w._materialMap=$K,$w._version=$H,$w._readData=$t,$w.READ_DATA(),$w.READ_BLOCK(),$w.READ_STRINGS();for(var $_=0,$V=$w._BLOCK.count;$_<$V;$_++){$w._readData.pos=$w._BLOCK.blockStarts[$_];var $e=$w._readData.getUint16(),$R=$w._strings[$e],$A=$w["READ_"+$R];if(null==$A)throw new Error("model file err,no this function:"+$e+" "+$R);$A.call()}$w._strings.length=0,$w._readData=null,$w._version=null,$w._mesh=null,$w._subMeshes=null,$w._materialMap=null},$w._readString=function(){return $w._strings[$w._readData.getUint16()]},$w.READ_DATA=function(){$w._DATA.offset=$w._readData.getUint32(),$w._DATA.size=$w._readData.getUint32()},$w.READ_BLOCK=function(){for(var $t=$w._BLOCK.count=$w._readData.getUint16(),$H=$w._BLOCK.blockStarts=[],$I=$w._BLOCK.blockLengths=[],$T=0;$T<$t;$T++)$H.push($w._readData.getUint32()),$I.push($w._readData.getUint32())},$w.READ_STRINGS=function(){var $t=$w._readData.getUint32(),$H=$w._readData.getUint16(),$I=$w._readData.pos;$w._readData.pos=$t+$w._DATA.offset;for(var $T=0;$T<$H;$T++)$w._strings[$T]=$w._readData.readUTFString();$w._readData.pos=$I},$w.READ_MESH=function(){var $t,$H=$w._readString(),$I=$w._readData.__getBuffer(),$T=0,$K=$w._readData.getInt16(),$_=$w._DATA.offset;for($T=0;$T<$K;$T++){var $V,$e=$_+$w._readData.getUint32(),$R=$w._readData.getUint32(),$A=new Float32Array($I.slice($e,$e+$R)),$q=$w._readString();switch($w._version){case"LAYAMODEL:03":$V=$w._vertexDeclarationMap_Discard[$q];break;case"LAYAMODEL:0301":$V=$w._vertexDeclarationMap[$q];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$V)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$w._version+"  bufferAttribute="+$q+"  name="+$H+"  url="+($w._mesh?$w._mesh.url:"null"));var $f=$hH.create($V,4*$A.length/$V.vertexStride,35044,!0,$w._mesh._url+"_"+$T);$f.setData($A),$w._mesh._vertexBuffers.push($f)}var $b=$_+$w._readData.getUint32(),$L=$w._readData.getUint32(),$G=new Uint16Array($I.slice($b,$b+$L)),$M=$EH.create("ushort",$L/2,35044,!0,$w._mesh._url);$M.setData($G),$w._mesh._indexBuffer=$M;var $O=$w._mesh._boneNames=[],$J=$w._readData.getUint16();for($O.length=$J,$T=0;$T<$J;$T++)$O[$T]=$w._strings[$w._readData.getUint16()];$w._readData.pos+=8;var $S=$w._readData.getUint32(),$U=$w._readData.getUint32(),$C=new Float32Array($I.slice($_+$S,$_+$S+$U));for($w._mesh._inverseBindPoses=[],$T=0,$t=$C.length;$T<$t;$T+=16){var $N=new $tH($C[$T+0],$C[$T+1],$C[$T+2],$C[$T+3],$C[$T+4],$C[$T+5],$C[$T+6],$C[$T+7],$C[$T+8],$C[$T+9],$C[$T+10],$C[$T+11],$C[$T+12],$C[$T+13],$C[$T+14],$C[$T+15]);$w._mesh._inverseBindPoses.push($N)}return $w._mesh._skinnedDatas=new Float32Array(16*$C.length),!0},$w.READ_SUBMESH=function(){var $t=$w._readData.__getBuffer(),$H=new $AH($w._mesh),$I=$w._readData.getInt16(),$T=$w._readData.getUint32(),$K=$w._readData.getUint32();$H._vertexBuffer=$w._mesh._vertexBuffers[$I],$H._vertexStart=$T,$H._vertexCount=$K;var $_=$w._readData.getUint32(),$V=$w._readData.getUint32(),$e=$w._mesh._indexBuffer;$H._indexBuffer=$e,$H._indexStart=$_,$H._indexCount=$V,$H._indices=new Uint16Array($e.getData().buffer,2*$_,$V);var $R=$w._DATA.offset,$A=$H._subIndexBufferStart,$q=$H._subIndexBufferCount,$f=$H._boneIndicesList,$b=$w._readData.getUint16();$A.length=$b,$q.length=$b,$f.length=$b;for(var $L=0;$L<$b;$L++){$A[$L]=$w._readData.getUint32(),$q[$L]=$w._readData.getUint32();var $G=$w._readData.getUint32(),$M=$w._readData.getUint32();$f[$L]=new Uint8Array($t.slice($R+$G,$R+$G+$M))}return $w._subMeshes.push($H),!0},$w._strings=[],$w._readData=null,$w._version=null,$w._mesh=null,$w._subMeshes=null,$w._materialMap=null,$f($w,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Ut.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Jt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$ut.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$gt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Dt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$st.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$wt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$ht.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$yt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$bt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$qt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Nt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$Ot.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$vt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$Yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$Pt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$at.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$Mt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Bt.vertexDeclaration,"POSITION,NORMAL,UV":$xt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$Gt.vertexDeclaration,"POSITION,NORMAL,COLOR":$At.vertexDeclaration,"POSITION,NORMAL,TANGENT":$rt.vertexDeclaration,"POSITION,NORMAL":$Rt.vertexDeclaration,"POSITION,UV":$Qt.vertexDeclaration,POSITION:$et.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$St.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Jt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$ut.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$pt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Dt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Wt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$wt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Et.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$yt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$ft.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$qt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Ct.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$Ot.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$lt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$Yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$zt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$at.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$Mt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Xt.vertexDeclaration,"POSITION,NORMAL,UV":$xt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$Lt.vertexDeclaration,"POSITION,NORMAL,COLOR":$At.vertexDeclaration,"POSITION,NORMAL,TANGENT":$kt.vertexDeclaration,"POSITION,NORMAL":$Rt.vertexDeclaration,"POSITION,UV":$Qt.vertexDeclaration,POSITION:$et.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$w}(),$Ft=function(){function $e(){}return $L($e,"laya.d3.loaders.MeshReader"),$e.read=function($t,$H,$I,$T,$K){var $_=new $w($t);$_.pos=0;var $V=$_.readUTFString();switch($V){case"LAYAMODEL:01":case"LAYASKINANI:01":$e._readVersion01($_,$V,$H,$I,$T,$K);break;case"LAYAMODEL:02":$ot.parse($_,$V,$H,$I,$T,$K);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$nt.parse($_,$V,$H,$T,$K);break;default:throw new Error("MeshReader: unknown mesh version.")}$H._setSubMeshes($T)},$e._readVersion01=function($t,$H,$I,$T,$K,$_){new $mt($t,$H,$I,$T,$K,$_)},$e}(),$ct=function(){function $t($t,$H){this.min=null,this.max=null,this.min=$t,this.max=$H}$L($t,"laya.d3.math.BoundBox");var $H=$t.prototype;return $N.imps($H,{"laya.d3.core.IClone":!0}),$H.getCorners=function($t){$t.length=8;var $H=this.min.elements,$I=this.max.elements,$T=$H[0],$K=$H[1],$_=$H[2],$V=$I[0],$e=$I[1],$R=$I[2];$t[0]=new $VH($T,$e,$R),$t[1]=new $VH($V,$e,$R),$t[2]=new $VH($V,$K,$R),$t[3]=new $VH($T,$K,$R),$t[4]=new $VH($T,$e,$_),$t[5]=new $VH($V,$e,$_),$t[6]=new $VH($V,$K,$_),$t[7]=new $VH($T,$K,$_)},$H.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$H.cloneTo=function($t){var $H=$t;this.min.cloneTo($H.min),this.max.cloneTo($H.max)},$H.clone=function(){var $t=new this.constructor(new $VH,new $VH);return this.cloneTo($t),$t},$t.createfromPoints=function($t,$H){if(null==$t)throw new Error("points");var $I=$H.min,$T=$H.max,$K=$I.elements;$K[0]=Number.MAX_VALUE,$K[1]=Number.MAX_VALUE,$K[2]=Number.MAX_VALUE;var $_=$T.elements;$_[0]=-Number.MAX_VALUE,$_[1]=-Number.MAX_VALUE,$_[2]=-Number.MAX_VALUE;for(var $V=0,$e=$t.length;$V<$e;++$V)$VH.min($I,$t[$V],$I),$VH.max($T,$t[$V],$T)},$t.merge=function($t,$H,$I){$VH.min($t.min,$H.min,$I.min),$VH.max($t.max,$H.max,$I.max)},$t}(),$it=function(){function $A($t){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$t,this._near=new $HH(new $VH),this._far=new $HH(new $VH),this._left=new $HH(new $VH),this._right=new $HH(new $VH),this._top=new $HH(new $VH),this._bottom=new $HH(new $VH),$A._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$L($A,"laya.d3.math.BoundFrustum");var $t=$A.prototype;return $t.equalsBoundFrustum=function($t){return this._matrix.equalsOtherMatrix($t.matrix)},$t.equalsObj=function($t){if($t instanceof laya.d3.math.BoundFrustum){var $H=$t;return this.equalsBoundFrustum($H)}return!1},$t.getPlane=function($t){switch($t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$t.getCorners=function($t){$A._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($t[0]),$A._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($t[1]),$A._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($t[2]),$A._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($t[3]),$A._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($t[4]),$A._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($t[5]),$A._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($t[6]),$A._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($t[7])},$t.containsPoint=function($t){for(var $H=$HH.PlaneIntersectionType_Front,$I=$HH.PlaneIntersectionType_Front,$T=0;$T<6;$T++){switch($T){case 0:$I=Collision.intersectsPlaneAndPoint(this._near,$t);break;case 1:$I=Collision.intersectsPlaneAndPoint(this._far,$t);break;case 2:$I=Collision.intersectsPlaneAndPoint(this._left,$t);break;case 3:$I=Collision.intersectsPlaneAndPoint(this._right,$t);break;case 4:$I=Collision.intersectsPlaneAndPoint(this._top,$t);break;case 5:$I=Collision.intersectsPlaneAndPoint(this._bottom,$t)}switch($I){case $HH.PlaneIntersectionType_Back:return 0;case $HH.PlaneIntersectionType_Intersecting:$H=$HH.PlaneIntersectionType_Intersecting}}switch($H){case $HH.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$t.containsBoundBox=function($t){for(var $H,$I=$A._tempV30,$T=$A._tempV31,$K=1,$_=0;$_<6;$_++){if($H=this.getPlane($_),this._getBoxToPlanePVertexNVertex($t,$H.normal,$I,$T),Collision.intersectsPlaneAndPoint($H,$I)===$HH.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($H,$T)===$HH.PlaneIntersectionType_Back&&($K=2)}return $K},$t.containsBoundSphere=function($t){for(var $H=$HH.PlaneIntersectionType_Front,$I=$HH.PlaneIntersectionType_Front,$T=0;$T<6;$T++){switch($T){case 0:$I=Collision.intersectsPlaneAndSphere(this._near,$t);break;case 1:$I=Collision.intersectsPlaneAndSphere(this._far,$t);break;case 2:$I=Collision.intersectsPlaneAndSphere(this._left,$t);break;case 3:$I=Collision.intersectsPlaneAndSphere(this._right,$t);break;case 4:$I=Collision.intersectsPlaneAndSphere(this._top,$t);break;case 5:$I=Collision.intersectsPlaneAndSphere(this._bottom,$t)}switch($I){case $HH.PlaneIntersectionType_Back:return 0;case $HH.PlaneIntersectionType_Intersecting:$H=$HH.PlaneIntersectionType_Intersecting}}switch($H){case $HH.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$t._getBoxToPlanePVertexNVertex=function($t,$H,$I,$T){var $K=$t.min,$_=$K.elements,$V=$t.max,$e=$V.elements,$R=$H.elements,$A=$R[0],$q=$R[1],$f=$R[2];$K.cloneTo($I);var $b=$I.elements;0<=$A&&($b[0]=$e[0]),0<=$q&&($b[1]=$e[1]),0<=$f&&($b[2]=$e[2]),$V.cloneTo($T);var $L=$T.elements;0<=$A&&($L[0]=$_[0]),0<=$q&&($L[1]=$_[1]),0<=$f&&($L[2]=$_[2])},$G(0,$t,"top",function(){return this._top}),$G(0,$t,"matrix",function(){return this._matrix},function($t){this._matrix=$t,$A._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$G(0,$t,"near",function(){return this._near}),$G(0,$t,"far",function(){return this._far}),$G(0,$t,"left",function(){return this._left}),$G(0,$t,"right",function(){return this._right}),$G(0,$t,"bottom",function(){return this._bottom}),$A._getPlanesFromMatrix=function($t,$H,$I,$T,$K,$_,$V){var $e=$t.elements,$R=$e[0],$A=$e[1],$q=$e[2],$f=$e[3],$b=$e[4],$L=$e[5],$G=$e[6],$M=$e[7],$O=$e[8],$J=$e[9],$S=$e[10],$U=$e[11],$C=$e[12],$N=$e[13],$w=$e[14],$W=$e[15],$s=$H.normal.elements;$s[0]=$f+$q,$s[1]=$M+$G,$s[2]=$U+$S,$H.distance=$W+$w,$H.normalize();var $z=$I.normal.elements;$z[0]=$f-$q,$z[1]=$M-$G,$z[2]=$U-$S,$I.distance=$W-$w,$I.normalize();var $P=$T.normal.elements;$P[0]=$f+$R,$P[1]=$M+$b,$P[2]=$U+$O,$T.distance=$W+$C,$T.normalize();var $k=$K.normal.elements;$k[0]=$f-$R,$k[1]=$M-$b,$k[2]=$U-$O,$K.distance=$W-$C,$K.normalize();var $r=$_.normal.elements;$r[0]=$f-$A,$r[1]=$M-$L,$r[2]=$U-$J,$_.distance=$W-$N,$_.normalize();var $x=$V.normal.elements;$x[0]=$f+$A,$x[1]=$M+$L,$x[2]=$U+$J,$V.distance=$W+$N,$V.normalize()},$A._get3PlaneInterPoint=function($t,$H,$I){var $T=$t.normal,$K=$H.normal,$_=$I.normal;$VH.cross($K,$_,$A._tempV30),$VH.cross($_,$T,$A._tempV31),$VH.cross($T,$K,$A._tempV32);var $V=$VH.dot($T,$A._tempV30),$e=$VH.dot($K,$A._tempV31),$R=$VH.dot($_,$A._tempV32);return $VH.scale($A._tempV30,-$t.distance/$V,$A._tempV33),$VH.scale($A._tempV31,-$H.distance/$e,$A._tempV34),$VH.scale($A._tempV32,-$I.distance/$R,$A._tempV35),$VH.add($A._tempV33,$A._tempV34,$A._tempV36),$VH.add($A._tempV35,$A._tempV36,$A._tempV37),$A._tempV37},$f($A,["_tempV30",function(){return this._tempV30=new $VH},"_tempV31",function(){return this._tempV31=new $VH},"_tempV32",function(){return this._tempV32=new $VH},"_tempV33",function(){return this._tempV33=new $VH},"_tempV34",function(){return this._tempV34=new $VH},"_tempV35",function(){return this._tempV35=new $VH},"_tempV36",function(){return this._tempV36=new $VH},"_tempV37",function(){return this._tempV37=new $VH}]),$A}(),$jt=function(){function $q($t,$H){this.center=null,this.radius=NaN,this.center=$t,this.radius=$H}$L($q,"laya.d3.math.BoundSphere");var $t=$q.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.toDefault=function(){this.center.toDefault(),this.radius=0},$t.intersectsRayDistance=function($t){return Collision.intersectsRayAndSphereRD($t,this)},$t.intersectsRayPoint=function($t,$H){return Collision.intersectsRayAndSphereRP($t,this,$H)},$t.cloneTo=function($t){var $H=$t;this.center.cloneTo($H.center),$H.radius=this.radius},$t.clone=function(){var $t=new this.constructor(new $VH,new $VH);return this.cloneTo($t),$t},$q.createFromSubPoints=function($t,$H,$I,$T){if(null==$t)throw new Error("points");if($H<0||$H>=$t.length)throw new Error("start"+$H+"Must be in the range [0, "+($t.length-1)+"]");if($I<0||$H+$I>$t.length)throw new Error("count"+$I+"Must be in the range <= "+$t.length+"}");var $K=$H+$I,$_=$q._tempVector3;$_.elements[0]=0,$_.elements[1]=0,$_.elements[2]=0;for(var $V=$H;$V<$K;++$V)$VH.add($t[$V],$_,$_);var $e=$T.center;$VH.scale($_,1/$I,$e);var $R=0;for($V=$H;$V<$K;++$V){var $A=$VH.distanceSquared($e,$t[$V]);$R<$A&&($R=$A)}$T.radius=Math.sqrt($R)},$q.createfromPoints=function($t,$H){if(null==$t)throw new Error("points");$q.createFromSubPoints($t,0,$t.length,$H)},$f($q,["_tempVector3",function(){return this._tempVector3=new $VH}]),$q}(),$dt=(function(){function $t(){}$L($t,"laya.d3.math.ContainmentType"),$t.Disjoint=0,$t.Contains=1,$t.Intersects=2}(),function(){function $I(){}return $L($I,"laya.d3.math.MathUtils3D"),$I.isZero=function($t){return Math.abs($t)<$I.zeroTolerance},$I.nearEqual=function($t,$H){return!!$I.isZero($t-$H)},$I.fastInvSqrt=function($t){return $I.isZero($t)?$t:1/Math.sqrt($t)},$f($I,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$I}()),$Zt=function(){function $R(){var $t=this.elements=new Float32Array(9);$t[0]=1,$t[1]=0,$t[2]=0,$t[3]=0,$t[4]=1,$t[5]=0,$t[6]=0,$t[7]=0,$t[8]=1}$L($R,"laya.d3.math.Matrix3x3");var $t=$R.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.determinant=function(){var $t=this.elements,$H=$t[0],$I=$t[1],$T=$t[2],$K=$t[3],$_=$t[4],$V=$t[5],$e=$t[6],$R=$t[7],$A=$t[8];return $H*($A*$_-$V*$R)+$I*(-$A*$K+$V*$e)+$T*($R*$K-$_*$e)},$t.translate=function($t,$H){var $I=$H.elements,$T=this.elements,$K=$t.elements,$_=$T[0],$V=$T[1],$e=$T[2],$R=$T[3],$A=$T[4],$q=$T[5],$f=$T[6],$b=$T[7],$L=$T[8],$G=$K[0],$M=$K[1];$I[0]=$_,$I[1]=$V,$I[2]=$e,$I[3]=$R,$I[4]=$A,$I[5]=$q,$I[6]=$G*$_+$M*$R+$f,$I[7]=$G*$V+$M*$A+$b,$I[8]=$G*$e+$M*$q+$L},$t.rotate=function($t,$H){var $I=$H.elements,$T=this.elements,$K=$T[0],$_=$T[1],$V=$T[2],$e=$T[3],$R=$T[4],$A=$T[5],$q=$T[6],$f=$T[7],$b=$T[8],$L=Math.sin($t),$G=Math.cos($t);$I[0]=$G*$K+$L*$e,$I[1]=$G*$_+$L*$R,$I[2]=$G*$V+$L*$A,$I[3]=$G*$e-$L*$K,$I[4]=$G*$R-$L*$_,$I[5]=$G*$A-$L*$V,$I[6]=$q,$I[7]=$f,$I[8]=$b},$t.scale=function($t,$H){var $I=$H.elements,$T=this.elements,$K=$t.elements,$_=$K[0],$V=$K[1];$I[0]=$_*$T[0],$I[1]=$_*$T[1],$I[2]=$_*$T[2],$I[3]=$V*$T[3],$I[4]=$V*$T[4],$I[5]=$V*$T[5],$I[6]=$T[6],$I[7]=$T[7],$I[8]=$T[8]},$t.invert=function($t){var $H=$t.elements,$I=this.elements,$T=$I[0],$K=$I[1],$_=$I[2],$V=$I[3],$e=$I[4],$R=$I[5],$A=$I[6],$q=$I[7],$f=$I[8],$b=$f*$e-$R*$q,$L=-$f*$V+$R*$A,$G=$q*$V-$e*$A,$M=$T*$b+$K*$L+$_*$G;$M||($t=null),$M=1/$M,$H[0]=$b*$M,$H[1]=(-$f*$K+$_*$q)*$M,$H[2]=($R*$K-$_*$e)*$M,$H[3]=$L*$M,$H[4]=($f*$T-$_*$A)*$M,$H[5]=(-$R*$T+$_*$V)*$M,$H[6]=$G*$M,$H[7]=(-$q*$T+$K*$A)*$M,$H[8]=($e*$T-$K*$V)*$M},$t.transpose=function($t){var $H=$t.elements,$I=this.elements;if($t===this){var $T=$I[1],$K=$I[2],$_=$I[5];$H[1]=$I[3],$H[2]=$I[6],$H[3]=$T,$H[5]=$I[7],$H[6]=$K,$H[7]=$_}else $H[0]=$I[0],$H[1]=$I[3],$H[2]=$I[6],$H[3]=$I[1],$H[4]=$I[4],$H[5]=$I[7],$H[6]=$I[2],$H[7]=$I[5],$H[8]=$I[8]},$t.identity=function(){var $t=this.elements;$t[0]=1,$t[1]=0,$t[2]=0,$t[3]=0,$t[4]=1,$t[5]=0,$t[6]=0,$t[7]=0,$t[8]=1},$t.cloneTo=function($t){var $H,$I,$T;if(($I=this.elements)!==($T=$t.elements))for($H=0;$H<9;++$H)$T[$H]=$I[$H]},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$R.createFromTranslation=function($t,$H){$H.elements;var $I=$t.elements;$H[0]=1,$H[1]=0,$H[2]=0,$H[3]=0,$H[4]=1,$H[5]=0,$H[6]=$I[0],$H[7]=$I[1],$H[8]=1},$R.createFromRotation=function($t,$H){var $I=$H.elements,$T=Math.sin($t),$K=Math.cos($t);$I[0]=$K,$I[1]=$T,$I[2]=0,$I[3]=-$T,$I[4]=$K,$I[5]=0,$I[6]=0,$I[7]=0,$I[8]=1},$R.createFromScaling=function($t,$H){var $I=$H.elements,$T=$t.elements;$I[0]=$T[0],$I[1]=0,$I[2]=0,$I[3]=0,$I[4]=$T[1],$I[5]=0,$I[6]=0,$I[7]=0,$I[8]=1},$R.createFromMatrix4x4=function($t,$H){$H[0]=$t[0],$H[1]=$t[1],$H[2]=$t[2],$H[3]=$t[4],$H[4]=$t[5],$H[5]=$t[6],$H[6]=$t[8],$H[7]=$t[9],$H[8]=$t[10]},$R.multiply=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements,$V=$K[0],$e=$K[1],$R=$K[2],$A=$K[3],$q=$K[4],$f=$K[5],$b=$K[6],$L=$K[7],$G=$K[8],$M=$_[0],$O=$_[1],$J=$_[2],$S=$_[3],$U=$_[4],$C=$_[5],$N=$_[6],$w=$_[7],$W=$_[8];$T[0]=$M*$V+$O*$A+$J*$b,$T[1]=$M*$e+$O*$q+$J*$L,$T[2]=$M*$R+$O*$f+$J*$G,$T[3]=$S*$V+$U*$A+$C*$b,$T[4]=$S*$e+$U*$q+$C*$L,$T[5]=$S*$R+$U*$f+$C*$G,$T[6]=$N*$V+$w*$A+$W*$b,$T[7]=$N*$e+$w*$q+$W*$L,$T[8]=$N*$R+$w*$f+$W*$G},$R.lookAt=function($t,$H,$I,$T){$VH.subtract($t,$H,$R._tempV30),$VH.normalize($R._tempV30,$R._tempV30),$VH.cross($I,$R._tempV30,$R._tempV31),$VH.normalize($R._tempV31,$R._tempV31),$VH.cross($R._tempV30,$R._tempV31,$R._tempV32);var $K=$R._tempV30.elements,$_=$R._tempV31.elements,$V=$R._tempV32.elements,$e=$T.elements;$e[0]=$_[0],$e[3]=$_[1],$e[6]=$_[2],$e[1]=$V[0],$e[4]=$V[1],$e[7]=$V[2],$e[2]=$K[0],$e[5]=$K[1],$e[8]=$K[2]},$R.DEFAULT=new $R,$f($R,["_tempV30",function(){return this._tempV30=new $VH},"_tempV31",function(){return this._tempV31=new $VH},"_tempV32",function(){return this._tempV32=new $VH}]),$R}(),$tH=function(){function $z($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f,$b,$L,$G,$M){void 0===$t&&($t=1),void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$_&&($_=1),void 0===$V&&($V=0),void 0===$e&&($e=0),void 0===$R&&($R=0),void 0===$A&&($A=0),void 0===$q&&($q=1),void 0===$f&&($f=0),void 0===$b&&($b=0),void 0===$L&&($L=0),void 0===$G&&($G=0),void 0===$M&&($M=1);var $O=this.elements=new Float32Array(16);$O[0]=$t,$O[1]=$H,$O[2]=$I,$O[3]=$T,$O[4]=$K,$O[5]=$_,$O[6]=$V,$O[7]=$e,$O[8]=$R,$O[9]=$A,$O[10]=$q,$O[11]=$f,$O[12]=$b,$O[13]=$L,$O[14]=$G,$O[15]=$M}$L($z,"laya.d3.math.Matrix4x4");var $t=$z.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.getElementByRowColumn=function($t,$H){if($t<0||3<$t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($H<0||3<$H)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$t+$H]},$t.setElementByRowColumn=function($t,$H,$I){if($t<0||3<$t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($H<0||3<$H)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$t+$H]=$I},$t.equalsOtherMatrix=function($t){var $H=this.elements,$I=$t.elements;return $dt.nearEqual($H[0],$I[0])&&$dt.nearEqual($H[1],$I[1])&&$dt.nearEqual($H[2],$I[2])&&$dt.nearEqual($H[3],$I[3])&&$dt.nearEqual($H[4],$I[4])&&$dt.nearEqual($H[5],$I[5])&&$dt.nearEqual($H[6],$I[6])&&$dt.nearEqual($H[7],$I[7])&&$dt.nearEqual($H[8],$I[8])&&$dt.nearEqual($H[9],$I[9])&&$dt.nearEqual($H[10],$I[10])&&$dt.nearEqual($H[11],$I[11])&&$dt.nearEqual($H[12],$I[12])&&$dt.nearEqual($H[13],$I[13])&&$dt.nearEqual($H[14],$I[14])&&$dt.nearEqual($H[15],$I[15])},$t.decomposeTransRotScale=function($t,$H,$I){var $T=$z._tempMatrix4x4;return this.decomposeTransRotMatScale($t,$T,$I)?($IH.createFromMatrix4x4($T,$H),!0):($H.identity(),!1)},$t.decomposeTransRotMatScale=function($t,$H,$I){var $T=this.elements,$K=$t.elements,$_=$H.elements,$V=$I.elements;$K[0]=$T[12],$K[1]=$T[13],$K[2]=$T[14];var $e=$T[0],$R=$T[1],$A=$T[2],$q=$T[4],$f=$T[5],$b=$T[6],$L=$T[8],$G=$T[9],$M=$T[10],$O=$V[0]=Math.sqrt($e*$e+$R*$R+$A*$A),$J=$V[1]=Math.sqrt($q*$q+$f*$f+$b*$b),$S=$V[2]=Math.sqrt($L*$L+$G*$G+$M*$M);if($dt.isZero($O)||$dt.isZero($J)||$dt.isZero($S))return $_[1]=$_[2]=$_[3]=$_[4]=$_[6]=$_[7]=$_[8]=$_[9]=$_[11]=$_[12]=$_[13]=$_[14]=0,$_[0]=$_[5]=$_[10]=$_[15]=1,!1;var $U=$z._tempVector0,$C=$U.elements;$C[0]=$L/$S,$C[1]=$G/$S,$C[2]=$M/$S;var $N=$z._tempVector1,$w=$N.elements;$w[0]=$e/$O,$w[1]=$R/$O,$w[2]=$A/$O;var $W=$z._tempVector2;$VH.cross($U,$N,$W);var $s=$z._tempVector1;return $VH.cross($W,$U,$s),$_[3]=$_[7]=$_[11]=$_[12]=$_[13]=$_[14]=0,$_[15]=1,$_[0]=$s.x,$_[1]=$s.y,$_[2]=$s.z,$_[4]=$W.x,$_[5]=$W.y,$_[6]=$W.z,$_[8]=$U.x,$_[9]=$U.y,$_[10]=$U.z,$_[0]*$e+$_[1]*$R+$_[2]*$A<0&&($V[0]=-$O),$_[4]*$q+$_[5]*$f+$_[6]*$b<0&&($V[1]=-$J),$_[8]*$L+$_[9]*$G+$_[10]*$M<0&&($V[2]=-$S),!0},$t.decomposeYawPitchRoll=function($t){var $H=$t.elements,$I=Math.asin(-this.elements[9]);$H[1]=$I,Math.cos($I)>$dt.zeroTolerance?($H[2]=Math.atan2(this.elements[1],this.elements[5]),$H[0]=Math.atan2(this.elements[8],this.elements[10])):($H[2]=Math.atan2(-this.elements[4],this.elements[0]),$H[0]=0)},$t.normalize=function(){var $t=this.elements,$H=$t[0],$I=$t[1],$T=$t[2],$K=Math.sqrt($H*$H+$I*$I+$T*$T);if(!$K)return $t[0]=0,$t[1]=0,void($t[2]=0);1!=$K&&($K=1/$K,$t[0]=$H*$K,$t[1]=$I*$K,$t[2]=$T*$K)},$t.transpose=function(){var $t,$H;return $H=($t=this.elements)[1],$t[1]=$t[4],$t[4]=$H,$H=$t[2],$t[2]=$t[8],$t[8]=$H,$H=$t[3],$t[3]=$t[12],$t[12]=$H,$H=$t[6],$t[6]=$t[9],$t[9]=$H,$H=$t[7],$t[7]=$t[13],$t[13]=$H,$H=$t[11],$t[11]=$t[14],$t[14]=$H,this},$t.invert=function($t){var $H=this.elements,$I=$t.elements,$T=$H[0],$K=$H[1],$_=$H[2],$V=$H[3],$e=$H[4],$R=$H[5],$A=$H[6],$q=$H[7],$f=$H[8],$b=$H[9],$L=$H[10],$G=$H[11],$M=$H[12],$O=$H[13],$J=$H[14],$S=$H[15],$U=$T*$R-$K*$e,$C=$T*$A-$_*$e,$N=$T*$q-$V*$e,$w=$K*$A-$_*$R,$W=$K*$q-$V*$R,$s=$_*$q-$V*$A,$z=$f*$O-$b*$M,$P=$f*$J-$L*$M,$k=$f*$S-$G*$M,$r=$b*$J-$L*$O,$x=$b*$S-$G*$O,$Y=$L*$S-$G*$J,$D=$U*$Y-$C*$x+$N*$r+$w*$k-$W*$P+$s*$z;0!==Math.abs($D)&&($D=1/$D,$I[0]=($R*$Y-$A*$x+$q*$r)*$D,$I[1]=($_*$x-$K*$Y-$V*$r)*$D,$I[2]=($O*$s-$J*$W+$S*$w)*$D,$I[3]=($L*$W-$b*$s-$G*$w)*$D,$I[4]=($A*$k-$e*$Y-$q*$P)*$D,$I[5]=($T*$Y-$_*$k+$V*$P)*$D,$I[6]=($J*$N-$M*$s-$S*$C)*$D,$I[7]=($f*$s-$L*$N+$G*$C)*$D,$I[8]=($e*$x-$R*$k+$q*$z)*$D,$I[9]=($K*$k-$T*$x-$V*$z)*$D,$I[10]=($M*$W-$O*$N+$S*$U)*$D,$I[11]=($b*$N-$f*$W-$G*$U)*$D,$I[12]=($R*$P-$e*$r-$A*$z)*$D,$I[13]=($T*$r-$K*$P+$_*$z)*$D,$I[14]=($O*$C-$M*$w-$J*$U)*$D,$I[15]=($f*$w-$b*$C+$L*$U)*$D)},$t.identity=function(){var $t=this.elements;$t[1]=$t[2]=$t[3]=$t[4]=$t[6]=$t[7]=$t[8]=$t[9]=$t[11]=$t[12]=$t[13]=$t[14]=0,$t[0]=$t[5]=$t[10]=$t[15]=1},$t.cloneTo=function($t){var $H,$I,$T;if(($I=this.elements)!==($T=$t.elements))for($H=0;$H<16;++$H)$T[$H]=$I[$H]},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$t.getTranslationVector=function($t){var $H=this.elements,$I=$t.elements;$I[0]=$H[12],$I[1]=$H[13],$I[2]=$H[14]},$t.setTranslationVector=function($t){var $H=this.elements,$I=$t.elements;$H[12]=$I[0],$H[13]=$I[1],$H[14]=$I[2]},$t.getForward=function($t){var $H=this.elements,$I=$t.elements;$I[0]=-$H[8],$I[1]=-$H[9],$I[2]=-$H[10]},$t.setForward=function($t){var $H=this.elements,$I=$t.elements;$H[8]=-$I[0],$H[9]=-$I[1],$H[10]=-$I[2]},$z.createRotationX=function($t,$H){var $I=$H.elements,$T=Math.sin($t),$K=Math.cos($t);$I[1]=$I[2]=$I[3]=$I[4]=$I[7]=$I[8]=$I[11]=$I[12]=$I[13]=$I[14]=0,$I[0]=$I[15]=1,$I[5]=$I[10]=$K,$I[6]=$T,$I[9]=-$T},$z.createRotationY=function($t,$H){var $I=$H.elements,$T=Math.sin($t),$K=Math.cos($t);$I[1]=$I[3]=$I[4]=$I[6]=$I[7]=$I[9]=$I[11]=$I[12]=$I[13]=$I[14]=0,$I[5]=$I[15]=1,$I[0]=$I[10]=$K,$I[2]=-$T,$I[8]=$T},$z.createRotationZ=function($t,$H){var $I=$H.elements,$T=Math.sin($t),$K=Math.cos($t);$I[2]=$I[3]=$I[6]=$I[7]=$I[8]=$I[9]=$I[11]=$I[12]=$I[13]=$I[14]=0,$I[10]=$I[15]=1,$I[0]=$I[5]=$K,$I[1]=$T,$I[4]=-$T},$z.createRotationYawPitchRoll=function($t,$H,$I,$T){$IH.createFromYawPitchRoll($t,$H,$I,$z._tempQuaternion),$z.createRotationQuaternion($z._tempQuaternion,$T)},$z.createRotationAxis=function($t,$H,$I){var $T=$t.elements,$K=$T[0],$_=$T[1],$V=$T[2],$e=Math.cos($H),$R=Math.sin($H),$A=$K*$K,$q=$_*$_,$f=$V*$V,$b=$K*$_,$L=$K*$V,$G=$_*$V,$M=$I.elements;$M[3]=$M[7]=$M[11]=$M[12]=$M[13]=$M[14]=0,$M[15]=1,$M[0]=$A+$e*(1-$A),$M[1]=$b-$e*$b+$R*$V,$M[2]=$L-$e*$L-$R*$_,$M[4]=$b-$e*$b-$R*$V,$M[5]=$q+$e*(1-$q),$M[6]=$G-$e*$G+$R*$K,$M[8]=$L-$e*$L+$R*$_,$M[9]=$G-$e*$G-$R*$K,$M[10]=$f+$e*(1-$f)},$z.createRotationQuaternion=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$I[0],$_=$I[1],$V=$I[2],$e=$I[3],$R=$K*$K,$A=$_*$_,$q=$V*$V,$f=$K*$_,$b=$V*$e,$L=$V*$K,$G=$_*$e,$M=$_*$V,$O=$K*$e;$T[3]=$T[7]=$T[11]=$T[12]=$T[13]=$T[14]=0,$T[15]=1,$T[0]=1-2*($A+$q),$T[1]=2*($f+$b),$T[2]=2*($L-$G),$T[4]=2*($f-$b),$T[5]=1-2*($q+$R),$T[6]=2*($M+$O),$T[8]=2*($L+$G),$T[9]=2*($M-$O),$T[10]=1-2*($A+$R)},$z.createTranslate=function($t,$H){var $I=$t.elements,$T=$H.elements;$T[4]=$T[8]=$T[1]=$T[9]=$T[2]=$T[6]=$T[3]=$T[7]=$T[11]=0,$T[0]=$T[5]=$T[10]=$T[15]=1,$T[12]=$I[0],$T[13]=$I[1],$T[14]=$I[2]},$z.createScaling=function($t,$H){var $I=$t.elements,$T=$H.elements;$T[0]=$I[0],$T[5]=$I[1],$T[10]=$I[2],$T[1]=$T[4]=$T[8]=$T[12]=$T[9]=$T[13]=$T[2]=$T[6]=$T[14]=$T[3]=$T[7]=$T[11]=0,$T[15]=1},$z.multiply=function($t,$H,$I){var $T,$K,$_,$V,$e,$R,$A,$q;for($K=$I.elements,$_=$t.elements,$K===($V=$H.elements)&&($V=$V.slice()),$T=0;$T<4;$T++)$e=$_[$T],$R=$_[$T+4],$A=$_[$T+8],$q=$_[$T+12],$K[$T]=$e*$V[0]+$R*$V[1]+$A*$V[2]+$q*$V[3],$K[$T+4]=$e*$V[4]+$R*$V[5]+$A*$V[6]+$q*$V[7],$K[$T+8]=$e*$V[8]+$R*$V[9]+$A*$V[10]+$q*$V[11],$K[$T+12]=$e*$V[12]+$R*$V[13]+$A*$V[14]+$q*$V[15]},$z.createFromQuaternion=function($t,$H){var $I=$H.elements,$T=$t.elements,$K=$T[0],$_=$T[1],$V=$T[2],$e=$T[3],$R=$K+$K,$A=$_+$_,$q=$V+$V,$f=$K*$R,$b=$_*$R,$L=$_*$A,$G=$V*$R,$M=$V*$A,$O=$V*$q,$J=$e*$R,$S=$e*$A,$U=$e*$q;$I[0]=1-$L-$O,$I[1]=$b+$U,$I[2]=$G-$S,$I[3]=0,$I[4]=$b-$U,$I[5]=1-$f-$O,$I[6]=$M+$J,$I[7]=0,$I[8]=$G+$S,$I[9]=$M-$J,$I[10]=1-$f-$L,$I[11]=0,$I[12]=0,$I[13]=0,$I[14]=0,$I[15]=1},$z.createAffineTransformation=function($t,$H,$I,$T){var $K=$t.elements,$_=$H.elements,$V=$I.elements,$e=$T.elements,$R=$_[0],$A=$_[1],$q=$_[2],$f=$_[3],$b=$R+$R,$L=$A+$A,$G=$q+$q,$M=$R*$b,$O=$R*$L,$J=$R*$G,$S=$A*$L,$U=$A*$G,$C=$q*$G,$N=$f*$b,$w=$f*$L,$W=$f*$G,$s=$V[0],$z=$V[1],$P=$V[2];$e[0]=(1-($S+$C))*$s,$e[1]=($O+$W)*$s,$e[2]=($J-$w)*$s,$e[3]=0,$e[4]=($O-$W)*$z,$e[5]=(1-($M+$C))*$z,$e[6]=($U+$N)*$z,$e[7]=0,$e[8]=($J+$w)*$P,$e[9]=($U-$N)*$P,$e[10]=(1-($M+$S))*$P,$e[11]=0,$e[12]=$K[0],$e[13]=$K[1],$e[14]=$K[2],$e[15]=1},$z.createLookAt=function($t,$H,$I,$T){var $K=$T.elements,$_=$z._tempVector0,$V=$z._tempVector1,$e=$z._tempVector2;$VH.subtract($t,$H,$e),$VH.normalize($e,$e),$VH.cross($I,$e,$_),$VH.normalize($_,$_),$VH.cross($e,$_,$V),$T.identity(),$K[0]=$_.x,$K[4]=$_.y,$K[8]=$_.z,$K[1]=$V.x,$K[5]=$V.y,$K[9]=$V.z,$K[2]=$e.x,$K[6]=$e.y,$K[10]=$e.z,$K[12]=-$VH.dot($_,$t),$K[13]=-$VH.dot($V,$t),$K[14]=-$VH.dot($e,$t)},$z.createPerspective=function($t,$H,$I,$T,$K){var $_=$K.elements,$V=1/Math.tan($t/2),$e=1/($I-$T);$_[0]=$V/$H,$_[5]=$V,$_[10]=($T+$I)*$e,$_[11]=-1,$_[14]=2*$T*$I*$e,$_[1]=$_[2]=$_[3]=$_[4]=$_[6]=$_[7]=$_[8]=$_[9]=$_[12]=$_[13]=$_[15]=0},$z.createOrthoOffCenterRH=function($t,$H,$I,$T,$K,$_,$V){var $e=$V.elements,$R=1/($t-$H),$A=1/($I-$T),$q=1/($K-$_);$e[1]=$e[2]=$e[3]=$e[4]=$e[6]=$e[7]=$e[8]=$e[9]=$e[11]=0,$e[15]=1,$e[0]=-2*$R,$e[5]=-2*$A,$e[10]=2*$q,$e[12]=($t+$H)*$R,$e[13]=($T+$I)*$A,$e[14]=($_+$K)*$q},$z.translation=function($t,$H){var $I=$t.elements,$T=$H.elements;$T[0]=$T[5]=$T[10]=$T[15]=1,$T[12]=$I[0],$T[13]=$I[1],$T[14]=$I[2]},$f($z,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $z},"_tempVector0",function(){return this._tempVector0=new $VH},"_tempVector1",function(){return this._tempVector1=new $VH},"_tempVector2",function(){return this._tempVector2=new $VH},"_tempQuaternion",function(){return this._tempQuaternion=new $IH},"DEFAULT",function(){return this.DEFAULT=new $z},"ZERO",function(){return this.ZERO=new $z(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$z}(),$HH=(function(){function $U($t,$H){this.extents=null,this.transformation=null,this.extents=$t,this.transformation=$H}$L($U,"laya.d3.math.OrientedBoundBox");var $t=$U.prototype;$t.getCorners=function($t){var $H=$U._tempV30.elements,$I=$U._tempV31.elements,$T=$U._tempV32.elements,$K=this.extents.elements;$H[0]=$K[0],$H[1]=$H[2]=0,$I[1]=$K[1],$I[0]=$I[2]=0,$T[2]=$K[2],$T[0]=$T[1]=0,$VH.TransformNormal($U._tempV30,this.transformation,$U._tempV30),$VH.TransformNormal($U._tempV31,this.transformation,$U._tempV31),$VH.TransformNormal($U._tempV32,this.transformation,$U._tempV32);var $_=$U._tempV33;this.transformation.getTranslationVector($_),$t.length=8,$VH.add($_,$U._tempV30,$U._tempV34),$VH.add($U._tempV34,$U._tempV31,$U._tempV34),$VH.add($U._tempV34,$U._tempV32,$t[0]),$VH.add($_,$U._tempV30,$U._tempV34),$VH.add($U._tempV34,$U._tempV31,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV32,$t[1]),$VH.subtract($_,$U._tempV30,$U._tempV34),$VH.add($U._tempV34,$U._tempV31,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV32,$t[2]),$VH.subtract($_,$U._tempV30,$U._tempV34),$VH.add($U._tempV34,$U._tempV31,$U._tempV34),$VH.add($U._tempV34,$U._tempV32,$t[3]),$VH.add($_,$U._tempV30,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV31,$U._tempV34),$VH.add($U._tempV34,$U._tempV32,$t[4]),$VH.add($_,$U._tempV30,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV31,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV32,$t[5]),$VH.subtract($_,$U._tempV30,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV31,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV32,$t[6]),$VH.subtract($_,$U._tempV30,$U._tempV34),$VH.subtract($U._tempV34,$U._tempV31,$U._tempV34),$VH.add($U._tempV34,$U._tempV32,$t[7])},$t.transform=function($t){$tH.multiply(this.transformation,$t,this.transformation)},$t.scale=function($t){$VH.multiply(this.extents,$t,this.extents)},$t.translate=function($t){this.transformation.getTranslationVector($U._tempV30),$VH.add($U._tempV30,$t,$U._tempV31),this.transformation.setTranslationVector($U._tempV31)},$t.Size=function($t){$VH.scale(this.extents,2,$t)},$t.getSize=function($t){var $H=this.extents.elements;$U._tempV30.x=$H[0],$U._tempV31.y=$H[1],$U._tempV32.z=$H[2],$VH.TransformNormal($U._tempV30,this.transformation,$U._tempV30),$VH.TransformNormal($U._tempV31,this.transformation,$U._tempV31),$VH.TransformNormal($U._tempV31,this.transformation,$U._tempV32);var $I=$t.elements;$I[0]=$VH.scalarLength($U._tempV30),$I[1]=$VH.scalarLength($U._tempV31),$I[2]=$VH.scalarLength($U._tempV32)},$t.getSizeSquared=function($t){var $H=this.extents.elements;$U._tempV30.x=$H[0],$U._tempV31.y=$H[1],$U._tempV32.z=$H[2],$VH.TransformNormal($U._tempV30,this.transformation,$U._tempV30),$VH.TransformNormal($U._tempV31,this.transformation,$U._tempV31),$VH.TransformNormal($U._tempV31,this.transformation,$U._tempV32);var $I=$t.elements;$I[0]=$VH.scalarLengthSquared($U._tempV30),$I[1]=$VH.scalarLengthSquared($U._tempV31),$I[2]=$VH.scalarLengthSquared($U._tempV32)},$t.getCenter=function($t){this.transformation.getTranslationVector($t)},$t.containsPoint=function($t){var $H=this.extents.elements,$I=$H[0],$T=$H[1],$K=$H[2];this.transformation.invert($U._tempM0),$VH.transformCoordinate($t,$U._tempM0,$U._tempV30);var $_=$U._tempV30.elements,$V=Math.abs($_[0]),$e=Math.abs($_[1]),$R=Math.abs($_[2]);return $dt.nearEqual($V,$I)&&$dt.nearEqual($e,$T)&&$dt.nearEqual($R,$K)?2:$V<$I&&$e<$T&&$R<$K?1:0},$t.containsPoints=function($t){var $H=this.extents.elements,$I=$H[0],$T=$H[1],$K=$H[2];this.transformation.invert($U._tempM0);for(var $_=!0,$V=!1,$e=0;$e<$t.length;$e++){$VH.transformCoordinate($t[$e],$U._tempM0,$U._tempV30);var $R=$U._tempV30.elements,$A=Math.abs($R[0]),$q=Math.abs($R[1]),$f=Math.abs($R[2]);$dt.nearEqual($A,$I)&&$dt.nearEqual($q,$T)&&$dt.nearEqual($f,$K)&&($V=!0),$A<$I&&$q<$T&&$f<$K?$V=!0:$_=!1}return $_?1:$V?2:0},$t.containsSphere=function($t,$H){void 0===$H&&($H=!1);var $I=this.extents.elements,$T=$I[0],$K=$I[1],$_=$I[2],$V=$t.radius;this.transformation.invert($U._tempM0),$VH.transformCoordinate($t.center,$U._tempM0,$U._tempV30);var $e=NaN;if($e=$H?$V:($VH.scale($VH.UnitX,$V,$U._tempV31),$VH.TransformNormal($U._tempV31,$U._tempM0,$U._tempV31),$VH.scalarLength($U._tempV31)),$VH.scale(this.extents,-1,$U._tempV32),$VH.Clamp($U._tempV30,$U._tempV32,this.extents,$U._tempV33),$e*$e<$VH.distanceSquared($U._tempV30,$U._tempV33))return 0;var $R=$U._tempV30.elements,$A=$R[0],$q=$R[1],$f=$R[2],$b=$U._tempV32.elements,$L=$b[0],$G=$b[1],$M=$b[2];return $L+$e<=$A&&$A<=$T-$e&&$e<$T-$L&&$G+$e<=$q&&$q<=$K-$e&&$e<$K-$G&&$M+$e<=$f&&$f<=$_-$e&&$e<$_-$M?1:2},$t.containsOrientedBoundBox=function($t){var $H=0,$I=0;$t.getCorners($U._corners);var $T=this.containsPoints($U._corners);if(0!=$T)return $T;var $K=this.extents.elements;$t.extents.cloneTo($U._tempV35);var $_=$U._tempV35.elements;$U._getRows(this.transformation,$U._rows1),$U._getRows($t.transformation,$U._rows2);var $V=NaN;for($H=0;$H<4;$H++)for($I=0;$I<4;$I++)3==$H||3==$I?($U._tempM0.setElementByRowColumn($H,$I,0),$U._tempM1.setElementByRowColumn($H,$I,0)):($V=$VH.dot($U._rows1[$H],$U._rows2[$I]),$U._tempM0.setElementByRowColumn($H,$I,$V),$U._tempM1.setElementByRowColumn($H,$I,Math.abs($V)));$t.getCenter($U._tempV34),this.getCenter($U._tempV36),$VH.subtract($U._tempV34,$U._tempV36,$U._tempV30);var $e=$U._tempV31.elements;$e[0]=$VH.dot($U._tempV30,$U._rows1[0]),$e[1]=$VH.dot($U._tempV30,$U._rows1[1]),$e[2]=$VH.dot($U._tempV30,$U._rows1[2]);var $R=$U._tempV32.elements,$A=$U._tempV33.elements;for($H=0;$H<3;$H++)if($R[0]=$U._tempM1.getElementByRowColumn($H,0),$R[1]=$U._tempM1.getElementByRowColumn($H,1),$R[2]=$U._tempM1.getElementByRowColumn($H,2),$K[$H]+$VH.dot($U._tempV35,$U._tempV32)<Math.abs($e[$H]))return 0;for($I=0;$I<3;$I++)if($R[0]=$U._tempM1.getElementByRowColumn(0,$I),$R[1]=$U._tempM1.getElementByRowColumn(1,$I),$R[2]=$U._tempM1.getElementByRowColumn(2,$I),$A[0]=$U._tempM0.getElementByRowColumn(0,$I),$A[1]=$U._tempM0.getElementByRowColumn(1,$I),$A[2]=$U._tempM0.getElementByRowColumn(2,$I),$VH.dot(this.extents,$U._tempV32)+$_[$I]<Math.abs($VH.dot($U._tempV31,$U._tempV33)))return 0;for($H=0;$H<3;$H++)for($I=0;$I<3;$I++){var $q=($H+1)%3,$f=($H+2)%3,$b=($I+1)%3,$L=($I+2)%3;if($K[$q]*$U._tempM1.getElementByRowColumn($f,$I)+$K[$f]*$U._tempM1.getElementByRowColumn($q,$I)+($_[$b]*$U._tempM1.getElementByRowColumn($H,$L)+$_[$L]*$U._tempM1.getElementByRowColumn($H,$b))<Math.abs($e[$f]*$U._tempM0.getElementByRowColumn($q,$I)-$e[$q]*$U._tempM0.getElementByRowColumn($f,$I)))return 0}return 2},$t.containsLine=function($t,$H){$U._corners[0]=$t,$U._corners[1]=$H;var $I=this.containsPoints($U._corners);if(0!=$I)return $I;var $T=this.extents.elements,$K=$T[0],$_=$T[1],$V=$T[2];this.transformation.invert($U._tempM0),$VH.transformCoordinate($t,$U._tempM0,$U._tempV30),$VH.transformCoordinate($H,$U._tempM0,$U._tempV31),$VH.add($U._tempV30,$U._tempV31,$U._tempV32),$VH.scale($U._tempV32,.5,$U._tempV32),$VH.subtract($U._tempV30,$U._tempV32,$U._tempV33);var $e=$U._tempV33.elements,$R=$e[0],$A=$e[1],$q=$e[2],$f=$U._tempV34.elements,$b=$f[0]=Math.abs($e[0]),$L=$f[1]=Math.abs($e[1]),$G=$f[2]=Math.abs($e[2]),$M=$U._tempV32.elements,$O=$M[0],$J=$M[1],$S=$M[2];return Math.abs($O)>$K+$b?0:Math.abs($J)>$_+$L?0:Math.abs($S)>$V+$G?0:Math.abs($J*$q-$S*$A)>$_*$G+$V*$L?0:Math.abs($O*$q-$S*$R)>$K*$G+$V*$b?0:Math.abs($O*$A-$J*$R)>$K*$L+$_*$b?0:2},$t.containsBoundBox=function($t){var $H=0,$I=0,$T=$t.min,$K=$t.max;$t.getCorners($U._corners);var $_=this.containsPoints($U._corners);if(0!=$_)return $_;$VH.subtract($K,$T,$U._tempV30),$VH.scale($U._tempV30,.5,$U._tempV30),$VH.add($T,$U._tempV30,$U._tempV30),$VH.subtract($K,$U._tempV30,$U._tempV31);var $V=this.extents.elements,$e=$U._tempV31.elements;$U._getRows(this.transformation,$U._rows1),this.transformation.invert($U._tempM0);for($H=0;$H<3;$H++)for($I=0;$I<3;$I++)$U._tempM1.setElementByRowColumn($H,$I,Math.abs($U._tempM0.getElementByRowColumn($H,$I)));this.getCenter($U._tempV35),$VH.subtract($U._tempV30,$U._tempV35,$U._tempV32);var $R=$U._tempV31.elements;$R[0]=$VH.dot($U._tempV32,$U._rows1[0]),$R[1]=$VH.dot($U._tempV32,$U._rows1[1]),$R[2]=$VH.dot($U._tempV32,$U._rows1[2]);var $A=$U._tempV33.elements,$q=$U._tempV34.elements;for($H=0;$H<3;$H++)if($A[0]=$U._tempM1.getElementByRowColumn($H,0),$A[1]=$U._tempM1.getElementByRowColumn($H,1),$A[2]=$U._tempM1.getElementByRowColumn($H,2),$V[$H]+$VH.dot($U._tempV31,$U._tempV33)<Math.abs($R[$H]))return 0;for($I=0;$I<3;$I++)if($A[0]=$U._tempM1.getElementByRowColumn(0,$I),$A[1]=$U._tempM1.getElementByRowColumn(1,$I),$A[2]=$U._tempM1.getElementByRowColumn(2,$I),$q[0]=$U._tempM0.getElementByRowColumn(0,$I),$q[1]=$U._tempM0.getElementByRowColumn(1,$I),$q[2]=$U._tempM0.getElementByRowColumn(2,$I),$VH.dot(this.extents,$U._tempV33)+$e[$I]<Math.abs($VH.dot($U._tempV31,$U._tempV34)))return 0;for($H=0;$H<3;$H++)for($I=0;$I<3;$I++){var $f=($H+1)%3,$b=($H+2)%3,$L=($I+1)%3,$G=($I+2)%3;if($V[$f]*$U._tempM1.getElementByRowColumn($b,$I)+$V[$b]*$U._tempM1.getElementByRowColumn($f,$I)+($e[$L]*$U._tempM1.getElementByRowColumn($H,$G)+$e[$G]*$U._tempM1.getElementByRowColumn($H,$L))<Math.abs($R[$b]*$U._tempM0.getElementByRowColumn($f,$I)-$R[$f]*$U._tempM0.getElementByRowColumn($b,$I)))return 0}return 2},$t.intersectsRay=function($t,$H){$VH.scale(this.extents,-1,$U._tempV30),this.transformation.invert($U._tempM0),$VH.TransformNormal($t.direction,$U._tempM0,$U._ray.direction),$VH.transformCoordinate($t.origin,$U._tempM0,$U._ray.origin),$U._boxBound1.min=$U._tempV30,$U._boxBound1.max=this.extents;var $I=Collision.intersectsRayAndBoxRP($U._ray,$U._boxBound1,$H);return-1!==$I&&$VH.transformCoordinate($H,this.transformation,$H),$I},$t._getLocalCorners=function($t){$t.length=8;var $H=this.extents.elements;$U._tempV30.x=$H[0],$U._tempV31.y=$H[1],$U._tempV32.z=$H[2],$VH.add($U._tempV30,$U._tempV31,$U._tempV33),$VH.add($U._tempV33,$U._tempV32,$t[0]),$VH.add($U._tempV30,$U._tempV31,$U._tempV33),$VH.subtract($U._tempV33,$U._tempV32,$t[1]),$VH.subtract($U._tempV31,$U._tempV30,$U._tempV33),$VH.subtract($U._tempV33,$U._tempV30,$t[2]),$VH.subtract($U._tempV31,$U._tempV30,$U._tempV33),$VH.add($U._tempV33,$U._tempV32,$t[3]),$VH.subtract($U._tempV30,$U._tempV31,$U._tempV33),$VH.add($U._tempV33,$U._tempV32,$t[4]),$VH.subtract($U._tempV30,$U._tempV31,$U._tempV33),$VH.subtract($U._tempV33,$U._tempV32,$t[5]),$VH.scale($t[0],-1,$t[6]),$VH.subtract($U._tempV32,$U._tempV30,$U._tempV33),$VH.subtract($U._tempV33,$U._tempV31,$t[7])},$t.equals=function($t){return this.extents==$t.extents&&this.transformation==$t.transformation},$t.cloneTo=function($t){var $H=$t;this.extents.cloneTo($H.extents),this.transformation.cloneTo($H.transformation)},$U.createByBoundBox=function($t,$H){var $I=$t.min,$T=$t.max;$VH.subtract($T,$I,$U._tempV30),$VH.scale($U._tempV30,.5,$U._tempV30),$VH.add($I,$U._tempV30,$U._tempV31),$VH.subtract($T,$U._tempV31,$U._tempV32),$tH.translation($U._tempV31,$U._tempM0);var $K=$U._tempV32.clone(),$_=$U._tempM0.clone();$H.extents=$K,$H.transformation=$_},$U.createByMinAndMaxVertex=function($t,$H){return $VH.subtract($H,$t,$U._tempV30),$VH.scale($U._tempV30,.5,$U._tempV30),$VH.add($t,$U._tempV30,$U._tempV31),$VH.subtract($H,$U._tempV31,$U._tempV32),$tH.translation($U._tempV31,$U._tempM0),new $U($U._tempV32,$U._tempM0)},$U._getRows=function($t,$H){$H.length=3;var $I=$t.elements,$T=$H[0].elements;$T[0]=$I[0],$T[1]=$I[1],$T[2]=$I[2];var $K=$H[1].elements;$K[0]=$I[4],$K[1]=$I[5],$K[2]=$I[6];var $_=$H[2].elements;$_[0]=$I[8],$_[1]=$I[9],$_[2]=$I[10]},$U.getObbtoObbMatrix4x4=function($t,$H,$I,$T){var $K=$t.transformation,$_=$H.transformation;if($I){$U._getRows($K,$U._rows1),$U._getRows($_,$U._rows2);for(var $V=0;$V<3;$V++)for(var $e=0;$e<3;$e++)$T.setElementByRowColumn($V,$e,$VH.dot($U._rows2[$V],$U._rows1[$e]));$H.getCenter($U._tempV30),$t.getCenter($U._tempV31),$VH.subtract($U._tempV30,$U._tempV31,$U._tempV32);var $R=$T.elements;$R[12]=$VH.dot($U._tempV32,$U._rows1[0]),$R[13]=$VH.dot($U._tempV32,$U._rows1[1]),$R[14]=$VH.dot($U._tempV32,$U._rows1[2]),$R[15]=1}else $K.invert($U._tempM0),$tH.multiply($_,$U._tempM0,$T)},$U.merge=function($t,$H,$I){var $T=$t.extents,$K=$t.transformation;$U.getObbtoObbMatrix4x4($t,$H,$I,$U._tempM0),$H._getLocalCorners($U._corners),$VH.transformCoordinate($U._corners[0],$U._tempM0,$U._corners[0]),$VH.transformCoordinate($U._corners[1],$U._tempM0,$U._corners[1]),$VH.transformCoordinate($U._corners[2],$U._tempM0,$U._corners[2]),$VH.transformCoordinate($U._corners[3],$U._tempM0,$U._corners[3]),$VH.transformCoordinate($U._corners[4],$U._tempM0,$U._corners[4]),$VH.transformCoordinate($U._corners[5],$U._tempM0,$U._corners[5]),$VH.transformCoordinate($U._corners[6],$U._tempM0,$U._corners[6]),$VH.transformCoordinate($U._corners[7],$U._tempM0,$U._corners[7]),$VH.scale($T,-1,$U._boxBound1.min),$T.cloneTo($U._boxBound1.max),$ct.createfromPoints($U._corners,$U._boxBound2),$ct.merge($U._boxBound2,$U._boxBound1,$U._boxBound3);var $_=$U._boxBound3.min,$V=$U._boxBound3.max;$VH.subtract($V,$_,$U._tempV30),$VH.scale($U._tempV30,.5,$U._tempV30),$VH.add($_,$U._tempV30,$U._tempV32),$VH.subtract($V,$U._tempV32,$T),$VH.transformCoordinate($U._tempV32,$K,$U._tempV33)},$f($U,["_tempV30",function(){return this._tempV30=new $VH},"_tempV31",function(){return this._tempV31=new $VH},"_tempV32",function(){return this._tempV32=new $VH},"_tempV33",function(){return this._tempV33=new $VH},"_tempV34",function(){return this._tempV34=new $VH},"_tempV35",function(){return this._tempV35=new $VH},"_tempV36",function(){return this._tempV36=new $VH},"_tempM0",function(){return this._tempM0=new $tH},"_tempM1",function(){return this._tempM1=new $tH},"_corners",function(){return this._corners=[new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH]},"_rows1",function(){return this._rows1=[new $VH,new $VH,new $VH]},"_rows2",function(){return this._rows2=[new $VH,new $VH,new $VH]},"_ray",function(){return this._ray=new $KH(new $VH,new $VH)},"_boxBound1",function(){return this._boxBound1=new $ct(new $VH,new $VH)},"_boxBound2",function(){return this._boxBound2=new $ct(new $VH,new $VH)},"_boxBound3",function(){return this._boxBound3=new $ct(new $VH,new $VH)}])}(),function(){function $N($t,$H){this.normal=null,this.distance=NaN,void 0===$H&&($H=0),this.normal=$t,this.distance=$H}return $L($N,"laya.d3.math.Plane"),$N.prototype.normalize=function(){var $t=this.normal.elements,$H=$t[0],$I=$t[1],$T=$t[2],$K=1/Math.sqrt($H*$H+$I*$I+$T*$T);$t[0]=$H*$K,$t[1]=$I*$K,$t[2]=$T*$K,this.distance*=$K},$N.createPlaneBy3P=function($t,$H,$I){var $T=$t.elements,$K=$H.elements,$_=$I.elements,$V=$K[0]-$T[0],$e=$K[1]-$T[1],$R=$K[2]-$T[2],$A=$_[0]-$T[0],$q=$_[1]-$T[1],$f=$_[2]-$T[2],$b=$e*$f-$R*$q,$L=$R*$A-$V*$f,$G=$V*$q-$e*$A,$M=1/Math.sqrt($b*$b+$L*$L+$G*$G),$O=$b*$M,$J=$L*$M,$S=$G*$M,$U=$N._TEMPVec3.elements;$U[0]=$O,$U[1]=$J,$U[2]=$S;var $C=-($O*$T[0]+$J*$T[1]+$S*$T[2]);return new $N($N._TEMPVec3,$C)},$N.PlaneIntersectionType_Back=0,$N.PlaneIntersectionType_Front=1,$N.PlaneIntersectionType_Intersecting=2,$f($N,["_TEMPVec3",function(){return this._TEMPVec3=new $VH}]),$N}()),$IH=function(){function $K($t,$H,$I,$T){this.elements=new Float32Array(4),void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=1),this.elements[0]=$t,this.elements[1]=$H,this.elements[2]=$I,this.elements[3]=$T}$L($K,"laya.d3.math.Quaternion");var $t=$K.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.scaling=function($t,$H){var $I=$H.elements,$T=this.elements;$I[0]=$T[0]*$t,$I[1]=$T[1]*$t,$I[2]=$T[2]*$t,$I[3]=$T[3]*$t},$t.normalize=function($t){var $H=$t.elements,$I=this.elements,$T=$I[0],$K=$I[1],$_=$I[2],$V=$I[3],$e=$T*$T+$K*$K+$_*$_+$V*$V;0<$e&&($e=1/Math.sqrt($e),$H[0]=$T*$e,$H[1]=$K*$e,$H[2]=$_*$e,$H[3]=$V*$e)},$t.length=function(){var $t=this.elements,$H=$t[0],$I=$t[1],$T=$t[2],$K=$t[3];return Math.sqrt($H*$H+$I*$I+$T*$T+$K*$K)},$t.rotateX=function($t,$H){var $I=$H.elements,$T=this.elements;$t*=.5;var $K=$T[0],$_=$T[1],$V=$T[2],$e=$T[3],$R=Math.sin($t),$A=Math.cos($t);$I[0]=$K*$A+$e*$R,$I[1]=$_*$A+$V*$R,$I[2]=$V*$A-$_*$R,$I[3]=$e*$A-$K*$R},$t.rotateY=function($t,$H){var $I=$H.elements,$T=this.elements;$t*=.5;var $K=$T[0],$_=$T[1],$V=$T[2],$e=$T[3],$R=Math.sin($t),$A=Math.cos($t);$I[0]=$K*$A-$V*$R,$I[1]=$_*$A+$e*$R,$I[2]=$V*$A+$K*$R,$I[3]=$e*$A-$_*$R},$t.rotateZ=function($t,$H){var $I=$H.elements,$T=this.elements;$t*=.5;var $K=$T[0],$_=$T[1],$V=$T[2],$e=$T[3],$R=Math.sin($t),$A=Math.cos($t);$I[0]=$K*$A+$_*$R,$I[1]=$_*$A-$K*$R,$I[2]=$V*$A+$e*$R,$I[3]=$e*$A-$V*$R},$t.getYawPitchRoll=function($t){$VH.transformQuat($VH.ForwardRH,this,$K.TEMPVector31),$VH.transformQuat($VH.Up,this,$K.TEMPVector32);var $H=$K.TEMPVector32.elements;$K.angleTo($VH.ZERO,$K.TEMPVector31,$K.TEMPVector33);var $I=$K.TEMPVector33.elements;$I[0]==Math.PI/2?($I[1]=$K.arcTanAngle($H[2],$H[0]),$I[2]=0):$I[0]==-Math.PI/2?($I[1]=$K.arcTanAngle(-$H[2],-$H[0]),$I[2]=0):($tH.createRotationY(-$I[1],$K.TEMPMatrix0),$tH.createRotationX(-$I[0],$K.TEMPMatrix1),$VH.transformCoordinate($K.TEMPVector32,$K.TEMPMatrix0,$K.TEMPVector32),$VH.transformCoordinate($K.TEMPVector32,$K.TEMPMatrix1,$K.TEMPVector32),$I[2]=$K.arcTanAngle($H[1],-$H[0])),$I[1]<=-Math.PI&&($I[1]=Math.PI),$I[2]<=-Math.PI&&($I[2]=Math.PI),$I[1]>=Math.PI&&$I[2]>=Math.PI&&($I[1]=0,$I[2]=0,$I[0]=Math.PI-$I[0]);var $T=$t.elements;$T[0]=$I[1],$T[1]=$I[0],$T[2]=$I[2]},$t.invert=function($t){var $H=$t.elements,$I=this.elements,$T=$I[0],$K=$I[1],$_=$I[2],$V=$I[3],$e=$T*$T+$K*$K+$_*$_+$V*$V,$R=$e?1/$e:0;$H[0]=-$T*$R,$H[1]=-$K*$R,$H[2]=-$_*$R,$H[3]=$V*$R},$t.identity=function(){var $t=this.elements;$t[0]=0,$t[1]=0,$t[2]=0,$t[3]=1},$t.fromArray=function($t,$H){void 0===$H&&($H=0),this.elements[0]=$t[$H+0],this.elements[1]=$t[$H+1],this.elements[2]=$t[$H+2],this.elements[3]=$t[$H+3]},$t.cloneTo=function($t){var $H,$I,$T;if(($I=this.elements)!==($T=$t.elements))for($H=0;$H<4;++$H)$T[$H]=$I[$H]},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$t.equals=function($t){var $H=this.elements,$I=$t.elements;return $dt.nearEqual($H[0],$I[0])&&$dt.nearEqual($H[1],$I[1])&&$dt.nearEqual($H[2],$I[2])&&$dt.nearEqual($H[3],$I[3])},$t.lengthSquared=function(){var $t=this.elements[0],$H=this.elements[1],$I=this.elements[2],$T=this.elements[3];return $t*$t+$H*$H+$I*$I+$T*$T},$G(0,$t,"x",function(){return this.elements[0]}),$G(0,$t,"y",function(){return this.elements[1]}),$G(0,$t,"z",function(){return this.elements[2]}),$G(0,$t,"w",function(){return this.elements[3]}),$K.createFromYawPitchRoll=function($t,$H,$I,$T){var $K=.5*$I,$_=.5*$H,$V=.5*$t,$e=Math.sin($K),$R=Math.cos($K),$A=Math.sin($_),$q=Math.cos($_),$f=Math.sin($V),$b=Math.cos($V),$L=$T.elements;$L[0]=$b*$A*$R+$f*$q*$e,$L[1]=$f*$q*$R-$b*$A*$e,$L[2]=$b*$q*$e-$f*$A*$R,$L[3]=$b*$q*$R+$f*$A*$e},$K.multiply=function($t,$H,$I){var $T=$t.elements,$K=$H.elements,$_=$I.elements,$V=$T[0],$e=$T[1],$R=$T[2],$A=$T[3],$q=$K[0],$f=$K[1],$b=$K[2],$L=$K[3],$G=$e*$b-$R*$f,$M=$R*$q-$V*$b,$O=$V*$f-$e*$q,$J=$V*$q+$e*$f+$R*$b;$_[0]=$V*$L+$q*$A+$G,$_[1]=$e*$L+$f*$A+$M,$_[2]=$R*$L+$b*$A+$O,$_[3]=$A*$L-$J},$K.arcTanAngle=function($t,$H){return 0==$t?1==$H?Math.PI/2:-Math.PI/2:0<$t?Math.atan($H/$t):$t<0?0<$H?Math.atan($H/$t)+Math.PI:Math.atan($H/$t)-Math.PI:0},$K.angleTo=function($t,$H,$I){$VH.subtract($H,$t,$K.TEMPVector30),$VH.normalize($K.TEMPVector30,$K.TEMPVector30),$I.elements[0]=Math.asin($K.TEMPVector30.y),$I.elements[1]=$K.arcTanAngle(-$K.TEMPVector30.z,-$K.TEMPVector30.x)},$K.createFromAxisAngle=function($t,$H,$I){var $T=$I.elements,$K=$t.elements;$H*=.5;var $_=Math.sin($H);$T[0]=$_*$K[0],$T[1]=$_*$K[1],$T[2]=$_*$K[2],$T[3]=Math.cos($H)},$K.createFromMatrix3x3=function($t,$H){var $I,$T=$H.elements,$K=$t.elements,$_=$K[0]+$K[4]+$K[8];if(0<$_)$I=Math.sqrt($_+1),$T[3]=.5*$I,$I=.5/$I,$T[0]=($K[5]-$K[7])*$I,$T[1]=($K[6]-$K[2])*$I,$T[2]=($K[1]-$K[3])*$I;else{var $V=0;$K[4]>$K[0]&&($V=1),$K[8]>$K[3*$V+$V]&&($V=2);var $e=($V+1)%3,$R=($V+2)%3;$I=Math.sqrt($K[3*$V+$V]-$K[3*$e+$e]-$K[3*$R+$R]+1),$T[$V]=.5*$I,$I=.5/$I,$T[3]=($K[3*$e+$R]-$K[3*$R+$e])*$I,$T[$e]=($K[3*$e+$V]+$K[3*$V+$e])*$I,$T[$R]=($K[3*$R+$V]+$K[3*$V+$R])*$I}},$K.createFromMatrix4x4=function($t,$H){var $I,$T,$K=$t.elements,$_=$H.elements,$V=$K[0]+$K[5]+$K[10];0<$V?($I=Math.sqrt($V+1),$_[3]=.5*$I,$I=.5/$I,$_[0]=($K[6]-$K[9])*$I,$_[1]=($K[8]-$K[2])*$I,$_[2]=($K[1]-$K[4])*$I):$K[0]>=$K[5]&&$K[0]>=$K[10]?($T=.5/($I=Math.sqrt(1+$K[0]-$K[5]-$K[10])),$_[0]=.5*$I,$_[1]=($K[1]+$K[4])*$T,$_[2]=($K[2]+$K[8])*$T,$_[3]=($K[6]-$K[9])*$T):$K[5]>$K[10]?($T=.5/($I=Math.sqrt(1+$K[5]-$K[0]-$K[10])),$_[0]=($K[4]+$K[1])*$T,$_[1]=.5*$I,$_[2]=($K[9]+$K[6])*$T,$_[3]=($K[8]-$K[2])*$T):($T=.5/($I=Math.sqrt(1+$K[10]-$K[0]-$K[5])),$_[0]=($K[8]+$K[2])*$T,$_[1]=($K[9]+$K[6])*$T,$_[2]=.5*$I,$_[3]=($K[1]-$K[4])*$T)},$K.slerp=function($t,$H,$I,$T){var $K,$_,$V,$e,$R,$A=$t.elements,$q=$H.elements,$f=$T.elements,$b=$A[0],$L=$A[1],$G=$A[2],$M=$A[3],$O=$q[0],$J=$q[1],$S=$q[2],$U=$q[3];return($_=$b*$O+$L*$J+$G*$S+$M*$U)<0&&($_=-$_,$O=-$O,$J=-$J,$S=-$S,$U=-$U),$R=1e-6<1-$_?($K=Math.acos($_),$V=Math.sin($K),$e=Math.sin((1-$I)*$K)/$V,Math.sin($I*$K)/$V):($e=1-$I,$I),$f[0]=$e*$b+$R*$O,$f[1]=$e*$L+$R*$J,$f[2]=$e*$G+$R*$S,$f[3]=$e*$M+$R*$U,$f},$K.lerp=function($t,$H,$I,$T){var $K=$T.elements,$_=$t.elements,$V=$H.elements,$e=$_[0],$R=$_[1],$A=$_[2],$q=$_[3];$K[0]=$e+$I*($V[0]-$e),$K[1]=$R+$I*($V[1]-$R),$K[2]=$A+$I*($V[2]-$A),$K[3]=$q+$I*($V[3]-$q)},$K.add=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]+$_[0],$T[1]=$K[1]+$_[1],$T[2]=$K[2]+$_[2],$T[3]=$K[3]+$_[3]},$K.dot=function($t,$H){var $I=$t.elements,$T=$H.elements;return $I[0]*$T[0]+$I[1]*$T[1]+$I[2]*$T[2]+$I[3]*$T[3]},$K.rotationLookAt=function($t,$H,$I){$K.lookAt($VH.ZERO,$t,$H,$I)},$K.lookAt=function($t,$H,$I,$T){$Zt.lookAt($t,$H,$I,$K._tempMatrix3x3),$K.rotationMatrix($K._tempMatrix3x3,$T)},$K.invert=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$t.lengthSquared();$dt.isZero($K)||($K=1/$K,$T[0]=-$I[0]*$K,$T[1]=-$I[1]*$K,$T[2]=-$I[2]*$K,$T[3]=$I[3]*$K)},$K.rotationMatrix=function($t,$H){var $I=$t.elements,$T=$I[0],$K=$I[1],$_=$I[2],$V=$I[3],$e=$I[4],$R=$I[5],$A=$I[6],$q=$I[7],$f=$I[8],$b=$H.elements,$L=NaN,$G=NaN,$M=$T+$e+$f;0<$M?($L=Math.sqrt($M+1),$b[3]=.5*$L,$L=.5/$L,$b[0]=($R-$q)*$L,$b[1]=($A-$_)*$L,$b[2]=($K-$V)*$L):$e<=$T&&$f<=$T?($G=.5/($L=Math.sqrt(1+$T-$e-$f)),$b[0]=.5*$L,$b[1]=($K+$V)*$G,$b[2]=($_+$A)*$G,$b[3]=($R-$q)*$G):$f<$e?($G=.5/($L=Math.sqrt(1+$e-$T-$f)),$b[0]=($V+$K)*$G,$b[1]=.5*$L,$b[2]=($q+$R)*$G,$b[3]=($A-$_)*$G):($G=.5/($L=Math.sqrt(1+$f-$T-$e)),$b[0]=($A+$_)*$G,$b[1]=($q+$R)*$G,$b[2]=.5*$L,$b[3]=($K-$V)*$G)},$K.DEFAULT=new $K,$f($K,["TEMPVector30",function(){return this.TEMPVector30=new $VH},"TEMPVector31",function(){return this.TEMPVector31=new $VH},"TEMPVector32",function(){return this.TEMPVector32=new $VH},"TEMPVector33",function(){return this.TEMPVector33=new $VH},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $tH},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $tH},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $Zt},"NAN",function(){return this.NAN=new $K(NaN,NaN,NaN,NaN)}]),$K}(),$TH=function(){function $t($t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$L($t,"laya.d3.math.Rand");var $H=$t.prototype;return $H.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$H.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$H.getSignedFloat=function(){return 2*this.getFloat()-1},$G(0,$H,"seed",function(){return this.seeds[0]},function($t){this.seeds[0]=$t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$t.getFloatFromInt=function($t){return 1/8388607*(8388607&$t)},$t.getByteFromInt=function($t){return(8388607&$t)>>>15},$t}(),$KH=(function(){function $K($t){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($t instanceof Array)||4!==$t.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$t[0],this._state0L=0|$t[1],this._state1U=0|$t[2],this._state1L=0|$t[3]}$L($K,"laya.d3.math.RandX");var $t=$K.prototype;$t.randomint=function(){var $t=this._state0U,$H=this._state0L,$I=this._state1U,$T=this._state1L,$K=($T>>>0)+($H>>>0),$_=$I+$t+($K/2>>>31)>>>0,$V=$K>>>0,$e=0,$R=0;$e=($t^=$e=$t<<23|(-512&$H)>>>9)^(this._state0U=$I),$R=($H^=$R=$H<<23)^(this._state0L=$T);$e^=$t>>>18,$R^=$H>>>18|(262143&$t)<<14;return $e^=$I>>>5,$R^=$T>>>5|(31&$I)<<27,this._state1U=$e,this._state1L=$R,[$_,$V]},$t.random=function(){var $t=this.randomint(),$H=$t[0],$I=1023<<20|$H>>>12,$T=0|($t[1]>>>12|(4095&$H)<<20);return $K._CONVERTION_BUFFER.setUint32(0,$I,!1),$K._CONVERTION_BUFFER.setUint32(4,$T,!1),$TH._CONVERTION_BUFFER.getFloat64(0,!1)-1},$f($K,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $TH([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $t($t,$H){this.origin=null,this.direction=null,this.origin=$t,this.direction=$H}return $L($t,"laya.d3.math.Ray"),$t}()),$_H=function(){function $t($t,$H){this.elements=new Float32Array(2),void 0===$t&&($t=0),void 0===$H&&($H=0);var $I=this.elements;$I[0]=$t,$I[1]=$H}$L($t,"laya.d3.math.Vector2");var $H=$t.prototype;return $N.imps($H,{"laya.d3.core.IClone":!0}),$H.fromArray=function($t,$H){void 0===$H&&($H=0),this.elements[0]=$t[$H+0],this.elements[1]=$t[$H+1]},$H.cloneTo=function($t){var $H=$t.elements,$I=this.elements;$H[0]=$I[0],$H[1]=$I[1]},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"x",function(){return this.elements[0]},function($t){this.elements[0]=$t}),$G(0,$H,"y",function(){return this.elements[1]},function($t){this.elements[1]=$t}),$t.scale=function($t,$H,$I){var $T=$I.elements,$K=$t.elements;$T[0]=$K[0]*$H,$T[1]=$K[1]*$H},$f($t,["ZERO",function(){return this.ZERO=new $t(0,0)},"ONE",function(){return this.ONE=new $t(1,1)}]),$t}(),$VH=function(){function $q($t,$H,$I){this.elements=new Float32Array(3),void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0);var $T=this.elements;$T[0]=$t,$T[1]=$H,$T[2]=$I}$L($q,"laya.d3.math.Vector3");var $t=$q.prototype;return $N.imps($t,{"laya.d3.core.IClone":!0}),$t.fromArray=function($t,$H){void 0===$H&&($H=0),this.elements[0]=$t[$H+0],this.elements[1]=$t[$H+1],this.elements[2]=$t[$H+2]},$t.cloneTo=function($t){var $H=$t.elements,$I=this.elements;$H[0]=$I[0],$H[1]=$I[1],$H[2]=$I[2]},$t.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$t.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$t.reset=function($t,$H,$I){this.elements[0]=$t,this.elements[1]=$H,this.elements[2]=$I},$G(0,$t,"x",function(){return this.elements[0]},function($t){this.elements[0]=$t}),$G(0,$t,"y",function(){return this.elements[1]},function($t){this.elements[1]=$t}),$G(0,$t,"z",function(){return this.elements[2]},function($t){this.elements[2]=$t}),$q.distanceSquared=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$I[0]-$T[0],$_=$I[1]-$T[1],$V=$I[2]-$T[2];return $K*$K+$_*$_+$V*$V},$q.distance=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$I[0]-$T[0],$_=$I[1]-$T[1],$V=$I[2]-$T[2];return Math.sqrt($K*$K+$_*$_+$V*$V)},$q.min=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=Math.min($K[0],$_[0]),$T[1]=Math.min($K[1],$_[1]),$T[2]=Math.min($K[2],$_[2])},$q.max=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=Math.max($K[0],$_[0]),$T[1]=Math.max($K[1],$_[1]),$T[2]=Math.max($K[2],$_[2])},$q.transformQuat=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements,$V=$K[0],$e=$K[1],$R=$K[2],$A=$_[0],$q=$_[1],$f=$_[2],$b=$_[3],$L=$b*$V+$q*$R-$f*$e,$G=$b*$e+$f*$V-$A*$R,$M=$b*$R+$A*$e-$q*$V,$O=-$A*$V-$q*$e-$f*$R;$T[0]=$L*$b+$O*-$A+$G*-$f-$M*-$q,$T[1]=$G*$b+$O*-$q+$M*-$A-$L*-$f,$T[2]=$M*$b+$O*-$f+$L*-$q-$G*-$A},$q.scalarLength=function($t){var $H=$t.elements,$I=$H[0],$T=$H[1],$K=$H[2];return Math.sqrt($I*$I+$T*$T+$K*$K)},$q.scalarLengthSquared=function($t){var $H=$t.elements,$I=$H[0],$T=$H[1],$K=$H[2];return $I*$I+$T*$T+$K*$K},$q.normalize=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$I[0],$_=$I[1],$V=$I[2],$e=$K*$K+$_*$_+$V*$V;0<$e&&($e=1/Math.sqrt($e),$T[0]=$I[0]*$e,$T[1]=$I[1]*$e,$T[2]=$I[2]*$e)},$q.multiply=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]*$_[0],$T[1]=$K[1]*$_[1],$T[2]=$K[2]*$_[2]},$q.scale=function($t,$H,$I){var $T=$I.elements,$K=$t.elements;$T[0]=$K[0]*$H,$T[1]=$K[1]*$H,$T[2]=$K[2]*$H},$q.lerp=function($t,$H,$I,$T){var $K=$T.elements,$_=$t.elements,$V=$H.elements,$e=$_[0],$R=$_[1],$A=$_[2];$K[0]=$e+$I*($V[0]-$e),$K[1]=$R+$I*($V[1]-$R),$K[2]=$A+$I*($V[2]-$A)},$q.transformV3ToV3=function($t,$H,$I){var $T=$q._tempVector4;$q.transformV3ToV4($t,$H,$T);var $K=$T.elements,$_=$I.elements;$_[0]=$K[0],$_[1]=$K[1],$_[2]=$K[2]},$q.transformV3ToV4=function($t,$H,$I){var $T=$t.elements,$K=$T[0],$_=$T[1],$V=$T[2],$e=$H.elements,$R=$I.elements;$R[0]=$K*$e[0]+$_*$e[4]+$V*$e[8]+$e[12],$R[1]=$K*$e[1]+$_*$e[5]+$V*$e[9]+$e[13],$R[2]=$K*$e[2]+$_*$e[6]+$V*$e[10]+$e[14],$R[3]=$K*$e[3]+$_*$e[7]+$V*$e[11]+$e[15]},$q.TransformNormal=function($t,$H,$I){var $T=$t.elements,$K=$T[0],$_=$T[1],$V=$T[2],$e=$H.elements,$R=$I.elements;$R[0]=$K*$e[0]+$_*$e[4]+$V*$e[8],$R[1]=$K*$e[1]+$_*$e[5]+$V*$e[9],$R[2]=$K*$e[2]+$_*$e[6]+$V*$e[10]},$q.transformCoordinate=function($t,$H,$I){var $T=$q._tempVector4.elements,$K=$t.elements,$_=$K[0],$V=$K[1],$e=$K[2],$R=$H.elements;$T[0]=$_*$R[0]+$V*$R[4]+$e*$R[8]+$R[12],$T[1]=$_*$R[1]+$V*$R[5]+$e*$R[9]+$R[13],$T[2]=$_*$R[2]+$V*$R[6]+$e*$R[10]+$R[14],$T[3]=1/($_*$R[3]+$V*$R[7]+$e*$R[11]+$R[15]);var $A=$I.elements;$A[0]=$T[0]*$T[3],$A[1]=$T[1]*$T[3],$A[2]=$T[2]*$T[3]},$q.Clamp=function($t,$H,$I,$T){var $K=$t.elements,$_=$K[0],$V=$K[1],$e=$K[2],$R=$H.elements,$A=$R[0],$q=$R[1],$f=$R[2],$b=$I.elements,$L=$b[0],$G=$b[1],$M=$b[2],$O=$T.elements;$_=($_=$L<$_?$L:$_)<$A?$A:$_,$V=($V=$G<$V?$G:$V)<$q?$q:$V,$e=($e=$M<$e?$M:$e)<$f?$f:$e,$O[0]=$_,$O[1]=$V,$O[2]=$e},$q.add=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]+$_[0],$T[1]=$K[1]+$_[1],$T[2]=$K[2]+$_[2]},$q.subtract=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]-$_[0],$T[1]=$K[1]-$_[1],$T[2]=$K[2]-$_[2]},$q.cross=function($t,$H,$I){var $T=$t.elements,$K=$H.elements,$_=$I.elements,$V=$T[0],$e=$T[1],$R=$T[2],$A=$K[0],$q=$K[1],$f=$K[2];$_[0]=$e*$f-$R*$q,$_[1]=$R*$A-$V*$f,$_[2]=$V*$q-$e*$A},$q.dot=function($t,$H){var $I=$t.elements,$T=$H.elements;return $I[0]*$T[0]+$I[1]*$T[1]+$I[2]*$T[2]},$q.equals=function($t,$H){var $I=$t.elements,$T=$H.elements;return $dt.nearEqual(Math.abs($I[0]),Math.abs($T[0]))&&$dt.nearEqual(Math.abs($I[1]),Math.abs($T[1]))&&$dt.nearEqual(Math.abs($I[2]),Math.abs($T[2]))},$q.ZERO=new $q(0,0,0),$q.ONE=new $q(1,1,1),$q.NegativeUnitX=new $q(-1,0,0),$q.UnitX=new $q(1,0,0),$q.UnitY=new $q(0,1,0),$q.UnitZ=new $q(0,0,1),$q.ForwardRH=new $q(0,0,-1),$q.ForwardLH=new $q(0,0,1),$q.Up=new $q(0,1,0),$q.NAN=new $q(NaN,NaN,NaN),$f($q,["_tempVector4",function(){return this._tempVector4=new $eH}]),$q}(),$eH=function(){function $t($t,$H,$I,$T){this.elements=new Float32Array(4),void 0===$t&&($t=0),void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=0);var $K=this.elements;$K[0]=$t,$K[1]=$H,$K[2]=$I,$K[3]=$T}$L($t,"laya.d3.math.Vector4");var $H=$t.prototype;return $N.imps($H,{"laya.d3.core.IClone":!0}),$H.fromArray=function($t,$H){void 0===$H&&($H=0),this.elements[0]=$t[$H+0],this.elements[1]=$t[$H+1],this.elements[2]=$t[$H+2],this.elements[3]=$t[$H+3]},$H.cloneTo=function($t){var $H=$t.elements,$I=this.elements;$H[0]=$I[0],$H[1]=$I[1],$H[2]=$I[2],$H[3]=$I[3]},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$H.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$H.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$G(0,$H,"x",function(){return this.elements[0]},function($t){this.elements[0]=$t}),$G(0,$H,"y",function(){return this.elements[1]},function($t){this.elements[1]=$t}),$G(0,$H,"z",function(){return this.elements[2]},function($t){this.elements[2]=$t}),$G(0,$H,"w",function(){return this.elements[3]},function($t){this.elements[3]=$t}),$t.lerp=function($t,$H,$I,$T){var $K=$T.elements,$_=$t.elements,$V=$H.elements,$e=$_[0],$R=$_[1],$A=$_[2],$q=$_[3];$K[0]=$e+$I*($V[0]-$e),$K[1]=$R+$I*($V[1]-$R),$K[2]=$A+$I*($V[2]-$A),$K[3]=$q+$I*($V[3]-$q)},$t.transformByM4x4=function($t,$H,$I){var $T=$t.elements,$K=$T[0],$_=$T[1],$V=$T[2],$e=$T[3],$R=$H.elements,$A=$I.elements;$A[0]=$K*$R[0]+$_*$R[4]+$V*$R[8]+$e*$R[12],$A[1]=$K*$R[1]+$_*$R[5]+$V*$R[9]+$e*$R[13],$A[2]=$K*$R[2]+$_*$R[6]+$V*$R[10]+$e*$R[14],$A[3]=$K*$R[3]+$_*$R[7]+$V*$R[11]+$e*$R[15]},$t.equals=function($t,$H){var $I=$t.elements,$T=$H.elements;return $dt.nearEqual(Math.abs($I[0]),Math.abs($T[0]))&&$dt.nearEqual(Math.abs($I[1]),Math.abs($T[1]))&&$dt.nearEqual(Math.abs($I[2]),Math.abs($T[2]))&&$dt.nearEqual(Math.abs($I[3]),Math.abs($T[3]))},$t.normalize=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$t.length();0<$K&&($T[0]=$I[0]*$K,$T[1]=$I[1]*$K,$T[2]=$I[2]*$K,$T[3]=$I[3]*$K)},$t.add=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]+$_[0],$T[1]=$K[1]+$_[1],$T[2]=$K[2]+$_[2],$T[3]=$K[3]+$_[3]},$t.subtract=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]-$_[0],$T[1]=$K[1]-$_[1],$T[2]=$K[2]-$_[2],$T[3]=$K[3]-$_[3]},$t.multiply=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=$K[0]*$_[0],$T[1]=$K[1]*$_[1],$T[2]=$K[2]*$_[2],$T[3]=$K[3]*$_[3]},$t.scale=function($t,$H,$I){var $T=$I.elements,$K=$t.elements;$T[0]=$K[0]*$H,$T[1]=$K[1]*$H,$T[2]=$K[2]*$H,$T[3]=$K[3]*$H},$t.Clamp=function($t,$H,$I,$T){var $K=$t.elements,$_=$K[0],$V=$K[1],$e=$K[2],$R=$K[3],$A=$H.elements,$q=$A[0],$f=$A[1],$b=$A[2],$L=$A[3],$G=$I.elements,$M=$G[0],$O=$G[1],$J=$G[2],$S=$G[3],$U=$T.elements;$_=($_=$M<$_?$M:$_)<$q?$q:$_,$V=($V=$O<$V?$O:$V)<$f?$f:$V,$e=($e=$J<$e?$J:$e)<$b?$b:$e,$R=($R=$S<$R?$S:$R)<$L?$L:$R,$U[0]=$_,$U[1]=$V,$U[2]=$e,$U[3]=$R},$t.distanceSquared=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$I[0]-$T[0],$_=$I[1]-$T[1],$V=$I[2]-$T[2],$e=$I[3]-$T[3];return $K*$K+$_*$_+$V*$V+$e*$e},$t.distance=function($t,$H){var $I=$t.elements,$T=$H.elements,$K=$I[0]-$T[0],$_=$I[1]-$T[1],$V=$I[2]-$T[2],$e=$I[3]-$T[3];return Math.sqrt($K*$K+$_*$_+$V*$V+$e*$e)},$t.dot=function($t,$H){var $I=$t.elements,$T=$H.elements;return $I[0]*$T[0]+$I[1]*$T[1]+$I[2]*$T[2]+$I[3]*$T[3]},$t.min=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=Math.min($K[0],$_[0]),$T[1]=Math.min($K[1],$_[1]),$T[2]=Math.min($K[2],$_[2]),$T[3]=Math.min($K[3],$_[3])},$t.max=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H.elements;$T[0]=Math.max($K[0],$_[0]),$T[1]=Math.max($K[1],$_[1]),$T[2]=Math.max($K[2],$_[2]),$T[3]=Math.max($K[3],$_[3])},$f($t,["ZERO",function(){return this.ZERO=new $t},"ONE",function(){return this.ONE=new $t(1,1,1,1)},"UnitX",function(){return this.UnitX=new $t(1,0,0,0)},"UnitY",function(){return this.UnitY=new $t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $t(0,0,1,0)},"UnitW",function(){return this.UnitW=new $t(0,0,0,1)}]),$t}(),$RH=function(){function $_($t,$H,$I,$T){this.minDepth=0,this.maxDepth=1,this.x=$t,this.y=$H,this.width=$I,this.height=$T}$L($_,"laya.d3.math.Viewport");var $t=$_.prototype;return $t.project=function($t,$H,$I){$VH.transformV3ToV3($t,$H,$I);var $T=$t.elements,$K=$H.elements,$_=$I.elements,$V=$T[0]*$K[3]+$T[1]*$K[7]+$T[2]*$K[11]+$K[15];1!==$V&&($_[0]=$_[0]/$V,$_[1]=$_[1]/$V,$_[2]=$_[2]/$V),$_[0]=.5*($_[0]+1)*this.width+this.x,$_[1]=.5*(1-$_[1])*this.height+this.y,$_[2]=$_[2]*(this.maxDepth-this.minDepth)+this.minDepth},$t.unprojectFromMat=function($t,$H,$I){var $T=$t.elements,$K=$H.elements,$_=$I.elements;$_[0]=($T[0]-this.x)/this.width*2-1,$_[1]=-(($T[1]-this.y)/this.height*2-1);var $V=(this.maxDepth-this.minDepth)/2;$_[2]=($T[2]-this.minDepth-$V)/$V;var $e=$_[0]*$K[3]+$_[1]*$K[7]+$_[2]*$K[11]+$K[15];$VH.transformV3ToV3($I,$H,$I),1!==$e&&($_[0]=$_[0]/$e,$_[1]=$_[1]/$e,$_[2]=$_[2]/$e)},$t.unprojectFromWVP=function($t,$H,$I,$T,$K){$tH.multiply($H,$I,$_._tempMatrix4x4),$T&&$tH.multiply($_._tempMatrix4x4,$T,$_._tempMatrix4x4),$_._tempMatrix4x4.invert($_._tempMatrix4x4),this.unprojectFromMat($t,$_._tempMatrix4x4,$K)},$f($_,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $tH}]),$_}(),$AH=function(){function $r($t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$L($r,"laya.d3.resource.models.SubMesh");var $t=$r.prototype;return $N.imps($t,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$t._getVertexBuffer=function($t){return void 0===$t&&($t=0),0===$t?this._vertexBuffer:null},$t._getIndexBuffer=function(){return this._indexBuffer},$t._getStaticBatchBakedVertexs=function($t,$H){var $I,$T,$K=this._vertexBuffer,$_=$K.vertexDeclaration,$V=$_.getVertexElementByUsage(0).offset/4,$e=$_.getVertexElementByUsage(3).offset/4,$R=$H.meshRender.lightmapScaleOffset,$A=0,$q=0,$f=0,$b=0,$L=0,$G=0;if($R)if($T=$_.getVertexElementByUsage(15))$f=$_.vertexStride/4,$I=0<this._vertexCount?$K.getData().slice(this._vertexStart*$f,(this._vertexStart+this._vertexCount)*$f):$K.getData().slice(),$b=$T.offset/4;else{$f=($G=$_.vertexStride/4)+2,$I=this._vertexCount?new Float32Array(this._vertexCount*($K.vertexDeclaration.vertexStride/4+2)):new Float32Array($K.vertexCount*($K.vertexDeclaration.vertexStride/4+2)),$b=($L=$_.getVertexElementByUsage(2).offset/4)+2;var $M=$K.getData();for($A=0,$q=$M.length/$G;$A<$q;$A++){var $O=0;$O=0<this._vertexCount?(this._vertexStart+$A)*$G:$A*$G;var $J=$A*$f,$S=0;for($S=0;$S<$b;$S++)$I[$J+$S]=$M[$O+$S];for($S=$b;$S<$G;$S++)$I[$J+$S+2]=$M[$O+$S]}}else $f=$_.vertexStride/4,$I=this._vertexCount?$K.getData().slice(this._vertexStart*$f,(this._vertexStart+this._vertexCount)*$f):$K.getData().slice();if($t){var $U=$t.worldMatrix,$C=$r._tempMatrix4x40;$U.invert($C);var $N=$r._tempMatrix4x41,$w=$H.transform.worldMatrix;$tH.multiply($C,$w,$N)}else $N=$H.transform.worldMatrix;var $W=$r._tempQuaternion0;for($N.decomposeTransRotScale($r._tempVector30,$W,$r._tempVector31),$A=0,$q=$I.length/$f;$A<$q;$A++){var $s=$A*$f+$V,$z=$A*$f+$e;if($OH.transformVector3ArrayToVector3ArrayCoordinate($I,$s,$N,$I,$s),$OH.transformVector3ArrayByQuat($I,$z,$W,$I,$z),$R){var $P=$A*$f+$b;if($T)$OH.transformLightingMapTexcoordByUV1Array($I,$P,$R,$I,$P);else{var $k=$A*$G+$L;$OH.transformLightingMapTexcoordByUV0Array($M,$k,$R,$I,$P)}}}return $I},$t._getVertexBuffers=function(){return null},$t._beforeRender=function($t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$t._render=function($t){var $H,$I=0,$T=$t.renderElement;if(1<this._indexCount){var $K=this._boneIndicesList.length;if(1<$K){for(var $_=0;$_<$K;$_++)($H=$T._skinAnimationDatas||this._skinAnimationDatas)&&($T._shaderValue.setValue(0,$H[$_]),$t._shader.uploadRenderElementUniforms($T._shaderValue.data)),$x.mainContext.drawElements(4,this._subIndexBufferCount[$_],5123,2*this._subIndexBufferStart[$_]);$s.drawCall+=$K}else($H=$T._skinAnimationDatas||this._skinAnimationDatas)&&($T._shaderValue.setValue(0,$H[0]),$t._shader.uploadRenderElementUniforms($T._shaderValue.data)),$x.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$s.drawCall++;$I=this._indexCount}else $I=this._indexBuffer.indexCount,($H=$T._skinAnimationDatas||this._skinAnimationDatas)&&($T._shaderValue.setValue(0,$H[0]),$t._shader.uploadRenderElementUniforms($T._shaderValue.data)),$x.mainContext.drawElements(4,$I,5123,0),$s.drawCall++;$s.trianglesFaces+=$I/3},$t.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$t.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$G(0,$t,"_vertexBufferCount",function(){return 1}),$G(0,$t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$f($r,["_tempVector30",function(){return this._tempVector30=new $VH},"_tempVector31",function(){return this._tempVector31=new $VH},"_tempQuaternion0",function(){return this._tempQuaternion0=new $IH},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $tH},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $tH}]),$r}(),$qH=function(){function $t($t){this.defineCounter=0,this.defines=null,$t?(this.defineCounter=$t.defineCounter,this.defines=$t.defines.slice()):(this.defineCounter=0,this.defines=[])}return $L($t,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$t.prototype.registerDefine=function($t){var $H=Math.pow(2,this.defineCounter++);return this.defines[$H]=$t,$H},$t}(),$fH=function(){function $t(){}return $L($t,"laya.d3.shader.ShaderInit3D"),$t.__init__=function(){var $t,$H;$sH._globalRegDefine("HIGHPRECISION",$sH.SHADERDEFINE_HIGHPRECISION),$sH._globalRegDefine("FOG",$sH.SHADERDEFINE_FOG),$sH._globalRegDefine("DIRECTIONLIGHT",$sH.SHADERDEFINE_DIRECTIONLIGHT),$sH._globalRegDefine("POINTLIGHT",$sH.SHADERDEFINE_POINTLIGHT),$sH._globalRegDefine("SPOTLIGHT",$sH.SHADERDEFINE_SPOTLIGHT),$sH._globalRegDefine("UV",$sH.SHADERDEFINE_UV0),$sH._globalRegDefine("COLOR",$sH.SHADERDEFINE_COLOR),$sH._globalRegDefine("UV1",$sH.SHADERDEFINE_UV1),$sH._globalRegDefine("CASTSHADOW",$LH.SHADERDEFINE_CAST_SHADOW),$sH._globalRegDefine("SHADOWMAP_PSSM1",$LH.SHADERDEFINE_SHADOW_PSSM1),$sH._globalRegDefine("SHADOWMAP_PSSM2",$LH.SHADERDEFINE_SHADOW_PSSM2),$sH._globalRegDefine("SHADOWMAP_PSSM3",$LH.SHADERDEFINE_SHADOW_PSSM3),$sH._globalRegDefine("SHADOWMAP_PCF_NO",$LH.SHADERDEFINE_SHADOW_PCF_NO),$sH._globalRegDefine("SHADOWMAP_PCF1",$LH.SHADERDEFINE_SHADOW_PCF1),$sH._globalRegDefine("SHADOWMAP_PCF2",$LH.SHADERDEFINE_SHADOW_PCF2),$sH._globalRegDefine("SHADOWMAP_PCF3",$LH.SHADERDEFINE_SHADOW_PCF3),$sH._globalRegDefine("DEPTHFOG",$sH.SAHDERDEFINE_DEPTHFOG),$vH.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$vH.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$t={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$H={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $I=$vH.nameKey.add("SIMPLE");shaderCompile=$sH.add($I,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$t,$H),$yH.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$yH.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$yH.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$yH.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$yH.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$yH.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$yH.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$yH.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$yH.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$t}(),$bH=function(){function $t(){this._data=null,this._data=[]}$L($t,"laya.d3.shader.ValusArray");var $H=$t.prototype;return $H.setValue=function($t,$H){this._data[$t]=$H},$G(0,$H,"data",function(){return this._data}),$t}(),$LH=function(){function $t(){}return $t.SHADERDEFINE_RECEIVE_SHADOW=1,$t.SHADERDEFINE_CAST_SHADOW=512,$t.SHADERDEFINE_SHADOW_PSSM1=1024,$t.SHADERDEFINE_SHADOW_PSSM2=2048,$t.SHADERDEFINE_SHADOW_PSSM3=4096,$t.SHADERDEFINE_SHADOW_PCF_NO=8192,$t.SHADERDEFINE_SHADOW_PCF1=16384,$t.SHADERDEFINE_SHADOW_PCF2=32768,$t.SHADERDEFINE_SHADOW_PCF3=65536,$t.MAX_PSSM_COUNT=3,$t}(),$GH=function(){function $n(){}return $L($n,"laya.d3.utils.Picker"),$n.calculateCursorRay=function($t,$H,$I,$T,$K,$_){var $V=$t.elements[0],$e=$t.elements[1],$R=$n._tempVector30,$A=$R.elements;$A[0]=$V,$A[1]=$e,$A[2]=$H.minDepth;var $q=$n._tempVector31,$f=$q.elements;$f[0]=$V,$f[1]=$e,$f[2]=$H.maxDepth;var $b=$_.origin,$L=$n._tempVector32;$H.unprojectFromWVP($R,$I,$T,$K,$b),$H.unprojectFromWVP($q,$I,$T,$K,$L);var $G=$_.direction.elements;$G[0]=$L.x-$b.x,$G[1]=$L.y-$b.y,$G[2]=$L.z-$b.z,$VH.normalize($_.direction,$_.direction)},$n.rayIntersectsPositionsAndIndices=function($t,$H,$I,$T,$K){for(var $_=$I.vertexStride/4,$V=$I.getVertexElementByUsage(0).offset/4,$e=Number.MAX_VALUE,$R=-1,$A=-1,$q=-1,$f=0;$f<$T.length;$f+=3){var $b=$n._tempVector35,$L=$b.elements,$G=$T[$f]*$_,$M=$G+$V;$L[0]=$H[$M],$L[1]=$H[1+$M],$L[2]=$H[2+$M];var $O=$n._tempVector36,$J=$O.elements,$S=$T[$f+1]*$_,$U=$S+$V;$J[0]=$H[$U],$J[1]=$H[1+$U],$J[2]=$H[2+$U];var $C=$n._tempVector37,$N=$C.elements,$w=$T[$f+2]*$_,$W=$w+$V;$N[0]=$H[$W],$N[1]=$H[1+$W],$N[2]=$H[2+$W];var $s=laya.d3.utils.Picker.rayIntersectsTriangle($t,$b,$O,$C);!isNaN($s)&&$s<$e&&($e=$s,$R=$G,$A=$S,$q=$w)}if($e===Number.MAX_VALUE)return $K.position.toDefault(),$K.distance=Number.MAX_VALUE,$K.trianglePositions[0].toDefault(),$K.trianglePositions[1].toDefault(),$K.trianglePositions[2].toDefault(),$K.triangleNormals[0].toDefault(),$K.triangleNormals[1].toDefault(),$K.triangleNormals[2].toDefault(),!1;$K.distance=$e,$VH.scale($t.direction,$e,$K.position),$VH.add($t.origin,$K.position,$K.position);var $z=$K.trianglePositions,$P=$z[0],$k=$z[1],$r=$z[2],$x=$P.elements,$Y=$k.elements,$D=$r.elements,$p=$R+$V;$x[0]=$H[$p],$x[1]=$H[$p+1],$x[2]=$H[$p+2];var $g=$A+$V;$Y[0]=$H[$g],$Y[1]=$H[$g+1],$Y[2]=$H[$g+2];var $l=$q+$V;$D[0]=$H[$l],$D[1]=$H[$l+1],$D[2]=$H[$l+2];var $v=$I.getVertexElementByUsage(3);if($v){var $y=$v.offset/4,$E=$K.triangleNormals,$h=$E[0],$X=$E[1],$B=$E[2],$a=$h.elements,$u=$X.elements,$$=$B.elements,$Q=$R+$y;$a[0]=$H[$Q],$a[1]=$H[$Q+1],$a[2]=$H[$Q+2];var $m=$A+$y;$u[0]=$H[$m],$u[1]=$H[$m+1],$u[2]=$H[$m+2];var $o=$q+$y;$$[0]=$H[$o],$$[1]=$H[$o+1],$$[2]=$H[$o+2]}return!0},$n.rayIntersectsTriangle=function($t,$H,$I,$T){var $K=$n._tempVector30,$_=$n._tempVector31;$VH.subtract($I,$H,$K),$VH.subtract($T,$H,$_);var $V,$e=$n._tempVector32;if($VH.cross($t.direction,$_,$e),($V=$VH.dot($K,$e))>-Number.MIN_VALUE&&$V<Number.MIN_VALUE)return Number.NaN;var $R,$A=1/$V,$q=$n._tempVector33;if($VH.subtract($t.origin,$H,$q),$R=$VH.dot($q,$e),($R*=$A)<0||1<$R)return Number.NaN;var $f,$b,$L=$n._tempVector34;return $VH.cross($q,$K,$L),$f=$VH.dot($t.direction,$L),($f*=$A)<0||1<$R+$f?Number.NaN:($b=$VH.dot($_,$L),($b*=$A)<0?Number.NaN:$b)},$f($n,["_tempVector30",function(){return this._tempVector30=new $VH},"_tempVector31",function(){return this._tempVector31=new $VH},"_tempVector32",function(){return this._tempVector32=new $VH},"_tempVector33",function(){return this._tempVector33=new $VH},"_tempVector34",function(){return this._tempVector34=new $VH},"_tempVector35",function(){return this._tempVector35=new $VH},"_tempVector36",function(){return this._tempVector36=new $VH},"_tempVector37",function(){return this._tempVector37=new $VH}]),$n}(),$MH=(function(){function $t(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $VH,new $VH,new $VH],this.trianglePositions.length=3,this.triangleNormals=[new $VH,new $VH,new $VH],this.triangleNormals.length=3,this.position=new $VH}$L($t,"laya.d3.utils.RaycastHit"),$t.prototype.cloneTo=function($t){$t.distance=this.distance,this.trianglePositions[0].cloneTo($t.trianglePositions[0]),this.trianglePositions[1].cloneTo($t.trianglePositions[1]),this.trianglePositions[2].cloneTo($t.trianglePositions[2]),this.triangleNormals[0].cloneTo($t.triangleNormals[0]),this.triangleNormals[1].cloneTo($t.triangleNormals[1]),this.triangleNormals[2].cloneTo($t.triangleNormals[2]),this.position.cloneTo($t.position),$t.sprite3D=this.sprite3D}}(),function(){function $t($t,$H){this._width=0,this._height=0,this._width=$t,this._height=$H}$L($t,"laya.d3.utils.Size");var $H=$t.prototype;return $G(0,$H,"width",function(){return-1===this._width?$F.clientWidth:this._width}),$G(0,$H,"height",function(){return-1===this._height?$F.clientHeight:this._height}),$G(1,$t,"fullScreen",function(){return new $t(-1,-1)}),$t}()),$OH=function(){function $p(){}return $L($p,"laya.d3.utils.Utils3D"),$p._rotationTransformScaleSkinAnimation=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f){var $b,$L,$G,$M,$O,$J=$p._tempArray16_0,$S=$p._tempArray16_1,$U=$p._tempArray16_2,$C=$T+$T,$N=$K+$K,$w=$_+$_,$W=$T*$C,$s=$K*$C,$z=$K*$N,$P=$_*$C,$k=$_*$N,$r=$_*$w,$x=$V*$C,$Y=$V*$N,$D=$V*$w;for($J[15]=1,$J[0]=1-$z-$r,$J[1]=$s+$D,$J[2]=$P-$Y,$J[4]=$s-$D,$J[5]=1-$W-$r,$J[6]=$k+$x,$J[8]=$P+$Y,$J[9]=$k-$x,$J[10]=1-$W-$z,$S[15]=1,$S[0]=$e,$S[5]=$R,$S[10]=$A,$b=0;$b<4;$b++)$L=$J[$b],$G=$J[$b+4],$M=$J[$b+8],$O=$J[$b+12],$U[$b]=$L,$U[$b+4]=$G,$U[$b+8]=$M,$U[$b+12]=$L*$t+$G*$H+$M*$I+$O;for($b=0;$b<4;$b++)$L=$U[$b],$G=$U[$b+4],$M=$U[$b+8],$O=$U[$b+12],$q[$b+$f]=$L*$S[0]+$G*$S[1]+$M*$S[2]+$O*$S[3],$q[$b+$f+4]=$L*$S[4]+$G*$S[5]+$M*$S[6]+$O*$S[7],$q[$b+$f+8]=$L*$S[8]+$G*$S[9]+$M*$S[10]+$O*$S[11],$q[$b+$f+12]=$L*$S[12]+$G*$S[13]+$M*$S[14]+$O*$S[15]},$p._createNodeByJson=function($t,$H,$I,$T){if(!$I)switch($H.type){case"Sprite3D":$I=new $lH;break;case"MeshSprite3D":$I=new $nH;break;case"SkinnedMeshSprite3D":$I=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$I=new ShuriKenParticle3D;break;case"TrailSprite3D":$I=new TrailSprite3D;break;case"Terrain":$I=new Terrain;break;case"Camera":$I=new $oH;break;case"DirectionLight":$I=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $K=$H.props;if($K)for(var $_ in $K)$I[$_]=$K[$_];var $V=$H.customProps;$V&&($I instanceof laya.d3.core.Sprite3D?($I._parseBaseCustomProps($V),$I._parseCustomProps($t,$T,$V,$H),$I._parseCustomComponent($t,$T,$H.components)):$I._parseCustomProps($t,$T,$V,$H));var $e=$H.child;if($e)for(var $R=0,$A=$e.length;$R<$A;$R++){var $q=$p._createNodeByJson($t,$e[$R],null,$T);$I.addChild($q)}return $I},$p._computeBoneAndAnimationDatasByBindPoseMatrxix=function($t,$H,$I,$T,$K,$_){var $V,$e,$R=0,$A=0,$q=$t.length;for($V=0;$V<$q;$R+=$t[$V].keyframeWidth,$A+=16,$V++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($H[$R+0],$H[$R+1],$H[$R+2],$H[$R+3],$H[$R+4],$H[$R+5],$H[$R+6],$H[$R+7],$H[$R+8],$H[$R+9],$T,$A),0!=$V&&($e=16*$t[$V].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($T,$e,$T,$A,$T,$A));var $f=$I.length;for($V=0;$V<$f;$V++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($T,16*$_[$V],$I[$V],$K,16*$V)},$p._computeAnimationDatasByArrayAndMatrixFast=function($t,$H,$I,$T){for(var $K=0,$_=$t.length;$K<$_;$K++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($H,16*$T[$K],$t[$K],$I,16*$K)},$p._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($t,$H,$I,$T,$K){var $_,$V,$e=0,$R=0,$A=$t.length;for($_=0;$_<$A;$e+=$t[$_].keyframeWidth,$R+=16,$_++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($H[$e+7],$H[$e+8],$H[$e+9],$H[$e+3],$H[$e+4],$H[$e+5],$H[$e+6],$H[$e+0],$H[$e+1],$H[$e+2],$T,$R),0!=$_&&($V=16*$t[$_].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($T,$V,$T,$R,$T,$R));var $q=$I.length;for($_=0;$_<$q;$_++){var $f=16*$_;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($T,$f,$I[$_],$K,$f)}},$p._computeAnimationDatasByArrayAndMatrixFastOld=function($t,$H,$I){for(var $T=$t.length,$K=0;$K<$T;$K++){var $_=16*$K;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($H,$_,$t[$K],$I,$_)}},$p._computeRootAnimationData=function($t,$H,$I){for(var $T=0,$K=0,$_=0,$V=$t.length;$T<$V;$K+=$t[$T].keyframeWidth,$_+=16,$T++)laya.d3.utils.Utils3D.createAffineTransformationArray($H[$K+0],$H[$K+1],$H[$K+2],$H[$K+3],$H[$K+4],$H[$K+5],$H[$K+6],$H[$K+7],$H[$K+8],$H[$K+9],$I,$_)},$p.transformVector3ArrayByQuat=function($t,$H,$I,$T,$K){var $_=$I.elements,$V=$t[$H],$e=$t[$H+1],$R=$t[$H+2],$A=$_[0],$q=$_[1],$f=$_[2],$b=$_[3],$L=$b*$V+$q*$R-$f*$e,$G=$b*$e+$f*$V-$A*$R,$M=$b*$R+$A*$e-$q*$V,$O=-$A*$V-$q*$e-$f*$R;$T[$K]=$L*$b+$O*-$A+$G*-$f-$M*-$q,$T[$K+1]=$G*$b+$O*-$q+$M*-$A-$L*-$f,$T[$K+2]=$M*$b+$O*-$f+$L*-$q-$G*-$A},$p.mulMatrixByArray=function($t,$H,$I,$T,$K,$_){var $V,$e,$R,$A,$q;if($K===$I){for($I=$p._tempArray16_3,$V=0;$V<16;++$V)$I[$V]=$K[$_+$V];$T=0}for($V=0;$V<4;$V++)$e=$t[$H+$V],$R=$t[$H+$V+4],$A=$t[$H+$V+8],$q=$t[$H+$V+12],$K[$_+$V]=$e*$I[$T+0]+$R*$I[$T+1]+$A*$I[$T+2]+$q*$I[$T+3],$K[$_+$V+4]=$e*$I[$T+4]+$R*$I[$T+5]+$A*$I[$T+6]+$q*$I[$T+7],$K[$_+$V+8]=$e*$I[$T+8]+$R*$I[$T+9]+$A*$I[$T+10]+$q*$I[$T+11],$K[$_+$V+12]=$e*$I[$T+12]+$R*$I[$T+13]+$A*$I[$T+14]+$q*$I[$T+15]},$p.mulMatrixByArrayFast=function($t,$H,$I,$T,$K,$_){var $V,$e,$R,$A,$q;for($V=0;$V<4;$V++)$e=$t[$H+$V],$R=$t[$H+$V+4],$A=$t[$H+$V+8],$q=$t[$H+$V+12],$K[$_+$V]=$e*$I[$T+0]+$R*$I[$T+1]+$A*$I[$T+2]+$q*$I[$T+3],$K[$_+$V+4]=$e*$I[$T+4]+$R*$I[$T+5]+$A*$I[$T+6]+$q*$I[$T+7],$K[$_+$V+8]=$e*$I[$T+8]+$R*$I[$T+9]+$A*$I[$T+10]+$q*$I[$T+11],$K[$_+$V+12]=$e*$I[$T+12]+$R*$I[$T+13]+$A*$I[$T+14]+$q*$I[$T+15]},$p.mulMatrixByArrayAndMatrixFast=function($t,$H,$I,$T,$K){var $_,$V,$e,$R,$A,$q=$I.elements,$f=$q[0],$b=$q[1],$L=$q[2],$G=$q[3],$M=$q[4],$O=$q[5],$J=$q[6],$S=$q[7],$U=$q[8],$C=$q[9],$N=$q[10],$w=$q[11],$W=$q[12],$s=$q[13],$z=$q[14],$P=$q[15],$k=$H,$r=$H+4,$x=$H+8,$Y=$H+12,$D=$K,$p=$K+4,$g=$K+8,$l=$K+12;for($_=0;$_<4;$_++)$V=$t[$k+$_],$e=$t[$r+$_],$R=$t[$x+$_],$A=$t[$Y+$_],$T[$D+$_]=$V*$f+$e*$b+$R*$L+$A*$G,$T[$p+$_]=$V*$M+$e*$O+$R*$J+$A*$S,$T[$g+$_]=$V*$U+$e*$C+$R*$N+$A*$w,$T[$l+$_]=$V*$W+$e*$s+$R*$z+$A*$P},$p.createAffineTransformationArray=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f){var $b=$T+$T,$L=$K+$K,$G=$_+$_,$M=$T*$b,$O=$T*$L,$J=$T*$G,$S=$K*$L,$U=$K*$G,$C=$_*$G,$N=$V*$b,$w=$V*$L,$W=$V*$G;$q[$f+0]=(1-($S+$C))*$e,$q[$f+1]=($O+$W)*$e,$q[$f+2]=($J-$w)*$e,$q[$f+3]=0,$q[$f+4]=($O-$W)*$R,$q[$f+5]=(1-($M+$C))*$R,$q[$f+6]=($U+$N)*$R,$q[$f+7]=0,$q[$f+8]=($J+$w)*$A,$q[$f+9]=($U-$N)*$A,$q[$f+10]=(1-($M+$S))*$A,$q[$f+11]=0,$q[$f+12]=$t,$q[$f+13]=$H,$q[$f+14]=$I,$q[$f+15]=1},$p.transformVector3ArrayToVector3ArrayCoordinate=function($t,$H,$I,$T,$K){var $_=$p._tempArray4_0,$V=$t[$H+0],$e=$t[$H+1],$R=$t[$H+2],$A=$I.elements;$_[0]=$V*$A[0]+$e*$A[4]+$R*$A[8]+$A[12],$_[1]=$V*$A[1]+$e*$A[5]+$R*$A[9]+$A[13],$_[2]=$V*$A[2]+$e*$A[6]+$R*$A[10]+$A[14],$_[3]=1/($V*$A[3]+$e*$A[7]+$R*$A[11]+$A[15]),$T[$K+0]=$_[0]*$_[3],$T[$K+1]=$_[1]*$_[3],$T[$K+2]=$_[2]*$_[3]},$p.transformLightingMapTexcoordByUV0Array=function($t,$H,$I,$T,$K){var $_=$I.elements;$T[$K+0]=$t[$H+0]*$_[0]+$_[2],$T[$K+1]=($t[$H+1]-1)*$_[1]+$_[3]},$p.transformLightingMapTexcoordByUV1Array=function($t,$H,$I,$T,$K){var $_=$I.elements;$T[$K+0]=$t[$H+0]*$_[0]+$_[2],$T[$K+1]=1+$t[$H+1]*$_[1]+$_[3]},$p.getURLVerion=function($t){var $H=$t.indexOf("?");return 0<=$H?$t.substr($H):null},$p._quaternionCreateFromYawPitchRollArray=function($t,$H,$I,$T){var $K=.5*$I,$_=.5*$H,$V=.5*$t,$e=Math.sin($K),$R=Math.cos($K),$A=Math.sin($_),$q=Math.cos($_),$f=Math.sin($V),$b=Math.cos($V);$T[0]=$b*$A*$R+$f*$q*$e,$T[1]=$f*$q*$R-$b*$A*$e,$T[2]=$b*$q*$e-$f*$A*$R,$T[3]=$b*$q*$R+$f*$A*$e},$p._createAffineTransformationArray=function($t,$H,$I,$T){var $K=$H[0],$_=$H[1],$V=$H[2],$e=$H[3],$R=$K+$K,$A=$_+$_,$q=$V+$V,$f=$K*$R,$b=$K*$A,$L=$K*$q,$G=$_*$A,$M=$_*$q,$O=$V*$q,$J=$e*$R,$S=$e*$A,$U=$e*$q,$C=$I[0],$N=$I[1],$w=$I[2];$T[0]=(1-($G+$O))*$C,$T[1]=($b+$U)*$C,$T[2]=($L-$S)*$C,$T[3]=0,$T[4]=($b-$U)*$N,$T[5]=(1-($f+$O))*$N,$T[6]=($M+$J)*$N,$T[7]=0,$T[8]=($L+$S)*$w,$T[9]=($M-$J)*$w,$T[10]=(1-($f+$G))*$w,$T[11]=0,$T[12]=$t[0],$T[13]=$t[1],$T[14]=$t[2],$T[15]=1},$p._mulMatrixArray=function($t,$H,$I,$T){var $K,$_,$V,$e,$R,$A=$H.elements,$q=$A[0],$f=$A[1],$b=$A[2],$L=$A[3],$G=$A[4],$M=$A[5],$O=$A[6],$J=$A[7],$S=$A[8],$U=$A[9],$C=$A[10],$N=$A[11],$w=$A[12],$W=$A[13],$s=$A[14],$z=$A[15],$P=$T,$k=$T+4,$r=$T+8,$x=$T+12;for($K=0;$K<4;$K++)$_=$t[$K],$V=$t[$K+4],$e=$t[$K+8],$R=$t[$K+12],$I[$P+$K]=$_*$q+$V*$f+$e*$b+$R*$L,$I[$k+$K]=$_*$G+$V*$M+$e*$O+$R*$J,$I[$r+$K]=$_*$S+$V*$U+$e*$C+$R*$N,$I[$x+$K]=$_*$w+$V*$W+$e*$s+$R*$z},$p.getYawPitchRoll=function($t,$H){$p.transformQuat($VH.ForwardRH,$t,$IH.TEMPVector31),$p.transformQuat($VH.Up,$t,$IH.TEMPVector32);var $I=$IH.TEMPVector32.elements;$p.angleTo($VH.ZERO,$IH.TEMPVector31,$IH.TEMPVector33);var $T=$IH.TEMPVector33.elements;$T[0]==Math.PI/2?($T[1]=$p.arcTanAngle($I[2],$I[0]),$T[2]=0):$T[0]==-Math.PI/2?($T[1]=$p.arcTanAngle(-$I[2],-$I[0]),$T[2]=0):($tH.createRotationY(-$T[1],$IH.TEMPMatrix0),$tH.createRotationX(-$T[0],$IH.TEMPMatrix1),$VH.transformCoordinate($IH.TEMPVector32,$IH.TEMPMatrix0,$IH.TEMPVector32),$VH.transformCoordinate($IH.TEMPVector32,$IH.TEMPMatrix1,$IH.TEMPVector32),$T[2]=$p.arcTanAngle($I[1],-$I[0])),$T[1]<=-Math.PI&&($T[1]=Math.PI),$T[2]<=-Math.PI&&($T[2]=Math.PI),$T[1]>=Math.PI&&$T[2]>=Math.PI&&($T[1]=0,$T[2]=0,$T[0]=Math.PI-$T[0]),$H[0]=$T[1],$H[1]=$T[0],$H[2]=$T[2]},$p.arcTanAngle=function($t,$H){return 0==$t?1==$H?Math.PI/2:-Math.PI/2:0<$t?Math.atan($H/$t):$t<0?0<$H?Math.atan($H/$t)+Math.PI:Math.atan($H/$t)-Math.PI:0},$p.angleTo=function($t,$H,$I){$VH.subtract($H,$t,$IH.TEMPVector30),$VH.normalize($IH.TEMPVector30,$IH.TEMPVector30),$I.elements[0]=Math.asin($IH.TEMPVector30.y),$I.elements[1]=$p.arcTanAngle(-$IH.TEMPVector30.z,-$IH.TEMPVector30.x)},$p.transformQuat=function($t,$H,$I){var $T=$I.elements,$K=$t.elements,$_=$H,$V=$K[0],$e=$K[1],$R=$K[2],$A=$_[0],$q=$_[1],$f=$_[2],$b=$_[3],$L=$b*$V+$q*$R-$f*$e,$G=$b*$e+$f*$V-$A*$R,$M=$b*$R+$A*$e-$q*$V,$O=-$A*$V-$q*$e-$f*$R;$T[0]=$L*$b+$O*-$A+$G*-$f-$M*-$q,$T[1]=$G*$b+$O*-$q+$M*-$A-$L*-$f,$T[2]=$M*$b+$O*-$f+$L*-$q-$G*-$A},$p.quaterionNormalize=function($t,$H){var $I=$t[0],$T=$t[1],$K=$t[2],$_=$t[3],$V=$I*$I+$T*$T+$K*$K+$_*$_;0<$V&&($V=1/Math.sqrt($V),$H[0]=$I*$V,$H[1]=$T*$V,$H[2]=$K*$V,$H[3]=$_*$V)},$p.matrix4x4MultiplyFFF=function($t,$H,$I){var $T,$K,$_,$V,$e;if($I===$H)for($H=new Float32Array(16),$T=0;$T<16;++$T)$H[$T]=$I[$T];for($T=0;$T<4;$T++)$K=$t[$T],$_=$t[$T+4],$V=$t[$T+8],$e=$t[$T+12],$I[$T]=$K*$H[0]+$_*$H[1]+$V*$H[2]+$e*$H[3],$I[$T+4]=$K*$H[4]+$_*$H[5]+$V*$H[6]+$e*$H[7],$I[$T+8]=$K*$H[8]+$_*$H[9]+$V*$H[10]+$e*$H[11],$I[$T+12]=$K*$H[12]+$_*$H[13]+$V*$H[14]+$e*$H[15]},$p.matrix4x4MultiplyMFM=function($t,$H,$I){$p.matrix4x4MultiplyFFF($t.elements,$H,$I.elements)},$f($p,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $VH},"_tempVector3_1",function(){return this._tempVector3_1=new $VH},"_tempVector3_2",function(){return this._tempVector3_2=new $VH},"_tempVector3_3",function(){return this._tempVector3_3=new $VH},"_tempVector3_4",function(){return this._tempVector3_4=new $VH},"_tempVector3_5",function(){return this._tempVector3_5=new $VH},"_tempVector3_6",function(){return this._tempVector3_6=new $VH},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$p}(),$JH=function(){function $Y(){}return $L($Y,"Laya3D"),$Y._cancelLoadByUrl=function($t){$N.loader.cancelLoadByUrl($t),$Y._innerFirstLevelLoaderManager.cancelLoadByUrl($t),$Y._innerSecondLevelLoaderManager.cancelLoadByUrl($t),$Y._innerThirdLevelLoaderManager.cancelLoadByUrl($t),$Y._innerFourthLevelLoaderManager.cancelLoadByUrl($t)},$Y._changeWebGLSize=function($t,$H){$x.onStageResize($t,$H),$F.clientWidth=$t,$F.clientHeight=$H},$Y.__init__=function(){var $t=$H.createMap;$t.lh=[$lH,"SPRITE3DHIERARCHY"],$t.ls=[$gH,"SPRITE3DHIERARCHY"],$t.lm=[$aH,"MESH"],$t.lmat=[$yH,"MATERIAL"],$t.jpg=[$$H,"nativeimage"],$t.jpeg=[$$H,"nativeimage"],$t.png=[$$H,"nativeimage"],$t.pkm=[$$H,"arraybuffer"],$t.raw=[$XH,"arraybuffer"],$t.mipmaps=[$XH,"arraybuffer"],$J.parserMap.SPRITE3DHIERARCHY=$Y._loadHierarchy,$J.parserMap.MESH=$Y._loadMesh,$J.parserMap.MATERIAL=$Y._loadMaterial,$J.parserMap.TEXTURECUBE=$Y._loadTextureCube,$J.parserMap.TERRAIN=$Y._loadTerrain,$Y._innerFirstLevelLoaderManager.on("error",null,$Y._eventLoadManagerError),$Y._innerSecondLevelLoaderManager.on("error",null,$Y._eventLoadManagerError),$Y._innerThirdLevelLoaderManager.on("error",null,$Y._eventLoadManagerError),$Y._innerFourthLevelLoaderManager.on("error",null,$Y._eventLoadManagerError)},$Y.READ_BLOCK=function(){return $Y._readData.pos+=4,!0},$Y.READ_DATA=function(){return $Y._DATA.offset=$Y._readData.getUint32(),$Y._DATA.size=$Y._readData.getUint32(),!0},$Y.READ_STRINGS=function(){var $t=[],$H={offset:0,size:0};$H.offset=$Y._readData.getUint16(),$H.size=$Y._readData.getUint16();$Y._readData.pos;$Y._readData.pos=$H.offset+$Y._DATA.offset;for(var $I=0;$I<$H.size;$I++){var $T=$Y._readData.readUTFString();-1===$T.lastIndexOf(".lmat")&&-1===$T.lastIndexOf(".lpbr")||$t.push($T)}return $t},$Y.formatRelativePath=function($t,$H){var $I;if("."===$H.charAt(0)){for(var $T=($t+$H).split("/"),$K=0,$_=$T.length;$K<$_;$K++)if(".."==$T[$K]){var $V=$K-1;0<$V&&".."!==$T[$V]&&($T.splice($V,2),$K-=2)}$I=$T.join("/")}else $I=$t+$H;return null!=$r.customFormat&&($I=$r.customFormat($I,null)),$I},$Y._eventLoadManagerError=function($t){$N.loader.event("error",$t)},$Y._addHierarchyInnerUrls=function($t,$H,$I,$T,$K,$_){var $V=$Y.formatRelativePath($T,$K);$I&&($V+=$I),$t.push({url:$V,clas:$_}),$H[$K]=$V},$Y._getSprite3DHierarchyInnerUrls=function($t,$H,$I,$T,$K,$_,$V){var $e,$R=0,$A=0;switch($t.type){case"Scene":var $q=$t.customProps.lightmaps;for($R=0,$A=$q.length;$R<$A;$R++){var $f=$q[$R].replace(".exr",".png");$Y._addHierarchyInnerUrls($T,$K,$_,$V,$f,$$H)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $b;if($t.instanceParams)($b=$t.instanceParams.loadPath)&&$Y._addHierarchyInnerUrls($H,$K,$_,$V,$b,$aH);else{($b=($e=$t.customProps).meshPath)&&$Y._addHierarchyInnerUrls($H,$K,$_,$V,$b,$aH);var $L=$e.materials;if($L)for($R=0,$A=$L.length;$R<$A;$R++){for(var $G=$L[$R],$M=$G.type.split("."),$O=$D.window,$J=0,$S=$M.length;$J<$S;++$J){$O=$O[this.clasPaths[$J]]}if("function"!=typeof $O)throw"_getSprite3DHierarchyInnerUrls 错误: "+$G.type+" 不是类";$Y._addHierarchyInnerUrls($I,$K,$_,$V,$G.path,$O)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $U=($e=$t.customProps).meshPath;$U&&$Y._addHierarchyInnerUrls($H,$K,$_,$V,$U,$aH);var $C=$e.material;if($C){$M=$C.type.split("."),$O=$D.window;for($J=0,$S=$M.length;$J<$S;++$J){$O=$O[this.clasPaths[$J]]}$Y._addHierarchyInnerUrls($I,$K,$_,$V,$C.path,$O)}else{var $N=$e.materialPath;if($N)$Y._addHierarchyInnerUrls($I,$K,$_,$V,$N,ShurikenParticleMaterial);else{var $w=$e.texturePath;$w&&$Y._addHierarchyInnerUrls($T,$K,$_,$V,$w,$$H)}}break;case"Terrain":$Y._addHierarchyInnerUrls($T,$K,$_,$V,$t.customProps.dataPath,TerrainRes)}var $W=$t.components;for(var $s in $W){var $z=$W[$s];switch($s){case"Animator":var $P=$z.avatarPath;if($P)$Y._addHierarchyInnerUrls($T,$K,$_,$V,$P,Avatar);else{var $k=$z.avatar;$k&&$Y._addHierarchyInnerUrls($T,$K,$_,$V,$k.path,Avatar)}var $r=$z.clipPaths;for($R=0,$A=$r.length;$R<$A;$R++)$Y._addHierarchyInnerUrls($T,$K,$_,$V,$r[$R],AnimationClip)}}var $x=$t.child;for($R=0,$A=$x.length;$R<$A;$R++)$Y._getSprite3DHierarchyInnerUrls($x[$R],$H,$I,$T,$K,$_,$V)},$Y._loadHierarchy=function($t){$t.on("loaded",null,$Y._onHierarchylhLoaded,[$t,$t._class._getGroup()]),$t.load($t.url,"json",!1,null,!0)},$Y._onHierarchylhLoaded=function($t,$H,$I){if($t._class.destroyed)$t.endLoad();else{var $T=$t.url,$K=$OH.getURLVerion($T),$_=$r.getPath($T),$V=[],$e=[],$R=[],$A={};$Y._getSprite3DHierarchyInnerUrls($I,$V,$e,$R,$A,$K,$_);var $q=$V.length+$e.length+$R.length,$f=$q+1,$b=1/$f;if($Y._onProcessChange($t,0,$b,1),0<$R.length){var $L=$q/$f,$G=$k.create(null,$Y._onProcessChange,[$t,$b,$L],!1);$Y._innerFourthLevelLoaderManager.create($R,$k.create(null,$Y._onHierarchyInnerForthLevResouLoaded,[$t,$H,$G,$I,$A,$V,$e,$b+$L*$R.length,$L]),$G,null,null,1,!0,$H)}else $Y._onHierarchyInnerForthLevResouLoaded($t,$H,null,$I,$A,$V,$e,$b,$L)}},$Y._onHierarchyInnerForthLevResouLoaded=function($t,$H,$I,$T,$K,$_,$V,$e,$R){if($t._class.destroyed)$t.endLoad();else if($I&&$I.recover(),0<$V.length){var $A=$k.create(null,$Y._onProcessChange,[$t,$e,$R],!1);$Y._innerSecondLevelLoaderManager.create($V,$k.create(null,$Y._onHierarchyInnerSecondLevResouLoaded,[$t,$H,$A,$T,$K,$_,$e+$R*$V.length,$R]),$I,null,null,1,!0,$H)}else $Y._onHierarchyInnerSecondLevResouLoaded($t,$H,null,$T,$K,$_,$e,$R)},$Y._onHierarchyInnerSecondLevResouLoaded=function($t,$H,$I,$T,$K,$_,$V,$e){if($t._class.destroyed)$t.endLoad();else if($I&&$I.recover(),0<$_.length){var $R=$k.create(null,$Y._onProcessChange,[$t,$V,$e],!1);$Y._innerFirstLevelLoaderManager.create($_,$k.create(null,$Y._onHierarchyInnerFirstLevResouLoaded,[$t,$R,$T,$K]),$I,null,null,1,!0,$H)}else $Y._onHierarchyInnerFirstLevResouLoaded($t,null,$T,$K)},$Y._onHierarchyInnerFirstLevResouLoaded=function($t,$H,$I,$T){$H&&$H.recover(),$t.endLoad([$I,$T])},$Y._loadTerrain=function($t){$t.on("loaded",null,$Y._onTerrainLtLoaded,[$t,$t._class._getGroup()]),$t.load($t.url,"json",!1,null,!0)},$Y._onTerrainLtLoaded=function($t,$H,$I){if($t._class.destroyed)$t.endLoad();else{var $T,$K,$_=$t.url,$V=$OH.getURLVerion($_),$e=$r.getPath($_),$R=[],$A={},$q=0,$f=0,$b=$I.heightData;$T=$b.url,$K=$Y.formatRelativePath($e,$T),$V&&($K+=$V),$T=$A[$T]=$K;var $L=$I.detailTexture;for($q=0,$f=$L.length;$q<$f;$q++)$R.push({url:$L[$q].diffuse});var $G=$I.normalMap;for($q=0,$f=$G.length;$q<$f;$q++)$R.push({url:$G[$q]});var $M=$I.alphaMap;for($q=0,$f=$M.length;$q<$f;$q++)$R.push({url:$M[$q],params:[!1,!1,6408,!0]});for($q=0,$f=$R.length;$q<$f;$q++){var $O=$R[$q].url;$K=$Y.formatRelativePath($e,$O),$V&&($K+=$V),$R[$q].url=$K,$A[$O]=$K}var $J=$R.length,$S=$J+2,$U=1/$S;$Y._onProcessChange($t,0,$U,1);var $C={heightMapLoaded:!1,texturesLoaded:!1},$N=$k.create(null,$Y._onProcessChange,[$t,$U,$U],!1);$Y._innerFourthLevelLoaderManager.create($T,$k.create(null,$Y._onTerrainHeightMapLoaded,[$t,$N,$I,$A,$C]),$N,null,[$b.numX,$b.numZ,$b.bitType,$b.value],1,!0,$H);var $w=$k.create(null,$Y._onProcessChange,[$t,2*$U,$J/$S],!1);$Y._innerFourthLevelLoaderManager.create($R,$k.create(null,$Y._onTerrainTexturesLoaded,[$t,$w,$I,$A,$C]),$w,null,null,1,!0,$H)}},$Y._onTerrainHeightMapLoaded=function($t,$H,$I,$T,$K){$K.heightMapLoaded=!0,$K.texturesLoaded&&($t.endLoad([$I,$T]),$H.recover())},$Y._onTerrainTexturesLoaded=function($t,$H,$I,$T,$K){$K.texturesLoaded=!0,$K.heightMapLoaded&&($t.endLoad([$I,$T]),$H.recover())},$Y._loadMesh=function($t){$t.on("loaded",null,$Y._onMeshLmLoaded,[$t,$t._class._getGroup()]),$t.load($t.url,"arraybuffer",!1,null,!0)},$Y._onMeshLmLoaded=function($t,$H,$I){if($t._class.destroyed)$t.endLoad();else{var $T,$K,$_,$V=$t.url,$e=$OH.getURLVerion($V),$R=$r.getPath($V),$A={},$q=0,$f=0;switch(($Y._readData=new $w($I)).pos=0,$Y._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $b=$Y._readData.getUint32();$Y._readData.pos=$Y._readData.pos+4,$f=$Y._readData.getUint16(),$Y._readData.pos=$Y._readData.pos+8*$f;var $L=$Y._readData.getUint32();for($f=$Y._readData.getUint16(),$Y._readData.pos=$b+$L,$T=[],$q=0;$q<$f;$q++){var $G=$Y._readData.readUTFString();-1!==$G.lastIndexOf(".lmat")&&$T.push($G)}break;default:for($Y.READ_BLOCK(),$q=0;$q<2;$q++){var $M=$Y._readData.getUint16(),$O=$Y._strings[$M],$J=$Y["READ_"+$O];if(null==$J)throw new Error("model file err,no this function:"+$M+" "+$O);1===$q?$T=$J.call():$J.call()}}for($q=0,$_=$T.length;$q<$_;$q++){var $S=$T[$q];$K=$Y.formatRelativePath($R,$S),$e&&($K+=$e),$T[$q]=$K,$A[$S]=$K}if(0<$T.length){$Y._onProcessChange($t,0,.5,1);var $U=$k.create(null,$Y._onProcessChange,[$t,.5,.5],!1);$Y._innerSecondLevelLoaderManager.create($T,$k.create(null,$Y._onMeshMateialLoaded,[$t,$U,$I,$A]),$U,null,null,1,!0,$H)}else $t.endLoad([$I,$A])}},$Y._onMeshMateialLoaded=function($t,$H,$I,$T){$t.endLoad([$I,$T]),$H.recover()},$Y._getMaterialTexturePath=function($t,$H,$I){var $T=$t.length-4;return $t.indexOf(".dds")!=$T&&$t.indexOf(".tga")!=$T&&$t.indexOf(".exr")!=$T&&$t.indexOf(".DDS")!=$T&&$t.indexOf(".TGA")!=$T&&$t.indexOf(".EXR")!=$T||($t=$t.substr(0,$T)+".png"),$t=$Y.formatRelativePath($I,$t),$H&&($t+=$H),$t},$Y._loadMaterial=function($t){$t.on("loaded",null,$Y._onMaterilLmatLoaded,[$t,$t._class._getGroup()]),$t.load($t.url,"json",!1,null,!0)},$Y._onMaterilLmatLoaded=function($t,$H,$I){if($t._class.destroyed)$t.endLoad();else{var $T,$K=$t.url,$_=$OH.getURLVerion($K),$V=$r.getPath($K),$e=[],$R={},$A=$I.customProps,$q=$I.version;if($q)switch($q){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $f=$I.props.textures,$b=0,$L=$f.length;$b<$L;$b++){var $G=$f[$b],$M=$G.path;if($M){var $O=$M.length-4;$M.indexOf(".exr")!=$O&&$M.indexOf(".EXR")!=$O||($M=$M.substr(0,$O)+".png"),$T=$Y.formatRelativePath($V,$M),$_&&($T+=$_),$e.push({url:$T,params:$G.params}),$R[$M]=$T}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $J=$A.diffuseTexture.texture2D;if($J&&($T=$Y._getMaterialTexturePath($J,$_,$V),$e.push($T),$R[$J]=$T),$A.normalTexture){var $S=$A.normalTexture.texture2D;$S&&($T=$Y._getMaterialTexturePath($S,$_,$V),$e.push($T),$R[$S]=$T)}if($A.specularTexture){var $U=$A.specularTexture.texture2D;$U&&($T=$Y._getMaterialTexturePath($U,$_,$V),$e.push($T),$R[$U]=$T)}if($A.emissiveTexture){var $C=$A.emissiveTexture.texture2D;$C&&($T=$Y._getMaterialTexturePath($C,$_,$V),$e.push($T),$R[$C]=$T)}if($A.ambientTexture){var $N=$A.ambientTexture.texture2D;$N&&($T=$Y._getMaterialTexturePath($N,$_,$V),$e.push($T),$R[$N]=$T)}if($A.reflectTexture){var $w=$A.reflectTexture.texture2D;$w&&($T=$Y._getMaterialTexturePath($w,$_,$V),$e.push($T),$R[$w]=$T)}}var $W=$e.length,$s=$W+1,$z=1/$s;if($Y._onProcessChange($t,0,$z,1),0<$W){var $P=$k.create(null,$Y._onProcessChange,[$t,$z,$W/$s],!1);$Y._innerFourthLevelLoaderManager.create($e,$k.create(null,$Y._onMateialTexturesLoaded,[$t,$P,$I,$R]),$P,$$H,null,1,!0,$H)}else $Y._onMateialTexturesLoaded($t,null,$I,null)}},$Y._onMateialTexturesLoaded=function($t,$H,$I,$T){$t.endLoad([$I,$T]),$H&&$H.recover()},$Y._loadTextureCube=function($t){$t.on("loaded",null,$Y._onTextureCubeLtcLoaded,[$t]),$t.load($t.url,"json",!1,null,!0)},$Y._onTextureCubeLtcLoaded=function($t,$H){if($t._class.destroyed)$t.endLoad();else{var $I=$r.getPath($t.url),$T=[$Y.formatRelativePath($I,$H.px),$Y.formatRelativePath($I,$H.nx),$Y.formatRelativePath($I,$H.py),$Y.formatRelativePath($I,$H.ny),$Y.formatRelativePath($I,$H.pz),$Y.formatRelativePath($I,$H.nz)];$Y._onProcessChange($t,0,1/7,1);var $K=$k.create(null,$Y._onProcessChange,[$t,1/7,6/7],!1);$Y._innerFourthLevelLoaderManager.load($T,$k.create(null,$Y._onTextureCubeImagesLoaded,[$t,$T,$K]),$K,"nativeimage")}},$Y._onTextureCubeImagesLoaded=function($t,$H,$I){var $T=[];$T.length=6;for(var $K=0;$K<6;$K++){var $_=$H[$K];$T[$K]=$J.getRes($_),$J.clearRes($_)}$t.endLoad($T),$I.recover()},$Y._onProcessChange=function($t,$H,$I,$T){($T=$H+$T*$I)<1&&$t.event("progress",$T)},$Y.init=function($t,$H,$I,$T,$K,$_){if(void 0===$I&&($I=!1),void 0===$T&&($T=!1),void 0===$K&&($K=!0),void 0===$_&&($_=!0),$S.update3DLoop=function(){},$S.cancelLoadByUrl=function($t){$Y._cancelLoadByUrl($t)},$R.isAntialias=$I,$R.isAlpha=$T,$R.premultipliedAlpha=$K,$R.isStencil=$_,!$x.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$S.changeWebGLSize=$Y._changeWebGLSize,$M.is3DMode=!0,$N.init($t,$H),$p.__init__(),$fH.__init__(),$nH.__init__(),$B.__init__(),$Y.__init__(),$V.maxTextureCount=2,($Y.debugMode||$c.debugMode)&&($Y._debugPhasorSprite=new $m)},$Y.HIERARCHY="SPRITE3DHIERARCHY",$Y.MESH="MESH",$Y.MATERIAL="MATERIAL",$Y.PBRMATERIAL="PBRMTL",$Y.TEXTURECUBE="TEXTURECUBE",$Y.TERRAIN="TERRAIN",$Y._readData=null,$Y._debugPhasorSprite=null,$Y.debugMode=!1,$f($Y,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $H},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $H},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $H},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $H}]),$Y}(),$SH=function($t){function $K($t){$K.__super.call(this),this._owner=$t,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$L($K,"laya.d3.animation.AnimationTransform3D",$_);var $H=$K.prototype;return $H._getlocalMatrix=function(){return this._localUpdate&&($OH._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$H._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldTransform()}},$H._setWorldMatrixAndUpdate=function($t){if(this._worldMatrix=$t,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $H=this._getlocalMatrix(),$I=0;$I<16;++$I)this._worldMatrix[$I]=$H[$I];else $OH.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$H._setWorldMatrixNoUpdate=function($t){this._worldMatrix=$t},$H._setWorldMatrixIgnoreUpdate=function($t){this._worldMatrix=$t,this._worldUpdate=!1},$H.getLocalPosition=function(){return this._localPosition},$H.setLocalPosition=function($t){if(this._parent)this._localPosition=$t,this._localUpdate=!0,this._onWorldTransform();else{var $H=this._entity.owner._transform,$I=this._entity.localPosition,$T=$I.elements;$T[0]=$t[0],$T[1]=$t[1],$T[2]=$t[2],$H.localPosition=$I}},$H.getLocalRotation=function(){if(this._localQuaternionUpdate){var $t=this._localRotationEuler;$OH._quaternionCreateFromYawPitchRollArray($t[1]/$K._angleToRandin,$t[0]/$K._angleToRandin,$t[2]/$K._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$H.setLocalRotation=function($t){if(this._parent)this._localRotation=$t,$OH.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $H=this._entity.owner._transform,$I=this._entity.localRotation,$T=$I.elements;$T[0]=$t[0],$T[1]=$t[1],$T[2]=$t[2],$T[3]=$t[3],$H.localRotation=$I}},$H.getLocalScale=function(){return this._localScale},$H.setLocalScale=function($t){if(this._parent)this._localScale=$t,this._localUpdate=!0,this._onWorldTransform();else{var $H=this._entity.owner._transform,$I=this._entity.localScale,$T=$I.elements;$T[0]=$t[0],$T[1]=$t[1],$T[2]=$t[2],$H.localScale=$I}},$H.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$OH.getYawPitchRoll(this._localRotation,$K._tempVector3);var $t=$K._tempVector3,$H=this._localRotationEuler;$H[0]=$t[1]*$K._angleToRandin,$H[1]=$t[0]*$K._angleToRandin,$H[2]=$t[2]*$K._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$H.setLocalRotationEuler=function($t){if(this._parent)$OH._quaternionCreateFromYawPitchRollArray($t[1]/$K._angleToRandin,$t[0]/$K._angleToRandin,$t[2]/$K._angleToRandin,this._localRotation),this._localRotationEuler=$t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $H=this._entity.owner._transform,$I=this._entity.localRotationEuler,$T=$I.elements;$T[0]=$t[0],$T[1]=$t[1],$T[2]=$t[2],$H.localRotationEuler=$I}},$H.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$OH.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $t=this._getlocalMatrix(),$H=0;$H<16;++$H)this._worldMatrix[$H]=$t[$H];this._worldUpdate=!1}return this._worldMatrix},$H.setParent=function($t){if(this._parent!==$t){if(this._parent){var $H=this._parent._childs,$I=$H.indexOf(this);$H.splice($I,1)}$t&&($t._childs.push(this),$t&&this._onWorldTransform()),this._parent=$t}},$f($K,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$K}(),$UH=function($t){function $H(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$H.__super.call(this),this._destroyed=!1,this._id=$H._uniqueIDCounter,$H._uniqueIDCounter++}$L($H,"laya.d3.component.Component3D",$_);var $I=$H.prototype;return $N.imps($I,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$I._initialize=function($t){this._owner=$t,this._enable=!0,this.started=!1,this._load($t)},$I._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$I._load=function($t){},$I._start=function($t){},$I._update=function($t){},$I._lateUpdate=function($t){},$I._preRenderUpdate=function($t){},$I._postRenderUpdate=function($t){},$I._unload=function($t){this.offAll()},$I._cloneTo=function($t){},$G(0,$I,"id",function(){return this._id}),$G(0,$I,"destroyed",function(){return this._destroyed}),$G(0,$I,"owner",function(){return this._owner}),$G(0,$I,"enable",function(){return this._enable},function($t){this._enable!==$t&&(this._enable=$t,this.event("enablechanged",this._enable))}),$G(0,$I,"isSingleton",function(){return $H._isSingleton}),$H._isSingleton=!0,$H._uniqueIDCounter=1,$H}(),$CH=function($t){function $H(){this._destroyed=!1,$H.__super.call(this),this._destroyed=!1}$L($H,"laya.d3.core.GeometryFilter",$_);var $I=$H.prototype;return $N.imps($I,{"laya.resource.IDestroy":!0}),$I._destroy=function(){this.offAll(),this._destroyed=!0},$G(0,$I,"_isAsyncLoaded",function(){return!0}),$G(0,$I,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$G(0,$I,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$G(0,$I,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$G(0,$I,"destroyed",function(){return this._destroyed}),$H}(),$NH=function($t){function $T($t){$T.__super.call(this),this._id=++$T._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $ct(new $VH,new $VH),this._boundingBoxCenter=new $VH,this._boundingSphere=new $jt(new $VH,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$t,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$L($T,"laya.d3.core.render.BaseRender",$_);var $H=$T.prototype;return $N.imps($H,{"laya.resource.IDestroy":!0}),$H._changeMaterialReference=function($t,$H){$t&&$t._removeReference(),$H._addReference()},$H._getInstanceMaterial=function($t,$H){var $I=new $t.constructor;return $t.cloneTo($I),$I.name=$I.name+"(Instance)",this._materialsInstance[$H]=!0,this._changeMaterialReference(this._materials[$H],$I),this._materials[$H]=$I},$H._setShaderValuelightMap=function($t){this._setShaderValueTexture(3,$t)},$H._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$H._renderRenderableBoundBox=function(){var $t=$JH._debugPhasorSprite,$H=this.boundingBox,$I=$T._tempBoundBoxCorners;$H.getCorners($I),$t.line($I[0],$T._greenColor,$I[1],$T._greenColor),$t.line($I[2],$T._greenColor,$I[3],$T._greenColor),$t.line($I[4],$T._greenColor,$I[5],$T._greenColor),$t.line($I[6],$T._greenColor,$I[7],$T._greenColor),$t.line($I[0],$T._greenColor,$I[3],$T._greenColor),$t.line($I[1],$T._greenColor,$I[2],$T._greenColor),$t.line($I[2],$T._greenColor,$I[6],$T._greenColor),$t.line($I[3],$T._greenColor,$I[7],$T._greenColor),$t.line($I[0],$T._greenColor,$I[4],$T._greenColor),$t.line($I[1],$T._greenColor,$I[5],$T._greenColor),$t.line($I[4],$T._greenColor,$I[7],$T._greenColor),$t.line($I[5],$T._greenColor,$I[6],$T._greenColor)},$H._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$H._calculateBoundingBox=function(){throw"BaseRender: must override it."},$H._setShaderValueTexture=function($t,$H){this._owner._shaderValues.setValue($t,$H)},$H._setShaderValueMatrix4x4=function($t,$H){this._owner._shaderValues.setValue($t,$H?$H.elements:null)},$H._setShaderValueColor=function($t,$H){this._owner._shaderValues.setValue($t,$H?$H.elements:null)},$H._setShaderValueBuffer=function($t,$H){this._owner._shaderValues.setValue($t,$H)},$H._setShaderValueInt=function($t,$H){this._owner._shaderValues.setValue($t,$H)},$H._setShaderValueBool=function($t,$H){this._owner._shaderValues.setValue($t,$H)},$H._setShaderValueNumber=function($t,$H){this._owner._shaderValues.setValue($t,$H)},$H._setShaderValueVector2=function($t,$H){this._owner._shaderValues.setValue($t,$H?$H.elements:null)},$H._addShaderDefine=function($t){this._owner._shaderDefineValue|=$t},$H._removeShaderDefine=function($t){this._owner._shaderDefineValue&=~$t},$H._renderUpdate=function($t){return!0},$H._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $t=this._owner.scene;if($t){var $H=$t.getlightmaps()[this._lightmapIndex];$H?(this._addShaderDefine($mH.SAHDERDEFINE_LIGHTMAP),$H.loaded?this._setShaderValuelightMap($H):$H.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($mH.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($mH.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($mH.SAHDERDEFINE_LIGHTMAP)},$H._updateOctreeNode=function(){var $t=this._treeNode;$t&&this._octreeNodeNeedChange&&($t.updateObject(this),this._octreeNodeNeedChange=!1)},$H._destroy=function(){this.offAll();var $t=0,$H=0;for($t=0,$H=this._renderElements.length;$t<$H;$t++)this._renderElements[$t]._destroy();for($t=0,$H=this._materials.length;$t<$H;$t++)this._materials[$t]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$G(0,$H,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$G(0,$H,"id",function(){return this._id}),$G(0,$H,"material",function(){var $t=this._materials[0];if($t&&!this._materialsInstance[0]){var $H=this._getInstanceMaterial($t,0);this.event("materialchanged",[this,0,$H])}return this._materials[0]},function($t){this.sharedMaterial=$t}),$G(0,$H,"sharedMaterial",function(){return this._materials[0]},function($t){var $H=this._materials[0];$H!==$t&&(this._materials[0]=$t,this._materialsInstance[0]=!1,this._changeMaterialReference($H,$t),this.event("materialchanged",[this,0,$t]))}),$G(0,$H,"lightmapIndex",function(){return this._lightmapIndex},function($t){this._lightmapIndex=$t,this._applyLightMapParams()}),$G(0,$H,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($t){this._lightmapScaleOffset=$t,this._setShaderValueColor(2,$t),this._addShaderDefine($mH.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$G(0,$H,"enable",function(){return this._enable},function($t){this._enable=$t,this.event("enablechanged",[this,$t])}),$G(0,$H,"materials",function(){for(var $t=0,$H=this._materials.length;$t<$H;$t++)if(!this._materialsInstance[$t]){var $I=this._getInstanceMaterial(this._materials[$t],$t);this.event("materialchanged",[this,$t,$I])}return this._materials.slice()},function($t){this.sharedMaterials=$t}),$G(0,$H,"sharedMaterials",function(){return this._materials.slice()},function($t){if(!$t)throw new Error("MeshRender: shadredMaterials value can't be null.");var $H=$t.length;this._materialsInstance.length=$H;for(var $I=0;$I<$H;$I++){var $T=this._materials[$I];$T!==$t[$I]&&(this._materialsInstance[$I]=!1,this._changeMaterialReference($T,$t[$I]),this.event("materialchanged",[this,$I,$t[$I]]))}this._materials=$t}),$G(0,$H,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$G(0,$H,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $t=this.boundingBox;$VH.add($t.min,$t.max,this._boundingBoxCenter),$VH.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$G(0,$H,"receiveShadow",function(){return this._receiveShadow},function($t){this._receiveShadow!==$t&&((this._receiveShadow=$t)?this._addShaderDefine($LH.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($LH.SHADERDEFINE_RECEIVE_SHADOW))}),$G(0,$H,"destroyed",function(){return this._destroyed}),$T._uniqueIDCounter=0,$f($T,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH,new $VH]},"_greenColor",function(){return this._greenColor=new $eH(0,1,0,1)}]),$T}(),$wH=function($t){function $e($t){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$e.__super.call(this),this._localPosition=new $VH,this._localRotation=new $IH(0,0,0,1),this._localScale=new $VH(1,1,1),this._localRotationEuler=new $VH,this._localMatrix=new $tH,this._position=new $VH,this._rotation=new $IH(0,0,0,1),this._scale=new $VH(1,1,1),this._worldMatrix=new $tH,this._forward=new $VH,this._up=new $VH,this._right=new $VH,this._owner=$t,this._childs=[]}$L($e,"laya.d3.core.Transform3D",$_);var $H=$e.prototype;return $H._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$tH.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $t=$e._tempVector30;$VH.multiply(this.pivot,this._localScale,$t);var $H=$e._tempVector31;$VH.subtract($t,this.pivot,$H);var $I=$e._tempVector32,$T=this.localRotation;$VH.transformQuat($t,$T,$I),$VH.subtract($I,$t,$I);var $K=$e._tempVector33;$VH.subtract(this._localPosition,$H,$K),$VH.subtract($K,$I,$K),$tH.createAffineTransformation($K,$T,this._localScale,this._localMatrix)}},$H._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldPositionRotationTransform()}},$H._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldPositionScaleTransform()}},$H._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldPositionTransform()}},$H._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldPositionRotationTransform()}},$H._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldPositionScaleTransform()}},$H._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._onWorldTransform()}},$H.translate=function($t,$H){void 0===$H&&($H=!0),$H?($tH.createFromQuaternion(this.localRotation,$e._tempMatrix0),$VH.transformCoordinate($t,$e._tempMatrix0,$e._tempVector30),$VH.add(this.localPosition,$e._tempVector30,this._localPosition),this.localPosition=this._localPosition):($VH.add(this.position,$t,this._position),this.position=this._position)},$H.rotate=function($t,$H,$I){var $T;void 0===$H&&($H=!0),void 0===$I&&($I=!0),$T=$I?$t:($VH.scale($t,Math.PI/180,$e._tempVector30),$e._tempVector30),$IH.createFromYawPitchRoll($T.y,$T.x,$T.z,$e._tempQuaternion0),$H?($IH.multiply(this._localRotation,$e._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($IH.multiply($e._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$H.lookAt=function($t,$H,$I){void 0===$I&&($I=!1);var $T,$K=$t.elements;if($I){if($T=this._localPosition.elements,Math.abs($T[0]-$K[0])<$dt.zeroTolerance&&Math.abs($T[1]-$K[1])<$dt.zeroTolerance&&Math.abs($T[2]-$K[2])<$dt.zeroTolerance)return;$IH.lookAt(this._localPosition,$t,$H,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $_=this.position;if($T=$_.elements,Math.abs($T[0]-$K[0])<$dt.zeroTolerance&&Math.abs($T[1]-$K[1])<$dt.zeroTolerance&&Math.abs($T[2]-$K[2])<$dt.zeroTolerance)return;$IH.lookAt($_,$t,$H,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$G(0,$H,"_isFrontFaceInvert",function(){var $t=this.scale,$H=$t.x<0;return $t.y<0&&($H=!$H),$t.z<0&&($H=!$H),$H}),$G(0,$H,"owner",function(){return this._owner}),$G(0,$H,"localRotation",function(){if(this._localQuaternionUpdate){var $t=this._localRotationEuler.elements;$IH.createFromYawPitchRoll($t[1]/$e._angleToRandin,$t[0]/$e._angleToRandin,$t[2]/$e._angleToRandin,this._localRotation)}return this._localRotation},function($t){this._localRotation=$t,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$G(0,$H,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$tH.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($t){null===this._parent?$t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$tH.multiply(this._localMatrix,$t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$t,this._worldUpdate=!1}),$G(0,$H,"worldNeedUpdate",function(){return this._worldUpdate}),$G(0,$H,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($t){this._localMatrix=$t,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$G(0,$H,"dummy",function(){return this._dummy},function($t){this._dummy!==$t&&(this._dummy&&(this._dummy._entity=null),$t&&($t._entity=this),this._dummy=$t)}),$G(0,$H,"localPosition",function(){return this._localPosition},function($t){this._localPosition=$t,this._localUpdate=!0,this._onWorldPositionTransform()}),$G(0,$H,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $t=this._parent.position;$VH.multiply(this._localPosition,this._parent.scale,$e._tempVector30),$VH.transformQuat($e._tempVector30,this._parent.rotation,$e._tempVector30),$VH.add($t,$e._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($t){if(null!=this._parent){$VH.subtract($t,this._parent.position,this._localPosition);var $H=this._parent.scale.elements,$I=$H[0],$T=$H[1],$K=$H[2];if(1!==$I||1!==$T||1!==$K){var $_=$e._tempVector30,$V=$_.elements;$V[0]=1/$I,$V[1]=1/$T,$V[2]=1/$K,$VH.multiply(this._localPosition,$_,this._localPosition)}this._parent.rotation.invert($e._tempQuaternion0),$VH.transformQuat(this._localPosition,$e._tempQuaternion0,this._localPosition)}else $t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$t,this._positionUpdate=!1}),$G(0,$H,"localScale",function(){return this._localScale},function($t){this._localScale=$t,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$G(0,$H,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($e._tempVector30);var $t=$e._tempVector30.elements,$H=this._localRotationEuler.elements;$H[0]=$t[1]*$e._angleToRandin,$H[1]=$t[0]*$e._angleToRandin,$H[2]=$t[2]*$e._angleToRandin}return this._localRotationEuler},function($t){this._localRotationEuler=$t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$G(0,$H,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$IH.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($t){null!=this._parent?(this._parent.rotation.invert($e._tempQuaternion0),$IH.multiply($t,$e._tempQuaternion0,this._localRotation)):$t.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$t,this._rotationUpdate=!1}),$G(0,$H,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$VH.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($t){if(null!==this._parent){var $H=this._parent.scale.elements,$I=$e._tempVector30.elements;$I[0]=1/$H[0],$I[1]=1/$H[1],$I[2]=1/$H[2],$VH.multiply($t,$e._tempVector30,this._localScale)}else $t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$t,this._scaleUpdate=!1}),$G(0,$H,"rotationEuler",null,function($t){$IH.createFromYawPitchRoll($t.y,$t.x,$t.z,this._rotation),this.rotation=this._rotation}),$G(0,$H,"forward",function(){var $t=this.worldMatrix.elements;return this._forward.elements[0]=-$t[8],this._forward.elements[1]=-$t[9],this._forward.elements[2]=-$t[10],this._forward}),$G(0,$H,"up",function(){var $t=this.worldMatrix.elements;return this._up.elements[0]=$t[4],this._up.elements[1]=$t[5],this._up.elements[2]=$t[6],this._up}),$G(0,$H,"right",function(){var $t=this.worldMatrix.elements;return this._right.elements[0]=$t[0],this._right.elements[1]=$t[1],this._right.elements[2]=$t[2],this._right}),$G(0,$H,"parent",function(){return this._parent},function($t){if(this._parent!==$t){if(this._parent){var $H=this._parent._childs,$I=$H.indexOf(this);$H.splice($I,1)}$t&&($t._childs.push(this),$t&&this._onWorldTransform()),this._parent=$t}}),$f($e,["_tempVector30",function(){return this._tempVector30=new $VH},"_tempVector31",function(){return this._tempVector31=new $VH},"_tempVector32",function(){return this._tempVector32=new $VH},"_tempVector33",function(){return this._tempVector33=new $VH},"_tempQuaternion0",function(){return this._tempQuaternion0=new $IH},"_tempMatrix0",function(){return this._tempMatrix0=new $tH},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$e}(),$WH=(function($t){function $H(){this._rotation=0,this._matNeedUpdte=!1,$H.__super.call(this),this._matrix=new $tH,this._offset=new $_H,this._tiling=new $_H(1,1)}$L($H,"laya.d3.core.TransformUV",$_);var $I=$H.prototype;$N.imps($I,{"laya.d3.core.IClone":!0}),$I._updateMatrix=function(){$H._tempOffsetV3.elements[0]=this._offset.x,$H._tempOffsetV3.elements[1]=this._offset.y,$IH.createFromYawPitchRoll(0,0,this._rotation,$H._tempRotationQua),$H._tempTitlingV3.elements[0]=this._tiling.x,$H._tempTitlingV3.elements[1]=this._tiling.y,$tH.createAffineTransformation($H._tempOffsetV3,$H._tempRotationQua,$H._tempTitlingV3,this._matrix)},$I.cloneTo=function($t){$t._matrix=this._matrix.clone(),$t._offset=this._offset.clone(),$t._rotation=this._rotation,$t._tiling=this._tiling.clone()},$I.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$I,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$G(0,$I,"tiling",function(){return this._tiling},function($t){this._tiling=$t,this._matNeedUpdte=!0}),$G(0,$I,"offset",function(){return this._offset},function($t){this._offset=$t,this._matNeedUpdte=!0}),$G(0,$I,"rotation",function(){return this._rotation},function($t){this._rotation=$t,this._matNeedUpdte=!0}),$f($H,["_tempOffsetV3",function(){return this._tempOffsetV3=new $VH(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $IH},"_tempTitlingV3",function(){return this._tempTitlingV3=new $VH(1,1,1)}])}(),function($I){function $t(){this.x=NaN,this.y=NaN,this.z=NaN,$t.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$L($t,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$I);var $H=$t.prototype;$H._getShapeBoundBox=function($t){var $H=$t.min.elements;$H[0]=.5*-this.x,$H[1]=.5*-this.y,$H[2]=.5*-this.z;var $I=$t.max.elements;$I[0]=.5*this.x,$I[1]=.5*this.y,$I[2]=.5*this.z},$H._getSpeedBoundBox=function($t){var $H=$t.min.elements;$H[0]=0,$H[1]=0,$H[2]=0;var $I=$t.max.elements;$I[0]=0,$I[1]=1,$I[2]=0},$H.generatePositionAndDirection=function($t,$H,$I,$T){var $K=$t.elements,$_=$H.elements;$I?($I.seed=$T[16],$$._randomPointInsideHalfUnitBox($t,$I),$T[16]=$I.seed):$$._randomPointInsideHalfUnitBox($t),$K[0]=this.x*$K[0],$K[1]=this.y*$K[1],$K[2]=this.z*$K[2],this.randomDirection?$I?($I.seed=$T[17],$$._randomPointUnitSphere($H,$I),$T[17]=$I.seed):$$._randomPointUnitSphere($H):($_[0]=0,$_[1]=0,$_[2]=1)},$H.cloneTo=function($t){$I.prototype.cloneTo.call(this,$t);var $H=$t;$H.x=this.x,$H.y=this.y,$H.z=this.z,$H.randomDirection=this.randomDirection}}($h),function($I){function $V(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$V.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$L($V,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$I);var $t=$V.prototype;$t._getShapeBoundBox=function($t){var $H=$t.min.elements;$H[0]=$H[2]=-this.radius,$H[1]=0;var $I=$t.max.elements;$I[0]=$I[2]=this.radius,$I[1]=0},$t._getSpeedBoundBox=function($t){var $H=$t.min.elements;$H[0]=$H[1]=-1,$H[2]=0;var $I=$t.max.elements;$I[0]=$I[1]=1,$I[2]=0},$t.generatePositionAndDirection=function($t,$H,$I,$T){var $K=$t.elements,$_=$V._tempPositionPoint.elements;$I?($I.seed=$T[16],this.emitFromEdge?$$._randomPointUnitArcCircle(this.arc,$V._tempPositionPoint,$I):$$._randomPointInsideUnitArcCircle(this.arc,$V._tempPositionPoint,$I),$T[16]=$I.seed):this.emitFromEdge?$$._randomPointUnitArcCircle(this.arc,$V._tempPositionPoint):$$._randomPointInsideUnitArcCircle(this.arc,$V._tempPositionPoint),$K[0]=-$_[0],$K[1]=$_[1],$K[2]=0,$VH.scale($t,this.radius,$t),this.randomDirection?$I?($I.seed=$T[17],$$._randomPointUnitSphere($H,$I),$T[17]=$I.seed):$$._randomPointUnitSphere($H):$t.cloneTo($H)},$t.cloneTo=function($t){$I.prototype.cloneTo.call(this,$t);var $H=$t;$H.radius=this.radius,$H.arc=this.arc,$H.emitFromEdge=this.emitFromEdge,$H.randomDirection=this.randomDirection},$f($V,["_tempPositionPoint",function(){return this._tempPositionPoint=new $_H}])}($h),function($I){function $b(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$b.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$L($b,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$I);var $t=$b.prototype;$t._getShapeBoundBox=function($t){var $H=this.radius+this.length*Math.sin(this.angle),$I=this.length*Math.cos(this.angle),$T=$t.min.elements;$T[0]=$T[1]=-$H,$T[2]=0;var $K=$t.max.elements;$K[0]=$K[1]=$H,$K[2]=$I},$t._getSpeedBoundBox=function($t){var $H=Math.sin(this.angle),$I=$t.min.elements;$I[0]=$I[1]=-$H,$I[2]=0;var $T=$t.max.elements;$T[0]=$I[1]=$H,$T[2]=1},$t.generatePositionAndDirection=function($t,$H,$I,$T){var $K,$_=$t.elements,$V=$H.elements,$e=$b._tempPositionPoint.elements,$R=NaN,$A=NaN,$q=Math.cos(this.angle),$f=Math.sin(this.angle);switch(this.emitType){case 0:$I?($I.seed=$T[16],$$._randomPointInsideUnitCircle($b._tempPositionPoint,$I),$T[16]=$I.seed):$$._randomPointInsideUnitCircle($b._tempPositionPoint),$R=$e[0],$A=$e[1],$_[0]=$R*this.radius,$_[1]=$A*this.radius,$_[2]=0,this.randomDirection?($I?($I.seed=$T[17],$$._randomPointInsideUnitCircle($b._tempDirectionPoint,$I),$T[17]=$I.seed):$$._randomPointInsideUnitCircle($b._tempDirectionPoint),$K=$b._tempDirectionPoint.elements,$V[0]=$K[0]*$f,$V[1]=$K[1]*$f):($V[0]=$R*$f,$V[1]=$A*$f),$V[2]=$q;break;case 1:$I?($I.seed=$T[16],$$._randomPointUnitCircle($b._tempPositionPoint,$I),$T[16]=$I.seed):$$._randomPointUnitCircle($b._tempPositionPoint),$R=$e[0],$A=$e[1],$_[0]=$R*this.radius,$_[1]=$A*this.radius,$_[2]=0,this.randomDirection?($I?($I.seed=$T[17],$$._randomPointInsideUnitCircle($b._tempDirectionPoint,$I),$T[17]=$I.seed):$$._randomPointInsideUnitCircle($b._tempDirectionPoint),$K=$b._tempDirectionPoint.elements,$V[0]=$K[0]*$f,$V[1]=$K[1]*$f):($V[0]=$R*$f,$V[1]=$A*$f),$V[2]=$q;break;case 2:$I?($I.seed=$T[16],$$._randomPointInsideUnitCircle($b._tempPositionPoint,$I)):$$._randomPointInsideUnitCircle($b._tempPositionPoint),$R=$e[0],$A=$e[1],$_[0]=$R*this.radius,$_[1]=$A*this.radius,$V[$_[2]=0]=$R*$f,$V[1]=$A*$f,$V[2]=$q,$VH.normalize($H,$H),$I?($VH.scale($H,this.length*$I.getFloat(),$H),$T[16]=$I.seed):$VH.scale($H,this.length*Math.random(),$H),$VH.add($t,$H,$t),this.randomDirection&&($I?($I.seed=$T[17],$$._randomPointUnitSphere($H,$I),$T[17]=$I.seed):$$._randomPointUnitSphere($H));break;case 3:$I?($I.seed=$T[16],$$._randomPointUnitCircle($b._tempPositionPoint,$I)):$$._randomPointUnitCircle($b._tempPositionPoint),$R=$e[0],$A=$e[1],$_[0]=$R*this.radius,$_[1]=$A*this.radius,$V[$_[2]=0]=$R*$f,$V[1]=$A*$f,$V[2]=$q,$VH.normalize($H,$H),$I?($VH.scale($H,this.length*$I.getFloat(),$H),$T[16]=$I.seed):$VH.scale($H,this.length*Math.random(),$H),$VH.add($t,$H,$t),this.randomDirection&&($I?($I.seed=$T[17],$$._randomPointUnitSphere($H,$I),$T[17]=$I.seed):$$._randomPointUnitSphere($H));break;default:throw new Error("ConeShape:emitType is invalid.")}},$t.cloneTo=function($t){$I.prototype.cloneTo.call(this,$t);var $H=$t;$H.angle=this.angle,$H.radius=this.radius,$H.length=this.length,$H.emitType=this.emitType,$H.randomDirection=this.randomDirection},$f($b,["_tempPositionPoint",function(){return this._tempPositionPoint=new $_H},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $_H}])}($h),function($I){function $t(){this.radius=NaN,this.emitFromShell=!1,$t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$L($t,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$I);var $H=$t.prototype;$H._getShapeBoundBox=function($t){var $H=$t.min.elements;$H[0]=$H[1]=$H[2]=-this.radius;var $I=$t.max.elements;$I[0]=$I[1]=this.radius,$I[2]=0},$H._getSpeedBoundBox=function($t){var $H=$t.min.elements;$H[0]=$H[1]=-1,$H[2]=0;var $I=$t.max.elements;$I[0]=$I[1]=$I[2]=1},$H.generatePositionAndDirection=function($t,$H,$I,$T){var $K=$t.elements;$I?($I.seed=$T[16],this.emitFromShell?$$._randomPointUnitSphere($t,$I):$$._randomPointInsideUnitSphere($t,$I),$T[16]=$I.seed):this.emitFromShell?$$._randomPointUnitSphere($t):$$._randomPointInsideUnitSphere($t),$VH.scale($t,this.radius,$t);var $_=$K[2];$_<0&&($K[2]=-1*$_),this.randomDirection?$I?($I.seed=$T[17],$$._randomPointUnitSphere($H,$I),$T[17]=$I.seed):$$._randomPointUnitSphere($H):$t.cloneTo($H)},$H.cloneTo=function($t){$I.prototype.cloneTo.call(this,$t);var $H=$t;$H.radius=this.radius,$H.emitFromShell=this.emitFromShell,$H.randomDirection=this.randomDirection}}($h),function($I){function $t(){this.radius=NaN,this.emitFromShell=!1,$t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$L($t,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$I);var $H=$t.prototype;$H._getShapeBoundBox=function($t){var $H=$t.min.elements;$H[0]=$H[1]=$H[2]=-this.radius;var $I=$t.max.elements;$I[0]=$I[1]=$I[2]=this.radius},$H._getSpeedBoundBox=function($t){var $H=$t.min.elements;$H[0]=$H[1]=$H[2]=-1;var $I=$t.max.elements;$I[0]=$I[1]=$I[2]=1},$H.generatePositionAndDirection=function($t,$H,$I,$T){$I?($I.seed=$T[16],this.emitFromShell?$$._randomPointUnitSphere($t,$I):$$._randomPointInsideUnitSphere($t,$I),$T[16]=$I.seed):this.emitFromShell?$$._randomPointUnitSphere($t):$$._randomPointInsideUnitSphere($t),$VH.scale($t,this.radius,$t),this.randomDirection?$I?($I.seed=$T[17],$$._randomPointUnitSphere($H,$I),$T[17]=$I.seed):$$._randomPointUnitSphere($H):$t.cloneTo($H)},$H.cloneTo=function($t){$I.prototype.cloneTo.call(this,$t);var $H=$t;$H.radius=this.radius,$H.emitFromShell=this.emitFromShell,$H.randomDirection=this.randomDirection}}($h),function($t){function $H(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$H.__super.call(this)}return $L($H,"laya.d3.core.render.SubMeshRenderElement",$o),$H}()),$sH=function($t){function $O($t,$H,$I,$T,$K,$_){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$t,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$LH.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$mH.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$mH.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$rH.SHADERDEFINE_ALPHATEST]="ALPHATEST";$O.__super.call(this,$t,$H,$I,null,{}),this._attributeMap=$T;var $V;for($V in $K){var $e=$K[$V];switch($e[1]){case 0:this._renderElementUniformMap[$V]=$e[0];break;case 1:this._materialUniformMap[$V]=$e[0];break;case 2:this._spriteUniformMap[$V]=$e[0];break;case 3:this._cameraUniformMap[$V]=$e[0];break;case 4:this._sceneUniformMap[$V]=$e[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$L($O,"laya.d3.shader.ShaderCompile3D",$U);var $H=$O.prototype;return $H._definesToNameDic=function($t,$H){for(var $I={},$T=1,$K=0;$K<32&&!($t<($T=1<<$K));$K++)if($t&$T){var $_=$H[$T];$_&&($I[$_]="")}return $I},$H.withCompile=function($t,$H,$I,$T){var $K,$_,$V;if($_=this.sharders[$t])if($V=$_[$H]){if($K=$V[$I])return $K}else $V=$_[$H]=[];else $V=($_=this.sharders[$t]=[])[$H]=[];var $e,$R=this._definesToNameDic($t,$O._globalInt2name),$A=this._definesToNameDic($H,this._spriteInt2name),$q=this._definesToNameDic($I,this._materialInt2name),$f={},$b="";if($R)for($e in $R)$b+="#define "+$e+"\n",$f[$e]=!0;if($A)for($e in $A)$b+="#define "+$e+"\n",$f[$e]=!0;if($q)for($e in $q)$b+="#define "+$e+"\n",$f[$e]=!0;var $L=$vH.nameKey.getName(this._name)+" compile ("+$t+","+$H+","+$I+")",$G=this._VS.toscript($f,[]),$M=this._PS.toscript($f,[]);$D.now();if($K=$vH.create($b+$G.join("\n"),$b+$M.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$T,$L),$V[$I]=$K,laya.d3.shader.ShaderCompile3D.debugMode)$D.now();return $K},$H.precompileShaderWithShaderDefine=function($t,$H,$I){this.withCompile($t,$H,$I,!0)},$H.addMaterialDefines=function($t){var $H=$t.defines;for(var $I in $H){var $T=$H[$I],$K=parseInt($I);this._materialInt2name[$K]=$T,this._materialName2Int[$T]=$K}},$H.addSpriteDefines=function($t){var $H=$t.defines;for(var $I in $H){var $T=$H[$I],$K=parseInt($I);this._spriteInt2name[$K]=$T,this._spriteName2Int[$T]=$K}},$H.getMaterialDefineByName=function($t){return this._materialName2Int[$t]},$H.registerMaterialDefine=function($t){var $H=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$H]=$t,this._materialName2Int[$t]=$H},$H.registerSpriteDefine=function($t){var $H=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$H]=$t,this._spriteName2Int[$t]=$H},$O._globalRegDefine=function($t,$H){$O._globalInt2name[$H]=$t},$O.add=function($t,$H,$I,$T,$K){return laya.d3.shader.ShaderCompile3D._preCompileShader[$t]=new $O($t,$H,$I,$T,$K,$U.includes)},$O.get=function($t){return laya.d3.shader.ShaderCompile3D._preCompileShader[$vH.nameKey.getID($t)]},$O._preCompileShader={},$O._globalInt2name=[],$O.debugMode=!1,$O.SHADERDEFINE_HIGHPRECISION=1,$O.SHADERDEFINE_FOG=4,$O.SHADERDEFINE_DIRECTIONLIGHT=8,$O.SHADERDEFINE_POINTLIGHT=16,$O.SHADERDEFINE_SPOTLIGHT=32,$O.SHADERDEFINE_UV0=64,$O.SHADERDEFINE_COLOR=128,$O.SHADERDEFINE_UV1=256,$O.SAHDERDEFINE_DEPTHFOG=131072,$O}(),$zH=function($t){function $G(){$G.__super.call(this)}$L($G,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$Tt);var $H=$G.prototype;return $H._getStaticBatch=function($t,$H,$I,$T){var $K,$_;return $_=$t?$t.id.toString()+$I.id.toString()+$H.id.toString()+$T.toString():$I.id.toString()+$H.id.toString()+$T.toString(),this._staticBatches[$_]?$K=this._staticBatches[$_]:this._staticBatches[$_]=$K=new $PH($_,this,$t,$H,$I),$K},$H._initStaticBatchs=function($t){var $H,$I;this._initBatchRenderElements.sort($G._sortPrepareStaticBatch);for(var $T,$K=!1,$_=0,$V=0,$e=this._initBatchRenderElements.length;$V<$e;$V++){var $R,$A=this._initBatchRenderElements[$V],$q=$A.renderObj._getVertexBuffer(0);$A._sprite3D;if($I===$q.vertexDeclaration&&$H===$A._material)if($K)$T._addCombineBatchRenderObjTest($A)?($R=$A._staticBatch)!==$T&&($R&&$R._deleteCombineBatchRenderObj($A),$T._addCombineBatchRenderObj($A)):($K=!1,$_++);else{var $f=this._initBatchRenderElements[$V-1],$b=$f.renderObj,$L=$A.renderObj;$K=!(65535<$b._getVertexBuffer().vertexCount+$L._getVertexBuffer().vertexCount)&&($T=this._getStaticBatch($t,$I,$H,$_),($R=$f._staticBatch)!==$T&&($R&&$R._deleteCombineBatchRenderObj($f),$T._addCombineBatchRenderObj($f)),($R=$A._staticBatch)!==$T&&($R&&$R._deleteCombineBatchRenderObj($A),$T._addCombineBatchRenderObj($A)),!0)}else $K=!1,$_=0;$H=$A._material,$I=$q.vertexDeclaration}},$G._sortPrepareStaticBatch=function($t,$H){var $I=$t._render,$T=$H._render,$K=$I.lightmapIndex-$T.lightmapIndex;if(0!=$K)return $K;var $_=$I.receiveShadow-$T.receiveShadow;if(0!=$_)return $_;var $V=$t._mainSortID-$H._mainSortID;return 0==$V?$t.renderObj.triangleCount-$H.renderObj.triangleCount:$V},$G}(),$PH=function($t){function $_($t,$H,$I,$T,$K){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$_.__super.call(this,$t,$H,$I),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$T,this._material=$K}$L($_,"laya.d3.graphics.SubMeshStaticBatch",$Kt);var $H=$_.prototype;return $H._compareBatchRenderElement=function($t,$H){return $t._batchIndexStart>$H._batchIndexStart},$H._addCombineBatchRenderObjTest=function($t){var $H=$t.renderObj._vertexCount;return!(65535<(0<$H?this._currentCombineVertexCount+$H:this._currentCombineVertexCount+$t.renderObj._getVertexBuffer().vertexCount))},$H._addCombineBatchRenderObj=function($t){var $H=$t.renderObj,$I=$H._vertexCount;this._initBatchRenderElements.push($t),$t._staticBatch=this,0<$I?(this._currentCombineIndexCount+=$H._indexCount,this._currentCombineVertexCount+=$I):(this._currentCombineIndexCount=this._currentCombineIndexCount+$H._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$H._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$H._deleteCombineBatchRenderObj=function($t){var $H=$t.renderObj,$I=this._initBatchRenderElements.indexOf($t);if(-1!==$I){this._initBatchRenderElements.splice($I,1),$t._staticBatch=null;var $T=$H._vertexCount;0<$T?(this._currentCombineIndexCount=this._currentCombineIndexCount-$H._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$T):(this._currentCombineIndexCount=this._currentCombineIndexCount-$H._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$H._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$H._finishInit=function(){if(this._needFinishCombine){var $t=0,$H=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $I=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$T=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$hH.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$EH.create("ushort",this._currentCombineIndexCount,35044);for(var $K=0,$_=this._initBatchRenderElements.length;$K<$_;$K++){var $V=this._initBatchRenderElements[$K],$e=$V.renderObj,$R=$e._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$V._sprite3D),$A=$e.getIndices(),$q=$V._sprite3D.transform._isFrontFaceInvert,$f=$t/(this._vertexDeclaration.vertexStride/4)-$e._vertexStart,$b=$H,$L=$b+$A.length;$V._batchIndexStart=$b,$V._batchIndexEnd=$L,$T.set($A,$H);var $G=0;if($q)for($G=$b;$G<$L;$G+=3){$T[$G]=$f+$T[$G];var $M=$T[$G+1],$O=$T[$G+2];$T[$G+1]=$f+$O,$T[$G+2]=$f+$M}else for($G=$b;$G<$L;$G+=3)$T[$G]=$f+$T[$G],$T[$G+1]=$f+$T[$G+1],$T[$G+2]=$f+$T[$G+2];$H+=$A.length,$I.set($R,$t),$t+=$R.length}this._vertexBuffer.setData($I),this._indexBuffer.setData($T),this._needFinishCombine=!1}},$H._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $WH)},$H._getRenderElement=function($t,$H,$I){for(var $T,$K,$_=this._batchRenderElements.length,$V=!0,$e=0;$e<$_;$e++){var $R,$A,$q=($K=this._batchRenderElements[$e])._sprite3D._render;if(0!==$e&&($V=($R=($T=this._batchRenderElements[$e-1])._sprite3D._render).lightmapIndex!==$q.lightmapIndex||$R.receiveShadow!==$q.receiveShadow||$T._batchIndexEnd!==$K._batchIndexStart),$V){($A=this._getCombineRenderElementFromPool()).renderObj=this,$A._material=this._material,$A._batchIndexStart=$K._batchIndexStart,$A._batchIndexEnd=$K._batchIndexEnd;var $f=$q.lightmapIndex,$b=$f+1,$L=this._batchOwnerIndices[$b];$L||($L=this._batchOwnerIndices[$b]=[]);var $G,$M=$L[$K._render.receiveShadow?1:0];void 0===$M?($L[$q.receiveShadow?1:0]=this._batchOwners.length,($G=new $nH(null,"StaticBatchMeshSprite3D"))._scene=$H,$G._transform=this._rootOwner?this._rootOwner._transform:null,$G._render.lightmapIndex=$f,$G._render.receiveShadow=$K._render.receiveShadow,this._batchOwners.push($G)):$G=this._batchOwners[$M],$G._render._renderUpdate($I),$A._sprite3D=$G,$t.push($A)}else $A._batchIndexEnd=$K._batchIndexEnd}},$H._beforeRender=function($t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$H._render=function($t){var $H=$t.renderElement,$I=$H._batchIndexStart,$T=$H._batchIndexEnd-$I;$x.mainContext.drawElements(4,$T,5123,2*$I),$s.drawCall++,$s.trianglesFaces+=$T/3},$H.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$H._getVertexBuffer=function($t){return void 0===$t&&($t=0),this._vertexBuffer},$_}(),$kH=function($t){function $H(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$H.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$L($H,"laya.d3.core.ComponentNode",$A);var $I=$H.prototype;return $I.addComponent=function($t){var $H,$I=this._componentsMap.indexOf($t);if(-1===$I)$H=[],this._componentsMap.push($t),this._typeComponentsIndices.push($H);else if($H=this._typeComponentsIndices[$I],this._components[$H[0]].isSingleton)throw new Error("无法单实例创建"+$t+"组件，"+$t+"组件已存在！");var $T=$K.getInstance($t);return $H.push(this._components.length),this._components.push($T),$T instanceof laya.d3.component.Script&&this._scripts.push($T),$T._initialize(this),$T},$I._removeComponent=function($t,$H){var $I=this._typeComponentsIndices[$t],$T=$I[$H],$K=this._components[$T];this._components.splice($T,1),$K instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($K),1),$I.splice($H,1),0===$I.length&&(this._typeComponentsIndices.splice($t,1),this._componentsMap.splice($t,1));for(var $_=0,$V=this._componentsMap.length;$_<$V;$_++)for(var $e=($I=this._typeComponentsIndices[$_]).length-1;0<=$e;$e--){var $R=$I[$e];if(!($T<$R))break;$I[$e]=--$R}$K._destroy()},$I.getComponentByType=function($t,$H){void 0===$H&&($H=0);var $I=this._componentsMap.indexOf($t);return-1===$I?null:this._components[this._typeComponentsIndices[$I][$H]]},$I.getComponentsByType=function($t,$H){var $I=this._componentsMap.indexOf($t);if(-1!==$I){var $T=this._typeComponentsIndices[$I],$K=$T.length;$H.length=$K;for(var $_=0;$_<$K;$_++)$H[$_]=this._components[$T[$_]]}else $H.length=0},$I.getComponentByIndex=function($t){return this._components[$t]},$I.removeComponentByType=function($t,$H){void 0===$H&&($H=0);var $I=this._componentsMap.indexOf($t);-1!==$I&&this._removeComponent($I,$H)},$I.removeComponentsByType=function($t){var $H=this._componentsMap.indexOf($t);if(-1!==$H)for(var $I=this._typeComponentsIndices[$H],$T=0,$K=$I.length;$T<$K;$I.length<$K?$K--:$T++)this._removeComponent($H,$T)},$I.removeAllComponent=function(){for(var $t=0,$H=this._componentsMap.length;$t<$H;this._componentsMap.length<$H?$H--:$t++)this.removeComponentsByType(this._componentsMap[$t])},$I._updateComponents=function($t){for(var $H=0,$I=this._components.length;$H<$I;$H++){var $T=this._components[$H];!$T.started&&($T._start($t),$T.started=!0),$T.enable&&$T._update($t)}},$I._lateUpdateComponents=function($t){for(var $H=0;$H<this._components.length;$H++){var $I=this._components[$H];!$I.started&&($I._start($t),$I.started=!0),$I.enable&&$I._lateUpdate($t)}},$I._preRenderUpdateComponents=function($t){for(var $H=0;$H<this._components.length;$H++){var $I=this._components[$H];!$I.started&&($I._start($t),$I.started=!0),$I.enable&&$I._preRenderUpdate($t)}},$I._postRenderUpdateComponents=function($t){for(var $H=0;$H<this._components.length;$H++){var $I=this._components[$H];!$I.started&&($I._start($t),$I.started=!0),$I.enable&&$I._postRenderUpdate($t)}},$H}(),$rH=function($T){function $t(){$t.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $bH,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $eH(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$L($t,"laya.d3.core.material.BaseMaterial",$T);var $H=$t.prototype;return $N.imps($H,{"laya.d3.core.IClone":!0}),$H._addShaderDefine=function($t){this._shaderDefineValue|=$t},$H._removeShaderDefine=function($t){this._shaderDefineValue&=~$t},$H._addDisablePublicShaderDefine=function($t){this._disablePublicShaderDefine|=$t},$H._removeDisablePublicShaderDefine=function($t){this._disablePublicShaderDefine&=~$t},$H._setBuffer=function($t,$H){this._shaderValues.setValue($t,$H),this._values[$t]=$H},$H._getBuffer=function($t){return this._values[$t]},$H._setMatrix4x4=function($t,$H){this._shaderValues.setValue($t,$H?$H.elements:null),this._values[$t]=$H},$H._getMatrix4x4=function($t){return this._values[$t]},$H._setInt=function($t,$H){this._shaderValues.setValue($t,$H),this._values[$t]=$H},$H._getInt=function($t){return this._values[$t]},$H._setNumber=function($t,$H){this._shaderValues.setValue($t,$H),this._values[$t]=$H},$H._getNumber=function($t){return this._values[$t]},$H._setBool=function($t,$H){this._shaderValues.setValue($t,$H),this._values[$t]=$H},$H._getBool=function($t){return this._values[$t]},$H._setVector2=function($t,$H){this._shaderValues.setValue($t,$H?$H.elements:null),this._values[$t]=$H},$H._getVector2=function($t){return this._values[$t]},$H._setColor=function($t,$H){this._shaderValues.setValue($t,$H?$H.elements:null),this._values[$t]=$H},$H._getColor=function($t){return this._values[$t]},$H._setTexture=function($t,$H){var $I=this._values[$t];this._values[$t]=$H,this._shaderValues.setValue($t,$H),0<this.referenceCount&&($I&&$I._removeReference(),$H&&$H._addReference())},$H._getTexture=function($t){return this._values[$t]},$H._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$H._getShader=function($t,$H,$I){var $T=($t|$H)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($T,$I,this._shaderDefineValue),this._shader},$H._setRenderStateBlendDepth=function(){var $t=$x.mainContext;switch($Y.setDepthMask($t,this.depthWrite),0===this.depthTest?$Y.setDepthTest($t,!1):($Y.setDepthTest($t,!0),$Y.setDepthFunc($t,this.depthTest)),this.blend){case 0:$Y.setBlend($t,!1);break;case 1:$Y.setBlend($t,!0),$Y.setBlendFunc($t,this.srcBlend,this.dstBlend);break;case 2:$Y.setBlend($t,!0)}},$H._setRenderStateFrontFace=function($t,$H){var $I=$x.mainContext,$T=0;switch(this.cull){case 0:$Y.setCullFace($I,!1);break;case 1:$Y.setCullFace($I,!0),$T=$t?$H&&$H._isFrontFaceInvert?2305:2304:$H&&$H._isFrontFaceInvert?2304:2305,$Y.setFrontFace($I,$T);break;case 2:$Y.setCullFace($I,!0),$T=$t?$H&&$H._isFrontFaceInvert?2304:2305:$H&&$H._isFrontFaceInvert?2305:2304,$Y.setFrontFace($I,$T)}},$H.onAsynLoaded=function($t,$H,$I){var $T=$H[0],$K=$H[1];switch($T.version){case"LAYAMATERIAL:01":var $_=0,$V=0,$e=$T.props;for(var $R in $e)switch($R){case"vectors":var $A=$e[$R];for($_=0,$V=$A.length;$_<$V;$_++){var $q=$A[$_],$f=$q.value;switch($f.length){case 2:this[$q.name]=new $_H($f[0],$f[1]);break;case 3:this[$q.name]=new $VH($f[0],$f[1],$f[2]);break;case 4:this[$q.name]=new $eH($f[0],$f[1],$f[2],$f[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $b=$e[$R];for($_=0,$V=$b.length;$_<$V;$_++){var $L=$b[$_],$G=$L.path;$G&&(this[$L.name]=$J.getRes($K[$G]))}break;case"defines":var $M=$e[$R];for($_=0,$V=$M.length;$_<$V;$_++){var $O=this._shaderCompile.getMaterialDefineByName($M[$_]);this._addShaderDefine($O)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$R]=$e[$R];break;case"renderQueue":switch($e[$R]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$R]=$e[$R]}break;case"LAYAMATERIAL:02":for($R in $e=$T.props)switch($R){case"vectors":for($_=0,$V=($A=$e[$R]).length;$_<$V;$_++)switch(($f=($q=$A[$_]).value).length){case 2:this[$q.name]=new $_H($f[0],$f[1]);break;case 3:this[$q.name]=new $VH($f[0],$f[1],$f[2]);break;case 4:this[$q.name]=new $eH($f[0],$f[1],$f[2],$f[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($_=0,$V=($b=$e[$R]).length;$_<$V;$_++)($G=($L=$b[$_]).path)&&(this[$L.name]=$J.getRes($K[$G]));break;case"defines":for($_=0,$V=($M=$e[$R]).length;$_<$V;$_++)$O=this._shaderCompile.getMaterialDefineByName($M[$_]),this._addShaderDefine($O);break;default:this[$R]=$e[$R]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$H._addReference=function(){$T.prototype._addReference.call(this);for(var $t=0,$H=this._values.length;$t<$H;$t++){var $I=this._values[$t];$I&&$I instanceof laya.d3.resource.BaseTexture&&$I._addReference()}},$H._removeReference=function(){$T.prototype._removeReference.call(this);for(var $t=0,$H=this._values.length;$t<$H;$t++){var $I=this._values[$t];$I&&$I instanceof laya.d3.resource.BaseTexture&&$I._removeReference()}},$H.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$H.setShaderName=function($t){var $H=$vH.nameKey.getID($t);if(-1===$H)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$sH._preCompileShader[$H]},$H.cloneTo=function($t){var $H=$t;$H.name=this.name,$H.cull=this.cull,$H.blend=this.blend,$H.srcBlend=this.srcBlend,$H.dstBlend=this.dstBlend,$H.srcBlendRGB=this.srcBlendRGB,$H.dstBlendRGB=this.dstBlendRGB,$H.srcBlendAlpha=this.srcBlendAlpha,$H.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($H.blendConstColor),$H.blendEquation=this.blendEquation,$H.blendEquationRGB=this.blendEquationRGB,$H.blendEquationAlpha=this.blendEquationAlpha,$H.depthTest=this.depthTest,$H.depthWrite=this.depthWrite,$H.renderQueue=this.renderQueue,$H._shader=this._shader,$H._disablePublicShaderDefine=this._disablePublicShaderDefine,$H._shaderDefineValue=this._shaderDefineValue;var $I,$T=0,$K=$H._shaderValues;$H._shaderValues.data.length=this._shaderValues.data.length;var $_=this._values.length,$V=$H._values;for($T=0,$I=$V.length=$_;$T<$I;$T++){var $e=this._values[$T];if($e)if("number"==typeof $e)$V[$T]=$e,$K.data[$T]=$e;else if("number"==typeof $e&&Math.floor($e)==$e)$V[$T]=$e,$K.data[$T]=$e;else if("boolean"==typeof $e)$V[$T]=$e,$K.data[$T]=$e;else if($e instanceof laya.d3.math.Vector2){var $R=$V[$T]||($V[$T]=new $_H);$e.cloneTo($R),$K.data[$T]=$R.elements}else if($e instanceof laya.d3.math.Vector3){var $A=$V[$T]||($V[$T]=new $VH);$e.cloneTo($A),$K.data[$T]=$A.elements}else if($e instanceof laya.d3.math.Vector4){var $q=$V[$T]||($V[$T]=new $eH);$e.cloneTo($q),$K.data[$T]=$q.elements}else if($e instanceof laya.d3.math.Matrix4x4){var $f=$V[$T]||($V[$T]=new $tH);$e.cloneTo($f),$K.data[$T]=$f.elements}else $e instanceof laya.d3.resource.BaseTexture&&($V[$T]=$e,$K.data[$T]=$e)}},$H.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$G(0,$H,"alphaTestValue",function(){return this._getNumber(0)},function($t){this._setNumber(0,$t)}),$G(0,$H,"alphaTest",function(){return this._alphaTest},function($t){(this._alphaTest=$t)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$t.__init__=function(){$t.SHADERDEFINE_ALPHATEST=$t.shaderDefines.registerDefine("ALPHATEST")},$t.RENDERQUEUE_OPAQUE=2e3,$t.RENDERQUEUE_ALPHATEST=2450,$t.RENDERQUEUE_TRANSPARENT=3e3,$t.CULL_NONE=0,$t.CULL_FRONT=1,$t.CULL_BACK=2,$t.BLEND_DISABLE=0,$t.BLEND_ENABLE_ALL=1,$t.BLEND_ENABLE_SEPERATE=2,$t.BLENDPARAM_ZERO=0,$t.BLENDPARAM_ONE=1,$t.BLENDPARAM_SRC_COLOR=768,$t.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$t.BLENDPARAM_DST_COLOR=774,$t.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$t.BLENDPARAM_SRC_ALPHA=770,$t.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$t.BLENDPARAM_DST_ALPHA=772,$t.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$t.BLENDPARAM_SRC_ALPHA_SATURATE=776,$t.BLENDEQUATION_ADD=0,$t.BLENDEQUATION_SUBTRACT=1,$t.BLENDEQUATION_REVERSE_SUBTRACT=2,$t.DEPTHTEST_OFF=0,$t.DEPTHTEST_NEVER=512,$t.DEPTHTEST_LESS=513,$t.DEPTHTEST_EQUAL=514,$t.DEPTHTEST_LEQUAL=515,$t.DEPTHTEST_GREATER=516,$t.DEPTHTEST_NOTEQUAL=517,$t.DEPTHTEST_GEQUAL=518,$t.DEPTHTEST_ALWAYS=519,$t.SHADERDEFINE_ALPHATEST=1,$t.ALPHATESTVALUE=0,$f($t,["shaderDefines",function(){return this.shaderDefines=new $qH}]),$t}($O),$xH=function($t){function $H(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$H.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$L($H,"laya.d3.resource.BaseTexture",$O);var $I=$H.prototype;return $G(0,$I,"width",function(){return this._width}),$G(0,$I,"repeat",function(){return this._repeat},function($t){if(this._repeat!==$t&&(this._repeat=$t,this._source)){var $H=$x.mainContext;$Y.bindTexture($H,this._type,this._source),$C.isPOT(this._width,this._height)&&this._repeat?($H.texParameteri(this._type,10242,10497),$H.texParameteri(this._type,10243,10497)):($H.texParameteri(this._type,10242,33071),$H.texParameteri(this._type,10243,33071))}}),$G(0,$I,"height",function(){return this._height}),$G(0,$I,"magFifter",function(){return this._magFifter},function($t){(this._magFifter=$t)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($t)}),$G(0,$I,"wrapModeV",function(){return this._wrapModeV}),$G(0,$I,"size",function(){return this._size}),$G(0,$I,"wrapModeU",function(){return this._wrapModeU}),$G(0,$I,"mipmap",function(){return this._mipmap},function($t){this._mipmap=$t,this._mipmap!=$t&&this._conchTexture&&this._conchTexture.setMipMap($t)}),$G(0,$I,"minFifter",function(){return this._minFifter},function($t){this._minFifter=$t,this._minFifter!=$t&&this._conchTexture&&this._conchTexture.setMinFifter($t)}),$G(0,$I,"format",function(){return this._format}),$G(0,$I,"source",function(){return this.activeResource(),this._source}),$G(0,$I,"defaulteTexture",function(){return $uH.grayTexture}),$H.WARPMODE_REPEAT=0,$H.WARPMODE_CLAMP=1,$H}(),$YH=function($t){function $H(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$H.__super.call(this),this._boundingBoxCorners=$T(8,null)}$L($H,"laya.d3.resource.models.BaseMesh",$O);var $I=$H.prototype;return $I._getPositions=function(){throw new Error("未Override,请重载该属性！")},$I._generateBoundingObject=function(){this._boundingSphere=new $jt(new $VH,0),$jt.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $ct(new $VH,new $VH),$ct.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$I.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$I.getRenderElement=function($t){throw new Error("未Override,请重载该属性！")},$G(0,$I,"subMeshCount",function(){return this._subMeshCount}),$G(0,$I,"boundingBox",function(){return this._boundingBox}),$G(0,$I,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$G(0,$I,"boundingSphere",function(){return this._boundingSphere}),$H}(),$DH=(function($t){function $H(){$H.__super.call(this)}$L($H,"laya.d3.component.Script",$UH);var $I=$H.prototype;$I.onTriggerEnter=function($t){},$I.onTriggerExit=function($t){},$I.onTriggerStay=function($t){},$G(0,$I,"isSingleton",function(){return $H._isSingleton}),$H._isSingleton=!1}(),function($t){function $H($t){this._owner=null,this._sharedMesh=null,$H.__super.call(this),this._owner=$t}$L($H,"laya.d3.core.MeshFilter",$t);var $I=$H.prototype;return $I._sharedMeshLoaded=function(){this.event("loaded")},$I._destroy=function(){$t.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$G(0,$I,"sharedMesh",function(){return this._sharedMesh},function($t){var $H=this._sharedMesh;$H&&$H._removeReference(),(this._sharedMesh=$t)._addReference(),this.event("meshchanged",[this,$H,$t]),$t.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$G(0,$I,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$G(0,$I,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$G(0,$I,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$G(0,$I,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$H}($CH)),$pH=function($t){function $H($t){$H.__super.call(this,$t),$t.meshFilter.on("meshchanged",this,this._onMeshChanged)}$L($H,"laya.d3.core.MeshRender",$NH);var $I=$H.prototype;return $I._onMeshChanged=function($t,$H,$I){$I.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$I.once("loaded",this,this._onMeshLoaed)},$I._onMeshLoaed=function($t,$H){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$I._calculateBoundingSphereByInitSphere=function($t){var $H=NaN,$I=this._owner.transform,$T=$I.scale.elements,$K=Math.abs($T[0]),$_=Math.abs($T[1]),$V=Math.abs($T[2]);$H=$_<=$K&&$V<=$K?$K:$V<=$_?$_:$V,$VH.transformCoordinate($t.center,$I.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$t.radius*$H},$I._calculateBoundBoxByInitCorners=function($t){for(var $H=this._owner.transform.worldMatrix,$I=0;$I<8;$I++)$VH.transformCoordinate($t[$I],$H,$NH._tempBoundBoxCorners[$I]);$ct.createfromPoints($NH._tempBoundBoxCorners,this._boundingBox)},$I._calculateBoundingSphere=function(){var $t=this._owner.meshFilter.sharedMesh;null==$t||null==$t.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($t.boundingSphere)},$I._calculateBoundingBox=function(){var $t=this._owner.meshFilter.sharedMesh;null==$t||null==$t.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($t.boundingBoxCorners)},$I._renderUpdate=function($t){var $H=this._owner.transform;if($H){this._setShaderValueMatrix4x4(0,$H.worldMatrix);var $I=this._owner.getProjectionViewWorldMatrix($t);this._setShaderValueMatrix4x4(1,$I)}else this._setShaderValueMatrix4x4(0,$tH.DEFAULT),this._setShaderValueMatrix4x4(1,$t);return $JH.debugMode&&this._renderRenderableBoundBox(),!0},$H}(),$gH=function($H){function $T(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$T.__super.call(this),this._renderState=new $F,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $bH,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $Ht,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $VH(.7,.7,.7),this.ambientColor=new $VH(.212,.227,.259),$x.shaderHighPrecision&&this.addShaderDefine($sH.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$L($T,"laya.d3.core.scene.Scene",$H);var $t=$T.prototype;return $N.imps($t,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$t._setUrl=function($t){this._url=$t},$t._getGroup=function(){return this._group},$t._setGroup=function($t){this._group=$t},$t._display=function(){$N.stage._scenes.push(this),$N.stage._scenes.sort($T._sortScenes);for(var $t=0,$H=this._childs.length;$t<$H;$t++){var $I=this._childs[$t];$I.active&&$I._activeHierarchy()}},$t._unDisplay=function(){var $t=$N.stage._scenes;$t.splice($t.indexOf(this),1);for(var $H=0,$I=this._childs.length;$H<$I;$H++){var $T=this._childs[$H];$T.active&&$T._inActiveHierarchy()}},$t._addChild3D=function($t){$t.transform._onWorldTransform(),$t._setBelongScene(this),this.displayedInStage&&$t.active&&$t._activeHierarchy()},$t._removeChild3D=function($t){$t.transform.parent=null,this.displayedInStage&&$t.active&&$t._inActiveHierarchy(),$t._setUnBelongScene()},$t.initOctree=function($t,$H,$I,$T,$K){void 0===$K&&($K=6),this.treeSize=new $VH($t,$H,$I),this.treeLevel=$K,this.treeRoot=new $c(this,0),this.treeRoot.init($T,this.treeSize)},$t._prepareUpdateToRenderState=function($t,$H){$H.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$H.scene=this},$t._prepareSceneToRender=function($t){var $H=this._lights.length;if(0<$H)for(var $I=0,$T=0;$T<$H&&!(this._lights[$T]._prepareToScene($t)&&++$I>=this._enableLightCount);$T++);},$t._updateChilds=function($t){for(var $H=0,$I=this._childs.length;$H<$I;++$H)this._childs[$H]._update($t)},$t._preRenderScene=function($t,$H,$I){var $T,$K=$H._viewMatrix,$_=$H._projectionMatrix,$V=$H._projectionViewMatrix,$e=0,$R=$H.camera;for($R.useOcclusionCulling?this.treeRoot?$It.renderObjectCullingOctree($I,this,$R,$K,$_,$V):$It.renderObjectCulling($I,this,$R,$K,$_,$V):$It.renderObjectCullingNoBoundFrustum(this,$R,$K,$_,$V),$e=0,$T=this._quenes.length;$e<$T;$e++)this._quenes[$e]&&this._quenes[$e]._preRender($H)},$t._clear=function($t,$H){var $I=$H._viewport,$T=$H.camera,$K=$I.x,$_=$T.renderTargetSize.height-$I.y-$I.height,$V=$I.width,$e=$I.height;$t.viewport($K,$_,$V,$e);var $R=256,$A=$T.renderTarget;switch($T.clearFlag){case 0:var $q=$T.clearColor;if($q){$t.enable(3089),$t.scissor($K,$_,$V,$e);var $f=$q.elements;$t.clearColor($f[0],$f[1],$f[2],$f[3]),$R|=16384}if($A)switch($q||($R=16384),$A.depthStencilFormat){case 33189:$R|=256;break;case 36168:$R|=1024;break;case 34041:$R|=256,$R|=1024}$t.clear($R),$q&&$t.disable(3089);break;case 1:case 2:if($A)switch($R=16384,$A.depthStencilFormat){case 33189:$R|=256;break;case 36168:$R|=1024;break;case 34041:$R|=256,$R|=1024}$t.clear($R);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$t._renderScene=function($t,$H){var $I,$T,$K=$H.camera,$_=0;for($_=0;$_<2;$_++)($T=this._quenes[$_])&&($K.renderTarget?$T._render($H,!0):$T._render($H,!1));if(1===$K.clearFlag){var $V=$K.sky;$V&&($Y.setCullFace($t,!1),$Y.setDepthFunc($t,515),$Y.setDepthMask($t,!1),$V._render($H),$Y.setDepthFunc($t,513),$Y.setDepthMask($t,!0))}for($_=2,$I=this._quenes.length;$_<$I;$_++)($T=this._quenes[$_])&&($T._sortAlpha($H.camera.transform.position),$K.renderTarget?$T._render($H,!0):$T._render($H,!1))},$t._set3DRenderConfig=function($t){$t.disable(3042),$Y._blend=!1,$t.blendFunc(770,771),$Y._sFactor=770,$Y._dFactor=771,$t.disable(2929),$Y._depthTest=!1,$t.enable(2884),$Y._cullFace=!0,$t.depthMask(1),$Y._depthMask=!0,$t.frontFace(2304),$Y._frontFace=2304},$t._set2DRenderConfig=function($t){$Y.setBlend($t,!0),$Y.setBlendFunc($t,1,771),$Y.setDepthTest($t,!1),$Y.setCullFace($t,!1),$Y.setDepthMask($t,!0),$Y.setFrontFace($t,2305),$t.viewport(0,0,$q.width,$q.height)},$t._parseCustomProps=function($t,$H,$I,$T){var $K=$T.customProps.lightmaps,$_=$K.length,$V=this._lightmaps;$V.length=$_;for(var $e=0;$e<$_;$e++)$V[$e]=$J.getRes($H[$K[$e].replace(".exr",".png")]);this.setlightmaps($V);var $R=$T.customProps.ambientColor;$R&&(this.ambientColor=new $VH($R[0],$R[1],$R[2]));var $A=$T.customProps.fogColor;$A&&(this.fogColor=new $VH($A[0],$A[1],$A[2]))},$t._addLight=function($t){this._lights.indexOf($t)<0&&this._lights.push($t)},$t._removeLight=function($t){var $H=this._lights.indexOf($t);0<=$H&&this._lights.splice($H,1)},$t._updateScene=function(){var $t=this._renderState;this._prepareUpdateToRenderState($x.mainContext,$t),this._updateComponents($t),this._updateChilds($t),this._lateUpdateComponents($t),this._time+=$t.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$t._updateSceneConch=function(){var $t=this._renderState;this._prepareUpdateToRenderState($x.mainContext,$t),this._updateComponents($t),this._lateUpdateComponents($t),this._prepareSceneToRender($t);for(var $H=0,$I=this._cameraPool.length;$H<$I;$H++){var $T=this._cameraPool[$H];($t.camera=$T)._prepareCameraToRender()}},$t._preRenderShadow=function($t,$H,$I,$T,$K){this.treeRoot?$It.renderShadowObjectCullingOctree(this,$H,$I,$T,$K):$It.renderShadowObjectCulling(this,$H,$I,$T,$K);for(var $_=0,$V=$I.length;$_<$V;$_++)$I[$_]&&$I[$_]._preRender($t)},$t._renderShadowMap=function($t,$H,$I){var $T=this.parallelSplitShadowMaps[0];$T._calcAllLightCameraInfo($I);var $K,$_,$V,$e=$T.PSSMNum;if(this._preRenderShadow($H,$T._lightCulling,$T._shadowQuenes,$T._lightVPMatrix[0],$e),this.addShaderDefine($LH.SHADERDEFINE_CAST_SHADOW),1<$e)for(var $R=0;$R<$e;$R++)$K=$T.getRenderTarget($R+1),$T.beginRenderTarget($R+1),$t.clearColor(1,1,1,1),$t.clear(16640),$t.viewport(0,0,$K.width,$K.height),$H.camera=$V=$T.getLightCamera($R),$V._prepareCameraToRender(),$V._prepareCameraViewProject($V.viewMatrix,$V.projectionMatrix),$H._projectionViewMatrix=$T._lightVPMatrix[$R+1],($_=$T._shadowQuenes[$R])._preRender($H),$_._renderShadow($H,!1),$T.endRenderTarget($R+1);else $K=$T.getRenderTarget(1),$T.beginRenderTarget(1),$t.clearColor(1,1,1,1),$t.clear(16640),$t.viewport(0,0,$K.width,$K.height),$H.camera=$V=$T.getLightCamera(0),$V._prepareCameraToRender(),$V._prepareCameraViewProject($V.viewMatrix,$V.projectionMatrix),$H._projectionViewMatrix=$T._lightVPMatrix[0],($_=$T._shadowQuenes[0])._preRender($H),$_._renderShadow($H,!0),$T.endRenderTarget(1);this.removeShaderDefine($LH.SHADERDEFINE_CAST_SHADOW)},$t.addTreeNode=function($t){this.treeRoot.addTreeNode($t)},$t.removeTreeNode=function($t){this.treeSize&&$t._treeNode&&$t._treeNode.removeObject($t)},$t.setlightmaps=function($t){this._lightmaps=$t;for(var $H=0,$I=this._renderableSprite3Ds.length;$H<$I;$H++)this._renderableSprite3Ds[$H]._render._applyLightMapParams()},$t.getlightmaps=function(){return this._lightmaps},$t.addChildAt=function($t,$H){if(!($t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($t&&$t.__className));if(!$t||this.destroyed||$t===this)return $t;if($t.zOrder&&this._set$P("hasZorder",!0),0<=$H&&$H<=this._childs.length){if($t._parent===this){var $I=this.getChildIndex($t);this._childs.splice($I,1),this._childs.splice($H,0,$t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,$H)),this._childChanged()}else $t.parent&&$t.parent.removeChild($t),this._childs===$A.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($H,0,$t),this.conchModel&&this.conchModel.addChildAt($t.conchModel,$H),($t.parent=this)._addChild3D($t);return $t}throw new Error("appendChildAt:The index is out of bounds")},$t.addChild=function($t){if(!($t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$t||this.destroyed||$t===this)return $t;if($t.zOrder&&this._set$P("hasZorder",!0),$t._parent===this){var $H=this.getChildIndex($t);$H!==this._childs.length-1&&(this._childs.splice($H,1),this._childs.push($t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,this._childs.length-1)),this._childChanged())}else $t.parent&&$t.parent.removeChild($t),this._childs===$A.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($t),this.conchModel&&this.conchModel.addChildAt($t.conchModel,this._childs.length-1),($t.parent=this)._childChanged(),this._addChild3D($t);return $t},$t.removeChildAt=function($t){var $H=this.getChildAt($t);return $H&&(this._removeChild3D($H),this._childs.splice($t,1),this.conchModel&&this.conchModel.removeChild($H.conchModel),$H.parent=null),$H},$t.removeChildren=function($t,$H){if(void 0===$t&&($t=0),void 0===$H&&($H=2147483647),this._childs&&0<this._childs.length){var $I=this._childs;if(0===$t&&$_<=$H){var $T=$I;this._childs=$A.ARRAY_EMPTY}else $T=$I.splice($t,$H-$t);for(var $K=0,$_=$T.length;$K<$_;$K++)this._removeChild3D($T[$K]),$T[$K].parent=null,this.conchModel&&this.conchModel.removeChild($T[$K].conchModel)}return this},$t.addFrustumCullingObject=function($t){this.treeRoot?this.addTreeNode($t):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($t):this._cullingRenders[this._cullingRendersLength]=$t,$t._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$t.removeFrustumCullingObject=function($t){if(this.treeRoot)this.removeTreeNode($t);else{this._cullingRendersLength--;var $H=$t._indexInSceneFrustumCullingObjects;if($H!==this._cullingRendersLength){var $I=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$H]=$I)._indexInSceneFrustumCullingObjects=$H,$t._indexInSceneFrustumCullingObjects=-1}}},$t.getRenderQueue=function($t){return $t<3e3?this._quenes[1]||(this._quenes[1]=new $n(this)):this._quenes[2]||(this._quenes[2]=new $n(this))},$t.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $n(this)},$t.addShaderDefine=function($t){this._shaderDefineValue|=$t},$t.removeShaderDefine=function($t){this._shaderDefineValue&=~$t},$t.addScript=function($t){return this._addComponent($t)},$t.getScriptByType=function($t,$H){return void 0===$H&&($H=0),this._getComponentByType($t,$H)},$t.getScriptsByType=function($t,$H){this._getComponentsByType($t,$H)},$t.getScriptByIndex=function($t){return this._getComponentByIndex($t)},$t.removeScriptByType=function($t,$H){void 0===$H&&($H=0),this._removeComponentByType($t,$H)},$t.removeScriptsByType=function($t){this._removeComponentByType($t)},$t.removeAllScript=function(){this._removeAllComponent()},$t.render=function($t,$H,$I){($M._context.ctx._renderKey=0)<this._childs.length&&$t.addRenderObject(this)},$t.renderSubmit=function(){var $t=$x.mainContext,$H=this._renderState;this._set3DRenderConfig($t),this._prepareSceneToRender(this._renderState);var $I,$T=0,$K=0;if($JH.debugMode||$c.debugMode)for($T=0,$K=this._cameraPool.length;$T<$K;$T++)$I=this._cameraPool[$T],$JH._debugPhasorSprite.begin(1,$I),$I.activeInHierarchy&&$I._renderCamera($t,$H,this),$JH._debugPhasorSprite.end();else for($T=0,$K=this._cameraPool.length;$T<$K;$T++)($I=this._cameraPool[$T]).activeInHierarchy&&$I._renderCamera($t,$H,this);return this._set2DRenderConfig($t),1},$t.onAsynLoaded=function($t,$H,$I){var $T=$H[0];if("Scene"!==$T.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $K=$H[1];$OH._createNodeByJson(this,$T,this,$K),this.event("hierarchyloaded",[this]),this.__loaded=!0},$t.destroy=function($t){void 0===$t&&($t=!0),this.destroyed||($H.prototype.destroy.call(this,$t),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$J.clearRes(this.url),this.loaded||$JH._cancelLoadByUrl(this.url))},$t.getRenderType=function(){return 0},$t.releaseRender=function(){},$t._addComponent=function($t){var $H,$I=this._componentsMap.indexOf($t);if(-1===$I)$H=[],this._componentsMap.push($t),this._typeComponentsIndices.push($H);else if($H=this._typeComponentsIndices[$I],this._components[$H[0]].isSingleton)throw new Error("无法单实例创建"+$t+"组件，"+$t+"组件已存在！");var $T=$K.getInstance($t);$H.push(this._components.length),this._components.push($T);return $T._initialize(this),$T},$t._removeComponent=function($t,$H){var $I=this._typeComponentsIndices[$t],$T=$I[$H],$K=this._components[$T];this._components.splice($T,1),$I.splice($H,1),0===$I.length&&(this._typeComponentsIndices.splice($t,1),this._componentsMap.splice($t,1));for(var $_=0,$V=this._componentsMap.length;$_<$V;$_++)for(var $e=($I=this._typeComponentsIndices[$_]).length-1;0<=$e;$e--){var $R=$I[$e];if(!($T<$R))break;$I[$e]=--$R}$K._destroy()},$t._getComponentByType=function($t,$H){void 0===$H&&($H=0);var $I=this._componentsMap.indexOf($t);return-1===$I?null:this._components[this._typeComponentsIndices[$I][$H]]},$t._getComponentsByType=function($t,$H){var $I=this._componentsMap.indexOf($t);if(-1!==$I){var $T=this._typeComponentsIndices[$I],$K=$T.length;$H.length=$K;for(var $_=0;$_<$K;$_++)$H[$_]=this._components[$T[$_]]}else $H.length=0},$t._getComponentByIndex=function($t){return this._components[$t]},$t._removeComponentByType=function($t,$H){void 0===$H&&($H=0);var $I=this._componentsMap.indexOf($t);-1!==$I&&this._removeComponent($I,$H)},$t._removeComponentsByType=function($t){var $H=this._componentsMap.indexOf($t);if(-1!==$H)for(var $I=this._typeComponentsIndices[$H],$T=0,$K=$I.length;$T<$K;$I.length<$K?$K--:$T++)this._removeComponent($H,$T)},$t._removeAllComponent=function(){for(var $t=0,$H=this._componentsMap.length;$t<$H;this._componentsMap.length<$H?$H--:$t++)this._removeComponentsByType(this._componentsMap[$t])},$t._updateComponents=function($t){for(var $H=0,$I=this._components.length;$H<$I;$H++){var $T=this._components[$H];!$T.started&&($T._start($t),$T.started=!0),$T.enable&&$T._update($t)}},$t._lateUpdateComponents=function($t){for(var $H=0;$H<this._components.length;$H++){var $I=this._components[$H];!$I.started&&($I._start($t),$I.started=!0),$I.enable&&$I._lateUpdate($t)}},$t._preRenderUpdateComponents=function($t){for(var $H=0;$H<this._components.length;$H++){var $I=this._components[$H];!$I.started&&($I._start($t),$I.started=!0),$I.enable&&$I._preRenderUpdate($t)}},$t._postRenderUpdateComponents=function($t){for(var $H=0;$H<this._components.length;$H++){var $I=this._components[$H];!$I.started&&($I._start($t),$I.started=!0),$I.enable&&$I._postRenderUpdate($t)}},$G(0,$t,"_loaded",null,function($t){this.__loaded=$t}),$G(0,$t,"fogColor",function(){return this._fogColor},function($t){this._fogColor=$t,this._shaderValues.setValue(0,$t.elements)}),$G(0,$t,"enableFog",function(){return this._enableFog},function($t){this._enableFog!==$t&&((this._enableFog=$t)?(this.addShaderDefine($sH.SHADERDEFINE_FOG),this.removeShaderDefine($sH.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($sH.SHADERDEFINE_FOG))}),$G(0,$t,"url",function(){return this._url}),$G(0,$t,"loaded",function(){return this.__loaded}),$G(0,$t,"enableDepthFog",function(){return this._enableDepthFog},function($t){this._enableDepthFog!=$t&&((this._enableDepthFog=$t)?(this.addShaderDefine($sH.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($sH.SHADERDEFINE_FOG)):this.removeShaderDefine($sH.SAHDERDEFINE_DEPTHFOG))}),$G(0,$t,"fogStart",function(){return this._fogStart},function($t){this._fogStart=$t,this._shaderValues.setValue(1,$t)}),$G(0,$t,"fogRange",function(){return this._fogRange},function($t){this._fogRange=$t,this._shaderValues.setValue(2,$t)}),$G(0,$t,"ambientColor",function(){return this._ambientColor},function($t){this._ambientColor=$t,this._shaderValues.setValue(21,$t.elements)}),$G(0,$t,"scene",function(){return this}),$G(0,$t,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$T._sortScenes=function($t,$H){if($t.parent!==$N.stage||$H.parent!==$N.stage)return $t.parent!==$N.stage&&$H.parent!==$N.stage?$T._sortScenes($t.parent,$H.parent):$t.parent===$N.stage?-1:1;var $I=$N.stage._childs;return $I.indexOf($t)-$I.indexOf($H)},$T.load=function($t){return $N.loader.create($t,null,null,$T)},$T.FOGCOLOR=0,$T.FOGSTART=1,$T.FOGRANGE=2,$T.LIGHTDIRECTION=3,$T.LIGHTDIRCOLOR=4,$T.POINTLIGHTPOS=5,$T.POINTLIGHTRANGE=6,$T.POINTLIGHTATTENUATION=7,$T.POINTLIGHTCOLOR=8,$T.SPOTLIGHTPOS=9,$T.SPOTLIGHTDIRECTION=10,$T.SPOTLIGHTSPOT=11,$T.SPOTLIGHTRANGE=12,$T.SPOTLIGHTATTENUATION=13,$T.SPOTLIGHTCOLOR=14,$T.SHADOWDISTANCE=15,$T.SHADOWLIGHTVIEWPROJECT=16,$T.SHADOWMAPPCFOFFSET=17,$T.SHADOWMAPTEXTURE1=18,$T.SHADOWMAPTEXTURE2=19,$T.SHADOWMAPTEXTURE3=20,$T.AMBIENTCOLOR=21,$T.TIME=22,$T}($W),$lH=function($t){function $H($t){$H.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $tH,this._shaderValues=new $bH,this._colliders=[],this._id=++$H._uniqueIDCounter,this._transform=new $wH(this),this.name=$t||"Sprite3D-"+$H._nameNumberCounter++,this.layer=$p.currentCreationLayer,this.active=!0}$L($H,"laya.d3.core.Sprite3D",$kH);var $I=$H.prototype;return $N.imps($I,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$I._setUrl=function($t){this._url=$t},$I._getGroup=function(){return this._group},$I._setGroup=function($t){this._group=$t},$I._addChild3D=function($t){$t.transform.parent=this.transform,this._hierarchyAnimator&&(!$t._hierarchyAnimator&&$t._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($t,!0,[$t.name])),this._scene&&($t._setBelongScene(this._scene),this._activeInHierarchy&&$t._active&&$t._activeHierarchy())},$I._removeChild3D=function($t){$t.transform.parent=null,this._scene&&(this._activeInHierarchy&&$t._active&&$t._inActiveHierarchy(),$t._setUnBelongScene()),this._hierarchyAnimator&&($t._hierarchyAnimator==this._hierarchyAnimator&&$t._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($t,!1,[$t.name]))},$I._parseBaseCustomProps=function($t){var $H=this.transform.localPosition;$t.translate?($H.fromArray($t.translate),$H.x*=100,$H.y*=100,$H.z*=100):$H.elements.fill(0),this.transform.localPosition=$H;var $I=this.transform.localRotation;$t.rotation?$I.fromArray($t.rotation):$I.fromArray([0,0,0,-1]),this.transform.localRotation=$I;var $T=this.transform.localScale;$t.scale?$T.fromArray($t.scale):$T.elements.fill(1),this.transform.localScale=$T;var $K=$t.layer;null!=$K&&(this.layer=$p.getLayerByNumber($K))},$I._parseCustomComponent=function($t,$H,$I){for(var $T in $I){var $K=$I[$T];switch($T){case"Animator":var $_=this.addComponent(Animator);if($K.avatarPath)$_.avatar=$J.getRes($H[$K.avatarPath]);else{var $V=$K.avatar;if($V){$_.avatar=$J.getRes($H[$V.path]);var $e=$V.linkSprites;$e&&$t.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$_,$e])}}for(var $R=$K.clipPaths,$A=$R.length,$q=0;$q<$A;$q++)$_.addClip($J.getRes($H[$R[$q]]));$_.clip=$J.getRes($H[$R[0]]);var $f=$K.playOnWake;void 0!==$f&&($_.playOnWake=$f);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $b=this.addComponent(SphereCollider);$b.isTrigger=$K.isTrigger;var $L=$b.center;$L.fromArray($K.center),$b.center=$L,$b.radius=$K.radius;break;case"BoxCollider":var $G=this.addComponent(BoxCollider);$G.isTrigger=$K.isTrigger,$G.center.fromArray($K.center);var $M=$G.size;$M.fromArray($K.size),$G.size=$M;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$I._onRootNodeHierarchyLoaded=function($t,$H){for(var $I in $H){for(var $T=this,$K=$H[$I],$_=0,$V=$K.length;$_<$V;$_++){var $e=$K[$_];if(""===$e)break;if(!($T=$T.getChildByName($e)))break}$T&&$t.linkSprite3DToAvatarNode($I,$T)}},$I._setHierarchyAnimator=function($t,$H){this._changeHierarchyAnimator($t);for(var $I=0,$T=this._childs.length;$I<$T;$I++){var $K=this._childs[$I];$K._hierarchyAnimator==$H&&$K._setHierarchyAnimator($t,$H)}},$I._clearHierarchyAnimator=function($t,$H){this._changeHierarchyAnimator($H);for(var $I=0,$T=this._childs.length;$I<$T;$I++){var $K=this._childs[$I];$K._hierarchyAnimator==$t&&$K._clearHierarchyAnimator($t,$H)}},$I._getAnimatorToLinkSprite3D=function($t,$H,$I){var $T=this.getComponentByType(Animator);if($T&&($T.avatar?$T.avatar._version||$t._setAnimatorToLinkAvatar($T,$H):$t._setAnimatorToLinkSprite3DNoAvatar($T,$H,$I)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$I.unshift(this._parent.name);var $K=this._parent;$K._hierarchyAnimator&&$K._getAnimatorToLinkSprite3D($t,$H,$I)}},$I._setAnimatorToLinkSprite3DNoAvatar=function($t,$H,$I){var $T=0,$K=0;for($T=0,$K=$t.getClipCount();$T<$K;$T++)$t._handleSpriteOwnersBySprite($T,$H,$I,this);for($T=0,$K=this._childs.length;$T<$K;$T++){var $_=this._childs[$T],$V=$I.length;$I.push($_.name),$_._setAnimatorToLinkSprite3DNoAvatar($t,$H,$I),$I.splice($V,1)}},$I._changeHierarchyAnimator=function($t){this._hierarchyAnimator=$t},$I._isLinkSpriteToAnimationNode=function($t,$H,$I){var $T=$t._avatarNodes.indexOf($H),$K=$t._cacheSpriteToNodesMap;if($I)this._transform.dummy=$H.transform,$t._cacheNodesToSpriteMap[$T]=$K.length,$K.push($T);else{this._transform.dummy=null;var $_=$t._cacheNodesToSpriteMap[$T];$t._cacheNodesToSpriteMap[$T]=null,$K.splice($_,1)}},$I._setBelongScene=function($t){this._scene=$t;for(var $H=0,$I=this._childs.length;$H<$I;$H++)this._childs[$H]._setBelongScene($t)},$I._setUnBelongScene=function(){this._scene=null;for(var $t=0,$H=this._childs.length;$t<$H;$t++)this._childs[$t]._setUnBelongScene()},$I._activeHierarchy=function(){var $t=0,$H=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$t=0,$H=this._colliders.length;$t<$H;$t++)this._layer._addCollider(this._colliders[$t]);for(this.event("activeinhierarchychanged",!0),$t=0,$H=this._childs.length;$t<$H;$t++){var $I=this._childs[$t];$I._active&&$I._activeHierarchy()}},$I._inActiveHierarchy=function(){var $t=0,$H=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$t=0,$H=this._colliders.length;$t<$H;$t++){var $I=this._colliders[$t];$I._clearCollsionMap(),this._layer._removeCollider($I)}for(this.event("activeinhierarchychanged",!1),$t=0,$H=this._childs.length;$t<$H;$t++){var $T=this._childs[$t];$T._active&&$T._inActiveHierarchy()}},$I.addComponent=function($t){var $H,$I=this._componentsMap.indexOf($t);if(-1===$I)$H=[],this._componentsMap.push($t),this._typeComponentsIndices.push($H);else if($H=this._typeComponentsIndices[$I],this._components[$H[0]].isSingleton)throw new Error("无法单实例创建"+$t+"组件，"+$t+"组件已存在！");var $T=$K.getInstance($t);return $H.push(this._components.length),this._components.push($T),$T instanceof laya.d3.component.Script&&this._scripts.push($T),$T._initialize(this),$T},$I._removeComponent=function($t,$H){var $I,$T=0,$K=this._typeComponentsIndices[$t],$_=$K[$H],$V=this._components[$_];for($V instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($V),1),$K.splice($H,1),0===$K.length&&(this._typeComponentsIndices.splice($t,1),this._componentsMap.splice($t,1)),$T=0,$I=this._componentsMap.length;$T<$I;$T++)for(var $e=($K=this._typeComponentsIndices[$T]).length-1;0<=$e;$e--){var $R=$K[$e];if(!($_<$R))break;$K[$e]=--$R}$V._destroy()},$I._clearSelfRenderObjects=function(){},$I._addSelfRenderObjects=function(){},$I._parseCustomProps=function($t,$H,$I,$T){},$I._updateChilds=function($t){var $H=this._childs.length;if(0!==$H)for(var $I=0;$I<$H;++$I)this._childs[$I]._update($t)},$I._getSortID=function($t,$H){return 1e3*$H.id+$t._getVertexBuffer().vertexDeclaration.id},$I._update=function($t){($t.owner=this)._activeInHierarchy&&(this._updateComponents($t),this._lateUpdateComponents($t),$s.spriteCount++,this._childs.length&&this._updateChilds($t))},$I.getProjectionViewWorldMatrix=function($t){return $tH.multiply($t,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$I.loadHierarchy=function($t){this.addChild(laya.d3.core.Sprite3D.load($t))},$I.addChildAt=function($t,$H){if(!($t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$t||this.destroyed||$t===this)return $t;if($t.zOrder&&this._set$P("hasZorder",!0),0<=$H&&$H<=this._childs.length){if($t._parent===this){var $I=this.getChildIndex($t);this._childs.splice($I,1),this._childs.splice($H,0,$t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,$H)),this._childChanged()}else $t.parent&&$t.parent.removeChild($t),this._childs===$A.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($H,0,$t),this.conchModel&&this.conchModel.addChildAt($t.conchModel,$H),($t.parent=this)._addChild3D($t);return $t}throw new Error("appendChildAt:The index is out of bounds")},$I.addChild=function($t){if(!($t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$t||this.destroyed||$t===this)return $t;if($t.zOrder&&this._set$P("hasZorder",!0),$t._parent===this){var $H=this.getChildIndex($t);$H!==this._childs.length-1&&(this._childs.splice($H,1),this._childs.push($t),this.conchModel&&(this.conchModel.removeChild($t.conchModel),this.conchModel.addChildAt($t.conchModel,this._childs.length-1)),this._childChanged())}else $t.parent&&$t.parent.removeChild($t),this._childs===$A.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($t),this.conchModel&&this.conchModel.addChildAt($t.conchModel,this._childs.length-1),($t.parent=this)._childChanged(),this._addChild3D($t);return $t},$I.removeChildAt=function($t){var $H=this.getChildAt($t);return $H&&(this._removeChild3D($H),this._childs.splice($t,1),this.conchModel&&this.conchModel.removeChild($H.conchModel),$H.parent=null),$H},$I.removeChildren=function($t,$H){if(void 0===$t&&($t=0),void 0===$H&&($H=2147483647),this._childs&&0<this._childs.length){var $I=this._childs;if(0===$t&&$_<=$H){var $T=$I;this._childs=$A.ARRAY_EMPTY}else $T=$I.splice($t,$H-$t);for(var $K=0,$_=$T.length;$K<$_;$K++)this._removeChild3D($T[$K]),$T[$K].parent=null,this.conchModel&&this.conchModel.removeChild($T[$K].conchModel)}return this},$I.onAsynLoaded=function($t,$H,$I){var $T=$H[0];if("Sprite3D"!==$T.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $K=$H[1];$OH._createNodeByJson(this,$T,this,$K),this.event("hierarchyloaded",[this]),this.__loaded=!0},$I.cloneTo=function($t){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $H=$t;$H.name=this.name,$H._destroyed=this._destroyed,$H.timer=this.timer,$H._$P=this._$P,$H.active=this._active;var $I=$H.transform.localPosition;this.transform.localPosition.cloneTo($I),$H.transform.localPosition=$I;var $T=$H.transform.localRotation;this.transform.localRotation.cloneTo($T),$H.transform.localRotation=$T;var $K=$H.transform.localScale;this.transform.localScale.cloneTo($K),$H.transform.localScale=$K,$H.isStatic=this.isStatic;var $_=0,$V=0;for($_=0,$V=this._componentsMap.length;$_<$V;$_++){var $e=$H.addComponent(this._componentsMap[$_]);this._components[$_]._cloneTo($e)}for($_=0,$V=this._childs.length;$_<$V;$_++)$H.addChild(this._childs[$_].clone());var $R=$H.getComponentByType(Animator);if($R){var $A=$R._linkSpritesData;if($A)for(var $q in $A){for(var $f=$A[$q],$b=$H,$L=0,$G=$f.length;$L<$G&&($b=$b.getChildByName($f[$L]));$L++);if($b){var $M=$R._avatarNodeMap[$q];$b._isLinkSpriteToAnimationNode($R,$M,!0)}}}},$I.clone=function(){var $t=new this.constructor;return this.cloneTo($t),$t},$I.destroy=function($t){if(void 0===$t&&($t=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$t);var $H,$I=0;for($I=0,$H=this._components.length;$I<$H;$I++)this._components[$I]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$J.clearRes(this.url),this.loaded||$JH._cancelLoadByUrl(this.url)}},$I._handleSpriteToAvatar=function($t,$H){$t._avatarNodes;var $I=$t._avatarNodeMap[this.name];$I&&$I.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($t,$I,$H)},$I._setAnimatorToLinkAvatar=function($t,$H){this._handleSpriteToAvatar($t,$H);for(var $I=0,$T=this._childs.length;$I<$T;$I++){this._childs[$I]._setAnimatorToLinkAvatar($t,$H)}},$G(0,$I,"activeInHierarchy",function(){return this._activeInHierarchy}),$G(0,$I,"_loaded",null,function($t){this.__loaded=$t}),$G(0,$I,"active",function(){return this._active},function($t){this._active!==$t&&(this._active=$t,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($t?this._activeHierarchy():this._inActiveHierarchy()))}),$G(0,$I,"componentsCount",function(){return this._components.length}),$G(0,$I,"loaded",function(){return this.__loaded}),$G(0,$I,"id",function(){return this._id}),$G(0,$I,"url",function(){return this._url}),$G(0,$I,"layer",function(){return this._layer},function($t){if(this._layer!==$t){if(!$t)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $H=0,$I=this._colliders.length;if(this._layer)for($H=0;$H<$I;$H++)this._layer._removeCollider(this._colliders[$H]);for($H=0;$H<$I;$H++)$t._addCollider(this._colliders[$H])}this._layer=$t,this.event("layerchanged",$t)}}),$G(0,$I,"scene",function(){return this._scene}),$G(0,$I,"transform",function(){return this._transform}),$H.instantiate=function($t,$H,$I,$T,$K){void 0===$I&&($I=!0);var $_=$t.clone();$H&&$H.addChild($_);var $V=$_.transform;if($I){var $e=$V.worldMatrix;$t.transform.worldMatrix.cloneTo($e),$V.worldMatrix=$e}else $T&&($V.position=$T),$K&&($V.rotation=$K);return $_},$H.load=function($t){return $N.loader.create($t,null,null,$H)},$H.WORLDMATRIX=0,$H.MVPMATRIX=1,$H._uniqueIDCounter=0,$H._nameNumberCounter=0,$H}(),$vH=function($t){function $q($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$q.__super.call(this),!$t||!$H)throw"Shader Error";this._id=++$q._count,this._vs=$t,this._ps=$H,this._attributeMap=$I,this._sceneUniformMap=$T,this._cameraUniformMap=$K,this._spriteUniformMap=$_,this._materialUniformMap=$V,this._renderElementUniformMap=$e,this._precompile=$R,this._define=$A,this._precompile&&$q.extCompileObj&&$q.extCompileFunc?$q.extCompileFunc.call($q.extCompileObj,$t,$H,$A):this.recreateResource()}$L($q,"laya.d3.shader.Shader3D",$I);var $H=$q.prototype;return $H.recreateResource=function(){$D.now();this._compile(),this.completeCreate(),this.memorySize=0},$H.disposeResource=function(){$x.mainContext.deleteShader(this._vshader),$x.mainContext.deleteShader(this._pshader),$x.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$H._compile=function(){if(!$x.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $t=[this._vs,this._ps],$H=$x.mainContext;if(this._program=$H.createProgram(),this._vshader=$q._createShader($H,$t[0],35633),this._pshader=$q._createShader($H,$t[1],35632),$H.attachShader(this._program,this._vshader),$H.attachShader(this._program,this._pshader),$H.linkProgram(this._program),!$M.isConchApp&&$sH.debugMode&&!$H.getProgramParameter(this._program,35714))throw $H.getProgramInfoLog(this._program);var $I,$T=0,$K=0,$_=0;for($_=$M.isConchApp?$H.getProgramParameterEx(this._vs,this._ps,"",35721):$H.getProgramParameter(this._program,35721),$T=0;$T<$_;$T++){var $V=null;$I={vartype:"attribute",ivartype:0,attrib:$V=$M.isConchApp?$H.getActiveAttribEx(this._vs,this._ps,"",$T):$H.getActiveAttrib(this._program,$T),location:$H.getAttribLocation(this._program,$V.name),name:$V.name,type:$V.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($I)}var $e=0;for($e=$M.isConchApp?$H.getProgramParameterEx(this._vs,this._ps,"",35718):$H.getProgramParameter(this._program,35718),$T=0;$T<$e;$T++){var $R=null;$R=$M.isConchApp?$H.getActiveUniformEx(this._vs,this._ps,"",$T):$H.getActiveUniform(this._program,$T),0<($I={vartype:"uniform",ivartype:1,attrib:$V,location:$H.getUniformLocation(this._program,$R.name),name:$R.name,type:$R.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($I.name=$I.name.substr(0,$I.name.length-3),$I.isArray=!0,$I.location=$H.getUniformLocation(this._program,$I.name)),this._uniformParams.push($I)}for($T=0,$K=this._attributeParams.length;$T<$K;$T++)($I=this._attributeParams[$T]).indexOfParams=$T,$I.index=1,$I.value=[$I.location,null],$I.codename=$I.name,$I.name=null!=this._attributeMap[$I.codename]?this._attributeMap[$I.codename]:$I.codename,this._attributeParamsMap.push($I.name),this._attributeParamsMap.push($I),$I._this=this,$I.uploadedValue=[],$I.fun=this._attribute;for($T=0,$K=this._uniformParams.length;$T<$K;$T++)switch(($I=this._uniformParams[$T]).indexOfParams=$T,$I.index=1,$I.value=[$I.location,null],$I.codename=$I.name,null!=this._sceneUniformMap[$I.codename]?($I.name=this._sceneUniformMap[$I.codename],this._sceneUniformParamsMap.push($I.name),this._sceneUniformParamsMap.push($I)):null!=this._cameraUniformMap[$I.codename]?($I.name=this._cameraUniformMap[$I.codename],this._cameraUniformParamsMap.push($I.name),this._cameraUniformParamsMap.push($I)):null!=this._spriteUniformMap[$I.codename]?($I.name=this._spriteUniformMap[$I.codename],this._spriteUniformParamsMap.push($I.name),this._spriteUniformParamsMap.push($I)):null!=this._materialUniformMap[$I.codename]?($I.name=this._materialUniformMap[$I.codename],this._materialUniformParamsMap.push($I.name),this._materialUniformParamsMap.push($I)):null!=this._renderElementUniformMap[$I.codename]?($I.name=this._renderElementUniformMap[$I.codename],this._renderElementUniformParamsMap.push($I.name),this._renderElementUniformParamsMap.push($I)):console.log("Shader:can't find uinform name:"+$I.codename+" in shader file."),$I._this=this,$I.uploadedValue=[],$I.type){case 5124:$I.fun=$I.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$I.fun=$I.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$I.fun=$I.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$I.fun=$I.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$I.fun=$I.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$I.fun=this._uniform_sampler2D;break;case 35680:$I.fun=this._uniform_samplerCube;break;case 35676:$I.fun=this._uniformMatrix4fv;break;case 35670:$I.fun=this._uniform1i;break;case 35674:$I.fun=this._uinformMatrix2fv;break;case 35675:$I.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$H._attribute=function($t,$H){var $I=$x.mainContext,$T=$e._enableAtributes,$K=$t.location;return $T[$K]||$I.enableVertexAttribArray($K),$I.vertexAttribPointer($K,$H[0],$H[1],$H[2],$H[3],$H[4]),$T[$K]=$e._bindVertexBuffer,1},$H._uniform1f=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H?($x.mainContext.uniform1f($t.location,$I[0]=$H),1):0},$H._uniform1fv=function($t,$H){if($H.length<4){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($x.mainContext.uniform1fv($t.location,$H),$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3],1):0}return $x.mainContext.uniform1fv($t.location,$H),1},$H._uniform_vec2=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]?($x.mainContext.uniform2f($t.location,$I[0]=$H[0],$I[1]=$H[1]),1):0},$H._uniform_vec2v=function($t,$H){if($H.length<2){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($x.mainContext.uniform2fv($t.location,$H),$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3],1):0}return $x.mainContext.uniform2fv($t.location,$H),1},$H._uniform_vec3=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]?($x.mainContext.uniform3f($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2]),1):0},$H._uniform_vec3v=function($t,$H){return $x.mainContext.uniform3fv($t.location,$H),1},$H._uniform_vec4=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($x.mainContext.uniform4f($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3]),1):0},$H._uniform_vec4v=function($t,$H){return $x.mainContext.uniform4fv($t.location,$H),1},$H._uniformMatrix2fv=function($t,$H){return $x.mainContext.uniformMatrix2fv($t.location,!1,$H),1},$H._uniformMatrix3fv=function($t,$H){return $x.mainContext.uniformMatrix3fv($t.location,!1,$H),1},$H._uniformMatrix4fv=function($t,$H){return $x.mainContext.uniformMatrix4fv($t.location,!1,$H),1},$H._uinformMatrix2fv=function($t,$H){return $x.mainContext.uniformMatrix2fv($t.location,!1,$H),1},$H._uinformMatrix3fv=function($t,$H){return $x.mainContext.uniformMatrix3fv($t.location,!1,$H),1},$H._uniform1i=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H?($x.mainContext.uniform1i($t.location,$I[0]=$H),1):0},$H._uniform1iv=function($t,$H){return $x.mainContext.uniform1iv($t.location,$H),1},$H._uniform_ivec2=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]?($x.mainContext.uniform2i($t.location,$I[0]=$H[0],$I[1]=$H[1]),1):0},$H._uniform_ivec2v=function($t,$H){return $x.mainContext.uniform2iv($t.location,$H),1},$H._uniform_vec3i=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]?($x.mainContext.uniform3i($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2]),1):0},$H._uniform_vec3vi=function($t,$H){return $x.mainContext.uniform3iv($t.location,$H),1},$H._uniform_vec4i=function($t,$H){var $I=$t.uploadedValue;return $I[0]!==$H[0]||$I[1]!==$H[1]||$I[2]!==$H[2]||$I[3]!==$H[3]?($x.mainContext.uniform4i($t.location,$I[0]=$H[0],$I[1]=$H[1],$I[2]=$H[2],$I[3]=$H[3]),1):0},$H._uniform_vec4vi=function($t,$H){return $x.mainContext.uniform4iv($t.location,$H),1},$H._uniform_sampler2D=function($t,$H){var $I=$H.source||$H.defaulteTexture.source,$T=$x.mainContext,$K=$t.uploadedValue;if(null!=$K[0])return $T.activeTexture($q._TEXTURES[$K[0]]),$I&&$Y.bindTexture($T,3553,$I),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $K[0]=this._curActTexIndex,$T.uniform1i($t.location,this._curActTexIndex),$T.activeTexture($q._TEXTURES[this._curActTexIndex]),$I&&$Y.bindTexture($T,3553,$I),this._curActTexIndex++,1},$H._uniform_samplerCube=function($t,$H){var $I=$H.source||$H.defaulteTexture.source,$T=$x.mainContext,$K=$t.uploadedValue;if(null!=$K[0])return $T.activeTexture($q._TEXTURES[$K[0]]),$I?$Y.bindTexture($T,34067,$I):$Y.bindTexture($T,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $K[0]=this._curActTexIndex,$T.uniform1i($t.location,this._curActTexIndex),$T.activeTexture($q._TEXTURES[this._curActTexIndex]),$I?$Y.bindTexture($T,34067,$I):$Y.bindTexture($T,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$H._noSetValue=function($t){console.log("no....:"+$t.name)},$H.bind=function(){return $I.activeShader=this,($I.bindShader=this).activeResource(),$Y.UseProgram(this._program)},$H.uploadAttributes=function($t,$H){for(var $I,$T,$K=0,$_=0,$V=this._attributeParamsMap.length;$_<$V;$_+=2)$T=this._attributeParamsMap[$_+1],null!=($I=$t[this._attributeParamsMap[$_]])&&($H&&$H[$T.name]&&$H[$T.name].bind(),$K+=$T.fun.call(this,$T,$I));$s.shaderCall+=$K},$H.uploadAttributesX=function($t,$H){for(var $I,$T,$K=0,$_=0,$V=this._attributeParamsMap.length;$_<$V;$_+=2)$T=this._attributeParamsMap[$_+1],null!=($I=$t[this._attributeParamsMap[$_]])&&($H._bind(),$K+=$T.fun.call(this,$T,$I));$s.shaderCall+=$K},$H.uploadSceneUniforms=function($t){for(var $H,$I,$T=0,$K=0,$_=this._sceneUniformParamsMap.length;$K<$_;$K+=2)$I=this._sceneUniformParamsMap[$K+1],null!=($H=$t[this._sceneUniformParamsMap[$K]])&&($T+=$I.fun.call(this,$I,$H));$s.shaderCall+=$T},$H.uploadCameraUniforms=function($t){for(var $H,$I,$T=0,$K=0,$_=this._cameraUniformParamsMap.length;$K<$_;$K+=2)$I=this._cameraUniformParamsMap[$K+1],null!=($H=$t[this._cameraUniformParamsMap[$K]])&&($T+=$I.fun.call(this,$I,$H));$s.shaderCall+=$T},$H.uploadSpriteUniforms=function($t){for(var $H,$I,$T=0,$K=0,$_=this._spriteUniformParamsMap.length;$K<$_;$K+=2)$I=this._spriteUniformParamsMap[$K+1],null!=($H=$t[this._spriteUniformParamsMap[$K]])&&($T+=$I.fun.call(this,$I,$H));$s.shaderCall+=$T},$H.uploadMaterialUniforms=function($t){for(var $H,$I,$T=0,$K=0,$_=this._materialUniformParamsMap.length;$K<$_;$K+=2)$I=this._materialUniformParamsMap[$K+1],null!=($H=$t[this._materialUniformParamsMap[$K]])&&($T+=$I.fun.call(this,$I,$H));$s.shaderCall+=$T},$H.uploadRenderElementUniforms=function($t){for(var $H,$I,$T=0,$K=0,$_=this._renderElementUniformParamsMap.length;$K<$_;$K+=2)$I=this._renderElementUniformParamsMap[$K+1],null!=($H=$t[this._renderElementUniformParamsMap[$K]])&&($T+=$I.fun.call(this,$I,$H));$s.shaderCall+=$T},$q.create=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){return new $q($t,$H,$I,$T,$K,$_,$V,$e,$R,$A)},$q.addInclude=function($t,$H){$U.addInclude($t,$H)},$q._createShader=function($t,$H,$I){var $T=$t.createShader($I);if($t.shaderSource($T,$H),$t.compileShader($T),$sH.debugMode&&!$t.getShaderParameter($T,35713))throw $t.getShaderInfoLog($T);return $T},$q.PERIOD_RENDERELEMENT=0,$q.PERIOD_MATERIAL=1,$q.PERIOD_SPRITE=2,$q.PERIOD_CAMERA=3,$q.PERIOD_SCENE=4,$q._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$q._count=0,$q._preCompile=!1,$q.extCompileFunc=null,$q.extCompileObj=null,$f($q,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $z}]),$q}(),$yH=function($e){function $R(){this._transformUV=null,$R.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $VH(.6,.6,.6)),this._setColor(10,new $VH(1,1,1)),this._setColor(11,new $eH(1,1,1,8)),this._setColor(12,new $VH(1,1,1)),this._setColor(7,new $eH(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $eH(1,1,0,0)),this.renderMode=1}$L($R,"laya.d3.core.material.StandardMaterial",$e);var $t=$R.prototype;return $t.disableLight=function(){this._addDisablePublicShaderDefine($sH.SHADERDEFINE_POINTLIGHT|$sH.SHADERDEFINE_SPOTLIGHT|$sH.SHADERDEFINE_DIRECTIONLIGHT)},$t.disableFog=function(){this._addDisablePublicShaderDefine($sH.SHADERDEFINE_FOG)},$t.onAsynLoaded=function($t,$H,$I){var $T=$H[0];if($T.version)$e.prototype.onAsynLoaded.call(this,$t,$H,$I);else{var $K=$H[1],$_=$T.props;for(var $V in $_)this[$V]=$_[$V];$R._parseStandardMaterial($K,this,$T),this._endLoaded()}},$t.cloneTo=function($t){$e.prototype.cloneTo.call(this,$t);var $H=$t;this._transformUV&&($H._transformUV=this._transformUV.clone())},$G(0,$t,"ambientColor",function(){return this._getColor(9)},function($t){this._setColor(9,$t)}),$G(0,$t,"ambientTexture",function(){return this._getTexture(5)},function($t){$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$t)}),$G(0,$t,"renderMode",null,function($t){switch($t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($R.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($t)}),$G(0,$t,"reflectColor",function(){return this._getColor(12)},function($t){this._setColor(12,$t)}),$G(0,$t,"tilingOffset",function(){return this._getColor(15)},function($t){if($t){var $H=$t.elements;1!=$H[0]||1!=$H[1]||0!=$H[2]||0!=$H[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$t)}),$G(0,$t,"albedo",function(){return this._getColor(7)},function($t){this._setColor(7,$t)}),$G(0,$t,"diffuseColor",function(){return this._getColor(10)},function($t){this._setColor(10,$t)}),$G(0,$t,"albedoColor",function(){return this._getColor(7)},function($t){this._setColor(7,$t)}),$G(0,$t,"specularColor",function(){return this._getColor(11)},function($t){this._setColor(11,$t)}),$G(0,$t,"diffuseTexture",function(){return this._getTexture(1)},function($t){$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$t)}),$G(0,$t,"normalTexture",function(){return this._getTexture(2)},function($t){$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$t)}),$G(0,$t,"specularTexture",function(){return this._getTexture(3)},function($t){$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$t)}),$G(0,$t,"emissiveTexture",function(){return this._getTexture(4)},function($t){$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$t)}),$G(0,$t,"reflectTexture",function(){return this._getTexture(6)},function($t){$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$t)}),$G(0,$t,"transformUV",function(){return this._transformUV},function($t){this._transformUV=$t,this._setMatrix4x4(13,$t.matrix),$t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$t.matrix.elements,0)}),$R.__init__=function(){$R.SHADERDEFINE_DIFFUSEMAP=$R.shaderDefines.registerDefine("DIFFUSEMAP"),$R.SHADERDEFINE_NORMALMAP=$R.shaderDefines.registerDefine("NORMALMAP"),$R.SHADERDEFINE_SPECULARMAP=$R.shaderDefines.registerDefine("SPECULARMAP"),$R.SHADERDEFINE_EMISSIVEMAP=$R.shaderDefines.registerDefine("EMISSIVEMAP"),$R.SHADERDEFINE_AMBIENTMAP=$R.shaderDefines.registerDefine("AMBIENTMAP"),$R.SHADERDEFINE_REFLECTMAP=$R.shaderDefines.registerDefine("REFLECTMAP"),$R.SHADERDEFINE_UVTRANSFORM=$R.shaderDefines.registerDefine("UVTRANSFORM"),$R.SHADERDEFINE_TILINGOFFSET=$R.shaderDefines.registerDefine("TILINGOFFSET"),$R.SHADERDEFINE_ADDTIVEFOG=$R.shaderDefines.registerDefine("ADDTIVEFOG")},$R.load=function($t){return $N.loader.create($t,null,null,$R)},$R._parseStandardMaterial=function($t,$H,$I){var $T=$I.customProps,$K=$T.ambientColor;$H.ambientColor=new $VH($K[0],$K[1],$K[2]);var $_=$T.diffuseColor;$H.diffuseColor=new $VH($_[0],$_[1],$_[2]);var $V=$T.specularColor;$H.specularColor=new $eH($V[0],$V[1],$V[2],$V[3]);var $e=$T.reflectColor;$H.reflectColor=new $VH($e[0],$e[1],$e[2]);var $R=$T.albedoColor;$R&&($H.albedo=new $eH($R[0],$R[1],$R[2],$R[3]));var $A=$T.diffuseTexture.texture2D;$A&&($H.diffuseTexture=$J.getRes($t[$A]));var $q=$T.normalTexture.texture2D;$q&&($H.normalTexture=$J.getRes($t[$q]));var $f=$T.specularTexture.texture2D;$f&&($H.specularTexture=$J.getRes($t[$f]));var $b=$T.emissiveTexture.texture2D;$b&&($H.emissiveTexture=$J.getRes($t[$b]));var $L=$T.ambientTexture.texture2D;$L&&($H.ambientTexture=$J.getRes($t[$L]));var $G=$T.reflectTexture.texture2D;$G&&($H.reflectTexture=$J.getRes($t[$G]))},$R.RENDERMODE_OPAQUE=1,$R.RENDERMODE_OPAQUEDOUBLEFACE=2,$R.RENDERMODE_CUTOUT=3,$R.RENDERMODE_CUTOUTDOUBLEFACE=4,$R.RENDERMODE_TRANSPARENT=13,$R.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$R.RENDERMODE_ADDTIVE=15,$R.RENDERMODE_ADDTIVEDOUBLEFACE=16,$R.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$R.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$R.RENDERMODE_DEPTHREAD_ADDTIVE=7,$R.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$R.RENDERMODE_NONDEPTH_TRANSPARENT=9,$R.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$R.RENDERMODE_NONDEPTH_ADDTIVE=11,$R.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$R.SHADERDEFINE_DIFFUSEMAP=0,$R.SHADERDEFINE_NORMALMAP=0,$R.SHADERDEFINE_SPECULARMAP=0,$R.SHADERDEFINE_EMISSIVEMAP=0,$R.SHADERDEFINE_AMBIENTMAP=0,$R.SHADERDEFINE_REFLECTMAP=0,$R.SHADERDEFINE_UVTRANSFORM=0,$R.SHADERDEFINE_TILINGOFFSET=0,$R.SHADERDEFINE_ADDTIVEFOG=0,$R.DIFFUSETEXTURE=1,$R.NORMALTEXTURE=2,$R.SPECULARTEXTURE=3,$R.EMISSIVETEXTURE=4,$R.AMBIENTTEXTURE=5,$R.REFLECTTEXTURE=6,$R.ALBEDO=7,$R.UVANIAGE=8,$R.MATERIALAMBIENT=9,$R.MATERIALDIFFUSE=10,$R.MATERIALSPECULAR=11,$R.MATERIALREFLECT=12,$R.UVMATRIX=13,$R.UVAGE=14,$R.TILINGOFFSET=15,$f($R,["defaultMaterial",function(){var $t=new $R;return $t.lock=!0,this.defaultMaterial=$t},"shaderDefines",function(){return this.shaderDefines=new $qH($rH.shaderDefines)}]),$R}($rH),$EH=function($t){function $V($t,$H,$I,$T,$K){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$I&&($I=35044),void 0===$T&&($T=!1),$V.__super.call(this),this._indexType=$t,this._indexCount=$H,this._bufferUsage=$I,this._bufferType=34963,this._canRead=$T;var $_;if("ushort"==$t)this._indexTypeByteCount=2;else{if("ubyte"!=$t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$_=this._indexTypeByteCount*$H,this._byteLength=$_,this._bind(),$e._gl.bufferData(this._bufferType,$_,this._bufferUsage),this.uri=$K,$T?("ushort"==$t?this._buffer=new Uint16Array($H):"ubyte"==$t&&(this._buffer=new Uint8Array($H)),this.memorySize=2*$_):this.memorySize=$_}$L($V,"laya.d3.graphics.IndexBuffer3D",$t);var $H=$V.prototype;return $H.setData=function($t,$H,$I,$T){void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=4294967295);var $K=0;if("ushort"==this._indexType?($K=2,0===$I&&4294967295===$T||($t=new Uint16Array($t.buffer,$I*$K,$T))):"ubyte"==this._indexType&&($K=1,0===$I&&4294967295===$T||($t=new Uint8Array($t.buffer,$I*$K,$T))),this._bind(),$e._gl.bufferSubData(this._bufferType,$H*$K,$t),this._canRead)if(0!==$H||0!==$I||4294967295!==$T){var $_=this._buffer.length-$H;$_<$T&&($T=$_);for(var $V=0;$V<$T;$V++)this._buffer[$H+$V]=$t[$V]}else this._buffer=$t},$H.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$H.disposeResource=function(){$t.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$G(0,$H,"indexType",function(){return this._indexType}),$G(0,$H,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$G(0,$H,"indexCount",function(){return this._indexCount}),$G(0,$H,"canRead",function(){return this._canRead}),$V.INDEXTYPE_UBYTE="ubyte",$V.INDEXTYPE_USHORT="ushort",$V.create=function($t,$H,$I,$T,$K){return void 0===$I&&($I=35044),void 0===$T&&($T=!1),new $V($t,$H,$I,$T,$K)},$V}($e),$hH=function($_){function $V($t,$H,$I,$T,$K){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$T&&($T=!1),$V.__super.call(this),this._vertexDeclaration=$t,this._vertexCount=$H,this._bufferUsage=$I,this._bufferType=34962,this._canRead=$T,this.uri=$K,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$H,this._bind(),$e._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$T&&(this._buffer=new Float32Array(this._byteLength/4))}$L($V,"laya.d3.graphics.VertexBuffer3D",$_);var $t=$V.prototype;return $t.bindWithIndexBuffer=function($t){$t&&$t._bind(),this._bind()},$t.setData=function($t,$H,$I,$T){if(void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=4294967295),0===$I&&4294967295===$T||($t=new Float32Array($t.buffer,4*$I,$T)),this._bind(),$e._gl.bufferSubData(this._bufferType,4*$H,$t),this._canRead)if(0!==$H||0!==$I||4294967295!==$T){var $K=this._buffer.length-$H;$K<$T&&($T=$K);for(var $_=0;$_<$T;$_++)this._buffer[$H+$_]=$t[$_]}else this._buffer=$t},$t.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$t.disposeResource=function(){for(var $t=$x.mainContext,$H=this._vertexDeclaration.getVertexElements(),$I=$e._enableAtributes,$T=0,$K=$H.length;$T<$K;$T++)$I[$T]===this._glBuffer&&($t.disableVertexAttribArray($T),$I[$T]=null);$_.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$G(0,$t,"vertexDeclaration",function(){return this._vertexDeclaration}),$G(0,$t,"vertexCount",function(){return this._vertexCount}),$G(0,$t,"canRead",function(){return this._canRead}),$V.create=function($t,$H,$I,$T,$K){return void 0===$I&&($I=35044),void 0===$T&&($T=!1),new $V($t,$H,$I,$T,$K)},$V}($e),$XH=function($t){function $U(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$U.__super.call(this),this._type=3553}$L($U,"laya.d3.resource.DataTexture2D",$xH);var $H=$U.prototype;return $H.genDebugMipmaps=function(){var $t=[];return $t.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$t.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$t.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$t.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$t.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$t.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$t.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$t.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$t.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$t.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$t},$H._onTextureLoaded=function($t){},$H._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $t=$x.mainContext,$H=this._source=$t.createTexture(),$I=this._width,$T=this._height,$K=$Y.curBindTexTarget,$_=$Y.curBindTexValue,$V=!1;if($Y.bindTexture($t,this._type,$H),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $e=0;$t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $R=0;$R<this._mipmaps.length;$R++){if(this._mipmaps[$R].byteLength!=$A*$q*4)throw"mipmap size error  level:"+$R;$t.texSubImage2D(this._type,0,$U.simLodRect[$e++],$U.simLodRect[$e++],$U.simLodRect[$e++],$U.simLodRect[$e++],6408,5121,new Uint8Array(this._mipmaps[$R]))}this.minFifter=9729,this.magFifter=9729}else{var $A=this._width,$q=this._height;for($e=0,$t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$R=0;$R<this._mipmaps.length;$R++){if(this._mipmaps[$R].byteLength!=$A*$q*4)throw"mipmap size error  level:"+$R;$t.texImage2D(this._type,$R,6408,$A,$q,0,6408,5121,new Uint8Array(this._mipmaps[$R])),($A/=2)<1&&($A=1),($q/=2)<1&&($q=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$t.pixelStorei($t.UNPACK_ALIGNMENT,1),$t.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $f=0,$b=!1,$L=!1;this._buffer.byteLength==4*$I*$T?($f=6408,$b=!0):this._buffer.byteLength==3*$I*$T?($f=6407,$L=!0):$f=this._format,$b||$L?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$L&&$t.pixelStorei($t.UNPACK_ALIGNMENT,1),$t.texImage2D(this._type,0,$f,$I,$T,0,$f,5121,this._buffer)):$t&&$f==$t.ALPHA?($t.texImage2D(3553,0,$f,$I,$T,0,$f,$t.UNSIGNED_BYTE,this._buffer),$V=!0):0!=$f&&($t.compressedTexImage2D(3553,0,$f,$I,$T,0,this._buffer),$V=!0)}var $G=this._minFifter,$M=this._magFifter,$O=0==this._wrapModeU?10497:33071,$J=0==this._wrapModeV?10497:33071,$S=$C.isPOT($I,$T);$S?(this._mipmap||this._mipmaps?-1!==$G||($G=9987):-1!==$G||($G=9729),-1!==$M||($M=9729),$t.texParameteri(this._type,10241,$G),$t.texParameteri(this._type,10240,$M),$t.texParameteri(this._type,10242,$O),$t.texParameteri(this._type,10243,$J),this._mipmap&&$t.generateMipmap(this._type)):(-1!==$G||($G=9729),-1!==$M||($M=9729),$t.texParameteri(this._type,10241,$G),$t.texParameteri(this._type,10240,$M),$t.texParameteri(this._type,10242,33071),$t.texParameteri(this._type,10243,33071)),$K&&$_&&$Y.bindTexture($t,$K,$_),this.memorySize=$V?this._buffer.length:$S?$I*$T*4*(1+1/3):$I*$T*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$H.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$H.onAsynLoaded=function($t,$H,$I){var $T;$I&&($T=$I[0].call(this,$H)),$T&&(this._width=$T.width,this._height=$T.height,this._buffer=$T.data),this._src=$t,this._size=new $MH(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$H.getPixels=function(){return new Uint8Array(this._buffer)},$H.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($x.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$G(0,$H,"src",function(){return this._src}),$U.create=function($t,$H,$I,$T,$K,$_,$V){if(void 0===$T&&($T=9729),void 0===$K&&($K=9729),void 0===$_&&($_=!0),!$t||$t.byteLength<$H*$I*4)throw"DataTexture2D create error";var $e=new $U;return $e.uri=$V,$e._buffer=$t,$e._width=$H,$e._height=$I,$e._mipmap=$_,$e._magFifter=$T,$e._minFifter=$K,$e._size=new $MH($e._width,$e._height),$e._conchTexture?alert("怎么给runtime传递datatexture数据"):$e.activeResource(),$e},$U.load=function($t,$H,$I,$T,$K){if(void 0===$H&&($H=0),void 0===$I&&($I=0),void 0===$T&&($T=9729),void 0===$K&&($K=9729),"mipmaps"===$P.getFileExtension($t)){var $_=$N.loader.create($t,null,null,$U,[function($t){this._mipmaps=[];var $H=new Uint32Array($t);this._width=$H[0];var $I=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$I=1024),this._width!=$I)throw"现在只支持512x256的环境贴图。当前的是"+$H[0];this._height=$H[1];for(var $T=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$K=this._height,$_=8;;){var $V=$T*$K*4;if($_+$V>$t.byteLength)throw"load mipmaps data size error ";var $e=new Uint8Array($t,$_,$V);if(this._mipmaps.push($e),$_+=$V,1==$T&&1==$K)break;($T/=2)<1&&($T=1),($K/=2)<1&&($K=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$_.simLodInfo=new Float32Array(40);for(var $V=0;$V<$_.simLodInfo.length;)$_.simLodInfo[$V]=($U.simLodRect[$V]+.5)/1024,$V++,$_.simLodInfo[$V]=($U.simLodRect[$V]+.5)/256,$V++,$_.simLodInfo[$V]=Math.max($U.simLodRect[$V]-1,.1)/1024,$V++,$_.simLodInfo[$V]=Math.max($U.simLodRect[$V]-1.5,.1)/256,$V++}return $_}if("number"==typeof $H)return $N.loader.create($t,null,null,$U,[function($t){return this._width=$H,this._height=$I,this._buffer=$t,null}]);if("function"==typeof $H)return $N.loader.create($t,null,null,$U,[$H]);throw new Error("unknown params.")},$U.lodasatlas=!1,$f($U,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$U}(),$BH=function($t){function $H(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$H.__super.call(this)}$L($H,"laya.d3.resource.models.PrimitiveMesh",$YH);var $I=$H.prototype;return $N.imps($I,{"laya.d3.core.render.IRenderable":!0}),$I._getVertexBuffer=function($t){return void 0===$t&&($t=0),0===$t?this._vertexBuffer:null},$I._getVertexBuffers=function(){return null},$I._getIndexBuffer=function(){return this._indexBuffer},$I._getPositions=function(){var $t,$H=[],$I=this._vertexBuffer.vertexDeclaration.getVertexElements(),$T=0;for($T=0;$T<$I.length;$T++){var $K=$I[$T];if("vector3"===$K.elementFormat&&0===$K.elementUsage){$t=$K;break}}var $_=this._vertexBuffer.getData();for($T=0;$T<$_.length;$T+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $V=$T+$t.offset/4,$e=new $VH($_[$V+0],$_[$V+1],$_[$V+2]);$H.push($e)}return $H},$I.getRenderElement=function($t){return this},$I.getRenderElementsCount=function(){return 1},$I.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$I._beforeRender=function($t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$I._render=function($t){$x.mainContext.drawElements(4,this._numberIndices,5123,0),$s.drawCall++,$s.trianglesFaces+=this._numberIndices/3},$G(0,$I,"_vertexBufferCount",function(){return 1}),$G(0,$I,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$H}(),$aH=function($t){function $H(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$H.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$L($H,"laya.d3.resource.models.Mesh",$YH);var $I=$H.prototype;return $I._getPositions=function(){var $t,$H,$I,$T,$K,$_=[],$V=0,$e=0,$R=0;if(0!==this._vertexBuffers.length){var $A=this._vertexBuffers.length;for($V=0;$V<$A;$V++){for($I=($t=this._vertexBuffers[$V]).vertexDeclaration.getVertexElements(),$e=0;$e<$I.length;$e++)if("vector3"===($T=$I[$e]).elementFormat&&0===$T.elementUsage){$H=$T;break}for($K=$t.getData(),$e=0;$e<$K.length;$e+=$t.vertexDeclaration.vertexStride/4)$R=$e+$H.offset/4,$_.push(new $VH($K[$R+0],$K[$R+1],$K[$R+2]))}}else{var $q=this._subMeshes.length;for($V=0;$V<$q;$V++){for($I=($t=this._subMeshes[$V]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$e=0;$e<$I.length;$e++)if("vector3"===($T=$I[$e]).elementFormat&&0===$T.elementUsage){$H=$T;break}for($K=$t.getData(),$e=0;$e<$K.length;$e+=$t.vertexDeclaration.vertexStride/4)$R=$e+$H.offset/4,$_.push(new $VH($K[$R+0],$K[$R+1],$K[$R+2]))}}return $_},$I._setSubMeshes=function($t){this._subMeshes=$t,this._subMeshCount=$t.length;for(var $H=0;$H<this._subMeshCount;$H++)$t[$H]._indexInMesh=$H;this._positions=this._getPositions(),this._generateBoundingObject()},$I.onAsynLoaded=function($t,$H,$I){var $T=$H[0],$K=$H[1];$Ft.read($T,this,this._materials,this._subMeshes,$K),this.completeCreate(),this._endLoaded()},$I.getSubMesh=function($t){return this._subMeshes[$t]},$I.getSubMeshCount=function(){return this._subMeshes.length},$I.getRenderElementsCount=function(){return this._subMeshes.length},$I.getRenderElement=function($t){return this._subMeshes[$t]},$I.disposeResource=function(){for(var $t=0;$t<this._subMeshes.length;$t++)this._subMeshes[$t].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$G(0,$I,"materials",function(){return this._materials.slice()}),$G(0,$I,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$H.load=function($t){return $N.loader.create($t,null,null,$H)},$H}(),$uH=(function($t){function $A($t,$H,$I,$T,$K,$_,$V,$e,$R){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$I&&($I=6408),void 0===$T&&($T=5121),void 0===$K&&($K=33189),void 0===$_&&($_=!1),void 0===$V&&($V=!1),void 0===$e&&($e=-1),void 0===$R&&($R=-1),$A.__super.call(this),this._type=3553,this._width=$t,this._height=$H,this._size=new $MH($t,$H),this._surfaceFormat=$I,this._surfaceType=$T,this._depthStencilFormat=$K,$M.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$_,this._repeat=$V,this._minFifter=$e,this._magFifter=$R,this.activeResource(),this._alreadyResolved=!0}$L($A,"laya.d3.resource.RenderTexture",$xH);var $H=$A.prototype;$H.recreateResource=function(){var $t=$x.mainContext;this._frameBuffer=$t.createFramebuffer(),this._source=$t.createTexture();var $H=$Y.curBindTexTarget,$I=$Y.curBindTexValue;$Y.bindTexture($t,this._type,this._source),$t.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $T=this._minFifter,$K=this._magFifter,$_=this._repeat?10497:33071;if($C.isPOT(this._width,this._height)?(this._mipmap?-1!==$T||($T=9987):-1!==$T||($T=9729),-1!==$K||($K=9729),$t.texParameteri(this._type,10241,$T),$t.texParameteri(this._type,10240,$K),$t.texParameteri(this._type,10242,$_),$t.texParameteri(this._type,10243,$_),this._mipmap&&$t.generateMipmap(this._type)):(-1!==$T||($T=9729),-1!==$K||($K=9729),$t.texParameteri(this._type,10241,$T),$t.texParameteri(this._type,10240,$K),$t.texParameteri(this._type,10242,33071),$t.texParameteri(this._type,10243,33071)),$H&&$I&&$Y.bindTexture($t,$H,$I),$t.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$t.createRenderbuffer(),$t.bindRenderbuffer(36161,this._depthStencilBuffer),$t.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$t.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$t.framebufferTexture2D(36160,36064,3553,this._source,0),$t.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$H.start=function(){$x.mainContext.bindFramebuffer(36160,this.frameBuffer),($A._currentRenderTarget=this)._alreadyResolved=!1},$H.end=function(){$x.mainContext.bindFramebuffer(36160,null),$A._currentRenderTarget=null,this._alreadyResolved=!0},$H.getData=function($t,$H,$I,$T){var $K=$x.mainContext;if($K.bindFramebuffer(36160,this._frameBuffer),!(36053===$K.checkFramebufferStatus(36160)))return $K.bindFramebuffer(36160,null),null;var $_=new Uint8Array(this._width*this._height*4);return $K.readPixels($t,$H,$I,$T,this._surfaceFormat,this._surfaceType,$_),$K.bindFramebuffer(36160,null),$_},$H.disposeResource=function(){if(this._frameBuffer){var $t=$x.mainContext;$t.deleteTexture(this._source),$t.deleteFramebuffer(this._frameBuffer),$t.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$G(0,$H,"surfaceFormat",function(){return this._surfaceFormat}),$G(0,$H,"surfaceType",function(){return this._surfaceType}),$G(0,$H,"depthStencilFormat",function(){return this._depthStencilFormat}),$G(0,$H,"source",function(){return this._alreadyResolved?$N.superGet($xH,this,"source"):null}),$G(0,$H,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$G(0,$H,"frameBuffer",function(){return this._frameBuffer}),$A._currentRenderTarget=null}(),function($t){function $H($t){this._color=null,this._pixels=null,$H.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $MH(this.width,this.height),this._color=$t,this._pixels=new Uint8Array([255*$t.x,255*$t.y,255*$t.z,255*$t.w]),this.uri="SolidColorTexture2D_"+this.id}$L($H,"laya.d3.resource.SolidColorTexture2D",$xH);var $I=$H.prototype;return $I._createWebGlTexture=function(){var $t=$x.mainContext,$H=this._source=$t.createTexture(),$I=this._width,$T=this._height,$K=$Y.curBindTexTarget,$_=$Y.curBindTexValue;$Y.bindTexture($t,this._type,$H),$t.texImage2D(this._type,0,6408,$I,$T,0,6408,5121,this._pixels);var $V=this._minFifter,$e=this._magFifter,$R=this._repeat?10497:33071,$A=$C.isPOT($I,$T);$A?(this._mipmap?-1!==$V||($V=9987):-1!==$V||($V=9729),-1!==$e||($e=9729),$t.texParameteri(this._type,10241,$V),$t.texParameteri(this._type,10240,$e),$t.texParameteri(this._type,10242,$R),$t.texParameteri(this._type,10243,$R),this._mipmap&&$t.generateMipmap(this._type)):(-1!==$V||($V=9729),-1!==$e||($e=9729),$t.texParameteri(this._type,10241,$V),$t.texParameteri(this._type,10240,$e),$t.texParameteri(this._type,10242,33071),$t.texParameteri(this._type,10243,33071)),$K&&$_&&$Y.bindTexture($t,$K,$_),this.memorySize=$A?$I*$T*4*(1+1/3):$I*$T*4},$I.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$I.disposeResource=function(){this._source&&($x.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$f($H,["magentaTexture",function(){var $t=new $H(new $eH(1,0,1,1));return $t.lock=!0,this.magentaTexture=$t},"grayTexture",function(){var $t=new $H(new $eH(.5,.5,.5,1));return $t.lock=!0,this.grayTexture=$t}]),$H}()),$$H=function($t){function $K($t,$H,$I,$T){this._canRead=!1,this._image=null,this._pixels=null,void 0===$t&&($t=!1),void 0===$H&&($H=!0),void 0===$I&&($I=6408),void 0===$T&&($T=!0),$K.__super.call(this),this._type=3553,this._repeat=$H,this._canRead=$t,this._format=$I,this._mipmap=$T}$L($K,"laya.d3.resource.Texture2D",$xH);var $H=$K.prototype;return $H._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $t=$x.mainContext,$H=this._source=$t.createTexture(),$I=this._width,$T=this._height,$K=$Y.curBindTexTarget,$_=$Y.curBindTexValue;switch($Y.bindTexture($t,this._type,$H),this._format){case 6407:case 6408:this._canRead?$t.texImage2D(this._type,0,this._format,$I,$T,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$t.texImage2D(this._type,0,this._image._format,$I,$T,0,this._image._format,5121,this._image.atlasSource):$t.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $x.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$t.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $V=this._minFifter,$e=this._magFifter,$R=this._repeat?10497:33071,$A=0==this._wrapModeU?10497:33071,$q=0==this._wrapModeV?10497:33071,$f=$C.isPOT($I,$T);$f?(this._mipmap?-1!==$V||($V=9987):-1!==$V||($V=9729),-1!==$e||($e=9729),$t.texParameteri(this._type,10241,$V),$t.texParameteri(this._type,10240,$e),$t.texParameteri(this._type,10242,$R),$t.texParameteri(this._type,10243,$R),$t.texParameteri(this._type,10242,$A),$t.texParameteri(this._type,10243,$q),this._mipmap&&$t.generateMipmap(this._type)):(-1!==$V||($V=9729),-1!==$e||($e=9729),$t.texParameteri(this._type,10241,$V),$t.texParameteri(this._type,10240,$e),$t.texParameteri(this._type,10242,33071),$t.texParameteri(this._type,10243,33071)),$K&&$_&&$Y.bindTexture($t,$K,$_),this._image.onload=null,this._image=null,this.memorySize=$f?$I*$T*4*(1+1/3):$I*$T*4},$H.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$H.onAsynLoaded=function($t,$H,$I){if($I){var $T=$I[0];void 0!==$T&&(this._canRead=$T);var $K=$I[1];void 0!==$K&&(this._repeat=$K);var $_=$I[2];void 0!==$_&&(this._format=$_);var $V=$I[3];void 0!==$V&&(this._mipmap=$V);var $e=$I.wrapModeU;void 0!==$e&&(this._wrapModeU=$e);var $R=$I.wrapModeV;void 0!==$R&&(this._wrapModeV=$R)}switch(this._format){case 6407:case 6408:var $A=(this._image=$H).width,$q=$H.height;this._width=$A,this._height=$q,this._size=new $MH($A,$q),this._canRead&&($M.isConchApp?$H instanceof $b.HTMLElement&&(this._pixels=new Uint8Array($H.getImageData(0,0,$A,$q))):($D.canvas.size($A,$q),$D.canvas.clear(),$D.context.drawImage($H,0,0,$A,$q),this._pixels=new Uint8Array($D.context.getImageData(0,0,$A,$q).data.buffer)));break;case $x.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $f=new $w($H);$f.readUTFBytes(4),$f.readUTFBytes(2),$f.getInt16();$f.endian="bigEndian",this._width=$f.getInt16(),this._height=$f.getInt16(),this._size=new $MH(this._width,this._height);$f.getInt16(),$f.getInt16();this._image=new Uint8Array($H,$f.pos)}this.recreateResource(),this._endLoaded()},$H.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$H.disposeResource=function(){this._source&&($x.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$G(0,$H,"_src",function(){return this.url}),$G(0,$H,"src",function(){return this.url}),$K.load=function($t){return $N.loader.create($t,null,null,$K)},$K}(),$QH=function($H){function $I($t,$H){$I.__super.call(this),void 0===$t&&($t=.3),void 0===$H&&($H=1e3),this._tempVector3=new $VH,this._position=new $VH,this._up=new $VH,this._forward=new $VH,this._right=new $VH,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$MH.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$t,this._farPlane=$H,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$N.stage.on("resize",this,this._onScreenSizeChanged)}$L($I,"laya.d3.core.BaseCamera",$H);var $t=$I.prototype;return $t._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $t=this.scene._cameraPool,$H=$t.length-1,$I=0;$I<$H;$I++)if($t[$I].renderingOrder>$t[$H].renderingOrder){var $T=$t[$I];$t[$I]=$t[$H],$t[$H]=$T}},$t._calculateProjectionMatrix=function(){},$t._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$t._prepareCameraToRender=function(){$p._currentCameraCullingMask=this.cullingMask;var $t=this._shaderValues;$t.setValue(0,this.transform.position.elements),$t.setValue(5,this.forward.elements),$t.setValue(6,this.up.elements)},$t._prepareCameraViewProject=function($t,$H){var $I=this._shaderValues;$I.setValue(1,$t.elements),$I.setValue(2,$H.elements)},$t._renderCamera=function($t,$H,$I){},$t.addLayer=function($t){29!==$t.number&&30!=$t.number&&(this.cullingMask=this.cullingMask|$t.mask)},$t.removeLayer=function($t){29!==$t.number&&30!=$t.number&&(this.cullingMask=this.cullingMask&~$t.mask)},$t.addAllLayers=function(){this.cullingMask=2147483647},$t.removeAllLayers=function(){this.cullingMask=0|$p.getLayerByNumber(29).mask|$p.getLayerByNumber(30).mask},$t.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$t.moveForward=function($t){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$t,this.transform.translate(this._tempVector3)},$t.moveRight=function($t){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$t,this.transform.translate(this._tempVector3)},$t.moveVertical=function($t){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$t,this.transform.translate(this._tempVector3,!1)},$t._addSelfRenderObjects=function(){var $t=this.scene._cameraPool,$H=$t.length;if(0<$H){for(var $I=$H-1;0<=$I;$I--)if(this.renderingOrder<=$t[$I].renderingOrder){$t.splice($I+1,0,this);break}}else $t.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$t._clearSelfRenderObjects=function(){var $t=this.scene._cameraPool;$t.splice($t.indexOf(this),1)},$t.destroy=function($t){void 0===$t&&($t=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$N.stage.off("resize",this,this._onScreenSizeChanged),$H.prototype.destroy.call(this,$t)},$G(0,$t,"sky",function(){return this._sky},function($t){(this._sky=$t)._ownerCamera=this}),$G(0,$t,"forward",function(){var $t=this.transform.worldMatrix.elements,$H=this._forward.elements;return $H[0]=-$t[8],$H[1]=-$t[9],$H[2]=-$t[10],this._forward}),$G(0,$t,"position",function(){var $t=this.transform.worldMatrix.elements,$H=this._position.elements;return $H[0]=$t[12],$H[1]=$t[13],$H[2]=$t[14],this._position}),$G(0,$t,"renderTarget",function(){return this._renderTarget},function($t){null!=(this._renderTarget=$t)&&(this._renderTargetSize=$t.size)}),$G(0,$t,"up",function(){var $t=this.transform.worldMatrix.elements,$H=this._up.elements;return $H[0]=$t[4],$H[1]=$t[5],$H[2]=$t[6],this._up}),$G(0,$t,"right",function(){var $t=this.transform.worldMatrix.elements,$H=this._right.elements;return $H[0]=$t[0],$H[1]=$t[1],$H[2]=$t[2],this._right}),$G(0,$t,"renderTargetSize",function(){return this._renderTargetSize},function($t){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$t,this._calculateProjectionMatrix()}),$G(0,$t,"fieldOfView",function(){return this._fieldOfView},function($t){this._fieldOfView=$t,this._calculateProjectionMatrix()}),$G(0,$t,"nearPlane",function(){return this._nearPlane},function($t){this._nearPlane=$t,this._calculateProjectionMatrix()}),$G(0,$t,"farPlane",function(){return this._farPlane},function($t){this._farPlane=$t,this._calculateProjectionMatrix()}),$G(0,$t,"orthographic",function(){return this._orthographic},function($t){this._orthographic=$t,this._calculateProjectionMatrix()}),$G(0,$t,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($t){this._orthographicVerticalSize=$t,this._calculateProjectionMatrix()}),$G(0,$t,"renderingOrder",function(){return this._renderingOrder},function($t){this._renderingOrder=$t,this._sortCamerasByRenderingOrder()}),$I.CAMERAPOS=0,$I.VIEWMATRIX=1,$I.PROJECTMATRIX=2,$I.VPMATRIX=3,$I.VPMATRIX_NO_TRANSLATE=4,$I.CAMERADIRECTION=5,$I.CAMERAUP=6,$I.ENVIRONMENTDIFFUSE=7,$I.ENVIRONMENTSPECULAR=8,$I.SIMLODINFO=9,$I.DIFFUSEIRRADMATR=10,$I.DIFFUSEIRRADMATG=11,$I.DIFFUSEIRRADMATB=12,$I.HDREXPOSURE=13,$I.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$I.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$I.CLEARFLAG_SOLIDCOLOR=0,$I.CLEARFLAG_SKY=1,$I.CLEARFLAG_DEPTHONLY=2,$I.CLEARFLAG_NONE=3,$f($I,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $tH(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $tH},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $tH}]),$I}($lH),$mH=function($I){function $H($t){this._render=null,this._geometryFilter=null,$H.__super.call(this,$t)}$L($H,"laya.d3.core.RenderableSprite3D",$I);var $t=$H.prototype;return $t._addToInitStaticBatchManager=function(){},$t._setBelongScene=function($t){$I.prototype._setBelongScene.call(this,$t),$t._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$t._setUnBelongScene=function(){var $t=this._scene._renderableSprite3Ds,$H=$t.indexOf(this);$t.splice($H,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$I.prototype._setUnBelongScene.call(this)},$t._update=function($t){($t.owner=this)._activeInHierarchy&&(this._updateComponents($t),this._render._updateOctreeNode(),this._lateUpdateComponents($t),$s.spriteCount++,this._childs.length&&this._updateChilds($t))},$t.destroy=function($t){void 0===$t&&($t=!0),$I.prototype.destroy.call(this,$t),this._render._destroy(),this._render=null},$H.__init__=function(){$H.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$H.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$H.SAHDERDEFINE_LIGHTMAP=$H.shaderDefines.registerDefine("LIGHTMAP")},$H.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$H.SAHDERDEFINE_LIGHTMAP=4,$H.LIGHTMAPSCALEOFFSET=2,$H.LIGHTMAP=3,$f($H,["shaderDefines",function(){return this.shaderDefines=new $qH}]),$H}($lH),$oH=(function($t){function $T($t,$H,$I){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$t&&($t=1),void 0===$H&&($H=1),void 0===$I&&($I=1),$T.__super.call(this),this._long=$t,this._width=$H,this._height=$I,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$L($T,"laya.d3.resource.models.BoxMesh",$BH);var $H=$T.prototype;$H.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $t=$xt.vertexDeclaration,$H=($t.vertexStride,this._long/2),$I=this._height/2,$T=this._width/2,$K=new Float32Array([-$H,$I,-$T,0,1,0,0,0,$H,$I,-$T,0,1,0,1,0,$H,$I,$T,0,1,0,1,1,-$H,$I,$T,0,1,0,0,1,-$H,-$I,-$T,0,-1,0,0,1,$H,-$I,-$T,0,-1,0,1,1,$H,-$I,$T,0,-1,0,1,0,-$H,-$I,$T,0,-1,0,0,0,-$H,$I,-$T,-1,0,0,0,0,-$H,$I,$T,-1,0,0,1,0,-$H,-$I,$T,-1,0,0,1,1,-$H,-$I,-$T,-1,0,0,0,1,$H,$I,-$T,1,0,0,1,0,$H,$I,$T,1,0,0,0,0,$H,-$I,$T,1,0,0,0,1,$H,-$I,-$T,1,0,0,1,1,-$H,$I,$T,0,0,1,0,0,$H,$I,$T,0,0,1,1,0,$H,-$I,$T,0,0,1,1,1,-$H,-$I,$T,0,0,1,0,1,-$H,$I,-$T,0,0,-1,1,0,$H,$I,-$T,0,0,-1,0,0,$H,-$I,-$T,0,0,-1,0,1,-$H,-$I,-$T,0,0,-1,1,1]),$_=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $hH($t,this._numberVertices,35044,!0),this._indexBuffer=new $EH("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($K),this._indexBuffer.setData($_),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$G(0,$H,"long",function(){return this._long},function($t){this._long!==$t&&(this._long=$t,this.releaseResource(),this.activeResource())}),$G(0,$H,"width",function(){return this._width},function($t){this._width!==$t&&(this._width=$t,this.releaseResource(),this.activeResource())}),$G(0,$H,"height",function(){return this._height},function($t){this._height!==$t&&(this._height=$t,this.releaseResource(),this.activeResource())})}(),function($t){function $K($t,$H,$I,$T){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$t&&($t=10),void 0===$H&&($H=10),void 0===$I&&($I=10),void 0===$T&&($T=10),$K.__super.call(this),this._long=$t,this._width=$H,this._stacks=$I,this._slices=$T,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$L($K,"laya.d3.resource.models.PlaneMesh",$BH);var $H=$K.prototype;$H.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $t=new Uint16Array(this._numberIndices),$H=$xt.vertexDeclaration,$I=$H.vertexStride/4,$T=new Float32Array(this._numberVertices*$I),$K=this._long/2,$_=this._width/2,$V=this._long/this._stacks,$e=this._width/this._slices,$R=0,$A=0;$A<=this._slices;$A++)for(var $q=0;$q<=this._stacks;$q++)$T[$R++]=$q*$V-$K,$T[$R++]=0,$T[$R++]=$A*$e-$_,$T[$R++]=0,$T[$R++]=1,$T[$R++]=0,$T[$R++]=1*$q/this._stacks,$T[$R++]=1*$A/this._slices;var $f=0;for($A=0;$A<this._slices;$A++)for($q=0;$q<this._stacks;$q++)$t[$f++]=($A+1)*(this._stacks+1)+$q,$t[$f++]=$A*(this._stacks+1)+$q,$t[$f++]=($A+1)*(this._stacks+1)+$q+1,$t[$f++]=$A*(this._stacks+1)+$q,$t[$f++]=$A*(this._stacks+1)+$q+1,$t[$f++]=($A+1)*(this._stacks+1)+$q+1;this._vertexBuffer=new $hH($H,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $EH("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($T),this._indexBuffer.setData($t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$G(0,$H,"long",function(){return this._long},function($t){this._long!==$t&&(this._long=$t,this.releaseResource(),this.activeResource())}),$G(0,$H,"width",function(){return this._width},function($t){this._width!==$t&&(this._width=$t,this.releaseResource(),this.activeResource())}),$G(0,$H,"stacks",function(){return this._stacks},function($t){this._stacks!==$t&&(this._stacks=$t,this.releaseResource(),this.activeResource())}),$G(0,$H,"slices",function(){return this._slices},function($t){this._slices!==$t&&(this._slices=$t,this.releaseResource(),this.activeResource())})}(),function($t){function $V($t,$H,$I){void 0===$t&&($t=0),void 0===$H&&($H=.3),void 0===$I&&($I=1e3),this._viewMatrix=new $tH,this._projectionMatrix=new $tH,this._projectionViewMatrix=new $tH,this._viewport=new $RH(0,0,0,0),this._normalizedViewport=new $RH(0,0,1,1),this._aspectRatio=$t,this._boundFrustumUpdate=!0,this._boundFrustum=new $it($tH.DEFAULT),$V.__super.call(this,$H,$I),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$L($V,"laya.d3.core.Camera",$QH);var $H=$V.prototype;return $H._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$H._parseCustomProps=function($t,$H,$I,$T){var $K=$I.clearColor;this.clearColor=new $eH($K[0],$K[1],$K[2],$K[3]);var $_=$I.viewport;this.normalizedViewport=new $RH($_[0],$_[1],$_[2],$_[3])},$H._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $t=this.orthographicVerticalSize*this.aspectRatio*.5,$H=.5*this.orthographicVerticalSize;$tH.createOrthoOffCenterRH(-$t,$t,-$H,$H,this.nearPlane,this.farPlane,this._projectionMatrix)}else $tH.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$H._update=function($t){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$t)},$H._renderCamera=function($t,$H,$I){var $T,$K;$I.parallelSplitShadowMaps[0]&&$I._renderShadowMap($t,$H,this),($H.camera=this)._prepareCameraToRender(),$I._preRenderUpdateComponents($H),$T=$H._viewMatrix=this.viewMatrix;var $_=this._renderTarget;$_?($_.start(),$tH.multiply($QH._invertYScaleMatrix,this._projectionMatrix,$QH._invertYProjectionMatrix),$tH.multiply($QH._invertYScaleMatrix,this.projectionViewMatrix,$QH._invertYProjectionViewMatrix),$K=$H._projectionMatrix=$QH._invertYProjectionMatrix,$H._projectionViewMatrix=$QH._invertYProjectionViewMatrix):($K=$H._projectionMatrix=this._projectionMatrix,$H._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($T,$K),$H._viewport=this.viewport,$I._preRenderScene($t,$H,this.boundFrustum),$I._clear($t,$H),$I._renderScene($t,$H),$I._postRenderUpdateComponents($H),$_&&$_.end()},$H.viewportPointToRay=function($t,$H){$GH.calculateCursorRay($t,this.viewport,this._projectionMatrix,this.viewMatrix,null,$H)},$H.normalizedViewportPointToRay=function($t,$H){var $I=$V._tempVector20,$T=this.viewport,$K=$t.elements,$_=$I.elements;$_[0]=$K[0]*$T.width,$_[1]=$K[1]*$T.height,$GH.calculateCursorRay($I,this.viewport,this._projectionMatrix,this.viewMatrix,null,$H)},$H.worldToViewportPoint=function($t,$H){$tH.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($t,this._projectionViewMatrix,$H);var $I=$H.elements;$I[0]=$I[0]/$N.stage.clientScaleX,$I[1]=$I[1]/$N.stage.clientScaleY},$H.worldToNormalizedViewportPoint=function($t,$H){$tH.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($t,this._projectionViewMatrix,$H);var $I=$H.elements;$I[0]=$I[0]/$N.stage.clientScaleX,$I[1]=$I[1]/$N.stage.clientScaleY},$H.convertScreenCoordToOrthographicCoord=function($t,$H){if(this._orthographic){var $I=$F.clientWidth,$T=$F.clientHeight,$K=this.orthographicVerticalSize*this.aspectRatio/$I,$_=this.orthographicVerticalSize/$T,$V=$t.elements,$e=$H.elements;return $e[0]=(-$I/2+$V[0])*$K,$e[1]=($T/2-$V[1])*$_,$e[2]=(this.nearPlane-this.farPlane)*($V[2]+1)/2-this.nearPlane,$VH.transformCoordinate($H,this.transform.worldMatrix,$H),!0}return!1},$G(0,$H,"projectionViewMatrix",function(){return $tH.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$G(0,$H,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $t=this.viewport;return $t.width/$t.height},function($t){if($t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$t,this._calculateProjectionMatrix()}),$G(0,$H,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$G(0,$H,"needViewport",function(){var $t=this.normalizedViewport;return 0===$t.x&&0===$t.y&&1===$t.width&&1===$t.height}),$G(0,$H,"viewport",function(){if(this._viewportExpressedInClipSpace){var $t=this._normalizedViewport,$H=this.renderTargetSize,$I=$H.width,$T=$H.height;this._viewport.x=$t.x*$I,this._viewport.y=$t.y*$T,this._viewport.width=$t.width*$I,this._viewport.height=$t.height*$T}return this._viewport},function($t){if(null!=this.renderTarget&&($t.x<0||$t.y<0||0==$t.width||0==$t.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$t,this._calculateProjectionMatrix()}),$G(0,$H,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $t=this._viewport,$H=this.renderTargetSize,$I=$H.width,$T=$H.height;this._normalizedViewport.x=$t.x/$I,this._normalizedViewport.y=$t.y/$T,this._normalizedViewport.width=$t.width/$I,this._normalizedViewport.height=$t.height/$T}return this._normalizedViewport},function($t){$t.x<0&&($t.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$t.y<0&&($t.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$t.x+$t.width&&($t.width=1-$t.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$t.y+$t.height&&($t.height=1-$t.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$t,this._calculateProjectionMatrix()}),$G(0,$H,"projectionMatrix",function(){return this._projectionMatrix},function($t){this._projectionMatrix=$t,this._useUserProjectionMatrix=!0}),$G(0,$H,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$f($V,["_tempVector20",function(){return this._tempVector20=new $_H}]),$V}()),$nH=function($I){function $T($t,$H){$T.__super.call(this,$H),this._geometryFilter=new $DH(this),this._render=new $pH(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$t&&(this._geometryFilter.sharedMesh=$t)instanceof laya.d3.resource.models.Mesh&&($t.loaded?this._render.sharedMaterials=$t.materials:$t.once("loaded",this,this._applyMeshMaterials))}$L($T,"laya.d3.core.MeshSprite3D",$I);var $t=$T.prototype;return $t._changeRenderObjectByMesh=function($t){var $H=this._render._renderElements,$I=$H[$t];$I||($I=$H[$t]=new $WH),$I._render=this._render;var $T=this._render.sharedMaterials[$t];$T||($T=$yH.defaultMaterial);var $K=this._geometryFilter.sharedMesh.getRenderElement($t);return $I._mainSortID=this._getSortID($K,$T),$I._sprite3D=this,$I.renderObj=$K,$I._material=$T,$I},$t._changeRenderObjectByMaterial=function($t,$H){var $I=this._render._renderElements[$t];$H||($H=$yH.defaultMaterial);var $T=this._geometryFilter.sharedMesh.getRenderElement($t);return $I._mainSortID=this._getSortID($T,$H),$I._sprite3D=this,$I.renderObj=$T,$I._material=$H,$I},$t._changeRenderObjectsByMesh=function(){var $t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$t;for(var $H=0;$H<$t;$H++)this._changeRenderObjectByMesh($H)},$t._onMeshChanged=function($t){var $H=$t.sharedMesh;$H.loaded?this._changeRenderObjectsByMesh():$H.once("loaded",this,this._onMeshLoaded)},$t._onMeshLoaded=function($t){$t===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$t._onMaterialChanged=function($t,$H,$I){$H<this._render._renderElements.length&&this._changeRenderObjectByMaterial($H,$I)},$t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$t._parseCustomProps=function($t,$H,$I,$T){var $K=this.meshRender,$_=$I.lightmapIndex;null!=$_&&($K.lightmapIndex=$_);var $V,$e,$R=$I.lightmapScaleOffset;if($R&&($K.lightmapScaleOffset=new $eH($R[0],$R[1],$R[2],$R[3])),$T.instanceParams)($V=$T.instanceParams.loadPath)&&($e=$J.getRes($H[$V]),(this.meshFilter.sharedMesh=$e).loaded?$K.sharedMaterials=$e.materials:$e.once("loaded",this,this._applyMeshMaterials));else{($V=$I.meshPath)&&($e=$J.getRes($H[$V]),this.meshFilter.sharedMesh=$e);var $A=$I.materials;if($A){var $q=$K.sharedMaterials,$f=$A.length;$q.length=$f;for(var $b=0;$b<$f;$b++)$q[$b]=$J.getRes($H[$A[$b].path]);$K.sharedMaterials=$q}}},$t._applyMeshMaterials=function($t){for(var $H=this._render.sharedMaterials,$I=$t.materials,$T=0,$K=$I.length;$T<$K;$T++)$H[$T]||($H[$T]=$I[$T]);this._render.sharedMaterials=$H},$t._addToInitStaticBatchManager=function(){$T._staticBatchManager._addInitBatchSprite(this)},$t.cloneTo=function($t){var $H=$t;$H._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $I=this._render,$T=$H._render;$T.enable=$I.enable,$T.sharedMaterials=$I.sharedMaterials,$T.castShadow=$I.castShadow;var $K=$I.lightmapScaleOffset;$K&&($T.lightmapScaleOffset=$K.clone()),$T.lightmapIndex=$I.lightmapIndex,$T.receiveShadow=$I.receiveShadow,$T.sortingFudge=$I.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$t)},$t.destroy=function($t){if(void 0===$t&&($t=!0),!this.destroyed){var $H=this.meshFilter.sharedMesh;null!=$H&&($H.loaded||$H.off("loaded",this,this._applyMeshMaterials)),$I.prototype.destroy.call(this,$t),this._geometryFilter._destroy()}},$G(0,$t,"meshFilter",function(){return this._geometryFilter}),$G(0,$t,"meshRender",function(){return this._render}),$T.__init__=function(){$Tt._staticBatchManagers.push($T._staticBatchManager)},$T.load=function($t){return $N.loader.create($t,null,null,$T)},$f($T,["_staticBatchManager",function(){return this._staticBatchManager=new $zH}]),$T}($mH)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($t,$H){"use strict";for(var $I in Object.defineProperty($H,"__esModule",{value:!0}),Laya){var $T=Laya[$I];$T&&$T.__isclass&&($H[$I]=$T)}}),function($t,$H,$Kt){$Kt.un,$Kt.uns;var $I=$Kt.static,$T=$Kt.class,$_=$Kt.getset,$M=$Kt.__newvec,$e=laya.maths.Bezier,$f=laya.utils.Browser,$xt=laya.utils.Byte,$K=(laya.events.Event,laya.events.EventDispatcher),$V=laya.display.Graphics,$R=(laya.resource.HTMLCanvas,laya.utils.Handler),$A=laya.net.Loader,$b=laya.maths.MathUtil,$Yt=laya.maths.Matrix,$O=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$q=(laya.renders.RenderContext,laya.resource.Resource),$L=laya.utils.RunDriver,$_t=laya.display.Sprite,$G=laya.utils.Stat,$Dt=laya.resource.Texture,$J=(laya.net.URL,laya.utils.Utils),$Y=function(){function $t(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $T($t,"laya.ani.AnimationContent"),$t}(),$D=function(){function $t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $T($t,"laya.ani.AnimationNodeContent"),$t}(),$U=function(){function $t(){}return $T($t,"laya.ani.AnimationParser01"),$t.parse=function($t,$H){var $I=$H.__getBuffer(),$T=0,$K=0,$_=0,$V=0,$e=0,$R=0,$A=0,$q=$H.readUTFString();$t._aniClassName=$q;var $f,$b=$H.readUTFString().split("\n"),$L=$H.getUint8(),$G=$H.getUint32(),$M=$H.getUint32();0<$G&&($f=$I.slice($G,$M));var $O=new $xt($f);for(0<$M&&($t._publicExtData=$I.slice($M,$I.byteLength)),$t._useParent=!!$H.getUint8(),$t._anis.length=$L,$T=0;$T<$L;$T++){var $J=$t._anis[$T]=new $Y;$J.nodes=new Array;var $S=$J.name=$b[$H.getUint16()];$t._aniMap[$S]=$T,$J.bone3DMap={},$J.playTime=$H.getFloat32(),$J.playTime<=0&&console.error("播放时间不能为0  url="+$t.url+" name="+$J.name);var $U=$J.nodes.length=$H.getUint8();for($K=$J.totalKeyframeDatasLength=0;$K<$U;$K++){var $C=$J.nodes[$K]=new $D;$C.childs=[];var $N=$H.getInt16();0<=$N&&($C.name=$b[$N],$J.bone3DMap[$C.name]=$K),$C.keyFrame=new Array,$C.parentIndex=$H.getInt16(),-1==$C.parentIndex?$C.parent=null:$C.parent=$J.nodes[$C.parentIndex],$C.lerpType=$H.getUint8();var $w=$H.getUint32();$O.pos=$w;var $W=$C.keyframeWidth=$O.getUint16();if($J.totalKeyframeDatasLength+=$W,0===$C.lerpType||1===$C.lerpType)for($C.interpolationMethod=[],$C.interpolationMethod.length=$W,$_=0;$_<$W;$_++)$C.interpolationMethod[$_]=$l.interpolation[$O.getUint8()];null!=$C.parent&&$C.parent.childs.push($C);var $s=$H.getUint16();0<$s&&($C.extenData=$I.slice($H.pos,$H.pos+$s),$H.pos+=$s);var $z,$P=$H.getUint16(),$k=0;for($_=0,$V=$C.keyFrame.length=$P;$_<$V;$_++){if(($z=$C.keyFrame[$_]=new $p).duration=$H.getFloat32(),$z.startTime=$k,2===$C.lerpType){$z.interpolationData=[];var $r,$x=$H.getUint8();switch($r=$H.getFloat32()){case 254:for($z.interpolationData.length=$W,$A=0;$A<$W;$A++)$z.interpolationData[$A]=0;break;case 255:for($z.interpolationData.length=$W,$A=0;$A<$W;$A++)$z.interpolationData[$A]=5;break;default:for($z.interpolationData.push($r),$R=1;$R<$x;$R++)$z.interpolationData.push($H.getFloat32())}}for($z.data=new Float32Array($W),$e=0;$e<$W;$e++)$z.data[$e]=$H.getFloat32(),-1e-8<$z.data[$e]&&$z.data[$e]<1e-8&&($z.data[$e]=0);$k+=$z.duration}$z.startTime=$J.playTime,$C.playTime=$J.playTime,$t._calculateKeyFrame($C,$P,$W)}}},$t}(),$C=function(){function $N(){}return $T($N,"laya.ani.AnimationParser02"),$N.READ_DATA=function(){$N._DATA.offset=$N._reader.getUint32(),$N._DATA.size=$N._reader.getUint32()},$N.READ_BLOCK=function(){for(var $t=$N._BLOCK.count=$N._reader.getUint16(),$H=$N._BLOCK.blockStarts=[],$I=$N._BLOCK.blockLengths=[],$T=0;$T<$t;$T++)$H.push($N._reader.getUint32()),$I.push($N._reader.getUint32())},$N.READ_STRINGS=function(){var $t=$N._reader.getUint32(),$H=$N._reader.getUint16(),$I=$N._reader.pos;$N._reader.pos=$t+$N._DATA.offset;for(var $T=0;$T<$H;$T++)$N._strings[$T]=$N._reader.readUTFString();$N._reader.pos=$I},$N.parse=function($t,$H){$N._templet=$t;($N._reader=$H).__getBuffer();$N.READ_DATA(),$N.READ_BLOCK(),$N.READ_STRINGS();for(var $I=0,$T=$N._BLOCK.count;$I<$T;$I++){var $K=$H.getUint16(),$_=$N._strings[$K],$V=$N["READ_"+$_];if(null==$V)throw new Error("model file err,no this function:"+$K+" "+$_);$V.call()}},$N.READ_ANIMATIONS=function(){var $t=$N._reader,$H=$t.__getBuffer(),$I=0,$T=0,$K=0,$_=0,$V=$t.getUint16(),$e=[];for($e.length=$V,$I=0;$I<$V;$I++)$e[$I]=$l.interpolation[$t.getByte()];var $R=$t.getUint8();for($N._templet._anis.length=$R,$I=0;$I<$R;$I++){var $A=$N._templet._anis[$I]={};$A.nodes=new Array;var $q=$A.name=$N._strings[$t.getUint16()];$N._templet._aniMap[$q]=$I,$A.bone3DMap={},$A.playTime=$t.getFloat32();var $f=$A.nodes.length=$t.getInt16();for($T=$A.totalKeyframeDatasLength=0;$T<$f;$T++){var $b=$A.nodes[$T]={};$b.keyframeWidth=$V,$b.childs=[];var $L=$t.getUint16();0<=$L&&($b.name=$N._strings[$L],$A.bone3DMap[$b.name]=$T),$b.keyFrame=new Array,$b.parentIndex=$t.getInt16(),-1==$b.parentIndex?$b.parent=null:$b.parent=$A.nodes[$b.parentIndex],$A.totalKeyframeDatasLength+=$V,$b.interpolationMethod=$e,null!=$b.parent&&$b.parent.childs.push($b);var $G=$t.getUint16(),$M=null,$O=null;for($K=0,$_=$b.keyFrame.length=$G;$K<$_;$K++){($M=$b.keyFrame[$K]={}).startTime=$t.getFloat32(),$O&&($O.duration=$M.startTime-$O.startTime);var $J=$N._DATA.offset,$S=$t.getUint32(),$U=4*$V,$C=$H.slice($J+$S,$J+$S+$U);$M.data=new Float32Array($C),$O=$M}$M.duration=0,$b.playTime=$A.playTime,$N._templet._calculateKeyFrame($b,$G,$V)}}},$N._templet=null,$N._reader=null,$N._strings=[],$I($N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$N}(),$pt=(function(){function $t(){}$T($t,"laya.ani.AnimationState"),$t.stopped=0,$t.paused=1,$t.playing=2}(),function(){function $K(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $mt,this.resultMatrix=new $Yt,this._children=[]}$T($K,"laya.ani.bone.Bone");var $t=$K.prototype;return $t.setTempMatrix=function($t){this._tempMatrix=$t;var $H,$I=0;for($I=0,$H=this._children.length;$I<$H;$I++)this._children[$I].setTempMatrix(this._tempMatrix)},$t.update=function($t){var $H;if(this.rotation=this.transform.skX,$t)$H=this.resultTransform.getMatrix(),$Yt.mul($H,$t,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$H=this.resultTransform.getMatrix(),$Yt.mul($H,this.parentBone.resultMatrix,this.resultMatrix);else{var $I=this.parentBone,$T=NaN,$K=NaN,$_=NaN,$V=this.parentBone.resultMatrix;$H=this.resultTransform.getMatrix();var $e=$V.a*$H.tx+$V.c*$H.ty+$V.tx,$R=$V.b*$H.tx+$V.d*$H.ty+$V.ty,$A=new $Yt;this.inheritRotation?($T=Math.atan2($I.resultMatrix.b,$I.resultMatrix.a),$K=Math.cos($T),$_=Math.sin($T),$A.setTo($K,$_,-$_,$K,0,0),$Yt.mul(this._tempMatrix,$A,$Yt.TEMP),$Yt.TEMP.copyTo($A),$H=this.resultTransform.getMatrix(),$Yt.mul($H,$A,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$H=this.resultTransform.getMatrix(),$Yt.TEMP.identity(),$Yt.TEMP.d=this.d,$Yt.mul($H,$Yt.TEMP,this.resultMatrix)),this.resultMatrix.tx=$e,this.resultMatrix.ty=$R}else($H=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $q,$f=0;for($f=0,$q=this._children.length;$f<$q;$f++)this._children[$f].update()},$t.updateChild=function(){var $t,$H=0;for($H=0,$t=this._children.length;$H<$t;$H++)this._children[$H].update()},$t.setRotation=function($t){this._sprite&&(this._sprite.rotation=180*$t/Math.PI)},$t.updateDraw=function($t,$H){$K.ShowBones&&!$K.ShowBones[this.name]||(this._sprite||(this._sprite=new $_t,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$Kt.stage.addChild(this._sprite)),this._sprite.x=$t+this.resultMatrix.tx,this._sprite.y=$H+this.resultMatrix.ty);var $I,$T=0;for($T=0,$I=this._children.length;$T<$I;$T++)this._children[$T].updateDraw($t,$H)},$t.addChild=function($t){this._children.push($t),$t.parentBone=this},$t.findBone=function($t){if(this.name==$t)return this;var $H,$I,$T=0;for($T=0,$H=this._children.length;$T<$H;$T++)if($I=this._children[$T].findBone($t))return $I;return null},$t.localToWorld=function($t){var $H=$t[0],$I=$t[1];$t[0]=$H*this.resultMatrix.a+$I*this.resultMatrix.c+this.resultMatrix.tx,$t[1]=$H*this.resultMatrix.b+$I*this.resultMatrix.d+this.resultMatrix.ty},$K.ShowBones={},$K}()),$gt=function(){function $M(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$T($M,"laya.ani.bone.BoneSlot");var $t=$M.prototype;return $t.showSlotData=function($t,$H){void 0===$H&&($H=!0),this.currSlotData=$t,$H&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$t.showDisplayByName=function($t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($t))},$t.replaceDisplayByName=function($t,$H){if(this.currSlotData){var $I;$I=this.currSlotData.getDisplayByName($t);var $T;$T=this.currSlotData.getDisplayByName($H),this.replaceDisplayByIndex($I,$T)}},$t.replaceDisplayByIndex=function($t,$H){this.currSlotData&&(this._replaceDic[$t]=$H,this.displayIndex==$t&&this.showDisplayByIndex($t))},$t.showDisplayByIndex=function($t){if(null!=this._replaceDic[$t]&&($t=this._replaceDic[$t]),this.currSlotData&&-1<$t&&$t<this.currSlotData.displayArr.length){if(this.displayIndex=$t,this.currDisplayData=this.currSlotData.displayArr[$t],this.currDisplayData){var $H=this.currDisplayData.name;this.currTexture=this.templet.getTexture($H),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$O.isConchApp||$O.isConchApp&&"0.9.15"<$_t.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$t.replaceSkin=function($t){this._diyTexture=$t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$t.setParentMatrix=function($t){this._parentMatrix=$t},$t.draw=function($t,$H,$I,$T){if(void 0===$I&&($I=!1),void 0===$T&&($T=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $K,$_=this.currTexture;switch(this._diyTexture&&($_=this._diyTexture),this.currDisplayData.type){case 0:if($t){var $V=this.getDisplayMatrix();if(this._parentMatrix){var $e=!1;if($V){var $R;if($Yt.mul($V,this._parentMatrix,$Yt.TEMP),$R=$I?(null==this._resultMatrix&&(this._resultMatrix=new $Yt),this._resultMatrix):new $Yt,!$O.isWebGL&&this.currDisplayData.uvs||$O.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $A=$M._tempMatrix;$A.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($A.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($e=!0,$A.rotate(-Math.PI/2)),$Yt.mul($A,$Yt.TEMP,$R)}else $Yt.TEMP.copyTo($R);$e?$t.drawTexture($_,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$R):$t.drawTexture($_,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$R)}}}break;case 1:if(null==($K=$I?(null==this._skinSprite&&(this._skinSprite=$M.createSkinMesh()),this._skinSprite):$M.createSkinMesh()))return;var $q;if(null==this.currDisplayData.bones){var $f,$b=this.currDisplayData.weights;this.deformData&&($b=this.deformData),$f=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$W.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$W.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$b;this.currDisplayData.triangles.length;$q=this.currDisplayData.triangles,$K.init2($_,null,$q,this._mVerticleArr,$f);var $L,$G=this.getDisplayMatrix();if(this._parentMatrix)if($G)$Yt.mul($G,this._parentMatrix,$Yt.TEMP),$L=$I?(null==this._resultMatrix&&(this._resultMatrix=new $Yt),this._resultMatrix):new $Yt,$Yt.TEMP.copyTo($L),$K.transform=$L}else this.skinMesh($H,$K,$T);$t.drawSkin($K);break;case 2:if(null==($K=$I?(null==this._skinSprite&&(this._skinSprite=$M.createSkinMesh()),this._skinSprite):$M.createSkinMesh()))return;this.skinMesh($H,$K,$T),$t.drawSkin($K)}}},$t.skinMesh=function($t,$H,$I){var $T,$K=this.currTexture,$_=this.currDisplayData.bones;$T=this._diyTexture?($K=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$W.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$W.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $V,$e,$R=this.currDisplayData.weights,$A=this.currDisplayData.triangles,$q=0,$f=0,$b=0,$L=NaN,$G=NaN,$M=0,$O=0,$J=[],$S=0,$U=0;if(this.deformData&&0<this.deformData.length){var $C=0;for($S=0,$U=$_.length;$S<$U;){for($b=$_[$S++]+$S,$f=$q=0;$S<$b;$S++)$e=$t[$_[$S]],$L=$R[$M]+this.deformData[$C++],$G=$R[$M+1]+this.deformData[$C++],$O=$R[$M+2],$q+=($L*$e.a+$G*$e.c+$e.tx)*$O,$f+=($L*$e.b+$G*$e.d+$e.ty)*$O,$M+=3;$J.push($q,$f)}}else for($S=0,$U=$_.length;$S<$U;){for($b=$_[$S++]+$S,$f=$q=0;$S<$b;$S++)$e=$t[$_[$S]],$L=$R[$M],$G=$R[$M+1],$O=$R[$M+2],$q+=($L*$e.a+$G*$e.c+$e.tx)*$O,$f+=($L*$e.b+$G*$e.d+$e.ty)*$O,$M+=3;$J.push($q,$f)}this._mVerticleArr=$J,$V=$A,$H.init2($K,null,$V,this._mVerticleArr,$T)},$t.drawBonePoint=function($t){$t&&this._parentMatrix&&$t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$t.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$t.getMatrix=function(){return this._resultMatrix},$t.copy=function(){var $t=new $M;return $t.type="copy",$t.name=this.name,$t.attachmentName=this.attachmentName,$t.srcDisplayIndex=this.srcDisplayIndex,$t.parent=this.parent,$t.displayIndex=this.displayIndex,$t.templet=this.templet,$t.currSlotData=this.currSlotData,$t.currTexture=this.currTexture,$t.currDisplayData=this.currDisplayData,$t},$M.createSkinMesh=function(){return $O.isWebGL||$O.isConchApp?$L.skinAniSprite():($O.isWebGL,null)},$I($M,["_tempMatrix",function(){return this._tempMatrix=new $Yt}]),$M}(),$lt=function(){function $t(){this.skinName=null,this.deformSlotDataList=[]}return $T($t,"laya.ani.bone.DeformAniData"),$t}(),$vt=function(){function $t(){this.deformSlotDisplayList=[]}return $T($t,"laya.ani.bone.DeformSlotData"),$t}(),$yt=function(){function $t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$T($t,"laya.ani.bone.DeformSlotDisplayData");var $H=$t.prototype;return $H.binarySearch1=function($t,$H){var $I=0,$T=$t.length-2;if(0==$T)return 1;for(var $K=$T>>>1;;){if($t[Math.floor($K+1)]<=$H?$I=$K+1:$T=$K,$I==$T)return $I+1;$K=$I+$T>>>1}return 0},$H.apply=function($t,$H,$I){if(void 0===$I&&($I=1),$t+=.05,!(this.timeList.length<=0)){var $T=0;if(!($t<this.timeList[0])){var $K=this.vectices[0].length,$_=[],$V=this.binarySearch1(this.timeList,$t);if(this.frameIndex=$V,$t>=this.timeList[this.timeList.length-1]){var $e=this.vectices[this.vectices.length-1];if($I<1)for($T=0;$T<$K;$T++)$_[$T]+=($e[$T]-$_[$T])*$I;else for($T=0;$T<$K;$T++)$_[$T]=$e[$T];this.deformData=$_}else{this.tweenKeyList[this.frameIndex];var $R=this.vectices[this.frameIndex-1],$A=this.vectices[this.frameIndex],$q=this.timeList[this.frameIndex-1],$f=this.timeList[this.frameIndex];$I=this.tweenKeyList[$V-1]?($t-$q)/($f-$q):0;var $b=NaN;for($T=0;$T<$K;$T++)$b=$R[$T],$_[$T]=$b+($A[$T]-$b)*$I;this.deformData=$_}}}},$t}(),$Et=function(){function $t(){this.time=NaN,this.drawOrder=[]}return $T($t,"laya.ani.bone.DrawOrderData"),$t}(),$ht=function(){function $t(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $T($t,"laya.ani.bone.EventData"),$t}(),$S=function(){function $Tt($t,$H){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$t,this._targetBone=$H[$t.targetBoneIndex],this.isSpine=$t.isSpine,null==this._bones&&(this._bones=[]);for(var $I=this._bones.length=0,$T=$t.boneIndexs.length;$I<$T;$I++)this._bones.push($H[$t.boneIndexs[$I]]);this.name=$t.name,this.mix=$t.mix,this.bendDirection=$t.bendDirection}$T($Tt,"laya.ani.bone.IkConstraint");var $t=$Tt.prototype;return $t.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$t._applyIk1=function($t,$H,$I,$T){var $K=$t.parentBone,$_=1/($K.resultMatrix.a*$K.resultMatrix.d-$K.resultMatrix.b*$K.resultMatrix.c),$V=$H-$K.resultMatrix.tx,$e=$I-$K.resultMatrix.ty,$R=($V*$K.resultMatrix.d-$e*$K.resultMatrix.c)*$_-$t.transform.x,$A=($e*$K.resultMatrix.a-$V*$K.resultMatrix.b)*$_-$t.transform.y,$q=Math.atan2($A,$R)*$Tt.radDeg-0-$t.transform.skX;$t.transform.scX<0&&($q+=180),180<$q?$q-=360:$q<-180&&($q+=360),$t.transform.skX=$t.transform.skY=$t.transform.skX+$q*$T,$t.update()},$t.updatePos=function($t,$H){this._sp&&this._sp.pos($t,$H)},$t._applyIk2=function($t,$H,$I,$T,$K,$_){if(0!=$_){var $V=$t.resultTransform.x,$e=$t.resultTransform.y,$R=$t.transform.scX,$A=$t.transform.scY,$q=$H.transform.scX,$f=0,$b=0,$L=0;$L=$R<0?($R=-$R,$f=180,-1):($f=0,1),$A<0&&($A=-$A,$L=-$L),$b=$q<0?($q=-$q,180):0;var $G=$H.resultTransform.x,$M=NaN,$O=NaN,$J=NaN,$S=$t.resultMatrix.a,$U=$t.resultMatrix.c,$C=$t.resultMatrix.b,$N=$t.resultMatrix.d,$w=Math.abs($R-$A)<=1e-4;$J=$w?($O=$S*$G+$U*($M=$H.resultTransform.y)+$t.resultMatrix.tx,$C*$G+$N*$M+$t.resultMatrix.ty):($M=0,$O=$S*$G+$t.resultMatrix.tx,$C*$G+$t.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $_t,$Kt.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($I,$T,15,"#ffff00"),this._sp.graphics.drawCircle($O,$J,15,"#ff00ff")),$t.setRotation(Math.atan2($J-$t.resultMatrix.ty,$O-$t.resultMatrix.tx));var $W=$t.parentBone;$S=$W.resultMatrix.a,$U=$W.resultMatrix.c,$C=$W.resultMatrix.b;var $s=1/($S*($N=$W.resultMatrix.d)-$U*$C),$z=$I-$W.resultMatrix.tx,$P=$T-$W.resultMatrix.ty,$k=($z*$N-$P*$U)*$s-$V,$r=($P*$S-$z*$C)*$s-$e,$x=(($z=$O-$W.resultMatrix.tx)*$N-($P=$J-$W.resultMatrix.ty)*$U)*$s-$V,$Y=($P*$S-$z*$C)*$s-$e,$D=Math.sqrt($x*$x+$Y*$Y),$p=$H.length*$q,$g=NaN,$l=NaN;if($w){var $v=($k*$k+$r*$r-$D*$D-($p*=$R)*$p)/(2*$D*$p);$v<-1?$v=-1:1<$v&&($v=1),$l=Math.acos($v)*$K,$S=$D+$p*$v,$U=$p*Math.sin($l),$g=Math.atan2($r*$S-$k*$U,$k*$S+$r*$U)}else{var $y=($S=$R*$p)*$S,$E=($U=$A*$p)*$U,$h=$k*$k+$r*$r,$X=Math.atan2($r,$k),$B=-2*$E*$D,$a=$E-$y;if(0<($N=$B*$B-4*$a*($C=$E*$D*$D+$y*$h-$y*$E))){var $u=Math.sqrt($N);$B<0&&($u=-$u);var $$=($u=-($B+$u)/2)/$a,$Q=$C/$u,$m=Math.abs($$)<Math.abs($Q)?$$:$Q;$m*$m<=$h&&($P=Math.sqrt($h-$m*$m)*$K,$g=$X-Math.atan2($P,$m),$l=Math.atan2($P/$A,($m-$D)/$R))}var $o=0,$n=Number.MAX_VALUE,$F=0,$c=0,$i=0,$j=0,$d=0,$Z=0;$j<($N=($z=$D+$S)*$z)&&($i=0,$j=$N,$d=$z),($N=($z=$D-$S)*$z)<$n&&($o=Math.PI,$n=$N,$F=$z);var $tt=Math.acos(-$S*$D/($y-$E));($N=($z=$S*Math.cos($tt)+$D)*$z+($P=$U*Math.sin($tt))*$P)<$n&&($o=$tt,$n=$N,$F=$z,$c=$P),$j<$N&&($i=$tt,$j=$N,$d=$z,$Z=$P),$l=$h<=($n+$j)/2?($g=$X-Math.atan2($c*$K,$F),$o*$K):($g=$X-Math.atan2($Z*$K,$d),$i*$K)}var $Ht=Math.atan2($M,$G)*$L,$It=$t.resultTransform.skX;180<($g=($g-$Ht)*$Tt.radDeg+$f-$It)?$g-=360:$g<-180&&($g+=360),$t.resultTransform.x=$V,$t.resultTransform.y=$e,$t.resultTransform.skX=$t.resultTransform.skY=$It+$g*$_,$It=$H.resultTransform.skX,180<($l=(($l+$Ht)*$Tt.radDeg-0)*$L+$b-($It%=360))?$l-=360:$l<-180&&($l+=360),$H.resultTransform.x=$G,$H.resultTransform.y=$M,$H.resultTransform.skX=$H.resultTransform.skY=$H.resultTransform.skY+$l*$_,$t.update()}},$t._applyIk3=function($t,$H,$I,$T,$K,$_){if(0!=$_){var $V,$e,$R=$H.resultMatrix.a*$H.length,$A=$H.resultMatrix.b*$H.length,$q=$R*$R+$A*$A,$f=Math.sqrt($q),$b=$t.resultMatrix.tx,$L=$t.resultMatrix.ty,$G=$H.resultMatrix.tx,$M=$H.resultMatrix.ty,$O=$G-$b,$J=$M-$L,$S=$O*$O+$J*$J,$U=Math.sqrt($S),$C=($O=$I-$t.resultMatrix.tx)*$O+($J=$T-$t.resultMatrix.ty)*$J,$N=Math.sqrt($C);if($f+$U<=$N||$N+$f<=$U||$N+$U<=$f){var $w=NaN;$G=$b+($w=$f+$U<=$N?1:-1)*($I-$b)*$U/$N,$M=$L+$w*($T-$L)*$U/$N}else{var $W=($S-$q+$C)/(2*$C),$s=Math.sqrt($S-$W*$W*$C)/$N,$z=$b+$O*$W,$P=$L+$J*$W,$k=-$J*$s,$r=$O*$s;$M=0<$K?($G=$z-$k,$P-$r):($G=$z+$k,$P+$r)}$V=$G,$e=$M,this.isDebug&&(this._sp||(this._sp=new $_t,$Kt.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($b,$L,15,"#ff00ff"),this._sp.graphics.drawCircle($I,$T,15,"#ffff00"),this._sp.graphics.drawCircle($V,$e,15,"#ff00ff"));var $x,$Y;$x=Math.atan2($e-$t.resultMatrix.ty,$V-$t.resultMatrix.tx),$t.setRotation($x),($Y=$Tt._tempMatrix).identity(),$Y.rotate($x),$Y.scale($t.resultMatrix.getScaleX(),$t.resultMatrix.getScaleY()),$Y.translate($t.resultMatrix.tx,$t.resultMatrix.ty),$Y.copyTo($t.resultMatrix),$t.updateChild();var $D,$p;$D=Math.atan2($T-$e,$I-$V),$H.setRotation($D),($p=$Tt._tempMatrix).identity(),$p.rotate($D),$p.scale($H.resultMatrix.getScaleX(),$H.resultMatrix.getScaleY()),$p.translate($V,$e),$Y.copyTo($H.resultMatrix),$H.updateChild()}},$I($Tt,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $Yt}]),$Tt}(),$Xt=function(){function $t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $T($t,"laya.ani.bone.IkConstraintData"),$t}(),$N=function(){function $p($t,$H){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$t,this.position=$t.position,this.spacing=$t.spacing,this.rotateMix=$t.rotateMix,this.translateMix=$t.translateMix,this.bones=[];for(var $I=this.data.bones,$T=0,$K=$I.length;$T<$K;$T++)this.bones.push($H[$I[$T]])}$T($p,"laya.ani.bone.PathConstraint");var $t=$p.prototype;return $t.apply=function($t,$H){if(this.target){var $I=this.translateMix,$T=this.translateMix,$K=0<$T,$_=this.data.spacingMode,$V="length"==$_,$e=this.data.rotateMode,$R="tangent"==$e,$A="chainScale"==$e,$q=[],$f=this.bones.length,$b=$R?$f:$f+1,$L=[];(this._spaces=$L)[0]=this.position;var $G=this.spacing;if($A||$V)for(var $M=0,$O=$b-1;$M<$O;){var $J=this.bones[$M],$S=$J.length,$U=$S*$J.resultMatrix.a,$C=$S*$J.resultMatrix.b;$S=Math.sqrt($U*$U+$C*$C),$A&&($q[$M]=$S),$L[++$M]=$V?Math.max(0,$S+$G):$G}else for($M=1;$M<$b;$M++)$L[$M]=$G;var $N=this.computeWorldPositions(this.target,$t,$H,$b,$R,"percent"==this.data.positionMode,"percent"==$_);if(this._debugKey){for($M=0;$M<$N.length;$M++)$H.drawCircle($N[$M++],$N[$M++],5,"#00ff00");var $w=[];for($M=0;$M<$N.length;$M++)$w.push($N[$M++],$N[$M++]);$H.drawLines(0,0,$w,"#ff0000")}var $W=$N[0],$s=$N[1],$z=this.data.offsetRotation,$P="chain"==$e&&0==$z,$k=NaN;for($M=0,$k=3;$M<$f;$M++,$k+=3){($J=this.bones[$M]).resultMatrix.tx+=($W-$J.resultMatrix.tx)*$I,$J.resultMatrix.ty+=($s-$J.resultMatrix.ty)*$I;var $r=($U=$N[$k])-$W,$x=($C=$N[$k+1])-$s;if($A&&0!=($S=$q[$M])){var $Y=(Math.sqrt($r*$r+$x*$x)/$S-1)*$T+1;$J.resultMatrix.a*=$Y,$J.resultMatrix.c*=$Y}if($W=$U,$s=$C,$K){var $D=$J.resultMatrix.a,$p=$J.resultMatrix.c,$g=$J.resultMatrix.b,$l=$J.resultMatrix.d,$v=NaN,$y=NaN,$E=NaN;$v=$R?$N[$k-1]:0==$L[$M+1]?$N[$k+2]:Math.atan2($x,$r),$v-=Math.atan2($g,$D)-$z/180*Math.PI,$P&&($y=Math.cos($v),$E=Math.sin($v),$W+=(($S=$J.length)*($y*$D-$E*$g)-$r)*$T,$s+=($S*($E*$D+$y*$g)-$x)*$T),$v>Math.PI?$v-=2*Math.PI:$v<-Math.PI&&($v+=2*Math.PI),$v*=$T,$y=Math.cos($v),$E=Math.sin($v),$J.resultMatrix.a=$y*$D-$E*$g,$J.resultMatrix.c=$y*$p-$E*$l,$J.resultMatrix.b=$E*$D+$y*$g,$J.resultMatrix.d=$E*$p+$y*$l}}}},$t.computeWorldVertices2=function($t,$H,$I,$T,$K,$_){var $V,$e,$R=$t.currDisplayData.bones,$A=$t.currDisplayData.weights,$q=$t.currDisplayData.triangles,$f=0,$b=0,$L=0,$G=0,$M=0,$O=0,$J=0,$S=0,$U=0,$C=0,$N=0;if(null!=$R){for($f=0;$f<$I;$f+=2)$b+=($G=$R[$b])+1,$L+=$G;var $w=$H;for($M=$_,$O=3*$L;$M<$T;$M+=2){for($S=$J=0,$G=$R[$b++],$G+=$b;$b<$G;$b++,$O+=3){$V=$w[$R[$b]].resultMatrix,$U=$A[$O],$C=$A[$O+1];var $W=$A[$O+2];$J+=($U*$V.a+$C*$V.c+$V.tx)*$W,$S+=($U*$V.b+$C*$V.d+$V.ty)*$W}$K[$M]=$J,$K[$M+1]=$S}}else{var $s,$z;if($q||($q=$A),$t.deformData&&($q=$t.deformData),$s=$t.parent,$H)for($N=$H.length,$f=0;$f<$N;$f++)if($H[$f].name==$s){$e=$H[$f];break}$e&&($z=$e.resultMatrix),$z||($z=$p._tempMt);var $P=$z.tx,$k=$z.ty,$r=$z.a,$x=$z.b,$Y=$z.c,$D=$z.d;for($e&&($D*=$e.d),$b=$I,$M=$_;$M<$T;$b+=2,$M+=2)$U=$q[$b],$C=$q[$b+1],$K[$M]=$U*$r+$C*$x+$P,$K[$M+1]=-($U*$Y+$C*$D+$k)}},$t.computeWorldPositions=function($t,$H,$I,$T,$K,$_,$V){$t.currDisplayData.bones,$t.currDisplayData.weights,$t.currDisplayData.triangles;var $e=[],$R=0,$A=$t.currDisplayData.verLen,$q=this.position,$f=this._spaces,$b=[],$L=[],$G=$A/6,$M=-1,$O=NaN,$J=0,$S=0,$U=NaN,$C=NaN,$N=NaN,$w=NaN;if($G--,$A-=4,this.computeWorldVertices2($t,$H,2,$A,$e,0),this._debugKey)for($R=0;$R<$e.length;)$I.drawCircle($e[$R++],$e[$R++],10,"#ff0000");$b=$e,this._curves.length=$G;var $W=this._curves,$s=$b[$O=0],$z=$b[1],$P=0,$k=0,$r=0,$x=0,$Y=0,$D=0,$p=NaN,$g=NaN,$l=NaN,$v=NaN,$y=NaN,$E=NaN,$h=NaN,$X=NaN,$B=0;for($R=0,$B=2;$R<$G;$R++,$B+=6)$P=$b[$B],$k=$b[$B+1],$r=$b[$B+2],$x=$b[$B+3],$y=2*($p=.1875*($s-2*$P+$r))+($l=.09375*(3*($P-$r)-$s+($Y=$b[$B+4]))),$E=2*($g=.1875*($z-2*$k+$x))+($v=.09375*(3*($k-$x)-$z+($D=$b[$B+5]))),$h=.75*($P-$s)+$p+.16666667*$l,$X=.75*($k-$z)+$g+.16666667*$v,$O+=Math.sqrt($h*$h+$X*$X),$h+=$y,$X+=$E,$y+=$l,$E+=$v,$O+=Math.sqrt($h*$h+$X*$X),$h+=$y,$X+=$E,$O+=Math.sqrt($h*$h+$X*$X),$h+=$y+$l,$X+=$E+$v,$O+=Math.sqrt($h*$h+$X*$X),$W[$R]=$O,$s=$Y,$z=$D;if($_&&($q*=$O),$V)for($R=0;$R<$T;$R++)$f[$R]*=$O;var $a=this._segments,$u=0,$$=0;for($$=$S=$J=$R=0;$R<$T;$R++,$J+=3)if(($U=$q+=$C=$f[$R])<0)this.addBeforePosition($U,$b,0,$L,$J);else if($O<$U)this.addAfterPosition($U-$O,$b,$A-4,$L,$J);else{for(;;$S++)if(!(($w=$W[$S])<$U)){0==$S?$U/=$w:$U=($U-($N=$W[$S-1]))/($w-$N);break}if($S!=$M){var $Q=6*($M=$S);for($s=$b[$Q],$z=$b[$Q+1],$P=$b[$Q+2],$k=$b[$Q+3],$r=$b[$Q+4],$x=$b[$Q+5],$y=2*($p=.03*($s-2*$P+$r))+($l=.006*(3*($P-$r)-$s+($Y=$b[$Q+6]))),$E=2*($g=.03*($z-2*$k+$x))+($v=.006*(3*($k-$x)-$z+($D=$b[$Q+7]))),$h=.3*($P-$s)+$p+.16666667*$l,$X=.3*($k-$z)+$g+.16666667*$v,$u=Math.sqrt($h*$h+$X*$X),$a[0]=$u,$Q=1;$Q<8;$Q++)$h+=$y,$X+=$E,$y+=$l,$E+=$v,$u+=Math.sqrt($h*$h+$X*$X),$a[$Q]=$u;$h+=$y,$X+=$E,$u+=Math.sqrt($h*$h+$X*$X),$a[8]=$u,$h+=$y+$l,$X+=$E+$v,$u+=Math.sqrt($h*$h+$X*$X),$a[9]=$u,$$=0}for($U*=$u;;$$++)if(!(($w=$a[$$])<$U)){0==$$?$U/=$w:$U=$$+($U-($N=$a[$$-1]))/($w-$N);break}this.addCurvePosition(.1*$U,$s,$z,$P,$k,$r,$x,$Y,$D,$L,$J,$K||0<$R&&0==$C)}return $L},$t.addBeforePosition=function($t,$H,$I,$T,$K){var $_=$H[$I],$V=$H[$I+1],$e=$H[$I+2]-$_,$R=$H[$I+3]-$V,$A=Math.atan2($R,$e);$T[$K]=$_+$t*Math.cos($A),$T[$K+1]=$V+$t*Math.sin($A),$T[$K+2]=$A},$t.addAfterPosition=function($t,$H,$I,$T,$K){var $_=$H[$I+2],$V=$H[$I+3],$e=$_-$H[$I],$R=$V-$H[$I+1],$A=Math.atan2($R,$e);$T[$K]=$_+$t*Math.cos($A),$T[$K+1]=$V+$t*Math.sin($A),$T[$K+2]=$A},$t.addCurvePosition=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q,$f){0==$t&&($t=1e-4);var $b=$t*$t,$L=$b*$t,$G=1-$t,$M=$G*$G,$O=$M*$G,$J=$G*$t,$S=3*$J,$U=$G*$S,$C=$S*$t,$N=$H*$O+$T*$U+$_*$C+$e*$L,$w=$I*$O+$K*$U+$V*$C+$R*$L;$A[$q]=$N,$A[$q+1]=$w,$A[$q+2]=$f?Math.atan2($w-($I*$M+$K*$J*2+$V*$b),$N-($H*$M+$T*$J*2+$_*$b)):0},$p.NONE=-1,$p.BEFORE=-2,$p.AFTER=-3,$I($p,["_tempMt",function(){return this._tempMt=new $Yt}]),$p}(),$Bt=function(){function $t(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $T($t,"laya.ani.bone.PathConstraintData"),$t}(),$at=function(){function $t(){this.name=null,this.slotArr=[]}return $T($t,"laya.ani.bone.SkinData"),$t}(),$ut=function(){function $t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$T($t,"laya.ani.bone.SkinSlotDisplayData");var $H=$t.prototype;return $H.createTexture=function($t){return this.texture||(this.texture=new $Dt($t.bitmap,this.uvs),$t.bitmap.alphaTexture&&(this.texture.alphaTexture=new $Dt($t.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$t.height,this.texture.height=$t.width,this.texture.offsetX=-$t.offsetX,this.texture.offsetY=-$t.offsetY,this.texture.sourceWidth=$t.sourceHeight,this.texture.sourceHeight=$t.sourceWidth):(this.texture.width=$t.width,this.texture.height=$t.height,this.texture.offsetX=-$t.offsetX,this.texture.offsetY=-$t.offsetY,this.texture.sourceWidth=$t.sourceWidth,this.texture.sourceHeight=$t.sourceHeight),$O.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$H.destory=function(){this.texture&&this.texture.destroy()},$t}(),$$t=function(){function $t(){this.name=null,this.displayArr=[]}return $T($t,"laya.ani.bone.SlotData"),$t.prototype.getDisplayByName=function($t){for(var $H=0,$I=this.displayArr.length;$H<$I;$H++)if(this.displayArr[$H].attachmentName==$t)return $H;return-1},$t}(),$w=function(){function $t($t,$H){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$M(2,0),this._data=$t,null==this._bones&&(this._bones=[]),this.target=$H[$t.targetIndex];var $I,$T=0;for($T=0,$I=$t.boneIndexs.length;$T<$I;$T++)this._bones.push($H[$t.boneIndexs[$T]]);this.rotateMix=$t.rotateMix,this.translateMix=$t.translateMix,this.scaleMix=$t.scaleMix,this.shearMix=$t.shearMix}return $T($t,"laya.ani.bone.TfConstraint"),$t.prototype.apply=function(){for(var $t,$H=this.target.resultMatrix.a,$I=this.target.resultMatrix.b,$T=this.target.resultMatrix.c,$K=this.target.resultMatrix.d,$_=0,$V=this._bones.length;$_<$V;$_++){if($t=this._bones[$_],0<this.rotateMix){var $e=$t.resultMatrix.a,$R=$t.resultMatrix.b,$A=$t.resultMatrix.c,$q=$t.resultMatrix.d,$f=Math.atan2($T,$H)-Math.atan2($A,$e)+this._data.offsetRotation*Math.PI/180;$f>Math.PI?$f-=2*Math.PI:$f<-Math.PI&&($f+=2*Math.PI),$f*=this.rotateMix;var $b=Math.cos($f),$L=Math.sin($f);$t.resultMatrix.a=$b*$e-$L*$A,$t.resultMatrix.b=$b*$R-$L*$q,$t.resultMatrix.c=$L*$e+$b*$A,$t.resultMatrix.d=$L*$R+$b*$q}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$t.resultMatrix.tx+=(this._temp[0]-$t.resultMatrix.tx)*this.translateMix,$t.resultMatrix.ty+=(this._temp[1]-$t.resultMatrix.ty)*this.translateMix,$t.updateChild()),0<this.scaleMix){var $G=Math.sqrt($t.resultMatrix.a*$t.resultMatrix.a+$t.resultMatrix.c*$t.resultMatrix.c),$M=Math.sqrt($H*$H+$T*$T),$O=1e-5<$G?($G+($M-$G+this._data.offsetScaleX)*this.scaleMix)/$G:0;$t.resultMatrix.a*=$O,$t.resultMatrix.c*=$O,$G=Math.sqrt($t.resultMatrix.b*$t.resultMatrix.b+$t.resultMatrix.d*$t.resultMatrix.d),$M=Math.sqrt($I*$I+$K*$K),$O=1e-5<$G?($G+($M-$G+this._data.offsetScaleY)*this.scaleMix)/$G:0,$t.resultMatrix.b*=$O,$t.resultMatrix.d*=$O}if(0<this.shearMix){$R=$t.resultMatrix.b,$q=$t.resultMatrix.d;var $J=Math.atan2($q,$R);($f=Math.atan2($K,$I)-Math.atan2($T,$H)-($J-Math.atan2($t.resultMatrix.c,$t.resultMatrix.a)))>Math.PI?$f-=2*Math.PI:$f<-Math.PI&&($f+=2*Math.PI),$f=$J+($f+this._data.offsetShearY*Math.PI/180)*this.shearMix,$O=Math.sqrt($R*$R+$q*$q),$t.resultMatrix.b=Math.cos($f)*$O,$t.resultMatrix.d=Math.sin($f)*$O}}},$t}(),$Qt=function(){function $t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $T($t,"laya.ani.bone.TfConstraintData"),$t}(),$mt=function(){function $t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$T($t,"laya.ani.bone.Transform");var $H=$t.prototype;return $H.initData=function($t){null!=$t.x&&(this.x=$t.x),null!=$t.y&&(this.y=$t.y),null!=$t.skX&&(this.skX=$t.skX),null!=$t.skY&&(this.skY=$t.skY),null!=$t.scX&&(this.scX=$t.scX),null!=$t.scY&&(this.scY=$t.scY)},$H.getMatrix=function(){var $t;return($t=this.mMatrix?this.mMatrix:this.mMatrix=new $Yt).identity(),$t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$t.rotate(this.skX*Math.PI/180),$t.translate(this.x,this.y),$t},$H.skew=function($t,$H,$I){var $T=Math.sin($I),$K=Math.cos($I),$_=Math.sin($H),$V=Math.cos($H);return $t.setTo($t.a*$V-$t.b*$T,$t.a*$_+$t.b*$K,$t.c*$V-$t.d*$T,$t.c*$_+$t.d*$K,$t.tx*$V-$t.ty*$T,$t.tx*$_+$t.ty*$K),$t},$t}(),$W=function(){function $t(){}return $T($t,"laya.ani.bone.UVTools"),$t.getRelativeUV=function($t,$H,$I){var $T=$t[0],$K=$t[2]-$t[0],$_=$t[1],$V=$t[5]-$t[1];$I||($I=[]),$I.length=$H.length;var $e,$R=0;$e=$I.length;var $A=1/$K,$q=1/$V;for($R=0;$R<$e;$R+=2)$I[$R]=($H[$R]-$T)*$A,$I[$R+1]=($H[$R+1]-$_)*$q;return $I},$t.getAbsoluteUV=function($t,$H,$I){if(0==$t[0]&&0==$t[1]&&1==$t[4]&&1==$t[5])return $I?($J.copyArray($I,$H),$I):$H;var $T=$t[0],$K=$t[2]-$t[0],$_=$t[1],$V=$t[5]-$t[1];$I||($I=[]),$I.length=$H.length;var $e,$R=0;for($e=$I.length,$R=0;$R<$e;$R+=2)$I[$R]=$H[$R]*$K+$T,$I[$R+1]=$H[$R+1]*$V+$_;return $I},$t}(),$p=function(){function $t(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $T($t,"laya.ani.KeyFramesContent"),$t}(),$s=function(){function $q(){}return $T($q,"laya.ani.math.BezierLerp"),$q.getBezierRate=function($t,$H,$I,$T,$K){var $_=$q._getBezierParamKey($H,$I,$T,$K),$V=100*$_+$t;if($q._bezierResultCache[$V])return $q._bezierResultCache[$V];var $e,$R=$q._getBezierPoints($H,$I,$T,$K,$_),$A=0;for($e=$R.length,$A=0;$A<$e;$A+=2)if($t<=$R[$A])return $q._bezierResultCache[$V]=$R[$A+1],$R[$A+1];return $q._bezierResultCache[$V]=1},$q._getBezierParamKey=function($t,$H,$I,$T){return 100*(100*(100*(100*$t+$H)+$I)+$T)},$q._getBezierPoints=function($t,$H,$I,$T,$K){return $q._bezierPointsCache[$K]?$q._bezierPointsCache[$K]:($_=[0,0,$t,$H,$I,$T,1,1],$V=(new $e).getBezierPoints($_,100,3),$q._bezierPointsCache[$K]=$V);var $_,$V},$q._bezierResultCache={},$q._bezierPointsCache={},$q}(),$z=function($t){function $H(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$H.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$T($H,"laya.ani.AnimationPlayer",$K);var $I=$H.prototype;return $Kt.imps($I,{"laya.resource.IDestroy":!0}),$I._onTempletLoadedComputeFullKeyframeIndices=function($t,$H,$I){this._templet===$I&&this._cachePlayRate===$t&&this._cacheFrameRate===$H&&this._computeFullKeyframeIndices()},$I._computeFullKeyframeIndices=function(){for(var $t=this._fullFrames=[],$H=this._templet,$I=this._cacheFrameRateInterval*this._cachePlayRate,$T=0,$K=$H.getAnimationCount();$T<$K;$T++){for(var $_=[],$V=0,$e=$H.getAnimation($T).nodes.length;$V<$e;$V++){for(var $R=$H.getAnimation($T).nodes[$V],$A=Math.floor($R.playTime/$I+.01),$q=new Uint16Array($A+1),$f=-1,$b=0,$L=$R.keyFrame.length;$b<$L;$b++){var $G=$R.keyFrame[$b],$M=$G.startTime,$O=$M+$G.duration+$I;do{for(var $J=Math.floor($M/$I+.5),$S=$f+1;$S<$J;$S++)$q[$S]=$b;$q[$f=$J]=$b,$M+=$I}while($M<=$O)}$_.push($q)}$t.push($_)}},$I._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$I._calculatePlayDuration=function(){if(0!==this.state){var $t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$t),this._playEnd>$t&&(this._playEnd=$t),this._playDuration=this._playEnd-this._playStart}},$I._setPlayParams=function($t,$H){this._currentTime=$t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$H+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$H},$I._setPlayParamsWhenStop=function($t,$H){this._currentTime=$t,this._currentKeyframeIndex=Math.max(Math.floor($t/$H+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$H,this._currentAnimationClipIndex=-1},$I._update=function($t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $H=this._cacheFrameRateInterval*this._cachePlayRate,$I=0;this._startUpdateLoopCount!==$G.loopCount&&($I=$t*this.playbackRate,this._elapsedPlaybackTime+=$I);var $T=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$T)return this._setPlayParamsWhenStop($T,$H),void this.event("stopped");if($I+=this._currentTime,0<$T)if($T<=$I)do{if($I-=$T,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($T,$H),this._stopWhenCircleFinish=!1,void this.event("stopped");$I<$T&&(this._setPlayParams($I,$H),this.event("complete"))}while($T<=$I);else this._setPlayParams($I,$H);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($T,$H),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$I._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$I.play=function($t,$H,$I,$T,$K){if(void 0===$t&&($t=0),void 0===$H&&($H=1),void 0===$I&&($I=2147483647),void 0===$T&&($T=0),void 0===$K&&($K=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($I<0||$T<0||$K<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$K&&$K<$T)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$H,this._overallDuration=$I,this._playStart=$T,this._playEnd=$K,this._paused=!1,this._currentAnimationClipIndex=$t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$G.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$I.playByFrame=function($t,$H,$I,$T,$K,$_){void 0===$t&&($t=0),void 0===$H&&($H=1),void 0===$I&&($I=2147483647),void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$_&&($_=30);var $V=1e3/$_;this.play($t,$H,$I,$T*$V,$K*$V)},$I.stop=function($t){void 0===$t&&($t=!0),$t?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$_(0,$I,"playEnd",function(){return this._playEnd}),$_(0,$I,"templet",function(){return this._templet},function($t){0===!this.state&&this.stop(!0),this._templet!==$t&&((this._templet=$t).loaded?this._computeFullKeyframeIndices():$t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$_(0,$I,"playStart",function(){return this._playStart}),$_(0,$I,"playDuration",function(){return this._playDuration}),$_(0,$I,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$_(0,$I,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$_(0,$I,"overallDuration",function(){return this._overallDuration}),$_(0,$I,"currentFrameTime",function(){return this._currentFrameTime}),$_(0,$I,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$_(0,$I,"currentPlayTime",function(){return this._currentTime+this._playStart}),$_(0,$I,"cachePlayRate",function(){return this._cachePlayRate},function($t){this._cachePlayRate!==$t&&(this._cachePlayRate=$t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$t,this._cacheFrameRate])))}),$_(0,$I,"cacheFrameRate",function(){return this._cacheFrameRate},function($t){this._cacheFrameRate!==$t&&(this._cacheFrameRate=$t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$t])))}),$_(0,$I,"currentTime",null,function($t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($t<this._playStart||$t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$G.loopCount;var $H=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$H),0),this._currentFrameTime=this._currentKeyframeIndex*$H}}),$_(0,$I,"paused",function(){return this._paused},function($t){(this._paused=$t)&&this.event("paused")}),$_(0,$I,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$_(0,$I,"destroyed",function(){return this._destroyed}),$H}(),$g=function($t){function $H(){$H.__super.call(this),$O.isConchNode&&(this.drawSkin=function($t){$t.transform||($t.transform=$Yt.EMPTY),this._addCmd([$t]),this.setSkinMesh&&this.setSkinMesh($t._ps,$t.mVBData,$t.mEleNum,0,$t.mTexture,$t.transform)})}return $T($H,"laya.ani.GraphicsAni",$V),$H.prototype.drawSkin=function($t){var $H=[$t];this._saveToCmd($O._context._drawSkin,$H)},$H.create=function(){return $H._caches.pop()||new $H},$H.recycle=function($t){$t.clear(),$H._caches.push($t)},$H._caches=[],$H}(),$l=function($t){function $S(){this._aniMap={},this.unfixedLastAniIndex=-1,$S.__super.call(this),this._anis=new Array}$T($S,"laya.ani.AnimationTemplet",$q);var $H=$S.prototype;return $H.parse=function($t){var $H=new $xt($t);this._aniVersion=$H.readUTFString(),$U.parse(this,$H)},$H._calculateKeyFrame=function($t,$H,$I){var $T=$t.keyFrame;$T[$H]=$T[0];for(var $K=0;$K<$H;$K++){var $_=$T[$K];$_.nextData=0===$_.duration?$_.data:$T[$K+1].data}$T.length--},$H.onAsynLoaded=function($t,$H,$I){var $T=new $xt($H);switch(this._aniVersion=$T.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$C.parse(this,$T);break;default:$U.parse(this,$T)}this._endLoaded()},$H.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$H.getAnimationCount=function(){return this._anis.length},$H.getAnimation=function($t){return this._anis[$t]},$H.getAniDuration=function($t){return this._anis[$t].playTime},$H.getNodes=function($t){return this._anis[$t].nodes},$H.getNodeIndexWithName=function($t,$H){return this._anis[$t].bone3DMap[$H]},$H.getNodeCount=function($t){return this._anis[$t].nodes.length},$H.getTotalkeyframesLength=function($t){return this._anis[$t].totalKeyframeDatasLength},$H.getPublicExtData=function(){return this._publicExtData},$H.getAnimationDataWithCache=function($t,$H,$I,$T){var $K=$H[$I];if($K){var $_=$K[$t];return $_?$_[$T]:null}return null},$H.setAnimationDataWithCache=function($t,$H,$I,$T,$K){var $_=$H[$I]||($H[$I]={});($_[$t]||($_[$t]=[]))[$T]=$K},$H.getOriginalData=function($t,$H,$I,$T,$K){for(var $_=this._anis[$t].nodes,$V=0,$e=0,$R=$_.length,$A=0;$e<$R;$e++){var $q,$f=$_[$e];$q=$f.keyFrame[$I[$e][$T]],$f.dataOffset=$A;var $b=$K-$q.startTime,$L=$f.lerpType;if($L)switch($L){case 0:case 1:for($V=0;$V<$f.keyframeWidth;)$V+=$f.interpolationMethod[$V]($f,$V,$H,$A+$V,$q.data,$b,null,$q.duration,$q.nextData);break;case 2:var $G=$q.interpolationData,$M=$G.length,$O=0;for($V=0;$V<$M;){var $J=$G[$V];switch($J){case 6:case 7:$V+=$S.interpolation[$J]($f,$O,$H,$A+$O,$q.data,$b,null,$q.duration,$q.nextData,$G,$V+1);break;default:$V+=$S.interpolation[$J]($f,$O,$H,$A+$O,$q.data,$b,null,$q.duration,$q.nextData)}$O++}}else for($V=0;$V<$f.keyframeWidth;)$V+=$f.interpolationMethod[$V]($f,$V,$H,$A+$V,$q.data,$b,null,$q.duration,$q.nextData);$A+=$f.keyframeWidth}},$H.getNodesCurrentFrameIndex=function($t,$H){var $I=this._anis[$t].nodes;$t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($I.length),this.unfixedCurrentTimes=new Float32Array($I.length),this.unfixedLastAniIndex=$t);for(var $T=0,$K=$I.length;$T<$K;$T++){var $_=$I[$T];for($H<this.unfixedCurrentTimes[$T]&&(this.unfixedCurrentFrameIndexes[$T]=0),this.unfixedCurrentTimes[$T]=$H;this.unfixedCurrentFrameIndexes[$T]<$_.keyFrame.length&&!($_.keyFrame[this.unfixedCurrentFrameIndexes[$T]].startTime>this.unfixedCurrentTimes[$T]);)this.unfixedCurrentFrameIndexes[$T]++;this.unfixedCurrentFrameIndexes[$T]--}return this.unfixedCurrentFrameIndexes},$H.getOriginalDataUnfixedRate=function($t,$H,$I){var $T=this._anis[$t].nodes;$t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($T.length),this.unfixedCurrentTimes=new Float32Array($T.length),this.unfixedKeyframes=$M($T.length),this.unfixedLastAniIndex=$t);for(var $K=0,$_=0,$V=$T.length,$e=0;$_<$V;$_++){var $R=$T[$_];for($I<this.unfixedCurrentTimes[$_]&&(this.unfixedCurrentFrameIndexes[$_]=0),this.unfixedCurrentTimes[$_]=$I;this.unfixedCurrentFrameIndexes[$_]<$R.keyFrame.length&&!($R.keyFrame[this.unfixedCurrentFrameIndexes[$_]].startTime>this.unfixedCurrentTimes[$_]);)this.unfixedKeyframes[$_]=$R.keyFrame[this.unfixedCurrentFrameIndexes[$_]],this.unfixedCurrentFrameIndexes[$_]++;var $A=this.unfixedKeyframes[$_];$R.dataOffset=$e;var $q=$I-$A.startTime;if($R.lerpType)switch($R.lerpType){case 0:case 1:for($K=0;$K<$R.keyframeWidth;)$K+=$R.interpolationMethod[$K]($R,$K,$H,$e+$K,$A.data,$q,null,$A.duration,$A.nextData);break;case 2:var $f=$A.interpolationData,$b=$f.length,$L=0;for($K=0;$K<$b;){var $G=$f[$K];switch($G){case 6:case 7:$K+=$S.interpolation[$G]($R,$L,$H,$e+$L,$A.data,$q,null,$A.duration,$A.nextData,$f,$K+1);break;default:$K+=$S.interpolation[$G]($R,$L,$H,$e+$L,$A.data,$q,null,$A.duration,$A.nextData)}$L++}}else for($K=0;$K<$R.keyframeWidth;)$K+=$R.interpolationMethod[$K]($R,$K,$H,$e+$K,$A.data,$q,null,$A.duration,$A.nextData);$e+=$R.keyframeWidth}},$S._LinearInterpolation_0=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){var $q=0===$e?0:$_/$e;return $I[$T]=(1-$q)*$K[$H]+$q*$R[$H],1},$S._QuaternionInterpolation_1=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){var $q=0===$e?0:$_/$e;return $b.slerpQuaternionArray($K,$H,$R,$H,$q,$I,$T),4},$S._AngleInterpolation_2=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){return 0},$S._RadiansInterpolation_3=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){return 0},$S._Matrix4x4Interpolation_4=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){for(var $q=0;$q<16;$q++,$H++)$I[$T+$q]=$K[$H]+$_*$V[$H];return 16},$S._NoInterpolation_5=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A){return $I[$T]=$K[$H],1},$S._BezierInterpolation_6=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q){return void 0===$q&&($q=0),$I[$T]=$K[$H]+($R[$H]-$K[$H])*$s.getBezierRate($_/$e,$A[$q],$A[$q+1],$A[$q+2],$A[$q+3]),5},$S._BezierInterpolation_7=function($t,$H,$I,$T,$K,$_,$V,$e,$R,$A,$q){return void 0===$q&&($q=0),$I[$T]=$A[$q+4]+$A[$q+5]*$s.getBezierRate((.001*$_+$A[$q+6])/$A[$q+7],$A[$q],$A[$q+1],$A[$q+2],$A[$q+3]),9},$S.load=function($t){return $Kt.loader.create($t,null,null,$S)},$S.interpolation=[$S._LinearInterpolation_0,$S._QuaternionInterpolation_1,$S._AngleInterpolation_2,$S._RadiansInterpolation_3,$S._Matrix4x4Interpolation_4,$S._NoInterpolation_5,$S._BezierInterpolation_6,$S._BezierInterpolation_7],$S}(),$P=function($H){function $I($t,$H){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$I.__super.call(this),void 0===$H&&($H=0),$t&&this.init($t,$H)}$T($I,"laya.ani.bone.Skeleton",$H);var $t=$I.prototype;return $t.init=function($t,$H){void 0===$H&&($H=0);var $I,$T,$K,$_=0,$V=0;if(1==$H)for(this._graphicsCache=[],$_=0,$V=$t.getAnimationCount();$_<$V;$_++)this._graphicsCache.push([]);if(this._yReverseMatrix=$t.yReverseMatrix,this._aniMode=$H,this._templet=$t,this._player=new $z,this._player.cacheFrameRate=$t.rate,this._player.templet=$t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$t.mBoneArr,this._rootBone=$t.mRootBone,this._aniSectionDic=$t.aniSectionDic,0<$t.ikArr.length)for(this._ikArr=[],$_=0,$V=$t.ikArr.length;$_<$V;$_++)this._ikArr.push(new $S($t.ikArr[$_],this._boneList));if(0<$t.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$_=0,$V=$t.pathArr.length;$_<$V;$_++)$I=$t.pathArr[$_],$T=new $N($I,this._boneList),($K=this._boneSlotDic[$I.name])&&(($T=new $N($I,this._boneList)).target=$K),this._pathDic[$I.name]=$T;if(0<$t.tfArr.length)for(this._tfArr=[],$_=0,$V=$t.tfArr.length;$_<$V;$_++)this._tfArr.push(new $w($t.tfArr[$_],this._boneList));if(0<$t.skinDataArray.length){var $e=this._templet.skinDataArray[this._skinIndex];this._skinName=$e.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$t.load=function($t,$H,$I){},$t._onLoaded=function(){},$t._parseComplete=function(){var $t=$k.TEMPLET_DICTIONARY[this._aniPath];$t&&(this.init($t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$t._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$t._onPlay=function(){this.event("played")},$t._onStop=function(){var $t,$H=this._templet.eventAniArr[this._aniClipIndex];if($H&&this._eventIndex<$H.length)for(;this._eventIndex<$H.length;this._eventIndex++)($t=$H[this._eventIndex]).time>=this._player.playStart&&$t.time<=this._player.playEnd&&this.event("label",$t);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$t._onPause=function(){this.event("paused")},$t._parseSrcBoneMatrix=function(){var $t=0,$H=0;for($H=this._templet.srcBoneMatrixArr.length,$t=0;$t<$H;$t++)this._boneMatrixArray.push(new $Yt);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $I,$T,$K=this._templet.boneSlotArray;for($t=0,$H=$K.length;$t<$H;$t++)$I=$K[$t],null==($T=this._bindBoneBoneSlotDic[$I.parent])&&(this._bindBoneBoneSlotDic[$I.parent]=$T=[]),this._boneSlotDic[$I.name]=$I=$I.copy(),$T.push($I),this._boneSlotArray.push($I)}},$t._emitMissedEvents=function($t,$H,$I){void 0===$I&&($I=0);var $T=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($T){var $K,$_,$V=0;for($K=$T.length,$V=$I;$V<$K;$V++)($_=$T[$V]).time>=this._player.playStart&&$_.time<=this._player.playEnd&&this.event("label",$_)}},$t._update=function($t){if(void 0===$t&&($t=!0),!(this._pause||$t&&this._indexControl)){var $H=this.timer.currTimer,$I=this._player.currentKeyframeIndex,$T=$H-this._lastTime;if($t?this._player._update($T):$I=-1,this._lastTime=$H,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$T&&this._clipIndex==$I&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $K;this._lastUpdateAniClipIndex=this._aniClipIndex,$I>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $_,$V=this._templet.eventAniArr[this._aniClipIndex];if($V&&this._eventIndex<$V.length&&(($K=$V[this._eventIndex]).time>=this._player.playStart&&$K.time<=this._player.playEnd?this._player.currentPlayTime>=$K.time&&(this.event("label",$K),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($_=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$_&&(this.graphics=$_));var $e=0,$R=0;for($R=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$R-1)&&0<$R;)$R--;if($R<this._clipIndex)for($e=$R;$e<this._clipIndex;$e++)this._createGraphics($e)}else if(1==this._aniMode){if($_=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$_&&(this.graphics=$_));for($R=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$R-1)&&0<$R;)$R--;if($R<this._clipIndex)for($e=$R;$e<this._clipIndex;$e++)this._createGraphics($e)}this._createGraphics()}}},$t._createGraphics=function($t){void 0===$t&&($t=-1),-1==$t&&($t=this._clipIndex);var $H,$I,$T=$t*this._player.cacheFrameRateInterval,$K=this._templet.drawOrderAniArr[this._aniClipIndex];if($K&&0<$K.length)for(this._drawOrderIndex=0,$H=$K[this._drawOrderIndex];$T>=$H.time&&(this._drawOrder=$H.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$K.length));)$H=$K[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$g.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$g.create(),$I=this.graphics;var $_=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$t,$T);var $V,$e,$R,$A,$q=this._aniSectionDic[this._aniClipIndex],$f=0,$b=0,$L=0,$G=0,$M=0,$O=this._templet.srcBoneMatrixArr.length;for($M=$q[$b=0];$b<$O;$b++)$A=this._boneList[$b],$R=this._templet.srcBoneMatrixArr[$b],$A.resultTransform.scX=$R.scX*this._curOriginalData[$f++],$A.resultTransform.skX=$R.skX+this._curOriginalData[$f++],$A.resultTransform.skY=$R.skY+this._curOriginalData[$f++],$A.resultTransform.scY=$R.scY*this._curOriginalData[$f++],$A.resultTransform.x=$R.x+this._curOriginalData[$f++],$A.resultTransform.y=$R.y+this._curOriginalData[$f++],8===this._templet.tMatrixDataLen&&($A.resultTransform.skewX=$R.skewX+this._curOriginalData[$f++],$A.resultTransform.skewY=$R.skewY+this._curOriginalData[$f++]);var $J,$S={},$U={};for($M+=$q[1];$b<$M;$b++)$S[($J=$_[$b]).name]=this._curOriginalData[$f++],$U[$J.name]=this._curOriginalData[$f++],this._curOriginalData[$f++],this._curOriginalData[$f++],this._curOriginalData[$f++],this._curOriginalData[$f++];var $C,$N,$w={},$W={};for($M+=$q[2];$b<$M;$b++)$w[($J=$_[$b]).name]=this._curOriginalData[$f++],$W[$J.name]=this._curOriginalData[$f++],this._curOriginalData[$f++],this._curOriginalData[$f++],this._curOriginalData[$f++],this._curOriginalData[$f++];if(this._pathDic)for($M+=$q[3];$b<$M;$b++){if($J=$_[$b],$C=this._pathDic[$J.name])switch(new $xt($J.extenData).getByte()){case 1:$C.position=this._curOriginalData[$f++];break;case 2:$C.spacing=this._curOriginalData[$f++];break;case 3:$C.rotateMix=this._curOriginalData[$f++],$C.translateMix=this._curOriginalData[$f++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($Yt.TEMP.identity()),this._ikArr)for($b=0,$M=this._ikArr.length;$b<$M;$b++)$N=this._ikArr[$b],$w.hasOwnProperty($N.name)&&($N.bendDirection=$w[$N.name]),$W.hasOwnProperty($N.name)&&($N.mix=$W[$N.name]),$N.apply();if(this._pathDic)for(var $s in this._pathDic)($C=this._pathDic[$s]).apply(this._boneList,$I);if(this._tfArr)for($b=0,$G=this._tfArr.length;$b<$G;$b++)this._tfArr[$b].apply();for($b=0,$G=this._boneList.length;$b<$G;$b++)if($A=this._boneList[$b],$e=this._bindBoneBoneSlotDic[$A.name],$A.resultMatrix.copyTo(this._boneMatrixArray[$b]),$e)for($L=0,$M=$e.length;$L<$M;$L++)($V=$e[$L])&&$V.setParentMatrix($A.resultMatrix);var $z,$P,$k,$r,$x={},$Y=this._templet.deformAniArr;if($Y&&0<$Y.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$b=0,$M=this._boneSlotArray.length;$b<$M;$b++)($V=this._boneSlotArray[$b]).deformData=null;var $D,$p=$Y[this._aniClipIndex];for($D in $z=$p.default,this._setDeform($z,$x,this._boneSlotArray,$T),$p)"default"!=$D&&$D!=this._skinName&&($z=$p[$D],this._setDeform($z,$x,this._boneSlotArray,$T));$z=$p[this._skinName],this._setDeform($z,$x,this._boneSlotArray,$T)}if(this._drawOrder)for($b=0,$M=this._drawOrder.length;$b<$M;$b++)$P=$S[($V=this._boneSlotArray[this._drawOrder[$b]]).name],$k=$U[$V.name],isNaN($k)||($I.save(),$I.alpha($k)),isNaN($P)||-2==$P||(this._templet.attachmentNames?$V.showDisplayByName(this._templet.attachmentNames[$P]):$V.showDisplayByIndex($P)),$x[this._drawOrder[$b]]?($r=$x[this._drawOrder[$b]],$V.currDisplayData&&$r[$V.currDisplayData.attachmentName]?$V.deformData=$r[$V.currDisplayData.attachmentName]:$V.deformData=null):$V.deformData=null,isNaN($k)?$V.draw($I,this._boneMatrixArray,2==this._aniMode):$V.draw($I,this._boneMatrixArray,2==this._aniMode,$k),isNaN($k)||$I.restore();else for($b=0,$M=this._boneSlotArray.length;$b<$M;$b++)$P=$S[($V=this._boneSlotArray[$b]).name],$k=$U[$V.name],isNaN($k)||($I.save(),$I.alpha($k)),isNaN($P)||-2==$P||(this._templet.attachmentNames?$V.showDisplayByName(this._templet.attachmentNames[$P]):$V.showDisplayByIndex($P)),$x[$b]?($r=$x[$b],$V.currDisplayData&&$r[$V.currDisplayData.attachmentName]?$V.deformData=$r[$V.currDisplayData.attachmentName]:$V.deformData=null):$V.deformData=null,isNaN($k)?$V.draw($I,this._boneMatrixArray,2==this._aniMode):$V.draw($I,this._boneMatrixArray,2==this._aniMode,$k),isNaN($k)||$I.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$t,$I):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$t,$I)},$t._setDeform=function($t,$H,$I,$T){if($t){var $K,$_,$V,$e=0,$R=0,$A=0;if($t)for($e=0,$R=$t.deformSlotDataList.length;$e<$R;$e++)for($K=$t.deformSlotDataList[$e],$A=0;$A<$K.deformSlotDisplayList.length;$A++)$V=$I[($_=$K.deformSlotDisplayList[$A]).slotIndex],$_.apply($T,$V),$H[$_.slotIndex]||($H[$_.slotIndex]={}),$H[$_.slotIndex][$_.attachment]=$_.deformData}},$t.getAnimNum=function(){return this._templet.getAnimationCount()},$t.getAniNameByIndex=function($t){return this._templet.getAniNameByIndex($t)},$t.getSlotByName=function($t){return this._boneSlotDic[$t]},$t.showSkinByName=function($t,$H){void 0===$H&&($H=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($t),$H)},$t.showSkinByIndex=function($t,$H){void 0===$H&&($H=!0);for(var $I=0;$I<this._boneSlotArray.length;$I++)this._boneSlotArray[$I].showSlotData(null,$H);if(this._templet.showSkinByIndex(this._boneSlotDic,$t,$H)){var $T=this._templet.skinDataArray[$t];this._skinIndex=$t,this._skinName=$T.name}this._clearCache()},$t.showSlotSkinByIndex=function($t,$H){if(0!=this._aniMode){var $I=this.getSlotByName($t);$I&&$I.showDisplayByIndex($H),this._clearCache()}},$t.showSlotSkinByName=function($t,$H){if(0!=this._aniMode){var $I=this.getSlotByName($t);$I&&$I.showDisplayByName($H),this._clearCache()}},$t.replaceSlotSkinName=function($t,$H,$I){if(0!=this._aniMode){var $T=this.getSlotByName($t);$T&&$T.replaceDisplayByName($H,$I),this._clearCache()}},$t.replaceSlotSkinByIndex=function($t,$H,$I){if(0!=this._aniMode){var $T=this.getSlotByName($t);$T&&$T.replaceDisplayByIndex($H,$I),this._clearCache()}},$t.setSlotSkin=function($t,$H){if(0!=this._aniMode){var $I=this.getSlotByName($t);$I&&$I.replaceSkin($H),this._clearCache()}},$t._clearCache=function(){if(1==this._aniMode)for(var $t=0,$H=this._graphicsCache.length;$t<$H;$t++){for(var $I=0,$T=this._graphicsCache[$t].length;$I<$T;$I++){var $K=this._graphicsCache[$t][$I];$K!=this.graphics&&$g.recycle($K)}this._graphicsCache[$t].length=0}},$t.play=function($t,$H,$I,$T,$K,$_){void 0===$I&&($I=!0),void 0===$T&&($T=0),void 0===$K&&($K=0),void 0===$_&&($_=!0),this._indexControl=!1;var $V=-1,$e=NaN;if($e=$H?2147483647:0,"string"==typeof $t)for(var $R=0,$A=this._templet.getAnimationCount();$R<$A;$R++){var $q=this._templet.getAnimation($R);if($q&&$t==$q.name){$V=$R;break}}else $V=$t;-1<$V&&$V<this.getAnimNum()&&(this._aniClipIndex=$V,($I||this._pause||this._currAniIndex!=$V)&&(this._currAniIndex=$V,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($V)),this._drawOrder=null,this._eventIndex=0,this._player.play($V,this._player.playbackRate,$e,$T,$K),$_&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$f.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$t.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$t.playbackRate=function($t){this._player&&(this._player.playbackRate=$t)},$t.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$t.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$f.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$t._getGrahicsDataWithCache=function($t,$H){return this._graphicsCache[$t][$H]},$t._setGrahicsDataWithCache=function($t,$H,$I){this._graphicsCache[$t][$H]=$I},$t.destroy=function($t){void 0===$t&&($t=!0),$H.prototype.destroy.call(this,$t),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$_(0,$t,"url",function(){return this._aniPath},function($t){this.load($t)}),$_(0,$t,"index",function(){return this._index},function($t){this.player&&(this._index=$t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$_(0,$t,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$_(0,$t,"templet",function(){return this._templet}),$_(0,$t,"player",function(){return this._player}),$I.useSimpleMeshInCanvas=!1,$I}($_t),$k=function($H){function $K(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$K.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$T($K,"laya.ani.bone.Templet",$H);var $t=$K.prototype;return $t.getLoadList=function(){return this._loadList},$t.loadAni=function($t){this._skBufferUrl=$t,$Kt.loader.load($t,$R.create(this,this.onComplete),null,"arraybuffer")},$t.onComplete=function($t){if(this._isDestroyed)this.destroy();else{var $H=$A.getRes(this._skBufferUrl);$H?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$H)):this.event("error","load failed:"+this._skBufferUrl)}},$t.parseData=function($t,$H,$I){void 0===$I&&($I=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$t,this._mainTexture&&$O.isWebGL&&$t.bitmap&&($t.bitmap.enableMerageInAtlas=!1),this._rate=$I,this.parse($H)},$t.buildArmature=function($t){return void 0===$t&&($t=0),new $P(this,$t)},$t.parse=function($t){$H.prototype.parse.call(this,$t),this._endLoaded(),this._aniVersion!=$K.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$K.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$t._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $t=0;this._loadList=[];var $H,$I=new $xt(this.getPublicExtData()),$T=0,$K=0,$_=0,$V=$I.getInt32(),$e=$I.readUTFString(),$R=$e.split("\n");for($t=0;$t<$V;$t++)$H=this._path+$R[2*$t],$e=$R[2*$t+1],$I.getFloat32(),$I.getFloat32(),$T=$I.getFloat32(),$K=$I.getFloat32(),$_=$I.getFloat32(),isNaN($_)?0:$_,$_=$I.getFloat32(),isNaN($_)?0:$_,$_=$I.getFloat32(),isNaN($_)?$T:$_,$_=$I.getFloat32(),isNaN($_)?$K:$_,-1==this._loadList.indexOf($H)&&this._loadList.push($H);this.event("inited",this)}},$t._textureComplete=function(){for(var $t,$H,$I=0,$T=this._loadList.length;$I<$T;$I++)$H=this._loadList[$I],$t=this._textureDic[$H]=$A.getRes($H),$O.isWebGL&&$t&&$t.bitmap&&($t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$t._parsePublicExtData=function(){var $t=0,$H=0,$I=0,$T=0,$K=0;for($t=0,$K=this.getAnimationCount();$t<$K;$t++)this._graphicsCache.push([]);var $_;$_="Dragon"!=this._aniClassName;var $V,$e,$R=new $xt(this.getPublicExtData()),$A=0,$q=0,$f=0,$b=0,$L=0,$G=0,$M=0,$O=0,$J=0,$S=$R.getInt32(),$U=$R.readUTFString(),$C=$U.split("\n");for($t=0;$t<$S;$t++){if($V=this._mainTexture,$e=this._path+$C[2*$t],$U=$C[2*$t+1],null==this._mainTexture&&($V=this._textureDic[$e]),!$V)return this.event("error",this),void(this.isParseFail=!0);$A=$R.getFloat32(),$q=$R.getFloat32(),$f=$R.getFloat32(),$b=$R.getFloat32(),$J=$R.getFloat32(),$L=isNaN($J)?0:$J,$J=$R.getFloat32(),$G=isNaN($J)?0:$J,$J=$R.getFloat32(),$M=isNaN($J)?$f:$J,$J=$R.getFloat32(),$O=isNaN($J)?$b:$J,this.subTextureDic[$U]=$Dt.create($V,$A,$q,$f,$b,-$L,-$G,$M,$O),$V.alphaTexture&&(this.subTextureDic[$U].alphaTexture=$Dt.create($V.alphaTexture,$A,$q,$f,$b,-$L,-$G,$M,$O))}this._mainTexture=$V;var $N,$w,$W,$s,$z,$P=$R.getUint16();for($t=0;$t<$P;$t++)($N=[]).push($R.getUint16()),$N.push($R.getUint16()),$N.push($R.getUint16()),$N.push($R.getUint16()),this.aniSectionDic[$t]=$N;var $k,$r=$R.getInt16(),$x={};for($t=0;$t<$r;$t++)$w=new $pt,0==$t?$k=$w:$w.root=$k,$w.d=$_?-1:1,$s=$R.readUTFString(),$z=$R.readUTFString(),$w.length=$R.getFloat32(),1==$R.getByte()&&($w.inheritRotation=!1),1==$R.getByte()&&($w.inheritScale=!1),$w.name=$s,$z&&(($W=$x[$z])?$W.addChild($w):this.mRootBone=$w),$x[$s]=$w,this.mBoneArr.push($w);this.tMatrixDataLen=$R.getUint16();var $Y,$D,$p=$R.getUint16(),$g=Math.floor($p/this.tMatrixDataLen),$l=this.srcBoneMatrixArr;for($t=0;$t<$g;$t++)($Y=new $mt).scX=$R.getFloat32(),$Y.skX=$R.getFloat32(),$Y.skY=$R.getFloat32(),$Y.scY=$R.getFloat32(),$Y.x=$R.getFloat32(),$Y.y=$R.getFloat32(),8===this.tMatrixDataLen&&($Y.skewX=$R.getFloat32(),$Y.skewY=$R.getFloat32()),$l.push($Y),($w=this.mBoneArr[$t]).transform=$Y;var $v,$y=$R.getUint16(),$E=0;for($t=0;$t<$y;$t++){for($D=new $Xt,$E=$R.getUint16(),$H=0;$H<$E;$H++)$D.boneNames.push($R.readUTFString()),$D.boneIndexs.push($R.getInt16());$D.name=$R.readUTFString(),$D.targetBoneName=$R.readUTFString(),$D.targetBoneIndex=$R.getInt16(),$D.bendDirection=$R.getFloat32(),$D.mix=$R.getFloat32(),$D.isSpine=$_,this.ikArr.push($D)}var $h,$X=$R.getUint16(),$B=0;for($t=0;$t<$X;$t++){for($v=new $Qt,$B=$R.getUint16(),$H=0;$H<$B;$H++)$v.boneIndexs.push($R.getInt16());$v.name=$R.getUTFString(),$v.targetIndex=$R.getInt16(),$v.rotateMix=$R.getFloat32(),$v.translateMix=$R.getFloat32(),$v.scaleMix=$R.getFloat32(),$v.shearMix=$R.getFloat32(),$v.offsetRotation=$R.getFloat32(),$v.offsetX=$R.getFloat32(),$v.offsetY=$R.getFloat32(),$v.offsetScaleX=$R.getFloat32(),$v.offsetScaleY=$R.getFloat32(),$v.offsetShearY=$R.getFloat32(),this.tfArr.push($v)}var $a=$R.getUint16(),$u=0;for($t=0;$t<$a;$t++){for(($h=new $Bt).name=$R.readUTFString(),$u=$R.getUint16(),$H=0;$H<$u;$H++)$h.bones.push($R.getInt16());$h.target=$R.readUTFString(),$h.positionMode=$R.readUTFString(),$h.spacingMode=$R.readUTFString(),$h.rotateMode=$R.readUTFString(),$h.offsetRotation=$R.getFloat32(),$h.position=$R.getFloat32(),$h.spacing=$R.getFloat32(),$h.rotateMix=$R.getFloat32(),$h.translateMix=$R.getFloat32(),this.pathArr.push($h)}var $$,$Q,$m,$o,$n,$F=0,$c=0,$i=0,$j=NaN,$d=0,$Z=$R.getInt16();for($t=0;$t<$Z;$t++){var $tt=$R.getUint8(),$Ht={};this.deformAniArr.push($Ht);for(var $It=0;$It<$tt;$It++)for(($$=new $lt).skinName=$R.getUTFString(),$Ht[$$.skinName]=$$,$F=$R.getInt16(),$H=0;$H<$F;$H++)for($Q=new $vt,$$.deformSlotDataList.push($Q),$c=$R.getInt16(),$I=0;$I<$c;$I++)for($m=new $yt,$Q.deformSlotDisplayList.push($m),$m.slotIndex=$R.getInt16(),$m.attachment=$R.getUTFString(),$i=$R.getInt16(),$T=0;$T<$i;$T++)for(1==$R.getByte()?$m.tweenKeyList.push(!0):$m.tweenKeyList.push(!1),$j=$R.getFloat32(),$m.timeList.push($j),$o=[],$m.vectices.push($o),$d=$R.getInt16(),$K=0;$K<$d;$K++)$o.push($R.getFloat32())}var $Tt,$Kt,$_t=$R.getInt16(),$Vt=0,$et=0;for($t=0;$t<$_t;$t++){for($Vt=$R.getInt16(),$n=[],$H=0;$H<$Vt;$H++){for(($Tt=new $Et).time=$R.getFloat32(),$et=$R.getInt16(),$I=0;$I<$et;$I++)$Tt.drawOrder.push($R.getInt16());$n.push($Tt)}this.drawOrderAniArr.push($n)}var $Rt,$At=$R.getInt16(),$qt=0;for($t=0;$t<$At;$t++){for($qt=$R.getInt16(),$Kt=[],$H=0;$H<$qt;$H++)($Rt=new $ht).name=$R.getUTFString(),$Rt.intValue=$R.getInt32(),$Rt.floatValue=$R.getFloat32(),$Rt.stringValue=$R.getUTFString(),$Rt.time=$R.getFloat32(),$Kt.push($Rt);this.eventAniArr.push($Kt)}var $ft=$R.getInt16();if(0<$ft)for(this.attachmentNames=[],$t=0;$t<$ft;$t++)this.attachmentNames.push($R.getUTFString());var $bt,$Lt,$Gt=$R.getInt16();for($t=0;$t<$Gt;$t++)($bt=new $gt).name=$R.readUTFString(),$bt.parent=$R.readUTFString(),$bt.attachmentName=$R.readUTFString(),$bt.srcDisplayIndex=$bt.displayIndex=$R.getInt16(),($bt.templet=this).boneSlotDic[$bt.name]=$bt,null==($Lt=this.bindBoneBoneSlotDic[$bt.parent])&&(this.bindBoneBoneSlotDic[$bt.parent]=$Lt=[]),$Lt.push($bt),this.boneSlotArray.push($bt);var $Mt,$Ot,$Jt,$St=$R.readUTFString().split("\n"),$Ut=0,$Ct=$R.getUint8(),$Nt=0,$wt=0,$Wt=0,$st=0,$zt=0,$Pt=0,$kt=0;for($t=0;$t<$Ct;$t++){for(($Mt=new $at).name=$St[$Ut++],$Nt=$R.getUint8(),$H=0;$H<$Nt;$H++){for(($Ot=new $$t).name=$St[$Ut++],$bt=this.boneSlotDic[$Ot.name],$wt=$R.getUint8(),$I=0;$I<$wt;$I++){if($Jt=new $ut,this.skinSlotDisplayDataArr.push($Jt),$Jt.name=$St[$Ut++],$Jt.attachmentName=$St[$Ut++],$Jt.transform=new $mt,$Jt.transform.scX=$R.getFloat32(),$Jt.transform.skX=$R.getFloat32(),$Jt.transform.skY=$R.getFloat32(),$Jt.transform.scY=$R.getFloat32(),$Jt.transform.x=$R.getFloat32(),$Jt.transform.y=$R.getFloat32(),$Ot.displayArr.push($Jt),$Jt.width=$R.getFloat32(),$Jt.height=$R.getFloat32(),$Jt.type=$R.getUint8(),$Jt.verLen=$R.getUint16(),0<($r=$R.getUint16()))for($Jt.bones=[],$T=0;$T<$r;$T++){var $rt=$R.getUint16();$Jt.bones.push($rt)}if(0<($Wt=$R.getUint16()))for($Jt.uvs=[],$T=0;$T<$Wt;$T++)$Jt.uvs.push($R.getFloat32());if(0<($st=$R.getUint16()))for($Jt.weights=[],$T=0;$T<$st;$T++)$Jt.weights.push($R.getFloat32());if(0<($zt=$R.getUint16()))for($Jt.triangles=[],$T=0;$T<$zt;$T++)$Jt.triangles.push($R.getUint16());if(0<($Pt=$R.getUint16()))for($Jt.vertices=[],$T=0;$T<$Pt;$T++)$Jt.vertices.push($R.getFloat32());if(0<($kt=$R.getUint16()))for($Jt.lengths=[],$T=0;$T<$kt;$T++)$Jt.lengths.push($R.getFloat32())}$Mt.slotArr.push($Ot)}this.skinDic[$Mt.name]=$Mt,this.skinDataArray.push($Mt)}1==$R.getUint8()?(this.yReverseMatrix=new $Yt(1,0,0,-1,0,0),$k&&$k.setTempMatrix(this.yReverseMatrix)):$k&&$k.setTempMatrix(new $Yt),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$t.getTexture=function($t){var $H=this.subTextureDic[$t];return $H||($H=this.subTextureDic[$t.substr(0,$t.length-1)]),null==$H?this._mainTexture:$H},$t.showSkinByIndex=function($t,$H,$I){if(void 0===$I&&($I=!0),$H<0&&$H>=this.skinDataArray.length)return!1;var $T,$K,$_=0,$V=0,$e=this.skinDataArray[$H];if($e){for($_=0,$V=$e.slotArr.length;$_<$V;$_++)($K=$e.slotArr[$_])&&($T=$t[$K.name])&&($T.showSlotData($K,$I),$I&&"undefined"!=$T.attachmentName&&"null"!=$T.attachmentName?$T.showDisplayByName($T.attachmentName):$T.showDisplayByIndex($T.displayIndex));return!0}return!1},$t.getSkinIndexByName=function($t){for(var $H=0,$I=this.skinDataArray.length;$H<$I;$H++)if(this.skinDataArray[$H].name==$t)return $H;return-1},$t.getGrahicsDataWithCache=function($t,$H){return this._graphicsCache[$t][$H]},$t.setGrahicsDataWithCache=function($t,$H,$I){this._graphicsCache[$t][$H]=$I},$t.destroy=function(){var $t;for(var $H in this._isDestroyed=!0,this.subTextureDic)($t=this.subTextureDic[$H])&&$t.destroy();for($H in this._textureDic)($t=this._textureDic[$H])&&$t.destroy();for(var $I=0,$T=this.skinSlotDisplayDataArr.length;$I<$T;$I++)this.skinSlotDisplayDataArr[$I].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $K.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$t.getAniNameByIndex=function($t){var $H=this.getAnimation($t);return $H?$H.name:null},$_(0,$t,"rate",function(){return this._rate},function($t){this._rate=$t}),$K.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$K.TEMPLET_DICTIONARY=null,$K}($l)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($t,$H){"use strict";for(var $I in Object.defineProperty($H,"__esModule",{value:!0}),Laya){var $T=Laya[$I];$T&&$T.__isclass&&($H[$I]=$T)}});