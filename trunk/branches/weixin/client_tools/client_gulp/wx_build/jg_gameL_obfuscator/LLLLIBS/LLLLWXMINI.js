var W=wx.$l;!function(o,a){a.un,a.uns;var n=a.static,l=a.class,i=a.getset,s=(a.__newvec,laya.utils.Browser),e=(laya.events.Event,laya.events.EventDispatcher),u=laya.resource.HTMLImage,c=laya.utils.Handler,t=laya.display.Input,h=laya.net.Loader,f=(laya.maths.Matrix,laya.renders.Render),m=laya.utils.RunDriver,v=(laya.media.Sound,laya.media.SoundChannel),y=laya.media.SoundManager,p=(laya.display.Stage,laya.net.URL),_=laya.utils.Utils,d=(l(y_x48n,"laya.wx.mini.MiniAdpter"),y_x48n.getJson=function(n){return JSON.parse(n)},y_x48n.init=function(n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),y_x48n._inited||(y_x48n.window=o).navigator.userAgent.indexOf("MiniGame")<0||(y_x48n._inited=!0,y_x48n.isZiYu=i,y_x48n.isPosMsgYu=n,y_x48n.EnvConfig={},y_x48n.isZiYu||(r.setNativeFileDir("/layaairGame"),r.existDir(r.fileNativeDir,c.create(y_x48n,y_x48n.onMkdirCallBack))),y_x48n.window.focus=function(){},a.getUrlPath=function(){},y_x48n.window.logtime=function(n){},y_x48n.window.alertTimeLog=function(n){},y_x48n.window.resetShareInfo=function(){},y_x48n.window.CanvasRenderingContext2D=function(){},y_x48n.window.CanvasRenderingContext2D.prototype=y_x48n.window.wx.createCanvas().getContext("2d").__proto__,y_x48n.window.document.body.appendChild=function(){},y_x48n.EnvConfig.pixelRatioInt=0,m.getPixelRatio=y_x48n.pixelRatio,y_x48n._preCreateElement=s.createElement,s.createElement=y_x48n.createElement,m.createShaderCondition=y_x48n.createShaderCondition,_.parseXMLFromString=y_x48n.parseXMLFromString,t._createInputElement=x._createInputElement,y_x48n.EnvConfig.load=h.prototype.load,h.prototype.load=w.prototype.load,y_x48n.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(r.ziyuFileData[n.url]=n.data)}))},y_x48n.onMkdirCallBack=function(n,i){n||(r.filesListObj=JSON.parse(i.data))},y_x48n.pixelRatio=function(){if(!y_x48n.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return y_x48n.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return y_x48n.EnvConfig.pixelRatioInt},y_x48n.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?y_x48n.onCreateInput(n):"div"==n?((e=y_x48n._preCreateElement(n)).contains=function(n){return null},e.removeChild=function(n){},e):y_x48n._preCreateElement(n):(1==y_x48n.idx?y_x48n.isZiYu?(i=sharedCanvas).style={}:i=o.canvas:i=o.wx.createCanvas(),y_x48n.idx++,i);var i;var e},y_x48n.onCreateInput=function(n){n=y_x48n._preCreateElement(n);return n.focus=x.wxinputFocus,n.blur=x.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},y_x48n.createShaderCondition=function(n){var i=this;return function(){return i[n.replace("this.","")]}},y_x48n.EnvConfig=null,y_x48n.window=null,y_x48n._preCreateElement=null,y_x48n._inited=!1,y_x48n.wxRequest=null,y_x48n.systemInfo=null,y_x48n.version="0.0.1",y_x48n.isZiYu=!1,y_x48n.isPosMsgYu=!1,y_x48n.parseXMLFromString=function(n){var i;n=n.replace(/>\s+</g,"><");try{i=(new o.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return i},y_x48n.idx=1,y_x48n),x=(l(a$b2ds,"laya.wx.mini.MiniImage"),a$b2ds.prototype._loadImage=function(n){var i=!1;-1==n.indexOf("layaNativeDir/")&&(i=!0,n=p.formatURL(n)),r.getFileInfo(n)?a$b2ds.onCreateImage(n,this,!i):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?r.downImg(n,new c(a$b2ds,a$b2ds.onDownImgCallBack,[n,this]),n):a$b2ds.onCreateImage(n,this,!0)},a$b2ds.onDownImgCallBack=function(n,i,e){e?i.onError(null):a$b2ds.onCreateImage(n,i)},a$b2ds.onCreateImage=function(i,e,n){var t;function v91f7(){t.onload=null,t.onerror=null,delete e.imgCache[i]}n=(n=void 0===n?!1:n)?i:(n=r.getFileInfo(i).md5,r.getFileNativePath(n)),null==e.imgCache&&(e.imgCache={});function za(){v91f7(),e.onLoaded(t)}function Aa(){v91f7(),e.event("error","Load image failed")}"nativeimage"==e._type?((t=new s.window.Image).crossOrigin="",t.onload=za,t.onerror=Aa,t.src=n,e.imgCache[i]=t):new u.create(n,{onload:za,onerror:Aa,onCreate:function(n){t=n,e.imgCache[i]=n}})},l(eo17v9,"laya.wx.mini.MiniInput"),eo17v9._createInputElement=function(){t._initInput(t.area=s.createElement("textarea")),t._initInput(t.input=s.createElement("input")),t.inputContainer=s.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,s.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(n,i){t.inputContainer.style.left=n+"px",t.inputContainer.style.top=i+"px"},a.stage.on("resize",null,eo17v9._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){o.dispatchEvent&&o.dispatchEvent("resize")}),y._soundClass=g,y._musicClass=g,o._videoClass=b},eo17v9._onStageResize=function(){a.stage._canvasTransform.identity().scale(s.width/f.canvas.width/m.getPixelRatio(),s.height/f.canvas.height/m.getPixelRatio())},eo17v9.wxinputFocus=function(n){var i=t.inputElement.target;i&&!i.editable||(d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),d.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"";i.text=n,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),d.window.wx.onKeyboardInput(function(n){n=n?n.value:"";i.multiline||-1==n.indexOf("\n")?(i.text=n,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},eo17v9.inputEnter=function(){t.inputElement.target.focus=!1},eo17v9.wxinputblur=function(){eo17v9.hideKeyboard()},eo17v9.hideKeyboard=function(){d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},eo17v9),w=(l(d_$4s8,"laya.wx.mini.MiniLoader"),(C=d_$4s8.prototype).load=function(n,i,e,t,o){void 0===e&&(e=!0),void 0===o&&(o=!1);var a=this;0===(a._url=n).indexOf("data:image")?a._type=i="image":a._type=i=i||a.getTypeFromUrl(n),a._cache=e,a._data=null;var l="ascii";-1!=n.indexOf(".fnt")?l="utf8":"arraybuffer"==i&&(l="");var s=_.getFileExtension(n);if(-1!=d_$4s8._fileTypeArr.indexOf(s))d.EnvConfig.load.call(this,n,i,e,t,o);else if(r.getFileInfo(n))d.EnvConfig.load.call(this,n,i,e,t,o);else{if(-1!=n.indexOf("layaNativeDir/"))return d.isZiYu?(s=r.ziyuFileData[n],void a.onLoaded(s)):(cosnole.log("read read"),void r.read(n,l,new c(d_$4s8,d_$4s8.onReadNativeCallBack,[l,n,i,e,t,o,a])));s=""==p.rootPath?n:n.split(p.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?d.EnvConfig.load.call(a,n,i,e,t,o):r.readFile(s,l,new c(d_$4s8,d_$4s8.onReadNativeCallBack,[l,n,i,e,t,o,a]),n)}},C.resMgrLoad=function(n,t,i,e,o,a,l){void 0===i&&(i=0),void 0===e&&(e=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===l&&(l=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),d.EnvConfig.resMgrLoad(n,(n,i,e)=>{d_$4s8.prototype.resMgrLoadCallBack(n,i,e,t)},i,e,o,a,l)},C.resMgrLoadCallBack=function(n,i,e,t){console.log("buff:::",n,e,r.fileNativeDir+"///"+r.fileListName),t(n,i,e)},C.clearRes=function(n,i){this.clearRes(n,i=void 0===i?!1:i);i=r.getFileInfo(n);!i||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=i.md5,i=r.getFileNativePath(n),r.remove(i))},d_$4s8.onReadNativeCallBack=function(n,i,e,t,o,a,l,s,r){void 0===t&&(t=!0),void 0===a&&(a=!1),(s=void 0===s?0:s)?1==s&&d.EnvConfig.load.call(l,i,e,t,o,a):(s="json"==e||"atlas"==e?d.getJson(r.data):"xml"==e?_.parseXMLFromString(r.data):r.data,l.onLoaded(s),!d.isZiYu&&d.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:i,data:s,isLoad:!0}))},n(d_$4s8,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),d_$4s8),r=(l(j2bha,"laya.wx.mini.MiniFileMgr",e),j2bha.isLoadFile=function(n){return-1!=j2bha._fileTypeArr.indexOf(n)},j2bha.getFileInfo=function(n){n=n.split("?")[0],n=j2bha.filesListObj[n];return null==n?null:n},j2bha.onFileUpdate=function(n,i){var n=n.split("/"),n=n[n.length-1],e=j2bha.getFileInfo(i);null==e?j2bha.onSaveFile(i,n):e.readyUrl!=i&&j2bha.remove(n,i)},j2bha.exits=function(n,i){n=j2bha.getFileNativePath(n);j2bha.fs.getFileInfo({filePath:n,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){null!=i&&i.runWith([1,n])}})},j2bha.read=function(n,i,e,t){void 0===i&&(i="ascill"),n=""!=(t=void 0===t?"":t)?j2bha.getFileNativePath(n):n,j2bha.fs.readFile({filePath:n,encoding:i,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){n&&""!=t?j2bha.down(t,i,e,t):null!=e&&e.runWith([1])}})},j2bha.readNativeFile=function(n,i){j2bha.fs.readFile({filePath:n,encoding:"",success:function(n){null!=i&&i.runWith([0])},fail:function(n){null!=i&&i.runWith([1])}})},j2bha.down=function(n,i,e,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var o=j2bha.getFileNativePath(t);j2bha.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&j2bha.readFile(n.filePath,i,e,t)},fail:function(n){null!=e&&e.runWith([1,n])}}).onProgressUpdate(function(n){null!=e&&e.runWith([2,n.progress])})},j2bha.readFile=function(i,n,e,t){void 0===t&&(t=""),j2bha.fs.readFile({filePath:i,encoding:n=void 0===n?"ascill":n,success:function(n){-1==i.indexOf("http://")&&-1==i.indexOf("https://")||j2bha.onFileUpdate(i,t),null!=e&&e.runWith([0,n])},fail:function(n){n&&null!=e&&e.runWith([1,n])}})},j2bha.downImg=function(n,i,e){void 0===e&&(e="");j2bha.wxdown({url:n,success:function(n){200===n.statusCode&&j2bha.copyFile(n.tempFilePath,e,i)},fail:function(n){null!=i&&i.runWith([1,n])}})},j2bha.copyFile=function(n,i,e){var t=n.split("/"),o=t[t.length-1],a=(i.split("?")[0],j2bha.getFileInfo(i)),t=j2bha.getFileNativePath(o);j2bha.fs.copyFile({srcPath:n,destPath:t,success:function(n){a?a.readyUrl!=i&&j2bha.remove(o,i,e):(j2bha.onSaveFile(i,o),null!=e&&e.runWith([0]))},fail:function(n){null!=e&&e.runWith([1,n])}})},j2bha.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},j2bha.remove=function(i,e,t){void 0===e&&(e="");var n=j2bha.getFileInfo(e),o=j2bha.getFileNativePath(n.md5);a.loader.clearRes(n.readyUrl),j2bha.fs.unlink({filePath:o,success:function(n){""!=e&&j2bha.onSaveFile(e,i),null!=t&&t.runWith([0])},fail:function(n){}})},j2bha.onSaveFile=function(n,i){var e=n.split("?")[0];j2bha.filesListObj[e]={md5:i,readyUrl:n},j2bha.fs.writeFile({filePath:j2bha.fileNativeDir+"/"+j2bha.fileListName,encoding:"utf8",data:JSON.stringify(j2bha.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},j2bha.existDir=function(n,i){j2bha.fs.mkdir({dirPath:n,success:function(n){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?j2bha.readSync(j2bha.fileListName,"utf8",i):null!=i&&i.runWith([1,n])}})},j2bha.readSync=function(n,i,e,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var o,i=j2bha.getFileNativePath(n);try{o=j2bha.fs.readFileSync(i),null!=e&&e.runWith([0,{data:o}])}catch(n){null!=e&&e.runWith([1])}},j2bha.readCache=function(){},j2bha.writeCache=function(n){var i=readyUrl.split("?")[0];j2bha.filesListObj[i]={md5:md5Name,readyUrl:readyUrl},j2bha.fs.writeFile({filePath:j2bha.fileNativeDir+"/"+j2bha.fileListName,encoding:"utf8",data:JSON.stringify(j2bha.filesListObj),success:function(n){},fail:function(n){}})},j2bha.setNativeFileDir=function(n){j2bha.fileNativeDir=wx.env.USER_DATA_PATH+n},j2bha.filesListObj={},j2bha.fileNativeDir=null,j2bha.fileListName="layaairfiles.txt",j2bha.ziyuFileData={},n(j2bha,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),j2bha),g=(l(rwi3cm,"laya.wx.mini.MiniSound",e),(C=rwi3cm.prototype).load=function(n){var i=this;var e;function oe19(){if(null!=rwi3cm._null)i._sound.onCanplay(rwi3cm._null),i._sound.onError(rwi3cm._null);else try{i._sound.onCanplay(null),i._sound.onError(null),rwi3cm._null=null}catch(n){console.warn("[wxmini] _clearSound:"+n),i._sound.onCanplay(x03rny),i._sound.onError(x03rny),rwi3cm._null=x03rny}}function x03rny(){}n=p.formatURL(n),this.url=n,rwi3cm._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){oe19(),e.loaded=!0,e.event("complete"),rwi3cm._audioCache[e.url]=e}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),oe19(),e.event("error")}),this._sound.src=n,e=this)},C.play=function(n,i){void 0===n&&(n=0),void 0===i&&(i=0),(e=this.url==y._tMusic?(rwi3cm._musicAudio||(rwi3cm._musicAudio=rwi3cm._createSound()),rwi3cm._musicAudio):rwi3cm._createSound()).src=this.url;var e=new E(e);return e.url=this.url,e.loops=i,e.startTime=n,e.play(),y.addChannel(e),e},C.dispose=function(){var n=rwi3cm._audioCache[this.url];n&&(n.src="",delete rwi3cm._audioCache[this.url])},i(0,C,"duration",function(){return this._sound.duration}),rwi3cm._createSound=function(){return rwi3cm._id++,d.window.wx.createInnerAudioContext()},rwi3cm._musicAudio=null,rwi3cm._id=0,rwi3cm._audioCache={},rwi3cm._null=void 0,rwi3cm),E=(l(d_s8$4,"laya.wx.mini.MiniSoundChannel",v),(n=d_s8$4.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,y.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){if(this.isStopped=!0,y.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=d_s8$4._null)this._audio.onEnded(d_s8$4._null);else try{this._audio.onEnded(null),d_s8$4._null=null}catch(n){console.warn("[wxmini] stop:"+n),this._audio.onEnded(_.bind(this.__onNull,this)),d_s8$4._null=_.bind(this.__onNull,this)}this._audio=null}},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,y.addChannel(this),this._audio.play())},i(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),i(0,n,"duration",function(){return this._audio?this._audio.duration:0}),i(0,n,"volume",function(){return 1},function(n){}),d_s8$4._null=void 0,d_s8$4),b=(l(f9o75,"laya.wx.mini.MiniVideo"),(e=f9o75.prototype).on=function(n,i,e){"loadedmetadata"==n?(this.onPlayFunc=e.bind(i),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=e.bind(i),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},e.onTimeUpdateFunc=function(n){this.position=n.position,this._duration=n.duration},e.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},e.onended=function(n,i){this.onEndedFunC=i.bind(n),this.videoElement.onended=this.onEndedFunction.bind(this)},e.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},e.off=function(n,i,e){"loadedmetadata"==n?(this.onPlayFunc=e.bind(i),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=e.bind(i),this.videoElement.offEnded=this.onEndedFunction.bind(this))},e.load=function(n){this.videoElement&&(this.videoElement.src=n)},e.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},e.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},e.size=function(n,i){this.videoElement&&(this.videoElement.width=n,this.videoElement.height=i)},e.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},e.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},i(0,e,"duration",function(){return this._duration}),i(0,e,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(n){this.videoElement&&(this.videoElement.initialTime=n)}),i(0,e,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),i(0,e,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),i(0,e,"ended",function(){return this.videoend}),i(0,e,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(n){this.videoElement&&(this.videoElement.loop=n)}),i(0,e,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(n){this.videoElement&&(this.videoElement.playbackRate=n)}),i(0,e,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(n){this.videoElement&&(this.videoElement.muted=n)}),i(0,e,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),i(0,e,"x",function(){return this.videoElement?this.videoElement.x:0},function(n){this.videoElement&&(this.videoElement.x=n)}),i(0,e,"y",function(){return this.videoElement?this.videoElement.y:0},function(n){this.videoElement&&(this.videoElement.y=n)}),i(0,e,"currentSrc",function(){return this.videoElement.src}),i(0,e,"src",function(){return this.videoElement?this.videoElement.src:0},function(n){this.videoElement&&(this.videoElement.src=n)}),i(0,e,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(n){this.videoElement&&(this.videoElement.controls=n)}),i(0,e,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(n){this.videoElement&&(this.videoElement.autoplay=n)}),f9o75);function f9o75(){this.videoend=!1,this.videourl="",this.videoElement=d.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function d_s8$4(n){this._audio=null,this._onEnd=null,d_s8$4.__super.call(this),this._audio=n,this._onEnd=_.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function rwi3cm(){this._sound=null,this.url=null,this.loaded=!1,rwi3cm.__super.call(this),this._sound=rwi3cm._createSound()}function j2bha(){j2bha.__super.call(this)}function d_$4s8(){}var C;function eo17v9(){}function a$b2ds(){}function y_x48n(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,i){"use strict";for(var e in Object.defineProperty(i,"__esModule",{value:!0}),Laya){var t=Laya[e];t&&t.__isclass&&(i[e]=t)}});