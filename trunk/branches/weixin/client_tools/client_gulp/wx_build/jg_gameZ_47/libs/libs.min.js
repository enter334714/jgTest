var Laya=window.Laya=function(a,U){var b={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(U,F){return 1==arguments.length?b.__presubstr.call(this,U):b.__presubstr.call(this,U,0<F?F:this.length+F)},__init:function(U){U.forEach(function(U){U.__init$&&U.__init$()})},__isClass:function(U){return U&&(U.__isclass||U==Object||U==String||U==Array)},__newvec:function(U,F){var O=[];O.length=U;for(var P=0;P<U;P++)O[P]=F;return O},__extend:function(U,F){for(var O in F)if(F.hasOwnProperty(O)){var P=Object.getOwnPropertyDescriptor(F,O),Y=P.get,c=P.set;Y||c?Y&&c?Object.defineProperty(U,O,P):(Y&&Object.defineProperty(U,O,Y),c&&Object.defineProperty(U,O,c)):U[O]=F[O]}function L(){b.un(this,"constructor",U)}L.prototype=F.prototype,U.prototype=new L,b.un(U.prototype,"__imps",b.__copy({},F.prototype.__imps))},__copy:function(U,F){if(!F)return null;for(var O in U=U||{},F)U[O]=F[O];return U},__package:function(U,F){if(!b.__packages[U]){b.__packages[U]=!0;var O=a,P=U.split(".");if(1<P.length)for(var Y=0,c=P.length-1;Y<c;Y++){var L=O[P[Y]];O=L||(O[P[Y]]={})}O[P[P.length-1]]||(O[P[P.length-1]]=F||{})}},__hasOwnProperty:function(U,F){return F=F||this,Object.hasOwnProperty.call(F,U)||function U(F,O){if(Object.hasOwnProperty.call(O.prototype,F))return!0;var P=O.prototype.__super;return null==P?null:U(F,P)}(U,F.__class)},__typeof:function(U,F){if(!U||!F)return!1;if(F===String)return"string"==typeof U;if(F===Number)return"number"==typeof U;if(F.__interface__)F=F.__interface__;else if("string"!=typeof F)return U instanceof F;return U.__imps&&U.__imps[F]||U.__class==F},__as:function(U,F){return this.__typeof(U,F)?U:null},__int:function(U){return U?parseInt(U):0},interface:function(U,F){b.__package(U,{});var O=b.__internals,P=O[U]=O[U]||{self:U};if(F){var Y=F.split(",");P.extend=[];for(var c=0;c<Y.length;c++){var L=Y[c];O[L]=O[L]||{self:L},P.extend.push(O[L])}}var u=a,d=U.split(".");for(c=0;c<d.length-1;c++)u=u[d[c]];u[d[d.length-1]]={__interface__:U}},class:function(U,F,O,P){if(O&&b.__extend(U,O),F)if(b.__package(F,U),b.__classmap[F]=U,0<F.indexOf(".")){if(0==F.indexOf("laya.")){var Y=F.split(".");P=P||Y[Y.length-1],b[P]&&console.log("Warning!,this class["+P+"] already exist:",b[P]),b[P]=U}}else"Main"==F?a.Main=U:"MainWX"==F?a.MainWX=U:(b[F]&&console.log("Error!,this class["+F+"] already exist:",b[F]),b[F]=U);var c=b.un,L=U.prototype;c(L,"hasOwnProperty",b.__hasOwnProperty),c(L,"__class",U),c(L,"__super",O),c(L,"__className",F),c(U,"__super",O),c(U,"__className",F),c(U,"__isclass",!0),c(U,"super",function(U){this.__super.call(U)})},imps:function(U,F){if(!F)return null;var Y=U.__imps||b.un(U,"__imps",{});function c(U){var F,O;if((F=b.__internals[U])&&(Y[U]=!0,O=F.extend))for(var P=0;P<O.length;P++)c(O[P].self)}for(var O in F)c(O)},superSet:function(U,F,O,P){var Y=U.prototype["_$set_"+O];Y&&Y.call(F,P)},superGet:function(U,F,O){var P=U.prototype["_$get_"+O];return P?P.call(F):null},getset:function(U,F,O,P,Y){U?(P&&(F["_$GET_"+O]=P),Y&&(F["_$SET_"+O]=Y)):(P&&b.un(F,"_$get_"+O,P),Y&&b.un(F,"_$set_"+O,Y)),P&&Y?Object.defineProperty(F,O,{get:P,set:Y,enumerable:!1,configurable:!0}):(P&&Object.defineProperty(F,O,{get:P,enumerable:!1,configurable:!0}),Y&&Object.defineProperty(F,O,{set:Y,enumerable:!1,configurable:!0}))},static:function(O,P){for(var Y=0,U=P.length;Y<U;Y+=2)if("length"==P[Y])O.length=P[Y+1].call(O);else{function F(){var F=P[Y],U=P[Y+1];Object.defineProperty(O,F,{get:function(){return delete this[F],this[F]=U.call(this)},set:function(U){delete this[F],this[F]=U},enumerable:!0,configurable:!0})}F()}},un:function(U,F,O){return O||(O=U[F]),b.__propun.value=O,Object.defineProperty(U,F,b.__propun),O},uns:function(F,U){U.forEach(function(U){b.un(F,U)})}};return a.console=a.console||{log:function(){}},a.trace=a.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),b}(window,document);!function(U,F,O){O.un,O.uns,O.static,O.class,O.getset,O.__newvec}(window,document,Laya),function(L,F,f){f.un,f.uns;var d=f.static,x=f.class,b=f.getset;f.__newvec;f.interface("laya.runtime.IMarket"),f.interface("laya.filters.IFilter"),f.interface("laya.display.ILayout"),f.interface("laya.resource.IDispose"),f.interface("laya.runtime.IPlatform"),f.interface("laya.resource.IDestroy"),f.interface("laya.runtime.IConchNode"),f.interface("laya.filters.IFilterAction"),f.interface("laya.runtime.ICPlatformClass"),f.interface("laya.resource.ICreateResource"),f.interface("laya.runtime.IConchRenderObject"),f.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var C=function(){function c(){}return x(c,"laya.utils.RunDriver"),c.FILTER_ACTIONS=[],c.pixelRatio=-1,c._charSizeTestDiv=null,c.now=function(){return Date.now()},c.getWindow=function(){return L},c.getPixelRatio=function(){if(c.pixelRatio<0){var U=m.context,F=U.backingStorePixelRatio||U.webkitBackingStorePixelRatio||U.mozBackingStorePixelRatio||U.msBackingStorePixelRatio||U.oBackingStorePixelRatio||U.backingStorePixelRatio||1;(c.pixelRatio=(m.window.devicePixelRatio||1)/F)<1&&(c.pixelRatio=1)}return c.pixelRatio},c.getIncludeStr=function(U){return null},c.createShaderCondition=function(U){var F="(function() {return "+U+";})";return f._runScript(F)},c.fontMap=[],c.measureText=function(U,F){var O=c.hanzi.test(U);if(O&&c.fontMap[F])return c.fontMap[F];var P=m.context;P.font=F;var Y=P.measureText(U);return Y||(Y={width:16,height:16}),O&&(c.fontMap[F]=Y),Y},c.getWebGLContext=function(U){},c.beginFlush=function(){},c.endFinish=function(){},c.addToAtlas=null,c.flashFlushImage=function(U){},c.drawToCanvas=function(U,F,O,P,Y,c){var L=QU.create("2D"),u=new A(O,P,L);return G.renders[F]._fun(U,u,Y,c),L},c.createParticleTemplate2D=null,c.createGLTextur=null,c.createWebGLContext2D=null,c.changeWebGLSize=function(U,F){},c.createRenderSprite=function(U,F){return new G(U,F)},c.createFilterAction=function(U){return new Q},c.createGraphics=function(){return new J},c.clear=function(U){k._context.ctx.clear()},c.cancelLoadByUrl=function(U){},c.clearAtlas=function(U){},c.isAtlas=function(U){return!1},c.addTextureToAtlas=function(U){},c.getTexturePixels=function(U,F,O,P,Y){return null},c.skinAniSprite=function(){return null},c.update3DLoop=function(){},d(c,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),c}(),P=(b(1,f,"alertGlobalError",null,function(U){var c=0;m.window.onerror=U?function(U,F,O,P,Y){c++<5&&Y&&alert(Y.stack||Y)}:null}),f.init=function(U,F,O){for(var P=[],Y=2,c=arguments.length;Y<c;Y++)P.push(arguments[Y]);if(!f._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=f._arrayBufferSlice),f._isinit=!0,m.__init__(),V.__init__(),J.__init__(),f.timer=new n,f.scaleTimer=new n,f.loader=new dU,B.__init__(),Y=0;for(var L=P.length;Y<L;Y++)P[Y].enable&&P[Y].enable();return w.__init__(),u.__init__(),M.__init__(),o.beginCheck(),f._currentStage=f.stage=new HU,f.stage.conchModel&&f.stage.conchModel.setRootNode(),f._getUrlPath(),f.render=new k(0,0),f.stage.size(U,F),G.__init__(),z.__init__(),j.instance.__init__(f.stage,k.canvas),NU.__init__(),$.autoStopMusic=!0,g.__init__(),k.canvas}},f._getUrlPath=function(){var U=m.window.location,F=U.pathname;F=F&&":"==F.charAt(2)?F.substring(1):F,y.rootPath=y.basePath=y.getPath("file:"==U.protocol?F:U.protocol+"//"+U.host+U.pathname)},f._arrayBufferSlice=function(U,F){var O=new Uint8Array(this,U,F-U),P=new Uint8Array(O.length);return P.set(O),P.buffer},f._runScript=function(U){return m.window[f._evcode](U)},f.stage=null,f.timer=null,f.scaleTimer=null,f.loader=null,f.version="1.8.6",f.render=null,f._currentStage=null,f._isinit=!1,f.isDebug=!1,f.MiniAdpter={init:function(){L.navigator&&L.navigator.userAgent&&-1<L.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},d(f,["conchMarket",function(){return this.conchMarket=L.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=L.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function U(){}return x(U,"Config"),U.WebGLTextCacheCount=500,U.atlasEnable=!1,U.showCanvasMark=!1,U.animationInterval=50,U.isAntialias=!1,U.isAlpha=!1,U.premultipliedAlpha=!0,U.isStencil=!0,U.preserveDrawingBuffer=!1,U}()),a=function(){function a(){this._events=null}x(a,"laya.events.EventDispatcher");var U=a.prototype;return U.hasListener=function(U){return!!(this._events&&this._events[U])},U.getListener=function(U){return this._events?this._events[U]:null},U.event=function(U,F){if(!this._events||!this._events[U])return!1;var O=this._events[U];if(O.lock)O.queue||(O.queue=[]),O.queue.push(F);else{var P;for(O.lock=!0,O.cursor=O.head;O.cursor;)(P=O.cursor).recover?(O.head=O.tail=O.cursor=null,console.error("node is recover："+P.id)):(O.cursor=P.next,P.once&&a.delNode(O,P),P.method&&(null!=F?P.args?P.method.apply(P.caller,P.args.concat(F)):F instanceof Array?P.method.apply(P.caller,F):P.caller?P.method.call(P.caller,F):f.recordError("事件派发错误","node.caller:"+P.caller+"node.method:"+P.method+"data:"+F+"node.prev"+P.prev):P.method.apply(P.caller,P.args)),P.once&&a.recoverHandler(P));O.lock=!1,!O.head&&this._events&&this._events[U]==O&&delete this._events[U],O.queue&&O.queue.length&&this.event(U,O.queue.shift())}return!0},U.on=function(U,F,O,P){return this._createListener(U,F,O,P,!1)},U.once=function(U,F,O,P){return this._createListener(U,F,O,P,!0)},U._createListener=function(U,F,O,P,Y,c){void 0===c&&(c=!0),c&&this.off(U,F,O,Y);var L=a.createHandler(F||this,O,P,Y);this._events||(this._events={});var u=this._events,d=u[U];return d?d.tail?(L.prev=d.tail,d.tail.next=L,d.tail=L):d.head=d.tail=L:u[U]={head:L,tail:L,cursor:null,lock:!1},this},U.off=function(U,F,O,P){if(void 0===P&&(P=!1),!this._events||!this._events[U])return this;for(var Y=this._events[U],c=Y.head;c;){if((!F||c.caller===F)&&c.method===O&&(!P||c.once)){a.delNode(Y,c),Y.cursor==c&&(Y.cursor=c.next),a.recoverHandler(c);break}c=c.next}return this},U.offAll=function(U){var F=this._events;if(!F)return this;if(U)this._recoverHandlers(F[U]),delete F[U];else{for(var O in F)this._recoverHandlers(F[O]);this._events=null}return this},U._recoverHandlers=function(U){if(U){for(var F=U.head;F;){a.delNode(U,F);var O=F.next;a.recoverHandler(F),F=O}U.cursor=null}},U.isMouseEvent=function(U){return a.MOUSE_EVENTS[U]},a.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},a.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},a.delNode=function(U,F){F.prev?F.prev.next=F.next:U.head=F.next,F.next?F.next.prev=F.prev:U.tail=F.prev},a.createHandler=function(U,F,O,P){var Y=500<a._freeHandler.length?a._freeHandler.shift():null;if(Y)if(Y.recover)Y.recover=!1,Y.caller=U,Y.method=F,Y.args=O,Y.once=P;else{var c="";try{arguments.propertyIsEnumerable.caller}catch(U){c=U.stack}var L=Y.caller?(Y.caller.__proto__&&Y.caller.__proto__.constructor&&Y.caller.__proto__.constructor.name)+"|"+Y.caller.__className+"|"+Y.caller.name:"",u=Y.method?Y.method.name:"";f.recordError("EventDispatcher重复创建","caller="+L+"  method="+u+"  stack="+c),Y={id:++a._nodeCount,caller:U,method:F,args:O,once:P,recover:!1}}else Y={id:++a._nodeCount,caller:U,method:F,args:O,once:P,recover:!1};return Y.prev=Y.next=null,Y},a.recoverHandler=function(U){if(U.recover){if(a._errorCount<5){a._errorCount++;var F="";try{arguments.propertyIsEnumerable.caller}catch(U){F=U.stack}var O=U.caller?(U.caller.__proto__&&U.caller.__proto__.constructor&&U.caller.__proto__.constructor.name)+"|"+U.caller.__className+"|"+U.caller.name:"",P=U.method?U.method.name:"";f.recordError("EventDispatcher重复回收","id="+U.id+"  caller="+O+"  method="+P+"  stack="+F)}U.caller=U.method=U.args=U.prev=null}else U.recover=!0,U.caller=U.method=U.args=U.prev=U.next=null,a._freeHandler&&a._freeHandler.length<3e3&&a._freeHandler.push(U)},a._freeHandler=[],a._nodeCount=0,a._errorCount=0,a}(),h=function(){function Y(U,F,O,P){this.once=!1,void(this._id=0)===P&&(P=!1),this.setTo(U,F,O,P)}x(Y,"laya.utils.Handler");var U=Y.prototype;return U.setTo=function(U,F,O,P){return this._id=Y._gid++,this.caller=U,this.method=F,this.args=O,this.once=P,this},U.run=function(){if(null==this.method)return null;var U=this._id,F=this.method.apply(this.caller,this.args);return this._id===U&&this.once&&this.recover(),F},U.runWith=function(U){if(null==this.method)return null;var F=this._id;if(null==U)var O=this.method.apply(this.caller,this.args);else O=this.args||U.unshift?this.args?this.method.apply(this.caller,this.args.concat(U)):this.method.apply(this.caller,U):this.method.call(this.caller,U);return this._id===F&&this.once&&this.recover(),O},U.clear=function(){return this.caller=null,this.method=null,this.args=null,this},U.recover=function(){0<this._id&&(this._id=0,this.clear())},Y.create=function(U,F,O,P){return void 0===P&&(P=!0),new Y(U,F,O,P)},Y._gid=1,Y}(),l=function(){function U(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}x(U,"laya.display.BitmapFont");var F=U.prototype;return F.loadFont=function(U,F){this._path=U,this._complete=F,f.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],h.create(this,this.onLoaded))},F.onLoaded=function(){this.parseFont(uU.getRes(this._path),uU.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},F.parseFont=function(U,F){if(null!=U&&null!=F){this._texture=F;var O=U.getElementsByTagName("info");if(!O[0].getAttributeNode)return this.parseFont2(U,F);this.fontSize=parseInt(O[0].getAttributeNode("size").nodeValue);var P,Y=O[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(Y[0]),parseInt(Y[1]),parseInt(Y[2]),parseInt(Y[3])],P=U.getElementsByTagName("char");var c=0;for(c=0;c<P.length;c++){var L=P[c],u=parseInt(L.getAttributeNode("id").nodeValue),d=parseInt(L.getAttributeNode("xoffset").nodeValue)/1,a=parseInt(L.getAttributeNode("yoffset").nodeValue)/1,b=parseInt(L.getAttributeNode("xadvance").nodeValue)/1,z=new T;z.x=parseInt(L.getAttributeNode("x").nodeValue),z.y=parseInt(L.getAttributeNode("y").nodeValue),z.width=parseInt(L.getAttributeNode("width").nodeValue),z.height=parseInt(L.getAttributeNode("height").nodeValue);var J=bU.create(F,z.x,z.y,z.width,z.height,d,a);this._maxWidth=Math.max(this._maxWidth,b+this.letterSpacing),this._fontCharDic[u]=J,this._fontWidthMap[u]=b}}},F.parseFont2=function(U,F){if(null!=U&&null!=F){this._texture=F;var O=U.getElementsByTagName("info");this.fontSize=parseInt(O[0].attributes.size.nodeValue);var P=O[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(P[0]),parseInt(P[1]),parseInt(P[2]),parseInt(P[3])];var Y=U.getElementsByTagName("char"),c=0;for(c=0;c<Y.length;c++){var L=Y[c].attributes,u=parseInt(L.id.nodeValue),d=parseInt(L.xoffset.nodeValue)/1,a=parseInt(L.yoffset.nodeValue)/1,b=parseInt(L.xadvance.nodeValue)/1,z=new T;z.x=parseInt(L.x.nodeValue),z.y=parseInt(L.y.nodeValue),z.width=parseInt(L.width.nodeValue),z.height=parseInt(L.height.nodeValue);var J=bU.create(F,z.x,z.y,z.width,z.height,d,a);this._maxWidth=Math.max(this._maxWidth,b+this.letterSpacing),this._fontCharDic[u]=J,this._fontWidthMap[u]=b}}},F.getCharTexture=function(U){return this._fontCharDic[U.charCodeAt(0)]},F.destroy=function(){if(this._texture){for(var U in this._fontCharDic){var F=this._fontCharDic[U];F&&F.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},F.setSpaceWidth=function(U){this._spaceWidth=U},F.getCharWidth=function(U){var F=U.charCodeAt(0);return this._fontWidthMap[F]?this._fontWidthMap[F]+this.letterSpacing:" "==U?this._spaceWidth+this.letterSpacing:0},F.getTextWidth=function(U){for(var F=0,O=0,P=U.length;O<P;O++)F+=this.getCharWidth(U.charAt(O));return F},F.getMaxWidth=function(){return this._maxWidth},F.getMaxHeight=function(){return this.fontSize},F.drawText=function(U,F,O,P,Y,c){var L,u=this.getTextWidth(U),d=0;"center"===Y&&(d=(c-u)/2),"right"===Y&&(d=c-u);for(var a=0,b=0,z=U.length;b<z;b++)(L=this.getCharTexture(U.charAt(b)))&&(F.graphics.drawTexture(L,O+a+d,P),a+=this.getCharWidth(U.charAt(b)))},U}(),u=function(){function O(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=O._TF_EMPTY}x(O,"laya.display.css.Style");var U=O.prototype;return U.getTransform=function(){return this._tf},U.setTransform=function(U){this._tf="none"!==U&&U?U:O._TF_EMPTY},U.setTranslateX=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.translateX=U},U.setTranslateY=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.translateY=U},U.setScaleX=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.scaleX=U},U.setScale=function(U,F){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.scaleX=U,this._tf.scaleY=F},U.setScaleY=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.scaleY=U},U.setRotate=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.rotate=U},U.setSkewX=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.skewX=U},U.setSkewY=function(U){this._tf===O._TF_EMPTY&&(this._tf=new Y),this._tf.skewY=U},U.destroy=function(){this.scrollRect=null},U.render=function(U,F,O,P){},U.getCSSStyle=function(){return FU.EMPTY},U._enableLayout=function(){return!1},b(0,U,"scaleX",function(){return this._tf.scaleX},function(U){this.setScaleX(U)}),b(0,U,"transform",function(){return this.getTransform()},function(U){this.setTransform(U)}),b(0,U,"translateX",function(){return this._tf.translateX},function(U){this.setTranslateX(U)}),b(0,U,"translateY",function(){return this._tf.translateY},function(U){this.setTranslateY(U)}),b(0,U,"scaleY",function(){return this._tf.scaleY},function(U){this.setScaleY(U)}),b(0,U,"block",function(){return 0!=(1&this._type)}),b(0,U,"skewY",function(){return this._tf.skewY},function(U){this.setSkewY(U)}),b(0,U,"rotate",function(){return this._tf.rotate},function(U){this.setRotate(U)}),b(0,U,"skewX",function(){return this._tf.skewX},function(U){this.setSkewX(U)}),b(0,U,"paddingLeft",function(){return 0}),b(0,U,"paddingTop",function(){return 0}),b(0,U,"absolute",function(){return!0}),O.__init__=function(){O._TF_EMPTY=new Y,O.EMPTY=new O},O.EMPTY=null,O._TF_EMPTY=null,O}(),w=function(){function F(U){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=_.create(F.defaultColor),this.family=F.defaultFamily,this.stroke=F._STROKE,this.size=F.defaultSize,U&&U!==F.EMPTY&&U.copyTo(this)}x(F,"laya.display.css.Font");var U=F.prototype;return U.set=function(U){this._text=null;for(var F=U.split(" "),O=0,P=F.length;O<P;O++){var Y=F[O];switch(Y){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<Y.indexOf("px")&&(this.size=parseInt(Y),this.family=F[O+1],O++)}},U.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},U.copyTo=function(U){U._type=this._type,U._text=this._text,U._weight=this._weight,U._color=this._color,U.family=this.family,U.stroke=this.stroke!=F._STROKE?this.stroke.slice():F._STROKE,U.indent=this.indent,U.size=this.size},b(0,U,"password",function(){return 0!=(1024&this._type)},function(U){U?this._type|=1024:this._type&=-1025}),b(0,U,"color",function(){return this._color.strColor},function(U){this._color=_.create(U)}),b(0,U,"italic",function(){return 0!=(512&this._type)},function(U){U?this._type|=512:this._type&=-513}),b(0,U,"bold",function(){return 0!=(2048&this._type)},function(U){U?this._type|=2048:this._type&=-2049}),b(0,U,"weight",function(){return""+this._weight},function(U){var F=0;switch(U){case"normal":break;case"bold":this.bold=!0,F=700;break;case"bolder":F=800;break;case"lighter":F=100;break;default:F=parseInt(U)}this._weight=F,this._text=null}),b(0,U,"decoration",function(){return this._decoration?this._decoration.value:null},function(U){var F=U.split(" ");switch(this._decoration||(this._decoration={}),F[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=F[0]}F[1]&&(this._decoration.color=_.create(F)),this._decoration.value=U}),F.__init__=function(){F.EMPTY=new F(null)},F.EMPTY=null,F.defaultColor="#000000",F.defaultSize=12,F.defaultFamily="Arial",F.defaultFont="12px Arial",F._STROKE=[0,"#000000"],F._ITALIC=512,F._PASSWORD=1024,F._BOLD=2048,F}(),Y=function(){function U(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return x(U,"laya.display.css.TransformInfo"),U}(),J=function(){function z(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,k.isConchNode){this._nativeObj=new L._conchGraphics,this.id=this._nativeObj.conchID}}x(z,"laya.display.Graphics");var U=z.prototype;return U.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},U.clear=function(U){void 0===U&&(U=!1);var F=0,O=0;if(U){var P=this._one;if(this._cmds){for(O=this._cmds.length,F=0;F<O;F++)!(P=this._cmds[F])||P.callee!==k._context._drawTexture&&P.callee!==k._context._drawTextureWithTransform||(P[0]=null,z._cache.push(P));this._cmds.length=0}else P&&(!P||P.callee!==k._context._drawTexture&&P.callee!==k._context._drawTextureWithTransform||(P[0]=null,z._cache.push(P)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(F=0,O=this._vectorgraphArray.length;F<O;F++)W.getInstance().deleteShape(this._vectorgraphArray[F]);this._vectorgraphArray.length=0}},U._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},U._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new O,this._graphicBounds._graphics=this)},U._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},U._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},U.getBounds=function(U){return void 0===U&&(U=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(U)},U.getBoundPoints=function(U){return void 0===U&&(U=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(U)},U._addCmd=function(U){this._cmds=this._cmds||[],U.callee=U.shift(),this._cmds.push(U)},U.setFilters=function(U){this._saveToCmd(k._context._setFilters,U)},U.drawTexture=function(U,F,O,P,Y,c,L){if(void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===L&&(L=1),!U||L<.01)return null;P||(P=U.sourceWidth),Y||(Y=U.sourceHeight),L=L<0?0:1<L?1:L;var u,d=!k.isWebGL&&(m.onFirefox||m.onEdge||m.onIE||m.onSafari)?.5:0,a=P/U.sourceWidth,b=Y/U.sourceHeight;return P=U.width*a,Y=U.height*b,U.loaded&&(P<=0||Y<=0)?null:(F+=U.offsetX*a,O+=U.offsetY*b,this._sp&&(this._sp._renderType|=512),F-=d,O-=d,P+=2*d,Y+=2*d,z._cache.length?((u=z._cache.pop())[0]=U,u[1]=F,u[2]=O,u[3]=P,u[4]=Y,u[5]=c,u[6]=L):u=[U,F,O,P,Y,c,L],u.callee=c||1!=L?k._context._drawTextureWithTransform:k._context._drawTexture,null!=this._one||c||1!=L?this._saveToCmd(u.callee,u):(this._one=u,this._render=this._renderOneImg),U.loaded||U.once("loaded",this,this._textureLoaded,[U,u]),this._repaint(),u)},U.cleanByTexture=function(U,F,O,P,Y){if(void 0===P&&(P=0),void 0===Y&&(Y=0),!U)return this.clear();if(this._one&&this._render===this._renderOneImg){P||(P=U.sourceWidth),Y||(Y=U.sourceHeight);var c=P/U.sourceWidth,L=Y/U.sourceHeight;P=U.width*c,Y=U.height*L,F+=U.offsetX*c,O+=U.offsetY*L,this._one[0]=U,this._one[1]=F,this._one[2]=O,this._one[3]=P,this._one[4]=Y,this._repaint()}else this.clear(),U&&this.drawTexture(U,F,O,P,Y)},U.drawTextures=function(U,F){U&&this._saveToCmd(k._context._drawTextures,[U,F])},U.fillTexture=function(U,F,O,P,Y,c,L){if(void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===c&&(c="repeat"),U){var u=[U,F,O,P,Y,c,L||I.EMPTY,{}];U.loaded||U.once("loaded",this,this._textureLoaded,[U,u]),this._saveToCmd(k._context._fillTexture,u)}},U._textureLoaded=function(U,F){F[3]=F[3]||U.width,F[4]=F[4]||U.height,this._repaint()},U.fillCircle=function(U,F,O,P,Y,c,L){O.bitmap.enableMerageInAtlas=!1;var u=new Float32Array(2*(L+1)),d=new Float32Array(2*(L+1)),a=new Uint16Array(3*L),b=2*Math.PI/L,z=0;u[0]=P,u[1]=Y,d[0]=P/O.width,d[1]=Y/O.height;for(var J=2,w=0;w<L;w++){var j=c*Math.cos(z)+P,x=c*Math.sin(z)+Y;u[J]=j,u[J+1]=x,d[J]=j/O.width,d[J+1]=x/O.height,z+=b,J+=2}for(w=J=0;w<L;w++)a[J++]=0,a[J++]=w+1,a[J++]=L+1<=w+2?1:w+2;this.drawTriangles(O,U,F,u,d,a)},U.drawTriangles=function(U,F,O,P,Y,c,L,u,d,a){void 0===u&&(u=1),this._saveToCmd(k._context.drawTriangles,[U,F,O,P,Y,c,L,u,d,a])},U._saveToCmd=function(U,F){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=F,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(F)),F.callee=U,this._repaint(),F},U.clipRect=function(U,F,O,P){this._saveToCmd(k._context._clipRect,[U,F,O,P])},U.fillText=function(U,F,O,P,Y,c,L){void 0===L&&(L=0),this._saveToCmd(k._context._fillText,[U,F,O,P||w.defaultFont,Y,c])},U.fillBorderText=function(U,F,O,P,Y,c,L,u){this._saveToCmd(k._context._fillBorderText,[U,F,O,P||w.defaultFont,Y,c,L,u])},U.strokeText=function(U,F,O,P,Y,c,L){this._saveToCmd(k._context._strokeText,[U,F,O,P||w.defaultFont,Y,c,L])},U.alpha=function(U){U=U<0?0:1<U?1:U,this._saveToCmd(k._context._alpha,[U])},U.setAlpha=function(U){U=U<0?0:1<U?1:U,this._saveToCmd(k._context._setAlpha,[U])},U.transform=function(U,F,O){void 0===F&&(F=0),void 0===O&&(O=0),this._saveToCmd(k._context._transform,[U,F,O])},U.rotate=function(U,F,O){void 0===F&&(F=0),void 0===O&&(O=0),this._saveToCmd(k._context._rotate,[U,F,O])},U.scale=function(U,F,O,P){void 0===O&&(O=0),void 0===P&&(P=0),this._saveToCmd(k._context._scale,[U,F,O,P])},U.translate=function(U,F){this._saveToCmd(k._context._translate,[U,F])},U.save=function(){this._saveToCmd(k._context._save,[])},U.restore=function(){this._saveToCmd(k._context._restore,[])},U.replaceText=function(U){this._repaint();var F=this._cmds;if(F){for(var O=F.length-1;-1<O;O--)if(this._isTextCmd(F[O].callee))return F[O][0].toUpperCase?F[O][0]=U:F[O][0].setText(U),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=U:this._one[0].setText(U),!0;return!1},U._isTextCmd=function(U){return U===k._context._fillText||U===k._context._fillBorderText||U===k._context._strokeText},U.replaceTextColor=function(U){this._repaint();var F=this._cmds;if(F)for(var O=F.length-1;-1<O;O--)this._isTextCmd(F[O].callee)&&(F[O][4]=U,F[O][0].toUpperCase||(F[O][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=U,this._one[0].toUpperCase||(this._one[0].changed=!0))},U.loadImage=function(U,F,O,P,Y,c){var L=this;void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0),void 0===Y&&(Y=0);var u=uU.getRes(U);function d(U){U&&(L.drawTexture(U,F,O,P,Y),null!=c&&c.call(L._sp,U))}u?d(u):f.loader.load(U,h.create(null,d),null,"image")},U._renderEmpty=function(U,F,O,P){},U._renderAll=function(U,F,O,P){for(var Y,c=this._cmds,L=0,u=c.length;L<u;L++)(Y=c[L]).callee.call(F,O,P,Y)},U._renderOne=function(U,F,O,P){this._one.callee.call(F,O,P,this._one)},U._renderOneImg=function(U,F,O,P){this._one.callee.call(F,O,P,this._one),2305!==U._renderType&&(U._renderType|=1)},U.drawLine=function(U,F,O,P,Y,c){void 0===c&&(c=1);var L=0;k.isWebGL&&(L=W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(L));var u=c%2==0?0:.5,d=[U+u,F+u,O+u,P+u,Y,c,L];this._saveToCmd(k._context._drawLine,d)},U.drawLines=function(U,F,O,P,Y){void 0===Y&&(Y=1);var c=0;if(O&&!(O.length<4)){k.isWebGL&&(c=W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(c));var L=Y%2==0?0:.5,u=[U+L,F+L,O,P,Y,c];this._saveToCmd(k._context._drawLines,u)}},U.drawCurves=function(U,F,O,P,Y){void 0===Y&&(Y=1);var c=[U,F,O,P,Y];this._saveToCmd(k._context._drawCurves,c)},U.drawRect=function(U,F,O,P,Y,c,L){void 0===L&&(L=1);var u=c?L/2:0,d=c?L:0,a=[U+u,F+u,O-d,P-d,Y,c,L];this._saveToCmd(k._context._drawRect,a)},U.drawCircle=function(U,F,O,P,Y,c){void 0===c&&(c=1);var L=Y?c/2:0,u=0;k.isWebGL&&(u=W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(u));var d=[U,F,O-L,P,Y,c,u];this._saveToCmd(k._context._drawCircle,d)},U.drawPie=function(U,F,O,P,Y,c,L,u){void 0===u&&(u=1);var d=L?u/2:0,a=L?u:0,b=0;k.isWebGL&&(b=W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(b));var z=[U+d,F+d,O-a,P,Y,c,L,u,b];z[3]=S.toRadian(P),z[4]=S.toRadian(Y),this._saveToCmd(k._context._drawPie,z)},U.drawPoly=function(U,F,O,P,Y,c){void 0===c&&(c=1);var L=0,u=!1;k.isWebGL&&(L=W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(L),u=!(6<O.length));var d=Y?c%2==0?0:.5:0,a=[U+d,F+d,O,P,Y,c,L,u];this._saveToCmd(k._context._drawPoly,a)},U.drawPath=function(U,F,O,P,Y){var c=[U,F,O,P,Y];this._saveToCmd(k._context._drawPath,c)},b(0,U,"cmds",function(){return this._cmds},function(U){this._sp&&(this._sp._renderType|=512),this._cmds=U,this._render=this._renderAll,this._repaint()}),z.__init__=function(){if(k.isConchNode){for(var U=laya.display.Graphics.prototype,F=m.window.ConchGraphics.prototype,O=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],P=0,Y=O.length;P<=Y;P++){var c=O[P];U[c]=F[c]}U._saveToCmd=null,F.drawImageS&&(U.drawTextures=function(U,F){if(U&&U.loaded&&U.bitmap&&U.source){var O=U.uv,P=U.bitmap.width,Y=U.bitmap.height;this.drawImageS(U.bitmap.source,O[0]*P,O[1]*Y,(O[2]-O[0])*P,(O[5]-O[3])*Y,U.offsetX,U.offsetY,U.width,U.height,F)}}),U.drawTexture=function(U,F,O,P,Y,c,L){if(void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===L&&(L=1),U)if(U.loaded){if(U.loaded&&U.bitmap&&U.source&&(P||(P=U.sourceWidth),Y||(Y=U.sourceHeight),L=L<0?0:1<L?1:L,P=P-U.sourceWidth+U.width,Y=Y-U.sourceHeight+U.height,!(P<=0||Y<=0))){F+=U.offsetX,O+=U.offsetY;var u=U.uv,d=U.bitmap.width,a=U.bitmap.height;u[4]<u[0]&&u[5]<u[1]?this.drawImageM(U.bitmap.source,u[4]*d,u[5]*a,(u[0]-u[4])*d,(u[1]-u[5])*a,F,O,P,Y,c,L):this.drawImageM(U.bitmap.source,u[0]*d,u[1]*a,(u[2]-u[0])*d,(u[5]-u[3])*a,F,O,P,Y,c,L),this._repaint()}}else U.once("loaded",this,function(){this.drawTexture(U,F,O,P,Y,c)})},U.fillTexture=function(U,F,O,P,Y,c,L){if(void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===c&&(c="repeat"),U&&U.loaded){var u,d=k._context.ctx,a=U.bitmap.width,b=U.bitmap.height,z=U.uv;u=U.uv!=bU.DEF_UV?d.createPattern(U.bitmap.source,c,z[0]*a,z[1]*b,(z[2]-z[0])*a,(z[5]-z[3])*b):d.createPattern(U.bitmap.source,c);var J=0,w=0;L&&(F+=L.x%U.width,O+=L.y%U.height,J-=L.x%U.width,w-=L.y%U.height),this._fillImage(u,F,O,J,w,P,Y)}}}},z._cache=[],z}(),O=function(){function Q(){this._cacheBoundsType=!1}x(Q,"laya.display.GraphicsBounds");var U=Q.prototype;return U.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},U.reset=function(){this._temp&&(this._temp.length=0)},U.getBounds=function(U){return void 0===U&&(U=!1),(!this._bounds||!this._temp||this._temp.length<1||U!=this._cacheBoundsType)&&(this._bounds=T._getWrapRec(this.getBoundPoints(U),this._bounds)),this._cacheBoundsType=U,this._bounds},U.getBoundPoints=function(U){return void 0===U&&(U=!1),(!this._temp||this._temp.length<1||U!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(U)),this._cacheBoundsType=U,this._rstBoundPoints=S.copyArray(this._rstBoundPoints,this._temp)},U._getCmdPoints=function(U){void 0===U&&(U=!1);var F,O,P=k._context,Y=this._graphics.cmds;if((F=this._temp||(this._temp=[])).length=0,Y||null==this._graphics._one||(Q._tempCmds.length=0,Q._tempCmds.push(this._graphics._one),Y=Q._tempCmds),!Y)return F;(O=Q._tempMatrixArrays).length=0;var c=Q._initMatrix;c.identity();for(var L,u,d=Q._tempMatrix,a=NaN,b=NaN,z=NaN,J=NaN,w=NaN,j=NaN,x=0,r=Y.length;x<r;x++)if((L=Y[x]).callee)switch(L.callee){case P._save:case 7:O.push(c),c=c.clone();break;case P._restore:case 8:c=O.pop();break;case P._scale:case 5:d.identity(),d.translate(-L[2],-L[3]),d.scale(L[0],L[1]),d.translate(L[2],L[3]),this._switchMatrix(c,d);break;case P._rotate:case 3:d.identity(),d.translate(-L[1],-L[2]),d.rotate(L[0]),d.translate(L[1],L[2]),this._switchMatrix(c,d);break;case P._translate:case 6:d.identity(),d.translate(L[0],L[1]),this._switchMatrix(c,d);break;case P._transform:case 4:d.identity(),d.translate(-L[1],-L[2]),d.concat(L[0]),d.translate(L[1],L[2]),this._switchMatrix(c,d);break;case 16:case 24:Q._addPointArrToRst(F,T._getBoundPointS(L[0],L[1],L[2],L[3]),c);break;case 17:c.copyTo(d),d.concat(L[4]),Q._addPointArrToRst(F,T._getBoundPointS(L[0],L[1],L[2],L[3]),d);break;case P._drawTexture:u=L[0],U?L[3]&&L[4]?Q._addPointArrToRst(F,T._getBoundPointS(L[1],L[2],L[3],L[4]),c):(u=L[0],Q._addPointArrToRst(F,T._getBoundPointS(L[1],L[2],u.width,u.height),c)):(a=(L[3]||u.sourceWidth)/u.width,b=(L[4]||u.sourceHeight)/u.height,z=a*u.sourceWidth,J=b*u.sourceHeight,w=0<u.offsetX?u.offsetX:0,j=0<u.offsetY?u.offsetY:0,w*=a,j*=b,Q._addPointArrToRst(F,T._getBoundPointS(L[1]-w,L[2]-j,z,J),c));break;case P._fillTexture:L[3]&&L[4]?Q._addPointArrToRst(F,T._getBoundPointS(L[1],L[2],L[3],L[4]),c):(u=L[0],Q._addPointArrToRst(F,T._getBoundPointS(L[1],L[2],u.width,u.height),c));break;case P._drawTextureWithTransform:var H;H=L[5]?(c.copyTo(d),d.concat(L[5]),d):c,U?L[3]&&L[4]?Q._addPointArrToRst(F,T._getBoundPointS(L[1],L[2],L[3],L[4]),H):(u=L[0],Q._addPointArrToRst(F,T._getBoundPointS(L[1],L[2],u.width,u.height),H)):(u=L[0],a=(L[3]||u.sourceWidth)/u.width,b=(L[4]||u.sourceHeight)/u.height,z=a*u.sourceWidth,J=b*u.sourceHeight,w=0<u.offsetX?u.offsetX:0,j=0<u.offsetY?u.offsetY:0,w*=a,j*=b,Q._addPointArrToRst(F,T._getBoundPointS(L[1]-w,L[2]-j,z,J),H));break;case P._drawRect:case 13:Q._addPointArrToRst(F,T._getBoundPointS(L[0],L[1],L[2],L[3]),c);break;case P._drawCircle:case P._fillCircle:case 14:Q._addPointArrToRst(F,T._getBoundPointS(L[0]-L[2],L[1]-L[2],L[2]+L[2],L[2]+L[2]),c);break;case P._drawLine:case 20:Q._tempPoints.length=0;var h;h=.5*L[5],L[0]==L[2]?Q._tempPoints.push(L[0]+h,L[1],L[2]+h,L[3],L[0]-h,L[1],L[2]-h,L[3]):L[1]==L[3]?Q._tempPoints.push(L[0],L[1]+h,L[2],L[3]+h,L[0],L[1]-h,L[2],L[3]-h):Q._tempPoints.push(L[0],L[1],L[2],L[3]),Q._addPointArrToRst(F,Q._tempPoints,c);break;case P._drawCurves:case 22:Q._addPointArrToRst(F,X.I.getBezierPoints(L[2]),c,L[0],L[1]);break;case P._drawPoly:case P._drawLines:case 18:Q._addPointArrToRst(F,L[2],c,L[0],L[1]);break;case P._drawPath:case 19:Q._addPointArrToRst(F,this._getPathPoints(L[2]),c,L[0],L[1]);break;case P._drawPie:case 15:Q._addPointArrToRst(F,this._getPiePoints(L[0],L[1],L[2],L[3],L[4]),c)}return 200<F.length?F=S.copyArray(F,T._getWrapRec(F)._getBoundPoints()):8<F.length&&(F=N.scanPList(F)),F},U._switchMatrix=function(U,F){F.concat(U),F.copyTo(U)},U._getPiePoints=function(U,F,O,P,Y){var c=Q._tempPoints;Q._tempPoints.length=0,c.push(U,F);var L=(Y-P)%(2*Math.PI)/10,u=NaN,d=P;for(u=0;u<=10;u++)c.push(U+O*Math.cos(d),F+O*Math.sin(d)),d+=L;return c},U._getPathPoints=function(U){var F,O,P=0,Y=Q._tempPoints;for(Y.length=0,F=U.length,P=0;P<F;P++)1<(O=U[P]).length&&(Y.push(O[1],O[2]),3<O.length&&Y.push(O[3],O[4]));return Y},Q._addPointArrToRst=function(U,F,O,P,Y){void 0===P&&(P=0),void 0===Y&&(Y=0);var c,L=0;for(c=F.length,L=0;L<c;L+=2)Q._addPointToRst(U,F[L]+P,F[L+1]+Y,O)},Q._addPointToRst=function(U,F,O,P){var Y=I.TEMP;Y.setTo(F||0,O||0),P.transformPoint(Y),U.push(Y.x,Y.y)},Q._tempPoints=[],Q._tempMatrixArrays=[],Q._tempCmds=[],d(Q,["_tempMatrix",function(){return this._tempMatrix=new s},"_initMatrix",function(){return this._initMatrix=new s}]),Q}(),c=function(){function U(){}x(U,"laya.events.Event");var F=U.prototype;return F.setTo=function(U,F,O){return this.type=U,this.currentTarget=F,this.target=O,this},F.stopPropagation=function(){this._stoped=!0},b(0,F,"stageY",function(){return f.stage.mouseY}),b(0,F,"charCode",function(){return this.nativeEvent.charCode}),b(0,F,"touches",function(){var U=this.nativeEvent.touches;if(U)for(var F=f.stage,O=0,P=U.length;O<P;O++){var Y=U[O],c=I.TEMP;c.setTo(Y.clientX,Y.clientY),F._canvasTransform.invertTransformPoint(c),F.transform.invertTransformPoint(c),Y.stageX=c.x,Y.stageY=c.y}return U}),b(0,F,"keyLocation",function(){return this.nativeEvent.keyLocation}),b(0,F,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),b(0,F,"altKey",function(){return this.nativeEvent.altKey}),b(0,F,"shiftKey",function(){return this.nativeEvent.shiftKey}),b(0,F,"stageX",function(){return f.stage.mouseX}),U.EMPTY=new U,U.MOUSE_DOWN="mousedown",U.MOUSE_UP="mouseup",U.CLICK="click",U.RIGHT_MOUSE_DOWN="rightmousedown",U.RIGHT_MOUSE_UP="rightmouseup",U.RIGHT_CLICK="rightclick",U.MOUSE_MOVE="mousemove",U.MOUSE_OVER="mouseover",U.MOUSE_OUT="mouseout",U.MOUSE_WHEEL="mousewheel",U.ROLL_OVER="mouseover",U.ROLL_OUT="mouseout",U.DOUBLE_CLICK="doubleclick",U.CHANGE="change",U.CHANGED="changed",U.RESIZE="resize",U.ADDED="added",U.REMOVED="removed",U.DISPLAY="display",U.UNDISPLAY="undisplay",U.ERROR="error",U.COMPLETE="complete",U.LOADED="loaded",U.INITED="inited",U.PROGRESS="progress",U.INPUT="input",U.RENDER="render",U.OPEN="open",U.MESSAGE="message",U.CLOSE="close",U.KEY_DOWN="keydown",U.KEY_PRESS="keypress",U.KEY_UP="keyup",U.FRAME="enterframe",U.DRAG_START="dragstart",U.DRAG_MOVE="dragmove",U.DRAG_END="dragend",U.ENTER="enter",U.SELECT="select",U.BLUR="blur",U.FOCUS="focus",U.VISIBILITY_CHANGE="visibilitychange",U.FOCUS_CHANGE="focuschange",U.PLAYED="played",U.PAUSED="paused",U.STOPPED="stopped",U.START="start",U.END="end",U.ENABLE_CHANGED="enablechanged",U.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",U.COMPONENT_ADDED="componentadded",U.COMPONENT_REMOVED="componentremoved",U.LAYER_CHANGED="layerchanged",U.HIERARCHY_LOADED="hierarchyloaded",U.RECOVERED="recovered",U.RELEASED="released",U.LINK="link",U.LABEL="label",U.FULL_SCREEN_CHANGE="fullscreenchange",U.DEVICE_LOST="devicelost",U.MESH_CHANGED="meshchanged",U.MATERIAL_CHANGED="materialchanged",U.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",U.ANIMATION_CHANGED="animationchanged",U.TRIGGER_ENTER="triggerenter",U.TRIGGER_STAY="triggerstay",U.TRIGGER_EXIT="triggerexit",U.TRAIL_FILTER_CHANGE="trailfilterchange",U.DOMINO_FILTER_CHANGE="dominofilterchange",U}(),z=(function(){function U(){}x(U,"laya.events.Keyboard"),U.NUMBER_0=48,U.NUMBER_1=49,U.NUMBER_2=50,U.NUMBER_3=51,U.NUMBER_4=52,U.NUMBER_5=53,U.NUMBER_6=54,U.NUMBER_7=55,U.NUMBER_8=56,U.NUMBER_9=57,U.A=65,U.B=66,U.C=67,U.D=68,U.E=69,U.F=70,U.G=71,U.H=72,U.I=73,U.J=74,U.K=75,U.L=76,U.M=77,U.N=78,U.O=79,U.P=80,U.Q=81,U.R=82,U.S=83,U.T=84,U.U=85,U.V=86,U.W=87,U.X=88,U.Y=89,U.Z=90,U.F1=112,U.F2=113,U.F3=114,U.F4=115,U.F5=116,U.F6=117,U.F7=118,U.F8=119,U.F9=120,U.F10=121,U.F11=122,U.F12=123,U.F13=124,U.F14=125,U.F15=126,U.NUMPAD=21,U.NUMPAD_0=96,U.NUMPAD_1=97,U.NUMPAD_2=98,U.NUMPAD_3=99,U.NUMPAD_4=100,U.NUMPAD_5=101,U.NUMPAD_6=102,U.NUMPAD_7=103,U.NUMPAD_8=104,U.NUMPAD_9=105,U.NUMPAD_ADD=107,U.NUMPAD_DECIMAL=110,U.NUMPAD_DIVIDE=111,U.NUMPAD_ENTER=108,U.NUMPAD_MULTIPLY=106,U.NUMPAD_SUBTRACT=109,U.SEMICOLON=186,U.EQUAL=187,U.COMMA=188,U.MINUS=189,U.PERIOD=190,U.SLASH=191,U.BACKQUOTE=192,U.LEFTBRACKET=219,U.BACKSLASH=220,U.RIGHTBRACKET=221,U.QUOTE=222,U.ALTERNATE=18,U.BACKSPACE=8,U.CAPS_LOCK=20,U.COMMAND=15,U.CONTROL=17,U.DELETE=46,U.ENTER=13,U.ESCAPE=27,U.PAGE_UP=33,U.PAGE_DOWN=34,U.END=35,U.HOME=36,U.LEFT=37,U.UP=38,U.RIGHT=39,U.DOWN=40,U.SHIFT=16,U.SPACE=32,U.TAB=9,U.INSERT=45}(),function(){function Y(){}return x(Y,"laya.events.KeyBoardManager"),Y.__init__=function(){Y._addEvent("keydown"),Y._addEvent("keypress"),Y._addEvent("keyup")},Y._addEvent=function(F){m.document.addEventListener(F,function(U){laya.events.KeyBoardManager._dispatch(U,F)},!0)},Y._dispatch=function(U,F){if(Y.enabled){Y._event._stoped=!1,Y._event.nativeEvent=U,Y._event.keyCode=U.keyCode||U.which||U.charCode,"keydown"===F?Y._pressKeys[Y._event.keyCode]=!0:"keyup"===F&&(Y._pressKeys[Y._event.keyCode]=null);for(var O=f.stage.focus&&null!=f.stage.focus.event&&f.stage.focus.displayedInStage?f.stage.focus:f.stage,P=O;P;)P.event(F,Y._event.setTo(F,P,O)),P=P.parent}},Y.hasKeyDown=function(U){return Y._pressKeys[U]},Y._pressKeys={},Y.enabled=!0,d(Y,["_event",function(){return this._event=new c}]),Y}()),j=(function(){function U(){}x(U,"laya.events.KeyLocation"),U.STANDARD=0,U.LEFT=1,U.RIGHT=2,U.NUM_PAD=3}(),function(){function b(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=m.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new c,this._matrix=new s,this._point=new I,this._rect=new T,this._prePoint=new I,this._curTouchID=NaN}x(b,"laya.events.MouseManager");var U=b.prototype;return U.__init__=function(U,F){var O=this;this._stage=U;var P=this,Y=this._eventList;F.oncontextmenu=function(U){if(b.enabled)return!1},F.addEventListener("mousedown",function(U){b.enabled&&(m.onIE||U.preventDefault(),Y.push(U),P.mouseDownTime=m.now())}),F.addEventListener("mouseup",function(U){b.enabled&&(U.preventDefault(),Y.push(U),P.mouseDownTime=-m.now())},!0),F.addEventListener("mousemove",function(U){if(b.enabled){U.preventDefault();var F=m.now();if(F-P._lastMoveTimer<10)return;P._lastMoveTimer=F,Y.push(U)}},!0),F.addEventListener("mouseout",function(U){b.enabled&&Y.push(U)}),F.addEventListener("mouseover",function(U){b.enabled&&Y.push(U)}),F.addEventListener("touchstart",function(U){b.enabled&&(Y.push(U),b._isFirstTouch||NU.isInputting||U.preventDefault(),P.mouseDownTime=m.now())}),F.addEventListener("touchend",function(U){b.enabled?(b._isFirstTouch||NU.isInputting||U.preventDefault(),b._isFirstTouch=!1,Y.push(U),P.mouseDownTime=-m.now()):O._curTouchID=NaN},!0),F.addEventListener("touchmove",function(U){b.enabled&&(U.preventDefault(),Y.push(U))},!0),F.addEventListener("touchcancel",function(U){b.enabled?(U.preventDefault(),Y.push(U)):O._curTouchID=NaN},!0),F.addEventListener("mousewheel",function(U){b.enabled&&Y.push(U)}),F.addEventListener("DOMMouseScroll",function(U){b.enabled&&Y.push(U)})},U.initEvent=function(U,F){var O,P=this;P._event._stoped=!1,P._event.nativeEvent=F||U,P._target=null,this._point.setTo(U.pageX||U.clientX,U.pageY||U.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),P.mouseX=this._point.x,P.mouseY=this._point.y,P._event.touchId=U.identifier||0,this._tTouchID=P._event.touchId,(O=r.I._event)._stoped=!1,O.nativeEvent=P._event.nativeEvent,O.touchId=P._event.touchId},U.checkMouseWheel=function(U){this._event.delta=U.wheelDelta?.025*U.wheelDelta:-U.detail;for(var F=r.I.getLastOvers(),O=0,P=F.length;O<P;O++){var Y=F[O];Y.event("mousewheel",this._event.setTo("mousewheel",Y,this._target))}},U.onMouseMove=function(U){r.I.onMouseMove(U,this._tTouchID)},U.onMouseDown=function(U){if(NU.isInputting&&f.stage.focus&&f.stage.focus.focus&&!f.stage.focus.contains(this._target)){var F=f.stage.focus._tf||f.stage.focus,O=U._tf||U;O instanceof laya.display.Input&&O.multiline==F.multiline?F._focusOut():F.focus=!1}r.I.onMouseDown(U,this._tTouchID,this._isLeftMouse)},U.onMouseUp=function(U){r.I.onMouseUp(U,this._tTouchID,this._isLeftMouse)},U.check=function(U,F,O,P){this._point.setTo(F,O),U.fromParentPoint(this._point),F=this._point.x,O=this._point.y;var Y=U.scrollRect;if(Y&&(this._rect.setTo(Y.x,Y.y,Y.width,Y.height),!this._rect.contains(F,O)))return!1;if(!this.disableMouseEvent){if(U.hitTestPrior&&!U.mouseThrough&&!this.hitTest(U,F,O))return!1;for(var c=U._childs.length-1;-1<c;c--){var L=U._childs[c];if(!L.destroyed&&L.mouseEnabled&&L.visible&&this.check(L,F,O,P))return!0}}var u=!(!U.hitTestPrior||U.mouseThrough||this.disableMouseEvent)||this.hitTest(U,F,O);return u?(this._target=U,P.call(this,U)):P===this.onMouseUp&&U===this._stage&&(this._target=this._stage,P.call(this,this._target)),u},U.hitTest=function(U,F,O){var P=!1;if(U.scrollRect&&(F-=U.scrollRect.x,O-=U.scrollRect.y),U.hitArea instanceof laya.utils.HitArea)return U.hitArea.isHit(F,O);if(0<U.width&&0<U.height||U.mouseThrough||U.hitArea)if(U.mouseThrough)P=U.getGraphicBounds().contains(F,O);else{var Y=this._rect;U.hitArea?Y=U.hitArea:Y.setTo(0,0,U.width,U.height),P=Y.contains(F,O)}return P},U.runEvent=function(){var U=this._eventList.length;if(U){var F=this;F.mouseEventTime=m.now();var O,P=0,Y=0,c=0;try{for(;P<U;){var L=this._eventList[P];switch("mousemove"!==L.type&&(this._prePoint.x=this._prePoint.y=-1e6),L.type){case"mousedown":this._touchIDs[0]=this._id++,b._isTouchRespond?b._isTouchRespond=!1:(F._isLeftMouse=0===L.button,F.initEvent(L),F.check(F._stage,F.mouseX,F.mouseY,F.onMouseDown));break;case"mouseup":F._isLeftMouse=0===L.button,F.initEvent(L),F.check(F._stage,F.mouseX,F.mouseY,F.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-L.clientX)+Math.abs(this._prePoint.y-L.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=L.clientX,this._prePoint.y=L.clientY,F.initEvent(L),F.check(F._stage,F.mouseX,F.mouseY,F.onMouseMove));break;case"touchstart":b._isTouchRespond=!0,F._isLeftMouse=!0;var u=L.changedTouches;for(Y=0,c=u.length;Y<c;Y++)O=u[Y],(b.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=O.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[O.identifier]=this._id++,F.initEvent(O,L),F.check(F._stage,F.mouseX,F.mouseY,F.onMouseDown));break;case"touchend":case"touchcancel":b._isTouchRespond=!0,F._isLeftMouse=!0;var d=L.changedTouches;for(Y=0,c=d.length;Y<c;Y++)if(O=d[Y],b.multiTouchEnabled||O.identifier==this._curTouchID){this._curTouchID=NaN,F.initEvent(O,L);F.check(F._stage,F.mouseX,F.mouseY,F.onMouseUp)||F.onMouseUp(null)}break;case"touchmove":var a=L.changedTouches;for(Y=0,c=a.length;Y<c;Y++)O=a[Y],(b.multiTouchEnabled||O.identifier==this._curTouchID)&&(F.initEvent(O,L),F.check(F._stage,F.mouseX,F.mouseY,F.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":F.checkMouseWheel(L);break;case"mouseout":r.I.stageMouseOut();break;case"mouseover":F._stage.event("mouseover",F._event.setTo("mouseover",F._stage,F._stage))}P++}}catch(U){throw this._eventList.length=0,U}this._eventList.length=0}},b.enabled=!0,b.multiTouchEnabled=!0,b._isTouchRespond=!1,b._isFirstTouch=!0,d(b,["instance",function(){return this.instance=new b}]),b}()),r=function(){function j(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new c}x(j,"laya.events.TouchManager");var U=j.prototype;return U._clearTempArrs=function(){j._oldArr.length=0,j._newArr.length=0,j._tEleArr.length=0},U.getTouchFromArr=function(U,F){var O,P,Y=0;for(O=F.length,Y=0;Y<O;Y++)if((P=F[Y]).id==U)return P;return null},U.removeTouchFromArr=function(U,F){var O=0;for(O=F.length-1;0<=O;O--)F[O].id==U&&F.splice(O,1)},U.createTouchO=function(U,F){var O;return(O=e.getItem("TouchData")||{}).id=F,O.tar=U,O},U.onMouseDown=function(U,F,O){var P,Y,c,L;(void 0===O&&(O=!1),this.enable)&&(P=this.getTouchFromArr(F,this.preOvers),c=this.getEles(U,null,j._tEleArr),P?P.tar=U:(Y=this.createTouchO(U,F),this.preOvers.push(Y)),m.onMobile&&this.sendEvents(c,"mouseover",F),L=O?this.preDowns:this.preRightDowns,(P=this.getTouchFromArr(F,L))?P.tar=U:(Y=this.createTouchO(U,F),L.push(Y)),this.sendEvents(c,O?"mousedown":"rightmousedown",F),this._clearTempArrs())},U.sendEvents=function(U,F,O){void 0===O&&(O=0);var P,Y,c,L=0;for(P=U.length,this._event._stoped=!1,Y=U[0],L=0;L<P;L++){if((c=U[L]).destroyed)return;if(c.event(F,this._event.setTo(F,c,Y)),this._event._stoped)break}},U.getEles=function(U,F,O){for(O?O.length=0:O=[];U&&U!=F;)O.push(U),U=U.parent;return O},U.checkMouseOutAndOverOfMove=function(U,F,O){if(void 0===O&&(O=0),F!=U){var P,Y,c=0,L=0;if(F.contains(U))Y=this.getEles(U,F,j._tEleArr),this.sendEvents(Y,"mouseover",O);else if(U.contains(F))Y=this.getEles(F,U,j._tEleArr),this.sendEvents(Y,"mouseout",O);else{var u,d;(Y=j._tEleArr).length=0,u=this.getEles(F,null,j._oldArr),d=this.getEles(U,null,j._newArr),L=u.length;var a=0;for(c=0;c<L;c++){if(P=u[c],0<=(a=d.indexOf(P))){d.splice(a,d.length-a);break}Y.push(P)}0<Y.length&&this.sendEvents(Y,"mouseout",O),0<d.length&&this.sendEvents(d,"mouseover",O)}}},U.onMouseMove=function(U,F){var O,P;this.enable&&((O=this.getTouchFromArr(F,this.preOvers))?(this.checkMouseOutAndOverOfMove(U,O.tar),O.tar=U,P=this.getEles(U,null,j._tEleArr)):(P=this.getEles(U,null,j._tEleArr),this.sendEvents(P,"mouseover",F),this.preOvers.push(this.createTouchO(U,F))),this.sendEvents(P,"mousemove",F),this._clearTempArrs())},U.getLastOvers=function(){return(j._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,j._tEleArr):(j._tEleArr.push(f.stage),j._tEleArr)},U.stageMouseOut=function(){var U;U=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(U,"mouseout",0)},U.onMouseUp=function(U,F,O){if(void 0===O&&(O=!1),this.enable){var P,Y,c,L,u,d,a=0,b=0,z=m.onMobile;if(Y=this.getEles(U,null,j._tEleArr),this.sendEvents(Y,O?"mouseup":"rightmouseup",F),d=O?this.preDowns:this.preRightDowns,P=this.getTouchFromArr(F,d)){var J,w=m.now();if(J=w-this._lastClickTime<300,this._lastClickTime=w,U==P.tar)u=Y;else for(c=this.getEles(P.tar,null,j._oldArr),(u=j._newArr).length=0,b=c.length,a=0;a<b;a++)L=c[a],0<=Y.indexOf(L)&&u.push(L);0<u.length&&this.sendEvents(u,O?"click":"rightclick",F),O&&J&&this.sendEvents(u,"doubleclick",F),this.removeTouchFromArr(F,d),P.tar=null,e.recover("TouchData",P)}else;(P=this.getTouchFromArr(F,this.preOvers))&&z&&((u=this.getEles(P.tar,null,u))&&0<u.length&&this.sendEvents(u,"mouseout",F),this.removeTouchFromArr(F,this.preOvers),P.tar=null,e.recover("TouchData",P)),this._clearTempArrs()}},j._oldArr=[],j._newArr=[],j._tEleArr=[],d(j,["I",function(){return this.I=new j}]),j}(),H=function(){function U(){this._action=null}x(U,"laya.filters.Filter");var F=U.prototype;return f.imps(F,{"laya.filters.IFilter":!0}),F.callNative=function(U){},b(0,F,"type",function(){return-1}),b(0,F,"action",function(){return this._action}),U.BLUR=16,U.COLOR=32,U.GLOW=8,U._filterStart=null,U._filterEnd=null,U._EndTarget=null,U._recycleScope=null,U._filter=null,U._useSrc=null,U._endSrc=null,U._useOut=null,U._endOut=null,U}(),Q=function(){function U(){this.data=null}x(U,"laya.filters.ColorFilterAction");var F=U.prototype;return f.imps(F,{"laya.filters.IFilterAction":!0}),F.apply=function(U){var F=U.ctx.ctx,O=U.ctx.ctx.canvas;if(0==O.width||0==O.height)return O;for(var P,Y=F.getImageData(0,0,O.width,O.height),c=Y.data,L=0,u=c.length;L<u;L+=4)P=this.getColor(c[L],c[L+1],c[L+2],c[L+3]),0!=c[L+3]&&(c[L]=P[0],c[L+1]=P[1],c[L+2]=P[2],c[L+3]=P[3]);return F.putImageData(Y,0,0),U},F.getColor=function(U,F,O,P){var Y=[];if(this.data._mat&&this.data._alpha){var c=this.data._mat,L=this.data._alpha;Y[0]=c[0]*U+c[1]*F+c[2]*O+c[3]*P+L[0],Y[1]=c[4]*U+c[5]*F+c[6]*O+c[7]*P+L[1],Y[2]=c[8]*U+c[9]*F+c[10]*O+c[11]*P+L[2],Y[3]=c[12]*U+c[13]*F+c[14]*O+c[15]*P+L[3]}return Y},U}(),X=(function(){function U(){}x(U,"laya.maths.Arith"),U.formatR=function(U){return U>Math.PI&&(U-=2*Math.PI),U<-Math.PI&&(U+=2*Math.PI),U},U.isPOT=function(U,F){return 0<U&&0==(U&U-1)&&0<F&&0==(F&F-1)},U.setMatToArray=function(U,F){U.a,U.b,U.c,U.d,U.tx,U.ty,F[0]=U.a,F[1]=U.b,F[4]=U.c,F[5]=U.d,F[12]=U.tx,F[13]=U.ty}}(),function(){function U(){this._controlPoints=[new I,new I,new I],this._calFun=this.getPoint2}x(U,"laya.maths.Bezier");var F=U.prototype;return F._switchPoint=function(U,F){var O=this._controlPoints.shift();O.setTo(U,F),this._controlPoints.push(O)},F.getPoint2=function(U,F){var O=this._controlPoints[0],P=this._controlPoints[1],Y=this._controlPoints[2],c=Math.pow(1-U,2)*O.x+2*U*(1-U)*P.x+Math.pow(U,2)*Y.x,L=Math.pow(1-U,2)*O.y+2*U*(1-U)*P.y+Math.pow(U,2)*Y.y;F.push(c,L)},F.getPoint3=function(U,F){var O=this._controlPoints[0],P=this._controlPoints[1],Y=this._controlPoints[2],c=this._controlPoints[3],L=Math.pow(1-U,3)*O.x+3*P.x*U*(1-U)*(1-U)+3*Y.x*U*U*(1-U)+c.x*Math.pow(U,3),u=Math.pow(1-U,3)*O.y+3*P.y*U*(1-U)*(1-U)+3*Y.y*U*U*(1-U)+c.y*Math.pow(U,3);F.push(L,u)},F.insertPoints=function(U,F){var O,P=NaN;for(O=1/(U=0<U?U:5),P=0;P<=1;P+=O)this._calFun(P,F)},F.getBezierPoints=function(U,F,O){void 0===F&&(F=5),void 0===O&&(O=2);var P,Y,c=0;if((P=U.length)<2*(O+1))return[];switch(Y=[],O){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=O;)this._controlPoints.push(new I);for(c=0;c<2*O;c+=2)this._switchPoint(U[c],U[c+1]);for(c=2*O;c<P;c+=2)this._switchPoint(U[c],U[c+1]),c/2%O==0&&this.insertPoints(F,Y);return Y},d(U,["I",function(){return this.I=new U}]),U}()),N=function(){function a(){}return x(a,"laya.maths.GrahamScan"),a.multiply=function(U,F,O){return(U.x-O.x)*(F.y-O.y)-(F.x-O.x)*(U.y-O.y)},a.dis=function(U,F){return(U.x-F.x)*(U.x-F.x)+(U.y-F.y)*(U.y-F.y)},a._getPoints=function(U,F,O){for(void 0===F&&(F=!1),a._mPointList||(a._mPointList=[]);a._mPointList.length<U;)a._mPointList.push(new I);return O||(O=[]),O.length=0,F?a.getFrom(O,a._mPointList,U):a.getFromR(O,a._mPointList,U),O},a.getFrom=function(U,F,O){var P=0;for(P=0;P<O;P++)U.push(F[P]);return U},a.getFromR=function(U,F,O){var P=0;for(P=0;P<O;P++)U.push(F.pop());return U},a.pListToPointList=function(U,F){void 0===F&&(F=!1);var O=0,P=U.length/2,Y=a._getPoints(P,F,a._tempPointList);for(O=0;O<P;O++)Y[O].setTo(U[O+O],U[O+O+1]);return Y},a.pointListToPlist=function(U){var F,O=0,P=U.length,Y=a._temPList;for(O=Y.length=0;O<P;O++)F=U[O],Y.push(F.x,F.y);return Y},a.scanPList=function(U){return S.copyArray(U,a.pointListToPlist(a.scan(a.pListToPointList(U,!0))))},a.scan=function(U){var F,O,P,Y=0,c=0,L=0,u=U.length,d={};for((O=a._temArr).length=0,Y=(u=U.length)-1;0<=Y;Y--)P=(F=U[Y]).x+"_"+F.y,d.hasOwnProperty(P)||(d[P]=!0,O.push(F));for(u=O.length,S.copyArray(U,O),Y=1;Y<u;Y++)(U[Y].y<U[L].y||U[Y].y==U[L].y&&U[Y].x<U[L].x)&&(L=Y);for(F=U[0],U[0]=U[L],U[L]=F,Y=1;Y<u-1;Y++){for(c=(L=Y)+1;c<u;c++)(0<a.multiply(U[c],U[L],U[0])||0==a.multiply(U[c],U[L],U[0])&&a.dis(U[0],U[c])<a.dis(U[0],U[L]))&&(L=c);F=U[Y],U[Y]=U[L],U[L]=F}if((O=a._temArr).length=0,U.length<3)return S.copyArray(O,U);for(O.push(U[0],U[1],U[2]),Y=3;Y<u;Y++){for(;2<=O.length&&0<=a.multiply(U[Y],O[O.length-1],O[O.length-2]);)O.pop();U[Y]&&O.push(U[Y])}return O},a._mPointList=null,a._tempPointList=[],a._temPList=[],a._temArr=[],a}(),K=function(){function Y(){}return x(Y,"laya.maths.MathUtil"),Y.subtractVector3=function(U,F,O){O[0]=U[0]-F[0],O[1]=U[1]-F[1],O[2]=U[2]-F[2]},Y.lerp=function(U,F,O){return U*(1-O)+F*O},Y.scaleVector3=function(U,F,O){O[0]=U[0]*F,O[1]=U[1]*F,O[2]=U[2]*F},Y.lerpVector3=function(U,F,O,P){var Y=U[0],c=U[1],L=U[2];P[0]=Y+O*(F[0]-Y),P[1]=c+O*(F[1]-c),P[2]=L+O*(F[2]-L)},Y.lerpVector4=function(U,F,O,P){var Y=U[0],c=U[1],L=U[2],u=U[3];P[0]=Y+O*(F[0]-Y),P[1]=c+O*(F[1]-c),P[2]=L+O*(F[2]-L),P[3]=u+O*(F[3]-u)},Y.slerpQuaternionArray=function(U,F,O,P,Y,c,L){var u,d,a,b,z,J=U[F+0],w=U[F+1],j=U[F+2],x=U[F+3],r=O[P+0],H=O[P+1],h=O[P+2],Q=O[P+3];return(d=J*r+w*H+j*h+x*Q)<0&&(d=-d,r=-r,H=-H,h=-h,Q=-Q),z=1e-6<1-d?(u=Math.acos(d),a=Math.sin(u),b=Math.sin((1-Y)*u)/a,Math.sin(Y*u)/a):(b=1-Y,Y),c[L+0]=b*J+z*r,c[L+1]=b*w+z*H,c[L+2]=b*j+z*h,c[L+3]=b*x+z*Q,c},Y.getRotation=function(U,F,O,P){return Math.atan2(P-F,O-U)/Math.PI*180},Y.sortBigFirst=function(U,F){return U==F?0:U<F?1:-1},Y.sortSmallFirst=function(U,F){return U==F?0:U<F?-1:1},Y.sortNumBigFirst=function(U,F){return parseFloat(F)-parseFloat(U)},Y.sortNumSmallFirst=function(U,F){return parseFloat(U)-parseFloat(F)},Y.sortByKey=function(O,U,F){var P;return void 0===U&&(U=!1),void 0===F&&(F=!0),P=U?F?Y.sortNumBigFirst:Y.sortBigFirst:F?Y.sortNumSmallFirst:Y.sortSmallFirst,function(U,F){return P(U[O],F[O])}},Y}(),s=function(){function O(U,F,O,P,Y,c){this.inPool=!1,this.bTransform=!1,void 0===U&&(U=1),void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=1),void 0===Y&&(Y=0),void 0===c&&(c=0),this.a=U,this.b=F,this.c=O,this.d=P,this.tx=Y,this.ty=c,this._checkTransform()}x(O,"laya.maths.Matrix");var U=O.prototype;return U.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},U._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},U.setTranslate=function(U,F){return this.tx=U,this.ty=F,this},U.translate=function(U,F){return this.tx+=U,this.ty+=F,this},U.scale=function(U,F){this.a*=U,this.d*=F,this.c*=U,this.b*=F,this.tx*=U,this.ty*=F,this.bTransform=!0},U.rotate=function(U){var F=Math.cos(U),O=Math.sin(U),P=this.a,Y=this.c,c=this.tx;this.a=P*F-this.b*O,this.b=P*O+this.b*F,this.c=Y*F-this.d*O,this.d=Y*O+this.d*F,this.tx=c*F-this.ty*O,this.ty=c*O+this.ty*F,this.bTransform=!0},U.skew=function(U,F){var O=Math.tan(U),P=Math.tan(F),Y=this.a,c=this.b;return this.a+=P*this.c,this.b+=P*this.d,this.c+=O*Y,this.d+=O*c,this},U.invertTransformPoint=function(U){var F=this.a,O=this.b,P=this.c,Y=this.d,c=this.tx,L=F*Y-O*P,u=Y/L,d=-O/L,a=-P/L,b=F/L,z=(P*this.ty-Y*c)/L,J=-(F*this.ty-O*c)/L;return U.setTo(u*U.x+a*U.y+z,d*U.x+b*U.y+J)},U.transformPoint=function(U){return U.setTo(this.a*U.x+this.c*U.y+this.tx,this.b*U.x+this.d*U.y+this.ty)},U.transformPointN=function(U){return U.setTo(this.a*U.x+this.c*U.y,this.b*U.x+this.d*U.y)},U.transformPointArray=function(U,F){for(var O=U.length,P=0;P<O;P+=2){var Y=U[P],c=U[P+1];F[P]=this.a*Y+this.c*c+this.tx,F[P+1]=this.b*Y+this.d*c+this.ty}return F},U.transformPointArrayScale=function(U,F){for(var O=U.length,P=0;P<O;P+=2){var Y=U[P],c=U[P+1];F[P]=this.a*Y+this.c*c,F[P+1]=this.b*Y+this.d*c}return F},U.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},U.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},U.invert=function(){var U=this.a,F=this.b,O=this.c,P=this.d,Y=this.tx,c=U*P-F*O;return this.a=P/c,this.b=-F/c,this.c=-O/c,this.d=U/c,this.tx=(O*this.ty-P*Y)/c,this.ty=-(U*this.ty-F*Y)/c,this},U.setTo=function(U,F,O,P,Y,c){return this.a=U,this.b=F,this.c=O,this.d=P,this.tx=Y,this.ty=c,this},U.concat=function(U){var F=this.a,O=this.c,P=this.tx;return this.a=F*U.a+this.b*U.c,this.b=F*U.b+this.b*U.d,this.c=O*U.a+this.d*U.c,this.d=O*U.b+this.d*U.d,this.tx=P*U.a+this.ty*U.c+U.tx,this.ty=P*U.b+this.ty*U.d+U.ty,this},U.scaleEx=function(U,F){var O=this.a,P=this.b,Y=this.c,c=this.d;0!==P||0!==Y?(this.a=U*O,this.b=U*P,this.c=F*Y):(this.a=U*O,this.b=0*c,this.c=0*O),this.d=F*c,this.bTransform=!0},U.rotateEx=function(U){var F=Math.cos(U),O=Math.sin(U),P=this.a,Y=this.b,c=this.c,L=this.d;0!==Y||0!==c?(this.a=F*P+O*c,this.b=F*Y+O*L,this.c=-O*P+F*c,this.d=-O*Y+F*L):(this.a=F*P,this.b=O*L,this.c=-O*P,this.d=F*L),this.bTransform=!0},U.clone=function(){var U=O.create();return U.a=this.a,U.b=this.b,U.c=this.c,U.d=this.d,U.tx=this.tx,U.ty=this.ty,U.bTransform=this.bTransform,U},U.copyTo=function(U){return U.a=this.a,U.b=this.b,U.c=this.c,U.d=this.d,U.tx=this.tx,U.ty=this.ty,U.bTransform=this.bTransform,U},U.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},U.destroy=function(){if(!this.inPool){var U=O._cache;this.inPool=!0,U._length||(U._length=0),(U[U._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},O.mul=function(U,F,O){var P=U.a,Y=U.b,c=U.c,L=U.d,u=U.tx,d=U.ty,a=F.a,b=F.b,z=F.c,J=F.d,w=F.tx,j=F.ty;return 0!==b||0!==z?(O.a=P*a+Y*z,O.b=P*b+Y*J,O.c=c*a+L*z,O.d=c*b+L*J,O.tx=a*u+z*d+w,O.ty=b*u+J*d+j):(O.a=P*a,O.b=Y*J,O.c=c*a,O.d=L*J,O.tx=a*u+w,O.ty=J*d+j),O},O.mul16=function(U,F,O){var P=U.a,Y=U.b,c=U.c,L=U.d,u=U.tx,d=U.ty,a=F.a,b=F.b,z=F.c,J=F.d,w=F.tx,j=F.ty;return 0!==b||0!==z?(O[0]=P*a+Y*z,O[1]=P*b+Y*J,O[4]=c*a+L*z,O[5]=c*b+L*J,O[12]=a*u+z*d+w,O[13]=b*u+J*d+j):(O[0]=P*a,O[1]=Y*J,O[4]=c*a,O[5]=L*J,O[12]=a*u+w,O[13]=J*d+j),O},O.mulPre=function(U,F,O,P,Y,c,L,u){var d=U.a,a=U.b,b=U.c,z=U.d,J=U.tx,w=U.ty;return 0!==O||0!==P?(u.a=d*F+a*P,u.b=d*O+a*Y,u.c=b*F+z*P,u.d=b*O+z*Y,u.tx=F*J+P*w+c,u.ty=O*J+Y*w+L):(u.a=d*F,u.b=a*Y,u.c=b*F,u.d=z*Y,u.tx=F*J+c,u.ty=Y*w+L),u},O.mulPos=function(U,F,O,P,Y,c,L,u){var d=U.a,a=U.b,b=U.c,z=U.d,J=U.tx,w=U.ty;return 0!==a||0!==b?(u.a=F*d+O*b,u.b=F*a+O*z,u.c=P*d+Y*b,u.d=P*a+Y*z,u.tx=d*c+b*L+J,u.ty=a*c+z*L+w):(u.a=F*d,u.b=O*z,u.c=P*d,u.d=Y*z,u.tx=d*c+J,u.ty=z*L+w),u},O.preMul=function(U,F,O){var P=U.a,Y=U.b,c=U.c,L=U.d,u=F.a,d=F.b,a=F.c,b=F.d,z=F.tx,J=F.ty;return O.a=u*P,O.b=O.c=0,O.d=b*L,O.tx=z*P+U.tx,O.ty=J*L+U.ty,0===d&&0===a&&0===Y&&0===c||(O.a+=d*c,O.d+=a*Y,O.b+=u*Y+d*L,O.c+=a*P+b*c,O.tx+=J*c,O.ty+=z*Y),O},O.preMulXY=function(U,F,O,P){var Y=U.a,c=U.b,L=U.c,u=U.d;return P.a=Y,P.b=c,P.c=L,P.d=u,P.tx=F*Y+U.tx+O*L,P.ty=O*u+U.ty+F*c,P},O.create=function(){var U=O._cache,F=U._length?U[--U._length]:new O;return F.inPool=!1,F},O.EMPTY=new O,O.TEMP=new O,O._cache=[],O}(),I=function(){function U(U,F){void 0===U&&(U=0),void 0===F&&(F=0),this.x=U,this.y=F}x(U,"laya.maths.Point");var F=U.prototype;return F.setTo=function(U,F){return this.x=U,this.y=F,this},F.distance=function(U,F){return Math.sqrt((this.x-U)*(this.x-U)+(this.y-F)*(this.y-F))},F.toString=function(){return this.x+","+this.y},F.normalize=function(){var U=Math.sqrt(this.x*this.x+this.y*this.y);if(0<U){var F=1/U;this.x*=F,this.y*=F}},U.TEMP=new U,U.EMPTY=new U,U}(),T=function(){function a(U,F,O,P){void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0),this.x=U,this.y=F,this.width=O,this.height=P}x(a,"laya.maths.Rectangle");var U=a.prototype;return U.setTo=function(U,F,O,P){return this.x=U,this.y=F,this.width=O,this.height=P,this},U.copyFrom=function(U){return this.x=U.x,this.y=U.y,this.width=U.width,this.height=U.height,this},U.contains=function(U,F){return!(this.width<=0||this.height<=0)&&(U>=this.x&&U<this.right&&F>=this.y&&F<this.bottom)},U.intersects=function(U){return!(U.x>this.x+this.width||U.x+U.width<this.x||U.y>this.y+this.height||U.y+U.height<this.y)},U.intersection=function(U,F){return this.intersects(U)?(F||(F=new a),F.x=Math.max(this.x,U.x),F.y=Math.max(this.y,U.y),F.width=Math.min(this.right,U.right)-F.x,F.height=Math.min(this.bottom,U.bottom)-F.y,F):null},U.union=function(U,F){return F||(F=new a),this.clone(F),U.width<=0||U.height<=0?F:(F.addPoint(U.x,U.y),F.addPoint(U.right,U.bottom),this)},U.clone=function(U){return U||(U=new a),U.x=this.x,U.y=this.y,U.width=this.width,U.height=this.height,U},U.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},U.equals=function(U){return!(!U||U.x!==this.x||U.y!==this.y||U.width!==this.width||U.height!==this.height)},U.addPoint=function(U,F){return this.x>U&&(this.width+=this.x-U,this.x=U),this.y>F&&(this.height+=this.y-F,this.y=F),this.width<U-this.x&&(this.width=U-this.x),this.height<F-this.y&&(this.height=F-this.y),this},U._getBoundPoints=function(){var U=a._temB;return(U.length=0)==this.width||0==this.height||U.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),U},U.isEmpty=function(){return this.width<=0||this.height<=0},b(0,U,"right",function(){return this.x+this.width}),b(0,U,"bottom",function(){return this.y+this.height}),a._getBoundPointS=function(U,F,O,P){var Y=a._temA;return(Y.length=0)==O||0==P||Y.push(U,F,U+O,F,U,F+P,U+O,F+P),Y},a._getWrapRec=function(U,F){if(!U||U.length<1)return F?F.setTo(0,0,0,0):a.TEMP.setTo(0,0,0,0);F=F||new a;var O,P,Y,c,L,u=U.length,d=I.TEMP;for(Y=L=-(P=c=99999),O=0;O<u;O+=2)d.x=U[O],d.y=U[O+1],P=P<d.x?P:d.x,c=c<d.y?c:d.y,Y=Y>d.x?Y:d.x,L=L>d.y?L:d.y;return F.setTo(P,c,Y-P,L-c)},a.EMPTY=new a,a.TEMP=new a,a._temB=[],a._temA=[],a}(),$=function(){function d(){}return x(d,"laya.media.SoundManager"),b(1,d,"useAudioMusic",function(){return d._useAudioMusic},function(U){d._useAudioMusic=U,d._musicClass=U?OU:null}),b(1,d,"autoStopMusic",function(){return d._autoStopMusic},function(U){f.stage.off("blur",null,d._stageOnBlur),f.stage.off("focus",null,d._stageOnFocus),f.stage.off("visibilitychange",null,d._visibilityChange),(d._autoStopMusic=U)&&(f.stage.on("blur",null,d._stageOnBlur),f.stage.on("focus",null,d._stageOnFocus),f.stage.on("visibilitychange",null,d._visibilityChange))}),b(1,d,"muted",function(){return d._muted},function(U){U!=d._muted&&(U&&d.stopAllSound(),d.musicMuted=U,d._muted=U)}),b(1,d,"musicMuted",function(){return d._musicMuted},function(U){U!=d._musicMuted&&(U?(d._tMusic&&d._musicChannel&&!d._musicChannel.isStopped?d._musicChannel.pause():d._musicChannel=null,d._musicMuted=U):(d._musicMuted=U,d._tMusic&&d._musicChannel&&d._musicChannel.resume()))}),b(1,d,"soundMuted",function(){return d._soundMuted},function(U){d._soundMuted=U}),d.addChannel=function(U){0<=d._channels.indexOf(U)||(d._channels.push(U),d.autoReleaseSound&&0!=d._notUsedCount&&d._notUsedUrls[U.url]&&(delete d._notUsedUrls[U.url],0==--d._notUsedCount&&f.timer.clear(d,d.disposeSoundIfNotUsed)))},d.removeChannel=function(U){var F=d._channels,O=F.indexOf(U);if(-1!=O&&(F.splice(O,1),d.autoReleaseSound)){var P=U.url,Y=d.defaultIntervals[P]||2e4;if(0<Y){var c=!0;for(O=F.length-1;0<=O;O--)if(F[O].url==P){c=!1;break}c&&(d._notUsedUrls[P]=Date.now()+Y,0==d._notUsedCount++&&f.timer.loop(1e4,d,d.disposeSoundIfNotUsed))}}},d.disposeSoundIfNotUsed=function(){var U=d._notUsedUrls;if(0!=d._notUsedCount){var F=Date.now();for(var O in U)F>=U[O]&&(delete U[O],--d._notUsedCount,d.destroySound(O));if(0!=d._notUsedCount)return}f.timer.clear(d,d.disposeSoundIfNotUsed)},d._visibilityChange=function(){f.stage.isVisibility?d._stageOnFocus():d._stageOnBlur()},d._stageOnBlur=function(){d._isActive=!1,d._musicChannel&&(d._musicChannel.isStopped||(d._blurPaused=!0,d._musicChannel.pause())),d.stopAllSound(),f.stage.once("mousedown",null,d._stageOnFocus)},d._recoverWebAudio=function(){cU.ctx&&"running"!=cU.ctx.state&&cU.ctx.resume&&cU.ctx.resume()},d._stageOnFocus=function(){if(d._isActive=!0,d._recoverWebAudio(),f.stage.off("mousedown",null,d._stageOnFocus),d._blurPaused){var U=d._musicChannel;U&&d._music&&U.isStopped&&(d._blurPaused=!1,d._music._disposed?d.playMusic(U.url,U.loops,U.startHandler,U.completeHandler,U.startTime):U.audioBuffer?U.resume():d._music.play(U.startTime,U.loops,U.startHandler,U))}},d.playSound=function(U,F,O,P,Y,c){if(void 0===F&&(F=1),void 0===c&&(c=0),!U)return null;if(d._muted)return null;if(d._recoverWebAudio(),U==d._tMusic){if(d._musicMuted)return null}else{if(!d._isActive)return null;if(d._soundMuted)return null}var L,u=d._pool[U];return Y||(Y=d._soundClass),u||((u=new Y).load(U),d._pool[U]=u),(L=u.play(c,F,O))?(U==d._tMusic&&(d._music=u,d._isActive||(d._blurPaused=!0,L.pause())),L.url=U,L.volume=U==d._tMusic?d.musicVolume:d.soundVolume,L.completeHandler=P,L):null},d.destroySound=function(U){var F=d._pool[U];F&&(delete d._pool[U],F.dispose())},d.playMusic=function(U,F,O,P,Y){return void 0===F&&(F=0),void 0===Y&&(Y=0),d._tMusic=U,d._musicChannel&&d._musicChannel.stop(),d._musicChannel=d.playSound(U,F,O,P,null,Y)},d.stopSound=function(U){for(var F,O=d._channels.length-1;0<=O;O--)(F=d._channels[O]).url==U&&F.stop()},d.stopAll=function(){d._tMusic=null;var U=0;for(U=d._channels.length-1;0<=U;U--)d._channels[U].stop()},d.stopAllSound=function(){var U,F=0;for(F=d._channels.length-1;0<=F;F--)(U=d._channels[F]).url!=d._tMusic&&U.stop()},d.stopMusic=function(){d._musicChannel&&d._musicChannel.stop(),d._tMusic=null},d.setSoundVolume=function(U,F){if(F)d._setVolume(F,U);else{d.soundVolume=U;var O,P=0;for(P=d._channels.length-1;0<=P;P--)(O=d._channels[P]).url!=d._tMusic&&(O.volume=U)}},d.setMusicVolume=function(U){d.musicVolume=U,d._setVolume(d._tMusic,U)},d._setVolume=function(U,F){for(var O,P=d._channels.length-1;0<=P;P--)(O=d._channels[P]).url==U&&(O.volume=F)},d.musicVolume=1,d.soundVolume=1,d.playbackRate=1,d._useAudioMusic=!0,d._muted=!1,d._soundMuted=!1,d._musicMuted=!1,d._tMusic=null,d._musicChannel=null,d._music=null,d._channels=[],d._autoStopMusic=!1,d._blurPaused=!1,d._isActive=!0,d._soundClass=null,d._musicClass=null,d.autoReleaseSound=!0,d._pool={},d.defaultIntervals={},d._notUsedUrls={},d._notUsedCount=0,d}(),g=function(){var U;function O(){}return x(O,"laya.net.LocalStorage"),O.__init__=function(){O._baseClass||(O._baseClass=U).init(),O.items=O._baseClass.items,O.support=O._baseClass.support},O.setItem=function(U,F){O._baseClass.setItem(U,F)},O.getItem=function(U){return O._baseClass.getItem(U)},O.setJSON=function(U,F){O._baseClass.setJSON(U,F)},O.getJSON=function(U){return O._baseClass.getJSON(U)},O.removeItem=function(U){O._baseClass.removeItem(U)},O.clear=function(){O._baseClass.clear()},O._baseClass=null,O.items=null,O.support=!1,O.__init$=function(){U=function(){function O(){}return x(O,""),O.init=function(){try{O.support=!0,O.items=L.localStorage,O.setItem("laya","1"),O.removeItem("laya")}catch(U){O.support=!1}O.support||console.log("LocalStorage is not supprot or browser is private mode.")},O.setItem=function(U,F){try{O.support&&O.items.setItem(U,F)}catch(U){console.warn("set localStorage failed",U)}},O.getItem=function(U){return O.support?O.items.getItem(U):null},O.setJSON=function(U,F){try{O.support&&O.items.setItem(U,JSON.stringify(F))}catch(U){console.warn("set localStorage failed",U)}},O.getJSON=function(U){return JSON.parse(O.support?O.items.getItem(U):null)},O.removeItem=function(U){O.support&&O.items.removeItem(U)},O.clear=function(){O.support&&O.items.clear()},O.items=null,O.support=!1,O}()},O}(),i=(function(){function P(){}x(P,"laya.net.ResourceVersion"),P.enable=function(U,F,O){void 0===O&&(O=2),laya.net.ResourceVersion.type=O,f.loader.load(U,h.create(null,P.onManifestLoaded,[F]),null,"json"),y.customFormat=P.addVersionPrefix},P.onManifestLoaded=function(U,F){P.manifest=F,U.run(),F||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},P.addVersionPrefix=function(U){return P.manifest&&P.manifest[U]?2==P.type?P.manifest[U]:P.manifest[U]+"/"+U:U},P.FOLDER_VERSION=1,P.FILENAME_VERSION=2,P.manifest=null,P.type=1}(),function(){function U(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}x(U,"laya.net.TTFLoader");var F=U.prototype;return F.load=function(U){var F=(this._url=U).split(".ttf")[0].split("/");this.fontName=F[F.length-1],m.window.conch?this._loadConch():m.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},F._loadConch=function(){this._http=new LU,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},F._onHttpLoaded=function(U){m.window.conch.setFontFaceFromBuffer(this.fontName,U),this._clearHttp(),this._complete()},F._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},F._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},F._complete=function(){f.timer.clear(this,this._complete),f.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},F._checkComplete=function(){C.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},F._loadWithFontFace=function(){var U=new m.window.FontFace(this.fontName,"url('"+this._url+"')");m.window.document.fonts.add(U);var F=this;U.loaded.then(function(){F._complete()}),U.load()},F._createDiv=function(){this._div=m.createElement("div"),this._div.innerHTML="laya";var U=this._div.style;U.fontFamily=this.fontName,U.position="absolute",U.left="-100px",U.top="-100px",m.document.body.appendChild(this._div)},F._loadWithCSS=function(){var U=this,F=m.createElement("style");F.type="text/css",m.document.body.appendChild(F),F.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=C.measureText("LayaTTFFont",this._fontTxt).width;var O=this;F.onload=function(){f.timer.once(1e4,O,U._complete)},f.timer.loop(20,this,this._checkComplete),this._createDiv()},U._testString="LayaTTFFont",U}()),y=function(){function P(U){this._url=null,this._path=null,this._url=P.formatURL(U),this._path=P.getPath(U)}x(P,"laya.net.URL");var U=P.prototype;return b(0,U,"path",function(){return this._path}),b(0,U,"url",function(){return this._url}),P.formatURL=function(U,F){if(!U)return"null path";if(0<U.indexOf(":"))return U;null!=P.customFormat&&(U=P.customFormat(U,F));var O=U.charAt(0);if("."===O)return P.formatRelativePath((F||P.basePath)+U);if("~"===O)return P.rootPath+U.substring(1);if("d"===O){if(0===U.indexOf("data:image"))return U}else if("/"===O)return U;return(F||P.basePath)+U},P.formatRelativePath=function(U){for(var F=U.split("/"),O=0,P=F.length;O<P;O++)".."==F[O]&&(F.splice(O-1,2),O-=2);return F.join("/")},P.isAbsolute=function(U){return 0<U.indexOf(":")||"/"==U.charAt(0)},P.getPath=function(U){var F=U.lastIndexOf("/");return 0<F?U.substr(0,F+1):""},P.getFileName=function(U){var F=U.lastIndexOf("/");return 0<F?U.substr(F+1):U},P.version={},P.basePath="",P.rootPath="",P.customFormat=function(U){var F=P.version[U];return!k.isConchApp&&F&&(U+="?v="+F),U},P}(),k=function(){function Y(U,F){this._timeId=0;var O=Y._mainCanvas.source.style;O.position="absolute",O.top=O.left="0px",O.background="#000000",Y._mainCanvas.source.id="layaCanvas";var P=laya.renders.Render.isWebGL;Y._mainCanvas.source.width=U,Y._mainCanvas.source.height=F,P&&Y.WebGL.init(Y._mainCanvas,U,F),m.container.appendChild(Y._mainCanvas.source),(Y._context=new A(U,F,P?null:Y._mainCanvas)).ctx.setIsMainContext(),m.window.requestAnimationFrame(function U(F){m.window.requestAnimationFrame(U);f.stage._loop()}),f.stage.on("visibilitychange",this,this._onVisibilitychange)}x(Y,"laya.renders.Render");var U=Y.prototype;return U._onVisibilitychange=function(){f.stage.isVisibility?0!=this._timeId&&m.window.clearInterval(this._timeId):this._timeId=m.window.setInterval(this._enterFrame,1e3)},U._enterFrame=function(U){f.stage._loop()},b(1,Y,"context",function(){return Y._context}),b(1,Y,"canvas",function(){return Y._mainCanvas.source}),Y._context=null,Y._mainCanvas=null,Y.WebGL=null,Y.isConchNode=!1,Y.isConchApp=!1,Y.isConchWebGL=!1,Y.isWebGL=!1,Y.is3DMode=!1,Y.optimizeTextureMemory=function(U,F){return!0},Y.__init$=function(){L.ConchRenderType=L.ConchRenderType||1,L.ConchRenderType|=L.conch?4:0,Y.isConchNode=5==(5&L.ConchRenderType),Y.isConchApp=4==(4&L.ConchRenderType),Y.isConchWebGL=6==L.ConchRenderType},Y}(),A=function(){function L(U,F,O){this.x=0,this.y=0,this._drawTexture=function(U,F,O){O[0].loaded&&this.ctx.drawTexture(O[0],O[1],O[2],O[3],O[4],U,F)},this._fillTexture=function(U,F,O){O[0].loaded&&this.ctx.fillTexture(O[0],O[1]+U,O[2]+F,O[3],O[4],O[5],O[6],O[7])},this._drawTextureWithTransform=function(U,F,O){O[0].loaded&&this.ctx.drawTextureWithTransform(O[0],O[1],O[2],O[3],O[4],O[5],U,F,O[6])},this._fillQuadrangle=function(U,F,O){this.ctx.fillQuadrangle(O[0],O[1],O[2],O[3],O[4])},this._drawRect=function(U,F,O){var P=this.ctx;null!=O[4]&&(P.fillStyle=O[4],P.fillRect(U+O[0],F+O[1],O[2],O[3],null)),null!=O[5]&&(P.strokeStyle=O[5],P.lineWidth=O[6],P.strokeRect(U+O[0],F+O[1],O[2],O[3],O[6]))},this._drawPie=function(U,F,O){var P=this.ctx;k.isWebGL&&P.setPathId(O[8]),P.beginPath(),k.isWebGL?(P.movePath(O[0]+U,O[1]+F),P.moveTo(0,0)):P.moveTo(U+O[0],F+O[1]),P.arc(U+O[0],F+O[1],O[2],O[3],O[4]),P.closePath(),this._fillAndStroke(O[5],O[6],O[7],!0)},this._clipRect=function(U,F,O){this.ctx.clipRect(U+O[0],F+O[1],O[2],O[3])},this._fillRect=function(U,F,O){this.ctx.fillRect(U+O[0],F+O[1],O[2],O[3],O[4])},this._drawCircle=function(U,F,O){var P=this.ctx;k.isWebGL&&P.setPathId(O[6]),v.drawCall++,P.beginPath(),k.isWebGL&&P.movePath(O[0]+U,O[1]+F),P.arc(O[0]+U,O[1]+F,O[2],0,L.PI2),P.closePath(),this._fillAndStroke(O[3],O[4],O[5],!0)},this._fillCircle=function(U,F,O){v.drawCall++;var P=this.ctx;P.beginPath(),P.fillStyle=O[3],P.arc(O[0]+U,O[1]+F,O[2],0,L.PI2),P.fill()},this._setShader=function(U,F,O){this.ctx.setShader(O[0])},this._drawLine=function(U,F,O){var P=this.ctx;k.isWebGL&&P.setPathId(O[6]),P.beginPath(),P.strokeStyle=O[4],P.lineWidth=O[5],k.isWebGL?(P.movePath(U,F),P.moveTo(O[0],O[1]),P.lineTo(O[2],O[3])):(P.moveTo(U+O[0],F+O[1]),P.lineTo(U+O[2],F+O[3])),P.stroke()},this._drawLines=function(U,F,O){var P=this.ctx;k.isWebGL&&P.setPathId(O[5]),P.beginPath(),U+=O[0],F+=O[1],k.isWebGL&&P.movePath(U,F),P.strokeStyle=O[3],P.lineWidth=O[4];var Y=O[2],c=2,L=Y.length;if(k.isWebGL)for(P.moveTo(Y[0],Y[1]);c<L;)P.lineTo(Y[c++],Y[c++]);else for(P.moveTo(U+Y[0],F+Y[1]);c<L;)P.lineTo(U+Y[c++],F+Y[c++]);P.stroke()},this._drawLinesWebGL=function(U,F,O){this.ctx.drawLines(U+this.x+O[0],F+this.y+O[1],O[2],O[3],O[4])},this._drawCurves=function(U,F,O){this.ctx.drawCurves(U,F,O)},this._draw=function(U,F,O){O[0].call(null,this,U,F)},this._transformByMatrix=function(U,F,O){this.ctx.transformByMatrix(O[0])},this._setTransform=function(U,F,O){this.ctx.setTransform(O[0],O[1],O[2],O[3],O[4],O[5])},this._setTransformByMatrix=function(U,F,O){this.ctx.setTransformByMatrix(O[0])},this._save=function(U,F,O){this.ctx.save()},this._restore=function(U,F,O){this.ctx.restore()},this._translate=function(U,F,O){this.ctx.translate(O[0],O[1])},this._transform=function(U,F,O){this.ctx.translate(O[1]+U,O[2]+F);var P=O[0];this.ctx.transform(P.a,P.b,P.c,P.d,P.tx,P.ty),this.ctx.translate(-U-O[1],-F-O[2])},this._rotate=function(U,F,O){this.ctx.translate(O[1]+U,O[2]+F),this.ctx.rotate(O[0]),this.ctx.translate(-U-O[1],-F-O[2])},this._scale=function(U,F,O){this.ctx.translate(O[2]+U,O[3]+F),this.ctx.scale(O[0],O[1]),this.ctx.translate(-U-O[2],-F-O[3])},this._alpha=function(U,F,O){this.ctx.globalAlpha*=O[0]},this._setAlpha=function(U,F,O){this.ctx.globalAlpha=O[0]},this._fillText=function(U,F,O){this.ctx.fillText(O[0],O[1]+U,O[2]+F,O[3],O[4],O[5])},this._strokeText=function(U,F,O){this.ctx.strokeText(O[0],O[1]+U,O[2]+F,O[3],O[4],O[5],O[6])},this._fillBorderText=function(U,F,O){this.ctx.fillBorderText(O[0],O[1]+U,O[2]+F,O[3],O[4],O[5],O[6],O[7])},this._blendMode=function(U,F,O){this.ctx.globalCompositeOperation=O[0]},this._beginClip=function(U,F,O){this.ctx.beginClip&&this.ctx.beginClip(U+O[0],F+O[1],O[2],O[3])},this._setIBVB=function(U,F,O){this.ctx.setIBVB(O[0]+U,O[1]+F,O[2],O[3],O[4],O[5],O[6],O[7])},this._fillTrangles=function(U,F,O){this.ctx.fillTrangles(O[0],O[1]+U,O[2]+F,O[3],O[4])},this._drawPath=function(U,F,O){var P=this.ctx;k.isWebGL&&P.setPathId(-1),P.beginPath(),U+=O[0],F+=O[1],k.isWebGL&&P.movePath(U,F);for(var Y=O[2],c=0,L=Y.length;c<L;c++){var u=Y[c];switch(u[0]){case"moveTo":k.isWebGL?P.moveTo(u[1],u[2]):P.moveTo(U+u[1],F+u[2]);break;case"lineTo":k.isWebGL?P.lineTo(u[1],u[2]):P.lineTo(U+u[1],F+u[2]);break;case"arcTo":k.isWebGL?P.arcTo(u[1],u[2],u[3],u[4],u[5]):P.arcTo(U+u[1],F+u[2],U+u[3],F+u[4],u[5]);break;case"closePath":P.closePath()}}var d=O[3];null!=d&&(P.fillStyle=d.fillStyle,P.fill());var a=O[4];null!=a&&(P.strokeStyle=a.strokeStyle,P.lineWidth=a.lineWidth||1,P.lineJoin=a.lineJoin,P.lineCap=a.lineCap,P.miterLimit=a.miterLimit,P.stroke())},this.drawPoly=function(U,F,O){this.ctx.drawPoly(U+this.x+O[0],F+this.y+O[1],O[2],O[3],O[4],O[5],O[6])},this._drawPoly=function(U,F,O){var P=this.ctx,Y=O[2],c=2,L=Y.length;if(k.isWebGL)for(P.setPathId(O[6]),P.beginPath(),U+=O[0],F+=O[1],P.movePath(U,F),P.moveTo(Y[0],Y[1]);c<L;)P.lineTo(Y[c++],Y[c++]);else for(P.beginPath(),U+=O[0],F+=O[1],P.moveTo(U+Y[0],F+Y[1]);c<L;)P.lineTo(U+Y[c++],F+Y[c++]);P.closePath(),this._fillAndStroke(O[3],O[4],O[5],O[7])},this._drawSkin=function(U,F,O){var P=O[0];if(P){var Y=this.ctx;P.render(Y,U,F)}},this._drawParticle=function(U,F,O){this.ctx.drawParticle(U+this.x,F+this.y,O[0])},this._setFilters=function(U,F,O){this.ctx.setFilters(O)},O?this.ctx=O.getContext("2d"):(O=QU.create("3D"),this.ctx=C.createWebGLContext2D(O),O._setContext(this.ctx)),O.size(U,F),this.canvas=O}x(L,"laya.renders.RenderContext");var U=L.prototype;return U.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},U.drawTexture=function(U,F,O,P,Y){U.loaded&&this.ctx.drawTexture(U,F,O,P,Y,this.x,this.y)},U._drawTextures=function(U,F,O){O[0].loaded&&this.ctx.drawTextures(O[0],O[1],U+this.x,F+this.y)},U.drawTextureWithTransform=function(U,F,O,P,Y,c,L){U.loaded&&this.ctx.drawTextureWithTransform(U,F,O,P,Y,c,this.x,this.y,L)},U.fillQuadrangle=function(U,F,O,P,Y){this.ctx.fillQuadrangle(U,F,O,P,Y)},U.drawCanvas=function(U,F,O,P,Y){this.ctx.drawCanvas(U,F+this.x,O+this.y,P,Y)},U.drawRect=function(U,F,O,P,Y,c){void 0===c&&(c=1);var L=this.ctx;L.strokeStyle=Y,L.lineWidth=c,L.strokeRect(U+this.x,F+this.y,O,P,c)},U._fillAndStroke=function(U,F,O,P){void 0===P&&(P=!1);var Y=this.ctx;null!=U&&(Y.fillStyle=U,k.isWebGL?Y.fill(P):Y.fill()),null!=F&&0<O&&(Y.strokeStyle=F,Y.lineWidth=O,Y.stroke())},U.clipRect=function(U,F,O,P){this.ctx.clipRect(U+this.x,F+this.y,O,P)},U.fillRect=function(U,F,O,P,Y){this.ctx.fillRect(U+this.x,F+this.y,O,P,Y)},U.drawCircle=function(U,F,O,P,Y){void 0===Y&&(Y=1),v.drawCall++;var c=this.ctx;c.beginPath(),c.strokeStyle=P,c.lineWidth=Y,c.arc(U+this.x,F+this.y,O,0,L.PI2),c.stroke()},U.drawTriangles=function(U,F,O){if(k.isWebGL)this.ctx.drawTriangles(O[0],U+O[1],F+O[2],O[3],O[4],O[5],O[6],O[7],O[8],O[9]);else{var P=O[5],Y=0,c=P.length,L=this.ctx;for(Y=0;Y<c;Y+=3){var u=2*P[Y],d=2*P[Y+1],a=2*P[Y+2];L.drawTriangle(O[0],O[3],O[4],u,d,a,O[6],!0)}}},U.fillCircle=function(U,F,O,P){v.drawCall++;var Y=this.ctx;Y.beginPath(),Y.fillStyle=P,Y.arc(U+this.x,F+this.y,O,0,L.PI2),Y.fill()},U.setShader=function(U){this.ctx.setShader(U)},U.drawLine=function(U,F,O,P,Y,c){void 0===c&&(c=1);var L=this.ctx;L.beginPath(),L.strokeStyle=Y,L.lineWidth=c,L.moveTo(this.x+U,this.y+F),L.lineTo(this.x+O,this.y+P),L.stroke()},U.clear=function(){this.ctx.clear()},U.transformByMatrix=function(U){this.ctx.transformByMatrix(U)},U.setTransform=function(U,F,O,P,Y,c){this.ctx.setTransform(U,F,O,P,Y,c)},U.setTransformByMatrix=function(U){this.ctx.setTransformByMatrix(U)},U.save=function(){this.ctx.save()},U.restore=function(){this.ctx.restore()},U.translate=function(U,F){this.ctx.translate(U,F)},U.transform=function(U,F,O,P,Y,c){this.ctx.transform(U,F,O,P,Y,c)},U.rotate=function(U){this.ctx.rotate(U)},U.scale=function(U,F){this.ctx.scale(U,F)},U.alpha=function(U){this.ctx.globalAlpha*=U},U.setAlpha=function(U){this.ctx.globalAlpha=U},U.fillWords=function(U,F,O,P,Y,c){void 0===c&&(c=0),this.ctx.fillWords(U,F,O,P,Y,c)},U.fillBorderWords=function(U,F,O,P,Y,c,L){this.ctx.fillBorderWords(U,F,O,P,Y,c,L)},U.fillText=function(U,F,O,P,Y,c){this.ctx.fillText(U,F+this.x,O+this.y,P,Y,c)},U.strokeText=function(U,F,O,P,Y,c,L){this.ctx.strokeText(U,F+this.x,O+this.y,P,Y,c,L)},U.blendMode=function(U){this.ctx.globalCompositeOperation=U},U.flush=function(){this.ctx.flush&&this.ctx.flush()},U.addRenderObject=function(U){this.ctx.addRenderObject(U)},U.beginClip=function(U,F,O,P){this.ctx.beginClip&&this.ctx.beginClip(U,F,O,P)},U.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},U.fillTrangles=function(U,F,O){this.ctx.fillTrangles(O[0],O[1],O[2],O[3],4<O.length?O[4]:null)},L.PI2=2*Math.PI,L}(),G=function(){function L(U,F){switch(this._next=F||L.NORENDER,U){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=H._filter);case 69905:return void(this._fun=L._initRenderFun)}this.onCreate(U)}x(L,"laya.renders.RenderSprite");var U=L.prototype;return U.onCreate=function(U){},U._style=function(U,F,O,P){U._style.render(U,F,O,P);var Y=this._next;Y._fun.call(Y,U,F,O,P)},U._no=function(U,F,O,P){},U._custom=function(U,F,O,P){U.customRender(F,O,P);var Y=U._style._tf;this._next._fun.call(this._next,U,F,O-Y.translateX,P-Y.translateY)},U._clip=function(U,F,O,P){var Y=this._next;if(Y!=L.NORENDER){var c=U._style.scrollRect;F.ctx.save(),F.ctx.clipRect(O,P,c.width,c.height),Y._fun.call(Y,U,F,O-c.x,P-c.y),F.ctx.restore()}},U._blend=function(U,F,O,P){var Y=U._style;Y.blendMode&&(F.ctx.globalCompositeOperation=Y.blendMode);var c=this._next;c._fun.call(c,U,F,O,P),F.ctx.globalCompositeOperation="source-over"},U._mask=function(U,F,O,P){var Y=this._next;Y._fun.call(Y,U,F,O,P);var c=U.mask;c&&(F.ctx.globalCompositeOperation="destination-in",(0<c.numChildren||!c.graphics._isOnlyOne())&&(c.cacheAsBitmap=!0),c.render(F,O-U.pivotX,P-U.pivotY)),F.ctx.globalCompositeOperation="source-over"},U._graphics=function(U,F,O,P){var Y=U._style._tf;U._graphics&&U._graphics._render(U,F,O-Y.translateX,P-Y.translateY);var c=this._next;c._fun.call(c,U,F,O,P)},U._image=function(U,F,O,P){var Y=U._style;F.ctx.drawTexture2(O,P,Y._tf.translateX,Y._tf.translateY,U.transform,Y.alpha,Y.blendMode,U._graphics._one)},U._image2=function(U,F,O,P){var Y=U._style._tf;F.ctx.drawTexture2(O,P,Y.translateX,Y.translateY,U.transform,1,null,U._graphics._one)},U._alpha=function(U,F,O,P){var Y;if(.01<(Y=U._style.alpha)||U._needRepaint()){var c=F.ctx.globalAlpha;F.ctx.globalAlpha*=Y;var L=this._next;L._fun.call(L,U,F,O,P),F.ctx.globalAlpha=c}},U._transform=function(U,F,O,P){var Y=U.transform,c=this._next;Y&&c!=L.NORENDER?(F.save(),F.transform(Y.a,Y.b,Y.c,Y.d,Y.tx+O,Y.ty+P),c._fun.call(c,U,F,0,0),F.restore()):c._fun.call(c,U,F,O,P)},U._childs=function(U,F,O,P){var Y=U._style,c=Y._tf;if(O=O-c.translateX+Y.paddingLeft,P=P-c.translateY+Y.paddingTop,Y._calculation){var L=U._getWords();if(L){var u=Y;u&&(u.stroke?F.fillBorderWords(L,O,P,u.font,u.color,u.strokeColor,u.stroke):F.fillWords(L,O,P,u.font,u.color,"none"!=u.textDecoration&&u.underLine?1:0))}}var d,a=U._childs,b=a.length;if(U.viewport||U.optimizeScrollRect&&U._style.scrollRect){var z=U.viewport||U._style.scrollRect,J=z.x,w=z.y,j=z.right,x=z.bottom,r=NaN,H=NaN;for(h=0;h<b;++h)(d=a[h]).visible&&(r=d._x)<j&&r+d.width>J&&(H=d._y)<x&&H+d.height>w&&d.render(F,O,P)}else for(var h=0;h<b;++h)(d=a[h])._style.visible&&d.render(F,O,P)},U._canvas=function(U,F,O,P){var Y=U._$P.cacheCanvas;if(Y){"bitmap"===Y.type?v.canvasBitmap++:v.canvasNormal++;var c=Y.ctx;if(U._needRepaint()||!c)this._canvas_repaint(U,F,O,P);else{var L=Y._cacheRec;F.drawCanvas(c.canvas,O+L.x,P+L.y,L.width,L.height)}}else this._next._fun.call(this._next,U,F,O,P)},U._canvas_repaint=function(U,F,O,P){var Y=U._$P.cacheCanvas,c=this._next;if(Y){var L,u,d,a,b=Y.ctx,z=U._needRepaint()||!b,J=Y.type;if("bitmap"===J?v.canvasBitmap++:v.canvasNormal++,z){var w,j;Y._cacheRec||(Y._cacheRec=new T),k.isWebGL&&"bitmap"!==J?Y._cacheRec.setTo(-U.pivotX,-U.pivotY,1,1):((a=U.getSelfBounds()).x=a.x-U.pivotX,a.y=a.y-U.pivotY,a.x=a.x-16,a.y=a.y-16,a.width=a.width+32,a.height=a.height+32,a.x=Math.floor(a.x+O)-O,a.y=Math.floor(a.y+P)-P,a.width=Math.floor(a.width),a.height=Math.floor(a.height),Y._cacheRec.copyFrom(a)),a=Y._cacheRec;var x,r=k.isWebGL?1:m.pixelRatio*f.stage.clientScaleX,H=k.isWebGL?1:m.pixelRatio*f.stage.clientScaleY;if(!k.isWebGL){var h,Q=1,X=1;for(h=U;h&&h!=f.stage;)Q*=h.scaleX,X*=h.scaleY,h=h.parent;k.isWebGL?(Q<1&&(r*=Q),X<1&&(H*=X)):(1<Q&&(r*=Q),1<X&&(H*=X))}if(U.scrollRect){var N=U.scrollRect;a.x-=N.x,a.y-=N.y}if(w=a.width*r,j=a.height*H,u=a.x,d=a.y,k.isWebGL&&"bitmap"===J&&(2048<w||2048<j))return console.warn("cache bitmap size larger than 2048,cache ignored"),Y.ctx&&(e.recover("RenderContext",Y.ctx),Y.ctx.canvas.size(0,0),Y.ctx=null),void c._fun.call(c,U,F,O,P);if(b||(b=Y.ctx=e.getItem("RenderContext")||new A(w,j,QU.create("AUTO"))),b.ctx.sprite=U,(L=b.canvas).clear(),(L.width!=w||L.height!=j)&&L.size(w,j),"bitmap"===J?L.context.asBitmap=!0:"normal"===J&&(L.context.asBitmap=!1),1!=r||1!=H){var K=b.ctx;K.save(),K.scale(r,H),!k.isConchWebGL&&k.isConchApp&&(x=U._$P.cf)&&K.setFilterMatrix&&K.setFilterMatrix(x._mat,x._alpha),c._fun.call(c,U,b,-u,-d),K.restore(),k.isConchApp&&!k.isConchWebGL||U._applyFilters()}else K=b.ctx,!k.isConchWebGL&&k.isConchApp&&(x=U._$P.cf)&&K.setFilterMatrix&&K.setFilterMatrix(x._mat,x._alpha),c._fun.call(c,U,b,-u,-d),k.isConchApp&&!k.isConchWebGL||U._applyFilters();U._$P.staticCache&&(Y.reCache=!1),v.canvasReCache++}else u=(a=Y._cacheRec).x,d=a.y,L=b.canvas;F.drawCanvas(L,O+u,P+d,a.width,a.height)}else c._fun.call(c,U,b,O,P)},L.__init__=function(){var U,F,O=0;for(F=C.createRenderSprite(69905,null),U=L.renders.length=4096,O=0;O<U;O++)L.renders[O]=F;L.renders[0]=C.createRenderSprite(0,null),function(U,F){for(var O=0,P=0;P<U.length;P++)O|=U[P],L.renders[O]=F}([1,512,4,2],new L(1,null)),L.renders[513]=C.createRenderSprite(513,null),L.renders[517]=new L(517,null)},L._initRenderFun=function(U,F,O,P){var Y=U._renderType;(L.renders[Y]=L._getTypeRender(Y))._fun(U,F,O,P)},L._getTypeRender=function(U){for(var F=null,O=2048;1<O;)O&U&&(F=C.createRenderSprite(O,F)),O>>=1;return F},L.IMAGE=1,L.ALPHA=2,L.TRANSFORM=4,L.BLEND=8,L.CANVAS=16,L.FILTERS=32,L.MASK=64,L.CLIP=128,L.STYLE=256,L.GRAPHICS=512,L.CUSTOM=1024,L.CHILDS=2048,L.INIT=69905,L.renders=[],L.NORENDER=new L(0,null),L}(),V=function(){function u(){this._repaint=!1}x(u,"laya.resource.Context");var U=u.prototype;return U.replaceReset=function(){var U,F,O=0;for(U=u.replaceKeys.length,O=0;O<U;O++)F=u.replaceKeys[O],this[u.newKeys[O]]=this[F]},U.replaceResotre=function(){this.__restore(),this.__reset()},U.setIsMainContext=function(){},U.drawTextures=function(U,F,O,P){v.drawCall+=F.length/2;for(var Y=U.width,c=U.height,L=0,u=F.length;L<u;L+=2)this.drawTexture(U,F[L],F[L+1],Y,c,O,P)},U.drawCanvas=function(U,F,O,P,Y){v.drawCall++,this.drawImage(U.source,F,O,P,Y)},U.fillRect=function(U,F,O,P,Y){v.drawCall++,Y&&(this.fillStyle=Y),this.__fillRect(U,F,O,P)},U.fillText=function(U,F,O,P,Y,c){v.drawCall++,3<arguments.length&&null!=P&&(this.font=P,this.fillStyle=Y,this.textAlign=c,this.textBaseline="top"),this.__fillText(U,F,O)},U.fillBorderText=function(U,F,O,P,Y,c,L,u){v.drawCall++,this.font=P,this.fillStyle=Y,this.textBaseline="top",this.strokeStyle=c,this.lineWidth=L,this.textAlign=u,this.__strokeText(U,F,O),this.__fillText(U,F,O)},U.strokeText=function(U,F,O,P,Y,c,L){v.drawCall++,3<arguments.length&&null!=P&&(this.font=P,this.strokeStyle=Y,this.lineWidth=c,this.textAlign=L,this.textBaseline="top"),this.__strokeText(U,F,O)},U.transformByMatrix=function(U){this.transform(U.a,U.b,U.c,U.d,U.tx,U.ty)},U.setTransformByMatrix=function(U){this.setTransform(U.a,U.b,U.c,U.d,U.tx,U.ty)},U.clipRect=function(U,F,O,P){v.drawCall++,this.beginPath(),this.rect(U,F,O,P),this.clip()},U.drawTexture=function(U,F,O,P,Y,c,L){v.drawCall++;var u=U.uv,d=U.bitmap.width,a=U.bitmap.height;this.drawImage(U.source,u[0]*d,u[1]*a,(u[2]-u[0])*d,(u[5]-u[3])*a,F+c,O+L,P,Y)},U.drawTextureWithTransform=function(U,F,O,P,Y,c,L,u,d){v.drawCall++;var a=U.uv,b=U.bitmap.width,z=U.bitmap.height;this.save(),1!=d&&(this.globalAlpha*=d),c?(this.transform(c.a,c.b,c.c,c.d,c.tx+L,c.ty+u),this.drawImage(U.source,a[0]*b,a[1]*z,(a[2]-a[0])*b,(a[5]-a[3])*z,F,O,P,Y)):this.drawImage(U.source,a[0]*b,a[1]*z,(a[2]-a[0])*b,(a[5]-a[3])*z,F+L,O+u,P,Y),this.restore()},U.drawTexture2=function(U,F,O,P,Y,c,L,u){var d=u[0];if(d.loaded&&d.bitmap&&d.source){v.drawCall++;var a=1!==c;if(a){var b=this.globalAlpha;this.globalAlpha*=c}var z=d.uv,J=d.bitmap.width,w=d.bitmap.height;Y?(this.save(),this.transform(Y.a,Y.b,Y.c,Y.d,Y.tx+U,Y.ty+F),this.drawImage(d.source,z[0]*J,z[1]*w,(z[2]-z[0])*J,(z[5]-z[3])*w,u[1]-O,u[2]-P,u[3],u[4]),this.restore()):this.drawImage(d.source,z[0]*J,z[1]*w,(z[2]-z[0])*J,(z[5]-z[3])*w,u[1]-O+U,u[2]-P+F,u[3],u[4]),a&&(this.globalAlpha=b)}},U.fillTexture=function(U,F,O,P,Y,c,L,u){if(!u.pat){if(U.uv!=bU.DEF_UV){var d=new QU("2D");d.getContext("2d"),d.size(U.width,U.height),d.context.drawTexture(U,0,0,U.width,U.height,0,0),U=new bU(d)}u.pat=this.createPattern(U.bitmap.source,c)}var a=F,b=O,z=0,J=0;L&&(a+=L.x%U.width,b+=L.y%U.height,z-=L.x%U.width,J-=L.y%U.height),this.translate(a,b),this.fillRect(z,J,P,Y,u.pat),this.translate(-a,-b)},U.drawTriangle=function(U,F,O,P,Y,c,L,u){var d=U.bitmap,a=d.source,b=U.width,z=U.height,J=d.width,w=d.height,j=O[P]*J,x=O[Y]*J,r=O[c]*J,H=O[P+1]*w,h=O[Y+1]*w,Q=O[c+1]*w,X=F[P],N=F[Y],K=F[c],f=F[P+1],I=F[Y+1],T=F[c+1];if(u){var g=(X+N+K)/3,l=(f+I+T)/3,$=X-g,C=f-l,s=Math.sqrt($*$+C*C);X=g+$/s*(s+1),f=l+C/s*(s+1),C=I-l,N=g+($=N-g)/(s=Math.sqrt($*$+C*C))*(s+1),I=l+C/s*(s+1),C=T-l,K=g+($=K-g)/(s=Math.sqrt($*$+C*C))*(s+1),T=l+C/s*(s+1)}this.save(),L&&this.transform(L.a,L.b,L.c,L.d,L.tx,L.ty),this.beginPath(),this.moveTo(X,f),this.lineTo(N,I),this.lineTo(K,T),this.closePath(),this.clip();var i=1/(j*h+H*r+x*Q-h*r-H*x-j*Q),y=X*h+H*K+N*Q-h*K-H*N-X*Q,k=j*N+X*r+x*K-N*r-X*x-j*K,A=j*h*K+H*N*r+X*x*Q-X*h*r-H*x*K-j*N*Q,G=f*h+H*T+I*Q-h*T-H*I-f*Q,V=j*I+f*r+x*T-I*r-f*x-j*T,M=j*h*T+H*I*r+f*x*Q-f*h*r-H*x*T-j*I*Q;this.transform(y*i,G*i,k*i,V*i,A*i,M*i),this.drawImage(a,U.uv[0]*J,U.uv[1]*w,b,z,U.uv[0]*J,U.uv[1]*w,b,z),this.restore()},U.flush=function(){return 0},U.fillWords=function(U,F,O,P,Y,c){P&&(this.font=P),Y&&(this.fillStyle=Y);this.textBaseline="top",this.textAlign="left";for(var L=0,u=U.length;L<u;L++){var d=U[L];if(this.__fillText(d.char,d.x+F,d.y+O),1===c){var a=d.height,b=.5*d.style.letterSpacing;b||(b=0),this.beginPath(),this.strokeStyle=Y,this.lineWidth=1,this.moveTo(F+d.x-b+.5,O+d.y+a+.5),this.lineTo(F+d.x+d.width+b+.5,O+d.y+a+.5),this.stroke()}}},U.fillBorderWords=function(U,F,O,P,Y,c,L){P&&(this.font=P),Y&&(this.fillStyle=Y),this.textBaseline="top",this.lineWidth=L,this.textAlign="left",this.strokeStyle=c;for(var u=0,d=U.length;u<d;u++){var a=U[u];this.__strokeText(a.char,a.x+F,a.y+O),this.__fillText(a.char,a.x+F,a.y+O)}},U.destroy=function(){this.canvas.width=this.canvas.height=0},U.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},U.drawCurves=function(U,F,O){this.beginPath(),this.strokeStyle=O[3],this.lineWidth=O[4];var P=O[2];U+=O[0],F+=O[1],this.moveTo(U+P[0],F+P[1]);for(var Y=2,c=P.length;Y<c;)this.quadraticCurveTo(U+P[Y++],F+P[Y++],U+P[Y++],F+P[Y++]);this.stroke()},u.__init__=function(F){var O=laya.resource.Context.prototype;if(!(F=F||CanvasRenderingContext2D.prototype).inited){F.inited=!0,F.__fillText=F.fillText,F.__fillRect=F.fillRect,F.__strokeText=F.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(U){F[U]=O[U]})}},u.replaceCanvasGetSet=function(U,F){var O=Object.getOwnPropertyDescriptor(U,F);if(!O||!O.configurable)return!1;var P,Y={};for(P in O)"set"!=P&&(Y[P]=O[P]);var c=O.set;return Y.set=function(U){c.call(this,U);var F=this.getContext("2d");F&&"__reset"in F&&F.__reset()},Object.defineProperty(U,F,Y),!0},u.replaceGetSet=function(U,F){var O=Object.getOwnPropertyDescriptor(U,F);if(!O||!O.configurable)return!1;var P,Y={};for(P in O)"set"!=P&&(Y[P]=O[P]);var c=O.set,L="___"+F+"__";return u.newKeys.push(L),Y.set=function(U){U!=this[L]&&(this[L]=U,c.call(this,U))},Object.defineProperty(U,F,Y),!0},u._default=new u,u.newKeys=[],d(u,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),u}(),M=function(){function c(U){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++c._uniqueIDCounter,this._name=U||"Content Manager",c._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,c._resourceManagers.push(this),this._resources=[],this._records={}}x(c,"laya.resource.ResourceManager");var U=c.prototype;return f.imps(U,{"laya.resource.IDispose":!0}),U.getResourceByIndex=function(U){return this._resources[U]},U.getResourcesLength=function(){return this._resources.length},U.addResource=function(U){return U.resourceManager&&U.resourceManager.removeResource(U),-1===this._resources.indexOf(U)&&((U._resourceManager=this)._resources.push(U),this.addRecord(U.uri,U.__className,U.memorySize),this.addSize(U.memorySize),!0)},U.removeResource=function(U){var F=this._resources.indexOf(U);return-1!==F&&(this._resources.splice(F,1),U._resourceManager=null,this._memorySize-=U.memorySize,this.addRecord(U.uri,U.__className,-U.memorySize),!0)},U.unload=function(){for(var U=this._resources.slice(0,this._resources.length),F=0;F<U.length;F++){U[F].destroy()}U.length=0},U.dispose=function(){if(this===c._systemResourceManager)throw new Error("systemResourceManager不能被释放！");c._resourceManagers.splice(c._resourceManagers.indexOf(this),1),c._isResourceManagersSorted=!1;for(var U=this._resources.slice(0,this._resources.length),F=0;F<U.length;F++){var O=U[F];O.resourceManager.removeResource(O),O.destroy()}U.length=0},U.addSize=function(U){U&&(this.autoRelease&&0<U&&this._memorySize+U>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=U)},U.addRecord=function(U,F,O){DEBUG&&O&&!U&&console.error(U,F,O)},U.garbageCollection=function(U){var F=this._resources;(F=F.slice()).sort(function(U,F){if(!U||!F)throw new Error("a或b不能为空！");return U.released&&F.released?0:U.released?1:F.released?-1:U._lastUseFrameCount-F._lastUseFrameCount});for(var O=v.loopCount,P=0,Y=F.length;P<Y;P++){var c=F[P];if(!(1<O-c._lastUseFrameCount))return void(this._memorySize>=U&&(this._isOverflow=!0));if(c.releaseResource(),this._memorySize<U)return void(this._isOverflow=!1)}},b(0,U,"id",function(){return this._id}),b(0,U,"name",function(){return this._name},function(U){!U&&""===U||this._name===U||(this._name=U,c._isResourceManagersSorted=!1)}),b(0,U,"memorySize",function(){return this._memorySize}),b(0,U,"records",function(){return this._records}),b(1,c,"systemResourceManager",function(){return c._systemResourceManager}),c.__init__=function(){c.currentResourceManager=c.systemResourceManager},c.getLoadedResourceManagerByIndex=function(U){return c._resourceManagers[U]},c.getLoadedResourceManagersCount=function(){return c._resourceManagers.length},c.recreateContentManagers=function(U){void 0===U&&(U=!1);for(var F=c.currentResourceManager,O=0;O<c._resourceManagers.length;O++){c.currentResourceManager=c._resourceManagers[O];for(var P=0;P<c.currentResourceManager._resources.length;P++)c.currentResourceManager._resources[P].releaseResource(U),c.currentResourceManager._resources[P].activeResource(U)}c.currentResourceManager=F},c.releaseContentManagers=function(U){void 0===U&&(U=!1);for(var F=c.currentResourceManager,O=0;O<c._resourceManagers.length;O++){c.currentResourceManager=c._resourceManagers[O];for(var P=0;P<c.currentResourceManager._resources.length;P++){var Y=c.currentResourceManager._resources[P];!Y.released&&Y.releaseResource(U)}}c.currentResourceManager=F},c._uniqueIDCounter=0,c._isResourceManagersSorted=!1,c._resourceManagers=[],d(c,["_systemResourceManager",function(){return this._systemResourceManager=new c("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=c._systemResourceManager}]),c}(),m=(function(){function U(){}x(U,"laya.system.System"),U.changeDefinition=function(U,F){f[U]=F;var O=U+"=classObj";f._runScript(O)},U.__init__=function(){k.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function O(){}return x(O,"laya.utils.Browser"),b(1,O,"pixelRatio",function(){return O.__init__(),-1<O.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:C.getPixelRatio()}),b(1,O,"height",function(){return O.__init__(),(f.stage&&f.stage.canvasRotation?O.clientWidth:O.clientHeight)*O.pixelRatio}),b(1,O,"clientWidth",function(){return O.__init__(),O.window.innerWidth||O.document.body.clientWidth}),b(1,O,"window",function(){return O.__init__(),O._window}),b(1,O,"clientHeight",function(){return O.__init__(),O.window.innerHeight||O.document.body.clientHeight||O.document.documentElement.clientHeight}),b(1,O,"width",function(){return O.__init__(),(f.stage&&f.stage.canvasRotation?O.clientHeight:O.clientWidth)*O.pixelRatio}),b(1,O,"container",function(){return O.__init__(),O._container||((O._container=O.createElement("div")).id="layaContainer",O.document.body.appendChild(O._container)),O._container},function(U){O._container=U}),b(1,O,"document",function(){return O.__init__(),O._document}),O.__init__=function(){if(!O._window){O._window=C.getWindow(),O._document=O.window.document,O._window.addEventListener("message",function(U){laya.utils.Browser._onMessage(U)},!1),O.document.__createElement=O.document.createElement,L.requestAnimationFrame=L.requestAnimationFrame||L.webkitRequestAnimationFrame||L.mozRequestAnimationFrame||L.oRequestAnimationFrame||L.msRequestAnimationFrame||function(U){return L.setTimeout(U,1e3/60)};var U=L.document.body.style;U["-webkit-user-select"]="none",U["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",O.userAgent=O.window.navigator.userAgent,O.onIOS=!!(O.u=O.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),O.onMobile=-1<O.u.indexOf("Mobile"),O.onIPhone=-1<O.u.indexOf("iPhone"),O.onMac=-1<O.u.indexOf("Mac OS X"),O.onIPad=-1<O.u.indexOf("iPad"),O.onAndroid=-1<O.u.indexOf("Android")||-1<O.u.indexOf("Adr"),O.onWP=-1<O.u.indexOf("Windows Phone"),O.onQQBrowser=-1<O.u.indexOf("QQBrowser"),O.onMQQBrowser=-1<O.u.indexOf("MQQBrowser")||-1<O.u.indexOf("Mobile")&&-1<O.u.indexOf("QQ"),O.onIE=!!O.window.ActiveXObject||"ActiveXObject"in O.window,O.onWeiXin=-1<O.u.indexOf("MicroMessenger"),O.onPC=!O.onMobile,O.onSafari=-1<O.u.indexOf("Safari"),O.onFirefox=-1<O.u.indexOf("Firefox"),O.onEdge=-1<O.u.indexOf("Edge"),O.onMiniGame=-1<O.u.indexOf("MiniGame"),O.onLimixiu=-1<O.u.indexOf("limixiu"),O.httpProtocol="http:"==O.window.location.protocol,O.onMiniGame&&null==O.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),O.webAudioEnabled=!!(O.window.AudioContext||O.window.webkitAudioContext||O.window.mozAudioContext),O.soundType=O.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",YU=O.webAudioEnabled?cU:OU,O.webAudioEnabled&&cU.initWebAudio(),OU._initMusicAudio(),O.enableTouch="ontouchstart"in L||L.DocumentTouch&&F instanceof DocumentTouch,L.focus(),$._soundClass=YU,$._musicClass=OU,k._mainCanvas=k._mainCanvas||QU.create("2D"),O.canvas||(O.canvas=QU.create("2D"),O.context=O.canvas.getContext("2d"))}},O._onMessage=function(U){if(U.data&&"size"==U.data.name){if(O.window.innerWidth=U.data.width,O.window.innerHeight=U.data.height,O.window.__innerHeight=U.data.clientHeight,!O.document.createEvent)return void console.warn("no document.createEvent");var F=O.document.createEvent("HTMLEvents");return F.initEvent("resize",!1,!1),void O.window.dispatchEvent(F)}},O.createElement=function(U){return O.__init__(),O.document.__createElement(U)},O.getElementById=function(U){return O.__init__(),O.document.getElementById(U)},O.removeElement=function(U){U&&U.parentNode&&U.parentNode.removeChild(U)},O.now=function(){return C.now()},O._window=null,O._document=null,O._container=null,O.userAgent=null,O.u=null,O.onIOS=!1,O.onMac=!1,O.onMobile=!1,O.onIPhone=!1,O.onIPad=!1,O.onAndroid=!1,O.onWP=!1,O.onQQBrowser=!1,O.onMQQBrowser=!1,O.onSafari=!1,O.onFirefox=!1,O.onEdge=!1,O.onIE=!1,O.onWeiXin=!1,O.onMiniGame=!1,O.onLimixiu=!1,O.onPC=!1,O.httpProtocol=!1,O.webAudioEnabled=!1,O.soundType=null,O.enableTouch=!1,O.canvas=null,O.context=null,O.__init$=function(){},O}()),p=function(){function F(U){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,U?(this._u8d_=new Uint8Array(U),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}x(F,"laya.utils.Byte");var U=F.prototype;return U.___resizeBuffer=function(F){try{var U=new Uint8Array(F);null!=this._u8d_&&(this._u8d_.length<=F?U.set(this._u8d_):U.set(this._u8d_.subarray(0,F))),this._u8d_=U,this._d_=new DataView(U.buffer)}catch(U){throw"___resizeBuffer err:"+F}},U.getString=function(){return this.rUTF(this.getUint16())},U.getFloat32Array=function(U,F){var O=U+F;O=O>this._length?this._length:O;var P=new Float32Array(this._d_.buffer.slice(U,O));return this._pos_=O,P},U.getUint8Array=function(U,F){var O=U+F;O=O>this._length?this._length:O;var P=new Uint8Array(this._d_.buffer.slice(U,O));return this._pos_=O,P},U.getInt16Array=function(U,F){var O=U+F;O=O>this._length?this._length:O;var P=new Int16Array(this._d_.buffer.slice(U,O));return this._pos_=O,P},U.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var U=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,U},U.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var U=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,U},U.writeFloat32=function(U){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,U,this._xd_),this._pos_+=4},U.writeFloat64=function(U){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,U,this._xd_),this._pos_+=8},U.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var U=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,U},U.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var U=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,U},U.writeInt32=function(U){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,U,this._xd_),this._pos_+=4},U.writeUint32=function(U){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,U,this._xd_),this._pos_+=4},U.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var U=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,U},U.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var U=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,U},U.writeUint16=function(U){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,U,this._xd_),this._pos_+=2},U.writeInt16=function(U){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,U,this._xd_),this._pos_+=2},U.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},U.writeUint8=function(U){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,U),this._pos_++},U._getUInt8=function(U){return this._d_.getUint8(U)},U._getUint16=function(U){return this._d_.getUint16(U,this._xd_)},U._getMatrix=function(){return new s(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},U.rUTF=function(U){for(var F=[],O=this._pos_+U,P=0,Y=0,c=0,L=String.fromCharCode,u=this._u8d_;this._pos_<O;)(P=u[this._pos_++])<128?0!=P&&F.push(L(P)):P<224?F.push(L((63&P)<<6|127&u[this._pos_++])):P<240?(Y=u[this._pos_++],F.push(L((31&P)<<12|(127&Y)<<6|127&u[this._pos_++]))):(Y=u[this._pos_++],c=u[this._pos_++],F.push(L((15&P)<<18|(127&Y)<<12|c<<6&127|127&u[this._pos_++]))),0;return F.join("")},U.getCustomString=function(U){for(var F=[],O=0,P=0,Y=0,c=String.fromCharCode,L=this._u8d_;0<U;)if((P=L[this._pos_])<128)F.push(c(P)),this._pos_++,U--;else for(O=P-128,this._pos_++,U-=O;0<O;)P=L[this._pos_++],Y=L[this._pos_++],F.push(c(Y<<8|P)),O--;return F.join("")},U.clear=function(){this._pos_=0,this.length=0},U.__getBuffer=function(){return this._d_.buffer},U.writeUTFBytes=function(U){for(var F=0,O=(U+="").length;F<O;F++){var P=U.charCodeAt(F);P<=127?this.writeByte(P):P<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|P>>6,128|63&P],this._pos_),this._pos_+=2):P<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|P>>12,128|P>>6&63,128|63&P],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|P>>18,128|P>>12&63,128|P>>6&63,128|63&P],this._pos_),this._pos_+=4)}},U.writeUTFString=function(U){var F=this.pos;this.writeUint16(1),this.writeUTFBytes(U);var O=this.pos-F-2;if(65536<=O)throw"writeUTFString byte len more than 65536";this._d_.setUint16(F,O,this._xd_)},U.readUTFString=function(){return this.readUTFBytes(this.getUint16())},U.getUTFString=function(){return this.readUTFString()},U.readUTFBytes=function(U){if(void 0===U&&(U=-1),0==U)return"";var F=this.bytesAvailable;if(F<U)throw"readUTFBytes error - Out of bounds";return U=0<U?U:F,this.rUTF(U)},U.getUTFBytes=function(U){return void 0===U&&(U=-1),this.readUTFBytes(U)},U.writeByte=function(U){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,U),this._pos_+=1},U.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},U.getByte=function(){return this.readByte()},U.ensureWrite=function(U){this._length<U&&(this._length=U),this._allocated_<U&&(this.length=U)},U.writeArrayBuffer=function(U,F,O){if(void 0===F&&(F=0),void 0===O&&(O=0),F<0||O<0)throw"writeArrayBuffer error - Out of bounds";0==O&&(O=U.byteLength-F),this.ensureWrite(this._pos_+O);var P=new Uint8Array(U);this._u8d_.set(P.subarray(F,F+O),this._pos_),this._pos_+=O},b(0,U,"buffer",function(){var U=this._d_.buffer;return U.byteLength==this.length?U:U.slice(0,this.length)}),b(0,U,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(U){this._xd_="littleEndian"==U}),b(0,U,"length",function(){return this._length},function(U){this._allocated_<U?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(U,2*this._allocated_))):this._allocated_>U&&this.___resizeBuffer(this._allocated_=U),this._length=U}),b(0,U,"pos",function(){return this._pos_},function(U){this._pos_=U}),b(0,U,"bytesAvailable",function(){return this._length-this._pos_}),F.getSystemEndian=function(){if(!F._sysEndian){var U=new ArrayBuffer(2);new DataView(U).setInt16(0,256,!0),F._sysEndian=256===new Int16Array(U)[0]?"littleEndian":"bigEndian"}return F._sysEndian},F.BIG_ENDIAN="bigEndian",F.LITTLE_ENDIAN="littleEndian",F._sysEndian=null,F}(),o=function(){function Y(){}return x(Y,"laya.utils.CacheManager"),Y.regCacheByFunction=function(U,F){var O;Y.unRegCacheByFunction(U,F),O={tryDispose:U,getCacheList:F},Y._cacheList.push(O)},Y.unRegCacheByFunction=function(U,F){var O,P=0;for(O=Y._cacheList.length,P=0;P<O;P++)if(Y._cacheList[P].tryDispose==U&&Y._cacheList[P].getCacheList==F)return void Y._cacheList.splice(P,1)},Y.forceDispose=function(){var U=0,F=Y._cacheList.length;for(U=0;U<F;U++)Y._cacheList[U].tryDispose(!0)},Y.beginCheck=function(U){void 0===U&&(U=15e3),f.timer.loop(U,null,Y._checkLoop)},Y.stopCheck=function(){f.timer.clear(null,Y._checkLoop)},Y._checkLoop=function(){var U=Y._cacheList;if(!(U.length<1)){var F,O=m.now(),P=0;for(F=P=U.length;0<P&&(U[Y._index=++Y._index%F].tryDispose(!1),!(m.now()-O>Y.loopTimeLimit));)P--}},Y.loopTimeLimit=2,Y._cacheList=[],Y._index=0,Y}(),R=function(){function w(){}return x(w,"laya.utils.ClassUtils"),w.regClass=function(U,F){w._classMap[U]=F},w.getRegClass=function(U){return w._classMap[U]},w.getInstance=function(U){var F=w.getClass(U);return F?new F:(console.warn("[error] Undefined class:",U),null)},w.createByJson=function(U,F,O,P,Y){"string"==typeof U&&(U=JSON.parse(U));var c=U.props;if(!F&&!(F=Y?Y.runWith(U):w.getInstance(c.runtime||U.type)))return null;var L=U.child;if(L)for(var u=0,d=L.length;u<d;u++){var a=L[u];if("render"!==a.props.name&&"render"!==a.props.renderType||!F._$set_itemRender)if("Graphic"==a.type)w.addGraphicsToSprite(a,F);else if(w.isDrawType(a.type))w.addGraphicToSprite(a,F,!0);else{var b=w.createByJson(a,null,O,P,Y);"Script"==a.type?b.hasOwnProperty("owner")?b.owner=F:b.hasOwnProperty("target")&&(b.target=F):"mask"==a.props.renderType?F.mask=b:F.addChild(b)}else F.itemRender=a}if(c)for(var z in c){var J=c[z];"var"===z&&O?O[J]=F:J instanceof Array&&"function"==typeof F[z]?F[z].apply(F,J):F[z]=J}return P&&U.customProps&&P.runWith([F,U]),F.created&&F.created(),F},w.addGraphicsToSprite=function(U,F){var O;if((O=U.child)&&!(O.length<1)){var P;P=w._getGraphicsFromSprite(U,F);var Y=0,c=0;U.props&&(Y=w._getObjVar(U.props,"x",0),c=w._getObjVar(U.props,"y",0)),0!=Y&&0!=c&&P.translate(Y,c);var L,u=0;for(L=O.length,u=0;u<L;u++)w._addGraphicToGraphics(O[u],P);0!=Y&&0!=c&&P.translate(-Y,-c)}},w.addGraphicToSprite=function(U,F,O){var P;void 0===O&&(O=!1),P=O?w._getGraphicsFromSprite(U,F):F.graphics,w._addGraphicToGraphics(U,P)},w._getGraphicsFromSprite=function(U,F){var O,P;if(!U||!U.props)return F.graphics;switch(P=U.props.renderType){case"hit":case"unHit":var Y;F.hitArea||(F.hitArea=new Z),(Y=F.hitArea)[P]||(Y[P]=new J),O=Y[P]}return O||(O=F.graphics),O},w._getTransformData=function(U){var F;(U.hasOwnProperty("pivotX")||U.hasOwnProperty("pivotY"))&&(F=F||new s).translate(-w._getObjVar(U,"pivotX",0),-w._getObjVar(U,"pivotY",0));var O=w._getObjVar(U,"scaleX",1),P=w._getObjVar(U,"scaleY",1),Y=w._getObjVar(U,"rotation",0);w._getObjVar(U,"skewX",0),w._getObjVar(U,"skewY",0);return 1==O&&1==P&&0==Y||((F=F||new s).scale(O,P),F.rotate(.0174532922222222*Y)),F},w._addGraphicToGraphics=function(U,F){var O,P;if((O=U.props)&&(P=w.DrawTypeDic[U.type])){var Y,c;Y=F;var L=w._getParams(O,P[1],P[2],P[3]);((c=w._tM)||1!=w._alpha)&&(Y.save(),c&&Y.transform(c),1!=w._alpha&&Y.alpha(w._alpha)),Y[P[0]].apply(Y,L),(c||1!=w._alpha)&&Y.restore()}},w._adptLineData=function(U){return U[2]=parseFloat(U[0])+parseFloat(U[2]),U[3]=parseFloat(U[1])+parseFloat(U[3]),U},w._adptTextureData=function(U){return U[0]=uU.getRes(U[0]),U},w._adptLinesData=function(U){return U[2]=w._getPointListByStr(U[2]),U},w.isDrawType=function(U){return"Image"!=U&&w.DrawTypeDic.hasOwnProperty(U)},w._getParams=function(U,F,O,P){var Y;void 0===O&&(O=0),(Y=w._temParam).length=F.length;var c,L,u=0;for(c=F.length,u=0;u<c;u++)Y[u]=w._getObjVar(U,F[u][0],F[u][1]);return w._alpha=w._getObjVar(U,"alpha",1),L=w._getTransformData(U),w._tM=L?(O||(O=0),L.translate(Y[O],Y[O+1]),Y[O]=Y[O+1]=0,L):null,P&&w[P]&&(Y=w[P](Y)),Y},w._getPointListByStr=function(U){var F,O,P=0;for(O=(F=U.split(",")).length,P=0;P<O;P++)F[P]=parseFloat(F[P]);return F},w._getObjVar=function(U,F,O){return U.hasOwnProperty(F)?U[F]:O},w._temParam=[],w._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},w.getClass=function(U){var F=w._classMap[U]||U;return"string"==typeof F?f.__classmap[F]:F},w._tM=null,w._alpha=NaN,d(w,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),w}(),_=function(){function c(U){if(this._color=[],"string"==typeof U){null===(this.strColor=U)&&(U="#000000"),"#"==U.charAt(0)&&(U=U.substr(1));var F=U.length;if(3==F||4==F){for(var O="",P=0;P<F;P++)O+=U[P]+U[P];U=O}var Y=this.numColor=parseInt(U,16);if(8==U.length)return void(this._color=[parseInt(U.substr(0,2),16)/255,((16711680&Y)>>16)/255,((65280&Y)>>8)/255,(255&Y)/255])}else Y=this.numColor=U,this.strColor=S.toHexColor(Y);this._color=[((16711680&Y)>>16)/255,((65280&Y)>>8)/255,(255&Y)/255,1],this._color.__id=++c._COLODID}return x(c,"laya.utils.Color"),c._initDefault=function(){for(var U in c._DEFAULT={},c._COLOR_MAP)c._SAVE[U]=c._DEFAULT[U]=new c(c._COLOR_MAP[U]);return c._DEFAULT},c._initSaveMap=function(){for(var U in c._SAVE_SIZE=0,c._SAVE={},c._DEFAULT)c._SAVE[U]=c._DEFAULT[U]},c.create=function(U){var F=c._SAVE[U+""];return null!=F?F:(c._SAVE_SIZE<1e3||c._initSaveMap(),c._SAVE[U+""]=new c(U))},c._SAVE={},c._SAVE_SIZE=0,c._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},c._DEFAULT=c._initDefault(),c._COLODID=1,c}(),q=(function(){function U(){this._values=[],this._keys=[]}x(U,"laya.utils.Dictionary");var F=U.prototype;F.set=function(U,F){var O=this.indexOf(U);0<=O?this._values[O]=F:(this._keys.push(U),this._values.push(F))},F.indexOf=function(U){var F=this._keys.indexOf(U);return 0<=F?F:(U="string"==typeof U?Number(U):"number"==typeof U?U.toString():U,this._keys.indexOf(U))},F.get=function(U){var F=this.indexOf(U);return F<0?null:this._values[F]},F.remove=function(U){var F=this.indexOf(U);return 0<=F&&(this._keys.splice(F,1),this._values.splice(F,1),!0)},F.clear=function(){this._values.length=0,this._keys.length=0},b(0,F,"values",function(){return this._values}),b(0,F,"keys",function(){return this._keys})}(),function(){function U(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}x(U,"laya.utils.Dragging");var F=U.prototype;return F.start=function(U,F,O,P,Y,c,L,u){void 0===u&&(u=.92),this.clearTimer(),this.target=U,this.area=F,this.hasInertia=O,this.elasticDistance=F?P:0,this.elasticBackTime=Y,this.data=c,this._disableMouseEvent=L,this.ratio=u,1!=U.globalScaleX||1!=U.globalScaleY?this._parent=U.parent:this._parent=f.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,f.stage.on("mouseup",this,this.onStageMouseUp),f.stage.on("mouseout",this,this.onStageMouseUp),f.timer.frameLoop(1,this,this.loop)},F.clearTimer=function(){f.timer.clear(this,this.loop),f.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},F.stop=function(){this._dragging&&(j.instance.disableMouseEvent=!1,f.stage.off("mouseup",this,this.onStageMouseUp),f.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},F.loop=function(){var U=this._parent.getMousePoint(),F=U.x,O=U.y,P=F-this._lastX,Y=O-this._lastY;if(this._clickOnly){if(!(1<Math.abs(P*f.stage._canvasTransform.getScaleX())||1<Math.abs(Y*f.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),j.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(P,Y);0==P&&0==Y||(this._lastX=F,this._lastY=O,this.target.x+=P*this._elasticRateX,this.target.y+=Y*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},F.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var U=this.area.x-this.target.x;else U=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-U/this.elasticDistance),this.target.y<this.area.y)var F=this.area.y-this.target.y;else F=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-F/this.elasticDistance)}},F.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},F.onStageMouseUp=function(U){if(j.instance.disableMouseEvent=!1,f.stage.off("mouseup",this,this.onStageMouseUp),f.stage.off("mouseout",this,this.onStageMouseUp),f.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var F=this._offsets.length,O=Math.min(F,6),P=this._offsets.length-O,Y=F-1;P<Y;Y--)this._offsetY+=this._offsets[Y--],this._offsetX+=this._offsets[Y];this._offsetX=this._offsetX/O*2,this._offsetY=this._offsetY/O*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),f.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},F.checkElastic=function(){var U=NaN,F=NaN;if(this.target.x<this.area.x?U=this.area.x:this.target.x>this.area.x+this.area.width&&(U=this.area.x+this.area.width),this.target.y<this.area.y?F=this.area.y:this.target.y>this.area.y+this.area.height&&(F=this.area.y+this.area.height),isNaN(U)&&isNaN(F))this.clear();else{var O={};isNaN(U)||(O.x=U),isNaN(F)||(O.y=F),this._tween=t.to(this.target,O,this.elasticBackTime,D.sineOut,h.create(this,this.clear),0,!1,!1)}},F.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(f.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},F.clear=function(){if(this.target){this.clearTimer();var U=this.target;this.target=null,this._parent=null,U.event("dragend",this.data)}},U}()),D=function(){function u(){}return x(u,"laya.utils.Ease"),u.linearNone=function(U,F,O,P){return O*U/P+F},u.linearIn=function(U,F,O,P){return O*U/P+F},u.linearInOut=function(U,F,O,P){return O*U/P+F},u.linearOut=function(U,F,O,P){return O*U/P+F},u.bounceIn=function(U,F,O,P){return O-u.bounceOut(P-U,0,O,P)+F},u.bounceInOut=function(U,F,O,P){return U<.5*P?.5*u.bounceIn(2*U,0,O,P)+F:.5*u.bounceOut(2*U-P,0,O,P)+.5*O+F},u.bounceOut=function(U,F,O,P){return(U/=P)<1/2.75?O*(7.5625*U*U)+F:U<2/2.75?O*(7.5625*(U-=1.5/2.75)*U+.75)+F:U<2.5/2.75?O*(7.5625*(U-=2.25/2.75)*U+.9375)+F:O*(7.5625*(U-=2.625/2.75)*U+.984375)+F},u.backIn=function(U,F,O,P,Y){return void 0===Y&&(Y=1.70158),O*(U/=P)*U*((Y+1)*U-Y)+F},u.backInOut=function(U,F,O,P,Y){return void 0===Y&&(Y=1.70158),(U/=.5*P)<1?.5*O*(U*U*((1+(Y*=1.525))*U-Y))+F:O/2*((U-=2)*U*((1+(Y*=1.525))*U+Y)+2)+F},u.backOut=function(U,F,O,P,Y){return void 0===Y&&(Y=1.70158),O*((U=U/P-1)*U*((Y+1)*U+Y)+1)+F},u.elasticIn=function(U,F,O,P,Y,c){var L;return void 0===Y&&(Y=0),void 0===c&&(c=0),0==U?F:1==(U/=P)?F+O:(c||(c=.3*P),L=!Y||0<O&&Y<O||O<0&&Y<-O?(Y=O,c/4):c/u.PI2*Math.asin(O/Y),-Y*Math.pow(2,10*(U-=1))*Math.sin((U*P-L)*u.PI2/c)+F)},u.elasticInOut=function(U,F,O,P,Y,c){var L;return void 0===Y&&(Y=0),void 0===c&&(c=0),0==U?F:2==(U/=.5*P)?F+O:(c||(c=P*(.3*1.5)),L=!Y||0<O&&Y<O||O<0&&Y<-O?(Y=O,c/4):c/u.PI2*Math.asin(O/Y),U<1?Y*Math.pow(2,10*(U-=1))*Math.sin((U*P-L)*u.PI2/c)*-.5+F:Y*Math.pow(2,-10*(U-=1))*Math.sin((U*P-L)*u.PI2/c)*.5+O+F)},u.elasticOut=function(U,F,O,P,Y,c){var L;return void 0===Y&&(Y=0),void 0===c&&(c=0),0==U?F:1==(U/=P)?F+O:(c||(c=.3*P),L=!Y||0<O&&Y<O||O<0&&Y<-O?(Y=O,c/4):c/u.PI2*Math.asin(O/Y),Y*Math.pow(2,-10*U)*Math.sin((U*P-L)*u.PI2/c)+O+F)},u.strongIn=function(U,F,O,P){return O*(U/=P)*U*U*U*U+F},u.strongInOut=function(U,F,O,P){return(U/=.5*P)<1?.5*O*U*U*U*U*U+F:.5*O*((U-=2)*U*U*U*U+2)+F},u.strongOut=function(U,F,O,P){return O*((U=U/P-1)*U*U*U*U+1)+F},u.sineInOut=function(U,F,O,P){return.5*-O*(Math.cos(Math.PI*U/P)-1)+F},u.sineIn=function(U,F,O,P){return-O*Math.cos(U/P*u.HALF_PI)+O+F},u.sineOut=function(U,F,O,P){return O*Math.sin(U/P*u.HALF_PI)+F},u.quintIn=function(U,F,O,P){return O*(U/=P)*U*U*U*U+F},u.quintInOut=function(U,F,O,P){return(U/=.5*P)<1?.5*O*U*U*U*U*U+F:.5*O*((U-=2)*U*U*U*U+2)+F},u.quintOut=function(U,F,O,P){return O*((U=U/P-1)*U*U*U*U+1)+F},u.quartIn=function(U,F,O,P){return O*(U/=P)*U*U*U+F},u.quartInOut=function(U,F,O,P){return(U/=.5*P)<1?.5*O*U*U*U*U+F:.5*-O*((U-=2)*U*U*U-2)+F},u.quartOut=function(U,F,O,P){return-O*((U=U/P-1)*U*U*U-1)+F},u.cubicIn=function(U,F,O,P){return O*(U/=P)*U*U+F},u.cubicInOut=function(U,F,O,P){return(U/=.5*P)<1?.5*O*U*U*U+F:.5*O*((U-=2)*U*U+2)+F},u.cubicOut=function(U,F,O,P){return O*((U=U/P-1)*U*U+1)+F},u.quadIn=function(U,F,O,P){return O*(U/=P)*U+F},u.quadInOut=function(U,F,O,P){return(U/=.5*P)<1?.5*O*U*U+F:.5*-O*(--U*(U-2)-1)+F},u.quadOut=function(U,F,O,P){return-O*(U/=P)*(U-2)+F},u.expoIn=function(U,F,O,P){return 0==U?F:O*Math.pow(2,10*(U/P-1))+F-.001*O},u.expoInOut=function(U,F,O,P){return 0==U?F:U==P?F+O:(U/=.5*P)<1?.5*O*Math.pow(2,10*(U-1))+F:.5*O*(2-Math.pow(2,-10*--U))+F},u.expoOut=function(U,F,O,P){return U==P?F+O:O*(1-Math.pow(2,-10*U/P))+F},u.circIn=function(U,F,O,P){return-O*(Math.sqrt(1-(U/=P)*U)-1)+F},u.circInOut=function(U,F,O,P){return(U/=.5*P)<1?.5*-O*(Math.sqrt(1-U*U)-1)+F:.5*O*(Math.sqrt(1-(U-=2)*U)+1)+F},u.circOut=function(U,F,O,P){return O*Math.sqrt(1-(U=U/P-1)*U)+F},u.HALF_PI=.5*Math.PI,u.PI2=2*Math.PI,u}(),Z=function(){function z(){this._hit=null,this._unHit=null}x(z,"laya.utils.HitArea");var U=z.prototype;return U.isHit=function(U,F){return!!z.isHitGraphic(U,F,this.hit)&&!z.isHitGraphic(U,F,this.unHit)},U.contains=function(U,F){return this.isHit(U,F)},b(0,U,"hit",function(){return this._hit||(this._hit=new J),this._hit},function(U){this._hit=U}),b(0,U,"unHit",function(){return this._unHit||(this._unHit=new J),this._unHit},function(U){this._unHit=U}),z.isHitGraphic=function(U,F,O){if(!O)return!1;var P;if(!(P=O.cmds)&&O._one&&((P=z._cmds).length=1,P[0]=O._one),!P)return!1;var Y,c,L=0;for(Y=P.length,L=0;L<Y;L++)if(c=P[L]){var u=k._context;switch(c.callee){case u._translate:case 6:U-=c[0],F-=c[1]}if(z.isHitCmd(U,F,c))return!0}return!1},z.isHitCmd=function(U,F,O){if(!O)return!1;var P=k._context,Y=!1;switch(O.callee){case P._drawRect:case 13:z._rec.setTo(O[0],O[1],O[2],O[3]),Y=z._rec.contains(U,F);break;case P._drawCircle:case P._fillCircle:case 14:Y=(U-=O[0])*U+(F-=O[1])*F<O[2]*O[2];break;case P._drawPoly:case 18:U-=O[0],F-=O[1],Y=z.ptInPolygon(U,F,O[2])}return Y},z.ptInPolygon=function(U,F,O){var P;(P=z._ptPoint).setTo(U,F);var Y,c=0,L=NaN,u=NaN,d=NaN,a=NaN;Y=O.length;for(var b=0;b<Y;b+=2){if(L=O[b],u=O[b+1],d=O[(b+2)%Y],u!=(a=O[(b+3)%Y]))if(!(P.y<Math.min(u,a)))if(!(P.y>=Math.max(u,a)))(P.y-u)*(d-L)/(a-u)+L>P.x&&c++}return c%2==1},z._cmds=[],d(z,["_rec",function(){return this._rec=new T},"_ptPoint",function(){return this._ptPoint=new I}]),z}(),e=(function(){function Y(U,F,O,P){this.char=U,this.charNum=U.charCodeAt(0),this._x=this._y=0,this.width=F,this.height=O,this.style=P,this.isWord=!Y._isWordRegExp.test(U)}x(Y,"laya.utils.HTMLChar");var U=Y.prototype;f.imps(U,{"laya.display.ILayout":!0}),U.setSprite=function(U){this._sprite=U},U.getSprite=function(){return this._sprite},U._isChar=function(){return!0},U._getCSSStyle=function(){return this.style},b(0,U,"width",function(){return this._w},function(U){this._w=U}),b(0,U,"x",function(){return this._x},function(U){this._sprite&&(this._sprite.x=U),this._x=U}),b(0,U,"y",function(){return this._y},function(U){this._sprite&&(this._sprite.y=U),this._y=U}),b(0,U,"height",function(){return this._h},function(U){this._h=U}),Y._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function F(){}x(F,"laya.utils.Log"),F.enable=function(){F._logdiv||(F._logdiv=m.window.document.createElement("div"),m.window.document.body.appendChild(F._logdiv),F._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},F.toggle=function(){var U=F._logdiv.style;"1px"==U.width?U.width=U.height="50%":U.width=U.height="1px"},F.print=function(U){F._logdiv&&(F.maxCount<=F._count&&F.clear(),F._count++,F._logdiv.innerText+=U+"\n",F._logdiv.scrollTop=F._logdiv.scrollHeight)},F.clear=function(){F._logdiv.innerText="",F._count=0},F._logdiv=null,F._count=0,F.maxCount=20}(),function(){function F(){}x(F,"laya.utils.Mouse"),b(1,F,"cursor",function(){return F._style.cursor},function(U){F._style.cursor=U}),F.hide=function(){"none"!=F.cursor&&(F._preCursor=F.cursor,F.cursor="none")},F.show=function(){"none"==F.cursor&&(F.cursor=F._preCursor?F._preCursor:"auto")},F._preCursor=null,d(F,["_style",function(){return this._style=m.document.body.style}])}(),function(){function c(){}return x(c,"laya.utils.Pool"),c.getPoolBySign=function(U){return c._poolDic[U]||(c._poolDic[U]=[])},c.clearBySign=function(U){c._poolDic[U]&&(c._poolDic[U].length=0)},c.recover=function(U,F){F.__InPool||(F.__InPool=!0,c.getPoolBySign(U).push(F))},c.getItemByClass=function(U,F){var O=c.getPoolBySign(U),P=O.length?O.pop():new F;return P.__InPool=!1,P},c.getItemByCreateFun=function(U,F,O){var P=c.getPoolBySign(U),Y=P.length?P.pop():F.call(O);return Y.__InPool=!1,Y},c.getItem=function(U){var F=c.getPoolBySign(U),O=F.length?F.pop():null;return O&&(O.__InPool=!1),O},c._poolDic={},c.InPoolSign="__InPool",c}()),v=function(){function d(){}return x(d,"laya.utils.Stat"),b(1,d,"onclick",null,function(U){d._sp&&d._sp.on("click",d._sp,U),d._canvas&&(d._canvas.source.onclick=U,d._canvas.source.style.pointerEvents="")}),d.show=function(U,F,O){if(void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),!k.isConchApp||k.isConchWebGL){if(k.isConchWebGL||m.onMiniGame||m.onLimixiu||(d._useCanvas=!0),d._show=!0,d._fpsData.length=60,d._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},d._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},d._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},d._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},k.isWebGL)if(d._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},k.is3DMode){if(d._view[0].title="FPS(3D)",d._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},d._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},d._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==O){var P=8;d._view[P++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},d._view[P++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},d._view[P++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},d._view[P++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},d._view[P++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},d._view[P++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},d._view[P++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},d._view[P++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},d._view[P++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==O){P=8;d._view[P++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},d._view[P++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},d._view[P++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},d._view[P++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},d._view[P++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},d._view[P++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},d._view[P++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else d._view[0].title="FPS(WebGL)",d._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else d._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};d._useCanvas?d.createUIPre(U,F):d.createUI(U,F),d.enable()}else m.window.conch.showFPS&&m.window.conch.showFPS(U,F)},d.createUIPre=function(U,F){var O=m.pixelRatio;d._width=170*O,d._vx=75*O,d._height=O*(12*d._view.length+3*O)+4,d._fontSize=12*O;for(var P=0;P<d._view.length;P++)d._view[P].x=4,d._view[P].y=P*d._fontSize+2*O;d._canvas||((d._canvas=new QU("2D")).size(d._width,d._height),(d._ctx=d._canvas.getContext("2d")).textBaseline="top",d._ctx.font=d._fontSize+"px Sans-serif",d._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+U+"px;top:"+F+"px;width:"+d._width/O+"px;height:"+d._height/O+"px;"),d._first=!0,d.loop(),d._first=!1,m.container.appendChild(d._canvas.source)},d.createUI=function(U,F){var O=d._sp,P=m.pixelRatio;O||(O=new zU,(d._leftText=new rU).pos(5,5),d._leftText.color="#ffffff",O.addChild(d._leftText),(d._txt=new rU).pos(80*P,5),d._txt.color="#ffffff",O.addChild(d._txt),d._sp=O),O.pos(U,F);for(var Y="",c=0;c<d._view.length;c++){Y+=d._view[c].title+"\n"}d._leftText.text=Y;var L=170*P,u=P*(12*d._view.length+3*P)+4;d._txt.fontSize=d._fontSize*P,d._leftText.fontSize=d._fontSize*P,O.size(L,u),O.graphics.clear(),O.graphics.setAlpha(.5),O.graphics.drawRect(0,0,L,u,"#999999"),O.graphics.setAlpha(1),d.loop()},d.enable=function(){f.timer.frameLoop(1,d,d.loop)},d.hide=function(){d._show=!1,f.timer.clear(d,d.loop),d._canvas&&m.removeElement(d._canvas.source)},d.clear=function(){d.trianglesFaces=d.drawCall=d.shaderCall=d.spriteCount=d.spriteRenderUseCacheCount=d.treeNodeCollision=d.treeSpriteCollision=d.canvasNormal=d.canvasBitmap=d.canvasReCache=0},d.loop=function(){d._count++;var U=m.now();if(!(U-d._timer<1e3)){var F=d._count;if(d.FPS=Math.round(1e3*F/(U-d._timer)),d._show){d.trianglesFaces=Math.round(d.trianglesFaces/F),d.spriteCount=d._useCanvas?(d.drawCall=Math.round(d.drawCall/F)-2,d.shaderCall=Math.round(d.shaderCall/F),Math.round(d.spriteCount/F)-1):(d.drawCall=Math.round(d.drawCall/F)-2,d.shaderCall=Math.round(d.shaderCall/F)-4,Math.round(d.spriteCount/F)-4),d.spriteRenderUseCacheCount=Math.round(d.spriteRenderUseCacheCount/F),d.canvasNormal=Math.round(d.canvasNormal/F),d.canvasBitmap=Math.round(d.canvasBitmap/F),d.canvasReCache=Math.ceil(d.canvasReCache/F),d.treeNodeCollision=Math.round(d.treeNodeCollision/F),d.treeSpriteCollision=Math.round(d.treeSpriteCollision/F);var O=0<d.FPS?Math.floor(1e3/d.FPS).toString():" ";d._fpsStr=d.FPS+(d.renderSlow?" slow":"")+" "+O,d._spriteStr=d.spriteCount+(d.spriteRenderUseCacheCount?"/"+d.spriteRenderUseCacheCount:""),d._canvasStr=d.canvasReCache+"/"+d.canvasNormal+"/"+d.canvasBitmap,d.currentMemorySize=M.systemResourceManager.memorySize,d._useCanvas?d.renderInfoPre():d.renderInfo(),d.clear()}d._count=0,d._timer=U}},d.renderInfoPre=function(){if(d._canvas){var U=d._ctx;U.clearRect(d._first?0:d._vx,0,d._width,d._height);for(var F=k.WebGL.mainContext,O=0;O<d._view.length;O++){var P=d._view[O];d._first&&(U.fillStyle="white",U.fillText(P.title,P.x,P.y,null,null,null)),U.fillStyle=P.color;var Y=-1;if((P=d._view[O]).varying){if(F)switch(P.varying){case 1:Y=F.getParameter(F[P.value]);break;case 2:Y=F.getExtension(P.value)}}else Y=d[P.value];"M"==P.units&&(Y=Math.floor(Y/1048576*100)/100+" M"),"K"==P.units&&(Y=Math.floor(Y/1024*100)/100+" K"),"string"==P.units&&(Y=Y.match(/\d+\.?\d/i)),U.fillText(Y+"",P.x+d._vx,P.y,null,null,null)}}},d.renderInfo=function(){for(var U="",F=k.WebGL.mainContext,O=0;O<d._view.length;O++){var P=d._view[O],Y=-1;if(P.varying){if(F)switch(P.varying){case 1:Y=F.getParameter(F[P.value]);break;case 2:Y=F.getExtension(P.value)}}else Y=d[P.value];"M"==P.units&&(Y=Math.floor(Y/1048576*100)/100+" M"),"K"==P.units&&(Y=Math.floor(Y/1024*100)/100+" K"),"string"==P.units&&(Y=Y.match(/\d+\.?\d/i)),U+=Y+"\n"}d._txt.text=U},d.FPS=0,d.loopCount=0,d.shaderCall=0,d.drawCall=0,d.trianglesFaces=0,d.spriteCount=0,d.spriteRenderUseCacheCount=0,d.treeNodeCollision=0,d.treeSpriteCollision=0,d.canvasNormal=0,d.canvasBitmap=0,d.canvasReCache=0,d.renderSlow=!1,d.currentMemorySize=0,d._fpsStr=null,d._canvasStr=null,d._spriteStr=null,d._fpsData=[],d._timer=0,d._count=0,d._view=[],d._fontSize=12,d._txt=null,d._leftText=null,d._sp=null,d._show=!1,d._useCanvas=!1,d._canvas=null,d._ctx=null,d._first=!1,d._vx=NaN,d._width=0,d._height=100,d}(),n=(function(){function U(){this._strsToID={},this._idToStrs=[],this._length=0}x(U,"laya.utils.StringKey");var F=U.prototype;F.add=function(U){var F=this._strsToID[U];return null!=F?F:(this._idToStrs[this._length]=U,this._strsToID[U]=this._length++)},F.getID=function(U){var F=this._strsToID[U];return null==F?-1:F},F.getName=function(U){var F=this._idToStrs[U];return null==F?void 0:F}}(),function(){var a;function U(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}x(U,"laya.utils.Timer");var F=U.prototype;return F._init=function(){f.timer&&f.timer.frameLoop(1,this,this._update)},F._now=function(){return Date.now()},F._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var U=this.currFrame=this.currFrame+this.scale,F=this._now();this._delta=(F-this._lastTimer)*this.scale;var O=this.currTimer=this.currTimer+this._delta;f.isDebug&&6e4<Math.abs(F-this._lastTimer)&&console.error("系统时间错误！"+(F-this._lastTimer)),this._lastTimer=F;var P=this._handlers;for(L=this._count=0,u=P.length;L<u;L++)if(null!==(d=P[L]).method){var Y=d.userFrame?U:O;if(Y>=d.exeTime)if(d.repeat)if(d.jumpFrame)for(;Y>=d.exeTime;)d.exeTime+=d.delay,d.run(!1);else d.exeTime+=d.delay,d.run(!1),Y>d.exeTime&&(d.exeTime+=Math.ceil((Y-d.exeTime)/d.delay)*d.delay);else d.run(!0)}else this._count++;(30<this._count||U%200==0)&&this._clearHandlers();for(var c=this._laters,L=0,u=c.length-1;L<=u;L++){var d=c[L];this._isIgnoreRecover(d)||(null!==d.method&&(delete this._map[d.key],d.run(!1)),this._recoverHandler(d)),L===u&&(u=c.length-1)}c.length=0}},F._clearHandlers=function(){for(var U=this._handlers,F=0,O=U.length;F<O;F++){var P=U[F];null!==P.method?this._temp.push(P):this._isIgnoreRecover(P)?this._temp.push(P):this._recoverHandler(P)}this._handlers=this._temp,this._temp=U,this._temp.length=0},F._recoverHandler=function(U){this._map[U.key]==U&&delete this._map[U.key],U.recover()},F._create=function(U,F,O,P,Y,c,L,u){if(!O)return Y.apply(P,c),null;if(L){var d=this._getHandler(P,Y);if(d)return d.repeat=F,d.userFrame=U,d.delay=O,d.ignoreRecover=u,d.caller=P,d.method=Y,d.args=c,d.exeTime=O+(U?this.currFrame:this.currTimer+this._now()-this._lastTimer),d}return(d=a.create()).repeat=F,d.userFrame=U,d.delay=O,d.ignoreRecover=u,d.caller=P,d.method=Y,d.args=c,d.exeTime=O+(U?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(d),this._handlers.push(d),d},F._indexHandler=function(U){var F=U.caller,O=U.method,P=F?F.$_GID||(F.$_GID=S.getGID()):0,Y=O.$_TID||(O.$_TID=this._mid++);U.key=P+"_"+Y,this._map[U.key]=U},F.once=function(U,F,O,P,Y){void 0===Y&&(Y=!0),this._create(!1,!1,U,F,O,P,Y,!1)},F.loop=function(U,F,O,P,Y,c,L){void 0===Y&&(Y=!0),void 0===c&&(c=!1),void 0===L&&(L=!1);var u=this._create(!1,!0,U,F,O,P,Y,L);u&&(u.jumpFrame=c)},F.frameOnce=function(U,F,O,P,Y){void 0===Y&&(Y=!0),this._create(!0,!1,U,F,O,P,Y,!1)},F.frameLoop=function(U,F,O,P,Y,c){void 0===Y&&(Y=!0),void 0===c&&(c=!1),this._create(!0,!0,U,F,O,P,Y,c)},F.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+a._freeCount},F.clear=function(U,F){var O=this._getHandler(U,F);return!(!O||this._isIgnoreRecover(O))&&(delete this._map[O.key],O.key=null,O.clear(),!0)},F.clearAll=function(U){if(U)for(var F=0,O=this._handlers.length;F<O;F++){var P=this._handlers[F];P.caller===U&&(this._isIgnoreRecover(P)||(delete this._map[P.key],P.key=null,P.clear()))}},F._getHandler=function(U,F){var O=U?U.$_GID||(U.$_GID=S.getGID()):0,P=F.$_TID||(F.$_TID=this._mid++);return this._map[O+"_"+P]},F._isIgnoreRecover=function(U){if(U.ignoreRecover||U.caller&&"IgnoreRecover"==U.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var F="";try{arguments.propertyIsEnumerable.caller}catch(U){F=U.stack}f.recordError("报错：核心定时器销毁忽略  "+F)}return!0}return!1},F.hasHandler=function(U,F){return this._map[U.$_GID+"_"+F.$_TID]},F.callLater=function(U,F,O){if(null==this._getHandler(U,F)){var P=a.create();P.caller=U,P.method=F,P.args=O,this._indexHandler(P),this._laters.push(P)}},F.runCallLater=function(U,F){var O=this._getHandler(U,F);O&&null!=O.method&&(this._isIgnoreRecover(O)||(delete this._map[O.key],O.run(!0)))},F.runTimer=function(U,F){this.runCallLater(U,F)},b(0,F,"delta",function(){return this._delta}),U.__init$=function(){a=function(){function F(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}x(F,"");var U=F.prototype;return U.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},U.recover=function(){this.clear(),this.args=F._freeHandler,F._freeHandler=this,F._freeCount++},U.run=function(U){var F=this.caller;if(F&&F.destroyed)return this.clear();var O=this.method,P=this.args;U&&this.clear(),null!=O&&(P?O.apply(F,P):O.call(F))},F._freeHandler=null,F._freeCount=0,F.create=function(){var U=F._freeHandler;return U?(F._freeHandler=U.args,--F._freeCount,U.args=null,U):new F},F}()},U}()),t=function(){function z(){this.gid=0}x(z,"laya.utils.Tween");var U=z.prototype;return U.to=function(U,F,O,P,Y,c,L){return void 0===c&&(c=0),void 0===L&&(L=!1),this._create(U,F,O,P,Y,c,L,!0,!1,!0)},U.from=function(U,F,O,P,Y,c,L){return void 0===c&&(c=0),void 0===L&&(L=!1),this._create(U,F,O,P,Y,c,L,!1,!1,!0)},U._create=function(U,F,O,P,Y,c,L,u,d,a){if(!U)throw new Error("Tween:target is null");this._target=U,this._duration=O,this._ease=P||F.ease||z.easeNone,this._complete=Y||F.complete,this._delay=c,this._props=[],this._usedTimer=0,this._startTimer=m.now(),this._usedPool=d,this._delayParam=null,this.update=F.update;var b=U.$_GID||(U.$_GID=S.getGID());return z.tweenMap[b]?(L&&z.clearTween(U),z.tweenMap[b].push(this)):z.tweenMap[b]=[this],a?c<=0?this.firstStart(U,F,u):(this._delayParam=[U,F,u],f.scaleTimer.once(c,this,this.firstStart,this._delayParam)):this._initProps(U,F,u),this},U.firstStart=function(U,F,O){this._delayParam=null,U.destroyed?this.clear():(this._initProps(U,F,O),this._beginLoop())},U._initProps=function(U,F,O){for(var P in F)if("number"==typeof U[P]){var Y=O?U[P]:F[P],c=O?F[P]:U[P];this._props.push([P,Y,c-Y]),O||(U[P]=Y)}},U._beginLoop=function(){f.scaleTimer.frameLoop(1,this,this._doEase)},U._doEase=function(){this._updateEase(m.now())},U._updateEase=function(U){var F=this._target;if(F){if(F.destroyed)return z.clearTween(F);var O=this._usedTimer=U-this._startTimer-this._delay;if(!(O<0)){if(O>=this._duration)return this.complete();for(var P=0<O?this._ease(O,0,1,this._duration):0,Y=this._props,c=0,L=Y.length;c<L;c++){var u=Y[c];F[u[0]]=u[1]+P*u[2]}this.update&&this.update.run()}}},U.complete=function(){if(this._target){f.scaleTimer.runTimer(this,this.firstStart);for(var U=this._target,F=this._props,O=this._complete,P=0,Y=F.length;P<Y;P++){var c=F[P];U[c[0]]=c[1]+c[2]}this.update&&this.update.run(),this.clear(),O&&O.run()}},U.pause=function(){f.scaleTimer.clear(this,this._beginLoop),f.scaleTimer.clear(this,this._doEase),f.scaleTimer.clear(this,this.firstStart);var U;(U=m.now()-this._startTimer-this._delay)<0&&(this._usedTimer=U)},U.setStartTime=function(U){this._startTimer=U},U.clear=function(){this._target&&(this._remove(),this._clear())},U._clear=function(){this.pause(),f.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,e.recover("tween",this))},U.recover=function(){this._usedPool=!0,this._clear()},U._remove=function(){var U=z.tweenMap[this._target.$_GID];if(U)for(var F=0,O=U.length;F<O;F++)if(U[F]===this){U.splice(F,1);break}},U.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=m.now(),this._delayParam)f.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var U=this._props,F=0,O=U.length;F<O;F++){var P=U[F];this._target[P[0]]=P[1]}f.scaleTimer.once(this._delay,this,this._beginLoop)}},U.resume=function(){this._usedTimer>=this._duration||(this._startTimer=m.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?f.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},b(0,U,"progress",null,function(U){var F=U*this._duration;this._startTimer=m.now()-this._delay-F}),z.to=function(U,F,O,P,Y,c,L,u){return void 0===c&&(c=0),void 0===L&&(L=!1),void 0===u&&(u=!0),e.getItemByClass("tween",z)._create(U,F,O,P,Y,c,L,!0,u,!0)},z.from=function(U,F,O,P,Y,c,L,u){return void 0===c&&(c=0),void 0===L&&(L=!1),void 0===u&&(u=!0),e.getItemByClass("tween",z)._create(U,F,O,P,Y,c,L,!1,u,!0)},z.clearAll=function(U){if(U&&U.$_GID){var F=z.tweenMap[U.$_GID];if(F){for(var O=0,P=F.length;O<P;O++)F[O]._clear();F.length=0}}},z.clear=function(U){U.clear()},z.clearTween=function(U){z.clearAll(U)},z.easeNone=function(U,F,O,P){return O*U/P+F},z.tweenMap={},z}(),S=function(){function u(){}return x(u,"laya.utils.Utils"),u.toRadian=function(U){return U*u._pi2},u.toAngle=function(U){return U*u._pi},u.toHexColor=function(U){if(U<0||isNaN(U))return null;for(var F=U.toString(16);F.length<6;)F="0"+F;return"#"+F},u.getGID=function(){return u._gid++},u.concatArray=function(U,F){if(!F)return U;if(!U)return F;var O=0,P=F.length;for(O=0;O<P;O++)U.push(F[O]);return U},u.clearArray=function(U){return U&&(U.length=0),U},u.copyArray=function(U,F){if(U||(U=[]),!F)return U;U.length=F.length;var O=0,P=F.length;for(O=0;O<P;O++)U[O]=F[O];return U},u.getGlobalRecByPoints=function(U,F,O,P,Y){var c,L;return c=new I(F,O),c=U.localToGlobal(c),L=new I(P,Y),L=U.localToGlobal(L),T._getWrapRec([c.x,c.y,L.x,L.y])},u.getGlobalPosAndScale=function(U){return u.getGlobalRecByPoints(U,0,0,1,1)},u.bind=function(U,F){return U.bind(F)},u.measureText=function(U,F){return C.measureText(U,F)},u.contextMeasureText=function(U){var F=m.context.measureText(U);return F||(F={width:16,height:16}),F},u.updateOrder=function(U){if(!U||U.length<2)return!1;for(var F,O=1,P=0,Y=U.length,c=NaN;O<Y;){for(F=U[P=O],c=U[P]._zOrder;-1<--P&&U[P]._zOrder>c;)U[P+1]=U[P];U[P+1]=F,O++}var L=F.parent.conchModel;if(L)if(null!=L.updateZOrder)L.updateZOrder();else{for(O=0;O<Y;O++)L.removeChild(U[O].conchModel);for(O=0;O<Y;O++)L.addChildAt(U[O].conchModel,O)}return!0},u.transPointList=function(U,F,O){var P=0,Y=U.length;for(P=0;P<Y;P+=2)U[P]+=F,U[P+1]+=O},u.parseInt=function(U,F){void 0===F&&(F=0);var O=m.window.parseInt(U,F);return isNaN(O)?0:O},u.getFileExtension=function(U){u._extReg.lastIndex=U.lastIndexOf(".");var F=u._extReg.exec(U);return F&&1<F.length?F[1].toLowerCase():null},u.getTransformRelativeToWindow=function(U,F,O){var P=f.stage,Y=laya.utils.Utils.getGlobalPosAndScale(U),c=P._canvasTransform.clone(),L=c.tx,u=c.ty;c.rotate(-Math.PI/180*f.stage.canvasDegree),c.scale(f.stage.clientScaleX,f.stage.clientScaleY);var d=f.stage.canvasDegree%180!=0,a=NaN,b=NaN;d?(a=O+Y.y,b=F+Y.x,a*=c.d,b*=c.a,90==f.stage.canvasDegree?(a=L-a,b+=u):(a+=L,b=u-b)):(a=F+Y.x,b=O+Y.y,a*=c.a,b*=c.d,a+=L,b+=u);var z=NaN,J=NaN;return J=d?(z=c.d*Y.height,c.a*Y.width):(z=c.a*Y.width,c.d*Y.height),{x:a,y:b,scaleX:z,scaleY:J}},u.fitDOMElementInArea=function(U,F,O,P,Y,c){U._fitLayaAirInitialized||(U._fitLayaAirInitialized=!0,U.style.transformOrigin=U.style.webKittransformOrigin="left top",U.style.position="absolute");var L=u.getTransformRelativeToWindow(F,O,P);U.style.transform=U.style.webkitTransform="scale("+L.scaleX+","+L.scaleY+") rotate("+f.stage.canvasDegree+"deg)",U.style.width=Y+"px",U.style.height=c+"px",U.style.left=L.x+"px",U.style.top=L.y+"px"},u.isOkTextureList=function(U){if(!U)return!1;var F,O=0,P=U.length;for(O=0;O<P;O++)if(!(F=U[O])||!F.source)return!1;return!0},u.isOKCmdList=function(U){if(!U)return!1;var F,O,P=0,Y=U.length,c=k._context;for(P=0;P<Y;P++)switch((F=U[P]).callee){case c._drawTexture:case c._fillTexture:case c._drawTextureWithTransform:if(!(O=F[0])||!O.source)return!1}return!0},u._gid=1,u._pi=180/Math.PI,u._pi2=Math.PI/180,u._extReg=/\.(\w+)\??/g,u.parseXMLFromString=function(U){var F;if(U=U.replace(/>\s+</g,"><"),-1<(F=(new DOMParser).parseFromString(U,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(F.firstChild.firstChild.textContent);return F},u}(),W=function(){function U(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],k.isWebGL&&o.regCacheByFunction(S.bind(this.startDispose,this),S.bind(this.getCacheList,this))}x(U,"laya.utils.VectorGraphManager");var F=U.prototype;return F.getId=function(){return this._id++},F.addShape=function(U,F){this.shapeDic[U]=F,this.useDic[U]||(this.useDic[U]=!0)},F.addLine=function(U,F){this.shapeLineDic[U]=F,this.shapeLineDic[U]||(this.shapeLineDic[U]=!0)},F.getShape=function(U){this._checkKey&&null!=this.useDic[U]&&(this.useDic[U]=!0)},F.deleteShape=function(U){this.shapeDic[U]&&(this.shapeDic[U]=null,delete this.shapeDic[U]),this.shapeLineDic[U]&&(this.shapeLineDic[U]=null,delete this.shapeLineDic[U]),null!=this.useDic[U]&&delete this.useDic[U]},F.getCacheList=function(){var U,F=[];for(U in this.shapeDic)F.push(this.shapeDic[U]);for(U in this.shapeLineDic)F.push(this.shapeLineDic[U]);return F},F.startDispose=function(U){var F;for(F in this.useDic)this.useDic[F]=!1;this._checkKey=!0},F.endDispose=function(){if(this._checkKey){var U;for(U in this.useDic)this.useDic[U]||this.deleteShape(U);this._checkKey=!1}},U.getInstance=function(){return U.instance=U.instance||new U},U.instance=null,U}(),B=function(){function P(){this._obj=null,this._obj=P.supportWeakMap?new m.window.WeakMap:{},P.supportWeakMap||P._maps.push(this)}x(P,"laya.utils.WeakObject");var U=P.prototype;return U.set=function(U,F){if(null!=U)if(P.supportWeakMap){var O=U;"string"!=typeof U&&"number"!=typeof U||(O=P._keys[U])||(O=P._keys[U]={k:U}),this._obj.set(O,F)}else"string"==typeof U||"number"==typeof U?this._obj[U]=F:(U.$_GID||(U.$_GID=S.getGID()),this._obj[U.$_GID]=F)},U.get=function(U){if(null==U)return null;if(P.supportWeakMap){var F="string"==typeof U||"number"==typeof U?P._keys[U]:U;return F?this._obj.get(F):null}return"string"==typeof U||"number"==typeof U?this._obj[U]:this._obj[U.$_GID]},U.del=function(U){if(null!=U)if(P.supportWeakMap){var F="string"==typeof U||"number"==typeof U?P._keys[U]:U;if(!F)return;this._obj.delete(F)}else"string"==typeof U||"number"==typeof U?delete this._obj[U]:delete this._obj[this._obj.$_GID]},U.has=function(U){if(null==U)return!1;if(P.supportWeakMap){var F="string"==typeof U||"number"==typeof U?P._keys[U]:U;return this._obj.has(F)}return"string"==typeof U||"number"==typeof U?null!=this._obj[U]:null!=this._obj[this._obj.$_GID]},P.__init__=function(){(P.supportWeakMap=null!=m.window.WeakMap)||f.timer.loop(P.delInterval,null,P.clearCache)},P.clearCache=function(){for(var U=0,F=P._maps.length;U<F;U++){P._maps[U]._obj={}}},P.supportWeakMap=!1,P.delInterval=3e5,P._keys={},P._maps=[],d(P,["I",function(){return this.I=new P}]),P}(),E=function(){function U(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}x(U,"laya.utils.WordText");var F=U.prototype;return F.setText=function(U){this.changed=!0,this._text=U},F.toString=function(){return this._text},F.charCodeAt=function(U){return this._text?this._text.charCodeAt(U):NaN},F.charAt=function(U){return this._text?this._text.charAt(U):null},b(0,F,"length",function(){return this._text?this._text.length:0}),U}(),UU=function(U){function L(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,L.__super.call(this),this._childs=L.ARRAY_EMPTY,this._$P=L.PROP_EMPTY,this.timer=f.scaleTimer,this.conchModel=k.isConchNode?this.createConchModel():null}x(L,"laya.display.Node",a);var F=L.prototype;return F._setBit=function(U,F){1==U&&(this._getBit(U)!=F&&this._updateDisplayedInstage());F?this._bits|=U:this._bits&=~U},F._getBit=function(U){return 0!=(this._bits&U)},F._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},F._setUpNoticeType=function(U){var F=this;for(F._setBit(U,!0),F=F.parent;F;){if(F._getBit(U))return;F._setBit(U,!0),F=F.parent}},F.on=function(U,F,O,P){return"display"!==U&&"undisplay"!==U||this._getBit(1)||this._setUpNoticeType(1),this._createListener(U,F,O,P,!1)},F.once=function(U,F,O,P){return"display"!==U&&"undisplay"!==U||this._getBit(1)||this._setUpNoticeType(1),this._createListener(U,F,O,P,!0)},F.createConchModel=function(){return null},F.destroy=function(U){void 0===U&&(U=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(U?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},F.destroyChildren=function(){if(this._childs)for(var U=this._childs.length-1;-1<U;U--)this._childs[U].destroy(!0)},F.addChild=function(U){if(!U||this.destroyed||U===this)return U;if(U.zOrder&&this._set$P("hasZorder",!0),U._parent===this){var F=this.getChildIndex(U);F!==this._childs.length-1&&(this._childs.splice(F,1),this._childs.push(U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,this._childs.length-1)),this._childChanged())}else U.parent&&U.parent.removeChild(U),this._childs===L.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(U),this.conchModel&&this.conchModel.addChildAt(U.conchModel,this._childs.length-1),(U.parent=this)._childChanged();return U},F.addChildren=function(U){for(var F=arguments,O=0,P=F.length;O<P;)this.addChild(F[O++])},F.addChildAt=function(U,F){if(!U||this.destroyed||U===this)return U;if(U.zOrder&&this._set$P("hasZorder",!0),0<=F&&F<=this._childs.length){if(U._parent===this){var O=this.getChildIndex(U);this._childs.splice(O,1),this._childs.splice(F,0,U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,F)),this._childChanged()}else U.parent&&U.parent.removeChild(U),this._childs===L.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(F,0,U),this.conchModel&&this.conchModel.addChildAt(U.conchModel,F),U.parent=this;return U}throw new Error("appendChildAt:The index is out of bounds")},F.getChildIndex=function(U){return this._childs.indexOf(U)},F.getChildByName=function(U){var F=this._childs;if(F)for(var O=0,P=F.length;O<P;O++){var Y=F[O];if(Y.name===U)return Y}return null},F._get$P=function(U){return this._$P[U]},F._set$P=function(U,F){return this.destroyed||(this._$P===L.PROP_EMPTY&&(this._$P={}),this._$P[U]=F),F},F.getChildAt=function(U){return this._childs[U]},F.setChildIndex=function(U,F){var O=this._childs;if(F<0||F>=O.length)throw new Error("setChildIndex:The index is out of bounds.");var P=this.getChildIndex(U);if(P<0)throw new Error("setChildIndex:node is must child of this object.");return O.splice(P,1),O.splice(F,0,U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,F)),this._childChanged(),U},F._childChanged=function(U){},F.removeChild=function(U){if(!this._childs)return U;var F=this._childs.indexOf(U);return this.removeChildAt(F)},F.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},F.removeChildByName=function(U){var F=this.getChildByName(U);return F&&this.removeChild(F),F},F.removeChildAt=function(U){var F=this.getChildAt(U);if(F){for(var O=this._childs.length-1,P=U;P<O;++P)this._childs[P]=this._childs[P+1];this._childs.length=O,this.conchModel&&this.conchModel.removeChild(F.conchModel),F.parent=null}return F},F.removeChildren=function(U,F){if(void 0===U&&(U=0),void 0===F&&(F=2147483647),this._childs&&0<this._childs.length){var O=this._childs;if(0===U&&c<=F){var P=O;this._childs=L.ARRAY_EMPTY}else P=O.splice(U,F-U);for(var Y=0,c=P.length;Y<c;Y++)P[Y].parent=null,this.conchModel&&this.conchModel.removeChild(P[Y].conchModel)}return this},F.replaceChild=function(U,F){var O=this._childs.indexOf(F);return-1<O?(this._childs.splice(O,1,U),this.conchModel&&(this.conchModel.removeChild(F.conchModel),this.conchModel.addChildAt(U.conchModel,O)),F.parent=null,U.parent=this,U):null},F._updateDisplayedInstage=function(){var U;U=this;var F=f.stage;for(this._displayedInStage=!1;U;){if(U._getBit(1)){this._displayedInStage=U._displayedInStage;break}if(U==F||U._displayedInStage){this._displayedInStage=!0;break}U=U.parent}},F._setDisplay=function(U){this._displayedInStage!==U&&((this._displayedInStage=U)?this.event("display"):this.event("undisplay"))},F._displayChild=function(U,F){var O=U._childs;if(O)for(var P=0;P<O.length;P++){var Y=O[P];Y&&Y._getBit(1)&&(0<Y._childs.length?this._displayChild(Y,F):Y._setDisplay(F))}U._setDisplay(F)},F.contains=function(U){if(U===this)return!0;for(;U;){if(U.parent===this)return!0;U=U.parent}return!1},F.timerLoop=function(U,F,O,P,Y,c){void 0===Y&&(Y=!0),void 0===c&&(c=!1),this.timer.loop(U,F,O,P,Y,c)},F.timerOnce=function(U,F,O,P,Y){void 0===Y&&(Y=!0),this.timer._create(!1,!1,U,F,O,P,Y)},F.frameLoop=function(U,F,O,P,Y){void 0===Y&&(Y=!0),this.timer._create(!0,!0,U,F,O,P,Y)},F.frameOnce=function(U,F,O,P,Y){void 0===Y&&(Y=!0),this.timer._create(!0,!1,U,F,O,P,Y)},F.clearTimer=function(U,F){this.timer.clear(U,F)},b(0,F,"numChildren",function(){return this._childs.length}),b(0,F,"destroyed",function(){return this._destroyed}),b(0,F,"parent",function(){return this._parent},function(U){this._parent!==U&&(U?(this._parent=U,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),U.displayedInStage&&this._displayChild(this,!0)),U._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=U))}),b(0,F,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),L.ARRAY_EMPTY=[],L.PROP_EMPTY={},L.NOTICE_DISPLAY=1,L.MOUSEENABLE=2,L}(),FU=function(U){function J(U){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,J.__super.call(this),this._padding=J._PADDING,this._spacing=J._SPACING,this._aligns=J._ALIGNS,this._font=w.EMPTY,this._ower=U}x(J,"laya.display.css.CSSStyle",U);var F=J.prototype;return F.destroy=function(){this._ower=null,this._font=null,this._rect=null},F.inherit=function(U){this._font=U._font,this._spacing=U._spacing===J._SPACING?J._SPACING:U._spacing.slice(),this.lineHeight=U.lineHeight},F._widthAuto=function(){return 0!=(262144&this._type)},F.widthed=function(U){return 0!=(8&this._type)},F._calculation=function(U,F){if(F.indexOf("%")<0)return!1;var P=this._ower,Y=P.parent,c=this._rect;function L(U,F,O){return U*O[0]+F*O[1]+O[2]}function O(U){var F=Y.width,O=P.width;c.width&&(P.width=L(F,O,c.width)),c.height&&(P.height=L(F,O,c.height)),c.left&&(P.x=L(F,O,c.left)),c.top&&(P.y=L(F,O,c.top))}null===c&&(Y._getCSSStyle()._type|=524288,Y.on("resize",this,O),this._rect=c={input:{}});var u=F.split(" ");return u[0]=parseFloat(u[0])/100,1==u.length?u[1]=u[2]=0:(u[1]=parseFloat(u[1])/100,u[2]=parseFloat(u[2])),c[U]=u,c.input[U]=F,O(),!0},F.heighted=function(U){return 0!=(8192&this._type)},F.size=function(U,F){var O=this._ower,P=!1;-1!==U&&U!=this._ower.width&&(this._type|=8,this._ower.width=U,P=!0),-1!==F&&F!=this._ower.height&&(this._type|=8192,this._ower.height=F,P=!0),P&&(O._layoutLater(),524288&this._type&&O.event("resize",this))},F._getAlign=function(){return this._aligns[0]},F._getValign=function(){return this._aligns[1]},F._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},F._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new w(this._font))},F.render=function(U,F,O,P){var Y=U.width,c=U.height;O-=U.pivotX,P-=U.pivotY,this._bgground&&null!=this._bgground.color&&F.ctx.fillRect(O,P,Y,c,this._bgground.color),this._border&&this._border.color&&F.drawRect(O,P,Y,c,this._border.color.strColor,this._border.size)},F.getCSSStyle=function(){return this},F.cssText=function(U){this.attrs(J.parseOneCSS(U,";"))},F.attrs=function(U){if(U)for(var F=0,O=U.length;F<O;F++){var P=U[F];this[P[0]]=P[1]}},F.setTransform=function(U){"none"===U?this._tf=u._TF_EMPTY:this.attrs(J.parseOneCSS(U,","))},F.translate=function(U,F){this._tf===u._TF_EMPTY&&(this._tf=new Y),this._tf.translateX=U,this._tf.translateY=F},F.scale=function(U,F){this._tf===u._TF_EMPTY&&(this._tf=new Y),this._tf.scaleX=U,this._tf.scaleY=F},F._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},b(0,F,"block",U.prototype._$get_block,function(U){U?this._type|=1:this._type&=-2}),b(0,F,"valign",function(){return J._valigndef[this._aligns[1]]},function(U){this._aligns===J._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=J._valigndef[U]}),b(0,F,"height",null,function(U){if(this._type|=8192,"string"==typeof U){if(this._calculation("height",U))return;U=parseInt(U)}this.size(-1,U)}),b(0,F,"width",null,function(U){if(this._type|=8,"string"==typeof U){var F=U.indexOf("auto");if(0<=F&&(this._type|=262144,U=U.substr(0,F)),this._calculation("width",U))return;U=parseInt(U)}this.size(U,-1)}),b(0,F,"fontWeight",function(){return this._font.weight},function(U){this._createFont().weight=U}),b(0,F,"left",null,function(U){var F=this._ower;if("string"==typeof U){if("center"===U?U="50% -50% 0":"right"===U&&(U="100% -100% 0"),this._calculation("left",U))return;U=parseInt(U)}F.x=U}),b(0,F,"_translate",null,function(U){this.translate(U[0],U[1])}),b(0,F,"absolute",function(){return 0!=(4&this._type)}),b(0,F,"top",null,function(U){var F=this._ower;if("string"==typeof U){if("middle"===U?U="50% -50% 0":"bottom"===U&&(U="100% -100% 0"),this._calculation("top",U))return;U=parseInt(U)}F.y=U}),b(0,F,"align",function(){return J._aligndef[this._aligns[0]]},function(U){this._aligns===J._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=J._aligndef[U]}),b(0,F,"bold",function(){return this._font.bold},function(U){this._createFont().bold=U}),b(0,F,"padding",function(){return this._padding},function(U){this._padding=U}),b(0,F,"leading",function(){return this._spacing[1]},function(U){"string"==typeof U&&(U=parseInt(U+"")),this._spacing===J._SPACING&&(this._spacing=[0,0]),this._spacing[1]=U}),b(0,F,"lineElement",function(){return 0!=(65536&this._type)},function(U){U?this._type|=65536:this._type&=-65537}),b(0,F,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(U){this.lineElement=!1,"right"===U?this._type|=32768:this._type&=-32769}),b(0,F,"textDecoration",function(){return this._font.decoration},function(U){this._createFont().decoration=U}),b(0,F,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(U){"nowrap"===U&&(this._type|=131072),"none"===U&&(this._type&=-131073)}),b(0,F,"background",null,function(U){U?(this._bgground||(this._bgground={}),this._bgground.color=U,this._ower.conchModel&&this._ower.conchModel.bgColor(U),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),b(0,F,"wordWrap",function(){return 0==(131072&this._type)},function(U){U?this._type&=-131073:this._type|=131072}),b(0,F,"color",function(){return this._font.color},function(U){this._createFont().color=U}),b(0,F,"password",function(){return this._font.password},function(U){this._createFont().password=U}),b(0,F,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(U){"none"===U?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=U),this._ower.conchModel&&this._ower.conchModel.bgColor(U),this._ower._renderType|=256}),b(0,F,"font",function(){return this._font.toString()},function(U){this._createFont().set(U)}),b(0,F,"weight",null,function(U){this._createFont().weight=U}),b(0,F,"letterSpacing",function(){return this._spacing[0]},function(U){"string"==typeof U&&(U=parseInt(U+"")),this._spacing===J._SPACING&&(this._spacing=[0,0]),this._spacing[0]=U}),b(0,F,"fontSize",function(){return this._font.size},function(U){this._createFont().size=U}),b(0,F,"italic",function(){return this._font.italic},function(U){this._createFont().italic=U}),b(0,F,"fontFamily",function(){return this._font.family},function(U){this._createFont().family=U}),b(0,F,"stroke",function(){return this._font.stroke[0]},function(U){this._createFont().stroke===w._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=U}),b(0,F,"strokeColor",function(){return this._font.stroke[1]},function(U){this._createFont().stroke===w._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=U}),b(0,F,"border",function(){return this._border?this._border.value:""},function(U){if("none"!=U){this._border||(this._border={});var F=(this._border.value=U).split(" ");if(this._border.color=_.create(F[F.length-1]),1==F.length)return this._border.size=1,void(this._border.type="solid");var O=0;0<F[0].indexOf("px")?(this._border.size=parseInt(F[0]),O++):this._border.size=1,this._border.type=F[O],this._ower._renderType|=256}else this._border=null}),b(0,F,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(U){U?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==U?null:_.create(U),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),b(0,F,"position",function(){return 4&this._type?"absolute":""},function(U){"absolute"==U?this._type|=4:this._type&=-5}),b(0,F,"display",null,function(U){switch(U){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),b(0,F,"paddingLeft",function(){return this.padding[3]}),b(0,F,"paddingTop",function(){return this.padding[0]}),b(0,F,"_scale",null,function(U){this._ower.scale(U[0],U[1])}),b(0,F,"_rotate",null,function(U){this._ower.rotation=U}),J.parseOneCSS=function(U,F){for(var O,P=[],Y=U.split(F),c=0,L=Y.length;c<L;c++){var u=Y[c],d=u.indexOf(":"),a=u.substr(0,d).replace(/^\s+|\s+$/g,"");if(0!=a.length){var b=u.substr(d+1).replace(/^\s+|\s+$/g,""),z=[a,b];switch(a){case"italic":case"bold":z[1]="true"==b;break;case"line-height":z[0]="lineHeight",z[1]=parseInt(b);break;case"font-size":z[0]="fontSize",z[1]=parseInt(b);break;case"padding":1<(O=b.split(" ")).length||(O[1]=O[2]=O[3]=O[0]),z[1]=[parseInt(O[0]),parseInt(O[1]),parseInt(O[2]),parseInt(O[3])];break;case"rotate":z[0]="_rotate",z[1]=parseFloat(b);break;case"scale":O=b.split(" "),z[0]="_scale",z[1]=[parseFloat(O[0]),parseFloat(O[1])];break;case"translate":O=b.split(" "),z[0]="_translate",z[1]=[parseInt(O[0]),parseInt(O[1])];break;default:(z[0]=J._CSSTOVALUE[a])||(z[0]=a)}P.push(z)}}return P},J.parseCSS=function(U,F){for(var O;null!=(O=J._parseCSSRegExp.exec(U));)J.styleSheets[O[1]]=J.parseOneCSS(O[2],";")},J.EMPTY=new J(null),J._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},J._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),J._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},J._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},J.styleSheets={},J.ALIGN_CENTER=1,J.ALIGN_RIGHT=2,J.VALIGN_MIDDLE=1,J.VALIGN_BOTTOM=2,J._CSS_BLOCK=1,J._DISPLAY_NONE=2,J._ABSOLUTE=4,J._WIDTH_SET=8,J._PADDING=[0,0,0,0],J._RECT=[-1,-1,-1,-1],J._SPACING=[0,0],J._ALIGNS=[0,0,0],J.ADDLAYOUTED=512,J._NEWFONT=4096,J._HEIGHT_SET=8192,J._BACKGROUND_SET=16384,J._FLOAT_RIGHT=32768,J._LINE_ELEMENT=65536,J._NOWARP=131072,J._WIDTHAUTO=262144,J._LISTERRESZIE=524288,J}(u),OU=function(U){function L(){this.url=null,this.audio=null,this.loaded=!1,L.__super.call(this)}x(L,"laya.media.h5audio.AudioSound",a);var F=L.prototype;return F.dispose=function(){var U=L._audioCache[this.url];U&&(U.src="",delete L._audioCache[this.url])},F.load=function(U){var F;if(U=y.formatURL(U),(this.url=U)==$._tMusic?(L._initMusicAudio(),(F=L._musicAudio).src!=U&&(L._audioCache[F.src]=null,F=null)):F=L._audioCache[U],F&&2<=F.readyState)this.event("complete");else{F||(F=U==$._tMusic?(L._initMusicAudio(),L._musicAudio):m.createElement("audio"),(L._audioCache[U]=F).src=U),F.addEventListener("canplaythrough",P),F.addEventListener("error",Y);var O=this;(this.audio=F).load?F.load():Y()}function P(){c(),O.loaded=!0,O.event("complete")}function Y(){F.load=null,c(),O.event("error")}function c(){F.removeEventListener("canplaythrough",P),F.removeEventListener("error",Y)}},F.play=function(U,F,O){if(void 0===U&&(U=0),void 0===F&&(F=0),!this.url)return null;var P,Y;if(!(P=this.url==$._tMusic?L._musicAudio:L._audioCache[this.url]))return null;Y=e.getItem("audio:"+this.url),k.isConchApp?Y||((Y=m.createElement("audio")).src=this.url):this.url==$._tMusic?(L._initMusicAudio(),(Y=L._musicAudio).src=this.url):Y=Y||P.cloneNode(!0);var c=new JU(Y);return c.url=this.url,c.loops=F,c.startTime=U,c.startHandler=O,c.play(!1),$.addChannel(c),c},b(0,F,"duration",function(){var U;return(U=L._audioCache[this.url])?U.duration:0}),L._initMusicAudio=function(){L._musicAudio||(L._musicAudio||(L._musicAudio=m.createElement("audio")),k.isConchApp||m.document.addEventListener("mousedown",L._makeMusicOK))},L._makeMusicOK=function(){m.document.removeEventListener("mousedown",L._makeMusicOK),L._musicAudio.src?L._musicAudio.play():(L._musicAudio.src="",L._musicAudio.load())},L._audioCache={},L._musicAudio=null,L}(),PU=function(U){function F(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,F.__super.call(this)}x(F,"laya.media.SoundChannel",a);var O=F.prototype;return O.play=function(){},O.stop=function(){},O.pause=function(){},O.resume=function(){},O.__runComplete=function(U){U&&U.run()},b(0,O,"volume",function(){return 1},function(U){}),b(0,O,"position",function(){return 0}),b(0,O,"duration",function(){return 0}),F}(),YU=function(U){function F(){F.__super.call(this)}x(F,"laya.media.Sound",a);var O=F.prototype;return O.load=function(U){},O.play=function(U,F,O){return void 0===U&&(U=0),void 0===F&&(F=0),null},O.dispose=function(){},b(0,O,"duration",function(){return 0}),F}(),cU=function(U){function Y(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,Y.__super.call(this)}x(Y,"laya.media.webaudio.WebAudioSound",a);var F=Y.prototype;return F.load=function(U){this.url=U,this.audioBuffer=Y._dataCache[U],this.audioBuffer?this._loaded(this.audioBuffer):(Y.e.on("loaded:"+U,this,this._loaded),Y.e.on("err:"+U,this,this._err),Y.__loadingSound[U]||(Y.__loadingSound[U]=!0,f.loader.load(U,h.create(this,this.onloaded),null,uU.BUFFER,4,!1,null,!0)))},F.onloaded=function(U){U||this._err(),this._disposed?this._removeLoadEvents():(this.data=U,Y.buffs.push({buffer:this.data,url:this.url}),Y.decode())},F._err=function(){if(this._removeLoadEvents(),Y.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var U,F,O,P=0;for(U=(F=this.__toPlays).length,P=0;P<U;P++)(O=F[P])[3]&&!O[3].isStopped&&O[3].event("error");this.__toPlays.length=0}},F._loaded=function(U){this._removeLoadEvents(),this._disposed||(this.audioBuffer=U,this.loaded=!0,this.event("complete"))},F._removeLoadEvents=function(){Y.e.off("loaded:"+this.url,this,this._loaded),Y.e.off("err:"+this.url,this,this._err)},F.__playAfterLoaded=function(){if(this.__toPlays){var U,F,O,P=0;for(U=(F=this.__toPlays).length,P=0;P<U;P++)(O=F[P])[3]&&!O[3].isStopped&&this.play(O[0],O[1],O[2],O[3]);this.__toPlays.length=0}},F.play=function(U,F,O,P){return void 0===U&&(U=0),void 0===F&&(F=0),P=P||new wU,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([U,F,O,P]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),P.url=this.url,P.loops=F,P.audioBuffer=this.audioBuffer,P.startTime=U,P.startHandler=O,P.play(!1),$.addChannel(P),P},F.dispose=function(){this._disposed=!0,delete Y._dataCache[this.url],delete Y.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},b(0,F,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),Y.decode=function(){if(!(Y.buffs.length<=0||Y.isDecoding))if(Y.isDecoding=!0,(Y.tInfo=Y.buffs.shift())&&Y.tInfo.buffer&&Y.tInfo.buffer.byteLength)try{Y.ctx.decodeAudioData(Y.tInfo.buffer,Y._done,Y._fail)}catch(U){console.error("decodeAudioData error  byteLength:"+Y.tInfo.buffer.byteLength+"  url:"+Y.tInfo.url)}else Y._fail()},Y._done=function(U){Y.e.event("loaded:"+Y.tInfo.url,U),Y._dataCache[Y.tInfo.url]=U,Y.isDecoding=!1,Y.decode()},Y._fail=function(){Y.e.event("err:"+Y.tInfo.url,null),Y.isDecoding=!1,Y.decode()},Y._playEmptySound=function(){if(null!=Y.ctx){if(Y._emptySource&&(Y._emptySource.stop(),Y._emptySource.disconnect(0),!wU._tryCleanFailed))try{Y._emptySource.buffer=null}catch(U){wU._tryCleanFailed=!0}var U=Y.ctx.createBufferSource();U.buffer=Y._miniBuffer,U.connect(Y.ctx.destination),U.start(0,0,0),Y._emptySource=U}},Y._unlock=function(){Y._unlocked||(Y._playEmptySound(),"running"==Y.ctx.state?(m.document.removeEventListener("mousedown",Y._unlock,!0),m.document.removeEventListener("touchend",Y._unlock,!0),m.document.removeEventListener("touchstart",Y._unlock,!0),Y._unlocked=!0):"suspended"==Y.ctx.state&&$._recoverWebAudio())},Y.initWebAudio=function(){"running"!=Y.ctx.state&&(Y._unlock(),m.document.addEventListener("mousedown",Y._unlock,!0),m.document.addEventListener("touchend",Y._unlock,!0),m.document.addEventListener("touchstart",Y._unlock,!0))},Y._emptySource=null,Y._dataCache={},Y.buffs=[],Y.isDecoding=!1,Y._unlocked=!1,Y.tInfo=null,Y.__loadingSound={},d(Y,["window",function(){return this.window=m.window},"webAudioEnabled",function(){return this.webAudioEnabled=Y.window.AudioContext||Y.window.webkitAudioContext||Y.window.mozAudioContext},"ctx",function(){return this.ctx=Y.webAudioEnabled?new(Y.window.AudioContext||Y.window.webkitAudioContext||Y.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=Y.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new a}]),Y}(),LU=function(U){function F(){this._responseType=null,this._data=null,F.__super.call(this),this._http=new m.window.XMLHttpRequest}x(F,"laya.net.HttpRequest",a);var O=F.prototype;return O.send=function(U,F,O,P,Y){void 0===O&&(O="get"),void 0===P&&(P="text"),this._responseType=P,this._data=null;var c=this,L=this._http;if(L.open(O,U,!0),Y)for(var u=0;u<Y.length;u++)L.setRequestHeader(Y[u++],Y[u]);else k.isConchApp||(F&&"string"!=typeof F?L.setRequestHeader("Content-Type","application/json"):L.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));L.responseType="arraybuffer"!==P?"text":"arraybuffer",L.onerror=function(U){c._onError(U)},L.onabort=function(U){c._onAbort(U)},L.onprogress=function(U){c._onProgress(U)},L.onload=function(U){c._onLoad(U)},L.send(F)},O._onProgress=function(U){U&&U.lengthComputable&&this.event("progress",U.loaded/U.total)},O._onAbort=function(U){this.error("Request was aborted by user")},O._onError=function(U){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},O._onLoad=function(U){var F=this._http,O=void 0!==F.status?F.status:200;200===O||204===O||0===O?this.complete():this.error("["+F.status+"]"+F.statusText+":"+F.responseURL)},O.error=function(U){this.clear(),this.event("error",U)},O.complete=function(){this.clear();var F=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=S.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(U){F=!1,this.error(U.message)}F&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},O.clear=function(){var U=this._http;U.onerror=U.onabort=U.onprogress=U.onload=null},b(0,O,"url",function(){return this._http.responseURL}),b(0,O,"http",function(){return this._http}),b(0,O,"data",function(){return this._data}),F}(),uU=function(U){function g(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,g.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}x(g,"laya.net.Loader",a);var F=g.prototype;return F.load=function(U,F,O,P,Y){if(U&&""!=U||console.error("Loader 加载的url不合法 "+U),void 0===O&&(O=!0),void 0===Y&&(Y=!1),this._url=U,this._base64=!1,0===U.indexOf("data:image")?(this._base64=!0,this._type=F="image"):this._type=F||(F=this.getTypeFromUrl(U)),this._cache=O,this._data=null,!Y&&g.loadedMap[U])return this._data=g.loadedMap[U],this.event("progress",1),void this.event("complete",this._data);if(P&&g.setGroup(U,P),null!=g.parserMap[F])return this._customParse=!0,void(g.parserMap[F]instanceof laya.utils.Handler?g.parserMap[F].runWith(this):g.parserMap[F].call(null,this));if("image"===F||"htmlimage"===F||"nativeimage"===F)return this._loadImage(U);if("ttf"===F)return this._loadTTF(U);switch(F){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:F}g.preLoadedMap[U]?this.onLoaded(g.preLoadedMap[U]):L.resMgrLoad(U,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},F.getTypeFromUrl=function(U){var F=S.getFileExtension(U);return F?g.typeMap[F]:(console.warn("Not recognize the resources suffix",U),"text")},F._loadTTF=function(U){U=y.formatURL(U);var F=new i;F.complete=h.create(this,this.onLoaded),F.load(U)},F._loadBase64Image=function(F){F=y.formatURL(F);var O,U=this;function P(){O.onload=null,O.onerror=null,delete g.imgCache[F]}function Y(){P(),U.onLoaded(O)}function c(){P(),U.event("error","Load image failed")}"nativeimage"===this._type?((O=new m.window.Image).crossOrigin="",O.onload=Y,O.onerror=c,O.src=F,g.imgCache[F]=O):new KU.create(F,{onload:Y,onerror:c,onCreate:function(U){O=U,g.imgCache[F]=U}})},F._loadImage=function(U){this._base64?this._loadBase64Image(U):L.imgMgrLoad(U,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},F._loadImageComplete=function(U,F,O){if(null!=O)if(O instanceof ArrayBuffer){var P=new DataView(O),Y=new laya.webgl.resource.WebGLImage(new Uint8Array(O,8),U,0,!1,P.getUint32(0),P.getUint32(4));this.onLoaded(Y)}else if(O instanceof bU)g.imgMgrSet[U]=F,L.imgMgrLock(U,g.imgMgrSet[U]),this._url=U,this.complete(O);else{var c=-1!=U.indexOf(".png",U.length-4)?6408:6407;Y=new laya.webgl.resource.WebGLImage(O,U,c,!1,O.width,O.height);this.onLoaded(Y)}else this.event("error","Load image failed")},F.imageCancel=function(U,F,O){L.imgMgrCancel&&L.imgMgrCancel(U,this._onImageCallback)},F._loadSound=function(U){var F=new $._soundClass,O=this;function P(){F.offAll()}F.on("complete",this,function(){P(),O.onLoaded(F)}),F.on("error",this,function(){P(),F.dispose(),O.event("error","Load sound failed")}),F.load(U)},F.onProgress=function(U){"atlas"===this._type?this.event("progress",.3*U):this.event("progress",U)},F.onError=function(U){this.event("error",U)},F._loadedComplete=function(U,F,O){if(null!=O)switch(this._type){case"atlas":case"plf":case"json":var P=new p(O);this.onLoaded(JSON.parse(P.readUTFBytes()));break;case"font":P=new p(O);this.onLoaded(S.parseXMLFromString(P.readUTFBytes()));break;default:this.onLoaded(O)}else this.event("error",U)},F.onLoaded=function(U){var F=this._type;if("plf"==F)this.parsePLFData(U),this.complete(U);else if("image"===F){var O=new bU(U);O.url=this._url,this.complete(O)}else if("sound"===F||"htmlimage"===F||"nativeimage"===F)this.complete(U);else if("atlas"===F){if(!U.src&&!U._setContext){if(!this._data){if((this._data=U).meta&&U.meta.image)for(var P=U.meta.image.split(","),Y=0<=this._url.indexOf("/")?"/":"\\",c=this._url.lastIndexOf(Y),L=0<=c?this._url.substr(0,c+1):"",u=0,d=P.length;u<d;u++)P[u]=L+P[u];else P=[this._url.replace(".json",".png")];P.reverse(),U.toLoads=P,U.pics=[]}return this.event("progress",.3+1/P.length*.6),this._loadImage(P.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(U),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var a=this._data.frames,b=this._url.split("?")[0],z=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:b.substring(0,b.lastIndexOf("."))+"/",J=this._data.pics,w=y.formatURL(this._url),j=g.atlasMap[w]||(g.atlasMap[w]=[]);j.dir=z;var x=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var r in x=parseFloat(this._data.meta.scale),a){var H,h=a[r],Q=J[h.frame.idx?h.frame.idx:0],X=y.formatURL(z+r);Q.scaleRate=x,H=bU.create(Q,h.frame.x,h.frame.y,h.frame.w,h.frame.h,h.spriteSourceSize.x,h.spriteSourceSize.y,h.sourceSize.w,h.sourceSize.h),g.cacheRes(X,H),g.keepCache(this._url,z+r),H.url=X,j.push(X)}else for(r in a)Q=J[(h=a[r]).frame.idx?h.frame.idx:0],X=y.formatURL(z+r),g.cacheRes(X,bU.create(Q,h.frame.x,h.frame.y,h.frame.w,h.frame.h,h.spriteSourceSize.x,h.spriteSourceSize.y,h.sourceSize.w,h.sourceSize.h)),g.loadedMap[X].url=X,g.keepCache(this._url,z+r),j.push(X);delete this._data.pics,this.complete(this._data)}else if("font"==F){if(!U.src)return this._data=U,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var N=new l;N.parseFont(this._data,U);var K=this._url.split(".fnt")[0].split("/"),f=K[K.length-1];rU.registerBitmapFont(f,N),this._data=N,this.complete(this._data)}else if("pkm"==F){var I=KU.create(U,this._url),T=new bU(I);T.url=this._url,this.complete(T)}else this.complete(U)},F.parsePLFData=function(U){var F,O,P;for(F in U)switch(P=U[F],F){case"json":case"text":for(O in P)g.preLoadedMap[y.formatURL(O)]=P[O];break;default:for(O in P)g.preLoadedMap[y.formatURL(O)]=P[O]}},F.complete=function(U){this._data=U,this._customParse?this.event("loaded",U instanceof Array?[U]:U):(g._loaders.push(this),g._isWorking||g.checkNext())},F.endLoad=function(U){U&&(this._data=U),this._cache&&g.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},b(0,F,"url",function(){return this._url}),b(0,F,"data",function(){return this._data}),b(0,F,"cache",function(){return this._cache}),b(0,F,"type",function(){return this._type}),g.checkNext=function(){g._isWorking=!0;for(var U=m.now();g._startIndex<g._loaders.length;)if(m.now(),g._loaders[g._startIndex].endLoad(),g._startIndex++,m.now()-U>g.maxTimeOut)return console.warn("loader callback cost a long time:"+(m.now()-U)+" url="+g._loaders[g._startIndex-1].url),void f.timer.frameOnce(1,null,g.checkNext);g._loaders.length=0,g._startIndex=0,g._isWorking=!1},g.clearRes=function(U,F){if(null!=U){void 0===F&&(F=!1),U=y.formatURL(U);var O=g.getAtlas(U);if(O){for(var P=0,Y=O.length;P<Y;P++){var c=O[P],L=g.getRes(c);delete g.loadedMap[c],g.clearCache(U.substring(y.basePath.length),c.substring(y.basePath.length)),L&&L.destroy(F)}O.length=0,delete g.atlasMap[U],delete g.loadedMap[U]}else{var u=g.loadedMap[U];u&&(delete g.loadedMap[U],u instanceof laya.resource.Texture&&u.bitmap&&u.destroy(F))}}},g.clearTextureRes=function(U){U=y.formatURL(U);var F=laya.net.Loader.getAtlas(U),O=F&&0<F.length?laya.net.Loader.getRes(F[0]):laya.net.Loader.getRes(U);O&&O.bitmap&&(k.isConchApp&&!k.isConchWebGL?O.bitmap.source.releaseTexture&&O.bitmap.source.releaseTexture():null==O.bitmap._atlaser&&O.bitmap.releaseResource(!0))},g.getRes=function(U){return g.loadedMap[y.formatURL(U)]},g.getAtlas=function(U){return g.atlasMap[y.formatURL(U)]},g.cacheRes=function(U,F){U=y.formatURL(U),null!=g.loadedMap[U]?console.warn("Resources already exist,is repeated loading:",U):g.loadedMap[U]=F},g.setGroup=function(U,F){g.groupMap[F]||(g.groupMap[F]=[]),g.groupMap[F].push(U)},g.clearResByGroup=function(U){if(g.groupMap[U]){var F=g.groupMap[U],O=0,P=F.length;for(O=0;O<P;O++)g.clearRes(F[O]);F.length=0}},g.keepCache=function(U,F){if(U&&F){var O=g.cacheSet[F];O?-1==O.indexOf(U)&&O.push(U):g.cacheSet[F]=[U]}},g.clearCache=function(U,F){if(U&&F){var O=g.cacheSet[F];if(O){var P=O.indexOf(U);if(-1!==P){var Y=O.length-1;0==Y?(delete g.cacheSet[F],0<g.imgMgrSet[F]?L.imgMgrFree(F,g.imgMgrSet[F]):g.clearRes(F,!0)):(O[P]=O[Y],O.length=Y)}}}},g.saveObject=function(U,F,O){if(F&&U){var P=g.objectSet[U];P?(console.warn("Loader.saveObject: "+U),P[0]=F,P[1]=O):g.objectSet[U]=[F,O,[]]}},g.findObject=function(U){if(U){var F=g.objectSet[U];if(F)return F[0]}return null},g.keepObject=function(U,F){if(U&&F){var O=g.objectSet[F];O&&-1===O[2].indexOf(U)&&O[2].push(U)}},g.clearObject=function(U,F){if(U&&F){var O=g.objectSet[F];if(O){var P=O[2],Y=P.indexOf(U);if(-1!==Y){var c=P.length-1;0==c?(delete g.objectSet[F],O[1]&&O[1].call(null,O[0])):(P[Y]=P[c],P.length=c)}}}},g.TEXT="text",g.JSON="json",g.XML="xml",g.BUFFER="arraybuffer",g.IMAGE="image",g.SOUND="sound",g.ATLAS="atlas",g.FONT="font",g.TTF="ttf",g.PLF="plf",g.PKM="pkm",g.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},g.parserMap={},g.groupMap={},g.maxTimeOut=100,g.loadedMap={},g.preLoadedMap={},g.atlasMap={},g._loaders=[],g._isWorking=!1,g._startIndex=0,g.imgCache={},g.cacheSet={},g.objectSet={},g.imgMgrSet={},g}(),dU=function(U){var J;function w(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},w.__super.call(this);for(var U=0;U<this._maxPriority;U++)this._resInfos[U]=[]}x(w,"laya.net.LoaderManager",a);var F=w.prototype;return F.create=function(U,O,F,P,Y,c,L,u){if(null==c&&(c=2),null==L&&(L=!0),U instanceof Array){var d=U,a=d.length,b=0;if(F)var z=h.create(F.caller,F.method,F.args,!1);for(var J=0;J<a;J++){var w=d[J];"string"==typeof w&&(w=d[J]={url:w}),w.progress=0}for(J=0;J<a;J++){w=d[J];var j=F?h.create(null,H,[w],!1):null,x=F||O?h.create(null,r,[w]):null;this._create(w.url,x,j,w.clas||P,w.params||Y,null!=w.priority&&0<=w.priority?w.priority:c,L,w.group||u)}function r(U,F){b++,U.progress=1,b===a&&O&&O.run()}function H(U,F){U.progress=F;for(var O=0,P=0;P<a;P++){O+=d[P].progress}var Y=O/a;z.runWith(Y)}return!0}return this._create(U,O,F,P,Y,c,L,u)},F._create=function(F,O,U,P,Y,c,L,u){F&&""!=F||console.error("加载的url不合法 "+F),null==c&&(c=2),null==L&&(L=!0);var d=y.formatURL(F),a=this.getRes(d);if(a)!a.hasOwnProperty("loaded")||a.loaded?(U&&U.runWith(1),O&&O.run()):O&&f.loader._createListener(F,O.caller,O.method,O.args,!0,!1);else{var b=S.getFileExtension(F),z=w.createMap[b];if(!z)throw new Error("LoaderManager:unknown file("+F+") extension with: "+b+".");P||(P=z[0]);var J=z[1];if("atlas"==b)this.load(F,O,U,J,c,L);else{P===bU&&(J="htmlimage"),(a=P?new P:null).hasOwnProperty("_loaded")&&(a._loaded=!1),a._setUrl(F),u&&a._setGroup(u),this._createLoad(a,F,h.create(null,function(U){a&&!a.destroyed&&U&&a.onAsynLoaded.call(a,F,U,Y),O&&O.run();f.loader.event(F)}),U,J,c,!1,u,!0),L&&this.cacheRes(d,a)}}return a},F.load=function(U,F,O,P,Y,c,L,u){U&&""!=U||console.error("加载的url不合法 "+U);var d=this;if(null==Y&&(Y=2),null==c&&(c=!0),void 0===u&&(u=!1),U instanceof Array)return this._loadAssets(U,F,O,P,Y,c,L);var a=uU.getRes(U);if(null!=a)f.timer.frameOnce(1,null,function(){O&&O.runWith(1),F&&F.runWith(a),d._loaderCount||d.event("complete")});else{var b=w._resMap[U];b?(F&&b._createListener("complete",F.caller,F.method,F.args,!1,!1),O&&b._createListener("progress",O.caller,O.method,O.args,!1,!1)):((b=this._infoPool.length?this._infoPool.pop():new J).url=U,b.clas=null,b.type=P,b.cache=c,b.group=L,b.ignoreCache=u,b.priority=Y,F&&b.on("complete",F.caller,F.method,F.args),O&&b.on("progress",O.caller,O.method,O.args),w._resMap[U]=b,Y=Y<this._maxPriority?0<=Y?Y:0:this._maxPriority-1,this._resInfos[Y].push(b),this._next())}return this},F.cancel=function(U,F,O){if(a=w._resMap[U]){F&&a.off("complete",F.caller,F.method,!1),O&&a.off("progress",O.caller,O.method,!1);var P=a.getListener("complete"),Y=a.getListener("progress");if(!(P&&P.head||Y&&Y.head)){if(a.loader){var c=a.loader;c.imageCancel(U),c.offAll(),c._data=null,c._customParse=!1,c._url=null,c._class=null,c._type=null,this._loaders.push(c),this._loaderCount--,delete this._loaderMap[a.url]}for(var L=0;L<this._maxPriority;L++)for(var u=this._resInfos[L],d=u.length-1;-1<d;d--){var a;(a=u[d])&&a.url===U&&(u[d]=null,a.destroy(),a.offAll(),this._infoPool.push(a))}delete w._resMap[U],this._next()}}},F._createLoad=function(U,F,O,P,Y,c,L,u,d){var a=this;if(null==c&&(c=2),null==L&&(L=!0),void 0===d&&(d=!1),F instanceof Array)return this._loadAssets(F,O,P,Y,c,L,u);var b=uU.getRes(F);if(null!=b)f.timer.frameOnce(1,null,function(){P&&P.runWith(1),O&&O.runWith(b),a._loaderCount||a.event("complete")});else{var z=w._resMap[F];z?(O&&z._createListener("complete",O.caller,O.method,O.args,!1,!1),P&&z._createListener("progress",P.caller,P.method,P.args,!1,!1)):((z=this._infoPool.length?this._infoPool.pop():new J).url=F,z.clas=U,z.type=Y,z.cache=L,z.group=u,z.ignoreCache=d,z.priority=c,O&&z.on("complete",O.caller,O.method,O.args),P&&z.on("progress",P.caller,P.method,P.args),w._resMap[F]=z,c=c<this._maxPriority?0<=c?c:0:this._maxPriority-1,this._resInfos[c].push(z),this._next())}return this},F._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var U=0;U<this._maxPriority;U++)for(var F=this._resInfos[U];0<F.length;){var O=F.shift();if(O)return this._doLoad(O)}this._loaderCount||this.event("complete")}},F._doLoad=function(F){var O=this._loaders.length?this._loaders.pop():new uU;this._loaderCount++,(this._loaderMap[F.url]=O).on("complete",null,Y),O.on("progress",null,function(U){F.event("progress",U)}),O.on("error",null,function(U){Y(null)}),F.loader=O;var P=this;function Y(U){O.offAll(),O._data=null,O._customParse=!1,O._url=null,O._class=null,O._type=null,P._loaders.push(O),P._loaderCount--,delete P._loaderMap[F.url],P._endLoad(F,U instanceof Array?[U]:U),P._next()}O._class=F.clas,1<=F.priority?(O.priority=F.priority,O.realTime=!1):(O.priority=0,O.realTime=!0),O.load(F.url,F.type,F.cache,F.group,F.ignoreCache)},F._endLoad=function(U,F){var O=U.url;if(null==F){var P=this._failRes[O]||0;if(P<this.retryNum)return console.warn("[warn]Retry to load:",O),this._failRes[O]=P+1,void f.timer.once(this.retryDelay,this,this._addReTry,[U],!1);console.warn("[error]Failed to load:",O),this.event("error",O)}this._failRes[O]&&(this._failRes[O]=0),delete w._resMap[O],U.event("complete",F),U.destroy(),U.offAll(),this._infoPool.push(U)},F._addReTry=function(U){this._resInfos[this._maxPriority-1].push(U),this._next()},F.clearRes=function(U,F){void 0===F&&(F=!1),uU.clearRes(U,F)},F.getRes=function(U){return uU.getRes(U)},F.cacheRes=function(U,F){uU.cacheRes(U,F)},F.clearTextureRes=function(U){uU.clearTextureRes(U)},F.setGroup=function(U,F){uU.setGroup(U,F)},F.clearResByGroup=function(U){uU.clearResByGroup(U)},F.clearUnLoaded=function(){for(var U=0;U<this._maxPriority;U++){for(var F=this._resInfos[U],O=F.length-1;-1<O;O--){var P=F[O];P&&(P.destroy(),P.offAll(),this._infoPool.push(P))}F.length=0}this._loaderCount=0,w._resMap={}},F.cancelLoadByUrls=function(U){if(U)for(var F=0,O=U.length;F<O;F++)this.cancelLoadByUrl(U[F])},F.cancelLoadByUrl=function(U){for(var F=0;F<this._maxPriority;F++)for(var O=this._resInfos[F],P=O.length-1;-1<P;P--){var Y=O[P];Y&&Y.url===U&&(O[P]=null,Y.destroy(),Y.offAll(),this._infoPool.push(Y))}w._resMap[U]&&delete w._resMap[U]},F._loadAssets=function(U,O,L,F,P,Y,c){null==P&&(P=2),null==Y&&(Y=!0);for(var u=U.length,d=0,a=0,b=[],z=!0,J=0;J<u;J++){var w=U[J];if(!w)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+U);"string"==typeof w&&(w={url:w,type:F,size:1,priority:P}),w.size||(w.size=1),w.progress=0,a+=w.size,b.push(w);var j=L?h.create(null,H,[w],!1):null,x=O||L?h.create(null,r,[w]):null;this.load(w.url,x,j,w.type,null!=w.priority&&0<=w.priority?w.priority:2,Y,w.group||c)}function r(U,F){d++,U.progress=1,F||(z=!1),d===u&&O&&O.runWith(z)}function H(U,F){if(null!=L){U.progress=F;for(var O=0,P=0;P<b.length;P++){var Y=b[P];O+=Y.size*Y.progress}var c=O/a;L.runWith(c)}}return this},w.cacheRes=function(U,F){uU.cacheRes(U,F)},w._resMap={},d(w,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),w.__init$=function(){J=function(U){function F(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,F.__super.call(this)}return x(F,"",a),F.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},F}()},w}(),aU=(function(U){function Y(U){Y.__super.call(this),U||(U=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var F=0,O=0,P=0;P<20;P++)P%5!=4?this._mat[F++]=U[P]:this._alpha[O++]=U[P];this._action=C.createFilterAction(32),this._action.data=this}x(Y,"laya.filters.ColorFilter",H);var F=Y.prototype;f.imps(F,{"laya.filters.IFilter":!0}),F.callNative=function(U){U._$P.cf=this;U.conchModel&&U.conchModel.setFilterMatrix&&U.conchModel.setFilterMatrix(this._mat,this._alpha)},b(0,F,"type",function(){return 32}),b(0,F,"action",function(){return this._action})}(),function(U){function P(U,F,O){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===F&&(F=0),P.__super.call(this),this._byteClass=O||p,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,U&&0<F&&F<65535&&this.connect(U,F)}x(P,"laya.net.Socket",a);var F=P.prototype;F.connect=function(U,F){var O="ws://"+U+":"+F;O="https:"==m.window.location.protocol?"wss://"+U+":"+F:"ws://"+U+":"+F,this.connectByUrl(O)},F.connectByUrl=function(U){var F=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new m.window.WebSocket(U,this.protocols):this._socket=new m.window.WebSocket(U),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(U){F._onOpen(U)},this._socket.onmessage=function(U){F._onMessage(U)},this._socket.onclose=function(U){F._onClose(U)},this._socket.onerror=function(U){F._onError(U)}},F.cleanSocket=function(){try{this._socket.close()}catch(U){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},F.close=function(){if(null!=this._socket)try{this._socket.close()}catch(U){}},F._onOpen=function(U){this._connected=!0,this.event("open",U)},F._onMessage=function(U){if(U&&U.data){var F=U.data;if(this.disableInput&&F)this.event("message",F);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var O=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,F&&("string"==typeof F?this._input.writeUTFBytes(F):this._input.writeArrayBuffer(F),this._addInputPosition=this._input.pos,this._input.pos=O),this.event("message",F)}}},F._onClose=function(U){this._connected=!1,this.event("close",U)},F._onError=function(U){this.event("error",U)},F.send=function(U){this._socket.send(U)},F.flush=function(){if(this._output&&0<this._output.length){var F;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(U){F=U}this._output.endian=this.endian,this._output.clear(),F&&this.event("error",F)}},b(0,F,"input",function(){return this._input}),b(0,F,"output",function(){return this._output}),b(0,F,"connected",function(){return this._connected}),b(0,F,"endian",function(){return this._endian},function(U){this._endian=U,null!=this._input&&(this._input.endian=U),null!=this._output&&(this._output.endian=U)}),P.LITTLE_ENDIAN="littleEndian",P.BIG_ENDIAN="bigEndian"}(),function(U){function u(){u.__super.call(this),this._$1__id=++u._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(u._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,M.currentResourceManager&&M.currentResourceManager.addResource(this)}x(u,"laya.resource.Resource",a);var F=u.prototype;return f.imps(F,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),F._setUrl=function(U){var F;this._url!==U&&(this._url&&((F=u._urlResourcesMap[this._url]).splice(F.indexOf(this),1),0===F.length&&delete u._urlResourcesMap[this._url]),U&&((F=u._urlResourcesMap[U])||(u._urlResourcesMap[U]=F=[]),F.push(this)),this._url=U)},F._getGroup=function(){return this._group},F._setGroup=function(U){var F;this._group!==U&&(this._group&&((F=u._groupResourcesMap[this._group]).splice(F.indexOf(this),1),0===F.length&&delete u._groupResourcesMap[this._group]),U&&((F=u._groupResourcesMap[U])||(u._groupResourcesMap[U]=F=[]),F.push(this)),this._group=U)},F._addReference=function(){this._referenceCount++},F._removeReference=function(){this._referenceCount--},F._clearReference=function(){this._referenceCount=0},F._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},F.recreateResource=function(){this.completeCreate()},F.disposeResource=function(){},F.activeResource=function(U){void 0===U&&(U=!1),this._lastUseFrameCount=v.loopCount,!this._destroyed&&this.__loaded&&(this._released||U)&&this.recreateResource()},F.releaseResource=function(U){return void 0===U&&(U=!0),!(!U&&this.lock)&&(!(this._released&&!U)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},F.onAsynLoaded=function(U,F,O){throw new Error("Resource: must override this function!")},F.destroy=function(){var U;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete u._idResourcesMap[this.id],this._url&&((U=u._urlResourcesMap[this._url])&&(U.splice(U.indexOf(this),1),0===U.length&&delete u._urlResourcesMap[this.url]),uU.clearRes(this._url),this.__loaded||C.cancelLoadByUrl(this._url)),this._group&&((U=u._groupResourcesMap[this._group]).splice(U.indexOf(this),1),0===U.length&&delete u._groupResourcesMap[this.url]))},F.completeCreate=function(){this._released=!1,this.event("recovered",this)},F.dispose=function(){this.destroy()},b(0,F,"memorySize",function(){return this._memorySize},function(U){var F=U-this._memorySize;this._memorySize=U,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,F),this.resourceManager&&this.resourceManager.addSize(F)}),b(0,F,"_loaded",null,function(U){this.__loaded=U}),b(0,F,"loaded",function(){return this.__loaded}),b(0,F,"id",function(){return this._$1__id}),b(0,F,"destroyed",function(){return this._destroyed}),b(0,F,"group",function(){return this._getGroup()},function(U){this._setGroup(U)}),b(0,F,"resourceManager",function(){return this._resourceManager}),b(0,F,"url",function(){return this._url}),b(0,F,"released",function(){return this._released}),b(0,F,"referenceCount",function(){return this._referenceCount}),u.getResourceByID=function(U){return u._idResourcesMap[U]},u.getResourceByURL=function(U,F){return void 0===F&&(F=0),null==u._urlResourcesMap[U]?null:u._urlResourcesMap[U][F]},u.getResourceCountByURL=function(U){return u._urlResourcesMap[U].length},u.destroyUnusedResources=function(U){var F;if(U){var O=u._groupResourcesMap[U];if(O)for(var P=O.slice(),Y=0,c=P.length;Y<c;Y++)(F=P[Y]).lock||0!==F._referenceCount||F.destroy()}else for(var L in u._idResourcesMap)(F=u._idResourcesMap[L]).lock||0!==F._referenceCount||F.destroy()},u._uniqueIDCounter=0,u._idResourcesMap={},u._urlResourcesMap={},u._groupResourcesMap={},u}()),bU=function(U){function g(U,F){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,g.__super.call(this),U&&null!=U._addReference&&U._addReference(),this.setTo(U,F)}x(g,"laya.resource.Texture",a);var F=g.prototype;return F._setUrl=function(U){this.url=U},F.setTo=function(U,F){if(U instanceof L.HTMLElement){var O=QU.create("2D",U);this.bitmap=O}else this.bitmap=U;if(this.uv=F||g.DEF_UV,U){this._w=U.width,this._h=U.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var P=this;if(this._loaded)C.addToAtlas&&C.addToAtlas(P);else{var Y=U;Y instanceof laya.resource.HTMLImage&&Y.image&&Y.image.addEventListener("load",function(U){C.addToAtlas&&C.addToAtlas(P)},!1)}}},F.active=function(){this.bitmap&&this.bitmap.activeResource()},F.destroy=function(U){if(void 0===U&&(U=!1),this.alphaTexture&&(this.alphaTexture.destroy(U),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var F=this.bitmap;U?(k.isConchApp&&F.source&&F.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,F.dispose(),F._clearReference()):(F._removeReference(),0==F.referenceCount&&(k.isConchApp&&F.source&&F.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,F.dispose())),this.url&&this===f.loader.getRes(this.url)&&f.loader.clearRes(this.url,U),this._loaded=!1}},F.load=function(U){var F=this;this._loaded=!1,U=y.customFormat(U);var O=this.bitmap||(this.bitmap=KU.create(U));O.uri=U,O&&O._addReference();var P=this;O.onload=function(){O.onload=null,P._loaded=!0,F.sourceWidth=F._w=O.width,F.sourceHeight=F._h=O.height,P.event("loaded",this),C.addToAtlas&&C.addToAtlas(P)}},F.addTextureToAtlas=function(U){C.addTextureToAtlas(this)},F.getPixels=function(U,F,O,P){if(k.isConchApp){var Y=this.bitmap;if(Y.source&&Y.source.getImageData){var c=Y.source.getImageData(U,F,O,P),L=new Uint8Array(c);return Array.from(L)}return null}return k.isWebGL?C.getTexturePixels(this,U,F,O,P):(m.canvas.size(O,P),m.canvas.clear(),m.context.drawTexture(this,-U,-F,this.width,this.height,0,0),m.context.getImageData(0,0,O,P).data)},F.onAsynLoaded=function(U,F){if(F){if("function"!=typeof F._addReference)throw new Error("bitmap._addReference is not a function. "+F.className+" "+typeof F._addReference+" "+F.constructor);F._addReference()}this.setTo(F,this.uv),this._loaded&&this.event("loaded",this)},b(0,F,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),b(0,F,"loaded",function(){return this._loaded}),b(0,F,"released",function(){return!this.bitmap||this.bitmap.released}),b(0,F,"width",function(){return this._w?this._w:this.uv&&this.uv!==g.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(U){this._w=U,this.sourceWidth||(this.sourceWidth=U)}),b(0,F,"repeat",function(){return!k.isWebGL||!this.bitmap||this.bitmap.repeat},function(U){U&&k.isWebGL&&this.bitmap&&(this.bitmap.repeat=U)&&(this.bitmap.enableMerageInAtlas=!1)}),b(0,F,"height",function(){return this._h?this._h:this.uv&&this.uv!==g.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(U){this._h=U,this.sourceHeight||(this.sourceHeight=U)}),b(0,F,"isLinearSampling",function(){return!k.isWebGL||9728!=this.bitmap.minFifter},function(U){!U&&k.isWebGL&&(U||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),g.moveUV=function(U,F,O){for(var P=0;P<8;P+=2)O[P]+=U,O[P+1]+=F;return O},g.create=function(U,F,O,P,Y,c,L,u,d){void 0===c&&(c=0),void 0===L&&(L=0),void 0===u&&(u=0),void 0===d&&(d=0);var a=U instanceof laya.resource.Texture,b=a?U.uv:g.DEF_UV,z=a?U.bitmap:U,J=C.isAtlas(z);if(J){var w=z._atlaser,j=U._atlasID;if(-1==j)throw new Error("create texture error");z=w._inAtlasTextureBitmapValue[j],b=w._inAtlasTextureOriUVValue[j]}var x=new g(z,null);z.width&&F+P>z.width&&(P=z.width-F),z.height&&O+Y>z.height&&(Y=z.height-O),x.width=P,x.height=Y,x.offsetX=c,x.offsetY=L,x.sourceWidth=u||P,x.sourceHeight=d||Y;var r=1/z.width,H=1/z.height;F*=r,O*=H,P*=r,Y*=H;var h=x.uv[0],Q=x.uv[1],X=x.uv[4],N=x.uv[5],K=X-h,f=N-Q,I=g.moveUV(b[0],b[1],[F,O,F+P,O,F+P,O+Y,F,O+Y]);x.uv=[h+I[0]*K,Q+I[1]*f,X-(1-I[2])*K,Q+I[3]*f,X-(1-I[4])*K,N-(1-I[5])*f,h+I[6]*K,N-(1-I[7])*f],J&&x.addTextureToAtlas();var T=z.scaleRate;return T&&1!=T?(x.sourceWidth/=T,x.sourceHeight/=T,x.width/=T,x.height/=T,x.scaleRate=T,x.offsetX/=T,x.offsetY/=T):x.scaleRate=1,x},g.createFromTexture=function(U,F,O,P,Y){var c=U.scaleRate;1!=c&&(F*=c,O*=c,P*=c,Y*=c);var L=T.TEMP.setTo(F-U.offsetX,O-U.offsetY,P,Y),u=L.intersection(g._rect1.setTo(0,0,U.width,U.height),g._rect2);if(!u)return null;var d=g.create(U,u.x,u.y,u.width,u.height,u.x-L.x,u.y-L.y,P,Y);if(d.bitmap&&d.bitmap._removeReference)return d.bitmap._removeReference(),d;var a="bitmap:"+(d.bitmap?d.bitmap.constructor?d.bitmap.constructor.name:d.bitmap.__className:"")+", url:"+(U.url+" | "+(d.bitmap?d.bitmap.url:U.url))+", x="+F+",y="+O+",width="+P+",height="+Y+", result="+(u?u.x+","+u.y+","+u.width+","+u.height:"null")+", rect="+L.x+","+L.y+","+L.width+","+L.height;throw new Error("报错：bitmap._removeReference is not a function  "+a)},g.DEF_UV=[0,0,1,0,1,1,0,1],g.INV_UV=[0,1,1,1,1,0,0,0],g._rect1=new T,g._rect2=new T,g}(),U=function(U){var u;function c(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,c.__super.call(this)}x(c,"laya.utils.TimeLine",a);var F=c.prototype;return F.to=function(U,F,O,P,Y){return void 0===Y&&(Y=0),this._create(U,F,O,P,Y,!0)},F.from=function(U,F,O,P,Y){return void 0===Y&&(Y=0),this._create(U,F,O,P,Y,!1)},F._create=function(U,F,O,P,Y,c){var L=e.getItemByClass("tweenData",u);return L.isTo=c,L.type=0,L.target=U,L.duration=O,L.data=F,L.startTime=this._startTime+Y,L.endTime=L.startTime+L.duration,L.ease=P,this._startTime=Math.max(L.endTime,this._startTime),this._tweenDataList.push(L),this._startTimeSort=!0,this._endTimeSort=!0,this},F.addLabel=function(U,F){var O=e.getItemByClass("tweenData",u);return O.type=1,O.data=U,O.endTime=O.startTime=this._startTime+F,this._labelDic||(this._labelDic={}),this._labelDic[U]=O,this._tweenDataList.push(O),this},F.removeLabel=function(U){if(this._labelDic&&this._labelDic[U]){var F=this._labelDic[U];if(F){var O=this._tweenDataList.indexOf(F);-1<O&&this._tweenDataList.splice(O,1)}delete this._labelDic[U]}},F.gotoTime=function(U){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var F,O,P,Y;for(var c in this._firstTweenDic)if(O=this._firstTweenDic[c])for(var L in O)O.diyTarget.hasOwnProperty(L)&&(O.diyTarget[L]=O[L]);for(c in this._tweenDic)(F=this._tweenDic[c]).clear(),delete this._tweenDic[c];if(this._index=0,this._gidIndex=0,this._currTime=U,this._lastTime=m.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=P=this._tweenDataList.concat(),P.sort(function(U,F){return U.endTime>F.endTime?1:U.endTime<F.endTime?-1:0})}else P=this._endTweenDataList;for(var u=0,d=P.length;u<d;u++)if(0==(Y=P[u]).type){if(!(U>=Y.endTime))break;this._index=Math.max(this._index,u+1);var a=Y.data;if(Y.isTo)for(var b in a)Y.target[b]=a[b]}for(u=0,d=this._tweenDataList.length;u<d;u++)0==(Y=this._tweenDataList[u]).type&&U>=Y.startTime&&U<Y.endTime&&(this._index=Math.max(this._index,u+1),this._gidIndex++,(F=e.getItemByClass("tween",t))._create(Y.target,Y.data,Y.duration,Y.ease,h.create(this,this._animComplete,[this._gidIndex]),0,!1,Y.isTo,!0,!1),F.setStartTime(this._currTime-(U-Y.startTime)),F._updateEase(this._currTime),F.gid=this._gidIndex,this._tweenDic[this._gidIndex]=F)}},F.gotoLabel=function(U){if(null!=this._labelDic){var F=this._labelDic[U];F&&this.gotoTime(F.startTime)}},F.pause=function(){f.timer.clear(this,this._update)},F.resume=function(){this.play(this._currTime,this._loopKey)},F.play=function(U,F){if(void 0===U&&(U=0),void 0===F&&(F=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(U,F){return U.startTime>F.startTime?1:U.startTime<F.startTime?-1:0});for(var O=0,P=this._tweenDataList.length;O<P;O++){var Y=this._tweenDataList[O];if(null!=Y&&0==Y.type){var c=Y.target,L=c.$_GID||(c.$_GID=S.getGID()),u=null;for(var d in null==this._firstTweenDic[L]?((u={}).diyTarget=c,this._firstTweenDic[L]=u):u=this._firstTweenDic[L],Y.data)null==u[d]&&(u[d]=c[d])}}}"string"==typeof U?this.gotoLabel(U):this.gotoTime(U),this._loopKey=F,this._lastTime=m.now(),f.timer.frameLoop(1,this,this._update)}},F._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var U in this._tweenDic)(F=this._tweenDic[U]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var F,O=m.now(),P=O-this._lastTime,Y=this._currTime+=P*this.scale;for(U in this._lastTime=O,this._tweenDic)(F=this._tweenDic[U])._updateEase(Y);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var c=this._tweenDataList[this._index];Y>=c.startTime&&(this._index++,0==c.type?(this._gidIndex++,(F=e.getItemByClass("tween",t))._create(c.target,c.data,c.duration,c.ease,h.create(this,this._animComplete,[this._gidIndex]),0,!1,c.isTo,!0,!1),F.setStartTime(Y),F.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=F)._updateEase(Y)):this.event("label",c.data))}},F._animComplete=function(U){this._tweenDic[U]&&delete this._tweenDic[U]},F._complete=function(){this.event("complete")},F.reset=function(){var U;if(this._labelDic)for(U in this._labelDic)delete this._labelDic[U];for(U in this._tweenDic)this._tweenDic[U].clear(),delete this._tweenDic[U];for(U in this._firstTweenDic)delete this._firstTweenDic[U];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var F,O=0;for(F=this._tweenDataList.length,O=0;O<F;O++)this._tweenDataList[O]&&this._tweenDataList[O].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,f.timer.clear(this,this._update)},F.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},b(0,F,"index",function(){return this._frameIndex},function(U){this._frameIndex=U,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),b(0,F,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),c.to=function(U,F,O,P,Y){return void 0===Y&&(Y=0),(new c).to(U,F,O,P,Y)},c.from=function(U,F,O,P,Y){return void 0===Y&&(Y=0),(new c).from(U,F,O,P,Y)},c.__init$=function(){u=function(){function U(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return x(U,""),U.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,e.recover("tweenData",this)},U}()},c}(),zU=function(Y){function O(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,O.__super.call(this),this._style=u.EMPTY}x(O,"laya.display.Sprite",Y);var U=O.prototype;return f.imps(U,{"laya.display.ILayout":!0}),U.createConchModel=function(){return new ConchNode},U.destroy=function(U){if(void 0===U&&(U=!0),this._releaseMem(),!this._destroyed){this.filters=null;var F=this.mask;F&&(this.mask=null,F.destroy(U))}Y.prototype.destroy.call(this,U),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},U.updateZOrder=function(){S.updateOrder(this._childs)&&this.repaint()},U.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},U.setBounds=function(U){this._set$P("uBounds",U)},U.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new T),T._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},U.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new T),T._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},U._boundPointsToParent=function(U){void 0===U&&(U=!1);var F=0,O=0;this._style&&(F=this._style._tf.translateX,O=this._style._tf.translateY,U=U||0!==this._style._tf.rotate,this._style.scrollRect&&(F+=this._style.scrollRect.x,O+=this._style.scrollRect.y));var P=this._getBoundPointsM(U);if(!P||P.length<1)return P;if(8!=P.length&&(P=U?N.scanPList(P):T._getWrapRec(P,T.TEMP)._getBoundPoints()),!this.transform)return S.transPointList(P,this._x-F,this._y-O),P;var Y=I.TEMP,c=0,L=P.length;for(c=0;c<L;c+=2)Y.x=P[c],Y.y=P[c+1],this.toParentPoint(Y),P[c]=Y.x,P[c+1]=Y.y;return P},U.getGraphicBounds=function(U){return void 0===U&&(U=!1),this._graphics?this._graphics.getBounds(U):T.TEMP.setTo(0,0,0,0)},U._getBoundPointsM=function(U){if(void 0===U&&(U=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var F=S.clearArray(this._$P.temBM),O=T.TEMP;return O.copyFrom(this.scrollRect),S.concatArray(F,O._getBoundPoints()),F}for(var P,Y,c,L=this._graphics?this._graphics.getBoundPoints():S.clearArray(this._$P.temBM),u=0,d=(c=this._childs).length;u<d;u++)(P=c[u])instanceof laya.display.Sprite&&1==P.visible&&(Y=P._boundPointsToParent(U))&&(L=L?S.concatArray(L,Y):Y);return L},U.getStyle=function(){return this._style===u.EMPTY&&(this._style=new u),this._style},U.setStyle=function(U){this._style=U},U._adjustTransform=function(){this._tfChanged=!1;var U,F=this._style._tf,O=F.scaleX,P=F.scaleY;if(F.rotate||1!==O||1!==P||F.skewX||F.skewY){(U=this._transform||(this._transform=s.create())).bTransform=!0;var Y=.0174532922222222*(F.rotate-F.skewX),c=.0174532922222222*(F.rotate+F.skewY),L=Math.cos(c),u=Math.sin(c),d=Math.sin(Y),a=Math.cos(Y);return U.a=O*L,U.b=O*u,U.c=-P*d,U.d=P*a,U.tx=U.ty=0,U}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,U},U.pos=function(U,F,O){if(void 0===O&&(O=!1),this._x!==U||this._y!==F){if(this.destroyed)return this;if(O){this._x=U,this._y=F,this.conchModel&&this.conchModel.pos(this._x,this._y);var P=this._parent;P&&0===P._repaint&&(P._repaint=1,P.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=U,this.y=F}return this},U.pivot=function(U,F){return this.pivotX=U,this.pivotY=F,this},U.size=function(U,F){return this.width=U,this.height=F,this},U.scale=function(U,F,O){void 0===O&&(O=!1);var P=this.getStyle(),Y=P._tf;if(Y.scaleX!=U||Y.scaleY!=F){if(this.destroyed)return this;if(O){P.setScale(U,F),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(U,F),this._renderType|=4;var c=this._parent;c&&0===c._repaint&&(c._repaint=1,c.parentRepaint())}else this.scaleX=U,this.scaleY=F}return this},U.skew=function(U,F){return this.skewX=U,this.skewY=F,this},U.render=function(U,F,O){v.spriteCount++,G.renders[this._renderType]._fun(this,U,F+this._x,O+this._y),this._repaint=0},U.drawToCanvas=function(U,F,O,P){if(k.isConchNode){var Y=QU.create("2D");return new A(U,F,Y).ctx.setCanvasType(1),this.conchModel.drawToCanvas(Y.source,O,P),Y}return C.drawToCanvas(this,this._renderType,U,F,O,P)},U.customRender=function(U,F,O){this._renderType|=1024},U._applyFilters=function(){var U;if(!k.isWebGL&&((U=this._$P.filters)&&!(U.length<1)))for(var F=0,O=U.length;F<O;F++)U[F].action.apply(this._$P.cacheCanvas)},U._isHaveGlowFilter=function(){var U,F=0;if(this.filters)for(F=0;F<this.filters.length;F++)if(8==this.filters[F].type)return!0;for(F=0,U=this._childs.length;F<U;F++)if(this._childs[F]._isHaveGlowFilter())return!0;return!1},U.localToGlobal=function(U,F){void 0===F&&(F=!1),!0===F&&(U=new I(U.x,U.y));for(var O=this;O&&O!=f.stage;)U=O.toParentPoint(U),O=O.parent;return U},U.globalToLocal=function(U,F){void 0===F&&(F=!1),F&&(U=new I(U.x,U.y));for(var O=this,P=[];O&&O!=f.stage;)P.push(O),O=O.parent;for(var Y=P.length-1;0<=Y;)U=(O=P[Y]).fromParentPoint(U),Y--;return U},U.toParentPoint=function(U){if(!U)return U;U.x-=this.pivotX,U.y-=this.pivotY,this.transform&&this._transform.transformPoint(U),U.x+=this._x,U.y+=this._y;var F=this._style.scrollRect;return F&&(U.x-=F.x,U.y-=F.y),U},U.fromParentPoint=function(U){if(!U)return U;U.x-=this._x,U.y-=this._y;var F=this._style.scrollRect;return F&&(U.x+=F.x,U.y+=F.y),this.transform&&this._transform.invertTransformPoint(U),U.x+=this.pivotX,U.y+=this.pivotY,U},U.on=function(U,F,O,P){return 1!==this._mouseEnableState&&this.isMouseEvent(U)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(U,F,O,P,!1)):Y.prototype.on.call(this,U,F,O,P)},U.once=function(U,F,O,P){return 1!==this._mouseEnableState&&this.isMouseEvent(U)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(U,F,O,P,!0)):Y.prototype.once.call(this,U,F,O,P)},U._$2__onDisplay=function(){if(1!==this._mouseEnableState){var U=this;for(U=U.parent;U&&1!==U._mouseEnableState&&!U._getBit(2);)U.mouseEnabled=!0,U._setBit(2,!0),U=U.parent}},U.loadImage=function(U,F,O,P,Y,c){var L=this;return void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0),void 0===Y&&(Y=0),this.graphics.loadImage(U,F,O,P,Y,function(U){L.destroyed||(L.size(F+(P||U.width),O+(Y||U.height)),L.repaint(),c&&c.runWith(U))}),this},U.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},U._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},U._childChanged=function(U){this._childs.length?this._renderType|=2048:this._renderType&=-2049,U&&this._get$P("hasZorder")&&f.timer.callLater(this,this.updateZOrder),this.repaint()},U.parentRepaint=function(){var U=this._parent;U&&0===U._repaint&&(U._repaint=1,U.parentRepaint())},U.startDrag=function(U,F,O,P,Y,c,L){void 0===F&&(F=!1),void 0===O&&(O=0),void 0===P&&(P=300),void 0===c&&(c=!1),void 0===L&&(L=.92),this._$P.dragging||this._set$P("dragging",new q),this._$P.dragging.start(this,U,F,O,P,Y,c,L)},U.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},U._releaseMem=function(){if(this._$P){var U=this._$P.cacheCanvas;U&&U.ctx&&(e.recover("RenderContext",U.ctx),U.ctx.canvas.size(0,0),U.ctx=null);var F=this._$P._filterCache;F&&(F.destroy(),F.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},U._setDisplay=function(U){U||this._releaseMem(),Y.prototype._setDisplay.call(this,U)},U.hitTestPoint=function(U,F){var O=this.globalToLocal(I.TEMP.setTo(U,F));return U=O.x,F=O.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?T.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(U,F)},U.getMousePoint=function(){return this.globalToLocal(I.TEMP.setTo(f.stage.mouseX,f.stage.mouseY))},U._getWords=function(){return null},U._addChildsToLayout=function(U){var F=this._getWords();if(null==F&&0==this._childs.length)return!1;if(F)for(var O=0,P=F.length;O<P;O++)U.push(F[O]);O=0;for(var Y=this._childs.length;O<Y;++O){var c=this._childs[O];c._style._enableLayout()&&c._addToLayout(U)}return!0},U._addToLayout=function(U){this._style.absolute||(this._style.block?U.push(this):this._addChildsToLayout(U)&&(this.x=this.y=0))},U._isChar=function(){return!1},U._getCSSStyle=function(){return this._style.getCSSStyle()},U._setAttributes=function(U,F){switch(U){case"x":this.x=parseFloat(F);break;case"y":this.y=parseFloat(F);break;case"width":this.width=parseFloat(F);break;case"height":this.height=parseFloat(F);break;default:this[U]=F}},U._layoutLater=function(){this.parent&&this.parent._layoutLater()},b(0,U,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(U){this._optimizeScrollRect!=U&&(this._optimizeScrollRect=U,this.conchModel&&this.conchModel.optimizeScrollRect(U))}),b(0,U,"customRenderEnable",null,function(U){if(U&&(this._renderType|=1024,k.isConchNode)){O.CustomList.push(this);var F=new QU("2d");F._setContext(new CanvasRenderingContext2D),this.customContext=new A(0,0,F),F.context.setCanvasType&&F.context.setCanvasType(2),this.conchModel.custom(F.context)}}),b(0,U,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(U){this.cacheAs=U?this._$P.hasFilter?"none":"normal":"none"}),b(0,U,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(U){var F=this._$P.cacheCanvas;if(U!==(F?F.type:"none")){if("none"!==U)this._getBit(1)||this._setUpNoticeType(1),F||(F=this._set$P("cacheCanvas",e.getItemByClass("cacheCanvas",Object))),F.type=U,F.reCache=!0,this._renderType|=16,"bitmap"==U&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(F){var O=F;O&&O.ctx&&(e.recover("RenderContext",O.ctx),O.ctx.canvas.size(0,0),O.ctx=null),e.recover("cacheCanvas",F)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),b(0,U,"zOrder",function(){return this._zOrder},function(U){this._zOrder!=U&&(this._zOrder=U,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(U),this._parent&&(U&&this._parent._set$P("hasZorder",!0),f.timer.callLater(this._parent,this.updateZOrder)))}),b(0,U,"rotation",function(){return this._style._tf.rotate},function(U){var F=this.getStyle();if(F._tf.rotate!==U){F.setRotate(U),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(U),this._renderType|=4;var O=this._parent;O&&0===O._repaint&&(O._repaint=1,O.parentRepaint())}}),b(0,U,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(U){this._width!==U&&(this._width=U,this.conchModel&&this.conchModel.size(U,this._height),this.repaint())}),b(0,U,"x",function(){return this._x},function(U){if(this._x!==U){if(this.destroyed)return;this._x=U,this.conchModel&&this.conchModel.pos(U,this._y);var F=this._parent;F&&0===F._repaint&&(F._repaint=1,F.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),b(0,U,"globalScaleY",function(){for(var U=1,F=this;F&&F!==f.stage;)U*=F.scaleY,F=F.parent;return U}),b(0,U,"hitArea",function(){return this._$P.hitArea},function(U){this._set$P("hitArea",U)}),b(0,U,"staticCache",function(){return this._$P.staticCache},function(U){this._set$P("staticCache",U),U||this.reCache()}),b(0,U,"texture",function(){return this._texture},function(U){this._texture!=U&&(this._texture=U,this.graphics.cleanByTexture(U,0,0))}),b(0,U,"y",function(){return this._y},function(U){if(this._y!==U){if(this.destroyed)return;this._y=U,this.conchModel&&this.conchModel.pos(this._x,U);var F=this._parent;F&&0===F._repaint&&(F._repaint=1,F.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),b(0,U,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(U){this._height!==U&&(this._height=U,this.conchModel&&this.conchModel.size(this._width,U),this.repaint())}),b(0,U,"blendMode",function(){return this._style.blendMode},function(U){this.getStyle().blendMode=U,this.conchModel&&this.conchModel.blendMode(U),U&&"source-over"!=U?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),b(0,U,"scaleX",function(){return this._style._tf.scaleX},function(U){var F=this.getStyle();if(F._tf.scaleX!==U){F.setScaleX(U),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(U,F._tf.scaleY),this._renderType|=4;var O=this._parent;O&&0===O._repaint&&(O._repaint=1,O.parentRepaint())}}),b(0,U,"scaleY",function(){return this._style._tf.scaleY},function(U){var F=this.getStyle();if(F._tf.scaleY!==U){F.setScaleY(U),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(F._tf.scaleX,U),this._renderType|=4;var O=this._parent;O&&0===O._repaint&&(O._repaint=1,O.parentRepaint())}}),b(0,U,"stage",function(){return f.stage}),b(0,U,"skewX",function(){return this._style._tf.skewX},function(U){var F=this.getStyle();if(F._tf.skewX!==U){F.setSkewX(U),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(U,F._tf.skewY),this._renderType|=4;var O=this._parent;O&&0===O._repaint&&(O._repaint=1,O.parentRepaint())}}),b(0,U,"scrollRect",function(){return this._style.scrollRect},function(U){this.getStyle().scrollRect=U,this.repaint(),U?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(U.x,U.y,U.width,U.height)):(this._renderType&=-129,this.conchModel&&(O.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),b(0,U,"skewY",function(){return this._style._tf.skewY},function(U){var F=this.getStyle();if(F._tf.skewY!==U){F.setSkewY(U),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(F._tf.skewX,U),this._renderType|=4;var O=this._parent;O&&0===O._repaint&&(O._repaint=1,O.parentRepaint())}}),b(0,U,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(U){this._tfChanged=!1,(this._transform=U)&&(this._x=U.tx,this._y=U.ty,U.tx=U.ty=0,this.conchModel&&this.conchModel.transform(U.a,U.b,U.c,U.d,this._x,this._y)),U?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),b(0,U,"pivotX",function(){return this._style._tf.translateX},function(U){this.getStyle().setTranslateX(U),this.conchModel&&this.conchModel.pivot(U,this._style._tf.translateY),this.repaint()}),b(0,U,"pivotY",function(){return this._style._tf.translateY},function(U){this.getStyle().setTranslateY(U),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,U),this.repaint()}),b(0,U,"alpha",function(){return this._style.alpha},function(U){this._style&&this._style.alpha!==U&&(U=U<0?0:1<U?1:U,this.getStyle().alpha=U,this.conchModel&&this.conchModel.alpha(U),1!==U?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),b(0,U,"visible",function(){return this._style.visible},function(U){this._style&&this._style.visible!==U&&(this.getStyle().visible=U,this.conchModel&&this.conchModel.visible(U),this.parentRepaint())}),b(0,U,"graphics",function(){return this._graphics||(this.graphics=C.createGraphics())},function(U){this._graphics&&(this._graphics._sp=null),(this._graphics=U)?(this._renderType&=-2,this._renderType|=512,(U._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(O.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),b(0,U,"filters",function(){return this._$P.filters},function(U){U&&0===U.length&&(U=null),this._$P.filters!=U&&(this._set$P("filters",U?U.slice():null),k.isConchApp&&(this.conchModel&&(O.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),k.isWebGL&&(U&&U.length?this._renderType|=32:this._renderType&=-33),U&&0<U.length?(this._getBit(1)||this._setUpNoticeType(1),k.isWebGL&&1==U.length&&U[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(k.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),b(0,U,"parent",Y.prototype._$get_parent,function(U){f.superSet(UU,this,"parent",U),U&&this._getBit(2)&&this._$2__onDisplay()}),b(0,U,"mask",function(){return this._$P._mask},function(U){U&&this.mask&&this.mask._$P.maskParent||(U?(this.cacheAs="bitmap",this._set$P("_mask",U),U._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",U),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(U?U.conchModel:null),this._renderType|=64,this.parentRepaint())}),b(0,U,"mouseEnabled",function(){return 1<this._mouseEnableState},function(U){this._mouseEnableState=U?2:1}),b(0,U,"globalScaleX",function(){for(var U=1,F=this;F&&F!==f.stage;)U*=F.scaleX,F=F.parent;return U}),b(0,U,"mouseX",function(){return this.getMousePoint().x}),b(0,U,"mouseY",function(){return this.getMousePoint().y}),O.fromImage=function(U){return(new O).loadImage(U)},O._cachePool=[],O.CustomList=[],d(O,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=L.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),O}(UU),JU=function(U){function F(U){this._audio=null,this._onEnd=null,this._resumePlay=null,F.__super.call(this),this._onEnd=S.bind(this.__onEnd,this),this._resumePlay=S.bind(this.__resumePlay,this),U.addEventListener("ended",this._onEnd),this._audio=U}x(F,"laya.media.h5audio.AudioSoundChannel",PU);var O=F.prototype;return O.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(f.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},O.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,m.container.appendChild(this._audio),this._audio.play()}catch(U){this.event("error")}},O.play=function(U){this.isStopped=!1;try{this._audio.playbackRate=$.playbackRate,this._audio.currentTime=this.startTime}catch(U){return void this._audio.addEventListener("canplay",this._resumePlay)}$.addChannel(this),m.container.appendChild(this._audio),!U&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},O.stop=function(){this.isStopped=!0,$.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&k.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),m.onIE||this._audio!=OU._musicAudio&&e.recover("audio:"+this.url,this._audio),m.removeElement(this._audio),this._audio=null)},O.pause=function(){this.isStopped=!0,$.removeChannel(this),"pause"in this._audio&&this._audio.pause()},O.resume=function(){this._audio&&(this.isStopped=!1,$.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},b(0,O,"position",function(){return this._audio?this._audio.currentTime:0}),b(0,O,"duration",function(){return this._audio?this._audio.duration:0}),b(0,O,"volume",function(){return this._audio?this._audio.volume:1},function(U){this._audio&&(this._audio.volume=U)}),F}(),wU=function(U){function F(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=cU.ctx,F.__super.call(this),this._onPlayEnd=S.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}x(F,"laya.media.webaudio.WebAudioSoundChannel",PU);var O=F.prototype;return O.play=function(U){if($.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var F=this.context,O=this.gain,P=F.createBufferSource();(this.bufferSource=P).buffer=this.audioBuffer,P.connect(O),O&&O.disconnect(),O.connect(F.destination),P.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=m.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(P.loop=!0),P.playbackRate.setTargetAtTime?P.playbackRate.setTargetAtTime($.playbackRate,this.context.currentTime,.1):P.playbackRate.value=$.playbackRate,P.start(0,this.startTime),!U&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},O.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(f.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},O._clearBufferSource=function(){if(this.bufferSource){var U=this.bufferSource;U.stop?U.stop(0):U.noteOff(0),U.disconnect(0),U.onended=null,F._tryCleanFailed||this._tryClearBuffer(U),this.bufferSource=null}},O._tryClearBuffer=function(U){try{U.buffer=null}catch(U){F._tryCleanFailed=!0}},O.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$.removeChannel(this),this.startHandler=null,this.completeHandler=null},O.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$.removeChannel(this)},O.resume=function(){this.startTime=this._pauseTime,this.play(!1)},b(0,O,"position",function(){return this.bufferSource?(m.now()-this._startTime)/1e3+this.startTime:0}),b(0,O,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),b(0,O,"volume",function(){return this._volume},function(U){this.isStopped||(this._volume=U,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(U,this.context.currentTime,.1):this.gain.gain.value=U)}),F._tryCleanFailed=!1,F}(),jU=function(U){function F(){F.__super.call(this),this._w=0,this._h=0}x(F,"laya.resource.Bitmap",aU);var O=F.prototype;return b(0,O,"width",function(){return this._w}),b(0,O,"height",function(){return this._h}),b(0,O,"source",function(){return this._source}),F}(),xU=function(F){function U(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,U.__super.call(this),this._interval=P.animationInterval,this._setUpNoticeType(1)}x(U,"laya.display.AnimationPlayerBase",F);var O=U.prototype;return O.play=function(U,F,O,P){void 0===U&&(U=0),void 0===F&&(F=!0),void 0===O&&(O=""),void 0===P&&(P=!0),this._isPlaying=!0,this.index="string"==typeof U?this._getFrameByLabel(U):U,this.loop=F,this._actionName=O,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},O._getFrameByLabel=function(U){var F=0;for(F=0;F<this._count;F++)if(this._labels[F]&&0<=this._labels[F].indexOf(U))return F;return 0},O._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},O._setControlNode=function(U){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=U)&&U!=this&&(U.on("display",this,this._checkResumePlaying),U.on("undisplay",this,this._checkResumePlaying))},O._setDisplay=function(U){F.prototype._setDisplay.call(this,U),this._checkResumePlaying()},O._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},O.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},O.addLabel=function(U,F){this._labels||(this._labels={}),this._labels[F]||(this._labels[F]=[]),this._labels[F].push(U)},O.removeLabel=function(U){if(U){if(this._labels)for(var F in this._labels)this._removeLabelFromLabelList(this._labels[F],U)}else this._labels=null},O._removeLabelFromLabelList=function(U,F){if(U)for(var O=U.length-1;0<=O;O--)U[O]==F&&U.splice(O,1)},O.gotoAndStop=function(U){this.index="string"==typeof U?this._getFrameByLabel(U):U,this.stop()},O._displayToIndex=function(U){},O.clear=function(){this.stop(),this._labels=null},b(0,O,"interval",function(){return this._interval},function(U){this._interval!=U&&(this._frameRateChanged=!0,this._interval=U,this._isPlaying&&0<U&&this.timerLoop(U,this,this._frameLoop,null,!0,!0))}),b(0,O,"isPlaying",function(){return this._isPlaying}),b(0,O,"index",function(){return this._index},function(U){if(this._index=U,this._displayToIndex(U),this._labels&&this._labels[U])for(var F=this._labels[U],O=0,P=F.length;O<P;O++)this.event("label",F[O])}),b(0,O,"count",function(){return this._count}),U.WRAP_POSITIVE=0,U.WRAP_REVERSE=1,U.WRAP_PINGPONG=2,U}(zU),rU=function(F){function w(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,w.__super.call(this),this.overflow=w.VISIBLE,this._style=new FU(this),this._style.wordWrap=!1}x(w,"laya.display.Text",F);var U=w.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._lines=null,this._words&&(this._words.length=0,this._words=null)},U._getBoundPointsM=function(U){void 0===U&&(U=!1);var F=T.TEMP;return F.setTo(0,0,this.width,this.height),F._getBoundPoints()},U.getGraphicBounds=function(U){void 0===U&&(U=!1);var F=T.TEMP;return F.setTo(0,0,this.width,this.height),F},U._getCSSStyle=function(){return this._style},U.lang=function(U,F,O,P,Y,c,L,u,d,a,b){if(U=w.langPacks&&w.langPacks[U]?w.langPacks[U]:U,arguments.length<2)this._text=U;else{for(var z=0,J=arguments.length;z<J;z++)U=U.replace("{"+z+"}",arguments[z+1]);this._text=U}},U._isPassWordMode=function(){var U=this._style.password;return"prompt"in this&&this.prompt==this._text&&(U=!1),U},U._getPassWordTxt=function(U){var F;F="";for(var O=U.length;0<O;O--)F+="●";return F},U.renderText=function(U,F){var O=this.graphics;O.clear(!0);var P=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(m.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);m.context.font=P;var Y=this.padding,c=Y[3],L="left",u=this._lines,d=this.leading+this._charSize.height,a=this._currBitmapFont;a&&(d=this.leading+a.getMaxHeight());var b=Y[0];if(!a&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(L="right",c=this._width-Y[1]):"center"==this.align&&(L="center",c=.5*this._width+Y[3]-Y[1])),0<this._height){var z=this._textHeight>this._height?"top":this.valign;"middle"===z?b=.5*(this._height-F*d)+Y[0]-Y[2]:"bottom"===z&&(b=this._height-F*d-Y[2])}var J=this._style;if(a&&a.autoScaleSize)var w=a.fontSize/this.fontSize;if(this._clipPoint)if(O.save(),a&&a.autoScaleSize){var j=0,x=0;j=this._width?this._width-Y[3]-Y[1]:this._textWidth,x=this._height?this._height-Y[0]-Y[2]:this._textHeight,j*=w,x*=w,O.clipRect(Y[3],Y[0],j,x)}else O.clipRect(Y[3],Y[0],this._width?this._width-Y[3]-Y[1]:this._textWidth,this._height?this._height-Y[0]-Y[2]:this._textHeight);var r=J.password;"prompt"in this&&this.prompt==this._text&&(r=!1);for(var H=0,h=0,Q=Math.min(this._lines.length,F+U)||1,X=U;X<Q;X++){var N,K=u[X];if(r){var f=K.length;K="";for(var I=f;0<I;I--)K+="●"}if(H=c-(this._clipPoint?this._clipPoint.x:0),h=b+d*X-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(L,H,h,X),a){var T=this.width;a.autoScaleSize&&(T=this.width*w),a.drawText(K,this,H,h,this.align,T)}else k.isWebGL?(this._words||(this._words=[]),(N=this._words.length>X-U?this._words[X-U]:new E).setText(K)):N=K,J.stroke?O.fillBorderText(N,H,h,P,this.color,J.strokeColor,J.stroke,L):O.fillText(N,H,h,P,this.color,L)}if(a&&a.autoScaleSize){var g=1/w;this.scale(g,g)}this._clipPoint&&O.restore(),this._startX=c,this._startY=b},U.drawUnderline=function(U,F,O,P){var Y=this._lineWidths[P];switch(U){case"center":F-=Y/2;break;case"right":F-=Y}O+=this._charSize.height,this._graphics.drawLine(F,O,F+Y,O,this.underlineColor||this.color,1)},U.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);m.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new I(0,0)):this._clipPoint=null;var U=this._lines.length;if(this.overflow!=w.VISIBLE){var F=this.overflow==w.HIDDEN?Math.floor:Math.ceil;U=Math.min(U,F((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var O=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(O,U),this.repaint()},U.evalTextSize=function(){var U,F=NaN;U=Math.max.apply(this,this._lineWidths),F=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],U==this._textWidth&&F==this._textHeight||(this._textWidth=U,this._textHeight=F,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},U.checkEnabledViewportOrNot=function(){return this.overflow==w.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},U.changeText=function(U){this._text!==U&&(this.lang(U+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},U.parseLines=function(U){var F=this.wordWrap||this.overflow==w.HIDDEN;if(F)var O=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var P=S.contextMeasureText(w._testWord);k.isConchApp&&0===P.width&&0===P.height&&(P=S.contextMeasureText("W")),this._charSize.width=P.width,this._charSize.height=P.height||this.fontSize}for(var Y=U.replace(/\r\n/g,"\n").split("\n"),c=0,L=Y.length;c<L;c++){var u=Y[c];F?this.parseLine(u,O):(this._lineWidths.push(this.getTextWidth(u)),this._lines.push(u))}},U.parseLine=function(U,F){m.context;var O,P=this._lines,Y=0,c=NaN,L=NaN,u=0;if((c=this.getTextWidth(U))<=F)return P.push(U),void this._lineWidths.push(c);c=this._charSize.width,0==(Y=Math.floor(F/c))&&(Y=1),L=c=this.getTextWidth(U.substring(0,Y));for(var d=Y,a=U.length;d<a;d++)if(F<(L+=c=this.getTextWidth(U.charAt(d))))if(this.wordWrap){var b=U.substring(u,d);if(b.charCodeAt(b.length-1)<255?(O=/(?:\w|-)+$/.exec(b))&&(d=O.index+u,0==O.index?d+=b.length:b=U.substring(u,d)):w.RightToLeft&&(O=/([\u0600-\u06FF])+$/.exec(b))&&(d=O.index+u,0==O.index?d+=b.length:b=U.substring(u,d)),P.push(b),this._lineWidths.push(L-c),!((u=d)+Y<a)){P.push(U.substring(u,a)),this._lineWidths.push(this.getTextWidth(P[P.length-1])),u=-1;break}d+=Y,L=c=this.getTextWidth(U.substring(u,d)),d--}else if(this.overflow==w.HIDDEN)return P.push(U.substring(0,d)),void this._lineWidths.push(this.getTextWidth(P[P.length-1]));this.wordWrap&&-1!=u&&(P.push(U.substring(u,a)),this._lineWidths.push(this.getTextWidth(P[P.length-1])))},U.getTextWidth=function(U){return this._currBitmapFont?this._currBitmapFont.getTextWidth(U):S.contextMeasureText(U).width},U.getWordWrapWidth=function(){var U=this.padding,F=NaN;return(F=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(F=this.wordWrap?100:m.width),F<=0&&(F=100),F-U[3]-U[1]},U.getCharPoint=function(U,F){this._isChanged&&f.timer.runCallLater(this,this.typeset);for(var O=0,P=this._lines,Y=0,c=0,L=P.length;c<L;c++){if(U<(O+=P[c].length)){var u=c;break}Y=O}var d=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;m.context.font=d;var a=this.getTextWidth(this._text.substring(Y,U));return(F||new I).setTo(this._startX+a-(this._clipPoint?this._clipPoint.x:0),this._startY+u*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},b(0,U,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(U){U!=this._width&&(f.superSet(zU,this,"width",U),this.isChanged=!0)}),b(0,U,"textWidth",function(){return this._isChanged&&f.timer.runCallLater(this,this.typeset),this._textWidth}),b(0,U,"height",function(){return this._height?this._height:this.textHeight},function(U){U!=this._height&&(f.superSet(zU,this,"height",U),this.isChanged=!0)}),b(0,U,"textHeight",function(){return this._isChanged&&f.timer.runCallLater(this,this.typeset),this._textHeight}),b(0,U,"padding",function(){return this._getCSSStyle().padding},function(U){this._getCSSStyle().padding=U,this.isChanged=!0}),b(0,U,"bold",function(){return this._getCSSStyle().bold},function(U){this._getCSSStyle().bold=U,this.isChanged=!0}),b(0,U,"text",function(){return this._text||""},function(U){this._text!==U&&(this.lang(U+""),this.isChanged=!0,this.event("change"))}),b(0,U,"color",function(){return this._getCSSStyle().color},function(U){this._getCSSStyle().color!=U&&(this._getCSSStyle().color=U,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),b(0,U,"font",function(){return this._getCSSStyle().fontFamily},function(U){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),w._bitmapFonts&&w._bitmapFonts[U]&&(this._currBitmapFont=w._bitmapFonts[U]),this._getCSSStyle().fontFamily=U,this.isChanged=!0}),b(0,U,"fontSize",function(){return this._getCSSStyle().fontSize},function(U){this._getCSSStyle().fontSize=U,this.isChanged=!0}),b(0,U,"italic",function(){return this._getCSSStyle().italic},function(U){this._getCSSStyle().italic=U,this.isChanged=!0}),b(0,U,"align",function(){return this._getCSSStyle().align},function(U){this._getCSSStyle().align=U,this.isChanged=!0}),b(0,U,"valign",function(){return this._getCSSStyle().valign},function(U){this._getCSSStyle().valign=U,this.isChanged=!0}),b(0,U,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(U){this._getCSSStyle().wordWrap=U,this.isChanged=!0}),b(0,U,"leading",function(){return this._getCSSStyle().leading},function(U){this._getCSSStyle().leading=U,this.isChanged=!0}),b(0,U,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(U){this._getCSSStyle().backgroundColor=U,this.isChanged=!0}),b(0,U,"borderColor",function(){return this._getCSSStyle().borderColor},function(U){this._getCSSStyle().borderColor=U,this.isChanged=!0}),b(0,U,"stroke",function(){return this._getCSSStyle().stroke},function(U){this._getCSSStyle().stroke=U,this.isChanged=!0}),b(0,U,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(U){this._getCSSStyle().strokeColor=U,this.isChanged=!0}),b(0,U,"isChanged",null,function(U){this._isChanged!==U&&(this._isChanged=U)&&f.timer.callLater(this,this.typeset)}),b(0,U,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(U){if(!(this.overflow!=w.SCROLL||this.textWidth<this._width)&&this._clipPoint){U=U<this.padding[3]?this.padding[3]:U;var F=this._textWidth-this._width;U=F<U?F:U;var O=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=U,this.renderText(this._lastVisibleLineIndex,O)}}),b(0,U,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(U){if(!(this.overflow!=w.SCROLL||this.textHeight<this._height)&&this._clipPoint){U=U<this.padding[0]?this.padding[0]:U;var F=this._textHeight-this._height,O=(U=F<U?F:U)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=O;var P=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=U,this.renderText(O,P)}}),b(0,U,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),b(0,U,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),b(0,U,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),b(0,U,"underlineColor",function(){return this._underlineColor},function(U){this._underlineColor=U,this._isChanged=!0,this.typeset()}),w.registerBitmapFont=function(U,F){w._bitmapFonts||(w._bitmapFonts={}),w._bitmapFonts[U]=F},w.unregisterBitmapFont=function(U,F){if(void 0===F&&(F=!0),w._bitmapFonts&&w._bitmapFonts[U]){var O=w._bitmapFonts[U];F&&O.destroy(),delete w._bitmapFonts[U]}},w.setTextRightToLeft=function(){var U;(U=m.canvas.source.style).display="none",U.position="absolute",U.direction="rtl",k._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,m.document.body.appendChild(m.canvas.source)},w.supportFont=function(U){m.context.font="10px sans-serif";var F=S.contextMeasureText("abcji").width;m.context.font="10px "+U;var O=S.contextMeasureText("abcji").width;return console.log(F,O),F!==O},w._testWord="游",w.langPacks=null,w.VISIBLE="visible",w.SCROLL="scroll",w.HIDDEN="hidden",w.CharacterCache=!0,w.RightToLeft=!1,w._bitmapFonts=null,d(w,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),w}(zU),HU=function(z){function L(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",L.__super.call(this),this.offset=new I,this._canvasTransform=new s,this._previousOrientation=m.window.orientation;var F=this;this.transform=s.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var U=m.window,O=this;U.addEventListener("focus",function(){F._isFocused=!0,O.event("focus"),O.event("focuschange")}),U.addEventListener("blur",function(){F._isFocused=!1,O.event("blur"),O.event("focuschange"),O._isInputting()&&(NU.inputElement.target.focus=!1)});var P="visibilityState",Y="visibilitychange",c=U.document;void 0!==c.hidden?(Y="visibilitychange",P="visibilityState"):void 0!==c.mozHidden?(Y="mozvisibilitychange",P="mozVisibilityState"):void 0!==c.msHidden?(Y="msvisibilitychange",P="msVisibilityState"):void 0!==c.webkitHidden&&(Y="webkitvisibilitychange",P="webkitVisibilityState"),U.document.addEventListener(Y,function(){"hidden"==m.document[P]?O._setStageVisible(!1):O._setStageVisible(!0)}),U.document.addEventListener("qbrowserVisibilityChange",function(U){O._setStageVisible(!U.hidden)}),U.addEventListener("resize",function(){var U=m.window.orientation;null!=U&&U!=F._previousOrientation&&O._isInputting()&&(NU.inputElement.target.focus=!1),F._previousOrientation=U,O._isInputting()||O._resetCanvas()}),U.addEventListener("orientationchange",function(U){O._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),m.onMobile&&this.on("mousedown",this,this._onmouseMove)}x(L,"laya.display.Stage",z);var U=L.prototype;return U._setStageVisible=function(U){this._isVisibility!=U&&(this._isVisibility=U,this._isVisibility||this._isInputting()&&(NU.inputElement.target.focus=!1),this.event("visibilitychange"))},U._isInputting=function(){return m.onMobile&&NU.isInputting},U._changeCanvasSize=function(){this.setScreenSize(m.clientWidth*m.pixelRatio,m.clientHeight*m.pixelRatio)},U._resetCanvas=function(){if(this.screenAdaptationEnabled){var U=k._mainCanvas;U.source.style;U.size(1,1),f.timer.once(100,this,this._changeCanvasSize)}},U.setScreenSize=function(U,F){var O=!1;if("none"!==this._screenMode&&(O=(U/F<1?"vertical":"horizontal")!==this._screenMode)){var P=F;F=U,U=P}this.canvasRotation=O;var Y=k._mainCanvas,c=Y.source.style,L=this._canvasTransform.identity(),u=this._scaleMode,d=U/this.designWidth,a=F/this.designHeight,b=this.designWidth,z=this.designHeight,J=U,w=F,j=m.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,u){case"noscale":d=a=1,J=this.designWidth,w=this.designHeight;break;case"showall":d=a=Math.min(d,a),b=J=Math.round(this.designWidth*d),z=w=Math.round(this.designHeight*a);break;case"noborder":d=a=Math.max(d,a),J=Math.round(this.designWidth*d),w=Math.round(this.designHeight*a);break;case"full":d=a=1,this._width=b=U,this._height=z=F;break;case"fixedwidth":a=d,this._height=z=Math.round(F/d);break;case"fixedheight":d=a,this._width=b=Math.round(U/a);break;case"fixedauto":U/F<this.designWidth/this.designHeight?(a=d,this._height=z=Math.round(F/d)):(d=a,this._width=b=Math.round(U/a))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,b=b+1&2147483646,z=z+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),d*=this.scaleX,a*=this.scaleY,1===d&&1===a?this.transform.identity():(this.transform.a=this._formatData(d/(J/b)),this.transform.d=this._formatData(a/(w/z)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),Y.size(b,z),C.changeWebGLSize(b,z),L.scale(J/b/j,w/z/j),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(U-J)/j:this.offset.x=.5*(U-J)/j,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(F-w)/j:this.offset.y=.5*(F-w)/j,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),L.translate(this.offset.x,this.offset.y),this.canvasDegree=0,O&&("horizontal"===this._screenMode?(L.rotate(Math.PI/2),L.translate(F/j,0),this.canvasDegree=90):(L.rotate(-Math.PI/2),L.translate(0,U/j),this.canvasDegree=-90)),L.a=this._formatData(L.a),L.d=this._formatData(L.d),L.tx=this._formatData(L.tx),L.ty=this._formatData(L.ty),c.transformOrigin=c.webkitTransformOrigin=c.msTransformOrigin=c.mozTransformOrigin=c.oTransformOrigin="0px 0px 0px",c.transform=c.webkitTransform=c.msTransform=c.mozTransform=c.oTransform="matrix("+L.toString()+")",L.translate(parseInt(c.left)||0,parseInt(c.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},U._formatData=function(U){return Math.abs(U)<1e-6?0:Math.abs(1-U)<.001?0<U?1:-1:U},U.getMousePoint=function(){return I.TEMP.setTo(this.mouseX,this.mouseY)},U.repaint=function(){this._repaint=1},U.parentRepaint=function(){},U._loop=function(){return this.render(k.context,0,0),!0},U._onmouseMove=function(U){this._mouseMoveTime=m.now()},U.getTimeFromFrameStart=function(){return m.now()-this._frameStartTime},U.render=function(U,F,O){if("sleep"===this._frameRate&&!k.isConchApp){var P=m.now();if(!(1e3<=P-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(v.loopCount++,j.instance.runEvent(),f.timer._update()));this._frameStartTime=P}if(this._renderCount++,k.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=m.now();var Y="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),c=this._renderCount%2==0;if(v.renderSlow=!Y,Y||c||k.isConchApp){var L;v.loopCount++,j.instance.runEvent(),f.timer._update(),C.update3DLoop();var u=0,d=0;if(k.isConchNode)for(u=0,d=this._scenes.length;u<d;u++)(L=this._scenes[u])&&L._updateSceneConch();else for(u=0,d=this._scenes.length;u<d;u++)(L=this._scenes[u])&&L._updateScene();if(k.isConchNode){var a=zU.CustomList;for(u=0,d=a.length;u<d;u++){var b=a[u];b.customRender(b.customContext,0,0)}return}}k.isConchNode||this.renderingEnabled&&(Y||!c||k.isConchWebGL)&&(k.isWebGL?k.WebGL.mainContext&&!k.WebGL.mainContext.isContextLost()&&(U.clear(),z.prototype.render.call(this,U,F,O),v._show&&v._sp&&v._sp.render(U,F,O),C.clear(this._bgColor),C.beginFlush(),U.flush(),C.endFinish(),W.instance&&W.getInstance().endDispose()):(C.clear(this._bgColor),z.prototype.render.call(this,U,F,O),v._show&&v._sp&&v._sp.render(U,F,O)))}else this._renderCount%5==0&&(v.loopCount++,j.instance.runEvent(),f.timer._update())},U._requestFullscreen=function(){var U=m.document.documentElement;U.requestFullscreen?U.requestFullscreen():U.mozRequestFullScreen?U.mozRequestFullScreen():U.webkitRequestFullscreen?U.webkitRequestFullscreen():U.msRequestFullscreen&&U.msRequestFullscreen()},U._fullScreenChanged=function(){f.stage.event("fullscreenchange")},U.exitFullscreen=function(){var U=m.document;U.exitFullscreen?U.exitFullscreen():U.mozCancelFullScreen?U.mozCancelFullScreen():U.webkitExitFullscreen&&U.webkitExitFullscreen()},b(0,U,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),b(0,U,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),b(0,U,"frameRate",function(){return this._frameRate},function(U){if(this._frameRate=U,k.isConchApp)switch(this._frameRate){case"slow":m.window.conch&&m.window.conchConfig.setSlowFrame&&m.window.conchConfig.setSlowFrame(!0);break;case"fast":m.window.conch&&m.window.conchConfig.setSlowFrame&&m.window.conchConfig.setSlowFrame(!1);break;case"mouse":m.window.conch&&m.window.conchConfig.setMouseFrame&&m.window.conchConfig.setMouseFrame(2e3);break;case"sleep":m.window.conch&&m.window.conchConfig.setLimitFPS&&m.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),b(0,U,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),b(0,U,"width",z.prototype._$get_width,function(U){this.designWidth=U,f.superSet(zU,this,"width",U),f.timer.callLater(this,this._changeCanvasSize)}),b(0,U,"alignH",function(){return this._alignH},function(U){this._alignH=U,f.timer.callLater(this,this._changeCanvasSize)}),b(0,U,"isFocused",function(){return this._isFocused}),b(0,U,"height",z.prototype._$get_height,function(U){this.designHeight=U,f.superSet(zU,this,"height",U),f.timer.callLater(this,this._changeCanvasSize)}),b(0,U,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||s.create()},z.prototype._$set_transform),b(0,U,"isVisibility",function(){return this._isVisibility}),b(0,U,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),b(0,U,"scaleMode",function(){return this._scaleMode},function(U){this._scaleMode=U,f.timer.callLater(this,this._changeCanvasSize)}),b(0,U,"alignV",function(){return this._alignV},function(U){this._alignV=U,f.timer.callLater(this,this._changeCanvasSize)}),b(0,U,"bgColor",function(){return this._bgColor},function(U){this._bgColor=U,this.conchModel&&this.conchModel.bgColor(U),k.isWebGL&&(U?L._wgColor=_.create(U)._color:m.onMiniGame||(L._wgColor=null)),m.onLimixiu?L._wgColor=_.create(U)._color:k.canvas.style.background=U||"none"}),b(0,U,"mouseX",function(){return Math.round(j.instance.mouseX/this.clientScaleX)}),b(0,U,"mouseY",function(){return Math.round(j.instance.mouseY/this.clientScaleY)}),b(0,U,"screenMode",function(){return this._screenMode},function(U){this._screenMode=U}),b(0,U,"visible",z.prototype._$get_visible,function(U){this.visible!==U&&(f.superSet(zU,this,"visible",U),k._mainCanvas.source.style.visibility=U?"visible":"hidden")}),b(0,U,"fullScreenEnabled",null,function(U){var F=m.document,O=k.canvas;U?(O.addEventListener("mousedown",this._requestFullscreen),O.addEventListener("touchstart",this._requestFullscreen),F.addEventListener("fullscreenchange",this._fullScreenChanged),F.addEventListener("mozfullscreenchange",this._fullScreenChanged),F.addEventListener("webkitfullscreenchange",this._fullScreenChanged),F.addEventListener("msfullscreenchange",this._fullScreenChanged)):(O.removeEventListener("mousedown",this._requestFullscreen),O.removeEventListener("touchstart",this._requestFullscreen),F.removeEventListener("fullscreenchange",this._fullScreenChanged),F.removeEventListener("mozfullscreenchange",this._fullScreenChanged),F.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),F.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),L.SCALE_NOSCALE="noscale",L.SCALE_EXACTFIT="exactfit",L.SCALE_SHOWALL="showall",L.SCALE_NOBORDER="noborder",L.SCALE_FULL="full",L.SCALE_FIXED_WIDTH="fixedwidth",L.SCALE_FIXED_HEIGHT="fixedheight",L.SCALE_FIXED_AUTO="fixedauto",L.ALIGN_LEFT="left",L.ALIGN_RIGHT="right",L.ALIGN_CENTER="center",L.ALIGN_TOP="top",L.ALIGN_MIDDLE="middle",L.ALIGN_BOTTOM="bottom",L.SCREEN_NONE="none",L.SCREEN_HORIZONTAL="horizontal",L.SCREEN_VERTICAL="vertical",L.FRAME_FAST="fast",L.FRAME_SLOW="slow",L.FRAME_MOUSE="mouse",L.FRAME_SLEEP="sleep",L.FRAME_MOUSE_THREDHOLD=2e3,d(L,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),L}(zU),hU=(function(U){function F(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,F.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}x(F,"laya.media.SoundNode",zU);var O=F.prototype;O._onParentChange=function(){this.target=this.parent},O.play=function(U,F){void 0===U&&(U=1),isNaN(U)&&(U=1),this.url&&(this.stop(),this._channel=$.playSound(this.url,U,null,F))},O.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},O._setPlayAction=function(U,F,O,P){void 0===P&&(P=!0),this[O]&&U&&(P?U.on(F,this,this[O]):U.off(F,this,this[O]))},O._setPlayActions=function(U,F,O,P){if(void 0===P&&(P=!0),U&&F){var Y,c=F.split(","),L=0;for(Y=c.length,L=0;L<Y;L++)this._setPlayAction(U,c[L],O,P)}},b(0,O,"playEvent",null,function(U){(this._playEvents=U)&&this._tar&&this._setPlayActions(this._tar,U,"play")}),b(0,O,"target",null,function(U){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=U,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),b(0,O,"stopEvent",null,function(U){(this._stopEvents=U)&&this._tar&&this._setPlayActions(this._tar,U,"stop")})}(),function(U){function F(){this._src=null,this._onload=null,this._onerror=null,F.__super.call(this)}x(F,"laya.resource.FileBitmap",jU);var O=F.prototype;return b(0,O,"src",function(){return this._src},function(U){this._src=U}),b(0,O,"onload",null,function(U){}),b(0,O,"onerror",null,function(U){}),F}()),QU=function(U){function O(U,F){this._is2D=!1,O.__super.call(this);var P=this;if(this._source=this,"2D"===U||"AUTO"===U&&!k.isWebGL){this._is2D=!0,this._source=F||m.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var Y=this;Y.getContext=function(U,F){if(P._ctx)return P._ctx;var O=P._ctx=P._source.getContext(U,F);return O&&(O._canvas=Y,k.isFlash||m.onLimixiu||(O.size=function(U,F){})),O}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}x(O,"laya.resource.HTMLCanvas",jU);var F=O.prototype;return F.clear=function(){this._ctx&&this._ctx.clear()},F.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},F.release=function(){},F._setContext=function(U){this._ctx=U},F.getContext=function(U,F){return this._ctx?this._ctx:this._ctx=O._createContext(this)},F.getMemSize=function(){return 0},F.size=function(U,F){(this._w!=U||this._h!=F||this._source&&(this._source.width!=U||this._source.height!=F))&&(this._w=U,this._h=F,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(U,F),this._source&&(this._source.height=F,this._source.width=U))},F.getCanvas=function(){return this._source},F.toBase64=function(U,F,O){if(this._source)if(k.isConchApp&&this._source.toBase64)this._source.toBase64(U,F,O);else{var P=this._source.toDataURL(U,F);O.call(this,P)}},b(0,F,"context",function(){return this._ctx}),b(0,F,"asBitmap",null,function(U){}),O.create=function(U,F){return new O(U,F)},O.TYPE2D="2D",O.TYPE3D="3D",O.TYPEAUTO="AUTO",O._createContext=null,O}(),XU=(function(U){function d(U,F,O,P,Y,c,L,u){throw d.__super.call(this),new Error("不允许new！")}x(d,"laya.resource.HTMLSubImage",jU),d.create=function(U,F,O,P,Y,c,L,u){return void 0===u&&(u=!1),new d(U,F,O,P,Y,c,L,u)}}(),function(U){function z(){this._frames=null,this._url=null,z.__super.call(this),this._setControlNode(this)}x(z,"laya.display.Animation",U);var F=z.prototype;F.destroy=function(U){void 0===U&&(U=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,U),this._frames=null,this._labels=null},F.play=function(U,F,O,P){void 0===U&&(U=0),void 0===F&&(F=!0),void 0===O&&(O=""),void 0===P&&(P=!0),O&&this._setFramesFromCache(O,P),this._isPlaying=!0,this.index="string"==typeof U?this._getFrameByLabel(U):U,this.loop=F,this._actionName=O,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},F._setFramesFromCache=function(U,F){var O;return void 0===F&&(F=!1),this._url&&(U=this._url+"#"+U),U&&z.framesMap[U]?((O=z.framesMap[U])instanceof Array?(this._frames=z.framesMap[U],this._count=this._frames.length):(O.nodeRoot&&(z.framesMap[U]=this._parseGraphicAnimationByData(O),O=z.framesMap[U]),this._frames=O.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=O.interval),this._labels=this._copyLabels(O.labels)),!0):(F&&console.log("ani not found:",U),!1)},F._copyLabels=function(U){if(!U)return null;var F,O;for(O in F={},U)F[O]=S.copyArray([],U[O]);return F},F._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&U.prototype._frameLoop.call(this)},F._displayToIndex=function(U){this._frames&&(this.graphics=this._frames[U])},F.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},F.loadImages=function(U,F){return void 0===F&&(F=""),this._url="",this._setFramesFromCache(F)||(this.frames=z.framesMap[F]?z.framesMap[F]:z.createFrames(U,F)),this},F.loadAtlas=function(F,O,P){void 0===P&&(P=""),this._url="";var Y=this;function U(U){F===U&&(Y.frames=z.framesMap[P]?z.framesMap[P]:z.createFrames(F,P),O&&O.run())}return Y._setFramesFromCache(P)||(uU.getAtlas(F)?U(F):f.loader.load(F,h.create(null,U,[F]),null,"atlas")),this},F.loadAnimation=function(U,F,O){this._url=U;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,F&&F.run()):!O||uU.getAtlas(O)?this._loadAnimationData(U,F,O):f.loader.load(O,h.create(this,this._loadAnimationData,[U,F,O]),null,"atlas"),this},F._loadAnimationData=function(u,d,U){var a=this;if(!U||uU.getAtlas(U)){var b=this;uU.getRes(u)?F(u):f.loader.load(u,h.create(null,F,[u]),null,"json"),uU.clearRes(u)}else console.warn("atlas load fail:"+U);function F(U){if(uU.getRes(U)&&u===U){var F;if(z.framesMap[u+"#"])b._setFramesFromCache(a._actionName,!0),a.index=0,a._checkResumePlaying();else{var O=b._parseGraphicAnimation(uU.getRes(u));if(!O)return;var P,Y=O.animationList,c=0,L=Y.length;for(c=0;c<L;c++)F=Y[c],z.framesMap[u+"#"+F.name]=F,P||(P=F);P&&(z.framesMap[u+"#"]=P,b._setFramesFromCache(a._actionName,!0),a.index=0),a._checkResumePlaying()}d&&d.run()}}},F._parseGraphicAnimation=function(U){return fU.parseAnimationData(U)},F._parseGraphicAnimationByData=function(U){return fU.parseAnimationByData(U)},b(0,F,"frames",function(){return this._frames},function(U){(this._frames=U)&&(this._count=U.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),b(0,F,"autoPlay",null,function(U){U?this.play():this.stop()}),b(0,F,"source",null,function(U){-1<U.indexOf(".ani")?this.loadAnimation(U):-1<U.indexOf(".json")||-1<U.indexOf("als")||-1<U.indexOf("atlas")?this.loadAtlas(U):this.loadImages(U.split(","))}),b(0,F,"autoAnimation",null,function(U){this.play(0,!0,U,!1)}),z.createFrames=function(U,F){var O,P,Y=0,c=0;if("string"==typeof U){var L=uU.getAtlas(U);if(L&&L.length)for(O=[],Y=0,c=L.length;Y<c;Y++)(P=new C.createGraphics).drawTexture(uU.getRes(L[Y]),0,0),O.push(P)}else if(U instanceof Array)for(O=[],Y=0,c=U.length;Y<c;Y++)(P=new C.createGraphics).loadImage(U[Y],0,0),O.push(P);return F&&(z.framesMap[F]=O),O},z.clearCache=function(U){var F,O=z.framesMap,P=U+"#";for(F in O)F!==U&&0!=F.indexOf(P)||delete z.framesMap[F]},z.framesMap={}}(xU),function(U){function c(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,c.__super.call(this),null==c._sortIndexFun&&(c._sortIndexFun=K.sortByKey("index",!1,!0))}x(c,"laya.display.FrameAnimation",U);var F=c.prototype;return F._setUp=function(U,F){this._labels=null,this._animationNewFrames=null,this._targetDic=U,this._animationData=F,this.interval=1e3/F.frameRate,F.parsed?(this._count=F.count,this._labels=F.labels,this._animationNewFrames=F.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),F.parsed=!0,F.labels=this._labels,F.count=this._count,F.animationNewFrames=this._animationNewFrames},F.clear=function(){U.prototype.clear.call(this),this._targetDic=null,this._animationData=null},F._displayToIndex=function(U){if(this._animationData){U<0&&(U=0),U>this._count&&(U=this._count);var F=this._animationData.nodes,O=0,P=F.length;for(O=0;O<P;O++)this._displayNodeToFrame(F[O],U)}},F._displayNodeToFrame=function(U,F,O){O||(O=this._targetDic);var P=O[U.target];if(P){var Y,c,L,u=U.frames,d=U.keys,a=0,b=d.length;for(a=0;a<b;a++)L=(c=u[Y=d[a]]).length>F?c[F]:c[c.length-1],P[Y]=L}},F._calculateDatas=function(){if(this._animationData){var U,F=this._animationData.nodes,O=0,P=F.length;for(O=this._count=0;O<P;O++)U=F[O],this._calculateNodeKeyFrames(U);this._count+=1}},F._calculateNodeKeyFrames=function(U){var F,O,P=U.keyframes,Y=U.target;for(F in U.frames||(U.frames={}),U.keys?U.keys.length=0:U.keys=[],U.initValues||(U.initValues={}),P)O=P[F],U.frames[F]||(U.frames[F]=[]),this._targetDic&&this._targetDic[Y]&&(U.initValues[F]=this._targetDic[Y][F]),O.sort(c._sortIndexFun),U.keys.push(F),this._calculateNodePropFrames(O,U.frames[F],F,Y)},F.resetToInitState=function(){if(this._targetDic&&this._animationData){var U,F,O=this._animationData.nodes,P=0,Y=O.length;for(P=0;P<Y;P++)if(F=(U=O[P]).initValues){var c,L=this._targetDic[U.target];if(L)for(c in F)L[c]=F[c]}}},F._calculateNodePropFrames=function(U,F,O,P){var Y=0,c=U.length-1;if(0<c){for(F.length=U[c].index+1,Y=0;Y<c;Y++)this._dealKeyFrame(U[Y]),this._calculateFrameValues(U[Y],U[Y+1],F);this._dealKeyFrame(U[Y])}0==c&&(F[U[0].index]=U[0].value,this._animationNewFrames&&(this._animationNewFrames[U[0].index]=!0))},F._dealKeyFrame=function(U){U.label&&""!=U.label&&this.addLabel(U.label,U.index)},F._calculateFrameValues=function(U,F,O){var P,Y=0,c=U.index,L=F.index,u=U.value,d=F.value-U.value,a=L-c;if(L>this._count&&(this._count=L),U.tween)for(null==(P=D[U.tweenMethod])&&(P=D.linearNone),Y=c;Y<L;Y++)O[Y]=P(Y-c,u,d,a),this._animationNewFrames&&(this._animationNewFrames[Y]=!0);else for(Y=c;Y<L;Y++)O[Y]=u;this._animationNewFrames&&(this._animationNewFrames[U.index]=!0,this._animationNewFrames[F.index]=!0),O[F.index]=F.value},c._sortIndexFun=null,c}(xU)),NU=function(F){function Y(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",Y.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=rU.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}x(Y,"laya.display.Input",F);var U=Y.prototype;return U.setSelection=function(U,F){this.focus=!0,laya.display.Input.inputElement.selectionStart=U,laya.display.Input.inputElement.selectionEnd=F},U._onUnDisplay=function(U){this.focus=!1},U._onMouseDown=function(U){this.focus=!0},U._syncInputTransform=function(){var U=this.nativeInput,F=S.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),O=this._width-this.padding[1]-this.padding[3],P=this._height-this.padding[0]-this.padding[2];k.isConchApp?(U.setScale(F.scaleX,F.scaleY),U.setSize(O,P),U.setPos(F.x,F.y)):(Y.inputContainer.style.transform=Y.inputContainer.style.webkitTransform="scale("+F.scaleX+","+F.scaleY+") rotate("+f.stage.canvasDegree+"deg)",U.style.width=O+"px",U.style.height=P+"px",Y.inputContainer.style.left=F.x+"px",Y.inputContainer.style.top=F.y+"px")},U.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},U._setInputMethod=function(){Y.input.parentElement&&Y.inputContainer.removeChild(Y.input),Y.area.parentElement&&Y.inputContainer.removeChild(Y.area),Y.inputElement=this._multiline?Y.area:Y.input,Y.inputContainer.appendChild(Y.inputElement),rU.RightToLeft&&(Y.inputElement.style.direction="rtl")},U._focusIn=function(){laya.display.Input.isInputting=!0;var U=this.nativeInput;this._focus=!0;var F=U.style;F.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),U.readOnly=!this._editable,k.isConchApp&&(U.setType(this._type),U.setForbidEdit(!this._editable)),U.maxLength=this._maxChars;this.padding;if(U.type=this._type,U.value=this._content,U.placeholder=this._prompt,f.stage.off("keydown",this,this._onKeyDown),f.stage.on("keydown",this,this._onKeyDown),(f.stage.focus=this).event("focus"),m.onPC&&U.focus(),!m.onMiniGame){this._text;this._text=null}this.typeset(),U.setColor(this._originColor),U.setFontSize(this.fontSize),U.setFontFace(m.onIPhone&&rU._fontFamilyMap[this.font]||this.font),k.isConchApp&&U.setMultiAble&&U.setMultiAble(this._multiline),F.lineHeight=this.leading+this.fontSize+"px",F.fontStyle=this.italic?"italic":"normal",F.fontWeight=this.bold?"bold":"normal",F.textAlign=this.align,F.padding="0 0",this._syncInputTransform(),!k.isConchApp&&m.onPC&&f.timer.frameLoop(1,this,this._syncInputTransform)},U._setPromptColor=function(){(Y.promptStyleDOM=m.getElementById("promptStyle"))||((Y.promptStyleDOM=m.createElement("style")).setAttribute("id","promptStyle"),m.document.head.appendChild(Y.promptStyleDOM)),Y.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},U._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(f.superSet(rU,this,"text",this._content),f.superSet(rU,this,"color",this._originColor)):(f.superSet(rU,this,"text",this._prompt),f.superSet(rU,this,"color",this._promptColor)),f.stage.off("keydown",this,this._onKeyDown),f.stage.focus=null,this.event("blur"),k.isConchApp&&this.nativeInput.blur(),m.onPC&&f.timer.clear(this,this._syncInputTransform)},U._onKeyDown=function(U){13===U.keyCode&&(m.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},U.changeText=function(U){this._content=U,this._focus?(this.nativeInput.value=U||"",this.event("change")):F.prototype.changeText.call(this,U)},b(0,U,"color",F.prototype._$get_color,function(U){this._focus&&this.nativeInput.setColor(U),f.superSet(rU,this,"color",this._content?U:this._promptColor),this._originColor=U}),b(0,U,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(U){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),b(0,U,"multiline",function(){return this._multiline},function(U){this._multiline=U,this.valign=U?"top":"middle"}),b(0,U,"maxChars",function(){return this._maxChars},function(U){U<=0&&(U=1e5),this._maxChars=U}),b(0,U,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(U){f.superSet(rU,this,"color",this._originColor),U+="",this._focus?(this.nativeInput.value=U||"",this.event("change")):(this._multiline||(U=U.replace(/\r?\n/g,"")),(this._content=U)?f.superSet(rU,this,"text",U):(f.superSet(rU,this,"text",this._prompt),f.superSet(rU,this,"color",this.promptColor)))}),b(0,U,"nativeInput",function(){return this._multiline?Y.area:Y.input}),b(0,U,"prompt",function(){return this._prompt},function(U){!this._text&&U&&f.superSet(rU,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?f.superSet(rU,this,"text",this._text==this._prompt?U:this._text):f.superSet(rU,this,"text",U),this._prompt=rU.langPacks&&rU.langPacks[U]?rU.langPacks[U]:U}),b(0,U,"focus",function(){return this._focus},function(U){var F=this.nativeInput;this._focus!==U&&(U?(F.target?F.target._focusOut():this._setInputMethod(),(F.target=this)._focusIn()):(F.target=null,this._focusOut(),m.document.body.scrollTop=0,F.blur(),k.isConchApp?F.setPos(-1e4,-1e4):Y.inputContainer.contains(F)&&Y.inputContainer.removeChild(F)))}),b(0,U,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(U){U?(-1<(U="[^"+U+"]").indexOf("^^")&&(U=U.replace("^^","")),this._restrictPattern=new RegExp(U,"g")):this._restrictPattern=null}),b(0,U,"editable",function(){return this._editable},function(U){this._editable=U,k.isConchApp&&Y.input.setForbidEdit(!U)}),b(0,U,"promptColor",function(){return this._promptColor},function(U){this._promptColor=U,this._content||f.superSet(rU,this,"color",U)}),b(0,U,"type",function(){return this._type},function(U){this._getCSSStyle().password="password"==U,this._type=U,k.isConchApp&&this.nativeInput.setType(U)}),b(0,U,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(U){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),b(0,U,"asPassword",function(){return this._getCSSStyle().password},function(U){this._getCSSStyle().password=U,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),Y.__init__=function(){Y._createInputElement(),m.onMobile&&k.canvas.addEventListener(Y.IOS_IFRAME?m.onMiniGame?"touchend":"click":"touchend",Y._popupInputMethod)},Y._popupInputMethod=function(U){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},Y._createInputElement=function(){Y._initInput(Y.area=m.createElement("textarea")),Y._initInput(Y.input=m.createElement("input")),(Y.inputContainer=m.createElement("div")).style.position="absolute",Y.inputContainer.style.zIndex=1e5,m.container.appendChild(Y.inputContainer),Y.inputContainer.setPos=function(U,F){Y.inputContainer.style.left=U+"px",Y.inputContainer.style.top=F+"px"}},Y._initInput=function(F){var U=F.style;U.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",U.resize="none",U.backgroundColor="transparent",U.border="none",U.outline="none",U.zIndex=1,F.addEventListener("input",Y._processInputting),F.addEventListener("mousemove",Y._stopEvent),F.addEventListener("mousedown",Y._stopEvent),F.addEventListener("touchmove",Y._stopEvent),F.setFontFace=function(U){F.style.fontFamily=U},k.isConchApp||(F.setColor=function(U){F.style.color=U},F.setFontSize=function(U){F.style.fontSize=U+"px"})},Y._processInputting=function(U){var F=laya.display.Input.inputElement.target;if(F){var O=laya.display.Input.inputElement.value;F._restrictPattern&&(O=O.replace(/\u2006|\x27/g,""),F._restrictPattern.test(O)&&(O=O.replace(F._restrictPattern,""),laya.display.Input.inputElement.value=O)),F._text=O,F.event("input")}},Y._stopEvent=function(U){"touchmove"==U.type&&U.preventDefault(),U.stopPropagation&&U.stopPropagation()},Y.TYPE_TEXT="text",Y.TYPE_PASSWORD="password",Y.TYPE_EMAIL="email",Y.TYPE_URL="url",Y.TYPE_NUMBER="number",Y.TYPE_RANGE="range",Y.TYPE_DATE="date",Y.TYPE_MONTH="month",Y.TYPE_WEEK="week",Y.TYPE_TIME="time",Y.TYPE_DATE_TIME="datetime",Y.TYPE_DATE_TIME_LOCAL="datetime-local",Y.TYPE_SEARCH="search",Y.input=null,Y.area=null,Y.inputElement=null,Y.inputContainer=null,Y.confirmButton=null,Y.promptStyleDOM=null,Y.inputHeight=45,Y.isInputting=!1,Y.stageMatrix=null,d(Y,["IOS_IFRAME",function(){return this.IOS_IFRAME=m.onIOS&&m.window.top!=m.window.self}]),Y}(rU),KU=function(U){function O(U,F){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,O.__super.call(this),U&&this._init_(U,F)}x(O,"laya.resource.HTMLImage",hU);var F=O.prototype;return F._init_=function(U,F){this._src=U,this._source=new m.window.Image,F&&(F.onload&&(this.onload=F.onload),F.onerror&&(this.onerror=F.onerror),F.onCreate&&F.onCreate(this)),0!=U.indexOf("data:image")&&(this._source.crossOrigin=""),U&&(this._source.src=U)},F.recreateResource=function(){var U=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var F=this;this._source=new m.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(F._needReleaseAgain)return F._needReleaseAgain=!1,F._source.onload=null,void(F._source=null);F._source.onload=null,F.memorySize=U._w*U._h*4,F._recreateLock=!1,F.completeCreate()},this._source.src=this._src}},F.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},F.onresize=function(){this._w=this._source.width,this._h=this._source.height},b(0,F,"onload",null,function(U){var F=this;this._onload=U,this._source&&(this._source.onload=null!=this._onload?function(){F.onresize(),F._onload()}:null)}),b(0,F,"onerror",null,function(U){var F=this;this._onerror=U,this._source&&(this._source.onerror=null!=this._onerror?function(){F._onerror()}:null)}),b(0,F,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(U){this._enableMerageInAtlas=U,k.isConchApp&&this._source&&(this._source.enableMerageInAtlas=U)}),O.create=function(U,F){return new O(U,F)},O}(),fU=(function(c){function U(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,U.__super.call(this)}x(U,"laya.display.EffectAnimation",c);var F=U.prototype;F._onOtherBegin=function(U){U!=this&&this.stop()},F.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},F._onPlayAction=function(){this.play(0,!1)},F.play=function(U,F,O,P){void 0===U&&(U=0),void 0===F&&(F=!0),void 0===O&&(O=""),void 0===P&&(P=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,U,F,O,P))},F._recordInitData=function(){if(this._aniKeys){var U,F,O=0;for(U=this._aniKeys.length,O=0;O<U;O++)F=this._aniKeys[O],this._initData[F]=this._target[F]}},F._displayToIndex=function(U){if(this._animationData){U<0&&(U=0),U>this._count&&(U=this._count);var F=this._animationData.nodes,O=0,P=F.length;for(P=1<P?1:P,O=0;O<P;O++)this._displayNodeToFrame(F[O],U)}},F._displayNodeToFrame=function(U,F,O){if(this._target){var P;P=this._target;var Y,c,L,u,d=U.frames,a=U.keys,b=0,z=a.length;u=U.secondFrames;var J,w,j,x,r=0;for(b=0;b<z;b++)c=d[Y=a[b]],L=-1==(r=u[Y])?this._initData[Y]:F<r?(j=(w=U.keyframes[Y])[0]).tween?(null==(J=D[j.tweenMethod])&&(J=D.linearNone),x=w[1],J(F,this._initData[Y],x.value-this._initData[Y],x.index)):this._initData[Y]:c.length>F?c[F]:c[c.length-1],P[Y]=L}},F._calculateNodeKeyFrames=function(U){c.prototype._calculateNodeKeyFrames.call(this,U);var F,O,P,Y=U.keyframes;U.target;for(F in P={},U.secondFrames=P,Y)(O=Y[F]).length<=1?P[F]=-1:P[F]=O[1].index},b(0,F,"target",function(){return this._target},function(U){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=U,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),b(0,F,"playEvent",null,function(U){(this._playEvents=U)&&this.addEvent()}),b(0,F,"effectData",null,function(U){var F;U&&((F=U.animations)&&F[0]&&(this._setUp({},F[0]),F[0].nodes&&F[0].nodes[0]&&(this._aniKeys=F[0].nodes[0].keys)))}),b(0,F,"effectClass",null,function(U){var F,O;(this._effectClass=R.getClass(U),this._effectClass)&&((F=this._effectClass.uiView)&&(O=F.animations)&&O[0]&&(this._setUp({},O[0]),O[0].nodes&&O[0].nodes[0]&&(this._aniKeys=O[0].nodes[0].keys)))}),U.EffectAnimationBegin="effectanimationbegin"}(XU),function(F){var l;function $(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$.__super.call(this)}x($,"laya.utils.GraphicAnimation",F);var U=$.prototype;return U._parseNodeList=function(U){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[U.compId]=U.props,U.compId&&this._nodeList.push(U.compId);var F=U.child;if(F){var O=0,P=F.length;for(O=0;O<P;O++)this._parseNodeList(F[O])}},U._calGraphicData=function(U){var F;if(this._setUp(null,U),this._createGraphicData(),this._nodeIDAniDic)for(F in this._nodeIDAniDic)this._nodeIDAniDic[F]=null},U._createGraphicData=function(){var U,F=[],O=0,P=this.count,Y=this._animationNewFrames;for(Y||(Y=[]),O=0;O<P;O++)!Y[O]&&U||(U=this._createFrameGraphic(O)),F.push(U);this._gList=F},U._createFrameGraphic=function(U){var F=C.createGraphics();return $._rootMatrix||($._rootMatrix=new s),this._updateNodeGraphic(this._rootNode,U,$._rootMatrix,F),F},U._updateNodeGraphic=function(U,F,O,P,Y){var c;void 0===Y&&(Y=1);var L,u,d,a=(c=this._nodeGDic[U.compId]=this._getNodeGraphicData(U.compId,F,this._nodeGDic[U.compId])).alpha*Y;if(!(a<.01)&&(c.resultTransform||(c.resultTransform=s.create()),L=c.resultTransform,s.mul(c.transform,O,L),c.skin&&(u=this._getTextureByUrl(c.skin))&&(L._checkTransform()?(P.drawTexture(u,0,0,c.width,c.height,L,a),c.resultTransform=null):P.drawTexture(u,L.tx,L.ty,c.width,c.height,null,a)),d=U.child)){var b,z=0;for(b=d.length,z=0;z<b;z++)this._updateNodeGraphic(d[z],F,L,P,a)}},U._updateNoChilds=function(U,F){if(U.skin){var O=this._getTextureByUrl(U.skin);if(O){var P=U.transform;P._checkTransform();!P.bTransform?F.drawTexture(O,P.tx,P.ty,U.width,U.height,null,U.alpha):F.drawTexture(O,0,0,U.width,U.height,P.clone(),U.alpha)}}},U._updateNodeGraphic2=function(U,F,O){var P;if(P=this._nodeGDic[U.compId]=this._getNodeGraphicData(U.compId,F,this._nodeGDic[U.compId]),U.child){var Y=P.transform;Y._checkTransform();var c,L;L=(c=!Y.bTransform)&&(0!=Y.tx||0!=Y.ty);var u,d,a;if((u=Y.bTransform||1!=P.alpha)&&O.save(),1!=P.alpha&&O.alpha(P.alpha),c?L&&O.translate(Y.tx,Y.ty):O.transform(Y.clone()),d=U.child,P.skin&&(a=this._getTextureByUrl(P.skin))&&O.drawTexture(a,0,0,P.width,P.height),d){var b,z=0;for(b=d.length,z=0;z<b;z++)this._updateNodeGraphic2(d[z],F,O)}u?O.restore():c?L&&O.translate(-Y.tx,-Y.ty):O.transform(Y.clone().invert())}else this._updateNoChilds(P,O)},U._calculateNodeKeyFrames=function(U){F.prototype._calculateNodeKeyFrames.call(this,U),this._nodeIDAniDic[U.target]=U},U.getNodeDataByID=function(U){return this._nodeIDAniDic[U]},U._getParams=function(U,F,O,P){var Y=$._temParam;Y.length=F.length;var c=0,L=F.length;for(c=0;c<L;c++)Y[c]=this._getObjVar(U,F[c][0],O,F[c][1],P);return Y},U._getObjVar=function(U,F,O,P,Y){if(U.hasOwnProperty(F)){var c=U[F];if(O>=c.length&&(O=c.length-1),null!=U[F][O])return U[F][O]}return Y.hasOwnProperty(F)?Y[F]:P},U._getNodeGraphicData=function(U,F,O){O||(O=l.create()),O.transform?O.transform.identity():O.transform=s.create();var P=this.getNodeDataByID(U);if(!P)return O;var Y,c,L=P.frames,u=this._getParams(L,$._drawTextureCmd,F,this._nodeDefaultProps[U]),d=u[0],a=NaN,b=NaN,z=u[5],J=u[6],w=u[13],j=u[14],x=u[7],r=u[8],H=u[9],h=u[11],Q=u[12];a=u[3],b=u[4],0!=a&&0!=b||(d=null),-1==a&&(a=0),-1==b&&(b=0),O.skin=d,O.width=a,O.height=b,d&&((Y=this._getTextureByUrl(d))?(a||(a=Y.sourceWidth),b||(b=Y.sourceHeight)):console.warn("lost skin:",d,",you may load pics first")),O.alpha=u[10],c=O.transform,0!=w&&(z=w*a),0!=j&&(J=j*b),0==z&&0==J||c.translate(-z,-J);var X=null;if(H||1!==x||1!==r||h||Q){(X=$._tempMt).identity(),X.bTransform=!0;var N=.0174532922222222*(H-h),K=.0174532922222222*(H+Q),f=Math.cos(K),I=Math.sin(K),T=Math.sin(N),g=Math.cos(N);X.a=x*f,X.b=x*I,X.c=-r*T,X.d=r*g,X.tx=X.ty=0}return X&&(c=s.mul(c,X,c)),c.translate(u[1],u[2]),O},U._getTextureByUrl=function(U){return uU.getRes(U)},U.setAniData=function(U,F){if(U.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=U,this._parseNodeList(U);var O,P={},Y=[],c=U.animations,L=0,u=c.length;for(L=0;L<u;L++)if(O=c[L],this._labels=null,(!F||F==O.name)&&O){try{this._calGraphicData(O)}catch(U){console.warn("parse animation fail:"+O.name+",empty animation created"),this._gList=[]}var d={};d.interval=1e3/O.frameRate,d.frames=this._gList,d.labels=this._labels,d.name=O.name,Y.push(d),P[O.name]=d}this.animationList=Y,this.animationDic=P}$._temParam.length=0},U.parseByData=function(U){var F,O;F=U.nodeRoot,O=U.aniO,delete U.nodeRoot,delete U.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=F,this._parseNodeList(F),this._labels=null;try{this._calGraphicData(O)}catch(U){console.warn("parse animation fail:"+O.name+",empty animation created"),this._gList=[]}var P=U;return P.interval=1e3/O.frameRate,P.frames=this._gList,P.labels=this._labels,P.name=O.name,P},U.setUpAniData=function(U){if(U.animations){var F,O={},P=[],Y=U.animations,c=0,L=Y.length;for(c=0;c<L;c++)if(F=Y[c]){var u={};u.name=F.name,u.aniO=F,u.nodeRoot=U,P.push(u),O[F.name]=u}this.animationList=P,this.animationDic=O}},U._clear=function(){var U,F;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(U in this._nodeGDic)(F=this._nodeGDic[U])&&F.recover();this._nodeGDic=null},$.parseAnimationByData=function(U){var F;return $._I||($._I=new $),F=$._I.parseByData(U),$._I._clear(),F},$.parseAnimationData=function(U){var F;return $._I||($._I=new $),$._I.setUpAniData(U),(F={}).animationList=$._I.animationList,F.animationDic=$._I.animationDic,$._I._clear(),F},$._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$._temParam=[],$._I=null,$._rootMatrix=null,d($,["_tempMt",function(){return this._tempMt=new s}]),$.__init$=function(){l=function(){function U(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return x(U,""),U.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),e.recover("GraphicNode",this)},U.create=function(){return e.getItemByClass("GraphicNode",U)},U}()},$}(XU));f.__init([a,dU,k,m,n,g,U,fU])}(window,document,Laya),function(U,F,O){O.un,O.uns,O.static;var P=O.class;O.getset,O.__newvec;new(function(){function U(){}return P(U,"LayaMain"),U}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(U,F){"use strict";for(var O in Object.defineProperty(F,"__esModule",{value:!0}),Laya){var P=Laya[O];P&&P.__isclass&&(F[O]=P)}}),function(U,F,K){K.un,K.uns;var L=K.static,J=K.class,P=K.getset,c=K.__newvec,b=laya.maths.Arith,z=laya.maths.Bezier,O=laya.resource.Bitmap,w=laya.utils.Browser,d=laya.utils.Byte,j=laya.utils.Color,f=(laya.filters.ColorFilter,K.Config),Y=laya.resource.Context,I=(laya.events.Event,laya.filters.Filter),u=laya.display.Graphics,a=laya.resource.HTMLCanvas,x=(laya.utils.HTMLChar,laya.resource.HTMLImage),r=laya.resource.HTMLSubImage,T=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),g=laya.maths.Point,l=laya.maths.Rectangle,H=laya.renders.Render,h=(laya.renders.RenderContext,laya.renders.RenderSprite),Q=laya.resource.Resource,X=laya.resource.ResourceManager,N=laya.utils.RunDriver,$=laya.display.Sprite,C=laya.display.Stage,s=laya.utils.Stat,i=laya.utils.StringKey,y=(laya.display.css.Style,laya.system.System),k=laya.display.Text,A=laya.resource.Texture,G=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),V=laya.utils.VectorGraphManager;laya.utils.WordText;K.interface("laya.webgl.shapes.IShape"),K.interface("laya.webgl.submit.ISubmit"),K.interface("laya.webgl.text.ICharSegment"),K.interface("laya.webgl.canvas.save.ISaveData"),K.interface("laya.webgl.resource.IMergeAtlasBitmap"),K.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var M=function(){function U(){}J(U,"laya.filters.webgl.FilterActionGL");var F=U.prototype;return K.imps(F,{"laya.filters.IFilterActionGL":!0}),F.setValue=function(U){},F.setValueMix=function(U){},F.apply3d=function(U,F,O,P,Y){return null},F.apply=function(U){return null},P(0,F,"typeMix",function(){return 0}),U}(),m=function(){function U(){}return J(U,"laya.webgl.shader.ShaderValue"),U}(),p=function(){var P,Y;function U(U,F,O){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new Y,void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),this._cells=null,this._rowInfo=null,this._init(U,F),this._atlasID=O}J(U,"laya.webgl.atlas.AtlasGrid");var F=U.prototype;return F.getAltasID=function(){return this._atlasID},F.setAltasID=function(U){0<=U&&(this._atlasID=U)},F.addTex=function(U,F,O){var P=this._get(F,O);return 0==P.ret||(this._fill(P.x,P.y,F,O,U),this._texCount++),P},F._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},F._init=function(U,F){if(this._width=U,this._height=F,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=c(this._height);for(var O=0;O<this._height;O++)this._rowInfo[O]=new P;return this._clear(),!0},F._get=function(U,F){var O=new R;if(U>=this._failSize.width&&F>=this._failSize.height)return O;for(var P=-1,Y=-1,c=this._width,L=this._height,u=this._cells,d=0;d<L;d++)if(!(this._rowInfo[d].spaceCount<U))for(var a=0;a<c;){var b=3*(d*c+a);if(0!=u[b]||u[1+b]<U||u[2+b]<F)a+=u[1+b];else{P=a,Y=d;for(var z=0;z<U;z++)if(u[3*z+b+2]<F){P=-1;break}if(!(P<0))return O.ret=!0,O.x=P,O.y=Y,O;a+=u[1+b]}}return O},F._fill=function(U,F,O,P,Y){var c=this._width,L=this._height;this._check(U+O<=c&&F+P<=L);for(var u=F;u<P+F;++u){this._check(this._rowInfo[u].spaceCount>=O),this._rowInfo[u].spaceCount-=O;for(var d=0;d<O;d++){var a=3*(U+u*c+d);this._check(0==this._cells[a]),this._cells[a]=Y,this._cells[1+a]=O,this._cells[2+a]=P}}if(0<U)for(u=0;u<P;++u){var b=0;for(d=U-1;0<=d&&0==this._cells[3*((F+u)*c+d)];--d,++b);for(d=b;0<d;--d)this._cells[3*((F+u)*c+U-d)+1]=d,this._check(0<d)}if(0<F)for(d=U;d<U+O;++d){for(b=0,u=F-1;0<=u&&0==this._cells[3*(d+u*c)];--u,b++);for(u=b;0<u;--u)this._cells[3*(d+(F-u)*c)+2]=u,this._check(0<u)}},F._check=function(U){0==U&&console.log("xtexMerger 错误啦")},F._clear=function(){for(var U=this._texCount=0;U<this._height;U++)this._rowInfo[U].spaceCount=this._width;for(var F=0;F<this._height;F++)for(var O=0;O<this._width;O++){var P=3*(F*this._width+O);this._cells[P]=0,this._cells[1+P]=this._width-O,this._cells[2+P]=this._width-F}this._failSize.width=this._width+1,this._failSize.height=this._height+1},U.__init$=function(){P=function(){function U(){this.spaceCount=0}return J(U,""),U}(),Y=function(){function U(){this.width=0,this.height=0}return J(U,""),U}()},U}(),o=function(){function H(U,F,O,P){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=U,this._height=F,this._gridSize=O,this._maxAtlaserCount=P,this._gridNumX=U/O,this._gridNumY=F/O,this._curAtlasIndex=0,this._atlaserArray=[]}J(H,"laya.webgl.atlas.AtlasResourceManager");var U=H.prototype;return U.setAtlasParam=function(U,F,O,P){if(1==this._setAtlasParam)return H._sid_=0,this._width=U,this._height=F,this._gridSize=O,this._maxAtlaserCount=P,this._gridNumX=U/O,this._gridNumY=F/O,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},U.pushData=function(U){var F,O=U.bitmap,P=-1,Y=null,c=0,L=0;for(c=0,F=this._atlaserArray.length;c<F&&(L=(this._curAtlasIndex+c)%F,-1==(P=(Y=this._atlaserArray[L]).findBitmapIsExist(O)));c++);if(-1!=P){var u=Y.InAtlasWebGLImagesOffsetValue[P];return j=u[0],x=u[1],Y.addToAtlas(U,j,x),!0}this._setAtlasParam=!1;for(var d=Math.ceil((U.bitmap.width+2)/this._gridSize),a=Math.ceil((U.bitmap.height+2)/this._gridSize),b=!1,z=0;z<2;z++){var J=this._maxAtlaserCount;for(c=0;c<J;c++){L=(this._curAtlasIndex+c)%J,this._atlaserArray.length-1>=L||this._atlaserArray.push(new lU(this._gridNumX,this._gridNumY,this._width,this._height,H._sid_++));var w=this._atlaserArray[L],j=0,x=0,r=w.addTex(1,d,a);if(r.ret){j=r.x*this._gridSize+1,x=r.y*this._gridSize+1,O.lock=!0,w.addToAtlasTexture(O,j,x),w.addToAtlas(U,j,x),b=!0,this._curAtlasIndex=L;break}}if(b)break;this._atlaserArray.push(new lU(this._gridNumX,this._gridNumY,this._width,this._height,H._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return b||console.log(">>>AtlasManager pushData error"),b},U.addToAtlas=function(U){laya.webgl.atlas.AtlasResourceManager.instance.pushData(U)},U.garbageCollection=function(){if(!0===this._needGC){for(var U=this._atlaserArray.length-this._maxAtlaserCount,F=0;F<U;F++)this._atlaserArray[F].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+U),this._atlaserArray.splice(0,U),this._needGC=!1}return!0},U.freeAll=function(){for(var U=0,F=this._atlaserArray.length;U<F;U++)this._atlaserArray[U].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},U.getAtlaserCount=function(){return this._atlaserArray.length},U.getAtlaserByIndex=function(U){return this._atlaserArray[U]},P(1,H,"instance",function(){return H._Instance||(H._Instance=new H(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),H._Instance}),P(1,H,"enabled",function(){return f.atlasEnable}),P(1,H,"atlasLimitWidth",function(){return H._atlasLimitWidth},function(U){H._atlasLimitWidth=U}),P(1,H,"atlasLimitHeight",function(){return H._atlasLimitHeight},function(U){H._atlasLimitHeight=U}),H._enable=function(){f.atlasEnable=!0},H._disable=function(){f.atlasEnable=!1},H.__init__=function(){H.atlasTextureWidth=2048,H.atlasTextureHeight=2048,H.maxTextureCount=6,H.atlasLimitWidth=512,H.atlasLimitHeight=512},H._atlasLimitWidth=0,H._atlasLimitHeight=0,H.gridSize=16,H.atlasTextureWidth=0,H.atlasTextureHeight=0,H.maxTextureCount=0,H._atlasRestore=0,H.BOARDER_TYPE_NO=0,H.BOARDER_TYPE_RIGHT=1,H.BOARDER_TYPE_LEFT=2,H.BOARDER_TYPE_BOTTOM=4,H.BOARDER_TYPE_TOP=8,H.BOARDER_TYPE_ALL=15,H._sid_=0,H._Instance=null,H}(),R=function(){function U(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return J(U,"laya.webgl.atlas.MergeFillInfo"),U}(),_=function(){function F(){}return J(F,"laya.webgl.canvas.BlendMode"),F._init_=function(U){F.fns=[F.BlendNormal,F.BlendAdd,F.BlendMultiply,F.BlendScreen,F.BlendOverlay,F.BlendLight,F.BlendMask,F.BlendDestinationOut],F.targetFns=[F.BlendNormalTarget,F.BlendAddTarget,F.BlendMultiplyTarget,F.BlendScreenTarget,F.BlendOverlayTarget,F.BlendLightTarget,F.BlendMask,F.BlendDestinationOut]},F.BlendNormal=function(U){U.blendFunc(1,771)},F.BlendAdd=function(U){U.blendFunc(1,772)},F.BlendMultiply=function(U){U.blendFunc(774,771)},F.BlendScreen=function(U){U.blendFunc(1,1)},F.BlendOverlay=function(U){U.blendFunc(1,769)},F.BlendLight=function(U){U.blendFunc(1,1)},F.BlendNormalTarget=function(U){U.blendFunc(1,771)},F.BlendAddTarget=function(U){U.blendFunc(1,772)},F.BlendMultiplyTarget=function(U){U.blendFunc(774,771)},F.BlendScreenTarget=function(U){U.blendFunc(1,1)},F.BlendOverlayTarget=function(U){U.blendFunc(1,769)},F.BlendLightTarget=function(U){U.blendFunc(1,1)},F.BlendMask=function(U){U.blendFunc(0,770)},F.BlendDestinationOut=function(U){U.blendFunc(0,0)},F.activeBlendFunction=null,F.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],F.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},F.NORMAL="normal",F.ADD="add",F.MULTIPLY="multiply",F.SCREEN="screen",F.LIGHT="light",F.OVERLAY="overlay",F.DESTINATIONOUT="destination-out",F.fns=[],F.targetFns=[],F}(),q=function(){function O(U){this._color=j.create("black"),this.setValue(U)}J(O,"laya.webgl.canvas.DrawStyle");var U=O.prototype;return U.setValue=function(U){if(U){if("string"==typeof U)return void(this._color=j.create(U));if(U instanceof laya.utils.Color)return void(this._color=U)}},U.reset=function(){this._color=j.create("black")},U.equal=function(U){return"string"==typeof U?this._color.strColor===U:U instanceof laya.utils.Color&&this._color.numColor===U.numColor},U.toColorStr=function(){return this._color.strColor},O.create=function(U){var F;if(U&&("string"==typeof U?F=j.create(U):U instanceof laya.utils.Color&&(F=U),F))return F._drawStyle||(F._drawStyle=new O(U));return laya.webgl.canvas.DrawStyle.DEFAULT},L(O,["DEFAULT",function(){return this.DEFAULT=new O("#000000")}]),O}(),D=function(){function U(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];XU.mainContext;this.ib=BU.create(35048),this.vb=EU.create(5)}J(U,"laya.webgl.canvas.Path");var F=U.prototype;return F.addPoint=function(U,F){this.tempArray.push(U,F)},F.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},F.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},F.polygon=function(U,F,O,P,Y,c){var L;return this.geomatrys.push(this._curGeomatry=L=new iU(U,F,O,P,Y,c)),P||(L.fill=!1),null==c&&(L.borderWidth=0),L},F.setGeomtry=function(U){this.geomatrys.push(this._curGeomatry=U)},F.drawLine=function(U,F,O,P,Y){var c;return this.closePath?this.geomatrys.push(this._curGeomatry=c=new sU(U,F,O,P,Y)):this.geomatrys.push(this._curGeomatry=c=new CU(U,F,O,P,Y)),c.fill=!1,c},F.update=function(){var U=this.ib._byteLength,F=this.geomatrys.length;this.offset=U;for(var O=this.geoStart;O<F;O++)this.geomatrys[O].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=F,this.count=(this.ib._byteLength-U)/xU.BYTES_PIDX},F.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},F.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},U}(),Z=function(){function u(){}J(u,"laya.webgl.canvas.save.SaveBase");var U=u.prototype;return K.imps(U,{"laya.webgl.canvas.save.ISaveData":!0}),U.isSaveMark=function(){return!1},U.restore=function(U){this._dataObj[this._valueName]=this._value,(u._cache[u._cache._length++]=this)._newSubmit&&(U._curSubmit=cU.RENDERBASE,U._renderKey=0)},u._createArray=function(){var U=[];return U._length=0,U},u._init=function(){var U=u._namemap={};return U[1]="ALPHA",U[2]="fillStyle",U[8]="font",U[256]="lineWidth",U[512]="strokeStyle",U[8192]="_mergeID",U[1024]=U[2048]=U[4096]=[],U[16384]="textBaseline",U[32768]="textAlign",U[65536]="_nBlendType",U[1048576]="shader",U[2097152]="filters",U},u.save=function(U,F,O,P){if((U._saveMark._saveuse&F)!==F){U._saveMark._saveuse|=F;var Y=u._cache,c=0<Y._length?Y[--Y._length]:new u;c._value=O[c._valueName=u._namemap[F]],c._dataObj=O,c._newSubmit=P;var L=U._save;L[L._length++]=c}},u._cache=laya.webgl.canvas.save.SaveBase._createArray(),u._namemap=u._init(),u}(),e=function(){function c(){this._clipRect=new l}J(c,"laya.webgl.canvas.save.SaveClipRect");var U=c.prototype;return K.imps(U,{"laya.webgl.canvas.save.ISaveData":!0}),U.isSaveMark=function(){return!1},U.restore=function(U){U._clipRect=this._clipSaveRect,(c._cache[c._cache._length++]=this)._submitScissor.submitLength=U._submits._length-this._submitScissor.submitIndex,U._curSubmit=cU.RENDERBASE,U._renderKey=0},c.save=function(U,F){if(131072!=(131072&U._saveMark._saveuse)){U._saveMark._saveuse|=131072;var O=c._cache,P=0<O._length?O[--O._length]:new c;P._clipSaveRect=U._clipRect,U._clipRect=P._clipRect.copyFrom(U._clipRect),P._submitScissor=F;var Y=U._save;Y[Y._length++]=P}},L(c,["_cache",function(){return this._cache=Z._createArray()}]),c}(),v=function(){function w(){this._contextX=0,this._contextY=0,this._clipRect=new l,this._rect=new l,this._matrix=new T}J(w,"laya.webgl.canvas.save.SaveClipRectStencil");var U=w.prototype;return K.imps(U,{"laya.webgl.canvas.save.ISaveData":!0}),U.isSaveMark=function(){return!1},U.restore=function(U){bU.restore(U,this._rect,this._saveMatrix,this._contextX,this._contextY),U._clipRect=this._clipSaveRect,U._curMat=this._saveMatrix,U._x=this._contextX,U._y=this._contextY,w._cache[w._cache._length++]=this,U._curSubmit=cU.RENDERBASE},w.save=function(U,F,O,P,Y,c,L,u,d,a){if(262144!=(262144&U._saveMark._saveuse)){U._saveMark._saveuse|=262144;var b=w._cache,z=0<b._length?b[--b._length]:new w;z._clipSaveRect=U._clipRect,z._clipRect.setTo(L,u,d,a),U._clipRect=z._clipRect,z._rect.x=O,z._rect.y=P,z._rect.width=Y,z._rect.height=c,z._contextX=U._x,z._contextY=U._y,z._saveMatrix=U._curMat,U._curMat.copyTo(z._matrix),U._curMat=z._matrix,z._submitStencil=F;var J=U._save;J[J._length++]=z}},L(w,["_cache",function(){return this._cache=Z._createArray()}]),w}(),n=function(){function P(){this._saveuse=0}J(P,"laya.webgl.canvas.save.SaveMark");var U=P.prototype;return K.imps(U,{"laya.webgl.canvas.save.ISaveData":!0}),U.isSaveMark=function(){return!0},U.restore=function(U){U._saveMark=this._preSaveMark,P._no[P._no._length++]=this},P.Create=function(U){var F=P._no,O=0<F._length?F[--F._length]:new P;return O._saveuse=0,O._preSaveMark=U._saveMark,U._saveMark=O},L(P,["_no",function(){return this._no=Z._createArray()}]),P}(),t=function(){function c(){this._matrix=new T}J(c,"laya.webgl.canvas.save.SaveTransform");var U=c.prototype;return K.imps(U,{"laya.webgl.canvas.save.ISaveData":!0}),U.isSaveMark=function(){return!1},U.restore=function(U){U._curMat=this._savematrix,c._no[c._no._length++]=this},c.save=function(U){var F=U._saveMark;if(2048!=(2048&F._saveuse)){F._saveuse|=2048;var O=c._no,P=0<O._length?O[--O._length]:new c;P._savematrix=U._curMat,U._curMat=U._curMat.copyTo(P._matrix);var Y=U._save;Y[Y._length++]=P}},L(c,["_no",function(){return this._no=Z._createArray()}]),c}(),S=function(){function Y(){}J(Y,"laya.webgl.canvas.save.SaveTranslate");var U=Y.prototype;return K.imps(U,{"laya.webgl.canvas.save.ISaveData":!0}),U.isSaveMark=function(){return!1},U.restore=function(U){U._curMat;U._x=this._x,U._y=this._y,Y._no[Y._no._length++]=this},Y.save=function(U){var F=Y._no,O=0<F._length?F[--F._length]:new Y;O._x=U._x,O._y=U._y;var P=U._save;P[P._length++]=O},L(Y,["_no",function(){return this._no=Z._createArray()}]),Y}(),W=function(){function U(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new l}J(U,"laya.webgl.resource.RenderTargetMAX");var F=U.prototype;return F.setSP=function(U){this._sp=U},F.size=function(U,F){var O=this;this._width!==U||this._height!==F?(this.repaint=!0,this._width=U,this._height=F,this.target?this.target.size(U,F):this.target=VU.create(U,F),this.target.hasListener("recovered")||this.target.on("recovered",this,function(U){K.timer.callLater(O._sp,O._sp.repaint)})):this.target.size(U,F)},F._flushToTarget=function(U,F){if(!F._destroy){var O=hU.worldScissorTest,P=hU.worldClipRect;hU.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,hU.worldScissorTest=!1,XU.mainContext.disable(3089);var Y=hU.worldAlpha,c=hU.worldMatrix4,L=hU.worldMatrix,u=hU.worldFilters,d=hU.worldShaderDefines;if(hU.worldMatrix=T.EMPTY,hU.restoreTempArray(),hU.worldMatrix4=hU.TEMPMAT4_ARRAY,hU.worldAlpha=1,hU.worldFilters=null,hU.worldShaderDefines=null,GU.activeShader=null,F.start(),f.showCanvasMark?F.clear(0,1,0,.3):F.clear(0,0,0,0),U.flush(),F.end(),GU.activeShader=null,hU.worldAlpha=Y,hU.worldMatrix4=c,hU.worldMatrix=L,hU.worldFilters=u,hU.worldShaderDefines=d,hU.worldScissorTest=O){var a=hU.height-P.y-P.height;XU.mainContext.scissor(P.x,a,P.width,P.height),XU.mainContext.enable(3089)}hU.worldClipRect=P}},F.flush=function(U){this.repaint&&(this._flushToTarget(U,this.target),this.repaint=!1)},F.drawTo=function(U,F,O,P,Y){U.drawTexture(this.target.getTexture(),F,O,P,Y,0,0)},F.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},U}(),B=function(){function U(){this.ALPHA=1,this.shaderType=0,this.defines=new $U}return J(U,"laya.webgl.shader.d2.Shader2D"),U.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},U.__init__=function(){var U,F;nU.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),nU.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),nU.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),nU.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),nU.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),nU.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),nU.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),nU.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),U="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",F='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',nU.preCompile2D(0,1,U,F,null),U="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",F='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',nU.preCompile2D(0,2,U,F,null),U="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",F="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",nU.preCompile2D(0,4,U,F,null),U="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",F='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',nU.preCompile2D(0,256,U,F,null),U="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",F="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",nU.preCompile2D(0,512,U,F,null)},U}(),E=function(){function F(U,F,O){this._value=0,this._name2int=U,this._int2name=F,this._int2nameMap=O}J(F,"laya.webgl.shader.ShaderDefines");var U=F.prototype;return U.add=function(U){return"string"==typeof U&&(U=this._name2int[U]),this._value|=U,this._value},U.addInt=function(U){return this._value|=U,this._value},U.remove=function(U){return"string"==typeof U&&(U=this._name2int[U]),this._value&=~U,this._value},U.isDefine=function(U){return(this._value&U)===U},U.getValue=function(){return this._value},U.setValue=function(U){this._value=U},U.toNameDic=function(){var U=this._int2nameMap[this._value];return U||F._toText(this._value,this._int2name,this._int2nameMap)},F._reg=function(U,F,O,P){P[O[U]=F]=U},F._toText=function(U,F,O){var P=O[U];if(P)return P;for(var Y={},c=1,L=0;L<32&&!(U<(c=1<<L));L++)if(U&c){var u=F[c];u&&(Y[u]="")}return O[U]=Y},F._toInt=function(U,F){for(var O=U.split("."),P=0,Y=0,c=O.length;Y<c;Y++){var L=F[O[Y]];if(!L)throw new Error("Defines to int err:"+U+"/"+O[Y]);P|=L}return P},F}(),UU=function(){function L(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new T}J(L,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var U=L.prototype;return U.init=function(U,F,O){if(F)this._vs=F;else{this._vs=[];var P=U.width,Y=U.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(P,0,1,0,1,1,1,1),this._vs.push(P,Y,1,1,1,1,1,1),this._vs.push(0,Y,0,1,1,1,1,1)}O?this._ps=O:(L._defaultPS||(L._defaultPS=[]).push(0,1,3,3,1,2),this._ps=L._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=U},U.init2=function(U,F,O,P,Y){this.transform&&(this.transform=null),O?this._ps=O:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=P,this._uvs=Y,this.mEleNum=this._ps.length,this.mTexture=U,(H.isConchNode||H.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},U._initMyData=function(){var U=0,F=0,O=4*this._verticles.length;this._vs=L._tempVS;var P=!1;if(H.isConchNode||H.isConchApp?(this._vs.length=O,P=!0):this._vs.length<O&&(this._vs.length=O,P=!0),L._tVSLen=O,P)for(;U<O;)this._vs[U]=this._verticles[F],this._vs[U+1]=this._verticles[F+1],this._vs[U+2]=this._uvs[F],this._vs[U+3]=this._uvs[F+1],this._vs[U+4]=1,this._vs[U+5]=1,this._vs[U+6]=1,this._vs[U+7]=1,U+=8,F+=2;else for(;U<O;)this._vs[U]=this._verticles[F],this._vs[U+1]=this._verticles[F+1],this._vs[U+2]=this._uvs[F],this._vs[U+3]=this._uvs[F+1],U+=8,F+=2},U.getData2=function(U,F,O){var P;this.mVBBuffer=U,this.mIBBuffer=F,this._initMyData(),U.appendEx2(this._vs,Float32Array,L._tVSLen,4),this._indexStart=F._byteLength,(P=L._tempIB).length<this._ps.length&&(P.length=this._ps.length);for(var Y=0,c=this._ps.length;Y<c;Y++)P[Y]=this._ps[Y]+O;F.appendEx2(P,Uint16Array,this._ps.length,2)},U.getData=function(U,F,O){if(this.mVBBuffer=U,this.mIBBuffer=F,U.append(this.mVBData),this._indexStart=F._byteLength,this.mIBData.start!=O){for(var P=0,Y=this._ps.length;P<Y;P++)this.mIBData[P]=this._ps[P]+O;this.mIBData.start=O}F.append(this.mIBData)},U.render=function(U,F,O){if(H.isWebGL&&this.mTexture){U._renderKey=0,U._shader2D.glTexture=null,FU.getInstance().addSkinMesh(this);var P=cU.createShape(U,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,IU.create(512,0));this.transform||(this.transform=T.EMPTY),this.transform.translate(F,O),T.mul(this.transform,U._curMat,this._tempMatrix),this.transform.translate(-F,-O);var Y=P.shaderValue,c=Y.u_mmat2||hU.getMatrArray();hU.mat2MatArray(this._tempMatrix,c),Y.textureHost=this.mTexture,Y.offsetX=0,Y.offsetY=0,Y.u_mmat2=c,Y.ALPHA=U._shader2D.ALPHA,U._submits[U._submits._length++]=P}else H.isConchApp&&this.mTexture&&(this.transform||(this.transform=T.EMPTY),U.setSkinMesh&&U.setSkinMesh(F,O,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},L._tempVS=[],L._tempIB=[],L._defaultPS=null,L._tVSLen=0,L}(),FU=function(){function U(){this.ib=null,this.vb=null;XU.mainContext;this.ib=BU.create(35048),this.vb=EU.create(8)}J(U,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var F=U.prototype;return F.addSkinMesh=function(U){U.getData2(this.vb,this.ib,this.vb._byteLength/32)},F.reset=function(){this.vb.clear(),this.ib.clear()},U.getInstance=function(){return U.instance=U.instance||new U},U.instance=null,U}(),OU=function(){function U(U,F,O,P,Y,c,L,u,d){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===d&&(d=0),this.x=U,this.y=F,this.width=O,this.height=P,this.edges=Y,this.color=c,this.borderWidth=L,this.borderColor=u}J(U,"laya.webgl.shapes.BasePoly");var F=U.prototype;return K.imps(F,{"laya.webgl.shapes.IShape":!0}),F.getData=function(U,F,O){},F.rebuild=function(U){},F.setMatrix=function(U){},F.needUpdate=function(U){return!0},F.sector=function(U,F,O){var P=this.x,Y=this.y,c=this.edges,L=(this.r1-this.r0)/c,u=this.width,d=this.height,a=this.color,b=(a>>16&255)/255,z=(a>>8&255)/255,J=(255&a)/255;U.push(P,Y,b,z,J);for(var w=0;w<c+1;w++)U.push(P+Math.sin(L*w+this.r0)*u,Y+Math.cos(L*w+this.r0)*d),U.push(b,z,J);for(w=0;w<c;w++)F.push(O,O+w+1,O+w+2)},F.createLine2=function(U,F,O,P,Y,c){var L,u,d,a,b,z,J,w,j,x,r,H,h,Q,X,N,K,f,I,T,g=U.concat(),l=Y,$=this.borderColor,C=($>>16&255)/255,s=($>>8&255)/255,i=(255&$)/255,y=g.length/2,k=P,A=O/2;d=g[0],a=g[1],x=d-(b=g[2]),j=(j=-(a-(z=g[3])))/(T=Math.sqrt(j*j+x*x))*A,x=x/T*A,l.push(d-j+this.x,a-x+this.y,C,s,i,d+j+this.x,a+x+this.y,C,s,i);for(var G=1;G<y-1;G++)d=g[2*(G-1)],a=g[2*(G-1)+1],b=g[2*G],z=g[2*G+1],J=g[2*(G+1)],w=g[2*(G+1)+1],x=d-b,H=b-J,X=(-(j=(j=-(a-z))/(T=Math.sqrt(j*j+x*x))*A)+d)*(-(x=x/T*A)+z)-(-j+b)*(-x+a),f=(-(r=(r=-(z-w))/(T=Math.sqrt(r*r+H*H))*A)+J)*(-(H=H/T*A)+z)-(-r+b)*(-H+w),I=(h=-x+a-(-x+z))*(K=-r+b-(-r+J))-(N=-H+w-(-H+z))*(Q=-j+b-(-j+d)),Math.abs(I)<.1?(I+=10.1,l.push(b-j+this.x,z-x+this.y,C,s,i,b+j+this.x,z+x+this.y,C,s,i)):(((L=(Q*f-K*X)/I)-b)*(L-b)+((u=(N*X-h*f)/I)-z)+(u-z),l.push(L+this.x,u+this.y,C,s,i,b-(L-b)+this.x,z-(u-z)+this.y,C,s,i));d=g[g.length-4],a=g[g.length-3],x=d-(b=g[g.length-2]),j=(j=-(a-(z=g[g.length-1])))/(T=Math.sqrt(j*j+x*x))*A,x=x/T*A,l.push(b-j+this.x,z-x+this.y,C,s,i,b+j+this.x,z+x+this.y,C,s,i);var V=c;for(G=1;G<V;G++)F.push(k+2*(G-1),k+2*(G-1)+1,k+2*G+1,k+2*G+1,k+2*G,k+2*(G-1));return l},F.createLine=function(U,F,O,P){var Y=U.concat(),c=U,L=this.borderColor,u=(L>>16&255)/255,d=(L>>8&255)/255,a=(255&L)/255;Y.splice(0,5);var b,z,J,w,j,x,r,H,h,Q,X,N,K,f,I,T,g,l,$,C,s=Y.length/5,i=P,y=O/2;J=Y[0],w=Y[1],Q=J-(j=Y[5]),h=(h=-(w-(x=Y[6])))/(C=Math.sqrt(h*h+Q*Q))*y,Q=Q/C*y,c.push(J-h,w-Q,u,d,a,J+h,w+Q,u,d,a);for(var k=1;k<s-1;k++)J=Y[5*(k-1)],w=Y[5*(k-1)+1],j=Y[5*k],x=Y[5*k+1],r=Y[5*(k+1)],H=Y[5*(k+1)+1],Q=J-j,N=j-r,I=(-(h=(h=-(w-x))/(C=Math.sqrt(h*h+Q*Q))*y)+J)*(-(Q=Q/C*y)+x)-(-h+j)*(-Q+w),l=(-(X=(X=-(x-H))/(C=Math.sqrt(X*X+N*N))*y)+r)*(-(N=N/C*y)+x)-(-X+j)*(-N+H),$=(K=-Q+w-(-Q+x))*(g=-X+j-(-X+r))-(T=-N+H-(-N+x))*(f=-h+j-(-h+J)),Math.abs($)<.1?($+=10.1,c.push(j-h,x-Q,u,d,a,j+h,x+Q,u,d,a)):(((b=(f*l-g*I)/$)-j)*(b-j)+((z=(T*I-K*l)/$)-x)+(z-x),c.push(b,z,u,d,a,j-(b-j),x-(z-x),u,d,a));J=Y[Y.length-10],w=Y[Y.length-9],Q=J-(j=Y[Y.length-5]),h=(h=-(w-(x=Y[Y.length-4])))/(C=Math.sqrt(h*h+Q*Q))*y,Q=Q/C*y,c.push(j-h,x-Q,u,d,a,j+h,x+Q,u,d,a);var A=this.edges+1;for(k=1;k<A;k++)F.push(i+2*(k-1),i+2*(k-1)+1,i+2*k+1,i+2*k+1,i+2*k,i+2*(k-1));return c},F.createLoopLine=function(U,F,O,P,Y,c){var L=U.concat(),u=Y||U,d=this.borderColor,a=(d>>16&255)/255,b=(d>>8&255)/255,z=(255&d)/255;L.splice(0,5);var J=[L[0],L[1]],w=[L[L.length-5],L[L.length-4]],j=w[0]+.5*(J[0]-w[0]),x=w[1]+.5*(J[1]-w[1]);L.unshift(j,x,0,0,0),L.push(j,x,0,0,0);var r,H,h,Q,X,N,K,f,I,T,g,l,$,C,s,i,y,k,A,G,V=L.length/5,M=P,m=O/2;h=L[0],Q=L[1],T=h-(X=L[5]),I=(I=-(Q-(N=L[6])))/(G=Math.sqrt(I*I+T*T))*m,T=T/G*m,u.push(h-I,Q-T,a,b,z,h+I,Q+T,a,b,z);for(var p=1;p<V-1;p++)h=L[5*(p-1)],Q=L[5*(p-1)+1],X=L[5*p],N=L[5*p+1],K=L[5*(p+1)],f=L[5*(p+1)+1],T=h-X,l=X-K,s=(-(I=(I=-(Q-N))/(G=Math.sqrt(I*I+T*T))*m)+h)*(-(T=T/G*m)+N)-(-I+X)*(-T+Q),k=(-(g=(g=-(N-f))/(G=Math.sqrt(g*g+l*l))*m)+K)*(-(l=l/G*m)+N)-(-g+X)*(-l+f),A=($=-T+Q-(-T+N))*(y=-g+X-(-g+K))-(i=-l+f-(-l+N))*(C=-I+X-(-I+h)),Math.abs(A)<.1?(A+=10.1,u.push(X-I,N-T,a,b,z,X+I,N+T,a,b,z)):(((r=(C*k-y*s)/A)-X)*(r-X)+((H=(i*s-$*k)/A)-N)+(H-N),u.push(r,H,a,b,z,X-(r-X),N-(H-N),a,b,z));c&&(F=c);var o=this.edges+1;for(p=1;p<o;p++)F.push(M+2*(p-1),M+2*(p-1)+1,M+2*p+1,M+2*p+1,M+2*p,M+2*(p-1));return F.push(M+2*(p-1),M+2*(p-1)+1,M+1,M+1,M,M+2*(p-1)),u},U}(),PU=function(){function x(){}return J(x,"laya.webgl.shapes.Earcut"),x.earcut=function(U,F,O){O=O||2;var P,Y,c,L,u,d,a,b=F&&F.length,z=b?F[0]*O:U.length,J=x.linkedList(U,0,z,O,!0),w=[];if(!J)return w;if(b&&(J=x.eliminateHoles(U,F,J,O)),U.length>80*O){P=c=U[0],Y=L=U[1];for(var j=O;j<z;j+=O)(u=U[j])<P&&(P=u),(d=U[j+1])<Y&&(Y=d),c<u&&(c=u),L<d&&(L=d);a=0!==(a=Math.max(c-P,L-Y))?1/a:0}return x.earcutLinked(J,w,O,P,Y,a),w},x.linkedList=function(U,F,O,P,Y){var c,L;if(Y===0<x.signedArea(U,F,O,P))for(c=F;c<O;c+=P)L=x.insertNode(c,U[c],U[c+1],L);else for(c=O-P;F<=c;c-=P)L=x.insertNode(c,U[c],U[c+1],L);return L&&x.equals(L,L.next)&&(x.removeNode(L),L=L.next),L},x.filterPoints=function(U,F){if(!U)return U;F||(F=U);var O,P=U;do{if(O=!1,P.steiner||!x.equals(P,P.next)&&0!==x.area(P.prev,P,P.next))P=P.next;else{if(x.removeNode(P),(P=F=P.prev)===P.next)break;O=!0}}while(O||P!==F);return F},x.earcutLinked=function(U,F,O,P,Y,c,L){if(U){!L&&c&&x.indexCurve(U,P,Y,c);for(var u,d,a=U;U.prev!==U.next;)if(u=U.prev,d=U.next,c?x.isEarHashed(U,P,Y,c):x.isEar(U))F.push(u.i/O),F.push(U.i/O),F.push(d.i/O),x.removeNode(U),U=d.next,a=d.next;else if((U=d)===a){L?1===L?(U=x.cureLocalIntersections(U,F,O),x.earcutLinked(U,F,O,P,Y,c,2)):2===L&&x.splitEarcut(U,F,O,P,Y,c):x.earcutLinked(x.filterPoints(U,null),F,O,P,Y,c,1);break}}},x.isEar=function(U){var F=U.prev,O=U,P=U.next;if(0<=x.area(F,O,P))return!1;for(var Y=U.next.next;Y!==U.prev;){if(x.pointInTriangle(F.x,F.y,O.x,O.y,P.x,P.y,Y.x,Y.y)&&0<=x.area(Y.prev,Y,Y.next))return!1;Y=Y.next}return!0},x.isEarHashed=function(U,F,O,P){var Y=U.prev,c=U,L=U.next;if(0<=x.area(Y,c,L))return!1;for(var u=Y.x<c.x?Y.x<L.x?Y.x:L.x:c.x<L.x?c.x:L.x,d=Y.y<c.y?Y.y<L.y?Y.y:L.y:c.y<L.y?c.y:L.y,a=Y.x>c.x?Y.x>L.x?Y.x:L.x:c.x>L.x?c.x:L.x,b=Y.y>c.y?Y.y>L.y?Y.y:L.y:c.y>L.y?c.y:L.y,z=x.zOrder(u,d,F,O,P),J=x.zOrder(a,b,F,O,P),w=U.nextZ;w&&w.z<=J;){if(w!==U.prev&&w!==U.next&&x.pointInTriangle(Y.x,Y.y,c.x,c.y,L.x,L.y,w.x,w.y)&&0<=x.area(w.prev,w,w.next))return!1;w=w.nextZ}for(w=U.prevZ;w&&w.z>=z;){if(w!==U.prev&&w!==U.next&&x.pointInTriangle(Y.x,Y.y,c.x,c.y,L.x,L.y,w.x,w.y)&&0<=x.area(w.prev,w,w.next))return!1;w=w.prevZ}return!0},x.cureLocalIntersections=function(U,F,O){var P=U;do{var Y=P.prev,c=P.next.next;!x.equals(Y,c)&&x.intersects(Y,P,P.next,c)&&x.locallyInside(Y,c)&&x.locallyInside(c,Y)&&(F.push(Y.i/O),F.push(P.i/O),F.push(c.i/O),x.removeNode(P),x.removeNode(P.next),P=U=c),P=P.next}while(P!==U);return P},x.splitEarcut=function(U,F,O,P,Y,c){var L=U;do{for(var u=L.next.next;u!==L.prev;){if(L.i!==u.i&&x.isValidDiagonal(L,u)){var d=x.splitPolygon(L,u);return L=x.filterPoints(L,L.next),d=x.filterPoints(d,d.next),x.earcutLinked(L,F,O,P,Y,c),void x.earcutLinked(d,F,O,P,Y,c)}u=u.next}L=L.next}while(L!==U)},x.eliminateHoles=function(U,F,O,P){var Y,c,L,u,d,a=[];for(Y=0,c=F.length;Y<c;Y++)L=F[Y]*P,u=Y<c-1?F[Y+1]*P:U.length,(d=x.linkedList(U,L,u,P,!1))===d.next&&(d.steiner=!0),a.push(x.getLeftmost(d));for(a.sort(x.compareX),Y=0;Y<a.length;Y++)x.eliminateHole(a[Y],O),O=x.filterPoints(O,O.next);return O},x.compareX=function(U,F){return U.x-F.x},x.eliminateHole=function(U,F){if(F=x.findHoleBridge(U,F)){var O=x.splitPolygon(F,U);x.filterPoints(O,O.next)}},x.findHoleBridge=function(U,F){var O,P=F,Y=U.x,c=U.y,L=-1/0;do{if(c<=P.y&&c>=P.next.y&&P.next.y!==P.y){var u=P.x+(c-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(u<=Y&&L<u){if((L=u)===Y){if(c===P.y)return P;if(c===P.next.y)return P.next}O=P.x<P.next.x?P:P.next}}P=P.next}while(P!==F);if(!O)return null;if(Y===L)return O.prev;var d,a=O,b=O.x,z=O.y,J=1/0;for(P=O.next;P!==a;)Y>=P.x&&P.x>=b&&Y!==P.x&&x.pointInTriangle(c<z?Y:L,c,b,z,c<z?L:Y,c,P.x,P.y)&&((d=Math.abs(c-P.y)/(Y-P.x))<J||d===J&&P.x>O.x)&&x.locallyInside(P,U)&&(O=P,J=d),P=P.next;return O},x.indexCurve=function(U,F,O,P){for(var Y=U;null===Y.z&&(Y.z=x.zOrder(Y.x,Y.y,F,O,P)),Y.prevZ=Y.prev,Y.nextZ=Y.next,(Y=Y.next)!==U;);Y.prevZ.nextZ=null,Y.prevZ=null,x.sortLinked(Y)},x.sortLinked=function(U){var F,O,P,Y,c,L,u,d,a=1;do{for(O=U,c=U=null,L=0;O;){for(L++,P=O,F=u=0;F<a&&(u++,P=P.nextZ);F++);for(d=a;0<u||0<d&&P;)0!==u&&(0===d||!P||O.z<=P.z)?(O=(Y=O).nextZ,u--):(P=(Y=P).nextZ,d--),c?c.nextZ=Y:U=Y,Y.prevZ=c,c=Y;O=P}c.nextZ=null,a*=2}while(1<L);return U},x.zOrder=function(U,F,O,P,Y){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U=32767*(U-O)*Y)|U<<8))|U<<4))|U<<2))|U<<1))|(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F=32767*(F-P)*Y)|F<<8))|F<<4))|F<<2))|F<<1))<<1},x.getLeftmost=function(U){for(var F=U,O=U;F.x<O.x&&(O=F),(F=F.next)!==U;);return O},x.pointInTriangle=function(U,F,O,P,Y,c,L,u){return 0<=(Y-L)*(F-u)-(U-L)*(c-u)&&0<=(U-L)*(P-u)-(O-L)*(F-u)&&0<=(O-L)*(c-u)-(Y-L)*(P-u)},x.isValidDiagonal=function(U,F){return U.next.i!==F.i&&U.prev.i!==F.i&&!x.intersectsPolygon(U,F)&&x.locallyInside(U,F)&&x.locallyInside(F,U)&&x.middleInside(U,F)},x.area=function(U,F,O){return(F.y-U.y)*(O.x-F.x)-(F.x-U.x)*(O.y-F.y)},x.equals=function(U,F){return U.x===F.x&&U.y===F.y},x.intersects=function(U,F,O,P){return!!(x.equals(U,F)&&x.equals(O,P)||x.equals(U,P)&&x.equals(O,F))||0<x.area(U,F,O)!=0<x.area(U,F,P)&&0<x.area(O,P,U)!=0<x.area(O,P,F)},x.intersectsPolygon=function(U,F){var O=U;do{if(O.i!==U.i&&O.next.i!==U.i&&O.i!==F.i&&O.next.i!==F.i&&x.intersects(O,O.next,U,F))return!0;O=O.next}while(O!==U);return!1},x.locallyInside=function(U,F){return x.area(U.prev,U,U.next)<0?0<=x.area(U,F,U.next)&&0<=x.area(U,U.prev,F):x.area(U,F,U.prev)<0||x.area(U,U.next,F)<0},x.middleInside=function(U,F){for(var O=U,P=!1,Y=(U.x+F.x)/2,c=(U.y+F.y)/2;O.y>c!=O.next.y>c&&O.next.y!==O.y&&Y<(O.next.x-O.x)*(c-O.y)/(O.next.y-O.y)+O.x&&(P=!P),(O=O.next)!==U;);return P},x.splitPolygon=function(U,F){var O=new YU(U.i,U.x,U.y),P=new YU(F.i,F.x,F.y),Y=U.next,c=F.prev;return(U.next=F).prev=U,(O.next=Y).prev=O,(P.next=O).prev=P,(c.next=P).prev=c,P},x.insertNode=function(U,F,O,P){var Y=new YU(U,F,O);return P?(Y.next=P.next,(Y.prev=P).next.prev=Y,P.next=Y):(Y.prev=Y).next=Y,Y},x.removeNode=function(U){U.next.prev=U.prev,U.prev.next=U.next,U.prevZ&&(U.prevZ.nextZ=U.nextZ),U.nextZ&&(U.nextZ.prevZ=U.prevZ)},x.signedArea=function(U,F,O,P){for(var Y=0,c=F,L=O-P;c<O;c+=P)Y+=(U[L]-U[c])*(U[c+1]+U[L+1]),L=c;return Y},x}(),YU=function(){function U(U,F,O){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=U,this.x=F,this.y=O,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return J(U,"laya.webgl.shapes.EarcutNode"),U}(),cU=(function(){function U(U,F,O,P,Y,c,L){this.lineWidth=U,this.lineColor=F,this.lineAlpha=O,this.fillColor=P,this.fillAlpha=Y,this.shape=L,this.fill=c}J(U,"laya.webgl.shapes.GeometryData");var F=U.prototype;F.clone=function(){return new U(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},F.getIndexData=function(){return null},F.getVertexData=function(){return null},F.destroy=function(){this.shape=null}}(),function(){function U(U){if(U instanceof Float32Array)this.points=U;else if(U instanceof Array){U.length;this.points=new Float32Array(U)}}J(U,"laya.webgl.shapes.Vertex");var F=U.prototype;K.imps(F,{"laya.webgl.shapes.IShape":!0}),F.getData=function(U,F,O){},F.needUpdate=function(U){return!1},F.rebuild=function(U){},F.setMatrix=function(U){}}(),function(){function d(U){void 0===U&&(U=1e4),this._renderType=U}J(d,"laya.webgl.submit.Submit");var U=d.prototype;return K.imps(U,{"laya.webgl.submit.ISubmit":!0}),U.releaseRender=function(){var U=d._cache;(U[U._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},U.getRenderType=function(){return this._renderType},U.renderSubmit=function(){if(0===this._numEle)return 1;var U=this.shaderValue.textureHost;if(U){var F=U.source;if(!U.bitmap||!F)return 1;this.shaderValue.texture=F,U.alphaTexture&&U.alphaTexture.source&&(this.shaderValue.texture1=U.alphaTexture.source)}this._vb.bind_upload(this._ib);var O=XU.mainContext;return this.shaderValue.upload(),_.activeBlendFunction!==this._blendFn&&(O.enable(3042),this._blendFn(O),_.activeBlendFunction=this._blendFn),s.drawCall++,s.trianglesFaces+=this._numEle/3,O.drawElements(4,this._numEle,5123,this._startIdx),1},d.__init__=function(){var U=d.RENDERBASE=new d(-1);U.shaderValue=new IU(0,0),U.shaderValue.ALPHA=-1234},d.createSubmit=function(U,F,O,P,Y){var c=d._cache._length?d._cache[--d._cache._length]:new d;null==O&&((O=c._selfVb||(c._selfVb=EU.create(-1))).clear(),P=0),c._ib=F,c._vb=O,c._startIdx=P*xU.BYTES_PIDX,c._numEle=0;var L=U._nBlendType;c._blendFn=U._targets?_.targetFns[L]:_.fns[L],c.shaderValue=Y,c.shaderValue.setValue(U._shader2D);var u=U._shader2D.filters;return u&&c.shaderValue.setFilters(u),c},d.createShape=function(U,F,O,P,Y,c){var L=d._cache._length?d._cache[--d._cache._length]:new d;L._ib=F,L._vb=O,L._numEle=P,L._startIdx=Y,L.shaderValue=c,L.shaderValue.setValue(U._shader2D);var u=U._nBlendType;return L._blendFn=U._targets?_.targetFns[u]:_.fns[u],L},d.TYPE_2D=1e4,d.TYPE_CANVAS=10003,d.TYPE_CMDSETRT=10004,d.TYPE_CUSTOM=10005,d.TYPE_BLURRT=10006,d.TYPE_CMDDESTORYPRERT=10007,d.TYPE_DISABLESTENCIL=10008,d.TYPE_OTHERIBVB=10009,d.TYPE_PRIMITIVE=10010,d.TYPE_RT=10011,d.TYPE_BLUR_RT=10012,d.TYPE_TARGET=10013,d.TYPE_CHANGE_VALUE=10014,d.TYPE_SHAPE=10015,d.TYPE_TEXTURE=10016,d.TYPE_FILLTEXTURE=10017,d.RENDERBASE=null,d._cache=((d._cache=[])._length=0,d._cache),d}()),LU=function(){function P(){this.fun=null,this.args=null}J(P,"laya.webgl.submit.SubmitCMD");var U=P.prototype;return K.imps(U,{"laya.webgl.submit.ISubmit":!0}),U.renderSubmit=function(){return this.fun.apply(null,this.args),1},U.getRenderType=function(){return 0},U.releaseRender=function(){var U=P._cache;U[U._length++]=this},P.create=function(U,F){var O=P._cache._length?P._cache[--P._cache._length]:new P;return O.fun=F,O.args=U,O},P._cache=((P._cache=[])._length=0,P._cache),P}(),uU=function(){function F(){this.variables={}}J(F,"laya.webgl.submit.SubmitCMDScope");var U=F.prototype;return U.getValue=function(U){return this.variables[U]},U.addValue=function(U,F){return this.variables[U]=F},U.setValue=function(U,F){return this.variables.hasOwnProperty(U)?this.variables[U]=F:null},U.clear=function(){for(var U in this.variables)delete this.variables[U]},U.recycle=function(){this.clear(),F.POOL.push(this)},F.create=function(){var U=F.POOL.pop();return U||(U=new F),U},F.POOL=[],F}(),dU=function(){function z(){this.offset=0,this.startIndex=0,this._mat=T.create()}J(z,"laya.webgl.submit.SubmitOtherIBVB");var U=z.prototype;return K.imps(U,{"laya.webgl.submit.ISubmit":!0}),U.releaseRender=function(){var U=z._cache;(U[U._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},U.getRenderType=function(){return 10009},U.renderSubmit=function(){var U=this._shaderValue.textureHost;if(U){var F=U.source;if(!U.bitmap||!F)return 1;this._shaderValue.texture=F}this._vb.bind_upload(this._ib);var O=hU.worldMatrix4,P=T.TEMP;T.mulPre(this._mat,O[0],O[1],O[4],O[5],O[12],O[13],P);var Y=hU.worldMatrix4=z.tempMatrix4;Y[0]=P.a,Y[1]=P.b,Y[4]=P.c,Y[5]=P.d,Y[12]=P.tx,Y[13]=P.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var c=XU.mainContext;return _.activeBlendFunction!==this._blendFn&&(c.enable(3042),this._blendFn(c),_.activeBlendFunction=this._blendFn),s.drawCall++,s.trianglesFaces+=this._numEle/3,c.drawElements(4,this._numEle,5123,this.startIndex),hU.worldMatrix4=O,GU.activeShader=null,1},z.create=function(U,F,O,P,Y,c,L,u,d){void 0===d&&(d=0);var a=z._cache._length?z._cache[--z._cache._length]:new z;a._ib=O,a._vb=F,a._numEle=P,a._shader=Y,a._shaderValue=c;var b=U._nBlendType;switch(a._blendFn=U._targets?_.targetFns[b]:_.fns[b],d){case 0:a.offset=0,a.startIndex=u/(xU.BYTES_PE*F.vertexStride)*1.5,a.startIndex*=xU.BYTES_PIDX;break;case 1:a.startIndex=L,a.offset=u}return a},z._cache=((z._cache=[])._length=0,z._cache),z.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],z}(),aU=function(){function O(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new l,this.screenRect=new l}J(O,"laya.webgl.submit.SubmitScissor");var U=O.prototype;return K.imps(U,{"laya.webgl.submit.ISubmit":!0}),U._scissor=function(U,F,O,P){var Y=hU.worldMatrix4,c=Y[0],L=Y[5],u=Y[12],d=Y[13];if(P*=L,(O*=c)<1||P<1)return!1;var a=(U=U*c+u)+O,b=(F=F*L+d)+P;U<0&&(O=a-(U=0)),F<0&&(P=b-(F=0));var z=hU.worldClipRect;if(U=Math.max(U,z.x),F=Math.max(F,z.y),O=Math.min(a,z.right)-U,P=Math.min(b,z.bottom)-F,O<1||P<1)return!1;var J=hU.worldScissorTest;return this.screenRect.copyFrom(z),z.x=U,z.y=F,z.width=O,z.height=P,hU.worldScissorTest=!0,F=hU.height-F-P,XU.mainContext.scissor(U,F,O,P),XU.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),J?(F=hU.height-this.screenRect.y-this.screenRect.height,XU.mainContext.scissor(this.screenRect.x,F,this.screenRect.width,this.screenRect.height),XU.mainContext.enable(3089)):(XU.mainContext.disable(3089),hU.worldScissorTest=!1),z.copyFrom(this.screenRect),!0},U._scissorWithTagart=function(U,F,O,P){if(O<1||P<1)return!1;var Y=U+O,c=F+P;U<0&&(O=Y-(U=0)),F<0&&(P=c-(F=0));var L=hU.worldClipRect;if(U=Math.max(U,L.x),F=Math.max(F,L.y),O=Math.min(Y,L.right)-U,P=Math.min(c,L.bottom)-F,O<1||P<1)return!1;var u=hU.worldScissorTest;return this.screenRect.copyFrom(L),hU.worldScissorTest=!0,L.x=U,L.y=F,L.width=O,L.height=P,F=hU.height-F-P,XU.mainContext.scissor(U,F,O,P),XU.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),u?(F=hU.height-this.screenRect.y-this.screenRect.height,XU.mainContext.scissor(this.screenRect.x,F,this.screenRect.width,this.screenRect.height),XU.mainContext.enable(3089)):(XU.mainContext.disable(3089),hU.worldScissorTest=!1),L.copyFrom(this.screenRect),!0},U.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},U.getRenderType=function(){return 0},U.releaseRender=function(){var U=O._cache;(U[U._length++]=this).context=null},O.create=function(U){var F=O._cache._length?O._cache[--O._cache._length]:new O;return F.context=U,F},O._cache=((O._cache=[])._length=0,O._cache),O}(),bU=function(){function d(){this.step=0,this.blendMode=null,this.level=0}J(d,"laya.webgl.submit.SubmitStencil");var U=d.prototype;return K.imps(U,{"laya.webgl.submit.ISubmit":!0}),U.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},U.getRenderType=function(){return 0},U.releaseRender=function(){var U=d._cache;U[U._length++]=this},U.do1=function(){var U=XU.mainContext;U.enable(2960),U.clear(1024),U.colorMask(!1,!1,!1,!1),U.stencilFunc(514,this.level,255),U.stencilOp(7680,7680,7682)},U.do2=function(){var U=XU.mainContext;U.stencilFunc(514,this.level+1,255),U.colorMask(!0,!0,!0,!0),U.stencilOp(7680,7680,7680)},U.do3=function(){var U=XU.mainContext;U.colorMask(!0,!0,!0,!0),U.stencilOp(7680,7680,7680),U.clear(1024),U.disable(2960)},U.do4=function(){var U=XU.mainContext;0==this.level&&(U.enable(2960),U.clear(1024)),U.colorMask(!1,!1,!1,!1),U.stencilFunc(519,0,255),U.stencilOp(7680,7680,7682)},U.do5=function(){var U=XU.mainContext;U.stencilFunc(514,this.level,255),U.colorMask(!0,!0,!0,!0),U.stencilOp(7680,7680,7680)},U.do6=function(){var U=XU.mainContext;_.targetFns[_.TOINT[this.blendMode]](U)},U.do7=function(){var U=XU.mainContext;U.colorMask(!1,!1,!1,!1),U.stencilOp(7680,7680,7683)},U.do8=function(){var U=XU.mainContext;U.colorMask(!0,!0,!0,!0),U.stencilFunc(514,this.level,255),U.stencilOp(7680,7680,7680)},d.restore=function(U,F,O,P,Y){var c;if((U._renderKey=0)<d._mask&&d._mask--,0==d._mask)c=laya.webgl.submit.SubmitStencil.create(3),U.addRenderObject(c),U._curSubmit=cU.RENDERBASE;else{c=laya.webgl.submit.SubmitStencil.create(7),U.addRenderObject(c);var L=U._vb;L._byteLength;if(rU.fillRectImgVb(L,null,F.x,F.y,F.width,F.height,A.DEF_UV,O,P,Y,0,0)){U._shader2D.glTexture=null;var u=U._curSubmit=cU.createSubmit(U,U._ib,L,(L._byteLength-64)/32*3,IU.create(2,0));u.shaderValue.ALPHA=1,U._submits[U._submits._length++]=u,U._curSubmit._numEle+=6,U._curSubmit=cU.RENDERBASE}else alert("clipRect calc stencil rect error");c=laya.webgl.submit.SubmitStencil.create(8),U.addRenderObject(c)}},d.restore2=function(U,F){var O;(U._renderKey=0)<d._mask&&d._mask--,0==d._mask?(O=laya.webgl.submit.SubmitStencil.create(3),U.addRenderObject(O),U._curSubmit=cU.RENDERBASE):(O=laya.webgl.submit.SubmitStencil.create(7),U.addRenderObject(O),U._submits[U._submits._length++]=F,O=laya.webgl.submit.SubmitStencil.create(8),U.addRenderObject(O))},d.create=function(U){var F=d._cache._length?d._cache[--d._cache._length]:new d;return 5==(F.step=U)&&++d._mask,F.level=d._mask,F},d._cache=((d._cache=[])._length=0,d._cache),d._mask=0,d}(),zU=function(){function u(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}J(u,"laya.webgl.submit.SubmitTarget");var U=u.prototype;return K.imps(U,{"laya.webgl.submit.ISubmit":!0}),U.renderSubmit=function(){this._vb.bind_upload(this._ib);var U=this.scope.getValue(this.proName);return U&&(this.shaderValue.texture=U.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[U.width,U.height]),this.shaderValue.upload(),this.blend(),s.drawCall++,s.trianglesFaces+=this._numEle/3,XU.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},U.blend=function(){if(_.activeBlendFunction!==_.fns[this.blendType]){var U=XU.mainContext;U.enable(3042),_.fns[this.blendType](U),_.activeBlendFunction=_.fns[this.blendType]}},U.getRenderType=function(){return 0},U.releaseRender=function(){var U=u._cache;(U[U._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},u.create=function(U,F,O,P,Y,c){var L=u._cache._length?u._cache[--u._cache._length]:new u;return L._ib=F,L._vb=O,L.proName=c,L._startIdx=P*xU.BYTES_PIDX,L._numEle=0,L.blendType=U._nBlendType,L.shaderValue=Y,L.shaderValue.setValue(U._shader2D),L},u._cache=((u._cache=[])._length=0,u._cache),u}(),JU=function(){function U(){this._sourceStr=null}J(U,"laya.webgl.text.CharSegment");var F=U.prototype;return K.imps(F,{"laya.webgl.text.ICharSegment":!0}),F.textToSpit=function(U){this._sourceStr=U},F.getChar=function(U){return this._sourceStr.charAt(U)},F.getCharCode=function(U){return this._sourceStr.charCodeAt(U)},F.length=function(){return this._sourceStr.length},U}(),wU=function(){var U;function s(){}return J(s,"laya.webgl.text.DrawText"),s.__init__=function(){s._charsTemp=new Array,s._drawValue=new U,s._charSeg=new JU},s.customCharSeg=function(U){s._charSeg=U},s.getChar=function(U,F,O){var P=ZU.createOneChar(U,O);return-1!=F&&(s._charsCache[F]=P),P},s._drawSlow=function(U,F,O,P,Y,c,L,u,d,a,b,z,J,w,j){var x,r,H=s._drawValue.value(c,u,d,a,J,w,j),h=0,Q=0,X=s._charsTemp,N=0,K=NaN;if(P)for(X.length=P.length,h=0,Q=P.length;h<Q;h++)(r=P[h])&&(K=r.charNum+H.txtID,X[h]=x=s._charsCache[K]||s.getChar(r.char,K,H),x.active());else{var f=O instanceof laya.utils.WordText?O.toString():O;if(k.CharacterCache){s._charSeg.textToSpit(f);var I=s._charSeg.length();for(h=0,Q=X.length=I;h<Q;h++)K=s._charSeg.getCharCode(h)+H.txtID,X[h]=x=s._charsCache[K]||s.getChar(s._charSeg.getChar(h),K,H),x.active(),N+=x.cw}else X.length=0,(x=s.getChar(f,-1,H)).active(),N+=x.cw,X[0]=x}var T=0;null!==L&&"left"!==L&&(T=-("center"==L?N/2:N));var g,l,$=NaN,C=0;if(P)for(h=0,Q=X.length;h<Q;h++)x=X[h],r=P[h],x&&r&&!x.isSpace&&($=x.borderSize,g=x.texture,F._drawText(g,b+T+r.x*J-$,z+r.y*w-$,g.width,g.height,Y,0,0,0,0));else{for(h=0,Q=X.length;h<Q;h++)(x=X[h])&&!x.isSpace&&($=x.borderSize,g=x.texture,F._drawText(g,b+T-$,z-$,g.width,g.height,Y,0,0,0,0),U&&((l=U[C++])||(l=U[C-1]=[]),l[0]=g,l[1]=T-$,l[2]=-$)),T+=x.cw;U&&(U.length=C)}},s._drawFast=function(U,F,O,P,Y){for(var c,L,u=0,d=U.length;u<d;u++)(c=(L=U[u])[0]).active(),F._drawText(c,P+L[1],Y+L[2],c.width,c.height,O,0,0,0,0)},s.drawText=function(U,F,O,P,Y,c,L,u,d,a,b,z){if(void 0===z&&(z=0),!(F&&0===F.length||O&&0===O.length)){var J=P.a,w=P.d;(0!==P.b||0!==P.c)&&(J=w=1);var j=1!==J||1!==w;if(j&&K.stage.transform){var x=K.stage.transform;j=x.a===J&&x.d===w}else j=!1;if(j){var r=(P=P.copyTo(fU._tmpMatrix)).tx,H=P.ty;P.scale(1/J,1/w),P._checkTransform(),a*=J,b*=w,a+=r-P.tx,b+=H-P.ty}else J=w=1;if(O)s._drawSlow(null,U,F,O,P,Y,c,L,u,d,a,b,J,w,z);else{if(null===F.toUpperCase){var h=J+1e5*w,Q=F;return void(Q.changed||Q.id!==h?(Q.id=h,Q.changed=!1,s._drawSlow(Q.save,U,F,O,P,Y,c,L,u,d,a,b,J,w,z)):s._drawFast(Q.save,U,P,a,b))}var X=F+Y.toString()+L+u+d+J+w+c,N=s._textsCache[X];k.CharacterCache?N?s._drawFast(N,U,P,a,b):(s._textsCache.__length||(s._textsCache.__length=0),s._textsCache.__length>f.WebGLTextCacheCount&&((s._textsCache={}).__length=0,s._curPoolIndex=0),s._textCachesPool[s._curPoolIndex]?(N=s._textsCache[X]=s._textCachesPool[s._curPoolIndex]).length=0:s._textCachesPool[s._curPoolIndex]=N=s._textsCache[X]=[],s._textsCache.__length++,s._curPoolIndex++,s._drawSlow(N,U,F,O,P,Y,c,L,u,d,a,b,J,w,z)):s._drawSlow(N,U,F,O,P,Y,c,L,u,d,a,b,J,w,z)}}},s._charsTemp=null,s._textCachesPool=[],s._curPoolIndex=0,s._charsCache={},s._textsCache={},s._drawValue=null,s.d=[],s._charSeg=null,s.__init$=function(){U=function(){function d(){}return J(d,""),d.prototype.value=function(U,F,O,P,Y,c,L){this.font=U,this.fillColor=F,this.borderColor=O,this.lineWidth=P,this.scaleX=Y,this.scaleY=c,this.underLine=L;var u=U.toString()+Y+c+P+(F?F.toLowerCase():" ")+(O?O.toLowerCase():" ")+L;return this.txtID=d._keymap[u],this.txtID||(this.txtID=1e-7*++d._keymapCount,d._keymap[u]=this.txtID),this},d.clear=function(){d._keymap={},d._keymapCount=1},d._keymap={},d._keymapCount=1,d}()},s}(),jU=function(){function Y(U){this._index=0,this._size=14,this._italic=-2,Y._cache2=Y._cache2||[],this.setFont(U||"14px Arial")}J(Y,"laya.webgl.text.FontInContext");var U=Y.prototype;return U.setFont=function(U){var F=Y._cache2[U];if(F)this._words=F[0],this._size=F[1];else{this._words=U.split(" ");for(var O=0,P=this._words.length;O<P;O++)if(0<this._words[O].indexOf("px")){this._index=O;break}this._size=parseInt(this._words[this._index]),Y._cache2[U]=[this._words,this._size]}this._text=null,this._italic=-2},U.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},U.hasType=function(U){for(var F=0,O=this._words.length;F<O;F++)if(this._words[F]===U)return F;return-1},U.removeType=function(U){for(var F=0,O=this._words.length;F<O;F++)if(this._words[F]===U){this._words.splice(F,1),this._index>F&&this._index--;break}this._text=null,this._italic=-2},U.copyTo=function(U){return U._text=this._text,U._size=this._size,U._index=this._index,U._words=this._words.slice(),U._italic=-2,U},U.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},P(0,U,"size",function(){return this._size},function(U){this._size=U,this._words[this._index]=U+"px",this._text=null}),Y.create=function(U){var F=Y._cache[U];return F||(F=Y._cache[U]=new Y(U))},Y.EMPTY=new Y,Y._cache={},Y._cache2=null,Y}(),xU=function(){function U(){}return J(U,"laya.webgl.utils.CONST3D2D"),U.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],U.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],U.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],U._TMPARRAY=[],U._OFFSETX=0,U._OFFSETY=0,L(U,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),U}(),rU=function(){function j(){}return J(j,"laya.webgl.utils.GlUtils"),j.make2DProjection=function(U,F,O){return[2/U,0,0,0,0,-2/F,0,0,0,0,2/O,0,-1,1,0,1]},j.fillIBQuadrangle=function(U,F){if(65535/4<F)throw Error("IBQuadrangle count:"+F+" must<:"+Math.floor(65535/4));F=Math.floor(F),U._resizeBuffer(6*(F+1)*2,!1),U.byteLength=U.bufferLength;for(var O=U.getUint16Array(),P=0,Y=0;Y<F;Y++)O[P++]=4*Y,O[P++]=4*Y+2,O[P++]=4*Y+1,O[P++]=4*Y,O[P++]=4*Y+3,O[P++]=4*Y+2;return U.setNeedUpload(),!0},j.expandIBQuadrangle=function(U,F){U.bufferLength>=6*F*2||j.fillIBQuadrangle(U,F)},j.mathCeilPowerOfTwo=function(U){return U--,U|=U>>1,U|=U>>2,U|=U>>4,U|=U>>8,U|=U>>16,++U},j.fillQuadrangleImgVb=function(U,F,O,P,Y,c,L,u){var d=16+(U._byteLength>>2);U.byteLength=d<<2;var a=U.getFloat32Array();a[(d-=16)+2]=Y[0],a[d+3]=Y[1],a[d+6]=Y[2],a[d+7]=Y[3],a[d+10]=Y[4],a[d+11]=Y[5],a[d+14]=Y[6],a[d+15]=Y[7];var b=c.a,z=c.b,J=c.c,w=c.d;if(1!==b||0!==z||0!==J||1!==w){c.bTransform=!0;var j=c.tx+L,x=c.ty+u;a[d]=(P[0]+F)*b+(P[1]+O)*J+j,a[d+1]=(P[0]+F)*z+(P[1]+O)*w+x,a[d+4]=(P[2]+F)*b+(P[3]+O)*J+j,a[d+5]=(P[2]+F)*z+(P[3]+O)*w+x,a[d+8]=(P[4]+F)*b+(P[5]+O)*J+j,a[d+9]=(P[4]+F)*z+(P[5]+O)*w+x,a[d+12]=(P[6]+F)*b+(P[7]+O)*J+j,a[d+13]=(P[6]+F)*z+(P[7]+O)*w+x}else c.bTransform=!1,F+=c.tx+L,O+=c.ty+u,a[d]=F+P[0],a[d+1]=O+P[1],a[d+4]=F+P[2],a[d+5]=O+P[3],a[d+8]=F+P[4],a[d+9]=O+P[5],a[d+12]=F+P[6],a[d+13]=O+P[7];return U._upload=!0},j.fillTranglesVB=function(U,F,O,P,Y,c,L){var u=(U._byteLength>>2)+P.length;U.byteLength=u<<2;var d=U.getFloat32Array();u-=P.length;for(var a=P.length,b=Y.a,z=Y.b,J=Y.c,w=Y.d,j=0;j<a;j+=4)if(d[u+j+2]=P[j+2],d[u+j+3]=P[j+3],1!==b||0!==z||0!==J||1!==w){Y.bTransform=!0;var x=Y.tx+c,r=Y.ty+L;d[u+j]=(P[j]+F)*b+(P[j+1]+O)*J+x,d[u+j+1]=(P[j]+F)*z+(P[j+1]+O)*w+r}else Y.bTransform=!1,F+=Y.tx+c,O+=Y.ty+L,d[u+j]=F+P[j],d[u+j+1]=O+P[j+1];return U._upload=!0},j.copyPreImgVb=function(U,F,O){var P=U._byteLength>>2;U.byteLength=P+16<<2;for(var Y=U.getFloat32Array(),c=0,L=P-16;c<4;c++)Y[P]=Y[L]+F,++L,Y[++P]=Y[L]+O,++L,Y[++P]=Y[L],++L,Y[++P]=Y[L],++P,++L;U._upload=!0},j.fillRectImgVb=function(U,F,O,P,Y,c,L,u,d,a,b,z,J){void 0===J&&(J=!1);var w,j,x,r,H,h,Q,X,N,K,f,I,T,g,l,$,C=1,s=u.a,i=u.b,y=u.c,k=u.d,A=F&&F.width<99999999;if(1!==s||0!==i||0!==y||1!==k?(u.bTransform=!0,0===i&&0===y&&(C=23,N=Y+O,K=c+P,w=s*O+(f=u.tx+d),x=s*N+f,j=k*P+(I=u.ty+a),r=k*K+I)):(C=23,u.bTransform=!1,x=(w=O+u.tx+d)+Y,r=(j=P+u.ty+a)+c),A&&(H=F.x,h=F.y,Q=F.width+H,X=F.height+h),1!==C){if(Math.min(w,x)>=Q)return!1;if(Math.min(j,r)>=X)return!1;if(Math.max(x,w)<=H)return!1;if(Math.max(r,j)<=h)return!1}var G=U._byteLength>>2;U.byteLength=16+G<<2;var V=U.getFloat32Array();switch(V[2+G]=L[0],V[3+G]=L[1],V[6+G]=L[2],V[7+G]=L[3],V[10+G]=L[4],V[11+G]=L[5],V[14+G]=L[6],V[15+G]=L[7],C){case 1:f=u.tx+d,I=u.ty+a;var M=s*O,m=y*P,p=k*P,o=i*O,R=s*(N=Y+O),_=y*(K=c+P),q=k*K,D=i*N;J?(T=M+m+f,l=Math.round(T)-T,g=p+o+I,$=Math.round(g)-g,V[G]=T+l,V[1+G]=g+$,V[4+G]=R+m+f+l,V[5+G]=p+D+I+$,V[8+G]=R+_+f+l,V[9+G]=q+D+I+$,V[12+G]=M+_+f+l,V[13+G]=q+o+I+$):(V[G]=M+m+f,V[1+G]=p+o+I,V[4+G]=R+m+f,V[5+G]=p+D+I,V[8+G]=R+_+f,V[9+G]=q+D+I,V[12+G]=M+_+f,V[13+G]=q+o+I);break;case 23:J?(T=w+b,l=Math.round(T)-T,g=j,$=Math.round(g)-g,V[G]=T+l,V[1+G]=g+$,V[4+G]=x+b+l,V[5+G]=j+$,V[8+G]=x+l,V[9+G]=r+$,V[12+G]=w+l,V[13+G]=r+$):(V[G]=w+b,V[1+G]=j,V[4+G]=x+b,V[5+G]=j,V[8+G]=x,V[9+G]=r,V[12+G]=w,V[13+G]=r)}return U._upload=!0},j.fillLineVb=function(U,F,O,P,Y,c,L,u){var d=.5*L,a=j._fillLineArray,b=-(P-c),z=O-Y,J=Math.sqrt(b*b+z*z);b/=J,z/=J,b*=d,z*=d,a[0]=O-b,a[1]=P-z,a[4]=O+b,a[5]=P+z,a[8]=Y+b,a[9]=c+z,a[12]=Y-b,a[13]=c-z,u&&u.transformPointArray(a,a);var w=16+(U._byteLength>>2);return U.byteLength=w<<2,U.insertData(a,w-16),!0},j._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],j}(),HU=(function(){function d(){}J(d,"laya.webgl.utils.MatirxArray"),d.ArrayMul=function(U,F,O){if(U)if(F)for(var P=NaN,Y=NaN,c=NaN,L=NaN,u=0;u<4;u++)P=U[u],Y=U[u+4],c=U[u+8],L=U[u+12],O[u]=P*F[0]+Y*F[1]+c*F[2]+L*F[3],O[u+4]=P*F[4]+Y*F[5]+c*F[6]+L*F[7],O[u+8]=P*F[8]+Y*F[9]+c*F[10]+L*F[11],O[u+12]=P*F[12]+Y*F[13]+c*F[14]+L*F[15];else d.copyArray(U,O);else d.copyArray(F,O)},d.copyArray=function(U,F){if(U&&F)for(var O=0;O<U.length;O++)F[O]=U[O]}}(),function(){function F(U,F,O){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=U,this._vb=new EU(U,35048),F&&this._vb._resizeBuffer(F,!1),this._ib=new BU,O&&this._ib._resizeBuffer(O,!1)}J(F,"laya.webgl.utils.Mesh2D");var U=F.prototype;return U.cloneWithNewVB=function(){var U=new F(this._stride,0,0);return U._ib=this._ib,U._quadNum=this._quadNum,U._attribInfo=this._attribInfo,U},U.cloneWithNewVBIB=function(){var U=new F(this._stride,0,0);return U._attribInfo=this._attribInfo,U},U.getVBW=function(){return this._vb.setNeedUpload(),this._vb},U.getVBR=function(){return this._vb},U.getIBR=function(){return this._ib},U.getIBW=function(){return this._ib.setNeedUpload(),this._ib},U.createQuadIB=function(U){this._quadNum=U,this._ib._resizeBuffer(6*U*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var F=this._ib.getUint16Array(),O=0,P=0,Y=0;Y<U;Y++)F[O++]=P,F[O++]=P+2,F[O++]=P+1,F[O++]=P,F[O++]=P+3,F[O++]=P+2,P+=4;this._ib.setNeedUpload()},U.setAttributes=function(U){if(this._attribInfo=U,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},U.getEleNum=function(){return this._ib.getBuffer().byteLength/2},U.releaseMesh=function(){},U.destroy=function(){},U.clearVB=function(){this._vb.clear()},F._gvaoid=0,F}()),hU=function(){function Y(){}return J(Y,"laya.webgl.utils.RenderState2D"),Y.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Y.mat2MatArray=function(U,F){var O=U,P=F;return P[0]=O.a,P[1]=O.b,P[2]=Y.EMPTYMAT4_ARRAY[2],P[3]=Y.EMPTYMAT4_ARRAY[3],P[4]=O.c,P[5]=O.d,P[6]=Y.EMPTYMAT4_ARRAY[6],P[7]=Y.EMPTYMAT4_ARRAY[7],P[8]=Y.EMPTYMAT4_ARRAY[8],P[9]=Y.EMPTYMAT4_ARRAY[9],P[10]=Y.EMPTYMAT4_ARRAY[10],P[11]=Y.EMPTYMAT4_ARRAY[11],P[12]=O.tx,P[13]=O.ty,P[14]=Y.EMPTYMAT4_ARRAY[14],P[15]=Y.EMPTYMAT4_ARRAY[15],F},Y.restoreTempArray=function(){Y.TEMPMAT4_ARRAY[0]=1,Y.TEMPMAT4_ARRAY[1]=0,Y.TEMPMAT4_ARRAY[4]=0,Y.TEMPMAT4_ARRAY[5]=1,Y.TEMPMAT4_ARRAY[12]=0,Y.TEMPMAT4_ARRAY[13]=0},Y.clear=function(){Y.worldScissorTest=!1,Y.worldShaderDefines=null,Y.worldFilters=null,Y.worldAlpha=1,Y.worldClipRect.x=Y.worldClipRect.y=0,Y.worldClipRect.width=Y.width,Y.worldClipRect.height=Y.height,Y.curRenderTarget=null},Y._MAXSIZE=99999999,Y.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Y.worldMatrix4=Y.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Y.worldAlpha=1,Y.worldScissorTest=!1,Y.worldFilters=null,Y.worldShaderDefines=null,Y.curRenderTarget=null,Y.width=0,Y.height=0,L(Y,["worldMatrix",function(){return this.worldMatrix=new T},"worldClipRect",function(){return this.worldClipRect=new l(0,0,99999999,99999999)}]),Y}(),QU=function(){var h,O;function Q(U,F,O,P,Y){var c=this;function L(U){var F=[],O=new h(F);return c._compileToTree(O,U.split("\n"),0,F,Y),O}var u=w.now();this._VS=L(F),this._PS=L(O),this._nameMap=P,2<w.now()-u&&console.log("ShaderCompile use time:"+(w.now()-u)+"  size:"+F.length+"/"+O.length)}J(Q,"laya.webgl.utils.ShaderCompile");var U=Q.prototype;return U._compileToTree=function(U,F,O,P,Y){var c,L,u,d,a,b,z,J=0,w=0,j=0,x=0;for(w=O;w<F.length;w++)if(!((u=F[w]).length<1)&&0!==(J=u.indexOf("//"))){if(0<=J&&(u=u.substr(0,J)),c=z||new h(P),z=null,c.text=u,c.noCompile=!0,0<=(J=u.indexOf("#"))){for(d="#",x=J+1,j=u.length;x<j;x++){var r=u.charAt(x);if(" "===r||"\t"===r||"\r"===r||"\n"===r||"?"===r)break;d+=r}switch(c.name=d){case"#ifdef":case"#ifndef":if(c.src=u,c.noCompile=null!=u.match(/[!&|()=<>]/),c.noCompile?console.log("function():Boolean{return "+u.substr(J+c.name.length)+"}"):(b=u.replace(/^\s*/,"").split(/\s+/),c.setCondition(b[1],"#ifdef"===d?1:2),c.text="//"+c.text),c.setParent(U),U=c,Y)for(b=u.substr(x).split(Q._splitToWordExps3),x=0;x<b.length;x++)(u=b[x]).length&&(Y[u]=!0);continue;case"#if":if(c.src=u,c.noCompile=!0,c.setParent(U),U=c,Y)for(b=u.substr(x).split(Q._splitToWordExps3),x=0;x<b.length;x++)(u=b[x]).length&&"defined"!=u&&(Y[u]=!0);continue;case"#else":c.src=u,L=(U=U.parent).childs[U.childs.length-1],c.noCompile=L.noCompile,c.noCompile||(c.condition=L.condition,c.conditionType=1==L.conditionType?2:1,c.text="//"+c.text+" "+L.text+" "+c.conditionType),c.setParent(U),U=c;continue;case"#endif":L=(U=U.parent).childs[U.childs.length-1],c.noCompile=L.noCompile,c.noCompile||(c.text="//"+c.text),c.setParent(U);continue;case"#include":b=Q.splitToWords(u,null);var H=Q.includes[b[1]];if(!H)throw"ShaderCompile error no this include file:"+b[1];if((J=b[0].indexOf("?"))<0){c.setParent(U),u=H.getWith("with"==b[2]?b[3]:null),this._compileToTree(c,u.split("\n"),0,P,Y),c.text="";continue}c.setCondition(b[0].substr(J+1),1),c.text=H.getWith("with"==b[2]?b[3]:null);break;case"#import":a=(b=Q.splitToWords(u,null))[1],P.push({node:c,file:Q.includes[a],ofs:c.text.length});continue}}else{if((L=U.childs[U.childs.length-1])&&!L.name){0<P.length&&Q.splitToWords(u,L),z=c,L.text+="\n"+u;continue}0<P.length&&Q.splitToWords(u,c)}c.setParent(U)}},U.createShader=function(U,F,O){var P={},Y="";if(U)for(var c in U)Y+="#define "+c+"\n",P[c]=!0;var L=this._VS.toscript(P,[]),u=this._PS.toscript(P,[]);return(O||nU.create)(Y+L.join("\n"),Y+u.join("\n"),F,this._nameMap)},Q._parseOne=function(U,F,O,P,Y,c){var L={type:Q.shaderParamsMap[O[P+1]],name:O[P+2],size:isNaN(parseInt(O[P+3]))?1:parseInt(O[P+3])};return c&&("attribute"==Y?U.push(L):F.push(L)),":"==O[P+3]&&(L.type=O[P+4],P+=2),P+=2},Q.addInclude=function(U,F){if(!F||0===F.length)throw new Error("add shader include file err:"+U);if(Q.includes[U])throw new Error("add shader include file err, has add:"+U);Q.includes[U]=new O(F)},Q.preGetParams=function(U,F){var O=[U,F],P={},Y=[],c=[],L={},u=[];P.attributes=Y,P.uniforms=c,P.defines=L;for(var d=0,a=0,b=0;b<2;b++){O[b]=O[b].replace(Q._removeAnnotation,"");var z,J=O[b].match(Q._reg);for(d=0,a=J.length;d<a;d++){var w=J[d];if("attribute"==w||"uniform"==w)d=Q._parseOne(Y,c,J,d,w,!0);else{if("#define"==w){u[w=J[++d]]=1;continue}if("#ifdef"==w){L[z=J[++d]]=L[z]||[];for(d++;d<a;d++)if("attribute"==(w=J[d])||"uniform"==w)d=Q._parseOne(Y,c,J,d,w,u[z]);else if("#else"==w)for(d++;d<a;d++)if("attribute"==(w=J[d])||"uniform"==w)d=Q._parseOne(Y,c,J,d,w,!u[z]);else if("#endif"==w)break}}}}return P},Q.splitToWords=function(U,F){for(var O,P,Y=[],c=-1,L=0,u=U.length;L<u;L++)if(O=U.charAt(L),0<=" \t=+-*/&%!<>()'\",;".indexOf(O)){if(0<=c&&1<L-c&&(P=U.substr(c,L-c),Y.push(P)),'"'==O||"'"==O){var d=U.indexOf(O,L+1);if(d<0)throw"Sharder err:"+U;Y.push(U.substr(L+1,d-L-1)),L=d,c=-1;continue}"("==O&&F&&0<Y.length&&(P=Y[Y.length-1]+";","vec4;main;".indexOf(P)<0&&(F.useFuns+=P)),c=-1}else c<0&&(c=L);return c<u&&1<u-c&&(P=U.substr(c,u-c),Y.push(P)),Y},Q.IFDEF_NO=0,Q.IFDEF_YES=1,Q.IFDEF_ELSE=2,Q.IFDEF_PARENT=3,Q._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),Q._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),Q._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),Q.includes={},L(Q,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),Q.__init$=function(){h=function(){function O(U){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=U}J(O,"");var U=O.prototype;return U.setParent=function(U){U.childs.push(this),this.z=U.z+1,this.parent=U},U.setCondition=function(U,F){U&&(this.conditionType=F,U=U.replace(/(\s*$)/g,""),this.condition=function(){return this[U]},this.condition.__condition=U)},U.toscript=function(U,F){return this._toscript(U,F,++O.__id)},U._toscript=function(P,Y,c){if(this.childs.length<1&&!this.text)return Y;Y.length;if(this.condition){var U=!!this.condition.call(P);if(2===this.conditionType&&(U=!U),!U)return Y}if(this.text&&Y.push(this.text),0<this.childs.length&&this.childs.forEach(function(U,F,O){U._toscript(P,Y,c)}),0<this.includefiles.length&&0<this.useFuns.length)for(var F,O=0,L=this.includefiles.length;O<L;O++)this.includefiles[O].curUseID!=c&&0<(F=this.includefiles[O].file.getFunsScript(this.useFuns)).length&&(this.includefiles[O].curUseID=c,Y[0]=F+Y[0]);return Y},O.__id=1,O}(),O=function(){function U(U){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=U;for(var F=0,O=0,P=0;!((F=U.indexOf("#begin",F))<0);){for(P=F+5;!((P=U.indexOf("#end",P))<0)&&"i"===U.charAt(P+4);)P+=5;if(P<0)throw"add include err,no #end:"+U;O=U.indexOf("\n",F);var Y=Q.splitToWords(U.substr(F,O-F),null);"code"==Y[1]?this.codes[Y[2]]=U.substr(O+1,P-O-1):"function"==Y[1]&&(O=U.indexOf("function",F),O+="function".length,this.funs[Y[3]]=U.substr(O+1,P-O-1),this.funnames+=Y[3]+";"),F=P+1}}J(U,"");var F=U.prototype;return F.getWith=function(U){var F=U?this.codes[U]:this.script;if(!F)throw"get with error:"+U;return F},F.getFunsScript=function(U){var F="";for(var O in this.funs)0<=U.indexOf(O+";")&&(F+=this.funs[O]);return F},U}()},Q}(),XU=function(){function L(){}return J(L,"laya.webgl.WebGL"),L._uint8ArraySlice=function(){for(var U=this.length,F=new Uint8Array(this.length),O=0;O<U;O++)F[O]=this[O];return F},L._float32ArraySlice=function(){for(var U=this.length,F=new Float32Array(this.length),O=0;O<U;O++)F[O]=this[O];return F},L._uint16ArraySlice=function(U){var F,O=arguments,P=0,Y=0;if(0===O.length)for(P=this.length,F=new Uint16Array(P),Y=0;Y<P;Y++)F[Y]=this[Y];else if(2===O.length){var c=O[0],L=O[1];if(c<L)for(P=L-c,F=new Uint16Array(P),Y=c;Y<L;Y++)F[Y-c]=this[Y];else F=new Uint16Array(0)}return F},L.expandContext=function(){var U=Y.prototype,F=CanvasRenderingContext2D.prototype;F.fillTrangles=U.fillTrangles,tU.__int__(null),F.setIBVB=function(U,F,O,P,Y,c,L,u,d,a){void 0===d&&(d=0),void 0===a&&(a=0),null===O&&(this._ib=this._ib||BU.QuadrangleIB,O=this._ib,rU.expandIBQuadrangle(O,P._byteLength/64+8)),this._setIBVB(U,F,O,P,Y,c,L,u,d,a)},F.fillTrangles=function(U,F,O,P,Y){this._curMat=this._curMat||T.create(),this._vb=this._vb||EU.create(),this._ib||(this._ib=BU.create(),rU.fillIBQuadrangle(this._ib,L/4));var c=this._vb,L=P.length>>4;rU.fillTranglesVB(c,F,O,P,Y||this._curMat,0,0),rU.expandIBQuadrangle(this._ib,c._byteLength/64+8);var u=new IU(1,0);u.textureHost=U;var d=new WU("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");c._vertType=3,this._setIBVB(F,O,this._ib,c,6*L,Y,d,u,0,0)}},L.enable=function(){if(w.__init__(),H.isConchApp&&!H.isConchWebGL)return N.skinAniSprite=function(){return new UU},L.expandContext(),!1;if(N.getWebGLContext=function(U){for(var F,O=["webgl","experimental-webgl","webkit-3d","moz-webgl"],P=0;P<O.length;P++){try{F=U.getContext(O[P],{stencil:f.isStencil,alpha:f.isAlpha,antialias:f.isAntialias,premultipliedAlpha:f.premultipliedAlpha,preserveDrawingBuffer:f.preserveDrawingBuffer})}catch(U){}if(F)return F}return null},null==(L.mainContext=L.mainContext||N.getWebGLContext(H._mainCanvas)))return!1;if(H.isWebGL)return!0;x.create=function(U,F){return new UF(U,F)},r.create=function(U,F,O,P,Y,c,L){return new vU(U,F,O,P,Y,c,L)},H.WebGL=L,H.isWebGL=!0,wU.__init__(),N.createRenderSprite=function(U,F){return new TU(U,F)},N.createWebGLContext2D=function(U){return new fU(U)},N.changeWebGLSize=function(U,F){laya.webgl.WebGL.onStageResize(U,F)},N.createGraphics=function(){return new KU};var U=N.createFilterAction;return N.createFilterAction=U||function(U){return new gU},N.clear=function(U){hU.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var F=H.context.ctx,O=0==F._submits._length||f.preserveDrawingBuffer?j.create(U)._color:C._wgColor;O&&F.clearBG(O[0],O[1],O[2],O[3]),hU.clear()},N.addToAtlas=function(U,F){void 0===F&&(F=!1);var O=U.bitmap;H.optimizeTextureMemory(U.url,U)?K.__typeof(O,"laya.webgl.resource.IMergeAtlasBitmap")&&O.allowMerageInAtlas&&O.on("recovered",U,U.addTextureToAtlas):O.enableMerageInAtlas=!1},N.isAtlas=function(U){return U instanceof laya.webgl.atlas.AtlasWebGLCanvas},o._enable(),N.beginFlush=function(){for(var U=o.instance,F=U.getAtlaserCount(),O=0;O<F;O++){var P=U.getAtlaserByIndex(O).texture;P._flashCacheImageNeedFlush&&N.flashFlushImage(P)}},N.drawToCanvas=function(U,F,O,P,Y,c){(O<=0||P<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),O|=0,P|=0,Y|=0,c|=0;var L=VU.create(O,P,6408,5121,0,!1);L.start(),L.clear(0,0,0,0),H.context.clear(),h.renders[F]._fun(U,H.context,Y,hU.height-P+c),H.context.flush(),L.end();var u=L.getData(0,0,O,P);if(L.recycle(),u.byteLength==O*P*4){var d=new DU;d._canvas=w.createElement("canvas"),d.size(O,P);var a=d._canvas.getContext("2d");w.canvas.size(O,P);var b=w.context,z=b.createImageData(O,P);return z.data.set(new Uint8ClampedArray(u.buffer)),d._imgData=z,b.putImageData(z,0,0),a.save(),a.translate(0,P),a.scale(1,-1),a.drawImage(w.canvas.source,0,0),a.restore(),d}console.log("drawToCanvas error: w:"+O+",h:"+P+",datalen:"+u.byteLength)},N.createFilterAction=function(U){var F;switch(U){case 32:F=new gU}return F},N.addTextureToAtlas=function(U){U._uvID++,o._atlasRestore++,U.bitmap.enableMerageInAtlas&&o.instance.addToAtlas(U)},N.getTexturePixels=function(U,F,O,P,Y){H.context.ctx.clear();var c=new $;c.graphics.drawTexture(U,-F,-O);var L=VU.create(P,Y);L.start(),L.clear(0,0,0,0),c.render(H.context,0,0),H.context.ctx.flush(),L.end();for(var u=L.getData(0,0,P,Y),d=[],a=0,b=Y-1;0<=b;b--)for(var z=0;z<P;z++)a=4*(b*P+z),d.push(u[a]),d.push(u[a+1]),d.push(u[a+2]),d.push(u[a+3]);return d},N.skinAniSprite=function(){return new UU},a.create=function(U,F){var O=new DU;return O._imgData=F,O.flipY=!1,O},I._filterStart=function(U,F,O,P,Y){var c=U.getValue("bounds"),L=VU.create(c.width,c.height);if(L.start(),L.clear(0,0,0,0),U.addValue("src",L),U.addValue("ScissorTest",hU.worldScissorTest),hU.worldScissorTest){var u=new l;u.copyFrom(O.ctx._clipRect),U.addValue("clipRect",u),hU.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},I._filterEnd=function(U,F,O,P,Y){var c=U.getValue("bounds");U.getValue("src").end();var L=VU.create(c.width,c.height);L.start(),L.clear(0,0,0,0),U.addValue("out",L),F._set$P("_filterCache",L),F._set$P("_isHaveGlowFilter",U.getValue("_isHaveGlowFilter"))},I._EndTarget=function(U,F){if(U.getValue("src").recycle(),U.getValue("out").end(),U.getValue("ScissorTest")){hU.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),F.ctx.save();var O=U.getValue("clipRect");F.ctx.clipRect(O.x,O.y,O.width,O.height)}},I._useSrc=function(U){var F=U.getValue("out");F.end(),(F=U.getValue("src")).start(),F.clear(0,0,0,0)},I._endSrc=function(U){U.getValue("src").end()},I._useOut=function(U){var F=U.getValue("src");F.end(),(F=U.getValue("out")).start(),F.clear(0,0,0,0)},I._endOut=function(U){U.getValue("out").end()},I._recycleScope=function(U){U.recycle()},I._filter=function(U,F,O,P){var Y=this._next;if(Y){var c,L,u=U.filters,d=u.length;if(1==d&&32==u[0].type)return F.ctx.save(),F.ctx.setFilters([u[0]]),Y._fun.call(Y,U,F,O,P),void F.ctx.restore();var a=uU.create(),b=g.TEMP,z=F.ctx._getTransformMatrix(),J=T.create();z.copyTo(J);var w=0,j=0,x=!1,r=U._$P._filterCache?U._$P._filterCache:null;if(!r||U._repaint){x=U._isHaveGlowFilter(),a.addValue("_isHaveGlowFilter",x),x&&(w=50,j=25),(L=new l).copyFrom(U.getSelfBounds()),L.x+=U.x,L.y+=U.y,L.x-=U.pivotX+4,L.y-=U.pivotY+4;var H=L.x,h=L.y;if(L.width+=w+8,L.height+=w+8,b.x=L.x*J.a+L.y*J.c,b.y=L.y*J.d+L.x*J.b,L.x=b.x,L.y=b.y,b.x=L.width*J.a+L.height*J.c,b.y=L.height*J.d+L.width*J.b,L.width=b.x,L.height=b.y,L.width<=0||L.height<=0)return;r&&r.recycle(),a.addValue("bounds",L);var Q=LU.create([a,U,F,0,0],I._filterStart);F.addRenderObject(Q),F.ctx._renderKey=0,F.ctx._shader2D.glTexture=null;var X=U.x-H+j,N=U.y-h+j;Y._fun.call(Y,U,F,X,N),Q=LU.create([a,U,F,0,0],I._filterEnd),F.addRenderObject(Q);for(var K=0;K<d;K++){0!=K&&(Q=LU.create([a],I._useSrc),F.addRenderObject(Q),c=IU.create(1,0),T.TEMP.identity(),F.ctx.drawTarget(a,0,0,L.width,L.height,T.TEMP,"out",c,null,_.TOINT.overlay),Q=LU.create([a],I._useOut),F.addRenderObject(Q)),u[K].action.apply3d(a,U,F,0,0)}Q=LU.create([a,F],I._EndTarget),F.addRenderObject(Q)}else{if((x=!!U._$P._isHaveGlowFilter&&U._$P._isHaveGlowFilter)&&(w=50,j=25),(L=U.getBounds()).width<=0||L.height<=0)return;L.width+=w,L.height+=w,b.x=L.x*J.a+L.y*J.c,b.y=L.y*J.d+L.x*J.b,L.x=b.x,L.y=b.y,b.x=L.width*J.a+L.height*J.c,b.y=L.height*J.d+L.width*J.b,L.width=b.x,L.height=b.y,a.addValue("out",r)}O=O-j-U.x,P=P-j-U.y,b.setTo(O,P),J.transformPoint(b),O=b.x+L.x,P=b.y+L.y,c=IU.create(1,0),T.TEMP.identity(),F.ctx.drawTarget(a,O,P,L.width,L.height,T.TEMP,"out",c,null,_.TOINT.overlay),Q=LU.create([a],I._recycleScope),F.addRenderObject(Q),J.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=L._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=L._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=L._uint8ArraySlice),!0},L.onStageResize=function(U,F){null!=L.mainContext&&(L.mainContext.viewport(0,0,U,F),hU.width=U,hU.height=F)},L.onInvalidGLRes=function(){o.instance.freeAll(),X.releaseContentManagers(!0),L.doNodeRepaint(K.stage),L.mainContext.viewport(0,0,hU.width,hU.height),K.stage.event("devicelost")},L.doNodeRepaint=function(U){0==U.numChildren&&U.repaint();for(var F=0;F<U.numChildren;F++)L.doNodeRepaint(U.getChildAt(F))},L.init=function(U,F,O){L.mainCanvas=U,a._createContext=function(U){return new fU(U)},DU._createContext=function(U){return new fU(U)};var P=laya.webgl.WebGL.mainContext;if(null!=P.getShaderPrecisionFormat){var Y=P.getShaderPrecisionFormat(35633,36338),c=P.getShaderPrecisionFormat(35632,36338);L.shaderHighPrecision=!(!Y.precision||!c.precision)}else L.shaderHighPrecision=!1;if(L.compressAstc=P.getExtension("WEBGL_compressed_texture_astc"),L.compressAtc=P.getExtension("WEBGL_compressed_texture_atc"),L.compressEtc=P.getExtension("WEBGL_compressed_texture_etc"),L.compressEtc1=P.getExtension("WEBGL_compressed_texture_etc1"),L.compressPvrtc=P.getExtension("WEBGL_compressed_texture_pvrtc"),L.compressS3tc=P.getExtension("WEBGL_compressed_texture_s3tc"),L.compressS3tc_srgb=P.getExtension("WEBGL_compressed_texture_s3tc_srgb"),L.compressAstc=L.compressAstc?L.compressAstc:{},L.compressAtc=L.compressAtc?L.compressAtc:{},L.compressEtc=L.compressEtc?L.compressEtc:{},L.compressEtc1=L.compressEtc1?L.compressEtc1:{},L.compressPvrtc=L.compressPvrtc?L.compressPvrtc:{},L.compressS3tc=L.compressS3tc?L.compressS3tc:{},L.compressS3tc_srgb=L.compressS3tc_srgb?L.compressS3tc_srgb:{},P.deleteTexture1=P.deleteTexture,P.deleteTexture=function(U){U==NU.curBindTexValue&&(NU.curBindTexValue=null),P.deleteTexture1(U)},L.onStageResize(F,O),null==L.mainContext)throw new Error("webGL getContext err!");y.__init__(),o.__init__(),$U.__init__(),cU.__init__(),fU.__init__(),IU.__init__(),B.__init__(),tU.__int__(P),_._init_(P),H.isConchApp&&conch.setOnInvalidGLRes(L.onInvalidGLRes)},L.mainCanvas=null,L.antialias=!0,L.shaderHighPrecision=!1,L._bg_null=[0,0,0,0],L}(),NU=function(){function P(){}return J(P,"laya.webgl.WebGLContext"),P.UseProgram=function(U){return P._useProgram!==U&&(XU.mainContext.useProgram(U),P._useProgram=U,!0)},P.setDepthTest=function(U,F){F!==P._depthTest&&((P._depthTest=F)?U.enable(2929):U.disable(2929))},P.setDepthMask=function(U,F){F!==P._depthMask&&(P._depthMask=F,U.depthMask(F))},P.setDepthFunc=function(U,F){F!==P._depthFunc&&(P._depthFunc=F,U.depthFunc(F))},P.setBlend=function(U,F){F!==P._blend&&((P._blend=F)?U.enable(3042):U.disable(3042))},P.setBlendFunc=function(U,F,O){(F!==P._sFactor||O!==P._dFactor)&&(P._sFactor=F,P._dFactor=O,U.blendFunc(F,O))},P.setCullFace=function(U,F){F!==P._cullFace&&((P._cullFace=F)?U.enable(2884):U.disable(2884))},P.setFrontFace=function(U,F){F!==P._frontFace&&(P._frontFace=F,U.frontFace(F))},P.bindTexture=function(U,F,O){U.bindTexture(F,O),P.curBindTexTarget=F,P.curBindTexValue=O},P.DEPTH_BUFFER_BIT=256,P.STENCIL_BUFFER_BIT=1024,P.COLOR_BUFFER_BIT=16384,P.POINTS=0,P.LINES=1,P.LINE_LOOP=2,P.LINE_STRIP=3,P.TRIANGLES=4,P.TRIANGLE_STRIP=5,P.TRIANGLE_FAN=6,P.ZERO=0,P.ONE=1,P.SRC_COLOR=768,P.ONE_MINUS_SRC_COLOR=769,P.SRC_ALPHA=770,P.ONE_MINUS_SRC_ALPHA=771,P.DST_ALPHA=772,P.ONE_MINUS_DST_ALPHA=773,P.DST_COLOR=774,P.ONE_MINUS_DST_COLOR=775,P.SRC_ALPHA_SATURATE=776,P.FUNC_ADD=32774,P.BLEND_EQUATION=32777,P.BLEND_EQUATION_RGB=32777,P.BLEND_EQUATION_ALPHA=34877,P.FUNC_SUBTRACT=32778,P.FUNC_REVERSE_SUBTRACT=32779,P.BLEND_DST_RGB=32968,P.BLEND_SRC_RGB=32969,P.BLEND_DST_ALPHA=32970,P.BLEND_SRC_ALPHA=32971,P.CONSTANT_COLOR=32769,P.ONE_MINUS_CONSTANT_COLOR=32770,P.CONSTANT_ALPHA=32771,P.ONE_MINUS_CONSTANT_ALPHA=32772,P.BLEND_COLOR=32773,P.ARRAY_BUFFER=34962,P.ELEMENT_ARRAY_BUFFER=34963,P.ARRAY_BUFFER_BINDING=34964,P.ELEMENT_ARRAY_BUFFER_BINDING=34965,P.STREAM_DRAW=35040,P.STATIC_DRAW=35044,P.DYNAMIC_DRAW=35048,P.BUFFER_SIZE=34660,P.BUFFER_USAGE=34661,P.CURRENT_VERTEX_ATTRIB=34342,P.FRONT=1028,P.BACK=1029,P.CULL_FACE=2884,P.FRONT_AND_BACK=1032,P.BLEND=3042,P.DITHER=3024,P.STENCIL_TEST=2960,P.DEPTH_TEST=2929,P.SCISSOR_TEST=3089,P.POLYGON_OFFSET_FILL=32823,P.SAMPLE_ALPHA_TO_COVERAGE=32926,P.SAMPLE_COVERAGE=32928,P.NO_ERROR=0,P.INVALID_ENUM=1280,P.INVALID_VALUE=1281,P.INVALID_OPERATION=1282,P.OUT_OF_MEMORY=1285,P.CW=2304,P.CCW=2305,P.LINE_WIDTH=2849,P.ALIASED_POINT_SIZE_RANGE=33901,P.ALIASED_LINE_WIDTH_RANGE=33902,P.CULL_FACE_MODE=2885,P.FRONT_FACE=2886,P.DEPTH_RANGE=2928,P.DEPTH_WRITEMASK=2930,P.DEPTH_CLEAR_VALUE=2931,P.DEPTH_FUNC=2932,P.STENCIL_CLEAR_VALUE=2961,P.STENCIL_FUNC=2962,P.STENCIL_FAIL=2964,P.STENCIL_PASS_DEPTH_FAIL=2965,P.STENCIL_PASS_DEPTH_PASS=2966,P.STENCIL_REF=2967,P.STENCIL_VALUE_MASK=2963,P.STENCIL_WRITEMASK=2968,P.STENCIL_BACK_FUNC=34816,P.STENCIL_BACK_FAIL=34817,P.STENCIL_BACK_PASS_DEPTH_FAIL=34818,P.STENCIL_BACK_PASS_DEPTH_PASS=34819,P.STENCIL_BACK_REF=36003,P.STENCIL_BACK_VALUE_MASK=36004,P.STENCIL_BACK_WRITEMASK=36005,P.VIEWPORT=2978,P.SCISSOR_BOX=3088,P.COLOR_CLEAR_VALUE=3106,P.COLOR_WRITEMASK=3107,P.UNPACK_ALIGNMENT=3317,P.PACK_ALIGNMENT=3333,P.MAX_TEXTURE_SIZE=3379,P.MAX_VIEWPORT_DIMS=3386,P.SUBPIXEL_BITS=3408,P.RED_BITS=3410,P.GREEN_BITS=3411,P.BLUE_BITS=3412,P.ALPHA_BITS=3413,P.DEPTH_BITS=3414,P.STENCIL_BITS=3415,P.POLYGON_OFFSET_UNITS=10752,P.POLYGON_OFFSET_FACTOR=32824,P.TEXTURE_BINDING_2D=32873,P.SAMPLE_BUFFERS=32936,P.SAMPLES=32937,P.SAMPLE_COVERAGE_VALUE=32938,P.SAMPLE_COVERAGE_INVERT=32939,P.NUM_COMPRESSED_TEXTURE_FORMATS=34466,P.COMPRESSED_TEXTURE_FORMATS=34467,P.DONT_CARE=4352,P.FASTEST=4353,P.NICEST=4354,P.GENERATE_MIPMAP_HINT=33170,P.BYTE=5120,P.UNSIGNED_BYTE=5121,P.SHORT=5122,P.UNSIGNED_SHORT=5123,P.INT=5124,P.UNSIGNED_INT=5125,P.FLOAT=5126,P.DEPTH_COMPONENT=6402,P.ALPHA=6406,P.RGB=6407,P.RGBA=6408,P.LUMINANCE=6409,P.LUMINANCE_ALPHA=6410,P.UNSIGNED_SHORT_4_4_4_4=32819,P.UNSIGNED_SHORT_5_5_5_1=32820,P.UNSIGNED_SHORT_5_6_5=33635,P.FRAGMENT_SHADER=35632,P.VERTEX_SHADER=35633,P.MAX_VERTEX_ATTRIBS=34921,P.MAX_VERTEX_UNIFORM_VECTORS=36347,P.MAX_VARYING_VECTORS=36348,P.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,P.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,P.MAX_TEXTURE_IMAGE_UNITS=34930,P.MAX_FRAGMENT_UNIFORM_VECTORS=36349,P.SHADER_TYPE=35663,P.DELETE_STATUS=35712,P.LINK_STATUS=35714,P.VALIDATE_STATUS=35715,P.ATTACHED_SHADERS=35717,P.ACTIVE_UNIFORMS=35718,P.ACTIVE_ATTRIBUTES=35721,P.SHADING_LANGUAGE_VERSION=35724,P.CURRENT_PROGRAM=35725,P.NEVER=512,P.LESS=513,P.EQUAL=514,P.LEQUAL=515,P.GREATER=516,P.NOTEQUAL=517,P.GEQUAL=518,P.ALWAYS=519,P.KEEP=7680,P.REPLACE=7681,P.INCR=7682,P.DECR=7683,P.INVERT=5386,P.INCR_WRAP=34055,P.DECR_WRAP=34056,P.VENDOR=7936,P.RENDERER=7937,P.VERSION=7938,P.NEAREST=9728,P.LINEAR=9729,P.NEAREST_MIPMAP_NEAREST=9984,P.LINEAR_MIPMAP_NEAREST=9985,P.NEAREST_MIPMAP_LINEAR=9986,P.LINEAR_MIPMAP_LINEAR=9987,P.TEXTURE_MAG_FILTER=10240,P.TEXTURE_MIN_FILTER=10241,P.TEXTURE_WRAP_S=10242,P.TEXTURE_WRAP_T=10243,P.TEXTURE_2D=3553,P.TEXTURE=5890,P.TEXTURE_CUBE_MAP=34067,P.TEXTURE_BINDING_CUBE_MAP=34068,P.TEXTURE_CUBE_MAP_POSITIVE_X=34069,P.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,P.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,P.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,P.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,P.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,P.MAX_CUBE_MAP_TEXTURE_SIZE=34076,P.TEXTURE0=33984,P.TEXTURE1=33985,P.TEXTURE2=33986,P.TEXTURE3=33987,P.TEXTURE4=33988,P.TEXTURE5=33989,P.TEXTURE6=33990,P.TEXTURE7=33991,P.TEXTURE8=33992,P.TEXTURE9=33993,P.TEXTURE10=33994,P.TEXTURE11=33995,P.TEXTURE12=33996,P.TEXTURE13=33997,P.TEXTURE14=33998,P.TEXTURE15=33999,P.TEXTURE16=34e3,P.TEXTURE17=34001,P.TEXTURE18=34002,P.TEXTURE19=34003,P.TEXTURE20=34004,P.TEXTURE21=34005,P.TEXTURE22=34006,P.TEXTURE23=34007,P.TEXTURE24=34008,P.TEXTURE25=34009,P.TEXTURE26=34010,P.TEXTURE27=34011,P.TEXTURE28=34012,P.TEXTURE29=34013,P.TEXTURE30=34014,P.TEXTURE31=34015,P.ACTIVE_TEXTURE=34016,P.REPEAT=10497,P.CLAMP_TO_EDGE=33071,P.MIRRORED_REPEAT=33648,P.FLOAT_VEC2=35664,P.FLOAT_VEC3=35665,P.FLOAT_VEC4=35666,P.INT_VEC2=35667,P.INT_VEC3=35668,P.INT_VEC4=35669,P.BOOL=35670,P.BOOL_VEC2=35671,P.BOOL_VEC3=35672,P.BOOL_VEC4=35673,P.FLOAT_MAT2=35674,P.FLOAT_MAT3=35675,P.FLOAT_MAT4=35676,P.SAMPLER_2D=35678,P.SAMPLER_CUBE=35680,P.VERTEX_ATTRIB_ARRAY_ENABLED=34338,P.VERTEX_ATTRIB_ARRAY_SIZE=34339,P.VERTEX_ATTRIB_ARRAY_STRIDE=34340,P.VERTEX_ATTRIB_ARRAY_TYPE=34341,P.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,P.VERTEX_ATTRIB_ARRAY_POINTER=34373,P.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,P.COMPILE_STATUS=35713,P.LOW_FLOAT=36336,P.MEDIUM_FLOAT=36337,P.HIGH_FLOAT=36338,P.LOW_INT=36339,P.MEDIUM_INT=36340,P.HIGH_INT=36341,P.FRAMEBUFFER=36160,P.RENDERBUFFER=36161,P.RGBA4=32854,P.RGB5_A1=32855,P.RGB565=36194,P.DEPTH_COMPONENT16=33189,P.STENCIL_INDEX=6401,P.STENCIL_INDEX8=36168,P.DEPTH_STENCIL=34041,P.RENDERBUFFER_WIDTH=36162,P.RENDERBUFFER_HEIGHT=36163,P.RENDERBUFFER_INTERNAL_FORMAT=36164,P.RENDERBUFFER_RED_SIZE=36176,P.RENDERBUFFER_GREEN_SIZE=36177,P.RENDERBUFFER_BLUE_SIZE=36178,P.RENDERBUFFER_ALPHA_SIZE=36179,P.RENDERBUFFER_DEPTH_SIZE=36180,P.RENDERBUFFER_STENCIL_SIZE=36181,P.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,P.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,P.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,P.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,P.COLOR_ATTACHMENT0=36064,P.DEPTH_ATTACHMENT=36096,P.STENCIL_ATTACHMENT=36128,P.DEPTH_STENCIL_ATTACHMENT=33306,P.NONE=0,P.FRAMEBUFFER_COMPLETE=36053,P.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,P.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,P.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,P.FRAMEBUFFER_UNSUPPORTED=36061,P.FRAMEBUFFER_BINDING=36006,P.RENDERBUFFER_BINDING=36007,P.MAX_RENDERBUFFER_SIZE=34024,P.INVALID_FRAMEBUFFER_OPERATION=1286,P.UNPACK_FLIP_Y_WEBGL=37440,P.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,P.CONTEXT_LOST_WEBGL=37442,P.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,P.BROWSER_DEFAULT_WEBGL=37444,P._useProgram=null,P._depthTest=!0,P._depthMask=!0,P._blend=!1,P._cullFace=!1,P.curBindTexTarget=null,P.curBindTexValue=null,L(P,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),P}(),KU=function(U){function F(){F.__super.call(this)}J(F,"laya.webgl.display.GraphicsGL",u);var O=F.prototype;return O.setShader=function(U){this._saveToCmd(H.context._setShader,[U])},O.setIBVB=function(U,F,O,P,Y,c){this._saveToCmd(H.context._setIBVB,[U,F,O,P,Y,c])},O.drawParticle=function(U,F,O){var P=N.createParticleTemplate2D(O);P.x=U,P.y=F,this._saveToCmd(H.context._drawParticle,[P])},F}(),fU=function(U){var O;function p(U){this._x=0,this._y=0,this._id=++p._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,p.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=p.MAXCLIPRECT,this.mOutPoint,this._canvas=U,this._canvas._addReference(),p._contextcount++,H.isFlash?(this._ib=BU.create(35044),rU.fillIBQuadrangle(this._ib,16)):this._ib=BU.QuadrangleIB,this.clear()}J(p,"laya.webgl.canvas.WebGLContext2D",Y);var F=p.prototype;return F.setIsMainContext=function(){this._isMain=!0},F.clearBG=function(U,F,O,P){var Y=XU.mainContext;Y.clearColor(U,F,O,P),Y.clear(16384)},F._getSubmits=function(){return this._submits},F._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var U=0,F=this._submits._length;U<F;U++)this._submits[U].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},F.destroy=function(){--p._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=BU.QuadrangleIB&&this._ib.releaseResource()},F.clear=function(){this._submits||(this._other=O.DEFAULT,this._curMat=T.create(),this._vb=EU.create(-1),this._submits=[],this._save=[n.Create(this)],this._save.length=10,this._shader2D=new B,this._triangleMesh=AU.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=O.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=p.MAXCLIPRECT,this._curSubmit=cU.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=q.DEFAULT;for(var U=0,F=this._submits._length;U<F;U++)this._submits[U].releaseRender(),this._submits[U]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},F.size=function(U,F){if(this._width!=U||this._height!=F)if(0==U||0==F){0!=this._vb._byteLength&&(this._width=U,this._height=F,this._vb.clear(),this._vb.upload());for(var O=0,P=this._submits._length;O<P;O++)this._submits[O].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=U,this._height=F,this._targets&&this._targets.size(U,F),this._canvas.memorySize-=this._canvas.memorySize;0===U&&0===F&&this._releaseMem()},F._getTransformMatrix=function(){return this._curMat},F.translate=function(U,F){0===U&&0===F||(S.save(this),this._curMat.bTransform&&(t.save(this),this._curMat.transformPointN(g.TEMP.setTo(U,F)),U=g.TEMP.x,F=g.TEMP.y),this._x+=U,this._y+=F)},F.save=function(){this._save[this._save._length++]=n.Create(this)},F.restore=function(){var U=this._save._length;if(!(U<1))for(var F=U-1;0<=F;F--){var O=this._save[F];if(O.restore(this),O.isSaveMark())return void(this._save._length=F)}},F._fillText=function(U,F,O,P,Y,c,L,u,d,a){void 0===a&&(a=0);var b=this._shader2D,z=this._curSubmit.shaderValue,J=Y?jU.create(Y):this._other.font;if(o.enabled)b.ALPHA!==z.ALPHA&&(b.glTexture=null),wU.drawText(this,U,F,this._curMat,J,d||this._other.textAlign,c,L,u,O,P,a);else{this._shader2D.defines.getValue();var w=c?j.create(c)._color:b.colorAdd;b.ALPHA===z.ALPHA&&w===b.colorAdd&&z.colorAdd===b.colorAdd||(b.glTexture=null,b.colorAdd=w),wU.drawText(this,U,F,this._curMat,J,d||this._other.textAlign,c,L,u,O,P,a)}},F.fillWords=function(U,F,O,P,Y,c){this._fillText(null,U,F,O,P,Y,null,-1,null,c)},F.fillBorderWords=function(U,F,O,P,Y,c,L){this._fillBorderText(null,U,F,O,P,Y,c,L,null)},F.fillText=function(U,F,O,P,Y,c){this._fillText(U,null,F,O,P,Y,null,-1,c)},F.strokeText=function(U,F,O,P,Y,c,L){this._fillText(U,null,F,O,P,null,Y,c||1,L)},F.fillBorderText=function(U,F,O,P,Y,c,L,u){this._fillBorderText(U,null,F,O,P,Y,c,L,u)},F._fillBorderText=function(U,F,O,P,Y,c,L,u,d){if(!o.enabled)return this._fillText(U,F,O,P,Y,null,L,u||1,d),void this._fillText(U,F,O,P,Y,c,null,-1,d);var a=this._shader2D,b=this._curSubmit.shaderValue;a.ALPHA!==b.ALPHA&&(a.glTexture=null);var z=Y?(p._fontTemp.setFont(Y),p._fontTemp):this._other.font;wU.drawText(this,U,F,this._curMat,z,d||this._other.textAlign,c,L,u||1,O,P,0)},F.fillRect=function(U,F,O,P,Y){var c=this._vb;if(rU.fillRectImgVb(c,this._clipRect,U,F,O,P,A.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var L=this._shader2D.fillStyle;Y&&(this._shader2D.fillStyle=q.create(Y));var u=this._shader2D,d=this._curSubmit.shaderValue;if(u.fillStyle!==d.fillStyle||u.ALPHA!==d.ALPHA){u.glTexture=null;var a=this._curSubmit=cU.createSubmit(this,this._ib,c,(c._byteLength-64)/32*3,IU.create(2,0));a.shaderValue.color=u.fillStyle._color._color,a.shaderValue.ALPHA=u.ALPHA,this._submits[this._submits._length++]=a}this._curSubmit._numEle+=6,this._shader2D.fillStyle=L}},F.fillTexture=function(U,F,O,P,Y,c,L,u){if(U.loaded&&U.bitmap&&U.source){var d=this._vb,a=U.bitmap.width,b=U.bitmap.height,z=U.uv,J=L.x%U.width,w=L.y%U.height;if(a!=u.w||b!=u.h){if(!u.w&&!u.h)switch(u.oy=u.ox=0,c){case"repeat":u.width=P,u.height=Y;break;case"repeat-x":u.width=P,w<0?U.height+w>Y?u.height=Y:u.height=U.height+w:(u.oy=w,U.height+w>Y?u.height=Y-w:u.height=U.height);break;case"repeat-y":J<0?U.width+J>P?u.width=P:u.width=U.width+J:(u.ox=J,U.width+J>P?u.width=P-J:u.width=U.width),u.height=Y;break;case"no-repeat":J<0?U.width+J>P?u.width=P:u.width=U.width+J:(u.ox=J,U.width+J>P?u.width=P-J:u.width=U.width),w<0?U.height+w>Y?u.height=Y:u.height=U.height+w:(u.oy=w,U.height+w>Y?u.height=Y-w:u.height=U.height);break;default:u.width=P,u.height=Y}u.w=a,u.h=b,u.uv=[0,0,u.width/a,0,u.width/a,u.height/b,0,u.height/b]}if(F+=u.ox,O+=u.oy,J-=u.ox,w-=u.oy,rU.fillRectImgVb(d,this._clipRect,F,O,u.width,u.height,u.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var j=kU.create(this,this._ib,d,(d._byteLength-64)/32*3,IU.create(256,0)),x=(this._submits[this._submits._length++]=j).shaderValue;x.textureHost=U;var r=z[0]*a,H=z[1]*b,h=(z[2]-z[0])*a,Q=(z[5]-z[3])*b,X=-J/a,N=-w/b;x.u_TexRange[0]=r/a,x.u_TexRange[1]=h/a,x.u_TexRange[2]=H/b,x.u_TexRange[3]=Q/b,x.u_offset[0]=X,x.u_offset[1]=N,o.enabled&&!this._isMain&&j.addTexture(U,(d._byteLength>>2)-16),(this._curSubmit=j)._renderType=10017,j._numEle+=6}}else this.sprite&&K.timer.callLater(this,this._repaintSprite)},F.setShader=function(U){Z.save(this,1048576,this._shader2D,!0),this._shader2D.shader=U},F.setFilters=function(U){Z.save(this,2097152,this._shader2D,!0),this._shader2D.filters=U,this._curSubmit=cU.RENDERBASE,this._renderKey=0,this._drawCount++},F.drawTexture=function(U,F,O,P,Y,c,L){this._drawTextureM(U,F,O,P,Y,c,L,null,1)},F.addTextureVb=function(U,F,O){var P=this._curSubmit._vb||this._vb,Y=P._byteLength>>2;P.byteLength=Y+16<<2;for(var c=P.getFloat32Array(),L=0;L<16;L+=4)c[Y++]=U[L]+F,c[Y++]=U[L+1]+O,c[Y++]=U[L+2],c[Y++]=U[L+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),P._upload=!0},F.willDrawTexture=function(U,F){if(!(U.loaded&&U.bitmap&&U.source))return this.sprite&&K.timer.callLater(this,this._repaintSprite),0;var O=U.bitmap,P=O.id+this._shader2D.ALPHA*F+10016;if(P==this._renderKey)return P;var Y=this._shader2D,c=Y.ALPHA,L=this._curSubmit.shaderValue;Y.ALPHA*=F,this._renderKey=P,this._drawCount++,Y.glTexture=O;var u=this._vb,d=null,a=u._byteLength/32*3,b=L.textureHost&&L.textureHost==U&&L.textureHost.alphaTexture==U.alphaTexture;return d=kU.create(this,this._ib,u,a,IU.create(1,0)),(this._submits[this._submits._length++]=d).shaderValue.textureHost=U,d._renderType=10016,d._preIsSameTextureShader=10016===this._curSubmit._renderType&&Y.ALPHA===L.ALPHA&&b,this._curSubmit=d,Y.ALPHA=c,P},F.drawTextures=function(U,F,O,P){if(U.loaded&&U.bitmap&&U.source){var Y=this._clipRect;if(this._clipRect=p.MAXCLIPRECT,this._drawTextureM(U,F[0],F[1],U.width,U.height,O,P,null,1)){if(this._clipRect=Y,s.drawCall++,!(F.length<4)){for(var c=this._curSubmit._vb||this._vb,L=this._curMat.a,u=this._curMat.d,d=2,a=F.length;d<a;d+=2)rU.copyPreImgVb(c,(F[d]-F[d-2])*L,(F[d+1]-F[d-1])*u),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&K.timer.callLater(this,this._repaintSprite)},F._drawTextureM=function(U,F,O,P,Y,c,L,u,d){if(!U.loaded||!U.source)return this.sprite&&K.timer.callLater(this,this._repaintSprite),!1;var a=this._curSubmit._vb||this._vb,b=U.bitmap;F+=c,O+=L,this._drawCount++;var z=b.id+this._shader2D.ALPHA*d+10016;if(z!=this._renderKey){this._renderKey=z;var J=this._curSubmit.shaderValue,w=this._shader2D,j=w.ALPHA;w.ALPHA*=d,w.glTexture=b;var x=this._vb,r=null,H=x._byteLength/32*3,h=J.textureHost&&J.textureHost==U&&J.textureHost.alphaTexture==U.alphaTexture;r=kU.create(this,this._ib,x,H,IU.create(1,0)),(this._submits[this._submits._length++]=r).shaderValue.textureHost=U,r._renderType=10016,r._preIsSameTextureShader=10016===this._curSubmit._renderType&&w.ALPHA===J.ALPHA&&h,this._curSubmit=r,a=this._curSubmit._vb||this._vb,w.ALPHA=j}return!!rU.fillRectImgVb(a,this._clipRect,F,O,P||U.width,Y||U.height,U.uv,u||this._curMat,this._x,this._y,0,0)&&(o.enabled&&!this._isMain&&this._curSubmit.addTexture(U,(a._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},F._repaintSprite=function(){this.sprite&&this.sprite.repaint()},F._drawText=function(U,F,O,P,Y,c,L,u,d,a){var b=U.bitmap;this._drawCount++;var z=b.id+this._shader2D.ALPHA+10016;if(z!=this._renderKey){this._renderKey=z;var J=this._curSubmit.shaderValue,w=this._shader2D;w.glTexture=b;var j=this._vb,x=null,r=j._byteLength/32*3,H=J.textureHost&&J.textureHost==U&&J.textureHost.alphaTexture==U.alphaTexture;(x=o.enabled?kU.create(this,this._ib,j,r,IU.create(1,0)):kU.create(this,this._ib,j,r,SU.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&w.ALPHA===J.ALPHA&&H,(this._submits[this._submits._length++]=x).shaderValue.textureHost=U,x._renderType=10016,this._curSubmit=x}U.active();var h=this._curSubmit._vb||this._vb;rU.fillRectImgVb(h,this._clipRect,F+L,O+u,P||U.width,Y||U.height,U.uv,c||this._curMat,this._x,this._y,d,a,!0)&&(o.enabled&&!this._isMain&&this._curSubmit.addTexture(U,(h._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},F.drawTextureWithTransform=function(U,F,O,P,Y,c,L,u,d){if(c){var a=this._curMat,b=this._x,z=this._y;(0!==L||0!==u)&&(this._x=L*a.a+u*a.c,this._y=u*a.d+L*a.b),c&&a.bTransform?(T.mul(c,a,p._tmpMatrix),(c=p._tmpMatrix)._checkTransform()):(this._x+=a.tx,this._y+=a.ty),this._drawTextureM(U,F,O,P,Y,0,0,c,d),this._x=b,this._y=z}else this._drawTextureM(U,F,O,P,Y,L,u,null,d)},F.fillQuadrangle=function(U,F,O,P,Y){var c=this._curSubmit,L=this._vb,u=this._shader2D,d=c.shaderValue;if(this._renderKey=0,U.bitmap){var a=U.bitmap;u.glTexture==a&&u.ALPHA===d.ALPHA||(u.glTexture=a,(c=this._curSubmit=cU.createSubmit(this,this._ib,L,L._byteLength/32*3,IU.create(1,0))).shaderValue.glTexture=a,this._submits[this._submits._length++]=c),rU.fillQuadrangleImgVb(L,F,O,P,U.uv,Y||this._curMat,this._x,this._y)}else c.shaderValue.fillStyle&&c.shaderValue.fillStyle.equal(U)&&u.ALPHA===d.ALPHA||(u.glTexture=null,(c=this._curSubmit=cU.createSubmit(this,this._ib,L,L._byteLength/32*3,IU.create(2,0))).shaderValue.defines.add(2),c.shaderValue.fillStyle=q.create(U),this._submits[this._submits._length++]=c),rU.fillQuadrangleImgVb(L,F,O,P,A.DEF_UV,Y||this._curMat,this._x,this._y);c._numEle+=6},F.drawTexture2=function(U,F,O,P,Y,c,L,u){if(0!=c){var d=this._curMat;if(this._x=U*d.a+F*d.c,this._y=F*d.d+U*d.b,Y&&(Y=d.bTransform||Y.bTransform?(T.mul(Y,d,p._tmpMatrix),p._tmpMatrix):(this._x+=Y.tx+d.tx,this._y+=Y.ty+d.ty,T.EMPTY)),1!==c||L){var a=this._shader2D.ALPHA,b=this._nBlendType;this._shader2D.ALPHA=c,L&&(this._nBlendType=_.TOINT(L)),this._drawTextureM(u[0],u[1]-O,u[2]-P,u[3],u[4],0,0,Y,1),this._shader2D.ALPHA=a,this._nBlendType=b}else this._drawTextureM(u[0],u[1]-O,u[2]-P,u[3],u[4],0,0,Y,1);this._x=this._y=0}},F.drawCanvas=function(U,F,O,P,Y){var c=U.context;if(this._renderKey=0,c._targets)this._submits[this._submits._length++]=yU.create(c,0,null),this._curSubmit=cU.RENDERBASE,c._targets.drawTo(this,F,O,P,Y);else{var L=this._submits[this._submits._length++]=yU.create(c,this._shader2D.ALPHA,this._shader2D.filters),u=P/U.width,d=Y/U.height,a=L._matrix;this._curMat.copyTo(a),1!=u&&1!=d&&a.scale(u,d);var b=a.tx,z=a.ty;a.tx=a.ty=0,a.transformPoint(g.TEMP.setTo(F,O)),a.translate(g.TEMP.x+b,g.TEMP.y+z),this._curSubmit=cU.RENDERBASE}f.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=c._targets?"yellow":"green",this.strokeRect(F-1,O-1,P+2,Y+2,1),this.strokeRect(F,O,P,Y,1),this.restore())},F.drawTarget=function(U,F,O,P,Y,c,L,u,d,a){void 0===a&&(a=-1);var b=this._vb;if(rU.fillRectImgVb(b,this._clipRect,F,O,P,Y,d||A.DEF_UV,c||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var z=this._curSubmit=zU.create(this,this._ib,b,(b._byteLength-64)/32*3,u,L);z.blendType=-1==a?this._nBlendType:a,z.scope=U,this._submits[this._submits._length++]=z,this._curSubmit._numEle+=6}},F.mixRGBandAlpha=function(U){return this._mixRGBandAlpha(U,this._shader2D.ALPHA)},F._mixRGBandAlpha=function(U,F){var O=(4278190080&U)>>>24;return 0!=O?O*=F:O=255*F,16777215&U|O<<24},F.drawTriangles=function(U,F,O,P,Y,c,L,u,d,a){if(!U.loaded||!U.source)return this.sprite&&K.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;U.bitmap;var b=this._mixRGBandAlpha(4294967295,u),z=(P.length,c.length);this._renderKey=-1;var J=this._curSubmit=kU.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,IU.create(1,0));return J.shaderValue.textureHost=U,J._renderType=10016,this._submits[this._submits._length++]=J,L?(p._tmpMatrix.a=L.a,p._tmpMatrix.b=L.b,p._tmpMatrix.c=L.c,p._tmpMatrix.d=L.d,p._tmpMatrix.tx=L.tx+F,p._tmpMatrix.ty=L.ty+O,T.mul(p._tmpMatrix,this._curMat,p._tmpMatrix)):(p._tmpMatrix.a=this._curMat.a,p._tmpMatrix.b=this._curMat.b,p._tmpMatrix.c=this._curMat.c,p._tmpMatrix.d=this._curMat.d,p._tmpMatrix.tx=this._curMat.tx+F,p._tmpMatrix.ty=this._curMat.ty+O),this._triangleMesh.addData(P,Y,c,p._tmpMatrix,b,this),this._curSubmit._numEle+=z,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},F.transform=function(U,F,O,P,Y,c){t.save(this),T.mul(T.TEMP.setTo(U,F,O,P,Y,c),this._curMat,this._curMat),this._curMat._checkTransform()},F.setTransformByMatrix=function(U){U.copyTo(this._curMat)},F.transformByMatrix=function(U){t.save(this),T.mul(U,this._curMat,this._curMat),this._curMat._checkTransform()},F.rotate=function(U){t.save(this),this._curMat.rotateEx(U)},F.scale=function(U,F){t.save(this),this._curMat.scaleEx(U,F)},F.clipRect=function(U,F,O,P){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var Y=bU.create(4);this.addRenderObject(Y);var c=this._vb,L=c._byteLength>>2;if(rU.fillRectImgVb(c,null,U,F,O,P,A.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var u=this._curSubmit=cU.createSubmit(this,this._ib,c,(c._byteLength-64)/32*3,IU.create(2,0));u.shaderValue.ALPHA=1,this._submits[this._submits._length++]=u,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var d=bU.create(5);this.addRenderObject(d);var a=c.getFloat32Array(),b=Math.min(Math.min(Math.min(a[0+L],a[4+L]),a[8+L]),a[12+L]),z=Math.max(Math.max(Math.max(a[0+L],a[4+L]),a[8+L]),a[12+L]),J=Math.min(Math.min(Math.min(a[1+L],a[5+L]),a[9+L]),a[13+L]),w=Math.max(Math.max(Math.max(a[1+L],a[5+L]),a[9+L]),a[13+L]);v.save(this,d,U,F,O,P,b,J,z-b,w-J),this._curSubmit=cU.RENDERBASE}else{O*=this._curMat.a,P*=this._curMat.d;var j=g.TEMP;this._curMat.transformPoint(j.setTo(U,F)),O<0&&(j.x=j.x+O,O=-O),P<0&&(j.y=j.y+P,P=-P),this._renderKey=0;var x=this._curSubmit=aU.create(this);(this._submits[this._submits._length++]=x).submitIndex=this._submits._length,x.submitLength=9999999,e.save(this,x);var r=this._clipRect,H=r.x,h=r.y,Q=j.x+O,X=j.y+P;H<j.x&&(r.x=j.x),h<j.y&&(r.y=j.y),r.width=Math.min(Q,H+r.width)-r.x,r.height=Math.min(X,h+r.height)-r.y,this._shader2D.glTexture=null,x.clipRect.copyFrom(r),this._curSubmit=cU.RENDERBASE}},F.setIBVB=function(U,F,O,P,Y,c,L,u,d,a,b){if(void 0===d&&(d=0),void 0===a&&(a=0),void 0===b&&(b=0),null===O){if(H.isFlash){var z=P;z._selfIB||(z._selfIB=BU.create(35044)),z._selfIB.clear(),O=z._selfIB}else O=this._ib;rU.expandIBQuadrangle(O,P._byteLength/(4*P.vertexStride*4))}if(!u||!L)throw Error("setIBVB must input:shader shaderValues");var J=dU.create(this,P,O,Y,L,u,d,a,b);c||(c=T.EMPTY),c.translate(U,F),T.mul(c,this._curMat,J._mat),c.translate(-U,-F),this._submits[this._submits._length++]=J,this._curSubmit=cU.RENDERBASE,this._renderKey=0},F.addRenderObject=function(U){this._submits[this._submits._length++]=U},F.fillTrangles=function(U,F,O,P,Y){var c=this._curSubmit,L=this._vb,u=this._shader2D,d=c.shaderValue,a=P.length>>4,b=U.bitmap;this._renderKey=0,u.glTexture==b&&u.ALPHA===d.ALPHA||((c=this._curSubmit=cU.createSubmit(this,this._ib,L,L._byteLength/32*3,IU.create(1,0))).shaderValue.textureHost=U,this._submits[this._submits._length++]=c),rU.fillTranglesVB(L,F,O,P,Y||this._curMat,this._x,this._y),c._numEle+=6*a},F.submitElement=function(U,F){var O=this._submits;for(F<0&&(F=O._length);U<F;)U+=O[U].renderSubmit()},F.finish=function(){XU.mainContext.finish()},F.flush=function(){var U=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(U>this._ib.bufferLength/12&&rU.expandIBQuadrangle(this._ib,U),!this._isMain&&o.enabled&&o._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=o._atlasRestore;for(var F=this._submits,O=0,P=F._length;O<P;O++){var Y=F[O];10016===Y.getRenderType()&&Y.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),FU.instance&&FU.getInstance().reset();var c;for(O=0,c=this.meshlist.length;O<c;O++){var L=this.meshlist[O];L.canReuse?L.releaseMesh():L.destroy()}return this.meshlist.length=0,this._curSubmit=cU.RENDERBASE,this._renderKey=0,this._triangleMesh=AU.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},F.setPathId=function(U){if(this.mId=U,-1!=this.mId){this.mHaveKey=!1;var F=V.getInstance();F.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,F.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},F.movePath=function(U,F){var O=U,P=F;U=this._curMat.a*O+this._curMat.c*P+this._curMat.tx,F=this._curMat.b*O+this._curMat.d*P+this._curMat.ty,this.mX+=U,this.mY+=F},F.beginPath=function(){var U=this._getPath();U.tempArray.length=0,U.closePath=!1,this.mX=0,this.mY=0},F.closePath=function(){this._path.closePath=!0},F.fill=function(U){void 0===U&&(U=!1);var F=this._getPath();this.drawPoly(0,0,F.tempArray,this.fillStyle._color.numColor,0,0,U)},F.stroke=function(){var U=this._getPath();if(0<this.lineWidth){if(-1==this.mId)U.drawLine(0,0,U.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var F=V.getInstance().shapeLineDic[this.mId];F.rebuild(U.tempArray),U.setGeomtry(F)}else V.getInstance().addLine(this.mId,U.drawLine(0,0,U.tempArray,this.lineWidth,this.strokeStyle._color.numColor));U.update();var O=[this.mX,this.mY],P=cU.createShape(this,U.ib,U.vb,U.count,U.offset,IU.create(4,0));P.shaderValue.ALPHA=this._shader2D.ALPHA,P.shaderValue.u_pos=O,P.shaderValue.u_mmat2=hU.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=P,this._renderKey=-1}},F.line=function(U,F,O,P,Y,c){var L=this._curSubmit,u=this._vb;if(rU.fillLineVb(u,this._clipRect,U,F,O,P,Y,c)){this._renderKey=0;var d=this._shader2D,a=L.shaderValue;d.strokeStyle===a.strokeStyle&&d.ALPHA===a.ALPHA||(d.glTexture=null,(L=this._curSubmit=cU.createSubmit(this,this._ib,u,(u._byteLength-64)/32*3,IU.create(2,0))).shaderValue.strokeStyle=d.strokeStyle,L.shaderValue.mainID=2,L.shaderValue.ALPHA=d.ALPHA,this._submits[this._submits._length++]=L),L._numEle+=6}},F.moveTo=function(U,F,O){void 0===O&&(O=!0);var P=this._getPath();if(O){var Y=U,c=F;U=this._curMat.a*Y+this._curMat.c*c,F=this._curMat.b*Y+this._curMat.d*c}P.addPoint(U,F)},F.lineTo=function(U,F,O){void 0===O&&(O=!0);var P=this._getPath();if(O){var Y=U,c=F;U=this._curMat.a*Y+this._curMat.c*c,F=this._curMat.b*Y+this._curMat.d*c}P.addPoint(U,F)},F.drawCurves=function(U,F,O){this.setPathId(-1),this.beginPath(),this.strokeStyle=O[3],this.lineWidth=O[4];var P=O[2];U+=O[0],F+=O[1],this.movePath(U,F),this.moveTo(P[0],P[1]);for(var Y=2,c=P.length;Y<c;)this.quadraticCurveTo(P[Y++],P[Y++],P[Y++],P[Y++]);this.stroke()},F.arcTo=function(U,F,O,P,Y){if(-1==this.mId||!this.mHaveKey){var c=0,L=0,u=0,d=this._getPath();this._curMat.copyTo(p._tmpMatrix),p._tmpMatrix.tx=p._tmpMatrix.ty=0,p._tempPoint.setTo(d.getEndPointX(),d.getEndPointY()),p._tmpMatrix.invertTransformPoint(p._tempPoint);var a=p._tempPoint.x-U,b=p._tempPoint.y-F,z=Math.sqrt(a*a+b*b);if(!(z<=1e-6)){var J=a/z,w=b/z,j=O-U,x=P-F,r=j*j+x*x,H=Math.sqrt(r);if(!(H<=1e-6)){var h=j/H,Q=x/H,X=J+h,N=w+Q,K=Math.sqrt(X*X+N*N);if(!(K<=1e-6)){var f=X/K,I=N/K,T=Math.acos(f*J+I*w),g=Math.PI/2-T,l=(z=Y/Math.tan(g))*J+U,$=z*w+F,C=Math.sqrt(z*z+Y*Y),s=U+f*C,i=F+I*C,y=0,k=0;if(0<=J*Q-w*h){var A=2*g/p.SEGNUM;y=Math.sin(A),k=Math.cos(A)}else A=2*-g/p.SEGNUM,y=Math.sin(A),k=Math.cos(A);L=this._curMat.a*l+this._curMat.c*$,u=this._curMat.b*l+this._curMat.d*$,L==this._path.getEndPointX()&&u==this._path.getEndPointY()||d.addPoint(L,u);var G=l-s,V=$-i;for(c=0;c<p.SEGNUM;c++){var M=G*k+V*y,m=-G*y+V*k;L=M+s,u=m+i,U=this._curMat.a*L+this._curMat.c*u,u=F=this._curMat.b*L+this._curMat.d*u,(L=U)==this._path.getEndPointX()&&u==this._path.getEndPointY()||d.addPoint(L,u),G=M,V=m}}}}}},F.arc=function(U,F,O,P,Y,c,L){if(void 0===c&&(c=!1),void 0===L&&(L=!0),-1!=this.mId){var u=V.getInstance().shapeDic[this.mId];if(u&&this.mHaveKey&&!u.needUpdate(this._curMat))return;F=U=0}var d,a=0,b=0,z=0,J=0,w=0,j=0,x=0;if(b=Y-P,c)if(Math.abs(b)>=2*Math.PI)b=2*-Math.PI;else for(;0<b;)b-=2*Math.PI;else if(Math.abs(b)>=2*Math.PI)b=2*Math.PI;else for(;b<0;)b+=2*Math.PI;d=b/(x=O<101?Math.max(10,b*O/5):O<201?Math.max(10,b*O/20):Math.max(10,b*O/40))/2,z=Math.abs(4/3*(1-Math.cos(d))/Math.sin(d)),c&&(z=-z);var r=this._getPath(),H=NaN,h=NaN;for(j=0;j<=x;j++)a=P+b*(j/x),J=U+Math.cos(a)*O,w=F+Math.sin(a)*O,L&&(H=J,h=w,J=this._curMat.a*H+this._curMat.c*h,w=this._curMat.b*H+this._curMat.d*h),J==this._path.getEndPointX()&&w==this._path.getEndPointY()||r.addPoint(J,w);J=U+Math.cos(Y)*O,w=F+Math.sin(Y)*O,L&&(H=J,h=w,J=this._curMat.a*H+this._curMat.c*h,w=this._curMat.b*H+this._curMat.d*h),J==this._path.getEndPointX()&&w==this._path.getEndPointY()||r.addPoint(J,w)},F.quadraticCurveTo=function(U,F,O,P){var Y=z.I,c=O,L=P;O=this._curMat.a*c+this._curMat.c*L,P=this._curMat.b*c+this._curMat.d*L,c=U,L=F,U=this._curMat.a*c+this._curMat.c*L,F=this._curMat.b*c+this._curMat.d*L;for(var u=Y.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),U,F,O,P],30,2),d=0,a=u.length/2;d<a;d++)this.lineTo(u[2*d],u[2*d+1],!1);this.lineTo(O,P,!1)},F.rect=function(U,F,O,P){this._other=this._other.make(),this._other.path||(this._other.path=new D),this._other.path.rect(U,F,O,P)},F.strokeRect=function(U,F,O,P,Y){var c=.5*Y;this.line(U-c,F,U+O+c,F,Y,this._curMat),this.line(U+O,F,U+O,F+P,Y,this._curMat),this.line(U,F,U,F+P,Y,this._curMat),this.line(U-c,F+P,U+O+c,F+P,Y,this._curMat)},F.clip=function(){},F.drawPoly=function(U,F,O,P,Y,c,L){void 0===L&&(L=!1),this._renderKey=0,this._shader2D.glTexture=null;var u=this._getPath();if(-1==this.mId)u.polygon(U,F,O,P,Y||1,c);else if(this.mHaveKey){var d=V.getInstance().shapeDic[this.mId];d.setMatrix(this._curMat),d.rebuild(u.tempArray),u.setGeomtry(d)}else{var a=u.polygon(U,F,O,P,Y||1,c);V.getInstance().addShape(this.mId,a),a.setMatrix(this._curMat)}u.update();var b,z=[this.mX,this.mY];if((b=cU.createShape(this,u.ib,u.vb,u.count,u.offset,IU.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,b.shaderValue.u_pos=z,b.shaderValue.u_mmat2=hU.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=b,0<Y){if(this.mHaveLineKey){var J=V.getInstance().shapeLineDic[this.mId];J.rebuild(u.tempArray),u.setGeomtry(J)}else V.getInstance().addShape(this.mId,u.drawLine(U,F,O,Y,c));u.update(),(b=cU.createShape(this,u.ib,u.vb,u.count,u.offset,IU.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,b.shaderValue.u_mmat2=hU.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=b}},F.drawParticle=function(U,F,O){O.x=U,O.y=F,this._submits[this._submits._length++]=O},F._getPath=function(){return this._path||(this._path=new D)},P(0,F,"globalCompositeOperation",function(){return _.NAMES[this._nBlendType]},function(U){var F=_.TOINT[U];null==F||this._nBlendType===F||(Z.save(this,65536,this,!0),this._curSubmit=cU.RENDERBASE,this._renderKey=0,this._nBlendType=F)}),P(0,F,"strokeStyle",function(){return this._shader2D.strokeStyle},function(U){this._shader2D.strokeStyle.equal(U)||(Z.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=q.create(U))}),P(0,F,"globalAlpha",function(){return this._shader2D.ALPHA},function(U){(U=Math.floor(1e3*U)/1e3)!=this._shader2D.ALPHA&&(Z.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=U)}),P(0,F,"asBitmap",null,function(U){if(U){if(this._targets||(this._targets=new W),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),P(0,F,"fillStyle",function(){return this._shader2D.fillStyle},function(U){this._shader2D.fillStyle.equal(U)||(Z.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=q.create(U))}),P(0,F,"textAlign",function(){return this._other.textAlign},function(U){this._other.textAlign===U||(this._other=this._other.make(),Z.save(this,32768,this._other,!1),this._other.textAlign=U)}),P(0,F,"lineWidth",function(){return this._other.lineWidth},function(U){this._other.lineWidth===U||(this._other=this._other.make(),Z.save(this,256,this._other,!1),this._other.lineWidth=U)}),P(0,F,"textBaseline",function(){return this._other.textBaseline},function(U){this._other.textBaseline===U||(this._other=this._other.make(),Z.save(this,16384,this._other,!1),this._other.textBaseline=U)}),P(0,F,"font",null,function(U){U!=this._other.font.toString()&&(this._other=this._other.make(),Z.save(this,8,this._other,!1),this._other.font===jU.EMPTY?this._other.font=new jU(U):this._other.font.setFont(U))}),p.__init__=function(){O.DEFAULT=new O},p._tempPoint=new g,p._SUBMITVBSIZE=32e3,p._MAXSIZE=99999999,p._RECTVBSIZE=16,p.MAXCLIPRECT=new l(0,0,99999999,99999999),p._COUNT=0,p._tmpMatrix=new T,p.SEGNUM=32,p._contextcount=0,L(p,["_fontTemp",function(){return this._fontTemp=new jU},"_drawStyleTemp",function(){return this._drawStyleTemp=new q(null)}]),p.__init$=function(){O=function(){function U(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=jU.EMPTY}J(U,"");var F=U.prototype;return F.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=jU.EMPTY},F.make=function(){return this===U.DEFAULT?new U:this},U.DEFAULT=null,U}()},p}(),IU=function(U){function P(U,F){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,P.__super.call(this),this.defines=new $U,this.position=P._POSITION,this.mainID=U,this.subID=F,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=U|F,this._inClassCache=P._cache[this._cacheID],0<U&&!this._inClassCache&&(this._inClassCache=P._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}J(P,"laya.webgl.shader.d2.value.Value2D",m);var F=P.prototype;return F.setValue=function(U){},F.refresh=function(){var U=this.size;return U[0]=hU.width,U[1]=hU.height,this.alpha=this.ALPHA*hU.worldAlpha,this.mmat=hU.worldMatrix4,this},F._ShaderWithCompile=function(){return nU.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,WU.create)},F._withWorldShaderDefines=function(){var U=hU.worldShaderDefines,F=nU.sharders[this.mainID|this.defines._value|U.getValue()];if(!F){var O,P={};for(O in this.defines.toNameDic())P[O]="";for(O in U.toNameDic())P[O]="";F=nU.withCompile2D(0,this.mainID,P,this.mainID|this.defines._value|U.getValue(),WU.create)}var Y=hU.worldFilters;if(!Y)return F;for(var c,L=Y.length,u=0;u<L;u++)(c=Y[u])&&c.action.setValue(this);return F},F.upload=function(){var U=hU;this.alpha=this.ALPHA*U.worldAlpha,hU.worldMatrix4!==hU.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),XU.shaderHighPrecision&&this.defines.add(1024);var F,O=U.worldShaderDefines?this._withWorldShaderDefines():nU.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=U.width,this.size[1]=U.height,this.mmat=U.worldMatrix4,GU.activeShader!==O?O._shaderValueWidth!==U.width||O._shaderValueHeight!==U.height?(O._shaderValueWidth=U.width,O._shaderValueHeight=U.height):F=O._params2dQuick2||O._make2dQuick2():O._shaderValueWidth!==U.width||O._shaderValueHeight!==U.height?(O._shaderValueWidth=U.width,O._shaderValueHeight=U.height):F=O._params2dQuick1||O._make2dQuick1(),O.upload(this,F)},F.setFilters=function(U){if(this.filters=U)for(var F,O=U.length,P=0;P<O;P++)(F=U[P])&&(this.defines.add(F.type),F.action.setValue(this))},F.clear=function(){this.defines.setValue(this.subID)},F.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},P._initone=function(U,F){P._typeClass[U]=F,P._cache[U]=[],P._cache[U]._length=0},P.__init__=function(){P._POSITION=[2,5126,!1,4*xU.BYTES_PE,0],P._TEXCOORD=[2,5126,!1,4*xU.BYTES_PE,2*xU.BYTES_PE],P._initone(2,pU),P._initone(4,_U),P._initone(256,oU),P._initone(512,mU),P._initone(1,RU),P._initone(65,SU),P._initone(9,RU)},P.create=function(U,F){var O=P._cache[U|F];return O._length?O[--O._length]:new P._typeClass[U|F](F)},P._POSITION=null,P._TEXCOORD=null,P._cache=[],P._typeClass=[],P.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],P}(),TU=function(U){function r(U,F){r.__super.call(this,U,F)}J(r,"laya.webgl.utils.RenderSprite3D",h);var F=r.prototype;return F.onCreate=function(U){switch(U){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},F._mask=function(U,F,O,P){var Y,c,L=this._next,u=U.mask;if(u){F.ctx.save();var d=F.ctx.globalCompositeOperation,a=new l;if(a.copyFrom(u.getBounds()),a.width=Math.round(a.width),a.height=Math.round(a.height),a.x=Math.round(a.x),a.y=Math.round(a.y),0<a.width&&0<a.height){var b=U._style._tf,z=uU.create();z.addValue("bounds",a),Y=LU.create([z,F],laya.webgl.utils.RenderSprite3D.tmpTarget),F.addRenderObject(Y),u.render(F,-a.x,-a.y),Y=LU.create([z],laya.webgl.utils.RenderSprite3D.endTmpTarget),F.addRenderObject(Y),F.ctx.save(),F.clipRect(O-b.translateX+a.x,P-b.translateY+a.y,a.width,a.height),L._fun.call(L,U,F,O,P),F.ctx.restore(),c=bU.create(6),d=F.ctx.globalCompositeOperation,c.blendMode="mask",F.addRenderObject(c),T.TEMP.identity();var J=IU.create(1,0),w=A.INV_UV,j=a.width,x=a.height;(a.width<32||a.height<32)&&((w=r.tempUV)[0]=0,w[1]=0,w[2]=32<=a.width?1:a.width/32,w[3]=0,w[4]=32<=a.width?1:a.width/32,w[5]=32<=a.height?1:a.height/32,w[6]=0,w[7]=32<=a.height?1:a.height/32,a.width=32<=a.width?a.width:32,a.height=32<=a.height?a.height:32,w[1]*=-1,w[3]*=-1,w[5]*=-1,w[7]*=-1,w[1]+=1,w[3]+=1,w[5]+=1,w[7]+=1),F.ctx.drawTarget(z,O+a.x-b.translateX,P+a.y-b.translateY,j,x,T.TEMP,"tmpTarget",J,w,6),Y=LU.create([z],laya.webgl.utils.RenderSprite3D.recycleTarget),F.addRenderObject(Y),(c=bU.create(6)).blendMode=d,F.addRenderObject(c)}F.ctx.restore()}else L._fun.call(L,U,F,O,P)},F._blend=function(U,F,O,P){var Y=U._style,c=this._next;Y.blendMode?(F.ctx.save(),F.ctx.globalCompositeOperation=Y.blendMode,c._fun.call(c,U,F,O,P),F.ctx.restore()):c._fun.call(c,U,F,O,P)},F._transform=function(U,F,O,P){var Y=U.transform,c=this._next;if(Y&&c!=h.NORENDER){var L=F.ctx;U._style;Y.tx=O,Y.ty=P;var u=L._getTransformMatrix(),d=u.clone();T.mul(Y,u,u),u._checkTransform(),Y.tx=Y.ty=0,c._fun.call(c,U,F,0,0),d.copyTo(u),d.destroy()}else c._fun.call(c,U,F,O,P)},r.tmpTarget=function(U,F){var O=U.getValue("bounds"),P=VU.create(O.width,O.height);P.start(),P.clear(0,0,0,0),U.addValue("tmpTarget",P)},r.endTmpTarget=function(U){U.getValue("tmpTarget").end()},r.recycleTarget=function(U){U.getValue("tmpTarget").recycle(),U.recycle()},L(r,["tempUV",function(){return this.tempUV=new Array(8)}]),r}(),gU=function(U){function F(){this.data=null,F.__super.call(this)}J(F,"laya.filters.webgl.ColorFilterActionGL",M);var O=F.prototype;return K.imps(O,{"laya.filters.IFilterActionGL":!0}),O.setValue=function(U){U.colorMat=this.data._mat,U.colorAlpha=this.data._alpha},O.apply3d=function(U,F,O,P,Y){var c=U.getValue("bounds"),L=IU.create(1,0);L.setFilters([this.data]);var u=T.TEMP;u.identity(),O.ctx.drawTarget(U,0,0,c.width,c.height,u,"src",L)},F}(),lU=function(U){function c(U,F,O,P,Y){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,c.__super.call(this,U,F,Y),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new qU,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=O,this._atlasCanvas.height=P,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}J(c,"laya.webgl.atlas.Atlaser",p);var F=c.prototype;return F.computeUVinAtlasTexture=function(U,F,O,P){var Y=o.atlasTextureWidth,c=o.atlasTextureHeight,L=O/Y,u=P/c,d=(O+U.bitmap.width)/Y,a=(P+U.bitmap.height)/c,b=U.bitmap.width/Y,z=U.bitmap.height/c;U.uv=[L+F[0]*b,u+F[1]*z,d-(1-F[2])*b,u+F[3]*z,d-(1-F[4])*b,a-(1-F[5])*z,L+F[6]*b,a-(1-F[7])*z]},F.findBitmapIsExist=function(U){if(U instanceof laya.webgl.resource.WebGLImage){var F=U,O=F.url,P=this._InAtlasWebGLImagesKey[O||F.id];if(P)return P.offsetInfoID}return-1},F.addToAtlasTexture=function(U,F,O){if(U instanceof laya.webgl.resource.WebGLImage){var P=U,Y=P.url;this._InAtlasWebGLImagesKey[Y||P.id]={bitmap:U,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([F,O])}this._atlasCanvas.texSubImage2D(F,O,U.atlasSource),U.clearAtlasSource()},F.addToAtlas=function(U,F,O){U._atlasID=this._inAtlasTextureKey.length;var P=U.uv.slice(),Y=U.bitmap;this._inAtlasTextureKey.push(U),this._inAtlasTextureOriUVValue.push(P),this._inAtlasTextureBitmapValue.push(Y),this.computeUVinAtlasTexture(U,P,F,O),U.bitmap=this._atlasCanvas},F.clear=function(){for(var U=0,F=this._inAtlasTextureKey.length;U<F;U++)this._inAtlasTextureKey[U].bitmap=this._inAtlasTextureBitmapValue[U],this._inAtlasTextureKey[U].uv=this._inAtlasTextureOriUVValue[U],this._inAtlasTextureKey[U]._atlasID=-1,this._inAtlasTextureKey[U].bitmap.lock=!1,this._inAtlasTextureKey[U].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},F.dispose=function(){this.clear(),this._atlasCanvas.destroy()},P(0,F,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),P(0,F,"texture",function(){return this._atlasCanvas}),P(0,F,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),c}(),$U=function(U){function O(){O.__super.call(this,O.__name2int,O.__int2name,O.__int2nameMap)}return J(O,"laya.webgl.shader.d2.ShaderDefines2D",E),O.__init__=function(){O.reg("TEXTURE2D",1),O.reg("COLOR2D",2),O.reg("PRIMITIVE",4),O.reg("GLOW_FILTER",8),O.reg("BLUR_FILTER",16),O.reg("COLOR_FILTER",32),O.reg("COLOR_ADD",64),O.reg("WORLDMAT",128),O.reg("FILLTEXTURE",256),O.reg("FSHIGHPRECISION",1024),O.reg("TXTALPHA",2048),O.reg("TXTCOMPRESS",4096)},O.reg=function(U,F){E._reg(U,F,O.__name2int,O.__int2name)},O.toText=function(U,F,O){return E._toText(U,F,O)},O.toInt=function(U){return E._toInt(U,O.__name2int)},O.TEXTURE2D=1,O.COLOR2D=2,O.PRIMITIVE=4,O.FILTERGLOW=8,O.FILTERBLUR=16,O.FILTERCOLOR=32,O.COLORADD=64,O.WORLDMAT=128,O.FILLTEXTURE=256,O.SKINMESH=512,O.SHADERDEFINE_FSHIGHPRECISION=1024,O.TXTALPHA=2048,O.TXTCOMPRESS=4096,O.__name2int={},O.__int2name=[],O.__int2nameMap=[],O}(),CU=(function(U){function u(U,F,O,P,Y,c,L){u.__super.call(this,U,F,O,P,40,Y,c,L)}J(u,"laya.webgl.shapes.Ellipse",OU)}(),function(U){function c(U,F,O,P,Y){this._points=[],this.rebuild(O),c.__super.call(this,U,F,0,0,0,Y,P,Y,0)}J(c,"laya.webgl.shapes.Line",OU);var F=c.prototype;return F.rebuild=function(U){var F=U.length;F!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(F/2-1)),this.mFloat32Array=new Float32Array(5*F)),this._points.length=0;for(var O=NaN,P=NaN,Y=-1,c=-1,L=U.length/2,u=0;u<L;u++)O=U[2*u],P=U[2*u+1],(.01<Math.abs(Y-O)||.01<Math.abs(c-P))&&this._points.push(O,P),Y=O,c=P},F.getData=function(U,F,O){var P=[],Y=[];0<this.borderWidth&&this.createLine2(this._points,P,this.borderWidth,O,Y,this._points.length/2),this.mUint16Array.set(P,0),this.mFloat32Array.set(Y,0),U.append(this.mUint16Array),F.append(this.mFloat32Array)},c}()),sU=function(U){function z(U,F,O,P,Y){this._points=[];for(var c=NaN,L=NaN,u=-1,d=-1,a=O.length/2-1,b=0;b<a;b++)c=O[2*b],L=O[2*b+1],(.01<Math.abs(u-c)||.01<Math.abs(d-L))&&this._points.push(c,L),u=c,d=L;c=O[2*a],L=O[2*a+1],u=this._points[0],d=this._points[1],(.01<Math.abs(u-c)||.01<Math.abs(d-L))&&this._points.push(c,L),z.__super.call(this,U,F,0,0,this._points.length/2,0,P,Y)}J(z,"laya.webgl.shapes.LoopLine",OU);var F=z.prototype;return F.getData=function(U,F,O){if(0<this.borderWidth){for(var P=this.color,Y=(P>>16&255)/255,c=(P>>8&255)/255,L=(255&P)/255,u=[],d=0,a=0,b=[],z=Math.floor(this._points.length/2),J=0;J<z;J++)d=this._points[2*J],a=this._points[2*J+1],u.push(this.x+d,this.y+a,Y,c,L);this.createLoopLine(u,b,this.borderWidth,O+u.length/5),U.append(new Uint16Array(b)),F.append(new Float32Array(u))}},F.createLoopLine=function(U,F,O,P,Y,c){U.length;var L=U.concat(),u=Y||U,d=this.borderColor,a=(d>>16&255)/255,b=(d>>8&255)/255,z=(255&d)/255,J=[L[0],L[1]],w=[L[L.length-5],L[L.length-4]],j=w[0]+.5*(J[0]-w[0]),x=w[1]+.5*(J[1]-w[1]);L.unshift(j,x,0,0,0),L.push(j,x,0,0,0);var r,H,h,Q,X,N,K,f,I,T,g,l,$,C,s,i,y,k,A,G,V=L.length/5,M=P,m=O/2;h=L[0],Q=L[1],T=h-(X=L[5]),I=(I=-(Q-(N=L[6])))/(G=Math.sqrt(I*I+T*T))*m,T=T/G*m,u.push(h-I,Q-T,a,b,z,h+I,Q+T,a,b,z);for(var p=1;p<V-1;p++)h=L[5*(p-1)],Q=L[5*(p-1)+1],X=L[5*p],N=L[5*p+1],K=L[5*(p+1)],f=L[5*(p+1)+1],T=h-X,l=X-K,s=(-(I=(I=-(Q-N))/(G=Math.sqrt(I*I+T*T))*m)+h)*(-(T=T/G*m)+N)-(-I+X)*(-T+Q),k=(-(g=(g=-(N-f))/(G=Math.sqrt(g*g+l*l))*m)+K)*(-(l=l/G*m)+N)-(-g+X)*(-l+f),A=($=-T+Q-(-T+N))*(y=-g+X-(-g+K))-(i=-l+f-(-l+N))*(C=-I+X-(-I+h)),Math.abs(A)<.1?(A+=10.1,u.push(X-I,N-T,a,b,z,X+I,N+T,a,b,z)):(((r=(C*k-y*s)/A)-X)*(r-X)+((H=(i*s-$*k)/A)-N)+(H-N),u.push(r,H,a,b,z,X-(r-X),N-(H-N),a,b,z));c&&(F=c);var o=this.edges+1;for(p=1;p<o;p++)F.push(M+2*(p-1),M+2*(p-1)+1,M+2*p+1,M+2*p+1,M+2*p,M+2*(p-1));return F.push(M+2*(p-1),M+2*(p-1)+1,M+1,M+1,M,M+2*(p-1)),u},z}(),iU=function(U){function L(U,F,O,P,Y,c){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=T.create(),this._points=O.slice(0,O.length),L.__super.call(this,U,F,0,0,this._points.length/2,P,Y,c)}J(L,"laya.webgl.shapes.Polygon",OU);var F=L.prototype;return F.rebuild=function(U){this._repaint||(this._points.length=0,this._points=this._points.concat(U))},F.setMatrix=function(U){U.copyTo(this._mat)},F.needUpdate=function(U){return this._repaint=this._mat.a==U.a&&this._mat.b==U.b&&this._mat.c==U.c&&this._mat.d==U.d&&this._mat.tx==U.tx&&this._mat.ty==U.ty,!this._repaint},F.getData=function(U,F,O){var P,Y=0,c=this._points,L=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=O){for(this._start=O,P=[],L=this.earcutTriangles.length,Y=0;Y<L;Y++)P.push(this.earcutTriangles[Y]+O);this.mUint16Array=new Uint16Array(P)}}else{this._start=O,P=[];var u=[],d=[],a=this.color,b=(a>>16&255)/255,z=(a>>8&255)/255,J=(255&a)/255;for(L=Math.floor(c.length/2),Y=0;Y<L;Y++)u.push(this.x+c[2*Y],this.y+c[2*Y+1],b,z,J),d.push(this.x+c[2*Y],this.y+c[2*Y+1]);for(this.earcutTriangles=PU.earcut(d,null,2),L=this.earcutTriangles.length,Y=0;Y<L;Y++)P.push(this.earcutTriangles[Y]+O);this.mUint16Array=new Uint16Array(P),this.mFloat32Array=new Float32Array(u)}U.append(this.mUint16Array),F.append(this.mFloat32Array)},L}(),yU=function(U){function c(){this._matrix=new T,this._matrix4=xU.defaultMatrix4.concat(),c.__super.call(this,1e4),this.shaderValue=new IU(0,0)}J(c,"laya.webgl.submit.SubmitCanvas",cU);var F=c.prototype;return F.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var U=hU.worldAlpha,F=hU.worldMatrix4,O=hU.worldMatrix,P=hU.worldFilters,Y=hU.worldShaderDefines,c=this.shaderValue,L=this._matrix,u=this._matrix4,d=T.TEMP;return T.mul(L,O,d),u[0]=d.a,u[1]=d.b,u[4]=d.c,u[5]=d.d,u[12]=d.tx,u[13]=d.ty,hU.worldMatrix=d.clone(),hU.worldMatrix4=u,hU.worldAlpha=hU.worldAlpha*c.alpha,c.filters&&c.filters.length&&(hU.worldFilters=c.filters,hU.worldShaderDefines=c.defines),this._ctx_src.flush(),hU.worldAlpha=U,hU.worldMatrix4=F,hU.worldMatrix.destroy(),hU.worldMatrix=O,hU.worldFilters=P,hU.worldShaderDefines=Y,1},F.releaseRender=function(){var U=c._cache;this._ctx_src=null,U[U._length++]=this},F.getRenderType=function(){return 10003},c.create=function(U,F,O){var P=c._cache._length?c._cache[--c._cache._length]:new c;P._ctx_src=U;var Y=P.shaderValue;return Y.alpha=F,Y.defines.setValue(0),O&&O.length&&Y.setFilters(O),P},c._cache=((c._cache=[])._length=0,c._cache),c}(),kU=function(U){function a(U){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===U&&(U=1e4),a.__super.call(this,U)}J(a,"laya.webgl.submit.SubmitTexture",cU);var F=a.prototype;return F.releaseRender=function(){var U=a._cache;(U[U._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},F.addTexture=function(U,F){this._texsID[this._texs.length]=U._uvID,this._texs.push(U),this._vbPos.push(F)},F.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var U=this.shaderValue.textureHost.bitmap;if(null!==U)for(var F=this._vb.getFloat32Array(),O=0,P=this._texs.length;O<P;O++){var Y=this._texs[O];Y.active();var c=Y.uv;if(this._texsID[O]!==Y._uvID){this._texsID[O]=Y._uvID;var L=this._vbPos[O];F[L+2]=c[0],F[L+3]=c[1],F[L+6]=c[2],F[L+7]=c[3],F[L+10]=c[4],F[L+11]=c[5],F[L+14]=c[6],F[L+15]=c[7],this._vb.setNeedUpload()}Y.bitmap!==U&&(this._isSameTexture=!1)}}},F.renderSubmit=function(){if(0===this._numEle)return a._shaderSet=!1,1;var U=this.shaderValue.textureHost;if(U){var F=U.source;if(!U.bitmap||!F)return a._shaderSet=!1,1;this.shaderValue.texture=F,U.alphaTexture&&U.alphaTexture.source&&(this.shaderValue.texture1=U.alphaTexture.source)}this._vb.bind_upload(this._ib);var O=XU.mainContext;if(_.activeBlendFunction!==this._blendFn&&(O.enable(3042),this._blendFn(O),_.activeBlendFunction=this._blendFn),s.drawCall++,s.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&GU.activeShader&&a._shaderSet?(GU.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&GU.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),a._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var P=U.bitmap,Y=0,c=GU.activeShader,L=0,u=this._texs.length;L<u;L++){var d=this._texs[L];d.bitmap===P&&L+1!==u||(c.uploadTexture2D(d.source),O.drawElements(4,6*(L-Y+1),5123,this._startIdx+6*Y*xU.BYTES_PIDX),P=d.bitmap,Y=L)}else O.drawElements(4,this._numEle,5123,this._startIdx);return 1},a.create=function(U,F,O,P,Y){var c=a._cache._length?a._cache[--a._cache._length]:new a;null==O&&((O=c._selfVb||(c._selfVb=EU.create(-1))).clear(),P=0),c._ib=F,c._vb=O,c._startIdx=P*xU.BYTES_PIDX,c._numEle=0;var L=U._nBlendType;c._blendFn=U._targets?_.targetFns[L]:_.fns[L],c.shaderValue=Y,c.shaderValue.setValue(U._shader2D);var u=U._shader2D.filters;return u&&c.shaderValue.setFilters(u),c},a._cache=((a._cache=[])._length=0,a._cache),a._shaderSet=!0,a}(),AU=function(U){function H(){H.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}J(H,"laya.webgl.utils.MeshTexture",HU);var F=H.prototype;return F.addData=function(U,F,O,P,Y,c){for(var L=U.length/2,u=this._vb.needSize(L*H.const_stride)>>2,d=this._vb.getFloat32Array(),a=0,b=0;b<L;b++){var z=U[a],J=U[a+1],w=z*P.a+J*P.c+P.tx,j=z*P.b+J*P.d+P.ty;d[u++]=w,d[u++]=j,d[u++]=F[a],d[u++]=F[a+1],a+=2}this._vb.setNeedUpload();var x=this.vertNum;if(0<x){(L=O.length)>H.tmpIdx.length&&(H.tmpIdx=new Uint16Array(L));for(var r=0;r<L;r++)H.tmpIdx[r]=O[r]+x;this._ib.appendU16Array(H.tmpIdx,O.length)}else this._ib.append(O);this._ib.setNeedUpload(),this.vertNum+=L,this.indexNum+=O.length},F.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},F.destroy=function(){this._ib.destroy(),this._vb.destroy()},H.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new H},H.const_stride=16,H._POOL=[],L(H,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),H}(),GU=function(U){function F(){F.__super.call(this),this.lock=!0}return J(F,"laya.webgl.shader.BaseShader",Q),F.activeShader=null,F.bindShader=null,F}(),VU=function(F){function b(U,F,O,P,Y,c,L,u,d){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===O&&(O=6408),void 0===P&&(P=5121),void 0===Y&&(Y=34041),void 0===c&&(c=!1),void 0===L&&(L=!1),void 0===u&&(u=-1),void 0===d&&(d=-1),this._type=1,this._w=U,this._h=F,this._surfaceFormat=O,this._surfaceType=P,this._depthStencilFormat=Y,H.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=c,this._repeat=L,this._minFifter=u,this._magFifter=d,this._createWebGLRenderTarget(),this.bitmap.lock=!0,b.__super.call(this,this.bitmap,A.INV_UV)}J(b,"laya.webgl.resource.RenderTarget2D",F);var U=b.prototype;return K.imps(U,{"laya.resource.IDispose":!0}),U.getType=function(){return this._type},U.getTexture=function(){return this},U.size=function(U,F){this._w==U&&this._h==F||(this._w=U,this._h=F,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},U.release=function(){this.destroy()},U.recycle=function(){b.POOL.push(this)},U.start=function(){var U=XU.mainContext;return this._preRenderTarget=hU.curRenderTarget,hU.curRenderTarget=this,U.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(U.viewport(0,0,this._w,this._h),this._svWidth=hU.width,this._svHeight=hU.height,hU.width=this._w,hU.height=this._h,GU.activeShader=null),this},U.clear=function(U,F,O,P){void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=1);var Y=XU.mainContext;Y.clearColor(U,F,O,P);var c=16384;switch(this._depthStencilFormat){case 33189:c|=256;break;case 36168:c|=1024;break;case 34041:c|=256,c|=1024}Y.clear(c)},U.end=function(){var U=XU.mainContext;U.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,hU.curRenderTarget=this._preRenderTarget,1==this._type?(U.viewport(0,0,this._svWidth,this._svHeight),hU.width=this._svWidth,hU.height=this._svHeight,GU.activeShader=null):U.viewport(0,0,K.stage.width,K.stage.height)},U.getData=function(U,F,O,P){var Y=XU.mainContext;if(Y.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===Y.checkFramebufferStatus(36160)))return Y.bindFramebuffer(36160,null),null;var c=new Uint8Array(this._w*this._h*4);return Y.readPixels(U,F,O,P,this._surfaceFormat,this._surfaceType,c),Y.bindFramebuffer(36160,null),c},U.destroy=function(U){void 0===U&&(U=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,F.prototype.destroy.call(this))},U.dispose=function(){},U._createWebGLRenderTarget=function(){this.bitmap=new eU(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(U){this.event("recovered")})},P(0,U,"surfaceFormat",function(){return this._surfaceFormat}),P(0,U,"magFifter",function(){return this._magFifter}),P(0,U,"surfaceType",function(){return this._surfaceType}),P(0,U,"mipMap",function(){return this._mipMap}),P(0,U,"depthStencilFormat",function(){return this._depthStencilFormat}),P(0,U,"minFifter",function(){return this._minFifter}),P(0,U,"source",function(){return this._alreadyResolved?K.superGet(A,this,"source"):null}),b.create=function(U,F,O,P,Y,c,L,u,d){void 0===O&&(O=6408),void 0===P&&(P=5121),void 0===Y&&(Y=34041),void 0===c&&(c=!1),void 0===L&&(L=!1),void 0===u&&(u=-1),void 0===d&&(d=-1);var a=b.POOL.pop();return a||(a=new b(U,F)),a.bitmap&&a._w==U&&a._h==F&&a._surfaceFormat==O&&a._surfaceType==P&&a._depthStencilFormat==Y&&a._mipMap==c&&a._repeat==L&&a._minFifter==u&&a._magFifter==d||(a._w=U,a._h=F,a._surfaceFormat=O,a._surfaceType=P,a._depthStencilFormat=Y,H.isConchWebGL&&34041===a._depthStencilFormat&&(a._depthStencilFormat=33189),a._mipMap=c,a._repeat=L,a._minFifter=u,a._magFifter=d,a.release(),a._createWebGLRenderTarget()),a},b.TYPE2D=1,b.TYPE3D=2,b.POOL=[],b}(A),MU=function(U){function F(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,F.__super.call(this),F._gl=XU.mainContext}J(F,"laya.webgl.utils.Buffer",Q);var O=F.prototype;return O._bind=function(){this.activeResource(),F._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(F._bindVertexBuffer=this._glBuffer),F._gl.bindBuffer(this._bufferType,F._bindActive[this._bufferType]=this._glBuffer),GU.activeShader=null)},O.recreateResource=function(){this._glBuffer||(this._glBuffer=F._gl.createBuffer()),this.completeCreate()},O.disposeResource=function(){this._glBuffer&&(XU.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},P(0,O,"bufferUsage",function(){return this._bufferUsage}),F._gl=null,F._bindActive={},F._bindVertexBuffer=null,F._enableAtributes=[],F}(),mU=function(U){function O(U){this.texcoord=null,this.offsetX=300,this.offsetY=0,O.__super.call(this,512,0);var F=8*xU.BYTES_PE;this.position=[2,5126,!1,F,0],this.texcoord=[2,5126,!1,F,2*xU.BYTES_PE],this.color=[4,5126,!1,F,4*xU.BYTES_PE]}return J(O,"laya.webgl.shader.d2.skinAnishader.SkinSV",IU),O}(),pU=function(U){function F(U){F.__super.call(this,2,0),this.color=[]}return J(F,"laya.webgl.shader.d2.value.Color2dSV",IU),F.prototype.setValue=function(U){U.fillStyle&&(this.color=U.fillStyle._color._color),U.strokeStyle&&(this.color=U.strokeStyle._color._color)},F}(),oU=function(U){function F(U){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=IU._TEXCOORD,F.__super.call(this,256,0)}J(F,"laya.webgl.shader.d2.value.FillTextureSV",IU);var O=F.prototype;return O.setValue=function(U){this.ALPHA=U.ALPHA,U.filters&&this.setFilters(U.filters)},O.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},F}(),RU=function(U){function F(U){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=IU._TEXCOORD,void 0===U&&(U=0),F.__super.call(this,1,U)}J(F,"laya.webgl.shader.d2.value.TextureSV",IU);var O=F.prototype;return O.setValue=function(U){this.ALPHA=U.ALPHA,U.filters&&this.setFilters(U.filters)},O.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},F}(),_U=function(U){function F(U){this.a_color=null,this.u_pos=[0,0],F.__super.call(this,4,0),this.position=[2,5126,!1,5*xU.BYTES_PE,0],this.a_color=[3,5126,!1,5*xU.BYTES_PE,2*xU.BYTES_PE]}return J(F,"laya.webgl.shader.d2.value.PrimitiveSV",IU),F}(),qU=function(U){function F(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,F.__super.call(this)}J(F,"laya.webgl.atlas.AtlasWebGLCanvas",U);var O=F.prototype;return O.recreateResource=function(){var U=XU.mainContext,F=this._source=U.createTexture(),O=NU.curBindTexTarget,P=NU.curBindTexValue;NU.bindTexture(U,3553,F),U.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),U.texParameteri(3553,10241,9729),U.texParameteri(3553,10240,9729),U.texParameteri(3553,10242,33071),U.texParameteri(3553,10243,33071),O&&P&&NU.bindTexture(U,O,P),this.memorySize=this._w*this._h*4,this.completeCreate()},O.disposeResource=function(){this._source&&(XU.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},O.texSubImage2D=function(U,F,O){if(H.isFlash){this._flashCacheImage||(this._flashCacheImage=x.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var P=O.bitmapdata;this._flashCacheImage._image.copyPixels(P,0,0,P.width,P.height,U,F),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var Y=XU.mainContext,c=NU.curBindTexTarget,L=NU.curBindTexValue;NU.bindTexture(Y,3553,this._source),Y.pixelStorei(37441,!0),0<=U-1&&Y.texSubImage2D(3553,0,U-1,F,6408,5121,O),U+1<=this._w&&Y.texSubImage2D(3553,0,U+1,F,6408,5121,O),0<=F-1&&Y.texSubImage2D(3553,0,U,F-1,6408,5121,O),F+1<=this._h&&Y.texSubImage2D(3553,0,U,F+1,6408,5121,O),Y.texSubImage2D(3553,0,U,F,6408,5121,O),Y.pixelStorei(37441,!1),c&&L&&NU.bindTexture(Y,c,L)}},O.texSubImage2DPixel=function(U,F,O,P,Y){var c=XU.mainContext,L=NU.curBindTexTarget,u=NU.curBindTexValue;NU.bindTexture(c,3553,this._source);var d=new Uint8Array(Y.data);c.pixelStorei(37441,!0),c.texSubImage2D(3553,0,U,F,O,P,6408,5121,d),c.pixelStorei(37441,!1),L&&u&&NU.bindTexture(c,L,u)},P(0,O,"width",U.prototype._$get_width,function(U){this._w=U}),P(0,O,"height",U.prototype._$get_height,function(U){this._h=U}),F}(O),DU=function(U){function Y(){this.flipY=!0,this.alwaysChange=!1,Y.__super.call(this)}J(Y,"laya.webgl.resource.WebGLCanvas",O);var F=Y.prototype;return F.getCanvas=function(){return this._canvas},F.clear=function(){this._ctx&&this._ctx.clear()},F.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},F._setContext=function(U){this._ctx=U},F.getContext=function(U,F){return this._ctx?this._ctx:this._ctx=Y._createContext(this)},F.size=function(U,F){this._w==U&&this._h==F||(this._w=U,this._h=F,this._ctx&&this._ctx.size(U,F),this._canvas&&(this._canvas.height=F,this._canvas.width=U))},F.activeResource=function(U){void 0===U&&(U=!1),this._source||this.recreateResource()},F.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},F.disposeResource=function(){this._source&&!this.iscpuSource&&(XU.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},F.createWebGlTexture=function(){var U=XU.mainContext;this._canvas;var F=this._source=U.createTexture();this.iscpuSource=!1;var O=NU.curBindTexTarget,P=NU.curBindTexValue;NU.bindTexture(U,3553,F),U.pixelStorei(37440,this.flipY?1:0),Y.premulAlpha&&U.pixelStorei(37441,!0),U.texImage2D(3553,0,6408,6408,5121,this._imgData),Y.premulAlpha&&U.pixelStorei(37441,!1),U.texParameteri(3553,10240,9729),U.texParameteri(3553,10241,9729),U.texParameteri(3553,10242,33071),U.texParameteri(3553,10243,33071),U.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,O&&P&&NU.bindTexture(U,O,P)},F.reloadCanvasData=function(){var U=XU.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var F=NU.curBindTexTarget,O=NU.curBindTexValue;NU.bindTexture(U,3553,this._source),Y.premulAlpha&&U.pixelStorei(37441,!0),U.texImage2D(3553,0,6408,6408,5121,this._imgData),Y.premulAlpha&&U.pixelStorei(37441,!1),U.pixelStorei(37440,0),F&&O&&NU.bindTexture(U,F,O)},F.texSubImage2D=function(U,F,O){var P=XU.mainContext,Y=NU.curBindTexTarget,c=NU.curBindTexValue;NU.bindTexture(P,3553,this._source),P.pixelStorei(37441,!0),P.texSubImage2D(3553,0,F,O,6408,5121,U._source),P.pixelStorei(37441,!1),Y&&c&&NU.bindTexture(P,Y,c)},F.toBase64=function(U,F,O){var P=null;this._canvas&&(P=this._canvas.toDataURL(U,F)),O.call(this,P)},P(0,F,"context",function(){return this._ctx}),P(0,F,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),P(0,F,"asBitmap",null,function(U){this._ctx&&(this._ctx.asBitmap=U)}),Y._createContext=null,Y.premulAlpha=!1,Y}(),ZU=function(U){function c(U,F){this.CborderSize=12,c.__super.call(this),this.char=U,this.isSpace=" "===U,this.xs=F.scaleX,this.ys=F.scaleY,this.font=F.font.toString(),this.fontSize=F.font.size,this.fillColor=F.fillColor,this.borderColor=F.borderColor,this.lineWidth=F.lineWidth,this.underLine=F.underLine;var O,P=H.isConchApp;P?((O=ConchTextCanvas)._source=ConchTextCanvas,O._source.canvas=ConchTextCanvas):O=w.canvas.source,this.canvas=O,this._enableMerageInAtlas=!0,this._ctx=P?O:this.canvas.getContext("2d",void 0);var Y=G.measureText(this.char,this.font);this.cw=Y.width*this.xs,this.ch=(Y.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new A(this)}J(c,"laya.webgl.resource.WebGLCharImage",O);var F=c.prototype;return K.imps(F,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),F.active=function(){this.texture.active()},F.recreateResource=function(){var U=H.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),U){var F=this.fontSize;1==this.xs&&1==this.ys||(F=parseInt(F*(this.xs>this.ys?this.xs:this.ys)+""));var O="normal 100 "+this.font;O=O.replace(c._fontSizeReg,F),this.borderColor&&(O+=" 1 "+this.borderColor),this._ctx.font=O,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,k.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var P=this._ctx.measureText(this.char);P||(P={width:16});var Y=P.width+1;this._ctx.lineTo(Y,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},F.onresize=function(U,F){this._w=U,this._h=F,this._allowMerageInAtlas=!0},F.clearAtlasSource=function(){},P(0,F,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),P(0,F,"atlasSource",function(){return this.canvas}),P(0,F,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(U){this._enableMerageInAtlas=U}),c.createOneChar=function(U,F){return new c(U,F)},c._fontSizeReg=new RegExp("\\d+(?=px)","g"),c}(),eU=function(U){function a(U,F,O,P,Y,c,L,u,d){void 0===O&&(O=6408),void 0===P&&(P=5121),void 0===Y&&(Y=34041),void 0===c&&(c=!1),void 0===L&&(L=!1),void 0===u&&(u=-1),void 0===d&&(d=1),a.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=U,this._h=F,this._surfaceFormat=O,this._surfaceType=P,this._depthStencilFormat=Y,this._mipMap=c,this._repeat=L,this._minFifter=u,this._magFifter=d}J(a,"laya.webgl.resource.WebGLRenderTarget",O);var F=a.prototype;return F.recreateResource=function(){var U=XU.mainContext;this._frameBuffer||(this._frameBuffer=U.createFramebuffer()),this._source||(this._source=U.createTexture());var F=NU.curBindTexTarget,O=NU.curBindTexValue;NU.bindTexture(U,3553,this._source),U.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var P=this._minFifter,Y=this._magFifter,c=this._repeat?10497:33071,L=b.isPOT(this._w,this._h);if(L?(this._mipMap?-1!==P||(P=9987):-1!==P||(P=9729),-1!==Y||(Y=9729),U.texParameteri(3553,10241,P),U.texParameteri(3553,10240,Y),U.texParameteri(3553,10242,c),U.texParameteri(3553,10243,c),this._mipMap&&U.generateMipmap(3553)):(-1!==P||(P=9729),-1!==Y||(Y=9729),U.texParameteri(3553,10241,P),U.texParameteri(3553,10240,Y),U.texParameteri(3553,10242,33071),U.texParameteri(3553,10243,33071)),U.bindFramebuffer(36160,this._frameBuffer),U.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=U.createRenderbuffer()),U.bindRenderbuffer(36161,this._depthStencilBuffer),U.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:U.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:U.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:U.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}U.bindFramebuffer(36160,null),F&&O&&NU.bindTexture(U,F,O),U.bindRenderbuffer(36161,null),L&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},F.disposeResource=function(){this._frameBuffer&&(XU.mainContext.deleteTexture(this._source),XU.mainContext.deleteFramebuffer(this._frameBuffer),XU.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},P(0,F,"depthStencilBuffer",function(){return this._depthStencilBuffer}),P(0,F,"frameBuffer",function(){return this._frameBuffer}),a}(),vU=function(U){function u(U,F,O,P,Y,c,L){this.offsetX=0,this.offsetY=0,u.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=c,this.canvas=U,this._ctx=U.getContext("2d",void 0),this._w=P,this._h=Y,this.offsetX=F,this.offsetY=O,this.src=L,this._enableMerageInAtlas=!0,o.enabled&&this._w<o.atlasLimitWidth&&this._h<o.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}J(u,"laya.webgl.resource.WebGLSubImage",O);var F=u.prototype;return K.imps(F,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),F.size=function(U,F){this._w=U,this._h=F,this._ctx&&this._ctx.size(U,F),this.canvas&&(this.canvas.height=F,this.canvas.width=U)},F.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},F.createWebGlTexture=function(){var U=XU.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var F=this._source=U.createTexture(),O=NU.curBindTexTarget,P=NU.curBindTexValue;NU.bindTexture(U,3553,F),U.pixelStorei(37441,!0),U.texImage2D(3553,0,6408,6408,5121,this.canvas),U.pixelStorei(37441,!1);var Y=this.minFifter,c=this.magFifter,L=this.repeat?10497:33071,u=b.isPOT(this.width,this.height);u?(this.mipmap?-1!==Y||(Y=9987):-1!==Y||(Y=9729),-1!==c||(c=9729),U.texParameteri(3553,10240,c),U.texParameteri(3553,10241,Y),U.texParameteri(3553,10242,L),U.texParameteri(3553,10243,L),this.mipmap&&U.generateMipmap(3553)):(-1!==Y||(Y=9729),-1!==c||(c=9729),U.texParameteri(3553,10241,Y),U.texParameteri(3553,10240,c),U.texParameteri(3553,10242,33071),U.texParameteri(3553,10243,33071)),O&&P&&NU.bindTexture(U,O,P),this.canvas=null,u&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},F.disposeResource=function(){o.enabled&&this._allowMerageInAtlas||!this._source||(XU.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},F.clearAtlasSource=function(){},P(0,F,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),P(0,F,"atlasSource",function(){return this.canvas}),P(0,F,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(U){this._allowMerageInAtlas=U}),u}(),nU=function(U){function a(U,F,O,P){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,a.__super.call(this),!U||!F)throw"Shader Error";this._id=++a._count,this._vs=U,this._ps=F,this._nameMap=P||{},null!=O&&(a.sharders[O]=this)}J(a,"laya.webgl.shader.Shader",GU);var F=a.prototype;return F.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},F.disposeResource=function(){XU.mainContext.deleteShader(this._vshader),XU.mainContext.deleteShader(this._pshader),XU.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},F._compile=function(){if(!XU.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var U=[this._vs,this._ps],F=XU.mainContext;if(this._program=F.createProgram(),this._vshader=a._createShader(F,U[0],35633),this._pshader=a._createShader(F,U[1],35632),F.attachShader(this._program,this._vshader),F.attachShader(this._program,this._pshader),F.linkProgram(this._program),!H.isConchApp&&!F.getProgramParameter(this._program,35714))throw F.getProgramInfoLog(this._program);var O,P,Y=0,c=0;for(c=H.isConchApp?F.getProgramParameterEx(this._vs,this._ps,"",35721):F.getProgramParameter(this._program,35721),Y=0;Y<c;Y++){var L=null;O={vartype:"attribute",glfun:null,ivartype:0,attrib:L=H.isConchApp?F.getActiveAttribEx(this._vs,this._ps,"",Y):F.getActiveAttrib(this._program,Y),location:F.getAttribLocation(this._program,L.name),name:L.name,type:L.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(O)}var u=0;for(u=H.isConchApp?F.getProgramParameterEx(this._vs,this._ps,"",35718):F.getProgramParameter(this._program,35718),Y=0;Y<u;Y++){var d=null;d=H.isConchApp?F.getActiveUniformEx(this._vs,this._ps,"",Y):F.getActiveUniform(this._program,Y),0<(O={vartype:"uniform",glfun:null,ivartype:1,attrib:L,location:F.getUniformLocation(this._program,d.name),name:d.name,type:d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(O.name=O.name.substr(0,O.name.length-3),O.isArray=!0,O.location=F.getUniformLocation(this._program,O.name)),this._params.push(O)}for(Y=0,P=this._params.length;Y<P;Y++)if((O=this._params[Y]).indexOfParams=Y,O.index=1,O.value=[O.location,null],O.codename=O.name,O.name=this._nameMap[O.codename]?this._nameMap[O.codename]:O.codename,(this._paramsMap[O.name]=O)._this=this,O.uploadedValue=[],"attribute"!==O.vartype)switch(O.type){case 5124:O.fun=O.isArray?this._uniform1iv:this._uniform1i;break;case 5126:O.fun=O.isArray?this._uniform1fv:this._uniform1f;break;case 35664:O.fun=O.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:O.fun=O.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:O.fun=O.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:O.fun=this._uniform_sampler2D;break;case 35680:O.fun=this._uniform_samplerCube;break;case 35676:O.glfun=F.uniformMatrix4fv,O.fun=this._uniformMatrix4fv;break;case 35670:O.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else O.fun=this._attribute}},F.getUniform=function(U){return this._paramsMap[U]},F._attribute=function(U,F){var O=XU.mainContext,P=MU._enableAtributes,Y=U.location;return P[Y]||O.enableVertexAttribArray(Y),O.vertexAttribPointer(Y,F[0],F[1],F[2],F[3],F[4]+this._offset),P[Y]=MU._bindVertexBuffer,1},F._uniform1f=function(U,F){var O=U.uploadedValue;return O[0]!==F?(XU.mainContext.uniform1f(U.location,O[0]=F),1):0},F._uniform1fv=function(U,F){if(F.length<4){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(XU.mainContext.uniform1fv(U.location,F),O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3],1):0}return XU.mainContext.uniform1fv(U.location,F),1},F._uniform_vec2=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]?(XU.mainContext.uniform2f(U.location,O[0]=F[0],O[1]=F[1]),1):0},F._uniform_vec2v=function(U,F){if(F.length<2){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(XU.mainContext.uniform2fv(U.location,F),O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3],1):0}return XU.mainContext.uniform2fv(U.location,F),1},F._uniform_vec3=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]?(XU.mainContext.uniform3f(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2]),1):0},F._uniform_vec3v=function(U,F){return XU.mainContext.uniform3fv(U.location,F),1},F._uniform_vec4=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(XU.mainContext.uniform4f(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3]),1):0},F._uniform_vec4v=function(U,F){return XU.mainContext.uniform4fv(U.location,F),1},F._uniformMatrix2fv=function(U,F){return XU.mainContext.uniformMatrix2fv(U.location,!1,F),1},F._uniformMatrix3fv=function(U,F){return XU.mainContext.uniformMatrix3fv(U.location,!1,F),1},F._uniformMatrix4fv=function(U,F){return XU.mainContext.uniformMatrix4fv(U.location,!1,F),1},F._uniform1i=function(U,F){var O=U.uploadedValue;return O[0]!==F?(XU.mainContext.uniform1i(U.location,O[0]=F),1):0},F._uniform1iv=function(U,F){return XU.mainContext.uniform1iv(U.location,F),1},F._uniform_ivec2=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]?(XU.mainContext.uniform2i(U.location,O[0]=F[0],O[1]=F[1]),1):0},F._uniform_ivec2v=function(U,F){return XU.mainContext.uniform2iv(U.location,F),1},F._uniform_vec3i=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]?(XU.mainContext.uniform3i(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2]),1):0},F._uniform_vec3vi=function(U,F){return XU.mainContext.uniform3iv(U.location,F),1},F._uniform_vec4i=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(XU.mainContext.uniform4i(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3]),1):0},F._uniform_vec4vi=function(U,F){return XU.mainContext.uniform4iv(U.location,F),1},F._uniform_sampler2D=function(U,F){var O=XU.mainContext,P=U.uploadedValue;return null==P[0]?(P[0]=this._curActTexIndex,O.uniform1i(U.location,this._curActTexIndex),O.activeTexture(a._TEXTURES[this._curActTexIndex]),NU.bindTexture(O,3553,F),this._curActTexIndex++,1):(O.activeTexture(a._TEXTURES[P[0]]),NU.bindTexture(O,3553,F),0)},F._uniform_samplerCube=function(U,F){var O=XU.mainContext,P=U.uploadedValue;return null==P[0]?(P[0]=this._curActTexIndex,O.uniform1i(U.location,this._curActTexIndex),O.activeTexture(a._TEXTURES[this._curActTexIndex]),NU.bindTexture(O,34067,F),this._curActTexIndex++,1):(O.activeTexture(a._TEXTURES[P[0]]),NU.bindTexture(O,34067,F),0)},F._noSetValue=function(U){console.log("no....:"+U.name)},F.uploadOne=function(U,F){this.activeResource(),NU.UseProgram(this._program);var O=this._paramsMap[U];O.fun.call(this,O,F)},F.uploadTexture2D=function(U){s.shaderCall++;var F=XU.mainContext;F.activeTexture(33984),NU.bindTexture(F,3553,U)},F.uploadTexture2D1=function(U){s.shaderCall++;var F=XU.mainContext;F.activeTexture(33985),NU.bindTexture(F,3553,U)},F.upload=function(U,F){GU.activeShader=GU.bindShader=this,this._lastUseFrameCount===s.loopCount||this.activeResource(),NU.UseProgram(this._program),this._reCompile?(F=this._params,this._reCompile=!1):F=F||this._params;XU.mainContext;for(var O,P,Y=F.length,c=0,L=0;L<Y;L++)null!==(P=U[(O=F[L]).name])&&(c+=O.fun.call(this,O,P));s.shaderCall+=c},F.uploadArray=function(U,F,O){GU.activeShader=this,(GU.bindShader=this).activeResource(),NU.UseProgram(this._program);this._params;for(var P,Y,c=0,L=F-2;0<=L;L-=2)(Y=this._paramsMap[U[L]])&&null!=(P=U[L+1])&&(O&&O[Y.name]&&O[Y.name].bind(),c+=Y.fun.call(this,Y,P));s.shaderCall+=c},F.getParams=function(){return this._params},a.getShader=function(U){return a.sharders[U]},a.create=function(U,F,O,P){return new a(U,F,O,P)},a.withCompile=function(U,F,O,P){if(O&&a.sharders[O])return a.sharders[O];var Y=a._preCompileShader[2e-4*U];if(!Y)throw new Error("withCompile shader err!"+U);return Y.createShader(F,O,P)},a.withCompile2D=function(U,F,O,P,Y){if(P&&a.sharders[P])return a.sharders[P];var c=a._preCompileShader[2e-4*U+F];if(!c)throw new Error("withCompile shader err!"+U+" "+F);return c.createShader(O,P,Y)},a.addInclude=function(U,F){QU.addInclude(U,F)},a.preCompile=function(U,F,O,P){var Y=2e-4*U;a._preCompileShader[Y]=new QU(Y,F,O,P)},a.preCompile2D=function(U,F,O,P,Y){var c=2e-4*U+F;a._preCompileShader[c]=new QU(c,O,P,Y)},a._createShader=function(U,F,O){var P=U.createShader(O);return U.shaderSource(P,F),U.compileShader(P),P},a._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],a._count=0,a._preCompileShader={},a.SHADERNAME2ID=2e-4,a.sharders=((a.sharders=[]).length=32,a.sharders),L(a,["nameKey",function(){return this.nameKey=new i}]),a}(),tU=function(U){function F(){this._maxsize=0,this._upload=!0,this._uploadSize=0,F.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}J(F,"laya.webgl.utils.Buffer2D",U);var O=F.prototype;return O.needSize=function(U){var F=this._byteLength;if(U){var O=this._byteLength+U;O<=this._buffer.byteLength||this._resizeBuffer(O<<1,!0),this._byteLength=O}return F},O._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),s.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,MU._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),MU._gl.bufferSubData(this._bufferType,0,this._buffer)},O._bufferSubData=function(U,F,O){if(void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),this._maxsize=Math.max(this._maxsize,this._byteLength),s.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,MU._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),F||O){var P=this._buffer.slice(F,O);MU._gl.bufferSubData(this._bufferType,U,P)}else MU._gl.bufferSubData(this._bufferType,U,this._buffer)},O._checkArrayUse=function(){},O._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},O._bind_subUpload=function(U,F,O){return void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(U,F,O),!0)},O._resizeBuffer=function(U,F){if(U<this._buffer.byteLength)return this;if(this.memorySize=U,F&&this._buffer&&0<this._buffer.byteLength){var O=new ArrayBuffer(U);new Uint8Array(O).set(new Uint8Array(this._buffer),0),this._buffer=O}else this._buffer=new ArrayBuffer(U);return this._checkArrayUse(),this._upload=!0,this},O.append=function(U){this._upload=!0;var F,O;F=U.byteLength,U instanceof Uint8Array?(this._resizeBuffer(this._byteLength+F,!0),O=new Uint8Array(this._buffer,this._byteLength)):U instanceof Uint16Array?(this._resizeBuffer(this._byteLength+F,!0),O=new Uint16Array(this._buffer,this._byteLength)):U instanceof Float32Array&&(this._resizeBuffer(this._byteLength+F,!0),O=new Float32Array(this._buffer,this._byteLength)),O.set(U,0),this._byteLength+=F,this._checkArrayUse()},O.appendU16Array=function(U,F){this._resizeBuffer(this._byteLength+2*F,!0);for(var O=new Uint16Array(this._buffer,this._byteLength,F),P=0;P<F;P++)O[P]=U[P];this._byteLength+=2*F,this._checkArrayUse()},O.appendEx=function(U,F){this._upload=!0;var O;O=U.byteLength,this._resizeBuffer(this._byteLength+O,!0),new F(this._buffer,this._byteLength).set(U,0),this._byteLength+=O,this._checkArrayUse()},O.appendEx2=function(U,F,O,P){void 0===P&&(P=1),this._upload=!0;var Y,c;Y=O*P,this._resizeBuffer(this._byteLength+Y,!0),c=new F(this._buffer,this._byteLength);var L=0;for(L=0;L<O;L++)c[L]=U[L];this._byteLength+=Y,this._checkArrayUse()},O.getBuffer=function(){return this._buffer},O.setNeedUpload=function(){this._upload=!0},O.getNeedUpload=function(){return this._upload},O.upload=function(){var U=this._bind_upload();return MU._gl.bindBuffer(this._bufferType,null),MU._bindActive[this._bufferType]=null,GU.activeShader=null,U},O.subUpload=function(U,F,O){void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0);var P=this._bind_subUpload();return MU._gl.bindBuffer(this._bufferType,null),MU._bindActive[this._bufferType]=null,GU.activeShader=null,P},O.disposeResource=function(){U.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},O.clear=function(){this._byteLength=0,this._upload=!0},P(0,O,"bufferLength",function(){return this._buffer.byteLength}),P(0,O,"byteLength",null,function(U){this._byteLength!==U&&(U<=this._buffer.byteLength||this._resizeBuffer(2*U+256,!0),this._byteLength=U)}),F.__int__=function(U){BU.QuadrangleIB=BU.create(35044),rU.fillIBQuadrangle(BU.QuadrangleIB,16)},F.FLOAT32=4,F.SHORT=2,F}(MU),SU=(function(F){function O(U){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,O.__super.call(this,9)}J(O,"laya.webgl.shader.d2.value.GlowSV",F);var U=O.prototype;U.setValue=function(U){F.prototype.setValue.call(this,U)},U.clear=function(){F.prototype.clear.call(this)}}(RU),function(U){function F(U){F.__super.call(this,64),this.defines.add(64)}J(F,"laya.webgl.shader.d2.value.TextSV",U);var O=F.prototype;return O.release=function(){(F.pool[F._length++]=this).clear()},O.clear=function(){U.prototype.clear.call(this)},F.create=function(){return F._length?F.pool[--F._length]:new F(null)},F.pool=[],F._length=0,F}(RU)),WU=function(U){function Y(U,F,O,P){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,Y.__super.call(this,U,F,O,P)}J(Y,"laya.webgl.shader.d2.Shader2X",U);var F=Y.prototype;return F.upload2dQuick1=function(U){this.upload(U,this._params2dQuick1||this._make2dQuick1())},F._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var U,F=this._params,O=0,P=F.length;O<P;O++)U=F[O],(H.isFlash||"size"!==U.name&&"position"!==U.name&&"texcoord"!==U.name)&&this._params2dQuick1.push(U)}return this._params2dQuick1},F.disposeResource=function(){U.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},F.upload2dQuick2=function(U){this.upload(U,this._params2dQuick2||this._make2dQuick2())},F._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var U,F=this._params,O=0,P=F.length;O<P;O++)U=F[O],(H.isFlash||"size"!==U.name)&&this._params2dQuick2.push(U)}return this._params2dQuick2},Y.create=function(U,F,O,P){return new Y(U,F,O,P)},Y}(nU),BU=function(U){function F(U){this._uint8Array=null,this._uint16Array=null,void 0===U&&(U=35044),F.__super.call(this),this._bufferUsage=U,this._bufferType=34963,H.isFlash||(this._buffer=new ArrayBuffer(8))}J(F,"laya.webgl.utils.IndexBuffer2D",tU);var O=F.prototype;return O._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},O.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},O.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},O.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},F.QuadrangleIB=null,F.create=function(U){return void 0===U&&(U=35044),new F(U)},F}(),EU=function(U){function O(U,F){this._floatArray32=null,this._vertexStride=0,O.__super.call(this),this._vertexStride=U,this._bufferUsage=F,this._bufferType=34962,H.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}J(O,"laya.webgl.utils.VertexBuffer2D",U);var F=O.prototype;return F.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},F.bind=function(U){U&&U._bind(),this._bind()},F.insertData=function(U,F){this.getFloat32Array().set(U,F),this._upload=!0},F.bind_upload=function(U){U._bind_upload()||U._bind(),this._bind_upload()||this._bind()},F._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},F.disposeResource=function(){U.prototype.disposeResource.call(this)},F.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},P(0,F,"vertexStride",function(){return this._vertexStride}),O.create=function(U,F){return void 0===F&&(F=35048),new O(U,F)},O}(tU),UF=function(U){function u(U,F,O,P,Y,c){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===O&&(O=6408),void 0===P&&(P=!0),u.__super.call(this,U,F),U){if(this._format=O,this._mipmap=P,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof U)this._url=U,this._src=U,this._image=new w.window.Image,F&&(F.onload&&(this.onload=F.onload),F.onerror&&(this.onerror=F.onerror),F.onCreate&&F.onCreate(this)),this._image.crossOrigin=U&&0==U.indexOf("data:")?null:"",U&&(this._image.src=U);else if(U instanceof ArrayBuffer){this._src=F,this._url=this._src;var L=new d(U);L.readUTFBytes(4),L.readUTFBytes(2),L.getInt16();L.endian="bigEndian",this._w=L.getInt16(),this._h=L.getInt16();L.getInt16(),L.getInt16();this._image=new Uint8Array(U,L.pos),this._format=XU.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,o.enabled&&this._w<o.atlasLimitWidth&&this._h<o.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(U instanceof Uint8Array))return this._src=F,this._url=this._src,this._image=U.source||U,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=F,this._url=this._src,this._w=Y,this._h=c,this._image=U,this._format=0===O?U.byteLength/(Y*c)==4?6408:6407:O}this._$5__enableMerageInAtlas=!0}}J(u,"laya.webgl.resource.WebGLImage",x);var F=u.prototype;return K.imps(F,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),F._init_=function(U,F){},F._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var U=XU.mainContext,F=this._source=U.createTexture(),O=NU.curBindTexTarget,P=NU.curBindTexValue;NU.bindTexture(U,3553,F);var Y=this.minFifter,c=this.magFifter,L=this.repeat?10497:33071,u=b.isPOT(this._w,this._h),d=!1;switch(u?(this.mipmap?-1!==Y||(Y=9987):-1!==Y||(Y=9729),-1!==c||(c=9729),U.texParameteri(3553,10241,Y),U.texParameteri(3553,10240,c),U.texParameteri(3553,10242,L),U.texParameteri(3553,10243,L),this.mipmap&&U.generateMipmap(3553)):(-1!==Y||(Y=9729),-1!==c||(c=9729),U.texParameteri(3553,10241,Y),U.texParameteri(3553,10240,c),U.texParameteri(3553,10242,33071),U.texParameteri(3553,10243,33071)),U.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&U.pixelStorei(U.UNPACK_ALIGNMENT,1),U.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&U.pixelStorei(U.UNPACK_ALIGNMENT,1),U.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:d=!0,U.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case XU.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:d=!0,U.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}U.pixelStorei(37441,!1),O&&P&&NU.bindTexture(U,O,P),this.uri||(this.uri=this._url),d?this.memorySize=this._image.length:u&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},F.recreateResource=function(){var U=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var F=this;this._image=new w.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(F._needReleaseAgain)return F._needReleaseAgain=!1,F._image.onload=null,void(F._image=null);F._allowMerageInAtlas&&F._enableMerageInAtlas?(U.memorySize=0,U._recreateLock=!1):F._createWebGlTexture(),F.completeCreate()},this._image.src=this._src}},F.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&XU.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},F.onresize=function(){this._w=this._image.width,this._h=this._image.height,o.enabled&&this._w<o.atlasLimitWidth&&this._h<o.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},F.clearAtlasSource=function(){this._image=null},P(0,F,"format",function(){return this._format}),P(0,F,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(U){this._$5__enableMerageInAtlas=U}),P(0,F,"mipmap",function(){return this._mipmap}),P(0,F,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),P(0,F,"atlasSource",function(){return this._image}),P(0,F,"onload",null,function(U){var F=this;this._onload=U,this._image&&(this._image.onload=null!=this._onload?function(){F.onresize(),F._onload()}:null)}),P(0,F,"onerror",null,function(U){var F=this;this._onerror=U,this._image&&(this._image.onerror=null!=this._onerror?function(){F._onerror()}:null)}),u}();K.__init([wU,p,fU,QU])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(U,F){"use strict";for(var O in Object.defineProperty(F,"__esModule",{value:!0}),Laya){var P=Laya[O];P&&P.__isclass&&(F[O]=P)}}),function(c,U,P){P.un,P.uns;var Y=P.static,L=P.class,u=P.getset,d=(P.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),j=laya.utils.ClassUtils,z=(laya.events.Event,laya.utils.HTMLChar),a=laya.net.Loader,b=(laya.display.Node,laya.maths.Rectangle),J=laya.renders.Render,w=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),x=laya.utils.Stat,G=laya.display.Text,r=laya.resource.Texture,H=laya.net.URL,h=laya.utils.Utils,Q=function(){function w(){}return L(w,"laya.html.utils.HTMLParse"),w.parse=function(U,F,O){F=(F="<root>"+(F=F.replace(/<br>/g,"<br/>"))+"</root>").replace(w.spacePattern,w.char255);var P=h.parseXMLFromString(F);w._parseXML(U,P.childNodes[0].childNodes,O)},w._parseXML=function(U,F,O,P){var Y=0,c=0;if(F.join||F.item)for(Y=0,c=F.length;Y<c;++Y)w._parseXML(U,F[Y],O,P);else{var L,u,d;if(3==F.nodeType)return void(U instanceof laya.html.dom.HTMLDivElement?(null==F.nodeName&&(F.nodeName="#text"),u=F.nodeName.toLowerCase(),0<(d=F.textContent.replace(/^\s+|\s+$/g,"")).length&&(L=j.getInstance(u))&&(U.addChild(L),L.innerTEXT=d.replace(w.char255AndOneSpacePattern," "))):0<(d=F.textContent.replace(/^\s+|\s+$/g,"")).length&&(U.innerTEXT=d.replace(w.char255AndOneSpacePattern," ")));if("#comment"==(u=F.nodeName.toLowerCase()))return;if(L=j.getInstance(u)){(L=U.addChild(L)).URI=O,L.href=P;var a=F.attributes;if(a&&0<a.length)for(Y=0,c=a.length;Y<c;++Y){var b=a[Y],z=b.nodeName,J=b.value;L._setAttributes(z,J)}w._parseXML(L,F.childNodes,O,L.href)}else w._parseXML(U,F.childNodes,O,P)}},w.char255=String.fromCharCode(255),w.spacePattern=/&nbsp;|&#160;/g,w.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),w}(),X=function(){function A(){}return L(A,"laya.html.utils.Layout"),A.later=function(U){null==A._will&&(A._will=[],P.stage.frameLoop(1,null,function(){if(!(A._will.length<1)){for(var U=0;U<A._will.length;U++)laya.html.utils.Layout.layout(A._will[U]);A._will.length=0}})),A._will.push(U)},A.layout=function(U){if(!U||!U._style)return null;if(0==(512&U._style._type))return null;U.getStyle()._type&=-513;var F=A._multiLineLayout(U);return J.isConchApp&&U.layaoutCallNative&&U.layaoutCallNative(),F},A._multiLineLayout=function(U){if(G.RightToLeft)return A._multiLineLayout2(U);var F=new Array;U._addChildsToLayout(F);var O,P,Y,c,L,u=0,d=F.length,a=U._getCSSStyle(),b=a.letterSpacing,z=a.leading,J=a.lineHeight,w=a._widthAuto()||!a.wordWrap,j=w?999999:U.width,x=(U.height,0),r=a.italic?a.fontSize/3:0,H=a._getAlign(),h=a._getValign(),Q=0!==h||0!==H||0!=J,X=0,N=0,K=0,f=0,I=new Array,T=I[0]=new V,g=!1,l=!1;T.h=0,a.italic&&(j-=a.fontSize/3);var $=0,C=!0;function s(){T.y=N,N+=T.h+z,0==T.h&&(N+=J),T.mWidth=$,$=0,T=new V,I.push(T),T.h=0,g=!(C=!(X=0))}for(u=0;u<d;u++)if(null!=(O=F[u]))if(C=!1,O instanceof laya.html.dom.HTMLBrElement)s(),T.y=N;else{if(O._isChar()){if((c=O).isWord)g=l||"\n"===c.char,T.wordStartIndex=T.elements.length;else{if(K=c.width+c.style.letterSpacin,0<I.length&&j<X+K&&0<T.wordStartIndex){var i;i=T.elements.length-T.wordStartIndex+1,T.elements.length=T.wordStartIndex,u-=i,s();continue}g=!1,$+=c.width}K=c.width+b,f=c.height,l=!1,(g=g||j<X+K)&&s(),T.minTextHeight=Math.min(T.minTextHeight,O.height)}else P=O._getCSSStyle(),L=O,Y=P.padding,0===P._getCssFloat()||(Q=!0),g=l||P.lineElement,K=L.width*L._style._tf.scaleX+Y[1]+Y[3]+b,f=L.height*L._style._tf.scaleY+Y[0]+Y[2],l=P.lineElement,(g=g||j<X+K&&P.wordWrap)&&s();T.elements.push(O),T.h=Math.max(T.h,f),O.x=X,O.y=N,X+=K,T.w=X-b,T.y=N,x=Math.max(X+r,x)}else C||(X+=A.DIV_ELEMENT_PADDING),T.wordStartIndex=T.elements.length;if(N=T.y+T.h,Q){var y=0,k=j;for(w&&0<U.width&&(k=U.width),u=0,d=I.length;u<d;u++)I[u].updatePos(0,k,u,y,H,h,J),y+=Math.max(J,I[u].h+z);N=y}return w&&(U.width=x),N>U.height&&(U.height=N),[x,N]},A._multiLineLayout2=function(U){var F=new Array;U._addChildsToLayout(F);var O,P,Y,c,L,u=0,d=F.length,a=U._getCSSStyle(),b=a.letterSpacing,z=a.leading,J=a.lineHeight,w=a._widthAuto()||!a.wordWrap,j=w?999999:U.width,x=(U.height,0),r=a.italic?a.fontSize/3:0,H=2-a._getAlign(),h=a._getValign(),Q=0!==h||0!=H||0!=J,X=0,N=0,K=0,f=0,I=new Array,T=I[0]=new V,g=!1,l=!1;T.h=0,a.italic&&(j-=a.fontSize/3);var $=0,C=!0;function s(){T.y=N,N+=T.h+z,0==T.h&&(N+=J),T.mWidth=$,$=0,T=new V,I.push(T),T.h=0,g=!(C=!(X=0))}for(u=0;u<d;u++)if(null!=(O=F[u]))if(C=!1,O instanceof laya.html.dom.HTMLBrElement)s(),T.y=N;else{if(O._isChar()){if((c=O).isWord)g=l||"\n"===c.char,T.wordStartIndex=T.elements.length;else{if(0<I.length&&j<X+K&&0<T.wordStartIndex){var i;i=T.elements.length-T.wordStartIndex+1,T.elements.length=T.wordStartIndex,u-=i,s();continue}g=!1,$+=c.width}K=c.width+b,f=c.height,l=!1,(g=g||j<X+K)&&s(),T.minTextHeight=Math.min(T.minTextHeight,O.height)}else P=O._getCSSStyle(),L=O,Y=P.padding,0===P._getCssFloat()||(Q=!0),g=l||P.lineElement,K=L.width*L._style._tf.scaleX+Y[1]+Y[3]+b,f=L.height*L._style._tf.scaleY+Y[0]+Y[2],l=P.lineElement,(g=g||j<X+K&&P.wordWrap)&&s();T.elements.push(O),T.h=Math.max(T.h,f),O.x=X,O.y=N,X+=K,T.w=X-b,T.y=N,x=Math.max(X+r,x)}else C||(X+=A.DIV_ELEMENT_PADDING),T.wordStartIndex=T.elements.length;if(N=T.y+T.h,Q){var y=0,k=j;for(u=0,d=I.length;u<d;u++)I[u].updatePos(0,k,u,y,H,h,J),y+=Math.max(J,I[u].h+z);N=y}for(w&&(U.width=x),N>U.height&&(U.height=N),u=0,d=I.length;u<d;u++)I[u].revertOrder(j);return[x,N]},A._will=null,A.DIV_ELEMENT_PADDING=0,A}(),V=function(){function U(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}L(U,"laya.html.utils.LayoutLine");var F=U.prototype;return F.updatePos=function(U,F,O,P,Y,c,L){var u,d=0;0<this.elements.length&&(d=(u=this.elements[this.elements.length-1]).x+u.width-this.elements[0].x);var a=0,b=NaN;1===Y&&(a=(F-d)/2),2===Y&&(a=F-d),0===L||0!=c||(c=1);for(var z=0,J=this.elements.length;z<J;z++){var w=(u=this.elements[z])._getCSSStyle();switch(0!==a&&(u.x+=a),w._getValign()){case 0:u.y=P;break;case 1:var j=0;99999!=this.minTextHeight&&(j=this.minTextHeight);var x=(j+L)/2;x=Math.max(x,this.h),b=(laya.html.dom.HTMLImageElement,P+x-u.height),u.y=b;break;case 2:u.y=P+(L-u.height)}}},F.revertOrder=function(U){var F;if(0<this.elements.length){var O,P=0;for(O=this.elements.length,P=0;P<O;P++)(F=this.elements[P]).x=U-F.x-F.width}},U}(),N=function(O){function F(){this.URI=null,this._href=null,F.__super.call(this),this._text=F._EMPTYTEXT,this.setStyle(new d(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}L(F,"laya.html.dom.HTMLElement",O);var U=F.prototype;return U.layaoutCallNative=function(){var U=0;if(this._childs&&0<(U=this._childs.length))for(var F=0;F<U;F++)this._childs[F].layaoutCallNative&&this._childs[F].layaoutCallNative();var O=this._getWords();O?laya.html.dom.HTMLElement.fillWords(this,O,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},U.appendChild=function(U){return this.addChild(U)},U._getWords2=function(){var U=this._text.text;if(!U||0===U.length)return null;var F,O,P=0,Y=0;if(this._text.drawWords)O=this._text.drawWords;else{for(Y=(F=U.split(" ")).length-1,O=[],P=0;P<Y;P++)O.push(F[P]," ");0<=Y&&O.push(F[Y]),this._text.drawWords=O}var c,L=this._text.words;if(L&&L.length===O.length)return L;null===L&&(this._text.words=L=[]),L.length=O.length;var u=this.style,d=u.font;for(P=0,Y=O.length;P<Y;P++){c=h.measureText(O[P],d);var a=L[P]=new z(O[P],c.width,c.height||u.fontSize,u);if(1<a.char.length&&(a.charNum=a.char),this.href){var b=new w;this.addChild(b),a.setSprite(b)}}return L},U._getWords=function(){if(!G.CharacterCache)return this._getWords2();var U=this._text.text;if(!U||0===U.length)return null;var F,O=this._text.words;if(O&&O.length===U.length)return O;null===O&&(this._text.words=O=[]),O.length=U.length;for(var P=this.style,Y=P.font,c=0,L=U.length;c<L;c++)if(F=h.measureText(U.charAt(c),Y)){var u=O[c]=new z(U.charAt(c),F.width,F.height||P.fontSize,P);if(this.href){var d=new w;this.addChild(d),u.setSprite(d)}}else console.warn("_getWords size is null"+U.charAt(c),Y);return O},U.showLinkSprite=function(){var U=this._text.words;if(U)for(var F,O,P=[],Y=0;Y<U.length;Y++)O=U[Y],(F=new w).graphics.drawRect(0,0,O.width,O.height,"#ff0000"),F.width=O.width,F.height=O.height,this.addChild(F),P.push(F)},U._layoutLater=function(){var U=this.style;512&U._type||(U.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&U.block?(X.later(this),U._type|=512):this.parent&&this.parent._layoutLater())},U._setAttributes=function(U,F){switch(U){case"style":return void this.style.cssText(F);case"class":return void(this.className=F)}O.prototype._setAttributes.call(this,U,F)},U.updateHref=function(){if(null!=this._href){var U=this._getWords();if(U)for(var F,O,P=0;P<U.length;P++)(O=(F=U[P]).getSprite())&&(O.size(F.width,F.height),O.on("click",this,this.onLinkHandler))}},U.onLinkHandler=function(U){switch(U.type){case"click":for(var F=this;F;)F.event("link",[this.href]),F=F.parent}},U.formatURL=function(U){return this.URI?H.formatURL(U,this.URI?this.URI.path:null):U},u(0,U,"href",function(){return this._href},function(U){null!=(this._href=U)&&(this._getCSSStyle().underLine=1,this.updateHref())}),u(0,U,"color",null,function(U){this.style.color=U}),u(0,U,"onClick",null,function(U){P._runScript("fn=function(event){"+U+";}"),this.on("click",this,void 0)}),u(0,U,"id",null,function(U){K.document.setElementById(U,this)}),u(0,U,"innerTEXT",function(){return this._text.text},function(U){this.text=U}),u(0,U,"style",function(){return this._style}),u(0,U,"text",function(){return this._text.text},function(U){this._text==F._EMPTYTEXT?this._text={text:U,words:null}:(this._text.text=U,this._text.words&&(this._text.words.length=0)),J.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),u(0,U,"parent",O.prototype._$get_parent,function(U){if(U instanceof laya.html.dom.HTMLElement){var F=U;this.URI||(this.URI=F.URI),this.style.inherit(F.style)}P.superSet(w,this,"parent",U)}),u(0,U,"className",null,function(U){this.style.attrs(K.document.styleSheets["."+U])}),F.fillWords=function(U,F,O,P,Y,c,L){U.graphics.clear();for(var u=0,d=F.length;u<d;u++){var a=F[u];U.graphics.fillText(a.char,a.x+O,a.y+P,Y,c,"left",L)}},F._EMPTYTEXT={text:null,words:null},F}(w),F=(function(U){function F(){F.__super.call(this),this.style.lineElement=!0,this.style.block=!0}L(F,"laya.html.dom.HTMLBrElement",N)}(),function(U){function F(){this.contextHeight=NaN,this.contextWidth=NaN,F.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}L(F,"laya.html.dom.HTMLDivElement",U);var O=F.prototype;return O.appendHTML=function(U){Q.parse(this,U,this.URI),this.layout()},O._addChildsToLayout=function(F){var U=this._getWords();if(null==U&&0==this._childs.length)return!1;U&&U.forEach(function(U){F.push(U)});for(var O=!0,P=0,Y=this._childs.length;P<Y;P++){var c=this._childs[P];O?O=!1:F.push(null),c._addToLayout(F)}return!0},O._addToLayout=function(U){this.layout()},O.layout=function(){if(this.style){this.style._type|=512;var U=X.layout(this);if(U){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new b);var F=this._$P.mHtmlBounds;F.x=F.y=0,F.width=this.contextWidth=U[0],F.height=this.contextHeight=U[1],this.setBounds(F)}}},u(0,O,"height",function(){return this._height?this._height:this.contextHeight},U.prototype._$set_height),u(0,O,"innerHTML",null,function(U){this.destroyChildren(),this.appendHTML(U)}),u(0,O,"width",function(){return this._width?this._width:this.contextWidth},function(U){var F=!1;F=0===U?U!=this._width:U!=this.width,P.superSet(N,this,"width",U),F&&this.layout()}),F}(N)),K=function(U){function F(){this.all=new Array,this.styleSheets=d.styleSheets,F.__super.call(this)}L(F,"laya.html.dom.HTMLDocument",N);var O=F.prototype;return O.getElementById=function(U){return this.all[U]},O.setElementById=function(U,F){this.all[U]=F},Y(F,["document",function(){return this.document=new F}]),F}();(function(U){function F(){this._tex=null,this._url=null,this._renderArgs=[],F.__super.call(this),this.style.block=!0}L(F,"laya.html.dom.HTMLImageElement",N);var O=F.prototype;O._addToLayout=function(U){!this._style.absolute&&U.push(this)},O.render=function(U,F,O){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(x.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,U.ctx.drawTexture2(F,O,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},O.layaoutCallNative=function(){var U=0;if(this._childs&&0<(U=this._childs.length))for(var F=0;F<U;F++)this._childs[F].layaoutCallNative&&this._childs[F].layaoutCallNative()},u(0,O,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(U){this._width!==U&&(this._width=U,this._style.width=U,this.repaint())}),u(0,O,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(U){this._height!==U&&(this._height=U,this._style.height=U,this.repaint())}),O.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),a.clearCache(this,this._url),this._tex=null),N.prototype.destroy.call(this)},O.onloaded=function(){var U=this._style;U&&!U.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),U&&!U.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),J.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},O._loadImageComplete=function(U,F,O){if(!this._destroyed)if(null!=O)if(O instanceof ArrayBuffer){var P=new DataView(O);new laya.webgl.resource.WebGLImage(new Uint8Array(O,8),U,0,!1,P.getUint32(0),P.getUint32(4));this.onloaded()}else if(O instanceof r)a.imgMgrSet[U]=F,c.imgMgrLock(U,a.imgMgrSet[U]),this._url=U,this._tex=O,a.keepCache(this,U),a.cacheRes(U,this._tex),this.onloaded();else{var Y=-1!=U.indexOf(".png",U.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(O,U,Y,!1,O.width,O.height);this.onloaded()}else this.event("error","Load image failed")},u(0,O,"src",null,function(U){(U=this.formatURL(U),this._url!=U)&&(null!=this._tex&&(a.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=U,(this._tex=a.getRes(U))?(a.keepCache(this,U),this.onloaded()):c.imgMgrLoad(U,this._loadImageComplete.bind(this),2,!1))})})(),function(U){function F(){this.type=null,F.__super.call(this),this.visible=!1}L(F,"laya.html.dom.HTMLLinkElement",U);var O=F.prototype;O._onload=function(U){switch(this.type){case"text/css":d.parseCSS(U,this.URI)}},u(0,O,"href",U.prototype._$get_href,function(U){var F=this;U=this.formatURL(U),this.URI=new H(U);var O=new a;O.once("complete",null,function(U){F._onload(U)}),O.load(U,"text")}),F._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(N),function(U){function F(){F.__super.call(this),this.visible=!1}L(F,"laya.html.dom.HTMLStyleElement",U),u(0,F.prototype,"text",U.prototype._$get_text,function(U){d.parseCSS(U,null)})}(N),function(U){function F(){F.__super.call(this),this._getCSSStyle().valign="middle"}L(F,"laya.html.dom.HTMLIframeElement",U),u(0,F.prototype,"href",U.prototype._$get_href,function(O){var P=this;O=this.formatURL(O);var U=new a;U.once("complete",null,function(U){var F=P.URI;P.URI=new H(O),P.innerHTML=U,!F||(P.URI=F)}),U.load(O,"text")})}(F)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(U,F){"use strict";for(var O in Object.defineProperty(F,"__esModule",{value:!0}),Laya){var P=Laya[O];P&&P.__isclass&&(F[O]=P)}}),function(Y,U,x){x.un,x.uns;var P=x.static,c=x.class,L=x.getset,O=(x.__newvec,laya.display.Animation),r=(laya.utils.Browser,laya.utils.ClassUtils),u=laya.filters.ColorFilter,d=laya.utils.Ease,a=laya.events.Event,b=(laya.events.EventDispatcher,laya.display.css.Font),z=laya.display.FrameAnimation,F=laya.display.Graphics,J=laya.utils.Handler,w=laya.display.Input,h=laya.net.Loader,j=(laya.display.Node,laya.maths.Point),H=laya.maths.Rectangle,Q=laya.renders.Render,X=laya.display.Sprite,N=laya.display.Text,K=laya.resource.Texture,f=laya.utils.Tween,I=laya.utils.Utils,T=laya.utils.WeakObject;x.interface("laya.ui.IItem"),x.interface("laya.ui.ISelect"),x.interface("laya.ui.IRender"),x.interface("laya.ui.IComponent"),x.interface("laya.ui.IBox","IComponent");var g=function(){function U(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return c(U,"laya.ui.LayoutStyle"),P(U,["EMPTY",function(){return this.EMPTY=new U}]),U}(),l=function(){function U(){}return c(U,"laya.ui.Styles"),U.labelColor="#000000",U.buttonStateNum=3,U.scrollBarMinNum=15,U.scrollBarDelayTime=500,P(U,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),U}(),$=function(){function Y(){}return c(Y,"laya.ui.UIUtils"),Y.fillArray=function(U,F,O){var P=U.concat();if(F)for(var Y=F.split(","),c=0,L=Math.min(P.length,Y.length);c<L;c++){var u=Y[c];P[c]="true"==u||"false"!=u&&u,null!=O&&(P[c]=O(u))}return P},Y.toColor=function(U){return I.toHexColor(U)},Y.gray=function(U,F){void 0===F&&(F=!0),F?Y.addFilter(U,Y.grayFilter):Y.clearFilter(U,u)},Y.addFilter=function(U,F){var O=U.filters||[];O.push(F),U.filters=O},Y.clearFilter=function(U,F){var O=U.filters;if(null!=O&&0<O.length){for(var P=O.length-1;-1<P;P--){var Y=O[P];x.__typeof(Y,F)&&O.splice(P,1)}U.filters=O}},Y._getReplaceStr=function(U){return Y.escapeSequence[U]},Y.adptString=function(U){return U.replace(/\\(\w)/g,Y._getReplaceStr)},Y.getBindFun=function(U){var F=Y._funMap.get(U);if(null==F){var O='"'+U+'"',P="(function(data){if(data==null)return;with(data){try{\nreturn "+(O=O.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";F=x._runScript(P),Y._funMap.set(U,F)}return F},P(Y,["grayFilter",function(){return this.grayFilter=new u([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new T}]),Y}(),C=function(){function U(){}return c(U,"UIConfig"),U.touchScrollEnable=!0,U.mouseWheelEnable=!0,U.showButtons=!0,U.popupBgColor="#000000",U.popupBgAlpha=.5,U.closeDialogOnSide=!0,U}(),s=function(O){function H(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,H.__super.call(this),this._weakKeys=[]}c(H,"laya.ui.AutoBitmap",O);var U=H.prototype;return U.destroy=function(){if(h.clearObject(this,this._weakKey),this._weakKeys){for(var U=0,F=this._weakKeys.length;U<F;++U)h.clearObject(this,this._weakKeys[U]);this._weakKeys=null}O.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},U._setChanged=function(){this._isChanged||(this._isChanged=!0,x.timer.callLater(this,this.changeSource))},U.changeSource=function(){this._isChanged=!1;var U=this._source;if(U&&U.bitmap){var F=this.width,O=this.height,P=this._sizeGrid,Y=U.sourceWidth,c=U.sourceHeight;if(!P||Y===F&&c===O)this.cleanByTexture(U,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,F,O);else{h.clearObject(this,this._weakKey),U.$_GID||(U.$_GID=I.getGID());var L=U.$_GID+"."+F+"."+O+"."+P.join("."),u=h.findObject(L);if(I.isOKCmdList(u))return this._weakKey=L,h.keepObject(this,this._weakKey),void(this.cmds=u);this.clear();var d,a,b=P[0],z=P[1],J=P[2],w=P[3],j=P[4],x=!1;if(F==Y&&(w=z=0),O==c&&(b=J=0),F<w+z){var r=F;x=!0,F=w+z,this.save(),this.clipRect(0,0,r,O)}w&&b&&(d=H.getTexture(U,0,0,w,b),a=this._weakKeys[0],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[0]=d.weakKey),this.drawTexture(d,0,0,w,b)):(h.clearObject(this,a),this._weakKeys[0]="")),z&&b&&(d=H.getTexture(U,Y-z,0,z,b),a=this._weakKeys[1],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[1]=d.weakKey),this.drawTexture(d,F-z,0,z,b)):(h.clearObject(this,a),this._weakKeys[1]="")),w&&J&&(d=H.getTexture(U,0,c-J,w,J),a=this._weakKeys[2],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[2]=d.weakKey),this.drawTexture(d,0,O-J,w,J)):(h.clearObject(this,a),this._weakKeys[2]="")),z&&J&&(d=H.getTexture(U,Y-z,c-J,z,J),a=this._weakKeys[3],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[3]=d.weakKey),this.drawTexture(d,F-z,O-J,z,J)):(h.clearObject(this,a),this._weakKeys[3]="")),b&&(d=H.getTexture(U,w,0,Y-w-z,b),a=this._weakKeys[4],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[4]=d.weakKey),this.drawBitmap(j,d,w,0,F-w-z,b)):(h.clearObject(this,a),this._weakKeys[4]="")),J&&(d=H.getTexture(U,w,c-J,Y-w-z,J),a=this._weakKeys[5],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[5]=d.weakKey),this.drawBitmap(j,d,w,O-J,F-w-z,J)):(h.clearObject(this,a),this._weakKeys[5]="")),w&&(d=H.getTexture(U,0,b,w,c-b-J),a=this._weakKeys[6],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[6]=d.weakKey),this.drawBitmap(j,d,0,b,w,O-b-J)):(h.clearObject(this,a),this._weakKeys[6]="")),z&&(d=H.getTexture(U,Y-z,b,z,c-b-J),a=this._weakKeys[7],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[7]=d.weakKey),this.drawBitmap(j,d,F-z,b,z,O-b-J)):(h.clearObject(this,a),this._weakKeys[7]="")),d=H.getTexture(U,w,b,Y-w-z,c-b-J),a=this._weakKeys[8],d?(a!=d.weakKey&&(h.clearObject(this,a),h.keepObject(this,d.weakKey),this._weakKeys[8]=d.weakKey),this.drawBitmap(j,d,w,b,F-w-z,O-b-J)):(h.clearObject(this,a),this._weakKeys[8]=""),x&&this.restore(),this.autoCacheCmd&&!Q.isConchApp&&(h.saveObject(L,this.cmds,null),this._weakKey=L,h.keepObject(this,this._weakKey))}this._repaint()}},U.drawBitmap=function(U,F,O,P,Y,c){void 0===Y&&(Y=0),void 0===c&&(c=0),Y<.1||c<.1||(!U||F.width==Y&&F.height==c?this.drawTexture(F,O,P,Y,c):this.fillTexture(F,O,P,Y,c))},U.clear=function(U){void 0===U&&(U=!0),O.prototype.clear.call(this,!1)},L(0,U,"sizeGrid",function(){return this._sizeGrid},function(U){this._sizeGrid=U,this._setChanged()}),L(0,U,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(U){this._width!=U&&(this._width=U,this._setChanged())}),L(0,U,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(U){this._height!=U&&(this._height=U,this._setChanged())}),L(0,U,"source",function(){return this._source},function(U){U?(this._source=U,this._setChanged()):(this._source=null,this.clear())}),H.getTexture=function(U,F,O,P,Y){P<=0&&(P=1),Y<=0&&(Y=1),U.$_GID||(U.$_GID=I.getGID());var c=U.$_GID+"."+F+"."+O+"."+P+"."+Y,L=h.findObject(c);if((!L||!L.source)&&(L=K.createFromTexture(U,F,O,P,Y))){if(U.alphaTexture){var u=U.width/U.alphaTexture.width;L.alphaTexture=K.createFromTexture(U.alphaTexture,F/u,O/u,P/u,Y/u)}h.saveObject(c,L),L.weakKey=c}return L},H}(F),i=(function(U){function F(){F.__super.call(this)}c(F,"laya.ui.UIEvent",a),F.SHOW_TIP="showtip",F.HIDE_TIP="hidetip"}(),function(F){function U(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,U.__super.call(this),this._layout=g.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}c(U,"laya.ui.Component",F);var O=U.prototype;return x.imps(O,{"laya.ui.IComponent":!0}),O.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},O.preinitialize=function(){},O.createChildren=function(){},O.initialize=function(){},O.callLater=function(U,F){x.timer.callLater(this,U,F)},O.runCallLater=function(U){x.timer.runCallLater(this,U)},O.commitMeasure=function(){},O.changeSize=function(){this.event("resize")},O.getLayout=function(){return this._layout===g.EMPTY&&(this._layout=new g),this._layout},O._setLayoutEnabled=function(U){this._layout&&this._layout.enable!=U&&(this._layout.enable=U,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},O.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},O.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},O.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},O.resetLayoutX=function(){var U=this._layout;if(isNaN(U.anchorX)||(this.pivotX=U.anchorX*this.width),this.layoutEnabled){var F=this.parent;F&&(isNaN(U.centerX)?isNaN(U.left)?isNaN(U.right)||(this.x=Math.round(F.width-this.displayWidth-U.right+this.pivotX*this.scaleX)):(this.x=Math.round(U.left+this.pivotX*this.scaleX),isNaN(U.right)||(this.width=(F._width-U.left-U.right)/(this.scaleX||.01))):this.x=Math.round(.5*(F.width-this.displayWidth)+U.centerX+this.pivotX*this.scaleX))}},O.resetLayoutY=function(){var U=this._layout;if(isNaN(U.anchorY)||(this.pivotY=U.anchorY*this.height),this.layoutEnabled){var F=this.parent;F&&(isNaN(U.centerY)?isNaN(U.top)?isNaN(U.bottom)||(this.y=Math.round(F.height-this.displayHeight-U.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(U.top+this.pivotY*this.scaleY),isNaN(U.bottom)||(this.height=(F._height-U.top-U.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(F.height-this.displayHeight)+U.centerY+this.pivotY*this.scaleY))}},O.onMouseOver=function(U){x.stage.event("showtip",this._toolTip)},O.onMouseOut=function(U){x.stage.event("hidetip",this._toolTip)},L(0,O,"displayWidth",function(){return this.width*this.scaleX}),L(0,O,"width",function(){return this._width?this._width:this.measureWidth},function(U){this._width!=U&&(this._width=U,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),L(0,O,"measureWidth",function(){var U=0;this.commitMeasure();for(var F=this.numChildren-1;-1<F;F--){var O=this.getChildAt(F);O.visible&&(U=Math.max(O.x+O.width*O.scaleX,U))}return U}),L(0,O,"displayHeight",function(){return this.height*this.scaleY}),L(0,O,"height",function(){return this._height?this._height:this.measureHeight},function(U){this._height!=U&&(this._height=U,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),L(0,O,"dataSource",function(){return this._dataSource},function(U){for(var F in this._dataSource=U,this._dataSource)this.hasOwnProperty(F)&&"function"!=typeof this[F]&&(this[F]=this._dataSource[F])}),L(0,O,"scaleY",F.prototype._$get_scaleY,function(U){x.superGet(X,this,"scaleY")!=U&&(x.superSet(X,this,"scaleY",U),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),L(0,O,"measureHeight",function(){var U=0;this.commitMeasure();for(var F=this.numChildren-1;-1<F;F--){var O=this.getChildAt(F);O.visible&&(U=Math.max(O.y+O.height*O.scaleY,U))}return U}),L(0,O,"scaleX",F.prototype._$get_scaleX,function(U){x.superGet(X,this,"scaleX")!=U&&(x.superSet(X,this,"scaleX",U),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),L(0,O,"top",function(){return this._layout.top},function(U){U!=this._layout.top&&(this.getLayout().top=U,this._setLayoutEnabled(!0)),this.resetLayoutY()}),L(0,O,"bottom",function(){return this._layout.bottom},function(U){U!=this._layout.bottom&&(this.getLayout().bottom=U,this._setLayoutEnabled(!0)),this.resetLayoutY()}),L(0,O,"left",function(){return this._layout.left},function(U){U!=this._layout.left&&(this.getLayout().left=U,this._setLayoutEnabled(!0)),this.resetLayoutX()}),L(0,O,"right",function(){return this._layout.right},function(U){U!=this._layout.right&&(this.getLayout().right=U,this._setLayoutEnabled(!0)),this.resetLayoutX()}),L(0,O,"centerX",function(){return this._layout.centerX},function(U){U!=this._layout.centerX&&(this.getLayout().centerX=U,this._setLayoutEnabled(!0)),this.resetLayoutX()}),L(0,O,"centerY",function(){return this._layout.centerY},function(U){U!=this._layout.centerY&&(this.getLayout().centerY=U,this._setLayoutEnabled(!0)),this.resetLayoutY()}),L(0,O,"anchorX",function(){return this._layout.anchorX},function(U){U!=this._layout.anchorX&&(this.getLayout().anchorX=U,this._setLayoutEnabled(!0)),this.resetLayoutX()}),L(0,O,"anchorY",function(){return this._layout.anchorY},function(U){U!=this._layout.anchorY&&(this.getLayout().anchorY=U,this._setLayoutEnabled(!0)),this.resetLayoutY()}),L(0,O,"tag",function(){return this._tag},function(U){this._tag=U}),L(0,O,"toolTip",function(){return this._toolTip},function(U){this._toolTip!=U&&(null!=(this._toolTip=U)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),L(0,O,"comXml",function(){return this._comXml},function(U){this._comXml=U}),L(0,O,"gray",function(){return this._gray},function(U){U!==this._gray&&(this._gray=U,$.gray(this,U))}),L(0,O,"disabled",function(){return this._disabled},function(U){U!==this._disabled&&(this.gray=this._disabled=U,this.mouseEnabled=!U)}),U}(X)),y=function(U){function F(){this.lockLayer=null,this.popupEffect=function(U){U.scale(1,1),f.from(U,{x:x.stage.width/2,y:x.stage.height/2,scaleX:0,scaleY:0},300,d.backOut,J.create(this,this.doOpen,[U]))},this.closeEffect=function(U,F){f.to(U,{x:x.stage.width/2,y:x.stage.height/2,scaleX:0,scaleY:0},300,d.strongOut,J.create(this,this.doClose,[U,F]))},F.__super.call(this),this.maskLayer=new X,this.popupEffectHandler=J.create(this,this.popupEffect,null,!1),this.closeEffectHandler=J.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,x.stage.addChild(this),x.stage.on("resize",this,this._onResize),C.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}c(F,"laya.ui.DialogManager",X);var O=F.prototype;return O._closeOnSide=function(){var U=this.getChildAt(this.numChildren-1);U instanceof laya.ui.Dialog&&U.close("side")},O.setLockView=function(U){this.lockLayer||(this.lockLayer=new k,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(x.stage.width,x.stage.height)),this.lockLayer.removeChildren(),U&&(U.centerX=U.centerY=0,this.lockLayer.addChild(U))},O._onResize=function(U){var F=this.maskLayer.width=x.stage.width,O=this.maskLayer.height=x.stage.height;this.lockLayer&&this.lockLayer.size(F,O),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,F,O,C.popupBgColor),this.maskLayer.alpha=C.popupBgAlpha;for(var P=this.numChildren-1;-1<P;P--){var Y=this.getChildAt(P);Y.popupCenter&&this._centerDialog(Y)}},O._centerDialog=function(U){U.x=Math.round((x.stage.width-U.width>>1)+U.pivotX),U.y=Math.round((x.stage.height-U.height>>1)+U.pivotY)},O.open=function(U,F,O){void 0===F&&(F=!1),void 0===O&&(O=!1),F&&this._closeAll(),U.popupCenter&&this._centerDialog(U),this.addChild(U),(U.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),O&&null!=U.popupEffect?U.popupEffect.runWith(U):this.doOpen(U),this.event("open")},O.doOpen=function(U){U.onOpened()},O.lock=function(U){this.lockLayer&&(U?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},O.close=function(U,F,O){void 0===O&&(O=!1),O&&null!=U.closeEffect?U.closeEffect.runWith([U,F]):this.doClose(U,F),this.event("close")},O.doClose=function(U,F){U.removeSelf(),U.isModal&&this._checkMask(),U.closeHandler&&U.closeHandler.runWith(F),U.onClosed(F)},O.closeAll=function(){this._closeAll(),this.event("close")},O._closeAll=function(){for(var U=this.numChildren-1;-1<U;U--){var F=this.getChildAt(U);F&&null!=F.close&&this.doClose(F)}},O.getDialogsByGroup=function(U){for(var F=[],O=this.numChildren-1;-1<O;O--){var P=this.getChildAt(O);P&&P.group===U&&F.push(P)}return F},O.closeByGroup=function(U){for(var F=[],O=this.numChildren-1;-1<O;O--){var P=this.getChildAt(O);P&&P.group===U&&(P.close(),F.push(P))}return F},O._checkMask=function(){this.maskLayer.removeSelf();for(var U=this.numChildren-1;-1<U;U--){var F=this.getChildAt(U);if(F&&F.isModal)return void this.addChildAt(this.maskLayer,U)}},F}(),k=function(U){function F(){F.__super.call(this)}c(F,"laya.ui.Box",U);var O=F.prototype;return x.imps(O,{"laya.ui.IBox":!0}),L(0,O,"dataSource",U.prototype._$get_dataSource,function(U){for(var F in this._dataSource=U){var O=this.getChildByName(F);O?O.dataSource=U[F]:this.hasOwnProperty(F)&&"function"!=typeof this[F]&&(this[F]=U[F])}}),F}(i),A=function(F){function O(U,F){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,O.__super.call(this),this._labelColors=l.buttonLabelColors,this._stateNum=l.buttonStateNum,void 0===F&&(F=""),this.skin=U,this.label=F}c(O,"laya.ui.Button",F);var U=O.prototype;return x.imps(U,{"laya.ui.ISelect":!0}),U.destroy=function(U){this.clearEvent(),h.clearCache(this,this._skin),h.clearObject(this,this._weakKey),void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(U),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},U.clearEvent=function(){this._skin&&Y.atalsNotify&&Y.atalsNotify.off(this._skin,this,this._setBtnSource)},U.createChildren=function(){this.graphics=this._bitmap=new s},U.createText=function(){this._text||(this._text=new N,this._text.overflow=N.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},U.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},U.onMouse=function(U){if(!1!==this.toggle||!this._selected)return"click"===U.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=O.stateMap[U.type]))},U.changeClips=function(){var U=h.getRes(this._skin);if(U)if(this._skin&&""!=this._skin){h.clearObject(this,this._weakKey);var F=U.sourceWidth,O=U.sourceHeight/this._stateNum;U.$_GID||(U.$_GID=I.getGID());var P=U.$_GID+"-"+this._stateNum,Y=h.findObject(P);if(I.isOkTextureList(Y)||(Y=null),Y)this._weakKey=P,h.keepObject(this,this._weakKey),this._sources=Y;else{if(this._sources=[],1===this._stateNum)this._sources.push(U);else for(var c=0;c<this._stateNum;c++){var L=K.createFromTexture(U,0,O*c,F,O);if(U.alphaTexture){var u=U.width/U.alphaTexture.width;L.alphaTexture=K.createFromTexture(U.alphaTexture,0/u,O*c/u,F/u,O/u)}this._sources.push(L)}h.saveObject(P,this._sources),this._weakKey=P,h.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||F,this._bitmap.height=this._height||O,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=F)}else console.warn("lose skin ",this._skin,this.name,this.__className)},U.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var U=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[U]),this.label&&(this._text.color=this._labelColors[U],this._strokeColors&&(this._text.strokeColor=this._strokeColors[U]))},U._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},L(0,U,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(U){this.createText(),this._text.strokeColor=U}),L(0,U,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),L(0,U,"skin",function(){return this._skin},function(U){if(this._skin!=U)if(this.clearEvent(),h.clearCache(this,this._skin),this._skin=U,h.keepCache(this,this._skin),h.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var F=Y.resAtalsObj&&Y.resAtalsObj[this._skin];F?(Y.atalsNotify&&Y.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=F.sourceW),0==this.height&&(this.height=F.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),U._setBtnSource=function(U,F){U===this._skin&&F&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},L(0,U,"state",function(){return this._state},function(U){this._state!=U&&(this._state=U,this._setStateChanged())}),L(0,U,"text",function(){return this.createText(),this._text}),L(0,U,"stateNum",function(){return this._stateNum},function(U){"string"==typeof U&&(U=parseInt(U)),this._stateNum!=U&&(this._stateNum=U<1?1:3<U?3:U,this.callLater(this.changeClips))}),L(0,U,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(U){this._strokeColors=$.fillArray(l.buttonLabelColors,U,String),this._setStateChanged()}),L(0,U,"labelColors",function(){return this._labelColors.join(",")},function(U){this._labelColors=$.fillArray(l.buttonLabelColors,U,String),this._setStateChanged()}),L(0,U,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),L(0,U,"label",function(){return this._text?this._text.text:null},function(U){(this._text||U)&&(this.createText(),this._text.text!=U&&(U&&!this._text.parent&&this.addChild(this._text),this._text.text=(U+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),L(0,U,"selected",function(){return this._selected},function(U){this._selected!=U&&(this._selected=U,this.state=this._selected?2:0,this.event("change"))}),L(0,U,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(U){this.createText(),this._text.padding=$.fillArray(l.labelPadding,U,Number)}),L(0,U,"labelSize",function(){return this.createText(),this._text.fontSize},function(U){this.createText(),this._text.fontSize=U}),L(0,U,"labelStroke",function(){return this.createText(),this._text.stroke},function(U){this.createText(),this._text.stroke=U}),L(0,U,"labelBold",function(){return this.createText(),this._text.bold},function(U){this.createText(),this._text.bold=U}),L(0,U,"labelFont",function(){return this.createText(),this._text.font},function(U){this.createText(),this._text.font=U}),L(0,U,"labelAlign",function(){return this.createText(),this._text.align},function(U){this.createText(),this._text.align=U}),L(0,U,"clickHandler",function(){return this._clickHandler},function(U){this._clickHandler=U}),L(0,U,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(U){this._bitmap.sizeGrid=$.fillArray(l.defaultSizeGrid,U,Number)}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(i,this,"width",U),this._autoSize&&(this._bitmap.width=U,this._text&&(this._text.width=U))}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(i,this,"height",U),this._autoSize&&(this._bitmap.height=U,this._text&&(this._text.height=U))}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)||"string"==typeof U?this.label=U+"":x.superSet(i,this,"dataSource",U)}),L(0,U,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(U){this._bitmap._offset=U?$.fillArray([1,1],U,Number):[]}),P(O,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),O}(i),G=function(F){function P(U,F,O){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,P.__super.call(this),void 0===F&&(F=1),void 0===O&&(O=1),this._clipX=F,this._clipY=O,this.skin=U}c(P,"laya.ui.Clip",F);var U=P.prototype;return U.destroy=function(U){this.clearEvent(),this.clearLoad(),h.clearCache(this,this._skin),h.clearObject(this,this._weakKey),void 0===U&&(U=!0),F.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},U.dispose=function(){this.destroy(!0),x.loader.clearRes(this._skin)},U.createChildren=function(){this.graphics=this._bitmap=new s},U._onDisplay=function(U){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},U.changeClip=function(){if(this._clipChanged=!1,this._skin){var U=h.getRes(this._skin);if(U)this.loadComplete(this._skin,U);else{if(Y.resAtalsObj&&Y.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=J.create(this,this.loadComplete,[this._skin]),this._progress=null,x.loader.load(this._skin,this._complete,this._progress)}}},U.loadComplete=function(U,F){if(U===this._skin&&F){h.clearObject(this,this._weakKey);var O=this._clipWidth||Math.ceil(F.sourceWidth/this._clipX),P=this._clipHeight||Math.ceil(F.sourceHeight/this._clipY),Y=this._skin+O+P,c=h.findObject(Y);if(I.isOkTextureList(c)||(c=null),c)this._weakKey=Y,h.keepObject(this,this._weakKey),this._sources=c;else{this._sources=[];for(var L=0;L<this._clipY;L++)for(var u=0;u<this._clipX;u++){var d=K.createFromTexture(F,O*u,P*L,O,P);if(F.alphaTexture){var a=F.width/F.alphaTexture.width;d.alphaTexture=K.createFromTexture(F.alphaTexture,O*u/a,P*L/a,O/a,P/a)}this._sources.push(d)}h.saveObject(Y,this._sources),this._weakKey=Y,h.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},U.play=function(U,F){void 0===U&&(U=0),void 0===F&&(F=-1),this._isPlaying=!0,this.index=U,this._toIndex=F,this._index++,x.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},U._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},U.stop=function(){this._isPlaying=!1,x.timer.clear(this,this._loop),this.event("complete")},U._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},L(0,U,"interval",function(){return this._interval},function(U){this._interval!=U&&(this._interval=U,this._isPlaying&&this.play())}),U.clearEvent=function(){this._skin&&Y.atalsNotify&&Y.atalsNotify.off(this._skin,this,this._setBtnSource)},U.clearLoad=function(){this._skin&&((this._complete||this._progress)&&x.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},L(0,U,"skin",function(){return this._skin},function(U){if(this._skin!=U)if(this.clearLoad(),this.clearEvent(),h.clearCache(this,this._skin),this._skin=U){h.keepCache(this,this._skin);var F=h.getRes(U),O=Y.resAtalsObj&&Y.resAtalsObj[this._skin];!F&&O?Y.atalsNotify&&Y.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),U._setBtnSource=function(U,F){U===this._skin&&F&&(this.loadComplete(U,F),this.clearEvent())},L(0,U,"sources",function(){return this._sources},function(U){this._sources=U,this.index=this._index,this.event("loaded")}),L(0,U,"clipX",function(){return this._clipX},function(U){this._clipX=U||1,this._setClipChanged()}),L(0,U,"clipY",function(){return this._clipY},function(U){this._clipY=U||1,this._setClipChanged()}),L(0,U,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),L(0,U,"clipWidth",function(){return this._clipWidth},function(U){this._clipWidth=U,this._setClipChanged()}),L(0,U,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(U){this._bitmap.sizeGrid=$.fillArray(l.defaultSizeGrid,U,Number)}),L(0,U,"group",function(){return this._group},function(U){U&&this._skin&&h.setGroup(this._skin,U),this._group=U}),L(0,U,"clipHeight",function(){return this._clipHeight},function(U){this._clipHeight=U,this._setClipChanged()}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(i,this,"width",U),this._bitmap.width=U}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(i,this,"height",U),this._bitmap.height=U}),L(0,U,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),L(0,U,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),L(0,U,"index",function(){return this._index},function(U){this._index=U,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[U]),this.event("change")}),L(0,U,"autoPlay",function(){return this._autoPlay},function(U){this._autoPlay!=U&&((this._autoPlay=U)?this.play():this.stop())}),L(0,U,"isPlaying",function(){return this._isPlaying},function(U){this._isPlaying=U}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)&&Math.floor(U)==U||"string"==typeof U?this.index=parseInt(U):x.superSet(i,this,"dataSource",U)}),L(0,U,"bitmap",function(){return this._bitmap}),P}(i),V=function(F){function U(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,U.__super.call(this)}c(U,"laya.ui.ColorPicker",F);var O=U.prototype;return O.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._colorPanel&&this._colorPanel.destroy(U),this._colorButton&&this._colorButton.destroy(U),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},O.createChildren=function(){this.addChild(this._colorButton=new A),this._colorPanel=new k,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new X),this._colorPanel.addChild(this._colorBlock=new X),this._colorPanel.addChild(this._colorInput=new w)},O.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},O.onPanelMouseDown=function(U){U.stopPropagation()},O.changePanel=function(){this._panelChanged=!1;var U=this._colorPanel.graphics;U.clear(),U.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(U=this._colorTiles.graphics).clear();for(var F=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],O=0;O<12;O++)for(var P=0;P<20;P++){var Y=0;Y=0===P?F[O]:1===P?0:51*(((3*O+P/6)%3<<0)+3*(O/6<<0))<<16|P%6*51<<8|(O<<0)%6*51;var c=$.toColor(Y);this._colors.push(c);var L=P*this._gridSize,u=O*this._gridSize;U.drawRect(L,u,this._gridSize,this._gridSize,c,"#000000")}},O.onColorButtonClick=function(U){this._colorPanel.parent?this.close():this.open()},O.open=function(){var U=this.localToGlobal(new j),F=U.x+this._colorPanel.width<=x.stage.width?U.x:x.stage.width-this._colorPanel.width,O=U.y+this._colorButton.height;O=O+this._colorPanel.height<=x.stage.height?O:U.y-this._colorPanel.height,this._colorPanel.pos(F,O),this._colorPanel.zOrder=1001,x._currentStage.addChild(this._colorPanel),x.stage.on("mousedown",this,this.removeColorBox)},O.close=function(){x.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},O.removeColorBox=function(U){this.close()},O.onColorFieldKeyDown=function(U){13==U.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),U.stopPropagation())},O.onColorInputChange=function(U){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},O.onColorTilesClick=function(U){this.selectedColor=this.getColorByMouse(),this.close()},O.onColorTilesMouseMove=function(U){this._colorInput.focus=!1;var F=this.getColorByMouse();this._colorInput.text=F,this.drawBlock(F)},O.getColorByMouse=function(){var U=this._colorTiles.getMousePoint(),F=Math.floor(U.x/this._gridSize),O=Math.floor(U.y/this._gridSize);return this._colors[20*O+F]},O.drawBlock=function(U){var F=this._colorBlock.graphics;F.clear();var O=U||"#ffffff";F.drawRect(0,0,50,20,O,this._borderColor),U||F.drawLine(0,0,50,20,"#ff0000")},O.changeColor=function(){var U=this.graphics;U.clear();var F=this._selectedColor||"#000000";U.drawRect(0,0,this._colorButton.width,this._colorButton.height,F)},O._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},L(0,O,"inputBgColor",function(){return this._inputBgColor},function(U){this._inputBgColor=U,this._setPanelChanged()}),L(0,O,"selectedColor",function(){return this._selectedColor},function(U){this._selectedColor!=U&&(this._selectedColor=this._colorInput.text=U,this.drawBlock(U),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",a.EMPTY.setTo("change",this,this)))}),L(0,O,"skin",function(){return this._colorButton.skin},function(U){this._colorButton.skin=U,this.changeColor()}),L(0,O,"bgColor",function(){return this._bgColor},function(U){this._bgColor=U,this._setPanelChanged()}),L(0,O,"borderColor",function(){return this._borderColor},function(U){this._borderColor=U,this._setPanelChanged()}),L(0,O,"inputColor",function(){return this._inputColor},function(U){this._inputColor=U,this._setPanelChanged()}),U}(i),M=function(F){function O(U,F){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,O.__super.call(this),this._itemColors=l.comboBoxItemColors,this.skin=U,this.labels=F}c(O,"laya.ui.ComboBox",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._button&&this._button.destroy(U),this._list&&this._list.destroy(U),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},U.createChildren=function(){this.addChild(this._button=new A),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},U._createList=function(){this._list=new v,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},U._setListEvent=function(U){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=J.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},U.onListDown=function(U){U.stopPropagation()},U.onScrollBarDown=function(U){U.stopPropagation()},U.onButtonMouseDown=function(U){this.callLater(this.switchTo,[!this._isOpen])},U.changeList=function(){this._listChanged=!1;var U=this.width-2,F=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:U,height:this._itemHeight,fontSize:this._itemSize,color:F}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},U.onlistItemMouse=function(U,F){var O=U.type;if("mouseover"===O||"mouseout"===O){if(this._isCustomList)return;var P=this._list.getCell(F);if(!P)return;var Y=P.getChildByName("label");Y&&("mouseover"===O?(Y.bgColor=this._itemColors[0],Y.color=this._itemColors[1]):(Y.bgColor=null,Y.color=this._itemColors[2]))}else"click"===O&&(this.selectedIndex=F,this.isOpen=!1)},U.switchTo=function(U){this.isOpen=U},U.changeOpen=function(){this.isOpen=!this._isOpen},U.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var U=this._list.graphics;U.clear(),U.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var F=this._list.array||[],O=F.length=0,P=this._labels.length;O<P;O++)F.push({label:this._labels[O]});this._list.height=this._listHeight,this._list.array=F},U.changeSelected=function(){this._button.label=this.selectedLabel},U._onStageMouseWheel=function(U){this._list&&!this._list.contains(U.target)&&this.removeList(null)},U.removeList=function(U){x.stage.off("mousedown",this,this.removeList),x.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},L(0,U,"selectedIndex",function(){return this._selectedIndex},function(U){this._selectedIndex!=U&&(this._selectedIndex=U,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[a.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),L(0,U,"measureHeight",function(){return this._button.height}),L(0,U,"skin",function(){return this._button.skin},function(U){this._button.skin!=U&&(this._button.skin=U,this._listChanged=!0)}),L(0,U,"measureWidth",function(){return this._button.width}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(i,this,"width",U),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),L(0,U,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(U){this.selectedIndex=this._labels.indexOf(U)}),L(0,U,"labels",function(){return this._labels.join(",")},function(U){0<this._labels.length&&(this.selectedIndex=-1),U?this._labels=U.split(","):this._labels.length=0,this._itemChanged=!0}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(i,this,"height",U),this._button.height=this._height}),L(0,U,"selectHandler",function(){return this._selectHandler},function(U){this._selectHandler=U}),L(0,U,"visibleNum",function(){return this._visibleNum},function(U){this._visibleNum=U,this._listChanged=!0}),L(0,U,"labelBold",function(){return this._button.text.bold},function(U){this._button.text.bold=U}),L(0,U,"itemColors",function(){return String(this._itemColors)},function(U){this._itemColors=$.fillArray(this._itemColors,U,String),this._listChanged=!0}),L(0,U,"itemSize",function(){return this._itemSize},function(U){this._itemSize=U,this._listChanged=!0}),L(0,U,"scrollBar",function(){return this.list.scrollBar}),L(0,U,"isOpen",function(){return this._isOpen},function(U){if(this._isOpen!=U)if(this._isOpen=U,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var F=this.localToGlobal(j.TEMP.setTo(0,0)),O=F.y+this._button.height;O=O+this._listHeight<=x.stage.height?O:F.y-this._listHeight,this._list.pos(F.x,O),this._list.zOrder=1001,x._currentStage.addChild(this._list),x.stage.once("mousedown",this,this.removeList),x.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),L(0,U,"scrollBarSkin",function(){return this._scrollBarSkin},function(U){this._scrollBarSkin=U}),L(0,U,"sizeGrid",function(){return this._button.sizeGrid},function(U){this._button.sizeGrid=U}),L(0,U,"button",function(){return this._button}),L(0,U,"list",function(){return this._list||this._createList(),this._list},function(U){U&&(U.removeSelf(),this._isCustomList=!0,this._list=U,this._setListEvent(U),this._itemHeight=U.getCell(0).height+U.spaceY)}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)&&Math.floor(U)==U||"string"==typeof U?this.selectedIndex=parseInt(U):U instanceof Array?this.labels=U.join(","):x.superSet(i,this,"dataSource",U)}),L(0,U,"labelColors",function(){return this._button.labelColors},function(U){this._button.labelColors!=U&&(this._button.labelColors=U)}),L(0,U,"labelPadding",function(){return this._button.text.padding.join(",")},function(U){this._button.text.padding=$.fillArray(l.labelPadding,U,Number)}),L(0,U,"labelSize",function(){return this._button.text.fontSize},function(U){this._button.text.fontSize=U}),L(0,U,"labelFont",function(){return this._button.text.font},function(U){this._button.text.font=U}),L(0,U,"stateNum",function(){return this._button.stateNum},function(U){this._button.stateNum=U}),O}(i),m=function(F){function O(U){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,O.__super.call(this),this._showButtons=C.showButtons,this._touchScrollEnable=C.touchScrollEnable,this._mouseWheelEnable=C.mouseWheelEnable,this.skin=U,this.max=1}c(O,"laya.ui.ScrollBar",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),this.stopScroll(),this.target=null,F.prototype.destroy.call(this,U),this.upButton&&this.upButton.destroy(U),this.downButton&&this.downButton.destroy(U),this.slider&&this.slider.destroy(U),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},U.createChildren=function(){this.addChild(this.slider=new p),this.addChild(this.upButton=new A),this.addChild(this.downButton=new A)},U.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},U.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},U.onButtonMouseDown=function(U){var F=U.currentTarget===this.upButton;this.slide(F),x.timer.once(l.scrollBarDelayTime,this,this.startLoop,[F]),x.stage.once("mouseup",this,this.onStageMouseUp)},U.startLoop=function(U){x.timer.frameLoop(1,this,this.slide,[U])},U.slide=function(U){U?this.value-=this._scrollSize:this.value+=this._scrollSize},U.onStageMouseUp=function(U){x.timer.clear(this,this.startLoop),x.timer.clear(this,this.slide)},U.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},U.changeSize=function(){F.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},U.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},U.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},U.setScroll=function(U,F,O){this.runCallLater(this.changeSize),this.slider.setSlider(U,F,O),this.slider.bar.visible=0<F,!this._hide&&this.autoHide&&(this.visible=!1)},U.onTargetMouseWheel=function(U){this.value-=U.delta*this._scrollSize,this.target=this._target},U.onTargetMouseDown=function(U){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new j),this._lastPoint.setTo(x.stage.mouseX,x.stage.mouseY),x.timer.clear(this,this.tweenMove),f.clearTween(this),x.stage.once("mouseup",this,this.onStageMouseUp2),x.stage.once("mouseout",this,this.onStageMouseUp2),x.timer.frameLoop(1,this,this.loop)},U.loop=function(){var U=x.stage.mouseY,F=x.stage.mouseX;if(this._lastOffset=this.isVertical?U-this._lastPoint.y:F-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?x.stage._canvasTransform.getScaleY():x.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=F,this._lastPoint.y=U,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},U.onStageMouseUp2=function(U){if(x.stage.off("mouseup",this,this.onStageMouseUp2),x.stage.off("mouseout",this,this.onStageMouseUp2),x.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?f.to(this,{value:this.min},this.elasticBackTime,d.sineOut,J.create(this,this.elasticOver)):this._value>this.max&&f.to(this,{value:this.max},this.elasticBackTime,d.sineOut,J.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?x.stage.mouseY-this._lastPoint.y:x.stage.mouseX-this._lastPoint.x);for(var F=0,O=Math.min(this._offsets.length,3),P=0;P<O;P++)F+=this._offsets[this._offsets.length-1-P];if(this._lastOffset=F/O,(F=Math.abs(this._lastOffset))<2)return void this.event("end");60<F&&(this._lastOffset=0<this._lastOffset?60:-60);var Y=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));x.timer.frameLoop(1,this,this.tweenMove,[Y])}},U.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&f.to(this,{alpha:0},500),this.event("end")},U.tweenMove=function(U){this._lastOffset*=this.rollRatio;var F=NaN;if(0<U&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,F=.5*-(this.min-U-this.value),this._lastOffset>F&&(this._lastOffset=F)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,F=.5*-(this.max+U-this.value),this._lastOffset<F&&(this._lastOffset=F))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(x.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?f.to(this,{value:this.min},this.elasticBackTime,d.sineOut,J.create(this,this.elasticOver)):this._value>this.max?f.to(this,{value:this.max},this.elasticBackTime,d.sineOut,J.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&f.to(this,{alpha:0},500)}},U.stopScroll=function(){this.onStageMouseUp2(null),x.timer.clear(this,this.tweenMove),f.clearTween(this)},L(0,U,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),L(0,U,"skin",function(){return this._skin},function(U){this._skin!=U&&(this._skin=U,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),L(0,U,"max",function(){return this.slider.max},function(U){this.slider.max=U}),L(0,U,"showButtons",function(){return this._showButtons},function(U){this._showButtons=U,this.callLater(this.changeScrollBar)}),L(0,U,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),L(0,U,"min",function(){return this.slider.min},function(U){this.slider.min=U}),L(0,U,"value",function(){return this._value},function(U){U!==this._value&&(this._value=U,this._isElastic||(this.slider._value!=U&&(this.slider._value=U,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),L(0,U,"isVertical",function(){return this.slider.isVertical},function(U){this.slider.isVertical=U}),L(0,U,"sizeGrid",function(){return this.slider.sizeGrid},function(U){this.slider.sizeGrid=U}),L(0,U,"scrollSize",function(){return this._scrollSize},function(U){this._scrollSize=U}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)||"string"==typeof U?this.value=Number(U):x.superSet(i,this,"dataSource",U)}),L(0,U,"thumbPercent",function(){return this._thumbPercent},function(U){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),U=1<=U?.99:U,this._thumbPercent=U,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*U,l.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*U,l.scrollBarMinNum))}),L(0,U,"target",function(){return this._target},function(U){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=U)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),L(0,U,"hide",function(){return this._hide},function(U){this._hide=U,this.visible=!U}),L(0,U,"touchScrollEnable",function(){return this._touchScrollEnable},function(U){this._touchScrollEnable=U,this.target=this._target}),L(0,U,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(U){this._mouseWheelEnable=U,this.target=this._target}),L(0,U,"tick",function(){return this.slider.tick},function(U){this.slider.tick=U}),O}(i),p=function(F){function O(U){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,O.__super.call(this),this.skin=U}c(O,"laya.ui.Slider",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._bg&&this._bg.destroy(U),this._bar&&this._bar.destroy(U),this._progress&&this._progress.destroy(U),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},U.createChildren=function(){this.addChild(this._bg=new o),this.addChild(this._bar=new A)},U.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},U.onBarMouseDown=function(U){this._globalSacle||(this._globalSacle=new j),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=x.stage.mouseX,this._ty=x.stage.mouseY,x.stage.on("mousemove",this,this.mouseMove),x.stage.once("mouseup",this,this.mouseUp),x.stage.once("mouseout",this,this.mouseUp),this.showValueText()},U.showValueText=function(){if(this.showLabel){var U=laya.ui.Slider.label;this.addChild(U),U.textField.changeText(this._value+""),this.isVertical?(U.x=this._bar.x+20,U.y=.5*(this._bar.height-U.height)+this._bar.y):(U.y=this._bar.y-20,U.x=.5*(this._bar.width-U.width)+this._bar.x)}},U.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},U.mouseUp=function(U){x.stage.off("mousemove",this,this.mouseMove),x.stage.off("mouseup",this,this.mouseUp),x.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},U.mouseMove=function(U){var F=this._value;this.isVertical?(this._bar.y+=(x.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(x.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=x.stage.mouseX,this._ty=x.stage.mouseY;var O=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*O)/O,this._value!=F&&this.sendChangeEvent(),this.showValueText()},U.sendChangeEvent=function(U){void 0===U&&(U="change"),this.event(U),this.changeHandler&&this.changeHandler.runWith(this._value)},U.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},U.changeSize=function(){F.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},U.setSlider=function(U,F,O){this._value=-1,this._min=U,this._max=U<F?F:U,this.value=O<U?U:F<O?F:O},U.changeValue=function(){var U=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*U)/U,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var F=this._max-this._min;0===F&&(F=1),this.isVertical?(this._bar.y=(this._value-this._min)/F*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/F*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},U.onBgMouseDown=function(U){var F=this._bg.getMousePoint();this.isVertical?this.value=F.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=F.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},L(0,U,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),L(0,U,"skin",function(){return this._skin},function(U){if(this._skin!=U){this._skin=U,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var F=this._skin.replace(".png","$progress.png");h.getRes(F)&&(this._progress||(this.addChild(this._progress=new o),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=F),this.setBarPoint(),this.callLater(this.changeValue)}}),L(0,U,"allowClickBack",function(){return this._allowClickBack},function(U){this._allowClickBack!=U&&((this._allowClickBack=U)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),L(0,U,"max",function(){return this._max},function(U){this._max!=U&&(this._max=U,this.callLater(this.changeValue))}),L(0,U,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),L(0,U,"tick",function(){return this._tick},function(U){this._tick!=U&&(this._tick=U,this.callLater(this.changeValue))}),L(0,U,"sizeGrid",function(){return this._bg.sizeGrid},function(U){this._bg.sizeGrid=U,this._bar.sizeGrid=U,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),L(0,U,"min",function(){return this._min},function(U){this._min!=U&&(this._min=U,this.callLater(this.changeValue))}),L(0,U,"value",function(){return this._value},function(U){if(this._value!=U){var F=this._value;this._value=U,this.changeValue(),this._value!=F&&this.sendChangeEvent()}}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)||"string"==typeof U?this.value=Number(U):x.superSet(i,this,"dataSource",U)}),L(0,U,"bar",function(){return this._bar}),P(O,["label",function(){return this.label=new R}]),O}(i),o=function(F){function O(U){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,O.__super.call(this),this.skin=U}c(O,"laya.ui.Image",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,h.clearCache(this,this._skin)},U.dispose=function(){this.destroy(!0),h.clearCache(this,this._skin),this.clearEvent()},U.createChildren=function(){this.graphics=this._bitmap=new s},U.setSource=function(U,F){this.destroyed||U===this._skin&&F&&(this.source=F,this.onCompResize(),this.clearEvent())},U.clearEvent=function(){this._skin&&Y.atalsNotify&&Y.atalsNotify.off(this._skin,this,this.setSource)},U.clearLoad=function(){this._skin&&((this._complete||this._progress)&&x.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},L(0,U,"source",function(){return this._bitmap.source},function(U){this._bitmap&&(this._bitmap.source=U,this.event("loaded"),this.repaint())}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"string"==typeof(this._dataSource=U)?this.skin=U:x.superSet(i,this,"dataSource",U)}),L(0,U,"measureHeight",function(){return this._bitmap.height}),L(0,U,"skin",function(){return this._skin},function(U){if(this._skin!=U)if(h.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=U){h.keepCache(this,this._skin);var F=h.getRes(U),O=Y.resAtalsObj&&Y.resAtalsObj[this._skin];F?(this.source=F,this.onCompResize()):O?(Y.atalsNotify&&Y.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=O.sourceW),0==this.height&&(this.height=O.sourceH)):(this._complete=J.create(this,this.setSource,[this._skin]),this._progress=null,x.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),L(0,U,"group",function(){return this._group},function(U){U&&this._skin&&h.setGroup(this._skin,U),this._group=U}),L(0,U,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(U){this._bitmap.sizeGrid=$.fillArray(l.defaultSizeGrid,U,Number)}),L(0,U,"measureWidth",function(){return this._bitmap.width}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(i,this,"width",U),this._bitmap.width=0==U?1e-7:U}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(i,this,"height",U),this._bitmap.height=0==U?1e-7:U}),O}(i),R=function(F){function O(U){this._tf=null,O.__super.call(this),void 0===U&&(U=""),b.defaultColor=l.labelColor,this.text=U}c(O,"laya.ui.Label",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._tf=null},U.createChildren=function(){this.addChild(this._tf=new N)},U.changeText=function(U){this._tf.changeText(U)},L(0,U,"padding",function(){return this._tf.padding.join(",")},function(U){this._tf.padding=$.fillArray(l.labelPadding,U,Number)}),L(0,U,"bold",function(){return this._tf.bold},function(U){this._tf.bold=U}),L(0,U,"align",function(){return this._tf.align},function(U){this._tf.align=U}),L(0,U,"text",function(){return this._tf.text},function(U){this._tf.text!=U&&(U&&(U=$.adptString(U+"")),this._tf.text=U,this.event("change"),this._width&&this._height||this.onCompResize())}),L(0,U,"italic",function(){return this._tf.italic},function(U){this._tf.italic=U}),L(0,U,"wordWrap",function(){return this._tf.wordWrap},function(U){this._tf.wordWrap=U}),L(0,U,"font",function(){return this._tf.font},function(U){this._tf.font=U}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)||"string"==typeof U?this.text=U+"":x.superSet(i,this,"dataSource",U)}),L(0,U,"color",function(){return this._tf.color},function(U){this._tf.color=U}),L(0,U,"valign",function(){return this._tf.valign},function(U){this._tf.valign=U}),L(0,U,"leading",function(){return this._tf.leading},function(U){this._tf.leading=U}),L(0,U,"fontSize",function(){return this._tf.fontSize},function(U){this._tf.fontSize=U}),L(0,U,"bgColor",function(){return this._tf.bgColor},function(U){this._tf.bgColor=U}),L(0,U,"borderColor",function(){return this._tf.borderColor},function(U){this._tf.borderColor=U}),L(0,U,"stroke",function(){return this._tf.stroke},function(U){this._tf.stroke=U}),L(0,U,"strokeColor",function(){return this._tf.strokeColor},function(U){this._tf.strokeColor=U}),L(0,U,"textField",function(){return this._tf}),L(0,U,"measureWidth",function(){return this._tf.width}),L(0,U,"measureHeight",function(){return this._tf.height}),L(0,U,"width",function(){return this._width||this._tf.text?x.superGet(i,this,"width"):0},function(U){x.superSet(i,this,"width",U),this._tf.width=U}),L(0,U,"height",function(){return this._height||this._tf.text?x.superGet(i,this,"height"):0},function(U){x.superSet(i,this,"height",U),this._tf.height=U}),L(0,U,"overflow",function(){return this._tf.overflow},function(U){this._tf.overflow=U}),L(0,U,"underline",function(){return this._tf.underline},function(U){this._tf.underline=U}),L(0,U,"underlineColor",function(){return this._tf.underlineColor},function(U){this._tf.underlineColor=U}),O}(i),_=function(F){function O(U){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,O.__super.call(this),this.skin=U}c(O,"laya.ui.ProgressBar",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._bg&&this._bg.destroy(U),this._bar&&this._bar.destroy(U),this._bg=this._bar=null,this.changeHandler=null},U.createChildren=function(){this.addChild(this._bg=new o),this.addChild(this._bar=new o)},U.changeValue=function(){if(this.sizeGrid){var U=this.sizeGrid.split(","),F=Number(U[3]),O=Number(U[1]),P=(this.width-F-O)*this._value;this._bar.width=F+O+P,this._bar.visible=this._bar.width>F+O}else this._bar.width=this.width*this._value},L(0,U,"measureHeight",function(){return this._bg.height}),L(0,U,"skin",function(){return this._skin},function(U){this._skin!=U&&(this._skin=U,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),L(0,U,"measureWidth",function(){return this._bg.width}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(i,this,"height",U),this._bg.height=this._height,this._bar.height=this._height}),L(0,U,"bar",function(){return this._bar}),L(0,U,"value",function(){return this._value},function(U){this._value!=U&&(U=1<U?1:U<0?0:U,this._value=U,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(U))}),L(0,U,"bg",function(){return this._bg}),L(0,U,"sizeGrid",function(){return this._bg.sizeGrid},function(U){this._bg.sizeGrid=this._bar.sizeGrid=U}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(i,this,"width",U),this._bg.width=this._width,this.callLater(this.changeValue)}),L(0,U,"dataSource",F.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)||"string"==typeof U?this.value=Number(U):x.superSet(i,this,"dataSource",U)}),O}(i),q=(function(U){function O(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,O.__super.call(this),this._tipBox=new i,this._tipBox.addChild(this._tipText=new N),this._tipText.x=this._tipText.y=5,this._tipText.color=O.tipTextColor,this._defaultTipHandler=this._showDefaultTip,x.stage.on("showtip",this,this._onStageShowTip),x.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}c(O,"laya.ui.TipManager",i);var F=O.prototype;F._onStageHideTip=function(U){x.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},F._onStageShowTip=function(U){x.timer.once(O.tipDelay,this,this._showTip,[U],!0)},F._showTip=function(U){if("string"==typeof U){var F=String(U);Boolean(F)&&this._defaultTipHandler(F)}else U instanceof laya.utils.Handler?U.run():"function"==typeof U&&U.apply();x.stage.on("mousemove",this,this._onStageMouseMove),x.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},F._onStageMouseDown=function(U){this.closeAll()},F._onStageMouseMove=function(U){this._showToStage(this,O.offsetX,O.offsetY)},F._showToStage=function(U,F,O){void 0===F&&(F=0),void 0===O&&(O=0);var P=U.getBounds();U.x=x.stage.mouseX+F,U.y=x.stage.mouseY+O,U.x+P.width>x.stage.width&&(U.x-=P.width+F),U.y+P.height>x.stage.height&&(U.y-=P.height+O)},F.closeAll=function(){x.timer.clear(this,this._showTip),x.stage.off("mousemove",this,this._onStageMouseMove),x.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},F.showDislayTip=function(U){this.addChild(U),this._showToStage(this),x._currentStage.addChild(this)},F._showDefaultTip=function(U){this._tipText.text=U;var F=this._tipBox.graphics;F.clear(),F.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,O.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),x._currentStage.addChild(this)},L(0,F,"defaultTipHandler",function(){return this._defaultTipHandler},function(U){this._defaultTipHandler=U}),O.offsetX=10,O.offsetY=15,O.tipTextColor="#ffffff",O.tipBackColor="#111111",O.tipDelay=200}(),function(U){var w;function j(){this._idMap=null,this._aniList=null,this._watchMap={},j.__super.call(this)}c(j,"laya.ui.View",k);var F=j.prototype;return F.createView=function(U){if(U.animations&&!this._idMap&&(this._idMap={}),j.createComp(U,this,this),U.animations){var F,O,P=[],Y=U.animations,c=0,L=Y.length;for(c=0;c<L;c++){switch(F=new z,O=Y[c],F._setUp(this._idMap,O),(this[O.name]=F)._setControlNode(this),O.action){case 1:F.play(0,!1);break;case 2:F.play(0,!0)}P.push(F)}this._aniList=P}0<this._width&&null==U.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},F.onEvent=function(U,F){},F.loadUI=function(U){var F=j.uiMap[U];F&&this.createView(F)},F.destroy=function(U){void 0===U&&(U=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,U)},F.changeData=function(U){var F=this._watchMap[U];if(F){console.log("change",U);for(var O=0,P=F.length;O<P;O++){F[O].exe(this)}}},j._regs=function(){for(var U in j.uiClassMap)r.regClass(U,j.uiClassMap[U])},j.createComp=function(U,F,O,P){if(!(F=F||j.getCompInstance(U)))return console.warn("can not create:"+U.type),null;var Y=U.child;if(Y)for(var c=F instanceof laya.ui.List,L=0,u=Y.length;L<u;L++){var d=Y[L];if(!F.hasOwnProperty("itemRender")||"render"!=d.props.name&&"render"!==d.props.renderType)if("Graphic"==d.type)r.addGraphicsToSprite(d,F);else if(r.isDrawType(d.type))r.addGraphicToSprite(d,F,!0);else{if(c){var a=[],b=j.createComp(d,null,O,a);a.length&&(b._$bindData=a)}else b=j.createComp(d,null,O,P);"Script"==d.type?"owner"in b?b.owner=F:"target"in b&&(b.target=F):"mask"==d.props.renderType||"mask"==d.props.name?F.mask=b:b instanceof laya.display.Sprite&&F.addChild(b)}else F.itemRender=d}var z=U.props;for(var J in z){var w=z[J];j.eventDic[J]?w&&O&&F.on(J,O,O.onEvent,[w]):j.setCompValue(F,J,w,O,P)}return x.__typeof(F,"laya.ui.IItem")&&F.initItems(),U.compId&&O&&O._idMap&&(O._idMap[U.compId]=F),F},j.setCompValue=function(U,F,O,P,Y){if("string"==typeof O&&-1<O.indexOf("${")){if(j._sheet||(j._sheet=r.getClass("laya.data.Table")),!j._sheet)return void console.warn("Can not find class Sheet");if(Y)Y.push(U,F,O);else if(P){-1==O.indexOf("].")&&(O=O.replace(".","[0]."));var c,L,u=new w(U,F,O);u.exe(P);for(var d=O.replace(/\[.*?\]\./g,".");null!=(c=j._parseWatchData.exec(d));){for(var a=c[1];null!=(L=j._parseKeyWord.exec(a));){var b=L[0],z=P._watchMap[b]||(P._watchMap[b]=[]);z.push(u),j._sheet.I.notifer.on(b,P,P.changeData,[b])}(z=P._watchMap[a]||(P._watchMap[a]=[])).push(u),j._sheet.I.notifer.on(a,P,P.changeData,[a])}}}else if("var"===F&&P)P[O]=U;else if("onClick"==F){var J=x._runScript("(function(){"+O+"})");U.on("click",P,J)}else U[F]="true"===O||"false"!==O&&O},j.getCompInstance=function(U){var F,O=U.props?U.props.runtime:null;return F=O?j.viewClassMap[O]||j.uiClassMap[O]||x.__classmap[O]:j.uiClassMap[U.type],U.props&&U.props.hasOwnProperty("renderType")&&"instance"==U.props.renderType?F.instance:F?new F:null},j.regComponent=function(U,F){j.uiClassMap[U]=F,r.regClass(U,F)},j.regViewRuntime=function(U,F){j.viewClassMap[U]=F},j.uiMap={},j.viewClassMap={},j._sheet=null,P(j,["uiClassMap",function(){return this.uiClassMap={ViewStack:UU,LinkButton:A,TextArea:aU,ColorPicker:V,Box:k,Button:A,CheckBox:D,Clip:G,ComboBox:M,Component:i,HScrollBar:n,HSlider:S,Image:o,Label:R,List:v,Panel:t,ProgressBar:_,Radio:B,RadioGroup:uU,ScrollBar:m,Slider:p,Tab:dU,TextInput:OU,View:j,VScrollBar:FU,VSlider:PU,Tree:E,HBox:cU,VBox:LU,Sprite:X,Animation:O,Text:N,FontClip:e}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),j.__init$=function(){j._regs(),w=function(){function U(U,F,O){this.comp=null,this.prop=null,this.value=null,this.comp=U,this.prop=F,this.value=O}return c(U,""),U.prototype.exe=function(U){var F=$.getBindFun(this.value);this.comp[this.prop]=F.call(this,U)},U}()},j}()),D=function(U){function O(U,F){void 0===F&&(F=""),O.__super.call(this,U,F)}c(O,"laya.ui.CheckBox",U);var F=O.prototype;return F.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},F.initialize=function(){U.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},L(0,F,"dataSource",U.prototype._$get_dataSource,function(U){"boolean"==typeof(this._dataSource=U)?this.selected=U:"string"==typeof U?this.selected="true"===U:x.superSet(A,this,"dataSource",U)}),O}(A),Z=function(U){function F(){this._space=0,this._align="none",this._itemChanged=!1,F.__super.call(this)}c(F,"laya.ui.LayoutBox",k);var O=F.prototype;return O.addChild=function(U){return U.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,U)},O.onResize=function(U){this._setItemChanged()},O.addChildAt=function(U,F){return U.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,U,F)},O.removeChild=function(U){return U.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,U)},O.removeChildAt=function(U){return this.getChildAt(U).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,U)},O.refresh=function(){this._setItemChanged()},O.changeItems=function(){this._itemChanged=!1},O.sortItem=function(U){U&&U.sort(function(U,F){return U.y-F.y})},O._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},L(0,O,"space",function(){return this._space},function(U){this._space=U,this._setItemChanged()}),L(0,O,"align",function(){return this._align},function(U){this._align=U,this._setItemChanged()}),F}(),e=function(F){function O(U,F){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,O.__super.call(this),U&&(this.skin=U),F&&(this.sheet=F)}c(O,"laya.ui.FontClip",F);var U=O.prototype;return U.createChildren=function(){this._bitmap=new s,this.on("loaded",this,this._onClipLoaded)},U._onClipLoaded=function(){this.callLater(this.changeValue)},U.changeValue=function(){var U;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),U=this._sources[0]))){var F="horizontal"===this._direction;F?(this._wordsW=this._valueArr.length*(U.sourceWidth+this.spaceX),this._wordsH=U.sourceHeight):(this._wordsW=U.sourceWidth,this._wordsH=(U.sourceHeight+this.spaceY)*this._valueArr.length);var O=0;if(this._width)switch(this._align){case"center":O=.5*(this._width-this._wordsW);break;case"right":O=this._width-this._wordsW;break;default:O=0}for(var P=0,Y=this._valueArr.length;P<Y;P++){var c=this._indexMap[this._valueArr.charAt(P)];this.sources[c]&&(U=this.sources[c],F?this.graphics.drawTexture(U,O+P*(U.sourceWidth+this.spaceX),0,U.sourceWidth,U.sourceHeight):this.graphics.drawTexture(U,0+O,P*(U.sourceHeight+this.spaceY),U.sourceWidth,U.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},U.destroy=function(U){void 0===U&&(U=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),F.prototype.destroy.call(this,U)},L(0,U,"sheet",function(){return this._sheet},function(U){U+="";var F=(this._sheet=U).split(" ");this._clipX=String(F[0]).length,this.clipY=F.length,this._indexMap={};for(var O=0;O<this._clipY;O++)for(var P=F[O].split(""),Y=0,c=P.length;Y<c;Y++)this._indexMap[P[Y]]=O*this._clipX+Y}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(G,this,"height",U),this.callLater(this.changeValue)}),L(0,U,"direction",function(){return this._direction},function(U){this._direction=U,this.callLater(this.changeValue)}),L(0,U,"value",function(){return this._valueArr?this._valueArr:""},function(U){U+="",this._valueArr=U,this.callLater(this.changeValue)}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(G,this,"width",U),this.callLater(this.changeValue)}),L(0,U,"spaceX",function(){return this._spaceX},function(U){this._spaceX=U,"horizontal"===this._direction&&this.callLater(this.changeValue)}),L(0,U,"spaceY",function(){return this._spaceY},function(U){this._spaceY=U,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),L(0,U,"align",function(){return this._align},function(U){this._align=U,this.callLater(this.changeValue)}),L(0,U,"measureWidth",function(){return this._wordsW}),L(0,U,"measureHeight",function(){return this._wordsH}),O}(G),v=function(U){function F(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new j,F.__super.call(this)}c(F,"laya.ui.List",U);var O=F.prototype;return x.imps(O,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),O.destroy=function(U){void 0===U&&(U=!0),this._content&&this._content.destroy(U),this._scrollBar&&this._scrollBar.destroy(U),laya.ui.Component.prototype.destroy.call(this,U),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},O.createChildren=function(){this.addChild(this._content=new k)},O.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=x.superGet(k,this,"cacheAs")),x.superSet(k,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},O.onScrollEnd=function(){x.superSet(k,this,"cacheAs",this._$P.cacheAs)},O._removePreScrollBar=function(){var U=this.removeChildByName("scrollBar");U&&U.destroy(!0)},O.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var U=this._getOneCell(),F=U.width+this._spaceX||1,O=U.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/F):Math.ceil(this._width/F)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/O):Math.round(this._height/O));var P=this._width?this._width:F*this.repeatX-this._spaceX,Y=this._height?this._height:O*this.repeatY-this._spaceY;this._cellSize=this._isVertical?O:F,this._cellOffset=this._isVertical?O*Math.max(this._repeatY2,this._repeatY)-Y-this._spaceY:F*Math.max(this._repeatX2,this._repeatX)-P-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=Y:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=P),this.setContentSize(P,Y);var c=this._isVertical?this.repeatX:this.repeatY,L=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,c,L),this._createdLine=L,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},O._getOneCell=function(){if(0===this._cells.length){var U=this.createItem();if(this._offset.setTo(U.x,U.y),this.cacheContent)return U;this._cells.push(U)}return this._cells[0]},O._createItems=function(U,F,O){var P=this._content,Y=this._getOneCell(),c=Y.width+this._spaceX,L=Y.height+this._spaceY;if(this.cacheContent){var u=new k;u.cacheAsBitmap=!0,u.pos((this._isVertical?0:U)*c,(this._isVertical?U:0)*L),this._content.addChild(u),this._content.optimizeScrollRect=!0,P=u}else{for(var d=[],a=this._cells.length-1;-1<a;a--){var b=this._cells[a];b.removeSelf(),d.push(b)}this._cells.length=0}for(var z=U;z<O;z++)for(var J=0;J<F;J++)(Y=d&&d.length?d.pop():this.createItem()).x=(this._isVertical?J:z)*c-P.x,Y.y=(this._isVertical?z:J)*L-P.y,Y.name="item"+(z*F+J),P.addChild(Y),this.addCell(Y)},O.createItem=function(){var U=[];if("function"==typeof this._itemRender)var F=new this._itemRender;else F=q.createComp(this._itemRender,null,null,U);if(0==U.length&&F._watchMap){var O=F._watchMap;for(var P in O)for(var Y=O[P],c=0;c<Y.length;c++){var L=Y[c];U.push(L.comp,L.prop,L.value)}}return U.length&&(F._$bindData=U),F},O.addCell=function(U){U.on("click",this,this.onCellMouse),U.on("rightclick",this,this.onCellMouse),U.on("mouseover",this,this.onCellMouse),U.on("mouseout",this,this.onCellMouse),U.on("mousedown",this,this.onCellMouse),U.on("mouseup",this,this.onCellMouse),this._cells.push(U)},O.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var U=0,F=U=0;F<1e4;F++){var O=this.getChildByName("item"+F);if(!O)break;this.addCell(O),U++}this.repeatY=U}},O.setContentSize=function(U,F){this._content.width=U,this._content.height=F,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new H),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,U,F),this._content.scrollRect=this._content.scrollRect),this.event("resize")},O.onCellMouse=function(U){"mousedown"===U.type&&(this._isMoved=!1);var F=U.currentTarget,O=this._startIndex+this._cells.indexOf(F);O<0||("click"===U.type||"rightclick"===U.type?this.selectEnable&&!this._isMoved?this.selectedIndex=O:this.changeCellState(F,!0,0):"mouseover"!==U.type&&"mouseout"!==U.type||this._selectedIndex===O||this.changeCellState(F,"mouseover"===U.type,0),this.mouseHandler&&this.mouseHandler.runWith([U,O]))},O.changeCellState=function(U,F,O){var P=U.getChildByName("selectBox");P&&(this.selectEnable=!0,P.visible=F,P.index=O)},O.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},O.onScrollBarChange=function(U){this.runCallLater(this.changeCells);var F=this._scrollBar.value,O=this._isVertical?this.repeatX:this.repeatY,P=this._isVertical?this.repeatY:this.repeatX,Y=Math.floor(F/this._cellSize);if(this.cacheContent)L=P+1,this._createdLine-Y<L&&(this._createItems(this._createdLine,O,this._createdLine+L),this.renderItems(this._createdLine*O,0),this._createdLine+=L);else{var c=Y*O,L=0;if(c>this._startIndex){L=c-this._startIndex;var u=!0,d=this._startIndex+O*(P+1);this._isMoved=!0}else c<this._startIndex&&(L=this._startIndex-c,u=!1,d=this._startIndex-1,this._isMoved=!0);for(var a=0;a<L;a++){if(u){var b=this._cells.shift();this._cells[this._cells.length]=b;var z=d+a}else b=this._cells.pop(),this._cells.unshift(b),z=d-a;var J=Math.floor(z/O)*this._cellSize;this._isVertical?b.y=J:b.x=J,this.renderItem(b,z)}this._startIndex=c,this.changeSelectStatus()}var w=this._content.scrollRect;this._isVertical?(w.y=F-this._offset.y,w.x=-this._offset.x):(w.y=-this._offset.y,w.x=F-this._offset.x),this._content.scrollRect=w},O.posCell=function(U,F){if(this._scrollBar){var O=this._isVertical?this.repeatX:this.repeatY,P=(this._isVertical?this.repeatY:this.repeatX,Math.floor(F/O)*this._cellSize);this._isVertical?U.y=P:U.x=P}},O.changeSelectStatus=function(){for(var U=0,F=this._cells.length;U<F;U++)this.changeCellState(this._cells[U],this._selectedIndex===this._startIndex+U,1)},O.renderItems=function(U,F){void 0===U&&(U=0),void 0===F&&(F=0);for(var O=U,P=F||this._cells.length;O<P;O++)this.renderItem(this._cells[O],this._startIndex+O);this.changeSelectStatus(),this._twDone=!0},O.renderItem=function(U,F){this._array&&0<=F&&F<this._array.length?(U.visible=!0,U._$bindData?(U._dataSource=this._array[F],this._bindData(U,this._array[F])):U.dataSource=this._array[F],this.cacheContent||this.posCell(U,F),this.hasListener("render")&&this.event("render",[U,F]),this.renderHandler&&this.renderHandler.runWith([U,F]),this.renderTwHandler&&this.renderTwHandler.runWith([U,F])):(U.visible=!1,U.dataSource=null)},O._bindData=function(U,F){for(var O=U._$bindData,P=0,Y=O.length;P<Y;P++){var c=O[P++],L=O[P++],u=O[P],d=$.getBindFun(u);c[L]=d.call(this,F)}},O.refresh=function(){this.array=this._array},O.getItem=function(U){return-1<U&&U<this._array.length?this._array[U]:null},O.changeItem=function(U,F){-1<U&&U<this._array.length&&(this._array[U]=F,U>=this._startIndex&&U<this._startIndex+this._cells.length&&this.renderItem(this.getCell(U),U))},O.setItem=function(U,F){this.changeItem(U,F)},O.addItem=function(U){this._array.push(U),this.array=this._array},O.addItemAt=function(U,F){this._array.splice(F,0,U),this.array=this._array},O.deleteItem=function(U){this._array.splice(U,1),this.array=this._array},O.getCell=function(U){return this.runCallLater(this.changeCells),-1<U&&this._cells?this._cells[(U-this._startIndex)%this._cells.length]:null},O.scrollTo=function(U){if(this._scrollBar){var F=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(U/F)*this._cellSize}else this.startIndex=U},O.tweenTo=function(U,F,O){if(void 0===F&&(F=200),this._scrollBar){var P=this._isVertical?this.repeatX:this.repeatY;f.to(this._scrollBar,{value:Math.floor(U/P)*this._cellSize},F,null,O,0,!0)}else this.startIndex=U,O&&O.run()},O._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},O.commitMeasure=function(){this.runCallLater(this.changeCells)},L(0,O,"cacheAs",U.prototype._$get_cacheAs,function(U){x.superSet(k,this,"cacheAs",U),this._scrollBar&&(this._$P.cacheAs=null,"none"!==U?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),L(0,O,"content",function(){return this._content}),L(0,O,"height",U.prototype._$get_height,function(U){U!=this._height&&(x.superSet(k,this,"height",U),this._setCellChanged())}),L(0,O,"itemRender",function(){return this._itemRender},function(U){if(this._itemRender!=U){this._itemRender=U;for(var F=this._cells.length-1;-1<F;F--)this._cells[F].destroy();this._cells.length=0,this._setCellChanged()}}),L(0,O,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(U){this._removePreScrollBar();var F=new FU;F.name="scrollBar",F.right=0,U&&" "!=U&&(F.skin=U),this.scrollBar=F,this.addChild(F),this._setCellChanged()}),L(0,O,"page",function(){return this._page},function(U){this._page=U,this._array&&(this._page=0<U?U:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),L(0,O,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(U){this._removePreScrollBar();var F=new n;F.name="scrollBar",F.bottom=0,U&&" "!=U&&(F.skin=U),this.scrollBar=F,this.addChild(F),this._setCellChanged()}),L(0,O,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(U){this._repeatX=U,this._setCellChanged()}),L(0,O,"scrollBar",function(){return this._scrollBar},function(U){this._scrollBar!=U&&(this._scrollBar=U)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),L(0,O,"width",U.prototype._$get_width,function(U){U!=this._width&&(x.superSet(k,this,"width",U),this._setCellChanged())}),L(0,O,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(U){this._repeatY=U,this._setCellChanged()}),L(0,O,"spaceX",function(){return this._spaceX},function(U){this._spaceX=U,this._setCellChanged()}),L(0,O,"spaceY",function(){return this._spaceY},function(U){this._spaceY=U,this._setCellChanged()}),L(0,O,"selectedIndex",function(){return this._selectedIndex},function(U){this._selectedIndex!=U&&(this._selectedIndex=U,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(U),this.startIndex=this._startIndex)}),L(0,O,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(U){this.selectedIndex=this._array.indexOf(U)}),L(0,O,"length",function(){return this._array?this._array.length:0}),L(0,O,"selection",function(){return this.getCell(this._selectedIndex)},function(U){this.selectedIndex=this._startIndex+this._cells.indexOf(U)}),L(0,O,"startIndex",function(){return this._startIndex},function(U){this._startIndex=0<U?U:0,this.callLater(this.renderItems)}),L(0,O,"twSwitch",function(){return this._twSwitch},function(U){this._twSwitch=U}),L(0,O,"twDone",function(){return this._twDone},function(U){this._twDone=U}),L(0,O,"array",function(){return this._array},function(U){this.runCallLater(this.changeCells),this._array=U||[];var F=this._array.length;if(this.totalPage=Math.ceil(F/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<F?this._selectedIndex:F-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var O=this._isVertical?this.repeatX:this.repeatY,P=this._isVertical?this.repeatY:this.repeatX,Y=Math.ceil(F/O);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=P/Y,this._scrollBar.setScroll(0,(Y-P)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),L(0,O,"dataSource",U.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)&&Math.floor(U)==U||"string"==typeof U?this.selectedIndex=parseInt(U):U instanceof Array?this.array=U:x.superSet(k,this,"dataSource",U)}),L(0,O,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),F}(k),n=function(U){function F(){F.__super.call(this)}return c(F,"laya.ui.HScrollBar",U),F.prototype.initialize=function(){U.prototype.initialize.call(this),this.slider.isVertical=!1},F}(m),t=function(U){function F(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,F.__super.call(this),this.width=this.height=100}c(F,"laya.ui.Panel",U);var O=F.prototype;return O.destroy=function(U){void 0===U&&(U=!0),laya.ui.Component.prototype.destroy.call(this,U),this._content&&this._content.destroy(U),this._vScrollBar&&this._vScrollBar.destroy(U),this._hScrollBar&&this._hScrollBar.destroy(U),this._vScrollBar=null,this._hScrollBar=null,this._content=null},O.destroyChildren=function(){this._content.destroyChildren()},O.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new k)},O.addChild=function(U){return U.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(U)},O.onResize=function(){this._setScrollChanged()},O.addChildAt=function(U,F){return U.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(U,F)},O.removeChild=function(U){return U.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(U)},O.removeChildAt=function(U){return this.getChildAt(U).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(U)},O.removeChildren=function(U,F){return void 0===U&&(U=0),void 0===F&&(F=2147483647),this._content.removeChildren(U,F),this._setScrollChanged(),this},O.getChildAt=function(U){return this._content.getChildAt(U)},O.getChildByName=function(U){return this._content.getChildByName(U)},O.getChildIndex=function(U){return this._content.getChildIndex(U)},O.changeScroll=function(){this._scrollChanged=!1;var U=this.contentWidth||1,F=this.contentHeight||1,O=this._vScrollBar,P=this._hScrollBar,Y=O&&F>this._height,c=P&&U>this._width,L=Y?this._width-O.width:this._width,u=c?this._height-P.height:this._height;O&&(O.x=this._width-O.width,O.y=0,O.height=this._height-(c?P.height:0),O.scrollSize=Math.max(.033*this._height,1),O.thumbPercent=u/F,O.setScroll(0,F-u,O.value)),P&&(P.x=0,P.y=this._height-P.height,P.width=this._width-(Y?O.width:0),P.scrollSize=Math.max(.033*this._width,1),P.thumbPercent=L/U,P.setScroll(0,U-L,P.value))},O.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},O.setContentSize=function(U,F){var O=this._content;O.width=U,O.height=F,O.scrollRect||(O.scrollRect=new H),O.scrollRect.setTo(0,0,U,F),O.scrollRect=O.scrollRect},O.onScrollBarChange=function(U){var F=this._content.scrollRect;if(F){var O=Math.round(U.value);U.isVertical?F.y=O:F.x=O,this._content.scrollRect=F}},O.scrollTo=function(U,F){void 0===U&&(U=0),void 0===F&&(F=0),this.vScrollBar&&(this.vScrollBar.value=F),this.hScrollBar&&(this.hScrollBar.value=U)},O.refresh=function(){this.changeScroll()},O.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=x.superGet(k,this,"cacheAs")),x.superSet(k,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},O.onScrollEnd=function(){x.superSet(k,this,"cacheAs",this._$P.cacheAs)},O._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},L(0,O,"numChildren",function(){return this._content.numChildren}),L(0,O,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(U){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new n),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=U}),L(0,O,"contentWidth",function(){for(var U=0,F=this._content.numChildren-1;-1<F;F--){var O=this._content.getChildAt(F);U=Math.max(O.x+O.width*O.scaleX,U)}return U}),L(0,O,"contentHeight",function(){for(var U=0,F=this._content.numChildren-1;-1<F;F--){var O=this._content.getChildAt(F);U=Math.max(O.y+O.height*O.scaleY,U)}return U}),L(0,O,"width",U.prototype._$get_width,function(U){x.superSet(k,this,"width",U),this._setScrollChanged()}),L(0,O,"hScrollBar",function(){return this._hScrollBar}),L(0,O,"content",function(){return this._content}),L(0,O,"height",U.prototype._$get_height,function(U){x.superSet(k,this,"height",U),this._setScrollChanged()}),L(0,O,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(U){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new FU),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=U}),L(0,O,"vScrollBar",function(){return this._vScrollBar}),L(0,O,"cacheAs",U.prototype._$get_cacheAs,function(U){x.superSet(k,this,"cacheAs",U),this._$P.cacheAs=null,"none"!==U?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),F}(k),S=function(U){function F(U){F.__super.call(this,U),this.isVertical=!1}return c(F,"laya.ui.HSlider",p),F}(),W=function(U){function O(U,F){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,O.__super.call(this),this.skin=F,this.labels=U}c(O,"laya.ui.UIGroup",U);var F=O.prototype;return x.imps(F,{"laya.ui.IItem":!0}),F.preinitialize=function(){this.mouseEnabled=!0},F.destroy=function(U){void 0===U&&(U=!0),laya.ui.Component.prototype.destroy.call(this,U),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},F.addItem=function(U,F){void 0===F&&(F=!0);var O=U,P=this._items.length;if(O.name="item"+P,this.addChild(O),this.initItems(),F&&0<P){var Y=this._items[P-1];"horizontal"==this._direction?O.x=Y.x+Y.width+this._space:O.y=Y.y+Y.height+this._space}else F&&(O.x=0,O.y=0);return P},F.delItem=function(U,F){void 0===F&&(F=!0);var O=this._items.indexOf(U);if(-1!=O){var P=U;this.removeChild(P);for(var Y=O+1,c=this._items.length;Y<c;Y++){var L=this._items[Y];L.name="item"+(Y-1),F&&("horizontal"==this._direction?L.x-=P.width+this._space:L.y-=P.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var u;u=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=u}}},F.initItems=function(){this._items||(this._items=[]);for(var U=this._items.length=0;U<1e4;U++){var F=this.getChildByName("item"+U);if(null==F)break;this._items.push(F),F.selected=U===this._selectedIndex,F.clickHandler=J.create(this,this.itemClick,[U],!1)}},F.itemClick=function(U){this.selectedIndex=U},F.setSelect=function(U,F){this._items&&-1<U&&U<this._items.length&&(this._items[U].selected=F)},F.createItem=function(U,F){return null},F.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var U=0,F=0,O=this._items.length;F<O;F++){var P=this._items[F];this._skin&&(P.skin=this._skin),this._labelColors&&(P.labelColors=this._labelColors),this._labelSize&&(P.labelSize=this._labelSize),this._labelStroke&&(P.labelStroke=this._labelStroke),this._labelStrokeColor&&(P.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(P.strokeColors=this._strokeColors),this._labelBold&&(P.labelBold=this._labelBold),this._labelPadding&&(P.labelPadding=this._labelPadding),this._labelAlign&&(P.labelAlign=this._labelAlign),this._stateNum&&(P.stateNum=this._stateNum),this._labelFont&&(P.labelFont=this._labelFont),"horizontal"===this._direction?(P.y=0,P.x=U,U+=P.width+this._space):(P.x=0,P.y=U,U+=P.height+this._space)}this.changeSize()},F.commitMeasure=function(){this.runCallLater(this.changeLabels)},F._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},L(0,F,"labelStrokeColor",function(){return this._labelStrokeColor},function(U){this._labelStrokeColor!=U&&(this._labelStrokeColor=U,this._setLabelChanged())}),L(0,F,"skin",function(){return this._skin},function(U){this._skin!=U&&(this._skin=U,this._setLabelChanged())}),L(0,F,"selectedIndex",function(){return this._selectedIndex},function(U){this._selectedIndex!=U&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=U,this.setSelect(U,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),L(0,F,"labels",function(){return this._labels},function(U){if(this._labels!=U){if(this._labels=U,this.removeChildren(),this._setLabelChanged(),this._labels)for(var F=this._labels.split(","),O=0,P=F.length;O<P;O++){var Y=this.createItem(this._skin,F[O]);Y.name="item"+O,this.addChild(Y)}this.initItems()}}),L(0,F,"strokeColors",function(){return this._strokeColors},function(U){this._strokeColors!=U&&(this._strokeColors=U,this._setLabelChanged())}),L(0,F,"labelColors",function(){return this._labelColors},function(U){this._labelColors!=U&&(this._labelColors=U,this._setLabelChanged())}),L(0,F,"labelStroke",function(){return this._labelStroke},function(U){this._labelStroke!=U&&(this._labelStroke=U,this._setLabelChanged())}),L(0,F,"labelSize",function(){return this._labelSize},function(U){this._labelSize!=U&&(this._labelSize=U,this._setLabelChanged())}),L(0,F,"stateNum",function(){return this._stateNum},function(U){this._stateNum!=U&&(this._stateNum=U,this._setLabelChanged())}),L(0,F,"labelBold",function(){return this._labelBold},function(U){this._labelBold!=U&&(this._labelBold=U,this._setLabelChanged())}),L(0,F,"labelFont",function(){return this._labelFont},function(U){this._labelFont!=U&&(this._labelFont=U,this._setLabelChanged())}),L(0,F,"labelPadding",function(){return this._labelPadding},function(U){this._labelPadding!=U&&(this._labelPadding=U,this._setLabelChanged())}),L(0,F,"direction",function(){return this._direction},function(U){this._direction=U,this._setLabelChanged()}),L(0,F,"space",function(){return this._space},function(U){this._space=U,this._setLabelChanged()}),L(0,F,"items",function(){return this._items}),L(0,F,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(U){this.selectedIndex=this._items.indexOf(U)}),L(0,F,"dataSource",U.prototype._$get_dataSource,function(U){"number"==typeof(this._dataSource=U)&&Math.floor(U)==U||"string"==typeof U?this.selectedIndex=parseInt(U):U instanceof Array?this.labels=U.join(","):x.superSet(k,this,"dataSource",U)}),O}(k),B=function(F){function O(U,F){this._value=null,void 0===F&&(F=""),O.__super.call(this,U,F)}c(O,"laya.ui.Radio",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._value=null},U.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},U.initialize=function(){F.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},U.onClick=function(U){this.selected=!0},L(0,U,"value",function(){return null!=this._value?this._value:this.label},function(U){this._value=U}),O}(A),E=function(U){function F(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,F.__super.call(this),this.width=this.height=200}c(F,"laya.ui.Tree",U);var O=F.prototype;return x.imps(O,{"laya.ui.IRender":!0}),O.destroy=function(U){void 0===U&&(U=!0),laya.ui.Component.prototype.destroy.call(this,U),this._list&&this._list.destroy(U),this._list=null,this._source=null,this._renderHandler=null},O.createChildren=function(){this.addChild(this._list=new v),this._list.renderHandler=J.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},O.onListChange=function(U){this.event("change")},O.getArray=function(){var U,F=[];for(var O in this._source)U=this._source[O],this.getParentOpenStatus(U)&&(U.x=this._spaceLeft*this.getDepth(U),F.push(U));return F},O.getDepth=function(U,F){return void 0===F&&(F=0),null==U.nodeParent?F:this.getDepth(U.nodeParent,F+1)},O.getParentOpenStatus=function(U){var F=U.nodeParent;return null==F||!!F.isOpen&&(null==F.nodeParent||this.getParentOpenStatus(F))},O.renderItem=function(U,F){var O=U.dataSource;if(O){U.left=O.x;var P=U.getChildByName("arrow");P&&(O.hasChild?(P.visible=!0,P.index=O.isOpen?1:0,P.tag=F,P.off("click",this,this.onArrowClick),P.on("click",this,this.onArrowClick)):P.visible=!1);var Y=U.getChildByName("folder");Y&&(2==Y.clipY?Y.index=O.isDirectory?0:1:Y.index=O.isDirectory?O.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([U,F])}},O.onArrowClick=function(U){var F=U.currentTarget.tag;this._list.array[F].isOpen=!this._list.array[F].isOpen,this.event("open"),this._list.array=this.getArray()},O.setItemState=function(U,F){this._list.array[U]&&(this._list.array[U].isOpen=F,this._list.array=this.getArray())},O.fresh=function(){this._list.array=this.getArray(),this.repaint()},O.parseXml=function(U,F,O,P){var Y,c=U.childNodes,L=c.length;if(!P){Y={};var u,d=U.attributes;for(var a in d){var b=(u=d[a]).nodeName,z=u.nodeValue;Y[b]="true"==z||"false"!=z&&z}Y.nodeParent=O,0<L&&(Y.isDirectory=!0),Y.hasChild=0<L,F.push(Y)}for(var J=0;J<L;J++){var w=c[J];this.parseXml(w,F,Y,!1)}},O.parseOpenStatus=function(U,F){for(var O=0,P=F.length;O<P;O++){var Y=F[O];if(Y.isDirectory)for(var c=0,L=U.length;c<L;c++){var u=U[c];if(u.isDirectory&&this.isSameParent(u,Y)&&Y.label==u.label){Y.isOpen=u.isOpen;break}}}},O.isSameParent=function(U,F){return null==U.nodeParent&&null==F.nodeParent||null!=U.nodeParent&&null!=F.nodeParent&&(U.nodeParent.label==F.nodeParent.label&&this.isSameParent(U.nodeParent,F.nodeParent))},O.filter=function(U){if(Boolean(U)){var F=[];this.getFilterSource(this._source,F,U),this._list.array=F}else this._list.array=this.getArray()},O.getFilterSource=function(U,F,O){var P;for(var Y in O=O.toLocaleLowerCase(),U)!(P=U[Y]).isDirectory&&-1<String(P.label).toLowerCase().indexOf(O)&&(P.x=0,F.push(P)),P.child&&0<P.child.length&&this.getFilterSource(P.child,F,O)},L(0,O,"spaceBottom",function(){return this._list.spaceY},function(U){this._list.spaceY=U}),L(0,O,"keepStatus",function(){return this._keepStatus},function(U){this._keepStatus=U}),L(0,O,"itemRender",function(){return this._list.itemRender},function(U){this._list.itemRender=U}),L(0,O,"array",function(){return this._list.array},function(U){this._keepStatus&&this._list.array&&U&&this.parseOpenStatus(this._list.array,U),this._source=U,this._list.array=this.getArray()}),L(0,O,"mouseHandler",function(){return this._list.mouseHandler},function(U){this._list.mouseHandler=U}),L(0,O,"dataSource",U.prototype._$get_dataSource,function(U){this._dataSource=U,x.superSet(k,this,"dataSource",U)}),L(0,O,"source",function(){return this._source}),L(0,O,"scrollBar",function(){return this._list.scrollBar}),L(0,O,"list",function(){return this._list}),L(0,O,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(U){this._list.vScrollBarSkin=U}),L(0,O,"renderHandler",function(){return this._renderHandler},function(U){this._renderHandler=U}),L(0,O,"selectedIndex",function(){return this._list.selectedIndex},function(U){this._list.selectedIndex=U}),L(0,O,"spaceLeft",function(){return this._spaceLeft},function(U){this._spaceLeft=U}),L(0,O,"selectedItem",function(){return this._list.selectedItem},function(U){this._list.selectedItem=U}),L(0,O,"width",U.prototype._$get_width,function(U){x.superSet(k,this,"width",U),this._list.width=U}),L(0,O,"height",U.prototype._$get_height,function(U){x.superSet(k,this,"height",U),this._list.height=U}),L(0,O,"xml",null,function(U){var F=[];this.parseXml(U.childNodes[0],F,null,!0),this.array=F}),L(0,O,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),F}(k),UU=function(U){function F(){this._items=null,this._selectedIndex=0,F.__super.call(this),this._setIndexHandler=J.create(this,this.setIndex,null,!1)}c(F,"laya.ui.ViewStack",U);var O=F.prototype;return x.imps(O,{"laya.ui.IItem":!0}),O.setItems=function(U){this.removeChildren();for(var F=0,O=0,P=U.length;O<P;O++){var Y=U[O];Y&&(Y.name="item"+F,this.addChild(Y),F++)}this.initItems()},O.addItem=function(U){U.name="item"+this._items.length,this.addChild(U),this.initItems()},O.initItems=function(){this._items=[];for(var U=0;U<1e4;U++){var F=this.getChildByName("item"+U);if(null==F)break;this._items.push(F),F.visible=U==this._selectedIndex}},O.setSelect=function(U,F){this._items&&-1<U&&U<this._items.length&&(this._items[U].visible=F)},O.setIndex=function(U){this.selectedIndex=U},L(0,O,"dataSource",U.prototype._$get_dataSource,function(U){if("number"==typeof(this._dataSource=U)&&Math.floor(U)==U||"string"==typeof U)this.selectedIndex=parseInt(U);else for(var F in this._dataSource)this.hasOwnProperty(F)&&(this[F]=this._dataSource[F])}),L(0,O,"selectedIndex",function(){return this._selectedIndex},function(U){this._selectedIndex!=U&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=U,this.setSelect(this._selectedIndex,!0))}),L(0,O,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(U){this.selectedIndex=this._items.indexOf(U)}),L(0,O,"items",function(){return this._items}),L(0,O,"setIndexHandler",function(){return this._setIndexHandler},function(U){this._setIndexHandler=U}),F}(k),FU=function(U){function F(){F.__super.call(this)}return c(F,"laya.ui.VScrollBar",m),F}(),OU=function(F){function O(U){this._bg=null,this._skin=null,O.__super.call(this),void 0===U&&(U=""),this.text=U,this.skin=this.skin}c(O,"laya.ui.TextInput",F);var U=O.prototype;return U.preinitialize=function(){this.mouseEnabled=!0},U.destroy=function(U){h.clearCache(this,this._skin),void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._bg&&this._bg.destroy(),this._bg=null},U.createChildren=function(){this.addChild(this._tf=new w),this._tf.padding=l.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},U._onFocus=function(){this.event("focus",this)},U._onBlur=function(){this.event("blur",this)},U._onInput=function(){this.event("input",this)},U._onEnter=function(){this.event("enter",this)},U.initialize=function(){this.width=128,this.height=22},U.select=function(){this._tf.select()},U.setSelection=function(U,F){this._tf.setSelection(U,F)},L(0,U,"text",F.prototype._$get_text,function(U){this._tf.text!=U&&(U+="",this._tf.text=U,this.event("change"))}),L(0,U,"bg",function(){return this._bg},function(U){this.graphics=this._bg=U}),L(0,U,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(U){this._tf.inputElementYAdjuster=U}),L(0,U,"multiline",function(){return this._tf.multiline},function(U){this._tf.multiline=U}),L(0,U,"skin",function(){return this._skin},function(U){this._skin!=U&&(h.clearCache(this,this._skin),this._skin=U,this._bg||(this.graphics=this._bg=new s),h.keepCache(this,this._skin),this._bg.source=h.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),L(0,U,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(U){this._bg||(this.graphics=this._bg=new s),this._bg.sizeGrid=$.fillArray(l.defaultSizeGrid,U,Number)}),L(0,U,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(U){this._tf.inputElementXAdjuster=U}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(R,this,"width",U),this._bg&&(this._bg.width=U)}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(R,this,"height",U),this._bg&&(this._bg.height=U)}),L(0,U,"editable",function(){return this._tf.editable},function(U){this._tf.editable=U}),L(0,U,"restrict",function(){return this._tf.restrict},function(U){this._tf.restrict=U}),L(0,U,"prompt",function(){return this._tf.prompt},function(U){this._tf.prompt=U}),L(0,U,"promptColor",function(){return this._tf.promptColor},function(U){this._tf.promptColor=U}),L(0,U,"maxChars",function(){return this._tf.maxChars},function(U){this._tf.maxChars=U}),L(0,U,"focus",function(){return this._tf.focus},function(U){this._tf.focus=U}),L(0,U,"type",function(){return this._tf.type},function(U){this._tf.type=U}),L(0,U,"asPassword",function(){return this._tf.asPassword},function(U){this._tf.asPassword=U}),O}(R),PU=function(U){function F(){F.__super.call(this)}return c(F,"laya.ui.VSlider",p),F}(),YU=function(U){function P(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,P.__super.call(this)}c(P,"laya.ui.Dialog",U);var F=P.prototype;return F.initialize=function(){this.popupEffect=P.manager.popupEffectHandler,this.closeEffect=P.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},F._dealDragArea=function(){var U=this.getChildByName("drag");U&&(this.dragArea=U.x+","+U.y+","+U.width+","+U.height,U.removeSelf())},F._onClick=function(U){var F=U.target;if(F)switch(F.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(F.name)}},F.show=function(U,F){void 0===U&&(U=!1),void 0===F&&(F=!0),this._open(!1,U,F)},F.popup=function(U,F){void 0===U&&(U=!1),void 0===F&&(F=!0),this._open(!0,U,F)},F._open=function(U,F,O){P.manager.lock(!1),this.isModal=U,P.manager.open(this,F,O)},F.onOpened=function(){},F.close=function(U,F){void 0===F&&(F=!0),P.manager.close(this,U,F)},F.onClosed=function(U){},F._onMouseDown=function(U){var F=this.getMousePoint();this._dragArea.contains(F.x,F.y)?this.startDrag():this.stopDrag()},L(0,F,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(U){if(U){var F=$.fillArray([0,0,0,0],U,Number);this._dragArea=new H(F[0],F[1],F[2],F[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),L(0,F,"isPopup",function(){return null!=this.parent}),L(0,F,"zOrder",U.prototype._$get_zOrder,function(U){x.superSet(q,this,"zOrder",U),P.manager._checkMask()}),L(1,P,"manager",function(){return P._manager=P._manager||new y},function(U){P._manager=U}),P.setLockView=function(U){P.manager.setLockView(U)},P.lock=function(U){P.manager.lock(U)},P.closeAll=function(){P.manager.closeAll()},P.getDialogsByGroup=function(U){return P.manager.getDialogsByGroup(U)},P.closeByGroup=function(U){return P.manager.closeByGroup(U)},P.CLOSE="close",P.CANCEL="cancel",P.SURE="sure",P.NO="no",P.OK="ok",P.YES="yes",P._manager=null,P}(q),cU=function(U){function F(){F.__super.call(this)}c(F,"laya.ui.HBox",U);var O=F.prototype;return O.sortItem=function(U){U&&U.sort(function(U,F){return U.x-F.x})},O.changeItems=function(){this._itemChanged=!1;for(var U=[],F=0,O=0,P=this.numChildren;O<P;O++){var Y=this.getChildAt(O);Y&&Y.layoutEnabled&&(U.push(Y),F=this._height?this._height:Math.max(F,Y.height*Y.scaleY))}this.sortItem(U);var c=0;for(O=0,P=U.length;O<P;O++)(Y=U[O]).x=c,c+=Y.width*Y.scaleX+this._space,"top"==this._align?Y.y=0:"middle"==this._align?Y.y=.5*(F-Y.height*Y.scaleY):"bottom"==this._align&&(Y.y=F-Y.height*Y.scaleY);this.changeSize()},L(0,O,"height",U.prototype._$get_height,function(U){this._height!=U&&(x.superSet(Z,this,"height",U),this.callLater(this.changeItems))}),F.NONE="none",F.TOP="top",F.MIDDLE="middle",F.BOTTOM="bottom",F}(Z),LU=function(U){function F(){F.__super.call(this)}c(F,"laya.ui.VBox",U);var O=F.prototype;return O.changeItems=function(){this._itemChanged=!1;for(var U=[],F=0,O=0,P=this.numChildren;O<P;O++){var Y=this.getChildAt(O);Y&&Y.layoutEnabled&&(U.push(Y),F=this._width?this._width:Math.max(F,Y.width*Y.scaleX))}this.sortItem(U);var c=0;for(O=0,P=U.length;O<P;O++)(Y=U[O]).y=c,c+=Y.height*Y.scaleY+this._space,"left"==this._align?Y.x=0:"center"==this._align?Y.x=.5*(F-Y.width*Y.scaleX):"right"==this._align&&(Y.x=F-Y.width*Y.scaleX);this.changeSize()},L(0,O,"width",U.prototype._$get_width,function(U){this._width!=U&&(x.superSet(Z,this,"width",U),this.callLater(this.changeItems))}),F.NONE="none",F.LEFT="left",F.CENTER="center",F.RIGHT="right",F}(Z),uU=function(U){function F(){F.__super.call(this)}return c(F,"laya.ui.RadioGroup",W),F.prototype.createItem=function(U,F){return new B(U,F)},F}(),dU=function(U){function F(){F.__super.call(this)}return c(F,"laya.ui.Tab",W),F.prototype.createItem=function(U,F){return new A(U,F)},F}(),aU=function(F){function O(U){this._vScrollBar=null,this._hScrollBar=null,void 0===U&&(U=""),O.__super.call(this,U)}c(O,"laya.ui.TextArea",F);var U=O.prototype;return U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},U.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},U.onVBarChanged=function(U){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},U.onHBarChanged=function(U){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},U.changeScroll=function(){var U=this._vScrollBar&&0<this._tf.maxScrollY,F=this._hScrollBar&&0<this._tf.maxScrollX,O=U?this._width-this._vScrollBar.width:this._width,P=F?this._height-this._hScrollBar.height:this._height,Y=this._tf.padding||l.labelPadding;this._tf.width=O,this._tf.height=P,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-Y[2],this._vScrollBar.y=Y[1],this._vScrollBar.height=this._height-(F?this._hScrollBar.height:0)-Y[1]-Y[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=P/Math.max(this._tf.textHeight,P),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=U),this._hScrollBar&&(this._hScrollBar.x=Y[0],this._hScrollBar.y=this._height-this._hScrollBar.height-Y[3],this._hScrollBar.width=this._width-(U?this._vScrollBar.width:0)-Y[0]-Y[2],this._hScrollBar.scrollSize=Math.max(.033*O,1),this._hScrollBar.thumbPercent=O/Math.max(this._tf.textWidth,O),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=F)},U.scrollTo=function(U){this.commitMeasure(),this._tf.scrollY=U},L(0,U,"scrollY",function(){return this._tf.scrollY}),L(0,U,"width",F.prototype._$get_width,function(U){x.superSet(OU,this,"width",U),this.callLater(this.changeScroll)}),L(0,U,"hScrollBar",function(){return this._hScrollBar}),L(0,U,"height",F.prototype._$get_height,function(U){x.superSet(OU,this,"height",U),this.callLater(this.changeScroll)}),L(0,U,"maxScrollX",function(){return this._tf.maxScrollX}),L(0,U,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(U){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new FU),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=U}),L(0,U,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(U){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new n),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=U}),L(0,U,"vScrollBar",function(){return this._vScrollBar}),L(0,U,"maxScrollY",function(){return this._tf.maxScrollY}),L(0,U,"scrollX",function(){return this._tf.scrollX}),O}(OU);!function(U){function F(){this._uiView=null,this.isCloseOther=!1,F.__super.call(this)}c(F,"laya.ui.AsynDialog",YU);var O=F.prototype;O.createView=function(U){this._uiView=U},O._open=function(U,F,O){this.isModal=U,this.isCloseOther=F,YU.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},O.onCreated=function(){this.createUI(),this.onOpen()},O.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},O.onOpen=function(){YU.manager.open(this,this.isCloseOther),YU.manager.lock(!1)},O.close=function(U,F){void 0===F&&(F=!0),YU.manager.close(this),this.onClose()},O.onClose=function(){},O.destroy=function(U){void 0===U&&(U=!0),laya.ui.View.prototype.destroy.call(this,U),this._uiView=null,this.onDestroy()},O.onDestroy=function(){}}();x.__init([q])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(U,F){"use strict";for(var O in Object.defineProperty(F,"__esModule",{value:!0}),Laya){var P=Laya[O];P&&P.__isclass&&(F[O]=P)}}),function(J,U,N){N.un,N.uns;var z=N.static,w=N.class,j=N.getset,P=N.__newvec,X=laya.maths.Arith,L=laya.webgl.atlas.AtlasResourceManager,O=laya.webgl.shader.BaseShader,i=laya.utils.Browser,u=laya.webgl.utils.Buffer,K=laya.utils.Byte,Y=laya.utils.ClassUtils,d=N.Config,c=(laya.events.Event,laya.events.EventDispatcher),l=laya.utils.Handler,H=laya.net.Loader,F=laya.net.LoaderManager,a=(laya.maths.MathUtil,laya.display.Node),x=laya.renders.Render,b=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),r=laya.resource.Resource,h=laya.utils.RunDriver,Q=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),f=laya.display.Sprite,I=laya.utils.Stat,T=laya.utils.StringKey,$=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),g=laya.utils.Utils,C=laya.webgl.WebGL,s=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;N.interface("laya.d3.core.IClone"),N.interface("laya.d3.graphics.IVertex"),N.interface("laya.d3.core.render.IUpdate"),N.interface("laya.d3.core.scene.ITreeNode"),N.interface("laya.d3.core.render.IRenderable");(function(){function A(){}w(A,"laya.d3.animation.AnimationClipParser01"),A.READ_DATA=function(){A._DATA.offset=A._reader.getUint32(),A._DATA.size=A._reader.getUint32()},A.READ_BLOCK=function(){for(var U=A._BLOCK.count=A._reader.getUint16(),F=A._BLOCK.blockStarts=[],O=A._BLOCK.blockLengths=[],P=0;P<U;P++)F.push(A._reader.getUint32()),O.push(A._reader.getUint32())},A.READ_STRINGS=function(){var U=A._reader.getUint32(),F=A._reader.getUint16(),O=A._reader.pos;A._reader.pos=U+A._DATA.offset;for(var P=0;P<F;P++)A._strings[P]=A._reader.readUTFString();A._reader.pos=O},A.parse=function(U,F){A._animationClip=U;(A._reader=F).__getBuffer();A.READ_DATA(),A.READ_BLOCK(),A.READ_STRINGS();for(var O=0,P=A._BLOCK.count;O<P;O++){var Y=F.getUint16(),c=A._strings[Y],L=A["READ_"+c];if(null==L)throw new Error("model file err,no this function:"+Y+" "+c);L.call()}},A.READ_ANIMATIONS=function(){var U,F=0,O=0,P=A._reader,Y=P.__getBuffer(),c=[],L=P.getUint8();for(c.length=L,F=0;F<L;F++)c[F]=P.getUint16();var u=[],d=P.getUint16();for(u.length=d,F=0;F<d;F++)u[F]=P.getFloat32();var a=A._animationClip;a.name=A._strings[P.getUint16()];var b=a._duration=P.getFloat32();a.islooping=!!P.getByte(),a._frameRate=P.getInt16();var z=P.getInt16(),J=a._nodes=new Array;J.length=z,(a._publicClipDatas=[]).length=z;var w=a._nodesMap={},j=0,x=0;for(F=0;F<z;F++){U=J[F]=new _;var r=P.getUint16(),H=U.path=[];for(H.length=r,O=0;O<r;O++)H[O]=A._strings[P.getUint16()];var h=H.join("/"),Q=w[h];Q||(w[h]=Q=[]),Q.push(U);var X=P.getInt16();-1!==X&&(U.componentType=A._strings[X]);var N=o._propertyIndexDic[A._strings[P.getUint16()]];if(null==N)throw new Error("AnimationClipParser01:unknown property name.");var K=N<4,f=!K||K&&""===H[0];(U._cacheProperty=f)?j++:x++,U.propertyNameID=N;var I=c[P.getUint8()];U.keyFrameWidth=I/4;var T=U.keyFrames=[],g=T.length=P.getUint16(),l=null,$=NaN;for(O=0;O<g;O++){var C=T[O]=new R;$=C.startTime=u[P.getUint16()];var s=P.pos;C.inTangent=new Float32Array(Y.slice(s,s+I)),P.pos+=I,s=P.pos,C.outTangent=new Float32Array(Y.slice(s,s+I)),P.pos+=I,s=P.pos,C.data=new Float32Array(Y.slice(s,s+I)),P.pos+=I,l&&(l.next=C,l.duration=$-l.startTime),l=C}C.next=null,C.duration=b-$}var i=a._nodeToCachePropertyMap=new Int32Array(z),y=a._cachePropertyMap=new Int32Array(j),k=a._unCachePropertyMap=new Int32Array(x);for(j=x=0,F=0;F<z;F++)(U=J[F])._cacheProperty?(i[F]=j,y[j++]=F):k[x++]=F},A._animationClip=null,A._reader=null,A._strings=[],z(A,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function m(){}w(m,"laya.d3.animation.AnimationClipParser02"),m.READ_DATA=function(){m._DATA.offset=m._reader.getUint32(),m._DATA.size=m._reader.getUint32()},m.READ_BLOCK=function(){for(var U=m._BLOCK.count=m._reader.getUint16(),F=m._BLOCK.blockStarts=[],O=m._BLOCK.blockLengths=[],P=0;P<U;P++)F.push(m._reader.getUint32()),O.push(m._reader.getUint32())},m.READ_STRINGS=function(){var U=m._reader.getUint32(),F=m._reader.getUint16(),O=m._reader.pos;m._reader.pos=U+m._DATA.offset;for(var P=0;P<F;P++)m._strings[P]=m._reader.readUTFString();m._reader.pos=O},m.parse=function(U,F){m._animationClip=U;(m._reader=F).__getBuffer();m.READ_DATA(),m.READ_BLOCK(),m.READ_STRINGS();for(var O=0,P=m._BLOCK.count;O<P;O++){var Y=F.getUint16(),c=m._strings[Y],L=m["READ_"+c];if(null==L)throw new Error("model file err,no this function:"+Y+" "+c);L.call()}},m.READ_ANIMATIONS=function(){var U,F=0,O=0,P=m._reader,Y=P.__getBuffer(),c=[],L=P.getUint8();for(c.length=L,F=0;F<L;F++)c[F]=P.getUint16();var u=[],d=P.getUint16();for(u.length=d,F=0;F<d;F++)u[F]=P.getFloat32();var a=m._animationClip;a.name=m._strings[P.getUint16()];var b=a._duration=P.getFloat32();a.islooping=!!P.getByte(),a._frameRate=P.getInt16();var z=P.getInt16(),J=a._nodes=new Array;J.length=z,(a._publicClipDatas=[]).length=z;var w=a._nodesMap={},j=0,x=0;for(F=0;F<z;F++){U=J[F]=new _;var r=P.getUint16(),H=U.path=[];for(H.length=r,O=0;O<r;O++)H[O]=m._strings[P.getUint16()];var h=H.join("/"),Q=w[h];Q||(w[h]=Q=[]),Q.push(U);var X=P.getInt16();-1!==X&&(U.componentType=m._strings[X]);var N=o._propertyIndexDic[m._strings[P.getUint16()]];if(null==N)throw new Error("AnimationClipParser02:unknown property name.");var K=N<4,f=!K||K&&""===H[0];(U._cacheProperty=f)?j++:x++,U.propertyNameID=N;var I=c[P.getUint8()];U.keyFrameWidth=I/4;var T=U.keyFrames=[],g=T.length=P.getUint16(),l=null,$=NaN;for(O=0;O<g;O++){var C=T[O]=new R;$=C.startTime=u[P.getUint16()];var s=P.pos;C.inTangent=new Float32Array(Y.slice(s,s+I)),P.pos+=I,s=P.pos,C.outTangent=new Float32Array(Y.slice(s,s+I)),P.pos+=I,s=P.pos,C.data=new Float32Array(Y.slice(s,s+I)),P.pos+=I,l&&(l.next=C,l.duration=$-l.startTime),l=C}C.next=null,C.duration=b-$}var i=P.getUint16();for(F=0;F<i;F++){var y,k=new p;k.time=P.getFloat32(),k.eventName=m._strings[P.getUint16()];var A=P.getUint16();for(0<A&&(k.params=y=[]),O=0;O<A;O++){switch(P.getByte()){case 0:y.push(!!P.getByte());break;case 1:y.push(P.getInt32());break;case 2:y.push(P.getFloat32());break;case 3:y.push(m._strings[P.getUint16()]);break;default:throw new Error("unknown type.")}}a.addEvent(k)}var G=a._nodeToCachePropertyMap=new Int32Array(z),V=a._cachePropertyMap=new Int32Array(j),M=a._unCachePropertyMap=new Int32Array(x);for(j=x=0,F=0;F<z;F++)(U=J[F])._cacheProperty?(G[F]=j,V[j++]=F):M[x++]=F},m._animationClip=null,m._reader=null,m._strings=[],z(m,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var p=function(){function U(){this.time=NaN,this.eventName=null,this.params=null}return w(U,"laya.d3.animation.AnimationEvent"),U}(),o=function(){function P(){this._childs=[],this.transform=new hF(this)}w(P,"laya.d3.animation.AnimationNode");var U=P.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.addChild=function(U){U._parent=this,U.transform.setParent(this.transform),this._childs.push(U)},U.removeChild=function(U){var F=this._childs.indexOf(U);-1!==F&&this._childs.splice(F,1)},U.getChildByName=function(U){for(var F=0,O=this._childs.length;F<O;F++){var P=this._childs[F];if(P.name===U)return P}return null},U.getChildByIndex=function(U){return this._childs[U]},U.getChildCount=function(){return this._childs.length},U.cloneTo=function(U){var F=U;F.name=this.name;for(var O=0,P=this._childs.length;O<P;O++){var Y=this._childs[O],c=Y.clone();F.addChild(c);var L=Y.transform,u=c.transform;u.setLocalPosition(L.getLocalPosition()),u.setLocalRotation(L.getLocalRotation()),u.setLocalScale(L.getLocalScale()),u._localRotationEuler=L._localRotationEuler,u._setWorldMatrixIgnoreUpdate(L.getWorldMatrix())}},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},P.__init__=function(){P.registerAnimationNodeProperty("localPosition",P._getLocalPosition,P._setLocalPosition),P.registerAnimationNodeProperty("localRotation",P._getLocalRotation,P._setLocalRotation),P.registerAnimationNodeProperty("localScale",P._getLocalScale,P._setLocalScale),P.registerAnimationNodeProperty("localRotationEuler",P._getLocalRotationEuler,P._setLocalRotationEuler),P.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",P._getParticleRenderSharedMaterialTintColor,P._setParticleRenderSharedMaterialTintColor),P.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",P._getMeshRenderSharedMaterialTilingOffset,P._setMeshRenderSharedMaterialTilingOffset),P.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",P._getMeshRenderSharedMaterialAlbedo,P._setMeshRenderSharedMaterialAlbedo),P.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",P._getSkinnedMeshRenderSharedMaterialTilingOffset,P._setSkinnedMeshRenderSharedMaterialTilingOffset),P.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",P._getSkinnedMeshRenderSharedMaterialAlbedo,P._setSkinnedMeshRenderSharedMaterialAlbedo),P.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",P._getMeshRenderSharedMaterialAlbedo,P._setMeshRenderSharedMaterialAlbedo),P.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",P._getSkinnedMeshRenderSharedMaterialAlbedo,P._setSkinnedMeshRenderSharedMaterialAlbedo),P.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",P._getMeshRenderSharedMaterialIntensity,P._setMeshRenderSharedMaterialIntensity),P.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",P._getMeshRenderSharedMaterialAlpha,P._setMeshRenderSharedMaterialAlpha),P.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",P._getMeshRenderSharedMaterialAlphaColor,P._setMeshRenderSharedMaterialAlphaColor),P.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",P._getMeshRenderSharedMaterialBaseColor,P._setMeshRenderSharedMaterialBaseColor),P.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",P._getMeshRenderSharedMaterialDissolve,P._setMeshRenderSharedMaterialDissolve),P.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",P._getMeshRenderSharedMaterialDissolveSpeed,P._setMeshRenderSharedMaterialDissolveSpeed),P.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",P._getMeshRenderSharedMaterialMMultiplier,P._setMeshRenderSharedMaterialMMultiplier),P.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",P._getMeshRenderSharedMaterialBaseScrollSpeedX,P._setMeshRenderSharedMaterialBaseScrollSpeedX),P.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",P._getMeshRenderSharedMaterialBaseScrollSpeedY,P._setMeshRenderSharedMaterialBaseScrollSpeedY),P.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",P._getMeshRenderSharedMaterialSecondScrollSpeedX,P._setMeshRenderSharedMaterialSecondScrollSpeedX),P.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",P._getMeshRenderSharedMaterialSecondScrollSpeedY,P._setMeshRenderSharedMaterialSecondScrollSpeedY),P.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",P._getMeshRenderSharedMaterialDetailTilingOffset,P._setMeshRenderSharedMaterialDetailTilingOffset),P.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",P._getMeshRenderSharedMaterialDissolveTilingOffset,P._setMeshRenderSharedMaterialDissolveTilingOffset),P.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",P._getMeshRenderSharedMaterialMaskTilingOffset,P._setMeshRenderSharedMaterialMaskTilingOffset)},P.registerAnimationNodeProperty=function(U,F,O){if(P._propertyIndexDic[U])throw new Error("AnimationNode: this propertyName has registered.");P._propertyIndexDic[U]=P._propertyIDCounter,P._propertyGetFuncs[P._propertyIDCounter]=F,P._propertySetFuncs[P._propertyIDCounter]=O,P._propertyIDCounter++},P._getLocalPosition=function(U,F){return U?U.transform.getLocalPosition():F._transform.localPosition.elements},P._setLocalPosition=function(U,F,O){if(U)U.transform.setLocalPosition(O);else{var P=F._transform,Y=P.localPosition;Y.elements=O,P.localPosition=Y}},P._getLocalRotation=function(U,F){return U?U.transform.getLocalRotation():F._transform.localRotation.elements},P._setLocalRotation=function(U,F,O){if(U)U.transform.setLocalRotation(O);else{var P=F._transform,Y=P.localRotation;Y.elements=O,P.localRotation=Y}},P._getLocalScale=function(U,F){return U?U.transform.getLocalScale():F._transform.localScale.elements},P._setLocalScale=function(U,F,O){if(U)U.transform.setLocalScale(O);else{var P=F._transform,Y=P.localScale;Y.elements=O,P.localScale=Y}},P._getLocalRotationEuler=function(U,F){return U?U.transform.getLocalRotationEuler():F._transform.localRotationEuler.elements},P._setLocalRotationEuler=function(U,F,O){if(U)U.transform.setLocalRotationEuler(O);else{var P=F._transform,Y=P.localRotationEuler;Y.elements=O,P.localRotationEuler=Y}},P._getMeshRenderSharedMaterialTilingOffset=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return F.meshRender.sharedMaterial.tilingOffset.elements},P._setMeshRenderSharedMaterialTilingOffset=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).tilingOffset).elements=O,P.tilingOffset=Y)}else(Y=(P=F.meshRender.material).tilingOffset).elements=O,P.tilingOffset=Y},P._getMeshRenderSharedMaterialAlbedo=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.albedoColor.elements:null}return F.meshRender.sharedMaterial.albedoColor.elements},P._setMeshRenderSharedMaterialAlbedo=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).albedoColor).elements=O,P.albedoColor=Y)}else(Y=(P=F.meshRender.material).albedoColor).elements=O,P.albedoColor=Y},P._getSkinnedMeshRenderSharedMaterialTilingOffset=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return F.skinnedMeshRender.sharedMaterial.tilingOffset.elements},P._setSkinnedMeshRenderSharedMaterialTilingOffset=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.skinnedMeshRender.material).tilingOffset).elements=O,P.tilingOffset=Y)}else(Y=(P=F.skinnedMeshRender.material).tilingOffset).elements=O,P.tilingOffset=Y},P._getSkinnedMeshRenderSharedMaterialAlbedo=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return F.skinnedMeshRender.sharedMaterial.albedoColor.elements},P._setSkinnedMeshRenderSharedMaterialAlbedo=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.skinnedMeshRender.material).albedoColor).elements=O,P.albedoColor=Y)}else(Y=(P=F.skinnedMeshRender.material).albedoColor).elements=O,P.albedoColor=Y},P._getParticleRenderSharedMaterialTintColor=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.particleRender.sharedMaterial.tintColor.elements:null}return F.particleRender.sharedMaterial.tintColor.elements},P._setParticleRenderSharedMaterialTintColor=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.particleRender.material).tintColor).elements=O,P.tintColor=Y)}else(Y=(P=F.particleRender.material).tintColor).elements=O,P.tintColor=Y},P._getMeshRenderSharedMaterialAlphaColor=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.alphaColor.elements:null}return F.meshRender.sharedMaterial.alphaColor.elements},P._setMeshRenderSharedMaterialAlphaColor=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).alphaColor).elements=O,P.alphaColor=Y)}else(Y=(P=F.meshRender.material).alphaColor).elements=O,P.alphaColor=Y},P._getMeshRenderSharedMaterialBaseColor=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.baseColor.elements:null}return F.meshRender.sharedMaterial.baseColor.elements},P._setMeshRenderSharedMaterialBaseColor=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).baseColor).elements=O,P.baseColor=Y)}else(Y=(P=F.meshRender.material).baseColor).elements=O,P.baseColor=Y},P._getMeshRenderSharedMaterialDissolve=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.dissolve:0}return F.meshRender.sharedMaterial.dissolve},P._setMeshRenderSharedMaterialDissolve=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.dissolve=O[0])}else F.meshRender.material.dissolve=O[0]},P._getMeshRenderSharedMaterialDissolveSpeed=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.dissolveSpeed:0}return F.meshRender.sharedMaterial.dissolveSpeed},P._setMeshRenderSharedMaterialDissolveSpeed=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.dissolveSpeed=O[0])}else F.meshRender.material.dissolveSpeed=O[0]},P._getMeshRenderSharedMaterialMMultiplier=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.mMultiplier:0}return F.meshRender.sharedMaterial.mMultiplier},P._setMeshRenderSharedMaterialMMultiplier=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.mMultiplier=O[0])}else F.meshRender.material.mMultiplier=O[0]},P._getMeshRenderSharedMaterialBaseScrollSpeedX=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return F.meshRender.sharedMaterial.baseScrollSpeedX},P._setMeshRenderSharedMaterialBaseScrollSpeedX=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.baseScrollSpeedX=O[0])}else F.meshRender.material.baseScrollSpeedX=O[0]},P._getMeshRenderSharedMaterialBaseScrollSpeedY=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return F.meshRender.sharedMaterial.baseScrollSpeedY},P._setMeshRenderSharedMaterialBaseScrollSpeedY=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.baseScrollSpeedY=O[0])}else F.meshRender.material.baseScrollSpeedY=O[0]},P._getMeshRenderSharedMaterialSecondScrollSpeedX=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return F.meshRender.sharedMaterial.secondScrollSpeedX},P._setMeshRenderSharedMaterialSecondScrollSpeedX=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.secondScrollSpeedX=O[0])}else F.meshRender.material.secondScrollSpeedX=O[0]},P._getMeshRenderSharedMaterialSecondScrollSpeedY=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return F.meshRender.sharedMaterial.secondScrollSpeedY},P._setMeshRenderSharedMaterialSecondScrollSpeedY=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.secondScrollSpeedY=O[0])}else F.meshRender.material.secondScrollSpeedY=O[0]},P._getMeshRenderSharedMaterialAlpha=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.alpha:0}return F.meshRender.sharedMaterial.alpha},P._setMeshRenderSharedMaterialAlpha=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.alpha=O[0])}else F.meshRender.material.alpha=O[0]},P._getMeshRenderSharedMaterialIntensity=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.intensity:0}return F.meshRender.sharedMaterial.intensity},P._setMeshRenderSharedMaterialIntensity=function(U,F,O){if(U){var P=U.transform._entity;P&&(P.owner.meshRender.material.intensity=O[0])}else F.meshRender.material.intensity=O[0]},P._getMeshRenderSharedMaterialDetailTilingOffset=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return F.meshRender.sharedMaterial.detailTilingOffset.elements},P._setMeshRenderSharedMaterialDetailTilingOffset=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).detailTilingOffset).elements=O,P.detailTilingOffset=Y)}else(Y=(P=F.meshRender.material).detailTilingOffset).elements=O,P.detailTilingOffset=Y},P._getMeshRenderSharedMaterialDissolveTilingOffset=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return F.meshRender.sharedMaterial.dissolveTilingOffset.elements},P._setMeshRenderSharedMaterialDissolveTilingOffset=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).dissolveTilingOffset).elements=O,P.dissolveTilingOffset=Y)}else(Y=(P=F.meshRender.material).dissolveTilingOffset).elements=O,P.dissolveTilingOffset=Y},P._getMeshRenderSharedMaterialMaskTilingOffset=function(U,F){if(U){var O=U.transform._entity;return O?O.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return F.meshRender.sharedMaterial.maskTilingOffset.elements},P._setMeshRenderSharedMaterialMaskTilingOffset=function(U,F,O){var P,Y;if(U){var c=U.transform._entity;c&&((Y=(P=c.owner.meshRender.material).maskTilingOffset).elements=O,P.maskTilingOffset=Y)}else(Y=(P=F.meshRender.material).maskTilingOffset).elements=O,P.maskTilingOffset=Y},P._propertyIDCounter=0,P._propertyIndexDic={},P._propertySetFuncs=[],P._propertyGetFuncs=[],P}(),R=function(){function U(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return w(U,"laya.d3.animation.Keyframe"),U}(),_=function(){function U(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return w(U,"laya.d3.animation.KeyframeNode"),U}(),y=(function(){function U(){this._tempVector30=new LF,this._tempVector31=new LF,this._tempVector32=new LF,this._a=new LF,this._b=new LF,this._c=new LF,this._d=new LF}w(U,"laya.d3.core.glitter.SplineCurvePositionVelocity");var F=U.prototype;F.Init=function(U,F,O,P){U.cloneTo(this._d),F.cloneTo(this._c),LF.scale(U,2,this._a),LF.scale(O,2,this._tempVector30),LF.subtract(this._a,this._tempVector30,this._a),LF.add(this._a,F,this._a),LF.add(this._a,P,this._a),LF.scale(O,3,this._b),LF.scale(U,3,this._tempVector30),LF.subtract(this._b,this._tempVector30,this._b),LF.subtract(this._b,P,this._b),LF.scale(F,2,this._tempVector30),LF.subtract(this._b,this._tempVector30,this._b)},F.Slerp=function(U,F){LF.scale(this._a,U*U*U,this._tempVector30),LF.scale(this._b,U*U,this._tempVector31),LF.scale(this._c,U,this._tempVector32),LF.add(this._tempVector30,this._tempVector31,F),LF.add(F,this._tempVector32,F),LF.add(F,this._d,F)}}(),function(){function V(U,F,O,P){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=U,this._h=F,this._minHeight=O,this._maxHeight=P}w(V,"laya.d3.core.HeightMap");var U=V.prototype;U._inBounds=function(U,F){return 0<=U&&U<this._h&&0<=F&&F<this._w},U.getHeight=function(U,F){return this._inBounds(U,F)?this._datas[U][F]:NaN},j(0,U,"width",function(){return this._w}),j(0,U,"height",function(){return this._h}),j(0,U,"maxHeight",function(){return this._maxHeight}),j(0,U,"minHeight",function(){return this._minHeight}),V.creatFromMesh=function(U,F,O,P){for(var Y=[],c=[],L=U.getSubMeshCount(),u=0;u<L;u++){for(var d=U.getSubMesh(u),a=d._getVertexBuffer(),b=a.getData(),z=[],J=0;J<b.length;J+=a.vertexDeclaration.vertexStride/4){var w=new LF(b[J+0],b[J+1],b[J+2]);z.push(w)}Y.push(z);var j=d._getIndexBuffer();c.push(j.getData())}var x=U.boundingBox,r=x.min.x,H=x.min.z,h=x.max.x,Q=x.max.z,X=x.min.y,N=x.max.y,K=h-r,f=Q-H,I=P.elements[0]=K/(F-1),T=P.elements[1]=f/(O-1),g=new V(F,O,X,N),l=V._tempRay,$=l.direction.elements;$[0]=0,$[1]=-1,$[2]=0;var C=N+.1;l.origin.elements[1]=C;for(var s=0;s<O;s++){var i=H+s*T;g._datas[s]=[];for(var y=0;y<F;y++){var k=r+y*I,A=l.origin.elements;A[0]=k,A[2]=i;var G=V._getPosition(l,Y,c);g._datas[s][y]=G===Number.MAX_VALUE?NaN:C-G}}return g},V.createFromImage=function(U,F,O){for(var P=U.width,Y=U.height,c=new V(P,Y,F,O),L=(O-F)/254,u=U.getPixels(),d=0,a=0;a<Y;a++)for(var b=c._datas[a]=[],z=0;z<P;z++){var J=u[d++],w=u[d++],j=u[d++],x=u[d++];b[z]=255==J&&255==w&&255==j&&255==x?NaN:(J+w+j)/3*L+F}return c},V._getPosition=function(U,F,O){for(var P=Number.MAX_VALUE,Y=0;Y<F.length;Y++)for(var c=F[Y],L=O[Y],u=0;u<L.length;u+=3){var d=c[L[u+0]],a=c[L[u+1]],b=c[L[u+2]],z=jF.rayIntersectsTriangle(U,d,a,b);!isNaN(z)&&z<P&&(P=z)}return P},z(V,["_tempRay",function(){return this._tempRay=new YF(new LF,new LF)}])}(),function(){function Y(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}w(Y,"laya.d3.core.Layer");var U=Y.prototype;return U._binarySearchIndex=function(){for(var U=0,F=Y._collsionTestList.length-1,O=0;U<=F;){O=Math.floor((U+F)/2);var P=Y._collsionTestList[O];if(P==this._number)return O;P>this._number?F=O-1:U=O+1}return U},U._addCollider=function(U){0===this._colliders.length&&Y._collsionTestList.splice(this._binarySearchIndex(),0,this._number),U._isRigidbody?(this._colliders.unshift(U),this._nonRigidbodyOffset++):this._colliders.push(U)},U._removeCollider=function(U){var F=this._colliders.indexOf(U);F<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(F,1),0===this._colliders.length&&Y._collsionTestList.splice(Y._collsionTestList.indexOf(this._number),1)},j(0,U,"number",function(){return this._number}),j(0,U,"visible",function(){return this._visible},function(U){this._visible=U,Y._visibleLayers=U?Y._visibleLayers|this.mask:Y._visibleLayers&~this.mask}),j(0,U,"mask",function(){return this._mask}),j(1,Y,"visibleLayers",function(){return Y._visibleLayers},function(U){Y._visibleLayers=U;for(var F=0,O=Y._layerList.length;F<O;F++){var P=Y._layerList[F];P._visible=0!=(P._mask&Y._visibleLayers)}}),Y.__init__=function(){Y._layerList.length=31;for(var U=0;U<31;U++){var F=new Y;Y._layerList[U]=F,0===U?(F.name="Default Layer",F.visible=!0):(F.name="Layer-"+U,F.visible=!1),F._number=U,F._mask=Math.pow(2,U)}Y.currentCreationLayer=Y._layerList[0]},Y.getLayerByNumber=function(U){if(U<0||30<U)throw new Error("无法返回指定Layer，该number超出范围！");return Y._layerList[U]},Y.getLayerByName=function(U){for(var F=0;F<31;F++)if(Y._layerList[F].name===U)return Y._layerList[F];throw new Error("无法返回指定Layer,该name不存在")},Y.isVisible=function(U){return 0!=(U&Y._currentCameraCullingMask&Y._visibleLayers)},Y._layerList=[],Y._visibleLayers=2147483647,Y._collsionTestList=[],Y._currentCameraCullingMask=2147483647,Y.maxCount=31,Y.currentCreationLayer=null,Y}()),k=(function(){function U(U,F,O){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=U,this._minCount=F,this._maxCount=O}w(U,"laya.d3.core.particleShuriKen.module.Burst");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.cloneTo=function(U){var F=U;F._time=this._time,F._minCount=this._minCount,F._maxCount=this._maxCount},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"time",function(){return this._time}),j(0,F,"minCount",function(){return this._minCount}),j(0,F,"maxCount",function(){return this._maxCount})}(),function(){function U(U){this._color=null,this.enbale=!1,this._color=U}w(U,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var F=U.prototype;F.cloneTo=function(U){var F=U;this._color.cloneTo(F._color),F.enbale=this.enbale},F.clone=function(){var U;switch(this._color.type){case 0:U=G.createByConstant(this._color.constant.clone());break;case 1:U=G.createByGradient(this._color.gradient.clone());break;case 2:U=G.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:U=G.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var F=new this.constructor(U);return F.enbale=this.enbale,F},j(0,F,"color",function(){return this._color})}(),function(){function U(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}w(U,"laya.d3.core.particleShuriKen.module.Emission");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),F._destroy=function(){this._bursts=null,this._destroyed=!0},F.getBurstsCount=function(){return this._bursts.length},F.getBurstByIndex=function(U){return this._bursts[U]},F.addBurst=function(U){var F=this._bursts.length;if(0<F)for(var O=0;O<F;O++)this._bursts[O].time>U.time&&this._bursts.splice(O,0,U);this._bursts.push(U)},F.removeBurst=function(U){var F=this._bursts.indexOf(U);-1!==F&&this._bursts.splice(F,1)},F.removeBurstByIndex=function(U){this._bursts.splice(U,1)},F.clearBurst=function(){this._bursts.length=0},F.cloneTo=function(U){var F=U,O=F._bursts;O.length=this._bursts.length;for(var P=0,Y=this._bursts.length;P<Y;P++){var c=O[P];c?this._bursts[P].cloneTo(c):O[P]=this._bursts[P].clone()}F._emissionRate=this._emissionRate,F.enbale=this.enbale},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"destroyed",function(){return this._destroyed}),j(0,F,"emissionRate",function(){return this._emissionRate},function(U){if(U<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=U})}(),function(){function P(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}w(P,"laya.d3.core.particleShuriKen.module.FrameOverTime");var U=P.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.cloneTo=function(U){var F=U;F._type=this._type,F._constant=this._constant,this._overTime.cloneTo(F._overTime),F._constantMin=this._constantMin,F._constantMax=this._constantMax,this._overTimeMin.cloneTo(F._overTimeMin),this._overTimeMax.cloneTo(F._overTimeMax)},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,U,"frameOverTimeData",function(){return this._overTime}),j(0,U,"constant",function(){return this._constant}),j(0,U,"type",function(){return this._type}),j(0,U,"frameOverTimeDataMin",function(){return this._overTimeMin}),j(0,U,"constantMin",function(){return this._constantMin}),j(0,U,"frameOverTimeDataMax",function(){return this._overTimeMax}),j(0,U,"constantMax",function(){return this._constantMax}),P.createByConstant=function(U){var F=new P;return F._type=0,F._constant=U,F},P.createByOverTime=function(U){var F=new P;return F._type=1,F._overTime=U,F},P.createByRandomTwoConstant=function(U,F){var O=new P;return O._type=2,O._constantMin=U,O._constantMax=F,O},P.createByRandomTwoOverTime=function(U,F){var O=new P;return O._type=3,O._overTimeMin=U,O._overTimeMax=F,O},P}()),A=function(){function a(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}w(a,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var U=a.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.cloneTo=function(U){var F=U;F._type=this._type,F._separateAxes=this._separateAxes,F._constant=this._constant,this._constantSeparate.cloneTo(F._constantSeparate),this._gradient.cloneTo(F._gradient),this._gradientX.cloneTo(F._gradientX),this._gradientY.cloneTo(F._gradientY),this._gradientZ.cloneTo(F._gradientZ),F._constantMin=this._constantMin,F._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(F._constantMinSeparate),this._constantMaxSeparate.cloneTo(F._constantMaxSeparate),this._gradientMin.cloneTo(F._gradientMin),this._gradientMax.cloneTo(F._gradientMax),this._gradientXMin.cloneTo(F._gradientXMin),this._gradientXMax.cloneTo(F._gradientXMax),this._gradientYMin.cloneTo(F._gradientYMin),this._gradientYMax.cloneTo(F._gradientYMax),this._gradientZMin.cloneTo(F._gradientZMin),this._gradientZMax.cloneTo(F._gradientZMax)},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,U,"gradientZ",function(){return this._gradientZ}),j(0,U,"constant",function(){return this._constant}),j(0,U,"gradient",function(){return this._gradient}),j(0,U,"separateAxes",function(){return this._separateAxes}),j(0,U,"type",function(){return this._type}),j(0,U,"constantSeparate",function(){return this._constantSeparate}),j(0,U,"gradientX",function(){return this._gradientX}),j(0,U,"gradientY",function(){return this._gradientY}),j(0,U,"gradientW",function(){return this._gradientW}),j(0,U,"gradientMin",function(){return this._gradientMin}),j(0,U,"constantMin",function(){return this._constantMin}),j(0,U,"gradientMax",function(){return this._gradientMax}),j(0,U,"constantMax",function(){return this._constantMax}),j(0,U,"gradientWMin",function(){return this._gradientWMin}),j(0,U,"constantMinSeparate",function(){return this._constantMinSeparate}),j(0,U,"constantMaxSeparate",function(){return this._constantMaxSeparate}),j(0,U,"gradientXMin",function(){return this._gradientXMin}),j(0,U,"gradientXMax",function(){return this._gradientXMax}),j(0,U,"gradientWMax",function(){return this._gradientWMax}),j(0,U,"gradientYMin",function(){return this._gradientYMin}),j(0,U,"gradientYMax",function(){return this._gradientYMax}),j(0,U,"gradientZMin",function(){return this._gradientZMin}),j(0,U,"gradientZMax",function(){return this._gradientZMax}),a.createByConstant=function(U){var F=new a;return F._type=0,F._separateAxes=!1,F._constant=U,F},a.createByConstantSeparate=function(U){var F=new a;return F._type=0,F._separateAxes=!0,F._constantSeparate=U,F},a.createByGradient=function(U){var F=new a;return F._type=1,F._separateAxes=!1,F._gradient=U,F},a.createByGradientSeparate=function(U,F,O,P){var Y=new a;return Y._type=1,Y._separateAxes=!0,Y._gradientX=U,Y._gradientY=F,Y._gradientZ=O,Y._gradientW=P,Y},a.createByRandomTwoConstant=function(U,F){var O=new a;return O._type=2,O._separateAxes=!1,O._constantMin=U,O._constantMax=F,O},a.createByRandomTwoConstantSeparate=function(U,F){var O=new a;return O._type=2,O._separateAxes=!0,O._constantMinSeparate=U,O._constantMaxSeparate=F,O},a.createByRandomTwoGradient=function(U,F){var O=new a;return O._type=3,O._separateAxes=!1,O._gradientMin=U,O._gradientMax=F,O},a.createByRandomTwoGradientSeparate=function(U,F,O,P,Y,c,L,u){var d=new a;return d._type=3,d._separateAxes=!0,d._gradientXMin=U,d._gradientXMax=F,d._gradientYMin=O,d._gradientYMax=P,d._gradientZMin=Y,d._gradientZMax=c,d._gradientWMin=L,d._gradientWMax=u,d},a}(),G=function(){function P(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}w(P,"laya.d3.core.particleShuriKen.module.GradientColor");var U=P.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.cloneTo=function(U){var F=U;F._type=this._type,this._constant.cloneTo(F._constant),this._constantMin.cloneTo(F._constantMin),this._constantMax.cloneTo(F._constantMax),this._gradient.cloneTo(F._gradient),this._gradientMin.cloneTo(F._gradientMin),this._gradientMax.cloneTo(F._gradientMax)},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,U,"gradient",function(){return this._gradient}),j(0,U,"constant",function(){return this._constant}),j(0,U,"type",function(){return this._type}),j(0,U,"gradientMin",function(){return this._gradientMin}),j(0,U,"constantMin",function(){return this._constantMin}),j(0,U,"gradientMax",function(){return this._gradientMax}),j(0,U,"constantMax",function(){return this._constantMax}),P.createByConstant=function(U){var F=new P;return F._type=0,F._constant=U,F},P.createByGradient=function(U){var F=new P;return F._type=1,F._gradient=U,F},P.createByRandomTwoConstant=function(U,F){var O=new P;return O._type=2,O._constantMin=U,O._constantMax=F,O},P.createByRandomTwoGradient=function(U,F){var O=new P;return O._type=3,O._gradientMin=U,O._gradientMax=F,O},P}(),V=(function(){function U(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}w(U,"laya.d3.core.particleShuriKen.module.GradientDataColor");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.addAlpha=function(U,F){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==U&&(U=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=U,this._alphaElements[this._alphaCurrentLength++]=F):DEBUG},F.addRGB=function(U,F){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==U&&(U=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=U,this._rgbElements[this._rgbCurrentLength++]=F.x,this._rgbElements[this._rgbCurrentLength++]=F.y,this._rgbElements[this._rgbCurrentLength++]=F.z):DEBUG},F.cloneTo=function(U){var F=U,O=0,P=0;F._alphaCurrentLength=this._alphaCurrentLength;var Y=F._alphaElements;for(Y.length=this._alphaElements.length,O=0,P=this._alphaElements.length;O<P;O++)Y[O]=this._alphaElements[O];F._rgbCurrentLength=this._rgbCurrentLength;var c=F._rgbElements;for(c.length=this._rgbElements.length,O=0,P=this._rgbElements.length;O<P;O++)c[O]=this._rgbElements[O]},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),j(0,F,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function U(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}w(U,"laya.d3.core.particleShuriKen.module.GradientDataInt");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.add=function(U,F){this._currentLength<8?(6===this._currentLength&&1!==U&&(U=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=U,this._elements[this._currentLength++]=F):console.log("Warning:data count must lessEqual than 4")},F.cloneTo=function(U){var F=U;F._currentLength=this._currentLength;var O=F._elements;O.length=this._elements.length;for(var P=0,Y=this._elements.length;P<Y;P++)O[P]=this._elements[P]},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"gradientCount",function(){return this._currentLength/2})}(),function(){function U(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}w(U,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.add=function(U,F){this._currentLength<8?(6===this._currentLength&&1!==U&&(U=1,DEBUG),this._elements[this._currentLength++]=U,this._elements[this._currentLength++]=F):DEBUG},F.getKeyByIndex=function(U){return this._elements[2*U]},F.getValueByIndex=function(U){return this._elements[2*U+1]},F.getAverageValue=function(){for(var U=0,F=this._currentLength-2;U<F;U+=2){this._elements[U+1];this._elements[U+3],this._elements[U+2]-this._elements[U]}return 0},F.cloneTo=function(U){var F=U;F._currentLength=this._currentLength;var O=F._elements;O.length=this._elements.length;for(var P=0,Y=this._elements.length;P<Y;P++)O[P]=this._elements[P]},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"gradientCount",function(){return this._currentLength/2})}(),function(){function U(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}w(U,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.add=function(U,F){this._currentLength<8?(6===this._currentLength&&1!==U&&(U=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=U,this._elements[this._currentLength++]=F.x,this._elements[this._currentLength++]=F.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},F.cloneTo=function(U){var F=U;F._currentLength=this._currentLength;var O=F._elements;O.length=this._elements.length;for(var P=0,Y=this._elements.length;P<Y;P++)O[P]=this._elements[P]},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"gradientCount",function(){return this._currentLength/3})}(),function(){function u(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}w(u,"laya.d3.core.particleShuriKen.module.GradientSize");var U=u.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.getMaxSizeInGradient=function(){var U=0,F=0,O=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(U=0,F=this._gradientX.gradientCount;U<F;U++)O=Math.max(O,this._gradientX.getValueByIndex(U));for(U=0,F=this._gradientY.gradientCount;U<F;U++)O=Math.max(O,this._gradientY.getValueByIndex(U))}else for(U=0,F=this._gradient.gradientCount;U<F;U++)O=Math.max(O,this._gradient.getValueByIndex(U));break;case 1:O=this._separateAxes?(O=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),O=Math.max(O,this._constantMinSeparate.y),Math.max(O,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(U=0,F=this._gradientXMin.gradientCount;U<F;U++)O=Math.max(O,this._gradientXMin.getValueByIndex(U));for(U=0,F=this._gradientXMax.gradientCount;U<F;U++)O=Math.max(O,this._gradientXMax.getValueByIndex(U));for(U=0,F=this._gradientYMin.gradientCount;U<F;U++)O=Math.max(O,this._gradientYMin.getValueByIndex(U));for(U=0,F=this._gradientZMax.gradientCount;U<F;U++)O=Math.max(O,this._gradientZMax.getValueByIndex(U))}else{for(U=0,F=this._gradientMin.gradientCount;U<F;U++)O=Math.max(O,this._gradientMin.getValueByIndex(U));for(U=0,F=this._gradientMax.gradientCount;U<F;U++)O=Math.max(O,this._gradientMax.getValueByIndex(U))}}return O},U.cloneTo=function(U){var F=U;F._type=this._type,F._separateAxes=this._separateAxes,this._gradient.cloneTo(F._gradient),this._gradientX.cloneTo(F._gradientX),this._gradientY.cloneTo(F._gradientY),this._gradientZ.cloneTo(F._gradientZ),F._constantMin=this._constantMin,F._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(F._constantMinSeparate),this._constantMaxSeparate.cloneTo(F._constantMaxSeparate),this._gradientMin.cloneTo(F._gradientMin),this._gradientMax.cloneTo(F._gradientMax),this._gradientXMin.cloneTo(F._gradientXMin),this._gradientXMax.cloneTo(F._gradientXMax),this._gradientYMin.cloneTo(F._gradientYMin),this._gradientYMax.cloneTo(F._gradientYMax),this._gradientZMin.cloneTo(F._gradientZMin),this._gradientZMax.cloneTo(F._gradientZMax)},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,U,"gradientZ",function(){return this._gradientZ}),j(0,U,"gradient",function(){return this._gradient}),j(0,U,"separateAxes",function(){return this._separateAxes}),j(0,U,"type",function(){return this._type}),j(0,U,"gradientMin",function(){return this._gradientMin}),j(0,U,"constantMin",function(){return this._constantMin}),j(0,U,"gradientX",function(){return this._gradientX}),j(0,U,"gradientY",function(){return this._gradientY}),j(0,U,"gradientMax",function(){return this._gradientMax}),j(0,U,"constantMax",function(){return this._constantMax}),j(0,U,"constantMinSeparate",function(){return this._constantMinSeparate}),j(0,U,"constantMaxSeparate",function(){return this._constantMaxSeparate}),j(0,U,"gradientXMin",function(){return this._gradientXMin}),j(0,U,"gradientXMax",function(){return this._gradientXMax}),j(0,U,"gradientYMin",function(){return this._gradientYMin}),j(0,U,"gradientYMax",function(){return this._gradientYMax}),j(0,U,"gradientZMin",function(){return this._gradientZMin}),j(0,U,"gradientZMax",function(){return this._gradientZMax}),u.createByGradient=function(U){var F=new u;return F._type=0,F._separateAxes=!1,F._gradient=U,F},u.createByGradientSeparate=function(U,F,O){var P=new u;return P._type=0,P._separateAxes=!0,P._gradientX=U,P._gradientY=F,P._gradientZ=O,P},u.createByRandomTwoConstant=function(U,F){var O=new u;return O._type=1,O._separateAxes=!1,O._constantMin=U,O._constantMax=F,O},u.createByRandomTwoConstantSeparate=function(U,F){var O=new u;return O._type=1,O._separateAxes=!0,O._constantMinSeparate=U,O._constantMaxSeparate=F,O},u.createByRandomTwoGradient=function(U,F){var O=new u;return O._type=2,O._separateAxes=!1,O._gradientMin=U,O._gradientMax=F,O},u.createByRandomTwoGradientSeparate=function(U,F,O,P,Y,c){var L=new u;return L._type=2,L._separateAxes=!0,L._gradientXMin=U,L._gradientXMax=F,L._gradientYMin=O,L._gradientYMax=P,L._gradientZMin=Y,L._gradientZMax=c,L},u}()),M=function(){function u(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}w(u,"laya.d3.core.particleShuriKen.module.GradientVelocity");var U=u.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.cloneTo=function(U){var F=U;F._type=this._type,this._constant.cloneTo(F._constant),this._gradientX.cloneTo(F._gradientX),this._gradientY.cloneTo(F._gradientY),this._gradientZ.cloneTo(F._gradientZ),this._constantMin.cloneTo(F._constantMin),this._constantMax.cloneTo(F._constantMax),this._gradientXMin.cloneTo(F._gradientXMin),this._gradientXMax.cloneTo(F._gradientXMax),this._gradientYMin.cloneTo(F._gradientYMin),this._gradientYMax.cloneTo(F._gradientYMax),this._gradientZMin.cloneTo(F._gradientZMin),this._gradientZMax.cloneTo(F._gradientZMax)},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,U,"gradientZ",function(){return this._gradientZ}),j(0,U,"constant",function(){return this._constant}),j(0,U,"type",function(){return this._type}),j(0,U,"gradientXMax",function(){return this._gradientXMax}),j(0,U,"constantMin",function(){return this._constantMin}),j(0,U,"gradientX",function(){return this._gradientX}),j(0,U,"gradientY",function(){return this._gradientY}),j(0,U,"gradientXMin",function(){return this._gradientXMin}),j(0,U,"constantMax",function(){return this._constantMax}),j(0,U,"gradientYMin",function(){return this._gradientYMin}),j(0,U,"gradientYMax",function(){return this._gradientYMax}),j(0,U,"gradientZMin",function(){return this._gradientZMin}),j(0,U,"gradientZMax",function(){return this._gradientZMax}),u.createByConstant=function(U){var F=new u;return F._type=0,F._constant=U,F},u.createByGradient=function(U,F,O){var P=new u;return P._type=1,P._gradientX=U,P._gradientY=F,P._gradientZ=O,P},u.createByRandomTwoConstant=function(U,F){var O=new u;return O._type=2,O._constantMin=U,O._constantMax=F,O},u.createByRandomTwoGradient=function(U,F,O,P,Y,c){var L=new u;return L._type=3,L._gradientXMin=U,L._gradientXMax=F,L._gradientYMin=O,L._gradientYMax=P,L._gradientZMin=Y,L._gradientZMax=c,L},u}(),m=(function(){function U(U){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=U}w(U,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.cloneTo=function(U){var F=U;this._angularVelocity.cloneTo(F._angularVelocity),F.enbale=this.enbale},F.clone=function(){var U;switch(this._angularVelocity.type){case 0:U=this._angularVelocity.separateAxes?A.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):A.createByConstant(this._angularVelocity.constant);break;case 1:U=this._angularVelocity.separateAxes?A.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):A.createByGradient(this._angularVelocity.gradient.clone());break;case 2:U=this._angularVelocity.separateAxes?A.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):A.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:U=this._angularVelocity.separateAxes?A.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):A.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var F=new this.constructor(U);return F.enbale=this.enbale,F},j(0,F,"angularVelocity",function(){return this._angularVelocity})}(),function(){function U(){this.enable=!1,this.randomDirection=!1}w(U,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var F=U.prototype;return N.imps(F,{"laya.d3.core.IClone":!0}),F._getShapeBoundBox=function(U){throw new Error("BaseShape: must override it.")},F._getSpeedBoundBox=function(U){throw new Error("BaseShape: must override it.")},F.generatePositionAndDirection=function(U,F,O,P){throw new Error("BaseShape: must override it.")},F._calculateProceduralBounds=function(U,F,O){this._getShapeBoundBox(U);var P=U.min,Y=U.max;LF.multiply(P,F,P),LF.multiply(Y,F,Y);var c=new tU(new LF,new LF);this.randomDirection?(c.min=new LF(-1,-1,-1),c.max=new LF(1,1,1)):this._getSpeedBoundBox(c);var L=new tU(new LF,new LF),u=L.min,d=L.max;LF.scale(c.min,O.y,u),LF.scale(c.max,O.y,d),LF.add(U.min,u,u),LF.add(U.max,d,d),LF.min(U.min,u,U.min),LF.max(U.max,u,U.max);var a=new tU(new LF,new LF),b=a.min,z=a.max;LF.scale(c.min,O.x,b),LF.scale(c.max,O.x,z),LF.min(a.min,z,u),LF.max(a.min,z,d),LF.min(U.min,u,U.min),LF.max(U.max,u,U.max)},F.cloneTo=function(U){U.enable=this.enable},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},U}()),q=function(){function c(){}return w(c,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),c._randomPointUnitArcCircle=function(U,F,O){var P=F.elements,Y=NaN;Y=O?O.getFloat()*U:Math.random()*U,P[0]=Math.cos(Y),P[1]=Math.sin(Y)},c._randomPointInsideUnitArcCircle=function(U,F,O){var P=F.elements;c._randomPointUnitArcCircle(U,F,O);var Y=NaN;Y=O?Math.pow(O.getFloat(),.5):Math.pow(Math.random(),.5),P[0]=P[0]*Y,P[1]=P[1]*Y},c._randomPointUnitCircle=function(U,F){var O=U.elements,P=NaN;P=F?F.getFloat()*Math.PI*2:Math.random()*Math.PI*2,O[0]=Math.cos(P),O[1]=Math.sin(P)},c._randomPointInsideUnitCircle=function(U,F){var O=U.elements;c._randomPointUnitCircle(U);var P=NaN;P=F?Math.pow(F.getFloat(),.5):Math.pow(Math.random(),.5),O[0]=O[0]*P,O[1]=O[1]*P},c._randomPointUnitSphere=function(U,F){var O=U.elements,P=NaN,Y=NaN;Y=F?(P=O[2]=2*F.getFloat()-1,F.getFloat()*Math.PI*2):(P=O[2]=2*Math.random()-1,Math.random()*Math.PI*2);var c=Math.sqrt(1-P*P);O[0]=c*Math.cos(Y),O[1]=c*Math.sin(Y)},c._randomPointInsideUnitSphere=function(U,F){var O=U.elements;c._randomPointUnitSphere(U);var P=NaN;P=F?Math.pow(F.getFloat(),1/3):Math.pow(Math.random(),1/3),O[0]=O[0]*P,O[1]=O[1]*P,O[2]=O[2]*P},c._randomPointInsideHalfUnitBox=function(U,F){var O=U.elements;F?(O[0]=F.getFloat()-.5,O[1]=F.getFloat()-.5,O[2]=F.getFloat()-.5):(O[0]=Math.random()-.5,O[1]=Math.random()-.5,O[2]=Math.random()-.5)},c}(),D=(function(){function U(U){this._size=null,this.enbale=!1,this._size=U}w(U,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.cloneTo=function(U){var F=U;this._size.cloneTo(F._size),F.enbale=this.enbale},F.clone=function(){var U;switch(this._size.type){case 0:U=this._size.separateAxes?V.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):V.createByGradient(this._size.gradient.clone());break;case 1:U=this._size.separateAxes?V.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):V.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:U=this._size.separateAxes?V.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):V.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var F=new this.constructor(U);return F.enbale=this.enbale,F},j(0,F,"size",function(){return this._size})}(),function(){function P(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}w(P,"laya.d3.core.particleShuriKen.module.StartFrame");var U=P.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.cloneTo=function(U){var F=U;F._type=this._type,F._constant=this._constant,F._constantMin=this._constantMin,F._constantMax=this._constantMax},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,U,"constant",function(){return this._constant}),j(0,U,"type",function(){return this._type}),j(0,U,"constantMin",function(){return this._constantMin}),j(0,U,"constantMax",function(){return this._constantMax}),P.createByConstant=function(U){var F=new P;return F._type=0,F._constant=U,F},P.createByRandomTwoConstant=function(U,F){var O=new P;return O._type=1,O._constantMin=U,O._constantMax=F,O},P}()),Z=(function(){function U(U,F){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new cF(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=U,this._startFrame=F}w(U,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.cloneTo=function(U){var F=U;this.tiles.cloneTo(F.tiles),F.type=this.type,F.randomRow=this.randomRow,this._frame.cloneTo(F._frame),this._startFrame.cloneTo(F._startFrame),F.cycles=this.cycles,F.enableUVChannels=this.enableUVChannels,F.enable=this.enable},F.clone=function(){var U,F;switch(this._frame.type){case 0:U=k.createByConstant(this._frame.constant);break;case 1:U=k.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:U=k.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:U=k.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:F=D.createByConstant(this._startFrame.constant);break;case 1:F=D.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var O=new this.constructor(U,F);return this.tiles.cloneTo(O.tiles),O.type=this.type,O.randomRow=this.randomRow,O.cycles=this.cycles,O.enableUVChannels=this.enableUVChannels,O.enable=this.enable,O},j(0,F,"frame",function(){return this._frame}),j(0,F,"startFrame",function(){return this._startFrame})}(),function(){function U(U){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=U}w(U,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var F=U.prototype;N.imps(F,{"laya.d3.core.IClone":!0}),F.cloneTo=function(U){var F=U;this._velocity.cloneTo(F._velocity),F.enbale=this.enbale,F.space=this.space},F.clone=function(){var U;switch(this._velocity.type){case 0:U=M.createByConstant(this._velocity.constant.clone());break;case 1:U=M.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:U=M.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:U=M.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var F=new this.constructor(U);return F.enbale=this.enbale,F.space=this.space,F},j(0,F,"velocity",function(){return this._velocity})}(),function(){function U(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new JF,this._vb=mF.create(U._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=MF.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=GF.nameKey.getID("LINE"),this._shaderCompile=IF._preCompileShader[this._sharderNameID]}w(U,"laya.d3.core.PhasorSpriter3D");var F=U.prototype;return F.line=function(U,F,O,P){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(U.x,U.y,U.z,F.x,F.y,F.z,F.w),this.addVertex(O.x,O.y,O.z,P.x,P.y,P.z,P.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},F.circle=function(U,F,O,P,Y,c){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*F,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/F,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*U,Math.cos(this._tempNumver0)*U,0,O,P,Y,c),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},F.plane=function(U,F,O,P,Y,c,L,u,d){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=P/2,this._tempNumver1=Y/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(U-this._tempNumver0,F+this._tempNumver1,O,c,L,u,d),this.addVertex(U+this._tempNumver0,F+this._tempNumver1,O,c,L,u,d),this.addVertex(U-this._tempNumver0,F-this._tempNumver1,O,c,L,u,d),this.addVertex(U+this._tempNumver0,F-this._tempNumver1,O,c,L,u,d),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},F.box=function(U,F,O,P,Y,c,L,u,d,a){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=P/2,this._tempNumver1=Y/2,this._tempNumver2=c/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(U-this._tempNumver0,F+this._tempNumver1,O+this._tempNumver2,L,u,d,a),this.addVertex(U+this._tempNumver0,F+this._tempNumver1,O+this._tempNumver2,L,u,d,a),this.addVertex(U-this._tempNumver0,F-this._tempNumver1,O+this._tempNumver2,L,u,d,a),this.addVertex(U+this._tempNumver0,F-this._tempNumver1,O+this._tempNumver2,L,u,d,a),this.addVertex(U+this._tempNumver0,F+this._tempNumver1,O-this._tempNumver2,L,u,d,a),this.addVertex(U-this._tempNumver0,F+this._tempNumver1,O-this._tempNumver2,L,u,d,a),this.addVertex(U+this._tempNumver0,F-this._tempNumver1,O-this._tempNumver2,L,u,d,a),this.addVertex(U-this._tempNumver0,F-this._tempNumver1,O-this._tempNumver2,L,u,d,a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},F.cone=function(U,F,O,P,Y,c,L){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*O+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*O>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/O,this.addVertexIndex(0,F,0,P,Y,c,L,this._tempUint0),this.addVertexIndex(0,0,0,P,Y,c,L,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<O;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(U*this._tempNumver2,0,U*this._tempNumver3,P,Y,c,L,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==O-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(U*this._tempNumver2,0,U*this._tempNumver3,P,Y,c,L,this._tempUint0+(this._tempInt0+O)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==O-1?this.addIndexes(this._tempUint1+O+2):this.addIndexes(this._tempUint1+this._tempInt0+O+1),this.addIndexes(this._tempUint1+this._tempInt0+O),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},F.boundingBoxLine=function(U,F,O,P,Y,c,L,u,d,a){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(U,Y,c,L,u,d,a),this.addVertex(P,Y,c,L,u,d,a),this.addVertex(U,F,c,L,u,d,a),this.addVertex(P,F,c,L,u,d,a),this.addVertex(P,Y,O,L,u,d,a),this.addVertex(U,Y,O,L,u,d,a),this.addVertex(P,F,O,L,u,d,a),this.addVertex(U,F,O,L,u,d,a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},F.addVertex=function(U,F,O,P,Y,c,L){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=U,this._vbData[this._posInVBData+1]=F,this._vbData[this._posInVBData+2]=O,this._vbData[this._posInVBData+3]=P,this._vbData[this._posInVBData+4]=Y,this._vbData[this._posInVBData+5]=c,this._vbData[this._posInVBData+6]=L,this._posInVBData+=this._floatSizePerVer,this},F.addVertexIndex=function(U,F,O,P,Y,c,L,u){return this._hasBegun||this.addVertexIndexException(),this._vbData[u]=U,this._vbData[u+1]=F,this._vbData[u+2]=O,this._vbData[u+3]=P,this._vbData[u+4]=Y,this._vbData[u+5]=c,this._vbData[u+6]=L,(u+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=u),this},F.addIndexes=function(U){var F=arguments;this._hasBegun||this.addVertexIndexException();for(var O=0;O<F.length;O++)this._ibData[this._posInIBData]=F[O],this._posInIBData++;return this},F.begin=function(U,F){return this._hasBegun&&this.beginException0(),1!==U&&4!==U&&this.beginException1(),this._primitiveType=U,this._camera=F,this._hasBegun=!0,this},F.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},F.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(U._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),I.drawCall++,C.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},F.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},F.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},F.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},F.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},F.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},F.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(28,[new LU(0,"vector3",0),new LU(12,"vector4",1)])}]),U}()),e=function(){function U(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++U._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new JF}w(U,"laya.d3.core.render.RenderElement");var F=U.prototype;return F.getDynamicBatchBakedVertexs=function(U){for(var F=this._renderObj._getVertexBuffer(U),O=F.getData().slice(),P=F.vertexDeclaration,Y=P.getVertexElementByUsage(0).offset/4,c=P.getVertexElementByUsage(3).offset/4,L=this._sprite3D.transform,u=L.worldMatrix,d=L.rotation,a=P.vertexStride/4,b=0,z=O.length;b<z;b+=a){var J=b+Y,w=b+c;rF.transformVector3ArrayToVector3ArrayCoordinate(O,J,u,O,J),rF.transformVector3ArrayByQuat(O,w,d,O,w)}return O},F.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},F._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},j(0,F,"id",function(){return this._id}),j(0,F,"renderObj",function(){return this._renderObj},function(U){this._renderObj!==U&&(this._renderObj=U)}),U._uniqueIDCounter=0,U}(),v=function(){function F(U){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++F._uniqueIDCounter,this._needSort=!1,this._scene=U,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}w(F,"laya.d3.core.render.RenderQueue");var U=F.prototype;return U._sortOpaqueFunc=function(U,F){if(U._render&&F._render){var O=U._material.renderQueue-F._material.renderQueue;return 0==O?U._render._distanceForSort-F._render._distanceForSort:O}return 0},U._sortAlphaFunc=function(U,F){if(U._render&&F._render){var O=U._material.renderQueue-F._material.renderQueue;return 0==O?F._render._distanceForSort-U._render._distanceForSort:O}return 0},U._begainRenderElement=function(U,F,O){return!!F._beforeRender(U)},U._sortAlpha=function(U){F._cameraPosition=U,this._finalElements.sort(this._sortAlphaFunc)},U._sortOpaque=function(U){F._cameraPosition=U,this._finalElements.sort(this._sortOpaqueFunc)},U._preRender=function(U){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},U._render=function(U,F){for(var O,P,Y,c,L,u,d=I.loopCount,a=this._scene,b=U.camera,z=(b.id,!1),J=0,w=this._finalElements.length;J<w;J++){var j,x,r,H=this._finalElements[J];if(null!=H._onPreRenderFunction&&H._onPreRenderFunction.call(H._sprite3D,U),0===H._type){if(U.owner=r=H._sprite3D,U.renderElement=H,r._preRenderUpdateComponents(U),j=H.renderObj,x=H._material,this._begainRenderElement(U,j,x)){if(O=j._getVertexBuffers(),!(Y=(P=j._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[P.id]){this._errorRecord[P.id]=1;var h="vertexBuffer:"+("("+P._destroyed+","+P._released+","+P._referenceCount+","+P._buffer+")")+", material:"+(x?x.__className+"("+x._destroyed+","+x._released+")":"null")+", owner:"+(r?r.__className+"("+r._destroyed+","+r._activeInHierarchy+","+r._displayedInStage+")":"null")+", renderObj:"+(j?j.__className+"("+j._destroyed+","+j._released+","+j._referenceCount+")":"")+", parent:, url:"+(r?r.url:"")+", disposeStack:"+P.disposeStack;N.recordError("报错：unknown vertexDeclaration  "+h)}continue}if(z=(c=U._shader=x._getShader(a._shaderDefineValue,Y.shaderDefineValue,r._shaderDefineValue)).bind()||d!==c._uploadLoopCount,O){if(c._uploadVertexBuffer!==O||z){for(var Q=0;Q<O.length;Q++){var X=O[Q];c.uploadAttributesX(X.vertexDeclaration.shaderValues.data,X)}c._uploadVertexBuffer=O}}else(c._uploadVertexBuffer!==P||z)&&(c.uploadAttributes(Y.shaderValues.data,null),c._uploadVertexBuffer=P);(c._uploadScene!==a||z)&&(c.uploadSceneUniforms(a._shaderValues.data),c._uploadScene=a),(b!==c._uploadCamera||c._uploadSprite3D!==r||z)&&(c.uploadSpriteUniforms(r._shaderValues.data),c._uploadSprite3D=r),(b!==c._uploadCamera||z)&&(c.uploadCameraUniforms(b._shaderValues.data),c._uploadCamera=b),(c._uploadMaterial!==x||z)&&(x._upload(),c._uploadMaterial=x),L!==x?(x._setRenderStateBlendDepth(),x._setRenderStateFrontFace(F,r.transform),L=x,u=r):u!==r&&(x._setRenderStateFrontFace(F,r.transform),u=r),j._render(U),c._uploadLoopCount=d}r._postRenderUpdateComponents(U)}else if(2===H._type){H.renderObj;U.owner=r=H._sprite3D,U.renderElement=H,U._batchIndexStart=H._tempBatchIndexStart,U._batchIndexEnd=H._tempBatchIndexEnd,j=H.renderObj,x=H._material,this._begainRenderElement(U,j,x)&&(Y=(P=j._getVertexBuffer(0)).vertexDeclaration,z=(c=U._shader=x._getShader(a._shaderDefineValue,Y.shaderDefineValue,r._shaderDefineValue)).bind()||d!==c._uploadLoopCount,(c._uploadVertexBuffer!==P||z)&&(c.uploadAttributes(Y.shaderValues.data,null),c._uploadVertexBuffer=P),(c._uploadScene!==a||z)&&(c.uploadSceneUniforms(a._shaderValues.data),c._uploadScene=a),(b!==c._uploadCamera||c._uploadSprite3D!==r||z)&&(c.uploadSpriteUniforms(r._shaderValues.data),c._uploadSprite3D=r),(b!==c._uploadCamera||z)&&(c.uploadCameraUniforms(b._shaderValues.data),c._uploadCamera=b),(c._uploadMaterial!==x||z)&&(x._upload(),c._uploadMaterial=x),L!==x?(x._setRenderStateBlendDepth(),x._setRenderStateFrontFace(F,r.transform),L=x,u=r):u!==r&&(x._setRenderStateFrontFace(F,r.transform),u=r),j._render(U),c._uploadLoopCount=d)}}},U._renderShadow=function(U,F){for(var O,P,Y,c,L,u=I.loopCount,d=this._scene,a=U.camera,b=!1,z=0,J=this._finalElements.length;z<J;z++){var w,j,x,r=this._finalElements[z];0===r._type&&(U.owner=x=r._sprite3D,F||x._projectionViewWorldUpdateCamera===a&&x._projectionViewWorldUpdateLoopCount===I.loopCount||(x._render._renderUpdate(U._projectionViewMatrix),x._projectionViewWorldUpdateLoopCount=I.loopCount,x._projectionViewWorldUpdateCamera=a),U.renderElement=r,x._preRenderUpdateComponents(U),w=r.renderObj,j=r._material,this._begainRenderElement(U,w,null)&&(P=(O=w._getVertexBuffer(0)).vertexDeclaration,b=(Y=U._shader=j._getShader(d._shaderDefineValue,P.shaderDefineValue,x._shaderDefineValue)).bind()||u!==Y._uploadLoopCount,(Y._uploadVertexBuffer!==O||b)&&(Y.uploadAttributes(P.shaderValues.data,null),Y._uploadVertexBuffer=O),(a!==Y._uploadCamera||Y._uploadSprite3D!==x||b)&&(Y.uploadSpriteUniforms(x._shaderValues.data),Y._uploadSprite3D=x),(a!==Y._uploadCamera||b)&&(Y.uploadCameraUniforms(a._shaderValues.data),Y._uploadCamera=a),(Y._uploadMaterial!==j||b)&&(j._upload(),Y._uploadMaterial=j),Y._uploadRenderElement,c!==j?(j._setRenderStateFrontFace(!1,x.transform),c=j,L=x):L!==x&&(j._setRenderStateFrontFace(!1,x.transform),L=x),w._render(U),Y._uploadLoopCount=u),x._postRenderUpdateComponents(U))}},U._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},U._addRenderElement=function(U){this._renderElements.push(U),this._needSort=!0},U._addDynamicBatchElement=function(U){this._dynamicBatchCombineRenderElements.push(U)},j(0,U,"id",function(){return this._id}),F._uniqueIDCounter=0,F._cameraPosition=null,F}(),n=function(){function U(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return w(U,"laya.d3.core.render.RenderState"),U.clientWidth=0,U.clientHeight=0,U}(),t=function(){function L(U,F){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new WU(new LF,0),this._corners=[new LF,new LF,new LF,new LF,new LF,new LF,new LF,new LF],this._boundingBoxCenter=new LF,this._children=P(8),this._objects=[],this._tempBoundBoxCorners=[new LF,new LF,new LF,new LF,new LF,new LF,new LF,new LF],this._scene=U,this._currentDepth=F}w(L,"laya.d3.core.scene.OctreeNode");var U=L.prototype;return N.imps(U,{"laya.d3.core.scene.ITreeNode":!0}),U.init=function(U,F){var O=new LF,P=new LF;LF.scale(F,-.5,O),LF.scale(F,.5,P),LF.add(O,U,O),LF.add(P,U,P),this.exactBox=new tU(O,P),this.relaxBox=new tU(O,P)},U.addTreeNode=function(U){1===Collision.boxContainsBox(this._relaxBox,U.boundingBox)?this.addNodeDown(U,0):this.addObject(U)},U.addChild=function(U){var F=this._children[U];if(null==F){F=new L(this._scene,this._currentDepth+1),(this._children[U]=F)._parent=this,LF.subtract(this._exactBox.max,this._exactBox.min,L.tempSize),LF.multiply(L.tempSize,L._octreeSplit[U],L.tempCenter),LF.add(this._exactBox.min,L.tempCenter,L.tempCenter),LF.scale(L.tempSize,.25,L.tempSize);var O=new LF,P=new LF;LF.subtract(L.tempCenter,L.tempSize,O),LF.add(L.tempCenter,L.tempSize,P),F.exactBox=new tU(O,P),LF.scale(L.tempSize,L.relax,L.tempSize);var Y=new LF,c=new LF;LF.subtract(L.tempCenter,L.tempSize,Y),LF.add(L.tempCenter,L.tempSize,c),F.relaxBox=new tU(Y,c)}return F},U.addObject=function(U){(U._treeNode=this)._objects.push(U)},U.removeObject=function(U){if(U._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var F=this._objects.indexOf(U);return-1!==F&&(this._objects.splice(F,1),!0)},U.clearObject=function(){this._objects.length=0},U.addNodeUp=function(U,F){this._parent&&1!==Collision.boxContainsBox(this._exactBox,U.boundingBox)?this._parent.addNodeUp(U,F-1):this.addNodeDown(U,F)},U.addNodeDown=function(U,F){if(F<this._scene.treeLevel){var O=this.inChildIndex(U.boundingBoxCenter),P=this.addChild(O);1===Collision.boxContainsBox(P._relaxBox,U.boundingBox)?P.addNodeDown(U,++F):this.addObject(U)}else this.addObject(U)},U.inChildIndex=function(U){return 4*(U.z<this._boundingBoxCenter.z?0:1)+2*(U.y<this._boundingBoxCenter.y?0:1)+(U.x<this._boundingBoxCenter.x?0:1)},U.updateObject=function(U){1===Collision.boxContainsBox(this._relaxBox,U.boundingBox)?(this.removeObject(U),U._treeNode=null,this.addNodeDown(U,this._currentDepth)):this._parent&&(this.removeObject(U),U._treeNode=null,this._parent.addNodeUp(U,this._currentDepth-1))},U.cullingObjects=function(U,F,O,P,Y){var c,L=0,u=0,d=0,a=this._scene._dynamicBatchManager;for(L=0,c=this._objects.length;L<c;L++){var b=this._objects[L];if(y.isVisible(b._owner.layer.mask)&&b.enable){if(F&&(I.treeSpriteCollision+=1,0===U.containsBoundSphere(b.boundingSphere)))continue;b._renderUpdate(Y),b._distanceForSort=LF.distance(b.boundingSphere.center,P)+b.sortingFudge;var z=b._renderElements;for(u=0,d=z.length;u<d;u++){var J=z[u],w=J._staticBatch;if(w&&w._material===J._material)w._addBatchRenderElement(J);else{var j=J.renderObj;j.triangleCount<10&&1===j._vertexBufferCount&&j._getIndexBuffer()&&J._material.renderQueue<2&&J._canDynamicBatch&&!b._owner.isStatic?a._addPrepareRenderElement(J):this._scene.getRenderQueue(J._material.renderQueue)._addRenderElement(J)}}}}for(L=0;L<8;L++){var x=this._children[L];if(null!=x){var r=F;if(F){var H=U.containsBoundBox(x._relaxBox);if(I.treeNodeCollision+=1,0===H)continue;r=2===H}x.cullingObjects(U,r,O,P,Y)}}},U.cullingShadowObjects=function(U,F,O,P,Y){var c,L=0,u=0,d=0;this._scene._dynamicBatchManager;for(L=0,c=this._objects.length;L<c;L++){var a=this._objects[L];if(a.castShadow&&y.isVisible(a._owner.layer.mask)&&a.enable){if(O&&0===U[0].containsBoundSphere(a.boundingSphere))continue;for(var b=1,z=U.length;b<z;b++){var J=F[b-1];if(0!==U[b].containsBoundSphere(a.boundingSphere)){var w=a._renderElements;for(u=0,d=w.length;u<d;u++)J._addRenderElement(w[u])}}}}for(L=0;L<8;L++){var j=this._children[L];if(null!=j){var x=O;if(O){var r=U[0].containsBoundBox(j._relaxBox);if(0===r)continue;x=2===r}j.cullingShadowObjects(U,F,x,P,Y)}}},U.cullingShadowObjectsOnePSSM=function(U,F,O,P,Y,c){var L,u=F[0],d=0,a=0,b=0;for(d=0,L=this._objects.length;d<L;d++){var z=this._objects[d];if(z.castShadow&&y.isVisible(z._owner.layer.mask)&&z.enable){if(P&&0===U.containsBoundSphere(z.boundingSphere))continue;z._renderUpdate(O);var J=z._renderElements;for(a=0,b=J.length;a<b;a++)u._addRenderElement(J[a])}}for(d=0;d<8;d++){var w=this._children[d];if(null!=w){var j=P;if(P){var x=U.containsBoundBox(w._relaxBox);if(0===x)continue;j=2===x}w.cullingShadowObjectsOnePSSM(U,F,O,j,Y,c)}}},U.renderBoudingBox=function(U){this._renderBoudingBox(U);for(var F=0;F<8;++F){var O=this._children[F];O&&O.renderBoudingBox(U)}},U.buildAllChild=function(U){if(U<this._scene.treeLevel)for(var F=0;F<8;F++){this.addChild(F).buildAllChild(U+1)}},U._renderBoudingBox=function(U){},j(0,U,"exactBox",function(){return this._exactBox},function(U){this._exactBox=U,LF.add(U.min,U.max,this._boundingBoxCenter),LF.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),j(0,U,"relaxBox",function(){return this._relaxBox},function(U){(this._relaxBox=U).getCorners(this._corners),WU.createfromPoints(this._corners,this._boundingSphere)}),L.debugMode=!1,L.relax=1.15,L.CHILDNUM=8,z(L,["tempVector0",function(){return this.tempVector0=new LF},"tempSize",function(){return this.tempSize=new LF},"tempCenter",function(){return this.tempCenter=new LF},"_octreeSplit",function(){return this._octreeSplit=[new LF(.25,.25,.25),new LF(.75,.25,.25),new LF(.25,.75,.25),new LF(.75,.75,.25),new LF(.25,.25,.75),new LF(.75,.25,.75),new LF(.25,.75,.75),new LF(.75,.75,.75)]}]),L}(),S=(function(){function U(){}w(U,"laya.d3.core.scene.SceneManager")}(),function(){function U(U,F,O,P){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===U&&(U=1),void 0===F&&(F=1),void 0===O&&(O=1),void 0===P&&(P=1),this._r=U,this._g=F,this._b=O,this._a=P}return w(U,"laya.d3.core.trail.module.Color",null,"Color$1"),U.prototype.cloneTo=function(U){U._r=this._r,U._g=this._g,U._b=this._b,U._a=this._a},z(U,["RED",function(){return this.RED=new U(1,0,0,1)},"GREEN",function(){return this.GREEN=new U(0,1,0,1)},"BLUE",function(){return this.BLUE=new U(0,0,1,1)},"CYAN",function(){return this.CYAN=new U(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new U(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new U(1,0,1,1)},"GRAY",function(){return this.GRAY=new U(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new U(1,1,1,1)},"BLACK",function(){return this.BLACK=new U(0,0,0,1)}]),U}()),W=(function(){function U(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}w(U,"laya.d3.core.trail.module.Gradient");var F=U.prototype;F.setKeys=function(U,F){var O,P;this._colorKeys=U;for(var Y=this.index=0;Y<U.length;Y++){var c=(O=U[Y]).color;this._colorKeyData[this.index++]=c._r,this._colorKeyData[this.index++]=c._g,this._colorKeyData[this.index++]=c._b,this._colorKeyData[this.index++]=O.time}this._alphaKeys=F;for(var L=this.index=0;L<F.length;L++)P=F[L],this._alphaKeyData[this.index++]=P.alpha,this._alphaKeyData[this.index++]=P.time},F.cloneTo=function(U){var F=0,O=0,P=this.colorKeys,Y=[];for(F=0,O=P.length;F<O;F++){var c=new B;P[F].cloneTo(c),Y.push(c)}var L=this.alphaKeys,u=[];for(F=0,O=L.length;F<O;F++){var d=new W;L[F].cloneTo(d),u.push(d)}U.setKeys(Y,u)},j(0,F,"mode",function(){return this._mode},function(U){this._mode=U}),j(0,F,"colorKeys",function(){return this._colorKeys},function(U){this._colorKeys=U;for(var F=this.index=0;F<U.length;F++){var O=U[F],P=O.color;this._colorKeyData[this.index++]=P._r,this._colorKeyData[this.index++]=P._g,this._colorKeyData[this.index++]=P._b,this._colorKeyData[this.index++]=O.time}}),j(0,F,"alphaKeys",function(){return this._alphaKeys},function(U){this._alphaKeys=U;for(var F=this.index=0;F<U.length;F++){var O=U[F];this._alphaKeyData[this.index++]=O.alpha,this._alphaKeyData[this.index++]=O.time}})}(),function(){function U(U,F){this._alpha=NaN,this._time=NaN,void 0===U&&(U=0),void 0===F&&(F=0),this._alpha=U,this._time=F}w(U,"laya.d3.core.trail.module.GradientAlphaKey");var F=U.prototype;return F.cloneTo=function(U){U.alpha=this.alpha,U.time=this.time},j(0,F,"alpha",function(){return this._alpha},function(U){this._alpha=U}),j(0,F,"time",function(){return this._time},function(U){this._time=U}),U}()),B=function(){function U(U,F){this._color=null,this._time=NaN,void 0===F&&(F=0),this._color=U||new S,this._time=F}w(U,"laya.d3.core.trail.module.GradientColorKey");var F=U.prototype;return F.cloneTo=function(U){this.color.cloneTo(U.color),U.time=this.time},j(0,F,"color",function(){return this._color},function(U){this._color=U}),j(0,F,"time",function(){return this._time},function(U){this._time=U}),U}(),E=(function(){function U(){}w(U,"laya.d3.core.trail.module.GradientMode"),U.Blend=0,U.Fixed=1}(),function(){function U(){}w(U,"laya.d3.core.trail.module.TextureMode"),U.Stretch=0,U.Tile=1}(),function(){function U(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}w(U,"laya.d3.core.trail.module.TrailKeyFrame"),U.prototype.cloneTo=function(U){U.time=this.time,U.inTangent=this.inTangent,U.outTangent=this.outTangent,U.value=this.value}}(),function(){function F(U){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new LF,this._curPosition=new LF,this._delVector3=new LF,this._lastFixedVertexPosition=new LF,this._pointAtoBVector3=new LF,this._pointA=new LF,this._pointB=new LF,this._owner=U,this._id=F.renderElementCount++,0==this._id?U._owner.transform.position.cloneTo(this._lastPosition):U._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new mF(E.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new mF(E.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}w(F,"laya.d3.core.trail.TrailRenderElement");var U=F.prototype;N.imps(U,{"laya.d3.core.render.IRenderable":!0}),U._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},U._addTrailByFirstPosition=function(U,F){LF.subtract(F,U,this._delVector3),LF.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),LF.normalize(this._pointAtoBVector3,this._pointAtoBVector3),LF.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(U),U.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},U._addTrailByNextPosition=function(U){LF.subtract(U,this._lastFixedVertexPosition,this._delVector3),LF.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),LF.normalize(this._pointAtoBVector3,this._pointAtoBVector3),LF.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=LF.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=BU.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(U),U.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(U),this._virtualVerticesCount=2)},U._updateVerticesByPosition=function(U){this._pointe=U.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},U._updateVertexBuffer2=function(){var U,F=0,O=0,P=0;for(P=0,U=(this._verticesCount+this._virtualVerticesCount)/2;P<U;P++)O=0==this._owner.textureMode?(this._VerticesToTailLength[P]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[P],this._vertices2[F++]=1-O,this._vertices2[F++]=1-O;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},U._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},U._updateDisappear=function(){var U,F=0;for(F=this._curDisappearIndex,U=(this._verticesCount+this._virtualVerticesCount)/2;F<U;F++)this._owner._curtime-this._everyGroupVertexBirthTime[F]>=this._owner.time+BU.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},U._beforeRender=function(U){return this._camera=U.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),LF.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},U._render=function(U){this._isDead||(C.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),I.drawCall++,I.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},U._getVertexBuffer=function(U){return void 0===U&&(U=0),0===U?this._vertexBuffer1:1===U?this._vertexBuffer2:null},U._getVertexBuffers=function(){return this._vertexBuffers},U._getIndexBuffer=function(){return null},U.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},U._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},j(0,U,"_vertexBufferCount",function(){return this._vertexBuffers.length}),j(0,U,"triangleCount",function(){return 0}),F.renderElementCount=0}(),function(){function U(){}w(U,"laya.d3.core.trail.VertexTrail");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration1}),j(1,U,"vertexDeclaration1",function(){return U._vertexDeclaration1}),j(1,U,"vertexDeclaration2",function(){return U._vertexDeclaration2}),z(U,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new cU(32,[new LU(0,"vector3",0),new LU(12,"vector3",41),new LU(24,"single",33),new LU(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new cU(4,[new LU(0,"single",38)])}]),U}()),UU=function(){function X(U){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=U}w(X,"laya.d3.graphics.DynamicBatch");var U=X.prototype;return N.imps(U,{"laya.d3.core.render.IRenderable":!0}),U._getVertexBuffer=function(U){return void 0===U&&(U=0),0===U?this._vertexBuffer:null},U._getIndexBuffer=function(){return this._indexBuffer},U._getCombineRenderElementFromPool=function(U,F,O){var P=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return P||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=P=new e,P._sprite3D=new vF),P._sprite3D._render._renderUpdate(O),P},U._getRenderElement=function(U,F,O){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*X.maxVertexCount),this._indexDatas=new Uint16Array(X.maxIndexCount),this._vertexBuffer=mF.create(this._vertexDeclaration,X.maxVertexCount,35048),this._indexBuffer=MF.create("ushort",X.maxIndexCount,35048));for(var P=this._merageElements.length=0,Y=0,c=0,L=this._combineRenderElements.length;c<L;c++){var u=this._combineRenderElements[c],d=u.getDynamicBatchBakedVertexs(0),a=u.getBakedIndices(),b=u._sprite3D.transform._isFrontFaceInvert,z=P/(this._vertexDeclaration.vertexStride/4),J=Y,w=J+a.length;u._tempBatchIndexStart=J,u._tempBatchIndexEnd=w,this._indexDatas.set(a,Y);var j=0;if(b)for(j=J;j<w;j+=3){this._indexDatas[j]=z+this._indexDatas[j];var x=this._indexDatas[j+1],r=this._indexDatas[j+2];this._indexDatas[j+1]=z+r,this._indexDatas[j+2]=z+x}else for(j=J;j<w;j+=3)this._indexDatas[j]=z+this._indexDatas[j],this._indexDatas[j+1]=z+this._indexDatas[j+1],this._indexDatas[j+2]=z+this._indexDatas[j+2];Y+=a.length,this._vertexDatas.set(d,P),P+=d.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),c=this._combineRenderElementPoolIndex=0,L=this._materials.length;c<L;c++){var H=this._getCombineRenderElementFromPool(U,F,O);H._type=2,H._staticBatch=null;var h=(H.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[c]]._tempBatchIndexStart,Q=c+1===this._materialToRenderElementsOffsets.length?Y:this._combineRenderElements[this._materialToRenderElementsOffsets[c+1]]._tempBatchIndexStart;H._tempBatchIndexStart=h,H._tempBatchIndexEnd=Q,H._material=this._materials[c],this._merageElements.push(H)}},U._addCombineRenderObjTest=function(U){var F=U.renderObj,O=this._currentCombineIndexCount+F._getIndexBuffer().indexCount,P=this._currentCombineVertexCount+F._getVertexBuffer().vertexCount;return!(X.maxVertexCount<P||X.maxIndexCount<O)},U._addCombineRenderObj=function(U){var F=U.renderObj;this._combineRenderElements.push(U),this._currentCombineIndexCount=this._currentCombineIndexCount+F._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+F._getVertexBuffer().vertexCount},U._addCombineMaterial=function(U){this._materials.push(U)},U._addMaterialToRenderElementOffset=function(U){this._materialToRenderElementsOffsets.push(U)},U._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},U._addToRenderQueue=function(U,F,O,P){this._getRenderElement(F,O,P);for(var Y=0,c=this._materials.length;Y<c;Y++)U.getRenderQueue(this._materials[Y].renderQueue)._addDynamicBatchElement(this._merageElements[Y])},U._beforeRender=function(U){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},U._render=function(U){var F=U._batchIndexEnd-U._batchIndexStart;C.mainContext.drawElements(4,F,5123,2*U._batchIndexStart),I.drawCall++,I.trianglesFaces+=F/3},U._getVertexBuffers=function(){return null},j(0,U,"_vertexBufferCount",function(){return 1}),j(0,U,"triangleCount",function(){return this._indexBuffer.indexCount/3}),j(0,U,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),X.maxVertexCount=2e4,X.maxIndexCount=4e4,X.maxCombineTriangleCount=10,X}(),FU=function(){function X(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}w(X,"laya.d3.graphics.DynamicBatchManager");var U=X.prototype;return U.getDynamicBatch=function(U,F){var O,P=U.id.toString()+F;return this._dynamicBatches[P]?O=this._dynamicBatches[P]:this._dynamicBatches[P]=O=new UU(U),O},U._garbageCollection=function(){for(var U in this._dynamicBatches)0===this._dynamicBatches[U].combineRenderElementsCount&&delete this._dynamicBatches[U]},U._addPrepareRenderElement=function(U){this._prepareDynamicBatchCombineElements.push(U)},U._finishCombineDynamicBatch=function(U){var F,O,P;this._prepareDynamicBatchCombineElements.sort(X._sortPrepareDynamicBatch);for(var Y,c,L,u,d,a=-1,b=!0,z=0,J=-1,w=0,j=this._prepareDynamicBatchCombineElements.length;w<j;w++){var x=(c=this._prepareDynamicBatchCombineElements[w]).renderObj._getVertexBuffer(0).vertexDeclaration,r=O!==x;r&&(z=0,O=x);var H=z!==a;if(H&&(a=z),(r||H)&&(L=this.getDynamicBatch(x,z),F=null),b)if(L._addCombineRenderObjTest(c)){if(F!==(Y=c._material))u&&(U.getRenderQueue(d._material.renderQueue)._addRenderElement(d),d=u=null,J=-1),u=Y,J=L.combineRenderElementsCount,d=c,F=Y;else if(u){var h=d.renderObj,Q=c.renderObj;h._getVertexBuffer().vertexCount+Q._getVertexBuffer().vertexCount>UU.maxVertexCount||h._getIndexBuffer().indexCount+Q._getIndexBuffer().indexCount>UU.maxIndexCount?(U.getRenderQueue(d._material.renderQueue)._addRenderElement(d),u=Y,J=L.combineRenderElementsCount,d=c):(L._addCombineMaterial(u),L._addMaterialToRenderElementOffset(J),L._addCombineRenderObj(d),d=u=null,J=-1,L._addCombineRenderObj(c))}else L._addCombineRenderObj(c);b=!0}else u&&(U.getRenderQueue(d._material.renderQueue)._addRenderElement(d),d=u=null,J=-1),z++,b=!1;else P=this._prepareDynamicBatchCombineElements[w-1],L._addMaterialToRenderElementOffset(L.combineRenderElementsCount),F=P._material,L._addCombineMaterial(F),L._addCombineRenderObj(P),b=!0,F!==(Y=c._material)?(u=Y,J=L.combineRenderElementsCount,d=c):L._addCombineRenderObj(c),F=Y}u&&(U.getRenderQueue(d._material.renderQueue)._addRenderElement(d),d=u=null,J=-1),this._prepareDynamicBatchCombineElements.length=0},U._clearRenderElements=function(){for(var U in this._dynamicBatches)this._dynamicBatches[U]._clearRenderElements()},U._addToRenderQueue=function(U,F,O,P){for(var Y in this._dynamicBatches){var c=this._dynamicBatches[Y];0<c.combineRenderElementsCount&&c._addToRenderQueue(U,F,O,P)}},U.dispose=function(){this._dynamicBatches=null},X._sortPrepareDynamicBatch=function(U,F){return U._mainSortID-F._mainSortID},X}(),OU=function(){function U(){}return w(U,"laya.d3.graphics.FrustumCulling"),U.renderShadowObjectCulling=function(U,F,O,P,Y){var c=0,L=0,u=0,d=0;for(c=0,u=O.length;c<u;c++){var a=O[c];a&&a._clearRenderElements()}var b,z,J,w=U._cullingRenders;if(1<Y){for(c=0,u=U._cullingRendersLength;c<u;c++)if((b=w[c]).castShadow&&y.isVisible(b._owner.layer.mask)&&b.enable)for(var j=1,x=F.length;j<x;j++)if(z=O[j-1],0!==F[j].containsBoundSphere(b.boundingSphere))for(L=0,d=(J=b._renderElements).length;L<d;L++)z._addRenderElement(J[L])}else for(c=0,u=U._cullingRendersLength;c<u;c++)if((b=w[c]).castShadow&&y.isVisible(b._owner.layer.mask)&&b.enable&&0!==F[0].containsBoundSphere(b.boundingSphere))for(b._renderUpdate(P),z=O[0],L=0,d=(J=b._renderElements).length;L<d;L++)z._addRenderElement(J[L])},U.renderShadowObjectCullingOctree=function(U,F,O,P,Y){for(var c=0,L=O.length;c<L;c++){var u=O[c];u&&u._clearRenderElements()}1<Y?U.treeRoot.cullingShadowObjects(F,O,!0,0,U):U.treeRoot.cullingShadowObjectsOnePSSM(F[0],O,P,!0,0,U)},U.renderObjectCulling=function(U,F,O,P,Y,c){var L=0,u=0,d=0,a=0,b=F._quenes,z=F._dynamicBatchManager,J=F._cullingRenders;for(L=0,u=b.length;L<u;L++){var w=b[L];w&&w._clearRenderElements()}var j=PU._staticBatchManagers;for(L=0,u=j.length;L<u;L++)j[L]._clearRenderElements();z._clearRenderElements();var x=O.transform.position;for(L=0,u=F._cullingRendersLength;L<u;L++){var r=J[L];if(y.isVisible(r._owner.layer.mask)&&r.enable&&0!==U.containsBoundSphere(r.boundingSphere)&&r._renderUpdate(c)){r._distanceForSort=LF.distance(r.boundingSphere.center,x)+r.sortingFudge;var H=r._renderElements;for(d=0,a=H.length;d<a;d++){var h=H[d],Q=h._staticBatch;if(Q&&Q._material===h._material)Q._addBatchRenderElement(h);else{var X=h.renderObj;X.triangleCount<10&&1===X._vertexBufferCount&&X._getIndexBuffer()&&h._material.renderQueue<2&&h._canDynamicBatch&&!r._owner.isStatic?z._addPrepareRenderElement(h):F.getRenderQueue(h._material.renderQueue)._addRenderElement(h)}}}}for(L=0,u=j.length;L<u;L++)j[L]._addToRenderQueue(F,P,Y,c);z._finishCombineDynamicBatch(F),z._addToRenderQueue(F,P,Y,c)},U.renderObjectCullingOctree=function(U,F,O,P,Y,c){var L=0,u=0,d=F._quenes,a=F._dynamicBatchManager;for(L=0,u=d.length;L<u;L++){var b=d[L];b&&b._clearRenderElements()}var z=PU._staticBatchManagers;for(L=0,u=z.length;L<u;L++)z[L]._clearRenderElements();for(a._clearRenderElements(),F._cullingRenders.length=0,F.treeRoot.cullingObjects(U,!0,0,O.transform.position,c),L=0,u=z.length;L<u;L++)z[L]._addToRenderQueue(F,P,Y,c);a._finishCombineDynamicBatch(F),a._addToRenderQueue(F,P,Y,c)},U.renderObjectCullingNoBoundFrustum=function(U,F,O,P,Y){var c=0,L=0,u=0,d=0,a=U._quenes,b=U._dynamicBatchManager,z=U._cullingRenders;for(c=0,L=a.length;c<L;c++){var J=a[c];J&&J._clearRenderElements()}var w=PU._staticBatchManagers;for(c=0,L=w.length;c<L;c++)w[c]._clearRenderElements();b._clearRenderElements();var j=F.transform.position;for(c=0,L=U._cullingRendersLength;c<L;c++){var x=z[c];if(y.isVisible(x._owner.layer.mask)&&x.enable){x._renderUpdate(Y),x._distanceForSort=LF.distance(x.boundingSphere.center,j)+x.sortingFudge;var r=x._renderElements;for(u=0,d=r.length;u<d;u++){var H=r[u],h=H._staticBatch;if(h&&h._material===H._material)h._addBatchRenderElement(H);else{var Q=H.renderObj;Q.triangleCount<10&&1===Q._vertexBufferCount&&Q._getIndexBuffer()&&H._material.renderQueue<2&&H._canDynamicBatch&&!x._owner.isStatic?b._addPrepareRenderElement(H):U.getRenderQueue(H._material.renderQueue)._addRenderElement(H)}}}}for(c=0,L=w.length;c<L;c++)w[c]._addToRenderQueue(U,O,P,Y);b._finishCombineDynamicBatch(U),b._addToRenderQueue(U,O,P,Y)},U}(),PU=function(){function c(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}w(c,"laya.d3.graphics.StaticBatchManager");var U=c.prototype;return U._finishInit=function(){for(var U in this._staticBatches)this._staticBatches[U]._finishInit();this._initBatchRenderElements.length=0},U._initStaticBatchs=function(U){throw new Error("StaticBatchManager:must override this function.")},U._addInitBatchSprite=function(U){for(var F=U._render._renderElements,O=0,P=F.length;O<P;O++)this._initBatchRenderElements.push(F[O])},U._clearRenderElements=function(){for(var U in this._staticBatches)this._staticBatches[U]._clearRenderElements()},U._garbageCollection=function(U){var F=U._staticBatch,O=F._initBatchRenderElements,P=O.indexOf(U);O.splice(P,1),0===O.length&&(F.dispose(),delete this._staticBatches[F._key])},U._addToRenderQueue=function(U,F,O,P){for(var Y in this._staticBatches){var c=this._staticBatches[Y];0<c._batchRenderElements.length&&c._updateToRenderQueue(U,P)}},U.dispose=function(){this._staticBatches=null},c._addToStaticBatchQueue=function(U){U instanceof laya.d3.core.RenderableSprite3D&&U._addToInitStaticBatchManager();for(var F=0,O=U.numChildren;F<O;F++)c._addToStaticBatchQueue(U._childs[F])},c.combine=function(U,F){var O,P=0,Y=0;if(F)for(P=0,Y=F.length;P<Y;P++){F[P]._addToInitStaticBatchManager()}else U&&c._addToStaticBatchQueue(U);for(P=0,Y=c._staticBatchManagers.length;P<Y;P++)(O=c._staticBatchManagers[P])._initStaticBatchs(U),O._finishInit()},c._staticBatchManagers=[],c}(),YU=function(){function U(U,F,O){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=U,this._manager=F,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=O}w(U,"laya.d3.graphics.StaticBatch");var F=U.prototype;return N.imps(F,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),F._binarySearch=function(U){for(var F=0,O=this._batchRenderElements.length-1,P=0;F<=O;)P=Math.floor((F+O)/2),this._compareBatchRenderElement(this._batchRenderElements[P],U)?O=P-1:F=P+1;return F},F._compareBatchRenderElement=function(U,F){throw new Error("StaticBatch:must override this function.")},F._getVertexDecLightMap=function(U){return U===MU.vertexDeclaration?yU.vertexDeclaration:U===VU.vertexDeclaration?iU.vertexDeclaration:U===TU.vertexDeclaration?XU.vertexDeclaration:U===RU.vertexDeclaration?null:U===xU.vertexDeclaration?rU.vertexDeclaration:U===pU.vertexDeclaration?AU.vertexDeclaration:U===CU.vertexDeclaration?sU.vertexDeclaration:U===mU.vertexDeclaration?kU.vertexDeclaration:U===VU.vertexDeclaration?iU.vertexDeclaration:U===gU.vertexDeclaration?NU.vertexDeclaration:U===RU.vertexDeclaration?null:U===xU.vertexDeclaration?rU.vertexDeclaration:U===oU.vertexDeclaration?GU.vertexDeclaration:U===CU.vertexDeclaration?sU.vertexDeclaration:U},F._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},F._addBatchRenderElement=function(U){this._batchRenderElements.splice(this._binarySearch(U),0,U)},F._updateToRenderQueue=function(U,F){this._combineRenderElementPoolIndex=0,this._getRenderElement(U.getRenderQueue(this._material.renderQueue)._renderElements,U,F)},F._getRenderElement=function(U,F,O){throw new Error("StaticBatch:must override this function.")},F._finishInit=function(){throw new Error("StaticBatch:must override this function.")},F._clearRenderElements=function(){this._batchRenderElements.length=0},F.dispose=function(){},F._getVertexBuffer=function(U){return void 0===U&&(U=0),null},F._getIndexBuffer=function(){return null},F._beforeRender=function(U){return!0},F._render=function(U){},F._getVertexBuffers=function(){return null},j(0,F,"_vertexBufferCount",function(){return 1}),j(0,F,"triangleCount",function(){return 0}),U.combine=function(U){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),PU.combine(U)},U.maxBatchVertexCount=65535,U}(),cU=function(){function L(U,F){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++L._uniqueIDCounter,this._id>L.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",L.maxVertexDeclaration);this._shaderValues=new JF,this._vertexElementsDic={},this._vertexStride=U,this._vertexElements=F;for(var O=0;O<F.length;O++){var P=F[O],Y=P.elementUsage;this._vertexElementsDic[Y]=P;var c=[L._getTypeSize(P.elementFormat)/4,5126,!1,this._vertexStride,P.offset];switch(this._shaderValues.setValue(Y,c),Y){case 1:this._addShaderDefine(IF.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(IF.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(IF.SHADERDEFINE_UV1)}}}w(L,"laya.d3.graphics.VertexDeclaration");var U=L.prototype;return U._addShaderDefine=function(U){this._shaderDefineValue|=U},U._removeShaderDefine=function(U){this._shaderDefineValue&=~U},U.getVertexElements=function(){return this._vertexElements.slice()},U.getVertexElementByUsage=function(U){return this._vertexElementsDic[U]},U.unBinding=function(){},j(0,U,"shaderDefineValue",function(){return this._shaderDefineValue}),j(0,U,"id",function(){return this._id}),j(0,U,"vertexStride",function(){return this._vertexStride}),j(0,U,"shaderValues",function(){return this._shaderValues}),L._getTypeSize=function(U){switch(U){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},L.getVertexStride=function(U){for(var F=0,O=0;O<U.Length;O++){var P=U[O],Y=P.offset+L._getTypeSize(P.elementFormat);F<Y&&(F=Y)}return F},L._maxVertexDeclarationBit=1e3,L._uniqueIDCounter=1,z(L,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),L}(),LU=function(){function U(U,F,O){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=U,this.elementFormat=F,this.elementUsage=O}return w(U,"laya.d3.graphics.VertexElement"),U}(),uU=(function(){function U(){}w(U,"laya.d3.graphics.VertexElementFormat"),U.Single="single",U.Vector2="vector2",U.Vector3="vector3",U.Vector4="vector4",U.Color="color",U.Byte4="byte4",U.Short2="short2",U.Short4="short4",U.NormalizedShort2="normalizedshort2",U.NormalizedShort4="normalizedshort4",U.HalfVector2="halfvector2",U.HalfVector4="halfvector4"}(),function(){function U(){}w(U,"laya.d3.graphics.VertexElementUsage"),U.POSITION0=0,U.COLOR0=1,U.TEXTURECOORDINATE0=2,U.NORMAL0=3,U.BINORMAL0=4,U.TANGENT0=5,U.BLENDINDICES0=6,U.BLENDWEIGHT0=7,U.DEPTH0=8,U.FOG0=9,U.POINTSIZE0=10,U.SAMPLE0=11,U.TESSELLATEFACTOR0=12,U.COLOR1=13,U.NEXTTEXTURECOORDINATE0=14,U.TEXTURECOORDINATE1=15,U.NEXTTEXTURECOORDINATE1=16,U.CORNERTEXTURECOORDINATE0=17,U.VELOCITY0=18,U.STARTCOLOR0=19,U.STARTSIZE=20,U.AGEADDSCALE0=21,U.STARTROTATION=22,U.ENDCOLOR0=23,U.STARTLIFETIME=24,U.TIME0=33,U.SHAPEPOSITIONSTARTLIFETIME=30,U.DIRECTIONTIME=32,U.SIZEROTATION0=27,U.RADIUS0=28,U.RADIAN0=29,U.STARTSPEED=31,U.RANDOM0=34,U.RANDOM1=35,U.SIMULATIONWORLDPOSTION=36,U.SIMULATIONWORLDROTATION=37,U.TEXTURECOORDINATE0X=38,U.TEXTURECOORDINATE0X1=39,U.TEXTURECOORDINATE0Y=40,U.OFFSETVECTOR=41}(),function(){function U(U,F,O){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=U,this._textureCoordinate0=F,this._time=O}w(U,"laya.d3.graphics.VertexGlitter");var F=U.prototype;N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate0}),j(0,F,"position",function(){return this._position}),j(0,F,"time",function(){return this._time}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(24,[new LU(0,"vector3",0),new LU(12,"vector2",2),new LU(20,"single",33)])}])}(),function(){function U(U,F,O,P,Y,c,L,u,d,a){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=U,this._position=F,this._velocity=O,this._startColor=P,this._endColor=Y,this._sizeRotation=c,this._radius=L,this._radian=u,this._ageAddScale=d,this._time=a}w(U,"laya.d3.graphics.VertexParticle");var F=U.prototype;N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"endColor",function(){return this._endColor}),j(0,F,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),j(0,F,"sizeRotation",function(){return this._sizeRotation}),j(0,F,"velocity",function(){return this._velocity}),j(0,F,"position",function(){return this._position}),j(0,F,"startColor",function(){return this._startColor}),j(0,F,"radius",function(){return this._radius}),j(0,F,"radian",function(){return this._radian}),j(0,F,"ageAddScale",function(){return this._ageAddScale}),j(0,F,"time",function(){return this._time}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(116,[new LU(0,"vector4",17),new LU(16,"vector3",0),new LU(28,"vector3",18),new LU(40,"vector4",19),new LU(56,"vector4",23),new LU(72,"vector3",27),new LU(84,"vector2",28),new LU(92,"vector4",29),new LU(108,"single",24),new LU(112,"single",33)])}])}(),function(){function U(U){this._position=null,this._position=U}w(U,"laya.d3.graphics.VertexPosition");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(12,[new LU(0,"vector3",0)])}]),U}()),dU=function(){function U(U,F){this._position=null,this._normal=null,this._position=U,this._normal=F}w(U,"laya.d3.graphics.VertexPositionNormal");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(24,[new LU(0,"vector3",0),new LU(12,"vector3",3)])}]),U}(),aU=function(){function U(U,F,O){this._position=null,this._normal=null,this._color=null,this._position=U,this._normal=F,this._color=O}w(U,"laya.d3.graphics.VertexPositionNormalColor");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(40,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1)])}]),U}(),bU=function(){function U(U,F,O,P,Y){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=U,this._normal=F,this._color=O,this._blendIndex=P,this._blendWeight=Y}w(U,"laya.d3.graphics.VertexPositionNormalColorSkin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(72,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector4",7),new LU(56,"vector4",6)])}]),U}(),zU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._tangent=P,this._blendIndex=Y,this._blendWeight=c}w(U,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(88,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector4",7),new LU(56,"vector4",6),new LU(72,"vector4",5)])}]),U}(),JU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._tangent=P,this._blendIndex=Y,this._blendWeight=c}w(U,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(84,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector4",7),new LU(56,"vector4",6),new LU(72,"vector3",5)])}]),U}(),wU=function(){function U(U,F,O,P){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._tangent=P}w(U,"laya.d3.graphics.VertexPositionNormalColorSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(56,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector4",5)])}]),U}(),jU=function(){function U(U,F,O,P){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._tangent=P}w(U,"laya.d3.graphics.VertexPositionNormalColorTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(52,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector3",5)])}]),U}(),xU=function(){function U(U,F,O,P){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate=P}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(48,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2)])}]),U}(),rU=function(){function U(U,F,O,P,Y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate0=P,this._textureCoordinate1=Y}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(56,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector2",15)])}]),U}(),HU=function(){function U(U,F,O,P,Y,c,L){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate0=P,this._textureCoordinate1=Y,this._blendIndex=c,this._blendWeight=L}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(88,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector2",15),new LU(56,"vector4",7),new LU(72,"vector4",6)])}]),U}(),hU=function(){function U(U,F,O,P,Y,c,L,u){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate0=P,this._textureCoordinate1=Y,this._tangent=c,this._blendIndex=L,this._blendWeight=u}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(104,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector2",15),new LU(56,"vector4",7),new LU(72,"vector4",6),new LU(88,"vector4",5)])}]),U}(),QU=function(){function U(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),F.VertexPositionNormalColorTexture0SkinTangent=function(U,F,O,P,Y,c,L,u){this._position=U,this._normal=F,this._color=O,this._textureCoordinate0=P,this._textureCoordinate1=Y,this._tangent=c,this._blendIndex=L,this._blendWeight=u},j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(100,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector2",15),new LU(56,"vector4",7),new LU(72,"vector4",6),new LU(88,"vector3",5)])}]),U}(),XU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate0=P,this._textureCoordinate1=Y,this._tangent=c}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(72,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector2",15),new LU(56,"vector4",5)])}]),U}(),NU=function(){function U(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}w(U,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),F.VertexPositionNormalColorTexture0Tangent=function(U,F,O,P,Y,c){this._position=U,this._normal=F,this._color=O,this._textureCoordinate0=P,this._textureCoordinate1=Y,this._tangent=c},j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(68,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector2",15),new LU(56,"vector3",5)])}]),U}(),KU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate=P,this._blendIndex=Y,this._blendWeight=c}w(U,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(80,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector4",7),new LU(64,"vector4",6)])}]),U}(),fU=function(){function U(U,F,O,P,Y,c,L){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate=P,this._tangent=Y,this._blendIndex=c,this._blendWeight=L}w(U,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(96,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector4",7),new LU(64,"vector4",6),new LU(80,"vector4",5)])}]),U}(),IU=function(){function U(U,F,O,P,Y,c,L){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate=P,this._tangent=Y,this._blendIndex=c,this._blendWeight=L}w(U,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"color",function(){return this._color}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(92,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector4",7),new LU(64,"vector4",6),new LU(80,"vector3",5)])}]),U}(),TU=function(){function U(U,F,O,P,Y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate=P,this._tangent=Y}w(U,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(64,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector4",5)])}]),U}(),gU=function(){function U(U,F,O,P,Y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=U,this._normal=F,this._color=O,this._textureCoordinate=P,this._tangent=Y}w(U,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"color",function(){return this._color}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(60,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",1),new LU(40,"vector2",2),new LU(48,"vector3",5)])}]),U}(),lU=function(){function U(U,F,O){this._position=null,this._normal=null,this._tangent=null,this._position=U,this._normal=F,this._tangent=O}w(U,"laya.d3.graphics.VertexPositionNormalSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(40,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector4",5)])}]),U}(),$U=function(){function U(U,F,O){this._position=null,this._normal=null,this._tangent=null,this._position=U,this._normal=F,this._tangent=O}w(U,"laya.d3.graphics.VertexPositionNormalTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(36,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector3",5)])}]),U}(),CU=function(){function U(U,F,O){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=U,this._normal=F,this._textureCoordinate=O}w(U,"laya.d3.graphics.VertexPositionNormalTexture");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(32,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2)])}]),U}(),sU=function(){function U(U,F,O,P){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=U,this._normal=F,this._textureCoordinate0=O,this._textureCoordinate1=P}w(U,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(40,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15)])}]),U}(),iU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=U,this._normal=F,this._textureCoordinate0=O,this._textureCoordinate1=P,this._blendIndex=Y,this._blendWeight=c}w(U,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(72,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15),new LU(40,"vector4",7),new LU(56,"vector4",6)])}]),U}(),yU=function(){function U(U,F,O,P,Y,c,L){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._textureCoordinate0=O,this._textureCoordinate1=P,this._tangent=Y,this._blendIndex=c,this._blendWeight=L}w(U,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(88,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15),new LU(40,"vector4",7),new LU(56,"vector4",6),new LU(72,"vector4",5)])}]),U}(),kU=function(){function U(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}w(U,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),F.VertexPositionNormalTexture0SkinTangent=function(U,F,O,P,Y,c,L){this._position=U,this._normal=F,this._textureCoordinate0=O,this._textureCoordinate1=P,this._tangent=Y,this._blendIndex=c,this._blendWeight=L},j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(84,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15),new LU(40,"vector4",7),new LU(56,"vector4",6),new LU(72,"vector3",5)])}]),U}(),AU=function(){function U(U,F,O,P,Y){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=U,this._normal=F,this._textureCoordinate0=O,this._textureCoordinate1=P,this._tangent=Y}w(U,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(56,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15),new LU(40,"vector4",5)])}]),U}(),GU=function(){function U(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}w(U,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),F.VertexPositionNormalTexture0Tangent=function(U,F,O,P,Y){this._position=U,this._normal=F,this._textureCoordinate0=O,this._textureCoordinate1=P,this._tangent=Y},j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(52,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15),new LU(40,"vector3",5)])}]),U}(),VU=function(){function U(U,F,O,P,Y){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=U,this._normal=F,this._textureCoordinate=O,this._blendIndex=P,this._blendWeight=Y}w(U,"laya.d3.graphics.VertexPositionNormalTextureSkin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(64,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector4",7),new LU(48,"vector4",6)])}]),U}(),MU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._textureCoordinate=O,this._tangent=P,this._blendIndex=Y,this._blendWeight=c}w(U,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(80,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector4",7),new LU(48,"vector4",6),new LU(64,"vector4",5)])}]),U}(),mU=function(){function U(U,F,O,P,Y,c){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=U,this._normal=F,this._textureCoordinate=O,this._tangent=P,this._blendIndex=Y,this._blendWeight=c}w(U,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(76,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector4",7),new LU(48,"vector4",6),new LU(64,"vector3",5)])}]),U}(),pU=function(){function U(U,F,O,P){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=U,this._normal=F,this._textureCoordinate=O,this._tangent=P}w(U,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(48,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector4",5)])}]),U}(),oU=function(){function U(U,F,O,P){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=U,this._normal=F,this._textureCoordinate=O,this._tangent=P}w(U,"laya.d3.graphics.VertexPositionNormalTextureTangent");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(44,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector3",5)])}]),U}(),RU=function(){function U(U,F,O){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=U,this._normal=F,this._textureCoordinate=O}w(U,"laya.d3.graphics.VertexPositionNTBTexture");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(56,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector3",5),new LU(36,"vector3",4),new LU(48,"vector2",2)])}]),U}(),_U=function(){function U(U,F,O,P,Y,c,L,u){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=U,this._normal=F,this._textureCoordinate0=P,this._textureCoordinate1=Y,this._tangent=c,O=O,this._blendIndex=L,this._blendWeight=u}w(U,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"tangent",function(){return this._tangent}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(0,F,"textureCoordinate1",function(){return this._textureCoordinate1}),j(0,F,"blendIndex",function(){return this._blendIndex}),j(0,F,"blendWeight",function(){return this._blendWeight}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(96,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector3",5),new LU(36,"vector3",4),new LU(48,"vector2",2),new LU(56,"vector2",15),new LU(64,"vector4",7),new LU(80,"vector4",6)])}]),U}(),qU=function(){function U(U,F,O){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=U,this._normal=F,this._textureCoordinate=O}w(U,"laya.d3.graphics.VertexPositionNTBTextureSkin");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"textureCoordinate",function(){return this._textureCoordinate}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(88,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector3",5),new LU(36,"vector3",4),new LU(48,"vector2",2),new LU(56,"vector4",7),new LU(72,"vector4",6)])}]),U}(),DU=(function(){function U(U,F,O,P){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=U,this._normal=F,this._textureCoord0=O,this._textureCoord1=P}w(U,"laya.d3.graphics.VertexPositionTerrain");var F=U.prototype;N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"normal",function(){return this._normal}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoord0",function(){return this._textureCoord0}),j(0,F,"textureCoord1",function(){return this._textureCoord1}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(40,[new LU(0,"vector3",0),new LU(12,"vector3",3),new LU(24,"vector2",2),new LU(32,"vector2",15)])}])}(),function(){function U(U,F){this._position=null,this._textureCoordinate0=null,this._position=U,this._textureCoordinate0=F}w(U,"laya.d3.graphics.VertexPositionTexture0");var F=U.prototype;return N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"position",function(){return this._position}),j(0,F,"textureCoordinate0",function(){return this._textureCoordinate0}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(20,[new LU(0,"vector3",0),new LU(12,"vector2",2)])}]),U}()),ZU=(function(){function U(U,F,O,P,Y,c,L,u,d,a,b,z,J,w){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=U,this._positionStartLifeTime=F,this._velocity=O,this._startColor=P,this._startSize=Y,this._startRotation0=c,this._startRotation1=L,this._startRotation2=u,this._startLifeTime=d,this._time=a,this._startSpeed=b,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=w}w(U,"laya.d3.graphics.VertexShurikenParticleBillboard");var F=U.prototype;N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),j(0,F,"random1",function(){return this._randoms1}),j(0,F,"startRotation2",function(){return this._startRotation2}),j(0,F,"positionStartLifeTime",function(){return this._positionStartLifeTime}),j(0,F,"velocity",function(){return this._velocity}),j(0,F,"random0",function(){return this._randoms0}),j(0,F,"startSize",function(){return this._startSize}),j(0,F,"startColor",function(){return this._startColor}),j(0,F,"startRotation0",function(){return this._startRotation0}),j(0,F,"startRotation1",function(){return this._startRotation1}),j(0,F,"startLifeTime",function(){return this._startLifeTime}),j(0,F,"time",function(){return this._time}),j(0,F,"startSpeed",function(){return this._startSpeed}),j(0,F,"simulationWorldPostion",function(){return this._simulationWorldPostion}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(152,[new LU(0,"vector4",17),new LU(16,"vector4",30),new LU(32,"vector4",32),new LU(48,"vector4",19),new LU(64,"vector3",20),new LU(76,"vector3",22),new LU(88,"single",31),new LU(92,"vector4",34),new LU(108,"vector4",35),new LU(124,"vector3",36),new LU(136,"vector4",37)])}])}(),function(){function U(U,F,O,P,Y,c,L,u,d,a,b,z,J,w){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=U,this._positionStartLifeTime=F,this._velocity=O,this._startColor=P,this._startSize=Y,this._startRotation0=c,this._startRotation1=L,this._startRotation2=u,this._startLifeTime=d,this._time=a,this._startSpeed=b,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=w}w(U,"laya.d3.graphics.VertexShurikenParticleMesh");var F=U.prototype;N.imps(F,{"laya.d3.graphics.IVertex":!0}),j(0,F,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),j(0,F,"velocity",function(){return this._velocity}),j(0,F,"position",function(){return this._positionStartLifeTime}),j(0,F,"random0",function(){return this._randoms0}),j(0,F,"startSize",function(){return this._startSize}),j(0,F,"startColor",function(){return this._startColor}),j(0,F,"startRotation0",function(){return this._startRotation0}),j(0,F,"startRotation1",function(){return this._startRotation1}),j(0,F,"random1",function(){return this._randoms1}),j(0,F,"startRotation2",function(){return this._startRotation2}),j(0,F,"startLifeTime",function(){return this._startLifeTime}),j(0,F,"time",function(){return this._time}),j(0,F,"startSpeed",function(){return this._startSpeed}),j(0,F,"simulationWorldPostion",function(){return this._simulationWorldPostion}),j(0,F,"vertexDeclaration",function(){return U._vertexDeclaration}),j(1,U,"vertexDeclaration",function(){return U._vertexDeclaration}),z(U,["_vertexDeclaration",function(){return this._vertexDeclaration=new cU(172,[new LU(0,"vector3",0),new LU(12,"vector4",1),new LU(28,"vector2",2),new LU(36,"vector4",30),new LU(52,"vector4",32),new LU(68,"vector4",19),new LU(84,"vector3",20),new LU(96,"vector3",22),new LU(108,"single",31),new LU(112,"vector4",34),new LU(128,"vector4",35),new LU(144,"vector3",36),new LU(156,"vector4",37)])}])}(),function(){function Q(U,F,O,P,Y,c){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=O,this._materials=P,this._subMeshes=Y,this._materialMap=c,this._version=F,this._onLoaded(U)}w(Q,"laya.d3.loaders.LoadModelV01");var U=Q.prototype;return U._onLoaded=function(U){this._readData=U,this.READ_BLOCK();for(var F=0;F<this._BLOCK.count;F++){var O=this._readData.getUint16(),P=this._strings[O],Y=this["READ_"+P];if(null==Y)throw new Error("model file err,no this function:"+O+" "+P);if(!Y.call(this))break}return this._mesh},U.onError=function(){},U._readString=function(){return this._strings[this._readData.getUint16()]},U.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},U.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},U.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var U=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var F=0;F<this._STRINGS.size;F++)this._strings[F]=this._readData.readUTFString();return this._readData.pos=U,!0},U.READ_MATERIAL=function(){var U=this._readData.getUint16(),F=(this._readString(),this._readString());return this._materials[U]="null"!==F?H.getRes(this._materialMap[F]):new $F,!0},U.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var U,F=this._readData.__getBuffer(),O=0,P=this._readData.getUint32(),Y=this._readData.getUint32(),c=(new Float32Array(F.slice(P+this._DATA.offset,P+this._DATA.offset+Y)),this._readData.getUint32()),L=this._readData.getUint32(),u=new Float32Array(F.slice(c+this._DATA.offset,c+this._DATA.offset+L));for(this.mesh._inverseBindPoses=[],O=0,U=u.length;O<U;O+=16){var d=new UF(u[O+0],u[O+1],u[O+2],u[O+3],u[O+4],u[O+5],u[O+6],u[O+7],u[O+8],u[O+9],u[O+10],u[O+11],u[O+12],u[O+13],u[O+14],u[O+15]);this.mesh._inverseBindPoses.push(d)}break;default:throw new Error("LoadModel:unknown version.")}return!0},U.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var U=this._readString();this._shaderAttributes=U.match(Q._attrReg);var F=this._readData.getUint32(),O=this._readData.getUint32(),P=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),Y=this._readData.getUint32(),c=this._readData.getUint32(),L=this._readData.getUint32(),u=this._readData.__getBuffer(),d=new aF(this._mesh),a=this._getVertexDeclaration(),b=mF.create(a,Y/a.vertexStride,35044,!0),z=P+this._DATA.offset,J=u.slice(z,z+Y);b.setData(new Float32Array(J));for(var w=(d._vertexBuffer=b).vertexDeclaration.getVertexElements(),j=0;j<w.length;j++)d._bufferUsage[w[j].elementUsage]=b;var x=MF.create("ushort",O/2,35044,!0),r=F+this._DATA.offset,H=u.slice(r,r+O);x.setData(new Uint16Array(H)),d._indexBuffer=x;var h=u.slice(c+this._DATA.offset,c+this._DATA.offset+L);return d._boneIndicesList[0]=new Uint8Array(h),this._subMeshes.push(d),!0},U.READ_DATAAREA=function(){return!1},U._getVertexDeclaration=function(){for(var U,F=!1,O=!1,P=!1,Y=!1,c=!1,L=!1,u=!1,d=!1,a=!1,b=0;b<this._shaderAttributes.length;b+=8)switch(this._shaderAttributes[b]){case"POSITION":F=!0;break;case"NORMAL":O=!0;break;case"COLOR":P=!0;break;case"UV":Y=!0;break;case"UV1":c=!0;break;case"BLENDWEIGHT":u=!0;break;case"BLENDINDICES":d=!0;break;case"TANGENT":L=!0;break;case"BINORMAL":a=!0}return F&&O&&P&&Y&&c&&u&&d&&L?U=QU.vertexDeclaration:F&&O&&P&&Y&&c&&u&&d?U=HU.vertexDeclaration:F&&O&&Y&&c&&u&&d&&L?U=kU.vertexDeclaration:F&&O&&Y&&c&&u&&d?U=iU.vertexDeclaration:F&&O&&P&&Y&&u&&d&&L?U=IU.vertexDeclaration:F&&O&&P&&Y&&u&&d?U=KU.vertexDeclaration:F&&O&&L&&a&&Y&&u&&d?U=qU.vertexDeclaration:F&&O&&Y&&u&&d&&L?U=mU.vertexDeclaration:F&&O&&Y&&u&&d?U=VU.vertexDeclaration:F&&O&&P&&u&&d&&L?U=JU.vertexDeclaration:F&&O&&P&&u&&d?U=bU.vertexDeclaration:F&&O&&P&&Y&&c&&L?U=NU.vertexDeclaration:F&&O&&P&&Y&&c?U=rU.vertexDeclaration:F&&O&&Y&&c&&L?U=GU.vertexDeclaration:F&&O&&Y&&c?U=sU.vertexDeclaration:F&&O&&P&&Y&&L?U=gU.vertexDeclaration:F&&O&&Y&&L&&a?U=RU.vertexDeclaration:F&&O&&P&&Y?U=xU.vertexDeclaration:F&&O&&Y&&L?U=oU.vertexDeclaration:F&&O&&Y?U=CU.vertexDeclaration:F&&O&&P&&L?U=jU.vertexDeclaration:F&&O&&P&&(U=aU.vertexDeclaration),U},j(0,U,"mesh",function(){return this._mesh}),Q._attrReg=new RegExp("(\\w+)|([:,;])","g"),Q}()),eU=function(){function f(){}return w(f,"laya.d3.loaders.LoadModelV02"),f.parse=function(U,F,O,P,Y,c){f._mesh=O,f._materials=P,f._subMeshes=Y,f._materialMap=c,f._version=F,f._readData=U,f.READ_DATA(),f.READ_BLOCK(),f.READ_STRINGS();for(var L=0,u=f._BLOCK.count;L<u;L++){f._readData.pos=f._BLOCK.blockStarts[L];var d=f._readData.getUint16(),a=f._strings[d],b=f["READ_"+a];if(null==b)throw new Error("model file err,no this function:"+d+" "+a);b.call()}f._strings.length=0,f._readData=null,f._version=null,f._mesh=null,f._materials=null,f._subMeshes=null,f._materialMap=null},f._readString=function(){return f._strings[f._readData.getUint16()]},f.READ_DATA=function(){f._DATA.offset=f._readData.getUint32(),f._DATA.size=f._readData.getUint32()},f.READ_BLOCK=function(){for(var U=f._BLOCK.count=f._readData.getUint16(),F=f._BLOCK.blockStarts=[],O=f._BLOCK.blockLengths=[],P=0;P<U;P++)F.push(f._readData.getUint32()),O.push(f._readData.getUint32())},f.READ_STRINGS=function(){var U=f._readData.getUint32(),F=f._readData.getUint16(),O=f._readData.pos;f._readData.pos=U+f._DATA.offset;for(var P=0;P<F;P++)f._strings[P]=f._readData.readUTFString();f._readData.pos=O},f.READ_MATERIAL=function(){f._readString(),f._readString();var U=f._readString();return""!==U&&f._materials.push(H.getRes(f._materialMap[U])),!0},f.READ_MESH=function(){f._readString();var U,F=f._readData.__getBuffer(),O=0,P=f._readData.getInt16(),Y=f._DATA.offset;for(O=0;O<P;O++){var c=Y+f._readData.getUint32(),L=f._readData.getUint32(),u=new Float32Array(F.slice(c,c+L)),d=f._readString().match(f._attrReg),a=f._getVertexDeclaration(d),b=mF.create(a,4*u.length/a.vertexStride,35044,!0);b.setData(u),f._mesh._vertexBuffers.push(b)}var z=Y+f._readData.getUint32(),J=f._readData.getUint32(),w=new Uint16Array(F.slice(z,z+J)),j=MF.create("ushort",J/2,35044,!0);j.setData(w),f._mesh._indexBuffer=j;var x=f._mesh._boneNames=[],r=f._readData.getUint16();for(x.length=r,O=0;O<r;O++)x[O]=f._strings[f._readData.getUint16()];var H=f._readData.getUint32(),h=f._readData.getUint32(),Q=(new Float32Array(F.slice(Y+H,Y+H+h)),f._readData.getUint32()),X=f._readData.getUint32(),N=new Float32Array(F.slice(Y+Q,Y+Q+X));for(f._mesh._inverseBindPoses=[],O=0,U=N.length;O<U;O+=16){var K=new UF(N[O+0],N[O+1],N[O+2],N[O+3],N[O+4],N[O+5],N[O+6],N[O+7],N[O+8],N[O+9],N[O+10],N[O+11],N[O+12],N[O+13],N[O+14],N[O+15]);f._mesh._inverseBindPoses.push(K)}return f._mesh._skinnedDatas=new Float32Array(16*N.length),!0},f.READ_SUBMESH=function(){var U=f._readData.__getBuffer(),F=new aF(f._mesh),O=f._readData.getInt16(),P=f._readData.getUint32(),Y=f._readData.getUint32();F._vertexBuffer=f._mesh._vertexBuffers[O],F._vertexStart=P,F._vertexCount=Y;var c=f._readData.getUint32(),L=f._readData.getUint32(),u=f._mesh._indexBuffer;F._indexBuffer=u,F._indexStart=c,F._indexCount=L,F._indices=new Uint16Array(u.getData().buffer,2*c,L);var d=f._DATA.offset,a=F._subIndexBufferStart,b=F._subIndexBufferCount,z=F._boneIndicesList,J=f._readData.getUint16();a.length=J,b.length=J,z.length=J;for(var w=0;w<J;w++){a[w]=f._readData.getUint32(),b[w]=f._readData.getUint32();var j=f._readData.getUint32(),x=f._readData.getUint32();F._boneIndicesList[w]=new Uint8Array(U.slice(d+j,d+j+x))}return f._subMeshes.push(F),!0},f._getVertexDeclaration=function(U){for(var F,O=!1,P=!1,Y=!1,c=!1,L=!1,u=!1,d=!1,a=!1,b=!1,z=0;z<U.length;z++)switch(U[z]){case"POSITION":O=!0;break;case"NORMAL":P=!0;break;case"COLOR":Y=!0;break;case"UV":c=!0;break;case"UV1":L=!0;break;case"BLENDWEIGHT":d=!0;break;case"BLENDINDICES":a=!0;break;case"TANGENT":u=!0;break;case"BINORMAL":b=!0}return O&&P&&Y&&c&&L&&d&&a&&u?F=QU.vertexDeclaration:O&&P&&Y&&c&&L&&d&&a?F=HU.vertexDeclaration:O&&P&&c&&L&&d&&a&&u?F=kU.vertexDeclaration:O&&P&&c&&L&&d&&a?F=iU.vertexDeclaration:O&&P&&Y&&c&&d&&a&&u?F=IU.vertexDeclaration:O&&P&&Y&&c&&d&&a?F=KU.vertexDeclaration:O&&P&&c&&d&&a&&u?F=mU.vertexDeclaration:O&&P&&c&&d&&a?F=VU.vertexDeclaration:O&&P&&Y&&d&&a&&u?F=JU.vertexDeclaration:O&&P&&Y&&d&&a?F=bU.vertexDeclaration:O&&P&&Y&&c&&L&&u?F=NU.vertexDeclaration:O&&P&&Y&&c&&L?F=rU.vertexDeclaration:O&&P&&c&&L&&u?F=GU.vertexDeclaration:O&&P&&c&&L?F=sU.vertexDeclaration:O&&P&&Y&&c&&u?F=gU.vertexDeclaration:O&&P&&c&&u&&b?F=RU.vertexDeclaration:O&&P&&Y&&c?F=xU.vertexDeclaration:O&&P&&c&&u?F=oU.vertexDeclaration:O&&P&&c?F=CU.vertexDeclaration:O&&P&&Y&&u?F=jU.vertexDeclaration:O&&P&&Y&&(F=aU.vertexDeclaration),F},f._attrReg=new RegExp("(\\w+)|([:,;])","g"),f._strings=[],f._readData=null,f._version=null,f._mesh=null,f._materials=null,f._subMeshes=null,f._materialMap=null,z(f,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),f}(),vU=function(){function K(){}return w(K,"laya.d3.loaders.LoadModelV03"),K.parse=function(U,F,O,P,Y){K._mesh=O,K._subMeshes=P,K._materialMap=Y,K._version=F,K._readData=U,K.READ_DATA(),K.READ_BLOCK(),K.READ_STRINGS();for(var c=0,L=K._BLOCK.count;c<L;c++){K._readData.pos=K._BLOCK.blockStarts[c];var u=K._readData.getUint16(),d=K._strings[u],a=K["READ_"+d];if(null==a)throw new Error("model file err,no this function:"+u+" "+d);a.call()}K._strings.length=0,K._readData=null,K._version=null,K._mesh=null,K._subMeshes=null,K._materialMap=null},K._readString=function(){return K._strings[K._readData.getUint16()]},K.READ_DATA=function(){K._DATA.offset=K._readData.getUint32(),K._DATA.size=K._readData.getUint32()},K.READ_BLOCK=function(){for(var U=K._BLOCK.count=K._readData.getUint16(),F=K._BLOCK.blockStarts=[],O=K._BLOCK.blockLengths=[],P=0;P<U;P++)F.push(K._readData.getUint32()),O.push(K._readData.getUint32())},K.READ_STRINGS=function(){var U=K._readData.getUint32(),F=K._readData.getUint16(),O=K._readData.pos;K._readData.pos=U+K._DATA.offset;for(var P=0;P<F;P++)K._strings[P]=K._readData.readUTFString();K._readData.pos=O},K.READ_MESH=function(){var U,F=K._readString(),O=K._readData.__getBuffer(),P=0,Y=K._readData.getInt16(),c=K._DATA.offset;for(P=0;P<Y;P++){var L,u=c+K._readData.getUint32(),d=K._readData.getUint32(),a=new Float32Array(O.slice(u,u+d)),b=K._readString();switch(K._version){case"LAYAMODEL:03":L=K._vertexDeclarationMap_Discard[b];break;case"LAYAMODEL:0301":L=K._vertexDeclarationMap[b];break;default:throw new Error("LoadModelV03: unknown version.")}if(!L)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+K._version+"  bufferAttribute="+b+"  name="+F+"  url="+(K._mesh?K._mesh.url:"null"));var z=mF.create(L,4*a.length/L.vertexStride,35044,!0,K._mesh._url+"_"+P);z.setData(a),K._mesh._vertexBuffers.push(z)}var J=c+K._readData.getUint32(),w=K._readData.getUint32(),j=new Uint16Array(O.slice(J,J+w)),x=MF.create("ushort",w/2,35044,!0,K._mesh._url);x.setData(j),K._mesh._indexBuffer=x;var r=K._mesh._boneNames=[],H=K._readData.getUint16();for(r.length=H,P=0;P<H;P++)r[P]=K._strings[K._readData.getUint16()];K._readData.pos+=8;var h=K._readData.getUint32(),Q=K._readData.getUint32(),X=new Float32Array(O.slice(c+h,c+h+Q));for(K._mesh._inverseBindPoses=[],P=0,U=X.length;P<U;P+=16){var N=new UF(X[P+0],X[P+1],X[P+2],X[P+3],X[P+4],X[P+5],X[P+6],X[P+7],X[P+8],X[P+9],X[P+10],X[P+11],X[P+12],X[P+13],X[P+14],X[P+15]);K._mesh._inverseBindPoses.push(N)}return K._mesh._skinnedDatas=new Float32Array(16*X.length),!0},K.READ_SUBMESH=function(){var U=K._readData.__getBuffer(),F=new aF(K._mesh),O=K._readData.getInt16(),P=K._readData.getUint32(),Y=K._readData.getUint32();F._vertexBuffer=K._mesh._vertexBuffers[O],F._vertexStart=P,F._vertexCount=Y;var c=K._readData.getUint32(),L=K._readData.getUint32(),u=K._mesh._indexBuffer;F._indexBuffer=u,F._indexStart=c,F._indexCount=L,F._indices=new Uint16Array(u.getData().buffer,2*c,L);var d=K._DATA.offset,a=F._subIndexBufferStart,b=F._subIndexBufferCount,z=F._boneIndicesList,J=K._readData.getUint16();a.length=J,b.length=J,z.length=J;for(var w=0;w<J;w++){a[w]=K._readData.getUint32(),b[w]=K._readData.getUint32();var j=K._readData.getUint32(),x=K._readData.getUint32();z[w]=new Uint8Array(U.slice(d+j,d+j+x))}return K._subMeshes.push(F),!0},K._strings=[],K._readData=null,K._version=null,K._mesh=null,K._subMeshes=null,K._materialMap=null,z(K,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":QU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":HU.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":_U.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":kU.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":iU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":IU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":KU.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":mU.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VU.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":JU.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":bU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":NU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":rU.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":GU.vertexDeclaration,"POSITION,NORMAL,UV,UV1":sU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":gU.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":RU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":xU.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":oU.vertexDeclaration,"POSITION,NORMAL,UV":CU.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":jU.vertexDeclaration,"POSITION,NORMAL,COLOR":aU.vertexDeclaration,"POSITION,NORMAL,TANGENT":$U.vertexDeclaration,"POSITION,NORMAL":dU.vertexDeclaration,"POSITION,UV":DU.vertexDeclaration,POSITION:uU.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":hU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":HU.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":_U.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":yU.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":iU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":fU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":KU.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":MU.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VU.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":zU.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":bU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":XU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":rU.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":AU.vertexDeclaration,"POSITION,NORMAL,UV,UV1":sU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":TU.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":RU.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":xU.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":pU.vertexDeclaration,"POSITION,NORMAL,UV":CU.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":wU.vertexDeclaration,"POSITION,NORMAL,COLOR":aU.vertexDeclaration,"POSITION,NORMAL,TANGENT":lU.vertexDeclaration,"POSITION,NORMAL":dU.vertexDeclaration,"POSITION,UV":DU.vertexDeclaration,POSITION:uU.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),K}(),nU=function(){function u(){}return w(u,"laya.d3.loaders.MeshReader"),u.read=function(U,F,O,P,Y){var c=new K(U);c.pos=0;var L=c.readUTFString();switch(L){case"LAYAMODEL:01":case"LAYASKINANI:01":u._readVersion01(c,L,F,O,P,Y);break;case"LAYAMODEL:02":eU.parse(c,L,F,O,P,Y);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":vU.parse(c,L,F,P,Y);break;default:throw new Error("MeshReader: unknown mesh version.")}F._setSubMeshes(P)},u._readVersion01=function(U,F,O,P,Y,c){new ZU(U,F,O,P,Y,c)},u}(),tU=function(){function U(U,F){this.min=null,this.max=null,this.min=U,this.max=F}w(U,"laya.d3.math.BoundBox");var F=U.prototype;return N.imps(F,{"laya.d3.core.IClone":!0}),F.getCorners=function(U){U.length=8;var F=this.min.elements,O=this.max.elements,P=F[0],Y=F[1],c=F[2],L=O[0],u=O[1],d=O[2];U[0]=new LF(P,u,d),U[1]=new LF(L,u,d),U[2]=new LF(L,Y,d),U[3]=new LF(P,Y,d),U[4]=new LF(P,u,c),U[5]=new LF(L,u,c),U[6]=new LF(L,Y,c),U[7]=new LF(P,Y,c)},F.toDefault=function(){this.min.toDefault(),this.max.toDefault()},F.cloneTo=function(U){var F=U;this.min.cloneTo(F.min),this.max.cloneTo(F.max)},F.clone=function(){var U=new this.constructor(new LF,new LF);return this.cloneTo(U),U},U.createfromPoints=function(U,F){if(null==U)throw new Error("points");var O=F.min,P=F.max,Y=O.elements;Y[0]=Number.MAX_VALUE,Y[1]=Number.MAX_VALUE,Y[2]=Number.MAX_VALUE;var c=P.elements;c[0]=-Number.MAX_VALUE,c[1]=-Number.MAX_VALUE,c[2]=-Number.MAX_VALUE;for(var L=0,u=U.length;L<u;++L)LF.min(O,U[L],O),LF.max(P,U[L],P)},U.merge=function(U,F,O){LF.min(U.min,F.min,O.min),LF.max(U.max,F.max,O.max)},U}(),SU=function(){function a(U){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=U,this._near=new FF(new LF),this._far=new FF(new LF),this._left=new FF(new LF),this._right=new FF(new LF),this._top=new FF(new LF),this._bottom=new FF(new LF),a._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}w(a,"laya.d3.math.BoundFrustum");var U=a.prototype;return U.equalsBoundFrustum=function(U){return this._matrix.equalsOtherMatrix(U.matrix)},U.equalsObj=function(U){if(U instanceof laya.d3.math.BoundFrustum){var F=U;return this.equalsBoundFrustum(F)}return!1},U.getPlane=function(U){switch(U){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},U.getCorners=function(U){a._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(U[0]),a._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(U[1]),a._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(U[2]),a._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(U[3]),a._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(U[4]),a._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(U[5]),a._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(U[6]),a._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(U[7])},U.containsPoint=function(U){for(var F=FF.PlaneIntersectionType_Front,O=FF.PlaneIntersectionType_Front,P=0;P<6;P++){switch(P){case 0:O=Collision.intersectsPlaneAndPoint(this._near,U);break;case 1:O=Collision.intersectsPlaneAndPoint(this._far,U);break;case 2:O=Collision.intersectsPlaneAndPoint(this._left,U);break;case 3:O=Collision.intersectsPlaneAndPoint(this._right,U);break;case 4:O=Collision.intersectsPlaneAndPoint(this._top,U);break;case 5:O=Collision.intersectsPlaneAndPoint(this._bottom,U)}switch(O){case FF.PlaneIntersectionType_Back:return 0;case FF.PlaneIntersectionType_Intersecting:F=FF.PlaneIntersectionType_Intersecting}}switch(F){case FF.PlaneIntersectionType_Intersecting:return 2;default:return 1}},U.containsBoundBox=function(U){for(var F,O=a._tempV30,P=a._tempV31,Y=1,c=0;c<6;c++){if(F=this.getPlane(c),this._getBoxToPlanePVertexNVertex(U,F.normal,O,P),Collision.intersectsPlaneAndPoint(F,O)===FF.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(F,P)===FF.PlaneIntersectionType_Back&&(Y=2)}return Y},U.containsBoundSphere=function(U){for(var F=FF.PlaneIntersectionType_Front,O=FF.PlaneIntersectionType_Front,P=0;P<6;P++){switch(P){case 0:O=Collision.intersectsPlaneAndSphere(this._near,U);break;case 1:O=Collision.intersectsPlaneAndSphere(this._far,U);break;case 2:O=Collision.intersectsPlaneAndSphere(this._left,U);break;case 3:O=Collision.intersectsPlaneAndSphere(this._right,U);break;case 4:O=Collision.intersectsPlaneAndSphere(this._top,U);break;case 5:O=Collision.intersectsPlaneAndSphere(this._bottom,U)}switch(O){case FF.PlaneIntersectionType_Back:return 0;case FF.PlaneIntersectionType_Intersecting:F=FF.PlaneIntersectionType_Intersecting}}switch(F){case FF.PlaneIntersectionType_Intersecting:return 2;default:return 1}},U._getBoxToPlanePVertexNVertex=function(U,F,O,P){var Y=U.min,c=Y.elements,L=U.max,u=L.elements,d=F.elements,a=d[0],b=d[1],z=d[2];Y.cloneTo(O);var J=O.elements;0<=a&&(J[0]=u[0]),0<=b&&(J[1]=u[1]),0<=z&&(J[2]=u[2]),L.cloneTo(P);var w=P.elements;0<=a&&(w[0]=c[0]),0<=b&&(w[1]=c[1]),0<=z&&(w[2]=c[2])},j(0,U,"top",function(){return this._top}),j(0,U,"matrix",function(){return this._matrix},function(U){this._matrix=U,a._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),j(0,U,"near",function(){return this._near}),j(0,U,"far",function(){return this._far}),j(0,U,"left",function(){return this._left}),j(0,U,"right",function(){return this._right}),j(0,U,"bottom",function(){return this._bottom}),a._getPlanesFromMatrix=function(U,F,O,P,Y,c,L){var u=U.elements,d=u[0],a=u[1],b=u[2],z=u[3],J=u[4],w=u[5],j=u[6],x=u[7],r=u[8],H=u[9],h=u[10],Q=u[11],X=u[12],N=u[13],K=u[14],f=u[15],I=F.normal.elements;I[0]=z+b,I[1]=x+j,I[2]=Q+h,F.distance=f+K,F.normalize();var T=O.normal.elements;T[0]=z-b,T[1]=x-j,T[2]=Q-h,O.distance=f-K,O.normalize();var g=P.normal.elements;g[0]=z+d,g[1]=x+J,g[2]=Q+r,P.distance=f+X,P.normalize();var l=Y.normal.elements;l[0]=z-d,l[1]=x-J,l[2]=Q-r,Y.distance=f-X,Y.normalize();var $=c.normal.elements;$[0]=z-a,$[1]=x-w,$[2]=Q-H,c.distance=f-N,c.normalize();var C=L.normal.elements;C[0]=z+a,C[1]=x+w,C[2]=Q+H,L.distance=f+N,L.normalize()},a._get3PlaneInterPoint=function(U,F,O){var P=U.normal,Y=F.normal,c=O.normal;LF.cross(Y,c,a._tempV30),LF.cross(c,P,a._tempV31),LF.cross(P,Y,a._tempV32);var L=LF.dot(P,a._tempV30),u=LF.dot(Y,a._tempV31),d=LF.dot(c,a._tempV32);return LF.scale(a._tempV30,-U.distance/L,a._tempV33),LF.scale(a._tempV31,-F.distance/u,a._tempV34),LF.scale(a._tempV32,-O.distance/d,a._tempV35),LF.add(a._tempV33,a._tempV34,a._tempV36),LF.add(a._tempV35,a._tempV36,a._tempV37),a._tempV37},z(a,["_tempV30",function(){return this._tempV30=new LF},"_tempV31",function(){return this._tempV31=new LF},"_tempV32",function(){return this._tempV32=new LF},"_tempV33",function(){return this._tempV33=new LF},"_tempV34",function(){return this._tempV34=new LF},"_tempV35",function(){return this._tempV35=new LF},"_tempV36",function(){return this._tempV36=new LF},"_tempV37",function(){return this._tempV37=new LF}]),a}(),WU=function(){function b(U,F){this.center=null,this.radius=NaN,this.center=U,this.radius=F}w(b,"laya.d3.math.BoundSphere");var U=b.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.toDefault=function(){this.center.toDefault(),this.radius=0},U.intersectsRayDistance=function(U){return Collision.intersectsRayAndSphereRD(U,this)},U.intersectsRayPoint=function(U,F){return Collision.intersectsRayAndSphereRP(U,this,F)},U.cloneTo=function(U){var F=U;this.center.cloneTo(F.center),F.radius=this.radius},U.clone=function(){var U=new this.constructor(new LF,new LF);return this.cloneTo(U),U},b.createFromSubPoints=function(U,F,O,P){if(null==U)throw new Error("points");if(F<0||F>=U.length)throw new Error("start"+F+"Must be in the range [0, "+(U.length-1)+"]");if(O<0||F+O>U.length)throw new Error("count"+O+"Must be in the range <= "+U.length+"}");var Y=F+O,c=b._tempVector3;c.elements[0]=0,c.elements[1]=0,c.elements[2]=0;for(var L=F;L<Y;++L)LF.add(U[L],c,c);var u=P.center;LF.scale(c,1/O,u);var d=0;for(L=F;L<Y;++L){var a=LF.distanceSquared(u,U[L]);d<a&&(d=a)}P.radius=Math.sqrt(d)},b.createfromPoints=function(U,F){if(null==U)throw new Error("points");b.createFromSubPoints(U,0,U.length,F)},z(b,["_tempVector3",function(){return this._tempVector3=new LF}]),b}(),BU=(function(){function U(){}w(U,"laya.d3.math.ContainmentType"),U.Disjoint=0,U.Contains=1,U.Intersects=2}(),function(){function O(){}return w(O,"laya.d3.math.MathUtils3D"),O.isZero=function(U){return Math.abs(U)<O.zeroTolerance},O.nearEqual=function(U,F){return!!O.isZero(U-F)},O.fastInvSqrt=function(U){return O.isZero(U)?U:1/Math.sqrt(U)},z(O,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),O}()),EU=function(){function d(){var U=this.elements=new Float32Array(9);U[0]=1,U[1]=0,U[2]=0,U[3]=0,U[4]=1,U[5]=0,U[6]=0,U[7]=0,U[8]=1}w(d,"laya.d3.math.Matrix3x3");var U=d.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.determinant=function(){var U=this.elements,F=U[0],O=U[1],P=U[2],Y=U[3],c=U[4],L=U[5],u=U[6],d=U[7],a=U[8];return F*(a*c-L*d)+O*(-a*Y+L*u)+P*(d*Y-c*u)},U.translate=function(U,F){var O=F.elements,P=this.elements,Y=U.elements,c=P[0],L=P[1],u=P[2],d=P[3],a=P[4],b=P[5],z=P[6],J=P[7],w=P[8],j=Y[0],x=Y[1];O[0]=c,O[1]=L,O[2]=u,O[3]=d,O[4]=a,O[5]=b,O[6]=j*c+x*d+z,O[7]=j*L+x*a+J,O[8]=j*u+x*b+w},U.rotate=function(U,F){var O=F.elements,P=this.elements,Y=P[0],c=P[1],L=P[2],u=P[3],d=P[4],a=P[5],b=P[6],z=P[7],J=P[8],w=Math.sin(U),j=Math.cos(U);O[0]=j*Y+w*u,O[1]=j*c+w*d,O[2]=j*L+w*a,O[3]=j*u-w*Y,O[4]=j*d-w*c,O[5]=j*a-w*L,O[6]=b,O[7]=z,O[8]=J},U.scale=function(U,F){var O=F.elements,P=this.elements,Y=U.elements,c=Y[0],L=Y[1];O[0]=c*P[0],O[1]=c*P[1],O[2]=c*P[2],O[3]=L*P[3],O[4]=L*P[4],O[5]=L*P[5],O[6]=P[6],O[7]=P[7],O[8]=P[8]},U.invert=function(U){var F=U.elements,O=this.elements,P=O[0],Y=O[1],c=O[2],L=O[3],u=O[4],d=O[5],a=O[6],b=O[7],z=O[8],J=z*u-d*b,w=-z*L+d*a,j=b*L-u*a,x=P*J+Y*w+c*j;x||(U=null),x=1/x,F[0]=J*x,F[1]=(-z*Y+c*b)*x,F[2]=(d*Y-c*u)*x,F[3]=w*x,F[4]=(z*P-c*a)*x,F[5]=(-d*P+c*L)*x,F[6]=j*x,F[7]=(-b*P+Y*a)*x,F[8]=(u*P-Y*L)*x},U.transpose=function(U){var F=U.elements,O=this.elements;if(U===this){var P=O[1],Y=O[2],c=O[5];F[1]=O[3],F[2]=O[6],F[3]=P,F[5]=O[7],F[6]=Y,F[7]=c}else F[0]=O[0],F[1]=O[3],F[2]=O[6],F[3]=O[1],F[4]=O[4],F[5]=O[7],F[6]=O[2],F[7]=O[5],F[8]=O[8]},U.identity=function(){var U=this.elements;U[0]=1,U[1]=0,U[2]=0,U[3]=0,U[4]=1,U[5]=0,U[6]=0,U[7]=0,U[8]=1},U.cloneTo=function(U){var F,O,P;if((O=this.elements)!==(P=U.elements))for(F=0;F<9;++F)P[F]=O[F]},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},d.createFromTranslation=function(U,F){F.elements;var O=U.elements;F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=1,F[5]=0,F[6]=O[0],F[7]=O[1],F[8]=1},d.createFromRotation=function(U,F){var O=F.elements,P=Math.sin(U),Y=Math.cos(U);O[0]=Y,O[1]=P,O[2]=0,O[3]=-P,O[4]=Y,O[5]=0,O[6]=0,O[7]=0,O[8]=1},d.createFromScaling=function(U,F){var O=F.elements,P=U.elements;O[0]=P[0],O[1]=0,O[2]=0,O[3]=0,O[4]=P[1],O[5]=0,O[6]=0,O[7]=0,O[8]=1},d.createFromMatrix4x4=function(U,F){F[0]=U[0],F[1]=U[1],F[2]=U[2],F[3]=U[4],F[4]=U[5],F[5]=U[6],F[6]=U[8],F[7]=U[9],F[8]=U[10]},d.multiply=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements,L=Y[0],u=Y[1],d=Y[2],a=Y[3],b=Y[4],z=Y[5],J=Y[6],w=Y[7],j=Y[8],x=c[0],r=c[1],H=c[2],h=c[3],Q=c[4],X=c[5],N=c[6],K=c[7],f=c[8];P[0]=x*L+r*a+H*J,P[1]=x*u+r*b+H*w,P[2]=x*d+r*z+H*j,P[3]=h*L+Q*a+X*J,P[4]=h*u+Q*b+X*w,P[5]=h*d+Q*z+X*j,P[6]=N*L+K*a+f*J,P[7]=N*u+K*b+f*w,P[8]=N*d+K*z+f*j},d.lookAt=function(U,F,O,P){LF.subtract(U,F,d._tempV30),LF.normalize(d._tempV30,d._tempV30),LF.cross(O,d._tempV30,d._tempV31),LF.normalize(d._tempV31,d._tempV31),LF.cross(d._tempV30,d._tempV31,d._tempV32);var Y=d._tempV30.elements,c=d._tempV31.elements,L=d._tempV32.elements,u=P.elements;u[0]=c[0],u[3]=c[1],u[6]=c[2],u[1]=L[0],u[4]=L[1],u[7]=L[2],u[2]=Y[0],u[5]=Y[1],u[8]=Y[2]},d.DEFAULT=new d,z(d,["_tempV30",function(){return this._tempV30=new LF},"_tempV31",function(){return this._tempV31=new LF},"_tempV32",function(){return this._tempV32=new LF}]),d}(),UF=function(){function T(U,F,O,P,Y,c,L,u,d,a,b,z,J,w,j,x){void 0===U&&(U=1),void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===c&&(c=1),void 0===L&&(L=0),void 0===u&&(u=0),void 0===d&&(d=0),void 0===a&&(a=0),void 0===b&&(b=1),void 0===z&&(z=0),void 0===J&&(J=0),void 0===w&&(w=0),void 0===j&&(j=0),void 0===x&&(x=1);var r=this.elements=new Float32Array(16);r[0]=U,r[1]=F,r[2]=O,r[3]=P,r[4]=Y,r[5]=c,r[6]=L,r[7]=u,r[8]=d,r[9]=a,r[10]=b,r[11]=z,r[12]=J,r[13]=w,r[14]=j,r[15]=x}w(T,"laya.d3.math.Matrix4x4");var U=T.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.getElementByRowColumn=function(U,F){if(U<0||3<U)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(F<0||3<F)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*U+F]},U.setElementByRowColumn=function(U,F,O){if(U<0||3<U)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(F<0||3<F)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*U+F]=O},U.equalsOtherMatrix=function(U){var F=this.elements,O=U.elements;return BU.nearEqual(F[0],O[0])&&BU.nearEqual(F[1],O[1])&&BU.nearEqual(F[2],O[2])&&BU.nearEqual(F[3],O[3])&&BU.nearEqual(F[4],O[4])&&BU.nearEqual(F[5],O[5])&&BU.nearEqual(F[6],O[6])&&BU.nearEqual(F[7],O[7])&&BU.nearEqual(F[8],O[8])&&BU.nearEqual(F[9],O[9])&&BU.nearEqual(F[10],O[10])&&BU.nearEqual(F[11],O[11])&&BU.nearEqual(F[12],O[12])&&BU.nearEqual(F[13],O[13])&&BU.nearEqual(F[14],O[14])&&BU.nearEqual(F[15],O[15])},U.decomposeTransRotScale=function(U,F,O){var P=T._tempMatrix4x4;return this.decomposeTransRotMatScale(U,P,O)?(OF.createFromMatrix4x4(P,F),!0):(F.identity(),!1)},U.decomposeTransRotMatScale=function(U,F,O){var P=this.elements,Y=U.elements,c=F.elements,L=O.elements;Y[0]=P[12],Y[1]=P[13],Y[2]=P[14];var u=P[0],d=P[1],a=P[2],b=P[4],z=P[5],J=P[6],w=P[8],j=P[9],x=P[10],r=L[0]=Math.sqrt(u*u+d*d+a*a),H=L[1]=Math.sqrt(b*b+z*z+J*J),h=L[2]=Math.sqrt(w*w+j*j+x*x);if(BU.isZero(r)||BU.isZero(H)||BU.isZero(h))return c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=c[12]=c[13]=c[14]=0,c[0]=c[5]=c[10]=c[15]=1,!1;var Q=T._tempVector0,X=Q.elements;X[0]=w/h,X[1]=j/h,X[2]=x/h;var N=T._tempVector1,K=N.elements;K[0]=u/r,K[1]=d/r,K[2]=a/r;var f=T._tempVector2;LF.cross(Q,N,f);var I=T._tempVector1;return LF.cross(f,Q,I),c[3]=c[7]=c[11]=c[12]=c[13]=c[14]=0,c[15]=1,c[0]=I.x,c[1]=I.y,c[2]=I.z,c[4]=f.x,c[5]=f.y,c[6]=f.z,c[8]=Q.x,c[9]=Q.y,c[10]=Q.z,c[0]*u+c[1]*d+c[2]*a<0&&(L[0]=-r),c[4]*b+c[5]*z+c[6]*J<0&&(L[1]=-H),c[8]*w+c[9]*j+c[10]*x<0&&(L[2]=-h),!0},U.decomposeYawPitchRoll=function(U){var F=U.elements,O=Math.asin(-this.elements[9]);F[1]=O,Math.cos(O)>BU.zeroTolerance?(F[2]=Math.atan2(this.elements[1],this.elements[5]),F[0]=Math.atan2(this.elements[8],this.elements[10])):(F[2]=Math.atan2(-this.elements[4],this.elements[0]),F[0]=0)},U.normalize=function(){var U=this.elements,F=U[0],O=U[1],P=U[2],Y=Math.sqrt(F*F+O*O+P*P);if(!Y)return U[0]=0,U[1]=0,void(U[2]=0);1!=Y&&(Y=1/Y,U[0]=F*Y,U[1]=O*Y,U[2]=P*Y)},U.transpose=function(){var U,F;return F=(U=this.elements)[1],U[1]=U[4],U[4]=F,F=U[2],U[2]=U[8],U[8]=F,F=U[3],U[3]=U[12],U[12]=F,F=U[6],U[6]=U[9],U[9]=F,F=U[7],U[7]=U[13],U[13]=F,F=U[11],U[11]=U[14],U[14]=F,this},U.invert=function(U){var F=this.elements,O=U.elements,P=F[0],Y=F[1],c=F[2],L=F[3],u=F[4],d=F[5],a=F[6],b=F[7],z=F[8],J=F[9],w=F[10],j=F[11],x=F[12],r=F[13],H=F[14],h=F[15],Q=P*d-Y*u,X=P*a-c*u,N=P*b-L*u,K=Y*a-c*d,f=Y*b-L*d,I=c*b-L*a,T=z*r-J*x,g=z*H-w*x,l=z*h-j*x,$=J*H-w*r,C=J*h-j*r,s=w*h-j*H,i=Q*s-X*C+N*$+K*l-f*g+I*T;0!==Math.abs(i)&&(i=1/i,O[0]=(d*s-a*C+b*$)*i,O[1]=(c*C-Y*s-L*$)*i,O[2]=(r*I-H*f+h*K)*i,O[3]=(w*f-J*I-j*K)*i,O[4]=(a*l-u*s-b*g)*i,O[5]=(P*s-c*l+L*g)*i,O[6]=(H*N-x*I-h*X)*i,O[7]=(z*I-w*N+j*X)*i,O[8]=(u*C-d*l+b*T)*i,O[9]=(Y*l-P*C-L*T)*i,O[10]=(x*f-r*N+h*Q)*i,O[11]=(J*N-z*f-j*Q)*i,O[12]=(d*g-u*$-a*T)*i,O[13]=(P*$-Y*g+c*T)*i,O[14]=(r*X-x*K-H*Q)*i,O[15]=(z*K-J*X+w*Q)*i)},U.identity=function(){var U=this.elements;U[1]=U[2]=U[3]=U[4]=U[6]=U[7]=U[8]=U[9]=U[11]=U[12]=U[13]=U[14]=0,U[0]=U[5]=U[10]=U[15]=1},U.cloneTo=function(U){var F,O,P;if((O=this.elements)!==(P=U.elements))for(F=0;F<16;++F)P[F]=O[F]},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},U.getTranslationVector=function(U){var F=this.elements,O=U.elements;O[0]=F[12],O[1]=F[13],O[2]=F[14]},U.setTranslationVector=function(U){var F=this.elements,O=U.elements;F[12]=O[0],F[13]=O[1],F[14]=O[2]},U.getForward=function(U){var F=this.elements,O=U.elements;O[0]=-F[8],O[1]=-F[9],O[2]=-F[10]},U.setForward=function(U){var F=this.elements,O=U.elements;F[8]=-O[0],F[9]=-O[1],F[10]=-O[2]},T.createRotationX=function(U,F){var O=F.elements,P=Math.sin(U),Y=Math.cos(U);O[1]=O[2]=O[3]=O[4]=O[7]=O[8]=O[11]=O[12]=O[13]=O[14]=0,O[0]=O[15]=1,O[5]=O[10]=Y,O[6]=P,O[9]=-P},T.createRotationY=function(U,F){var O=F.elements,P=Math.sin(U),Y=Math.cos(U);O[1]=O[3]=O[4]=O[6]=O[7]=O[9]=O[11]=O[12]=O[13]=O[14]=0,O[5]=O[15]=1,O[0]=O[10]=Y,O[2]=-P,O[8]=P},T.createRotationZ=function(U,F){var O=F.elements,P=Math.sin(U),Y=Math.cos(U);O[2]=O[3]=O[6]=O[7]=O[8]=O[9]=O[11]=O[12]=O[13]=O[14]=0,O[10]=O[15]=1,O[0]=O[5]=Y,O[1]=P,O[4]=-P},T.createRotationYawPitchRoll=function(U,F,O,P){OF.createFromYawPitchRoll(U,F,O,T._tempQuaternion),T.createRotationQuaternion(T._tempQuaternion,P)},T.createRotationAxis=function(U,F,O){var P=U.elements,Y=P[0],c=P[1],L=P[2],u=Math.cos(F),d=Math.sin(F),a=Y*Y,b=c*c,z=L*L,J=Y*c,w=Y*L,j=c*L,x=O.elements;x[3]=x[7]=x[11]=x[12]=x[13]=x[14]=0,x[15]=1,x[0]=a+u*(1-a),x[1]=J-u*J+d*L,x[2]=w-u*w-d*c,x[4]=J-u*J-d*L,x[5]=b+u*(1-b),x[6]=j-u*j+d*Y,x[8]=w-u*w+d*c,x[9]=j-u*j-d*Y,x[10]=z+u*(1-z)},T.createRotationQuaternion=function(U,F){var O=U.elements,P=F.elements,Y=O[0],c=O[1],L=O[2],u=O[3],d=Y*Y,a=c*c,b=L*L,z=Y*c,J=L*u,w=L*Y,j=c*u,x=c*L,r=Y*u;P[3]=P[7]=P[11]=P[12]=P[13]=P[14]=0,P[15]=1,P[0]=1-2*(a+b),P[1]=2*(z+J),P[2]=2*(w-j),P[4]=2*(z-J),P[5]=1-2*(b+d),P[6]=2*(x+r),P[8]=2*(w+j),P[9]=2*(x-r),P[10]=1-2*(a+d)},T.createTranslate=function(U,F){var O=U.elements,P=F.elements;P[4]=P[8]=P[1]=P[9]=P[2]=P[6]=P[3]=P[7]=P[11]=0,P[0]=P[5]=P[10]=P[15]=1,P[12]=O[0],P[13]=O[1],P[14]=O[2]},T.createScaling=function(U,F){var O=U.elements,P=F.elements;P[0]=O[0],P[5]=O[1],P[10]=O[2],P[1]=P[4]=P[8]=P[12]=P[9]=P[13]=P[2]=P[6]=P[14]=P[3]=P[7]=P[11]=0,P[15]=1},T.multiply=function(U,F,O){var P,Y,c,L,u,d,a,b;for(Y=O.elements,c=U.elements,Y===(L=F.elements)&&(L=L.slice()),P=0;P<4;P++)u=c[P],d=c[P+4],a=c[P+8],b=c[P+12],Y[P]=u*L[0]+d*L[1]+a*L[2]+b*L[3],Y[P+4]=u*L[4]+d*L[5]+a*L[6]+b*L[7],Y[P+8]=u*L[8]+d*L[9]+a*L[10]+b*L[11],Y[P+12]=u*L[12]+d*L[13]+a*L[14]+b*L[15]},T.createFromQuaternion=function(U,F){var O=F.elements,P=U.elements,Y=P[0],c=P[1],L=P[2],u=P[3],d=Y+Y,a=c+c,b=L+L,z=Y*d,J=c*d,w=c*a,j=L*d,x=L*a,r=L*b,H=u*d,h=u*a,Q=u*b;O[0]=1-w-r,O[1]=J+Q,O[2]=j-h,O[3]=0,O[4]=J-Q,O[5]=1-z-r,O[6]=x+H,O[7]=0,O[8]=j+h,O[9]=x-H,O[10]=1-z-w,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1},T.createAffineTransformation=function(U,F,O,P){var Y=U.elements,c=F.elements,L=O.elements,u=P.elements,d=c[0],a=c[1],b=c[2],z=c[3],J=d+d,w=a+a,j=b+b,x=d*J,r=d*w,H=d*j,h=a*w,Q=a*j,X=b*j,N=z*J,K=z*w,f=z*j,I=L[0],T=L[1],g=L[2];u[0]=(1-(h+X))*I,u[1]=(r+f)*I,u[2]=(H-K)*I,u[3]=0,u[4]=(r-f)*T,u[5]=(1-(x+X))*T,u[6]=(Q+N)*T,u[7]=0,u[8]=(H+K)*g,u[9]=(Q-N)*g,u[10]=(1-(x+h))*g,u[11]=0,u[12]=Y[0],u[13]=Y[1],u[14]=Y[2],u[15]=1},T.createLookAt=function(U,F,O,P){var Y=P.elements,c=T._tempVector0,L=T._tempVector1,u=T._tempVector2;LF.subtract(U,F,u),LF.normalize(u,u),LF.cross(O,u,c),LF.normalize(c,c),LF.cross(u,c,L),P.identity(),Y[0]=c.x,Y[4]=c.y,Y[8]=c.z,Y[1]=L.x,Y[5]=L.y,Y[9]=L.z,Y[2]=u.x,Y[6]=u.y,Y[10]=u.z,Y[12]=-LF.dot(c,U),Y[13]=-LF.dot(L,U),Y[14]=-LF.dot(u,U)},T.createPerspective=function(U,F,O,P,Y){var c=Y.elements,L=1/Math.tan(U/2),u=1/(O-P);c[0]=L/F,c[5]=L,c[10]=(P+O)*u,c[11]=-1,c[14]=2*P*O*u,c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[12]=c[13]=c[15]=0},T.createOrthoOffCenterRH=function(U,F,O,P,Y,c,L){var u=L.elements,d=1/(U-F),a=1/(O-P),b=1/(Y-c);u[1]=u[2]=u[3]=u[4]=u[6]=u[7]=u[8]=u[9]=u[11]=0,u[15]=1,u[0]=-2*d,u[5]=-2*a,u[10]=2*b,u[12]=(U+F)*d,u[13]=(P+O)*a,u[14]=(c+Y)*b},T.translation=function(U,F){var O=U.elements,P=F.elements;P[0]=P[5]=P[10]=P[15]=1,P[12]=O[0],P[13]=O[1],P[14]=O[2]},z(T,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new T},"_tempVector0",function(){return this._tempVector0=new LF},"_tempVector1",function(){return this._tempVector1=new LF},"_tempVector2",function(){return this._tempVector2=new LF},"_tempQuaternion",function(){return this._tempQuaternion=new OF},"DEFAULT",function(){return this.DEFAULT=new T},"ZERO",function(){return this.ZERO=new T(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),T}(),FF=(function(){function Q(U,F){this.extents=null,this.transformation=null,this.extents=U,this.transformation=F}w(Q,"laya.d3.math.OrientedBoundBox");var U=Q.prototype;U.getCorners=function(U){var F=Q._tempV30.elements,O=Q._tempV31.elements,P=Q._tempV32.elements,Y=this.extents.elements;F[0]=Y[0],F[1]=F[2]=0,O[1]=Y[1],O[0]=O[2]=0,P[2]=Y[2],P[0]=P[1]=0,LF.TransformNormal(Q._tempV30,this.transformation,Q._tempV30),LF.TransformNormal(Q._tempV31,this.transformation,Q._tempV31),LF.TransformNormal(Q._tempV32,this.transformation,Q._tempV32);var c=Q._tempV33;this.transformation.getTranslationVector(c),U.length=8,LF.add(c,Q._tempV30,Q._tempV34),LF.add(Q._tempV34,Q._tempV31,Q._tempV34),LF.add(Q._tempV34,Q._tempV32,U[0]),LF.add(c,Q._tempV30,Q._tempV34),LF.add(Q._tempV34,Q._tempV31,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV32,U[1]),LF.subtract(c,Q._tempV30,Q._tempV34),LF.add(Q._tempV34,Q._tempV31,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV32,U[2]),LF.subtract(c,Q._tempV30,Q._tempV34),LF.add(Q._tempV34,Q._tempV31,Q._tempV34),LF.add(Q._tempV34,Q._tempV32,U[3]),LF.add(c,Q._tempV30,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV31,Q._tempV34),LF.add(Q._tempV34,Q._tempV32,U[4]),LF.add(c,Q._tempV30,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV31,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV32,U[5]),LF.subtract(c,Q._tempV30,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV31,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV32,U[6]),LF.subtract(c,Q._tempV30,Q._tempV34),LF.subtract(Q._tempV34,Q._tempV31,Q._tempV34),LF.add(Q._tempV34,Q._tempV32,U[7])},U.transform=function(U){UF.multiply(this.transformation,U,this.transformation)},U.scale=function(U){LF.multiply(this.extents,U,this.extents)},U.translate=function(U){this.transformation.getTranslationVector(Q._tempV30),LF.add(Q._tempV30,U,Q._tempV31),this.transformation.setTranslationVector(Q._tempV31)},U.Size=function(U){LF.scale(this.extents,2,U)},U.getSize=function(U){var F=this.extents.elements;Q._tempV30.x=F[0],Q._tempV31.y=F[1],Q._tempV32.z=F[2],LF.TransformNormal(Q._tempV30,this.transformation,Q._tempV30),LF.TransformNormal(Q._tempV31,this.transformation,Q._tempV31),LF.TransformNormal(Q._tempV31,this.transformation,Q._tempV32);var O=U.elements;O[0]=LF.scalarLength(Q._tempV30),O[1]=LF.scalarLength(Q._tempV31),O[2]=LF.scalarLength(Q._tempV32)},U.getSizeSquared=function(U){var F=this.extents.elements;Q._tempV30.x=F[0],Q._tempV31.y=F[1],Q._tempV32.z=F[2],LF.TransformNormal(Q._tempV30,this.transformation,Q._tempV30),LF.TransformNormal(Q._tempV31,this.transformation,Q._tempV31),LF.TransformNormal(Q._tempV31,this.transformation,Q._tempV32);var O=U.elements;O[0]=LF.scalarLengthSquared(Q._tempV30),O[1]=LF.scalarLengthSquared(Q._tempV31),O[2]=LF.scalarLengthSquared(Q._tempV32)},U.getCenter=function(U){this.transformation.getTranslationVector(U)},U.containsPoint=function(U){var F=this.extents.elements,O=F[0],P=F[1],Y=F[2];this.transformation.invert(Q._tempM0),LF.transformCoordinate(U,Q._tempM0,Q._tempV30);var c=Q._tempV30.elements,L=Math.abs(c[0]),u=Math.abs(c[1]),d=Math.abs(c[2]);return BU.nearEqual(L,O)&&BU.nearEqual(u,P)&&BU.nearEqual(d,Y)?2:L<O&&u<P&&d<Y?1:0},U.containsPoints=function(U){var F=this.extents.elements,O=F[0],P=F[1],Y=F[2];this.transformation.invert(Q._tempM0);for(var c=!0,L=!1,u=0;u<U.length;u++){LF.transformCoordinate(U[u],Q._tempM0,Q._tempV30);var d=Q._tempV30.elements,a=Math.abs(d[0]),b=Math.abs(d[1]),z=Math.abs(d[2]);BU.nearEqual(a,O)&&BU.nearEqual(b,P)&&BU.nearEqual(z,Y)&&(L=!0),a<O&&b<P&&z<Y?L=!0:c=!1}return c?1:L?2:0},U.containsSphere=function(U,F){void 0===F&&(F=!1);var O=this.extents.elements,P=O[0],Y=O[1],c=O[2],L=U.radius;this.transformation.invert(Q._tempM0),LF.transformCoordinate(U.center,Q._tempM0,Q._tempV30);var u=NaN;if(u=F?L:(LF.scale(LF.UnitX,L,Q._tempV31),LF.TransformNormal(Q._tempV31,Q._tempM0,Q._tempV31),LF.scalarLength(Q._tempV31)),LF.scale(this.extents,-1,Q._tempV32),LF.Clamp(Q._tempV30,Q._tempV32,this.extents,Q._tempV33),u*u<LF.distanceSquared(Q._tempV30,Q._tempV33))return 0;var d=Q._tempV30.elements,a=d[0],b=d[1],z=d[2],J=Q._tempV32.elements,w=J[0],j=J[1],x=J[2];return w+u<=a&&a<=P-u&&u<P-w&&j+u<=b&&b<=Y-u&&u<Y-j&&x+u<=z&&z<=c-u&&u<c-x?1:2},U.containsOrientedBoundBox=function(U){var F=0,O=0;U.getCorners(Q._corners);var P=this.containsPoints(Q._corners);if(0!=P)return P;var Y=this.extents.elements;U.extents.cloneTo(Q._tempV35);var c=Q._tempV35.elements;Q._getRows(this.transformation,Q._rows1),Q._getRows(U.transformation,Q._rows2);var L=NaN;for(F=0;F<4;F++)for(O=0;O<4;O++)3==F||3==O?(Q._tempM0.setElementByRowColumn(F,O,0),Q._tempM1.setElementByRowColumn(F,O,0)):(L=LF.dot(Q._rows1[F],Q._rows2[O]),Q._tempM0.setElementByRowColumn(F,O,L),Q._tempM1.setElementByRowColumn(F,O,Math.abs(L)));U.getCenter(Q._tempV34),this.getCenter(Q._tempV36),LF.subtract(Q._tempV34,Q._tempV36,Q._tempV30);var u=Q._tempV31.elements;u[0]=LF.dot(Q._tempV30,Q._rows1[0]),u[1]=LF.dot(Q._tempV30,Q._rows1[1]),u[2]=LF.dot(Q._tempV30,Q._rows1[2]);var d=Q._tempV32.elements,a=Q._tempV33.elements;for(F=0;F<3;F++)if(d[0]=Q._tempM1.getElementByRowColumn(F,0),d[1]=Q._tempM1.getElementByRowColumn(F,1),d[2]=Q._tempM1.getElementByRowColumn(F,2),Y[F]+LF.dot(Q._tempV35,Q._tempV32)<Math.abs(u[F]))return 0;for(O=0;O<3;O++)if(d[0]=Q._tempM1.getElementByRowColumn(0,O),d[1]=Q._tempM1.getElementByRowColumn(1,O),d[2]=Q._tempM1.getElementByRowColumn(2,O),a[0]=Q._tempM0.getElementByRowColumn(0,O),a[1]=Q._tempM0.getElementByRowColumn(1,O),a[2]=Q._tempM0.getElementByRowColumn(2,O),LF.dot(this.extents,Q._tempV32)+c[O]<Math.abs(LF.dot(Q._tempV31,Q._tempV33)))return 0;for(F=0;F<3;F++)for(O=0;O<3;O++){var b=(F+1)%3,z=(F+2)%3,J=(O+1)%3,w=(O+2)%3;if(Y[b]*Q._tempM1.getElementByRowColumn(z,O)+Y[z]*Q._tempM1.getElementByRowColumn(b,O)+(c[J]*Q._tempM1.getElementByRowColumn(F,w)+c[w]*Q._tempM1.getElementByRowColumn(F,J))<Math.abs(u[z]*Q._tempM0.getElementByRowColumn(b,O)-u[b]*Q._tempM0.getElementByRowColumn(z,O)))return 0}return 2},U.containsLine=function(U,F){Q._corners[0]=U,Q._corners[1]=F;var O=this.containsPoints(Q._corners);if(0!=O)return O;var P=this.extents.elements,Y=P[0],c=P[1],L=P[2];this.transformation.invert(Q._tempM0),LF.transformCoordinate(U,Q._tempM0,Q._tempV30),LF.transformCoordinate(F,Q._tempM0,Q._tempV31),LF.add(Q._tempV30,Q._tempV31,Q._tempV32),LF.scale(Q._tempV32,.5,Q._tempV32),LF.subtract(Q._tempV30,Q._tempV32,Q._tempV33);var u=Q._tempV33.elements,d=u[0],a=u[1],b=u[2],z=Q._tempV34.elements,J=z[0]=Math.abs(u[0]),w=z[1]=Math.abs(u[1]),j=z[2]=Math.abs(u[2]),x=Q._tempV32.elements,r=x[0],H=x[1],h=x[2];return Math.abs(r)>Y+J?0:Math.abs(H)>c+w?0:Math.abs(h)>L+j?0:Math.abs(H*b-h*a)>c*j+L*w?0:Math.abs(r*b-h*d)>Y*j+L*J?0:Math.abs(r*a-H*d)>Y*w+c*J?0:2},U.containsBoundBox=function(U){var F=0,O=0,P=U.min,Y=U.max;U.getCorners(Q._corners);var c=this.containsPoints(Q._corners);if(0!=c)return c;LF.subtract(Y,P,Q._tempV30),LF.scale(Q._tempV30,.5,Q._tempV30),LF.add(P,Q._tempV30,Q._tempV30),LF.subtract(Y,Q._tempV30,Q._tempV31);var L=this.extents.elements,u=Q._tempV31.elements;Q._getRows(this.transformation,Q._rows1),this.transformation.invert(Q._tempM0);for(F=0;F<3;F++)for(O=0;O<3;O++)Q._tempM1.setElementByRowColumn(F,O,Math.abs(Q._tempM0.getElementByRowColumn(F,O)));this.getCenter(Q._tempV35),LF.subtract(Q._tempV30,Q._tempV35,Q._tempV32);var d=Q._tempV31.elements;d[0]=LF.dot(Q._tempV32,Q._rows1[0]),d[1]=LF.dot(Q._tempV32,Q._rows1[1]),d[2]=LF.dot(Q._tempV32,Q._rows1[2]);var a=Q._tempV33.elements,b=Q._tempV34.elements;for(F=0;F<3;F++)if(a[0]=Q._tempM1.getElementByRowColumn(F,0),a[1]=Q._tempM1.getElementByRowColumn(F,1),a[2]=Q._tempM1.getElementByRowColumn(F,2),L[F]+LF.dot(Q._tempV31,Q._tempV33)<Math.abs(d[F]))return 0;for(O=0;O<3;O++)if(a[0]=Q._tempM1.getElementByRowColumn(0,O),a[1]=Q._tempM1.getElementByRowColumn(1,O),a[2]=Q._tempM1.getElementByRowColumn(2,O),b[0]=Q._tempM0.getElementByRowColumn(0,O),b[1]=Q._tempM0.getElementByRowColumn(1,O),b[2]=Q._tempM0.getElementByRowColumn(2,O),LF.dot(this.extents,Q._tempV33)+u[O]<Math.abs(LF.dot(Q._tempV31,Q._tempV34)))return 0;for(F=0;F<3;F++)for(O=0;O<3;O++){var z=(F+1)%3,J=(F+2)%3,w=(O+1)%3,j=(O+2)%3;if(L[z]*Q._tempM1.getElementByRowColumn(J,O)+L[J]*Q._tempM1.getElementByRowColumn(z,O)+(u[w]*Q._tempM1.getElementByRowColumn(F,j)+u[j]*Q._tempM1.getElementByRowColumn(F,w))<Math.abs(d[J]*Q._tempM0.getElementByRowColumn(z,O)-d[z]*Q._tempM0.getElementByRowColumn(J,O)))return 0}return 2},U.intersectsRay=function(U,F){LF.scale(this.extents,-1,Q._tempV30),this.transformation.invert(Q._tempM0),LF.TransformNormal(U.direction,Q._tempM0,Q._ray.direction),LF.transformCoordinate(U.origin,Q._tempM0,Q._ray.origin),Q._boxBound1.min=Q._tempV30,Q._boxBound1.max=this.extents;var O=Collision.intersectsRayAndBoxRP(Q._ray,Q._boxBound1,F);return-1!==O&&LF.transformCoordinate(F,this.transformation,F),O},U._getLocalCorners=function(U){U.length=8;var F=this.extents.elements;Q._tempV30.x=F[0],Q._tempV31.y=F[1],Q._tempV32.z=F[2],LF.add(Q._tempV30,Q._tempV31,Q._tempV33),LF.add(Q._tempV33,Q._tempV32,U[0]),LF.add(Q._tempV30,Q._tempV31,Q._tempV33),LF.subtract(Q._tempV33,Q._tempV32,U[1]),LF.subtract(Q._tempV31,Q._tempV30,Q._tempV33),LF.subtract(Q._tempV33,Q._tempV30,U[2]),LF.subtract(Q._tempV31,Q._tempV30,Q._tempV33),LF.add(Q._tempV33,Q._tempV32,U[3]),LF.subtract(Q._tempV30,Q._tempV31,Q._tempV33),LF.add(Q._tempV33,Q._tempV32,U[4]),LF.subtract(Q._tempV30,Q._tempV31,Q._tempV33),LF.subtract(Q._tempV33,Q._tempV32,U[5]),LF.scale(U[0],-1,U[6]),LF.subtract(Q._tempV32,Q._tempV30,Q._tempV33),LF.subtract(Q._tempV33,Q._tempV31,U[7])},U.equals=function(U){return this.extents==U.extents&&this.transformation==U.transformation},U.cloneTo=function(U){var F=U;this.extents.cloneTo(F.extents),this.transformation.cloneTo(F.transformation)},Q.createByBoundBox=function(U,F){var O=U.min,P=U.max;LF.subtract(P,O,Q._tempV30),LF.scale(Q._tempV30,.5,Q._tempV30),LF.add(O,Q._tempV30,Q._tempV31),LF.subtract(P,Q._tempV31,Q._tempV32),UF.translation(Q._tempV31,Q._tempM0);var Y=Q._tempV32.clone(),c=Q._tempM0.clone();F.extents=Y,F.transformation=c},Q.createByMinAndMaxVertex=function(U,F){return LF.subtract(F,U,Q._tempV30),LF.scale(Q._tempV30,.5,Q._tempV30),LF.add(U,Q._tempV30,Q._tempV31),LF.subtract(F,Q._tempV31,Q._tempV32),UF.translation(Q._tempV31,Q._tempM0),new Q(Q._tempV32,Q._tempM0)},Q._getRows=function(U,F){F.length=3;var O=U.elements,P=F[0].elements;P[0]=O[0],P[1]=O[1],P[2]=O[2];var Y=F[1].elements;Y[0]=O[4],Y[1]=O[5],Y[2]=O[6];var c=F[2].elements;c[0]=O[8],c[1]=O[9],c[2]=O[10]},Q.getObbtoObbMatrix4x4=function(U,F,O,P){var Y=U.transformation,c=F.transformation;if(O){Q._getRows(Y,Q._rows1),Q._getRows(c,Q._rows2);for(var L=0;L<3;L++)for(var u=0;u<3;u++)P.setElementByRowColumn(L,u,LF.dot(Q._rows2[L],Q._rows1[u]));F.getCenter(Q._tempV30),U.getCenter(Q._tempV31),LF.subtract(Q._tempV30,Q._tempV31,Q._tempV32);var d=P.elements;d[12]=LF.dot(Q._tempV32,Q._rows1[0]),d[13]=LF.dot(Q._tempV32,Q._rows1[1]),d[14]=LF.dot(Q._tempV32,Q._rows1[2]),d[15]=1}else Y.invert(Q._tempM0),UF.multiply(c,Q._tempM0,P)},Q.merge=function(U,F,O){var P=U.extents,Y=U.transformation;Q.getObbtoObbMatrix4x4(U,F,O,Q._tempM0),F._getLocalCorners(Q._corners),LF.transformCoordinate(Q._corners[0],Q._tempM0,Q._corners[0]),LF.transformCoordinate(Q._corners[1],Q._tempM0,Q._corners[1]),LF.transformCoordinate(Q._corners[2],Q._tempM0,Q._corners[2]),LF.transformCoordinate(Q._corners[3],Q._tempM0,Q._corners[3]),LF.transformCoordinate(Q._corners[4],Q._tempM0,Q._corners[4]),LF.transformCoordinate(Q._corners[5],Q._tempM0,Q._corners[5]),LF.transformCoordinate(Q._corners[6],Q._tempM0,Q._corners[6]),LF.transformCoordinate(Q._corners[7],Q._tempM0,Q._corners[7]),LF.scale(P,-1,Q._boxBound1.min),P.cloneTo(Q._boxBound1.max),tU.createfromPoints(Q._corners,Q._boxBound2),tU.merge(Q._boxBound2,Q._boxBound1,Q._boxBound3);var c=Q._boxBound3.min,L=Q._boxBound3.max;LF.subtract(L,c,Q._tempV30),LF.scale(Q._tempV30,.5,Q._tempV30),LF.add(c,Q._tempV30,Q._tempV32),LF.subtract(L,Q._tempV32,P),LF.transformCoordinate(Q._tempV32,Y,Q._tempV33)},z(Q,["_tempV30",function(){return this._tempV30=new LF},"_tempV31",function(){return this._tempV31=new LF},"_tempV32",function(){return this._tempV32=new LF},"_tempV33",function(){return this._tempV33=new LF},"_tempV34",function(){return this._tempV34=new LF},"_tempV35",function(){return this._tempV35=new LF},"_tempV36",function(){return this._tempV36=new LF},"_tempM0",function(){return this._tempM0=new UF},"_tempM1",function(){return this._tempM1=new UF},"_corners",function(){return this._corners=[new LF,new LF,new LF,new LF,new LF,new LF,new LF,new LF]},"_rows1",function(){return this._rows1=[new LF,new LF,new LF]},"_rows2",function(){return this._rows2=[new LF,new LF,new LF]},"_ray",function(){return this._ray=new YF(new LF,new LF)},"_boxBound1",function(){return this._boxBound1=new tU(new LF,new LF)},"_boxBound2",function(){return this._boxBound2=new tU(new LF,new LF)},"_boxBound3",function(){return this._boxBound3=new tU(new LF,new LF)}])}(),function(){function N(U,F){this.normal=null,this.distance=NaN,void 0===F&&(F=0),this.normal=U,this.distance=F}return w(N,"laya.d3.math.Plane"),N.prototype.normalize=function(){var U=this.normal.elements,F=U[0],O=U[1],P=U[2],Y=1/Math.sqrt(F*F+O*O+P*P);U[0]=F*Y,U[1]=O*Y,U[2]=P*Y,this.distance*=Y},N.createPlaneBy3P=function(U,F,O){var P=U.elements,Y=F.elements,c=O.elements,L=Y[0]-P[0],u=Y[1]-P[1],d=Y[2]-P[2],a=c[0]-P[0],b=c[1]-P[1],z=c[2]-P[2],J=u*z-d*b,w=d*a-L*z,j=L*b-u*a,x=1/Math.sqrt(J*J+w*w+j*j),r=J*x,H=w*x,h=j*x,Q=N._TEMPVec3.elements;Q[0]=r,Q[1]=H,Q[2]=h;var X=-(r*P[0]+H*P[1]+h*P[2]);return new N(N._TEMPVec3,X)},N.PlaneIntersectionType_Back=0,N.PlaneIntersectionType_Front=1,N.PlaneIntersectionType_Intersecting=2,z(N,["_TEMPVec3",function(){return this._TEMPVec3=new LF}]),N}()),OF=function(){function Y(U,F,O,P){this.elements=new Float32Array(4),void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=1),this.elements[0]=U,this.elements[1]=F,this.elements[2]=O,this.elements[3]=P}w(Y,"laya.d3.math.Quaternion");var U=Y.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.scaling=function(U,F){var O=F.elements,P=this.elements;O[0]=P[0]*U,O[1]=P[1]*U,O[2]=P[2]*U,O[3]=P[3]*U},U.normalize=function(U){var F=U.elements,O=this.elements,P=O[0],Y=O[1],c=O[2],L=O[3],u=P*P+Y*Y+c*c+L*L;0<u&&(u=1/Math.sqrt(u),F[0]=P*u,F[1]=Y*u,F[2]=c*u,F[3]=L*u)},U.length=function(){var U=this.elements,F=U[0],O=U[1],P=U[2],Y=U[3];return Math.sqrt(F*F+O*O+P*P+Y*Y)},U.rotateX=function(U,F){var O=F.elements,P=this.elements;U*=.5;var Y=P[0],c=P[1],L=P[2],u=P[3],d=Math.sin(U),a=Math.cos(U);O[0]=Y*a+u*d,O[1]=c*a+L*d,O[2]=L*a-c*d,O[3]=u*a-Y*d},U.rotateY=function(U,F){var O=F.elements,P=this.elements;U*=.5;var Y=P[0],c=P[1],L=P[2],u=P[3],d=Math.sin(U),a=Math.cos(U);O[0]=Y*a-L*d,O[1]=c*a+u*d,O[2]=L*a+Y*d,O[3]=u*a-c*d},U.rotateZ=function(U,F){var O=F.elements,P=this.elements;U*=.5;var Y=P[0],c=P[1],L=P[2],u=P[3],d=Math.sin(U),a=Math.cos(U);O[0]=Y*a+c*d,O[1]=c*a-Y*d,O[2]=L*a+u*d,O[3]=u*a-L*d},U.getYawPitchRoll=function(U){LF.transformQuat(LF.ForwardRH,this,Y.TEMPVector31),LF.transformQuat(LF.Up,this,Y.TEMPVector32);var F=Y.TEMPVector32.elements;Y.angleTo(LF.ZERO,Y.TEMPVector31,Y.TEMPVector33);var O=Y.TEMPVector33.elements;O[0]==Math.PI/2?(O[1]=Y.arcTanAngle(F[2],F[0]),O[2]=0):O[0]==-Math.PI/2?(O[1]=Y.arcTanAngle(-F[2],-F[0]),O[2]=0):(UF.createRotationY(-O[1],Y.TEMPMatrix0),UF.createRotationX(-O[0],Y.TEMPMatrix1),LF.transformCoordinate(Y.TEMPVector32,Y.TEMPMatrix0,Y.TEMPVector32),LF.transformCoordinate(Y.TEMPVector32,Y.TEMPMatrix1,Y.TEMPVector32),O[2]=Y.arcTanAngle(F[1],-F[0])),O[1]<=-Math.PI&&(O[1]=Math.PI),O[2]<=-Math.PI&&(O[2]=Math.PI),O[1]>=Math.PI&&O[2]>=Math.PI&&(O[1]=0,O[2]=0,O[0]=Math.PI-O[0]);var P=U.elements;P[0]=O[1],P[1]=O[0],P[2]=O[2]},U.invert=function(U){var F=U.elements,O=this.elements,P=O[0],Y=O[1],c=O[2],L=O[3],u=P*P+Y*Y+c*c+L*L,d=u?1/u:0;F[0]=-P*d,F[1]=-Y*d,F[2]=-c*d,F[3]=L*d},U.identity=function(){var U=this.elements;U[0]=0,U[1]=0,U[2]=0,U[3]=1},U.fromArray=function(U,F){void 0===F&&(F=0),this.elements[0]=U[F+0],this.elements[1]=U[F+1],this.elements[2]=U[F+2],this.elements[3]=U[F+3]},U.cloneTo=function(U){var F,O,P;if((O=this.elements)!==(P=U.elements))for(F=0;F<4;++F)P[F]=O[F]},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},U.equals=function(U){var F=this.elements,O=U.elements;return BU.nearEqual(F[0],O[0])&&BU.nearEqual(F[1],O[1])&&BU.nearEqual(F[2],O[2])&&BU.nearEqual(F[3],O[3])},U.lengthSquared=function(){var U=this.elements[0],F=this.elements[1],O=this.elements[2],P=this.elements[3];return U*U+F*F+O*O+P*P},j(0,U,"x",function(){return this.elements[0]}),j(0,U,"y",function(){return this.elements[1]}),j(0,U,"z",function(){return this.elements[2]}),j(0,U,"w",function(){return this.elements[3]}),Y.createFromYawPitchRoll=function(U,F,O,P){var Y=.5*O,c=.5*F,L=.5*U,u=Math.sin(Y),d=Math.cos(Y),a=Math.sin(c),b=Math.cos(c),z=Math.sin(L),J=Math.cos(L),w=P.elements;w[0]=J*a*d+z*b*u,w[1]=z*b*d-J*a*u,w[2]=J*b*u-z*a*d,w[3]=J*b*d+z*a*u},Y.multiply=function(U,F,O){var P=U.elements,Y=F.elements,c=O.elements,L=P[0],u=P[1],d=P[2],a=P[3],b=Y[0],z=Y[1],J=Y[2],w=Y[3],j=u*J-d*z,x=d*b-L*J,r=L*z-u*b,H=L*b+u*z+d*J;c[0]=L*w+b*a+j,c[1]=u*w+z*a+x,c[2]=d*w+J*a+r,c[3]=a*w-H},Y.arcTanAngle=function(U,F){return 0==U?1==F?Math.PI/2:-Math.PI/2:0<U?Math.atan(F/U):U<0?0<F?Math.atan(F/U)+Math.PI:Math.atan(F/U)-Math.PI:0},Y.angleTo=function(U,F,O){LF.subtract(F,U,Y.TEMPVector30),LF.normalize(Y.TEMPVector30,Y.TEMPVector30),O.elements[0]=Math.asin(Y.TEMPVector30.y),O.elements[1]=Y.arcTanAngle(-Y.TEMPVector30.z,-Y.TEMPVector30.x)},Y.createFromAxisAngle=function(U,F,O){var P=O.elements,Y=U.elements;F*=.5;var c=Math.sin(F);P[0]=c*Y[0],P[1]=c*Y[1],P[2]=c*Y[2],P[3]=Math.cos(F)},Y.createFromMatrix3x3=function(U,F){var O,P=F.elements,Y=U.elements,c=Y[0]+Y[4]+Y[8];if(0<c)O=Math.sqrt(c+1),P[3]=.5*O,O=.5/O,P[0]=(Y[5]-Y[7])*O,P[1]=(Y[6]-Y[2])*O,P[2]=(Y[1]-Y[3])*O;else{var L=0;Y[4]>Y[0]&&(L=1),Y[8]>Y[3*L+L]&&(L=2);var u=(L+1)%3,d=(L+2)%3;O=Math.sqrt(Y[3*L+L]-Y[3*u+u]-Y[3*d+d]+1),P[L]=.5*O,O=.5/O,P[3]=(Y[3*u+d]-Y[3*d+u])*O,P[u]=(Y[3*u+L]+Y[3*L+u])*O,P[d]=(Y[3*d+L]+Y[3*L+d])*O}},Y.createFromMatrix4x4=function(U,F){var O,P,Y=U.elements,c=F.elements,L=Y[0]+Y[5]+Y[10];0<L?(O=Math.sqrt(L+1),c[3]=.5*O,O=.5/O,c[0]=(Y[6]-Y[9])*O,c[1]=(Y[8]-Y[2])*O,c[2]=(Y[1]-Y[4])*O):Y[0]>=Y[5]&&Y[0]>=Y[10]?(P=.5/(O=Math.sqrt(1+Y[0]-Y[5]-Y[10])),c[0]=.5*O,c[1]=(Y[1]+Y[4])*P,c[2]=(Y[2]+Y[8])*P,c[3]=(Y[6]-Y[9])*P):Y[5]>Y[10]?(P=.5/(O=Math.sqrt(1+Y[5]-Y[0]-Y[10])),c[0]=(Y[4]+Y[1])*P,c[1]=.5*O,c[2]=(Y[9]+Y[6])*P,c[3]=(Y[8]-Y[2])*P):(P=.5/(O=Math.sqrt(1+Y[10]-Y[0]-Y[5])),c[0]=(Y[8]+Y[2])*P,c[1]=(Y[9]+Y[6])*P,c[2]=.5*O,c[3]=(Y[1]-Y[4])*P)},Y.slerp=function(U,F,O,P){var Y,c,L,u,d,a=U.elements,b=F.elements,z=P.elements,J=a[0],w=a[1],j=a[2],x=a[3],r=b[0],H=b[1],h=b[2],Q=b[3];return(c=J*r+w*H+j*h+x*Q)<0&&(c=-c,r=-r,H=-H,h=-h,Q=-Q),d=1e-6<1-c?(Y=Math.acos(c),L=Math.sin(Y),u=Math.sin((1-O)*Y)/L,Math.sin(O*Y)/L):(u=1-O,O),z[0]=u*J+d*r,z[1]=u*w+d*H,z[2]=u*j+d*h,z[3]=u*x+d*Q,z},Y.lerp=function(U,F,O,P){var Y=P.elements,c=U.elements,L=F.elements,u=c[0],d=c[1],a=c[2],b=c[3];Y[0]=u+O*(L[0]-u),Y[1]=d+O*(L[1]-d),Y[2]=a+O*(L[2]-a),Y[3]=b+O*(L[3]-b)},Y.add=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]+c[0],P[1]=Y[1]+c[1],P[2]=Y[2]+c[2],P[3]=Y[3]+c[3]},Y.dot=function(U,F){var O=U.elements,P=F.elements;return O[0]*P[0]+O[1]*P[1]+O[2]*P[2]+O[3]*P[3]},Y.rotationLookAt=function(U,F,O){Y.lookAt(LF.ZERO,U,F,O)},Y.lookAt=function(U,F,O,P){EU.lookAt(U,F,O,Y._tempMatrix3x3),Y.rotationMatrix(Y._tempMatrix3x3,P)},Y.invert=function(U,F){var O=U.elements,P=F.elements,Y=U.lengthSquared();BU.isZero(Y)||(Y=1/Y,P[0]=-O[0]*Y,P[1]=-O[1]*Y,P[2]=-O[2]*Y,P[3]=O[3]*Y)},Y.rotationMatrix=function(U,F){var O=U.elements,P=O[0],Y=O[1],c=O[2],L=O[3],u=O[4],d=O[5],a=O[6],b=O[7],z=O[8],J=F.elements,w=NaN,j=NaN,x=P+u+z;0<x?(w=Math.sqrt(x+1),J[3]=.5*w,w=.5/w,J[0]=(d-b)*w,J[1]=(a-c)*w,J[2]=(Y-L)*w):u<=P&&z<=P?(j=.5/(w=Math.sqrt(1+P-u-z)),J[0]=.5*w,J[1]=(Y+L)*j,J[2]=(c+a)*j,J[3]=(d-b)*j):z<u?(j=.5/(w=Math.sqrt(1+u-P-z)),J[0]=(L+Y)*j,J[1]=.5*w,J[2]=(b+d)*j,J[3]=(a-c)*j):(j=.5/(w=Math.sqrt(1+z-P-u)),J[0]=(a+c)*j,J[1]=(b+d)*j,J[2]=.5*w,J[3]=(Y-L)*j)},Y.DEFAULT=new Y,z(Y,["TEMPVector30",function(){return this.TEMPVector30=new LF},"TEMPVector31",function(){return this.TEMPVector31=new LF},"TEMPVector32",function(){return this.TEMPVector32=new LF},"TEMPVector33",function(){return this.TEMPVector33=new LF},"TEMPMatrix0",function(){return this.TEMPMatrix0=new UF},"TEMPMatrix1",function(){return this.TEMPMatrix1=new UF},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new EU},"NAN",function(){return this.NAN=new Y(NaN,NaN,NaN,NaN)}]),Y}(),PF=function(){function U(U){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=U,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}w(U,"laya.d3.math.Rand");var F=U.prototype;return F.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},F.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},F.getSignedFloat=function(){return 2*this.getFloat()-1},j(0,F,"seed",function(){return this.seeds[0]},function(U){this.seeds[0]=U,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),U.getFloatFromInt=function(U){return 1/8388607*(8388607&U)},U.getByteFromInt=function(U){return(8388607&U)>>>15},U}(),YF=(function(){function Y(U){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(U instanceof Array)||4!==U.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|U[0],this._state0L=0|U[1],this._state1U=0|U[2],this._state1L=0|U[3]}w(Y,"laya.d3.math.RandX");var U=Y.prototype;U.randomint=function(){var U=this._state0U,F=this._state0L,O=this._state1U,P=this._state1L,Y=(P>>>0)+(F>>>0),c=O+U+(Y/2>>>31)>>>0,L=Y>>>0,u=0,d=0;u=(U^=u=U<<23|(-512&F)>>>9)^(this._state0U=O),d=(F^=d=F<<23)^(this._state0L=P);u^=U>>>18,d^=F>>>18|(262143&U)<<14;return u^=O>>>5,d^=P>>>5|(31&O)<<27,this._state1U=u,this._state1L=d,[c,L]},U.random=function(){var U=this.randomint(),F=U[0],O=1023<<20|F>>>12,P=0|(U[1]>>>12|(4095&F)<<20);return Y._CONVERTION_BUFFER.setUint32(0,O,!1),Y._CONVERTION_BUFFER.setUint32(4,P,!1),PF._CONVERTION_BUFFER.getFloat64(0,!1)-1},z(Y,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new PF([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function U(U,F){this.origin=null,this.direction=null,this.origin=U,this.direction=F}return w(U,"laya.d3.math.Ray"),U}()),cF=function(){function U(U,F){this.elements=new Float32Array(2),void 0===U&&(U=0),void 0===F&&(F=0);var O=this.elements;O[0]=U,O[1]=F}w(U,"laya.d3.math.Vector2");var F=U.prototype;return N.imps(F,{"laya.d3.core.IClone":!0}),F.fromArray=function(U,F){void 0===F&&(F=0),this.elements[0]=U[F+0],this.elements[1]=U[F+1]},F.cloneTo=function(U){var F=U.elements,O=this.elements;F[0]=O[0],F[1]=O[1]},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"x",function(){return this.elements[0]},function(U){this.elements[0]=U}),j(0,F,"y",function(){return this.elements[1]},function(U){this.elements[1]=U}),U.scale=function(U,F,O){var P=O.elements,Y=U.elements;P[0]=Y[0]*F,P[1]=Y[1]*F},z(U,["ZERO",function(){return this.ZERO=new U(0,0)},"ONE",function(){return this.ONE=new U(1,1)}]),U}(),LF=function(){function b(U,F,O){this.elements=new Float32Array(3),void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0);var P=this.elements;P[0]=U,P[1]=F,P[2]=O}w(b,"laya.d3.math.Vector3");var U=b.prototype;return N.imps(U,{"laya.d3.core.IClone":!0}),U.fromArray=function(U,F){void 0===F&&(F=0),this.elements[0]=U[F+0],this.elements[1]=U[F+1],this.elements[2]=U[F+2]},U.cloneTo=function(U){var F=U.elements,O=this.elements;F[0]=O[0],F[1]=O[1],F[2]=O[2]},U.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},U.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},U.reset=function(U,F,O){this.elements[0]=U,this.elements[1]=F,this.elements[2]=O},j(0,U,"x",function(){return this.elements[0]},function(U){this.elements[0]=U}),j(0,U,"y",function(){return this.elements[1]},function(U){this.elements[1]=U}),j(0,U,"z",function(){return this.elements[2]},function(U){this.elements[2]=U}),b.distanceSquared=function(U,F){var O=U.elements,P=F.elements,Y=O[0]-P[0],c=O[1]-P[1],L=O[2]-P[2];return Y*Y+c*c+L*L},b.distance=function(U,F){var O=U.elements,P=F.elements,Y=O[0]-P[0],c=O[1]-P[1],L=O[2]-P[2];return Math.sqrt(Y*Y+c*c+L*L)},b.min=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Math.min(Y[0],c[0]),P[1]=Math.min(Y[1],c[1]),P[2]=Math.min(Y[2],c[2])},b.max=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Math.max(Y[0],c[0]),P[1]=Math.max(Y[1],c[1]),P[2]=Math.max(Y[2],c[2])},b.transformQuat=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements,L=Y[0],u=Y[1],d=Y[2],a=c[0],b=c[1],z=c[2],J=c[3],w=J*L+b*d-z*u,j=J*u+z*L-a*d,x=J*d+a*u-b*L,r=-a*L-b*u-z*d;P[0]=w*J+r*-a+j*-z-x*-b,P[1]=j*J+r*-b+x*-a-w*-z,P[2]=x*J+r*-z+w*-b-j*-a},b.scalarLength=function(U){var F=U.elements,O=F[0],P=F[1],Y=F[2];return Math.sqrt(O*O+P*P+Y*Y)},b.scalarLengthSquared=function(U){var F=U.elements,O=F[0],P=F[1],Y=F[2];return O*O+P*P+Y*Y},b.normalize=function(U,F){var O=U.elements,P=F.elements,Y=O[0],c=O[1],L=O[2],u=Y*Y+c*c+L*L;0<u&&(u=1/Math.sqrt(u),P[0]=O[0]*u,P[1]=O[1]*u,P[2]=O[2]*u)},b.multiply=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]*c[0],P[1]=Y[1]*c[1],P[2]=Y[2]*c[2]},b.scale=function(U,F,O){var P=O.elements,Y=U.elements;P[0]=Y[0]*F,P[1]=Y[1]*F,P[2]=Y[2]*F},b.lerp=function(U,F,O,P){var Y=P.elements,c=U.elements,L=F.elements,u=c[0],d=c[1],a=c[2];Y[0]=u+O*(L[0]-u),Y[1]=d+O*(L[1]-d),Y[2]=a+O*(L[2]-a)},b.transformV3ToV3=function(U,F,O){var P=b._tempVector4;b.transformV3ToV4(U,F,P);var Y=P.elements,c=O.elements;c[0]=Y[0],c[1]=Y[1],c[2]=Y[2]},b.transformV3ToV4=function(U,F,O){var P=U.elements,Y=P[0],c=P[1],L=P[2],u=F.elements,d=O.elements;d[0]=Y*u[0]+c*u[4]+L*u[8]+u[12],d[1]=Y*u[1]+c*u[5]+L*u[9]+u[13],d[2]=Y*u[2]+c*u[6]+L*u[10]+u[14],d[3]=Y*u[3]+c*u[7]+L*u[11]+u[15]},b.TransformNormal=function(U,F,O){var P=U.elements,Y=P[0],c=P[1],L=P[2],u=F.elements,d=O.elements;d[0]=Y*u[0]+c*u[4]+L*u[8],d[1]=Y*u[1]+c*u[5]+L*u[9],d[2]=Y*u[2]+c*u[6]+L*u[10]},b.transformCoordinate=function(U,F,O){var P=b._tempVector4.elements,Y=U.elements,c=Y[0],L=Y[1],u=Y[2],d=F.elements;P[0]=c*d[0]+L*d[4]+u*d[8]+d[12],P[1]=c*d[1]+L*d[5]+u*d[9]+d[13],P[2]=c*d[2]+L*d[6]+u*d[10]+d[14],P[3]=1/(c*d[3]+L*d[7]+u*d[11]+d[15]);var a=O.elements;a[0]=P[0]*P[3],a[1]=P[1]*P[3],a[2]=P[2]*P[3]},b.Clamp=function(U,F,O,P){var Y=U.elements,c=Y[0],L=Y[1],u=Y[2],d=F.elements,a=d[0],b=d[1],z=d[2],J=O.elements,w=J[0],j=J[1],x=J[2],r=P.elements;c=(c=w<c?w:c)<a?a:c,L=(L=j<L?j:L)<b?b:L,u=(u=x<u?x:u)<z?z:u,r[0]=c,r[1]=L,r[2]=u},b.add=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]+c[0],P[1]=Y[1]+c[1],P[2]=Y[2]+c[2]},b.subtract=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]-c[0],P[1]=Y[1]-c[1],P[2]=Y[2]-c[2]},b.cross=function(U,F,O){var P=U.elements,Y=F.elements,c=O.elements,L=P[0],u=P[1],d=P[2],a=Y[0],b=Y[1],z=Y[2];c[0]=u*z-d*b,c[1]=d*a-L*z,c[2]=L*b-u*a},b.dot=function(U,F){var O=U.elements,P=F.elements;return O[0]*P[0]+O[1]*P[1]+O[2]*P[2]},b.equals=function(U,F){var O=U.elements,P=F.elements;return BU.nearEqual(Math.abs(O[0]),Math.abs(P[0]))&&BU.nearEqual(Math.abs(O[1]),Math.abs(P[1]))&&BU.nearEqual(Math.abs(O[2]),Math.abs(P[2]))},b.ZERO=new b(0,0,0),b.ONE=new b(1,1,1),b.NegativeUnitX=new b(-1,0,0),b.UnitX=new b(1,0,0),b.UnitY=new b(0,1,0),b.UnitZ=new b(0,0,1),b.ForwardRH=new b(0,0,-1),b.ForwardLH=new b(0,0,1),b.Up=new b(0,1,0),b.NAN=new b(NaN,NaN,NaN),z(b,["_tempVector4",function(){return this._tempVector4=new uF}]),b}(),uF=function(){function U(U,F,O,P){this.elements=new Float32Array(4),void 0===U&&(U=0),void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=0);var Y=this.elements;Y[0]=U,Y[1]=F,Y[2]=O,Y[3]=P}w(U,"laya.d3.math.Vector4");var F=U.prototype;return N.imps(F,{"laya.d3.core.IClone":!0}),F.fromArray=function(U,F){void 0===F&&(F=0),this.elements[0]=U[F+0],this.elements[1]=U[F+1],this.elements[2]=U[F+2],this.elements[3]=U[F+3]},F.cloneTo=function(U){var F=U.elements,O=this.elements;F[0]=O[0],F[1]=O[1],F[2]=O[2],F[3]=O[3]},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},F.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},F.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},j(0,F,"x",function(){return this.elements[0]},function(U){this.elements[0]=U}),j(0,F,"y",function(){return this.elements[1]},function(U){this.elements[1]=U}),j(0,F,"z",function(){return this.elements[2]},function(U){this.elements[2]=U}),j(0,F,"w",function(){return this.elements[3]},function(U){this.elements[3]=U}),U.lerp=function(U,F,O,P){var Y=P.elements,c=U.elements,L=F.elements,u=c[0],d=c[1],a=c[2],b=c[3];Y[0]=u+O*(L[0]-u),Y[1]=d+O*(L[1]-d),Y[2]=a+O*(L[2]-a),Y[3]=b+O*(L[3]-b)},U.transformByM4x4=function(U,F,O){var P=U.elements,Y=P[0],c=P[1],L=P[2],u=P[3],d=F.elements,a=O.elements;a[0]=Y*d[0]+c*d[4]+L*d[8]+u*d[12],a[1]=Y*d[1]+c*d[5]+L*d[9]+u*d[13],a[2]=Y*d[2]+c*d[6]+L*d[10]+u*d[14],a[3]=Y*d[3]+c*d[7]+L*d[11]+u*d[15]},U.equals=function(U,F){var O=U.elements,P=F.elements;return BU.nearEqual(Math.abs(O[0]),Math.abs(P[0]))&&BU.nearEqual(Math.abs(O[1]),Math.abs(P[1]))&&BU.nearEqual(Math.abs(O[2]),Math.abs(P[2]))&&BU.nearEqual(Math.abs(O[3]),Math.abs(P[3]))},U.normalize=function(U,F){var O=U.elements,P=F.elements,Y=U.length();0<Y&&(P[0]=O[0]*Y,P[1]=O[1]*Y,P[2]=O[2]*Y,P[3]=O[3]*Y)},U.add=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]+c[0],P[1]=Y[1]+c[1],P[2]=Y[2]+c[2],P[3]=Y[3]+c[3]},U.subtract=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]-c[0],P[1]=Y[1]-c[1],P[2]=Y[2]-c[2],P[3]=Y[3]-c[3]},U.multiply=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Y[0]*c[0],P[1]=Y[1]*c[1],P[2]=Y[2]*c[2],P[3]=Y[3]*c[3]},U.scale=function(U,F,O){var P=O.elements,Y=U.elements;P[0]=Y[0]*F,P[1]=Y[1]*F,P[2]=Y[2]*F,P[3]=Y[3]*F},U.Clamp=function(U,F,O,P){var Y=U.elements,c=Y[0],L=Y[1],u=Y[2],d=Y[3],a=F.elements,b=a[0],z=a[1],J=a[2],w=a[3],j=O.elements,x=j[0],r=j[1],H=j[2],h=j[3],Q=P.elements;c=(c=x<c?x:c)<b?b:c,L=(L=r<L?r:L)<z?z:L,u=(u=H<u?H:u)<J?J:u,d=(d=h<d?h:d)<w?w:d,Q[0]=c,Q[1]=L,Q[2]=u,Q[3]=d},U.distanceSquared=function(U,F){var O=U.elements,P=F.elements,Y=O[0]-P[0],c=O[1]-P[1],L=O[2]-P[2],u=O[3]-P[3];return Y*Y+c*c+L*L+u*u},U.distance=function(U,F){var O=U.elements,P=F.elements,Y=O[0]-P[0],c=O[1]-P[1],L=O[2]-P[2],u=O[3]-P[3];return Math.sqrt(Y*Y+c*c+L*L+u*u)},U.dot=function(U,F){var O=U.elements,P=F.elements;return O[0]*P[0]+O[1]*P[1]+O[2]*P[2]+O[3]*P[3]},U.min=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Math.min(Y[0],c[0]),P[1]=Math.min(Y[1],c[1]),P[2]=Math.min(Y[2],c[2]),P[3]=Math.min(Y[3],c[3])},U.max=function(U,F,O){var P=O.elements,Y=U.elements,c=F.elements;P[0]=Math.max(Y[0],c[0]),P[1]=Math.max(Y[1],c[1]),P[2]=Math.max(Y[2],c[2]),P[3]=Math.max(Y[3],c[3])},z(U,["ZERO",function(){return this.ZERO=new U},"ONE",function(){return this.ONE=new U(1,1,1,1)},"UnitX",function(){return this.UnitX=new U(1,0,0,0)},"UnitY",function(){return this.UnitY=new U(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new U(0,0,1,0)},"UnitW",function(){return this.UnitW=new U(0,0,0,1)}]),U}(),dF=function(){function c(U,F,O,P){this.minDepth=0,this.maxDepth=1,this.x=U,this.y=F,this.width=O,this.height=P}w(c,"laya.d3.math.Viewport");var U=c.prototype;return U.project=function(U,F,O){LF.transformV3ToV3(U,F,O);var P=U.elements,Y=F.elements,c=O.elements,L=P[0]*Y[3]+P[1]*Y[7]+P[2]*Y[11]+Y[15];1!==L&&(c[0]=c[0]/L,c[1]=c[1]/L,c[2]=c[2]/L),c[0]=.5*(c[0]+1)*this.width+this.x,c[1]=.5*(1-c[1])*this.height+this.y,c[2]=c[2]*(this.maxDepth-this.minDepth)+this.minDepth},U.unprojectFromMat=function(U,F,O){var P=U.elements,Y=F.elements,c=O.elements;c[0]=(P[0]-this.x)/this.width*2-1,c[1]=-((P[1]-this.y)/this.height*2-1);var L=(this.maxDepth-this.minDepth)/2;c[2]=(P[2]-this.minDepth-L)/L;var u=c[0]*Y[3]+c[1]*Y[7]+c[2]*Y[11]+Y[15];LF.transformV3ToV3(O,F,O),1!==u&&(c[0]=c[0]/u,c[1]=c[1]/u,c[2]=c[2]/u)},U.unprojectFromWVP=function(U,F,O,P,Y){UF.multiply(F,O,c._tempMatrix4x4),P&&UF.multiply(c._tempMatrix4x4,P,c._tempMatrix4x4),c._tempMatrix4x4.invert(c._tempMatrix4x4),this.unprojectFromMat(U,c._tempMatrix4x4,Y)},z(c,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new UF}]),c}(),aF=function(){function $(U){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=U,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}w($,"laya.d3.resource.models.SubMesh");var U=$.prototype;return N.imps(U,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),U._getVertexBuffer=function(U){return void 0===U&&(U=0),0===U?this._vertexBuffer:null},U._getIndexBuffer=function(){return this._indexBuffer},U._getStaticBatchBakedVertexs=function(U,F){var O,P,Y=this._vertexBuffer,c=Y.vertexDeclaration,L=c.getVertexElementByUsage(0).offset/4,u=c.getVertexElementByUsage(3).offset/4,d=F.meshRender.lightmapScaleOffset,a=0,b=0,z=0,J=0,w=0,j=0;if(d)if(P=c.getVertexElementByUsage(15))z=c.vertexStride/4,O=0<this._vertexCount?Y.getData().slice(this._vertexStart*z,(this._vertexStart+this._vertexCount)*z):Y.getData().slice(),J=P.offset/4;else{z=(j=c.vertexStride/4)+2,O=this._vertexCount?new Float32Array(this._vertexCount*(Y.vertexDeclaration.vertexStride/4+2)):new Float32Array(Y.vertexCount*(Y.vertexDeclaration.vertexStride/4+2)),J=(w=c.getVertexElementByUsage(2).offset/4)+2;var x=Y.getData();for(a=0,b=x.length/j;a<b;a++){var r=0;r=0<this._vertexCount?(this._vertexStart+a)*j:a*j;var H=a*z,h=0;for(h=0;h<J;h++)O[H+h]=x[r+h];for(h=J;h<j;h++)O[H+h+2]=x[r+h]}}else z=c.vertexStride/4,O=this._vertexCount?Y.getData().slice(this._vertexStart*z,(this._vertexStart+this._vertexCount)*z):Y.getData().slice();if(U){var Q=U.worldMatrix,X=$._tempMatrix4x40;Q.invert(X);var N=$._tempMatrix4x41,K=F.transform.worldMatrix;UF.multiply(X,K,N)}else N=F.transform.worldMatrix;var f=$._tempQuaternion0;for(N.decomposeTransRotScale($._tempVector30,f,$._tempVector31),a=0,b=O.length/z;a<b;a++){var I=a*z+L,T=a*z+u;if(rF.transformVector3ArrayToVector3ArrayCoordinate(O,I,N,O,I),rF.transformVector3ArrayByQuat(O,T,f,O,T),d){var g=a*z+J;if(P)rF.transformLightingMapTexcoordByUV1Array(O,g,d,O,g);else{var l=a*j+w;rF.transformLightingMapTexcoordByUV0Array(x,l,d,O,g)}}}return O},U._getVertexBuffers=function(){return null},U._beforeRender=function(U){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},U._render=function(U){var F,O=0,P=U.renderElement;if(1<this._indexCount){var Y=this._boneIndicesList.length;if(1<Y){for(var c=0;c<Y;c++)(F=P._skinAnimationDatas||this._skinAnimationDatas)&&(P._shaderValue.setValue(0,F[c]),U._shader.uploadRenderElementUniforms(P._shaderValue.data)),C.mainContext.drawElements(4,this._subIndexBufferCount[c],5123,2*this._subIndexBufferStart[c]);I.drawCall+=Y}else(F=P._skinAnimationDatas||this._skinAnimationDatas)&&(P._shaderValue.setValue(0,F[0]),U._shader.uploadRenderElementUniforms(P._shaderValue.data)),C.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),I.drawCall++;O=this._indexCount}else O=this._indexBuffer.indexCount,(F=P._skinAnimationDatas||this._skinAnimationDatas)&&(P._shaderValue.setValue(0,F[0]),U._shader.uploadRenderElementUniforms(P._shaderValue.data)),C.mainContext.drawElements(4,O,5123,0),I.drawCall++;I.trianglesFaces+=O/3},U.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},U.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},j(0,U,"_vertexBufferCount",function(){return 1}),j(0,U,"triangleCount",function(){return this._indexBuffer.indexCount/3}),z($,["_tempVector30",function(){return this._tempVector30=new LF},"_tempVector31",function(){return this._tempVector31=new LF},"_tempQuaternion0",function(){return this._tempQuaternion0=new OF},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new UF},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new UF}]),$}(),bF=function(){function U(U){this.defineCounter=0,this.defines=null,U?(this.defineCounter=U.defineCounter,this.defines=U.defines.slice()):(this.defineCounter=0,this.defines=[])}return w(U,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),U.prototype.registerDefine=function(U){var F=Math.pow(2,this.defineCounter++);return this.defines[F]=U,F},U}(),zF=function(){function U(){}return w(U,"laya.d3.shader.ShaderInit3D"),U.__init__=function(){var U,F;IF._globalRegDefine("HIGHPRECISION",IF.SHADERDEFINE_HIGHPRECISION),IF._globalRegDefine("FOG",IF.SHADERDEFINE_FOG),IF._globalRegDefine("DIRECTIONLIGHT",IF.SHADERDEFINE_DIRECTIONLIGHT),IF._globalRegDefine("POINTLIGHT",IF.SHADERDEFINE_POINTLIGHT),IF._globalRegDefine("SPOTLIGHT",IF.SHADERDEFINE_SPOTLIGHT),IF._globalRegDefine("UV",IF.SHADERDEFINE_UV0),IF._globalRegDefine("COLOR",IF.SHADERDEFINE_COLOR),IF._globalRegDefine("UV1",IF.SHADERDEFINE_UV1),IF._globalRegDefine("CASTSHADOW",wF.SHADERDEFINE_CAST_SHADOW),IF._globalRegDefine("SHADOWMAP_PSSM1",wF.SHADERDEFINE_SHADOW_PSSM1),IF._globalRegDefine("SHADOWMAP_PSSM2",wF.SHADERDEFINE_SHADOW_PSSM2),IF._globalRegDefine("SHADOWMAP_PSSM3",wF.SHADERDEFINE_SHADOW_PSSM3),IF._globalRegDefine("SHADOWMAP_PCF_NO",wF.SHADERDEFINE_SHADOW_PCF_NO),IF._globalRegDefine("SHADOWMAP_PCF1",wF.SHADERDEFINE_SHADOW_PCF1),IF._globalRegDefine("SHADOWMAP_PCF2",wF.SHADERDEFINE_SHADOW_PCF2),IF._globalRegDefine("SHADOWMAP_PCF3",wF.SHADERDEFINE_SHADOW_PCF3),IF._globalRegDefine("DEPTHFOG",IF.SAHDERDEFINE_DEPTHFOG),GF.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),GF.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),U={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},F={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var O=GF.nameKey.add("SIMPLE");shaderCompile=IF.add(O,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',U,F),VF.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),VF.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),VF.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),VF.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),VF.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),VF.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),VF.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),VF.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),VF.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},U}(),JF=function(){function U(){this._data=null,this._data=[]}w(U,"laya.d3.shader.ValusArray");var F=U.prototype;return F.setValue=function(U,F){this._data[U]=F},j(0,F,"data",function(){return this._data}),U}(),wF=function(){function U(){}return U.SHADERDEFINE_RECEIVE_SHADOW=1,U.SHADERDEFINE_CAST_SHADOW=512,U.SHADERDEFINE_SHADOW_PSSM1=1024,U.SHADERDEFINE_SHADOW_PSSM2=2048,U.SHADERDEFINE_SHADOW_PSSM3=4096,U.SHADERDEFINE_SHADOW_PCF_NO=8192,U.SHADERDEFINE_SHADOW_PCF1=16384,U.SHADERDEFINE_SHADOW_PCF2=32768,U.SHADERDEFINE_SHADOW_PCF3=65536,U.MAX_PSSM_COUNT=3,U}(),jF=function(){function v(){}return w(v,"laya.d3.utils.Picker"),v.calculateCursorRay=function(U,F,O,P,Y,c){var L=U.elements[0],u=U.elements[1],d=v._tempVector30,a=d.elements;a[0]=L,a[1]=u,a[2]=F.minDepth;var b=v._tempVector31,z=b.elements;z[0]=L,z[1]=u,z[2]=F.maxDepth;var J=c.origin,w=v._tempVector32;F.unprojectFromWVP(d,O,P,Y,J),F.unprojectFromWVP(b,O,P,Y,w);var j=c.direction.elements;j[0]=w.x-J.x,j[1]=w.y-J.y,j[2]=w.z-J.z,LF.normalize(c.direction,c.direction)},v.rayIntersectsPositionsAndIndices=function(U,F,O,P,Y){for(var c=O.vertexStride/4,L=O.getVertexElementByUsage(0).offset/4,u=Number.MAX_VALUE,d=-1,a=-1,b=-1,z=0;z<P.length;z+=3){var J=v._tempVector35,w=J.elements,j=P[z]*c,x=j+L;w[0]=F[x],w[1]=F[1+x],w[2]=F[2+x];var r=v._tempVector36,H=r.elements,h=P[z+1]*c,Q=h+L;H[0]=F[Q],H[1]=F[1+Q],H[2]=F[2+Q];var X=v._tempVector37,N=X.elements,K=P[z+2]*c,f=K+L;N[0]=F[f],N[1]=F[1+f],N[2]=F[2+f];var I=laya.d3.utils.Picker.rayIntersectsTriangle(U,J,r,X);!isNaN(I)&&I<u&&(u=I,d=j,a=h,b=K)}if(u===Number.MAX_VALUE)return Y.position.toDefault(),Y.distance=Number.MAX_VALUE,Y.trianglePositions[0].toDefault(),Y.trianglePositions[1].toDefault(),Y.trianglePositions[2].toDefault(),Y.triangleNormals[0].toDefault(),Y.triangleNormals[1].toDefault(),Y.triangleNormals[2].toDefault(),!1;Y.distance=u,LF.scale(U.direction,u,Y.position),LF.add(U.origin,Y.position,Y.position);var T=Y.trianglePositions,g=T[0],l=T[1],$=T[2],C=g.elements,s=l.elements,i=$.elements,y=d+L;C[0]=F[y],C[1]=F[y+1],C[2]=F[y+2];var k=a+L;s[0]=F[k],s[1]=F[k+1],s[2]=F[k+2];var A=b+L;i[0]=F[A],i[1]=F[A+1],i[2]=F[A+2];var G=O.getVertexElementByUsage(3);if(G){var V=G.offset/4,M=Y.triangleNormals,m=M[0],p=M[1],o=M[2],R=m.elements,_=p.elements,q=o.elements,D=d+V;R[0]=F[D],R[1]=F[D+1],R[2]=F[D+2];var Z=a+V;_[0]=F[Z],_[1]=F[Z+1],_[2]=F[Z+2];var e=b+V;q[0]=F[e],q[1]=F[e+1],q[2]=F[e+2]}return!0},v.rayIntersectsTriangle=function(U,F,O,P){var Y=v._tempVector30,c=v._tempVector31;LF.subtract(O,F,Y),LF.subtract(P,F,c);var L,u=v._tempVector32;if(LF.cross(U.direction,c,u),(L=LF.dot(Y,u))>-Number.MIN_VALUE&&L<Number.MIN_VALUE)return Number.NaN;var d,a=1/L,b=v._tempVector33;if(LF.subtract(U.origin,F,b),d=LF.dot(b,u),(d*=a)<0||1<d)return Number.NaN;var z,J,w=v._tempVector34;return LF.cross(b,Y,w),z=LF.dot(U.direction,w),(z*=a)<0||1<d+z?Number.NaN:(J=LF.dot(c,w),(J*=a)<0?Number.NaN:J)},z(v,["_tempVector30",function(){return this._tempVector30=new LF},"_tempVector31",function(){return this._tempVector31=new LF},"_tempVector32",function(){return this._tempVector32=new LF},"_tempVector33",function(){return this._tempVector33=new LF},"_tempVector34",function(){return this._tempVector34=new LF},"_tempVector35",function(){return this._tempVector35=new LF},"_tempVector36",function(){return this._tempVector36=new LF},"_tempVector37",function(){return this._tempVector37=new LF}]),v}(),xF=(function(){function U(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new LF,new LF,new LF],this.trianglePositions.length=3,this.triangleNormals=[new LF,new LF,new LF],this.triangleNormals.length=3,this.position=new LF}w(U,"laya.d3.utils.RaycastHit"),U.prototype.cloneTo=function(U){U.distance=this.distance,this.trianglePositions[0].cloneTo(U.trianglePositions[0]),this.trianglePositions[1].cloneTo(U.trianglePositions[1]),this.trianglePositions[2].cloneTo(U.trianglePositions[2]),this.triangleNormals[0].cloneTo(U.triangleNormals[0]),this.triangleNormals[1].cloneTo(U.triangleNormals[1]),this.triangleNormals[2].cloneTo(U.triangleNormals[2]),this.position.cloneTo(U.position),U.sprite3D=this.sprite3D}}(),function(){function U(U,F){this._width=0,this._height=0,this._width=U,this._height=F}w(U,"laya.d3.utils.Size");var F=U.prototype;return j(0,F,"width",function(){return-1===this._width?n.clientWidth:this._width}),j(0,F,"height",function(){return-1===this._height?n.clientHeight:this._height}),j(1,U,"fullScreen",function(){return new U(-1,-1)}),U}()),rF=function(){function y(){}return w(y,"laya.d3.utils.Utils3D"),y._rotationTransformScaleSkinAnimation=function(U,F,O,P,Y,c,L,u,d,a,b,z){var J,w,j,x,r,H=y._tempArray16_0,h=y._tempArray16_1,Q=y._tempArray16_2,X=P+P,N=Y+Y,K=c+c,f=P*X,I=Y*X,T=Y*N,g=c*X,l=c*N,$=c*K,C=L*X,s=L*N,i=L*K;for(H[15]=1,H[0]=1-T-$,H[1]=I+i,H[2]=g-s,H[4]=I-i,H[5]=1-f-$,H[6]=l+C,H[8]=g+s,H[9]=l-C,H[10]=1-f-T,h[15]=1,h[0]=u,h[5]=d,h[10]=a,J=0;J<4;J++)w=H[J],j=H[J+4],x=H[J+8],r=H[J+12],Q[J]=w,Q[J+4]=j,Q[J+8]=x,Q[J+12]=w*U+j*F+x*O+r;for(J=0;J<4;J++)w=Q[J],j=Q[J+4],x=Q[J+8],r=Q[J+12],b[J+z]=w*h[0]+j*h[1]+x*h[2]+r*h[3],b[J+z+4]=w*h[4]+j*h[5]+x*h[6]+r*h[7],b[J+z+8]=w*h[8]+j*h[9]+x*h[10]+r*h[11],b[J+z+12]=w*h[12]+j*h[13]+x*h[14]+r*h[15]},y._createNodeByJson=function(U,F,O,P){if(!O)switch(F.type){case"Sprite3D":O=new AF;break;case"MeshSprite3D":O=new vF;break;case"SkinnedMeshSprite3D":O=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":O=new ShuriKenParticle3D;break;case"TrailSprite3D":O=new TrailSprite3D;break;case"Terrain":O=new Terrain;break;case"Camera":O=new eF;break;case"DirectionLight":O=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var Y=F.props;if(Y)for(var c in Y)O[c]=Y[c];var L=F.customProps;L&&(O instanceof laya.d3.core.Sprite3D?(O._parseBaseCustomProps(L),O._parseCustomProps(U,P,L,F),O._parseCustomComponent(U,P,F.components)):O._parseCustomProps(U,P,L,F));var u=F.child;if(u)for(var d=0,a=u.length;d<a;d++){var b=y._createNodeByJson(U,u[d],null,P);O.addChild(b)}return O},y._computeBoneAndAnimationDatasByBindPoseMatrxix=function(U,F,O,P,Y,c){var L,u,d=0,a=0,b=U.length;for(L=0;L<b;d+=U[L].keyframeWidth,a+=16,L++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(F[d+0],F[d+1],F[d+2],F[d+3],F[d+4],F[d+5],F[d+6],F[d+7],F[d+8],F[d+9],P,a),0!=L&&(u=16*U[L].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(P,u,P,a,P,a));var z=O.length;for(L=0;L<z;L++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(P,16*c[L],O[L],Y,16*L)},y._computeAnimationDatasByArrayAndMatrixFast=function(U,F,O,P){for(var Y=0,c=U.length;Y<c;Y++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(F,16*P[Y],U[Y],O,16*Y)},y._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(U,F,O,P,Y){var c,L,u=0,d=0,a=U.length;for(c=0;c<a;u+=U[c].keyframeWidth,d+=16,c++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(F[u+7],F[u+8],F[u+9],F[u+3],F[u+4],F[u+5],F[u+6],F[u+0],F[u+1],F[u+2],P,d),0!=c&&(L=16*U[c].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(P,L,P,d,P,d));var b=O.length;for(c=0;c<b;c++){var z=16*c;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(P,z,O[c],Y,z)}},y._computeAnimationDatasByArrayAndMatrixFastOld=function(U,F,O){for(var P=U.length,Y=0;Y<P;Y++){var c=16*Y;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(F,c,U[Y],O,c)}},y._computeRootAnimationData=function(U,F,O){for(var P=0,Y=0,c=0,L=U.length;P<L;Y+=U[P].keyframeWidth,c+=16,P++)laya.d3.utils.Utils3D.createAffineTransformationArray(F[Y+0],F[Y+1],F[Y+2],F[Y+3],F[Y+4],F[Y+5],F[Y+6],F[Y+7],F[Y+8],F[Y+9],O,c)},y.transformVector3ArrayByQuat=function(U,F,O,P,Y){var c=O.elements,L=U[F],u=U[F+1],d=U[F+2],a=c[0],b=c[1],z=c[2],J=c[3],w=J*L+b*d-z*u,j=J*u+z*L-a*d,x=J*d+a*u-b*L,r=-a*L-b*u-z*d;P[Y]=w*J+r*-a+j*-z-x*-b,P[Y+1]=j*J+r*-b+x*-a-w*-z,P[Y+2]=x*J+r*-z+w*-b-j*-a},y.mulMatrixByArray=function(U,F,O,P,Y,c){var L,u,d,a,b;if(Y===O){for(O=y._tempArray16_3,L=0;L<16;++L)O[L]=Y[c+L];P=0}for(L=0;L<4;L++)u=U[F+L],d=U[F+L+4],a=U[F+L+8],b=U[F+L+12],Y[c+L]=u*O[P+0]+d*O[P+1]+a*O[P+2]+b*O[P+3],Y[c+L+4]=u*O[P+4]+d*O[P+5]+a*O[P+6]+b*O[P+7],Y[c+L+8]=u*O[P+8]+d*O[P+9]+a*O[P+10]+b*O[P+11],Y[c+L+12]=u*O[P+12]+d*O[P+13]+a*O[P+14]+b*O[P+15]},y.mulMatrixByArrayFast=function(U,F,O,P,Y,c){var L,u,d,a,b;for(L=0;L<4;L++)u=U[F+L],d=U[F+L+4],a=U[F+L+8],b=U[F+L+12],Y[c+L]=u*O[P+0]+d*O[P+1]+a*O[P+2]+b*O[P+3],Y[c+L+4]=u*O[P+4]+d*O[P+5]+a*O[P+6]+b*O[P+7],Y[c+L+8]=u*O[P+8]+d*O[P+9]+a*O[P+10]+b*O[P+11],Y[c+L+12]=u*O[P+12]+d*O[P+13]+a*O[P+14]+b*O[P+15]},y.mulMatrixByArrayAndMatrixFast=function(U,F,O,P,Y){var c,L,u,d,a,b=O.elements,z=b[0],J=b[1],w=b[2],j=b[3],x=b[4],r=b[5],H=b[6],h=b[7],Q=b[8],X=b[9],N=b[10],K=b[11],f=b[12],I=b[13],T=b[14],g=b[15],l=F,$=F+4,C=F+8,s=F+12,i=Y,y=Y+4,k=Y+8,A=Y+12;for(c=0;c<4;c++)L=U[l+c],u=U[$+c],d=U[C+c],a=U[s+c],P[i+c]=L*z+u*J+d*w+a*j,P[y+c]=L*x+u*r+d*H+a*h,P[k+c]=L*Q+u*X+d*N+a*K,P[A+c]=L*f+u*I+d*T+a*g},y.createAffineTransformationArray=function(U,F,O,P,Y,c,L,u,d,a,b,z){var J=P+P,w=Y+Y,j=c+c,x=P*J,r=P*w,H=P*j,h=Y*w,Q=Y*j,X=c*j,N=L*J,K=L*w,f=L*j;b[z+0]=(1-(h+X))*u,b[z+1]=(r+f)*u,b[z+2]=(H-K)*u,b[z+3]=0,b[z+4]=(r-f)*d,b[z+5]=(1-(x+X))*d,b[z+6]=(Q+N)*d,b[z+7]=0,b[z+8]=(H+K)*a,b[z+9]=(Q-N)*a,b[z+10]=(1-(x+h))*a,b[z+11]=0,b[z+12]=U,b[z+13]=F,b[z+14]=O,b[z+15]=1},y.transformVector3ArrayToVector3ArrayCoordinate=function(U,F,O,P,Y){var c=y._tempArray4_0,L=U[F+0],u=U[F+1],d=U[F+2],a=O.elements;c[0]=L*a[0]+u*a[4]+d*a[8]+a[12],c[1]=L*a[1]+u*a[5]+d*a[9]+a[13],c[2]=L*a[2]+u*a[6]+d*a[10]+a[14],c[3]=1/(L*a[3]+u*a[7]+d*a[11]+a[15]),P[Y+0]=c[0]*c[3],P[Y+1]=c[1]*c[3],P[Y+2]=c[2]*c[3]},y.transformLightingMapTexcoordByUV0Array=function(U,F,O,P,Y){var c=O.elements;P[Y+0]=U[F+0]*c[0]+c[2],P[Y+1]=(U[F+1]-1)*c[1]+c[3]},y.transformLightingMapTexcoordByUV1Array=function(U,F,O,P,Y){var c=O.elements;P[Y+0]=U[F+0]*c[0]+c[2],P[Y+1]=1+U[F+1]*c[1]+c[3]},y.getURLVerion=function(U){var F=U.indexOf("?");return 0<=F?U.substr(F):null},y._quaternionCreateFromYawPitchRollArray=function(U,F,O,P){var Y=.5*O,c=.5*F,L=.5*U,u=Math.sin(Y),d=Math.cos(Y),a=Math.sin(c),b=Math.cos(c),z=Math.sin(L),J=Math.cos(L);P[0]=J*a*d+z*b*u,P[1]=z*b*d-J*a*u,P[2]=J*b*u-z*a*d,P[3]=J*b*d+z*a*u},y._createAffineTransformationArray=function(U,F,O,P){var Y=F[0],c=F[1],L=F[2],u=F[3],d=Y+Y,a=c+c,b=L+L,z=Y*d,J=Y*a,w=Y*b,j=c*a,x=c*b,r=L*b,H=u*d,h=u*a,Q=u*b,X=O[0],N=O[1],K=O[2];P[0]=(1-(j+r))*X,P[1]=(J+Q)*X,P[2]=(w-h)*X,P[3]=0,P[4]=(J-Q)*N,P[5]=(1-(z+r))*N,P[6]=(x+H)*N,P[7]=0,P[8]=(w+h)*K,P[9]=(x-H)*K,P[10]=(1-(z+j))*K,P[11]=0,P[12]=U[0],P[13]=U[1],P[14]=U[2],P[15]=1},y._mulMatrixArray=function(U,F,O,P){var Y,c,L,u,d,a=F.elements,b=a[0],z=a[1],J=a[2],w=a[3],j=a[4],x=a[5],r=a[6],H=a[7],h=a[8],Q=a[9],X=a[10],N=a[11],K=a[12],f=a[13],I=a[14],T=a[15],g=P,l=P+4,$=P+8,C=P+12;for(Y=0;Y<4;Y++)c=U[Y],L=U[Y+4],u=U[Y+8],d=U[Y+12],O[g+Y]=c*b+L*z+u*J+d*w,O[l+Y]=c*j+L*x+u*r+d*H,O[$+Y]=c*h+L*Q+u*X+d*N,O[C+Y]=c*K+L*f+u*I+d*T},y.getYawPitchRoll=function(U,F){y.transformQuat(LF.ForwardRH,U,OF.TEMPVector31),y.transformQuat(LF.Up,U,OF.TEMPVector32);var O=OF.TEMPVector32.elements;y.angleTo(LF.ZERO,OF.TEMPVector31,OF.TEMPVector33);var P=OF.TEMPVector33.elements;P[0]==Math.PI/2?(P[1]=y.arcTanAngle(O[2],O[0]),P[2]=0):P[0]==-Math.PI/2?(P[1]=y.arcTanAngle(-O[2],-O[0]),P[2]=0):(UF.createRotationY(-P[1],OF.TEMPMatrix0),UF.createRotationX(-P[0],OF.TEMPMatrix1),LF.transformCoordinate(OF.TEMPVector32,OF.TEMPMatrix0,OF.TEMPVector32),LF.transformCoordinate(OF.TEMPVector32,OF.TEMPMatrix1,OF.TEMPVector32),P[2]=y.arcTanAngle(O[1],-O[0])),P[1]<=-Math.PI&&(P[1]=Math.PI),P[2]<=-Math.PI&&(P[2]=Math.PI),P[1]>=Math.PI&&P[2]>=Math.PI&&(P[1]=0,P[2]=0,P[0]=Math.PI-P[0]),F[0]=P[1],F[1]=P[0],F[2]=P[2]},y.arcTanAngle=function(U,F){return 0==U?1==F?Math.PI/2:-Math.PI/2:0<U?Math.atan(F/U):U<0?0<F?Math.atan(F/U)+Math.PI:Math.atan(F/U)-Math.PI:0},y.angleTo=function(U,F,O){LF.subtract(F,U,OF.TEMPVector30),LF.normalize(OF.TEMPVector30,OF.TEMPVector30),O.elements[0]=Math.asin(OF.TEMPVector30.y),O.elements[1]=y.arcTanAngle(-OF.TEMPVector30.z,-OF.TEMPVector30.x)},y.transformQuat=function(U,F,O){var P=O.elements,Y=U.elements,c=F,L=Y[0],u=Y[1],d=Y[2],a=c[0],b=c[1],z=c[2],J=c[3],w=J*L+b*d-z*u,j=J*u+z*L-a*d,x=J*d+a*u-b*L,r=-a*L-b*u-z*d;P[0]=w*J+r*-a+j*-z-x*-b,P[1]=j*J+r*-b+x*-a-w*-z,P[2]=x*J+r*-z+w*-b-j*-a},y.quaterionNormalize=function(U,F){var O=U[0],P=U[1],Y=U[2],c=U[3],L=O*O+P*P+Y*Y+c*c;0<L&&(L=1/Math.sqrt(L),F[0]=O*L,F[1]=P*L,F[2]=Y*L,F[3]=c*L)},y.matrix4x4MultiplyFFF=function(U,F,O){var P,Y,c,L,u;if(O===F)for(F=new Float32Array(16),P=0;P<16;++P)F[P]=O[P];for(P=0;P<4;P++)Y=U[P],c=U[P+4],L=U[P+8],u=U[P+12],O[P]=Y*F[0]+c*F[1]+L*F[2]+u*F[3],O[P+4]=Y*F[4]+c*F[5]+L*F[6]+u*F[7],O[P+8]=Y*F[8]+c*F[9]+L*F[10]+u*F[11],O[P+12]=Y*F[12]+c*F[13]+L*F[14]+u*F[15]},y.matrix4x4MultiplyMFM=function(U,F,O){y.matrix4x4MultiplyFFF(U.elements,F,O.elements)},z(y,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new LF},"_tempVector3_1",function(){return this._tempVector3_1=new LF},"_tempVector3_2",function(){return this._tempVector3_2=new LF},"_tempVector3_3",function(){return this._tempVector3_3=new LF},"_tempVector3_4",function(){return this._tempVector3_4=new LF},"_tempVector3_5",function(){return this._tempVector3_5=new LF},"_tempVector3_6",function(){return this._tempVector3_6=new LF},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),y}(),HF=function(){function s(){}return w(s,"Laya3D"),s._cancelLoadByUrl=function(U){N.loader.cancelLoadByUrl(U),s._innerFirstLevelLoaderManager.cancelLoadByUrl(U),s._innerSecondLevelLoaderManager.cancelLoadByUrl(U),s._innerThirdLevelLoaderManager.cancelLoadByUrl(U),s._innerFourthLevelLoaderManager.cancelLoadByUrl(U)},s._changeWebGLSize=function(U,F){C.onStageResize(U,F),n.clientWidth=U,n.clientHeight=F},s.__init__=function(){var U=F.createMap;U.lh=[AF,"SPRITE3DHIERARCHY"],U.ls=[kF,"SPRITE3DHIERARCHY"],U.lm=[RF,"MESH"],U.lmat=[VF,"MATERIAL"],U.jpg=[qF,"nativeimage"],U.jpeg=[qF,"nativeimage"],U.png=[qF,"nativeimage"],U.pkm=[qF,"arraybuffer"],U.raw=[pF,"arraybuffer"],U.mipmaps=[pF,"arraybuffer"],H.parserMap.SPRITE3DHIERARCHY=s._loadHierarchy,H.parserMap.MESH=s._loadMesh,H.parserMap.MATERIAL=s._loadMaterial,H.parserMap.TEXTURECUBE=s._loadTextureCube,H.parserMap.TERRAIN=s._loadTerrain,s._innerFirstLevelLoaderManager.on("error",null,s._eventLoadManagerError),s._innerSecondLevelLoaderManager.on("error",null,s._eventLoadManagerError),s._innerThirdLevelLoaderManager.on("error",null,s._eventLoadManagerError),s._innerFourthLevelLoaderManager.on("error",null,s._eventLoadManagerError)},s.READ_BLOCK=function(){return s._readData.pos+=4,!0},s.READ_DATA=function(){return s._DATA.offset=s._readData.getUint32(),s._DATA.size=s._readData.getUint32(),!0},s.READ_STRINGS=function(){var U=[],F={offset:0,size:0};F.offset=s._readData.getUint16(),F.size=s._readData.getUint16();s._readData.pos;s._readData.pos=F.offset+s._DATA.offset;for(var O=0;O<F.size;O++){var P=s._readData.readUTFString();-1===P.lastIndexOf(".lmat")&&-1===P.lastIndexOf(".lpbr")||U.push(P)}return U},s.formatRelativePath=function(U,F){var O;if("."===F.charAt(0)){for(var P=(U+F).split("/"),Y=0,c=P.length;Y<c;Y++)if(".."==P[Y]){var L=Y-1;0<L&&".."!==P[L]&&(P.splice(L,2),Y-=2)}O=P.join("/")}else O=U+F;return null!=$.customFormat&&(O=$.customFormat(O,null)),O},s._eventLoadManagerError=function(U){N.loader.event("error",U)},s._addHierarchyInnerUrls=function(U,F,O,P,Y,c){var L=s.formatRelativePath(P,Y);O&&(L+=O),U.push({url:L,clas:c}),F[Y]=L},s._getSprite3DHierarchyInnerUrls=function(U,F,O,P,Y,c,L){var u,d=0,a=0;switch(U.type){case"Scene":var b=U.customProps.lightmaps;for(d=0,a=b.length;d<a;d++){var z=b[d].replace(".exr",".png");s._addHierarchyInnerUrls(P,Y,c,L,z,qF)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var J;if(U.instanceParams)(J=U.instanceParams.loadPath)&&s._addHierarchyInnerUrls(F,Y,c,L,J,RF);else{(J=(u=U.customProps).meshPath)&&s._addHierarchyInnerUrls(F,Y,c,L,J,RF);var w=u.materials;if(w)for(d=0,a=w.length;d<a;d++){for(var j=w[d],x=j.type.split("."),r=i.window,H=0,h=x.length;H<h;++H){r=r[this.clasPaths[H]]}if("function"!=typeof r)throw"_getSprite3DHierarchyInnerUrls 错误: "+j.type+" 不是类";s._addHierarchyInnerUrls(O,Y,c,L,j.path,r)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var Q=(u=U.customProps).meshPath;Q&&s._addHierarchyInnerUrls(F,Y,c,L,Q,RF);var X=u.material;if(X){x=X.type.split("."),r=i.window;for(H=0,h=x.length;H<h;++H){r=r[this.clasPaths[H]]}s._addHierarchyInnerUrls(O,Y,c,L,X.path,r)}else{var N=u.materialPath;if(N)s._addHierarchyInnerUrls(O,Y,c,L,N,ShurikenParticleMaterial);else{var K=u.texturePath;K&&s._addHierarchyInnerUrls(P,Y,c,L,K,qF)}}break;case"Terrain":s._addHierarchyInnerUrls(P,Y,c,L,U.customProps.dataPath,TerrainRes)}var f=U.components;for(var I in f){var T=f[I];switch(I){case"Animator":var g=T.avatarPath;if(g)s._addHierarchyInnerUrls(P,Y,c,L,g,Avatar);else{var l=T.avatar;l&&s._addHierarchyInnerUrls(P,Y,c,L,l.path,Avatar)}var $=T.clipPaths;for(d=0,a=$.length;d<a;d++)s._addHierarchyInnerUrls(P,Y,c,L,$[d],AnimationClip)}}var C=U.child;for(d=0,a=C.length;d<a;d++)s._getSprite3DHierarchyInnerUrls(C[d],F,O,P,Y,c,L)},s._loadHierarchy=function(U){U.on("loaded",null,s._onHierarchylhLoaded,[U,U._class._getGroup()]),U.load(U.url,"json",!1,null,!0)},s._onHierarchylhLoaded=function(U,F,O){if(U._class.destroyed)U.endLoad();else{var P=U.url,Y=rF.getURLVerion(P),c=$.getPath(P),L=[],u=[],d=[],a={};s._getSprite3DHierarchyInnerUrls(O,L,u,d,a,Y,c);var b=L.length+u.length+d.length,z=b+1,J=1/z;if(s._onProcessChange(U,0,J,1),0<d.length){var w=b/z,j=l.create(null,s._onProcessChange,[U,J,w],!1);s._innerFourthLevelLoaderManager.create(d,l.create(null,s._onHierarchyInnerForthLevResouLoaded,[U,F,j,O,a,L,u,J+w*d.length,w]),j,null,null,1,!0,F)}else s._onHierarchyInnerForthLevResouLoaded(U,F,null,O,a,L,u,J,w)}},s._onHierarchyInnerForthLevResouLoaded=function(U,F,O,P,Y,c,L,u,d){if(U._class.destroyed)U.endLoad();else if(O&&O.recover(),0<L.length){var a=l.create(null,s._onProcessChange,[U,u,d],!1);s._innerSecondLevelLoaderManager.create(L,l.create(null,s._onHierarchyInnerSecondLevResouLoaded,[U,F,a,P,Y,c,u+d*L.length,d]),O,null,null,1,!0,F)}else s._onHierarchyInnerSecondLevResouLoaded(U,F,null,P,Y,c,u,d)},s._onHierarchyInnerSecondLevResouLoaded=function(U,F,O,P,Y,c,L,u){if(U._class.destroyed)U.endLoad();else if(O&&O.recover(),0<c.length){var d=l.create(null,s._onProcessChange,[U,L,u],!1);s._innerFirstLevelLoaderManager.create(c,l.create(null,s._onHierarchyInnerFirstLevResouLoaded,[U,d,P,Y]),O,null,null,1,!0,F)}else s._onHierarchyInnerFirstLevResouLoaded(U,null,P,Y)},s._onHierarchyInnerFirstLevResouLoaded=function(U,F,O,P){F&&F.recover(),U.endLoad([O,P])},s._loadTerrain=function(U){U.on("loaded",null,s._onTerrainLtLoaded,[U,U._class._getGroup()]),U.load(U.url,"json",!1,null,!0)},s._onTerrainLtLoaded=function(U,F,O){if(U._class.destroyed)U.endLoad();else{var P,Y,c=U.url,L=rF.getURLVerion(c),u=$.getPath(c),d=[],a={},b=0,z=0,J=O.heightData;P=J.url,Y=s.formatRelativePath(u,P),L&&(Y+=L),P=a[P]=Y;var w=O.detailTexture;for(b=0,z=w.length;b<z;b++)d.push({url:w[b].diffuse});var j=O.normalMap;for(b=0,z=j.length;b<z;b++)d.push({url:j[b]});var x=O.alphaMap;for(b=0,z=x.length;b<z;b++)d.push({url:x[b],params:[!1,!1,6408,!0]});for(b=0,z=d.length;b<z;b++){var r=d[b].url;Y=s.formatRelativePath(u,r),L&&(Y+=L),d[b].url=Y,a[r]=Y}var H=d.length,h=H+2,Q=1/h;s._onProcessChange(U,0,Q,1);var X={heightMapLoaded:!1,texturesLoaded:!1},N=l.create(null,s._onProcessChange,[U,Q,Q],!1);s._innerFourthLevelLoaderManager.create(P,l.create(null,s._onTerrainHeightMapLoaded,[U,N,O,a,X]),N,null,[J.numX,J.numZ,J.bitType,J.value],1,!0,F);var K=l.create(null,s._onProcessChange,[U,2*Q,H/h],!1);s._innerFourthLevelLoaderManager.create(d,l.create(null,s._onTerrainTexturesLoaded,[U,K,O,a,X]),K,null,null,1,!0,F)}},s._onTerrainHeightMapLoaded=function(U,F,O,P,Y){Y.heightMapLoaded=!0,Y.texturesLoaded&&(U.endLoad([O,P]),F.recover())},s._onTerrainTexturesLoaded=function(U,F,O,P,Y){Y.texturesLoaded=!0,Y.heightMapLoaded&&(U.endLoad([O,P]),F.recover())},s._loadMesh=function(U){U.on("loaded",null,s._onMeshLmLoaded,[U,U._class._getGroup()]),U.load(U.url,"arraybuffer",!1,null,!0)},s._onMeshLmLoaded=function(U,F,O){if(U._class.destroyed)U.endLoad();else{var P,Y,c,L=U.url,u=rF.getURLVerion(L),d=$.getPath(L),a={},b=0,z=0;switch((s._readData=new K(O)).pos=0,s._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var J=s._readData.getUint32();s._readData.pos=s._readData.pos+4,z=s._readData.getUint16(),s._readData.pos=s._readData.pos+8*z;var w=s._readData.getUint32();for(z=s._readData.getUint16(),s._readData.pos=J+w,P=[],b=0;b<z;b++){var j=s._readData.readUTFString();-1!==j.lastIndexOf(".lmat")&&P.push(j)}break;default:for(s.READ_BLOCK(),b=0;b<2;b++){var x=s._readData.getUint16(),r=s._strings[x],H=s["READ_"+r];if(null==H)throw new Error("model file err,no this function:"+x+" "+r);1===b?P=H.call():H.call()}}for(b=0,c=P.length;b<c;b++){var h=P[b];Y=s.formatRelativePath(d,h),u&&(Y+=u),P[b]=Y,a[h]=Y}if(0<P.length){s._onProcessChange(U,0,.5,1);var Q=l.create(null,s._onProcessChange,[U,.5,.5],!1);s._innerSecondLevelLoaderManager.create(P,l.create(null,s._onMeshMateialLoaded,[U,Q,O,a]),Q,null,null,1,!0,F)}else U.endLoad([O,a])}},s._onMeshMateialLoaded=function(U,F,O,P){U.endLoad([O,P]),F.recover()},s._getMaterialTexturePath=function(U,F,O){var P=U.length-4;return U.indexOf(".dds")!=P&&U.indexOf(".tga")!=P&&U.indexOf(".exr")!=P&&U.indexOf(".DDS")!=P&&U.indexOf(".TGA")!=P&&U.indexOf(".EXR")!=P||(U=U.substr(0,P)+".png"),U=s.formatRelativePath(O,U),F&&(U+=F),U},s._loadMaterial=function(U){U.on("loaded",null,s._onMaterilLmatLoaded,[U,U._class._getGroup()]),U.load(U.url,"json",!1,null,!0)},s._onMaterilLmatLoaded=function(U,F,O){if(U._class.destroyed)U.endLoad();else{var P,Y=U.url,c=rF.getURLVerion(Y),L=$.getPath(Y),u=[],d={},a=O.customProps,b=O.version;if(b)switch(b){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var z=O.props.textures,J=0,w=z.length;J<w;J++){var j=z[J],x=j.path;if(x){var r=x.length-4;x.indexOf(".exr")!=r&&x.indexOf(".EXR")!=r||(x=x.substr(0,r)+".png"),P=s.formatRelativePath(L,x),c&&(P+=c),u.push({url:P,params:j.params}),d[x]=P}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var H=a.diffuseTexture.texture2D;if(H&&(P=s._getMaterialTexturePath(H,c,L),u.push(P),d[H]=P),a.normalTexture){var h=a.normalTexture.texture2D;h&&(P=s._getMaterialTexturePath(h,c,L),u.push(P),d[h]=P)}if(a.specularTexture){var Q=a.specularTexture.texture2D;Q&&(P=s._getMaterialTexturePath(Q,c,L),u.push(P),d[Q]=P)}if(a.emissiveTexture){var X=a.emissiveTexture.texture2D;X&&(P=s._getMaterialTexturePath(X,c,L),u.push(P),d[X]=P)}if(a.ambientTexture){var N=a.ambientTexture.texture2D;N&&(P=s._getMaterialTexturePath(N,c,L),u.push(P),d[N]=P)}if(a.reflectTexture){var K=a.reflectTexture.texture2D;K&&(P=s._getMaterialTexturePath(K,c,L),u.push(P),d[K]=P)}}var f=u.length,I=f+1,T=1/I;if(s._onProcessChange(U,0,T,1),0<f){var g=l.create(null,s._onProcessChange,[U,T,f/I],!1);s._innerFourthLevelLoaderManager.create(u,l.create(null,s._onMateialTexturesLoaded,[U,g,O,d]),g,qF,null,1,!0,F)}else s._onMateialTexturesLoaded(U,null,O,null)}},s._onMateialTexturesLoaded=function(U,F,O,P){U.endLoad([O,P]),F&&F.recover()},s._loadTextureCube=function(U){U.on("loaded",null,s._onTextureCubeLtcLoaded,[U]),U.load(U.url,"json",!1,null,!0)},s._onTextureCubeLtcLoaded=function(U,F){if(U._class.destroyed)U.endLoad();else{var O=$.getPath(U.url),P=[s.formatRelativePath(O,F.px),s.formatRelativePath(O,F.nx),s.formatRelativePath(O,F.py),s.formatRelativePath(O,F.ny),s.formatRelativePath(O,F.pz),s.formatRelativePath(O,F.nz)];s._onProcessChange(U,0,1/7,1);var Y=l.create(null,s._onProcessChange,[U,1/7,6/7],!1);s._innerFourthLevelLoaderManager.load(P,l.create(null,s._onTextureCubeImagesLoaded,[U,P,Y]),Y,"nativeimage")}},s._onTextureCubeImagesLoaded=function(U,F,O){var P=[];P.length=6;for(var Y=0;Y<6;Y++){var c=F[Y];P[Y]=H.getRes(c),H.clearRes(c)}U.endLoad(P),O.recover()},s._onProcessChange=function(U,F,O,P){(P=F+P*O)<1&&U.event("progress",P)},s.init=function(U,F,O,P,Y,c){if(void 0===O&&(O=!1),void 0===P&&(P=!1),void 0===Y&&(Y=!0),void 0===c&&(c=!0),h.update3DLoop=function(){},h.cancelLoadByUrl=function(U){s._cancelLoadByUrl(U)},d.isAntialias=O,d.isAlpha=P,d.premultipliedAlpha=Y,d.isStencil=c,!C.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");h.changeWebGLSize=s._changeWebGLSize,x.is3DMode=!0,N.init(U,F),y.__init__(),zF.__init__(),vF.__init__(),o.__init__(),s.__init__(),L.maxTextureCount=2,(s.debugMode||t.debugMode)&&(s._debugPhasorSprite=new Z)},s.HIERARCHY="SPRITE3DHIERARCHY",s.MESH="MESH",s.MATERIAL="MATERIAL",s.PBRMATERIAL="PBRMTL",s.TEXTURECUBE="TEXTURECUBE",s.TERRAIN="TERRAIN",s._readData=null,s._debugPhasorSprite=null,s.debugMode=!1,z(s,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new F},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new F},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new F},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new F}]),s}(),hF=function(U){function Y(U){Y.__super.call(this),this._owner=U,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}w(Y,"laya.d3.animation.AnimationTransform3D",c);var F=Y.prototype;return F._getlocalMatrix=function(){return this._localUpdate&&(rF._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},F._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldTransform()}},F._setWorldMatrixAndUpdate=function(U){if(this._worldMatrix=U,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var F=this._getlocalMatrix(),O=0;O<16;++O)this._worldMatrix[O]=F[O];else rF.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},F._setWorldMatrixNoUpdate=function(U){this._worldMatrix=U},F._setWorldMatrixIgnoreUpdate=function(U){this._worldMatrix=U,this._worldUpdate=!1},F.getLocalPosition=function(){return this._localPosition},F.setLocalPosition=function(U){if(this._parent)this._localPosition=U,this._localUpdate=!0,this._onWorldTransform();else{var F=this._entity.owner._transform,O=this._entity.localPosition,P=O.elements;P[0]=U[0],P[1]=U[1],P[2]=U[2],F.localPosition=O}},F.getLocalRotation=function(){if(this._localQuaternionUpdate){var U=this._localRotationEuler;rF._quaternionCreateFromYawPitchRollArray(U[1]/Y._angleToRandin,U[0]/Y._angleToRandin,U[2]/Y._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},F.setLocalRotation=function(U){if(this._parent)this._localRotation=U,rF.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var F=this._entity.owner._transform,O=this._entity.localRotation,P=O.elements;P[0]=U[0],P[1]=U[1],P[2]=U[2],P[3]=U[3],F.localRotation=O}},F.getLocalScale=function(){return this._localScale},F.setLocalScale=function(U){if(this._parent)this._localScale=U,this._localUpdate=!0,this._onWorldTransform();else{var F=this._entity.owner._transform,O=this._entity.localScale,P=O.elements;P[0]=U[0],P[1]=U[1],P[2]=U[2],F.localScale=O}},F.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){rF.getYawPitchRoll(this._localRotation,Y._tempVector3);var U=Y._tempVector3,F=this._localRotationEuler;F[0]=U[1]*Y._angleToRandin,F[1]=U[0]*Y._angleToRandin,F[2]=U[2]*Y._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},F.setLocalRotationEuler=function(U){if(this._parent)rF._quaternionCreateFromYawPitchRollArray(U[1]/Y._angleToRandin,U[0]/Y._angleToRandin,U[2]/Y._angleToRandin,this._localRotation),this._localRotationEuler=U,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var F=this._entity.owner._transform,O=this._entity.localRotationEuler,P=O.elements;P[0]=U[0],P[1]=U[1],P[2]=U[2],F.localRotationEuler=O}},F.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)rF.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var U=this._getlocalMatrix(),F=0;F<16;++F)this._worldMatrix[F]=U[F];this._worldUpdate=!1}return this._worldMatrix},F.setParent=function(U){if(this._parent!==U){if(this._parent){var F=this._parent._childs,O=F.indexOf(this);F.splice(O,1)}U&&(U._childs.push(this),U&&this._onWorldTransform()),this._parent=U}},z(Y,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),Y}(),QF=function(U){function F(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,F.__super.call(this),this._destroyed=!1,this._id=F._uniqueIDCounter,F._uniqueIDCounter++}w(F,"laya.d3.component.Component3D",c);var O=F.prototype;return N.imps(O,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),O._initialize=function(U){this._owner=U,this._enable=!0,this.started=!1,this._load(U)},O._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},O._load=function(U){},O._start=function(U){},O._update=function(U){},O._lateUpdate=function(U){},O._preRenderUpdate=function(U){},O._postRenderUpdate=function(U){},O._unload=function(U){this.offAll()},O._cloneTo=function(U){},j(0,O,"id",function(){return this._id}),j(0,O,"destroyed",function(){return this._destroyed}),j(0,O,"owner",function(){return this._owner}),j(0,O,"enable",function(){return this._enable},function(U){this._enable!==U&&(this._enable=U,this.event("enablechanged",this._enable))}),j(0,O,"isSingleton",function(){return F._isSingleton}),F._isSingleton=!0,F._uniqueIDCounter=1,F}(),XF=function(U){function F(){this._destroyed=!1,F.__super.call(this),this._destroyed=!1}w(F,"laya.d3.core.GeometryFilter",c);var O=F.prototype;return N.imps(O,{"laya.resource.IDestroy":!0}),O._destroy=function(){this.offAll(),this._destroyed=!0},j(0,O,"_isAsyncLoaded",function(){return!0}),j(0,O,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),j(0,O,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),j(0,O,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),j(0,O,"destroyed",function(){return this._destroyed}),F}(),NF=function(U){function P(U){P.__super.call(this),this._id=++P._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new tU(new LF,new LF),this._boundingBoxCenter=new LF,this._boundingSphere=new WU(new LF,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=U,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}w(P,"laya.d3.core.render.BaseRender",c);var F=P.prototype;return N.imps(F,{"laya.resource.IDestroy":!0}),F._changeMaterialReference=function(U,F){U&&U._removeReference(),F._addReference()},F._getInstanceMaterial=function(U,F){var O=new U.constructor;return U.cloneTo(O),O.name=O.name+"(Instance)",this._materialsInstance[F]=!0,this._changeMaterialReference(this._materials[F],O),this._materials[F]=O},F._setShaderValuelightMap=function(U){this._setShaderValueTexture(3,U)},F._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},F._renderRenderableBoundBox=function(){var U=HF._debugPhasorSprite,F=this.boundingBox,O=P._tempBoundBoxCorners;F.getCorners(O),U.line(O[0],P._greenColor,O[1],P._greenColor),U.line(O[2],P._greenColor,O[3],P._greenColor),U.line(O[4],P._greenColor,O[5],P._greenColor),U.line(O[6],P._greenColor,O[7],P._greenColor),U.line(O[0],P._greenColor,O[3],P._greenColor),U.line(O[1],P._greenColor,O[2],P._greenColor),U.line(O[2],P._greenColor,O[6],P._greenColor),U.line(O[3],P._greenColor,O[7],P._greenColor),U.line(O[0],P._greenColor,O[4],P._greenColor),U.line(O[1],P._greenColor,O[5],P._greenColor),U.line(O[4],P._greenColor,O[7],P._greenColor),U.line(O[5],P._greenColor,O[6],P._greenColor)},F._calculateBoundingSphere=function(){throw"BaseRender: must override it."},F._calculateBoundingBox=function(){throw"BaseRender: must override it."},F._setShaderValueTexture=function(U,F){this._owner._shaderValues.setValue(U,F)},F._setShaderValueMatrix4x4=function(U,F){this._owner._shaderValues.setValue(U,F?F.elements:null)},F._setShaderValueColor=function(U,F){this._owner._shaderValues.setValue(U,F?F.elements:null)},F._setShaderValueBuffer=function(U,F){this._owner._shaderValues.setValue(U,F)},F._setShaderValueInt=function(U,F){this._owner._shaderValues.setValue(U,F)},F._setShaderValueBool=function(U,F){this._owner._shaderValues.setValue(U,F)},F._setShaderValueNumber=function(U,F){this._owner._shaderValues.setValue(U,F)},F._setShaderValueVector2=function(U,F){this._owner._shaderValues.setValue(U,F?F.elements:null)},F._addShaderDefine=function(U){this._owner._shaderDefineValue|=U},F._removeShaderDefine=function(U){this._owner._shaderDefineValue&=~U},F._renderUpdate=function(U){return!0},F._applyLightMapParams=function(){if(0<=this._lightmapIndex){var U=this._owner.scene;if(U){var F=U.getlightmaps()[this._lightmapIndex];F?(this._addShaderDefine(ZF.SAHDERDEFINE_LIGHTMAP),F.loaded?this._setShaderValuelightMap(F):F.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(ZF.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(ZF.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(ZF.SAHDERDEFINE_LIGHTMAP)},F._updateOctreeNode=function(){var U=this._treeNode;U&&this._octreeNodeNeedChange&&(U.updateObject(this),this._octreeNodeNeedChange=!1)},F._destroy=function(){this.offAll();var U=0,F=0;for(U=0,F=this._renderElements.length;U<F;U++)this._renderElements[U]._destroy();for(U=0,F=this._materials.length;U<F;U++)this._materials[U]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},j(0,F,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),j(0,F,"id",function(){return this._id}),j(0,F,"material",function(){var U=this._materials[0];if(U&&!this._materialsInstance[0]){var F=this._getInstanceMaterial(U,0);this.event("materialchanged",[this,0,F])}return this._materials[0]},function(U){this.sharedMaterial=U}),j(0,F,"sharedMaterial",function(){return this._materials[0]},function(U){var F=this._materials[0];F!==U&&(this._materials[0]=U,this._materialsInstance[0]=!1,this._changeMaterialReference(F,U),this.event("materialchanged",[this,0,U]))}),j(0,F,"lightmapIndex",function(){return this._lightmapIndex},function(U){this._lightmapIndex=U,this._applyLightMapParams()}),j(0,F,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(U){this._lightmapScaleOffset=U,this._setShaderValueColor(2,U),this._addShaderDefine(ZF.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),j(0,F,"enable",function(){return this._enable},function(U){this._enable=U,this.event("enablechanged",[this,U])}),j(0,F,"materials",function(){for(var U=0,F=this._materials.length;U<F;U++)if(!this._materialsInstance[U]){var O=this._getInstanceMaterial(this._materials[U],U);this.event("materialchanged",[this,U,O])}return this._materials.slice()},function(U){this.sharedMaterials=U}),j(0,F,"sharedMaterials",function(){return this._materials.slice()},function(U){if(!U)throw new Error("MeshRender: shadredMaterials value can't be null.");var F=U.length;this._materialsInstance.length=F;for(var O=0;O<F;O++){var P=this._materials[O];P!==U[O]&&(this._materialsInstance[O]=!1,this._changeMaterialReference(P,U[O]),this.event("materialchanged",[this,O,U[O]]))}this._materials=U}),j(0,F,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),j(0,F,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var U=this.boundingBox;LF.add(U.min,U.max,this._boundingBoxCenter),LF.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),j(0,F,"receiveShadow",function(){return this._receiveShadow},function(U){this._receiveShadow!==U&&((this._receiveShadow=U)?this._addShaderDefine(wF.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(wF.SHADERDEFINE_RECEIVE_SHADOW))}),j(0,F,"destroyed",function(){return this._destroyed}),P._uniqueIDCounter=0,z(P,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new LF,new LF,new LF,new LF,new LF,new LF,new LF,new LF]},"_greenColor",function(){return this._greenColor=new uF(0,1,0,1)}]),P}(),KF=function(U){function u(U){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,u.__super.call(this),this._localPosition=new LF,this._localRotation=new OF(0,0,0,1),this._localScale=new LF(1,1,1),this._localRotationEuler=new LF,this._localMatrix=new UF,this._position=new LF,this._rotation=new OF(0,0,0,1),this._scale=new LF(1,1,1),this._worldMatrix=new UF,this._forward=new LF,this._up=new LF,this._right=new LF,this._owner=U,this._childs=[]}w(u,"laya.d3.core.Transform3D",c);var F=u.prototype;return F._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)UF.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var U=u._tempVector30;LF.multiply(this.pivot,this._localScale,U);var F=u._tempVector31;LF.subtract(U,this.pivot,F);var O=u._tempVector32,P=this.localRotation;LF.transformQuat(U,P,O),LF.subtract(O,U,O);var Y=u._tempVector33;LF.subtract(this._localPosition,F,Y),LF.subtract(Y,O,Y),UF.createAffineTransformation(Y,P,this._localScale,this._localMatrix)}},F._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldPositionRotationTransform()}},F._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldPositionScaleTransform()}},F._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldPositionTransform()}},F._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldPositionRotationTransform()}},F._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldPositionScaleTransform()}},F._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._onWorldTransform()}},F.translate=function(U,F){void 0===F&&(F=!0),F?(UF.createFromQuaternion(this.localRotation,u._tempMatrix0),LF.transformCoordinate(U,u._tempMatrix0,u._tempVector30),LF.add(this.localPosition,u._tempVector30,this._localPosition),this.localPosition=this._localPosition):(LF.add(this.position,U,this._position),this.position=this._position)},F.rotate=function(U,F,O){var P;void 0===F&&(F=!0),void 0===O&&(O=!0),P=O?U:(LF.scale(U,Math.PI/180,u._tempVector30),u._tempVector30),OF.createFromYawPitchRoll(P.y,P.x,P.z,u._tempQuaternion0),F?(OF.multiply(this._localRotation,u._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(OF.multiply(u._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},F.lookAt=function(U,F,O){void 0===O&&(O=!1);var P,Y=U.elements;if(O){if(P=this._localPosition.elements,Math.abs(P[0]-Y[0])<BU.zeroTolerance&&Math.abs(P[1]-Y[1])<BU.zeroTolerance&&Math.abs(P[2]-Y[2])<BU.zeroTolerance)return;OF.lookAt(this._localPosition,U,F,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var c=this.position;if(P=c.elements,Math.abs(P[0]-Y[0])<BU.zeroTolerance&&Math.abs(P[1]-Y[1])<BU.zeroTolerance&&Math.abs(P[2]-Y[2])<BU.zeroTolerance)return;OF.lookAt(c,U,F,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},j(0,F,"_isFrontFaceInvert",function(){var U=this.scale,F=U.x<0;return U.y<0&&(F=!F),U.z<0&&(F=!F),F}),j(0,F,"owner",function(){return this._owner}),j(0,F,"localRotation",function(){if(this._localQuaternionUpdate){var U=this._localRotationEuler.elements;OF.createFromYawPitchRoll(U[1]/u._angleToRandin,U[0]/u._angleToRandin,U[2]/u._angleToRandin,this._localRotation)}return this._localRotation},function(U){this._localRotation=U,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),j(0,F,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?UF.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(U){null===this._parent?U.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),UF.multiply(this._localMatrix,U,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=U,this._worldUpdate=!1}),j(0,F,"worldNeedUpdate",function(){return this._worldUpdate}),j(0,F,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(U){this._localMatrix=U,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),j(0,F,"dummy",function(){return this._dummy},function(U){this._dummy!==U&&(this._dummy&&(this._dummy._entity=null),U&&(U._entity=this),this._dummy=U)}),j(0,F,"localPosition",function(){return this._localPosition},function(U){this._localPosition=U,this._localUpdate=!0,this._onWorldPositionTransform()}),j(0,F,"position",function(){if(this._positionUpdate){if(null!=this._parent){var U=this._parent.position;LF.multiply(this._localPosition,this._parent.scale,u._tempVector30),LF.transformQuat(u._tempVector30,this._parent.rotation,u._tempVector30),LF.add(U,u._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(U){if(null!=this._parent){LF.subtract(U,this._parent.position,this._localPosition);var F=this._parent.scale.elements,O=F[0],P=F[1],Y=F[2];if(1!==O||1!==P||1!==Y){var c=u._tempVector30,L=c.elements;L[0]=1/O,L[1]=1/P,L[2]=1/Y,LF.multiply(this._localPosition,c,this._localPosition)}this._parent.rotation.invert(u._tempQuaternion0),LF.transformQuat(this._localPosition,u._tempQuaternion0,this._localPosition)}else U.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=U,this._positionUpdate=!1}),j(0,F,"localScale",function(){return this._localScale},function(U){this._localScale=U,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),j(0,F,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(u._tempVector30);var U=u._tempVector30.elements,F=this._localRotationEuler.elements;F[0]=U[1]*u._angleToRandin,F[1]=U[0]*u._angleToRandin,F[2]=U[2]*u._angleToRandin}return this._localRotationEuler},function(U){this._localRotationEuler=U,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),j(0,F,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?OF.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(U){null!=this._parent?(this._parent.rotation.invert(u._tempQuaternion0),OF.multiply(U,u._tempQuaternion0,this._localRotation)):U.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=U,this._rotationUpdate=!1}),j(0,F,"scale",function(){return this._scaleUpdate&&(null!==this._parent?LF.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(U){if(null!==this._parent){var F=this._parent.scale.elements,O=u._tempVector30.elements;O[0]=1/F[0],O[1]=1/F[1],O[2]=1/F[2],LF.multiply(U,u._tempVector30,this._localScale)}else U.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=U,this._scaleUpdate=!1}),j(0,F,"rotationEuler",null,function(U){OF.createFromYawPitchRoll(U.y,U.x,U.z,this._rotation),this.rotation=this._rotation}),j(0,F,"forward",function(){var U=this.worldMatrix.elements;return this._forward.elements[0]=-U[8],this._forward.elements[1]=-U[9],this._forward.elements[2]=-U[10],this._forward}),j(0,F,"up",function(){var U=this.worldMatrix.elements;return this._up.elements[0]=U[4],this._up.elements[1]=U[5],this._up.elements[2]=U[6],this._up}),j(0,F,"right",function(){var U=this.worldMatrix.elements;return this._right.elements[0]=U[0],this._right.elements[1]=U[1],this._right.elements[2]=U[2],this._right}),j(0,F,"parent",function(){return this._parent},function(U){if(this._parent!==U){if(this._parent){var F=this._parent._childs,O=F.indexOf(this);F.splice(O,1)}U&&(U._childs.push(this),U&&this._onWorldTransform()),this._parent=U}}),z(u,["_tempVector30",function(){return this._tempVector30=new LF},"_tempVector31",function(){return this._tempVector31=new LF},"_tempVector32",function(){return this._tempVector32=new LF},"_tempVector33",function(){return this._tempVector33=new LF},"_tempQuaternion0",function(){return this._tempQuaternion0=new OF},"_tempMatrix0",function(){return this._tempMatrix0=new UF},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),u}(),fF=(function(U){function F(){this._rotation=0,this._matNeedUpdte=!1,F.__super.call(this),this._matrix=new UF,this._offset=new cF,this._tiling=new cF(1,1)}w(F,"laya.d3.core.TransformUV",c);var O=F.prototype;N.imps(O,{"laya.d3.core.IClone":!0}),O._updateMatrix=function(){F._tempOffsetV3.elements[0]=this._offset.x,F._tempOffsetV3.elements[1]=this._offset.y,OF.createFromYawPitchRoll(0,0,this._rotation,F._tempRotationQua),F._tempTitlingV3.elements[0]=this._tiling.x,F._tempTitlingV3.elements[1]=this._tiling.y,UF.createAffineTransformation(F._tempOffsetV3,F._tempRotationQua,F._tempTitlingV3,this._matrix)},O.cloneTo=function(U){U._matrix=this._matrix.clone(),U._offset=this._offset.clone(),U._rotation=this._rotation,U._tiling=this._tiling.clone()},O.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,O,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),j(0,O,"tiling",function(){return this._tiling},function(U){this._tiling=U,this._matNeedUpdte=!0}),j(0,O,"offset",function(){return this._offset},function(U){this._offset=U,this._matNeedUpdte=!0}),j(0,O,"rotation",function(){return this._rotation},function(U){this._rotation=U,this._matNeedUpdte=!0}),z(F,["_tempOffsetV3",function(){return this._tempOffsetV3=new LF(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new OF},"_tempTitlingV3",function(){return this._tempTitlingV3=new LF(1,1,1)}])}(),function(O){function U(){this.x=NaN,this.y=NaN,this.z=NaN,U.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}w(U,"laya.d3.core.particleShuriKen.module.shape.BoxShape",O);var F=U.prototype;F._getShapeBoundBox=function(U){var F=U.min.elements;F[0]=.5*-this.x,F[1]=.5*-this.y,F[2]=.5*-this.z;var O=U.max.elements;O[0]=.5*this.x,O[1]=.5*this.y,O[2]=.5*this.z},F._getSpeedBoundBox=function(U){var F=U.min.elements;F[0]=0,F[1]=0,F[2]=0;var O=U.max.elements;O[0]=0,O[1]=1,O[2]=0},F.generatePositionAndDirection=function(U,F,O,P){var Y=U.elements,c=F.elements;O?(O.seed=P[16],q._randomPointInsideHalfUnitBox(U,O),P[16]=O.seed):q._randomPointInsideHalfUnitBox(U),Y[0]=this.x*Y[0],Y[1]=this.y*Y[1],Y[2]=this.z*Y[2],this.randomDirection?O?(O.seed=P[17],q._randomPointUnitSphere(F,O),P[17]=O.seed):q._randomPointUnitSphere(F):(c[0]=0,c[1]=0,c[2]=1)},F.cloneTo=function(U){O.prototype.cloneTo.call(this,U);var F=U;F.x=this.x,F.y=this.y,F.z=this.z,F.randomDirection=this.randomDirection}}(m),function(O){function L(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,L.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}w(L,"laya.d3.core.particleShuriKen.module.shape.CircleShape",O);var U=L.prototype;U._getShapeBoundBox=function(U){var F=U.min.elements;F[0]=F[2]=-this.radius,F[1]=0;var O=U.max.elements;O[0]=O[2]=this.radius,O[1]=0},U._getSpeedBoundBox=function(U){var F=U.min.elements;F[0]=F[1]=-1,F[2]=0;var O=U.max.elements;O[0]=O[1]=1,O[2]=0},U.generatePositionAndDirection=function(U,F,O,P){var Y=U.elements,c=L._tempPositionPoint.elements;O?(O.seed=P[16],this.emitFromEdge?q._randomPointUnitArcCircle(this.arc,L._tempPositionPoint,O):q._randomPointInsideUnitArcCircle(this.arc,L._tempPositionPoint,O),P[16]=O.seed):this.emitFromEdge?q._randomPointUnitArcCircle(this.arc,L._tempPositionPoint):q._randomPointInsideUnitArcCircle(this.arc,L._tempPositionPoint),Y[0]=-c[0],Y[1]=c[1],Y[2]=0,LF.scale(U,this.radius,U),this.randomDirection?O?(O.seed=P[17],q._randomPointUnitSphere(F,O),P[17]=O.seed):q._randomPointUnitSphere(F):U.cloneTo(F)},U.cloneTo=function(U){O.prototype.cloneTo.call(this,U);var F=U;F.radius=this.radius,F.arc=this.arc,F.emitFromEdge=this.emitFromEdge,F.randomDirection=this.randomDirection},z(L,["_tempPositionPoint",function(){return this._tempPositionPoint=new cF}])}(m),function(O){function J(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,J.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}w(J,"laya.d3.core.particleShuriKen.module.shape.ConeShape",O);var U=J.prototype;U._getShapeBoundBox=function(U){var F=this.radius+this.length*Math.sin(this.angle),O=this.length*Math.cos(this.angle),P=U.min.elements;P[0]=P[1]=-F,P[2]=0;var Y=U.max.elements;Y[0]=Y[1]=F,Y[2]=O},U._getSpeedBoundBox=function(U){var F=Math.sin(this.angle),O=U.min.elements;O[0]=O[1]=-F,O[2]=0;var P=U.max.elements;P[0]=O[1]=F,P[2]=1},U.generatePositionAndDirection=function(U,F,O,P){var Y,c=U.elements,L=F.elements,u=J._tempPositionPoint.elements,d=NaN,a=NaN,b=Math.cos(this.angle),z=Math.sin(this.angle);switch(this.emitType){case 0:O?(O.seed=P[16],q._randomPointInsideUnitCircle(J._tempPositionPoint,O),P[16]=O.seed):q._randomPointInsideUnitCircle(J._tempPositionPoint),d=u[0],a=u[1],c[0]=d*this.radius,c[1]=a*this.radius,c[2]=0,this.randomDirection?(O?(O.seed=P[17],q._randomPointInsideUnitCircle(J._tempDirectionPoint,O),P[17]=O.seed):q._randomPointInsideUnitCircle(J._tempDirectionPoint),Y=J._tempDirectionPoint.elements,L[0]=Y[0]*z,L[1]=Y[1]*z):(L[0]=d*z,L[1]=a*z),L[2]=b;break;case 1:O?(O.seed=P[16],q._randomPointUnitCircle(J._tempPositionPoint,O),P[16]=O.seed):q._randomPointUnitCircle(J._tempPositionPoint),d=u[0],a=u[1],c[0]=d*this.radius,c[1]=a*this.radius,c[2]=0,this.randomDirection?(O?(O.seed=P[17],q._randomPointInsideUnitCircle(J._tempDirectionPoint,O),P[17]=O.seed):q._randomPointInsideUnitCircle(J._tempDirectionPoint),Y=J._tempDirectionPoint.elements,L[0]=Y[0]*z,L[1]=Y[1]*z):(L[0]=d*z,L[1]=a*z),L[2]=b;break;case 2:O?(O.seed=P[16],q._randomPointInsideUnitCircle(J._tempPositionPoint,O)):q._randomPointInsideUnitCircle(J._tempPositionPoint),d=u[0],a=u[1],c[0]=d*this.radius,c[1]=a*this.radius,L[c[2]=0]=d*z,L[1]=a*z,L[2]=b,LF.normalize(F,F),O?(LF.scale(F,this.length*O.getFloat(),F),P[16]=O.seed):LF.scale(F,this.length*Math.random(),F),LF.add(U,F,U),this.randomDirection&&(O?(O.seed=P[17],q._randomPointUnitSphere(F,O),P[17]=O.seed):q._randomPointUnitSphere(F));break;case 3:O?(O.seed=P[16],q._randomPointUnitCircle(J._tempPositionPoint,O)):q._randomPointUnitCircle(J._tempPositionPoint),d=u[0],a=u[1],c[0]=d*this.radius,c[1]=a*this.radius,L[c[2]=0]=d*z,L[1]=a*z,L[2]=b,LF.normalize(F,F),O?(LF.scale(F,this.length*O.getFloat(),F),P[16]=O.seed):LF.scale(F,this.length*Math.random(),F),LF.add(U,F,U),this.randomDirection&&(O?(O.seed=P[17],q._randomPointUnitSphere(F,O),P[17]=O.seed):q._randomPointUnitSphere(F));break;default:throw new Error("ConeShape:emitType is invalid.")}},U.cloneTo=function(U){O.prototype.cloneTo.call(this,U);var F=U;F.angle=this.angle,F.radius=this.radius,F.length=this.length,F.emitType=this.emitType,F.randomDirection=this.randomDirection},z(J,["_tempPositionPoint",function(){return this._tempPositionPoint=new cF},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new cF}])}(m),function(O){function U(){this.radius=NaN,this.emitFromShell=!1,U.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}w(U,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",O);var F=U.prototype;F._getShapeBoundBox=function(U){var F=U.min.elements;F[0]=F[1]=F[2]=-this.radius;var O=U.max.elements;O[0]=O[1]=this.radius,O[2]=0},F._getSpeedBoundBox=function(U){var F=U.min.elements;F[0]=F[1]=-1,F[2]=0;var O=U.max.elements;O[0]=O[1]=O[2]=1},F.generatePositionAndDirection=function(U,F,O,P){var Y=U.elements;O?(O.seed=P[16],this.emitFromShell?q._randomPointUnitSphere(U,O):q._randomPointInsideUnitSphere(U,O),P[16]=O.seed):this.emitFromShell?q._randomPointUnitSphere(U):q._randomPointInsideUnitSphere(U),LF.scale(U,this.radius,U);var c=Y[2];c<0&&(Y[2]=-1*c),this.randomDirection?O?(O.seed=P[17],q._randomPointUnitSphere(F,O),P[17]=O.seed):q._randomPointUnitSphere(F):U.cloneTo(F)},F.cloneTo=function(U){O.prototype.cloneTo.call(this,U);var F=U;F.radius=this.radius,F.emitFromShell=this.emitFromShell,F.randomDirection=this.randomDirection}}(m),function(O){function U(){this.radius=NaN,this.emitFromShell=!1,U.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}w(U,"laya.d3.core.particleShuriKen.module.shape.SphereShape",O);var F=U.prototype;F._getShapeBoundBox=function(U){var F=U.min.elements;F[0]=F[1]=F[2]=-this.radius;var O=U.max.elements;O[0]=O[1]=O[2]=this.radius},F._getSpeedBoundBox=function(U){var F=U.min.elements;F[0]=F[1]=F[2]=-1;var O=U.max.elements;O[0]=O[1]=O[2]=1},F.generatePositionAndDirection=function(U,F,O,P){O?(O.seed=P[16],this.emitFromShell?q._randomPointUnitSphere(U,O):q._randomPointInsideUnitSphere(U,O),P[16]=O.seed):this.emitFromShell?q._randomPointUnitSphere(U):q._randomPointInsideUnitSphere(U),LF.scale(U,this.radius,U),this.randomDirection?O?(O.seed=P[17],q._randomPointUnitSphere(F,O),P[17]=O.seed):q._randomPointUnitSphere(F):U.cloneTo(F)},F.cloneTo=function(U){O.prototype.cloneTo.call(this,U);var F=U;F.radius=this.radius,F.emitFromShell=this.emitFromShell,F.randomDirection=this.randomDirection}}(m),function(U){function F(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,F.__super.call(this)}return w(F,"laya.d3.core.render.SubMeshRenderElement",e),F}()),IF=function(U){function r(U,F,O,P,Y,c){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=U,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[wF.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[ZF.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[ZF.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$F.SHADERDEFINE_ALPHATEST]="ALPHATEST";r.__super.call(this,U,F,O,null,{}),this._attributeMap=P;var L;for(L in Y){var u=Y[L];switch(u[1]){case 0:this._renderElementUniformMap[L]=u[0];break;case 1:this._materialUniformMap[L]=u[0];break;case 2:this._spriteUniformMap[L]=u[0];break;case 3:this._cameraUniformMap[L]=u[0];break;case 4:this._sceneUniformMap[L]=u[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}w(r,"laya.d3.shader.ShaderCompile3D",Q);var F=r.prototype;return F._definesToNameDic=function(U,F){for(var O={},P=1,Y=0;Y<32&&!(U<(P=1<<Y));Y++)if(U&P){var c=F[P];c&&(O[c]="")}return O},F.withCompile=function(U,F,O,P){var Y,c,L;if(c=this.sharders[U])if(L=c[F]){if(Y=L[O])return Y}else L=c[F]=[];else L=(c=this.sharders[U]=[])[F]=[];var u,d=this._definesToNameDic(U,r._globalInt2name),a=this._definesToNameDic(F,this._spriteInt2name),b=this._definesToNameDic(O,this._materialInt2name),z={},J="";if(d)for(u in d)J+="#define "+u+"\n",z[u]=!0;if(a)for(u in a)J+="#define "+u+"\n",z[u]=!0;if(b)for(u in b)J+="#define "+u+"\n",z[u]=!0;var w=GF.nameKey.getName(this._name)+" compile ("+U+","+F+","+O+")",j=this._VS.toscript(z,[]),x=this._PS.toscript(z,[]);i.now();if(Y=GF.create(J+j.join("\n"),J+x.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,P,w),L[O]=Y,laya.d3.shader.ShaderCompile3D.debugMode)i.now();return Y},F.precompileShaderWithShaderDefine=function(U,F,O){this.withCompile(U,F,O,!0)},F.addMaterialDefines=function(U){var F=U.defines;for(var O in F){var P=F[O],Y=parseInt(O);this._materialInt2name[Y]=P,this._materialName2Int[P]=Y}},F.addSpriteDefines=function(U){var F=U.defines;for(var O in F){var P=F[O],Y=parseInt(O);this._spriteInt2name[Y]=P,this._spriteName2Int[P]=Y}},F.getMaterialDefineByName=function(U){return this._materialName2Int[U]},F.registerMaterialDefine=function(U){var F=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[F]=U,this._materialName2Int[U]=F},F.registerSpriteDefine=function(U){var F=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[F]=U,this._spriteName2Int[U]=F},r._globalRegDefine=function(U,F){r._globalInt2name[F]=U},r.add=function(U,F,O,P,Y){return laya.d3.shader.ShaderCompile3D._preCompileShader[U]=new r(U,F,O,P,Y,Q.includes)},r.get=function(U){return laya.d3.shader.ShaderCompile3D._preCompileShader[GF.nameKey.getID(U)]},r._preCompileShader={},r._globalInt2name=[],r.debugMode=!1,r.SHADERDEFINE_HIGHPRECISION=1,r.SHADERDEFINE_FOG=4,r.SHADERDEFINE_DIRECTIONLIGHT=8,r.SHADERDEFINE_POINTLIGHT=16,r.SHADERDEFINE_SPOTLIGHT=32,r.SHADERDEFINE_UV0=64,r.SHADERDEFINE_COLOR=128,r.SHADERDEFINE_UV1=256,r.SAHDERDEFINE_DEPTHFOG=131072,r}(),TF=function(U){function j(){j.__super.call(this)}w(j,"laya.d3.graphics.MeshSprite3DStaticBatchManager",PU);var F=j.prototype;return F._getStaticBatch=function(U,F,O,P){var Y,c;return c=U?U.id.toString()+O.id.toString()+F.id.toString()+P.toString():O.id.toString()+F.id.toString()+P.toString(),this._staticBatches[c]?Y=this._staticBatches[c]:this._staticBatches[c]=Y=new gF(c,this,U,F,O),Y},F._initStaticBatchs=function(U){var F,O;this._initBatchRenderElements.sort(j._sortPrepareStaticBatch);for(var P,Y=!1,c=0,L=0,u=this._initBatchRenderElements.length;L<u;L++){var d,a=this._initBatchRenderElements[L],b=a.renderObj._getVertexBuffer(0);a._sprite3D;if(O===b.vertexDeclaration&&F===a._material)if(Y)P._addCombineBatchRenderObjTest(a)?(d=a._staticBatch)!==P&&(d&&d._deleteCombineBatchRenderObj(a),P._addCombineBatchRenderObj(a)):(Y=!1,c++);else{var z=this._initBatchRenderElements[L-1],J=z.renderObj,w=a.renderObj;Y=!(65535<J._getVertexBuffer().vertexCount+w._getVertexBuffer().vertexCount)&&(P=this._getStaticBatch(U,O,F,c),(d=z._staticBatch)!==P&&(d&&d._deleteCombineBatchRenderObj(z),P._addCombineBatchRenderObj(z)),(d=a._staticBatch)!==P&&(d&&d._deleteCombineBatchRenderObj(a),P._addCombineBatchRenderObj(a)),!0)}else Y=!1,c=0;F=a._material,O=b.vertexDeclaration}},j._sortPrepareStaticBatch=function(U,F){var O=U._render,P=F._render,Y=O.lightmapIndex-P.lightmapIndex;if(0!=Y)return Y;var c=O.receiveShadow-P.receiveShadow;if(0!=c)return c;var L=U._mainSortID-F._mainSortID;return 0==L?U.renderObj.triangleCount-F.renderObj.triangleCount:L},j}(),gF=function(U){function c(U,F,O,P,Y){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,c.__super.call(this,U,F,O),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=P,this._material=Y}w(c,"laya.d3.graphics.SubMeshStaticBatch",YU);var F=c.prototype;return F._compareBatchRenderElement=function(U,F){return U._batchIndexStart>F._batchIndexStart},F._addCombineBatchRenderObjTest=function(U){var F=U.renderObj._vertexCount;return!(65535<(0<F?this._currentCombineVertexCount+F:this._currentCombineVertexCount+U.renderObj._getVertexBuffer().vertexCount))},F._addCombineBatchRenderObj=function(U){var F=U.renderObj,O=F._vertexCount;this._initBatchRenderElements.push(U),U._staticBatch=this,0<O?(this._currentCombineIndexCount+=F._indexCount,this._currentCombineVertexCount+=O):(this._currentCombineIndexCount=this._currentCombineIndexCount+F._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+F._getVertexBuffer().vertexCount),this._needFinishCombine=!0},F._deleteCombineBatchRenderObj=function(U){var F=U.renderObj,O=this._initBatchRenderElements.indexOf(U);if(-1!==O){this._initBatchRenderElements.splice(O,1),U._staticBatch=null;var P=F._vertexCount;0<P?(this._currentCombineIndexCount=this._currentCombineIndexCount-F._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-P):(this._currentCombineIndexCount=this._currentCombineIndexCount-F._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-F._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},F._finishInit=function(){if(this._needFinishCombine){var U=0,F=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var O=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),P=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=mF.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=MF.create("ushort",this._currentCombineIndexCount,35044);for(var Y=0,c=this._initBatchRenderElements.length;Y<c;Y++){var L=this._initBatchRenderElements[Y],u=L.renderObj,d=u._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,L._sprite3D),a=u.getIndices(),b=L._sprite3D.transform._isFrontFaceInvert,z=U/(this._vertexDeclaration.vertexStride/4)-u._vertexStart,J=F,w=J+a.length;L._batchIndexStart=J,L._batchIndexEnd=w,P.set(a,F);var j=0;if(b)for(j=J;j<w;j+=3){P[j]=z+P[j];var x=P[j+1],r=P[j+2];P[j+1]=z+r,P[j+2]=z+x}else for(j=J;j<w;j+=3)P[j]=z+P[j],P[j+1]=z+P[j+1],P[j+2]=z+P[j+2];F+=a.length,O.set(d,U),U+=d.length}this._vertexBuffer.setData(O),this._indexBuffer.setData(P),this._needFinishCombine=!1}},F._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new fF)},F._getRenderElement=function(U,F,O){for(var P,Y,c=this._batchRenderElements.length,L=!0,u=0;u<c;u++){var d,a,b=(Y=this._batchRenderElements[u])._sprite3D._render;if(0!==u&&(L=(d=(P=this._batchRenderElements[u-1])._sprite3D._render).lightmapIndex!==b.lightmapIndex||d.receiveShadow!==b.receiveShadow||P._batchIndexEnd!==Y._batchIndexStart),L){(a=this._getCombineRenderElementFromPool()).renderObj=this,a._material=this._material,a._batchIndexStart=Y._batchIndexStart,a._batchIndexEnd=Y._batchIndexEnd;var z=b.lightmapIndex,J=z+1,w=this._batchOwnerIndices[J];w||(w=this._batchOwnerIndices[J]=[]);var j,x=w[Y._render.receiveShadow?1:0];void 0===x?(w[b.receiveShadow?1:0]=this._batchOwners.length,(j=new vF(null,"StaticBatchMeshSprite3D"))._scene=F,j._transform=this._rootOwner?this._rootOwner._transform:null,j._render.lightmapIndex=z,j._render.receiveShadow=Y._render.receiveShadow,this._batchOwners.push(j)):j=this._batchOwners[x],j._render._renderUpdate(O),a._sprite3D=j,U.push(a)}else a._batchIndexEnd=Y._batchIndexEnd}},F._beforeRender=function(U){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},F._render=function(U){var F=U.renderElement,O=F._batchIndexStart,P=F._batchIndexEnd-O;C.mainContext.drawElements(4,P,5123,2*O),I.drawCall++,I.trianglesFaces+=P/3},F.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},F._getVertexBuffer=function(U){return void 0===U&&(U=0),this._vertexBuffer},c}(),lF=function(U){function F(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,F.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}w(F,"laya.d3.core.ComponentNode",a);var O=F.prototype;return O.addComponent=function(U){var F,O=this._componentsMap.indexOf(U);if(-1===O)F=[],this._componentsMap.push(U),this._typeComponentsIndices.push(F);else if(F=this._typeComponentsIndices[O],this._components[F[0]].isSingleton)throw new Error("无法单实例创建"+U+"组件，"+U+"组件已存在！");var P=Y.getInstance(U);return F.push(this._components.length),this._components.push(P),P instanceof laya.d3.component.Script&&this._scripts.push(P),P._initialize(this),P},O._removeComponent=function(U,F){var O=this._typeComponentsIndices[U],P=O[F],Y=this._components[P];this._components.splice(P,1),Y instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(Y),1),O.splice(F,1),0===O.length&&(this._typeComponentsIndices.splice(U,1),this._componentsMap.splice(U,1));for(var c=0,L=this._componentsMap.length;c<L;c++)for(var u=(O=this._typeComponentsIndices[c]).length-1;0<=u;u--){var d=O[u];if(!(P<d))break;O[u]=--d}Y._destroy()},O.getComponentByType=function(U,F){void 0===F&&(F=0);var O=this._componentsMap.indexOf(U);return-1===O?null:this._components[this._typeComponentsIndices[O][F]]},O.getComponentsByType=function(U,F){var O=this._componentsMap.indexOf(U);if(-1!==O){var P=this._typeComponentsIndices[O],Y=P.length;F.length=Y;for(var c=0;c<Y;c++)F[c]=this._components[P[c]]}else F.length=0},O.getComponentByIndex=function(U){return this._components[U]},O.removeComponentByType=function(U,F){void 0===F&&(F=0);var O=this._componentsMap.indexOf(U);-1!==O&&this._removeComponent(O,F)},O.removeComponentsByType=function(U){var F=this._componentsMap.indexOf(U);if(-1!==F)for(var O=this._typeComponentsIndices[F],P=0,Y=O.length;P<Y;O.length<Y?Y--:P++)this._removeComponent(F,P)},O.removeAllComponent=function(){for(var U=0,F=this._componentsMap.length;U<F;this._componentsMap.length<F?F--:U++)this.removeComponentsByType(this._componentsMap[U])},O._updateComponents=function(U){for(var F=0,O=this._components.length;F<O;F++){var P=this._components[F];!P.started&&(P._start(U),P.started=!0),P.enable&&P._update(U)}},O._lateUpdateComponents=function(U){for(var F=0;F<this._components.length;F++){var O=this._components[F];!O.started&&(O._start(U),O.started=!0),O.enable&&O._lateUpdate(U)}},O._preRenderUpdateComponents=function(U){for(var F=0;F<this._components.length;F++){var O=this._components[F];!O.started&&(O._start(U),O.started=!0),O.enable&&O._preRenderUpdate(U)}},O._postRenderUpdateComponents=function(U){for(var F=0;F<this._components.length;F++){var O=this._components[F];!O.started&&(O._start(U),O.started=!0),O.enable&&O._postRenderUpdate(U)}},F}(),$F=function(P){function U(){U.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new JF,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new uF(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}w(U,"laya.d3.core.material.BaseMaterial",P);var F=U.prototype;return N.imps(F,{"laya.d3.core.IClone":!0}),F._addShaderDefine=function(U){this._shaderDefineValue|=U},F._removeShaderDefine=function(U){this._shaderDefineValue&=~U},F._addDisablePublicShaderDefine=function(U){this._disablePublicShaderDefine|=U},F._removeDisablePublicShaderDefine=function(U){this._disablePublicShaderDefine&=~U},F._setBuffer=function(U,F){this._shaderValues.setValue(U,F),this._values[U]=F},F._getBuffer=function(U){return this._values[U]},F._setMatrix4x4=function(U,F){this._shaderValues.setValue(U,F?F.elements:null),this._values[U]=F},F._getMatrix4x4=function(U){return this._values[U]},F._setInt=function(U,F){this._shaderValues.setValue(U,F),this._values[U]=F},F._getInt=function(U){return this._values[U]},F._setNumber=function(U,F){this._shaderValues.setValue(U,F),this._values[U]=F},F._getNumber=function(U){return this._values[U]},F._setBool=function(U,F){this._shaderValues.setValue(U,F),this._values[U]=F},F._getBool=function(U){return this._values[U]},F._setVector2=function(U,F){this._shaderValues.setValue(U,F?F.elements:null),this._values[U]=F},F._getVector2=function(U){return this._values[U]},F._setColor=function(U,F){this._shaderValues.setValue(U,F?F.elements:null),this._values[U]=F},F._getColor=function(U){return this._values[U]},F._setTexture=function(U,F){var O=this._values[U];this._values[U]=F,this._shaderValues.setValue(U,F),0<this.referenceCount&&(O&&O._removeReference(),F&&F._addReference())},F._getTexture=function(U){return this._values[U]},F._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},F._getShader=function(U,F,O){var P=(U|F)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(P,O,this._shaderDefineValue),this._shader},F._setRenderStateBlendDepth=function(){var U=C.mainContext;switch(s.setDepthMask(U,this.depthWrite),0===this.depthTest?s.setDepthTest(U,!1):(s.setDepthTest(U,!0),s.setDepthFunc(U,this.depthTest)),this.blend){case 0:s.setBlend(U,!1);break;case 1:s.setBlend(U,!0),s.setBlendFunc(U,this.srcBlend,this.dstBlend);break;case 2:s.setBlend(U,!0)}},F._setRenderStateFrontFace=function(U,F){var O=C.mainContext,P=0;switch(this.cull){case 0:s.setCullFace(O,!1);break;case 1:s.setCullFace(O,!0),P=U?F&&F._isFrontFaceInvert?2305:2304:F&&F._isFrontFaceInvert?2304:2305,s.setFrontFace(O,P);break;case 2:s.setCullFace(O,!0),P=U?F&&F._isFrontFaceInvert?2304:2305:F&&F._isFrontFaceInvert?2305:2304,s.setFrontFace(O,P)}},F.onAsynLoaded=function(U,F,O){var P=F[0],Y=F[1];switch(P.version){case"LAYAMATERIAL:01":var c=0,L=0,u=P.props;for(var d in u)switch(d){case"vectors":var a=u[d];for(c=0,L=a.length;c<L;c++){var b=a[c],z=b.value;switch(z.length){case 2:this[b.name]=new cF(z[0],z[1]);break;case 3:this[b.name]=new LF(z[0],z[1],z[2]);break;case 4:this[b.name]=new uF(z[0],z[1],z[2],z[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var J=u[d];for(c=0,L=J.length;c<L;c++){var w=J[c],j=w.path;j&&(this[w.name]=H.getRes(Y[j]))}break;case"defines":var x=u[d];for(c=0,L=x.length;c<L;c++){var r=this._shaderCompile.getMaterialDefineByName(x[c]);this._addShaderDefine(r)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[d]=u[d];break;case"renderQueue":switch(u[d]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[d]=u[d]}break;case"LAYAMATERIAL:02":for(d in u=P.props)switch(d){case"vectors":for(c=0,L=(a=u[d]).length;c<L;c++)switch((z=(b=a[c]).value).length){case 2:this[b.name]=new cF(z[0],z[1]);break;case 3:this[b.name]=new LF(z[0],z[1],z[2]);break;case 4:this[b.name]=new uF(z[0],z[1],z[2],z[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(c=0,L=(J=u[d]).length;c<L;c++)(j=(w=J[c]).path)&&(this[w.name]=H.getRes(Y[j]));break;case"defines":for(c=0,L=(x=u[d]).length;c<L;c++)r=this._shaderCompile.getMaterialDefineByName(x[c]),this._addShaderDefine(r);break;default:this[d]=u[d]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},F._addReference=function(){P.prototype._addReference.call(this);for(var U=0,F=this._values.length;U<F;U++){var O=this._values[U];O&&O instanceof laya.d3.resource.BaseTexture&&O._addReference()}},F._removeReference=function(){P.prototype._removeReference.call(this);for(var U=0,F=this._values.length;U<F;U++){var O=this._values[U];O&&O instanceof laya.d3.resource.BaseTexture&&O._removeReference()}},F.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},F.setShaderName=function(U){var F=GF.nameKey.getID(U);if(-1===F)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=IF._preCompileShader[F]},F.cloneTo=function(U){var F=U;F.name=this.name,F.cull=this.cull,F.blend=this.blend,F.srcBlend=this.srcBlend,F.dstBlend=this.dstBlend,F.srcBlendRGB=this.srcBlendRGB,F.dstBlendRGB=this.dstBlendRGB,F.srcBlendAlpha=this.srcBlendAlpha,F.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(F.blendConstColor),F.blendEquation=this.blendEquation,F.blendEquationRGB=this.blendEquationRGB,F.blendEquationAlpha=this.blendEquationAlpha,F.depthTest=this.depthTest,F.depthWrite=this.depthWrite,F.renderQueue=this.renderQueue,F._shader=this._shader,F._disablePublicShaderDefine=this._disablePublicShaderDefine,F._shaderDefineValue=this._shaderDefineValue;var O,P=0,Y=F._shaderValues;F._shaderValues.data.length=this._shaderValues.data.length;var c=this._values.length,L=F._values;for(P=0,O=L.length=c;P<O;P++){var u=this._values[P];if(u)if("number"==typeof u)L[P]=u,Y.data[P]=u;else if("number"==typeof u&&Math.floor(u)==u)L[P]=u,Y.data[P]=u;else if("boolean"==typeof u)L[P]=u,Y.data[P]=u;else if(u instanceof laya.d3.math.Vector2){var d=L[P]||(L[P]=new cF);u.cloneTo(d),Y.data[P]=d.elements}else if(u instanceof laya.d3.math.Vector3){var a=L[P]||(L[P]=new LF);u.cloneTo(a),Y.data[P]=a.elements}else if(u instanceof laya.d3.math.Vector4){var b=L[P]||(L[P]=new uF);u.cloneTo(b),Y.data[P]=b.elements}else if(u instanceof laya.d3.math.Matrix4x4){var z=L[P]||(L[P]=new UF);u.cloneTo(z),Y.data[P]=z.elements}else u instanceof laya.d3.resource.BaseTexture&&(L[P]=u,Y.data[P]=u)}},F.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},j(0,F,"alphaTestValue",function(){return this._getNumber(0)},function(U){this._setNumber(0,U)}),j(0,F,"alphaTest",function(){return this._alphaTest},function(U){(this._alphaTest=U)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),U.__init__=function(){U.SHADERDEFINE_ALPHATEST=U.shaderDefines.registerDefine("ALPHATEST")},U.RENDERQUEUE_OPAQUE=2e3,U.RENDERQUEUE_ALPHATEST=2450,U.RENDERQUEUE_TRANSPARENT=3e3,U.CULL_NONE=0,U.CULL_FRONT=1,U.CULL_BACK=2,U.BLEND_DISABLE=0,U.BLEND_ENABLE_ALL=1,U.BLEND_ENABLE_SEPERATE=2,U.BLENDPARAM_ZERO=0,U.BLENDPARAM_ONE=1,U.BLENDPARAM_SRC_COLOR=768,U.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,U.BLENDPARAM_DST_COLOR=774,U.BLENDPARAM_ONE_MINUS_DST_COLOR=775,U.BLENDPARAM_SRC_ALPHA=770,U.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,U.BLENDPARAM_DST_ALPHA=772,U.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,U.BLENDPARAM_SRC_ALPHA_SATURATE=776,U.BLENDEQUATION_ADD=0,U.BLENDEQUATION_SUBTRACT=1,U.BLENDEQUATION_REVERSE_SUBTRACT=2,U.DEPTHTEST_OFF=0,U.DEPTHTEST_NEVER=512,U.DEPTHTEST_LESS=513,U.DEPTHTEST_EQUAL=514,U.DEPTHTEST_LEQUAL=515,U.DEPTHTEST_GREATER=516,U.DEPTHTEST_NOTEQUAL=517,U.DEPTHTEST_GEQUAL=518,U.DEPTHTEST_ALWAYS=519,U.SHADERDEFINE_ALPHATEST=1,U.ALPHATESTVALUE=0,z(U,["shaderDefines",function(){return this.shaderDefines=new bF}]),U}(r),CF=function(U){function F(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,F.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}w(F,"laya.d3.resource.BaseTexture",r);var O=F.prototype;return j(0,O,"width",function(){return this._width}),j(0,O,"repeat",function(){return this._repeat},function(U){if(this._repeat!==U&&(this._repeat=U,this._source)){var F=C.mainContext;s.bindTexture(F,this._type,this._source),X.isPOT(this._width,this._height)&&this._repeat?(F.texParameteri(this._type,10242,10497),F.texParameteri(this._type,10243,10497)):(F.texParameteri(this._type,10242,33071),F.texParameteri(this._type,10243,33071))}}),j(0,O,"height",function(){return this._height}),j(0,O,"magFifter",function(){return this._magFifter},function(U){(this._magFifter=U)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(U)}),j(0,O,"wrapModeV",function(){return this._wrapModeV}),j(0,O,"size",function(){return this._size}),j(0,O,"wrapModeU",function(){return this._wrapModeU}),j(0,O,"mipmap",function(){return this._mipmap},function(U){this._mipmap=U,this._mipmap!=U&&this._conchTexture&&this._conchTexture.setMipMap(U)}),j(0,O,"minFifter",function(){return this._minFifter},function(U){this._minFifter=U,this._minFifter!=U&&this._conchTexture&&this._conchTexture.setMinFifter(U)}),j(0,O,"format",function(){return this._format}),j(0,O,"source",function(){return this.activeResource(),this._source}),j(0,O,"defaulteTexture",function(){return _F.grayTexture}),F.WARPMODE_REPEAT=0,F.WARPMODE_CLAMP=1,F}(),sF=function(U){function F(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,F.__super.call(this),this._boundingBoxCorners=P(8,null)}w(F,"laya.d3.resource.models.BaseMesh",r);var O=F.prototype;return O._getPositions=function(){throw new Error("未Override,请重载该属性！")},O._generateBoundingObject=function(){this._boundingSphere=new WU(new LF,0),WU.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new tU(new LF,new LF),tU.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},O.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},O.getRenderElement=function(U){throw new Error("未Override,请重载该属性！")},j(0,O,"subMeshCount",function(){return this._subMeshCount}),j(0,O,"boundingBox",function(){return this._boundingBox}),j(0,O,"boundingBoxCorners",function(){return this._boundingBoxCorners}),j(0,O,"boundingSphere",function(){return this._boundingSphere}),F}(),iF=(function(U){function F(){F.__super.call(this)}w(F,"laya.d3.component.Script",QF);var O=F.prototype;O.onTriggerEnter=function(U){},O.onTriggerExit=function(U){},O.onTriggerStay=function(U){},j(0,O,"isSingleton",function(){return F._isSingleton}),F._isSingleton=!1}(),function(U){function F(U){this._owner=null,this._sharedMesh=null,F.__super.call(this),this._owner=U}w(F,"laya.d3.core.MeshFilter",U);var O=F.prototype;return O._sharedMeshLoaded=function(){this.event("loaded")},O._destroy=function(){U.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},j(0,O,"sharedMesh",function(){return this._sharedMesh},function(U){var F=this._sharedMesh;F&&F._removeReference(),(this._sharedMesh=U)._addReference(),this.event("meshchanged",[this,F,U]),U.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),j(0,O,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),j(0,O,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),j(0,O,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),j(0,O,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),F}(XF)),yF=function(U){function F(U){F.__super.call(this,U),U.meshFilter.on("meshchanged",this,this._onMeshChanged)}w(F,"laya.d3.core.MeshRender",NF);var O=F.prototype;return O._onMeshChanged=function(U,F,O){O.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:O.once("loaded",this,this._onMeshLoaed)},O._onMeshLoaed=function(U,F){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},O._calculateBoundingSphereByInitSphere=function(U){var F=NaN,O=this._owner.transform,P=O.scale.elements,Y=Math.abs(P[0]),c=Math.abs(P[1]),L=Math.abs(P[2]);F=c<=Y&&L<=Y?Y:L<=c?c:L,LF.transformCoordinate(U.center,O.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=U.radius*F},O._calculateBoundBoxByInitCorners=function(U){for(var F=this._owner.transform.worldMatrix,O=0;O<8;O++)LF.transformCoordinate(U[O],F,NF._tempBoundBoxCorners[O]);tU.createfromPoints(NF._tempBoundBoxCorners,this._boundingBox)},O._calculateBoundingSphere=function(){var U=this._owner.meshFilter.sharedMesh;null==U||null==U.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(U.boundingSphere)},O._calculateBoundingBox=function(){var U=this._owner.meshFilter.sharedMesh;null==U||null==U.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(U.boundingBoxCorners)},O._renderUpdate=function(U){var F=this._owner.transform;if(F){this._setShaderValueMatrix4x4(0,F.worldMatrix);var O=this._owner.getProjectionViewWorldMatrix(U);this._setShaderValueMatrix4x4(1,O)}else this._setShaderValueMatrix4x4(0,UF.DEFAULT),this._setShaderValueMatrix4x4(1,U);return HF.debugMode&&this._renderRenderableBoundBox(),!0},F}(),kF=function(F){function P(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,P.__super.call(this),this._renderState=new n,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new JF,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new FU,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new LF(.7,.7,.7),this.ambientColor=new LF(.212,.227,.259),C.shaderHighPrecision&&this.addShaderDefine(IF.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}w(P,"laya.d3.core.scene.Scene",F);var U=P.prototype;return N.imps(U,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),U._setUrl=function(U){this._url=U},U._getGroup=function(){return this._group},U._setGroup=function(U){this._group=U},U._display=function(){N.stage._scenes.push(this),N.stage._scenes.sort(P._sortScenes);for(var U=0,F=this._childs.length;U<F;U++){var O=this._childs[U];O.active&&O._activeHierarchy()}},U._unDisplay=function(){var U=N.stage._scenes;U.splice(U.indexOf(this),1);for(var F=0,O=this._childs.length;F<O;F++){var P=this._childs[F];P.active&&P._inActiveHierarchy()}},U._addChild3D=function(U){U.transform._onWorldTransform(),U._setBelongScene(this),this.displayedInStage&&U.active&&U._activeHierarchy()},U._removeChild3D=function(U){U.transform.parent=null,this.displayedInStage&&U.active&&U._inActiveHierarchy(),U._setUnBelongScene()},U.initOctree=function(U,F,O,P,Y){void 0===Y&&(Y=6),this.treeSize=new LF(U,F,O),this.treeLevel=Y,this.treeRoot=new t(this,0),this.treeRoot.init(P,this.treeSize)},U._prepareUpdateToRenderState=function(U,F){F.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,F.scene=this},U._prepareSceneToRender=function(U){var F=this._lights.length;if(0<F)for(var O=0,P=0;P<F&&!(this._lights[P]._prepareToScene(U)&&++O>=this._enableLightCount);P++);},U._updateChilds=function(U){for(var F=0,O=this._childs.length;F<O;++F)this._childs[F]._update(U)},U._preRenderScene=function(U,F,O){var P,Y=F._viewMatrix,c=F._projectionMatrix,L=F._projectionViewMatrix,u=0,d=F.camera;for(d.useOcclusionCulling?this.treeRoot?OU.renderObjectCullingOctree(O,this,d,Y,c,L):OU.renderObjectCulling(O,this,d,Y,c,L):OU.renderObjectCullingNoBoundFrustum(this,d,Y,c,L),u=0,P=this._quenes.length;u<P;u++)this._quenes[u]&&this._quenes[u]._preRender(F)},U._clear=function(U,F){var O=F._viewport,P=F.camera,Y=O.x,c=P.renderTargetSize.height-O.y-O.height,L=O.width,u=O.height;U.viewport(Y,c,L,u);var d=256,a=P.renderTarget;switch(P.clearFlag){case 0:var b=P.clearColor;if(b){U.enable(3089),U.scissor(Y,c,L,u);var z=b.elements;U.clearColor(z[0],z[1],z[2],z[3]),d|=16384}if(a)switch(b||(d=16384),a.depthStencilFormat){case 33189:d|=256;break;case 36168:d|=1024;break;case 34041:d|=256,d|=1024}U.clear(d),b&&U.disable(3089);break;case 1:case 2:if(a)switch(d=16384,a.depthStencilFormat){case 33189:d|=256;break;case 36168:d|=1024;break;case 34041:d|=256,d|=1024}U.clear(d);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},U._renderScene=function(U,F){var O,P,Y=F.camera,c=0;for(c=0;c<2;c++)(P=this._quenes[c])&&(Y.renderTarget?P._render(F,!0):P._render(F,!1));if(1===Y.clearFlag){var L=Y.sky;L&&(s.setCullFace(U,!1),s.setDepthFunc(U,515),s.setDepthMask(U,!1),L._render(F),s.setDepthFunc(U,513),s.setDepthMask(U,!0))}for(c=2,O=this._quenes.length;c<O;c++)(P=this._quenes[c])&&(P._sortAlpha(F.camera.transform.position),Y.renderTarget?P._render(F,!0):P._render(F,!1))},U._set3DRenderConfig=function(U){U.disable(3042),s._blend=!1,U.blendFunc(770,771),s._sFactor=770,s._dFactor=771,U.disable(2929),s._depthTest=!1,U.enable(2884),s._cullFace=!0,U.depthMask(1),s._depthMask=!0,U.frontFace(2304),s._frontFace=2304},U._set2DRenderConfig=function(U){s.setBlend(U,!0),s.setBlendFunc(U,1,771),s.setDepthTest(U,!1),s.setCullFace(U,!1),s.setDepthMask(U,!0),s.setFrontFace(U,2305),U.viewport(0,0,b.width,b.height)},U._parseCustomProps=function(U,F,O,P){var Y=P.customProps.lightmaps,c=Y.length,L=this._lightmaps;L.length=c;for(var u=0;u<c;u++)L[u]=H.getRes(F[Y[u].replace(".exr",".png")]);this.setlightmaps(L);var d=P.customProps.ambientColor;d&&(this.ambientColor=new LF(d[0],d[1],d[2]));var a=P.customProps.fogColor;a&&(this.fogColor=new LF(a[0],a[1],a[2]))},U._addLight=function(U){this._lights.indexOf(U)<0&&this._lights.push(U)},U._removeLight=function(U){var F=this._lights.indexOf(U);0<=F&&this._lights.splice(F,1)},U._updateScene=function(){var U=this._renderState;this._prepareUpdateToRenderState(C.mainContext,U),this._updateComponents(U),this._updateChilds(U),this._lateUpdateComponents(U),this._time+=U.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},U._updateSceneConch=function(){var U=this._renderState;this._prepareUpdateToRenderState(C.mainContext,U),this._updateComponents(U),this._lateUpdateComponents(U),this._prepareSceneToRender(U);for(var F=0,O=this._cameraPool.length;F<O;F++){var P=this._cameraPool[F];(U.camera=P)._prepareCameraToRender()}},U._preRenderShadow=function(U,F,O,P,Y){this.treeRoot?OU.renderShadowObjectCullingOctree(this,F,O,P,Y):OU.renderShadowObjectCulling(this,F,O,P,Y);for(var c=0,L=O.length;c<L;c++)O[c]&&O[c]._preRender(U)},U._renderShadowMap=function(U,F,O){var P=this.parallelSplitShadowMaps[0];P._calcAllLightCameraInfo(O);var Y,c,L,u=P.PSSMNum;if(this._preRenderShadow(F,P._lightCulling,P._shadowQuenes,P._lightVPMatrix[0],u),this.addShaderDefine(wF.SHADERDEFINE_CAST_SHADOW),1<u)for(var d=0;d<u;d++)Y=P.getRenderTarget(d+1),P.beginRenderTarget(d+1),U.clearColor(1,1,1,1),U.clear(16640),U.viewport(0,0,Y.width,Y.height),F.camera=L=P.getLightCamera(d),L._prepareCameraToRender(),L._prepareCameraViewProject(L.viewMatrix,L.projectionMatrix),F._projectionViewMatrix=P._lightVPMatrix[d+1],(c=P._shadowQuenes[d])._preRender(F),c._renderShadow(F,!1),P.endRenderTarget(d+1);else Y=P.getRenderTarget(1),P.beginRenderTarget(1),U.clearColor(1,1,1,1),U.clear(16640),U.viewport(0,0,Y.width,Y.height),F.camera=L=P.getLightCamera(0),L._prepareCameraToRender(),L._prepareCameraViewProject(L.viewMatrix,L.projectionMatrix),F._projectionViewMatrix=P._lightVPMatrix[0],(c=P._shadowQuenes[0])._preRender(F),c._renderShadow(F,!0),P.endRenderTarget(1);this.removeShaderDefine(wF.SHADERDEFINE_CAST_SHADOW)},U.addTreeNode=function(U){this.treeRoot.addTreeNode(U)},U.removeTreeNode=function(U){this.treeSize&&U._treeNode&&U._treeNode.removeObject(U)},U.setlightmaps=function(U){this._lightmaps=U;for(var F=0,O=this._renderableSprite3Ds.length;F<O;F++)this._renderableSprite3Ds[F]._render._applyLightMapParams()},U.getlightmaps=function(){return this._lightmaps},U.addChildAt=function(U,F){if(!(U instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(U&&U.__className));if(!U||this.destroyed||U===this)return U;if(U.zOrder&&this._set$P("hasZorder",!0),0<=F&&F<=this._childs.length){if(U._parent===this){var O=this.getChildIndex(U);this._childs.splice(O,1),this._childs.splice(F,0,U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,F)),this._childChanged()}else U.parent&&U.parent.removeChild(U),this._childs===a.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(F,0,U),this.conchModel&&this.conchModel.addChildAt(U.conchModel,F),(U.parent=this)._addChild3D(U);return U}throw new Error("appendChildAt:The index is out of bounds")},U.addChild=function(U){if(!(U instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!U||this.destroyed||U===this)return U;if(U.zOrder&&this._set$P("hasZorder",!0),U._parent===this){var F=this.getChildIndex(U);F!==this._childs.length-1&&(this._childs.splice(F,1),this._childs.push(U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,this._childs.length-1)),this._childChanged())}else U.parent&&U.parent.removeChild(U),this._childs===a.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(U),this.conchModel&&this.conchModel.addChildAt(U.conchModel,this._childs.length-1),(U.parent=this)._childChanged(),this._addChild3D(U);return U},U.removeChildAt=function(U){var F=this.getChildAt(U);return F&&(this._removeChild3D(F),this._childs.splice(U,1),this.conchModel&&this.conchModel.removeChild(F.conchModel),F.parent=null),F},U.removeChildren=function(U,F){if(void 0===U&&(U=0),void 0===F&&(F=2147483647),this._childs&&0<this._childs.length){var O=this._childs;if(0===U&&c<=F){var P=O;this._childs=a.ARRAY_EMPTY}else P=O.splice(U,F-U);for(var Y=0,c=P.length;Y<c;Y++)this._removeChild3D(P[Y]),P[Y].parent=null,this.conchModel&&this.conchModel.removeChild(P[Y].conchModel)}return this},U.addFrustumCullingObject=function(U){this.treeRoot?this.addTreeNode(U):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(U):this._cullingRenders[this._cullingRendersLength]=U,U._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},U.removeFrustumCullingObject=function(U){if(this.treeRoot)this.removeTreeNode(U);else{this._cullingRendersLength--;var F=U._indexInSceneFrustumCullingObjects;if(F!==this._cullingRendersLength){var O=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[F]=O)._indexInSceneFrustumCullingObjects=F,U._indexInSceneFrustumCullingObjects=-1}}},U.getRenderQueue=function(U){return U<3e3?this._quenes[1]||(this._quenes[1]=new v(this)):this._quenes[2]||(this._quenes[2]=new v(this))},U.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new v(this)},U.addShaderDefine=function(U){this._shaderDefineValue|=U},U.removeShaderDefine=function(U){this._shaderDefineValue&=~U},U.addScript=function(U){return this._addComponent(U)},U.getScriptByType=function(U,F){return void 0===F&&(F=0),this._getComponentByType(U,F)},U.getScriptsByType=function(U,F){this._getComponentsByType(U,F)},U.getScriptByIndex=function(U){return this._getComponentByIndex(U)},U.removeScriptByType=function(U,F){void 0===F&&(F=0),this._removeComponentByType(U,F)},U.removeScriptsByType=function(U){this._removeComponentByType(U)},U.removeAllScript=function(){this._removeAllComponent()},U.render=function(U,F,O){(x._context.ctx._renderKey=0)<this._childs.length&&U.addRenderObject(this)},U.renderSubmit=function(){var U=C.mainContext,F=this._renderState;this._set3DRenderConfig(U),this._prepareSceneToRender(this._renderState);var O,P=0,Y=0;if(HF.debugMode||t.debugMode)for(P=0,Y=this._cameraPool.length;P<Y;P++)O=this._cameraPool[P],HF._debugPhasorSprite.begin(1,O),O.activeInHierarchy&&O._renderCamera(U,F,this),HF._debugPhasorSprite.end();else for(P=0,Y=this._cameraPool.length;P<Y;P++)(O=this._cameraPool[P]).activeInHierarchy&&O._renderCamera(U,F,this);return this._set2DRenderConfig(U),1},U.onAsynLoaded=function(U,F,O){var P=F[0];if("Scene"!==P.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var Y=F[1];rF._createNodeByJson(this,P,this,Y),this.event("hierarchyloaded",[this]),this.__loaded=!0},U.destroy=function(U){void 0===U&&(U=!0),this.destroyed||(F.prototype.destroy.call(this,U),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,H.clearRes(this.url),this.loaded||HF._cancelLoadByUrl(this.url))},U.getRenderType=function(){return 0},U.releaseRender=function(){},U._addComponent=function(U){var F,O=this._componentsMap.indexOf(U);if(-1===O)F=[],this._componentsMap.push(U),this._typeComponentsIndices.push(F);else if(F=this._typeComponentsIndices[O],this._components[F[0]].isSingleton)throw new Error("无法单实例创建"+U+"组件，"+U+"组件已存在！");var P=Y.getInstance(U);F.push(this._components.length),this._components.push(P);return P._initialize(this),P},U._removeComponent=function(U,F){var O=this._typeComponentsIndices[U],P=O[F],Y=this._components[P];this._components.splice(P,1),O.splice(F,1),0===O.length&&(this._typeComponentsIndices.splice(U,1),this._componentsMap.splice(U,1));for(var c=0,L=this._componentsMap.length;c<L;c++)for(var u=(O=this._typeComponentsIndices[c]).length-1;0<=u;u--){var d=O[u];if(!(P<d))break;O[u]=--d}Y._destroy()},U._getComponentByType=function(U,F){void 0===F&&(F=0);var O=this._componentsMap.indexOf(U);return-1===O?null:this._components[this._typeComponentsIndices[O][F]]},U._getComponentsByType=function(U,F){var O=this._componentsMap.indexOf(U);if(-1!==O){var P=this._typeComponentsIndices[O],Y=P.length;F.length=Y;for(var c=0;c<Y;c++)F[c]=this._components[P[c]]}else F.length=0},U._getComponentByIndex=function(U){return this._components[U]},U._removeComponentByType=function(U,F){void 0===F&&(F=0);var O=this._componentsMap.indexOf(U);-1!==O&&this._removeComponent(O,F)},U._removeComponentsByType=function(U){var F=this._componentsMap.indexOf(U);if(-1!==F)for(var O=this._typeComponentsIndices[F],P=0,Y=O.length;P<Y;O.length<Y?Y--:P++)this._removeComponent(F,P)},U._removeAllComponent=function(){for(var U=0,F=this._componentsMap.length;U<F;this._componentsMap.length<F?F--:U++)this._removeComponentsByType(this._componentsMap[U])},U._updateComponents=function(U){for(var F=0,O=this._components.length;F<O;F++){var P=this._components[F];!P.started&&(P._start(U),P.started=!0),P.enable&&P._update(U)}},U._lateUpdateComponents=function(U){for(var F=0;F<this._components.length;F++){var O=this._components[F];!O.started&&(O._start(U),O.started=!0),O.enable&&O._lateUpdate(U)}},U._preRenderUpdateComponents=function(U){for(var F=0;F<this._components.length;F++){var O=this._components[F];!O.started&&(O._start(U),O.started=!0),O.enable&&O._preRenderUpdate(U)}},U._postRenderUpdateComponents=function(U){for(var F=0;F<this._components.length;F++){var O=this._components[F];!O.started&&(O._start(U),O.started=!0),O.enable&&O._postRenderUpdate(U)}},j(0,U,"_loaded",null,function(U){this.__loaded=U}),j(0,U,"fogColor",function(){return this._fogColor},function(U){this._fogColor=U,this._shaderValues.setValue(0,U.elements)}),j(0,U,"enableFog",function(){return this._enableFog},function(U){this._enableFog!==U&&((this._enableFog=U)?(this.addShaderDefine(IF.SHADERDEFINE_FOG),this.removeShaderDefine(IF.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(IF.SHADERDEFINE_FOG))}),j(0,U,"url",function(){return this._url}),j(0,U,"loaded",function(){return this.__loaded}),j(0,U,"enableDepthFog",function(){return this._enableDepthFog},function(U){this._enableDepthFog!=U&&((this._enableDepthFog=U)?(this.addShaderDefine(IF.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(IF.SHADERDEFINE_FOG)):this.removeShaderDefine(IF.SAHDERDEFINE_DEPTHFOG))}),j(0,U,"fogStart",function(){return this._fogStart},function(U){this._fogStart=U,this._shaderValues.setValue(1,U)}),j(0,U,"fogRange",function(){return this._fogRange},function(U){this._fogRange=U,this._shaderValues.setValue(2,U)}),j(0,U,"ambientColor",function(){return this._ambientColor},function(U){this._ambientColor=U,this._shaderValues.setValue(21,U.elements)}),j(0,U,"scene",function(){return this}),j(0,U,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),P._sortScenes=function(U,F){if(U.parent!==N.stage||F.parent!==N.stage)return U.parent!==N.stage&&F.parent!==N.stage?P._sortScenes(U.parent,F.parent):U.parent===N.stage?-1:1;var O=N.stage._childs;return O.indexOf(U)-O.indexOf(F)},P.load=function(U){return N.loader.create(U,null,null,P)},P.FOGCOLOR=0,P.FOGSTART=1,P.FOGRANGE=2,P.LIGHTDIRECTION=3,P.LIGHTDIRCOLOR=4,P.POINTLIGHTPOS=5,P.POINTLIGHTRANGE=6,P.POINTLIGHTATTENUATION=7,P.POINTLIGHTCOLOR=8,P.SPOTLIGHTPOS=9,P.SPOTLIGHTDIRECTION=10,P.SPOTLIGHTSPOT=11,P.SPOTLIGHTRANGE=12,P.SPOTLIGHTATTENUATION=13,P.SPOTLIGHTCOLOR=14,P.SHADOWDISTANCE=15,P.SHADOWLIGHTVIEWPROJECT=16,P.SHADOWMAPPCFOFFSET=17,P.SHADOWMAPTEXTURE1=18,P.SHADOWMAPTEXTURE2=19,P.SHADOWMAPTEXTURE3=20,P.AMBIENTCOLOR=21,P.TIME=22,P}(f),AF=function(U){function F(U){F.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new UF,this._shaderValues=new JF,this._colliders=[],this._id=++F._uniqueIDCounter,this._transform=new KF(this),this.name=U||"Sprite3D-"+F._nameNumberCounter++,this.layer=y.currentCreationLayer,this.active=!0}w(F,"laya.d3.core.Sprite3D",lF);var O=F.prototype;return N.imps(O,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),O._setUrl=function(U){this._url=U},O._getGroup=function(){return this._group},O._setGroup=function(U){this._group=U},O._addChild3D=function(U){U.transform.parent=this.transform,this._hierarchyAnimator&&(!U._hierarchyAnimator&&U._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(U,!0,[U.name])),this._scene&&(U._setBelongScene(this._scene),this._activeInHierarchy&&U._active&&U._activeHierarchy())},O._removeChild3D=function(U){U.transform.parent=null,this._scene&&(this._activeInHierarchy&&U._active&&U._inActiveHierarchy(),U._setUnBelongScene()),this._hierarchyAnimator&&(U._hierarchyAnimator==this._hierarchyAnimator&&U._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(U,!1,[U.name]))},O._parseBaseCustomProps=function(U){var F=this.transform.localPosition;U.translate?(F.fromArray(U.translate),F.x*=100,F.y*=100,F.z*=100):F.elements.fill(0),this.transform.localPosition=F;var O=this.transform.localRotation;U.rotation?O.fromArray(U.rotation):O.fromArray([0,0,0,-1]),this.transform.localRotation=O;var P=this.transform.localScale;U.scale?P.fromArray(U.scale):P.elements.fill(1),this.transform.localScale=P;var Y=U.layer;null!=Y&&(this.layer=y.getLayerByNumber(Y))},O._parseCustomComponent=function(U,F,O){for(var P in O){var Y=O[P];switch(P){case"Animator":var c=this.addComponent(Animator);if(Y.avatarPath)c.avatar=H.getRes(F[Y.avatarPath]);else{var L=Y.avatar;if(L){c.avatar=H.getRes(F[L.path]);var u=L.linkSprites;u&&U.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[c,u])}}for(var d=Y.clipPaths,a=d.length,b=0;b<a;b++)c.addClip(H.getRes(F[d[b]]));c.clip=H.getRes(F[d[0]]);var z=Y.playOnWake;void 0!==z&&(c.playOnWake=z);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var J=this.addComponent(SphereCollider);J.isTrigger=Y.isTrigger;var w=J.center;w.fromArray(Y.center),J.center=w,J.radius=Y.radius;break;case"BoxCollider":var j=this.addComponent(BoxCollider);j.isTrigger=Y.isTrigger,j.center.fromArray(Y.center);var x=j.size;x.fromArray(Y.size),j.size=x;break;case"MeshCollider":this.addComponent(MeshCollider)}}},O._onRootNodeHierarchyLoaded=function(U,F){for(var O in F){for(var P=this,Y=F[O],c=0,L=Y.length;c<L;c++){var u=Y[c];if(""===u)break;if(!(P=P.getChildByName(u)))break}P&&U.linkSprite3DToAvatarNode(O,P)}},O._setHierarchyAnimator=function(U,F){this._changeHierarchyAnimator(U);for(var O=0,P=this._childs.length;O<P;O++){var Y=this._childs[O];Y._hierarchyAnimator==F&&Y._setHierarchyAnimator(U,F)}},O._clearHierarchyAnimator=function(U,F){this._changeHierarchyAnimator(F);for(var O=0,P=this._childs.length;O<P;O++){var Y=this._childs[O];Y._hierarchyAnimator==U&&Y._clearHierarchyAnimator(U,F)}},O._getAnimatorToLinkSprite3D=function(U,F,O){var P=this.getComponentByType(Animator);if(P&&(P.avatar?P.avatar._version||U._setAnimatorToLinkAvatar(P,F):U._setAnimatorToLinkSprite3DNoAvatar(P,F,O)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){O.unshift(this._parent.name);var Y=this._parent;Y._hierarchyAnimator&&Y._getAnimatorToLinkSprite3D(U,F,O)}},O._setAnimatorToLinkSprite3DNoAvatar=function(U,F,O){var P=0,Y=0;for(P=0,Y=U.getClipCount();P<Y;P++)U._handleSpriteOwnersBySprite(P,F,O,this);for(P=0,Y=this._childs.length;P<Y;P++){var c=this._childs[P],L=O.length;O.push(c.name),c._setAnimatorToLinkSprite3DNoAvatar(U,F,O),O.splice(L,1)}},O._changeHierarchyAnimator=function(U){this._hierarchyAnimator=U},O._isLinkSpriteToAnimationNode=function(U,F,O){var P=U._avatarNodes.indexOf(F),Y=U._cacheSpriteToNodesMap;if(O)this._transform.dummy=F.transform,U._cacheNodesToSpriteMap[P]=Y.length,Y.push(P);else{this._transform.dummy=null;var c=U._cacheNodesToSpriteMap[P];U._cacheNodesToSpriteMap[P]=null,Y.splice(c,1)}},O._setBelongScene=function(U){this._scene=U;for(var F=0,O=this._childs.length;F<O;F++)this._childs[F]._setBelongScene(U)},O._setUnBelongScene=function(){this._scene=null;for(var U=0,F=this._childs.length;U<F;U++)this._childs[U]._setUnBelongScene()},O._activeHierarchy=function(){var U=0,F=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),U=0,F=this._colliders.length;U<F;U++)this._layer._addCollider(this._colliders[U]);for(this.event("activeinhierarchychanged",!0),U=0,F=this._childs.length;U<F;U++){var O=this._childs[U];O._active&&O._activeHierarchy()}},O._inActiveHierarchy=function(){var U=0,F=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),U=0,F=this._colliders.length;U<F;U++){var O=this._colliders[U];O._clearCollsionMap(),this._layer._removeCollider(O)}for(this.event("activeinhierarchychanged",!1),U=0,F=this._childs.length;U<F;U++){var P=this._childs[U];P._active&&P._inActiveHierarchy()}},O.addComponent=function(U){var F,O=this._componentsMap.indexOf(U);if(-1===O)F=[],this._componentsMap.push(U),this._typeComponentsIndices.push(F);else if(F=this._typeComponentsIndices[O],this._components[F[0]].isSingleton)throw new Error("无法单实例创建"+U+"组件，"+U+"组件已存在！");var P=Y.getInstance(U);return F.push(this._components.length),this._components.push(P),P instanceof laya.d3.component.Script&&this._scripts.push(P),P._initialize(this),P},O._removeComponent=function(U,F){var O,P=0,Y=this._typeComponentsIndices[U],c=Y[F],L=this._components[c];for(L instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(L),1),Y.splice(F,1),0===Y.length&&(this._typeComponentsIndices.splice(U,1),this._componentsMap.splice(U,1)),P=0,O=this._componentsMap.length;P<O;P++)for(var u=(Y=this._typeComponentsIndices[P]).length-1;0<=u;u--){var d=Y[u];if(!(c<d))break;Y[u]=--d}L._destroy()},O._clearSelfRenderObjects=function(){},O._addSelfRenderObjects=function(){},O._parseCustomProps=function(U,F,O,P){},O._updateChilds=function(U){var F=this._childs.length;if(0!==F)for(var O=0;O<F;++O)this._childs[O]._update(U)},O._getSortID=function(U,F){return 1e3*F.id+U._getVertexBuffer().vertexDeclaration.id},O._update=function(U){(U.owner=this)._activeInHierarchy&&(this._updateComponents(U),this._lateUpdateComponents(U),I.spriteCount++,this._childs.length&&this._updateChilds(U))},O.getProjectionViewWorldMatrix=function(U){return UF.multiply(U,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},O.loadHierarchy=function(U){this.addChild(laya.d3.core.Sprite3D.load(U))},O.addChildAt=function(U,F){if(!(U instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!U||this.destroyed||U===this)return U;if(U.zOrder&&this._set$P("hasZorder",!0),0<=F&&F<=this._childs.length){if(U._parent===this){var O=this.getChildIndex(U);this._childs.splice(O,1),this._childs.splice(F,0,U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,F)),this._childChanged()}else U.parent&&U.parent.removeChild(U),this._childs===a.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(F,0,U),this.conchModel&&this.conchModel.addChildAt(U.conchModel,F),(U.parent=this)._addChild3D(U);return U}throw new Error("appendChildAt:The index is out of bounds")},O.addChild=function(U){if(!(U instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!U||this.destroyed||U===this)return U;if(U.zOrder&&this._set$P("hasZorder",!0),U._parent===this){var F=this.getChildIndex(U);F!==this._childs.length-1&&(this._childs.splice(F,1),this._childs.push(U),this.conchModel&&(this.conchModel.removeChild(U.conchModel),this.conchModel.addChildAt(U.conchModel,this._childs.length-1)),this._childChanged())}else U.parent&&U.parent.removeChild(U),this._childs===a.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(U),this.conchModel&&this.conchModel.addChildAt(U.conchModel,this._childs.length-1),(U.parent=this)._childChanged(),this._addChild3D(U);return U},O.removeChildAt=function(U){var F=this.getChildAt(U);return F&&(this._removeChild3D(F),this._childs.splice(U,1),this.conchModel&&this.conchModel.removeChild(F.conchModel),F.parent=null),F},O.removeChildren=function(U,F){if(void 0===U&&(U=0),void 0===F&&(F=2147483647),this._childs&&0<this._childs.length){var O=this._childs;if(0===U&&c<=F){var P=O;this._childs=a.ARRAY_EMPTY}else P=O.splice(U,F-U);for(var Y=0,c=P.length;Y<c;Y++)this._removeChild3D(P[Y]),P[Y].parent=null,this.conchModel&&this.conchModel.removeChild(P[Y].conchModel)}return this},O.onAsynLoaded=function(U,F,O){var P=F[0];if("Sprite3D"!==P.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var Y=F[1];rF._createNodeByJson(this,P,this,Y),this.event("hierarchyloaded",[this]),this.__loaded=!0},O.cloneTo=function(U){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var F=U;F.name=this.name,F._destroyed=this._destroyed,F.timer=this.timer,F._$P=this._$P,F.active=this._active;var O=F.transform.localPosition;this.transform.localPosition.cloneTo(O),F.transform.localPosition=O;var P=F.transform.localRotation;this.transform.localRotation.cloneTo(P),F.transform.localRotation=P;var Y=F.transform.localScale;this.transform.localScale.cloneTo(Y),F.transform.localScale=Y,F.isStatic=this.isStatic;var c=0,L=0;for(c=0,L=this._componentsMap.length;c<L;c++){var u=F.addComponent(this._componentsMap[c]);this._components[c]._cloneTo(u)}for(c=0,L=this._childs.length;c<L;c++)F.addChild(this._childs[c].clone());var d=F.getComponentByType(Animator);if(d){var a=d._linkSpritesData;if(a)for(var b in a){for(var z=a[b],J=F,w=0,j=z.length;w<j&&(J=J.getChildByName(z[w]));w++);if(J){var x=d._avatarNodeMap[b];J._isLinkSpriteToAnimationNode(d,x,!0)}}}},O.clone=function(){var U=new this.constructor;return this.cloneTo(U),U},O.destroy=function(U){if(void 0===U&&(U=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,U);var F,O=0;for(O=0,F=this._components.length;O<F;O++)this._components[O]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,H.clearRes(this.url),this.loaded||HF._cancelLoadByUrl(this.url)}},O._handleSpriteToAvatar=function(U,F){U._avatarNodes;var O=U._avatarNodeMap[this.name];O&&O.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(U,O,F)},O._setAnimatorToLinkAvatar=function(U,F){this._handleSpriteToAvatar(U,F);for(var O=0,P=this._childs.length;O<P;O++){this._childs[O]._setAnimatorToLinkAvatar(U,F)}},j(0,O,"activeInHierarchy",function(){return this._activeInHierarchy}),j(0,O,"_loaded",null,function(U){this.__loaded=U}),j(0,O,"active",function(){return this._active},function(U){this._active!==U&&(this._active=U,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(U?this._activeHierarchy():this._inActiveHierarchy()))}),j(0,O,"componentsCount",function(){return this._components.length}),j(0,O,"loaded",function(){return this.__loaded}),j(0,O,"id",function(){return this._id}),j(0,O,"url",function(){return this._url}),j(0,O,"layer",function(){return this._layer},function(U){if(this._layer!==U){if(!U)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var F=0,O=this._colliders.length;if(this._layer)for(F=0;F<O;F++)this._layer._removeCollider(this._colliders[F]);for(F=0;F<O;F++)U._addCollider(this._colliders[F])}this._layer=U,this.event("layerchanged",U)}}),j(0,O,"scene",function(){return this._scene}),j(0,O,"transform",function(){return this._transform}),F.instantiate=function(U,F,O,P,Y){void 0===O&&(O=!0);var c=U.clone();F&&F.addChild(c);var L=c.transform;if(O){var u=L.worldMatrix;U.transform.worldMatrix.cloneTo(u),L.worldMatrix=u}else P&&(L.position=P),Y&&(L.rotation=Y);return c},F.load=function(U){return N.loader.create(U,null,null,F)},F.WORLDMATRIX=0,F.MVPMATRIX=1,F._uniqueIDCounter=0,F._nameNumberCounter=0,F}(),GF=function(U){function b(U,F,O,P,Y,c,L,u,d,a){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],b.__super.call(this),!U||!F)throw"Shader Error";this._id=++b._count,this._vs=U,this._ps=F,this._attributeMap=O,this._sceneUniformMap=P,this._cameraUniformMap=Y,this._spriteUniformMap=c,this._materialUniformMap=L,this._renderElementUniformMap=u,this._precompile=d,this._define=a,this._precompile&&b.extCompileObj&&b.extCompileFunc?b.extCompileFunc.call(b.extCompileObj,U,F,a):this.recreateResource()}w(b,"laya.d3.shader.Shader3D",O);var F=b.prototype;return F.recreateResource=function(){i.now();this._compile(),this.completeCreate(),this.memorySize=0},F.disposeResource=function(){C.mainContext.deleteShader(this._vshader),C.mainContext.deleteShader(this._pshader),C.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},F._compile=function(){if(!C.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var U=[this._vs,this._ps],F=C.mainContext;if(this._program=F.createProgram(),this._vshader=b._createShader(F,U[0],35633),this._pshader=b._createShader(F,U[1],35632),F.attachShader(this._program,this._vshader),F.attachShader(this._program,this._pshader),F.linkProgram(this._program),!x.isConchApp&&IF.debugMode&&!F.getProgramParameter(this._program,35714))throw F.getProgramInfoLog(this._program);var O,P=0,Y=0,c=0;for(c=x.isConchApp?F.getProgramParameterEx(this._vs,this._ps,"",35721):F.getProgramParameter(this._program,35721),P=0;P<c;P++){var L=null;O={vartype:"attribute",ivartype:0,attrib:L=x.isConchApp?F.getActiveAttribEx(this._vs,this._ps,"",P):F.getActiveAttrib(this._program,P),location:F.getAttribLocation(this._program,L.name),name:L.name,type:L.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(O)}var u=0;for(u=x.isConchApp?F.getProgramParameterEx(this._vs,this._ps,"",35718):F.getProgramParameter(this._program,35718),P=0;P<u;P++){var d=null;d=x.isConchApp?F.getActiveUniformEx(this._vs,this._ps,"",P):F.getActiveUniform(this._program,P),0<(O={vartype:"uniform",ivartype:1,attrib:L,location:F.getUniformLocation(this._program,d.name),name:d.name,type:d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(O.name=O.name.substr(0,O.name.length-3),O.isArray=!0,O.location=F.getUniformLocation(this._program,O.name)),this._uniformParams.push(O)}for(P=0,Y=this._attributeParams.length;P<Y;P++)(O=this._attributeParams[P]).indexOfParams=P,O.index=1,O.value=[O.location,null],O.codename=O.name,O.name=null!=this._attributeMap[O.codename]?this._attributeMap[O.codename]:O.codename,this._attributeParamsMap.push(O.name),this._attributeParamsMap.push(O),O._this=this,O.uploadedValue=[],O.fun=this._attribute;for(P=0,Y=this._uniformParams.length;P<Y;P++)switch((O=this._uniformParams[P]).indexOfParams=P,O.index=1,O.value=[O.location,null],O.codename=O.name,null!=this._sceneUniformMap[O.codename]?(O.name=this._sceneUniformMap[O.codename],this._sceneUniformParamsMap.push(O.name),this._sceneUniformParamsMap.push(O)):null!=this._cameraUniformMap[O.codename]?(O.name=this._cameraUniformMap[O.codename],this._cameraUniformParamsMap.push(O.name),this._cameraUniformParamsMap.push(O)):null!=this._spriteUniformMap[O.codename]?(O.name=this._spriteUniformMap[O.codename],this._spriteUniformParamsMap.push(O.name),this._spriteUniformParamsMap.push(O)):null!=this._materialUniformMap[O.codename]?(O.name=this._materialUniformMap[O.codename],this._materialUniformParamsMap.push(O.name),this._materialUniformParamsMap.push(O)):null!=this._renderElementUniformMap[O.codename]?(O.name=this._renderElementUniformMap[O.codename],this._renderElementUniformParamsMap.push(O.name),this._renderElementUniformParamsMap.push(O)):console.log("Shader:can't find uinform name:"+O.codename+" in shader file."),O._this=this,O.uploadedValue=[],O.type){case 5124:O.fun=O.isArray?this._uniform1iv:this._uniform1i;break;case 5126:O.fun=O.isArray?this._uniform1fv:this._uniform1f;break;case 35664:O.fun=O.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:O.fun=O.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:O.fun=O.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:O.fun=this._uniform_sampler2D;break;case 35680:O.fun=this._uniform_samplerCube;break;case 35676:O.fun=this._uniformMatrix4fv;break;case 35670:O.fun=this._uniform1i;break;case 35674:O.fun=this._uinformMatrix2fv;break;case 35675:O.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},F._attribute=function(U,F){var O=C.mainContext,P=u._enableAtributes,Y=U.location;return P[Y]||O.enableVertexAttribArray(Y),O.vertexAttribPointer(Y,F[0],F[1],F[2],F[3],F[4]),P[Y]=u._bindVertexBuffer,1},F._uniform1f=function(U,F){var O=U.uploadedValue;return O[0]!==F?(C.mainContext.uniform1f(U.location,O[0]=F),1):0},F._uniform1fv=function(U,F){if(F.length<4){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(C.mainContext.uniform1fv(U.location,F),O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3],1):0}return C.mainContext.uniform1fv(U.location,F),1},F._uniform_vec2=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]?(C.mainContext.uniform2f(U.location,O[0]=F[0],O[1]=F[1]),1):0},F._uniform_vec2v=function(U,F){if(F.length<2){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(C.mainContext.uniform2fv(U.location,F),O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3],1):0}return C.mainContext.uniform2fv(U.location,F),1},F._uniform_vec3=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]?(C.mainContext.uniform3f(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2]),1):0},F._uniform_vec3v=function(U,F){return C.mainContext.uniform3fv(U.location,F),1},F._uniform_vec4=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(C.mainContext.uniform4f(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3]),1):0},F._uniform_vec4v=function(U,F){return C.mainContext.uniform4fv(U.location,F),1},F._uniformMatrix2fv=function(U,F){return C.mainContext.uniformMatrix2fv(U.location,!1,F),1},F._uniformMatrix3fv=function(U,F){return C.mainContext.uniformMatrix3fv(U.location,!1,F),1},F._uniformMatrix4fv=function(U,F){return C.mainContext.uniformMatrix4fv(U.location,!1,F),1},F._uinformMatrix2fv=function(U,F){return C.mainContext.uniformMatrix2fv(U.location,!1,F),1},F._uinformMatrix3fv=function(U,F){return C.mainContext.uniformMatrix3fv(U.location,!1,F),1},F._uniform1i=function(U,F){var O=U.uploadedValue;return O[0]!==F?(C.mainContext.uniform1i(U.location,O[0]=F),1):0},F._uniform1iv=function(U,F){return C.mainContext.uniform1iv(U.location,F),1},F._uniform_ivec2=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]?(C.mainContext.uniform2i(U.location,O[0]=F[0],O[1]=F[1]),1):0},F._uniform_ivec2v=function(U,F){return C.mainContext.uniform2iv(U.location,F),1},F._uniform_vec3i=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]?(C.mainContext.uniform3i(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2]),1):0},F._uniform_vec3vi=function(U,F){return C.mainContext.uniform3iv(U.location,F),1},F._uniform_vec4i=function(U,F){var O=U.uploadedValue;return O[0]!==F[0]||O[1]!==F[1]||O[2]!==F[2]||O[3]!==F[3]?(C.mainContext.uniform4i(U.location,O[0]=F[0],O[1]=F[1],O[2]=F[2],O[3]=F[3]),1):0},F._uniform_vec4vi=function(U,F){return C.mainContext.uniform4iv(U.location,F),1},F._uniform_sampler2D=function(U,F){var O=F.source||F.defaulteTexture.source,P=C.mainContext,Y=U.uploadedValue;if(null!=Y[0])return P.activeTexture(b._TEXTURES[Y[0]]),O&&s.bindTexture(P,3553,O),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return Y[0]=this._curActTexIndex,P.uniform1i(U.location,this._curActTexIndex),P.activeTexture(b._TEXTURES[this._curActTexIndex]),O&&s.bindTexture(P,3553,O),this._curActTexIndex++,1},F._uniform_samplerCube=function(U,F){var O=F.source||F.defaulteTexture.source,P=C.mainContext,Y=U.uploadedValue;if(null!=Y[0])return P.activeTexture(b._TEXTURES[Y[0]]),O?s.bindTexture(P,34067,O):s.bindTexture(P,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return Y[0]=this._curActTexIndex,P.uniform1i(U.location,this._curActTexIndex),P.activeTexture(b._TEXTURES[this._curActTexIndex]),O?s.bindTexture(P,34067,O):s.bindTexture(P,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},F._noSetValue=function(U){console.log("no....:"+U.name)},F.bind=function(){return O.activeShader=this,(O.bindShader=this).activeResource(),s.UseProgram(this._program)},F.uploadAttributes=function(U,F){for(var O,P,Y=0,c=0,L=this._attributeParamsMap.length;c<L;c+=2)P=this._attributeParamsMap[c+1],null!=(O=U[this._attributeParamsMap[c]])&&(F&&F[P.name]&&F[P.name].bind(),Y+=P.fun.call(this,P,O));I.shaderCall+=Y},F.uploadAttributesX=function(U,F){for(var O,P,Y=0,c=0,L=this._attributeParamsMap.length;c<L;c+=2)P=this._attributeParamsMap[c+1],null!=(O=U[this._attributeParamsMap[c]])&&(F._bind(),Y+=P.fun.call(this,P,O));I.shaderCall+=Y},F.uploadSceneUniforms=function(U){for(var F,O,P=0,Y=0,c=this._sceneUniformParamsMap.length;Y<c;Y+=2)O=this._sceneUniformParamsMap[Y+1],null!=(F=U[this._sceneUniformParamsMap[Y]])&&(P+=O.fun.call(this,O,F));I.shaderCall+=P},F.uploadCameraUniforms=function(U){for(var F,O,P=0,Y=0,c=this._cameraUniformParamsMap.length;Y<c;Y+=2)O=this._cameraUniformParamsMap[Y+1],null!=(F=U[this._cameraUniformParamsMap[Y]])&&(P+=O.fun.call(this,O,F));I.shaderCall+=P},F.uploadSpriteUniforms=function(U){for(var F,O,P=0,Y=0,c=this._spriteUniformParamsMap.length;Y<c;Y+=2)O=this._spriteUniformParamsMap[Y+1],null!=(F=U[this._spriteUniformParamsMap[Y]])&&(P+=O.fun.call(this,O,F));I.shaderCall+=P},F.uploadMaterialUniforms=function(U){for(var F,O,P=0,Y=0,c=this._materialUniformParamsMap.length;Y<c;Y+=2)O=this._materialUniformParamsMap[Y+1],null!=(F=U[this._materialUniformParamsMap[Y]])&&(P+=O.fun.call(this,O,F));I.shaderCall+=P},F.uploadRenderElementUniforms=function(U){for(var F,O,P=0,Y=0,c=this._renderElementUniformParamsMap.length;Y<c;Y+=2)O=this._renderElementUniformParamsMap[Y+1],null!=(F=U[this._renderElementUniformParamsMap[Y]])&&(P+=O.fun.call(this,O,F));I.shaderCall+=P},b.create=function(U,F,O,P,Y,c,L,u,d,a){return new b(U,F,O,P,Y,c,L,u,d,a)},b.addInclude=function(U,F){Q.addInclude(U,F)},b._createShader=function(U,F,O){var P=U.createShader(O);if(U.shaderSource(P,F),U.compileShader(P),IF.debugMode&&!U.getShaderParameter(P,35713))throw U.getShaderInfoLog(P);return P},b.PERIOD_RENDERELEMENT=0,b.PERIOD_MATERIAL=1,b.PERIOD_SPRITE=2,b.PERIOD_CAMERA=3,b.PERIOD_SCENE=4,b._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],b._count=0,b._preCompile=!1,b.extCompileFunc=null,b.extCompileObj=null,z(b,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new T}]),b}(),VF=function(u){function d(){this._transformUV=null,d.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new LF(.6,.6,.6)),this._setColor(10,new LF(1,1,1)),this._setColor(11,new uF(1,1,1,8)),this._setColor(12,new LF(1,1,1)),this._setColor(7,new uF(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new uF(1,1,0,0)),this.renderMode=1}w(d,"laya.d3.core.material.StandardMaterial",u);var U=d.prototype;return U.disableLight=function(){this._addDisablePublicShaderDefine(IF.SHADERDEFINE_POINTLIGHT|IF.SHADERDEFINE_SPOTLIGHT|IF.SHADERDEFINE_DIRECTIONLIGHT)},U.disableFog=function(){this._addDisablePublicShaderDefine(IF.SHADERDEFINE_FOG)},U.onAsynLoaded=function(U,F,O){var P=F[0];if(P.version)u.prototype.onAsynLoaded.call(this,U,F,O);else{var Y=F[1],c=P.props;for(var L in c)this[L]=c[L];d._parseStandardMaterial(Y,this,P),this._endLoaded()}},U.cloneTo=function(U){u.prototype.cloneTo.call(this,U);var F=U;this._transformUV&&(F._transformUV=this._transformUV.clone())},j(0,U,"ambientColor",function(){return this._getColor(9)},function(U){this._setColor(9,U)}),j(0,U,"ambientTexture",function(){return this._getTexture(5)},function(U){U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,U)}),j(0,U,"renderMode",null,function(U){switch(U){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(d.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(U)}),j(0,U,"reflectColor",function(){return this._getColor(12)},function(U){this._setColor(12,U)}),j(0,U,"tilingOffset",function(){return this._getColor(15)},function(U){if(U){var F=U.elements;1!=F[0]||1!=F[1]||0!=F[2]||0!=F[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,U)}),j(0,U,"albedo",function(){return this._getColor(7)},function(U){this._setColor(7,U)}),j(0,U,"diffuseColor",function(){return this._getColor(10)},function(U){this._setColor(10,U)}),j(0,U,"albedoColor",function(){return this._getColor(7)},function(U){this._setColor(7,U)}),j(0,U,"specularColor",function(){return this._getColor(11)},function(U){this._setColor(11,U)}),j(0,U,"diffuseTexture",function(){return this._getTexture(1)},function(U){U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,U)}),j(0,U,"normalTexture",function(){return this._getTexture(2)},function(U){U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,U)}),j(0,U,"specularTexture",function(){return this._getTexture(3)},function(U){U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,U)}),j(0,U,"emissiveTexture",function(){return this._getTexture(4)},function(U){U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,U)}),j(0,U,"reflectTexture",function(){return this._getTexture(6)},function(U){U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,U)}),j(0,U,"transformUV",function(){return this._transformUV},function(U){this._transformUV=U,this._setMatrix4x4(13,U.matrix),U?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,U.matrix.elements,0)}),d.__init__=function(){d.SHADERDEFINE_DIFFUSEMAP=d.shaderDefines.registerDefine("DIFFUSEMAP"),d.SHADERDEFINE_NORMALMAP=d.shaderDefines.registerDefine("NORMALMAP"),d.SHADERDEFINE_SPECULARMAP=d.shaderDefines.registerDefine("SPECULARMAP"),d.SHADERDEFINE_EMISSIVEMAP=d.shaderDefines.registerDefine("EMISSIVEMAP"),d.SHADERDEFINE_AMBIENTMAP=d.shaderDefines.registerDefine("AMBIENTMAP"),d.SHADERDEFINE_REFLECTMAP=d.shaderDefines.registerDefine("REFLECTMAP"),d.SHADERDEFINE_UVTRANSFORM=d.shaderDefines.registerDefine("UVTRANSFORM"),d.SHADERDEFINE_TILINGOFFSET=d.shaderDefines.registerDefine("TILINGOFFSET"),d.SHADERDEFINE_ADDTIVEFOG=d.shaderDefines.registerDefine("ADDTIVEFOG")},d.load=function(U){return N.loader.create(U,null,null,d)},d._parseStandardMaterial=function(U,F,O){var P=O.customProps,Y=P.ambientColor;F.ambientColor=new LF(Y[0],Y[1],Y[2]);var c=P.diffuseColor;F.diffuseColor=new LF(c[0],c[1],c[2]);var L=P.specularColor;F.specularColor=new uF(L[0],L[1],L[2],L[3]);var u=P.reflectColor;F.reflectColor=new LF(u[0],u[1],u[2]);var d=P.albedoColor;d&&(F.albedo=new uF(d[0],d[1],d[2],d[3]));var a=P.diffuseTexture.texture2D;a&&(F.diffuseTexture=H.getRes(U[a]));var b=P.normalTexture.texture2D;b&&(F.normalTexture=H.getRes(U[b]));var z=P.specularTexture.texture2D;z&&(F.specularTexture=H.getRes(U[z]));var J=P.emissiveTexture.texture2D;J&&(F.emissiveTexture=H.getRes(U[J]));var w=P.ambientTexture.texture2D;w&&(F.ambientTexture=H.getRes(U[w]));var j=P.reflectTexture.texture2D;j&&(F.reflectTexture=H.getRes(U[j]))},d.RENDERMODE_OPAQUE=1,d.RENDERMODE_OPAQUEDOUBLEFACE=2,d.RENDERMODE_CUTOUT=3,d.RENDERMODE_CUTOUTDOUBLEFACE=4,d.RENDERMODE_TRANSPARENT=13,d.RENDERMODE_TRANSPARENTDOUBLEFACE=14,d.RENDERMODE_ADDTIVE=15,d.RENDERMODE_ADDTIVEDOUBLEFACE=16,d.RENDERMODE_DEPTHREAD_TRANSPARENT=5,d.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,d.RENDERMODE_DEPTHREAD_ADDTIVE=7,d.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,d.RENDERMODE_NONDEPTH_TRANSPARENT=9,d.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,d.RENDERMODE_NONDEPTH_ADDTIVE=11,d.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,d.SHADERDEFINE_DIFFUSEMAP=0,d.SHADERDEFINE_NORMALMAP=0,d.SHADERDEFINE_SPECULARMAP=0,d.SHADERDEFINE_EMISSIVEMAP=0,d.SHADERDEFINE_AMBIENTMAP=0,d.SHADERDEFINE_REFLECTMAP=0,d.SHADERDEFINE_UVTRANSFORM=0,d.SHADERDEFINE_TILINGOFFSET=0,d.SHADERDEFINE_ADDTIVEFOG=0,d.DIFFUSETEXTURE=1,d.NORMALTEXTURE=2,d.SPECULARTEXTURE=3,d.EMISSIVETEXTURE=4,d.AMBIENTTEXTURE=5,d.REFLECTTEXTURE=6,d.ALBEDO=7,d.UVANIAGE=8,d.MATERIALAMBIENT=9,d.MATERIALDIFFUSE=10,d.MATERIALSPECULAR=11,d.MATERIALREFLECT=12,d.UVMATRIX=13,d.UVAGE=14,d.TILINGOFFSET=15,z(d,["defaultMaterial",function(){var U=new d;return U.lock=!0,this.defaultMaterial=U},"shaderDefines",function(){return this.shaderDefines=new bF($F.shaderDefines)}]),d}($F),MF=function(U){function L(U,F,O,P,Y){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===O&&(O=35044),void 0===P&&(P=!1),L.__super.call(this),this._indexType=U,this._indexCount=F,this._bufferUsage=O,this._bufferType=34963,this._canRead=P;var c;if("ushort"==U)this._indexTypeByteCount=2;else{if("ubyte"!=U)throw new Error("unidentification index type.");this._indexTypeByteCount=1}c=this._indexTypeByteCount*F,this._byteLength=c,this._bind(),u._gl.bufferData(this._bufferType,c,this._bufferUsage),this.uri=Y,P?("ushort"==U?this._buffer=new Uint16Array(F):"ubyte"==U&&(this._buffer=new Uint8Array(F)),this.memorySize=2*c):this.memorySize=c}w(L,"laya.d3.graphics.IndexBuffer3D",U);var F=L.prototype;return F.setData=function(U,F,O,P){void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=4294967295);var Y=0;if("ushort"==this._indexType?(Y=2,0===O&&4294967295===P||(U=new Uint16Array(U.buffer,O*Y,P))):"ubyte"==this._indexType&&(Y=1,0===O&&4294967295===P||(U=new Uint8Array(U.buffer,O*Y,P))),this._bind(),u._gl.bufferSubData(this._bufferType,F*Y,U),this._canRead)if(0!==F||0!==O||4294967295!==P){var c=this._buffer.length-F;c<P&&(P=c);for(var L=0;L<P;L++)this._buffer[F+L]=U[L]}else this._buffer=U},F.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},F.disposeResource=function(){U.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},j(0,F,"indexType",function(){return this._indexType}),j(0,F,"indexTypeByteCount",function(){return this._indexTypeByteCount}),j(0,F,"indexCount",function(){return this._indexCount}),j(0,F,"canRead",function(){return this._canRead}),L.INDEXTYPE_UBYTE="ubyte",L.INDEXTYPE_USHORT="ushort",L.create=function(U,F,O,P,Y){return void 0===O&&(O=35044),void 0===P&&(P=!1),new L(U,F,O,P,Y)},L}(u),mF=function(c){function L(U,F,O,P,Y){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===P&&(P=!1),L.__super.call(this),this._vertexDeclaration=U,this._vertexCount=F,this._bufferUsage=O,this._bufferType=34962,this._canRead=P,this.uri=Y,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*F,this._bind(),u._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),P&&(this._buffer=new Float32Array(this._byteLength/4))}w(L,"laya.d3.graphics.VertexBuffer3D",c);var U=L.prototype;return U.bindWithIndexBuffer=function(U){U&&U._bind(),this._bind()},U.setData=function(U,F,O,P){if(void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=4294967295),0===O&&4294967295===P||(U=new Float32Array(U.buffer,4*O,P)),this._bind(),u._gl.bufferSubData(this._bufferType,4*F,U),this._canRead)if(0!==F||0!==O||4294967295!==P){var Y=this._buffer.length-F;Y<P&&(P=Y);for(var c=0;c<P;c++)this._buffer[F+c]=U[c]}else this._buffer=U},U.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},U.disposeResource=function(){for(var U=C.mainContext,F=this._vertexDeclaration.getVertexElements(),O=u._enableAtributes,P=0,Y=F.length;P<Y;P++)O[P]===this._glBuffer&&(U.disableVertexAttribArray(P),O[P]=null);c.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},j(0,U,"vertexDeclaration",function(){return this._vertexDeclaration}),j(0,U,"vertexCount",function(){return this._vertexCount}),j(0,U,"canRead",function(){return this._canRead}),L.create=function(U,F,O,P,Y){return void 0===O&&(O=35044),void 0===P&&(P=!1),new L(U,F,O,P,Y)},L}(u),pF=function(U){function Q(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,Q.__super.call(this),this._type=3553}w(Q,"laya.d3.resource.DataTexture2D",CF);var F=Q.prototype;return F.genDebugMipmaps=function(){var U=[];return U.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),U.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),U.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),U.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),U.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),U.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),U.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),U.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),U.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),U.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),U},F._onTextureLoaded=function(U){},F._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var U=C.mainContext,F=this._source=U.createTexture(),O=this._width,P=this._height,Y=s.curBindTexTarget,c=s.curBindTexValue,L=!1;if(s.bindTexture(U,this._type,F),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var u=0;U.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var d=0;d<this._mipmaps.length;d++){if(this._mipmaps[d].byteLength!=a*b*4)throw"mipmap size error  level:"+d;U.texSubImage2D(this._type,0,Q.simLodRect[u++],Q.simLodRect[u++],Q.simLodRect[u++],Q.simLodRect[u++],6408,5121,new Uint8Array(this._mipmaps[d]))}this.minFifter=9729,this.magFifter=9729}else{var a=this._width,b=this._height;for(u=0,U.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),d=0;d<this._mipmaps.length;d++){if(this._mipmaps[d].byteLength!=a*b*4)throw"mipmap size error  level:"+d;U.texImage2D(this._type,d,6408,a,b,0,6408,5121,new Uint8Array(this._mipmaps[d])),(a/=2)<1&&(a=1),(b/=2)<1&&(b=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&U.pixelStorei(U.UNPACK_ALIGNMENT,1),U.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var z=0,J=!1,w=!1;this._buffer.byteLength==4*O*P?(z=6408,J=!0):this._buffer.byteLength==3*O*P?(z=6407,w=!0):z=this._format,J||w?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),w&&U.pixelStorei(U.UNPACK_ALIGNMENT,1),U.texImage2D(this._type,0,z,O,P,0,z,5121,this._buffer)):U&&z==U.ALPHA?(U.texImage2D(3553,0,z,O,P,0,z,U.UNSIGNED_BYTE,this._buffer),L=!0):0!=z&&(U.compressedTexImage2D(3553,0,z,O,P,0,this._buffer),L=!0)}var j=this._minFifter,x=this._magFifter,r=0==this._wrapModeU?10497:33071,H=0==this._wrapModeV?10497:33071,h=X.isPOT(O,P);h?(this._mipmap||this._mipmaps?-1!==j||(j=9987):-1!==j||(j=9729),-1!==x||(x=9729),U.texParameteri(this._type,10241,j),U.texParameteri(this._type,10240,x),U.texParameteri(this._type,10242,r),U.texParameteri(this._type,10243,H),this._mipmap&&U.generateMipmap(this._type)):(-1!==j||(j=9729),-1!==x||(x=9729),U.texParameteri(this._type,10241,j),U.texParameteri(this._type,10240,x),U.texParameteri(this._type,10242,33071),U.texParameteri(this._type,10243,33071)),Y&&c&&s.bindTexture(U,Y,c),this.memorySize=L?this._buffer.length:h?O*P*4*(1+1/3):O*P*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},F.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},F.onAsynLoaded=function(U,F,O){var P;O&&(P=O[0].call(this,F)),P&&(this._width=P.width,this._height=P.height,this._buffer=P.data),this._src=U,this._size=new xF(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},F.getPixels=function(){return new Uint8Array(this._buffer)},F.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(C.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},j(0,F,"src",function(){return this._src}),Q.create=function(U,F,O,P,Y,c,L){if(void 0===P&&(P=9729),void 0===Y&&(Y=9729),void 0===c&&(c=!0),!U||U.byteLength<F*O*4)throw"DataTexture2D create error";var u=new Q;return u.uri=L,u._buffer=U,u._width=F,u._height=O,u._mipmap=c,u._magFifter=P,u._minFifter=Y,u._size=new xF(u._width,u._height),u._conchTexture?alert("怎么给runtime传递datatexture数据"):u.activeResource(),u},Q.load=function(U,F,O,P,Y){if(void 0===F&&(F=0),void 0===O&&(O=0),void 0===P&&(P=9729),void 0===Y&&(Y=9729),"mipmaps"===g.getFileExtension(U)){var c=N.loader.create(U,null,null,Q,[function(U){this._mipmaps=[];var F=new Uint32Array(U);this._width=F[0];var O=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,O=1024),this._width!=O)throw"现在只支持512x256的环境贴图。当前的是"+F[0];this._height=F[1];for(var P=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,Y=this._height,c=8;;){var L=P*Y*4;if(c+L>U.byteLength)throw"load mipmaps data size error ";var u=new Uint8Array(U,c,L);if(this._mipmaps.push(u),c+=L,1==P&&1==Y)break;(P/=2)<1&&(P=1),(Y/=2)<1&&(Y=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){c.simLodInfo=new Float32Array(40);for(var L=0;L<c.simLodInfo.length;)c.simLodInfo[L]=(Q.simLodRect[L]+.5)/1024,L++,c.simLodInfo[L]=(Q.simLodRect[L]+.5)/256,L++,c.simLodInfo[L]=Math.max(Q.simLodRect[L]-1,.1)/1024,L++,c.simLodInfo[L]=Math.max(Q.simLodRect[L]-1.5,.1)/256,L++}return c}if("number"==typeof F)return N.loader.create(U,null,null,Q,[function(U){return this._width=F,this._height=O,this._buffer=U,null}]);if("function"==typeof F)return N.loader.create(U,null,null,Q,[F]);throw new Error("unknown params.")},Q.lodasatlas=!1,z(Q,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),Q}(),oF=function(U){function F(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,F.__super.call(this)}w(F,"laya.d3.resource.models.PrimitiveMesh",sF);var O=F.prototype;return N.imps(O,{"laya.d3.core.render.IRenderable":!0}),O._getVertexBuffer=function(U){return void 0===U&&(U=0),0===U?this._vertexBuffer:null},O._getVertexBuffers=function(){return null},O._getIndexBuffer=function(){return this._indexBuffer},O._getPositions=function(){var U,F=[],O=this._vertexBuffer.vertexDeclaration.getVertexElements(),P=0;for(P=0;P<O.length;P++){var Y=O[P];if("vector3"===Y.elementFormat&&0===Y.elementUsage){U=Y;break}}var c=this._vertexBuffer.getData();for(P=0;P<c.length;P+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var L=P+U.offset/4,u=new LF(c[L+0],c[L+1],c[L+2]);F.push(u)}return F},O.getRenderElement=function(U){return this},O.getRenderElementsCount=function(){return 1},O.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},O._beforeRender=function(U){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},O._render=function(U){C.mainContext.drawElements(4,this._numberIndices,5123,0),I.drawCall++,I.trianglesFaces+=this._numberIndices/3},j(0,O,"_vertexBufferCount",function(){return 1}),j(0,O,"triangleCount",function(){return this._indexBuffer.indexCount/3}),F}(),RF=function(U){function F(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,F.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}w(F,"laya.d3.resource.models.Mesh",sF);var O=F.prototype;return O._getPositions=function(){var U,F,O,P,Y,c=[],L=0,u=0,d=0;if(0!==this._vertexBuffers.length){var a=this._vertexBuffers.length;for(L=0;L<a;L++){for(O=(U=this._vertexBuffers[L]).vertexDeclaration.getVertexElements(),u=0;u<O.length;u++)if("vector3"===(P=O[u]).elementFormat&&0===P.elementUsage){F=P;break}for(Y=U.getData(),u=0;u<Y.length;u+=U.vertexDeclaration.vertexStride/4)d=u+F.offset/4,c.push(new LF(Y[d+0],Y[d+1],Y[d+2]))}}else{var b=this._subMeshes.length;for(L=0;L<b;L++){for(O=(U=this._subMeshes[L]._getVertexBuffer()).vertexDeclaration.getVertexElements(),u=0;u<O.length;u++)if("vector3"===(P=O[u]).elementFormat&&0===P.elementUsage){F=P;break}for(Y=U.getData(),u=0;u<Y.length;u+=U.vertexDeclaration.vertexStride/4)d=u+F.offset/4,c.push(new LF(Y[d+0],Y[d+1],Y[d+2]))}}return c},O._setSubMeshes=function(U){this._subMeshes=U,this._subMeshCount=U.length;for(var F=0;F<this._subMeshCount;F++)U[F]._indexInMesh=F;this._positions=this._getPositions(),this._generateBoundingObject()},O.onAsynLoaded=function(U,F,O){var P=F[0],Y=F[1];nU.read(P,this,this._materials,this._subMeshes,Y),this.completeCreate(),this._endLoaded()},O.getSubMesh=function(U){return this._subMeshes[U]},O.getSubMeshCount=function(){return this._subMeshes.length},O.getRenderElementsCount=function(){return this._subMeshes.length},O.getRenderElement=function(U){return this._subMeshes[U]},O.disposeResource=function(){for(var U=0;U<this._subMeshes.length;U++)this._subMeshes[U].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},j(0,O,"materials",function(){return this._materials.slice()}),j(0,O,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),F.load=function(U){return N.loader.create(U,null,null,F)},F}(),_F=(function(U){function a(U,F,O,P,Y,c,L,u,d){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===O&&(O=6408),void 0===P&&(P=5121),void 0===Y&&(Y=33189),void 0===c&&(c=!1),void 0===L&&(L=!1),void 0===u&&(u=-1),void 0===d&&(d=-1),a.__super.call(this),this._type=3553,this._width=U,this._height=F,this._size=new xF(U,F),this._surfaceFormat=O,this._surfaceType=P,this._depthStencilFormat=Y,x.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=c,this._repeat=L,this._minFifter=u,this._magFifter=d,this.activeResource(),this._alreadyResolved=!0}w(a,"laya.d3.resource.RenderTexture",CF);var F=a.prototype;F.recreateResource=function(){var U=C.mainContext;this._frameBuffer=U.createFramebuffer(),this._source=U.createTexture();var F=s.curBindTexTarget,O=s.curBindTexValue;s.bindTexture(U,this._type,this._source),U.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var P=this._minFifter,Y=this._magFifter,c=this._repeat?10497:33071;if(X.isPOT(this._width,this._height)?(this._mipmap?-1!==P||(P=9987):-1!==P||(P=9729),-1!==Y||(Y=9729),U.texParameteri(this._type,10241,P),U.texParameteri(this._type,10240,Y),U.texParameteri(this._type,10242,c),U.texParameteri(this._type,10243,c),this._mipmap&&U.generateMipmap(this._type)):(-1!==P||(P=9729),-1!==Y||(Y=9729),U.texParameteri(this._type,10241,P),U.texParameteri(this._type,10240,Y),U.texParameteri(this._type,10242,33071),U.texParameteri(this._type,10243,33071)),F&&O&&s.bindTexture(U,F,O),U.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=U.createRenderbuffer(),U.bindRenderbuffer(36161,this._depthStencilBuffer),U.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),U.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:U.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:U.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:U.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}U.framebufferTexture2D(36160,36064,3553,this._source,0),U.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},F.start=function(){C.mainContext.bindFramebuffer(36160,this.frameBuffer),(a._currentRenderTarget=this)._alreadyResolved=!1},F.end=function(){C.mainContext.bindFramebuffer(36160,null),a._currentRenderTarget=null,this._alreadyResolved=!0},F.getData=function(U,F,O,P){var Y=C.mainContext;if(Y.bindFramebuffer(36160,this._frameBuffer),!(36053===Y.checkFramebufferStatus(36160)))return Y.bindFramebuffer(36160,null),null;var c=new Uint8Array(this._width*this._height*4);return Y.readPixels(U,F,O,P,this._surfaceFormat,this._surfaceType,c),Y.bindFramebuffer(36160,null),c},F.disposeResource=function(){if(this._frameBuffer){var U=C.mainContext;U.deleteTexture(this._source),U.deleteFramebuffer(this._frameBuffer),U.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},j(0,F,"surfaceFormat",function(){return this._surfaceFormat}),j(0,F,"surfaceType",function(){return this._surfaceType}),j(0,F,"depthStencilFormat",function(){return this._depthStencilFormat}),j(0,F,"source",function(){return this._alreadyResolved?N.superGet(CF,this,"source"):null}),j(0,F,"depthStencilBuffer",function(){return this._depthStencilBuffer}),j(0,F,"frameBuffer",function(){return this._frameBuffer}),a._currentRenderTarget=null}(),function(U){function F(U){this._color=null,this._pixels=null,F.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new xF(this.width,this.height),this._color=U,this._pixels=new Uint8Array([255*U.x,255*U.y,255*U.z,255*U.w]),this.uri="SolidColorTexture2D_"+this.id}w(F,"laya.d3.resource.SolidColorTexture2D",CF);var O=F.prototype;return O._createWebGlTexture=function(){var U=C.mainContext,F=this._source=U.createTexture(),O=this._width,P=this._height,Y=s.curBindTexTarget,c=s.curBindTexValue;s.bindTexture(U,this._type,F),U.texImage2D(this._type,0,6408,O,P,0,6408,5121,this._pixels);var L=this._minFifter,u=this._magFifter,d=this._repeat?10497:33071,a=X.isPOT(O,P);a?(this._mipmap?-1!==L||(L=9987):-1!==L||(L=9729),-1!==u||(u=9729),U.texParameteri(this._type,10241,L),U.texParameteri(this._type,10240,u),U.texParameteri(this._type,10242,d),U.texParameteri(this._type,10243,d),this._mipmap&&U.generateMipmap(this._type)):(-1!==L||(L=9729),-1!==u||(u=9729),U.texParameteri(this._type,10241,L),U.texParameteri(this._type,10240,u),U.texParameteri(this._type,10242,33071),U.texParameteri(this._type,10243,33071)),Y&&c&&s.bindTexture(U,Y,c),this.memorySize=a?O*P*4*(1+1/3):O*P*4},O.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},O.disposeResource=function(){this._source&&(C.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},z(F,["magentaTexture",function(){var U=new F(new uF(1,0,1,1));return U.lock=!0,this.magentaTexture=U},"grayTexture",function(){var U=new F(new uF(.5,.5,.5,1));return U.lock=!0,this.grayTexture=U}]),F}()),qF=function(U){function Y(U,F,O,P){this._canRead=!1,this._image=null,this._pixels=null,void 0===U&&(U=!1),void 0===F&&(F=!0),void 0===O&&(O=6408),void 0===P&&(P=!0),Y.__super.call(this),this._type=3553,this._repeat=F,this._canRead=U,this._format=O,this._mipmap=P}w(Y,"laya.d3.resource.Texture2D",CF);var F=Y.prototype;return F._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var U=C.mainContext,F=this._source=U.createTexture(),O=this._width,P=this._height,Y=s.curBindTexTarget,c=s.curBindTexValue;switch(s.bindTexture(U,this._type,F),this._format){case 6407:case 6408:this._canRead?U.texImage2D(this._type,0,this._format,O,P,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?U.texImage2D(this._type,0,this._image._format,O,P,0,this._image._format,5121,this._image.atlasSource):U.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case C.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:U.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var L=this._minFifter,u=this._magFifter,d=this._repeat?10497:33071,a=0==this._wrapModeU?10497:33071,b=0==this._wrapModeV?10497:33071,z=X.isPOT(O,P);z?(this._mipmap?-1!==L||(L=9987):-1!==L||(L=9729),-1!==u||(u=9729),U.texParameteri(this._type,10241,L),U.texParameteri(this._type,10240,u),U.texParameteri(this._type,10242,d),U.texParameteri(this._type,10243,d),U.texParameteri(this._type,10242,a),U.texParameteri(this._type,10243,b),this._mipmap&&U.generateMipmap(this._type)):(-1!==L||(L=9729),-1!==u||(u=9729),U.texParameteri(this._type,10241,L),U.texParameteri(this._type,10240,u),U.texParameteri(this._type,10242,33071),U.texParameteri(this._type,10243,33071)),Y&&c&&s.bindTexture(U,Y,c),this._image.onload=null,this._image=null,this.memorySize=z?O*P*4*(1+1/3):O*P*4},F.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},F.onAsynLoaded=function(U,F,O){if(O){var P=O[0];void 0!==P&&(this._canRead=P);var Y=O[1];void 0!==Y&&(this._repeat=Y);var c=O[2];void 0!==c&&(this._format=c);var L=O[3];void 0!==L&&(this._mipmap=L);var u=O.wrapModeU;void 0!==u&&(this._wrapModeU=u);var d=O.wrapModeV;void 0!==d&&(this._wrapModeV=d)}switch(this._format){case 6407:case 6408:var a=(this._image=F).width,b=F.height;this._width=a,this._height=b,this._size=new xF(a,b),this._canRead&&(x.isConchApp?F instanceof J.HTMLElement&&(this._pixels=new Uint8Array(F.getImageData(0,0,a,b))):(i.canvas.size(a,b),i.canvas.clear(),i.context.drawImage(F,0,0,a,b),this._pixels=new Uint8Array(i.context.getImageData(0,0,a,b).data.buffer)));break;case C.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var z=new K(F);z.readUTFBytes(4),z.readUTFBytes(2),z.getInt16();z.endian="bigEndian",this._width=z.getInt16(),this._height=z.getInt16(),this._size=new xF(this._width,this._height);z.getInt16(),z.getInt16();this._image=new Uint8Array(F,z.pos)}this.recreateResource(),this._endLoaded()},F.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},F.disposeResource=function(){this._source&&(C.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},j(0,F,"_src",function(){return this.url}),j(0,F,"src",function(){return this.url}),Y.load=function(U){return N.loader.create(U,null,null,Y)},Y}(),DF=function(F){function O(U,F){O.__super.call(this),void 0===U&&(U=.3),void 0===F&&(F=1e3),this._tempVector3=new LF,this._position=new LF,this._up=new LF,this._forward=new LF,this._right=new LF,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=xF.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=U,this._farPlane=F,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),N.stage.on("resize",this,this._onScreenSizeChanged)}w(O,"laya.d3.core.BaseCamera",F);var U=O.prototype;return U._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var U=this.scene._cameraPool,F=U.length-1,O=0;O<F;O++)if(U[O].renderingOrder>U[F].renderingOrder){var P=U[O];U[O]=U[F],U[F]=P}},U._calculateProjectionMatrix=function(){},U._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},U._prepareCameraToRender=function(){y._currentCameraCullingMask=this.cullingMask;var U=this._shaderValues;U.setValue(0,this.transform.position.elements),U.setValue(5,this.forward.elements),U.setValue(6,this.up.elements)},U._prepareCameraViewProject=function(U,F){var O=this._shaderValues;O.setValue(1,U.elements),O.setValue(2,F.elements)},U._renderCamera=function(U,F,O){},U.addLayer=function(U){29!==U.number&&30!=U.number&&(this.cullingMask=this.cullingMask|U.mask)},U.removeLayer=function(U){29!==U.number&&30!=U.number&&(this.cullingMask=this.cullingMask&~U.mask)},U.addAllLayers=function(){this.cullingMask=2147483647},U.removeAllLayers=function(){this.cullingMask=0|y.getLayerByNumber(29).mask|y.getLayerByNumber(30).mask},U.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},U.moveForward=function(U){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=U,this.transform.translate(this._tempVector3)},U.moveRight=function(U){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=U,this.transform.translate(this._tempVector3)},U.moveVertical=function(U){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=U,this.transform.translate(this._tempVector3,!1)},U._addSelfRenderObjects=function(){var U=this.scene._cameraPool,F=U.length;if(0<F){for(var O=F-1;0<=O;O--)if(this.renderingOrder<=U[O].renderingOrder){U.splice(O+1,0,this);break}}else U.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},U._clearSelfRenderObjects=function(){var U=this.scene._cameraPool;U.splice(U.indexOf(this),1)},U.destroy=function(U){void 0===U&&(U=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,N.stage.off("resize",this,this._onScreenSizeChanged),F.prototype.destroy.call(this,U)},j(0,U,"sky",function(){return this._sky},function(U){(this._sky=U)._ownerCamera=this}),j(0,U,"forward",function(){var U=this.transform.worldMatrix.elements,F=this._forward.elements;return F[0]=-U[8],F[1]=-U[9],F[2]=-U[10],this._forward}),j(0,U,"position",function(){var U=this.transform.worldMatrix.elements,F=this._position.elements;return F[0]=U[12],F[1]=U[13],F[2]=U[14],this._position}),j(0,U,"renderTarget",function(){return this._renderTarget},function(U){null!=(this._renderTarget=U)&&(this._renderTargetSize=U.size)}),j(0,U,"up",function(){var U=this.transform.worldMatrix.elements,F=this._up.elements;return F[0]=U[4],F[1]=U[5],F[2]=U[6],this._up}),j(0,U,"right",function(){var U=this.transform.worldMatrix.elements,F=this._right.elements;return F[0]=U[0],F[1]=U[1],F[2]=U[2],this._right}),j(0,U,"renderTargetSize",function(){return this._renderTargetSize},function(U){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=U,this._calculateProjectionMatrix()}),j(0,U,"fieldOfView",function(){return this._fieldOfView},function(U){this._fieldOfView=U,this._calculateProjectionMatrix()}),j(0,U,"nearPlane",function(){return this._nearPlane},function(U){this._nearPlane=U,this._calculateProjectionMatrix()}),j(0,U,"farPlane",function(){return this._farPlane},function(U){this._farPlane=U,this._calculateProjectionMatrix()}),j(0,U,"orthographic",function(){return this._orthographic},function(U){this._orthographic=U,this._calculateProjectionMatrix()}),j(0,U,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(U){this._orthographicVerticalSize=U,this._calculateProjectionMatrix()}),j(0,U,"renderingOrder",function(){return this._renderingOrder},function(U){this._renderingOrder=U,this._sortCamerasByRenderingOrder()}),O.CAMERAPOS=0,O.VIEWMATRIX=1,O.PROJECTMATRIX=2,O.VPMATRIX=3,O.VPMATRIX_NO_TRANSLATE=4,O.CAMERADIRECTION=5,O.CAMERAUP=6,O.ENVIRONMENTDIFFUSE=7,O.ENVIRONMENTSPECULAR=8,O.SIMLODINFO=9,O.DIFFUSEIRRADMATR=10,O.DIFFUSEIRRADMATG=11,O.DIFFUSEIRRADMATB=12,O.HDREXPOSURE=13,O.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",O.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",O.CLEARFLAG_SOLIDCOLOR=0,O.CLEARFLAG_SKY=1,O.CLEARFLAG_DEPTHONLY=2,O.CLEARFLAG_NONE=3,z(O,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new UF(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new UF},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new UF}]),O}(AF),ZF=function(O){function F(U){this._render=null,this._geometryFilter=null,F.__super.call(this,U)}w(F,"laya.d3.core.RenderableSprite3D",O);var U=F.prototype;return U._addToInitStaticBatchManager=function(){},U._setBelongScene=function(U){O.prototype._setBelongScene.call(this,U),U._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},U._setUnBelongScene=function(){var U=this._scene._renderableSprite3Ds,F=U.indexOf(this);U.splice(F,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),O.prototype._setUnBelongScene.call(this)},U._update=function(U){(U.owner=this)._activeInHierarchy&&(this._updateComponents(U),this._render._updateOctreeNode(),this._lateUpdateComponents(U),I.spriteCount++,this._childs.length&&this._updateChilds(U))},U.destroy=function(U){void 0===U&&(U=!0),O.prototype.destroy.call(this,U),this._render._destroy(),this._render=null},F.__init__=function(){F.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=F.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),F.SAHDERDEFINE_LIGHTMAP=F.shaderDefines.registerDefine("LIGHTMAP")},F.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,F.SAHDERDEFINE_LIGHTMAP=4,F.LIGHTMAPSCALEOFFSET=2,F.LIGHTMAP=3,z(F,["shaderDefines",function(){return this.shaderDefines=new bF}]),F}(AF),eF=(function(U){function P(U,F,O){this._long=NaN,this._width=NaN,this._height=NaN,void 0===U&&(U=1),void 0===F&&(F=1),void 0===O&&(O=1),P.__super.call(this),this._long=U,this._width=F,this._height=O,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}w(P,"laya.d3.resource.models.BoxMesh",oF);var F=P.prototype;F.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var U=CU.vertexDeclaration,F=(U.vertexStride,this._long/2),O=this._height/2,P=this._width/2,Y=new Float32Array([-F,O,-P,0,1,0,0,0,F,O,-P,0,1,0,1,0,F,O,P,0,1,0,1,1,-F,O,P,0,1,0,0,1,-F,-O,-P,0,-1,0,0,1,F,-O,-P,0,-1,0,1,1,F,-O,P,0,-1,0,1,0,-F,-O,P,0,-1,0,0,0,-F,O,-P,-1,0,0,0,0,-F,O,P,-1,0,0,1,0,-F,-O,P,-1,0,0,1,1,-F,-O,-P,-1,0,0,0,1,F,O,-P,1,0,0,1,0,F,O,P,1,0,0,0,0,F,-O,P,1,0,0,0,1,F,-O,-P,1,0,0,1,1,-F,O,P,0,0,1,0,0,F,O,P,0,0,1,1,0,F,-O,P,0,0,1,1,1,-F,-O,P,0,0,1,0,1,-F,O,-P,0,0,-1,1,0,F,O,-P,0,0,-1,0,0,F,-O,-P,0,0,-1,0,1,-F,-O,-P,0,0,-1,1,1]),c=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new mF(U,this._numberVertices,35044,!0),this._indexBuffer=new MF("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(Y),this._indexBuffer.setData(c),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},j(0,F,"long",function(){return this._long},function(U){this._long!==U&&(this._long=U,this.releaseResource(),this.activeResource())}),j(0,F,"width",function(){return this._width},function(U){this._width!==U&&(this._width=U,this.releaseResource(),this.activeResource())}),j(0,F,"height",function(){return this._height},function(U){this._height!==U&&(this._height=U,this.releaseResource(),this.activeResource())})}(),function(U){function Y(U,F,O,P){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===U&&(U=10),void 0===F&&(F=10),void 0===O&&(O=10),void 0===P&&(P=10),Y.__super.call(this),this._long=U,this._width=F,this._stacks=O,this._slices=P,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}w(Y,"laya.d3.resource.models.PlaneMesh",oF);var F=Y.prototype;F.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var U=new Uint16Array(this._numberIndices),F=CU.vertexDeclaration,O=F.vertexStride/4,P=new Float32Array(this._numberVertices*O),Y=this._long/2,c=this._width/2,L=this._long/this._stacks,u=this._width/this._slices,d=0,a=0;a<=this._slices;a++)for(var b=0;b<=this._stacks;b++)P[d++]=b*L-Y,P[d++]=0,P[d++]=a*u-c,P[d++]=0,P[d++]=1,P[d++]=0,P[d++]=1*b/this._stacks,P[d++]=1*a/this._slices;var z=0;for(a=0;a<this._slices;a++)for(b=0;b<this._stacks;b++)U[z++]=(a+1)*(this._stacks+1)+b,U[z++]=a*(this._stacks+1)+b,U[z++]=(a+1)*(this._stacks+1)+b+1,U[z++]=a*(this._stacks+1)+b,U[z++]=a*(this._stacks+1)+b+1,U[z++]=(a+1)*(this._stacks+1)+b+1;this._vertexBuffer=new mF(F,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new MF("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData(P),this._indexBuffer.setData(U),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},j(0,F,"long",function(){return this._long},function(U){this._long!==U&&(this._long=U,this.releaseResource(),this.activeResource())}),j(0,F,"width",function(){return this._width},function(U){this._width!==U&&(this._width=U,this.releaseResource(),this.activeResource())}),j(0,F,"stacks",function(){return this._stacks},function(U){this._stacks!==U&&(this._stacks=U,this.releaseResource(),this.activeResource())}),j(0,F,"slices",function(){return this._slices},function(U){this._slices!==U&&(this._slices=U,this.releaseResource(),this.activeResource())})}(),function(U){function L(U,F,O){void 0===U&&(U=0),void 0===F&&(F=.3),void 0===O&&(O=1e3),this._viewMatrix=new UF,this._projectionMatrix=new UF,this._projectionViewMatrix=new UF,this._viewport=new dF(0,0,0,0),this._normalizedViewport=new dF(0,0,1,1),this._aspectRatio=U,this._boundFrustumUpdate=!0,this._boundFrustum=new SU(UF.DEFAULT),L.__super.call(this,F,O),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}w(L,"laya.d3.core.Camera",DF);var F=L.prototype;return F._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},F._parseCustomProps=function(U,F,O,P){var Y=O.clearColor;this.clearColor=new uF(Y[0],Y[1],Y[2],Y[3]);var c=O.viewport;this.normalizedViewport=new dF(c[0],c[1],c[2],c[3])},F._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var U=this.orthographicVerticalSize*this.aspectRatio*.5,F=.5*this.orthographicVerticalSize;UF.createOrthoOffCenterRH(-U,U,-F,F,this.nearPlane,this.farPlane,this._projectionMatrix)}else UF.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},F._update=function(U){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,U)},F._renderCamera=function(U,F,O){var P,Y;O.parallelSplitShadowMaps[0]&&O._renderShadowMap(U,F,this),(F.camera=this)._prepareCameraToRender(),O._preRenderUpdateComponents(F),P=F._viewMatrix=this.viewMatrix;var c=this._renderTarget;c?(c.start(),UF.multiply(DF._invertYScaleMatrix,this._projectionMatrix,DF._invertYProjectionMatrix),UF.multiply(DF._invertYScaleMatrix,this.projectionViewMatrix,DF._invertYProjectionViewMatrix),Y=F._projectionMatrix=DF._invertYProjectionMatrix,F._projectionViewMatrix=DF._invertYProjectionViewMatrix):(Y=F._projectionMatrix=this._projectionMatrix,F._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(P,Y),F._viewport=this.viewport,O._preRenderScene(U,F,this.boundFrustum),O._clear(U,F),O._renderScene(U,F),O._postRenderUpdateComponents(F),c&&c.end()},F.viewportPointToRay=function(U,F){jF.calculateCursorRay(U,this.viewport,this._projectionMatrix,this.viewMatrix,null,F)},F.normalizedViewportPointToRay=function(U,F){var O=L._tempVector20,P=this.viewport,Y=U.elements,c=O.elements;c[0]=Y[0]*P.width,c[1]=Y[1]*P.height,jF.calculateCursorRay(O,this.viewport,this._projectionMatrix,this.viewMatrix,null,F)},F.worldToViewportPoint=function(U,F){UF.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(U,this._projectionViewMatrix,F);var O=F.elements;O[0]=O[0]/N.stage.clientScaleX,O[1]=O[1]/N.stage.clientScaleY},F.worldToNormalizedViewportPoint=function(U,F){UF.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(U,this._projectionViewMatrix,F);var O=F.elements;O[0]=O[0]/N.stage.clientScaleX,O[1]=O[1]/N.stage.clientScaleY},F.convertScreenCoordToOrthographicCoord=function(U,F){if(this._orthographic){var O=n.clientWidth,P=n.clientHeight,Y=this.orthographicVerticalSize*this.aspectRatio/O,c=this.orthographicVerticalSize/P,L=U.elements,u=F.elements;return u[0]=(-O/2+L[0])*Y,u[1]=(P/2-L[1])*c,u[2]=(this.nearPlane-this.farPlane)*(L[2]+1)/2-this.nearPlane,LF.transformCoordinate(F,this.transform.worldMatrix,F),!0}return!1},j(0,F,"projectionViewMatrix",function(){return UF.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),j(0,F,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var U=this.viewport;return U.width/U.height},function(U){if(U<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=U,this._calculateProjectionMatrix()}),j(0,F,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),j(0,F,"needViewport",function(){var U=this.normalizedViewport;return 0===U.x&&0===U.y&&1===U.width&&1===U.height}),j(0,F,"viewport",function(){if(this._viewportExpressedInClipSpace){var U=this._normalizedViewport,F=this.renderTargetSize,O=F.width,P=F.height;this._viewport.x=U.x*O,this._viewport.y=U.y*P,this._viewport.width=U.width*O,this._viewport.height=U.height*P}return this._viewport},function(U){if(null!=this.renderTarget&&(U.x<0||U.y<0||0==U.width||0==U.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=U,this._calculateProjectionMatrix()}),j(0,F,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var U=this._viewport,F=this.renderTargetSize,O=F.width,P=F.height;this._normalizedViewport.x=U.x/O,this._normalizedViewport.y=U.y/P,this._normalizedViewport.width=U.width/O,this._normalizedViewport.height=U.height/P}return this._normalizedViewport},function(U){U.x<0&&(U.x=0,console.warn("Camera: viewport.x must large than 0.0.")),U.y<0&&(U.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<U.x+U.width&&(U.width=1-U.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<U.y+U.height&&(U.height=1-U.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=U,this._calculateProjectionMatrix()}),j(0,F,"projectionMatrix",function(){return this._projectionMatrix},function(U){this._projectionMatrix=U,this._useUserProjectionMatrix=!0}),j(0,F,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),z(L,["_tempVector20",function(){return this._tempVector20=new cF}]),L}()),vF=function(O){function P(U,F){P.__super.call(this,F),this._geometryFilter=new iF(this),this._render=new yF(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),U&&(this._geometryFilter.sharedMesh=U)instanceof laya.d3.resource.models.Mesh&&(U.loaded?this._render.sharedMaterials=U.materials:U.once("loaded",this,this._applyMeshMaterials))}w(P,"laya.d3.core.MeshSprite3D",O);var U=P.prototype;return U._changeRenderObjectByMesh=function(U){var F=this._render._renderElements,O=F[U];O||(O=F[U]=new fF),O._render=this._render;var P=this._render.sharedMaterials[U];P||(P=VF.defaultMaterial);var Y=this._geometryFilter.sharedMesh.getRenderElement(U);return O._mainSortID=this._getSortID(Y,P),O._sprite3D=this,O.renderObj=Y,O._material=P,O},U._changeRenderObjectByMaterial=function(U,F){var O=this._render._renderElements[U];F||(F=VF.defaultMaterial);var P=this._geometryFilter.sharedMesh.getRenderElement(U);return O._mainSortID=this._getSortID(P,F),O._sprite3D=this,O.renderObj=P,O._material=F,O},U._changeRenderObjectsByMesh=function(){var U=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=U;for(var F=0;F<U;F++)this._changeRenderObjectByMesh(F)},U._onMeshChanged=function(U){var F=U.sharedMesh;F.loaded?this._changeRenderObjectsByMesh():F.once("loaded",this,this._onMeshLoaded)},U._onMeshLoaded=function(U){U===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},U._onMaterialChanged=function(U,F,O){F<this._render._renderElements.length&&this._changeRenderObjectByMaterial(F,O)},U._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},U._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},U._parseCustomProps=function(U,F,O,P){var Y=this.meshRender,c=O.lightmapIndex;null!=c&&(Y.lightmapIndex=c);var L,u,d=O.lightmapScaleOffset;if(d&&(Y.lightmapScaleOffset=new uF(d[0],d[1],d[2],d[3])),P.instanceParams)(L=P.instanceParams.loadPath)&&(u=H.getRes(F[L]),(this.meshFilter.sharedMesh=u).loaded?Y.sharedMaterials=u.materials:u.once("loaded",this,this._applyMeshMaterials));else{(L=O.meshPath)&&(u=H.getRes(F[L]),this.meshFilter.sharedMesh=u);var a=O.materials;if(a){var b=Y.sharedMaterials,z=a.length;b.length=z;for(var J=0;J<z;J++)b[J]=H.getRes(F[a[J].path]);Y.sharedMaterials=b}}},U._applyMeshMaterials=function(U){for(var F=this._render.sharedMaterials,O=U.materials,P=0,Y=O.length;P<Y;P++)F[P]||(F[P]=O[P]);this._render.sharedMaterials=F},U._addToInitStaticBatchManager=function(){P._staticBatchManager._addInitBatchSprite(this)},U.cloneTo=function(U){var F=U;F._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var O=this._render,P=F._render;P.enable=O.enable,P.sharedMaterials=O.sharedMaterials,P.castShadow=O.castShadow;var Y=O.lightmapScaleOffset;Y&&(P.lightmapScaleOffset=Y.clone()),P.lightmapIndex=O.lightmapIndex,P.receiveShadow=O.receiveShadow,P.sortingFudge=O.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,U)},U.destroy=function(U){if(void 0===U&&(U=!0),!this.destroyed){var F=this.meshFilter.sharedMesh;null!=F&&(F.loaded||F.off("loaded",this,this._applyMeshMaterials)),O.prototype.destroy.call(this,U),this._geometryFilter._destroy()}},j(0,U,"meshFilter",function(){return this._geometryFilter}),j(0,U,"meshRender",function(){return this._render}),P.__init__=function(){PU._staticBatchManagers.push(P._staticBatchManager)},P.load=function(U){return N.loader.create(U,null,null,P)},z(P,["_staticBatchManager",function(){return this._staticBatchManager=new TF}]),P}(ZF)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(U,F){"use strict";for(var O in Object.defineProperty(F,"__esModule",{value:!0}),Laya){var P=Laya[O];P&&P.__isclass&&(F[O]=P)}}),function(U,F,YU){YU.un,YU.uns;var O=YU.static,P=YU.class,c=YU.getset,x=YU.__newvec,u=laya.maths.Bezier,z=laya.utils.Browser,CU=laya.utils.Byte,Y=(laya.events.Event,laya.events.EventDispatcher),L=laya.display.Graphics,d=(laya.resource.HTMLCanvas,laya.utils.Handler),a=laya.net.Loader,J=laya.maths.MathUtil,sU=laya.maths.Matrix,r=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),b=(laya.renders.RenderContext,laya.resource.Resource),w=laya.utils.RunDriver,cU=laya.display.Sprite,j=laya.utils.Stat,iU=laya.resource.Texture,H=(laya.net.URL,laya.utils.Utils),s=function(){function U(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return P(U,"laya.ani.AnimationContent"),U}(),i=function(){function U(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return P(U,"laya.ani.AnimationNodeContent"),U}(),Q=function(){function U(){}return P(U,"laya.ani.AnimationParser01"),U.parse=function(U,F){var O=F.__getBuffer(),P=0,Y=0,c=0,L=0,u=0,d=0,a=0,b=F.readUTFString();U._aniClassName=b;var z,J=F.readUTFString().split("\n"),w=F.getUint8(),j=F.getUint32(),x=F.getUint32();0<j&&(z=O.slice(j,x));var r=new CU(z);for(0<x&&(U._publicExtData=O.slice(x,O.byteLength)),U._useParent=!!F.getUint8(),U._anis.length=w,P=0;P<w;P++){var H=U._anis[P]=new s;H.nodes=new Array;var h=H.name=J[F.getUint16()];U._aniMap[h]=P,H.bone3DMap={},H.playTime=F.getFloat32(),H.playTime<=0&&console.error("播放时间不能为0  url="+U.url+" name="+H.name);var Q=H.nodes.length=F.getUint8();for(Y=H.totalKeyframeDatasLength=0;Y<Q;Y++){var X=H.nodes[Y]=new i;X.childs=[];var N=F.getInt16();0<=N&&(X.name=J[N],H.bone3DMap[X.name]=Y),X.keyFrame=new Array,X.parentIndex=F.getInt16(),-1==X.parentIndex?X.parent=null:X.parent=H.nodes[X.parentIndex],X.lerpType=F.getUint8();var K=F.getUint32();r.pos=K;var f=X.keyframeWidth=r.getUint16();if(H.totalKeyframeDatasLength+=f,0===X.lerpType||1===X.lerpType)for(X.interpolationMethod=[],X.interpolationMethod.length=f,c=0;c<f;c++)X.interpolationMethod[c]=A.interpolation[r.getUint8()];null!=X.parent&&X.parent.childs.push(X);var I=F.getUint16();0<I&&(X.extenData=O.slice(F.pos,F.pos+I),F.pos+=I);var T,g=F.getUint16(),l=0;for(c=0,L=X.keyFrame.length=g;c<L;c++){if((T=X.keyFrame[c]=new y).duration=F.getFloat32(),T.startTime=l,2===X.lerpType){T.interpolationData=[];var $,C=F.getUint8();switch($=F.getFloat32()){case 254:for(T.interpolationData.length=f,a=0;a<f;a++)T.interpolationData[a]=0;break;case 255:for(T.interpolationData.length=f,a=0;a<f;a++)T.interpolationData[a]=5;break;default:for(T.interpolationData.push($),d=1;d<C;d++)T.interpolationData.push(F.getFloat32())}}for(T.data=new Float32Array(f),u=0;u<f;u++)T.data[u]=F.getFloat32(),-1e-8<T.data[u]&&T.data[u]<1e-8&&(T.data[u]=0);l+=T.duration}T.startTime=H.playTime,X.playTime=H.playTime,U._calculateKeyFrame(X,g,f)}}},U}(),X=function(){function N(){}return P(N,"laya.ani.AnimationParser02"),N.READ_DATA=function(){N._DATA.offset=N._reader.getUint32(),N._DATA.size=N._reader.getUint32()},N.READ_BLOCK=function(){for(var U=N._BLOCK.count=N._reader.getUint16(),F=N._BLOCK.blockStarts=[],O=N._BLOCK.blockLengths=[],P=0;P<U;P++)F.push(N._reader.getUint32()),O.push(N._reader.getUint32())},N.READ_STRINGS=function(){var U=N._reader.getUint32(),F=N._reader.getUint16(),O=N._reader.pos;N._reader.pos=U+N._DATA.offset;for(var P=0;P<F;P++)N._strings[P]=N._reader.readUTFString();N._reader.pos=O},N.parse=function(U,F){N._templet=U;(N._reader=F).__getBuffer();N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var O=0,P=N._BLOCK.count;O<P;O++){var Y=F.getUint16(),c=N._strings[Y],L=N["READ_"+c];if(null==L)throw new Error("model file err,no this function:"+Y+" "+c);L.call()}},N.READ_ANIMATIONS=function(){var U=N._reader,F=U.__getBuffer(),O=0,P=0,Y=0,c=0,L=U.getUint16(),u=[];for(u.length=L,O=0;O<L;O++)u[O]=A.interpolation[U.getByte()];var d=U.getUint8();for(N._templet._anis.length=d,O=0;O<d;O++){var a=N._templet._anis[O]={};a.nodes=new Array;var b=a.name=N._strings[U.getUint16()];N._templet._aniMap[b]=O,a.bone3DMap={},a.playTime=U.getFloat32();var z=a.nodes.length=U.getInt16();for(P=a.totalKeyframeDatasLength=0;P<z;P++){var J=a.nodes[P]={};J.keyframeWidth=L,J.childs=[];var w=U.getUint16();0<=w&&(J.name=N._strings[w],a.bone3DMap[J.name]=P),J.keyFrame=new Array,J.parentIndex=U.getInt16(),-1==J.parentIndex?J.parent=null:J.parent=a.nodes[J.parentIndex],a.totalKeyframeDatasLength+=L,J.interpolationMethod=u,null!=J.parent&&J.parent.childs.push(J);var j=U.getUint16(),x=null,r=null;for(Y=0,c=J.keyFrame.length=j;Y<c;Y++){(x=J.keyFrame[Y]={}).startTime=U.getFloat32(),r&&(r.duration=x.startTime-r.startTime);var H=N._DATA.offset,h=U.getUint32(),Q=4*L,X=F.slice(H+h,H+h+Q);x.data=new Float32Array(X),r=x}x.duration=0,J.playTime=a.playTime,N._templet._calculateKeyFrame(J,j,L)}}},N._templet=null,N._reader=null,N._strings=[],O(N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),N}(),yU=(function(){function U(){}P(U,"laya.ani.AnimationState"),U.stopped=0,U.paused=1,U.playing=2}(),function(){function Y(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new ZU,this.resultMatrix=new sU,this._children=[]}P(Y,"laya.ani.bone.Bone");var U=Y.prototype;return U.setTempMatrix=function(U){this._tempMatrix=U;var F,O=0;for(O=0,F=this._children.length;O<F;O++)this._children[O].setTempMatrix(this._tempMatrix)},U.update=function(U){var F;if(this.rotation=this.transform.skX,U)F=this.resultTransform.getMatrix(),sU.mul(F,U,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)F=this.resultTransform.getMatrix(),sU.mul(F,this.parentBone.resultMatrix,this.resultMatrix);else{var O=this.parentBone,P=NaN,Y=NaN,c=NaN,L=this.parentBone.resultMatrix;F=this.resultTransform.getMatrix();var u=L.a*F.tx+L.c*F.ty+L.tx,d=L.b*F.tx+L.d*F.ty+L.ty,a=new sU;this.inheritRotation?(P=Math.atan2(O.resultMatrix.b,O.resultMatrix.a),Y=Math.cos(P),c=Math.sin(P),a.setTo(Y,c,-c,Y,0,0),sU.mul(this._tempMatrix,a,sU.TEMP),sU.TEMP.copyTo(a),F=this.resultTransform.getMatrix(),sU.mul(F,a,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,F=this.resultTransform.getMatrix(),sU.TEMP.identity(),sU.TEMP.d=this.d,sU.mul(F,sU.TEMP,this.resultMatrix)),this.resultMatrix.tx=u,this.resultMatrix.ty=d}else(F=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var b,z=0;for(z=0,b=this._children.length;z<b;z++)this._children[z].update()},U.updateChild=function(){var U,F=0;for(F=0,U=this._children.length;F<U;F++)this._children[F].update()},U.setRotation=function(U){this._sprite&&(this._sprite.rotation=180*U/Math.PI)},U.updateDraw=function(U,F){Y.ShowBones&&!Y.ShowBones[this.name]||(this._sprite||(this._sprite=new cU,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),YU.stage.addChild(this._sprite)),this._sprite.x=U+this.resultMatrix.tx,this._sprite.y=F+this.resultMatrix.ty);var O,P=0;for(P=0,O=this._children.length;P<O;P++)this._children[P].updateDraw(U,F)},U.addChild=function(U){this._children.push(U),U.parentBone=this},U.findBone=function(U){if(this.name==U)return this;var F,O,P=0;for(P=0,F=this._children.length;P<F;P++)if(O=this._children[P].findBone(U))return O;return null},U.localToWorld=function(U){var F=U[0],O=U[1];U[0]=F*this.resultMatrix.a+O*this.resultMatrix.c+this.resultMatrix.tx,U[1]=F*this.resultMatrix.b+O*this.resultMatrix.d+this.resultMatrix.ty},Y.ShowBones={},Y}()),kU=function(){function x(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}P(x,"laya.ani.bone.BoneSlot");var U=x.prototype;return U.showSlotData=function(U,F){void 0===F&&(F=!0),this.currSlotData=U,F&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},U.showDisplayByName=function(U){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(U))},U.replaceDisplayByName=function(U,F){if(this.currSlotData){var O;O=this.currSlotData.getDisplayByName(U);var P;P=this.currSlotData.getDisplayByName(F),this.replaceDisplayByIndex(O,P)}},U.replaceDisplayByIndex=function(U,F){this.currSlotData&&(this._replaceDic[U]=F,this.displayIndex==U&&this.showDisplayByIndex(U))},U.showDisplayByIndex=function(U){if(null!=this._replaceDic[U]&&(U=this._replaceDic[U]),this.currSlotData&&-1<U&&U<this.currSlotData.displayArr.length){if(this.displayIndex=U,this.currDisplayData=this.currSlotData.displayArr[U],this.currDisplayData){var F=this.currDisplayData.name;this.currTexture=this.templet.getTexture(F),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!r.isConchApp||r.isConchApp&&"0.9.15"<cU.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},U.replaceSkin=function(U){this._diyTexture=U,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},U.setParentMatrix=function(U){this._parentMatrix=U},U.draw=function(U,F,O,P){if(void 0===O&&(O=!1),void 0===P&&(P=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var Y,c=this.currTexture;switch(this._diyTexture&&(c=this._diyTexture),this.currDisplayData.type){case 0:if(U){var L=this.getDisplayMatrix();if(this._parentMatrix){var u=!1;if(L){var d;if(sU.mul(L,this._parentMatrix,sU.TEMP),d=O?(null==this._resultMatrix&&(this._resultMatrix=new sU),this._resultMatrix):new sU,!r.isWebGL&&this.currDisplayData.uvs||r.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var a=x._tempMatrix;a.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(a.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(u=!0,a.rotate(-Math.PI/2)),sU.mul(a,sU.TEMP,d)}else sU.TEMP.copyTo(d);u?U.drawTexture(c,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,d):U.drawTexture(c,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,d)}}}break;case 1:if(null==(Y=O?(null==this._skinSprite&&(this._skinSprite=x.createSkinMesh()),this._skinSprite):x.createSkinMesh()))return;var b;if(null==this.currDisplayData.bones){var z,J=this.currDisplayData.weights;this.deformData&&(J=this.deformData),z=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=f.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=f.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=J;this.currDisplayData.triangles.length;b=this.currDisplayData.triangles,Y.init2(c,null,b,this._mVerticleArr,z);var w,j=this.getDisplayMatrix();if(this._parentMatrix)if(j)sU.mul(j,this._parentMatrix,sU.TEMP),w=O?(null==this._resultMatrix&&(this._resultMatrix=new sU),this._resultMatrix):new sU,sU.TEMP.copyTo(w),Y.transform=w}else this.skinMesh(F,Y,P);U.drawSkin(Y);break;case 2:if(null==(Y=O?(null==this._skinSprite&&(this._skinSprite=x.createSkinMesh()),this._skinSprite):x.createSkinMesh()))return;this.skinMesh(F,Y,P),U.drawSkin(Y)}}},U.skinMesh=function(U,F,O){var P,Y=this.currTexture,c=this.currDisplayData.bones;P=this._diyTexture?(Y=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=f.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=f.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var L,u,d=this.currDisplayData.weights,a=this.currDisplayData.triangles,b=0,z=0,J=0,w=NaN,j=NaN,x=0,r=0,H=[],h=0,Q=0;if(this.deformData&&0<this.deformData.length){var X=0;for(h=0,Q=c.length;h<Q;){for(J=c[h++]+h,z=b=0;h<J;h++)u=U[c[h]],w=d[x]+this.deformData[X++],j=d[x+1]+this.deformData[X++],r=d[x+2],b+=(w*u.a+j*u.c+u.tx)*r,z+=(w*u.b+j*u.d+u.ty)*r,x+=3;H.push(b,z)}}else for(h=0,Q=c.length;h<Q;){for(J=c[h++]+h,z=b=0;h<J;h++)u=U[c[h]],w=d[x],j=d[x+1],r=d[x+2],b+=(w*u.a+j*u.c+u.tx)*r,z+=(w*u.b+j*u.d+u.ty)*r,x+=3;H.push(b,z)}this._mVerticleArr=H,L=a,F.init2(Y,null,L,this._mVerticleArr,P)},U.drawBonePoint=function(U){U&&this._parentMatrix&&U.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},U.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},U.getMatrix=function(){return this._resultMatrix},U.copy=function(){var U=new x;return U.type="copy",U.name=this.name,U.attachmentName=this.attachmentName,U.srcDisplayIndex=this.srcDisplayIndex,U.parent=this.parent,U.displayIndex=this.displayIndex,U.templet=this.templet,U.currSlotData=this.currSlotData,U.currTexture=this.currTexture,U.currDisplayData=this.currDisplayData,U},x.createSkinMesh=function(){return r.isWebGL||r.isConchApp?w.skinAniSprite():(r.isWebGL,null)},O(x,["_tempMatrix",function(){return this._tempMatrix=new sU}]),x}(),AU=function(){function U(){this.skinName=null,this.deformSlotDataList=[]}return P(U,"laya.ani.bone.DeformAniData"),U}(),GU=function(){function U(){this.deformSlotDisplayList=[]}return P(U,"laya.ani.bone.DeformSlotData"),U}(),VU=function(){function U(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}P(U,"laya.ani.bone.DeformSlotDisplayData");var F=U.prototype;return F.binarySearch1=function(U,F){var O=0,P=U.length-2;if(0==P)return 1;for(var Y=P>>>1;;){if(U[Math.floor(Y+1)]<=F?O=Y+1:P=Y,O==P)return O+1;Y=O+P>>>1}return 0},F.apply=function(U,F,O){if(void 0===O&&(O=1),U+=.05,!(this.timeList.length<=0)){var P=0;if(!(U<this.timeList[0])){var Y=this.vectices[0].length,c=[],L=this.binarySearch1(this.timeList,U);if(this.frameIndex=L,U>=this.timeList[this.timeList.length-1]){var u=this.vectices[this.vectices.length-1];if(O<1)for(P=0;P<Y;P++)c[P]+=(u[P]-c[P])*O;else for(P=0;P<Y;P++)c[P]=u[P];this.deformData=c}else{this.tweenKeyList[this.frameIndex];var d=this.vectices[this.frameIndex-1],a=this.vectices[this.frameIndex],b=this.timeList[this.frameIndex-1],z=this.timeList[this.frameIndex];O=this.tweenKeyList[L-1]?(U-b)/(z-b):0;var J=NaN;for(P=0;P<Y;P++)J=d[P],c[P]=J+(a[P]-J)*O;this.deformData=c}}}},U}(),MU=function(){function U(){this.time=NaN,this.drawOrder=[]}return P(U,"laya.ani.bone.DrawOrderData"),U}(),mU=function(){function U(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return P(U,"laya.ani.bone.EventData"),U}(),h=function(){function PU(U,F){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=U,this._targetBone=F[U.targetBoneIndex],this.isSpine=U.isSpine,null==this._bones&&(this._bones=[]);for(var O=this._bones.length=0,P=U.boneIndexs.length;O<P;O++)this._bones.push(F[U.boneIndexs[O]]);this.name=U.name,this.mix=U.mix,this.bendDirection=U.bendDirection}P(PU,"laya.ani.bone.IkConstraint");var U=PU.prototype;return U.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},U._applyIk1=function(U,F,O,P){var Y=U.parentBone,c=1/(Y.resultMatrix.a*Y.resultMatrix.d-Y.resultMatrix.b*Y.resultMatrix.c),L=F-Y.resultMatrix.tx,u=O-Y.resultMatrix.ty,d=(L*Y.resultMatrix.d-u*Y.resultMatrix.c)*c-U.transform.x,a=(u*Y.resultMatrix.a-L*Y.resultMatrix.b)*c-U.transform.y,b=Math.atan2(a,d)*PU.radDeg-0-U.transform.skX;U.transform.scX<0&&(b+=180),180<b?b-=360:b<-180&&(b+=360),U.transform.skX=U.transform.skY=U.transform.skX+b*P,U.update()},U.updatePos=function(U,F){this._sp&&this._sp.pos(U,F)},U._applyIk2=function(U,F,O,P,Y,c){if(0!=c){var L=U.resultTransform.x,u=U.resultTransform.y,d=U.transform.scX,a=U.transform.scY,b=F.transform.scX,z=0,J=0,w=0;w=d<0?(d=-d,z=180,-1):(z=0,1),a<0&&(a=-a,w=-w),J=b<0?(b=-b,180):0;var j=F.resultTransform.x,x=NaN,r=NaN,H=NaN,h=U.resultMatrix.a,Q=U.resultMatrix.c,X=U.resultMatrix.b,N=U.resultMatrix.d,K=Math.abs(d-a)<=1e-4;H=K?(r=h*j+Q*(x=F.resultTransform.y)+U.resultMatrix.tx,X*j+N*x+U.resultMatrix.ty):(x=0,r=h*j+U.resultMatrix.tx,X*j+U.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new cU,YU.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(O,P,15,"#ffff00"),this._sp.graphics.drawCircle(r,H,15,"#ff00ff")),U.setRotation(Math.atan2(H-U.resultMatrix.ty,r-U.resultMatrix.tx));var f=U.parentBone;h=f.resultMatrix.a,Q=f.resultMatrix.c,X=f.resultMatrix.b;var I=1/(h*(N=f.resultMatrix.d)-Q*X),T=O-f.resultMatrix.tx,g=P-f.resultMatrix.ty,l=(T*N-g*Q)*I-L,$=(g*h-T*X)*I-u,C=((T=r-f.resultMatrix.tx)*N-(g=H-f.resultMatrix.ty)*Q)*I-L,s=(g*h-T*X)*I-u,i=Math.sqrt(C*C+s*s),y=F.length*b,k=NaN,A=NaN;if(K){var G=(l*l+$*$-i*i-(y*=d)*y)/(2*i*y);G<-1?G=-1:1<G&&(G=1),A=Math.acos(G)*Y,h=i+y*G,Q=y*Math.sin(A),k=Math.atan2($*h-l*Q,l*h+$*Q)}else{var V=(h=d*y)*h,M=(Q=a*y)*Q,m=l*l+$*$,p=Math.atan2($,l),o=-2*M*i,R=M-V;if(0<(N=o*o-4*R*(X=M*i*i+V*m-V*M))){var _=Math.sqrt(N);o<0&&(_=-_);var q=(_=-(o+_)/2)/R,D=X/_,Z=Math.abs(q)<Math.abs(D)?q:D;Z*Z<=m&&(g=Math.sqrt(m-Z*Z)*Y,k=p-Math.atan2(g,Z),A=Math.atan2(g/a,(Z-i)/d))}var e=0,v=Number.MAX_VALUE,n=0,t=0,S=0,W=0,B=0,E=0;W<(N=(T=i+h)*T)&&(S=0,W=N,B=T),(N=(T=i-h)*T)<v&&(e=Math.PI,v=N,n=T);var UU=Math.acos(-h*i/(V-M));(N=(T=h*Math.cos(UU)+i)*T+(g=Q*Math.sin(UU))*g)<v&&(e=UU,v=N,n=T,t=g),W<N&&(S=UU,W=N,B=T,E=g),A=m<=(v+W)/2?(k=p-Math.atan2(t*Y,n),e*Y):(k=p-Math.atan2(E*Y,B),S*Y)}var FU=Math.atan2(x,j)*w,OU=U.resultTransform.skX;180<(k=(k-FU)*PU.radDeg+z-OU)?k-=360:k<-180&&(k+=360),U.resultTransform.x=L,U.resultTransform.y=u,U.resultTransform.skX=U.resultTransform.skY=OU+k*c,OU=F.resultTransform.skX,180<(A=((A+FU)*PU.radDeg-0)*w+J-(OU%=360))?A-=360:A<-180&&(A+=360),F.resultTransform.x=j,F.resultTransform.y=x,F.resultTransform.skX=F.resultTransform.skY=F.resultTransform.skY+A*c,U.update()}},U._applyIk3=function(U,F,O,P,Y,c){if(0!=c){var L,u,d=F.resultMatrix.a*F.length,a=F.resultMatrix.b*F.length,b=d*d+a*a,z=Math.sqrt(b),J=U.resultMatrix.tx,w=U.resultMatrix.ty,j=F.resultMatrix.tx,x=F.resultMatrix.ty,r=j-J,H=x-w,h=r*r+H*H,Q=Math.sqrt(h),X=(r=O-U.resultMatrix.tx)*r+(H=P-U.resultMatrix.ty)*H,N=Math.sqrt(X);if(z+Q<=N||N+z<=Q||N+Q<=z){var K=NaN;j=J+(K=z+Q<=N?1:-1)*(O-J)*Q/N,x=w+K*(P-w)*Q/N}else{var f=(h-b+X)/(2*X),I=Math.sqrt(h-f*f*X)/N,T=J+r*f,g=w+H*f,l=-H*I,$=r*I;x=0<Y?(j=T-l,g-$):(j=T+l,g+$)}L=j,u=x,this.isDebug&&(this._sp||(this._sp=new cU,YU.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(J,w,15,"#ff00ff"),this._sp.graphics.drawCircle(O,P,15,"#ffff00"),this._sp.graphics.drawCircle(L,u,15,"#ff00ff"));var C,s;C=Math.atan2(u-U.resultMatrix.ty,L-U.resultMatrix.tx),U.setRotation(C),(s=PU._tempMatrix).identity(),s.rotate(C),s.scale(U.resultMatrix.getScaleX(),U.resultMatrix.getScaleY()),s.translate(U.resultMatrix.tx,U.resultMatrix.ty),s.copyTo(U.resultMatrix),U.updateChild();var i,y;i=Math.atan2(P-u,O-L),F.setRotation(i),(y=PU._tempMatrix).identity(),y.rotate(i),y.scale(F.resultMatrix.getScaleX(),F.resultMatrix.getScaleY()),y.translate(L,u),s.copyTo(F.resultMatrix),F.updateChild()}},O(PU,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new sU}]),PU}(),pU=function(){function U(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return P(U,"laya.ani.bone.IkConstraintData"),U}(),N=function(){function y(U,F){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=U,this.position=U.position,this.spacing=U.spacing,this.rotateMix=U.rotateMix,this.translateMix=U.translateMix,this.bones=[];for(var O=this.data.bones,P=0,Y=O.length;P<Y;P++)this.bones.push(F[O[P]])}P(y,"laya.ani.bone.PathConstraint");var U=y.prototype;return U.apply=function(U,F){if(this.target){var O=this.translateMix,P=this.translateMix,Y=0<P,c=this.data.spacingMode,L="length"==c,u=this.data.rotateMode,d="tangent"==u,a="chainScale"==u,b=[],z=this.bones.length,J=d?z:z+1,w=[];(this._spaces=w)[0]=this.position;var j=this.spacing;if(a||L)for(var x=0,r=J-1;x<r;){var H=this.bones[x],h=H.length,Q=h*H.resultMatrix.a,X=h*H.resultMatrix.b;h=Math.sqrt(Q*Q+X*X),a&&(b[x]=h),w[++x]=L?Math.max(0,h+j):j}else for(x=1;x<J;x++)w[x]=j;var N=this.computeWorldPositions(this.target,U,F,J,d,"percent"==this.data.positionMode,"percent"==c);if(this._debugKey){for(x=0;x<N.length;x++)F.drawCircle(N[x++],N[x++],5,"#00ff00");var K=[];for(x=0;x<N.length;x++)K.push(N[x++],N[x++]);F.drawLines(0,0,K,"#ff0000")}var f=N[0],I=N[1],T=this.data.offsetRotation,g="chain"==u&&0==T,l=NaN;for(x=0,l=3;x<z;x++,l+=3){(H=this.bones[x]).resultMatrix.tx+=(f-H.resultMatrix.tx)*O,H.resultMatrix.ty+=(I-H.resultMatrix.ty)*O;var $=(Q=N[l])-f,C=(X=N[l+1])-I;if(a&&0!=(h=b[x])){var s=(Math.sqrt($*$+C*C)/h-1)*P+1;H.resultMatrix.a*=s,H.resultMatrix.c*=s}if(f=Q,I=X,Y){var i=H.resultMatrix.a,y=H.resultMatrix.c,k=H.resultMatrix.b,A=H.resultMatrix.d,G=NaN,V=NaN,M=NaN;G=d?N[l-1]:0==w[x+1]?N[l+2]:Math.atan2(C,$),G-=Math.atan2(k,i)-T/180*Math.PI,g&&(V=Math.cos(G),M=Math.sin(G),f+=((h=H.length)*(V*i-M*k)-$)*P,I+=(h*(M*i+V*k)-C)*P),G>Math.PI?G-=2*Math.PI:G<-Math.PI&&(G+=2*Math.PI),G*=P,V=Math.cos(G),M=Math.sin(G),H.resultMatrix.a=V*i-M*k,H.resultMatrix.c=V*y-M*A,H.resultMatrix.b=M*i+V*k,H.resultMatrix.d=M*y+V*A}}}},U.computeWorldVertices2=function(U,F,O,P,Y,c){var L,u,d=U.currDisplayData.bones,a=U.currDisplayData.weights,b=U.currDisplayData.triangles,z=0,J=0,w=0,j=0,x=0,r=0,H=0,h=0,Q=0,X=0,N=0;if(null!=d){for(z=0;z<O;z+=2)J+=(j=d[J])+1,w+=j;var K=F;for(x=c,r=3*w;x<P;x+=2){for(h=H=0,j=d[J++],j+=J;J<j;J++,r+=3){L=K[d[J]].resultMatrix,Q=a[r],X=a[r+1];var f=a[r+2];H+=(Q*L.a+X*L.c+L.tx)*f,h+=(Q*L.b+X*L.d+L.ty)*f}Y[x]=H,Y[x+1]=h}}else{var I,T;if(b||(b=a),U.deformData&&(b=U.deformData),I=U.parent,F)for(N=F.length,z=0;z<N;z++)if(F[z].name==I){u=F[z];break}u&&(T=u.resultMatrix),T||(T=y._tempMt);var g=T.tx,l=T.ty,$=T.a,C=T.b,s=T.c,i=T.d;for(u&&(i*=u.d),J=O,x=c;x<P;J+=2,x+=2)Q=b[J],X=b[J+1],Y[x]=Q*$+X*C+g,Y[x+1]=-(Q*s+X*i+l)}},U.computeWorldPositions=function(U,F,O,P,Y,c,L){U.currDisplayData.bones,U.currDisplayData.weights,U.currDisplayData.triangles;var u=[],d=0,a=U.currDisplayData.verLen,b=this.position,z=this._spaces,J=[],w=[],j=a/6,x=-1,r=NaN,H=0,h=0,Q=NaN,X=NaN,N=NaN,K=NaN;if(j--,a-=4,this.computeWorldVertices2(U,F,2,a,u,0),this._debugKey)for(d=0;d<u.length;)O.drawCircle(u[d++],u[d++],10,"#ff0000");J=u,this._curves.length=j;var f=this._curves,I=J[r=0],T=J[1],g=0,l=0,$=0,C=0,s=0,i=0,y=NaN,k=NaN,A=NaN,G=NaN,V=NaN,M=NaN,m=NaN,p=NaN,o=0;for(d=0,o=2;d<j;d++,o+=6)g=J[o],l=J[o+1],$=J[o+2],C=J[o+3],V=2*(y=.1875*(I-2*g+$))+(A=.09375*(3*(g-$)-I+(s=J[o+4]))),M=2*(k=.1875*(T-2*l+C))+(G=.09375*(3*(l-C)-T+(i=J[o+5]))),m=.75*(g-I)+y+.16666667*A,p=.75*(l-T)+k+.16666667*G,r+=Math.sqrt(m*m+p*p),m+=V,p+=M,V+=A,M+=G,r+=Math.sqrt(m*m+p*p),m+=V,p+=M,r+=Math.sqrt(m*m+p*p),m+=V+A,p+=M+G,r+=Math.sqrt(m*m+p*p),f[d]=r,I=s,T=i;if(c&&(b*=r),L)for(d=0;d<P;d++)z[d]*=r;var R=this._segments,_=0,q=0;for(q=h=H=d=0;d<P;d++,H+=3)if((Q=b+=X=z[d])<0)this.addBeforePosition(Q,J,0,w,H);else if(r<Q)this.addAfterPosition(Q-r,J,a-4,w,H);else{for(;;h++)if(!((K=f[h])<Q)){0==h?Q/=K:Q=(Q-(N=f[h-1]))/(K-N);break}if(h!=x){var D=6*(x=h);for(I=J[D],T=J[D+1],g=J[D+2],l=J[D+3],$=J[D+4],C=J[D+5],V=2*(y=.03*(I-2*g+$))+(A=.006*(3*(g-$)-I+(s=J[D+6]))),M=2*(k=.03*(T-2*l+C))+(G=.006*(3*(l-C)-T+(i=J[D+7]))),m=.3*(g-I)+y+.16666667*A,p=.3*(l-T)+k+.16666667*G,_=Math.sqrt(m*m+p*p),R[0]=_,D=1;D<8;D++)m+=V,p+=M,V+=A,M+=G,_+=Math.sqrt(m*m+p*p),R[D]=_;m+=V,p+=M,_+=Math.sqrt(m*m+p*p),R[8]=_,m+=V+A,p+=M+G,_+=Math.sqrt(m*m+p*p),R[9]=_,q=0}for(Q*=_;;q++)if(!((K=R[q])<Q)){0==q?Q/=K:Q=q+(Q-(N=R[q-1]))/(K-N);break}this.addCurvePosition(.1*Q,I,T,g,l,$,C,s,i,w,H,Y||0<d&&0==X)}return w},U.addBeforePosition=function(U,F,O,P,Y){var c=F[O],L=F[O+1],u=F[O+2]-c,d=F[O+3]-L,a=Math.atan2(d,u);P[Y]=c+U*Math.cos(a),P[Y+1]=L+U*Math.sin(a),P[Y+2]=a},U.addAfterPosition=function(U,F,O,P,Y){var c=F[O+2],L=F[O+3],u=c-F[O],d=L-F[O+1],a=Math.atan2(d,u);P[Y]=c+U*Math.cos(a),P[Y+1]=L+U*Math.sin(a),P[Y+2]=a},U.addCurvePosition=function(U,F,O,P,Y,c,L,u,d,a,b,z){0==U&&(U=1e-4);var J=U*U,w=J*U,j=1-U,x=j*j,r=x*j,H=j*U,h=3*H,Q=j*h,X=h*U,N=F*r+P*Q+c*X+u*w,K=O*r+Y*Q+L*X+d*w;a[b]=N,a[b+1]=K,a[b+2]=z?Math.atan2(K-(O*x+Y*H*2+L*J),N-(F*x+P*H*2+c*J)):0},y.NONE=-1,y.BEFORE=-2,y.AFTER=-3,O(y,["_tempMt",function(){return this._tempMt=new sU}]),y}(),oU=function(){function U(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return P(U,"laya.ani.bone.PathConstraintData"),U}(),RU=function(){function U(){this.name=null,this.slotArr=[]}return P(U,"laya.ani.bone.SkinData"),U}(),_U=function(){function U(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}P(U,"laya.ani.bone.SkinSlotDisplayData");var F=U.prototype;return F.createTexture=function(U){return this.texture||(this.texture=new iU(U.bitmap,this.uvs),U.bitmap.alphaTexture&&(this.texture.alphaTexture=new iU(U.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=U.height,this.texture.height=U.width,this.texture.offsetX=-U.offsetX,this.texture.offsetY=-U.offsetY,this.texture.sourceWidth=U.sourceHeight,this.texture.sourceHeight=U.sourceWidth):(this.texture.width=U.width,this.texture.height=U.height,this.texture.offsetX=-U.offsetX,this.texture.offsetY=-U.offsetY,this.texture.sourceWidth=U.sourceWidth,this.texture.sourceHeight=U.sourceHeight),r.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},F.destory=function(){this.texture&&this.texture.destroy()},U}(),qU=function(){function U(){this.name=null,this.displayArr=[]}return P(U,"laya.ani.bone.SlotData"),U.prototype.getDisplayByName=function(U){for(var F=0,O=this.displayArr.length;F<O;F++)if(this.displayArr[F].attachmentName==U)return F;return-1},U}(),K=function(){function U(U,F){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=x(2,0),this._data=U,null==this._bones&&(this._bones=[]),this.target=F[U.targetIndex];var O,P=0;for(P=0,O=U.boneIndexs.length;P<O;P++)this._bones.push(F[U.boneIndexs[P]]);this.rotateMix=U.rotateMix,this.translateMix=U.translateMix,this.scaleMix=U.scaleMix,this.shearMix=U.shearMix}return P(U,"laya.ani.bone.TfConstraint"),U.prototype.apply=function(){for(var U,F=this.target.resultMatrix.a,O=this.target.resultMatrix.b,P=this.target.resultMatrix.c,Y=this.target.resultMatrix.d,c=0,L=this._bones.length;c<L;c++){if(U=this._bones[c],0<this.rotateMix){var u=U.resultMatrix.a,d=U.resultMatrix.b,a=U.resultMatrix.c,b=U.resultMatrix.d,z=Math.atan2(P,F)-Math.atan2(a,u)+this._data.offsetRotation*Math.PI/180;z>Math.PI?z-=2*Math.PI:z<-Math.PI&&(z+=2*Math.PI),z*=this.rotateMix;var J=Math.cos(z),w=Math.sin(z);U.resultMatrix.a=J*u-w*a,U.resultMatrix.b=J*d-w*b,U.resultMatrix.c=w*u+J*a,U.resultMatrix.d=w*d+J*b}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),U.resultMatrix.tx+=(this._temp[0]-U.resultMatrix.tx)*this.translateMix,U.resultMatrix.ty+=(this._temp[1]-U.resultMatrix.ty)*this.translateMix,U.updateChild()),0<this.scaleMix){var j=Math.sqrt(U.resultMatrix.a*U.resultMatrix.a+U.resultMatrix.c*U.resultMatrix.c),x=Math.sqrt(F*F+P*P),r=1e-5<j?(j+(x-j+this._data.offsetScaleX)*this.scaleMix)/j:0;U.resultMatrix.a*=r,U.resultMatrix.c*=r,j=Math.sqrt(U.resultMatrix.b*U.resultMatrix.b+U.resultMatrix.d*U.resultMatrix.d),x=Math.sqrt(O*O+Y*Y),r=1e-5<j?(j+(x-j+this._data.offsetScaleY)*this.scaleMix)/j:0,U.resultMatrix.b*=r,U.resultMatrix.d*=r}if(0<this.shearMix){d=U.resultMatrix.b,b=U.resultMatrix.d;var H=Math.atan2(b,d);(z=Math.atan2(Y,O)-Math.atan2(P,F)-(H-Math.atan2(U.resultMatrix.c,U.resultMatrix.a)))>Math.PI?z-=2*Math.PI:z<-Math.PI&&(z+=2*Math.PI),z=H+(z+this._data.offsetShearY*Math.PI/180)*this.shearMix,r=Math.sqrt(d*d+b*b),U.resultMatrix.b=Math.cos(z)*r,U.resultMatrix.d=Math.sin(z)*r}}},U}(),DU=function(){function U(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return P(U,"laya.ani.bone.TfConstraintData"),U}(),ZU=function(){function U(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}P(U,"laya.ani.bone.Transform");var F=U.prototype;return F.initData=function(U){null!=U.x&&(this.x=U.x),null!=U.y&&(this.y=U.y),null!=U.skX&&(this.skX=U.skX),null!=U.skY&&(this.skY=U.skY),null!=U.scX&&(this.scX=U.scX),null!=U.scY&&(this.scY=U.scY)},F.getMatrix=function(){var U;return(U=this.mMatrix?this.mMatrix:this.mMatrix=new sU).identity(),U.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(U,this.skewX*Math.PI/180,this.skewY*Math.PI/180),U.rotate(this.skX*Math.PI/180),U.translate(this.x,this.y),U},F.skew=function(U,F,O){var P=Math.sin(O),Y=Math.cos(O),c=Math.sin(F),L=Math.cos(F);return U.setTo(U.a*L-U.b*P,U.a*c+U.b*Y,U.c*L-U.d*P,U.c*c+U.d*Y,U.tx*L-U.ty*P,U.tx*c+U.ty*Y),U},U}(),f=function(){function U(){}return P(U,"laya.ani.bone.UVTools"),U.getRelativeUV=function(U,F,O){var P=U[0],Y=U[2]-U[0],c=U[1],L=U[5]-U[1];O||(O=[]),O.length=F.length;var u,d=0;u=O.length;var a=1/Y,b=1/L;for(d=0;d<u;d+=2)O[d]=(F[d]-P)*a,O[d+1]=(F[d+1]-c)*b;return O},U.getAbsoluteUV=function(U,F,O){if(0==U[0]&&0==U[1]&&1==U[4]&&1==U[5])return O?(H.copyArray(O,F),O):F;var P=U[0],Y=U[2]-U[0],c=U[1],L=U[5]-U[1];O||(O=[]),O.length=F.length;var u,d=0;for(u=O.length,d=0;d<u;d+=2)O[d]=F[d]*Y+P,O[d+1]=F[d+1]*L+c;return O},U}(),y=function(){function U(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return P(U,"laya.ani.KeyFramesContent"),U}(),I=function(){function b(){}return P(b,"laya.ani.math.BezierLerp"),b.getBezierRate=function(U,F,O,P,Y){var c=b._getBezierParamKey(F,O,P,Y),L=100*c+U;if(b._bezierResultCache[L])return b._bezierResultCache[L];var u,d=b._getBezierPoints(F,O,P,Y,c),a=0;for(u=d.length,a=0;a<u;a+=2)if(U<=d[a])return b._bezierResultCache[L]=d[a+1],d[a+1];return b._bezierResultCache[L]=1},b._getBezierParamKey=function(U,F,O,P){return 100*(100*(100*(100*U+F)+O)+P)},b._getBezierPoints=function(U,F,O,P,Y){return b._bezierPointsCache[Y]?b._bezierPointsCache[Y]:(c=[0,0,U,F,O,P,1,1],L=(new u).getBezierPoints(c,100,3),b._bezierPointsCache[Y]=L);var c,L},b._bezierResultCache={},b._bezierPointsCache={},b}(),T=function(U){function F(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,F.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}P(F,"laya.ani.AnimationPlayer",Y);var O=F.prototype;return YU.imps(O,{"laya.resource.IDestroy":!0}),O._onTempletLoadedComputeFullKeyframeIndices=function(U,F,O){this._templet===O&&this._cachePlayRate===U&&this._cacheFrameRate===F&&this._computeFullKeyframeIndices()},O._computeFullKeyframeIndices=function(){for(var U=this._fullFrames=[],F=this._templet,O=this._cacheFrameRateInterval*this._cachePlayRate,P=0,Y=F.getAnimationCount();P<Y;P++){for(var c=[],L=0,u=F.getAnimation(P).nodes.length;L<u;L++){for(var d=F.getAnimation(P).nodes[L],a=Math.floor(d.playTime/O+.01),b=new Uint16Array(a+1),z=-1,J=0,w=d.keyFrame.length;J<w;J++){var j=d.keyFrame[J],x=j.startTime,r=x+j.duration+O;do{for(var H=Math.floor(x/O+.5),h=z+1;h<H;h++)b[h]=J;b[z=H]=J,x+=O}while(x<=r)}c.push(b)}U.push(c)}},O._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},O._calculatePlayDuration=function(){if(0!==this.state){var U=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=U),this._playEnd>U&&(this._playEnd=U),this._playDuration=this._playEnd-this._playStart}},O._setPlayParams=function(U,F){this._currentTime=U,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/F+.01),0),this._currentFrameTime=this._currentKeyframeIndex*F},O._setPlayParamsWhenStop=function(U,F){this._currentTime=U,this._currentKeyframeIndex=Math.max(Math.floor(U/F+.01),0),this._currentFrameTime=this._currentKeyframeIndex*F,this._currentAnimationClipIndex=-1},O._update=function(U){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var F=this._cacheFrameRateInterval*this._cachePlayRate,O=0;this._startUpdateLoopCount!==j.loopCount&&(O=U*this.playbackRate,this._elapsedPlaybackTime+=O);var P=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=P)return this._setPlayParamsWhenStop(P,F),void this.event("stopped");if(O+=this._currentTime,0<P)if(P<=O)do{if(O-=P,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(P,F),this._stopWhenCircleFinish=!1,void this.event("stopped");O<P&&(this._setPlayParams(O,F),this.event("complete"))}while(P<=O);else this._setPlayParams(O,F);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(P,F),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},O._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},O.play=function(U,F,O,P,Y){if(void 0===U&&(U=0),void 0===F&&(F=1),void 0===O&&(O=2147483647),void 0===P&&(P=0),void 0===Y&&(Y=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(O<0||P<0||Y<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==Y&&Y<P)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=F,this._overallDuration=O,this._playStart=P,this._playEnd=Y,this._paused=!1,this._currentAnimationClipIndex=U,this._currentKeyframeIndex=0,this._startUpdateLoopCount=j.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},O.playByFrame=function(U,F,O,P,Y,c){void 0===U&&(U=0),void 0===F&&(F=1),void 0===O&&(O=2147483647),void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===c&&(c=30);var L=1e3/c;this.play(U,F,O,P*L,Y*L)},O.stop=function(U){void 0===U&&(U=!0),U?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},c(0,O,"playEnd",function(){return this._playEnd}),c(0,O,"templet",function(){return this._templet},function(U){0===!this.state&&this.stop(!0),this._templet!==U&&((this._templet=U).loaded?this._computeFullKeyframeIndices():U.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),c(0,O,"playStart",function(){return this._playStart}),c(0,O,"playDuration",function(){return this._playDuration}),c(0,O,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),c(0,O,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),c(0,O,"overallDuration",function(){return this._overallDuration}),c(0,O,"currentFrameTime",function(){return this._currentFrameTime}),c(0,O,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),c(0,O,"currentPlayTime",function(){return this._currentTime+this._playStart}),c(0,O,"cachePlayRate",function(){return this._cachePlayRate},function(U){this._cachePlayRate!==U&&(this._cachePlayRate=U,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[U,this._cacheFrameRate])))}),c(0,O,"cacheFrameRate",function(){return this._cacheFrameRate},function(U){this._cacheFrameRate!==U&&(this._cacheFrameRate=U,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,U])))}),c(0,O,"currentTime",null,function(U){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(U<this._playStart||U>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=j.loopCount;var F=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=U,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/F),0),this._currentFrameTime=this._currentKeyframeIndex*F}}),c(0,O,"paused",function(){return this._paused},function(U){(this._paused=U)&&this.event("paused")}),c(0,O,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),c(0,O,"destroyed",function(){return this._destroyed}),F}(),k=function(U){function F(){F.__super.call(this),r.isConchNode&&(this.drawSkin=function(U){U.transform||(U.transform=sU.EMPTY),this._addCmd([U]),this.setSkinMesh&&this.setSkinMesh(U._ps,U.mVBData,U.mEleNum,0,U.mTexture,U.transform)})}return P(F,"laya.ani.GraphicsAni",L),F.prototype.drawSkin=function(U){var F=[U];this._saveToCmd(r._context._drawSkin,F)},F.create=function(){return F._caches.pop()||new F},F.recycle=function(U){U.clear(),F._caches.push(U)},F._caches=[],F}(),A=function(U){function h(){this._aniMap={},this.unfixedLastAniIndex=-1,h.__super.call(this),this._anis=new Array}P(h,"laya.ani.AnimationTemplet",b);var F=h.prototype;return F.parse=function(U){var F=new CU(U);this._aniVersion=F.readUTFString(),Q.parse(this,F)},F._calculateKeyFrame=function(U,F,O){var P=U.keyFrame;P[F]=P[0];for(var Y=0;Y<F;Y++){var c=P[Y];c.nextData=0===c.duration?c.data:P[Y+1].data}P.length--},F.onAsynLoaded=function(U,F,O){var P=new CU(F);switch(this._aniVersion=P.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":X.parse(this,P);break;default:Q.parse(this,P)}this._endLoaded()},F.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},F.getAnimationCount=function(){return this._anis.length},F.getAnimation=function(U){return this._anis[U]},F.getAniDuration=function(U){return this._anis[U].playTime},F.getNodes=function(U){return this._anis[U].nodes},F.getNodeIndexWithName=function(U,F){return this._anis[U].bone3DMap[F]},F.getNodeCount=function(U){return this._anis[U].nodes.length},F.getTotalkeyframesLength=function(U){return this._anis[U].totalKeyframeDatasLength},F.getPublicExtData=function(){return this._publicExtData},F.getAnimationDataWithCache=function(U,F,O,P){var Y=F[O];if(Y){var c=Y[U];return c?c[P]:null}return null},F.setAnimationDataWithCache=function(U,F,O,P,Y){var c=F[O]||(F[O]={});(c[U]||(c[U]=[]))[P]=Y},F.getOriginalData=function(U,F,O,P,Y){for(var c=this._anis[U].nodes,L=0,u=0,d=c.length,a=0;u<d;u++){var b,z=c[u];b=z.keyFrame[O[u][P]],z.dataOffset=a;var J=Y-b.startTime,w=z.lerpType;if(w)switch(w){case 0:case 1:for(L=0;L<z.keyframeWidth;)L+=z.interpolationMethod[L](z,L,F,a+L,b.data,J,null,b.duration,b.nextData);break;case 2:var j=b.interpolationData,x=j.length,r=0;for(L=0;L<x;){var H=j[L];switch(H){case 6:case 7:L+=h.interpolation[H](z,r,F,a+r,b.data,J,null,b.duration,b.nextData,j,L+1);break;default:L+=h.interpolation[H](z,r,F,a+r,b.data,J,null,b.duration,b.nextData)}r++}}else for(L=0;L<z.keyframeWidth;)L+=z.interpolationMethod[L](z,L,F,a+L,b.data,J,null,b.duration,b.nextData);a+=z.keyframeWidth}},F.getNodesCurrentFrameIndex=function(U,F){var O=this._anis[U].nodes;U!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(O.length),this.unfixedCurrentTimes=new Float32Array(O.length),this.unfixedLastAniIndex=U);for(var P=0,Y=O.length;P<Y;P++){var c=O[P];for(F<this.unfixedCurrentTimes[P]&&(this.unfixedCurrentFrameIndexes[P]=0),this.unfixedCurrentTimes[P]=F;this.unfixedCurrentFrameIndexes[P]<c.keyFrame.length&&!(c.keyFrame[this.unfixedCurrentFrameIndexes[P]].startTime>this.unfixedCurrentTimes[P]);)this.unfixedCurrentFrameIndexes[P]++;this.unfixedCurrentFrameIndexes[P]--}return this.unfixedCurrentFrameIndexes},F.getOriginalDataUnfixedRate=function(U,F,O){var P=this._anis[U].nodes;U!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(P.length),this.unfixedCurrentTimes=new Float32Array(P.length),this.unfixedKeyframes=x(P.length),this.unfixedLastAniIndex=U);for(var Y=0,c=0,L=P.length,u=0;c<L;c++){var d=P[c];for(O<this.unfixedCurrentTimes[c]&&(this.unfixedCurrentFrameIndexes[c]=0),this.unfixedCurrentTimes[c]=O;this.unfixedCurrentFrameIndexes[c]<d.keyFrame.length&&!(d.keyFrame[this.unfixedCurrentFrameIndexes[c]].startTime>this.unfixedCurrentTimes[c]);)this.unfixedKeyframes[c]=d.keyFrame[this.unfixedCurrentFrameIndexes[c]],this.unfixedCurrentFrameIndexes[c]++;var a=this.unfixedKeyframes[c];d.dataOffset=u;var b=O-a.startTime;if(d.lerpType)switch(d.lerpType){case 0:case 1:for(Y=0;Y<d.keyframeWidth;)Y+=d.interpolationMethod[Y](d,Y,F,u+Y,a.data,b,null,a.duration,a.nextData);break;case 2:var z=a.interpolationData,J=z.length,w=0;for(Y=0;Y<J;){var j=z[Y];switch(j){case 6:case 7:Y+=h.interpolation[j](d,w,F,u+w,a.data,b,null,a.duration,a.nextData,z,Y+1);break;default:Y+=h.interpolation[j](d,w,F,u+w,a.data,b,null,a.duration,a.nextData)}w++}}else for(Y=0;Y<d.keyframeWidth;)Y+=d.interpolationMethod[Y](d,Y,F,u+Y,a.data,b,null,a.duration,a.nextData);u+=d.keyframeWidth}},h._LinearInterpolation_0=function(U,F,O,P,Y,c,L,u,d,a){var b=0===u?0:c/u;return O[P]=(1-b)*Y[F]+b*d[F],1},h._QuaternionInterpolation_1=function(U,F,O,P,Y,c,L,u,d,a){var b=0===u?0:c/u;return J.slerpQuaternionArray(Y,F,d,F,b,O,P),4},h._AngleInterpolation_2=function(U,F,O,P,Y,c,L,u,d,a){return 0},h._RadiansInterpolation_3=function(U,F,O,P,Y,c,L,u,d,a){return 0},h._Matrix4x4Interpolation_4=function(U,F,O,P,Y,c,L,u,d,a){for(var b=0;b<16;b++,F++)O[P+b]=Y[F]+c*L[F];return 16},h._NoInterpolation_5=function(U,F,O,P,Y,c,L,u,d,a){return O[P]=Y[F],1},h._BezierInterpolation_6=function(U,F,O,P,Y,c,L,u,d,a,b){return void 0===b&&(b=0),O[P]=Y[F]+(d[F]-Y[F])*I.getBezierRate(c/u,a[b],a[b+1],a[b+2],a[b+3]),5},h._BezierInterpolation_7=function(U,F,O,P,Y,c,L,u,d,a,b){return void 0===b&&(b=0),O[P]=a[b+4]+a[b+5]*I.getBezierRate((.001*c+a[b+6])/a[b+7],a[b],a[b+1],a[b+2],a[b+3]),9},h.load=function(U){return YU.loader.create(U,null,null,h)},h.interpolation=[h._LinearInterpolation_0,h._QuaternionInterpolation_1,h._AngleInterpolation_2,h._RadiansInterpolation_3,h._Matrix4x4Interpolation_4,h._NoInterpolation_5,h._BezierInterpolation_6,h._BezierInterpolation_7],h}(),g=function(F){function O(U,F){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,O.__super.call(this),void 0===F&&(F=0),U&&this.init(U,F)}P(O,"laya.ani.bone.Skeleton",F);var U=O.prototype;return U.init=function(U,F){void 0===F&&(F=0);var O,P,Y,c=0,L=0;if(1==F)for(this._graphicsCache=[],c=0,L=U.getAnimationCount();c<L;c++)this._graphicsCache.push([]);if(this._yReverseMatrix=U.yReverseMatrix,this._aniMode=F,this._templet=U,this._player=new T,this._player.cacheFrameRate=U.rate,this._player.templet=U,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=U.mBoneArr,this._rootBone=U.mRootBone,this._aniSectionDic=U.aniSectionDic,0<U.ikArr.length)for(this._ikArr=[],c=0,L=U.ikArr.length;c<L;c++)this._ikArr.push(new h(U.ikArr[c],this._boneList));if(0<U.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),c=0,L=U.pathArr.length;c<L;c++)O=U.pathArr[c],P=new N(O,this._boneList),(Y=this._boneSlotDic[O.name])&&((P=new N(O,this._boneList)).target=Y),this._pathDic[O.name]=P;if(0<U.tfArr.length)for(this._tfArr=[],c=0,L=U.tfArr.length;c<L;c++)this._tfArr.push(new K(U.tfArr[c],this._boneList));if(0<U.skinDataArray.length){var u=this._templet.skinDataArray[this._skinIndex];this._skinName=u.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},U.load=function(U,F,O){},U._onLoaded=function(){},U._parseComplete=function(){var U=l.TEMPLET_DICTIONARY[this._aniPath];U&&(this.init(U,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},U._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},U._onPlay=function(){this.event("played")},U._onStop=function(){var U,F=this._templet.eventAniArr[this._aniClipIndex];if(F&&this._eventIndex<F.length)for(;this._eventIndex<F.length;this._eventIndex++)(U=F[this._eventIndex]).time>=this._player.playStart&&U.time<=this._player.playEnd&&this.event("label",U);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},U._onPause=function(){this.event("paused")},U._parseSrcBoneMatrix=function(){var U=0,F=0;for(F=this._templet.srcBoneMatrixArr.length,U=0;U<F;U++)this._boneMatrixArray.push(new sU);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var O,P,Y=this._templet.boneSlotArray;for(U=0,F=Y.length;U<F;U++)O=Y[U],null==(P=this._bindBoneBoneSlotDic[O.parent])&&(this._bindBoneBoneSlotDic[O.parent]=P=[]),this._boneSlotDic[O.name]=O=O.copy(),P.push(O),this._boneSlotArray.push(O)}},U._emitMissedEvents=function(U,F,O){void 0===O&&(O=0);var P=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(P){var Y,c,L=0;for(Y=P.length,L=O;L<Y;L++)(c=P[L]).time>=this._player.playStart&&c.time<=this._player.playEnd&&this.event("label",c)}},U._update=function(U){if(void 0===U&&(U=!0),!(this._pause||U&&this._indexControl)){var F=this.timer.currTimer,O=this._player.currentKeyframeIndex,P=F-this._lastTime;if(U?this._player._update(P):O=-1,this._lastTime=F,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<P&&this._clipIndex==O&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var Y;this._lastUpdateAniClipIndex=this._aniClipIndex,O>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var c,L=this._templet.eventAniArr[this._aniClipIndex];if(L&&this._eventIndex<L.length&&((Y=L[this._eventIndex]).time>=this._player.playStart&&Y.time<=this._player.playEnd?this._player.currentPlayTime>=Y.time&&(this.event("label",Y),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(c=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=c&&(this.graphics=c));var u=0,d=0;for(d=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,d-1)&&0<d;)d--;if(d<this._clipIndex)for(u=d;u<this._clipIndex;u++)this._createGraphics(u)}else if(1==this._aniMode){if(c=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=c&&(this.graphics=c));for(d=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,d-1)&&0<d;)d--;if(d<this._clipIndex)for(u=d;u<this._clipIndex;u++)this._createGraphics(u)}this._createGraphics()}}},U._createGraphics=function(U){void 0===U&&(U=-1),-1==U&&(U=this._clipIndex);var F,O,P=U*this._player.cacheFrameRateInterval,Y=this._templet.drawOrderAniArr[this._aniClipIndex];if(Y&&0<Y.length)for(this._drawOrderIndex=0,F=Y[this._drawOrderIndex];P>=F.time&&(this._drawOrder=F.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=Y.length));)F=Y[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=k.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=k.create(),O=this.graphics;var c=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],U,P);var L,u,d,a,b=this._aniSectionDic[this._aniClipIndex],z=0,J=0,w=0,j=0,x=0,r=this._templet.srcBoneMatrixArr.length;for(x=b[J=0];J<r;J++)a=this._boneList[J],d=this._templet.srcBoneMatrixArr[J],a.resultTransform.scX=d.scX*this._curOriginalData[z++],a.resultTransform.skX=d.skX+this._curOriginalData[z++],a.resultTransform.skY=d.skY+this._curOriginalData[z++],a.resultTransform.scY=d.scY*this._curOriginalData[z++],a.resultTransform.x=d.x+this._curOriginalData[z++],a.resultTransform.y=d.y+this._curOriginalData[z++],8===this._templet.tMatrixDataLen&&(a.resultTransform.skewX=d.skewX+this._curOriginalData[z++],a.resultTransform.skewY=d.skewY+this._curOriginalData[z++]);var H,h={},Q={};for(x+=b[1];J<x;J++)h[(H=c[J]).name]=this._curOriginalData[z++],Q[H.name]=this._curOriginalData[z++],this._curOriginalData[z++],this._curOriginalData[z++],this._curOriginalData[z++],this._curOriginalData[z++];var X,N,K={},f={};for(x+=b[2];J<x;J++)K[(H=c[J]).name]=this._curOriginalData[z++],f[H.name]=this._curOriginalData[z++],this._curOriginalData[z++],this._curOriginalData[z++],this._curOriginalData[z++],this._curOriginalData[z++];if(this._pathDic)for(x+=b[3];J<x;J++){if(H=c[J],X=this._pathDic[H.name])switch(new CU(H.extenData).getByte()){case 1:X.position=this._curOriginalData[z++];break;case 2:X.spacing=this._curOriginalData[z++];break;case 3:X.rotateMix=this._curOriginalData[z++],X.translateMix=this._curOriginalData[z++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(sU.TEMP.identity()),this._ikArr)for(J=0,x=this._ikArr.length;J<x;J++)N=this._ikArr[J],K.hasOwnProperty(N.name)&&(N.bendDirection=K[N.name]),f.hasOwnProperty(N.name)&&(N.mix=f[N.name]),N.apply();if(this._pathDic)for(var I in this._pathDic)(X=this._pathDic[I]).apply(this._boneList,O);if(this._tfArr)for(J=0,j=this._tfArr.length;J<j;J++)this._tfArr[J].apply();for(J=0,j=this._boneList.length;J<j;J++)if(a=this._boneList[J],u=this._bindBoneBoneSlotDic[a.name],a.resultMatrix.copyTo(this._boneMatrixArray[J]),u)for(w=0,x=u.length;w<x;w++)(L=u[w])&&L.setParentMatrix(a.resultMatrix);var T,g,l,$,C={},s=this._templet.deformAniArr;if(s&&0<s.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,J=0,x=this._boneSlotArray.length;J<x;J++)(L=this._boneSlotArray[J]).deformData=null;var i,y=s[this._aniClipIndex];for(i in T=y.default,this._setDeform(T,C,this._boneSlotArray,P),y)"default"!=i&&i!=this._skinName&&(T=y[i],this._setDeform(T,C,this._boneSlotArray,P));T=y[this._skinName],this._setDeform(T,C,this._boneSlotArray,P)}if(this._drawOrder)for(J=0,x=this._drawOrder.length;J<x;J++)g=h[(L=this._boneSlotArray[this._drawOrder[J]]).name],l=Q[L.name],isNaN(l)||(O.save(),O.alpha(l)),isNaN(g)||-2==g||(this._templet.attachmentNames?L.showDisplayByName(this._templet.attachmentNames[g]):L.showDisplayByIndex(g)),C[this._drawOrder[J]]?($=C[this._drawOrder[J]],L.currDisplayData&&$[L.currDisplayData.attachmentName]?L.deformData=$[L.currDisplayData.attachmentName]:L.deformData=null):L.deformData=null,isNaN(l)?L.draw(O,this._boneMatrixArray,2==this._aniMode):L.draw(O,this._boneMatrixArray,2==this._aniMode,l),isNaN(l)||O.restore();else for(J=0,x=this._boneSlotArray.length;J<x;J++)g=h[(L=this._boneSlotArray[J]).name],l=Q[L.name],isNaN(l)||(O.save(),O.alpha(l)),isNaN(g)||-2==g||(this._templet.attachmentNames?L.showDisplayByName(this._templet.attachmentNames[g]):L.showDisplayByIndex(g)),C[J]?($=C[J],L.currDisplayData&&$[L.currDisplayData.attachmentName]?L.deformData=$[L.currDisplayData.attachmentName]:L.deformData=null):L.deformData=null,isNaN(l)?L.draw(O,this._boneMatrixArray,2==this._aniMode):L.draw(O,this._boneMatrixArray,2==this._aniMode,l),isNaN(l)||O.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,U,O):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,U,O)},U._setDeform=function(U,F,O,P){if(U){var Y,c,L,u=0,d=0,a=0;if(U)for(u=0,d=U.deformSlotDataList.length;u<d;u++)for(Y=U.deformSlotDataList[u],a=0;a<Y.deformSlotDisplayList.length;a++)L=O[(c=Y.deformSlotDisplayList[a]).slotIndex],c.apply(P,L),F[c.slotIndex]||(F[c.slotIndex]={}),F[c.slotIndex][c.attachment]=c.deformData}},U.getAnimNum=function(){return this._templet.getAnimationCount()},U.getAniNameByIndex=function(U){return this._templet.getAniNameByIndex(U)},U.getSlotByName=function(U){return this._boneSlotDic[U]},U.showSkinByName=function(U,F){void 0===F&&(F=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(U),F)},U.showSkinByIndex=function(U,F){void 0===F&&(F=!0);for(var O=0;O<this._boneSlotArray.length;O++)this._boneSlotArray[O].showSlotData(null,F);if(this._templet.showSkinByIndex(this._boneSlotDic,U,F)){var P=this._templet.skinDataArray[U];this._skinIndex=U,this._skinName=P.name}this._clearCache()},U.showSlotSkinByIndex=function(U,F){if(0!=this._aniMode){var O=this.getSlotByName(U);O&&O.showDisplayByIndex(F),this._clearCache()}},U.showSlotSkinByName=function(U,F){if(0!=this._aniMode){var O=this.getSlotByName(U);O&&O.showDisplayByName(F),this._clearCache()}},U.replaceSlotSkinName=function(U,F,O){if(0!=this._aniMode){var P=this.getSlotByName(U);P&&P.replaceDisplayByName(F,O),this._clearCache()}},U.replaceSlotSkinByIndex=function(U,F,O){if(0!=this._aniMode){var P=this.getSlotByName(U);P&&P.replaceDisplayByIndex(F,O),this._clearCache()}},U.setSlotSkin=function(U,F){if(0!=this._aniMode){var O=this.getSlotByName(U);O&&O.replaceSkin(F),this._clearCache()}},U._clearCache=function(){if(1==this._aniMode)for(var U=0,F=this._graphicsCache.length;U<F;U++){for(var O=0,P=this._graphicsCache[U].length;O<P;O++){var Y=this._graphicsCache[U][O];Y!=this.graphics&&k.recycle(Y)}this._graphicsCache[U].length=0}},U.play=function(U,F,O,P,Y,c){void 0===O&&(O=!0),void 0===P&&(P=0),void 0===Y&&(Y=0),void 0===c&&(c=!0),this._indexControl=!1;var L=-1,u=NaN;if(u=F?2147483647:0,"string"==typeof U)for(var d=0,a=this._templet.getAnimationCount();d<a;d++){var b=this._templet.getAnimation(d);if(b&&U==b.name){L=d;break}}else L=U;-1<L&&L<this.getAnimNum()&&(this._aniClipIndex=L,(O||this._pause||this._currAniIndex!=L)&&(this._currAniIndex=L,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(L)),this._drawOrder=null,this._eventIndex=0,this._player.play(L,this._player.playbackRate,u,P,Y),c&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=z.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},U.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},U.playbackRate=function(U){this._player&&(this._player.playbackRate=U)},U.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},U.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=z.now(),this.timer.frameLoop(1,this,this._update,null,!0))},U._getGrahicsDataWithCache=function(U,F){return this._graphicsCache[U][F]},U._setGrahicsDataWithCache=function(U,F,O){this._graphicsCache[U][F]=O},U.destroy=function(U){void 0===U&&(U=!0),F.prototype.destroy.call(this,U),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},c(0,U,"url",function(){return this._aniPath},function(U){this.load(U)}),c(0,U,"index",function(){return this._index},function(U){this.player&&(this._index=U,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),c(0,U,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),c(0,U,"templet",function(){return this._templet}),c(0,U,"player",function(){return this._player}),O.useSimpleMeshInCanvas=!1,O}(cU),l=function(F){function Y(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,Y.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}P(Y,"laya.ani.bone.Templet",F);var U=Y.prototype;return U.getLoadList=function(){return this._loadList},U.loadAni=function(U){this._skBufferUrl=U,YU.loader.load(U,d.create(this,this.onComplete),null,"arraybuffer")},U.onComplete=function(U){if(this._isDestroyed)this.destroy();else{var F=a.getRes(this._skBufferUrl);F?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,F)):this.event("error","load failed:"+this._skBufferUrl)}},U.parseData=function(U,F,O){void 0===O&&(O=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=U,this._mainTexture&&r.isWebGL&&U.bitmap&&(U.bitmap.enableMerageInAtlas=!1),this._rate=O,this.parse(F)},U.buildArmature=function(U){return void 0===U&&(U=0),new g(this,U)},U.parse=function(U){F.prototype.parse.call(this,U),this._endLoaded(),this._aniVersion!=Y.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+Y.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},U._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var U=0;this._loadList=[];var F,O=new CU(this.getPublicExtData()),P=0,Y=0,c=0,L=O.getInt32(),u=O.readUTFString(),d=u.split("\n");for(U=0;U<L;U++)F=this._path+d[2*U],u=d[2*U+1],O.getFloat32(),O.getFloat32(),P=O.getFloat32(),Y=O.getFloat32(),c=O.getFloat32(),isNaN(c)?0:c,c=O.getFloat32(),isNaN(c)?0:c,c=O.getFloat32(),isNaN(c)?P:c,c=O.getFloat32(),isNaN(c)?Y:c,-1==this._loadList.indexOf(F)&&this._loadList.push(F);this.event("inited",this)}},U._textureComplete=function(){for(var U,F,O=0,P=this._loadList.length;O<P;O++)F=this._loadList[O],U=this._textureDic[F]=a.getRes(F),r.isWebGL&&U&&U.bitmap&&(U.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},U._parsePublicExtData=function(){var U=0,F=0,O=0,P=0,Y=0;for(U=0,Y=this.getAnimationCount();U<Y;U++)this._graphicsCache.push([]);var c;c="Dragon"!=this._aniClassName;var L,u,d=new CU(this.getPublicExtData()),a=0,b=0,z=0,J=0,w=0,j=0,x=0,r=0,H=0,h=d.getInt32(),Q=d.readUTFString(),X=Q.split("\n");for(U=0;U<h;U++){if(L=this._mainTexture,u=this._path+X[2*U],Q=X[2*U+1],null==this._mainTexture&&(L=this._textureDic[u]),!L)return this.event("error",this),void(this.isParseFail=!0);a=d.getFloat32(),b=d.getFloat32(),z=d.getFloat32(),J=d.getFloat32(),H=d.getFloat32(),w=isNaN(H)?0:H,H=d.getFloat32(),j=isNaN(H)?0:H,H=d.getFloat32(),x=isNaN(H)?z:H,H=d.getFloat32(),r=isNaN(H)?J:H,this.subTextureDic[Q]=iU.create(L,a,b,z,J,-w,-j,x,r),L.alphaTexture&&(this.subTextureDic[Q].alphaTexture=iU.create(L.alphaTexture,a,b,z,J,-w,-j,x,r))}this._mainTexture=L;var N,K,f,I,T,g=d.getUint16();for(U=0;U<g;U++)(N=[]).push(d.getUint16()),N.push(d.getUint16()),N.push(d.getUint16()),N.push(d.getUint16()),this.aniSectionDic[U]=N;var l,$=d.getInt16(),C={};for(U=0;U<$;U++)K=new yU,0==U?l=K:K.root=l,K.d=c?-1:1,I=d.readUTFString(),T=d.readUTFString(),K.length=d.getFloat32(),1==d.getByte()&&(K.inheritRotation=!1),1==d.getByte()&&(K.inheritScale=!1),K.name=I,T&&((f=C[T])?f.addChild(K):this.mRootBone=K),C[I]=K,this.mBoneArr.push(K);this.tMatrixDataLen=d.getUint16();var s,i,y=d.getUint16(),k=Math.floor(y/this.tMatrixDataLen),A=this.srcBoneMatrixArr;for(U=0;U<k;U++)(s=new ZU).scX=d.getFloat32(),s.skX=d.getFloat32(),s.skY=d.getFloat32(),s.scY=d.getFloat32(),s.x=d.getFloat32(),s.y=d.getFloat32(),8===this.tMatrixDataLen&&(s.skewX=d.getFloat32(),s.skewY=d.getFloat32()),A.push(s),(K=this.mBoneArr[U]).transform=s;var G,V=d.getUint16(),M=0;for(U=0;U<V;U++){for(i=new pU,M=d.getUint16(),F=0;F<M;F++)i.boneNames.push(d.readUTFString()),i.boneIndexs.push(d.getInt16());i.name=d.readUTFString(),i.targetBoneName=d.readUTFString(),i.targetBoneIndex=d.getInt16(),i.bendDirection=d.getFloat32(),i.mix=d.getFloat32(),i.isSpine=c,this.ikArr.push(i)}var m,p=d.getUint16(),o=0;for(U=0;U<p;U++){for(G=new DU,o=d.getUint16(),F=0;F<o;F++)G.boneIndexs.push(d.getInt16());G.name=d.getUTFString(),G.targetIndex=d.getInt16(),G.rotateMix=d.getFloat32(),G.translateMix=d.getFloat32(),G.scaleMix=d.getFloat32(),G.shearMix=d.getFloat32(),G.offsetRotation=d.getFloat32(),G.offsetX=d.getFloat32(),G.offsetY=d.getFloat32(),G.offsetScaleX=d.getFloat32(),G.offsetScaleY=d.getFloat32(),G.offsetShearY=d.getFloat32(),this.tfArr.push(G)}var R=d.getUint16(),_=0;for(U=0;U<R;U++){for((m=new oU).name=d.readUTFString(),_=d.getUint16(),F=0;F<_;F++)m.bones.push(d.getInt16());m.target=d.readUTFString(),m.positionMode=d.readUTFString(),m.spacingMode=d.readUTFString(),m.rotateMode=d.readUTFString(),m.offsetRotation=d.getFloat32(),m.position=d.getFloat32(),m.spacing=d.getFloat32(),m.rotateMix=d.getFloat32(),m.translateMix=d.getFloat32(),this.pathArr.push(m)}var q,D,Z,e,v,n=0,t=0,S=0,W=NaN,B=0,E=d.getInt16();for(U=0;U<E;U++){var UU=d.getUint8(),FU={};this.deformAniArr.push(FU);for(var OU=0;OU<UU;OU++)for((q=new AU).skinName=d.getUTFString(),FU[q.skinName]=q,n=d.getInt16(),F=0;F<n;F++)for(D=new GU,q.deformSlotDataList.push(D),t=d.getInt16(),O=0;O<t;O++)for(Z=new VU,D.deformSlotDisplayList.push(Z),Z.slotIndex=d.getInt16(),Z.attachment=d.getUTFString(),S=d.getInt16(),P=0;P<S;P++)for(1==d.getByte()?Z.tweenKeyList.push(!0):Z.tweenKeyList.push(!1),W=d.getFloat32(),Z.timeList.push(W),e=[],Z.vectices.push(e),B=d.getInt16(),Y=0;Y<B;Y++)e.push(d.getFloat32())}var PU,YU,cU=d.getInt16(),LU=0,uU=0;for(U=0;U<cU;U++){for(LU=d.getInt16(),v=[],F=0;F<LU;F++){for((PU=new MU).time=d.getFloat32(),uU=d.getInt16(),O=0;O<uU;O++)PU.drawOrder.push(d.getInt16());v.push(PU)}this.drawOrderAniArr.push(v)}var dU,aU=d.getInt16(),bU=0;for(U=0;U<aU;U++){for(bU=d.getInt16(),YU=[],F=0;F<bU;F++)(dU=new mU).name=d.getUTFString(),dU.intValue=d.getInt32(),dU.floatValue=d.getFloat32(),dU.stringValue=d.getUTFString(),dU.time=d.getFloat32(),YU.push(dU);this.eventAniArr.push(YU)}var zU=d.getInt16();if(0<zU)for(this.attachmentNames=[],U=0;U<zU;U++)this.attachmentNames.push(d.getUTFString());var JU,wU,jU=d.getInt16();for(U=0;U<jU;U++)(JU=new kU).name=d.readUTFString(),JU.parent=d.readUTFString(),JU.attachmentName=d.readUTFString(),JU.srcDisplayIndex=JU.displayIndex=d.getInt16(),(JU.templet=this).boneSlotDic[JU.name]=JU,null==(wU=this.bindBoneBoneSlotDic[JU.parent])&&(this.bindBoneBoneSlotDic[JU.parent]=wU=[]),wU.push(JU),this.boneSlotArray.push(JU);var xU,rU,HU,hU=d.readUTFString().split("\n"),QU=0,XU=d.getUint8(),NU=0,KU=0,fU=0,IU=0,TU=0,gU=0,lU=0;for(U=0;U<XU;U++){for((xU=new RU).name=hU[QU++],NU=d.getUint8(),F=0;F<NU;F++){for((rU=new qU).name=hU[QU++],JU=this.boneSlotDic[rU.name],KU=d.getUint8(),O=0;O<KU;O++){if(HU=new _U,this.skinSlotDisplayDataArr.push(HU),HU.name=hU[QU++],HU.attachmentName=hU[QU++],HU.transform=new ZU,HU.transform.scX=d.getFloat32(),HU.transform.skX=d.getFloat32(),HU.transform.skY=d.getFloat32(),HU.transform.scY=d.getFloat32(),HU.transform.x=d.getFloat32(),HU.transform.y=d.getFloat32(),rU.displayArr.push(HU),HU.width=d.getFloat32(),HU.height=d.getFloat32(),HU.type=d.getUint8(),HU.verLen=d.getUint16(),0<($=d.getUint16()))for(HU.bones=[],P=0;P<$;P++){var $U=d.getUint16();HU.bones.push($U)}if(0<(fU=d.getUint16()))for(HU.uvs=[],P=0;P<fU;P++)HU.uvs.push(d.getFloat32());if(0<(IU=d.getUint16()))for(HU.weights=[],P=0;P<IU;P++)HU.weights.push(d.getFloat32());if(0<(TU=d.getUint16()))for(HU.triangles=[],P=0;P<TU;P++)HU.triangles.push(d.getUint16());if(0<(gU=d.getUint16()))for(HU.vertices=[],P=0;P<gU;P++)HU.vertices.push(d.getFloat32());if(0<(lU=d.getUint16()))for(HU.lengths=[],P=0;P<lU;P++)HU.lengths.push(d.getFloat32())}xU.slotArr.push(rU)}this.skinDic[xU.name]=xU,this.skinDataArray.push(xU)}1==d.getUint8()?(this.yReverseMatrix=new sU(1,0,0,-1,0,0),l&&l.setTempMatrix(this.yReverseMatrix)):l&&l.setTempMatrix(new sU),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},U.getTexture=function(U){var F=this.subTextureDic[U];return F||(F=this.subTextureDic[U.substr(0,U.length-1)]),null==F?this._mainTexture:F},U.showSkinByIndex=function(U,F,O){if(void 0===O&&(O=!0),F<0&&F>=this.skinDataArray.length)return!1;var P,Y,c=0,L=0,u=this.skinDataArray[F];if(u){for(c=0,L=u.slotArr.length;c<L;c++)(Y=u.slotArr[c])&&(P=U[Y.name])&&(P.showSlotData(Y,O),O&&"undefined"!=P.attachmentName&&"null"!=P.attachmentName?P.showDisplayByName(P.attachmentName):P.showDisplayByIndex(P.displayIndex));return!0}return!1},U.getSkinIndexByName=function(U){for(var F=0,O=this.skinDataArray.length;F<O;F++)if(this.skinDataArray[F].name==U)return F;return-1},U.getGrahicsDataWithCache=function(U,F){return this._graphicsCache[U][F]},U.setGrahicsDataWithCache=function(U,F,O){this._graphicsCache[U][F]=O},U.destroy=function(){var U;for(var F in this._isDestroyed=!0,this.subTextureDic)(U=this.subTextureDic[F])&&U.destroy();for(F in this._textureDic)(U=this._textureDic[F])&&U.destroy();for(var O=0,P=this.skinSlotDisplayDataArr.length;O<P;O++)this.skinSlotDisplayDataArr[O].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete Y.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},U.getAniNameByIndex=function(U){var F=this.getAnimation(U);return F?F.name:null},c(0,U,"rate",function(){return this._rate},function(U){this._rate=U}),Y.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",Y.TEMPLET_DICTIONARY=null,Y}(A)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(U,F){"use strict";for(var O in Object.defineProperty(F,"__esModule",{value:!0}),Laya){var P=Laya[O];P&&P.__isclass&&(F[O]=P)}});