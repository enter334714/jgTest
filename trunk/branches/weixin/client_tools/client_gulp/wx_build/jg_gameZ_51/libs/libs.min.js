var Laya=window.Laya=function($H,$j){var $g={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($j,$O){return 1==arguments.length?$g.__presubstr.call(this,$j):$g.__presubstr.call(this,$j,0<$O?$O:this.length+$O)},__init:function($j){$j.forEach(function($j){$j.__init$&&$j.__init$()})},__isClass:function($j){return $j&&($j.__isclass||$j==Object||$j==String||$j==Array)},__newvec:function($j,$O){var $V=[];$V.length=$j;for(var $l=0;$l<$j;$l++)$V[$l]=$O;return $V},__extend:function($j,$O){for(var $V in $O)if($O.hasOwnProperty($V)){var $l=Object.getOwnPropertyDescriptor($O,$V),$T=$l.get,$S=$l.set;$T||$S?$T&&$S?Object.defineProperty($j,$V,$l):($T&&Object.defineProperty($j,$V,$T),$S&&Object.defineProperty($j,$V,$S)):$j[$V]=$O[$V]}function $m(){$g.un(this,"constructor",$j)}$m.prototype=$O.prototype,$j.prototype=new $m,$g.un($j.prototype,"__imps",$g.__copy({},$O.prototype.__imps))},__copy:function($j,$O){if(!$O)return null;for(var $V in $j=$j||{},$O)$j[$V]=$O[$V];return $j},__package:function($j,$O){if(!$g.__packages[$j]){$g.__packages[$j]=!0;var $V=$H,$l=$j.split(".");if(1<$l.length)for(var $T=0,$S=$l.length-1;$T<$S;$T++){var $m=$V[$l[$T]];$V=$m||($V[$l[$T]]={})}$V[$l[$l.length-1]]||($V[$l[$l.length-1]]=$O||{})}},__hasOwnProperty:function($j,$O){return $O=$O||this,Object.hasOwnProperty.call($O,$j)||function $j($O,$V){if(Object.hasOwnProperty.call($V.prototype,$O))return!0;var $l=$V.prototype.__super;return null==$l?null:$j($O,$l)}($j,$O.__class)},__typeof:function($j,$O){if(!$j||!$O)return!1;if($O===String)return"string"==typeof $j;if($O===Number)return"number"==typeof $j;if($O.__interface__)$O=$O.__interface__;else if("string"!=typeof $O)return $j instanceof $O;return $j.__imps&&$j.__imps[$O]||$j.__class==$O},__as:function($j,$O){return this.__typeof($j,$O)?$j:null},__int:function($j){return $j?parseInt($j):0},interface:function($j,$O){$g.__package($j,{});var $V=$g.__internals,$l=$V[$j]=$V[$j]||{self:$j};if($O){var $T=$O.split(",");$l.extend=[];for(var $S=0;$S<$T.length;$S++){var $m=$T[$S];$V[$m]=$V[$m]||{self:$m},$l.extend.push($V[$m])}}var $p=$H,$o=$j.split(".");for($S=0;$S<$o.length-1;$S++)$p=$p[$o[$S]];$p[$o[$o.length-1]]={__interface__:$j}},class:function($j,$O,$V,$l){if($V&&$g.__extend($j,$V),$O)if($g.__package($O,$j),$g.__classmap[$O]=$j,0<$O.indexOf(".")){if(0==$O.indexOf("laya.")){var $T=$O.split(".");$l=$l||$T[$T.length-1],$g[$l]&&console.log("Warning!,this class["+$l+"] already exist:",$g[$l]),$g[$l]=$j}}else"Main"==$O?$H.Main=$j:"MainWX"==$O?$H.MainWX=$j:($g[$O]&&console.log("Error!,this class["+$O+"] already exist:",$g[$O]),$g[$O]=$j);var $S=$g.un,$m=$j.prototype;$S($m,"hasOwnProperty",$g.__hasOwnProperty),$S($m,"__class",$j),$S($m,"__super",$V),$S($m,"__className",$O),$S($j,"__super",$V),$S($j,"__className",$O),$S($j,"__isclass",!0),$S($j,"super",function($j){this.__super.call($j)})},imps:function($j,$O){if(!$O)return null;var $T=$j.__imps||$g.un($j,"__imps",{});function $S($j){var $O,$V;if(($O=$g.__internals[$j])&&($T[$j]=!0,$V=$O.extend))for(var $l=0;$l<$V.length;$l++)$S($V[$l].self)}for(var $V in $O)$S($V)},superSet:function($j,$O,$V,$l){var $T=$j.prototype["_$set_"+$V];$T&&$T.call($O,$l)},superGet:function($j,$O,$V){var $l=$j.prototype["_$get_"+$V];return $l?$l.call($O):null},getset:function($j,$O,$V,$l,$T){$j?($l&&($O["_$GET_"+$V]=$l),$T&&($O["_$SET_"+$V]=$T)):($l&&$g.un($O,"_$get_"+$V,$l),$T&&$g.un($O,"_$set_"+$V,$T)),$l&&$T?Object.defineProperty($O,$V,{get:$l,set:$T,enumerable:!1,configurable:!0}):($l&&Object.defineProperty($O,$V,{get:$l,enumerable:!1,configurable:!0}),$T&&Object.defineProperty($O,$V,{set:$T,enumerable:!1,configurable:!0}))},static:function($V,$l){for(var $T=0,$j=$l.length;$T<$j;$T+=2)if("length"==$l[$T])$V.length=$l[$T+1].call($V);else{function $O(){var $O=$l[$T],$j=$l[$T+1];Object.defineProperty($V,$O,{get:function(){return delete this[$O],this[$O]=$j.call(this)},set:function($j){delete this[$O],this[$O]=$j},enumerable:!0,configurable:!0})}$O()}},un:function($j,$O,$V){return $V||($V=$j[$O]),$g.__propun.value=$V,Object.defineProperty($j,$O,$g.__propun),$V},uns:function($O,$j){$j.forEach(function($j){$g.un($O,$j)})}};return $H.console=$H.console||{log:function(){}},$H.trace=$H.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$g}(window,document);!function($j,$O,$V){$V.un,$V.uns,$V.static,$V.class,$V.getset,$V.__newvec}(window,document,Laya),function($m,$O,$E){$E.un,$E.uns;var $o=$E.static,$b=$E.class,$g=$E.getset;$E.__newvec;$E.interface("laya.runtime.IMarket"),$E.interface("laya.filters.IFilter"),$E.interface("laya.display.ILayout"),$E.interface("laya.resource.IDispose"),$E.interface("laya.runtime.IPlatform"),$E.interface("laya.resource.IDestroy"),$E.interface("laya.runtime.IConchNode"),$E.interface("laya.filters.IFilterAction"),$E.interface("laya.runtime.ICPlatformClass"),$E.interface("laya.resource.ICreateResource"),$E.interface("laya.runtime.IConchRenderObject"),$E.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $M=function(){function $S(){}return $b($S,"laya.utils.RunDriver"),$S.FILTER_ACTIONS=[],$S.pixelRatio=-1,$S._charSizeTestDiv=null,$S.now=function(){return Date.now()},$S.getWindow=function(){return $m},$S.getPixelRatio=function(){if($S.pixelRatio<0){var $j=$F.context,$O=$j.backingStorePixelRatio||$j.webkitBackingStorePixelRatio||$j.mozBackingStorePixelRatio||$j.msBackingStorePixelRatio||$j.oBackingStorePixelRatio||$j.backingStorePixelRatio||1;($S.pixelRatio=($F.window.devicePixelRatio||1)/$O)<1&&($S.pixelRatio=1)}return $S.pixelRatio},$S.getIncludeStr=function($j){return null},$S.createShaderCondition=function($j){var $O="(function() {return "+$j+";})";return $E._runScript($O)},$S.fontMap=[],$S.measureText=function($j,$O){var $V=$S.hanzi.test($j);if($V&&$S.fontMap[$O])return $S.fontMap[$O];var $l=$F.context;$l.font=$O;var $T=$l.measureText($j);return $T||($T={width:16,height:16}),$V&&($S.fontMap[$O]=$T),$T},$S.getWebGLContext=function($j){},$S.beginFlush=function(){},$S.endFinish=function(){},$S.addToAtlas=null,$S.flashFlushImage=function($j){},$S.drawToCanvas=function($j,$O,$V,$l,$T,$S){var $m=$cj.create("2D"),$p=new $i($V,$l,$m);return $k.renders[$O]._fun($j,$p,$T,$S),$m},$S.createParticleTemplate2D=null,$S.createGLTextur=null,$S.createWebGLContext2D=null,$S.changeWebGLSize=function($j,$O){},$S.createRenderSprite=function($j,$O){return new $k($j,$O)},$S.createFilterAction=function($j){return new $c},$S.createGraphics=function(){return new $t},$S.clear=function($j){$q._context.ctx.clear()},$S.cancelLoadByUrl=function($j){},$S.clearAtlas=function($j){},$S.isAtlas=function($j){return!1},$S.addTextureToAtlas=function($j){},$S.getTexturePixels=function($j,$O,$V,$l,$T){return null},$S.skinAniSprite=function(){return null},$S.update3DLoop=function(){},$o($S,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$S}(),$l=($g(1,$E,"alertGlobalError",null,function($j){var $S=0;$F.window.onerror=$j?function($j,$O,$V,$l,$T){$S++<5&&$T&&alert($T.stack||$T)}:null}),$E.init=function($j,$O,$V){for(var $l=[],$T=2,$S=arguments.length;$T<$S;$T++)$l.push(arguments[$T]);if(!$E._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$E._arrayBufferSlice),$E._isinit=!0,$F.__init__(),$n.__init__(),$t.__init__(),$E.timer=new $d,$E.scaleTimer=new $d,$E.loader=new $oj,$I.__init__(),$T=0;for(var $m=$l.length;$T<$m;$T++)$l[$T].enable&&$l[$T].enable();return $w.__init__(),$p.__init__(),$G.__init__(),$X.beginCheck(),$E._currentStage=$E.stage=new $hj,$E.stage.conchModel&&$E.stage.conchModel.setRootNode(),$E._getUrlPath(),$E.render=new $q(0,0),$E.stage.size($j,$O),$k.__init__(),$e.__init__(),$s.instance.__init__($E.stage,$q.canvas),$Zj.__init__(),$B.autoStopMusic=!0,$$.__init__(),$q.canvas}},$E._getUrlPath=function(){var $j=$F.window.location,$O=$j.pathname;$O=$O&&":"==$O.charAt(2)?$O.substring(1):$O,$R.rootPath=$R.basePath=$R.getPath("file:"==$j.protocol?$O:$j.protocol+"//"+$j.host+$j.pathname)},$E._arrayBufferSlice=function($j,$O){var $V=new Uint8Array(this,$j,$O-$j),$l=new Uint8Array($V.length);return $l.set($V),$l.buffer},$E._runScript=function($j){return $F.window[$E._evcode]($j)},$E.stage=null,$E.timer=null,$E.scaleTimer=null,$E.loader=null,$E.version="1.8.6",$E.render=null,$E._currentStage=null,$E._isinit=!1,$E.isDebug=!1,$E.MiniAdpter={init:function(){$m.navigator&&$m.navigator.userAgent&&-1<$m.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$o($E,["conchMarket",function(){return this.conchMarket=$m.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$m.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $j(){}return $b($j,"Config"),$j.WebGLTextCacheCount=500,$j.atlasEnable=!1,$j.showCanvasMark=!1,$j.animationInterval=50,$j.isAntialias=!1,$j.isAlpha=!1,$j.premultipliedAlpha=!0,$j.isStencil=!0,$j.preserveDrawingBuffer=!1,$j}()),$H=function(){function $H(){this._events=null}$b($H,"laya.events.EventDispatcher");var $j=$H.prototype;return $j.hasListener=function($j){return!!(this._events&&this._events[$j])},$j.getListener=function($j){return this._events?this._events[$j]:null},$j.event=function($j,$O){if(!this._events||!this._events[$j])return!1;var $V=this._events[$j];if($V.lock)$V.queue||($V.queue=[]),$V.queue.push($O);else{var $l;for($V.lock=!0,$V.cursor=$V.head;$V.cursor;)($l=$V.cursor).recover?($V.head=$V.tail=$V.cursor=null,console.error("node is recover："+$l.id)):($V.cursor=$l.next,$l.once&&$H.delNode($V,$l),$l.method&&(null!=$O?$l.args?$l.method.apply($l.caller,$l.args.concat($O)):$O instanceof Array?$l.method.apply($l.caller,$O):$l.caller?$l.method.call($l.caller,$O):$E.recordError("事件派发错误","node.caller:"+$l.caller+"node.method:"+$l.method+"data:"+$O+"node.prev"+$l.prev):$l.method.apply($l.caller,$l.args)),$l.once&&$H.recoverHandler($l));$V.lock=!1,!$V.head&&this._events&&this._events[$j]==$V&&delete this._events[$j],$V.queue&&$V.queue.length&&this.event($j,$V.queue.shift())}return!0},$j.on=function($j,$O,$V,$l){return this._createListener($j,$O,$V,$l,!1)},$j.once=function($j,$O,$V,$l){return this._createListener($j,$O,$V,$l,!0)},$j._createListener=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=!0),$S&&this.off($j,$O,$V,$T);var $m=$H.createHandler($O||this,$V,$l,$T);this._events||(this._events={});var $p=this._events,$o=$p[$j];return $o?$o.tail?($m.prev=$o.tail,$o.tail.next=$m,$o.tail=$m):$o.head=$o.tail=$m:$p[$j]={head:$m,tail:$m,cursor:null,lock:!1},this},$j.off=function($j,$O,$V,$l){if(void 0===$l&&($l=!1),!this._events||!this._events[$j])return this;for(var $T=this._events[$j],$S=$T.head;$S;){if((!$O||$S.caller===$O)&&$S.method===$V&&(!$l||$S.once)){$H.delNode($T,$S),$T.cursor==$S&&($T.cursor=$S.next),$H.recoverHandler($S);break}$S=$S.next}return this},$j.offAll=function($j){var $O=this._events;if(!$O)return this;if($j)this._recoverHandlers($O[$j]),delete $O[$j];else{for(var $V in $O)this._recoverHandlers($O[$V]);this._events=null}return this},$j._recoverHandlers=function($j){if($j){for(var $O=$j.head;$O;){$H.delNode($j,$O);var $V=$O.next;$H.recoverHandler($O),$O=$V}$j.cursor=null}},$j.isMouseEvent=function($j){return $H.MOUSE_EVENTS[$j]},$H.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$H.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$H.delNode=function($j,$O){$O.prev?$O.prev.next=$O.next:$j.head=$O.next,$O.next?$O.next.prev=$O.prev:$j.tail=$O.prev},$H.createHandler=function($j,$O,$V,$l){var $T=500<$H._freeHandler.length?$H._freeHandler.shift():null;if($T)if($T.recover)$T.recover=!1,$T.caller=$j,$T.method=$O,$T.args=$V,$T.once=$l;else{var $S="";try{arguments.propertyIsEnumerable.caller}catch($j){$S=$j.stack}var $m=$T.caller?($T.caller.__proto__&&$T.caller.__proto__.constructor&&$T.caller.__proto__.constructor.name)+"|"+$T.caller.__className+"|"+$T.caller.name:"",$p=$T.method?$T.method.name:"";$E.recordError("EventDispatcher重复创建","caller="+$m+"  method="+$p+"  stack="+$S),$T={id:++$H._nodeCount,caller:$j,method:$O,args:$V,once:$l,recover:!1}}else $T={id:++$H._nodeCount,caller:$j,method:$O,args:$V,once:$l,recover:!1};return $T.prev=$T.next=null,$T},$H.recoverHandler=function($j){if($j.recover){if($H._errorCount<5){$H._errorCount++;var $O="";try{arguments.propertyIsEnumerable.caller}catch($j){$O=$j.stack}var $V=$j.caller?($j.caller.__proto__&&$j.caller.__proto__.constructor&&$j.caller.__proto__.constructor.name)+"|"+$j.caller.__className+"|"+$j.caller.name:"",$l=$j.method?$j.method.name:"";$E.recordError("EventDispatcher重复回收","id="+$j.id+"  caller="+$V+"  method="+$l+"  stack="+$O)}$j.caller=$j.method=$j.args=$j.prev=null}else $j.recover=!0,$j.caller=$j.method=$j.args=$j.prev=$j.next=null,$H._freeHandler&&$H._freeHandler.length<3e3&&$H._freeHandler.push($j)},$H._freeHandler=[],$H._nodeCount=0,$H._errorCount=0,$H}(),$a=function(){function $T($j,$O,$V,$l){this.once=!1,void(this._id=0)===$l&&($l=!1),this.setTo($j,$O,$V,$l)}$b($T,"laya.utils.Handler");var $j=$T.prototype;return $j.setTo=function($j,$O,$V,$l){return this._id=$T._gid++,this.caller=$j,this.method=$O,this.args=$V,this.once=$l,this},$j.run=function(){if(null==this.method)return null;var $j=this._id,$O=this.method.apply(this.caller,this.args);return this._id===$j&&this.once&&this.recover(),$O},$j.runWith=function($j){if(null==this.method)return null;var $O=this._id;if(null==$j)var $V=this.method.apply(this.caller,this.args);else $V=this.args||$j.unshift?this.args?this.method.apply(this.caller,this.args.concat($j)):this.method.apply(this.caller,$j):this.method.call(this.caller,$j);return this._id===$O&&this.once&&this.recover(),$V},$j.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$j.recover=function(){0<this._id&&(this._id=0,this.clear())},$T.create=function($j,$O,$V,$l){return void 0===$l&&($l=!0),new $T($j,$O,$V,$l)},$T._gid=1,$T}(),$_=function(){function $j(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$b($j,"laya.display.BitmapFont");var $O=$j.prototype;return $O.loadFont=function($j,$O){this._path=$j,this._complete=$O,$E.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$a.create(this,this.onLoaded))},$O.onLoaded=function(){this.parseFont($pj.getRes(this._path),$pj.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$O.parseFont=function($j,$O){if(null!=$j&&null!=$O){this._texture=$O;var $V=$j.getElementsByTagName("info");if(!$V[0].getAttributeNode)return this.parseFont2($j,$O);this.fontSize=parseInt($V[0].getAttributeNode("size").nodeValue);var $l,$T=$V[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($T[0]),parseInt($T[1]),parseInt($T[2]),parseInt($T[3])],$l=$j.getElementsByTagName("char");var $S=0;for($S=0;$S<$l.length;$S++){var $m=$l[$S],$p=parseInt($m.getAttributeNode("id").nodeValue),$o=parseInt($m.getAttributeNode("xoffset").nodeValue)/1,$H=parseInt($m.getAttributeNode("yoffset").nodeValue)/1,$g=parseInt($m.getAttributeNode("xadvance").nodeValue)/1,$e=new $z;$e.x=parseInt($m.getAttributeNode("x").nodeValue),$e.y=parseInt($m.getAttributeNode("y").nodeValue),$e.width=parseInt($m.getAttributeNode("width").nodeValue),$e.height=parseInt($m.getAttributeNode("height").nodeValue);var $t=$gj.create($O,$e.x,$e.y,$e.width,$e.height,$o,$H);this._maxWidth=Math.max(this._maxWidth,$g+this.letterSpacing),this._fontCharDic[$p]=$t,this._fontWidthMap[$p]=$g}}},$O.parseFont2=function($j,$O){if(null!=$j&&null!=$O){this._texture=$O;var $V=$j.getElementsByTagName("info");this.fontSize=parseInt($V[0].attributes.size.nodeValue);var $l=$V[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($l[0]),parseInt($l[1]),parseInt($l[2]),parseInt($l[3])];var $T=$j.getElementsByTagName("char"),$S=0;for($S=0;$S<$T.length;$S++){var $m=$T[$S].attributes,$p=parseInt($m.id.nodeValue),$o=parseInt($m.xoffset.nodeValue)/1,$H=parseInt($m.yoffset.nodeValue)/1,$g=parseInt($m.xadvance.nodeValue)/1,$e=new $z;$e.x=parseInt($m.x.nodeValue),$e.y=parseInt($m.y.nodeValue),$e.width=parseInt($m.width.nodeValue),$e.height=parseInt($m.height.nodeValue);var $t=$gj.create($O,$e.x,$e.y,$e.width,$e.height,$o,$H);this._maxWidth=Math.max(this._maxWidth,$g+this.letterSpacing),this._fontCharDic[$p]=$t,this._fontWidthMap[$p]=$g}}},$O.getCharTexture=function($j){return this._fontCharDic[$j.charCodeAt(0)]},$O.destroy=function(){if(this._texture){for(var $j in this._fontCharDic){var $O=this._fontCharDic[$j];$O&&$O.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$O.setSpaceWidth=function($j){this._spaceWidth=$j},$O.getCharWidth=function($j){var $O=$j.charCodeAt(0);return this._fontWidthMap[$O]?this._fontWidthMap[$O]+this.letterSpacing:" "==$j?this._spaceWidth+this.letterSpacing:0},$O.getTextWidth=function($j){for(var $O=0,$V=0,$l=$j.length;$V<$l;$V++)$O+=this.getCharWidth($j.charAt($V));return $O},$O.getMaxWidth=function(){return this._maxWidth},$O.getMaxHeight=function(){return this.fontSize},$O.drawText=function($j,$O,$V,$l,$T,$S){var $m,$p=this.getTextWidth($j),$o=0;"center"===$T&&($o=($S-$p)/2),"right"===$T&&($o=$S-$p);for(var $H=0,$g=0,$e=$j.length;$g<$e;$g++)($m=this.getCharTexture($j.charAt($g)))&&($O.graphics.drawTexture($m,$V+$H+$o,$l),$H+=this.getCharWidth($j.charAt($g)))},$j}(),$p=function(){function $V(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$V._TF_EMPTY}$b($V,"laya.display.css.Style");var $j=$V.prototype;return $j.getTransform=function(){return this._tf},$j.setTransform=function($j){this._tf="none"!==$j&&$j?$j:$V._TF_EMPTY},$j.setTranslateX=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.translateX=$j},$j.setTranslateY=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.translateY=$j},$j.setScaleX=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.scaleX=$j},$j.setScale=function($j,$O){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.scaleX=$j,this._tf.scaleY=$O},$j.setScaleY=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.scaleY=$j},$j.setRotate=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.rotate=$j},$j.setSkewX=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.skewX=$j},$j.setSkewY=function($j){this._tf===$V._TF_EMPTY&&(this._tf=new $T),this._tf.skewY=$j},$j.destroy=function(){this.scrollRect=null},$j.render=function($j,$O,$V,$l){},$j.getCSSStyle=function(){return $Oj.EMPTY},$j._enableLayout=function(){return!1},$g(0,$j,"scaleX",function(){return this._tf.scaleX},function($j){this.setScaleX($j)}),$g(0,$j,"transform",function(){return this.getTransform()},function($j){this.setTransform($j)}),$g(0,$j,"translateX",function(){return this._tf.translateX},function($j){this.setTranslateX($j)}),$g(0,$j,"translateY",function(){return this._tf.translateY},function($j){this.setTranslateY($j)}),$g(0,$j,"scaleY",function(){return this._tf.scaleY},function($j){this.setScaleY($j)}),$g(0,$j,"block",function(){return 0!=(1&this._type)}),$g(0,$j,"skewY",function(){return this._tf.skewY},function($j){this.setSkewY($j)}),$g(0,$j,"rotate",function(){return this._tf.rotate},function($j){this.setRotate($j)}),$g(0,$j,"skewX",function(){return this._tf.skewX},function($j){this.setSkewX($j)}),$g(0,$j,"paddingLeft",function(){return 0}),$g(0,$j,"paddingTop",function(){return 0}),$g(0,$j,"absolute",function(){return!0}),$V.__init__=function(){$V._TF_EMPTY=new $T,$V.EMPTY=new $V},$V.EMPTY=null,$V._TF_EMPTY=null,$V}(),$w=function(){function $O($j){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$C.create($O.defaultColor),this.family=$O.defaultFamily,this.stroke=$O._STROKE,this.size=$O.defaultSize,$j&&$j!==$O.EMPTY&&$j.copyTo(this)}$b($O,"laya.display.css.Font");var $j=$O.prototype;return $j.set=function($j){this._text=null;for(var $O=$j.split(" "),$V=0,$l=$O.length;$V<$l;$V++){var $T=$O[$V];switch($T){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$T.indexOf("px")&&(this.size=parseInt($T),this.family=$O[$V+1],$V++)}},$j.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$j.copyTo=function($j){$j._type=this._type,$j._text=this._text,$j._weight=this._weight,$j._color=this._color,$j.family=this.family,$j.stroke=this.stroke!=$O._STROKE?this.stroke.slice():$O._STROKE,$j.indent=this.indent,$j.size=this.size},$g(0,$j,"password",function(){return 0!=(1024&this._type)},function($j){$j?this._type|=1024:this._type&=-1025}),$g(0,$j,"color",function(){return this._color.strColor},function($j){this._color=$C.create($j)}),$g(0,$j,"italic",function(){return 0!=(512&this._type)},function($j){$j?this._type|=512:this._type&=-513}),$g(0,$j,"bold",function(){return 0!=(2048&this._type)},function($j){$j?this._type|=2048:this._type&=-2049}),$g(0,$j,"weight",function(){return""+this._weight},function($j){var $O=0;switch($j){case"normal":break;case"bold":this.bold=!0,$O=700;break;case"bolder":$O=800;break;case"lighter":$O=100;break;default:$O=parseInt($j)}this._weight=$O,this._text=null}),$g(0,$j,"decoration",function(){return this._decoration?this._decoration.value:null},function($j){var $O=$j.split(" ");switch(this._decoration||(this._decoration={}),$O[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$O[0]}$O[1]&&(this._decoration.color=$C.create($O)),this._decoration.value=$j}),$O.__init__=function(){$O.EMPTY=new $O(null)},$O.EMPTY=null,$O.defaultColor="#000000",$O.defaultSize=12,$O.defaultFamily="Arial",$O.defaultFont="12px Arial",$O._STROKE=[0,"#000000"],$O._ITALIC=512,$O._PASSWORD=1024,$O._BOLD=2048,$O}(),$T=function(){function $j(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $b($j,"laya.display.css.TransformInfo"),$j}(),$t=function(){function $e(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$q.isConchNode){this._nativeObj=new $m._conchGraphics,this.id=this._nativeObj.conchID}}$b($e,"laya.display.Graphics");var $j=$e.prototype;return $j.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$j.clear=function($j){void 0===$j&&($j=!1);var $O=0,$V=0;if($j){var $l=this._one;if(this._cmds){for($V=this._cmds.length,$O=0;$O<$V;$O++)!($l=this._cmds[$O])||$l.callee!==$q._context._drawTexture&&$l.callee!==$q._context._drawTextureWithTransform||($l[0]=null,$e._cache.push($l));this._cmds.length=0}else $l&&(!$l||$l.callee!==$q._context._drawTexture&&$l.callee!==$q._context._drawTextureWithTransform||($l[0]=null,$e._cache.push($l)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($O=0,$V=this._vectorgraphArray.length;$O<$V;$O++)$D.getInstance().deleteShape(this._vectorgraphArray[$O]);this._vectorgraphArray.length=0}},$j._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$j._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $V,this._graphicBounds._graphics=this)},$j._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$j._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$j.getBounds=function($j){return void 0===$j&&($j=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($j)},$j.getBoundPoints=function($j){return void 0===$j&&($j=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($j)},$j._addCmd=function($j){this._cmds=this._cmds||[],$j.callee=$j.shift(),this._cmds.push($j)},$j.setFilters=function($j){this._saveToCmd($q._context._setFilters,$j)},$j.drawTexture=function($j,$O,$V,$l,$T,$S,$m){if(void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$m&&($m=1),!$j||$m<.01)return null;$l||($l=$j.sourceWidth),$T||($T=$j.sourceHeight),$m=$m<0?0:1<$m?1:$m;var $p,$o=!$q.isWebGL&&($F.onFirefox||$F.onEdge||$F.onIE||$F.onSafari)?.5:0,$H=$l/$j.sourceWidth,$g=$T/$j.sourceHeight;return $l=$j.width*$H,$T=$j.height*$g,$j.loaded&&($l<=0||$T<=0)?null:($O+=$j.offsetX*$H,$V+=$j.offsetY*$g,this._sp&&(this._sp._renderType|=512),$O-=$o,$V-=$o,$l+=2*$o,$T+=2*$o,$e._cache.length?(($p=$e._cache.pop())[0]=$j,$p[1]=$O,$p[2]=$V,$p[3]=$l,$p[4]=$T,$p[5]=$S,$p[6]=$m):$p=[$j,$O,$V,$l,$T,$S,$m],$p.callee=$S||1!=$m?$q._context._drawTextureWithTransform:$q._context._drawTexture,null!=this._one||$S||1!=$m?this._saveToCmd($p.callee,$p):(this._one=$p,this._render=this._renderOneImg),$j.loaded||$j.once("loaded",this,this._textureLoaded,[$j,$p]),this._repaint(),$p)},$j.cleanByTexture=function($j,$O,$V,$l,$T){if(void 0===$l&&($l=0),void 0===$T&&($T=0),!$j)return this.clear();if(this._one&&this._render===this._renderOneImg){$l||($l=$j.sourceWidth),$T||($T=$j.sourceHeight);var $S=$l/$j.sourceWidth,$m=$T/$j.sourceHeight;$l=$j.width*$S,$T=$j.height*$m,$O+=$j.offsetX*$S,$V+=$j.offsetY*$m,this._one[0]=$j,this._one[1]=$O,this._one[2]=$V,this._one[3]=$l,this._one[4]=$T,this._repaint()}else this.clear(),$j&&this.drawTexture($j,$O,$V,$l,$T)},$j.drawTextures=function($j,$O){$j&&this._saveToCmd($q._context._drawTextures,[$j,$O])},$j.fillTexture=function($j,$O,$V,$l,$T,$S,$m){if(void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$S&&($S="repeat"),$j){var $p=[$j,$O,$V,$l,$T,$S,$m||$U.EMPTY,{}];$j.loaded||$j.once("loaded",this,this._textureLoaded,[$j,$p]),this._saveToCmd($q._context._fillTexture,$p)}},$j._textureLoaded=function($j,$O){$O[3]=$O[3]||$j.width,$O[4]=$O[4]||$j.height,this._repaint()},$j.fillCircle=function($j,$O,$V,$l,$T,$S,$m){$V.bitmap.enableMerageInAtlas=!1;var $p=new Float32Array(2*($m+1)),$o=new Float32Array(2*($m+1)),$H=new Uint16Array(3*$m),$g=2*Math.PI/$m,$e=0;$p[0]=$l,$p[1]=$T,$o[0]=$l/$V.width,$o[1]=$T/$V.height;for(var $t=2,$w=0;$w<$m;$w++){var $s=$S*Math.cos($e)+$l,$b=$S*Math.sin($e)+$T;$p[$t]=$s,$p[$t+1]=$b,$o[$t]=$s/$V.width,$o[$t+1]=$b/$V.height,$e+=$g,$t+=2}for($w=$t=0;$w<$m;$w++)$H[$t++]=0,$H[$t++]=$w+1,$H[$t++]=$m+1<=$w+2?1:$w+2;this.drawTriangles($V,$j,$O,$p,$o,$H)},$j.drawTriangles=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){void 0===$p&&($p=1),this._saveToCmd($q._context.drawTriangles,[$j,$O,$V,$l,$T,$S,$m,$p,$o,$H])},$j._saveToCmd=function($j,$O){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$O,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($O)),$O.callee=$j,this._repaint(),$O},$j.clipRect=function($j,$O,$V,$l){this._saveToCmd($q._context._clipRect,[$j,$O,$V,$l])},$j.fillText=function($j,$O,$V,$l,$T,$S,$m){void 0===$m&&($m=0),this._saveToCmd($q._context._fillText,[$j,$O,$V,$l||$w.defaultFont,$T,$S])},$j.fillBorderText=function($j,$O,$V,$l,$T,$S,$m,$p){this._saveToCmd($q._context._fillBorderText,[$j,$O,$V,$l||$w.defaultFont,$T,$S,$m,$p])},$j.strokeText=function($j,$O,$V,$l,$T,$S,$m){this._saveToCmd($q._context._strokeText,[$j,$O,$V,$l||$w.defaultFont,$T,$S,$m])},$j.alpha=function($j){$j=$j<0?0:1<$j?1:$j,this._saveToCmd($q._context._alpha,[$j])},$j.setAlpha=function($j){$j=$j<0?0:1<$j?1:$j,this._saveToCmd($q._context._setAlpha,[$j])},$j.transform=function($j,$O,$V){void 0===$O&&($O=0),void 0===$V&&($V=0),this._saveToCmd($q._context._transform,[$j,$O,$V])},$j.rotate=function($j,$O,$V){void 0===$O&&($O=0),void 0===$V&&($V=0),this._saveToCmd($q._context._rotate,[$j,$O,$V])},$j.scale=function($j,$O,$V,$l){void 0===$V&&($V=0),void 0===$l&&($l=0),this._saveToCmd($q._context._scale,[$j,$O,$V,$l])},$j.translate=function($j,$O){this._saveToCmd($q._context._translate,[$j,$O])},$j.save=function(){this._saveToCmd($q._context._save,[])},$j.restore=function(){this._saveToCmd($q._context._restore,[])},$j.replaceText=function($j){this._repaint();var $O=this._cmds;if($O){for(var $V=$O.length-1;-1<$V;$V--)if(this._isTextCmd($O[$V].callee))return $O[$V][0].toUpperCase?$O[$V][0]=$j:$O[$V][0].setText($j),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$j:this._one[0].setText($j),!0;return!1},$j._isTextCmd=function($j){return $j===$q._context._fillText||$j===$q._context._fillBorderText||$j===$q._context._strokeText},$j.replaceTextColor=function($j){this._repaint();var $O=this._cmds;if($O)for(var $V=$O.length-1;-1<$V;$V--)this._isTextCmd($O[$V].callee)&&($O[$V][4]=$j,$O[$V][0].toUpperCase||($O[$V][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$j,this._one[0].toUpperCase||(this._one[0].changed=!0))},$j.loadImage=function($j,$O,$V,$l,$T,$S){var $m=this;void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0),void 0===$T&&($T=0);var $p=$pj.getRes($j);function $o($j){$j&&($m.drawTexture($j,$O,$V,$l,$T),null!=$S&&$S.call($m._sp,$j))}$p?$o($p):$E.loader.load($j,$a.create(null,$o),null,"image")},$j._renderEmpty=function($j,$O,$V,$l){},$j._renderAll=function($j,$O,$V,$l){for(var $T,$S=this._cmds,$m=0,$p=$S.length;$m<$p;$m++)($T=$S[$m]).callee.call($O,$V,$l,$T)},$j._renderOne=function($j,$O,$V,$l){this._one.callee.call($O,$V,$l,this._one)},$j._renderOneImg=function($j,$O,$V,$l){this._one.callee.call($O,$V,$l,this._one),2305!==$j._renderType&&($j._renderType|=1)},$j.drawLine=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=1);var $m=0;$q.isWebGL&&($m=$D.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($m));var $p=$S%2==0?0:.5,$o=[$j+$p,$O+$p,$V+$p,$l+$p,$T,$S,$m];this._saveToCmd($q._context._drawLine,$o)},$j.drawLines=function($j,$O,$V,$l,$T){void 0===$T&&($T=1);var $S=0;if($V&&!($V.length<4)){$q.isWebGL&&($S=$D.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($S));var $m=$T%2==0?0:.5,$p=[$j+$m,$O+$m,$V,$l,$T,$S];this._saveToCmd($q._context._drawLines,$p)}},$j.drawCurves=function($j,$O,$V,$l,$T){void 0===$T&&($T=1);var $S=[$j,$O,$V,$l,$T];this._saveToCmd($q._context._drawCurves,$S)},$j.drawRect=function($j,$O,$V,$l,$T,$S,$m){void 0===$m&&($m=1);var $p=$S?$m/2:0,$o=$S?$m:0,$H=[$j+$p,$O+$p,$V-$o,$l-$o,$T,$S,$m];this._saveToCmd($q._context._drawRect,$H)},$j.drawCircle=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=1);var $m=$T?$S/2:0,$p=0;$q.isWebGL&&($p=$D.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($p));var $o=[$j,$O,$V-$m,$l,$T,$S,$p];this._saveToCmd($q._context._drawCircle,$o)},$j.drawPie=function($j,$O,$V,$l,$T,$S,$m,$p){void 0===$p&&($p=1);var $o=$m?$p/2:0,$H=$m?$p:0,$g=0;$q.isWebGL&&($g=$D.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($g));var $e=[$j+$o,$O+$o,$V-$H,$l,$T,$S,$m,$p,$g];$e[3]=$Q.toRadian($l),$e[4]=$Q.toRadian($T),this._saveToCmd($q._context._drawPie,$e)},$j.drawPoly=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=1);var $m=0,$p=!1;$q.isWebGL&&($m=$D.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($m),$p=!(6<$V.length));var $o=$T?$S%2==0?0:.5:0,$H=[$j+$o,$O+$o,$V,$l,$T,$S,$m,$p];this._saveToCmd($q._context._drawPoly,$H)},$j.drawPath=function($j,$O,$V,$l,$T){var $S=[$j,$O,$V,$l,$T];this._saveToCmd($q._context._drawPath,$S)},$g(0,$j,"cmds",function(){return this._cmds},function($j){this._sp&&(this._sp._renderType|=512),this._cmds=$j,this._render=this._renderAll,this._repaint()}),$e.__init__=function(){if($q.isConchNode){for(var $j=laya.display.Graphics.prototype,$O=$F.window.ConchGraphics.prototype,$V=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$l=0,$T=$V.length;$l<=$T;$l++){var $S=$V[$l];$j[$S]=$O[$S]}$j._saveToCmd=null,$O.drawImageS&&($j.drawTextures=function($j,$O){if($j&&$j.loaded&&$j.bitmap&&$j.source){var $V=$j.uv,$l=$j.bitmap.width,$T=$j.bitmap.height;this.drawImageS($j.bitmap.source,$V[0]*$l,$V[1]*$T,($V[2]-$V[0])*$l,($V[5]-$V[3])*$T,$j.offsetX,$j.offsetY,$j.width,$j.height,$O)}}),$j.drawTexture=function($j,$O,$V,$l,$T,$S,$m){if(void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$m&&($m=1),$j)if($j.loaded){if($j.loaded&&$j.bitmap&&$j.source&&($l||($l=$j.sourceWidth),$T||($T=$j.sourceHeight),$m=$m<0?0:1<$m?1:$m,$l=$l-$j.sourceWidth+$j.width,$T=$T-$j.sourceHeight+$j.height,!($l<=0||$T<=0))){$O+=$j.offsetX,$V+=$j.offsetY;var $p=$j.uv,$o=$j.bitmap.width,$H=$j.bitmap.height;$p[4]<$p[0]&&$p[5]<$p[1]?this.drawImageM($j.bitmap.source,$p[4]*$o,$p[5]*$H,($p[0]-$p[4])*$o,($p[1]-$p[5])*$H,$O,$V,$l,$T,$S,$m):this.drawImageM($j.bitmap.source,$p[0]*$o,$p[1]*$H,($p[2]-$p[0])*$o,($p[5]-$p[3])*$H,$O,$V,$l,$T,$S,$m),this._repaint()}}else $j.once("loaded",this,function(){this.drawTexture($j,$O,$V,$l,$T,$S)})},$j.fillTexture=function($j,$O,$V,$l,$T,$S,$m){if(void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$S&&($S="repeat"),$j&&$j.loaded){var $p,$o=$q._context.ctx,$H=$j.bitmap.width,$g=$j.bitmap.height,$e=$j.uv;$p=$j.uv!=$gj.DEF_UV?$o.createPattern($j.bitmap.source,$S,$e[0]*$H,$e[1]*$g,($e[2]-$e[0])*$H,($e[5]-$e[3])*$g):$o.createPattern($j.bitmap.source,$S);var $t=0,$w=0;$m&&($O+=$m.x%$j.width,$V+=$m.y%$j.height,$t-=$m.x%$j.width,$w-=$m.y%$j.height),this._fillImage($p,$O,$V,$t,$w,$l,$T)}}}},$e._cache=[],$e}(),$V=function(){function $c(){this._cacheBoundsType=!1}$b($c,"laya.display.GraphicsBounds");var $j=$c.prototype;return $j.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$j.reset=function(){this._temp&&(this._temp.length=0)},$j.getBounds=function($j){return void 0===$j&&($j=!1),(!this._bounds||!this._temp||this._temp.length<1||$j!=this._cacheBoundsType)&&(this._bounds=$z._getWrapRec(this.getBoundPoints($j),this._bounds)),this._cacheBoundsType=$j,this._bounds},$j.getBoundPoints=function($j){return void 0===$j&&($j=!1),(!this._temp||this._temp.length<1||$j!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($j)),this._cacheBoundsType=$j,this._rstBoundPoints=$Q.copyArray(this._rstBoundPoints,this._temp)},$j._getCmdPoints=function($j){void 0===$j&&($j=!1);var $O,$V,$l=$q._context,$T=this._graphics.cmds;if(($O=this._temp||(this._temp=[])).length=0,$T||null==this._graphics._one||($c._tempCmds.length=0,$c._tempCmds.push(this._graphics._one),$T=$c._tempCmds),!$T)return $O;($V=$c._tempMatrixArrays).length=0;var $S=$c._initMatrix;$S.identity();for(var $m,$p,$o=$c._tempMatrix,$H=NaN,$g=NaN,$e=NaN,$t=NaN,$w=NaN,$s=NaN,$b=0,$r=$T.length;$b<$r;$b++)if(($m=$T[$b]).callee)switch($m.callee){case $l._save:case 7:$V.push($S),$S=$S.clone();break;case $l._restore:case 8:$S=$V.pop();break;case $l._scale:case 5:$o.identity(),$o.translate(-$m[2],-$m[3]),$o.scale($m[0],$m[1]),$o.translate($m[2],$m[3]),this._switchMatrix($S,$o);break;case $l._rotate:case 3:$o.identity(),$o.translate(-$m[1],-$m[2]),$o.rotate($m[0]),$o.translate($m[1],$m[2]),this._switchMatrix($S,$o);break;case $l._translate:case 6:$o.identity(),$o.translate($m[0],$m[1]),this._switchMatrix($S,$o);break;case $l._transform:case 4:$o.identity(),$o.translate(-$m[1],-$m[2]),$o.concat($m[0]),$o.translate($m[1],$m[2]),this._switchMatrix($S,$o);break;case 16:case 24:$c._addPointArrToRst($O,$z._getBoundPointS($m[0],$m[1],$m[2],$m[3]),$S);break;case 17:$S.copyTo($o),$o.concat($m[4]),$c._addPointArrToRst($O,$z._getBoundPointS($m[0],$m[1],$m[2],$m[3]),$o);break;case $l._drawTexture:$p=$m[0],$j?$m[3]&&$m[4]?$c._addPointArrToRst($O,$z._getBoundPointS($m[1],$m[2],$m[3],$m[4]),$S):($p=$m[0],$c._addPointArrToRst($O,$z._getBoundPointS($m[1],$m[2],$p.width,$p.height),$S)):($H=($m[3]||$p.sourceWidth)/$p.width,$g=($m[4]||$p.sourceHeight)/$p.height,$e=$H*$p.sourceWidth,$t=$g*$p.sourceHeight,$w=0<$p.offsetX?$p.offsetX:0,$s=0<$p.offsetY?$p.offsetY:0,$w*=$H,$s*=$g,$c._addPointArrToRst($O,$z._getBoundPointS($m[1]-$w,$m[2]-$s,$e,$t),$S));break;case $l._fillTexture:$m[3]&&$m[4]?$c._addPointArrToRst($O,$z._getBoundPointS($m[1],$m[2],$m[3],$m[4]),$S):($p=$m[0],$c._addPointArrToRst($O,$z._getBoundPointS($m[1],$m[2],$p.width,$p.height),$S));break;case $l._drawTextureWithTransform:var $h;$h=$m[5]?($S.copyTo($o),$o.concat($m[5]),$o):$S,$j?$m[3]&&$m[4]?$c._addPointArrToRst($O,$z._getBoundPointS($m[1],$m[2],$m[3],$m[4]),$h):($p=$m[0],$c._addPointArrToRst($O,$z._getBoundPointS($m[1],$m[2],$p.width,$p.height),$h)):($p=$m[0],$H=($m[3]||$p.sourceWidth)/$p.width,$g=($m[4]||$p.sourceHeight)/$p.height,$e=$H*$p.sourceWidth,$t=$g*$p.sourceHeight,$w=0<$p.offsetX?$p.offsetX:0,$s=0<$p.offsetY?$p.offsetY:0,$w*=$H,$s*=$g,$c._addPointArrToRst($O,$z._getBoundPointS($m[1]-$w,$m[2]-$s,$e,$t),$h));break;case $l._drawRect:case 13:$c._addPointArrToRst($O,$z._getBoundPointS($m[0],$m[1],$m[2],$m[3]),$S);break;case $l._drawCircle:case $l._fillCircle:case 14:$c._addPointArrToRst($O,$z._getBoundPointS($m[0]-$m[2],$m[1]-$m[2],$m[2]+$m[2],$m[2]+$m[2]),$S);break;case $l._drawLine:case 20:$c._tempPoints.length=0;var $a;$a=.5*$m[5],$m[0]==$m[2]?$c._tempPoints.push($m[0]+$a,$m[1],$m[2]+$a,$m[3],$m[0]-$a,$m[1],$m[2]-$a,$m[3]):$m[1]==$m[3]?$c._tempPoints.push($m[0],$m[1]+$a,$m[2],$m[3]+$a,$m[0],$m[1]-$a,$m[2],$m[3]-$a):$c._tempPoints.push($m[0],$m[1],$m[2],$m[3]),$c._addPointArrToRst($O,$c._tempPoints,$S);break;case $l._drawCurves:case 22:$c._addPointArrToRst($O,$A.I.getBezierPoints($m[2]),$S,$m[0],$m[1]);break;case $l._drawPoly:case $l._drawLines:case 18:$c._addPointArrToRst($O,$m[2],$S,$m[0],$m[1]);break;case $l._drawPath:case 19:$c._addPointArrToRst($O,this._getPathPoints($m[2]),$S,$m[0],$m[1]);break;case $l._drawPie:case 15:$c._addPointArrToRst($O,this._getPiePoints($m[0],$m[1],$m[2],$m[3],$m[4]),$S)}return 200<$O.length?$O=$Q.copyArray($O,$z._getWrapRec($O)._getBoundPoints()):8<$O.length&&($O=$Z.scanPList($O)),$O},$j._switchMatrix=function($j,$O){$O.concat($j),$O.copyTo($j)},$j._getPiePoints=function($j,$O,$V,$l,$T){var $S=$c._tempPoints;$c._tempPoints.length=0,$S.push($j,$O);var $m=($T-$l)%(2*Math.PI)/10,$p=NaN,$o=$l;for($p=0;$p<=10;$p++)$S.push($j+$V*Math.cos($o),$O+$V*Math.sin($o)),$o+=$m;return $S},$j._getPathPoints=function($j){var $O,$V,$l=0,$T=$c._tempPoints;for($T.length=0,$O=$j.length,$l=0;$l<$O;$l++)1<($V=$j[$l]).length&&($T.push($V[1],$V[2]),3<$V.length&&$T.push($V[3],$V[4]));return $T},$c._addPointArrToRst=function($j,$O,$V,$l,$T){void 0===$l&&($l=0),void 0===$T&&($T=0);var $S,$m=0;for($S=$O.length,$m=0;$m<$S;$m+=2)$c._addPointToRst($j,$O[$m]+$l,$O[$m+1]+$T,$V)},$c._addPointToRst=function($j,$O,$V,$l){var $T=$U.TEMP;$T.setTo($O||0,$V||0),$l.transformPoint($T),$j.push($T.x,$T.y)},$c._tempPoints=[],$c._tempMatrixArrays=[],$c._tempCmds=[],$o($c,["_tempMatrix",function(){return this._tempMatrix=new $v},"_initMatrix",function(){return this._initMatrix=new $v}]),$c}(),$S=function(){function $j(){}$b($j,"laya.events.Event");var $O=$j.prototype;return $O.setTo=function($j,$O,$V){return this.type=$j,this.currentTarget=$O,this.target=$V,this},$O.stopPropagation=function(){this._stoped=!0},$g(0,$O,"stageY",function(){return $E.stage.mouseY}),$g(0,$O,"charCode",function(){return this.nativeEvent.charCode}),$g(0,$O,"touches",function(){var $j=this.nativeEvent.touches;if($j)for(var $O=$E.stage,$V=0,$l=$j.length;$V<$l;$V++){var $T=$j[$V],$S=$U.TEMP;$S.setTo($T.clientX,$T.clientY),$O._canvasTransform.invertTransformPoint($S),$O.transform.invertTransformPoint($S),$T.stageX=$S.x,$T.stageY=$S.y}return $j}),$g(0,$O,"keyLocation",function(){return this.nativeEvent.keyLocation}),$g(0,$O,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$g(0,$O,"altKey",function(){return this.nativeEvent.altKey}),$g(0,$O,"shiftKey",function(){return this.nativeEvent.shiftKey}),$g(0,$O,"stageX",function(){return $E.stage.mouseX}),$j.EMPTY=new $j,$j.MOUSE_DOWN="mousedown",$j.MOUSE_UP="mouseup",$j.CLICK="click",$j.RIGHT_MOUSE_DOWN="rightmousedown",$j.RIGHT_MOUSE_UP="rightmouseup",$j.RIGHT_CLICK="rightclick",$j.MOUSE_MOVE="mousemove",$j.MOUSE_OVER="mouseover",$j.MOUSE_OUT="mouseout",$j.MOUSE_WHEEL="mousewheel",$j.ROLL_OVER="mouseover",$j.ROLL_OUT="mouseout",$j.DOUBLE_CLICK="doubleclick",$j.CHANGE="change",$j.CHANGED="changed",$j.RESIZE="resize",$j.ADDED="added",$j.REMOVED="removed",$j.DISPLAY="display",$j.UNDISPLAY="undisplay",$j.ERROR="error",$j.COMPLETE="complete",$j.LOADED="loaded",$j.INITED="inited",$j.PROGRESS="progress",$j.INPUT="input",$j.RENDER="render",$j.OPEN="open",$j.MESSAGE="message",$j.CLOSE="close",$j.KEY_DOWN="keydown",$j.KEY_PRESS="keypress",$j.KEY_UP="keyup",$j.FRAME="enterframe",$j.DRAG_START="dragstart",$j.DRAG_MOVE="dragmove",$j.DRAG_END="dragend",$j.ENTER="enter",$j.SELECT="select",$j.BLUR="blur",$j.FOCUS="focus",$j.VISIBILITY_CHANGE="visibilitychange",$j.FOCUS_CHANGE="focuschange",$j.PLAYED="played",$j.PAUSED="paused",$j.STOPPED="stopped",$j.START="start",$j.END="end",$j.ENABLE_CHANGED="enablechanged",$j.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$j.COMPONENT_ADDED="componentadded",$j.COMPONENT_REMOVED="componentremoved",$j.LAYER_CHANGED="layerchanged",$j.HIERARCHY_LOADED="hierarchyloaded",$j.RECOVERED="recovered",$j.RELEASED="released",$j.LINK="link",$j.LABEL="label",$j.FULL_SCREEN_CHANGE="fullscreenchange",$j.DEVICE_LOST="devicelost",$j.MESH_CHANGED="meshchanged",$j.MATERIAL_CHANGED="materialchanged",$j.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$j.ANIMATION_CHANGED="animationchanged",$j.TRIGGER_ENTER="triggerenter",$j.TRIGGER_STAY="triggerstay",$j.TRIGGER_EXIT="triggerexit",$j.TRAIL_FILTER_CHANGE="trailfilterchange",$j.DOMINO_FILTER_CHANGE="dominofilterchange",$j}(),$e=(function(){function $j(){}$b($j,"laya.events.Keyboard"),$j.NUMBER_0=48,$j.NUMBER_1=49,$j.NUMBER_2=50,$j.NUMBER_3=51,$j.NUMBER_4=52,$j.NUMBER_5=53,$j.NUMBER_6=54,$j.NUMBER_7=55,$j.NUMBER_8=56,$j.NUMBER_9=57,$j.A=65,$j.B=66,$j.C=67,$j.D=68,$j.E=69,$j.F=70,$j.G=71,$j.H=72,$j.I=73,$j.J=74,$j.K=75,$j.L=76,$j.M=77,$j.N=78,$j.O=79,$j.P=80,$j.Q=81,$j.R=82,$j.S=83,$j.T=84,$j.U=85,$j.V=86,$j.W=87,$j.X=88,$j.Y=89,$j.Z=90,$j.F1=112,$j.F2=113,$j.F3=114,$j.F4=115,$j.F5=116,$j.F6=117,$j.F7=118,$j.F8=119,$j.F9=120,$j.F10=121,$j.F11=122,$j.F12=123,$j.F13=124,$j.F14=125,$j.F15=126,$j.NUMPAD=21,$j.NUMPAD_0=96,$j.NUMPAD_1=97,$j.NUMPAD_2=98,$j.NUMPAD_3=99,$j.NUMPAD_4=100,$j.NUMPAD_5=101,$j.NUMPAD_6=102,$j.NUMPAD_7=103,$j.NUMPAD_8=104,$j.NUMPAD_9=105,$j.NUMPAD_ADD=107,$j.NUMPAD_DECIMAL=110,$j.NUMPAD_DIVIDE=111,$j.NUMPAD_ENTER=108,$j.NUMPAD_MULTIPLY=106,$j.NUMPAD_SUBTRACT=109,$j.SEMICOLON=186,$j.EQUAL=187,$j.COMMA=188,$j.MINUS=189,$j.PERIOD=190,$j.SLASH=191,$j.BACKQUOTE=192,$j.LEFTBRACKET=219,$j.BACKSLASH=220,$j.RIGHTBRACKET=221,$j.QUOTE=222,$j.ALTERNATE=18,$j.BACKSPACE=8,$j.CAPS_LOCK=20,$j.COMMAND=15,$j.CONTROL=17,$j.DELETE=46,$j.ENTER=13,$j.ESCAPE=27,$j.PAGE_UP=33,$j.PAGE_DOWN=34,$j.END=35,$j.HOME=36,$j.LEFT=37,$j.UP=38,$j.RIGHT=39,$j.DOWN=40,$j.SHIFT=16,$j.SPACE=32,$j.TAB=9,$j.INSERT=45}(),function(){function $T(){}return $b($T,"laya.events.KeyBoardManager"),$T.__init__=function(){$T._addEvent("keydown"),$T._addEvent("keypress"),$T._addEvent("keyup")},$T._addEvent=function($O){$F.document.addEventListener($O,function($j){laya.events.KeyBoardManager._dispatch($j,$O)},!0)},$T._dispatch=function($j,$O){if($T.enabled){$T._event._stoped=!1,$T._event.nativeEvent=$j,$T._event.keyCode=$j.keyCode||$j.which||$j.charCode,"keydown"===$O?$T._pressKeys[$T._event.keyCode]=!0:"keyup"===$O&&($T._pressKeys[$T._event.keyCode]=null);for(var $V=$E.stage.focus&&null!=$E.stage.focus.event&&$E.stage.focus.displayedInStage?$E.stage.focus:$E.stage,$l=$V;$l;)$l.event($O,$T._event.setTo($O,$l,$V)),$l=$l.parent}},$T.hasKeyDown=function($j){return $T._pressKeys[$j]},$T._pressKeys={},$T.enabled=!0,$o($T,["_event",function(){return this._event=new $S}]),$T}()),$s=(function(){function $j(){}$b($j,"laya.events.KeyLocation"),$j.STANDARD=0,$j.LEFT=1,$j.RIGHT=2,$j.NUM_PAD=3}(),function(){function $g(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$F.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $S,this._matrix=new $v,this._point=new $U,this._rect=new $z,this._prePoint=new $U,this._curTouchID=NaN}$b($g,"laya.events.MouseManager");var $j=$g.prototype;return $j.__init__=function($j,$O){var $V=this;this._stage=$j;var $l=this,$T=this._eventList;$O.oncontextmenu=function($j){if($g.enabled)return!1},$O.addEventListener("mousedown",function($j){$g.enabled&&($F.onIE||$j.preventDefault(),$T.push($j),$l.mouseDownTime=$F.now())}),$O.addEventListener("mouseup",function($j){$g.enabled&&($j.preventDefault(),$T.push($j),$l.mouseDownTime=-$F.now())},!0),$O.addEventListener("mousemove",function($j){if($g.enabled){$j.preventDefault();var $O=$F.now();if($O-$l._lastMoveTimer<10)return;$l._lastMoveTimer=$O,$T.push($j)}},!0),$O.addEventListener("mouseout",function($j){$g.enabled&&$T.push($j)}),$O.addEventListener("mouseover",function($j){$g.enabled&&$T.push($j)}),$O.addEventListener("touchstart",function($j){$g.enabled&&($T.push($j),$g._isFirstTouch||$Zj.isInputting||$j.preventDefault(),$l.mouseDownTime=$F.now())}),$O.addEventListener("touchend",function($j){$g.enabled?($g._isFirstTouch||$Zj.isInputting||$j.preventDefault(),$g._isFirstTouch=!1,$T.push($j),$l.mouseDownTime=-$F.now()):$V._curTouchID=NaN},!0),$O.addEventListener("touchmove",function($j){$g.enabled&&($j.preventDefault(),$T.push($j))},!0),$O.addEventListener("touchcancel",function($j){$g.enabled?($j.preventDefault(),$T.push($j)):$V._curTouchID=NaN},!0),$O.addEventListener("mousewheel",function($j){$g.enabled&&$T.push($j)}),$O.addEventListener("DOMMouseScroll",function($j){$g.enabled&&$T.push($j)})},$j.initEvent=function($j,$O){var $V;this._event._stoped=!1,this._event.nativeEvent=$O||$j,this._target=null,this._point.setTo($j.pageX||$j.clientX,$j.pageY||$j.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$j.identifier||0,this._tTouchID=this._event.touchId,($V=$r.I._event)._stoped=!1,$V.nativeEvent=this._event.nativeEvent,$V.touchId=this._event.touchId},$j.checkMouseWheel=function($j){this._event.delta=$j.wheelDelta?.025*$j.wheelDelta:-$j.detail;for(var $O=$r.I.getLastOvers(),$V=0,$l=$O.length;$V<$l;$V++){var $T=$O[$V];$T.event("mousewheel",this._event.setTo("mousewheel",$T,this._target))}},$j.onMouseMove=function($j){$r.I.onMouseMove($j,this._tTouchID)},$j.onMouseDown=function($j){if($Zj.isInputting&&$E.stage.focus&&$E.stage.focus.focus&&!$E.stage.focus.contains(this._target)){var $O=$E.stage.focus._tf||$E.stage.focus,$V=$j._tf||$j;$V instanceof laya.display.Input&&$V.multiline==$O.multiline?$O._focusOut():$O.focus=!1}$r.I.onMouseDown($j,this._tTouchID,this._isLeftMouse)},$j.onMouseUp=function($j){$r.I.onMouseUp($j,this._tTouchID,this._isLeftMouse)},$j.check=function($j,$O,$V,$l){this._point.setTo($O,$V),$j.fromParentPoint(this._point),$O=this._point.x,$V=this._point.y;var $T=$j.scrollRect;if($T&&(this._rect.setTo($T.x,$T.y,$T.width,$T.height),!this._rect.contains($O,$V)))return!1;if(!this.disableMouseEvent){if($j.hitTestPrior&&!$j.mouseThrough&&!this.hitTest($j,$O,$V))return!1;for(var $S=$j._childs.length-1;-1<$S;$S--){var $m=$j._childs[$S];if(!$m.destroyed&&$m.mouseEnabled&&$m.visible&&this.check($m,$O,$V,$l))return!0}}var $p=!(!$j.hitTestPrior||$j.mouseThrough||this.disableMouseEvent)||this.hitTest($j,$O,$V);return $p?(this._target=$j,$l.call(this,$j)):$l===this.onMouseUp&&$j===this._stage&&(this._target=this._stage,$l.call(this,this._target)),$p},$j.hitTest=function($j,$O,$V){var $l=!1;if($j.scrollRect&&($O-=$j.scrollRect.x,$V-=$j.scrollRect.y),$j.hitArea instanceof laya.utils.HitArea)return $j.hitArea.isHit($O,$V);if(0<$j.width&&0<$j.height||$j.mouseThrough||$j.hitArea)if($j.mouseThrough)$l=$j.getGraphicBounds().contains($O,$V);else{var $T=this._rect;$j.hitArea?$T=$j.hitArea:$T.setTo(0,0,$j.width,$j.height),$l=$T.contains($O,$V)}return $l},$j.runEvent=function(){var $j=this._eventList.length;if($j){var $O=this;$O.mouseEventTime=$F.now();var $V,$l=0,$T=0,$S=0;try{for(;$l<$j;){var $m=this._eventList[$l];switch("mousemove"!==$m.type&&(this._prePoint.x=this._prePoint.y=-1e6),$m.type){case"mousedown":this._touchIDs[0]=this._id++,$g._isTouchRespond?$g._isTouchRespond=!1:($O._isLeftMouse=0===$m.button,$O.initEvent($m),$O.check($O._stage,$O.mouseX,$O.mouseY,$O.onMouseDown));break;case"mouseup":$O._isLeftMouse=0===$m.button,$O.initEvent($m),$O.check($O._stage,$O.mouseX,$O.mouseY,$O.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$m.clientX)+Math.abs(this._prePoint.y-$m.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$m.clientX,this._prePoint.y=$m.clientY,$O.initEvent($m),$O.check($O._stage,$O.mouseX,$O.mouseY,$O.onMouseMove));break;case"touchstart":$g._isTouchRespond=!0,$O._isLeftMouse=!0;var $p=$m.changedTouches;for($T=0,$S=$p.length;$T<$S;$T++)$V=$p[$T],($g.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$V.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$V.identifier]=this._id++,$O.initEvent($V,$m),$O.check($O._stage,$O.mouseX,$O.mouseY,$O.onMouseDown));break;case"touchend":case"touchcancel":$g._isTouchRespond=!0,$O._isLeftMouse=!0;var $o=$m.changedTouches;for($T=0,$S=$o.length;$T<$S;$T++)if($V=$o[$T],$g.multiTouchEnabled||$V.identifier==this._curTouchID){this._curTouchID=NaN,$O.initEvent($V,$m);$O.check($O._stage,$O.mouseX,$O.mouseY,$O.onMouseUp)||$O.onMouseUp(null)}break;case"touchmove":var $H=$m.changedTouches;for($T=0,$S=$H.length;$T<$S;$T++)$V=$H[$T],($g.multiTouchEnabled||$V.identifier==this._curTouchID)&&($O.initEvent($V,$m),$O.check($O._stage,$O.mouseX,$O.mouseY,$O.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$O.checkMouseWheel($m);break;case"mouseout":$r.I.stageMouseOut();break;case"mouseover":$O._stage.event("mouseover",$O._event.setTo("mouseover",$O._stage,$O._stage))}$l++}}catch($j){throw this._eventList.length=0,$j}this._eventList.length=0}},$g.enabled=!0,$g.multiTouchEnabled=!0,$g._isTouchRespond=!1,$g._isFirstTouch=!0,$o($g,["instance",function(){return this.instance=new $g}]),$g}()),$r=function(){function $s(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $S}$b($s,"laya.events.TouchManager");var $j=$s.prototype;return $j._clearTempArrs=function(){$s._oldArr.length=0,$s._newArr.length=0,$s._tEleArr.length=0},$j.getTouchFromArr=function($j,$O){var $V,$l,$T=0;for($V=$O.length,$T=0;$T<$V;$T++)if(($l=$O[$T]).id==$j)return $l;return null},$j.removeTouchFromArr=function($j,$O){var $V=0;for($V=$O.length-1;0<=$V;$V--)$O[$V].id==$j&&$O.splice($V,1)},$j.createTouchO=function($j,$O){var $V;return($V=$W.getItem("TouchData")||{}).id=$O,$V.tar=$j,$V},$j.onMouseDown=function($j,$O,$V){var $l,$T,$S,$m;(void 0===$V&&($V=!1),this.enable)&&($l=this.getTouchFromArr($O,this.preOvers),$S=this.getEles($j,null,$s._tEleArr),$l?$l.tar=$j:($T=this.createTouchO($j,$O),this.preOvers.push($T)),$F.onMobile&&this.sendEvents($S,"mouseover",$O),$m=$V?this.preDowns:this.preRightDowns,($l=this.getTouchFromArr($O,$m))?$l.tar=$j:($T=this.createTouchO($j,$O),$m.push($T)),this.sendEvents($S,$V?"mousedown":"rightmousedown",$O),this._clearTempArrs())},$j.sendEvents=function($j,$O,$V){void 0===$V&&($V=0);var $l,$T,$S,$m=0;for($l=$j.length,this._event._stoped=!1,$T=$j[0],$m=0;$m<$l;$m++){if(($S=$j[$m]).destroyed)return;if($S.event($O,this._event.setTo($O,$S,$T)),this._event._stoped)break}},$j.getEles=function($j,$O,$V){for($V?$V.length=0:$V=[];$j&&$j!=$O;)$V.push($j),$j=$j.parent;return $V},$j.checkMouseOutAndOverOfMove=function($j,$O,$V){if(void 0===$V&&($V=0),$O!=$j){var $l,$T,$S=0,$m=0;if($O.contains($j))$T=this.getEles($j,$O,$s._tEleArr),this.sendEvents($T,"mouseover",$V);else if($j.contains($O))$T=this.getEles($O,$j,$s._tEleArr),this.sendEvents($T,"mouseout",$V);else{var $p,$o;($T=$s._tEleArr).length=0,$p=this.getEles($O,null,$s._oldArr),$o=this.getEles($j,null,$s._newArr),$m=$p.length;var $H=0;for($S=0;$S<$m;$S++){if($l=$p[$S],0<=($H=$o.indexOf($l))){$o.splice($H,$o.length-$H);break}$T.push($l)}0<$T.length&&this.sendEvents($T,"mouseout",$V),0<$o.length&&this.sendEvents($o,"mouseover",$V)}}},$j.onMouseMove=function($j,$O){var $V,$l;this.enable&&(($V=this.getTouchFromArr($O,this.preOvers))?(this.checkMouseOutAndOverOfMove($j,$V.tar),$V.tar=$j,$l=this.getEles($j,null,$s._tEleArr)):($l=this.getEles($j,null,$s._tEleArr),this.sendEvents($l,"mouseover",$O),this.preOvers.push(this.createTouchO($j,$O))),this.sendEvents($l,"mousemove",$O),this._clearTempArrs())},$j.getLastOvers=function(){return($s._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$s._tEleArr):($s._tEleArr.push($E.stage),$s._tEleArr)},$j.stageMouseOut=function(){var $j;$j=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($j,"mouseout",0)},$j.onMouseUp=function($j,$O,$V){if(void 0===$V&&($V=!1),this.enable){var $l,$T,$S,$m,$p,$o,$H=0,$g=0,$e=$F.onMobile;if($T=this.getEles($j,null,$s._tEleArr),this.sendEvents($T,$V?"mouseup":"rightmouseup",$O),$o=$V?this.preDowns:this.preRightDowns,$l=this.getTouchFromArr($O,$o)){var $t,$w=$F.now();if($t=$w-this._lastClickTime<300,this._lastClickTime=$w,$j==$l.tar)$p=$T;else for($S=this.getEles($l.tar,null,$s._oldArr),($p=$s._newArr).length=0,$g=$S.length,$H=0;$H<$g;$H++)$m=$S[$H],0<=$T.indexOf($m)&&$p.push($m);0<$p.length&&this.sendEvents($p,$V?"click":"rightclick",$O),$V&&$t&&this.sendEvents($p,"doubleclick",$O),this.removeTouchFromArr($O,$o),$l.tar=null,$W.recover("TouchData",$l)}else;($l=this.getTouchFromArr($O,this.preOvers))&&$e&&(($p=this.getEles($l.tar,null,$p))&&0<$p.length&&this.sendEvents($p,"mouseout",$O),this.removeTouchFromArr($O,this.preOvers),$l.tar=null,$W.recover("TouchData",$l)),this._clearTempArrs()}},$s._oldArr=[],$s._newArr=[],$s._tEleArr=[],$o($s,["I",function(){return this.I=new $s}]),$s}(),$h=function(){function $j(){this._action=null}$b($j,"laya.filters.Filter");var $O=$j.prototype;return $E.imps($O,{"laya.filters.IFilter":!0}),$O.callNative=function($j){},$g(0,$O,"type",function(){return-1}),$g(0,$O,"action",function(){return this._action}),$j.BLUR=16,$j.COLOR=32,$j.GLOW=8,$j._filterStart=null,$j._filterEnd=null,$j._EndTarget=null,$j._recycleScope=null,$j._filter=null,$j._useSrc=null,$j._endSrc=null,$j._useOut=null,$j._endOut=null,$j}(),$c=function(){function $j(){this.data=null}$b($j,"laya.filters.ColorFilterAction");var $O=$j.prototype;return $E.imps($O,{"laya.filters.IFilterAction":!0}),$O.apply=function($j){var $O=$j.ctx.ctx,$V=$j.ctx.ctx.canvas;if(0==$V.width||0==$V.height)return $V;for(var $l,$T=$O.getImageData(0,0,$V.width,$V.height),$S=$T.data,$m=0,$p=$S.length;$m<$p;$m+=4)$l=this.getColor($S[$m],$S[$m+1],$S[$m+2],$S[$m+3]),0!=$S[$m+3]&&($S[$m]=$l[0],$S[$m+1]=$l[1],$S[$m+2]=$l[2],$S[$m+3]=$l[3]);return $O.putImageData($T,0,0),$j},$O.getColor=function($j,$O,$V,$l){var $T=[];if(this.data._mat&&this.data._alpha){var $S=this.data._mat,$m=this.data._alpha;$T[0]=$S[0]*$j+$S[1]*$O+$S[2]*$V+$S[3]*$l+$m[0],$T[1]=$S[4]*$j+$S[5]*$O+$S[6]*$V+$S[7]*$l+$m[1],$T[2]=$S[8]*$j+$S[9]*$O+$S[10]*$V+$S[11]*$l+$m[2],$T[3]=$S[12]*$j+$S[13]*$O+$S[14]*$V+$S[15]*$l+$m[3]}return $T},$j}(),$A=(function(){function $j(){}$b($j,"laya.maths.Arith"),$j.formatR=function($j){return $j>Math.PI&&($j-=2*Math.PI),$j<-Math.PI&&($j+=2*Math.PI),$j},$j.isPOT=function($j,$O){return 0<$j&&0==($j&$j-1)&&0<$O&&0==($O&$O-1)},$j.setMatToArray=function($j,$O){$j.a,$j.b,$j.c,$j.d,$j.tx,$j.ty,$O[0]=$j.a,$O[1]=$j.b,$O[4]=$j.c,$O[5]=$j.d,$O[12]=$j.tx,$O[13]=$j.ty}}(),function(){function $j(){this._controlPoints=[new $U,new $U,new $U],this._calFun=this.getPoint2}$b($j,"laya.maths.Bezier");var $O=$j.prototype;return $O._switchPoint=function($j,$O){var $V=this._controlPoints.shift();$V.setTo($j,$O),this._controlPoints.push($V)},$O.getPoint2=function($j,$O){var $V=this._controlPoints[0],$l=this._controlPoints[1],$T=this._controlPoints[2],$S=Math.pow(1-$j,2)*$V.x+2*$j*(1-$j)*$l.x+Math.pow($j,2)*$T.x,$m=Math.pow(1-$j,2)*$V.y+2*$j*(1-$j)*$l.y+Math.pow($j,2)*$T.y;$O.push($S,$m)},$O.getPoint3=function($j,$O){var $V=this._controlPoints[0],$l=this._controlPoints[1],$T=this._controlPoints[2],$S=this._controlPoints[3],$m=Math.pow(1-$j,3)*$V.x+3*$l.x*$j*(1-$j)*(1-$j)+3*$T.x*$j*$j*(1-$j)+$S.x*Math.pow($j,3),$p=Math.pow(1-$j,3)*$V.y+3*$l.y*$j*(1-$j)*(1-$j)+3*$T.y*$j*$j*(1-$j)+$S.y*Math.pow($j,3);$O.push($m,$p)},$O.insertPoints=function($j,$O){var $V,$l=NaN;for($V=1/($j=0<$j?$j:5),$l=0;$l<=1;$l+=$V)this._calFun($l,$O)},$O.getBezierPoints=function($j,$O,$V){void 0===$O&&($O=5),void 0===$V&&($V=2);var $l,$T,$S=0;if(($l=$j.length)<2*($V+1))return[];switch($T=[],$V){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$V;)this._controlPoints.push(new $U);for($S=0;$S<2*$V;$S+=2)this._switchPoint($j[$S],$j[$S+1]);for($S=2*$V;$S<$l;$S+=2)this._switchPoint($j[$S],$j[$S+1]),$S/2%$V==0&&this.insertPoints($O,$T);return $T},$o($j,["I",function(){return this.I=new $j}]),$j}()),$Z=function(){function $H(){}return $b($H,"laya.maths.GrahamScan"),$H.multiply=function($j,$O,$V){return($j.x-$V.x)*($O.y-$V.y)-($O.x-$V.x)*($j.y-$V.y)},$H.dis=function($j,$O){return($j.x-$O.x)*($j.x-$O.x)+($j.y-$O.y)*($j.y-$O.y)},$H._getPoints=function($j,$O,$V){for(void 0===$O&&($O=!1),$H._mPointList||($H._mPointList=[]);$H._mPointList.length<$j;)$H._mPointList.push(new $U);return $V||($V=[]),$V.length=0,$O?$H.getFrom($V,$H._mPointList,$j):$H.getFromR($V,$H._mPointList,$j),$V},$H.getFrom=function($j,$O,$V){var $l=0;for($l=0;$l<$V;$l++)$j.push($O[$l]);return $j},$H.getFromR=function($j,$O,$V){var $l=0;for($l=0;$l<$V;$l++)$j.push($O.pop());return $j},$H.pListToPointList=function($j,$O){void 0===$O&&($O=!1);var $V=0,$l=$j.length/2,$T=$H._getPoints($l,$O,$H._tempPointList);for($V=0;$V<$l;$V++)$T[$V].setTo($j[$V+$V],$j[$V+$V+1]);return $T},$H.pointListToPlist=function($j){var $O,$V=0,$l=$j.length,$T=$H._temPList;for($V=$T.length=0;$V<$l;$V++)$O=$j[$V],$T.push($O.x,$O.y);return $T},$H.scanPList=function($j){return $Q.copyArray($j,$H.pointListToPlist($H.scan($H.pListToPointList($j,!0))))},$H.scan=function($j){var $O,$V,$l,$T=0,$S=0,$m=0,$p=$j.length,$o={};for(($V=$H._temArr).length=0,$T=($p=$j.length)-1;0<=$T;$T--)$l=($O=$j[$T]).x+"_"+$O.y,$o.hasOwnProperty($l)||($o[$l]=!0,$V.push($O));for($p=$V.length,$Q.copyArray($j,$V),$T=1;$T<$p;$T++)($j[$T].y<$j[$m].y||$j[$T].y==$j[$m].y&&$j[$T].x<$j[$m].x)&&($m=$T);for($O=$j[0],$j[0]=$j[$m],$j[$m]=$O,$T=1;$T<$p-1;$T++){for($S=($m=$T)+1;$S<$p;$S++)(0<$H.multiply($j[$S],$j[$m],$j[0])||0==$H.multiply($j[$S],$j[$m],$j[0])&&$H.dis($j[0],$j[$S])<$H.dis($j[0],$j[$m]))&&($m=$S);$O=$j[$T],$j[$T]=$j[$m],$j[$m]=$O}if(($V=$H._temArr).length=0,$j.length<3)return $Q.copyArray($V,$j);for($V.push($j[0],$j[1],$j[2]),$T=3;$T<$p;$T++){for(;2<=$V.length&&0<=$H.multiply($j[$T],$V[$V.length-1],$V[$V.length-2]);)$V.pop();$j[$T]&&$V.push($j[$T])}return $V},$H._mPointList=null,$H._tempPointList=[],$H._temPList=[],$H._temArr=[],$H}(),$x=function(){function $T(){}return $b($T,"laya.maths.MathUtil"),$T.subtractVector3=function($j,$O,$V){$V[0]=$j[0]-$O[0],$V[1]=$j[1]-$O[1],$V[2]=$j[2]-$O[2]},$T.lerp=function($j,$O,$V){return $j*(1-$V)+$O*$V},$T.scaleVector3=function($j,$O,$V){$V[0]=$j[0]*$O,$V[1]=$j[1]*$O,$V[2]=$j[2]*$O},$T.lerpVector3=function($j,$O,$V,$l){var $T=$j[0],$S=$j[1],$m=$j[2];$l[0]=$T+$V*($O[0]-$T),$l[1]=$S+$V*($O[1]-$S),$l[2]=$m+$V*($O[2]-$m)},$T.lerpVector4=function($j,$O,$V,$l){var $T=$j[0],$S=$j[1],$m=$j[2],$p=$j[3];$l[0]=$T+$V*($O[0]-$T),$l[1]=$S+$V*($O[1]-$S),$l[2]=$m+$V*($O[2]-$m),$l[3]=$p+$V*($O[3]-$p)},$T.slerpQuaternionArray=function($j,$O,$V,$l,$T,$S,$m){var $p,$o,$H,$g,$e,$t=$j[$O+0],$w=$j[$O+1],$s=$j[$O+2],$b=$j[$O+3],$r=$V[$l+0],$h=$V[$l+1],$a=$V[$l+2],$c=$V[$l+3];return($o=$t*$r+$w*$h+$s*$a+$b*$c)<0&&($o=-$o,$r=-$r,$h=-$h,$a=-$a,$c=-$c),$e=1e-6<1-$o?($p=Math.acos($o),$H=Math.sin($p),$g=Math.sin((1-$T)*$p)/$H,Math.sin($T*$p)/$H):($g=1-$T,$T),$S[$m+0]=$g*$t+$e*$r,$S[$m+1]=$g*$w+$e*$h,$S[$m+2]=$g*$s+$e*$a,$S[$m+3]=$g*$b+$e*$c,$S},$T.getRotation=function($j,$O,$V,$l){return Math.atan2($l-$O,$V-$j)/Math.PI*180},$T.sortBigFirst=function($j,$O){return $j==$O?0:$j<$O?1:-1},$T.sortSmallFirst=function($j,$O){return $j==$O?0:$j<$O?-1:1},$T.sortNumBigFirst=function($j,$O){return parseFloat($O)-parseFloat($j)},$T.sortNumSmallFirst=function($j,$O){return parseFloat($j)-parseFloat($O)},$T.sortByKey=function($V,$j,$O){var $l;return void 0===$j&&($j=!1),void 0===$O&&($O=!0),$l=$j?$O?$T.sortNumBigFirst:$T.sortBigFirst:$O?$T.sortNumSmallFirst:$T.sortSmallFirst,function($j,$O){return $l($j[$V],$O[$V])}},$T}(),$v=function(){function $V($j,$O,$V,$l,$T,$S){this.inPool=!1,this.bTransform=!1,void 0===$j&&($j=1),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=1),void 0===$T&&($T=0),void 0===$S&&($S=0),this.a=$j,this.b=$O,this.c=$V,this.d=$l,this.tx=$T,this.ty=$S,this._checkTransform()}$b($V,"laya.maths.Matrix");var $j=$V.prototype;return $j.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$j._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$j.setTranslate=function($j,$O){return this.tx=$j,this.ty=$O,this},$j.translate=function($j,$O){return this.tx+=$j,this.ty+=$O,this},$j.scale=function($j,$O){this.a*=$j,this.d*=$O,this.c*=$j,this.b*=$O,this.tx*=$j,this.ty*=$O,this.bTransform=!0},$j.rotate=function($j){var $O=Math.cos($j),$V=Math.sin($j),$l=this.a,$T=this.c,$S=this.tx;this.a=$l*$O-this.b*$V,this.b=$l*$V+this.b*$O,this.c=$T*$O-this.d*$V,this.d=$T*$V+this.d*$O,this.tx=$S*$O-this.ty*$V,this.ty=$S*$V+this.ty*$O,this.bTransform=!0},$j.skew=function($j,$O){var $V=Math.tan($j),$l=Math.tan($O),$T=this.a,$S=this.b;return this.a+=$l*this.c,this.b+=$l*this.d,this.c+=$V*$T,this.d+=$V*$S,this},$j.invertTransformPoint=function($j){var $O=this.a,$V=this.b,$l=this.c,$T=this.d,$S=this.tx,$m=$O*$T-$V*$l,$p=$T/$m,$o=-$V/$m,$H=-$l/$m,$g=$O/$m,$e=($l*this.ty-$T*$S)/$m,$t=-($O*this.ty-$V*$S)/$m;return $j.setTo($p*$j.x+$H*$j.y+$e,$o*$j.x+$g*$j.y+$t)},$j.transformPoint=function($j){return $j.setTo(this.a*$j.x+this.c*$j.y+this.tx,this.b*$j.x+this.d*$j.y+this.ty)},$j.transformPointN=function($j){return $j.setTo(this.a*$j.x+this.c*$j.y,this.b*$j.x+this.d*$j.y)},$j.transformPointArray=function($j,$O){for(var $V=$j.length,$l=0;$l<$V;$l+=2){var $T=$j[$l],$S=$j[$l+1];$O[$l]=this.a*$T+this.c*$S+this.tx,$O[$l+1]=this.b*$T+this.d*$S+this.ty}return $O},$j.transformPointArrayScale=function($j,$O){for(var $V=$j.length,$l=0;$l<$V;$l+=2){var $T=$j[$l],$S=$j[$l+1];$O[$l]=this.a*$T+this.c*$S,$O[$l+1]=this.b*$T+this.d*$S}return $O},$j.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$j.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$j.invert=function(){var $j=this.a,$O=this.b,$V=this.c,$l=this.d,$T=this.tx,$S=$j*$l-$O*$V;return this.a=$l/$S,this.b=-$O/$S,this.c=-$V/$S,this.d=$j/$S,this.tx=($V*this.ty-$l*$T)/$S,this.ty=-($j*this.ty-$O*$T)/$S,this},$j.setTo=function($j,$O,$V,$l,$T,$S){return this.a=$j,this.b=$O,this.c=$V,this.d=$l,this.tx=$T,this.ty=$S,this},$j.concat=function($j){var $O=this.a,$V=this.c,$l=this.tx;return this.a=$O*$j.a+this.b*$j.c,this.b=$O*$j.b+this.b*$j.d,this.c=$V*$j.a+this.d*$j.c,this.d=$V*$j.b+this.d*$j.d,this.tx=$l*$j.a+this.ty*$j.c+$j.tx,this.ty=$l*$j.b+this.ty*$j.d+$j.ty,this},$j.scaleEx=function($j,$O){var $V=this.a,$l=this.b,$T=this.c,$S=this.d;0!==$l||0!==$T?(this.a=$j*$V,this.b=$j*$l,this.c=$O*$T):(this.a=$j*$V,this.b=0*$S,this.c=0*$V),this.d=$O*$S,this.bTransform=!0},$j.rotateEx=function($j){var $O=Math.cos($j),$V=Math.sin($j),$l=this.a,$T=this.b,$S=this.c,$m=this.d;0!==$T||0!==$S?(this.a=$O*$l+$V*$S,this.b=$O*$T+$V*$m,this.c=-$V*$l+$O*$S,this.d=-$V*$T+$O*$m):(this.a=$O*$l,this.b=$V*$m,this.c=-$V*$l,this.d=$O*$m),this.bTransform=!0},$j.clone=function(){var $j=$V.create();return $j.a=this.a,$j.b=this.b,$j.c=this.c,$j.d=this.d,$j.tx=this.tx,$j.ty=this.ty,$j.bTransform=this.bTransform,$j},$j.copyTo=function($j){return $j.a=this.a,$j.b=this.b,$j.c=this.c,$j.d=this.d,$j.tx=this.tx,$j.ty=this.ty,$j.bTransform=this.bTransform,$j},$j.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$j.destroy=function(){if(!this.inPool){var $j=$V._cache;this.inPool=!0,$j._length||($j._length=0),($j[$j._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$V.mul=function($j,$O,$V){var $l=$j.a,$T=$j.b,$S=$j.c,$m=$j.d,$p=$j.tx,$o=$j.ty,$H=$O.a,$g=$O.b,$e=$O.c,$t=$O.d,$w=$O.tx,$s=$O.ty;return 0!==$g||0!==$e?($V.a=$l*$H+$T*$e,$V.b=$l*$g+$T*$t,$V.c=$S*$H+$m*$e,$V.d=$S*$g+$m*$t,$V.tx=$H*$p+$e*$o+$w,$V.ty=$g*$p+$t*$o+$s):($V.a=$l*$H,$V.b=$T*$t,$V.c=$S*$H,$V.d=$m*$t,$V.tx=$H*$p+$w,$V.ty=$t*$o+$s),$V},$V.mul16=function($j,$O,$V){var $l=$j.a,$T=$j.b,$S=$j.c,$m=$j.d,$p=$j.tx,$o=$j.ty,$H=$O.a,$g=$O.b,$e=$O.c,$t=$O.d,$w=$O.tx,$s=$O.ty;return 0!==$g||0!==$e?($V[0]=$l*$H+$T*$e,$V[1]=$l*$g+$T*$t,$V[4]=$S*$H+$m*$e,$V[5]=$S*$g+$m*$t,$V[12]=$H*$p+$e*$o+$w,$V[13]=$g*$p+$t*$o+$s):($V[0]=$l*$H,$V[1]=$T*$t,$V[4]=$S*$H,$V[5]=$m*$t,$V[12]=$H*$p+$w,$V[13]=$t*$o+$s),$V},$V.mulPre=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=$j.a,$H=$j.b,$g=$j.c,$e=$j.d,$t=$j.tx,$w=$j.ty;return 0!==$V||0!==$l?($p.a=$o*$O+$H*$l,$p.b=$o*$V+$H*$T,$p.c=$g*$O+$e*$l,$p.d=$g*$V+$e*$T,$p.tx=$O*$t+$l*$w+$S,$p.ty=$V*$t+$T*$w+$m):($p.a=$o*$O,$p.b=$H*$T,$p.c=$g*$O,$p.d=$e*$T,$p.tx=$O*$t+$S,$p.ty=$T*$w+$m),$p},$V.mulPos=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=$j.a,$H=$j.b,$g=$j.c,$e=$j.d,$t=$j.tx,$w=$j.ty;return 0!==$H||0!==$g?($p.a=$O*$o+$V*$g,$p.b=$O*$H+$V*$e,$p.c=$l*$o+$T*$g,$p.d=$l*$H+$T*$e,$p.tx=$o*$S+$g*$m+$t,$p.ty=$H*$S+$e*$m+$w):($p.a=$O*$o,$p.b=$V*$e,$p.c=$l*$o,$p.d=$T*$e,$p.tx=$o*$S+$t,$p.ty=$e*$m+$w),$p},$V.preMul=function($j,$O,$V){var $l=$j.a,$T=$j.b,$S=$j.c,$m=$j.d,$p=$O.a,$o=$O.b,$H=$O.c,$g=$O.d,$e=$O.tx,$t=$O.ty;return $V.a=$p*$l,$V.b=$V.c=0,$V.d=$g*$m,$V.tx=$e*$l+$j.tx,$V.ty=$t*$m+$j.ty,0===$o&&0===$H&&0===$T&&0===$S||($V.a+=$o*$S,$V.d+=$H*$T,$V.b+=$p*$T+$o*$m,$V.c+=$H*$l+$g*$S,$V.tx+=$t*$S,$V.ty+=$e*$T),$V},$V.preMulXY=function($j,$O,$V,$l){var $T=$j.a,$S=$j.b,$m=$j.c,$p=$j.d;return $l.a=$T,$l.b=$S,$l.c=$m,$l.d=$p,$l.tx=$O*$T+$j.tx+$V*$m,$l.ty=$V*$p+$j.ty+$O*$S,$l},$V.create=function(){var $j=$V._cache,$O=$j._length?$j[--$j._length]:new $V;return $O.inPool=!1,$O},$V.EMPTY=new $V,$V.TEMP=new $V,$V._cache=[],$V}(),$U=function(){function $j($j,$O){void 0===$j&&($j=0),void 0===$O&&($O=0),this.x=$j,this.y=$O}$b($j,"laya.maths.Point");var $O=$j.prototype;return $O.setTo=function($j,$O){return this.x=$j,this.y=$O,this},$O.distance=function($j,$O){return Math.sqrt((this.x-$j)*(this.x-$j)+(this.y-$O)*(this.y-$O))},$O.toString=function(){return this.x+","+this.y},$O.normalize=function(){var $j=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$j){var $O=1/$j;this.x*=$O,this.y*=$O}},$j.TEMP=new $j,$j.EMPTY=new $j,$j}(),$z=function(){function $H($j,$O,$V,$l){void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0),this.x=$j,this.y=$O,this.width=$V,this.height=$l}$b($H,"laya.maths.Rectangle");var $j=$H.prototype;return $j.setTo=function($j,$O,$V,$l){return this.x=$j,this.y=$O,this.width=$V,this.height=$l,this},$j.copyFrom=function($j){return this.x=$j.x,this.y=$j.y,this.width=$j.width,this.height=$j.height,this},$j.contains=function($j,$O){return!(this.width<=0||this.height<=0)&&($j>=this.x&&$j<this.right&&$O>=this.y&&$O<this.bottom)},$j.intersects=function($j){return!($j.x>this.x+this.width||$j.x+$j.width<this.x||$j.y>this.y+this.height||$j.y+$j.height<this.y)},$j.intersection=function($j,$O){return this.intersects($j)?($O||($O=new $H),$O.x=Math.max(this.x,$j.x),$O.y=Math.max(this.y,$j.y),$O.width=Math.min(this.right,$j.right)-$O.x,$O.height=Math.min(this.bottom,$j.bottom)-$O.y,$O):null},$j.union=function($j,$O){return $O||($O=new $H),this.clone($O),$j.width<=0||$j.height<=0?$O:($O.addPoint($j.x,$j.y),$O.addPoint($j.right,$j.bottom),this)},$j.clone=function($j){return $j||($j=new $H),$j.x=this.x,$j.y=this.y,$j.width=this.width,$j.height=this.height,$j},$j.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$j.equals=function($j){return!(!$j||$j.x!==this.x||$j.y!==this.y||$j.width!==this.width||$j.height!==this.height)},$j.addPoint=function($j,$O){return this.x>$j&&(this.width+=this.x-$j,this.x=$j),this.y>$O&&(this.height+=this.y-$O,this.y=$O),this.width<$j-this.x&&(this.width=$j-this.x),this.height<$O-this.y&&(this.height=$O-this.y),this},$j._getBoundPoints=function(){var $j=$H._temB;return($j.length=0)==this.width||0==this.height||$j.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$j},$j.isEmpty=function(){return this.width<=0||this.height<=0},$g(0,$j,"right",function(){return this.x+this.width}),$g(0,$j,"bottom",function(){return this.y+this.height}),$H._getBoundPointS=function($j,$O,$V,$l){var $T=$H._temA;return($T.length=0)==$V||0==$l||$T.push($j,$O,$j+$V,$O,$j,$O+$l,$j+$V,$O+$l),$T},$H._getWrapRec=function($j,$O){if(!$j||$j.length<1)return $O?$O.setTo(0,0,0,0):$H.TEMP.setTo(0,0,0,0);$O=$O||new $H;var $V,$l,$T,$S,$m,$p=$j.length,$o=$U.TEMP;for($T=$m=-($l=$S=99999),$V=0;$V<$p;$V+=2)$o.x=$j[$V],$o.y=$j[$V+1],$l=$l<$o.x?$l:$o.x,$S=$S<$o.y?$S:$o.y,$T=$T>$o.x?$T:$o.x,$m=$m>$o.y?$m:$o.y;return $O.setTo($l,$S,$T-$l,$m-$S)},$H.EMPTY=new $H,$H.TEMP=new $H,$H._temB=[],$H._temA=[],$H}(),$B=function(){function $o(){}return $b($o,"laya.media.SoundManager"),$g(1,$o,"useAudioMusic",function(){return $o._useAudioMusic},function($j){$o._useAudioMusic=$j,$o._musicClass=$j?$Vj:null}),$g(1,$o,"autoStopMusic",function(){return $o._autoStopMusic},function($j){$E.stage.off("blur",null,$o._stageOnBlur),$E.stage.off("focus",null,$o._stageOnFocus),$E.stage.off("visibilitychange",null,$o._visibilityChange),($o._autoStopMusic=$j)&&($E.stage.on("blur",null,$o._stageOnBlur),$E.stage.on("focus",null,$o._stageOnFocus),$E.stage.on("visibilitychange",null,$o._visibilityChange))}),$g(1,$o,"muted",function(){return $o._muted},function($j){$j!=$o._muted&&($j&&$o.stopAllSound(),$o.musicMuted=$j,$o._muted=$j)}),$g(1,$o,"musicMuted",function(){return $o._musicMuted},function($j){$j!=$o._musicMuted&&($j?($o._tMusic&&$o._musicChannel&&!$o._musicChannel.isStopped?$o._musicChannel.pause():$o._musicChannel=null,$o._musicMuted=$j):($o._musicMuted=$j,$o._tMusic&&$o._musicChannel&&$o._musicChannel.resume()))}),$g(1,$o,"soundMuted",function(){return $o._soundMuted},function($j){$o._soundMuted=$j}),$o.addChannel=function($j){0<=$o._channels.indexOf($j)||($o._channels.push($j),$o.autoReleaseSound&&0!=$o._notUsedCount&&$o._notUsedUrls[$j.url]&&(delete $o._notUsedUrls[$j.url],0==--$o._notUsedCount&&$E.timer.clear($o,$o.disposeSoundIfNotUsed)))},$o.removeChannel=function($j){var $O=$o._channels,$V=$O.indexOf($j);if(-1!=$V&&($O.splice($V,1),$o.autoReleaseSound)){var $l=$j.url,$T=$o.defaultIntervals[$l]||2e4;if(0<$T){var $S=!0;for($V=$O.length-1;0<=$V;$V--)if($O[$V].url==$l){$S=!1;break}$S&&($o._notUsedUrls[$l]=Date.now()+$T,0==$o._notUsedCount++&&$E.timer.loop(1e4,$o,$o.disposeSoundIfNotUsed))}}},$o.disposeSoundIfNotUsed=function(){var $j=$o._notUsedUrls;if(0!=$o._notUsedCount){var $O=Date.now();for(var $V in $j)$O>=$j[$V]&&(delete $j[$V],--$o._notUsedCount,$o.destroySound($V));if(0!=$o._notUsedCount)return}$E.timer.clear($o,$o.disposeSoundIfNotUsed)},$o._visibilityChange=function(){$E.stage.isVisibility?$o._stageOnFocus():$o._stageOnBlur()},$o._stageOnBlur=function(){$o._isActive=!1,$o._musicChannel&&($o._musicChannel.isStopped||($o._blurPaused=!0,$o._musicChannel.pause())),$o.stopAllSound(),$E.stage.once("mousedown",null,$o._stageOnFocus)},$o._recoverWebAudio=function(){$Sj.ctx&&"running"!=$Sj.ctx.state&&$Sj.ctx.resume&&$Sj.ctx.resume()},$o._stageOnFocus=function(){if($o._isActive=!0,$o._recoverWebAudio(),$E.stage.off("mousedown",null,$o._stageOnFocus),$o._blurPaused){var $j=$o._musicChannel;$j&&$o._music&&$j.isStopped&&($o._blurPaused=!1,$o._music._disposed?$o.playMusic($j.url,$j.loops,$j.startHandler,$j.completeHandler,$j.startTime):$j.audioBuffer?$j.resume():$o._music.play($j.startTime,$j.loops,$j.startHandler,$j))}},$o.playSound=function($j,$O,$V,$l,$T,$S){if(void 0===$O&&($O=1),void 0===$S&&($S=0),!$j)return null;if($o._muted)return null;if($o._recoverWebAudio(),$j==$o._tMusic){if($o._musicMuted)return null}else{if(!$o._isActive)return null;if($o._soundMuted)return null}var $m,$p=$o._pool[$j];return $T||($T=$o._soundClass),$p||(($p=new $T).load($j),$o._pool[$j]=$p),($m=$p.play($S,$O,$V))?($j==$o._tMusic&&($o._music=$p,$o._isActive||($o._blurPaused=!0,$m.pause())),$m.url=$j,$m.volume=$j==$o._tMusic?$o.musicVolume:$o.soundVolume,$m.completeHandler=$l,$m):null},$o.destroySound=function($j){var $O=$o._pool[$j];$O&&(delete $o._pool[$j],$O.dispose())},$o.playMusic=function($j,$O,$V,$l,$T){return void 0===$O&&($O=0),void 0===$T&&($T=0),$o._tMusic=$j,$o._musicChannel&&$o._musicChannel.stop(),$o._musicChannel=$o.playSound($j,$O,$V,$l,null,$T)},$o.stopSound=function($j){for(var $O,$V=$o._channels.length-1;0<=$V;$V--)($O=$o._channels[$V]).url==$j&&$O.stop()},$o.stopAll=function(){$o._tMusic=null;var $j=0;for($j=$o._channels.length-1;0<=$j;$j--)$o._channels[$j].stop()},$o.stopAllSound=function(){var $j,$O=0;for($O=$o._channels.length-1;0<=$O;$O--)($j=$o._channels[$O]).url!=$o._tMusic&&$j.stop()},$o.stopMusic=function(){$o._musicChannel&&$o._musicChannel.stop(),$o._tMusic=null},$o.setSoundVolume=function($j,$O){if($O)$o._setVolume($O,$j);else{$o.soundVolume=$j;var $V,$l=0;for($l=$o._channels.length-1;0<=$l;$l--)($V=$o._channels[$l]).url!=$o._tMusic&&($V.volume=$j)}},$o.setMusicVolume=function($j){$o.musicVolume=$j,$o._setVolume($o._tMusic,$j)},$o._setVolume=function($j,$O){for(var $V,$l=$o._channels.length-1;0<=$l;$l--)($V=$o._channels[$l]).url==$j&&($V.volume=$O)},$o.musicVolume=1,$o.soundVolume=1,$o.playbackRate=1,$o._useAudioMusic=!0,$o._muted=!1,$o._soundMuted=!1,$o._musicMuted=!1,$o._tMusic=null,$o._musicChannel=null,$o._music=null,$o._channels=[],$o._autoStopMusic=!1,$o._blurPaused=!1,$o._isActive=!0,$o._soundClass=null,$o._musicClass=null,$o.autoReleaseSound=!0,$o._pool={},$o.defaultIntervals={},$o._notUsedUrls={},$o._notUsedCount=0,$o}(),$$=function(){var $j;function $V(){}return $b($V,"laya.net.LocalStorage"),$V.__init__=function(){$V._baseClass||($V._baseClass=$j).init(),$V.items=$V._baseClass.items,$V.support=$V._baseClass.support},$V.setItem=function($j,$O){$V._baseClass.setItem($j,$O)},$V.getItem=function($j){return $V._baseClass.getItem($j)},$V.setJSON=function($j,$O){$V._baseClass.setJSON($j,$O)},$V.getJSON=function($j){return $V._baseClass.getJSON($j)},$V.removeItem=function($j){$V._baseClass.removeItem($j)},$V.clear=function(){$V._baseClass.clear()},$V._baseClass=null,$V.items=null,$V.support=!1,$V.__init$=function(){$j=function(){function $V(){}return $b($V,""),$V.init=function(){try{$V.support=!0,$V.items=$m.localStorage,$V.setItem("laya","1"),$V.removeItem("laya")}catch($j){$V.support=!1}$V.support||console.log("LocalStorage is not supprot or browser is private mode.")},$V.setItem=function($j,$O){try{$V.support&&$V.items.setItem($j,$O)}catch($j){console.warn("set localStorage failed",$j)}},$V.getItem=function($j){return $V.support?$V.items.getItem($j):null},$V.setJSON=function($j,$O){try{$V.support&&$V.items.setItem($j,JSON.stringify($O))}catch($j){console.warn("set localStorage failed",$j)}},$V.getJSON=function($j){return JSON.parse($V.support?$V.items.getItem($j):null)},$V.removeItem=function($j){$V.support&&$V.items.removeItem($j)},$V.clear=function(){$V.support&&$V.items.clear()},$V.items=null,$V.support=!1,$V}()},$V}(),$Y=(function(){function $l(){}$b($l,"laya.net.ResourceVersion"),$l.enable=function($j,$O,$V){void 0===$V&&($V=2),laya.net.ResourceVersion.type=$V,$E.loader.load($j,$a.create(null,$l.onManifestLoaded,[$O]),null,"json"),$R.customFormat=$l.addVersionPrefix},$l.onManifestLoaded=function($j,$O){$l.manifest=$O,$j.run(),$O||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$l.addVersionPrefix=function($j){return $l.manifest&&$l.manifest[$j]?2==$l.type?$l.manifest[$j]:$l.manifest[$j]+"/"+$j:$j},$l.FOLDER_VERSION=1,$l.FILENAME_VERSION=2,$l.manifest=null,$l.type=1}(),function(){function $j(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$b($j,"laya.net.TTFLoader");var $O=$j.prototype;return $O.load=function($j){var $O=(this._url=$j).split(".ttf")[0].split("/");this.fontName=$O[$O.length-1],$F.window.conch?this._loadConch():$F.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$O._loadConch=function(){this._http=new $mj,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$O._onHttpLoaded=function($j){$F.window.conch.setFontFaceFromBuffer(this.fontName,$j),this._clearHttp(),this._complete()},$O._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$O._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$O._complete=function(){$E.timer.clear(this,this._complete),$E.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$O._checkComplete=function(){$M.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$O._loadWithFontFace=function(){var $j=new $F.window.FontFace(this.fontName,"url('"+this._url+"')");$F.window.document.fonts.add($j);var $O=this;$j.loaded.then(function(){$O._complete()}),$j.load()},$O._createDiv=function(){this._div=$F.createElement("div"),this._div.innerHTML="laya";var $j=this._div.style;$j.fontFamily=this.fontName,$j.position="absolute",$j.left="-100px",$j.top="-100px",$F.document.body.appendChild(this._div)},$O._loadWithCSS=function(){var $j=this,$O=$F.createElement("style");$O.type="text/css",$F.document.body.appendChild($O),$O.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$M.measureText("LayaTTFFont",this._fontTxt).width;var $V=this;$O.onload=function(){$E.timer.once(1e4,$V,$j._complete)},$E.timer.loop(20,this,this._checkComplete),this._createDiv()},$j._testString="LayaTTFFont",$j}()),$R=function(){function $l($j){this._url=null,this._path=null,this._url=$l.formatURL($j),this._path=$l.getPath($j)}$b($l,"laya.net.URL");var $j=$l.prototype;return $g(0,$j,"path",function(){return this._path}),$g(0,$j,"url",function(){return this._url}),$l.formatURL=function($j,$O){if(!$j)return"null path";if(0<$j.indexOf(":"))return $j;null!=$l.customFormat&&($j=$l.customFormat($j,$O));var $V=$j.charAt(0);if("."===$V)return $l.formatRelativePath(($O||$l.basePath)+$j);if("~"===$V)return $l.rootPath+$j.substring(1);if("d"===$V){if(0===$j.indexOf("data:image"))return $j}else if("/"===$V)return $j;return($O||$l.basePath)+$j},$l.formatRelativePath=function($j){for(var $O=$j.split("/"),$V=0,$l=$O.length;$V<$l;$V++)".."==$O[$V]&&($O.splice($V-1,2),$V-=2);return $O.join("/")},$l.isAbsolute=function($j){return 0<$j.indexOf(":")||"/"==$j.charAt(0)},$l.getPath=function($j){var $O=$j.lastIndexOf("/");return 0<$O?$j.substr(0,$O+1):""},$l.getFileName=function($j){var $O=$j.lastIndexOf("/");return 0<$O?$j.substr($O+1):$j},$l.version={},$l.basePath="",$l.rootPath="",$l.customFormat=function($j){var $O=$l.version[$j];return!$q.isConchApp&&$O&&($j+="?v="+$O),$j},$l}(),$q=function(){function $T($j,$O){this._timeId=0;var $V=$T._mainCanvas.source.style;$V.position="absolute",$V.top=$V.left="0px",$V.background="#000000",$T._mainCanvas.source.id="layaCanvas";var $l=laya.renders.Render.isWebGL;$T._mainCanvas.source.width=$j,$T._mainCanvas.source.height=$O,$l&&$T.WebGL.init($T._mainCanvas,$j,$O),$F.container.appendChild($T._mainCanvas.source),($T._context=new $i($j,$O,$l?null:$T._mainCanvas)).ctx.setIsMainContext(),$F.window.requestAnimationFrame(function $j($O){$F.window.requestAnimationFrame($j);$E.stage._loop()}),$E.stage.on("visibilitychange",this,this._onVisibilitychange)}$b($T,"laya.renders.Render");var $j=$T.prototype;return $j._onVisibilitychange=function(){$E.stage.isVisibility?0!=this._timeId&&$F.window.clearInterval(this._timeId):this._timeId=$F.window.setInterval(this._enterFrame,1e3)},$j._enterFrame=function($j){$E.stage._loop()},$g(1,$T,"context",function(){return $T._context}),$g(1,$T,"canvas",function(){return $T._mainCanvas.source}),$T._context=null,$T._mainCanvas=null,$T.WebGL=null,$T.isConchNode=!1,$T.isConchApp=!1,$T.isConchWebGL=!1,$T.isWebGL=!1,$T.is3DMode=!1,$T.optimizeTextureMemory=function($j,$O){return!0},$T.__init$=function(){$m.ConchRenderType=$m.ConchRenderType||1,$m.ConchRenderType|=$m.conch?4:0,$T.isConchNode=5==(5&$m.ConchRenderType),$T.isConchApp=4==(4&$m.ConchRenderType),$T.isConchWebGL=6==$m.ConchRenderType},$T}(),$i=function(){function $m($j,$O,$V){this.x=0,this.y=0,this._drawTexture=function($j,$O,$V){$V[0].loaded&&this.ctx.drawTexture($V[0],$V[1],$V[2],$V[3],$V[4],$j,$O)},this._fillTexture=function($j,$O,$V){$V[0].loaded&&this.ctx.fillTexture($V[0],$V[1]+$j,$V[2]+$O,$V[3],$V[4],$V[5],$V[6],$V[7])},this._drawTextureWithTransform=function($j,$O,$V){$V[0].loaded&&this.ctx.drawTextureWithTransform($V[0],$V[1],$V[2],$V[3],$V[4],$V[5],$j,$O,$V[6])},this._fillQuadrangle=function($j,$O,$V){this.ctx.fillQuadrangle($V[0],$V[1],$V[2],$V[3],$V[4])},this._drawRect=function($j,$O,$V){var $l=this.ctx;null!=$V[4]&&($l.fillStyle=$V[4],$l.fillRect($j+$V[0],$O+$V[1],$V[2],$V[3],null)),null!=$V[5]&&($l.strokeStyle=$V[5],$l.lineWidth=$V[6],$l.strokeRect($j+$V[0],$O+$V[1],$V[2],$V[3],$V[6]))},this._drawPie=function($j,$O,$V){var $l=this.ctx;$q.isWebGL&&$l.setPathId($V[8]),$l.beginPath(),$q.isWebGL?($l.movePath($V[0]+$j,$V[1]+$O),$l.moveTo(0,0)):$l.moveTo($j+$V[0],$O+$V[1]),$l.arc($j+$V[0],$O+$V[1],$V[2],$V[3],$V[4]),$l.closePath(),this._fillAndStroke($V[5],$V[6],$V[7],!0)},this._clipRect=function($j,$O,$V){this.ctx.clipRect($j+$V[0],$O+$V[1],$V[2],$V[3])},this._fillRect=function($j,$O,$V){this.ctx.fillRect($j+$V[0],$O+$V[1],$V[2],$V[3],$V[4])},this._drawCircle=function($j,$O,$V){var $l=this.ctx;$q.isWebGL&&$l.setPathId($V[6]),$K.drawCall++,$l.beginPath(),$q.isWebGL&&$l.movePath($V[0]+$j,$V[1]+$O),$l.arc($V[0]+$j,$V[1]+$O,$V[2],0,$m.PI2),$l.closePath(),this._fillAndStroke($V[3],$V[4],$V[5],!0)},this._fillCircle=function($j,$O,$V){$K.drawCall++;var $l=this.ctx;$l.beginPath(),$l.fillStyle=$V[3],$l.arc($V[0]+$j,$V[1]+$O,$V[2],0,$m.PI2),$l.fill()},this._setShader=function($j,$O,$V){this.ctx.setShader($V[0])},this._drawLine=function($j,$O,$V){var $l=this.ctx;$q.isWebGL&&$l.setPathId($V[6]),$l.beginPath(),$l.strokeStyle=$V[4],$l.lineWidth=$V[5],$q.isWebGL?($l.movePath($j,$O),$l.moveTo($V[0],$V[1]),$l.lineTo($V[2],$V[3])):($l.moveTo($j+$V[0],$O+$V[1]),$l.lineTo($j+$V[2],$O+$V[3])),$l.stroke()},this._drawLines=function($j,$O,$V){var $l=this.ctx;$q.isWebGL&&$l.setPathId($V[5]),$l.beginPath(),$j+=$V[0],$O+=$V[1],$q.isWebGL&&$l.movePath($j,$O),$l.strokeStyle=$V[3],$l.lineWidth=$V[4];var $T=$V[2],$S=2,$m=$T.length;if($q.isWebGL)for($l.moveTo($T[0],$T[1]);$S<$m;)$l.lineTo($T[$S++],$T[$S++]);else for($l.moveTo($j+$T[0],$O+$T[1]);$S<$m;)$l.lineTo($j+$T[$S++],$O+$T[$S++]);$l.stroke()},this._drawLinesWebGL=function($j,$O,$V){this.ctx.drawLines($j+this.x+$V[0],$O+this.y+$V[1],$V[2],$V[3],$V[4])},this._drawCurves=function($j,$O,$V){this.ctx.drawCurves($j,$O,$V)},this._draw=function($j,$O,$V){$V[0].call(null,this,$j,$O)},this._transformByMatrix=function($j,$O,$V){this.ctx.transformByMatrix($V[0])},this._setTransform=function($j,$O,$V){this.ctx.setTransform($V[0],$V[1],$V[2],$V[3],$V[4],$V[5])},this._setTransformByMatrix=function($j,$O,$V){this.ctx.setTransformByMatrix($V[0])},this._save=function($j,$O,$V){this.ctx.save()},this._restore=function($j,$O,$V){this.ctx.restore()},this._translate=function($j,$O,$V){this.ctx.translate($V[0],$V[1])},this._transform=function($j,$O,$V){this.ctx.translate($V[1]+$j,$V[2]+$O);var $l=$V[0];this.ctx.transform($l.a,$l.b,$l.c,$l.d,$l.tx,$l.ty),this.ctx.translate(-$j-$V[1],-$O-$V[2])},this._rotate=function($j,$O,$V){this.ctx.translate($V[1]+$j,$V[2]+$O),this.ctx.rotate($V[0]),this.ctx.translate(-$j-$V[1],-$O-$V[2])},this._scale=function($j,$O,$V){this.ctx.translate($V[2]+$j,$V[3]+$O),this.ctx.scale($V[0],$V[1]),this.ctx.translate(-$j-$V[2],-$O-$V[3])},this._alpha=function($j,$O,$V){this.ctx.globalAlpha*=$V[0]},this._setAlpha=function($j,$O,$V){this.ctx.globalAlpha=$V[0]},this._fillText=function($j,$O,$V){this.ctx.fillText($V[0],$V[1]+$j,$V[2]+$O,$V[3],$V[4],$V[5])},this._strokeText=function($j,$O,$V){this.ctx.strokeText($V[0],$V[1]+$j,$V[2]+$O,$V[3],$V[4],$V[5],$V[6])},this._fillBorderText=function($j,$O,$V){this.ctx.fillBorderText($V[0],$V[1]+$j,$V[2]+$O,$V[3],$V[4],$V[5],$V[6],$V[7])},this._blendMode=function($j,$O,$V){this.ctx.globalCompositeOperation=$V[0]},this._beginClip=function($j,$O,$V){this.ctx.beginClip&&this.ctx.beginClip($j+$V[0],$O+$V[1],$V[2],$V[3])},this._setIBVB=function($j,$O,$V){this.ctx.setIBVB($V[0]+$j,$V[1]+$O,$V[2],$V[3],$V[4],$V[5],$V[6],$V[7])},this._fillTrangles=function($j,$O,$V){this.ctx.fillTrangles($V[0],$V[1]+$j,$V[2]+$O,$V[3],$V[4])},this._drawPath=function($j,$O,$V){var $l=this.ctx;$q.isWebGL&&$l.setPathId(-1),$l.beginPath(),$j+=$V[0],$O+=$V[1],$q.isWebGL&&$l.movePath($j,$O);for(var $T=$V[2],$S=0,$m=$T.length;$S<$m;$S++){var $p=$T[$S];switch($p[0]){case"moveTo":$q.isWebGL?$l.moveTo($p[1],$p[2]):$l.moveTo($j+$p[1],$O+$p[2]);break;case"lineTo":$q.isWebGL?$l.lineTo($p[1],$p[2]):$l.lineTo($j+$p[1],$O+$p[2]);break;case"arcTo":$q.isWebGL?$l.arcTo($p[1],$p[2],$p[3],$p[4],$p[5]):$l.arcTo($j+$p[1],$O+$p[2],$j+$p[3],$O+$p[4],$p[5]);break;case"closePath":$l.closePath()}}var $o=$V[3];null!=$o&&($l.fillStyle=$o.fillStyle,$l.fill());var $H=$V[4];null!=$H&&($l.strokeStyle=$H.strokeStyle,$l.lineWidth=$H.lineWidth||1,$l.lineJoin=$H.lineJoin,$l.lineCap=$H.lineCap,$l.miterLimit=$H.miterLimit,$l.stroke())},this.drawPoly=function($j,$O,$V){this.ctx.drawPoly($j+this.x+$V[0],$O+this.y+$V[1],$V[2],$V[3],$V[4],$V[5],$V[6])},this._drawPoly=function($j,$O,$V){var $l=this.ctx,$T=$V[2],$S=2,$m=$T.length;if($q.isWebGL)for($l.setPathId($V[6]),$l.beginPath(),$j+=$V[0],$O+=$V[1],$l.movePath($j,$O),$l.moveTo($T[0],$T[1]);$S<$m;)$l.lineTo($T[$S++],$T[$S++]);else for($l.beginPath(),$j+=$V[0],$O+=$V[1],$l.moveTo($j+$T[0],$O+$T[1]);$S<$m;)$l.lineTo($j+$T[$S++],$O+$T[$S++]);$l.closePath(),this._fillAndStroke($V[3],$V[4],$V[5],$V[7])},this._drawSkin=function($j,$O,$V){var $l=$V[0];if($l){var $T=this.ctx;$l.render($T,$j,$O)}},this._drawParticle=function($j,$O,$V){this.ctx.drawParticle($j+this.x,$O+this.y,$V[0])},this._setFilters=function($j,$O,$V){this.ctx.setFilters($V)},$V?this.ctx=$V.getContext("2d"):($V=$cj.create("3D"),this.ctx=$M.createWebGLContext2D($V),$V._setContext(this.ctx)),$V.size($j,$O),this.canvas=$V}$b($m,"laya.renders.RenderContext");var $j=$m.prototype;return $j.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$j.drawTexture=function($j,$O,$V,$l,$T){$j.loaded&&this.ctx.drawTexture($j,$O,$V,$l,$T,this.x,this.y)},$j._drawTextures=function($j,$O,$V){$V[0].loaded&&this.ctx.drawTextures($V[0],$V[1],$j+this.x,$O+this.y)},$j.drawTextureWithTransform=function($j,$O,$V,$l,$T,$S,$m){$j.loaded&&this.ctx.drawTextureWithTransform($j,$O,$V,$l,$T,$S,this.x,this.y,$m)},$j.fillQuadrangle=function($j,$O,$V,$l,$T){this.ctx.fillQuadrangle($j,$O,$V,$l,$T)},$j.drawCanvas=function($j,$O,$V,$l,$T){this.ctx.drawCanvas($j,$O+this.x,$V+this.y,$l,$T)},$j.drawRect=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=1);var $m=this.ctx;$m.strokeStyle=$T,$m.lineWidth=$S,$m.strokeRect($j+this.x,$O+this.y,$V,$l,$S)},$j._fillAndStroke=function($j,$O,$V,$l){void 0===$l&&($l=!1);var $T=this.ctx;null!=$j&&($T.fillStyle=$j,$q.isWebGL?$T.fill($l):$T.fill()),null!=$O&&0<$V&&($T.strokeStyle=$O,$T.lineWidth=$V,$T.stroke())},$j.clipRect=function($j,$O,$V,$l){this.ctx.clipRect($j+this.x,$O+this.y,$V,$l)},$j.fillRect=function($j,$O,$V,$l,$T){this.ctx.fillRect($j+this.x,$O+this.y,$V,$l,$T)},$j.drawCircle=function($j,$O,$V,$l,$T){void 0===$T&&($T=1),$K.drawCall++;var $S=this.ctx;$S.beginPath(),$S.strokeStyle=$l,$S.lineWidth=$T,$S.arc($j+this.x,$O+this.y,$V,0,$m.PI2),$S.stroke()},$j.drawTriangles=function($j,$O,$V){if($q.isWebGL)this.ctx.drawTriangles($V[0],$j+$V[1],$O+$V[2],$V[3],$V[4],$V[5],$V[6],$V[7],$V[8],$V[9]);else{var $l=$V[5],$T=0,$S=$l.length,$m=this.ctx;for($T=0;$T<$S;$T+=3){var $p=2*$l[$T],$o=2*$l[$T+1],$H=2*$l[$T+2];$m.drawTriangle($V[0],$V[3],$V[4],$p,$o,$H,$V[6],!0)}}},$j.fillCircle=function($j,$O,$V,$l){$K.drawCall++;var $T=this.ctx;$T.beginPath(),$T.fillStyle=$l,$T.arc($j+this.x,$O+this.y,$V,0,$m.PI2),$T.fill()},$j.setShader=function($j){this.ctx.setShader($j)},$j.drawLine=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=1);var $m=this.ctx;$m.beginPath(),$m.strokeStyle=$T,$m.lineWidth=$S,$m.moveTo(this.x+$j,this.y+$O),$m.lineTo(this.x+$V,this.y+$l),$m.stroke()},$j.clear=function(){this.ctx.clear()},$j.transformByMatrix=function($j){this.ctx.transformByMatrix($j)},$j.setTransform=function($j,$O,$V,$l,$T,$S){this.ctx.setTransform($j,$O,$V,$l,$T,$S)},$j.setTransformByMatrix=function($j){this.ctx.setTransformByMatrix($j)},$j.save=function(){this.ctx.save()},$j.restore=function(){this.ctx.restore()},$j.translate=function($j,$O){this.ctx.translate($j,$O)},$j.transform=function($j,$O,$V,$l,$T,$S){this.ctx.transform($j,$O,$V,$l,$T,$S)},$j.rotate=function($j){this.ctx.rotate($j)},$j.scale=function($j,$O){this.ctx.scale($j,$O)},$j.alpha=function($j){this.ctx.globalAlpha*=$j},$j.setAlpha=function($j){this.ctx.globalAlpha=$j},$j.fillWords=function($j,$O,$V,$l,$T,$S){void 0===$S&&($S=0),this.ctx.fillWords($j,$O,$V,$l,$T,$S)},$j.fillBorderWords=function($j,$O,$V,$l,$T,$S,$m){this.ctx.fillBorderWords($j,$O,$V,$l,$T,$S,$m)},$j.fillText=function($j,$O,$V,$l,$T,$S){this.ctx.fillText($j,$O+this.x,$V+this.y,$l,$T,$S)},$j.strokeText=function($j,$O,$V,$l,$T,$S,$m){this.ctx.strokeText($j,$O+this.x,$V+this.y,$l,$T,$S,$m)},$j.blendMode=function($j){this.ctx.globalCompositeOperation=$j},$j.flush=function(){this.ctx.flush&&this.ctx.flush()},$j.addRenderObject=function($j){this.ctx.addRenderObject($j)},$j.beginClip=function($j,$O,$V,$l){this.ctx.beginClip&&this.ctx.beginClip($j,$O,$V,$l)},$j.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$j.fillTrangles=function($j,$O,$V){this.ctx.fillTrangles($V[0],$V[1],$V[2],$V[3],4<$V.length?$V[4]:null)},$m.PI2=2*Math.PI,$m}(),$k=function(){function $m($j,$O){switch(this._next=$O||$m.NORENDER,$j){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$h._filter);case 69905:return void(this._fun=$m._initRenderFun)}this.onCreate($j)}$b($m,"laya.renders.RenderSprite");var $j=$m.prototype;return $j.onCreate=function($j){},$j._style=function($j,$O,$V,$l){$j._style.render($j,$O,$V,$l);var $T=this._next;$T._fun.call($T,$j,$O,$V,$l)},$j._no=function($j,$O,$V,$l){},$j._custom=function($j,$O,$V,$l){$j.customRender($O,$V,$l);var $T=$j._style._tf;this._next._fun.call(this._next,$j,$O,$V-$T.translateX,$l-$T.translateY)},$j._clip=function($j,$O,$V,$l){var $T=this._next;if($T!=$m.NORENDER){var $S=$j._style.scrollRect;$O.ctx.save(),$O.ctx.clipRect($V,$l,$S.width,$S.height),$T._fun.call($T,$j,$O,$V-$S.x,$l-$S.y),$O.ctx.restore()}},$j._blend=function($j,$O,$V,$l){var $T=$j._style;$T.blendMode&&($O.ctx.globalCompositeOperation=$T.blendMode);var $S=this._next;$S._fun.call($S,$j,$O,$V,$l),$O.ctx.globalCompositeOperation="source-over"},$j._mask=function($j,$O,$V,$l){var $T=this._next;$T._fun.call($T,$j,$O,$V,$l);var $S=$j.mask;$S&&($O.ctx.globalCompositeOperation="destination-in",(0<$S.numChildren||!$S.graphics._isOnlyOne())&&($S.cacheAsBitmap=!0),$S.render($O,$V-$j.pivotX,$l-$j.pivotY)),$O.ctx.globalCompositeOperation="source-over"},$j._graphics=function($j,$O,$V,$l){var $T=$j._style._tf;$j._graphics&&$j._graphics._render($j,$O,$V-$T.translateX,$l-$T.translateY);var $S=this._next;$S._fun.call($S,$j,$O,$V,$l)},$j._image=function($j,$O,$V,$l){var $T=$j._style;$O.ctx.drawTexture2($V,$l,$T._tf.translateX,$T._tf.translateY,$j.transform,$T.alpha,$T.blendMode,$j._graphics._one)},$j._image2=function($j,$O,$V,$l){var $T=$j._style._tf;$O.ctx.drawTexture2($V,$l,$T.translateX,$T.translateY,$j.transform,1,null,$j._graphics._one)},$j._alpha=function($j,$O,$V,$l){var $T;if(.01<($T=$j._style.alpha)||$j._needRepaint()){var $S=$O.ctx.globalAlpha;$O.ctx.globalAlpha*=$T;var $m=this._next;$m._fun.call($m,$j,$O,$V,$l),$O.ctx.globalAlpha=$S}},$j._transform=function($j,$O,$V,$l){var $T=$j.transform,$S=this._next;$T&&$S!=$m.NORENDER?($O.save(),$O.transform($T.a,$T.b,$T.c,$T.d,$T.tx+$V,$T.ty+$l),$S._fun.call($S,$j,$O,0,0),$O.restore()):$S._fun.call($S,$j,$O,$V,$l)},$j._childs=function($j,$O,$V,$l){var $T=$j._style,$S=$T._tf;if($V=$V-$S.translateX+$T.paddingLeft,$l=$l-$S.translateY+$T.paddingTop,$T._calculation){var $m=$j._getWords();if($m){var $p=$T;$p&&($p.stroke?$O.fillBorderWords($m,$V,$l,$p.font,$p.color,$p.strokeColor,$p.stroke):$O.fillWords($m,$V,$l,$p.font,$p.color,"none"!=$p.textDecoration&&$p.underLine?1:0))}}var $o,$H=$j._childs,$g=$H.length;if($j.viewport||$j.optimizeScrollRect&&$j._style.scrollRect){var $e=$j.viewport||$j._style.scrollRect,$t=$e.x,$w=$e.y,$s=$e.right,$b=$e.bottom,$r=NaN,$h=NaN;for($a=0;$a<$g;++$a)($o=$H[$a]).visible&&($r=$o._x)<$s&&$r+$o.width>$t&&($h=$o._y)<$b&&$h+$o.height>$w&&$o.render($O,$V,$l)}else for(var $a=0;$a<$g;++$a)($o=$H[$a])._style.visible&&$o.render($O,$V,$l)},$j._canvas=function($j,$O,$V,$l){var $T=$j._$P.cacheCanvas;if($T){"bitmap"===$T.type?$K.canvasBitmap++:$K.canvasNormal++;var $S=$T.ctx;if($j._needRepaint()||!$S)this._canvas_repaint($j,$O,$V,$l);else{var $m=$T._cacheRec;$O.drawCanvas($S.canvas,$V+$m.x,$l+$m.y,$m.width,$m.height)}}else this._next._fun.call(this._next,$j,$O,$V,$l)},$j._canvas_repaint=function($j,$O,$V,$l){var $T=$j._$P.cacheCanvas,$S=this._next;if($T){var $m,$p,$o,$H,$g=$T.ctx,$e=$j._needRepaint()||!$g,$t=$T.type;if("bitmap"===$t?$K.canvasBitmap++:$K.canvasNormal++,$e){var $w,$s;$T._cacheRec||($T._cacheRec=new $z),$q.isWebGL&&"bitmap"!==$t?$T._cacheRec.setTo(-$j.pivotX,-$j.pivotY,1,1):(($H=$j.getSelfBounds()).x=$H.x-$j.pivotX,$H.y=$H.y-$j.pivotY,$H.x=$H.x-16,$H.y=$H.y-16,$H.width=$H.width+32,$H.height=$H.height+32,$H.x=Math.floor($H.x+$V)-$V,$H.y=Math.floor($H.y+$l)-$l,$H.width=Math.floor($H.width),$H.height=Math.floor($H.height),$T._cacheRec.copyFrom($H)),$H=$T._cacheRec;var $b,$r=$q.isWebGL?1:$F.pixelRatio*$E.stage.clientScaleX,$h=$q.isWebGL?1:$F.pixelRatio*$E.stage.clientScaleY;if(!$q.isWebGL){var $a,$c=1,$A=1;for($a=$j;$a&&$a!=$E.stage;)$c*=$a.scaleX,$A*=$a.scaleY,$a=$a.parent;$q.isWebGL?($c<1&&($r*=$c),$A<1&&($h*=$A)):(1<$c&&($r*=$c),1<$A&&($h*=$A))}if($j.scrollRect){var $Z=$j.scrollRect;$H.x-=$Z.x,$H.y-=$Z.y}if($w=$H.width*$r,$s=$H.height*$h,$p=$H.x,$o=$H.y,$q.isWebGL&&"bitmap"===$t&&(2048<$w||2048<$s))return console.warn("cache bitmap size larger than 2048,cache ignored"),$T.ctx&&($W.recover("RenderContext",$T.ctx),$T.ctx.canvas.size(0,0),$T.ctx=null),void $S._fun.call($S,$j,$O,$V,$l);if($g||($g=$T.ctx=$W.getItem("RenderContext")||new $i($w,$s,$cj.create("AUTO"))),$g.ctx.sprite=$j,($m=$g.canvas).clear(),($m.width!=$w||$m.height!=$s)&&$m.size($w,$s),"bitmap"===$t?$m.context.asBitmap=!0:"normal"===$t&&($m.context.asBitmap=!1),1!=$r||1!=$h){var $x=$g.ctx;$x.save(),$x.scale($r,$h),!$q.isConchWebGL&&$q.isConchApp&&($b=$j._$P.cf)&&$x.setFilterMatrix&&$x.setFilterMatrix($b._mat,$b._alpha),$S._fun.call($S,$j,$g,-$p,-$o),$x.restore(),$q.isConchApp&&!$q.isConchWebGL||$j._applyFilters()}else $x=$g.ctx,!$q.isConchWebGL&&$q.isConchApp&&($b=$j._$P.cf)&&$x.setFilterMatrix&&$x.setFilterMatrix($b._mat,$b._alpha),$S._fun.call($S,$j,$g,-$p,-$o),$q.isConchApp&&!$q.isConchWebGL||$j._applyFilters();$j._$P.staticCache&&($T.reCache=!1),$K.canvasReCache++}else $p=($H=$T._cacheRec).x,$o=$H.y,$m=$g.canvas;$O.drawCanvas($m,$V+$p,$l+$o,$H.width,$H.height)}else $S._fun.call($S,$j,$g,$V,$l)},$m.__init__=function(){var $j,$O,$V=0;for($O=$M.createRenderSprite(69905,null),$j=$m.renders.length=4096,$V=0;$V<$j;$V++)$m.renders[$V]=$O;$m.renders[0]=$M.createRenderSprite(0,null),function($j,$O){for(var $V=0,$l=0;$l<$j.length;$l++)$V|=$j[$l],$m.renders[$V]=$O}([1,512,4,2],new $m(1,null)),$m.renders[513]=$M.createRenderSprite(513,null),$m.renders[517]=new $m(517,null)},$m._initRenderFun=function($j,$O,$V,$l){var $T=$j._renderType;($m.renders[$T]=$m._getTypeRender($T))._fun($j,$O,$V,$l)},$m._getTypeRender=function($j){for(var $O=null,$V=2048;1<$V;)$V&$j&&($O=$M.createRenderSprite($V,$O)),$V>>=1;return $O},$m.IMAGE=1,$m.ALPHA=2,$m.TRANSFORM=4,$m.BLEND=8,$m.CANVAS=16,$m.FILTERS=32,$m.MASK=64,$m.CLIP=128,$m.STYLE=256,$m.GRAPHICS=512,$m.CUSTOM=1024,$m.CHILDS=2048,$m.INIT=69905,$m.renders=[],$m.NORENDER=new $m(0,null),$m}(),$n=function(){function $p(){this._repaint=!1}$b($p,"laya.resource.Context");var $j=$p.prototype;return $j.replaceReset=function(){var $j,$O,$V=0;for($j=$p.replaceKeys.length,$V=0;$V<$j;$V++)$O=$p.replaceKeys[$V],this[$p.newKeys[$V]]=this[$O]},$j.replaceResotre=function(){this.__restore(),this.__reset()},$j.setIsMainContext=function(){},$j.drawTextures=function($j,$O,$V,$l){$K.drawCall+=$O.length/2;for(var $T=$j.width,$S=$j.height,$m=0,$p=$O.length;$m<$p;$m+=2)this.drawTexture($j,$O[$m],$O[$m+1],$T,$S,$V,$l)},$j.drawCanvas=function($j,$O,$V,$l,$T){$K.drawCall++,this.drawImage($j.source,$O,$V,$l,$T)},$j.fillRect=function($j,$O,$V,$l,$T){$K.drawCall++,$T&&(this.fillStyle=$T),this.__fillRect($j,$O,$V,$l)},$j.fillText=function($j,$O,$V,$l,$T,$S){$K.drawCall++,3<arguments.length&&null!=$l&&(this.font=$l,this.fillStyle=$T,this.textAlign=$S,this.textBaseline="top"),this.__fillText($j,$O,$V)},$j.fillBorderText=function($j,$O,$V,$l,$T,$S,$m,$p){$K.drawCall++,this.font=$l,this.fillStyle=$T,this.textBaseline="top",this.strokeStyle=$S,this.lineWidth=$m,this.textAlign=$p,this.__strokeText($j,$O,$V),this.__fillText($j,$O,$V)},$j.strokeText=function($j,$O,$V,$l,$T,$S,$m){$K.drawCall++,3<arguments.length&&null!=$l&&(this.font=$l,this.strokeStyle=$T,this.lineWidth=$S,this.textAlign=$m,this.textBaseline="top"),this.__strokeText($j,$O,$V)},$j.transformByMatrix=function($j){this.transform($j.a,$j.b,$j.c,$j.d,$j.tx,$j.ty)},$j.setTransformByMatrix=function($j){this.setTransform($j.a,$j.b,$j.c,$j.d,$j.tx,$j.ty)},$j.clipRect=function($j,$O,$V,$l){$K.drawCall++,this.beginPath(),this.rect($j,$O,$V,$l),this.clip()},$j.drawTexture=function($j,$O,$V,$l,$T,$S,$m){$K.drawCall++;var $p=$j.uv,$o=$j.bitmap.width,$H=$j.bitmap.height;this.drawImage($j.source,$p[0]*$o,$p[1]*$H,($p[2]-$p[0])*$o,($p[5]-$p[3])*$H,$O+$S,$V+$m,$l,$T)},$j.drawTextureWithTransform=function($j,$O,$V,$l,$T,$S,$m,$p,$o){$K.drawCall++;var $H=$j.uv,$g=$j.bitmap.width,$e=$j.bitmap.height;this.save(),1!=$o&&(this.globalAlpha*=$o),$S?(this.transform($S.a,$S.b,$S.c,$S.d,$S.tx+$m,$S.ty+$p),this.drawImage($j.source,$H[0]*$g,$H[1]*$e,($H[2]-$H[0])*$g,($H[5]-$H[3])*$e,$O,$V,$l,$T)):this.drawImage($j.source,$H[0]*$g,$H[1]*$e,($H[2]-$H[0])*$g,($H[5]-$H[3])*$e,$O+$m,$V+$p,$l,$T),this.restore()},$j.drawTexture2=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=$p[0];if($o.loaded&&$o.bitmap&&$o.source){$K.drawCall++;var $H=1!==$S;if($H){var $g=this.globalAlpha;this.globalAlpha*=$S}var $e=$o.uv,$t=$o.bitmap.width,$w=$o.bitmap.height;$T?(this.save(),this.transform($T.a,$T.b,$T.c,$T.d,$T.tx+$j,$T.ty+$O),this.drawImage($o.source,$e[0]*$t,$e[1]*$w,($e[2]-$e[0])*$t,($e[5]-$e[3])*$w,$p[1]-$V,$p[2]-$l,$p[3],$p[4]),this.restore()):this.drawImage($o.source,$e[0]*$t,$e[1]*$w,($e[2]-$e[0])*$t,($e[5]-$e[3])*$w,$p[1]-$V+$j,$p[2]-$l+$O,$p[3],$p[4]),$H&&(this.globalAlpha=$g)}},$j.fillTexture=function($j,$O,$V,$l,$T,$S,$m,$p){if(!$p.pat){if($j.uv!=$gj.DEF_UV){var $o=new $cj("2D");$o.getContext("2d"),$o.size($j.width,$j.height),$o.context.drawTexture($j,0,0,$j.width,$j.height,0,0),$j=new $gj($o)}$p.pat=this.createPattern($j.bitmap.source,$S)}var $H=$O,$g=$V,$e=0,$t=0;$m&&($H+=$m.x%$j.width,$g+=$m.y%$j.height,$e-=$m.x%$j.width,$t-=$m.y%$j.height),this.translate($H,$g),this.fillRect($e,$t,$l,$T,$p.pat),this.translate(-$H,-$g)},$j.drawTriangle=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=$j.bitmap,$H=$o.source,$g=$j.width,$e=$j.height,$t=$o.width,$w=$o.height,$s=$V[$l]*$t,$b=$V[$T]*$t,$r=$V[$S]*$t,$h=$V[$l+1]*$w,$a=$V[$T+1]*$w,$c=$V[$S+1]*$w,$A=$O[$l],$Z=$O[$T],$x=$O[$S],$E=$O[$l+1],$U=$O[$T+1],$z=$O[$S+1];if($p){var $$=($A+$Z+$x)/3,$_=($E+$U+$z)/3,$B=$A-$$,$M=$E-$_,$v=Math.sqrt($B*$B+$M*$M);$A=$$+$B/$v*($v+1),$E=$_+$M/$v*($v+1),$M=$U-$_,$Z=$$+($B=$Z-$$)/($v=Math.sqrt($B*$B+$M*$M))*($v+1),$U=$_+$M/$v*($v+1),$M=$z-$_,$x=$$+($B=$x-$$)/($v=Math.sqrt($B*$B+$M*$M))*($v+1),$z=$_+$M/$v*($v+1)}this.save(),$m&&this.transform($m.a,$m.b,$m.c,$m.d,$m.tx,$m.ty),this.beginPath(),this.moveTo($A,$E),this.lineTo($Z,$U),this.lineTo($x,$z),this.closePath(),this.clip();var $Y=1/($s*$a+$h*$r+$b*$c-$a*$r-$h*$b-$s*$c),$R=$A*$a+$h*$x+$Z*$c-$a*$x-$h*$Z-$A*$c,$q=$s*$Z+$A*$r+$b*$x-$Z*$r-$A*$b-$s*$x,$i=$s*$a*$x+$h*$Z*$r+$A*$b*$c-$A*$a*$r-$h*$b*$x-$s*$Z*$c,$k=$E*$a+$h*$z+$U*$c-$a*$z-$h*$U-$E*$c,$n=$s*$U+$E*$r+$b*$z-$U*$r-$E*$b-$s*$z,$G=$s*$a*$z+$h*$U*$r+$E*$b*$c-$E*$a*$r-$h*$b*$z-$s*$U*$c;this.transform($R*$Y,$k*$Y,$q*$Y,$n*$Y,$i*$Y,$G*$Y),this.drawImage($H,$j.uv[0]*$t,$j.uv[1]*$w,$g,$e,$j.uv[0]*$t,$j.uv[1]*$w,$g,$e),this.restore()},$j.flush=function(){return 0},$j.fillWords=function($j,$O,$V,$l,$T,$S){$l&&(this.font=$l),$T&&(this.fillStyle=$T);this.textBaseline="top",this.textAlign="left";for(var $m=0,$p=$j.length;$m<$p;$m++){var $o=$j[$m];if(this.__fillText($o.char,$o.x+$O,$o.y+$V),1===$S){var $H=$o.height,$g=.5*$o.style.letterSpacing;$g||($g=0),this.beginPath(),this.strokeStyle=$T,this.lineWidth=1,this.moveTo($O+$o.x-$g+.5,$V+$o.y+$H+.5),this.lineTo($O+$o.x+$o.width+$g+.5,$V+$o.y+$H+.5),this.stroke()}}},$j.fillBorderWords=function($j,$O,$V,$l,$T,$S,$m){$l&&(this.font=$l),$T&&(this.fillStyle=$T),this.textBaseline="top",this.lineWidth=$m,this.textAlign="left",this.strokeStyle=$S;for(var $p=0,$o=$j.length;$p<$o;$p++){var $H=$j[$p];this.__strokeText($H.char,$H.x+$O,$H.y+$V),this.__fillText($H.char,$H.x+$O,$H.y+$V)}},$j.destroy=function(){this.canvas.width=this.canvas.height=0},$j.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$j.drawCurves=function($j,$O,$V){this.beginPath(),this.strokeStyle=$V[3],this.lineWidth=$V[4];var $l=$V[2];$j+=$V[0],$O+=$V[1],this.moveTo($j+$l[0],$O+$l[1]);for(var $T=2,$S=$l.length;$T<$S;)this.quadraticCurveTo($j+$l[$T++],$O+$l[$T++],$j+$l[$T++],$O+$l[$T++]);this.stroke()},$p.__init__=function($O){var $V=laya.resource.Context.prototype;if(!($O=$O||CanvasRenderingContext2D.prototype).inited){$O.inited=!0,$O.__fillText=$O.fillText,$O.__fillRect=$O.fillRect,$O.__strokeText=$O.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($j){$O[$j]=$V[$j]})}},$p.replaceCanvasGetSet=function($j,$O){var $V=Object.getOwnPropertyDescriptor($j,$O);if(!$V||!$V.configurable)return!1;var $l,$T={};for($l in $V)"set"!=$l&&($T[$l]=$V[$l]);var $S=$V.set;return $T.set=function($j){$S.call(this,$j);var $O=this.getContext("2d");$O&&"__reset"in $O&&$O.__reset()},Object.defineProperty($j,$O,$T),!0},$p.replaceGetSet=function($j,$O){var $V=Object.getOwnPropertyDescriptor($j,$O);if(!$V||!$V.configurable)return!1;var $l,$T={};for($l in $V)"set"!=$l&&($T[$l]=$V[$l]);var $S=$V.set,$m="___"+$O+"__";return $p.newKeys.push($m),$T.set=function($j){$j!=this[$m]&&(this[$m]=$j,$S.call(this,$j))},Object.defineProperty($j,$O,$T),!0},$p._default=new $p,$p.newKeys=[],$o($p,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$p}(),$G=function(){function $S($j){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$S._uniqueIDCounter,this._name=$j||"Content Manager",$S._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$S._resourceManagers.push(this),this._resources=[],this._records={}}$b($S,"laya.resource.ResourceManager");var $j=$S.prototype;return $E.imps($j,{"laya.resource.IDispose":!0}),$j.getResourceByIndex=function($j){return this._resources[$j]},$j.getResourcesLength=function(){return this._resources.length},$j.addResource=function($j){return $j.resourceManager&&$j.resourceManager.removeResource($j),-1===this._resources.indexOf($j)&&(($j._resourceManager=this)._resources.push($j),this.addRecord($j.uri,$j.__className,$j.memorySize),this.addSize($j.memorySize),!0)},$j.removeResource=function($j){var $O=this._resources.indexOf($j);return-1!==$O&&(this._resources.splice($O,1),$j._resourceManager=null,this._memorySize-=$j.memorySize,this.addRecord($j.uri,$j.__className,-$j.memorySize),!0)},$j.unload=function(){for(var $j=this._resources.slice(0,this._resources.length),$O=0;$O<$j.length;$O++){$j[$O].destroy()}$j.length=0},$j.dispose=function(){if(this===$S._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$S._resourceManagers.splice($S._resourceManagers.indexOf(this),1),$S._isResourceManagersSorted=!1;for(var $j=this._resources.slice(0,this._resources.length),$O=0;$O<$j.length;$O++){var $V=$j[$O];$V.resourceManager.removeResource($V),$V.destroy()}$j.length=0},$j.addSize=function($j){$j&&(this.autoRelease&&0<$j&&this._memorySize+$j>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$j)},$j.addRecord=function($j,$O,$V){DEBUG&&$V&&!$j&&console.error($j,$O,$V)},$j.garbageCollection=function($j){var $O=this._resources;($O=$O.slice()).sort(function($j,$O){if(!$j||!$O)throw new Error("a或b不能为空！");return $j.released&&$O.released?0:$j.released?1:$O.released?-1:$j._lastUseFrameCount-$O._lastUseFrameCount});for(var $V=$K.loopCount,$l=0,$T=$O.length;$l<$T;$l++){var $S=$O[$l];if(!(1<$V-$S._lastUseFrameCount))return void(this._memorySize>=$j&&(this._isOverflow=!0));if($S.releaseResource(),this._memorySize<$j)return void(this._isOverflow=!1)}},$g(0,$j,"id",function(){return this._id}),$g(0,$j,"name",function(){return this._name},function($j){!$j&&""===$j||this._name===$j||(this._name=$j,$S._isResourceManagersSorted=!1)}),$g(0,$j,"memorySize",function(){return this._memorySize}),$g(0,$j,"records",function(){return this._records}),$g(1,$S,"systemResourceManager",function(){return $S._systemResourceManager}),$S.__init__=function(){$S.currentResourceManager=$S.systemResourceManager},$S.getLoadedResourceManagerByIndex=function($j){return $S._resourceManagers[$j]},$S.getLoadedResourceManagersCount=function(){return $S._resourceManagers.length},$S.recreateContentManagers=function($j){void 0===$j&&($j=!1);for(var $O=$S.currentResourceManager,$V=0;$V<$S._resourceManagers.length;$V++){$S.currentResourceManager=$S._resourceManagers[$V];for(var $l=0;$l<$S.currentResourceManager._resources.length;$l++)$S.currentResourceManager._resources[$l].releaseResource($j),$S.currentResourceManager._resources[$l].activeResource($j)}$S.currentResourceManager=$O},$S.releaseContentManagers=function($j){void 0===$j&&($j=!1);for(var $O=$S.currentResourceManager,$V=0;$V<$S._resourceManagers.length;$V++){$S.currentResourceManager=$S._resourceManagers[$V];for(var $l=0;$l<$S.currentResourceManager._resources.length;$l++){var $T=$S.currentResourceManager._resources[$l];!$T.released&&$T.releaseResource($j)}}$S.currentResourceManager=$O},$S._uniqueIDCounter=0,$S._isResourceManagersSorted=!1,$S._resourceManagers=[],$o($S,["_systemResourceManager",function(){return this._systemResourceManager=new $S("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$S._systemResourceManager}]),$S}(),$F=(function(){function $j(){}$b($j,"laya.system.System"),$j.changeDefinition=function($j,$O){$E[$j]=$O;var $V=$j+"=classObj";$E._runScript($V)},$j.__init__=function(){$q.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $V(){}return $b($V,"laya.utils.Browser"),$g(1,$V,"pixelRatio",function(){return $V.__init__(),-1<$V.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$M.getPixelRatio()}),$g(1,$V,"height",function(){return $V.__init__(),($E.stage&&$E.stage.canvasRotation?$V.clientWidth:$V.clientHeight)*$V.pixelRatio}),$g(1,$V,"clientWidth",function(){return $V.__init__(),$V.window.innerWidth||$V.document.body.clientWidth}),$g(1,$V,"window",function(){return $V.__init__(),$V._window}),$g(1,$V,"clientHeight",function(){return $V.__init__(),$V.window.innerHeight||$V.document.body.clientHeight||$V.document.documentElement.clientHeight}),$g(1,$V,"width",function(){return $V.__init__(),($E.stage&&$E.stage.canvasRotation?$V.clientHeight:$V.clientWidth)*$V.pixelRatio}),$g(1,$V,"container",function(){return $V.__init__(),$V._container||(($V._container=$V.createElement("div")).id="layaContainer",$V.document.body.appendChild($V._container)),$V._container},function($j){$V._container=$j}),$g(1,$V,"document",function(){return $V.__init__(),$V._document}),$V.__init__=function(){if(!$V._window){$V._window=$M.getWindow(),$V._document=$V.window.document,$V._window.addEventListener("message",function($j){laya.utils.Browser._onMessage($j)},!1),$V.document.__createElement=$V.document.createElement,$m.requestAnimationFrame=$m.requestAnimationFrame||$m.webkitRequestAnimationFrame||$m.mozRequestAnimationFrame||$m.oRequestAnimationFrame||$m.msRequestAnimationFrame||function($j){return $m.setTimeout($j,1e3/60)};var $j=$m.document.body.style;$j["-webkit-user-select"]="none",$j["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$V.userAgent=$V.window.navigator.userAgent,$V.onIOS=!!($V.u=$V.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$V.onMobile=-1<$V.u.indexOf("Mobile"),$V.onIPhone=-1<$V.u.indexOf("iPhone"),$V.onMac=-1<$V.u.indexOf("Mac OS X"),$V.onIPad=-1<$V.u.indexOf("iPad"),$V.onAndroid=-1<$V.u.indexOf("Android")||-1<$V.u.indexOf("Adr"),$V.onWP=-1<$V.u.indexOf("Windows Phone"),$V.onQQBrowser=-1<$V.u.indexOf("QQBrowser"),$V.onMQQBrowser=-1<$V.u.indexOf("MQQBrowser")||-1<$V.u.indexOf("Mobile")&&-1<$V.u.indexOf("QQ"),$V.onIE=!!$V.window.ActiveXObject||"ActiveXObject"in $V.window,$V.onWeiXin=-1<$V.u.indexOf("MicroMessenger"),$V.onPC=!$V.onMobile,$V.onSafari=-1<$V.u.indexOf("Safari"),$V.onFirefox=-1<$V.u.indexOf("Firefox"),$V.onEdge=-1<$V.u.indexOf("Edge"),$V.onMiniGame=-1<$V.u.indexOf("MiniGame"),$V.onLimixiu=-1<$V.u.indexOf("limixiu"),$V.httpProtocol="http:"==$V.window.location.protocol,$V.onMiniGame&&null==$V.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$V.webAudioEnabled=!!($V.window.AudioContext||$V.window.webkitAudioContext||$V.window.mozAudioContext),$V.soundType=$V.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$Tj=$V.webAudioEnabled?$Sj:$Vj,$V.webAudioEnabled&&$Sj.initWebAudio(),$Vj._initMusicAudio(),$V.enableTouch="ontouchstart"in $m||$m.DocumentTouch&&$O instanceof DocumentTouch,$m.focus(),$B._soundClass=$Tj,$B._musicClass=$Vj,$q._mainCanvas=$q._mainCanvas||$cj.create("2D"),$V.canvas||($V.canvas=$cj.create("2D"),$V.context=$V.canvas.getContext("2d"))}},$V._onMessage=function($j){if($j.data&&"size"==$j.data.name){if($V.window.innerWidth=$j.data.width,$V.window.innerHeight=$j.data.height,$V.window.__innerHeight=$j.data.clientHeight,!$V.document.createEvent)return void console.warn("no document.createEvent");var $O=$V.document.createEvent("HTMLEvents");return $O.initEvent("resize",!1,!1),void $V.window.dispatchEvent($O)}},$V.createElement=function($j){return $V.__init__(),$V.document.__createElement($j)},$V.getElementById=function($j){return $V.__init__(),$V.document.getElementById($j)},$V.removeElement=function($j){$j&&$j.parentNode&&$j.parentNode.removeChild($j)},$V.now=function(){return $M.now()},$V._window=null,$V._document=null,$V._container=null,$V.userAgent=null,$V.u=null,$V.onIOS=!1,$V.onMac=!1,$V.onMobile=!1,$V.onIPhone=!1,$V.onIPad=!1,$V.onAndroid=!1,$V.onWP=!1,$V.onQQBrowser=!1,$V.onMQQBrowser=!1,$V.onSafari=!1,$V.onFirefox=!1,$V.onEdge=!1,$V.onIE=!1,$V.onWeiXin=!1,$V.onMiniGame=!1,$V.onLimixiu=!1,$V.onPC=!1,$V.httpProtocol=!1,$V.webAudioEnabled=!1,$V.soundType=null,$V.enableTouch=!1,$V.canvas=null,$V.context=null,$V.__init$=function(){},$V}()),$N=function(){function $O($j){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$j?(this._u8d_=new Uint8Array($j),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$b($O,"laya.utils.Byte");var $j=$O.prototype;return $j.___resizeBuffer=function($O){try{var $j=new Uint8Array($O);null!=this._u8d_&&(this._u8d_.length<=$O?$j.set(this._u8d_):$j.set(this._u8d_.subarray(0,$O))),this._u8d_=$j,this._d_=new DataView($j.buffer)}catch($j){throw"___resizeBuffer err:"+$O}},$j.getString=function(){return this.rUTF(this.getUint16())},$j.getFloat32Array=function($j,$O){var $V=$j+$O;$V=$V>this._length?this._length:$V;var $l=new Float32Array(this._d_.buffer.slice($j,$V));return this._pos_=$V,$l},$j.getUint8Array=function($j,$O){var $V=$j+$O;$V=$V>this._length?this._length:$V;var $l=new Uint8Array(this._d_.buffer.slice($j,$V));return this._pos_=$V,$l},$j.getInt16Array=function($j,$O){var $V=$j+$O;$V=$V>this._length?this._length:$V;var $l=new Int16Array(this._d_.buffer.slice($j,$V));return this._pos_=$V,$l},$j.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $j=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$j},$j.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $j=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$j},$j.writeFloat32=function($j){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$j,this._xd_),this._pos_+=4},$j.writeFloat64=function($j){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$j,this._xd_),this._pos_+=8},$j.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $j=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$j},$j.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $j=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$j},$j.writeInt32=function($j){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$j,this._xd_),this._pos_+=4},$j.writeUint32=function($j){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$j,this._xd_),this._pos_+=4},$j.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $j=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$j},$j.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $j=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$j},$j.writeUint16=function($j){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$j,this._xd_),this._pos_+=2},$j.writeInt16=function($j){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$j,this._xd_),this._pos_+=2},$j.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$j.writeUint8=function($j){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$j),this._pos_++},$j._getUInt8=function($j){return this._d_.getUint8($j)},$j._getUint16=function($j){return this._d_.getUint16($j,this._xd_)},$j._getMatrix=function(){return new $v(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$j.rUTF=function($j){for(var $O=[],$V=this._pos_+$j,$l=0,$T=0,$S=0,$m=String.fromCharCode,$p=this._u8d_;this._pos_<$V;)($l=$p[this._pos_++])<128?0!=$l&&$O.push($m($l)):$l<224?$O.push($m((63&$l)<<6|127&$p[this._pos_++])):$l<240?($T=$p[this._pos_++],$O.push($m((31&$l)<<12|(127&$T)<<6|127&$p[this._pos_++]))):($T=$p[this._pos_++],$S=$p[this._pos_++],$O.push($m((15&$l)<<18|(127&$T)<<12|$S<<6&127|127&$p[this._pos_++]))),0;return $O.join("")},$j.getCustomString=function($j){for(var $O=[],$V=0,$l=0,$T=0,$S=String.fromCharCode,$m=this._u8d_;0<$j;)if(($l=$m[this._pos_])<128)$O.push($S($l)),this._pos_++,$j--;else for($V=$l-128,this._pos_++,$j-=$V;0<$V;)$l=$m[this._pos_++],$T=$m[this._pos_++],$O.push($S($T<<8|$l)),$V--;return $O.join("")},$j.clear=function(){this._pos_=0,this.length=0},$j.__getBuffer=function(){return this._d_.buffer},$j.writeUTFBytes=function($j){for(var $O=0,$V=($j+="").length;$O<$V;$O++){var $l=$j.charCodeAt($O);$l<=127?this.writeByte($l):$l<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$l>>6,128|63&$l],this._pos_),this._pos_+=2):$l<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$l>>12,128|$l>>6&63,128|63&$l],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$l>>18,128|$l>>12&63,128|$l>>6&63,128|63&$l],this._pos_),this._pos_+=4)}},$j.writeUTFString=function($j){var $O=this.pos;this.writeUint16(1),this.writeUTFBytes($j);var $V=this.pos-$O-2;if(65536<=$V)throw"writeUTFString byte len more than 65536";this._d_.setUint16($O,$V,this._xd_)},$j.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$j.getUTFString=function(){return this.readUTFString()},$j.readUTFBytes=function($j){if(void 0===$j&&($j=-1),0==$j)return"";var $O=this.bytesAvailable;if($O<$j)throw"readUTFBytes error - Out of bounds";return $j=0<$j?$j:$O,this.rUTF($j)},$j.getUTFBytes=function($j){return void 0===$j&&($j=-1),this.readUTFBytes($j)},$j.writeByte=function($j){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$j),this._pos_+=1},$j.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$j.getByte=function(){return this.readByte()},$j.ensureWrite=function($j){this._length<$j&&(this._length=$j),this._allocated_<$j&&(this.length=$j)},$j.writeArrayBuffer=function($j,$O,$V){if(void 0===$O&&($O=0),void 0===$V&&($V=0),$O<0||$V<0)throw"writeArrayBuffer error - Out of bounds";0==$V&&($V=$j.byteLength-$O),this.ensureWrite(this._pos_+$V);var $l=new Uint8Array($j);this._u8d_.set($l.subarray($O,$O+$V),this._pos_),this._pos_+=$V},$g(0,$j,"buffer",function(){var $j=this._d_.buffer;return $j.byteLength==this.length?$j:$j.slice(0,this.length)}),$g(0,$j,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($j){this._xd_="littleEndian"==$j}),$g(0,$j,"length",function(){return this._length},function($j){this._allocated_<$j?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($j,2*this._allocated_))):this._allocated_>$j&&this.___resizeBuffer(this._allocated_=$j),this._length=$j}),$g(0,$j,"pos",function(){return this._pos_},function($j){this._pos_=$j}),$g(0,$j,"bytesAvailable",function(){return this._length-this._pos_}),$O.getSystemEndian=function(){if(!$O._sysEndian){var $j=new ArrayBuffer(2);new DataView($j).setInt16(0,256,!0),$O._sysEndian=256===new Int16Array($j)[0]?"littleEndian":"bigEndian"}return $O._sysEndian},$O.BIG_ENDIAN="bigEndian",$O.LITTLE_ENDIAN="littleEndian",$O._sysEndian=null,$O}(),$X=function(){function $T(){}return $b($T,"laya.utils.CacheManager"),$T.regCacheByFunction=function($j,$O){var $V;$T.unRegCacheByFunction($j,$O),$V={tryDispose:$j,getCacheList:$O},$T._cacheList.push($V)},$T.unRegCacheByFunction=function($j,$O){var $V,$l=0;for($V=$T._cacheList.length,$l=0;$l<$V;$l++)if($T._cacheList[$l].tryDispose==$j&&$T._cacheList[$l].getCacheList==$O)return void $T._cacheList.splice($l,1)},$T.forceDispose=function(){var $j=0,$O=$T._cacheList.length;for($j=0;$j<$O;$j++)$T._cacheList[$j].tryDispose(!0)},$T.beginCheck=function($j){void 0===$j&&($j=15e3),$E.timer.loop($j,null,$T._checkLoop)},$T.stopCheck=function(){$E.timer.clear(null,$T._checkLoop)},$T._checkLoop=function(){var $j=$T._cacheList;if(!($j.length<1)){var $O,$V=$F.now(),$l=0;for($O=$l=$j.length;0<$l&&($j[$T._index=++$T._index%$O].tryDispose(!1),!($F.now()-$V>$T.loopTimeLimit));)$l--}},$T.loopTimeLimit=2,$T._cacheList=[],$T._index=0,$T}(),$f=function(){function $w(){}return $b($w,"laya.utils.ClassUtils"),$w.regClass=function($j,$O){$w._classMap[$j]=$O},$w.getRegClass=function($j){return $w._classMap[$j]},$w.getInstance=function($j){var $O=$w.getClass($j);return $O?new $O:(console.warn("[error] Undefined class:",$j),null)},$w.createByJson=function($j,$O,$V,$l,$T){"string"==typeof $j&&($j=JSON.parse($j));var $S=$j.props;if(!$O&&!($O=$T?$T.runWith($j):$w.getInstance($S.runtime||$j.type)))return null;var $m=$j.child;if($m)for(var $p=0,$o=$m.length;$p<$o;$p++){var $H=$m[$p];if("render"!==$H.props.name&&"render"!==$H.props.renderType||!$O._$set_itemRender)if("Graphic"==$H.type)$w.addGraphicsToSprite($H,$O);else if($w.isDrawType($H.type))$w.addGraphicToSprite($H,$O,!0);else{var $g=$w.createByJson($H,null,$V,$l,$T);"Script"==$H.type?$g.hasOwnProperty("owner")?$g.owner=$O:$g.hasOwnProperty("target")&&($g.target=$O):"mask"==$H.props.renderType?$O.mask=$g:$O.addChild($g)}else $O.itemRender=$H}if($S)for(var $e in $S){var $t=$S[$e];"var"===$e&&$V?$V[$t]=$O:$t instanceof Array&&"function"==typeof $O[$e]?$O[$e].apply($O,$t):$O[$e]=$t}return $l&&$j.customProps&&$l.runWith([$O,$j]),$O.created&&$O.created(),$O},$w.addGraphicsToSprite=function($j,$O){var $V;if(($V=$j.child)&&!($V.length<1)){var $l;$l=$w._getGraphicsFromSprite($j,$O);var $T=0,$S=0;$j.props&&($T=$w._getObjVar($j.props,"x",0),$S=$w._getObjVar($j.props,"y",0)),0!=$T&&0!=$S&&$l.translate($T,$S);var $m,$p=0;for($m=$V.length,$p=0;$p<$m;$p++)$w._addGraphicToGraphics($V[$p],$l);0!=$T&&0!=$S&&$l.translate(-$T,-$S)}},$w.addGraphicToSprite=function($j,$O,$V){var $l;void 0===$V&&($V=!1),$l=$V?$w._getGraphicsFromSprite($j,$O):$O.graphics,$w._addGraphicToGraphics($j,$l)},$w._getGraphicsFromSprite=function($j,$O){var $V,$l;if(!$j||!$j.props)return $O.graphics;switch($l=$j.props.renderType){case"hit":case"unHit":var $T;$O.hitArea||($O.hitArea=new $y),($T=$O.hitArea)[$l]||($T[$l]=new $t),$V=$T[$l]}return $V||($V=$O.graphics),$V},$w._getTransformData=function($j){var $O;($j.hasOwnProperty("pivotX")||$j.hasOwnProperty("pivotY"))&&($O=$O||new $v).translate(-$w._getObjVar($j,"pivotX",0),-$w._getObjVar($j,"pivotY",0));var $V=$w._getObjVar($j,"scaleX",1),$l=$w._getObjVar($j,"scaleY",1),$T=$w._getObjVar($j,"rotation",0);$w._getObjVar($j,"skewX",0),$w._getObjVar($j,"skewY",0);return 1==$V&&1==$l&&0==$T||(($O=$O||new $v).scale($V,$l),$O.rotate(.0174532922222222*$T)),$O},$w._addGraphicToGraphics=function($j,$O){var $V,$l;if(($V=$j.props)&&($l=$w.DrawTypeDic[$j.type])){var $T,$S;$T=$O;var $m=$w._getParams($V,$l[1],$l[2],$l[3]);(($S=$w._tM)||1!=$w._alpha)&&($T.save(),$S&&$T.transform($S),1!=$w._alpha&&$T.alpha($w._alpha)),$T[$l[0]].apply($T,$m),($S||1!=$w._alpha)&&$T.restore()}},$w._adptLineData=function($j){return $j[2]=parseFloat($j[0])+parseFloat($j[2]),$j[3]=parseFloat($j[1])+parseFloat($j[3]),$j},$w._adptTextureData=function($j){return $j[0]=$pj.getRes($j[0]),$j},$w._adptLinesData=function($j){return $j[2]=$w._getPointListByStr($j[2]),$j},$w.isDrawType=function($j){return"Image"!=$j&&$w.DrawTypeDic.hasOwnProperty($j)},$w._getParams=function($j,$O,$V,$l){var $T;void 0===$V&&($V=0),($T=$w._temParam).length=$O.length;var $S,$m,$p=0;for($S=$O.length,$p=0;$p<$S;$p++)$T[$p]=$w._getObjVar($j,$O[$p][0],$O[$p][1]);return $w._alpha=$w._getObjVar($j,"alpha",1),$m=$w._getTransformData($j),$w._tM=$m?($V||($V=0),$m.translate($T[$V],$T[$V+1]),$T[$V]=$T[$V+1]=0,$m):null,$l&&$w[$l]&&($T=$w[$l]($T)),$T},$w._getPointListByStr=function($j){var $O,$V,$l=0;for($V=($O=$j.split(",")).length,$l=0;$l<$V;$l++)$O[$l]=parseFloat($O[$l]);return $O},$w._getObjVar=function($j,$O,$V){return $j.hasOwnProperty($O)?$j[$O]:$V},$w._temParam=[],$w._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$w.getClass=function($j){var $O=$w._classMap[$j]||$j;return"string"==typeof $O?$E.__classmap[$O]:$O},$w._tM=null,$w._alpha=NaN,$o($w,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$w}(),$C=function(){function $S($j){if(this._color=[],"string"==typeof $j){null===(this.strColor=$j)&&($j="#000000"),"#"==$j.charAt(0)&&($j=$j.substr(1));var $O=$j.length;if(3==$O||4==$O){for(var $V="",$l=0;$l<$O;$l++)$V+=$j[$l]+$j[$l];$j=$V}var $T=this.numColor=parseInt($j,16);if(8==$j.length)return void(this._color=[parseInt($j.substr(0,2),16)/255,((16711680&$T)>>16)/255,((65280&$T)>>8)/255,(255&$T)/255])}else $T=this.numColor=$j,this.strColor=$Q.toHexColor($T);this._color=[((16711680&$T)>>16)/255,((65280&$T)>>8)/255,(255&$T)/255,1],this._color.__id=++$S._COLODID}return $b($S,"laya.utils.Color"),$S._initDefault=function(){for(var $j in $S._DEFAULT={},$S._COLOR_MAP)$S._SAVE[$j]=$S._DEFAULT[$j]=new $S($S._COLOR_MAP[$j]);return $S._DEFAULT},$S._initSaveMap=function(){for(var $j in $S._SAVE_SIZE=0,$S._SAVE={},$S._DEFAULT)$S._SAVE[$j]=$S._DEFAULT[$j]},$S.create=function($j){var $O=$S._SAVE[$j+""];return null!=$O?$O:($S._SAVE_SIZE<1e3||$S._initSaveMap(),$S._SAVE[$j+""]=new $S($j))},$S._SAVE={},$S._SAVE_SIZE=0,$S._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$S._DEFAULT=$S._initDefault(),$S._COLODID=1,$S}(),$J=(function(){function $j(){this._values=[],this._keys=[]}$b($j,"laya.utils.Dictionary");var $O=$j.prototype;$O.set=function($j,$O){var $V=this.indexOf($j);0<=$V?this._values[$V]=$O:(this._keys.push($j),this._values.push($O))},$O.indexOf=function($j){var $O=this._keys.indexOf($j);return 0<=$O?$O:($j="string"==typeof $j?Number($j):"number"==typeof $j?$j.toString():$j,this._keys.indexOf($j))},$O.get=function($j){var $O=this.indexOf($j);return $O<0?null:this._values[$O]},$O.remove=function($j){var $O=this.indexOf($j);return 0<=$O&&(this._keys.splice($O,1),this._values.splice($O,1),!0)},$O.clear=function(){this._values.length=0,this._keys.length=0},$g(0,$O,"values",function(){return this._values}),$g(0,$O,"keys",function(){return this._keys})}(),function(){function $j(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$b($j,"laya.utils.Dragging");var $O=$j.prototype;return $O.start=function($j,$O,$V,$l,$T,$S,$m,$p){void 0===$p&&($p=.92),this.clearTimer(),this.target=$j,this.area=$O,this.hasInertia=$V,this.elasticDistance=$O?$l:0,this.elasticBackTime=$T,this.data=$S,this._disableMouseEvent=$m,this.ratio=$p,1!=$j.globalScaleX||1!=$j.globalScaleY?this._parent=$j.parent:this._parent=$E.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$E.stage.on("mouseup",this,this.onStageMouseUp),$E.stage.on("mouseout",this,this.onStageMouseUp),$E.timer.frameLoop(1,this,this.loop)},$O.clearTimer=function(){$E.timer.clear(this,this.loop),$E.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$O.stop=function(){this._dragging&&($s.instance.disableMouseEvent=!1,$E.stage.off("mouseup",this,this.onStageMouseUp),$E.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$O.loop=function(){var $j=this._parent.getMousePoint(),$O=$j.x,$V=$j.y,$l=$O-this._lastX,$T=$V-this._lastY;if(this._clickOnly){if(!(1<Math.abs($l*$E.stage._canvasTransform.getScaleX())||1<Math.abs($T*$E.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$s.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($l,$T);0==$l&&0==$T||(this._lastX=$O,this._lastY=$V,this.target.x+=$l*this._elasticRateX,this.target.y+=$T*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$O.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $j=this.area.x-this.target.x;else $j=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$j/this.elasticDistance),this.target.y<this.area.y)var $O=this.area.y-this.target.y;else $O=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$O/this.elasticDistance)}},$O.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$O.onStageMouseUp=function($j){if($s.instance.disableMouseEvent=!1,$E.stage.off("mouseup",this,this.onStageMouseUp),$E.stage.off("mouseout",this,this.onStageMouseUp),$E.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $O=this._offsets.length,$V=Math.min($O,6),$l=this._offsets.length-$V,$T=$O-1;$l<$T;$T--)this._offsetY+=this._offsets[$T--],this._offsetX+=this._offsets[$T];this._offsetX=this._offsetX/$V*2,this._offsetY=this._offsetY/$V*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$E.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$O.checkElastic=function(){var $j=NaN,$O=NaN;if(this.target.x<this.area.x?$j=this.area.x:this.target.x>this.area.x+this.area.width&&($j=this.area.x+this.area.width),this.target.y<this.area.y?$O=this.area.y:this.target.y>this.area.y+this.area.height&&($O=this.area.y+this.area.height),isNaN($j)&&isNaN($O))this.clear();else{var $V={};isNaN($j)||($V.x=$j),isNaN($O)||($V.y=$O),this._tween=$L.to(this.target,$V,this.elasticBackTime,$u.sineOut,$a.create(this,this.clear),0,!1,!1)}},$O.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($E.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$O.clear=function(){if(this.target){this.clearTimer();var $j=this.target;this.target=null,this._parent=null,$j.event("dragend",this.data)}},$j}()),$u=function(){function $p(){}return $b($p,"laya.utils.Ease"),$p.linearNone=function($j,$O,$V,$l){return $V*$j/$l+$O},$p.linearIn=function($j,$O,$V,$l){return $V*$j/$l+$O},$p.linearInOut=function($j,$O,$V,$l){return $V*$j/$l+$O},$p.linearOut=function($j,$O,$V,$l){return $V*$j/$l+$O},$p.bounceIn=function($j,$O,$V,$l){return $V-$p.bounceOut($l-$j,0,$V,$l)+$O},$p.bounceInOut=function($j,$O,$V,$l){return $j<.5*$l?.5*$p.bounceIn(2*$j,0,$V,$l)+$O:.5*$p.bounceOut(2*$j-$l,0,$V,$l)+.5*$V+$O},$p.bounceOut=function($j,$O,$V,$l){return($j/=$l)<1/2.75?$V*(7.5625*$j*$j)+$O:$j<2/2.75?$V*(7.5625*($j-=1.5/2.75)*$j+.75)+$O:$j<2.5/2.75?$V*(7.5625*($j-=2.25/2.75)*$j+.9375)+$O:$V*(7.5625*($j-=2.625/2.75)*$j+.984375)+$O},$p.backIn=function($j,$O,$V,$l,$T){return void 0===$T&&($T=1.70158),$V*($j/=$l)*$j*(($T+1)*$j-$T)+$O},$p.backInOut=function($j,$O,$V,$l,$T){return void 0===$T&&($T=1.70158),($j/=.5*$l)<1?.5*$V*($j*$j*((1+($T*=1.525))*$j-$T))+$O:$V/2*(($j-=2)*$j*((1+($T*=1.525))*$j+$T)+2)+$O},$p.backOut=function($j,$O,$V,$l,$T){return void 0===$T&&($T=1.70158),$V*(($j=$j/$l-1)*$j*(($T+1)*$j+$T)+1)+$O},$p.elasticIn=function($j,$O,$V,$l,$T,$S){var $m;return void 0===$T&&($T=0),void 0===$S&&($S=0),0==$j?$O:1==($j/=$l)?$O+$V:($S||($S=.3*$l),$m=!$T||0<$V&&$T<$V||$V<0&&$T<-$V?($T=$V,$S/4):$S/$p.PI2*Math.asin($V/$T),-$T*Math.pow(2,10*($j-=1))*Math.sin(($j*$l-$m)*$p.PI2/$S)+$O)},$p.elasticInOut=function($j,$O,$V,$l,$T,$S){var $m;return void 0===$T&&($T=0),void 0===$S&&($S=0),0==$j?$O:2==($j/=.5*$l)?$O+$V:($S||($S=$l*(.3*1.5)),$m=!$T||0<$V&&$T<$V||$V<0&&$T<-$V?($T=$V,$S/4):$S/$p.PI2*Math.asin($V/$T),$j<1?$T*Math.pow(2,10*($j-=1))*Math.sin(($j*$l-$m)*$p.PI2/$S)*-.5+$O:$T*Math.pow(2,-10*($j-=1))*Math.sin(($j*$l-$m)*$p.PI2/$S)*.5+$V+$O)},$p.elasticOut=function($j,$O,$V,$l,$T,$S){var $m;return void 0===$T&&($T=0),void 0===$S&&($S=0),0==$j?$O:1==($j/=$l)?$O+$V:($S||($S=.3*$l),$m=!$T||0<$V&&$T<$V||$V<0&&$T<-$V?($T=$V,$S/4):$S/$p.PI2*Math.asin($V/$T),$T*Math.pow(2,-10*$j)*Math.sin(($j*$l-$m)*$p.PI2/$S)+$V+$O)},$p.strongIn=function($j,$O,$V,$l){return $V*($j/=$l)*$j*$j*$j*$j+$O},$p.strongInOut=function($j,$O,$V,$l){return($j/=.5*$l)<1?.5*$V*$j*$j*$j*$j*$j+$O:.5*$V*(($j-=2)*$j*$j*$j*$j+2)+$O},$p.strongOut=function($j,$O,$V,$l){return $V*(($j=$j/$l-1)*$j*$j*$j*$j+1)+$O},$p.sineInOut=function($j,$O,$V,$l){return.5*-$V*(Math.cos(Math.PI*$j/$l)-1)+$O},$p.sineIn=function($j,$O,$V,$l){return-$V*Math.cos($j/$l*$p.HALF_PI)+$V+$O},$p.sineOut=function($j,$O,$V,$l){return $V*Math.sin($j/$l*$p.HALF_PI)+$O},$p.quintIn=function($j,$O,$V,$l){return $V*($j/=$l)*$j*$j*$j*$j+$O},$p.quintInOut=function($j,$O,$V,$l){return($j/=.5*$l)<1?.5*$V*$j*$j*$j*$j*$j+$O:.5*$V*(($j-=2)*$j*$j*$j*$j+2)+$O},$p.quintOut=function($j,$O,$V,$l){return $V*(($j=$j/$l-1)*$j*$j*$j*$j+1)+$O},$p.quartIn=function($j,$O,$V,$l){return $V*($j/=$l)*$j*$j*$j+$O},$p.quartInOut=function($j,$O,$V,$l){return($j/=.5*$l)<1?.5*$V*$j*$j*$j*$j+$O:.5*-$V*(($j-=2)*$j*$j*$j-2)+$O},$p.quartOut=function($j,$O,$V,$l){return-$V*(($j=$j/$l-1)*$j*$j*$j-1)+$O},$p.cubicIn=function($j,$O,$V,$l){return $V*($j/=$l)*$j*$j+$O},$p.cubicInOut=function($j,$O,$V,$l){return($j/=.5*$l)<1?.5*$V*$j*$j*$j+$O:.5*$V*(($j-=2)*$j*$j+2)+$O},$p.cubicOut=function($j,$O,$V,$l){return $V*(($j=$j/$l-1)*$j*$j+1)+$O},$p.quadIn=function($j,$O,$V,$l){return $V*($j/=$l)*$j+$O},$p.quadInOut=function($j,$O,$V,$l){return($j/=.5*$l)<1?.5*$V*$j*$j+$O:.5*-$V*(--$j*($j-2)-1)+$O},$p.quadOut=function($j,$O,$V,$l){return-$V*($j/=$l)*($j-2)+$O},$p.expoIn=function($j,$O,$V,$l){return 0==$j?$O:$V*Math.pow(2,10*($j/$l-1))+$O-.001*$V},$p.expoInOut=function($j,$O,$V,$l){return 0==$j?$O:$j==$l?$O+$V:($j/=.5*$l)<1?.5*$V*Math.pow(2,10*($j-1))+$O:.5*$V*(2-Math.pow(2,-10*--$j))+$O},$p.expoOut=function($j,$O,$V,$l){return $j==$l?$O+$V:$V*(1-Math.pow(2,-10*$j/$l))+$O},$p.circIn=function($j,$O,$V,$l){return-$V*(Math.sqrt(1-($j/=$l)*$j)-1)+$O},$p.circInOut=function($j,$O,$V,$l){return($j/=.5*$l)<1?.5*-$V*(Math.sqrt(1-$j*$j)-1)+$O:.5*$V*(Math.sqrt(1-($j-=2)*$j)+1)+$O},$p.circOut=function($j,$O,$V,$l){return $V*Math.sqrt(1-($j=$j/$l-1)*$j)+$O},$p.HALF_PI=.5*Math.PI,$p.PI2=2*Math.PI,$p}(),$y=function(){function $e(){this._hit=null,this._unHit=null}$b($e,"laya.utils.HitArea");var $j=$e.prototype;return $j.isHit=function($j,$O){return!!$e.isHitGraphic($j,$O,this.hit)&&!$e.isHitGraphic($j,$O,this.unHit)},$j.contains=function($j,$O){return this.isHit($j,$O)},$g(0,$j,"hit",function(){return this._hit||(this._hit=new $t),this._hit},function($j){this._hit=$j}),$g(0,$j,"unHit",function(){return this._unHit||(this._unHit=new $t),this._unHit},function($j){this._unHit=$j}),$e.isHitGraphic=function($j,$O,$V){if(!$V)return!1;var $l;if(!($l=$V.cmds)&&$V._one&&(($l=$e._cmds).length=1,$l[0]=$V._one),!$l)return!1;var $T,$S,$m=0;for($T=$l.length,$m=0;$m<$T;$m++)if($S=$l[$m]){var $p=$q._context;switch($S.callee){case $p._translate:case 6:$j-=$S[0],$O-=$S[1]}if($e.isHitCmd($j,$O,$S))return!0}return!1},$e.isHitCmd=function($j,$O,$V){if(!$V)return!1;var $l=$q._context,$T=!1;switch($V.callee){case $l._drawRect:case 13:$e._rec.setTo($V[0],$V[1],$V[2],$V[3]),$T=$e._rec.contains($j,$O);break;case $l._drawCircle:case $l._fillCircle:case 14:$T=($j-=$V[0])*$j+($O-=$V[1])*$O<$V[2]*$V[2];break;case $l._drawPoly:case 18:$j-=$V[0],$O-=$V[1],$T=$e.ptInPolygon($j,$O,$V[2])}return $T},$e.ptInPolygon=function($j,$O,$V){var $l;($l=$e._ptPoint).setTo($j,$O);var $T,$S=0,$m=NaN,$p=NaN,$o=NaN,$H=NaN;$T=$V.length;for(var $g=0;$g<$T;$g+=2){if($m=$V[$g],$p=$V[$g+1],$o=$V[($g+2)%$T],$p!=($H=$V[($g+3)%$T]))if(!($l.y<Math.min($p,$H)))if(!($l.y>=Math.max($p,$H)))($l.y-$p)*($o-$m)/($H-$p)+$m>$l.x&&$S++}return $S%2==1},$e._cmds=[],$o($e,["_rec",function(){return this._rec=new $z},"_ptPoint",function(){return this._ptPoint=new $U}]),$e}(),$W=(function(){function $T($j,$O,$V,$l){this.char=$j,this.charNum=$j.charCodeAt(0),this._x=this._y=0,this.width=$O,this.height=$V,this.style=$l,this.isWord=!$T._isWordRegExp.test($j)}$b($T,"laya.utils.HTMLChar");var $j=$T.prototype;$E.imps($j,{"laya.display.ILayout":!0}),$j.setSprite=function($j){this._sprite=$j},$j.getSprite=function(){return this._sprite},$j._isChar=function(){return!0},$j._getCSSStyle=function(){return this.style},$g(0,$j,"width",function(){return this._w},function($j){this._w=$j}),$g(0,$j,"x",function(){return this._x},function($j){this._sprite&&(this._sprite.x=$j),this._x=$j}),$g(0,$j,"y",function(){return this._y},function($j){this._sprite&&(this._sprite.y=$j),this._y=$j}),$g(0,$j,"height",function(){return this._h},function($j){this._h=$j}),$T._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $O(){}$b($O,"laya.utils.Log"),$O.enable=function(){$O._logdiv||($O._logdiv=$F.window.document.createElement("div"),$F.window.document.body.appendChild($O._logdiv),$O._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$O.toggle=function(){var $j=$O._logdiv.style;"1px"==$j.width?$j.width=$j.height="50%":$j.width=$j.height="1px"},$O.print=function($j){$O._logdiv&&($O.maxCount<=$O._count&&$O.clear(),$O._count++,$O._logdiv.innerText+=$j+"\n",$O._logdiv.scrollTop=$O._logdiv.scrollHeight)},$O.clear=function(){$O._logdiv.innerText="",$O._count=0},$O._logdiv=null,$O._count=0,$O.maxCount=20}(),function(){function $O(){}$b($O,"laya.utils.Mouse"),$g(1,$O,"cursor",function(){return $O._style.cursor},function($j){$O._style.cursor=$j}),$O.hide=function(){"none"!=$O.cursor&&($O._preCursor=$O.cursor,$O.cursor="none")},$O.show=function(){"none"==$O.cursor&&($O.cursor=$O._preCursor?$O._preCursor:"auto")},$O._preCursor=null,$o($O,["_style",function(){return this._style=$F.document.body.style}])}(),function(){function $S(){}return $b($S,"laya.utils.Pool"),$S.getPoolBySign=function($j){return $S._poolDic[$j]||($S._poolDic[$j]=[])},$S.clearBySign=function($j){$S._poolDic[$j]&&($S._poolDic[$j].length=0)},$S.recover=function($j,$O){$O.__InPool||($O.__InPool=!0,$S.getPoolBySign($j).push($O))},$S.getItemByClass=function($j,$O){var $V=$S.getPoolBySign($j),$l=$V.length?$V.pop():new $O;return $l.__InPool=!1,$l},$S.getItemByCreateFun=function($j,$O,$V){var $l=$S.getPoolBySign($j),$T=$l.length?$l.pop():$O.call($V);return $T.__InPool=!1,$T},$S.getItem=function($j){var $O=$S.getPoolBySign($j),$V=$O.length?$O.pop():null;return $V&&($V.__InPool=!1),$V},$S._poolDic={},$S.InPoolSign="__InPool",$S}()),$K=function(){function $o(){}return $b($o,"laya.utils.Stat"),$g(1,$o,"onclick",null,function($j){$o._sp&&$o._sp.on("click",$o._sp,$j),$o._canvas&&($o._canvas.source.onclick=$j,$o._canvas.source.style.pointerEvents="")}),$o.show=function($j,$O,$V){if(void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),!$q.isConchApp||$q.isConchWebGL){if($q.isConchWebGL||$F.onMiniGame||$F.onLimixiu||($o._useCanvas=!0),$o._show=!0,$o._fpsData.length=60,$o._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$o._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$o._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$o._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$q.isWebGL)if($o._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$q.is3DMode){if($o._view[0].title="FPS(3D)",$o._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$o._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$o._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$V){var $l=8;$o._view[$l++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$o._view[$l++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$o._view[$l++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$V){$l=8;$o._view[$l++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$o._view[$l++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$o._view[$l++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$o._view[$l++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$o._view[$l++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$o._view[$l++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$o._view[$l++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $o._view[0].title="FPS(WebGL)",$o._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $o._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$o._useCanvas?$o.createUIPre($j,$O):$o.createUI($j,$O),$o.enable()}else $F.window.conch.showFPS&&$F.window.conch.showFPS($j,$O)},$o.createUIPre=function($j,$O){var $V=$F.pixelRatio;$o._width=170*$V,$o._vx=75*$V,$o._height=$V*(12*$o._view.length+3*$V)+4,$o._fontSize=12*$V;for(var $l=0;$l<$o._view.length;$l++)$o._view[$l].x=4,$o._view[$l].y=$l*$o._fontSize+2*$V;$o._canvas||(($o._canvas=new $cj("2D")).size($o._width,$o._height),($o._ctx=$o._canvas.getContext("2d")).textBaseline="top",$o._ctx.font=$o._fontSize+"px Sans-serif",$o._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$j+"px;top:"+$O+"px;width:"+$o._width/$V+"px;height:"+$o._height/$V+"px;"),$o._first=!0,$o.loop(),$o._first=!1,$F.container.appendChild($o._canvas.source)},$o.createUI=function($j,$O){var $V=$o._sp,$l=$F.pixelRatio;$V||($V=new $ej,($o._leftText=new $rj).pos(5,5),$o._leftText.color="#ffffff",$V.addChild($o._leftText),($o._txt=new $rj).pos(80*$l,5),$o._txt.color="#ffffff",$V.addChild($o._txt),$o._sp=$V),$V.pos($j,$O);for(var $T="",$S=0;$S<$o._view.length;$S++){$T+=$o._view[$S].title+"\n"}$o._leftText.text=$T;var $m=170*$l,$p=$l*(12*$o._view.length+3*$l)+4;$o._txt.fontSize=$o._fontSize*$l,$o._leftText.fontSize=$o._fontSize*$l,$V.size($m,$p),$V.graphics.clear(),$V.graphics.setAlpha(.5),$V.graphics.drawRect(0,0,$m,$p,"#999999"),$V.graphics.setAlpha(1),$o.loop()},$o.enable=function(){$E.timer.frameLoop(1,$o,$o.loop)},$o.hide=function(){$o._show=!1,$E.timer.clear($o,$o.loop),$o._canvas&&$F.removeElement($o._canvas.source)},$o.clear=function(){$o.trianglesFaces=$o.drawCall=$o.shaderCall=$o.spriteCount=$o.spriteRenderUseCacheCount=$o.treeNodeCollision=$o.treeSpriteCollision=$o.canvasNormal=$o.canvasBitmap=$o.canvasReCache=0},$o.loop=function(){$o._count++;var $j=$F.now();if(!($j-$o._timer<1e3)){var $O=$o._count;if($o.FPS=Math.round(1e3*$O/($j-$o._timer)),$o._show){$o.trianglesFaces=Math.round($o.trianglesFaces/$O),$o.spriteCount=$o._useCanvas?($o.drawCall=Math.round($o.drawCall/$O)-2,$o.shaderCall=Math.round($o.shaderCall/$O),Math.round($o.spriteCount/$O)-1):($o.drawCall=Math.round($o.drawCall/$O)-2,$o.shaderCall=Math.round($o.shaderCall/$O)-4,Math.round($o.spriteCount/$O)-4),$o.spriteRenderUseCacheCount=Math.round($o.spriteRenderUseCacheCount/$O),$o.canvasNormal=Math.round($o.canvasNormal/$O),$o.canvasBitmap=Math.round($o.canvasBitmap/$O),$o.canvasReCache=Math.ceil($o.canvasReCache/$O),$o.treeNodeCollision=Math.round($o.treeNodeCollision/$O),$o.treeSpriteCollision=Math.round($o.treeSpriteCollision/$O);var $V=0<$o.FPS?Math.floor(1e3/$o.FPS).toString():" ";$o._fpsStr=$o.FPS+($o.renderSlow?" slow":"")+" "+$V,$o._spriteStr=$o.spriteCount+($o.spriteRenderUseCacheCount?"/"+$o.spriteRenderUseCacheCount:""),$o._canvasStr=$o.canvasReCache+"/"+$o.canvasNormal+"/"+$o.canvasBitmap,$o.currentMemorySize=$G.systemResourceManager.memorySize,$o._useCanvas?$o.renderInfoPre():$o.renderInfo(),$o.clear()}$o._count=0,$o._timer=$j}},$o.renderInfoPre=function(){if($o._canvas){var $j=$o._ctx;$j.clearRect($o._first?0:$o._vx,0,$o._width,$o._height);for(var $O=$q.WebGL.mainContext,$V=0;$V<$o._view.length;$V++){var $l=$o._view[$V];$o._first&&($j.fillStyle="white",$j.fillText($l.title,$l.x,$l.y,null,null,null)),$j.fillStyle=$l.color;var $T=-1;if(($l=$o._view[$V]).varying){if($O)switch($l.varying){case 1:$T=$O.getParameter($O[$l.value]);break;case 2:$T=$O.getExtension($l.value)}}else $T=$o[$l.value];"M"==$l.units&&($T=Math.floor($T/1048576*100)/100+" M"),"K"==$l.units&&($T=Math.floor($T/1024*100)/100+" K"),"string"==$l.units&&($T=$T.match(/\d+\.?\d/i)),$j.fillText($T+"",$l.x+$o._vx,$l.y,null,null,null)}}},$o.renderInfo=function(){for(var $j="",$O=$q.WebGL.mainContext,$V=0;$V<$o._view.length;$V++){var $l=$o._view[$V],$T=-1;if($l.varying){if($O)switch($l.varying){case 1:$T=$O.getParameter($O[$l.value]);break;case 2:$T=$O.getExtension($l.value)}}else $T=$o[$l.value];"M"==$l.units&&($T=Math.floor($T/1048576*100)/100+" M"),"K"==$l.units&&($T=Math.floor($T/1024*100)/100+" K"),"string"==$l.units&&($T=$T.match(/\d+\.?\d/i)),$j+=$T+"\n"}$o._txt.text=$j},$o.FPS=0,$o.loopCount=0,$o.shaderCall=0,$o.drawCall=0,$o.trianglesFaces=0,$o.spriteCount=0,$o.spriteRenderUseCacheCount=0,$o.treeNodeCollision=0,$o.treeSpriteCollision=0,$o.canvasNormal=0,$o.canvasBitmap=0,$o.canvasReCache=0,$o.renderSlow=!1,$o.currentMemorySize=0,$o._fpsStr=null,$o._canvasStr=null,$o._spriteStr=null,$o._fpsData=[],$o._timer=0,$o._count=0,$o._view=[],$o._fontSize=12,$o._txt=null,$o._leftText=null,$o._sp=null,$o._show=!1,$o._useCanvas=!1,$o._canvas=null,$o._ctx=null,$o._first=!1,$o._vx=NaN,$o._width=0,$o._height=100,$o}(),$d=(function(){function $j(){this._strsToID={},this._idToStrs=[],this._length=0}$b($j,"laya.utils.StringKey");var $O=$j.prototype;$O.add=function($j){var $O=this._strsToID[$j];return null!=$O?$O:(this._idToStrs[this._length]=$j,this._strsToID[$j]=this._length++)},$O.getID=function($j){var $O=this._strsToID[$j];return null==$O?-1:$O},$O.getName=function($j){var $O=this._idToStrs[$j];return null==$O?void 0:$O}}(),function(){var $H;function $j(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$b($j,"laya.utils.Timer");var $O=$j.prototype;return $O._init=function(){$E.timer&&$E.timer.frameLoop(1,this,this._update)},$O._now=function(){return Date.now()},$O._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $j=this.currFrame=this.currFrame+this.scale,$O=this._now();this._delta=($O-this._lastTimer)*this.scale;var $V=this.currTimer=this.currTimer+this._delta;$E.isDebug&&6e4<Math.abs($O-this._lastTimer)&&console.error("系统时间错误！"+($O-this._lastTimer)),this._lastTimer=$O;var $l=this._handlers;for($m=this._count=0,$p=$l.length;$m<$p;$m++)if(null!==($o=$l[$m]).method){var $T=$o.userFrame?$j:$V;if($T>=$o.exeTime)if($o.repeat)if($o.jumpFrame)for(;$T>=$o.exeTime;)$o.exeTime+=$o.delay,$o.run(!1);else $o.exeTime+=$o.delay,$o.run(!1),$T>$o.exeTime&&($o.exeTime+=Math.ceil(($T-$o.exeTime)/$o.delay)*$o.delay);else $o.run(!0)}else this._count++;(30<this._count||$j%200==0)&&this._clearHandlers();for(var $S=this._laters,$m=0,$p=$S.length-1;$m<=$p;$m++){var $o=$S[$m];this._isIgnoreRecover($o)||(null!==$o.method&&(delete this._map[$o.key],$o.run(!1)),this._recoverHandler($o)),$m===$p&&($p=$S.length-1)}$S.length=0}},$O._clearHandlers=function(){for(var $j=this._handlers,$O=0,$V=$j.length;$O<$V;$O++){var $l=$j[$O];null!==$l.method?this._temp.push($l):this._isIgnoreRecover($l)?this._temp.push($l):this._recoverHandler($l)}this._handlers=this._temp,this._temp=$j,this._temp.length=0},$O._recoverHandler=function($j){this._map[$j.key]==$j&&delete this._map[$j.key],$j.recover()},$O._create=function($j,$O,$V,$l,$T,$S,$m,$p){if(!$V)return $T.apply($l,$S),null;if($m){var $o=this._getHandler($l,$T);if($o)return $o.repeat=$O,$o.userFrame=$j,$o.delay=$V,$o.ignoreRecover=$p,$o.caller=$l,$o.method=$T,$o.args=$S,$o.exeTime=$V+($j?this.currFrame:this.currTimer+this._now()-this._lastTimer),$o}return($o=$H.create()).repeat=$O,$o.userFrame=$j,$o.delay=$V,$o.ignoreRecover=$p,$o.caller=$l,$o.method=$T,$o.args=$S,$o.exeTime=$V+($j?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($o),this._handlers.push($o),$o},$O._indexHandler=function($j){var $O=$j.caller,$V=$j.method,$l=$O?$O.$_GID||($O.$_GID=$Q.getGID()):0,$T=$V.$_TID||($V.$_TID=this._mid++);$j.key=$l+"_"+$T,this._map[$j.key]=$j},$O.once=function($j,$O,$V,$l,$T){void 0===$T&&($T=!0),this._create(!1,!1,$j,$O,$V,$l,$T,!1)},$O.loop=function($j,$O,$V,$l,$T,$S,$m){void 0===$T&&($T=!0),void 0===$S&&($S=!1),void 0===$m&&($m=!1);var $p=this._create(!1,!0,$j,$O,$V,$l,$T,$m);$p&&($p.jumpFrame=$S)},$O.frameOnce=function($j,$O,$V,$l,$T){void 0===$T&&($T=!0),this._create(!0,!1,$j,$O,$V,$l,$T,!1)},$O.frameLoop=function($j,$O,$V,$l,$T,$S){void 0===$T&&($T=!0),void 0===$S&&($S=!1),this._create(!0,!0,$j,$O,$V,$l,$T,$S)},$O.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$H._freeCount},$O.clear=function($j,$O){var $V=this._getHandler($j,$O);return!(!$V||this._isIgnoreRecover($V))&&(delete this._map[$V.key],$V.key=null,$V.clear(),!0)},$O.clearAll=function($j){if($j)for(var $O=0,$V=this._handlers.length;$O<$V;$O++){var $l=this._handlers[$O];$l.caller===$j&&(this._isIgnoreRecover($l)||(delete this._map[$l.key],$l.key=null,$l.clear()))}},$O._getHandler=function($j,$O){var $V=$j?$j.$_GID||($j.$_GID=$Q.getGID()):0,$l=$O.$_TID||($O.$_TID=this._mid++);return this._map[$V+"_"+$l]},$O._isIgnoreRecover=function($j){if($j.ignoreRecover||$j.caller&&"IgnoreRecover"==$j.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $O="";try{arguments.propertyIsEnumerable.caller}catch($j){$O=$j.stack}$E.recordError("报错：核心定时器销毁忽略  "+$O)}return!0}return!1},$O.hasHandler=function($j,$O){return this._map[$j.$_GID+"_"+$O.$_TID]},$O.callLater=function($j,$O,$V){if(null==this._getHandler($j,$O)){var $l=$H.create();$l.caller=$j,$l.method=$O,$l.args=$V,this._indexHandler($l),this._laters.push($l)}},$O.runCallLater=function($j,$O){var $V=this._getHandler($j,$O);$V&&null!=$V.method&&(this._isIgnoreRecover($V)||(delete this._map[$V.key],$V.run(!0)))},$O.runTimer=function($j,$O){this.runCallLater($j,$O)},$g(0,$O,"delta",function(){return this._delta}),$j.__init$=function(){$H=function(){function $O(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$b($O,"");var $j=$O.prototype;return $j.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$j.recover=function(){this.clear(),this.args=$O._freeHandler,$O._freeHandler=this,$O._freeCount++},$j.run=function($j){var $O=this.caller;if($O&&$O.destroyed)return this.clear();var $V=this.method,$l=this.args;$j&&this.clear(),null!=$V&&($l?$V.apply($O,$l):$V.call($O))},$O._freeHandler=null,$O._freeCount=0,$O.create=function(){var $j=$O._freeHandler;return $j?($O._freeHandler=$j.args,--$O._freeCount,$j.args=null,$j):new $O},$O}()},$j}()),$L=function(){function $e(){this.gid=0}$b($e,"laya.utils.Tween");var $j=$e.prototype;return $j.to=function($j,$O,$V,$l,$T,$S,$m){return void 0===$S&&($S=0),void 0===$m&&($m=!1),this._create($j,$O,$V,$l,$T,$S,$m,!0,!1,!0)},$j.from=function($j,$O,$V,$l,$T,$S,$m){return void 0===$S&&($S=0),void 0===$m&&($m=!1),this._create($j,$O,$V,$l,$T,$S,$m,!1,!1,!0)},$j._create=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){if(!$j)throw new Error("Tween:target is null");this._target=$j,this._duration=$V,this._ease=$l||$O.ease||$e.easeNone,this._complete=$T||$O.complete,this._delay=$S,this._props=[],this._usedTimer=0,this._startTimer=$F.now(),this._usedPool=$o,this._delayParam=null,this.update=$O.update;var $g=$j.$_GID||($j.$_GID=$Q.getGID());return $e.tweenMap[$g]?($m&&$e.clearTween($j),$e.tweenMap[$g].push(this)):$e.tweenMap[$g]=[this],$H?$S<=0?this.firstStart($j,$O,$p):(this._delayParam=[$j,$O,$p],$E.scaleTimer.once($S,this,this.firstStart,this._delayParam)):this._initProps($j,$O,$p),this},$j.firstStart=function($j,$O,$V){this._delayParam=null,$j.destroyed?this.clear():(this._initProps($j,$O,$V),this._beginLoop())},$j._initProps=function($j,$O,$V){for(var $l in $O)if("number"==typeof $j[$l]){var $T=$V?$j[$l]:$O[$l],$S=$V?$O[$l]:$j[$l];this._props.push([$l,$T,$S-$T]),$V||($j[$l]=$T)}},$j._beginLoop=function(){$E.scaleTimer.frameLoop(1,this,this._doEase)},$j._doEase=function(){this._updateEase($F.now())},$j._updateEase=function($j){var $O=this._target;if($O){if($O.destroyed)return $e.clearTween($O);var $V=this._usedTimer=$j-this._startTimer-this._delay;if(!($V<0)){if($V>=this._duration)return this.complete();for(var $l=0<$V?this._ease($V,0,1,this._duration):0,$T=this._props,$S=0,$m=$T.length;$S<$m;$S++){var $p=$T[$S];$O[$p[0]]=$p[1]+$l*$p[2]}this.update&&this.update.run()}}},$j.complete=function(){if(this._target){$E.scaleTimer.runTimer(this,this.firstStart);for(var $j=this._target,$O=this._props,$V=this._complete,$l=0,$T=$O.length;$l<$T;$l++){var $S=$O[$l];$j[$S[0]]=$S[1]+$S[2]}this.update&&this.update.run(),this.clear(),$V&&$V.run()}},$j.pause=function(){$E.scaleTimer.clear(this,this._beginLoop),$E.scaleTimer.clear(this,this._doEase),$E.scaleTimer.clear(this,this.firstStart);var $j;($j=$F.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$j)},$j.setStartTime=function($j){this._startTimer=$j},$j.clear=function(){this._target&&(this._remove(),this._clear())},$j._clear=function(){this.pause(),$E.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$W.recover("tween",this))},$j.recover=function(){this._usedPool=!0,this._clear()},$j._remove=function(){var $j=$e.tweenMap[this._target.$_GID];if($j)for(var $O=0,$V=$j.length;$O<$V;$O++)if($j[$O]===this){$j.splice($O,1);break}},$j.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$F.now(),this._delayParam)$E.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $j=this._props,$O=0,$V=$j.length;$O<$V;$O++){var $l=$j[$O];this._target[$l[0]]=$l[1]}$E.scaleTimer.once(this._delay,this,this._beginLoop)}},$j.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$F.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$E.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$g(0,$j,"progress",null,function($j){var $O=$j*this._duration;this._startTimer=$F.now()-this._delay-$O}),$e.to=function($j,$O,$V,$l,$T,$S,$m,$p){return void 0===$S&&($S=0),void 0===$m&&($m=!1),void 0===$p&&($p=!0),$W.getItemByClass("tween",$e)._create($j,$O,$V,$l,$T,$S,$m,!0,$p,!0)},$e.from=function($j,$O,$V,$l,$T,$S,$m,$p){return void 0===$S&&($S=0),void 0===$m&&($m=!1),void 0===$p&&($p=!0),$W.getItemByClass("tween",$e)._create($j,$O,$V,$l,$T,$S,$m,!1,$p,!0)},$e.clearAll=function($j){if($j&&$j.$_GID){var $O=$e.tweenMap[$j.$_GID];if($O){for(var $V=0,$l=$O.length;$V<$l;$V++)$O[$V]._clear();$O.length=0}}},$e.clear=function($j){$j.clear()},$e.clearTween=function($j){$e.clearAll($j)},$e.easeNone=function($j,$O,$V,$l){return $V*$j/$l+$O},$e.tweenMap={},$e}(),$Q=function(){function $p(){}return $b($p,"laya.utils.Utils"),$p.toRadian=function($j){return $j*$p._pi2},$p.toAngle=function($j){return $j*$p._pi},$p.toHexColor=function($j){if($j<0||isNaN($j))return null;for(var $O=$j.toString(16);$O.length<6;)$O="0"+$O;return"#"+$O},$p.getGID=function(){return $p._gid++},$p.concatArray=function($j,$O){if(!$O)return $j;if(!$j)return $O;var $V=0,$l=$O.length;for($V=0;$V<$l;$V++)$j.push($O[$V]);return $j},$p.clearArray=function($j){return $j&&($j.length=0),$j},$p.copyArray=function($j,$O){if($j||($j=[]),!$O)return $j;$j.length=$O.length;var $V=0,$l=$O.length;for($V=0;$V<$l;$V++)$j[$V]=$O[$V];return $j},$p.getGlobalRecByPoints=function($j,$O,$V,$l,$T){var $S,$m;return $S=new $U($O,$V),$S=$j.localToGlobal($S),$m=new $U($l,$T),$m=$j.localToGlobal($m),$z._getWrapRec([$S.x,$S.y,$m.x,$m.y])},$p.getGlobalPosAndScale=function($j){return $p.getGlobalRecByPoints($j,0,0,1,1)},$p.bind=function($j,$O){return $j.bind($O)},$p.measureText=function($j,$O){return $M.measureText($j,$O)},$p.contextMeasureText=function($j){var $O=$F.context.measureText($j);return $O||($O={width:16,height:16}),$O},$p.updateOrder=function($j){if(!$j||$j.length<2)return!1;for(var $O,$V=1,$l=0,$T=$j.length,$S=NaN;$V<$T;){for($O=$j[$l=$V],$S=$j[$l]._zOrder;-1<--$l&&$j[$l]._zOrder>$S;)$j[$l+1]=$j[$l];$j[$l+1]=$O,$V++}var $m=$O.parent.conchModel;if($m)if(null!=$m.updateZOrder)$m.updateZOrder();else{for($V=0;$V<$T;$V++)$m.removeChild($j[$V].conchModel);for($V=0;$V<$T;$V++)$m.addChildAt($j[$V].conchModel,$V)}return!0},$p.transPointList=function($j,$O,$V){var $l=0,$T=$j.length;for($l=0;$l<$T;$l+=2)$j[$l]+=$O,$j[$l+1]+=$V},$p.parseInt=function($j,$O){void 0===$O&&($O=0);var $V=$F.window.parseInt($j,$O);return isNaN($V)?0:$V},$p.getFileExtension=function($j){$p._extReg.lastIndex=$j.lastIndexOf(".");var $O=$p._extReg.exec($j);return $O&&1<$O.length?$O[1].toLowerCase():null},$p.getTransformRelativeToWindow=function($j,$O,$V){var $l=$E.stage,$T=laya.utils.Utils.getGlobalPosAndScale($j),$S=$l._canvasTransform.clone(),$m=$S.tx,$p=$S.ty;$S.rotate(-Math.PI/180*$E.stage.canvasDegree),$S.scale($E.stage.clientScaleX,$E.stage.clientScaleY);var $o=$E.stage.canvasDegree%180!=0,$H=NaN,$g=NaN;$o?($H=$V+$T.y,$g=$O+$T.x,$H*=$S.d,$g*=$S.a,90==$E.stage.canvasDegree?($H=$m-$H,$g+=$p):($H+=$m,$g=$p-$g)):($H=$O+$T.x,$g=$V+$T.y,$H*=$S.a,$g*=$S.d,$H+=$m,$g+=$p);var $e=NaN,$t=NaN;return $t=$o?($e=$S.d*$T.height,$S.a*$T.width):($e=$S.a*$T.width,$S.d*$T.height),{x:$H,y:$g,scaleX:$e,scaleY:$t}},$p.fitDOMElementInArea=function($j,$O,$V,$l,$T,$S){$j._fitLayaAirInitialized||($j._fitLayaAirInitialized=!0,$j.style.transformOrigin=$j.style.webKittransformOrigin="left top",$j.style.position="absolute");var $m=$p.getTransformRelativeToWindow($O,$V,$l);$j.style.transform=$j.style.webkitTransform="scale("+$m.scaleX+","+$m.scaleY+") rotate("+$E.stage.canvasDegree+"deg)",$j.style.width=$T+"px",$j.style.height=$S+"px",$j.style.left=$m.x+"px",$j.style.top=$m.y+"px"},$p.isOkTextureList=function($j){if(!$j)return!1;var $O,$V=0,$l=$j.length;for($V=0;$V<$l;$V++)if(!($O=$j[$V])||!$O.source)return!1;return!0},$p.isOKCmdList=function($j){if(!$j)return!1;var $O,$V,$l=0,$T=$j.length,$S=$q._context;for($l=0;$l<$T;$l++)switch(($O=$j[$l]).callee){case $S._drawTexture:case $S._fillTexture:case $S._drawTextureWithTransform:if(!($V=$O[0])||!$V.source)return!1}return!0},$p._gid=1,$p._pi=180/Math.PI,$p._pi2=Math.PI/180,$p._extReg=/\.(\w+)\??/g,$p.parseXMLFromString=function($j){var $O;if($j=$j.replace(/>\s+</g,"><"),-1<($O=(new DOMParser).parseFromString($j,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($O.firstChild.firstChild.textContent);return $O},$p}(),$D=function(){function $j(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$q.isWebGL&&$X.regCacheByFunction($Q.bind(this.startDispose,this),$Q.bind(this.getCacheList,this))}$b($j,"laya.utils.VectorGraphManager");var $O=$j.prototype;return $O.getId=function(){return this._id++},$O.addShape=function($j,$O){this.shapeDic[$j]=$O,this.useDic[$j]||(this.useDic[$j]=!0)},$O.addLine=function($j,$O){this.shapeLineDic[$j]=$O,this.shapeLineDic[$j]||(this.shapeLineDic[$j]=!0)},$O.getShape=function($j){this._checkKey&&null!=this.useDic[$j]&&(this.useDic[$j]=!0)},$O.deleteShape=function($j){this.shapeDic[$j]&&(this.shapeDic[$j]=null,delete this.shapeDic[$j]),this.shapeLineDic[$j]&&(this.shapeLineDic[$j]=null,delete this.shapeLineDic[$j]),null!=this.useDic[$j]&&delete this.useDic[$j]},$O.getCacheList=function(){var $j,$O=[];for($j in this.shapeDic)$O.push(this.shapeDic[$j]);for($j in this.shapeLineDic)$O.push(this.shapeLineDic[$j]);return $O},$O.startDispose=function($j){var $O;for($O in this.useDic)this.useDic[$O]=!1;this._checkKey=!0},$O.endDispose=function(){if(this._checkKey){var $j;for($j in this.useDic)this.useDic[$j]||this.deleteShape($j);this._checkKey=!1}},$j.getInstance=function(){return $j.instance=$j.instance||new $j},$j.instance=null,$j}(),$I=function(){function $l(){this._obj=null,this._obj=$l.supportWeakMap?new $F.window.WeakMap:{},$l.supportWeakMap||$l._maps.push(this)}$b($l,"laya.utils.WeakObject");var $j=$l.prototype;return $j.set=function($j,$O){if(null!=$j)if($l.supportWeakMap){var $V=$j;"string"!=typeof $j&&"number"!=typeof $j||($V=$l._keys[$j])||($V=$l._keys[$j]={k:$j}),this._obj.set($V,$O)}else"string"==typeof $j||"number"==typeof $j?this._obj[$j]=$O:($j.$_GID||($j.$_GID=$Q.getGID()),this._obj[$j.$_GID]=$O)},$j.get=function($j){if(null==$j)return null;if($l.supportWeakMap){var $O="string"==typeof $j||"number"==typeof $j?$l._keys[$j]:$j;return $O?this._obj.get($O):null}return"string"==typeof $j||"number"==typeof $j?this._obj[$j]:this._obj[$j.$_GID]},$j.del=function($j){if(null!=$j)if($l.supportWeakMap){var $O="string"==typeof $j||"number"==typeof $j?$l._keys[$j]:$j;if(!$O)return;this._obj.delete($O)}else"string"==typeof $j||"number"==typeof $j?delete this._obj[$j]:delete this._obj[this._obj.$_GID]},$j.has=function($j){if(null==$j)return!1;if($l.supportWeakMap){var $O="string"==typeof $j||"number"==typeof $j?$l._keys[$j]:$j;return this._obj.has($O)}return"string"==typeof $j||"number"==typeof $j?null!=this._obj[$j]:null!=this._obj[this._obj.$_GID]},$l.__init__=function(){($l.supportWeakMap=null!=$F.window.WeakMap)||$E.timer.loop($l.delInterval,null,$l.clearCache)},$l.clearCache=function(){for(var $j=0,$O=$l._maps.length;$j<$O;$j++){$l._maps[$j]._obj={}}},$l.supportWeakMap=!1,$l.delInterval=3e5,$l._keys={},$l._maps=[],$o($l,["I",function(){return this.I=new $l}]),$l}(),$P=function(){function $j(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$b($j,"laya.utils.WordText");var $O=$j.prototype;return $O.setText=function($j){this.changed=!0,this._text=$j},$O.toString=function(){return this._text},$O.charCodeAt=function($j){return this._text?this._text.charCodeAt($j):NaN},$O.charAt=function($j){return this._text?this._text.charAt($j):null},$g(0,$O,"length",function(){return this._text?this._text.length:0}),$j}(),$jj=function($j){function $m(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$m.__super.call(this),this._childs=$m.ARRAY_EMPTY,this._$P=$m.PROP_EMPTY,this.timer=$E.scaleTimer,this.conchModel=$q.isConchNode?this.createConchModel():null}$b($m,"laya.display.Node",$H);var $O=$m.prototype;return $O._setBit=function($j,$O){1==$j&&(this._getBit($j)!=$O&&this._updateDisplayedInstage());$O?this._bits|=$j:this._bits&=~$j},$O._getBit=function($j){return 0!=(this._bits&$j)},$O._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$O._setUpNoticeType=function($j){var $O=this;for($O._setBit($j,!0),$O=$O.parent;$O;){if($O._getBit($j))return;$O._setBit($j,!0),$O=$O.parent}},$O.on=function($j,$O,$V,$l){return"display"!==$j&&"undisplay"!==$j||this._getBit(1)||this._setUpNoticeType(1),this._createListener($j,$O,$V,$l,!1)},$O.once=function($j,$O,$V,$l){return"display"!==$j&&"undisplay"!==$j||this._getBit(1)||this._setUpNoticeType(1),this._createListener($j,$O,$V,$l,!0)},$O.createConchModel=function(){return null},$O.destroy=function($j){void 0===$j&&($j=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($j?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$O.destroyChildren=function(){if(this._childs)for(var $j=this._childs.length-1;-1<$j;$j--)this._childs[$j].destroy(!0)},$O.addChild=function($j){if(!$j||this.destroyed||$j===this)return $j;if($j.zOrder&&this._set$P("hasZorder",!0),$j._parent===this){var $O=this.getChildIndex($j);$O!==this._childs.length-1&&(this._childs.splice($O,1),this._childs.push($j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,this._childs.length-1)),this._childChanged())}else $j.parent&&$j.parent.removeChild($j),this._childs===$m.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($j),this.conchModel&&this.conchModel.addChildAt($j.conchModel,this._childs.length-1),($j.parent=this)._childChanged();return $j},$O.addChildren=function($j){for(var $O=arguments,$V=0,$l=$O.length;$V<$l;)this.addChild($O[$V++])},$O.addChildAt=function($j,$O){if(!$j||this.destroyed||$j===this)return $j;if($j.zOrder&&this._set$P("hasZorder",!0),0<=$O&&$O<=this._childs.length){if($j._parent===this){var $V=this.getChildIndex($j);this._childs.splice($V,1),this._childs.splice($O,0,$j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,$O)),this._childChanged()}else $j.parent&&$j.parent.removeChild($j),this._childs===$m.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($O,0,$j),this.conchModel&&this.conchModel.addChildAt($j.conchModel,$O),$j.parent=this;return $j}throw new Error("appendChildAt:The index is out of bounds")},$O.getChildIndex=function($j){return this._childs.indexOf($j)},$O.getChildByName=function($j){var $O=this._childs;if($O)for(var $V=0,$l=$O.length;$V<$l;$V++){var $T=$O[$V];if($T.name===$j)return $T}return null},$O._get$P=function($j){return this._$P[$j]},$O._set$P=function($j,$O){return this.destroyed||(this._$P===$m.PROP_EMPTY&&(this._$P={}),this._$P[$j]=$O),$O},$O.getChildAt=function($j){return this._childs[$j]},$O.setChildIndex=function($j,$O){var $V=this._childs;if($O<0||$O>=$V.length)throw new Error("setChildIndex:The index is out of bounds.");var $l=this.getChildIndex($j);if($l<0)throw new Error("setChildIndex:node is must child of this object.");return $V.splice($l,1),$V.splice($O,0,$j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,$O)),this._childChanged(),$j},$O._childChanged=function($j){},$O.removeChild=function($j){if(!this._childs)return $j;var $O=this._childs.indexOf($j);return this.removeChildAt($O)},$O.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$O.removeChildByName=function($j){var $O=this.getChildByName($j);return $O&&this.removeChild($O),$O},$O.removeChildAt=function($j){var $O=this.getChildAt($j);if($O){for(var $V=this._childs.length-1,$l=$j;$l<$V;++$l)this._childs[$l]=this._childs[$l+1];this._childs.length=$V,this.conchModel&&this.conchModel.removeChild($O.conchModel),$O.parent=null}return $O},$O.removeChildren=function($j,$O){if(void 0===$j&&($j=0),void 0===$O&&($O=2147483647),this._childs&&0<this._childs.length){var $V=this._childs;if(0===$j&&$S<=$O){var $l=$V;this._childs=$m.ARRAY_EMPTY}else $l=$V.splice($j,$O-$j);for(var $T=0,$S=$l.length;$T<$S;$T++)$l[$T].parent=null,this.conchModel&&this.conchModel.removeChild($l[$T].conchModel)}return this},$O.replaceChild=function($j,$O){var $V=this._childs.indexOf($O);return-1<$V?(this._childs.splice($V,1,$j),this.conchModel&&(this.conchModel.removeChild($O.conchModel),this.conchModel.addChildAt($j.conchModel,$V)),$O.parent=null,$j.parent=this,$j):null},$O._updateDisplayedInstage=function(){var $j;$j=this;var $O=$E.stage;for(this._displayedInStage=!1;$j;){if($j._getBit(1)){this._displayedInStage=$j._displayedInStage;break}if($j==$O||$j._displayedInStage){this._displayedInStage=!0;break}$j=$j.parent}},$O._setDisplay=function($j){this._displayedInStage!==$j&&((this._displayedInStage=$j)?this.event("display"):this.event("undisplay"))},$O._displayChild=function($j,$O){var $V=$j._childs;if($V)for(var $l=0;$l<$V.length;$l++){var $T=$V[$l];$T&&$T._getBit(1)&&(0<$T._childs.length?this._displayChild($T,$O):$T._setDisplay($O))}$j._setDisplay($O)},$O.contains=function($j){if($j===this)return!0;for(;$j;){if($j.parent===this)return!0;$j=$j.parent}return!1},$O.timerLoop=function($j,$O,$V,$l,$T,$S){void 0===$T&&($T=!0),void 0===$S&&($S=!1),this.timer.loop($j,$O,$V,$l,$T,$S)},$O.timerOnce=function($j,$O,$V,$l,$T){void 0===$T&&($T=!0),this.timer._create(!1,!1,$j,$O,$V,$l,$T)},$O.frameLoop=function($j,$O,$V,$l,$T){void 0===$T&&($T=!0),this.timer._create(!0,!0,$j,$O,$V,$l,$T)},$O.frameOnce=function($j,$O,$V,$l,$T){void 0===$T&&($T=!0),this.timer._create(!0,!1,$j,$O,$V,$l,$T)},$O.clearTimer=function($j,$O){this.timer.clear($j,$O)},$g(0,$O,"numChildren",function(){return this._childs.length}),$g(0,$O,"destroyed",function(){return this._destroyed}),$g(0,$O,"parent",function(){return this._parent},function($j){this._parent!==$j&&($j?(this._parent=$j,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$j.displayedInStage&&this._displayChild(this,!0)),$j._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$j))}),$g(0,$O,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$m.ARRAY_EMPTY=[],$m.PROP_EMPTY={},$m.NOTICE_DISPLAY=1,$m.MOUSEENABLE=2,$m}(),$Oj=function($j){function $t($j){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$t.__super.call(this),this._padding=$t._PADDING,this._spacing=$t._SPACING,this._aligns=$t._ALIGNS,this._font=$w.EMPTY,this._ower=$j}$b($t,"laya.display.css.CSSStyle",$j);var $O=$t.prototype;return $O.destroy=function(){this._ower=null,this._font=null,this._rect=null},$O.inherit=function($j){this._font=$j._font,this._spacing=$j._spacing===$t._SPACING?$t._SPACING:$j._spacing.slice(),this.lineHeight=$j.lineHeight},$O._widthAuto=function(){return 0!=(262144&this._type)},$O.widthed=function($j){return 0!=(8&this._type)},$O._calculation=function($j,$O){if($O.indexOf("%")<0)return!1;var $l=this._ower,$T=$l.parent,$S=this._rect;function $m($j,$O,$V){return $j*$V[0]+$O*$V[1]+$V[2]}function $V($j){var $O=$T.width,$V=$l.width;$S.width&&($l.width=$m($O,$V,$S.width)),$S.height&&($l.height=$m($O,$V,$S.height)),$S.left&&($l.x=$m($O,$V,$S.left)),$S.top&&($l.y=$m($O,$V,$S.top))}null===$S&&($T._getCSSStyle()._type|=524288,$T.on("resize",this,$V),this._rect=$S={input:{}});var $p=$O.split(" ");return $p[0]=parseFloat($p[0])/100,1==$p.length?$p[1]=$p[2]=0:($p[1]=parseFloat($p[1])/100,$p[2]=parseFloat($p[2])),$S[$j]=$p,$S.input[$j]=$O,$V(),!0},$O.heighted=function($j){return 0!=(8192&this._type)},$O.size=function($j,$O){var $V=this._ower,$l=!1;-1!==$j&&$j!=this._ower.width&&(this._type|=8,this._ower.width=$j,$l=!0),-1!==$O&&$O!=this._ower.height&&(this._type|=8192,this._ower.height=$O,$l=!0),$l&&($V._layoutLater(),524288&this._type&&$V.event("resize",this))},$O._getAlign=function(){return this._aligns[0]},$O._getValign=function(){return this._aligns[1]},$O._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$O._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $w(this._font))},$O.render=function($j,$O,$V,$l){var $T=$j.width,$S=$j.height;$V-=$j.pivotX,$l-=$j.pivotY,this._bgground&&null!=this._bgground.color&&$O.ctx.fillRect($V,$l,$T,$S,this._bgground.color),this._border&&this._border.color&&$O.drawRect($V,$l,$T,$S,this._border.color.strColor,this._border.size)},$O.getCSSStyle=function(){return this},$O.cssText=function($j){this.attrs($t.parseOneCSS($j,";"))},$O.attrs=function($j){if($j)for(var $O=0,$V=$j.length;$O<$V;$O++){var $l=$j[$O];this[$l[0]]=$l[1]}},$O.setTransform=function($j){"none"===$j?this._tf=$p._TF_EMPTY:this.attrs($t.parseOneCSS($j,","))},$O.translate=function($j,$O){this._tf===$p._TF_EMPTY&&(this._tf=new $T),this._tf.translateX=$j,this._tf.translateY=$O},$O.scale=function($j,$O){this._tf===$p._TF_EMPTY&&(this._tf=new $T),this._tf.scaleX=$j,this._tf.scaleY=$O},$O._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$g(0,$O,"block",$j.prototype._$get_block,function($j){$j?this._type|=1:this._type&=-2}),$g(0,$O,"valign",function(){return $t._valigndef[this._aligns[1]]},function($j){this._aligns===$t._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$t._valigndef[$j]}),$g(0,$O,"height",null,function($j){if(this._type|=8192,"string"==typeof $j){if(this._calculation("height",$j))return;$j=parseInt($j)}this.size(-1,$j)}),$g(0,$O,"width",null,function($j){if(this._type|=8,"string"==typeof $j){var $O=$j.indexOf("auto");if(0<=$O&&(this._type|=262144,$j=$j.substr(0,$O)),this._calculation("width",$j))return;$j=parseInt($j)}this.size($j,-1)}),$g(0,$O,"fontWeight",function(){return this._font.weight},function($j){this._createFont().weight=$j}),$g(0,$O,"left",null,function($j){var $O=this._ower;if("string"==typeof $j){if("center"===$j?$j="50% -50% 0":"right"===$j&&($j="100% -100% 0"),this._calculation("left",$j))return;$j=parseInt($j)}$O.x=$j}),$g(0,$O,"_translate",null,function($j){this.translate($j[0],$j[1])}),$g(0,$O,"absolute",function(){return 0!=(4&this._type)}),$g(0,$O,"top",null,function($j){var $O=this._ower;if("string"==typeof $j){if("middle"===$j?$j="50% -50% 0":"bottom"===$j&&($j="100% -100% 0"),this._calculation("top",$j))return;$j=parseInt($j)}$O.y=$j}),$g(0,$O,"align",function(){return $t._aligndef[this._aligns[0]]},function($j){this._aligns===$t._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$t._aligndef[$j]}),$g(0,$O,"bold",function(){return this._font.bold},function($j){this._createFont().bold=$j}),$g(0,$O,"padding",function(){return this._padding},function($j){this._padding=$j}),$g(0,$O,"leading",function(){return this._spacing[1]},function($j){"string"==typeof $j&&($j=parseInt($j+"")),this._spacing===$t._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$j}),$g(0,$O,"lineElement",function(){return 0!=(65536&this._type)},function($j){$j?this._type|=65536:this._type&=-65537}),$g(0,$O,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($j){this.lineElement=!1,"right"===$j?this._type|=32768:this._type&=-32769}),$g(0,$O,"textDecoration",function(){return this._font.decoration},function($j){this._createFont().decoration=$j}),$g(0,$O,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($j){"nowrap"===$j&&(this._type|=131072),"none"===$j&&(this._type&=-131073)}),$g(0,$O,"background",null,function($j){$j?(this._bgground||(this._bgground={}),this._bgground.color=$j,this._ower.conchModel&&this._ower.conchModel.bgColor($j),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$g(0,$O,"wordWrap",function(){return 0==(131072&this._type)},function($j){$j?this._type&=-131073:this._type|=131072}),$g(0,$O,"color",function(){return this._font.color},function($j){this._createFont().color=$j}),$g(0,$O,"password",function(){return this._font.password},function($j){this._createFont().password=$j}),$g(0,$O,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($j){"none"===$j?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$j),this._ower.conchModel&&this._ower.conchModel.bgColor($j),this._ower._renderType|=256}),$g(0,$O,"font",function(){return this._font.toString()},function($j){this._createFont().set($j)}),$g(0,$O,"weight",null,function($j){this._createFont().weight=$j}),$g(0,$O,"letterSpacing",function(){return this._spacing[0]},function($j){"string"==typeof $j&&($j=parseInt($j+"")),this._spacing===$t._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$j}),$g(0,$O,"fontSize",function(){return this._font.size},function($j){this._createFont().size=$j}),$g(0,$O,"italic",function(){return this._font.italic},function($j){this._createFont().italic=$j}),$g(0,$O,"fontFamily",function(){return this._font.family},function($j){this._createFont().family=$j}),$g(0,$O,"stroke",function(){return this._font.stroke[0]},function($j){this._createFont().stroke===$w._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$j}),$g(0,$O,"strokeColor",function(){return this._font.stroke[1]},function($j){this._createFont().stroke===$w._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$j}),$g(0,$O,"border",function(){return this._border?this._border.value:""},function($j){if("none"!=$j){this._border||(this._border={});var $O=(this._border.value=$j).split(" ");if(this._border.color=$C.create($O[$O.length-1]),1==$O.length)return this._border.size=1,void(this._border.type="solid");var $V=0;0<$O[0].indexOf("px")?(this._border.size=parseInt($O[0]),$V++):this._border.size=1,this._border.type=$O[$V],this._ower._renderType|=256}else this._border=null}),$g(0,$O,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($j){$j?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$j?null:$C.create($j),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$g(0,$O,"position",function(){return 4&this._type?"absolute":""},function($j){"absolute"==$j?this._type|=4:this._type&=-5}),$g(0,$O,"display",null,function($j){switch($j){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$g(0,$O,"paddingLeft",function(){return this.padding[3]}),$g(0,$O,"paddingTop",function(){return this.padding[0]}),$g(0,$O,"_scale",null,function($j){this._ower.scale($j[0],$j[1])}),$g(0,$O,"_rotate",null,function($j){this._ower.rotation=$j}),$t.parseOneCSS=function($j,$O){for(var $V,$l=[],$T=$j.split($O),$S=0,$m=$T.length;$S<$m;$S++){var $p=$T[$S],$o=$p.indexOf(":"),$H=$p.substr(0,$o).replace(/^\s+|\s+$/g,"");if(0!=$H.length){var $g=$p.substr($o+1).replace(/^\s+|\s+$/g,""),$e=[$H,$g];switch($H){case"italic":case"bold":$e[1]="true"==$g;break;case"line-height":$e[0]="lineHeight",$e[1]=parseInt($g);break;case"font-size":$e[0]="fontSize",$e[1]=parseInt($g);break;case"padding":1<($V=$g.split(" ")).length||($V[1]=$V[2]=$V[3]=$V[0]),$e[1]=[parseInt($V[0]),parseInt($V[1]),parseInt($V[2]),parseInt($V[3])];break;case"rotate":$e[0]="_rotate",$e[1]=parseFloat($g);break;case"scale":$V=$g.split(" "),$e[0]="_scale",$e[1]=[parseFloat($V[0]),parseFloat($V[1])];break;case"translate":$V=$g.split(" "),$e[0]="_translate",$e[1]=[parseInt($V[0]),parseInt($V[1])];break;default:($e[0]=$t._CSSTOVALUE[$H])||($e[0]=$H)}$l.push($e)}}return $l},$t.parseCSS=function($j,$O){for(var $V;null!=($V=$t._parseCSSRegExp.exec($j));)$t.styleSheets[$V[1]]=$t.parseOneCSS($V[2],";")},$t.EMPTY=new $t(null),$t._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$t._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$t._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$t._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$t.styleSheets={},$t.ALIGN_CENTER=1,$t.ALIGN_RIGHT=2,$t.VALIGN_MIDDLE=1,$t.VALIGN_BOTTOM=2,$t._CSS_BLOCK=1,$t._DISPLAY_NONE=2,$t._ABSOLUTE=4,$t._WIDTH_SET=8,$t._PADDING=[0,0,0,0],$t._RECT=[-1,-1,-1,-1],$t._SPACING=[0,0],$t._ALIGNS=[0,0,0],$t.ADDLAYOUTED=512,$t._NEWFONT=4096,$t._HEIGHT_SET=8192,$t._BACKGROUND_SET=16384,$t._FLOAT_RIGHT=32768,$t._LINE_ELEMENT=65536,$t._NOWARP=131072,$t._WIDTHAUTO=262144,$t._LISTERRESZIE=524288,$t}($p),$Vj=function($j){function $m(){this.url=null,this.audio=null,this.loaded=!1,$m.__super.call(this)}$b($m,"laya.media.h5audio.AudioSound",$H);var $O=$m.prototype;return $O.dispose=function(){var $j=$m._audioCache[this.url];$j&&($j.src="",delete $m._audioCache[this.url])},$O.load=function($j){var $O;if($j=$R.formatURL($j),(this.url=$j)==$B._tMusic?($m._initMusicAudio(),($O=$m._musicAudio).src!=$j&&($m._audioCache[$O.src]=null,$O=null)):$O=$m._audioCache[$j],$O&&2<=$O.readyState)this.event("complete");else{$O||($O=$j==$B._tMusic?($m._initMusicAudio(),$m._musicAudio):$F.createElement("audio"),($m._audioCache[$j]=$O).src=$j),$O.addEventListener("canplaythrough",$l),$O.addEventListener("error",$T);var $V=this;(this.audio=$O).load?$O.load():$T()}function $l(){$S(),$V.loaded=!0,$V.event("complete")}function $T(){$O.load=null,$S(),$V.event("error")}function $S(){$O.removeEventListener("canplaythrough",$l),$O.removeEventListener("error",$T)}},$O.play=function($j,$O,$V){if(void 0===$j&&($j=0),void 0===$O&&($O=0),!this.url)return null;var $l,$T;if(!($l=this.url==$B._tMusic?$m._musicAudio:$m._audioCache[this.url]))return null;$T=$W.getItem("audio:"+this.url),$q.isConchApp?$T||(($T=$F.createElement("audio")).src=this.url):this.url==$B._tMusic?($m._initMusicAudio(),($T=$m._musicAudio).src=this.url):$T=$T||$l.cloneNode(!0);var $S=new $tj($T);return $S.url=this.url,$S.loops=$O,$S.startTime=$j,$S.startHandler=$V,$S.play(!1),$B.addChannel($S),$S},$g(0,$O,"duration",function(){var $j;return($j=$m._audioCache[this.url])?$j.duration:0}),$m._initMusicAudio=function(){$m._musicAudio||($m._musicAudio||($m._musicAudio=$F.createElement("audio")),$q.isConchApp||$F.document.addEventListener("mousedown",$m._makeMusicOK))},$m._makeMusicOK=function(){$F.document.removeEventListener("mousedown",$m._makeMusicOK),$m._musicAudio.src?$m._musicAudio.play():($m._musicAudio.src="",$m._musicAudio.load())},$m._audioCache={},$m._musicAudio=null,$m}(),$lj=function($j){function $O(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$O.__super.call(this)}$b($O,"laya.media.SoundChannel",$H);var $V=$O.prototype;return $V.play=function(){},$V.stop=function(){},$V.pause=function(){},$V.resume=function(){},$V.__runComplete=function($j){$j&&$j.run()},$g(0,$V,"volume",function(){return 1},function($j){}),$g(0,$V,"position",function(){return 0}),$g(0,$V,"duration",function(){return 0}),$O}(),$Tj=function($j){function $O(){$O.__super.call(this)}$b($O,"laya.media.Sound",$H);var $V=$O.prototype;return $V.load=function($j){},$V.play=function($j,$O,$V){return void 0===$j&&($j=0),void 0===$O&&($O=0),null},$V.dispose=function(){},$g(0,$V,"duration",function(){return 0}),$O}(),$Sj=function($j){function $T(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$T.__super.call(this)}$b($T,"laya.media.webaudio.WebAudioSound",$H);var $O=$T.prototype;return $O.load=function($j){this.url=$j,this.audioBuffer=$T._dataCache[$j],this.audioBuffer?this._loaded(this.audioBuffer):($T.e.on("loaded:"+$j,this,this._loaded),$T.e.on("err:"+$j,this,this._err),$T.__loadingSound[$j]||($T.__loadingSound[$j]=!0,$E.loader.load($j,$a.create(this,this.onloaded),null,$pj.BUFFER,4,!1,null,!0)))},$O.onloaded=function($j){$j||this._err(),this._disposed?this._removeLoadEvents():(this.data=$j,$T.buffs.push({buffer:this.data,url:this.url}),$T.decode())},$O._err=function(){if(this._removeLoadEvents(),$T.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $j,$O,$V,$l=0;for($j=($O=this.__toPlays).length,$l=0;$l<$j;$l++)($V=$O[$l])[3]&&!$V[3].isStopped&&$V[3].event("error");this.__toPlays.length=0}},$O._loaded=function($j){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$j,this.loaded=!0,this.event("complete"))},$O._removeLoadEvents=function(){$T.e.off("loaded:"+this.url,this,this._loaded),$T.e.off("err:"+this.url,this,this._err)},$O.__playAfterLoaded=function(){if(this.__toPlays){var $j,$O,$V,$l=0;for($j=($O=this.__toPlays).length,$l=0;$l<$j;$l++)($V=$O[$l])[3]&&!$V[3].isStopped&&this.play($V[0],$V[1],$V[2],$V[3]);this.__toPlays.length=0}},$O.play=function($j,$O,$V,$l){return void 0===$j&&($j=0),void 0===$O&&($O=0),$l=$l||new $wj,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$j,$O,$V,$l]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$l.url=this.url,$l.loops=$O,$l.audioBuffer=this.audioBuffer,$l.startTime=$j,$l.startHandler=$V,$l.play(!1),$B.addChannel($l),$l},$O.dispose=function(){this._disposed=!0,delete $T._dataCache[this.url],delete $T.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$g(0,$O,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$T.decode=function(){if(!($T.buffs.length<=0||$T.isDecoding))if($T.isDecoding=!0,($T.tInfo=$T.buffs.shift())&&$T.tInfo.buffer&&$T.tInfo.buffer.byteLength)try{$T.ctx.decodeAudioData($T.tInfo.buffer,$T._done,$T._fail)}catch($j){console.error("decodeAudioData error  byteLength:"+$T.tInfo.buffer.byteLength+"  url:"+$T.tInfo.url)}else $T._fail()},$T._done=function($j){$T.e.event("loaded:"+$T.tInfo.url,$j),$T._dataCache[$T.tInfo.url]=$j,$T.isDecoding=!1,$T.decode()},$T._fail=function(){$T.e.event("err:"+$T.tInfo.url,null),$T.isDecoding=!1,$T.decode()},$T._playEmptySound=function(){if(null!=$T.ctx){if($T._emptySource&&($T._emptySource.stop(),$T._emptySource.disconnect(0),!$wj._tryCleanFailed))try{$T._emptySource.buffer=null}catch($j){$wj._tryCleanFailed=!0}var $j=$T.ctx.createBufferSource();$j.buffer=$T._miniBuffer,$j.connect($T.ctx.destination),$j.start(0,0,0),$T._emptySource=$j}},$T._unlock=function(){$T._unlocked||($T._playEmptySound(),"running"==$T.ctx.state?($F.document.removeEventListener("mousedown",$T._unlock,!0),$F.document.removeEventListener("touchend",$T._unlock,!0),$F.document.removeEventListener("touchstart",$T._unlock,!0),$T._unlocked=!0):"suspended"==$T.ctx.state&&$B._recoverWebAudio())},$T.initWebAudio=function(){"running"!=$T.ctx.state&&($T._unlock(),$F.document.addEventListener("mousedown",$T._unlock,!0),$F.document.addEventListener("touchend",$T._unlock,!0),$F.document.addEventListener("touchstart",$T._unlock,!0))},$T._emptySource=null,$T._dataCache={},$T.buffs=[],$T.isDecoding=!1,$T._unlocked=!1,$T.tInfo=null,$T.__loadingSound={},$o($T,["window",function(){return this.window=$F.window},"webAudioEnabled",function(){return this.webAudioEnabled=$T.window.AudioContext||$T.window.webkitAudioContext||$T.window.mozAudioContext},"ctx",function(){return this.ctx=$T.webAudioEnabled?new($T.window.AudioContext||$T.window.webkitAudioContext||$T.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$T.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $H}]),$T}(),$mj=function($j){function $O(){this._responseType=null,this._data=null,$O.__super.call(this),this._http=new $F.window.XMLHttpRequest}$b($O,"laya.net.HttpRequest",$H);var $V=$O.prototype;return $V.send=function($j,$O,$V,$l,$T){void 0===$V&&($V="get"),void 0===$l&&($l="text"),this._responseType=$l,this._data=null;var $S=this,$m=this._http;if($m.open($V,$j,!0),$T)for(var $p=0;$p<$T.length;$p++)$m.setRequestHeader($T[$p++],$T[$p]);else $q.isConchApp||($O&&"string"!=typeof $O?$m.setRequestHeader("Content-Type","application/json"):$m.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$m.responseType="arraybuffer"!==$l?"text":"arraybuffer",$m.onerror=function($j){$S._onError($j)},$m.onabort=function($j){$S._onAbort($j)},$m.onprogress=function($j){$S._onProgress($j)},$m.onload=function($j){$S._onLoad($j)},$m.send($O)},$V._onProgress=function($j){$j&&$j.lengthComputable&&this.event("progress",$j.loaded/$j.total)},$V._onAbort=function($j){this.error("Request was aborted by user")},$V._onError=function($j){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$V._onLoad=function($j){var $O=this._http,$V=void 0!==$O.status?$O.status:200;200===$V||204===$V||0===$V?this.complete():this.error("["+$O.status+"]"+$O.statusText+":"+$O.responseURL)},$V.error=function($j){this.clear(),this.event("error",$j)},$V.complete=function(){this.clear();var $O=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$Q.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($j){$O=!1,this.error($j.message)}$O&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$V.clear=function(){var $j=this._http;$j.onerror=$j.onabort=$j.onprogress=$j.onload=null},$g(0,$V,"url",function(){return this._http.responseURL}),$g(0,$V,"http",function(){return this._http}),$g(0,$V,"data",function(){return this._data}),$O}(),$pj=function($j){function $$(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$$.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}$b($$,"laya.net.Loader",$H);var $O=$$.prototype;return $O.load=function($j,$O,$V,$l,$T){if($j&&""!=$j||console.error("Loader 加载的url不合法 "+$j),void 0===$V&&($V=!0),void 0===$T&&($T=!1),this._url=$j,this._base64=!1,0===$j.indexOf("data:image")?(this._base64=!0,this._type=$O="image"):this._type=$O||($O=this.getTypeFromUrl($j)),this._cache=$V,this._data=null,!$T&&$$.loadedMap[$j])return this._data=$$.loadedMap[$j],this.event("progress",1),void this.event("complete",this._data);if($l&&$$.setGroup($j,$l),null!=$$.parserMap[$O])return this._customParse=!0,void($$.parserMap[$O]instanceof laya.utils.Handler?$$.parserMap[$O].runWith(this):$$.parserMap[$O].call(null,this));if("image"===$O||"htmlimage"===$O||"nativeimage"===$O)return this._loadImage($j);if("ttf"===$O)return this._loadTTF($j);switch($O){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$O}$$.preLoadedMap[$j]?this.onLoaded($$.preLoadedMap[$j]):$m.resMgrLoad($j,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$O.getTypeFromUrl=function($j){var $O=$Q.getFileExtension($j);return $O?$$.typeMap[$O]:(console.warn("Not recognize the resources suffix",$j),"text")},$O._loadTTF=function($j){$j=$R.formatURL($j);var $O=new $Y;$O.complete=$a.create(this,this.onLoaded),$O.load($j)},$O._loadBase64Image=function($O){$O=$R.formatURL($O);var $V,$j=this;function $l(){$V.onload=null,$V.onerror=null,delete $$.imgCache[$O]}function $T(){$l(),$j.onLoaded($V)}function $S(){$l(),$j.event("error","Load image failed")}"nativeimage"===this._type?(($V=new $F.window.Image).crossOrigin="",$V.onload=$T,$V.onerror=$S,$V.src=$O,$$.imgCache[$O]=$V):new $xj.create($O,{onload:$T,onerror:$S,onCreate:function($j){$V=$j,$$.imgCache[$O]=$j}})},$O._loadImage=function($j){this._base64?this._loadBase64Image($j):$m.imgMgrLoad($j,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$O._loadImageComplete=function($j,$O,$V){if(null!=$V)if($V instanceof ArrayBuffer){var $l=new DataView($V),$T=new laya.webgl.resource.WebGLImage(new Uint8Array($V,8),$j,0,!1,$l.getUint32(0),$l.getUint32(4));this.onLoaded($T)}else if($V instanceof $gj)$$.imgMgrSet[$j]=$O,$m.imgMgrLock($j,$$.imgMgrSet[$j]),this._url=$j,this.complete($V);else{var $S=-1!=$j.indexOf(".png",$j.length-4)?6408:6407;$T=new laya.webgl.resource.WebGLImage($V,$j,$S,!1,$V.width,$V.height);this.onLoaded($T)}else this.event("error","Load image failed")},$O.imageCancel=function($j,$O,$V){$m.imgMgrCancel&&$m.imgMgrCancel($j,this._onImageCallback)},$O._loadSound=function($j){var $O=new $B._soundClass,$V=this;function $l(){$O.offAll()}$O.on("complete",this,function(){$l(),$V.onLoaded($O)}),$O.on("error",this,function(){$l(),$O.dispose(),$V.event("error","Load sound failed")}),$O.load($j)},$O.onProgress=function($j){"atlas"===this._type?this.event("progress",.3*$j):this.event("progress",$j)},$O.onError=function($j){this.event("error",$j)},$O._loadedComplete=function($j,$O,$V){if(null!=$V)switch(this._type){case"atlas":case"plf":case"json":var $l=new $N($V);this.onLoaded(JSON.parse($l.readUTFBytes()));break;case"font":$l=new $N($V);this.onLoaded($Q.parseXMLFromString($l.readUTFBytes()));break;default:this.onLoaded($V)}else this.event("error",$j)},$O.onLoaded=function($j){var $O=this._type;if("plf"==$O)this.parsePLFData($j),this.complete($j);else if("image"===$O){var $V=new $gj($j);$V.url=this._url,this.complete($V)}else if("sound"===$O||"htmlimage"===$O||"nativeimage"===$O)this.complete($j);else if("atlas"===$O){if(!$j.src&&!$j._setContext){if(!this._data){if((this._data=$j).meta&&$j.meta.image)for(var $l=$j.meta.image.split(","),$T=0<=this._url.indexOf("/")?"/":"\\",$S=this._url.lastIndexOf($T),$m=0<=$S?this._url.substr(0,$S+1):"",$p=0,$o=$l.length;$p<$o;$p++)$l[$p]=$m+$l[$p];else $l=[this._url.replace(".json",".png")];$l.reverse(),$j.toLoads=$l,$j.pics=[]}return this.event("progress",.3+1/$l.length*.6),this._loadImage($l.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($j),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $H=this._data.frames,$g=this._url.split("?")[0],$e=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$g.substring(0,$g.lastIndexOf("."))+"/",$t=this._data.pics,$w=$R.formatURL(this._url),$s=$$.atlasMap[$w]||($$.atlasMap[$w]=[]);$s.dir=$e;var $b=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $r in $b=parseFloat(this._data.meta.scale),$H){var $h,$a=$H[$r],$c=$t[$a.frame.idx?$a.frame.idx:0],$A=$R.formatURL($e+$r);$c.scaleRate=$b,$h=$gj.create($c,$a.frame.x,$a.frame.y,$a.frame.w,$a.frame.h,$a.spriteSourceSize.x,$a.spriteSourceSize.y,$a.sourceSize.w,$a.sourceSize.h),$$.cacheRes($A,$h),$$.keepCache(this._url,$e+$r),$h.url=$A,$s.push($A)}else for($r in $H)$c=$t[($a=$H[$r]).frame.idx?$a.frame.idx:0],$A=$R.formatURL($e+$r),$$.cacheRes($A,$gj.create($c,$a.frame.x,$a.frame.y,$a.frame.w,$a.frame.h,$a.spriteSourceSize.x,$a.spriteSourceSize.y,$a.sourceSize.w,$a.sourceSize.h)),$$.loadedMap[$A].url=$A,$$.keepCache(this._url,$e+$r),$s.push($A);delete this._data.pics,this.complete(this._data)}else if("font"==$O){if(!$j.src)return this._data=$j,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $Z=new $_;$Z.parseFont(this._data,$j);var $x=this._url.split(".fnt")[0].split("/"),$E=$x[$x.length-1];$rj.registerBitmapFont($E,$Z),this._data=$Z,this.complete(this._data)}else if("pkm"==$O){var $U=$xj.create($j,this._url),$z=new $gj($U);$z.url=this._url,this.complete($z)}else this.complete($j)},$O.parsePLFData=function($j){var $O,$V,$l;for($O in $j)switch($l=$j[$O],$O){case"json":case"text":for($V in $l)$$.preLoadedMap[$R.formatURL($V)]=$l[$V];break;default:for($V in $l)$$.preLoadedMap[$R.formatURL($V)]=$l[$V]}},$O.complete=function($j){this._data=$j,this._customParse?this.event("loaded",$j instanceof Array?[$j]:$j):($$._loaders.push(this),$$._isWorking||$$.checkNext())},$O.endLoad=function($j){$j&&(this._data=$j),this._cache&&$$.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$g(0,$O,"url",function(){return this._url}),$g(0,$O,"data",function(){return this._data}),$g(0,$O,"cache",function(){return this._cache}),$g(0,$O,"type",function(){return this._type}),$$.checkNext=function(){$$._isWorking=!0;for(var $j=$F.now();$$._startIndex<$$._loaders.length;)if($F.now(),$$._loaders[$$._startIndex].endLoad(),$$._startIndex++,$F.now()-$j>$$.maxTimeOut)return console.warn("loader callback cost a long time:"+($F.now()-$j)+" url="+$$._loaders[$$._startIndex-1].url),void $E.timer.frameOnce(1,null,$$.checkNext);$$._loaders.length=0,$$._startIndex=0,$$._isWorking=!1},$$.clearRes=function($j,$O){if(null!=$j){void 0===$O&&($O=!1),$j=$R.formatURL($j);var $V=$$.getAtlas($j);if($V){for(var $l=0,$T=$V.length;$l<$T;$l++){var $S=$V[$l],$m=$$.getRes($S);delete $$.loadedMap[$S],$$.clearCache($j.substring($R.basePath.length),$S.substring($R.basePath.length)),$m&&$m.destroy($O)}$V.length=0,delete $$.atlasMap[$j],delete $$.loadedMap[$j]}else{var $p=$$.loadedMap[$j];$p&&(delete $$.loadedMap[$j],$p instanceof laya.resource.Texture&&$p.bitmap&&$p.destroy($O))}}},$$.clearTextureRes=function($j){$j=$R.formatURL($j);var $O=laya.net.Loader.getAtlas($j),$V=$O&&0<$O.length?laya.net.Loader.getRes($O[0]):laya.net.Loader.getRes($j);$V&&$V.bitmap&&($q.isConchApp&&!$q.isConchWebGL?$V.bitmap.source.releaseTexture&&$V.bitmap.source.releaseTexture():null==$V.bitmap._atlaser&&$V.bitmap.releaseResource(!0))},$$.getRes=function($j){return $$.loadedMap[$R.formatURL($j)]},$$.getAtlas=function($j){return $$.atlasMap[$R.formatURL($j)]},$$.cacheRes=function($j,$O){$j=$R.formatURL($j),null!=$$.loadedMap[$j]?console.warn("Resources already exist,is repeated loading:",$j):$$.loadedMap[$j]=$O},$$.setGroup=function($j,$O){$$.groupMap[$O]||($$.groupMap[$O]=[]),$$.groupMap[$O].push($j)},$$.clearResByGroup=function($j){if($$.groupMap[$j]){var $O=$$.groupMap[$j],$V=0,$l=$O.length;for($V=0;$V<$l;$V++)$$.clearRes($O[$V]);$O.length=0}},$$.keepCache=function($j,$O){if($j&&$O){var $V=$$.cacheSet[$O];$V?-1==$V.indexOf($j)&&$V.push($j):$$.cacheSet[$O]=[$j]}},$$.clearCache=function($j,$O){if($j&&$O){var $V=$$.cacheSet[$O];if($V){var $l=$V.indexOf($j);if(-1!==$l){var $T=$V.length-1;0==$T?(delete $$.cacheSet[$O],0<$$.imgMgrSet[$O]?$m.imgMgrFree($O,$$.imgMgrSet[$O]):$$.clearRes($O,!0)):($V[$l]=$V[$T],$V.length=$T)}}}},$$.saveObject=function($j,$O,$V){if($O&&$j){var $l=$$.objectSet[$j];$l?(console.warn("Loader.saveObject: "+$j),$l[0]=$O,$l[1]=$V):$$.objectSet[$j]=[$O,$V,[]]}},$$.findObject=function($j){if($j){var $O=$$.objectSet[$j];if($O)return $O[0]}return null},$$.keepObject=function($j,$O){if($j&&$O){var $V=$$.objectSet[$O];$V&&-1===$V[2].indexOf($j)&&$V[2].push($j)}},$$.clearObject=function($j,$O){if($j&&$O){var $V=$$.objectSet[$O];if($V){var $l=$V[2],$T=$l.indexOf($j);if(-1!==$T){var $S=$l.length-1;0==$S?(delete $$.objectSet[$O],$V[1]&&$V[1].call(null,$V[0])):($l[$T]=$l[$S],$l.length=$S)}}}},$$.TEXT="text",$$.JSON="json",$$.XML="xml",$$.BUFFER="arraybuffer",$$.IMAGE="image",$$.SOUND="sound",$$.ATLAS="atlas",$$.FONT="font",$$.TTF="ttf",$$.PLF="plf",$$.PKM="pkm",$$.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$$.parserMap={},$$.groupMap={},$$.maxTimeOut=100,$$.loadedMap={},$$.preLoadedMap={},$$.atlasMap={},$$._loaders=[],$$._isWorking=!1,$$._startIndex=0,$$.imgCache={},$$.cacheSet={},$$.objectSet={},$$.imgMgrSet={},$$}(),$oj=function($j){var $t;function $w(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$w.__super.call(this);for(var $j=0;$j<this._maxPriority;$j++)this._resInfos[$j]=[]}$b($w,"laya.net.LoaderManager",$H);var $O=$w.prototype;return $O.create=function($j,$V,$O,$l,$T,$S,$m,$p){if(null==$S&&($S=2),null==$m&&($m=!0),$j instanceof Array){var $o=$j,$H=$o.length,$g=0;if($O)var $e=$a.create($O.caller,$O.method,$O.args,!1);for(var $t=0;$t<$H;$t++){var $w=$o[$t];"string"==typeof $w&&($w=$o[$t]={url:$w}),$w.progress=0}for($t=0;$t<$H;$t++){$w=$o[$t];var $s=$O?$a.create(null,$h,[$w],!1):null,$b=$O||$V?$a.create(null,$r,[$w]):null;this._create($w.url,$b,$s,$w.clas||$l,$w.params||$T,null!=$w.priority&&0<=$w.priority?$w.priority:$S,$m,$w.group||$p)}function $r($j,$O){$g++,$j.progress=1,$g===$H&&$V&&$V.run()}function $h($j,$O){$j.progress=$O;for(var $V=0,$l=0;$l<$H;$l++){$V+=$o[$l].progress}var $T=$V/$H;$e.runWith($T)}return!0}return this._create($j,$V,$O,$l,$T,$S,$m,$p)},$O._create=function($O,$V,$j,$l,$T,$S,$m,$p){$O&&""!=$O||console.error("加载的url不合法 "+$O),null==$S&&($S=2),null==$m&&($m=!0);var $o=$R.formatURL($O),$H=this.getRes($o);if($H)!$H.hasOwnProperty("loaded")||$H.loaded?($j&&$j.runWith(1),$V&&$V.run()):$V&&$E.loader._createListener($O,$V.caller,$V.method,$V.args,!0,!1);else{var $g=$Q.getFileExtension($O),$e=$w.createMap[$g];if(!$e)throw new Error("LoaderManager:unknown file("+$O+") extension with: "+$g+".");$l||($l=$e[0]);var $t=$e[1];if("atlas"==$g)this.load($O,$V,$j,$t,$S,$m);else{$l===$gj&&($t="htmlimage"),($H=$l?new $l:null).hasOwnProperty("_loaded")&&($H._loaded=!1),$H._setUrl($O),$p&&$H._setGroup($p),this._createLoad($H,$O,$a.create(null,function($j){$H&&!$H.destroyed&&$j&&$H.onAsynLoaded.call($H,$O,$j,$T),$V&&$V.run();$E.loader.event($O)}),$j,$t,$S,!1,$p,!0),$m&&this.cacheRes($o,$H)}}return $H},$O.load=function($j,$O,$V,$l,$T,$S,$m,$p){$j&&""!=$j||console.error("加载的url不合法 "+$j);var $o=this;if(null==$T&&($T=2),null==$S&&($S=!0),void 0===$p&&($p=!1),$j instanceof Array)return this._loadAssets($j,$O,$V,$l,$T,$S,$m);var $H=$pj.getRes($j);if(null!=$H)$E.timer.frameOnce(1,null,function(){$V&&$V.runWith(1),$O&&$O.runWith($H),$o._loaderCount||$o.event("complete")});else{var $g=$w._resMap[$j];$g?($O&&$g._createListener("complete",$O.caller,$O.method,$O.args,!1,!1),$V&&$g._createListener("progress",$V.caller,$V.method,$V.args,!1,!1)):(($g=this._infoPool.length?this._infoPool.pop():new $t).url=$j,$g.clas=null,$g.type=$l,$g.cache=$S,$g.group=$m,$g.ignoreCache=$p,$g.priority=$T,$O&&$g.on("complete",$O.caller,$O.method,$O.args),$V&&$g.on("progress",$V.caller,$V.method,$V.args),$w._resMap[$j]=$g,$T=$T<this._maxPriority?0<=$T?$T:0:this._maxPriority-1,this._resInfos[$T].push($g),this._next())}return this},$O.cancel=function($j,$O,$V){if($H=$w._resMap[$j]){$O&&$H.off("complete",$O.caller,$O.method,!1),$V&&$H.off("progress",$V.caller,$V.method,!1);var $l=$H.getListener("complete"),$T=$H.getListener("progress");if(!($l&&$l.head||$T&&$T.head)){if($H.loader){var $S=$H.loader;$S.imageCancel($j),$S.offAll(),$S._data=null,$S._customParse=!1,$S._url=null,$S._class=null,$S._type=null,this._loaders.push($S),this._loaderCount--,delete this._loaderMap[$H.url]}for(var $m=0;$m<this._maxPriority;$m++)for(var $p=this._resInfos[$m],$o=$p.length-1;-1<$o;$o--){var $H;($H=$p[$o])&&$H.url===$j&&($p[$o]=null,$H.destroy(),$H.offAll(),this._infoPool.push($H))}delete $w._resMap[$j],this._next()}}},$O._createLoad=function($j,$O,$V,$l,$T,$S,$m,$p,$o){var $H=this;if(null==$S&&($S=2),null==$m&&($m=!0),void 0===$o&&($o=!1),$O instanceof Array)return this._loadAssets($O,$V,$l,$T,$S,$m,$p);var $g=$pj.getRes($O);if(null!=$g)$E.timer.frameOnce(1,null,function(){$l&&$l.runWith(1),$V&&$V.runWith($g),$H._loaderCount||$H.event("complete")});else{var $e=$w._resMap[$O];$e?($V&&$e._createListener("complete",$V.caller,$V.method,$V.args,!1,!1),$l&&$e._createListener("progress",$l.caller,$l.method,$l.args,!1,!1)):(($e=this._infoPool.length?this._infoPool.pop():new $t).url=$O,$e.clas=$j,$e.type=$T,$e.cache=$m,$e.group=$p,$e.ignoreCache=$o,$e.priority=$S,$V&&$e.on("complete",$V.caller,$V.method,$V.args),$l&&$e.on("progress",$l.caller,$l.method,$l.args),$w._resMap[$O]=$e,$S=$S<this._maxPriority?0<=$S?$S:0:this._maxPriority-1,this._resInfos[$S].push($e),this._next())}return this},$O._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $j=0;$j<this._maxPriority;$j++)for(var $O=this._resInfos[$j];0<$O.length;){var $V=$O.shift();if($V)return this._doLoad($V)}this._loaderCount||this.event("complete")}},$O._doLoad=function($O){var $V=this._loaders.length?this._loaders.pop():new $pj;this._loaderCount++,(this._loaderMap[$O.url]=$V).on("complete",null,$T),$V.on("progress",null,function($j){$O.event("progress",$j)}),$V.on("error",null,function($j){$T(null)}),$O.loader=$V;var $l=this;function $T($j){$V.offAll(),$V._data=null,$V._customParse=!1,$V._url=null,$V._class=null,$V._type=null,$l._loaders.push($V),$l._loaderCount--,delete $l._loaderMap[$O.url],$l._endLoad($O,$j instanceof Array?[$j]:$j),$l._next()}$V._class=$O.clas,1<=$O.priority?($V.priority=$O.priority,$V.realTime=!1):($V.priority=0,$V.realTime=!0),$V.load($O.url,$O.type,$O.cache,$O.group,$O.ignoreCache)},$O._endLoad=function($j,$O){var $V=$j.url;if(null==$O){var $l=this._failRes[$V]||0;if($l<this.retryNum)return console.warn("[warn]Retry to load:",$V),this._failRes[$V]=$l+1,void $E.timer.once(this.retryDelay,this,this._addReTry,[$j],!1);console.warn("[error]Failed to load:",$V),this.event("error",$V)}this._failRes[$V]&&(this._failRes[$V]=0),delete $w._resMap[$V],$j.event("complete",$O),$j.destroy(),$j.offAll(),this._infoPool.push($j)},$O._addReTry=function($j){this._resInfos[this._maxPriority-1].push($j),this._next()},$O.clearRes=function($j,$O){void 0===$O&&($O=!1),$pj.clearRes($j,$O)},$O.getRes=function($j){return $pj.getRes($j)},$O.cacheRes=function($j,$O){$pj.cacheRes($j,$O)},$O.clearTextureRes=function($j){$pj.clearTextureRes($j)},$O.setGroup=function($j,$O){$pj.setGroup($j,$O)},$O.clearResByGroup=function($j){$pj.clearResByGroup($j)},$O.clearUnLoaded=function(){for(var $j=0;$j<this._maxPriority;$j++){for(var $O=this._resInfos[$j],$V=$O.length-1;-1<$V;$V--){var $l=$O[$V];$l&&($l.destroy(),$l.offAll(),this._infoPool.push($l))}$O.length=0}this._loaderCount=0,$w._resMap={}},$O.cancelLoadByUrls=function($j){if($j)for(var $O=0,$V=$j.length;$O<$V;$O++)this.cancelLoadByUrl($j[$O])},$O.cancelLoadByUrl=function($j){for(var $O=0;$O<this._maxPriority;$O++)for(var $V=this._resInfos[$O],$l=$V.length-1;-1<$l;$l--){var $T=$V[$l];$T&&$T.url===$j&&($V[$l]=null,$T.destroy(),$T.offAll(),this._infoPool.push($T))}$w._resMap[$j]&&delete $w._resMap[$j]},$O._loadAssets=function($j,$V,$m,$O,$l,$T,$S){null==$l&&($l=2),null==$T&&($T=!0);for(var $p=$j.length,$o=0,$H=0,$g=[],$e=!0,$t=0;$t<$p;$t++){var $w=$j[$t];if(!$w)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$j);"string"==typeof $w&&($w={url:$w,type:$O,size:1,priority:$l}),$w.size||($w.size=1),$w.progress=0,$H+=$w.size,$g.push($w);var $s=$m?$a.create(null,$h,[$w],!1):null,$b=$V||$m?$a.create(null,$r,[$w]):null;this.load($w.url,$b,$s,$w.type,null!=$w.priority&&0<=$w.priority?$w.priority:2,$T,$w.group||$S)}function $r($j,$O){$o++,$j.progress=1,$O||($e=!1),$o===$p&&$V&&$V.runWith($e)}function $h($j,$O){if(null!=$m){$j.progress=$O;for(var $V=0,$l=0;$l<$g.length;$l++){var $T=$g[$l];$V+=$T.size*$T.progress}var $S=$V/$H;$m.runWith($S)}}return this},$w.cacheRes=function($j,$O){$pj.cacheRes($j,$O)},$w._resMap={},$o($w,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$w.__init$=function(){$t=function($j){function $O(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$O.__super.call(this)}return $b($O,"",$H),$O.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$O}()},$w}(),$Hj=(function($j){function $T($j){$T.__super.call(this),$j||($j=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $O=0,$V=0,$l=0;$l<20;$l++)$l%5!=4?this._mat[$O++]=$j[$l]:this._alpha[$V++]=$j[$l];this._action=$M.createFilterAction(32),this._action.data=this}$b($T,"laya.filters.ColorFilter",$h);var $O=$T.prototype;$E.imps($O,{"laya.filters.IFilter":!0}),$O.callNative=function($j){$j._$P.cf=this;$j.conchModel&&$j.conchModel.setFilterMatrix&&$j.conchModel.setFilterMatrix(this._mat,this._alpha)},$g(0,$O,"type",function(){return 32}),$g(0,$O,"action",function(){return this._action})}(),function($j){function $l($j,$O,$V){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$O&&($O=0),$l.__super.call(this),this._byteClass=$V||$N,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$j&&0<$O&&$O<65535&&this.connect($j,$O)}$b($l,"laya.net.Socket",$H);var $O=$l.prototype;$O.connect=function($j,$O){var $V="ws://"+$j+":"+$O;$V="https:"==$F.window.location.protocol?"wss://"+$j+":"+$O:"ws://"+$j+":"+$O,this.connectByUrl($V)},$O.connectByUrl=function($j){var $O=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $F.window.WebSocket($j,this.protocols):this._socket=new $F.window.WebSocket($j),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($j){$O._onOpen($j)},this._socket.onmessage=function($j){$O._onMessage($j)},this._socket.onclose=function($j){$O._onClose($j)},this._socket.onerror=function($j){$O._onError($j)}},$O.cleanSocket=function(){try{this._socket.close()}catch($j){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$O.close=function(){if(null!=this._socket)try{this._socket.close()}catch($j){}},$O._onOpen=function($j){this._connected=!0,this.event("open",$j)},$O._onMessage=function($j){if($j&&$j.data){var $O=$j.data;if(this.disableInput&&$O)this.event("message",$O);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $V=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$O&&("string"==typeof $O?this._input.writeUTFBytes($O):this._input.writeArrayBuffer($O),this._addInputPosition=this._input.pos,this._input.pos=$V),this.event("message",$O)}}},$O._onClose=function($j){this._connected=!1,this.event("close",$j)},$O._onError=function($j){this.event("error",$j)},$O.send=function($j){this._socket.send($j)},$O.flush=function(){if(this._output&&0<this._output.length){var $O;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($j){$O=$j}this._output.endian=this.endian,this._output.clear(),$O&&this.event("error",$O)}},$g(0,$O,"input",function(){return this._input}),$g(0,$O,"output",function(){return this._output}),$g(0,$O,"connected",function(){return this._connected}),$g(0,$O,"endian",function(){return this._endian},function($j){this._endian=$j,null!=this._input&&(this._input.endian=$j),null!=this._output&&(this._output.endian=$j)}),$l.LITTLE_ENDIAN="littleEndian",$l.BIG_ENDIAN="bigEndian"}(),function($j){function $p(){$p.__super.call(this),this._$1__id=++$p._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($p._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$G.currentResourceManager&&$G.currentResourceManager.addResource(this)}$b($p,"laya.resource.Resource",$H);var $O=$p.prototype;return $E.imps($O,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$O._setUrl=function($j){var $O;this._url!==$j&&(this._url&&(($O=$p._urlResourcesMap[this._url]).splice($O.indexOf(this),1),0===$O.length&&delete $p._urlResourcesMap[this._url]),$j&&(($O=$p._urlResourcesMap[$j])||($p._urlResourcesMap[$j]=$O=[]),$O.push(this)),this._url=$j)},$O._getGroup=function(){return this._group},$O._setGroup=function($j){var $O;this._group!==$j&&(this._group&&(($O=$p._groupResourcesMap[this._group]).splice($O.indexOf(this),1),0===$O.length&&delete $p._groupResourcesMap[this._group]),$j&&(($O=$p._groupResourcesMap[$j])||($p._groupResourcesMap[$j]=$O=[]),$O.push(this)),this._group=$j)},$O._addReference=function(){this._referenceCount++},$O._removeReference=function(){this._referenceCount--},$O._clearReference=function(){this._referenceCount=0},$O._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$O.recreateResource=function(){this.completeCreate()},$O.disposeResource=function(){},$O.activeResource=function($j){void 0===$j&&($j=!1),this._lastUseFrameCount=$K.loopCount,!this._destroyed&&this.__loaded&&(this._released||$j)&&this.recreateResource()},$O.releaseResource=function($j){return void 0===$j&&($j=!0),!(!$j&&this.lock)&&(!(this._released&&!$j)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$O.onAsynLoaded=function($j,$O,$V){throw new Error("Resource: must override this function!")},$O.destroy=function(){var $j;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $p._idResourcesMap[this.id],this._url&&(($j=$p._urlResourcesMap[this._url])&&($j.splice($j.indexOf(this),1),0===$j.length&&delete $p._urlResourcesMap[this.url]),$pj.clearRes(this._url),this.__loaded||$M.cancelLoadByUrl(this._url)),this._group&&(($j=$p._groupResourcesMap[this._group]).splice($j.indexOf(this),1),0===$j.length&&delete $p._groupResourcesMap[this.url]))},$O.completeCreate=function(){this._released=!1,this.event("recovered",this)},$O.dispose=function(){this.destroy()},$g(0,$O,"memorySize",function(){return this._memorySize},function($j){var $O=$j-this._memorySize;this._memorySize=$j,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$O),this.resourceManager&&this.resourceManager.addSize($O)}),$g(0,$O,"_loaded",null,function($j){this.__loaded=$j}),$g(0,$O,"loaded",function(){return this.__loaded}),$g(0,$O,"id",function(){return this._$1__id}),$g(0,$O,"destroyed",function(){return this._destroyed}),$g(0,$O,"group",function(){return this._getGroup()},function($j){this._setGroup($j)}),$g(0,$O,"resourceManager",function(){return this._resourceManager}),$g(0,$O,"url",function(){return this._url}),$g(0,$O,"released",function(){return this._released}),$g(0,$O,"referenceCount",function(){return this._referenceCount}),$p.getResourceByID=function($j){return $p._idResourcesMap[$j]},$p.getResourceByURL=function($j,$O){return void 0===$O&&($O=0),null==$p._urlResourcesMap[$j]?null:$p._urlResourcesMap[$j][$O]},$p.getResourceCountByURL=function($j){return $p._urlResourcesMap[$j].length},$p.destroyUnusedResources=function($j){var $O;if($j){var $V=$p._groupResourcesMap[$j];if($V)for(var $l=$V.slice(),$T=0,$S=$l.length;$T<$S;$T++)($O=$l[$T]).lock||0!==$O._referenceCount||$O.destroy()}else for(var $m in $p._idResourcesMap)($O=$p._idResourcesMap[$m]).lock||0!==$O._referenceCount||$O.destroy()},$p._uniqueIDCounter=0,$p._idResourcesMap={},$p._urlResourcesMap={},$p._groupResourcesMap={},$p}()),$gj=function($j){function $$($j,$O){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$$.__super.call(this),$j&&null!=$j._addReference&&$j._addReference(),this.setTo($j,$O)}$b($$,"laya.resource.Texture",$H);var $O=$$.prototype;return $O._setUrl=function($j){this.url=$j},$O.setTo=function($j,$O){if($j instanceof $m.HTMLElement){var $V=$cj.create("2D",$j);this.bitmap=$V}else this.bitmap=$j;if(this.uv=$O||$$.DEF_UV,$j){this._w=$j.width,this._h=$j.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $l=this;if(this._loaded)$M.addToAtlas&&$M.addToAtlas($l);else{var $T=$j;$T instanceof laya.resource.HTMLImage&&$T.image&&$T.image.addEventListener("load",function($j){$M.addToAtlas&&$M.addToAtlas($l)},!1)}}},$O.active=function(){this.bitmap&&this.bitmap.activeResource()},$O.destroy=function($j){if(void 0===$j&&($j=!1),this.alphaTexture&&(this.alphaTexture.destroy($j),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $O=this.bitmap;$j?($q.isConchApp&&$O.source&&$O.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$O.dispose(),$O._clearReference()):($O._removeReference(),0==$O.referenceCount&&($q.isConchApp&&$O.source&&$O.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$O.dispose())),this.url&&this===$E.loader.getRes(this.url)&&$E.loader.clearRes(this.url,$j),this._loaded=!1}},$O.load=function($j){var $O=this;this._loaded=!1,$j=$R.customFormat($j);var $V=this.bitmap||(this.bitmap=$xj.create($j));$V.uri=$j,$V&&$V._addReference();var $l=this;$V.onload=function(){$V.onload=null,$l._loaded=!0,$O.sourceWidth=$O._w=$V.width,$O.sourceHeight=$O._h=$V.height,$l.event("loaded",this),$M.addToAtlas&&$M.addToAtlas($l)}},$O.addTextureToAtlas=function($j){$M.addTextureToAtlas(this)},$O.getPixels=function($j,$O,$V,$l){if($q.isConchApp){var $T=this.bitmap;if($T.source&&$T.source.getImageData){var $S=$T.source.getImageData($j,$O,$V,$l),$m=new Uint8Array($S);return Array.from($m)}return null}return $q.isWebGL?$M.getTexturePixels(this,$j,$O,$V,$l):($F.canvas.size($V,$l),$F.canvas.clear(),$F.context.drawTexture(this,-$j,-$O,this.width,this.height,0,0),$F.context.getImageData(0,0,$V,$l).data)},$O.onAsynLoaded=function($j,$O){if($O){if("function"!=typeof $O._addReference)throw new Error("bitmap._addReference is not a function. "+$O.className+" "+typeof $O._addReference+" "+$O.constructor);$O._addReference()}this.setTo($O,this.uv),this._loaded&&this.event("loaded",this)},$g(0,$O,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$g(0,$O,"loaded",function(){return this._loaded}),$g(0,$O,"released",function(){return!this.bitmap||this.bitmap.released}),$g(0,$O,"width",function(){return this._w?this._w:this.uv&&this.uv!==$$.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($j){this._w=$j,this.sourceWidth||(this.sourceWidth=$j)}),$g(0,$O,"repeat",function(){return!$q.isWebGL||!this.bitmap||this.bitmap.repeat},function($j){$j&&$q.isWebGL&&this.bitmap&&(this.bitmap.repeat=$j)&&(this.bitmap.enableMerageInAtlas=!1)}),$g(0,$O,"height",function(){return this._h?this._h:this.uv&&this.uv!==$$.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($j){this._h=$j,this.sourceHeight||(this.sourceHeight=$j)}),$g(0,$O,"isLinearSampling",function(){return!$q.isWebGL||9728!=this.bitmap.minFifter},function($j){!$j&&$q.isWebGL&&($j||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$$.moveUV=function($j,$O,$V){for(var $l=0;$l<8;$l+=2)$V[$l]+=$j,$V[$l+1]+=$O;return $V},$$.create=function($j,$O,$V,$l,$T,$S,$m,$p,$o){void 0===$S&&($S=0),void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$o&&($o=0);var $H=$j instanceof laya.resource.Texture,$g=$H?$j.uv:$$.DEF_UV,$e=$H?$j.bitmap:$j,$t=$M.isAtlas($e);if($t){var $w=$e._atlaser,$s=$j._atlasID;if(-1==$s)throw new Error("create texture error");$e=$w._inAtlasTextureBitmapValue[$s],$g=$w._inAtlasTextureOriUVValue[$s]}var $b=new $$($e,null);$e.width&&$O+$l>$e.width&&($l=$e.width-$O),$e.height&&$V+$T>$e.height&&($T=$e.height-$V),$b.width=$l,$b.height=$T,$b.offsetX=$S,$b.offsetY=$m,$b.sourceWidth=$p||$l,$b.sourceHeight=$o||$T;var $r=1/$e.width,$h=1/$e.height;$O*=$r,$V*=$h,$l*=$r,$T*=$h;var $a=$b.uv[0],$c=$b.uv[1],$A=$b.uv[4],$Z=$b.uv[5],$x=$A-$a,$E=$Z-$c,$U=$$.moveUV($g[0],$g[1],[$O,$V,$O+$l,$V,$O+$l,$V+$T,$O,$V+$T]);$b.uv=[$a+$U[0]*$x,$c+$U[1]*$E,$A-(1-$U[2])*$x,$c+$U[3]*$E,$A-(1-$U[4])*$x,$Z-(1-$U[5])*$E,$a+$U[6]*$x,$Z-(1-$U[7])*$E],$t&&$b.addTextureToAtlas();var $z=$e.scaleRate;return $z&&1!=$z?($b.sourceWidth/=$z,$b.sourceHeight/=$z,$b.width/=$z,$b.height/=$z,$b.scaleRate=$z,$b.offsetX/=$z,$b.offsetY/=$z):$b.scaleRate=1,$b},$$.createFromTexture=function($j,$O,$V,$l,$T){var $S=$j.scaleRate;1!=$S&&($O*=$S,$V*=$S,$l*=$S,$T*=$S);var $m=$z.TEMP.setTo($O-$j.offsetX,$V-$j.offsetY,$l,$T),$p=$m.intersection($$._rect1.setTo(0,0,$j.width,$j.height),$$._rect2);if(!$p)return null;var $o=$$.create($j,$p.x,$p.y,$p.width,$p.height,$p.x-$m.x,$p.y-$m.y,$l,$T);if($o.bitmap&&$o.bitmap._removeReference)return $o.bitmap._removeReference(),$o;var $H="bitmap:"+($o.bitmap?$o.bitmap.constructor?$o.bitmap.constructor.name:$o.bitmap.__className:"")+", url:"+($j.url+" | "+($o.bitmap?$o.bitmap.url:$j.url))+", x="+$O+",y="+$V+",width="+$l+",height="+$T+", result="+($p?$p.x+","+$p.y+","+$p.width+","+$p.height:"null")+", rect="+$m.x+","+$m.y+","+$m.width+","+$m.height;throw new Error("报错：bitmap._removeReference is not a function  "+$H)},$$.DEF_UV=[0,0,1,0,1,1,0,1],$$.INV_UV=[0,1,1,1,1,0,0,0],$$._rect1=new $z,$$._rect2=new $z,$$}(),$j=function($j){var $p;function $S(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$S.__super.call(this)}$b($S,"laya.utils.TimeLine",$H);var $O=$S.prototype;return $O.to=function($j,$O,$V,$l,$T){return void 0===$T&&($T=0),this._create($j,$O,$V,$l,$T,!0)},$O.from=function($j,$O,$V,$l,$T){return void 0===$T&&($T=0),this._create($j,$O,$V,$l,$T,!1)},$O._create=function($j,$O,$V,$l,$T,$S){var $m=$W.getItemByClass("tweenData",$p);return $m.isTo=$S,$m.type=0,$m.target=$j,$m.duration=$V,$m.data=$O,$m.startTime=this._startTime+$T,$m.endTime=$m.startTime+$m.duration,$m.ease=$l,this._startTime=Math.max($m.endTime,this._startTime),this._tweenDataList.push($m),this._startTimeSort=!0,this._endTimeSort=!0,this},$O.addLabel=function($j,$O){var $V=$W.getItemByClass("tweenData",$p);return $V.type=1,$V.data=$j,$V.endTime=$V.startTime=this._startTime+$O,this._labelDic||(this._labelDic={}),this._labelDic[$j]=$V,this._tweenDataList.push($V),this},$O.removeLabel=function($j){if(this._labelDic&&this._labelDic[$j]){var $O=this._labelDic[$j];if($O){var $V=this._tweenDataList.indexOf($O);-1<$V&&this._tweenDataList.splice($V,1)}delete this._labelDic[$j]}},$O.gotoTime=function($j){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $O,$V,$l,$T;for(var $S in this._firstTweenDic)if($V=this._firstTweenDic[$S])for(var $m in $V)$V.diyTarget.hasOwnProperty($m)&&($V.diyTarget[$m]=$V[$m]);for($S in this._tweenDic)($O=this._tweenDic[$S]).clear(),delete this._tweenDic[$S];if(this._index=0,this._gidIndex=0,this._currTime=$j,this._lastTime=$F.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$l=this._tweenDataList.concat(),$l.sort(function($j,$O){return $j.endTime>$O.endTime?1:$j.endTime<$O.endTime?-1:0})}else $l=this._endTweenDataList;for(var $p=0,$o=$l.length;$p<$o;$p++)if(0==($T=$l[$p]).type){if(!($j>=$T.endTime))break;this._index=Math.max(this._index,$p+1);var $H=$T.data;if($T.isTo)for(var $g in $H)$T.target[$g]=$H[$g]}for($p=0,$o=this._tweenDataList.length;$p<$o;$p++)0==($T=this._tweenDataList[$p]).type&&$j>=$T.startTime&&$j<$T.endTime&&(this._index=Math.max(this._index,$p+1),this._gidIndex++,($O=$W.getItemByClass("tween",$L))._create($T.target,$T.data,$T.duration,$T.ease,$a.create(this,this._animComplete,[this._gidIndex]),0,!1,$T.isTo,!0,!1),$O.setStartTime(this._currTime-($j-$T.startTime)),$O._updateEase(this._currTime),$O.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$O)}},$O.gotoLabel=function($j){if(null!=this._labelDic){var $O=this._labelDic[$j];$O&&this.gotoTime($O.startTime)}},$O.pause=function(){$E.timer.clear(this,this._update)},$O.resume=function(){this.play(this._currTime,this._loopKey)},$O.play=function($j,$O){if(void 0===$j&&($j=0),void 0===$O&&($O=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($j,$O){return $j.startTime>$O.startTime?1:$j.startTime<$O.startTime?-1:0});for(var $V=0,$l=this._tweenDataList.length;$V<$l;$V++){var $T=this._tweenDataList[$V];if(null!=$T&&0==$T.type){var $S=$T.target,$m=$S.$_GID||($S.$_GID=$Q.getGID()),$p=null;for(var $o in null==this._firstTweenDic[$m]?(($p={}).diyTarget=$S,this._firstTweenDic[$m]=$p):$p=this._firstTweenDic[$m],$T.data)null==$p[$o]&&($p[$o]=$S[$o])}}}"string"==typeof $j?this.gotoLabel($j):this.gotoTime($j),this._loopKey=$O,this._lastTime=$F.now(),$E.timer.frameLoop(1,this,this._update)}},$O._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $j in this._tweenDic)($O=this._tweenDic[$j]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $O,$V=$F.now(),$l=$V-this._lastTime,$T=this._currTime+=$l*this.scale;for($j in this._lastTime=$V,this._tweenDic)($O=this._tweenDic[$j])._updateEase($T);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $S=this._tweenDataList[this._index];$T>=$S.startTime&&(this._index++,0==$S.type?(this._gidIndex++,($O=$W.getItemByClass("tween",$L))._create($S.target,$S.data,$S.duration,$S.ease,$a.create(this,this._animComplete,[this._gidIndex]),0,!1,$S.isTo,!0,!1),$O.setStartTime($T),$O.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$O)._updateEase($T)):this.event("label",$S.data))}},$O._animComplete=function($j){this._tweenDic[$j]&&delete this._tweenDic[$j]},$O._complete=function(){this.event("complete")},$O.reset=function(){var $j;if(this._labelDic)for($j in this._labelDic)delete this._labelDic[$j];for($j in this._tweenDic)this._tweenDic[$j].clear(),delete this._tweenDic[$j];for($j in this._firstTweenDic)delete this._firstTweenDic[$j];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $O,$V=0;for($O=this._tweenDataList.length,$V=0;$V<$O;$V++)this._tweenDataList[$V]&&this._tweenDataList[$V].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$E.timer.clear(this,this._update)},$O.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$g(0,$O,"index",function(){return this._frameIndex},function($j){this._frameIndex=$j,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$g(0,$O,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$S.to=function($j,$O,$V,$l,$T){return void 0===$T&&($T=0),(new $S).to($j,$O,$V,$l,$T)},$S.from=function($j,$O,$V,$l,$T){return void 0===$T&&($T=0),(new $S).from($j,$O,$V,$l,$T)},$S.__init$=function(){$p=function(){function $j(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $b($j,""),$j.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$W.recover("tweenData",this)},$j}()},$S}(),$ej=function($T){function $V(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$V.__super.call(this),this._style=$p.EMPTY}$b($V,"laya.display.Sprite",$T);var $j=$V.prototype;return $E.imps($j,{"laya.display.ILayout":!0}),$j.createConchModel=function(){return new ConchNode},$j.destroy=function($j){if(void 0===$j&&($j=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $O=this.mask;$O&&(this.mask=null,$O.destroy($j))}$T.prototype.destroy.call(this,$j),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$j.updateZOrder=function(){$Q.updateOrder(this._childs)&&this.repaint()},$j.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$j.setBounds=function($j){this._set$P("uBounds",$j)},$j.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $z),$z._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$j.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $z),$z._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$j._boundPointsToParent=function($j){void 0===$j&&($j=!1);var $O=0,$V=0;this._style&&($O=this._style._tf.translateX,$V=this._style._tf.translateY,$j=$j||0!==this._style._tf.rotate,this._style.scrollRect&&($O+=this._style.scrollRect.x,$V+=this._style.scrollRect.y));var $l=this._getBoundPointsM($j);if(!$l||$l.length<1)return $l;if(8!=$l.length&&($l=$j?$Z.scanPList($l):$z._getWrapRec($l,$z.TEMP)._getBoundPoints()),!this.transform)return $Q.transPointList($l,this._x-$O,this._y-$V),$l;var $T=$U.TEMP,$S=0,$m=$l.length;for($S=0;$S<$m;$S+=2)$T.x=$l[$S],$T.y=$l[$S+1],this.toParentPoint($T),$l[$S]=$T.x,$l[$S+1]=$T.y;return $l},$j.getGraphicBounds=function($j){return void 0===$j&&($j=!1),this._graphics?this._graphics.getBounds($j):$z.TEMP.setTo(0,0,0,0)},$j._getBoundPointsM=function($j){if(void 0===$j&&($j=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $O=$Q.clearArray(this._$P.temBM),$V=$z.TEMP;return $V.copyFrom(this.scrollRect),$Q.concatArray($O,$V._getBoundPoints()),$O}for(var $l,$T,$S,$m=this._graphics?this._graphics.getBoundPoints():$Q.clearArray(this._$P.temBM),$p=0,$o=($S=this._childs).length;$p<$o;$p++)($l=$S[$p])instanceof laya.display.Sprite&&1==$l.visible&&($T=$l._boundPointsToParent($j))&&($m=$m?$Q.concatArray($m,$T):$T);return $m},$j.getStyle=function(){return this._style===$p.EMPTY&&(this._style=new $p),this._style},$j.setStyle=function($j){this._style=$j},$j._adjustTransform=function(){this._tfChanged=!1;var $j,$O=this._style._tf,$V=$O.scaleX,$l=$O.scaleY;if($O.rotate||1!==$V||1!==$l||$O.skewX||$O.skewY){($j=this._transform||(this._transform=$v.create())).bTransform=!0;var $T=.0174532922222222*($O.rotate-$O.skewX),$S=.0174532922222222*($O.rotate+$O.skewY),$m=Math.cos($S),$p=Math.sin($S),$o=Math.sin($T),$H=Math.cos($T);return $j.a=$V*$m,$j.b=$V*$p,$j.c=-$l*$o,$j.d=$l*$H,$j.tx=$j.ty=0,$j}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$j},$j.pos=function($j,$O,$V){if(void 0===$V&&($V=!1),this._x!==$j||this._y!==$O){if(this.destroyed)return this;if($V){this._x=$j,this._y=$O,this.conchModel&&this.conchModel.pos(this._x,this._y);var $l=this._parent;$l&&0===$l._repaint&&($l._repaint=1,$l.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$j,this.y=$O}return this},$j.pivot=function($j,$O){return this.pivotX=$j,this.pivotY=$O,this},$j.size=function($j,$O){return this.width=$j,this.height=$O,this},$j.scale=function($j,$O,$V){void 0===$V&&($V=!1);var $l=this.getStyle(),$T=$l._tf;if($T.scaleX!=$j||$T.scaleY!=$O){if(this.destroyed)return this;if($V){$l.setScale($j,$O),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($j,$O),this._renderType|=4;var $S=this._parent;$S&&0===$S._repaint&&($S._repaint=1,$S.parentRepaint())}else this.scaleX=$j,this.scaleY=$O}return this},$j.skew=function($j,$O){return this.skewX=$j,this.skewY=$O,this},$j.render=function($j,$O,$V){$K.spriteCount++,$k.renders[this._renderType]._fun(this,$j,$O+this._x,$V+this._y),this._repaint=0},$j.drawToCanvas=function($j,$O,$V,$l){if($q.isConchNode){var $T=$cj.create("2D");return new $i($j,$O,$T).ctx.setCanvasType(1),this.conchModel.drawToCanvas($T.source,$V,$l),$T}return $M.drawToCanvas(this,this._renderType,$j,$O,$V,$l)},$j.customRender=function($j,$O,$V){this._renderType|=1024},$j._applyFilters=function(){var $j;if(!$q.isWebGL&&(($j=this._$P.filters)&&!($j.length<1)))for(var $O=0,$V=$j.length;$O<$V;$O++)$j[$O].action.apply(this._$P.cacheCanvas)},$j._isHaveGlowFilter=function(){var $j,$O=0;if(this.filters)for($O=0;$O<this.filters.length;$O++)if(8==this.filters[$O].type)return!0;for($O=0,$j=this._childs.length;$O<$j;$O++)if(this._childs[$O]._isHaveGlowFilter())return!0;return!1},$j.localToGlobal=function($j,$O){void 0===$O&&($O=!1),!0===$O&&($j=new $U($j.x,$j.y));for(var $V=this;$V&&$V!=$E.stage;)$j=$V.toParentPoint($j),$V=$V.parent;return $j},$j.globalToLocal=function($j,$O){void 0===$O&&($O=!1),$O&&($j=new $U($j.x,$j.y));for(var $V=this,$l=[];$V&&$V!=$E.stage;)$l.push($V),$V=$V.parent;for(var $T=$l.length-1;0<=$T;)$j=($V=$l[$T]).fromParentPoint($j),$T--;return $j},$j.toParentPoint=function($j){if(!$j)return $j;$j.x-=this.pivotX,$j.y-=this.pivotY,this.transform&&this._transform.transformPoint($j),$j.x+=this._x,$j.y+=this._y;var $O=this._style.scrollRect;return $O&&($j.x-=$O.x,$j.y-=$O.y),$j},$j.fromParentPoint=function($j){if(!$j)return $j;$j.x-=this._x,$j.y-=this._y;var $O=this._style.scrollRect;return $O&&($j.x+=$O.x,$j.y+=$O.y),this.transform&&this._transform.invertTransformPoint($j),$j.x+=this.pivotX,$j.y+=this.pivotY,$j},$j.on=function($j,$O,$V,$l){return 1!==this._mouseEnableState&&this.isMouseEvent($j)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($j,$O,$V,$l,!1)):$T.prototype.on.call(this,$j,$O,$V,$l)},$j.once=function($j,$O,$V,$l){return 1!==this._mouseEnableState&&this.isMouseEvent($j)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($j,$O,$V,$l,!0)):$T.prototype.once.call(this,$j,$O,$V,$l)},$j._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $j=this;for($j=$j.parent;$j&&1!==$j._mouseEnableState&&!$j._getBit(2);)$j.mouseEnabled=!0,$j._setBit(2,!0),$j=$j.parent}},$j.loadImage=function($j,$O,$V,$l,$T,$S){var $m=this;return void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0),void 0===$T&&($T=0),this.graphics.loadImage($j,$O,$V,$l,$T,function($j){$m.destroyed||($m.size($O+($l||$j.width),$V+($T||$j.height)),$m.repaint(),$S&&$S.runWith($j))}),this},$j.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$j._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$j._childChanged=function($j){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$j&&this._get$P("hasZorder")&&$E.timer.callLater(this,this.updateZOrder),this.repaint()},$j.parentRepaint=function(){var $j=this._parent;$j&&0===$j._repaint&&($j._repaint=1,$j.parentRepaint())},$j.startDrag=function($j,$O,$V,$l,$T,$S,$m){void 0===$O&&($O=!1),void 0===$V&&($V=0),void 0===$l&&($l=300),void 0===$S&&($S=!1),void 0===$m&&($m=.92),this._$P.dragging||this._set$P("dragging",new $J),this._$P.dragging.start(this,$j,$O,$V,$l,$T,$S,$m)},$j.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$j._releaseMem=function(){if(this._$P){var $j=this._$P.cacheCanvas;$j&&$j.ctx&&($W.recover("RenderContext",$j.ctx),$j.ctx.canvas.size(0,0),$j.ctx=null);var $O=this._$P._filterCache;$O&&($O.destroy(),$O.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$j._setDisplay=function($j){$j||this._releaseMem(),$T.prototype._setDisplay.call(this,$j)},$j.hitTestPoint=function($j,$O){var $V=this.globalToLocal($U.TEMP.setTo($j,$O));return $j=$V.x,$O=$V.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$z.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($j,$O)},$j.getMousePoint=function(){return this.globalToLocal($U.TEMP.setTo($E.stage.mouseX,$E.stage.mouseY))},$j._getWords=function(){return null},$j._addChildsToLayout=function($j){var $O=this._getWords();if(null==$O&&0==this._childs.length)return!1;if($O)for(var $V=0,$l=$O.length;$V<$l;$V++)$j.push($O[$V]);$V=0;for(var $T=this._childs.length;$V<$T;++$V){var $S=this._childs[$V];$S._style._enableLayout()&&$S._addToLayout($j)}return!0},$j._addToLayout=function($j){this._style.absolute||(this._style.block?$j.push(this):this._addChildsToLayout($j)&&(this.x=this.y=0))},$j._isChar=function(){return!1},$j._getCSSStyle=function(){return this._style.getCSSStyle()},$j._setAttributes=function($j,$O){switch($j){case"x":this.x=parseFloat($O);break;case"y":this.y=parseFloat($O);break;case"width":this.width=parseFloat($O);break;case"height":this.height=parseFloat($O);break;default:this[$j]=$O}},$j._layoutLater=function(){this.parent&&this.parent._layoutLater()},$g(0,$j,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($j){this._optimizeScrollRect!=$j&&(this._optimizeScrollRect=$j,this.conchModel&&this.conchModel.optimizeScrollRect($j))}),$g(0,$j,"customRenderEnable",null,function($j){if($j&&(this._renderType|=1024,$q.isConchNode)){$V.CustomList.push(this);var $O=new $cj("2d");$O._setContext(new CanvasRenderingContext2D),this.customContext=new $i(0,0,$O),$O.context.setCanvasType&&$O.context.setCanvasType(2),this.conchModel.custom($O.context)}}),$g(0,$j,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($j){this.cacheAs=$j?this._$P.hasFilter?"none":"normal":"none"}),$g(0,$j,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($j){var $O=this._$P.cacheCanvas;if($j!==($O?$O.type:"none")){if("none"!==$j)this._getBit(1)||this._setUpNoticeType(1),$O||($O=this._set$P("cacheCanvas",$W.getItemByClass("cacheCanvas",Object))),$O.type=$j,$O.reCache=!0,this._renderType|=16,"bitmap"==$j&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($O){var $V=$O;$V&&$V.ctx&&($W.recover("RenderContext",$V.ctx),$V.ctx.canvas.size(0,0),$V.ctx=null),$W.recover("cacheCanvas",$O)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$g(0,$j,"zOrder",function(){return this._zOrder},function($j){this._zOrder!=$j&&(this._zOrder=$j,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($j),this._parent&&($j&&this._parent._set$P("hasZorder",!0),$E.timer.callLater(this._parent,this.updateZOrder)))}),$g(0,$j,"rotation",function(){return this._style._tf.rotate},function($j){var $O=this.getStyle();if($O._tf.rotate!==$j){$O.setRotate($j),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($j),this._renderType|=4;var $V=this._parent;$V&&0===$V._repaint&&($V._repaint=1,$V.parentRepaint())}}),$g(0,$j,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($j){this._width!==$j&&(this._width=$j,this.conchModel&&this.conchModel.size($j,this._height),this.repaint())}),$g(0,$j,"x",function(){return this._x},function($j){if(this._x!==$j){if(this.destroyed)return;this._x=$j,this.conchModel&&this.conchModel.pos($j,this._y);var $O=this._parent;$O&&0===$O._repaint&&($O._repaint=1,$O.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$g(0,$j,"globalScaleY",function(){for(var $j=1,$O=this;$O&&$O!==$E.stage;)$j*=$O.scaleY,$O=$O.parent;return $j}),$g(0,$j,"hitArea",function(){return this._$P.hitArea},function($j){this._set$P("hitArea",$j)}),$g(0,$j,"staticCache",function(){return this._$P.staticCache},function($j){this._set$P("staticCache",$j),$j||this.reCache()}),$g(0,$j,"texture",function(){return this._texture},function($j){this._texture!=$j&&(this._texture=$j,this.graphics.cleanByTexture($j,0,0))}),$g(0,$j,"y",function(){return this._y},function($j){if(this._y!==$j){if(this.destroyed)return;this._y=$j,this.conchModel&&this.conchModel.pos(this._x,$j);var $O=this._parent;$O&&0===$O._repaint&&($O._repaint=1,$O.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$g(0,$j,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($j){this._height!==$j&&(this._height=$j,this.conchModel&&this.conchModel.size(this._width,$j),this.repaint())}),$g(0,$j,"blendMode",function(){return this._style.blendMode},function($j){this.getStyle().blendMode=$j,this.conchModel&&this.conchModel.blendMode($j),$j&&"source-over"!=$j?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$g(0,$j,"scaleX",function(){return this._style._tf.scaleX},function($j){var $O=this.getStyle();if($O._tf.scaleX!==$j){$O.setScaleX($j),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($j,$O._tf.scaleY),this._renderType|=4;var $V=this._parent;$V&&0===$V._repaint&&($V._repaint=1,$V.parentRepaint())}}),$g(0,$j,"scaleY",function(){return this._style._tf.scaleY},function($j){var $O=this.getStyle();if($O._tf.scaleY!==$j){$O.setScaleY($j),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($O._tf.scaleX,$j),this._renderType|=4;var $V=this._parent;$V&&0===$V._repaint&&($V._repaint=1,$V.parentRepaint())}}),$g(0,$j,"stage",function(){return $E.stage}),$g(0,$j,"skewX",function(){return this._style._tf.skewX},function($j){var $O=this.getStyle();if($O._tf.skewX!==$j){$O.setSkewX($j),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($j,$O._tf.skewY),this._renderType|=4;var $V=this._parent;$V&&0===$V._repaint&&($V._repaint=1,$V.parentRepaint())}}),$g(0,$j,"scrollRect",function(){return this._style.scrollRect},function($j){this.getStyle().scrollRect=$j,this.repaint(),$j?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($j.x,$j.y,$j.width,$j.height)):(this._renderType&=-129,this.conchModel&&($V.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$g(0,$j,"skewY",function(){return this._style._tf.skewY},function($j){var $O=this.getStyle();if($O._tf.skewY!==$j){$O.setSkewY($j),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($O._tf.skewX,$j),this._renderType|=4;var $V=this._parent;$V&&0===$V._repaint&&($V._repaint=1,$V.parentRepaint())}}),$g(0,$j,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($j){this._tfChanged=!1,(this._transform=$j)&&(this._x=$j.tx,this._y=$j.ty,$j.tx=$j.ty=0,this.conchModel&&this.conchModel.transform($j.a,$j.b,$j.c,$j.d,this._x,this._y)),$j?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$g(0,$j,"pivotX",function(){return this._style._tf.translateX},function($j){this.getStyle().setTranslateX($j),this.conchModel&&this.conchModel.pivot($j,this._style._tf.translateY),this.repaint()}),$g(0,$j,"pivotY",function(){return this._style._tf.translateY},function($j){this.getStyle().setTranslateY($j),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$j),this.repaint()}),$g(0,$j,"alpha",function(){return this._style.alpha},function($j){this._style&&this._style.alpha!==$j&&($j=$j<0?0:1<$j?1:$j,this.getStyle().alpha=$j,this.conchModel&&this.conchModel.alpha($j),1!==$j?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$g(0,$j,"visible",function(){return this._style.visible},function($j){this._style&&this._style.visible!==$j&&(this.getStyle().visible=$j,this.conchModel&&this.conchModel.visible($j),this.parentRepaint())}),$g(0,$j,"graphics",function(){return this._graphics||(this.graphics=$M.createGraphics())},function($j){this._graphics&&(this._graphics._sp=null),(this._graphics=$j)?(this._renderType&=-2,this._renderType|=512,($j._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($V.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$g(0,$j,"filters",function(){return this._$P.filters},function($j){$j&&0===$j.length&&($j=null),this._$P.filters!=$j&&(this._set$P("filters",$j?$j.slice():null),$q.isConchApp&&(this.conchModel&&($V.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$q.isWebGL&&($j&&$j.length?this._renderType|=32:this._renderType&=-33),$j&&0<$j.length?(this._getBit(1)||this._setUpNoticeType(1),$q.isWebGL&&1==$j.length&&$j[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($q.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$g(0,$j,"parent",$T.prototype._$get_parent,function($j){$E.superSet($jj,this,"parent",$j),$j&&this._getBit(2)&&this._$2__onDisplay()}),$g(0,$j,"mask",function(){return this._$P._mask},function($j){$j&&this.mask&&this.mask._$P.maskParent||($j?(this.cacheAs="bitmap",this._set$P("_mask",$j),$j._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$j),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($j?$j.conchModel:null),this._renderType|=64,this.parentRepaint())}),$g(0,$j,"mouseEnabled",function(){return 1<this._mouseEnableState},function($j){this._mouseEnableState=$j?2:1}),$g(0,$j,"globalScaleX",function(){for(var $j=1,$O=this;$O&&$O!==$E.stage;)$j*=$O.scaleX,$O=$O.parent;return $j}),$g(0,$j,"mouseX",function(){return this.getMousePoint().x}),$g(0,$j,"mouseY",function(){return this.getMousePoint().y}),$V.fromImage=function($j){return(new $V).loadImage($j)},$V._cachePool=[],$V.CustomList=[],$o($V,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$m.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$V}($jj),$tj=function($j){function $O($j){this._audio=null,this._onEnd=null,this._resumePlay=null,$O.__super.call(this),this._onEnd=$Q.bind(this.__onEnd,this),this._resumePlay=$Q.bind(this.__resumePlay,this),$j.addEventListener("ended",this._onEnd),this._audio=$j}$b($O,"laya.media.h5audio.AudioSoundChannel",$lj);var $V=$O.prototype;return $V.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($E.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$V.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$F.container.appendChild(this._audio),this._audio.play()}catch($j){this.event("error")}},$V.play=function($j){this.isStopped=!1;try{this._audio.playbackRate=$B.playbackRate,this._audio.currentTime=this.startTime}catch($j){return void this._audio.addEventListener("canplay",this._resumePlay)}$B.addChannel(this),$F.container.appendChild(this._audio),!$j&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$V.stop=function(){this.isStopped=!0,$B.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$q.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$F.onIE||this._audio!=$Vj._musicAudio&&$W.recover("audio:"+this.url,this._audio),$F.removeElement(this._audio),this._audio=null)},$V.pause=function(){this.isStopped=!0,$B.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$V.resume=function(){this._audio&&(this.isStopped=!1,$B.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$g(0,$V,"position",function(){return this._audio?this._audio.currentTime:0}),$g(0,$V,"duration",function(){return this._audio?this._audio.duration:0}),$g(0,$V,"volume",function(){return this._audio?this._audio.volume:1},function($j){this._audio&&(this._audio.volume=$j)}),$O}(),$wj=function($j){function $O(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$Sj.ctx,$O.__super.call(this),this._onPlayEnd=$Q.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$b($O,"laya.media.webaudio.WebAudioSoundChannel",$lj);var $V=$O.prototype;return $V.play=function($j){if($B.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $O=this.context,$V=this.gain,$l=$O.createBufferSource();(this.bufferSource=$l).buffer=this.audioBuffer,$l.connect($V),$V&&$V.disconnect(),$V.connect($O.destination),$l.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$F.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($l.loop=!0),$l.playbackRate.setTargetAtTime?$l.playbackRate.setTargetAtTime($B.playbackRate,this.context.currentTime,.1):$l.playbackRate.value=$B.playbackRate,$l.start(0,this.startTime),!$j&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$V.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($E.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$V._clearBufferSource=function(){if(this.bufferSource){var $j=this.bufferSource;$j.stop?$j.stop(0):$j.noteOff(0),$j.disconnect(0),$j.onended=null,$O._tryCleanFailed||this._tryClearBuffer($j),this.bufferSource=null}},$V._tryClearBuffer=function($j){try{$j.buffer=null}catch($j){$O._tryCleanFailed=!0}},$V.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$B.removeChannel(this),this.startHandler=null,this.completeHandler=null},$V.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$B.removeChannel(this)},$V.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$g(0,$V,"position",function(){return this.bufferSource?($F.now()-this._startTime)/1e3+this.startTime:0}),$g(0,$V,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$g(0,$V,"volume",function(){return this._volume},function($j){this.isStopped||(this._volume=$j,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($j,this.context.currentTime,.1):this.gain.gain.value=$j)}),$O._tryCleanFailed=!1,$O}(),$sj=function($j){function $O(){$O.__super.call(this),this._w=0,this._h=0}$b($O,"laya.resource.Bitmap",$Hj);var $V=$O.prototype;return $g(0,$V,"width",function(){return this._w}),$g(0,$V,"height",function(){return this._h}),$g(0,$V,"source",function(){return this._source}),$O}(),$bj=function($O){function $j(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$j.__super.call(this),this._interval=$l.animationInterval,this._setUpNoticeType(1)}$b($j,"laya.display.AnimationPlayerBase",$O);var $V=$j.prototype;return $V.play=function($j,$O,$V,$l){void 0===$j&&($j=0),void 0===$O&&($O=!0),void 0===$V&&($V=""),void 0===$l&&($l=!0),this._isPlaying=!0,this.index="string"==typeof $j?this._getFrameByLabel($j):$j,this.loop=$O,this._actionName=$V,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$V._getFrameByLabel=function($j){var $O=0;for($O=0;$O<this._count;$O++)if(this._labels[$O]&&0<=this._labels[$O].indexOf($j))return $O;return 0},$V._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$V._setControlNode=function($j){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$j)&&$j!=this&&($j.on("display",this,this._checkResumePlaying),$j.on("undisplay",this,this._checkResumePlaying))},$V._setDisplay=function($j){$O.prototype._setDisplay.call(this,$j),this._checkResumePlaying()},$V._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$V.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$V.addLabel=function($j,$O){this._labels||(this._labels={}),this._labels[$O]||(this._labels[$O]=[]),this._labels[$O].push($j)},$V.removeLabel=function($j){if($j){if(this._labels)for(var $O in this._labels)this._removeLabelFromLabelList(this._labels[$O],$j)}else this._labels=null},$V._removeLabelFromLabelList=function($j,$O){if($j)for(var $V=$j.length-1;0<=$V;$V--)$j[$V]==$O&&$j.splice($V,1)},$V.gotoAndStop=function($j){this.index="string"==typeof $j?this._getFrameByLabel($j):$j,this.stop()},$V._displayToIndex=function($j){},$V.clear=function(){this.stop(),this._labels=null},$g(0,$V,"interval",function(){return this._interval},function($j){this._interval!=$j&&(this._frameRateChanged=!0,this._interval=$j,this._isPlaying&&0<$j&&this.timerLoop($j,this,this._frameLoop,null,!0,!0))}),$g(0,$V,"isPlaying",function(){return this._isPlaying}),$g(0,$V,"index",function(){return this._index},function($j){if(this._index=$j,this._displayToIndex($j),this._labels&&this._labels[$j])for(var $O=this._labels[$j],$V=0,$l=$O.length;$V<$l;$V++)this.event("label",$O[$V])}),$g(0,$V,"count",function(){return this._count}),$j.WRAP_POSITIVE=0,$j.WRAP_REVERSE=1,$j.WRAP_PINGPONG=2,$j}($ej),$rj=function($O){function $w(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$w.__super.call(this),this.overflow=$w.VISIBLE,this._style=new $Oj(this),this._style.wordWrap=!1}$b($w,"laya.display.Text",$O);var $j=$w.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$j._getBoundPointsM=function($j){void 0===$j&&($j=!1);var $O=$z.TEMP;return $O.setTo(0,0,this.width,this.height),$O._getBoundPoints()},$j.getGraphicBounds=function($j){void 0===$j&&($j=!1);var $O=$z.TEMP;return $O.setTo(0,0,this.width,this.height),$O},$j._getCSSStyle=function(){return this._style},$j.lang=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g){if($j=$w.langPacks&&$w.langPacks[$j]?$w.langPacks[$j]:$j,arguments.length<2)this._text=$j;else{for(var $e=0,$t=arguments.length;$e<$t;$e++)$j=$j.replace("{"+$e+"}",arguments[$e+1]);this._text=$j}},$j._isPassWordMode=function(){var $j=this._style.password;return"prompt"in this&&this.prompt==this._text&&($j=!1),$j},$j._getPassWordTxt=function($j){var $O;$O="";for(var $V=$j.length;0<$V;$V--)$O+="●";return $O},$j.renderText=function($j,$O){var $V=this.graphics;$V.clear(!0);var $l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($F.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$F.context.font=$l;var $T=this.padding,$S=$T[3],$m="left",$p=this._lines,$o=this.leading+this._charSize.height,$H=this._currBitmapFont;$H&&($o=this.leading+$H.getMaxHeight());var $g=$T[0];if(!$H&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($m="right",$S=this._width-$T[1]):"center"==this.align&&($m="center",$S=.5*this._width+$T[3]-$T[1])),0<this._height){var $e=this._textHeight>this._height?"top":this.valign;"middle"===$e?$g=.5*(this._height-$O*$o)+$T[0]-$T[2]:"bottom"===$e&&($g=this._height-$O*$o-$T[2])}var $t=this._style;if($H&&$H.autoScaleSize)var $w=$H.fontSize/this.fontSize;if(this._clipPoint)if($V.save(),$H&&$H.autoScaleSize){var $s=0,$b=0;$s=this._width?this._width-$T[3]-$T[1]:this._textWidth,$b=this._height?this._height-$T[0]-$T[2]:this._textHeight,$s*=$w,$b*=$w,$V.clipRect($T[3],$T[0],$s,$b)}else $V.clipRect($T[3],$T[0],this._width?this._width-$T[3]-$T[1]:this._textWidth,this._height?this._height-$T[0]-$T[2]:this._textHeight);var $r=$t.password;"prompt"in this&&this.prompt==this._text&&($r=!1);for(var $h=0,$a=0,$c=Math.min(this._lines.length,$O+$j)||1,$A=$j;$A<$c;$A++){var $Z,$x=$p[$A];if($r){var $E=$x.length;$x="";for(var $U=$E;0<$U;$U--)$x+="●"}if($h=$S-(this._clipPoint?this._clipPoint.x:0),$a=$g+$o*$A-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($m,$h,$a,$A),$H){var $z=this.width;$H.autoScaleSize&&($z=this.width*$w),$H.drawText($x,this,$h,$a,this.align,$z)}else $q.isWebGL?(this._words||(this._words=[]),($Z=this._words.length>$A-$j?this._words[$A-$j]:new $P).setText($x)):$Z=$x,$t.stroke?$V.fillBorderText($Z,$h,$a,$l,this.color,$t.strokeColor,$t.stroke,$m):$V.fillText($Z,$h,$a,$l,this.color,$m)}if($H&&$H.autoScaleSize){var $$=1/$w;this.scale($$,$$)}this._clipPoint&&$V.restore(),this._startX=$S,this._startY=$g},$j.drawUnderline=function($j,$O,$V,$l){var $T=this._lineWidths[$l];switch($j){case"center":$O-=$T/2;break;case"right":$O-=$T}$V+=this._charSize.height,this._graphics.drawLine($O,$V,$O+$T,$V,this.underlineColor||this.color,1)},$j.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$F.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $U(0,0)):this._clipPoint=null;var $j=this._lines.length;if(this.overflow!=$w.VISIBLE){var $O=this.overflow==$w.HIDDEN?Math.floor:Math.ceil;$j=Math.min($j,$O((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $V=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($V,$j),this.repaint()},$j.evalTextSize=function(){var $j,$O=NaN;$j=Math.max.apply(this,this._lineWidths),$O=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$j==this._textWidth&&$O==this._textHeight||(this._textWidth=$j,this._textHeight=$O,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$j.checkEnabledViewportOrNot=function(){return this.overflow==$w.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$j.changeText=function($j){this._text!==$j&&(this.lang($j+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$j.parseLines=function($j){var $O=this.wordWrap||this.overflow==$w.HIDDEN;if($O)var $V=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $l=$Q.contextMeasureText($w._testWord);$q.isConchApp&&0===$l.width&&0===$l.height&&($l=$Q.contextMeasureText("W")),this._charSize.width=$l.width,this._charSize.height=$l.height||this.fontSize}for(var $T=$j.replace(/\r\n/g,"\n").split("\n"),$S=0,$m=$T.length;$S<$m;$S++){var $p=$T[$S];$O?this.parseLine($p,$V):(this._lineWidths.push(this.getTextWidth($p)),this._lines.push($p))}},$j.parseLine=function($j,$O){$F.context;var $V,$l=this._lines,$T=0,$S=NaN,$m=NaN,$p=0;if(($S=this.getTextWidth($j))<=$O)return $l.push($j),void this._lineWidths.push($S);$S=this._charSize.width,0==($T=Math.floor($O/$S))&&($T=1),$m=$S=this.getTextWidth($j.substring(0,$T));for(var $o=$T,$H=$j.length;$o<$H;$o++)if($O<($m+=$S=this.getTextWidth($j.charAt($o))))if(this.wordWrap){var $g=$j.substring($p,$o);if($g.charCodeAt($g.length-1)<255?($V=/(?:\w|-)+$/.exec($g))&&($o=$V.index+$p,0==$V.index?$o+=$g.length:$g=$j.substring($p,$o)):$w.RightToLeft&&($V=/([\u0600-\u06FF])+$/.exec($g))&&($o=$V.index+$p,0==$V.index?$o+=$g.length:$g=$j.substring($p,$o)),$l.push($g),this._lineWidths.push($m-$S),!(($p=$o)+$T<$H)){$l.push($j.substring($p,$H)),this._lineWidths.push(this.getTextWidth($l[$l.length-1])),$p=-1;break}$o+=$T,$m=$S=this.getTextWidth($j.substring($p,$o)),$o--}else if(this.overflow==$w.HIDDEN)return $l.push($j.substring(0,$o)),void this._lineWidths.push(this.getTextWidth($l[$l.length-1]));this.wordWrap&&-1!=$p&&($l.push($j.substring($p,$H)),this._lineWidths.push(this.getTextWidth($l[$l.length-1])))},$j.getTextWidth=function($j){return this._currBitmapFont?this._currBitmapFont.getTextWidth($j):$Q.contextMeasureText($j).width},$j.getWordWrapWidth=function(){var $j=this.padding,$O=NaN;return($O=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($O=this.wordWrap?100:$F.width),$O<=0&&($O=100),$O-$j[3]-$j[1]},$j.getCharPoint=function($j,$O){this._isChanged&&$E.timer.runCallLater(this,this.typeset);for(var $V=0,$l=this._lines,$T=0,$S=0,$m=$l.length;$S<$m;$S++){if($j<($V+=$l[$S].length)){var $p=$S;break}$T=$V}var $o=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$F.context.font=$o;var $H=this.getTextWidth(this._text.substring($T,$j));return($O||new $U).setTo(this._startX+$H-(this._clipPoint?this._clipPoint.x:0),this._startY+$p*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$g(0,$j,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($j){$j!=this._width&&($E.superSet($ej,this,"width",$j),this.isChanged=!0)}),$g(0,$j,"textWidth",function(){return this._isChanged&&$E.timer.runCallLater(this,this.typeset),this._textWidth}),$g(0,$j,"height",function(){return this._height?this._height:this.textHeight},function($j){$j!=this._height&&($E.superSet($ej,this,"height",$j),this.isChanged=!0)}),$g(0,$j,"textHeight",function(){return this._isChanged&&$E.timer.runCallLater(this,this.typeset),this._textHeight}),$g(0,$j,"padding",function(){return this._getCSSStyle().padding},function($j){this._getCSSStyle().padding=$j,this.isChanged=!0}),$g(0,$j,"bold",function(){return this._getCSSStyle().bold},function($j){this._getCSSStyle().bold=$j,this.isChanged=!0}),$g(0,$j,"text",function(){return this._text||""},function($j){this._text!==$j&&(this.lang($j+""),this.isChanged=!0,this.event("change"))}),$g(0,$j,"color",function(){return this._getCSSStyle().color},function($j){this._getCSSStyle().color!=$j&&(this._getCSSStyle().color=$j,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$g(0,$j,"font",function(){return this._getCSSStyle().fontFamily},function($j){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$w._bitmapFonts&&$w._bitmapFonts[$j]&&(this._currBitmapFont=$w._bitmapFonts[$j]),this._getCSSStyle().fontFamily=$j,this.isChanged=!0}),$g(0,$j,"fontSize",function(){return this._getCSSStyle().fontSize},function($j){this._getCSSStyle().fontSize=$j,this.isChanged=!0}),$g(0,$j,"italic",function(){return this._getCSSStyle().italic},function($j){this._getCSSStyle().italic=$j,this.isChanged=!0}),$g(0,$j,"align",function(){return this._getCSSStyle().align},function($j){this._getCSSStyle().align=$j,this.isChanged=!0}),$g(0,$j,"valign",function(){return this._getCSSStyle().valign},function($j){this._getCSSStyle().valign=$j,this.isChanged=!0}),$g(0,$j,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($j){this._getCSSStyle().wordWrap=$j,this.isChanged=!0}),$g(0,$j,"leading",function(){return this._getCSSStyle().leading},function($j){this._getCSSStyle().leading=$j,this.isChanged=!0}),$g(0,$j,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($j){this._getCSSStyle().backgroundColor=$j,this.isChanged=!0}),$g(0,$j,"borderColor",function(){return this._getCSSStyle().borderColor},function($j){this._getCSSStyle().borderColor=$j,this.isChanged=!0}),$g(0,$j,"stroke",function(){return this._getCSSStyle().stroke},function($j){this._getCSSStyle().stroke=$j,this.isChanged=!0}),$g(0,$j,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($j){this._getCSSStyle().strokeColor=$j,this.isChanged=!0}),$g(0,$j,"isChanged",null,function($j){this._isChanged!==$j&&(this._isChanged=$j)&&$E.timer.callLater(this,this.typeset)}),$g(0,$j,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($j){if(!(this.overflow!=$w.SCROLL||this.textWidth<this._width)&&this._clipPoint){$j=$j<this.padding[3]?this.padding[3]:$j;var $O=this._textWidth-this._width;$j=$O<$j?$O:$j;var $V=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$j,this.renderText(this._lastVisibleLineIndex,$V)}}),$g(0,$j,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($j){if(!(this.overflow!=$w.SCROLL||this.textHeight<this._height)&&this._clipPoint){$j=$j<this.padding[0]?this.padding[0]:$j;var $O=this._textHeight-this._height,$V=($j=$O<$j?$O:$j)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$V;var $l=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$j,this.renderText($V,$l)}}),$g(0,$j,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$g(0,$j,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$g(0,$j,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$g(0,$j,"underlineColor",function(){return this._underlineColor},function($j){this._underlineColor=$j,this._isChanged=!0,this.typeset()}),$w.registerBitmapFont=function($j,$O){$w._bitmapFonts||($w._bitmapFonts={}),$w._bitmapFonts[$j]=$O},$w.unregisterBitmapFont=function($j,$O){if(void 0===$O&&($O=!0),$w._bitmapFonts&&$w._bitmapFonts[$j]){var $V=$w._bitmapFonts[$j];$O&&$V.destroy(),delete $w._bitmapFonts[$j]}},$w.setTextRightToLeft=function(){var $j;($j=$F.canvas.source.style).display="none",$j.position="absolute",$j.direction="rtl",$q._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$F.document.body.appendChild($F.canvas.source)},$w.supportFont=function($j){$F.context.font="10px sans-serif";var $O=$Q.contextMeasureText("abcji").width;$F.context.font="10px "+$j;var $V=$Q.contextMeasureText("abcji").width;return console.log($O,$V),$O!==$V},$w._testWord="游",$w.langPacks=null,$w.VISIBLE="visible",$w.SCROLL="scroll",$w.HIDDEN="hidden",$w.CharacterCache=!0,$w.RightToLeft=!1,$w._bitmapFonts=null,$o($w,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$w}($ej),$hj=function($e){function $m(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$m.__super.call(this),this.offset=new $U,this._canvasTransform=new $v,this._previousOrientation=$F.window.orientation;var $O=this;this.transform=$v.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $j=$F.window,$V=this;$j.addEventListener("focus",function(){$O._isFocused=!0,$V.event("focus"),$V.event("focuschange")}),$j.addEventListener("blur",function(){$O._isFocused=!1,$V.event("blur"),$V.event("focuschange"),$V._isInputting()&&($Zj.inputElement.target.focus=!1)});var $l="visibilityState",$T="visibilitychange",$S=$j.document;void 0!==$S.hidden?($T="visibilitychange",$l="visibilityState"):void 0!==$S.mozHidden?($T="mozvisibilitychange",$l="mozVisibilityState"):void 0!==$S.msHidden?($T="msvisibilitychange",$l="msVisibilityState"):void 0!==$S.webkitHidden&&($T="webkitvisibilitychange",$l="webkitVisibilityState"),$j.document.addEventListener($T,function(){"hidden"==$F.document[$l]?$V._setStageVisible(!1):$V._setStageVisible(!0)}),$j.document.addEventListener("qbrowserVisibilityChange",function($j){$V._setStageVisible(!$j.hidden)}),$j.addEventListener("resize",function(){var $j=$F.window.orientation;null!=$j&&$j!=$O._previousOrientation&&$V._isInputting()&&($Zj.inputElement.target.focus=!1),$O._previousOrientation=$j,$V._isInputting()||$V._resetCanvas()}),$j.addEventListener("orientationchange",function($j){$V._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$F.onMobile&&this.on("mousedown",this,this._onmouseMove)}$b($m,"laya.display.Stage",$e);var $j=$m.prototype;return $j._setStageVisible=function($j){this._isVisibility!=$j&&(this._isVisibility=$j,this._isVisibility||this._isInputting()&&($Zj.inputElement.target.focus=!1),this.event("visibilitychange"))},$j._isInputting=function(){return $F.onMobile&&$Zj.isInputting},$j._changeCanvasSize=function(){this.setScreenSize($F.clientWidth*$F.pixelRatio,$F.clientHeight*$F.pixelRatio)},$j._resetCanvas=function(){if(this.screenAdaptationEnabled){var $j=$q._mainCanvas;$j.source.style;$j.size(1,1),$E.timer.once(100,this,this._changeCanvasSize)}},$j.setScreenSize=function($j,$O){var $V=!1;if("none"!==this._screenMode&&($V=($j/$O<1?"vertical":"horizontal")!==this._screenMode)){var $l=$O;$O=$j,$j=$l}this.canvasRotation=$V;var $T=$q._mainCanvas,$S=$T.source.style,$m=this._canvasTransform.identity(),$p=this._scaleMode,$o=$j/this.designWidth,$H=$O/this.designHeight,$g=this.designWidth,$e=this.designHeight,$t=$j,$w=$O,$s=$F.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$p){case"noscale":$o=$H=1,$t=this.designWidth,$w=this.designHeight;break;case"showall":$o=$H=Math.min($o,$H),$g=$t=Math.round(this.designWidth*$o),$e=$w=Math.round(this.designHeight*$H);break;case"noborder":$o=$H=Math.max($o,$H),$t=Math.round(this.designWidth*$o),$w=Math.round(this.designHeight*$H);break;case"full":$o=$H=1,this._width=$g=$j,this._height=$e=$O;break;case"fixedwidth":$H=$o,this._height=$e=Math.round($O/$o);break;case"fixedheight":$o=$H,this._width=$g=Math.round($j/$H);break;case"fixedauto":$j/$O<this.designWidth/this.designHeight?($H=$o,this._height=$e=Math.round($O/$o)):($o=$H,this._width=$g=Math.round($j/$H))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$g=$g+1&2147483646,$e=$e+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$o*=this.scaleX,$H*=this.scaleY,1===$o&&1===$H?this.transform.identity():(this.transform.a=this._formatData($o/($t/$g)),this.transform.d=this._formatData($H/($w/$e)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$T.size($g,$e),$M.changeWebGLSize($g,$e),$m.scale($t/$g/$s,$w/$e/$s),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($j-$t)/$s:this.offset.x=.5*($j-$t)/$s,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($O-$w)/$s:this.offset.y=.5*($O-$w)/$s,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$m.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$V&&("horizontal"===this._screenMode?($m.rotate(Math.PI/2),$m.translate($O/$s,0),this.canvasDegree=90):($m.rotate(-Math.PI/2),$m.translate(0,$j/$s),this.canvasDegree=-90)),$m.a=this._formatData($m.a),$m.d=this._formatData($m.d),$m.tx=this._formatData($m.tx),$m.ty=this._formatData($m.ty),$S.transformOrigin=$S.webkitTransformOrigin=$S.msTransformOrigin=$S.mozTransformOrigin=$S.oTransformOrigin="0px 0px 0px",$S.transform=$S.webkitTransform=$S.msTransform=$S.mozTransform=$S.oTransform="matrix("+$m.toString()+")",$m.translate(parseInt($S.left)||0,parseInt($S.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$j._formatData=function($j){return Math.abs($j)<1e-6?0:Math.abs(1-$j)<.001?0<$j?1:-1:$j},$j.getMousePoint=function(){return $U.TEMP.setTo(this.mouseX,this.mouseY)},$j.repaint=function(){this._repaint=1},$j.parentRepaint=function(){},$j._loop=function(){return this.render($q.context,0,0),!0},$j._onmouseMove=function($j){this._mouseMoveTime=$F.now()},$j.getTimeFromFrameStart=function(){return $F.now()-this._frameStartTime},$j.render=function($j,$O,$V){if("sleep"===this._frameRate&&!$q.isConchApp){var $l=$F.now();if(!(1e3<=$l-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($K.loopCount++,$s.instance.runEvent(),$E.timer._update()));this._frameStartTime=$l}if(this._renderCount++,$q.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$F.now();var $T="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$S=this._renderCount%2==0;if($K.renderSlow=!$T,$T||$S||$q.isConchApp){var $m;$K.loopCount++,$s.instance.runEvent(),$E.timer._update(),$M.update3DLoop();var $p=0,$o=0;if($q.isConchNode)for($p=0,$o=this._scenes.length;$p<$o;$p++)($m=this._scenes[$p])&&$m._updateSceneConch();else for($p=0,$o=this._scenes.length;$p<$o;$p++)($m=this._scenes[$p])&&$m._updateScene();if($q.isConchNode){var $H=$ej.CustomList;for($p=0,$o=$H.length;$p<$o;$p++){var $g=$H[$p];$g.customRender($g.customContext,0,0)}return}}$q.isConchNode||this.renderingEnabled&&($T||!$S||$q.isConchWebGL)&&($q.isWebGL?$q.WebGL.mainContext&&!$q.WebGL.mainContext.isContextLost()&&($j.clear(),$e.prototype.render.call(this,$j,$O,$V),$K._show&&$K._sp&&$K._sp.render($j,$O,$V),$M.clear(this._bgColor),$M.beginFlush(),$j.flush(),$M.endFinish(),$D.instance&&$D.getInstance().endDispose()):($M.clear(this._bgColor),$e.prototype.render.call(this,$j,$O,$V),$K._show&&$K._sp&&$K._sp.render($j,$O,$V)))}else this._renderCount%5==0&&($K.loopCount++,$s.instance.runEvent(),$E.timer._update())},$j._requestFullscreen=function(){var $j=$F.document.documentElement;$j.requestFullscreen?$j.requestFullscreen():$j.mozRequestFullScreen?$j.mozRequestFullScreen():$j.webkitRequestFullscreen?$j.webkitRequestFullscreen():$j.msRequestFullscreen&&$j.msRequestFullscreen()},$j._fullScreenChanged=function(){$E.stage.event("fullscreenchange")},$j.exitFullscreen=function(){var $j=$F.document;$j.exitFullscreen?$j.exitFullscreen():$j.mozCancelFullScreen?$j.mozCancelFullScreen():$j.webkitExitFullscreen&&$j.webkitExitFullscreen()},$g(0,$j,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$g(0,$j,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$g(0,$j,"frameRate",function(){return this._frameRate},function($j){if(this._frameRate=$j,$q.isConchApp)switch(this._frameRate){case"slow":$F.window.conch&&$F.window.conchConfig.setSlowFrame&&$F.window.conchConfig.setSlowFrame(!0);break;case"fast":$F.window.conch&&$F.window.conchConfig.setSlowFrame&&$F.window.conchConfig.setSlowFrame(!1);break;case"mouse":$F.window.conch&&$F.window.conchConfig.setMouseFrame&&$F.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$F.window.conch&&$F.window.conchConfig.setLimitFPS&&$F.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$g(0,$j,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$g(0,$j,"width",$e.prototype._$get_width,function($j){this.designWidth=$j,$E.superSet($ej,this,"width",$j),$E.timer.callLater(this,this._changeCanvasSize)}),$g(0,$j,"alignH",function(){return this._alignH},function($j){this._alignH=$j,$E.timer.callLater(this,this._changeCanvasSize)}),$g(0,$j,"isFocused",function(){return this._isFocused}),$g(0,$j,"height",$e.prototype._$get_height,function($j){this.designHeight=$j,$E.superSet($ej,this,"height",$j),$E.timer.callLater(this,this._changeCanvasSize)}),$g(0,$j,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$v.create()},$e.prototype._$set_transform),$g(0,$j,"isVisibility",function(){return this._isVisibility}),$g(0,$j,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$g(0,$j,"scaleMode",function(){return this._scaleMode},function($j){this._scaleMode=$j,$E.timer.callLater(this,this._changeCanvasSize)}),$g(0,$j,"alignV",function(){return this._alignV},function($j){this._alignV=$j,$E.timer.callLater(this,this._changeCanvasSize)}),$g(0,$j,"bgColor",function(){return this._bgColor},function($j){this._bgColor=$j,this.conchModel&&this.conchModel.bgColor($j),$q.isWebGL&&($j?$m._wgColor=$C.create($j)._color:$F.onMiniGame||($m._wgColor=null)),$F.onLimixiu?$m._wgColor=$C.create($j)._color:$q.canvas.style.background=$j||"none"}),$g(0,$j,"mouseX",function(){return Math.round($s.instance.mouseX/this.clientScaleX)}),$g(0,$j,"mouseY",function(){return Math.round($s.instance.mouseY/this.clientScaleY)}),$g(0,$j,"screenMode",function(){return this._screenMode},function($j){this._screenMode=$j}),$g(0,$j,"visible",$e.prototype._$get_visible,function($j){this.visible!==$j&&($E.superSet($ej,this,"visible",$j),$q._mainCanvas.source.style.visibility=$j?"visible":"hidden")}),$g(0,$j,"fullScreenEnabled",null,function($j){var $O=$F.document,$V=$q.canvas;$j?($V.addEventListener("mousedown",this._requestFullscreen),$V.addEventListener("touchstart",this._requestFullscreen),$O.addEventListener("fullscreenchange",this._fullScreenChanged),$O.addEventListener("mozfullscreenchange",this._fullScreenChanged),$O.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$O.addEventListener("msfullscreenchange",this._fullScreenChanged)):($V.removeEventListener("mousedown",this._requestFullscreen),$V.removeEventListener("touchstart",this._requestFullscreen),$O.removeEventListener("fullscreenchange",this._fullScreenChanged),$O.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$O.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$O.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$m.SCALE_NOSCALE="noscale",$m.SCALE_EXACTFIT="exactfit",$m.SCALE_SHOWALL="showall",$m.SCALE_NOBORDER="noborder",$m.SCALE_FULL="full",$m.SCALE_FIXED_WIDTH="fixedwidth",$m.SCALE_FIXED_HEIGHT="fixedheight",$m.SCALE_FIXED_AUTO="fixedauto",$m.ALIGN_LEFT="left",$m.ALIGN_RIGHT="right",$m.ALIGN_CENTER="center",$m.ALIGN_TOP="top",$m.ALIGN_MIDDLE="middle",$m.ALIGN_BOTTOM="bottom",$m.SCREEN_NONE="none",$m.SCREEN_HORIZONTAL="horizontal",$m.SCREEN_VERTICAL="vertical",$m.FRAME_FAST="fast",$m.FRAME_SLOW="slow",$m.FRAME_MOUSE="mouse",$m.FRAME_SLEEP="sleep",$m.FRAME_MOUSE_THREDHOLD=2e3,$o($m,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$m}($ej),$aj=(function($j){function $O(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$O.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$b($O,"laya.media.SoundNode",$ej);var $V=$O.prototype;$V._onParentChange=function(){this.target=this.parent},$V.play=function($j,$O){void 0===$j&&($j=1),isNaN($j)&&($j=1),this.url&&(this.stop(),this._channel=$B.playSound(this.url,$j,null,$O))},$V.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$V._setPlayAction=function($j,$O,$V,$l){void 0===$l&&($l=!0),this[$V]&&$j&&($l?$j.on($O,this,this[$V]):$j.off($O,this,this[$V]))},$V._setPlayActions=function($j,$O,$V,$l){if(void 0===$l&&($l=!0),$j&&$O){var $T,$S=$O.split(","),$m=0;for($T=$S.length,$m=0;$m<$T;$m++)this._setPlayAction($j,$S[$m],$V,$l)}},$g(0,$V,"playEvent",null,function($j){(this._playEvents=$j)&&this._tar&&this._setPlayActions(this._tar,$j,"play")}),$g(0,$V,"target",null,function($j){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$j,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$g(0,$V,"stopEvent",null,function($j){(this._stopEvents=$j)&&this._tar&&this._setPlayActions(this._tar,$j,"stop")})}(),function($j){function $O(){this._src=null,this._onload=null,this._onerror=null,$O.__super.call(this)}$b($O,"laya.resource.FileBitmap",$sj);var $V=$O.prototype;return $g(0,$V,"src",function(){return this._src},function($j){this._src=$j}),$g(0,$V,"onload",null,function($j){}),$g(0,$V,"onerror",null,function($j){}),$O}()),$cj=function($j){function $V($j,$O){this._is2D=!1,$V.__super.call(this);var $l=this;if(this._source=this,"2D"===$j||"AUTO"===$j&&!$q.isWebGL){this._is2D=!0,this._source=$O||$F.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $T=this;$T.getContext=function($j,$O){if($l._ctx)return $l._ctx;var $V=$l._ctx=$l._source.getContext($j,$O);return $V&&($V._canvas=$T,$q.isFlash||$F.onLimixiu||($V.size=function($j,$O){})),$V}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$b($V,"laya.resource.HTMLCanvas",$sj);var $O=$V.prototype;return $O.clear=function(){this._ctx&&this._ctx.clear()},$O.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$O.release=function(){},$O._setContext=function($j){this._ctx=$j},$O.getContext=function($j,$O){return this._ctx?this._ctx:this._ctx=$V._createContext(this)},$O.getMemSize=function(){return 0},$O.size=function($j,$O){(this._w!=$j||this._h!=$O||this._source&&(this._source.width!=$j||this._source.height!=$O))&&(this._w=$j,this._h=$O,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($j,$O),this._source&&(this._source.height=$O,this._source.width=$j))},$O.getCanvas=function(){return this._source},$O.toBase64=function($j,$O,$V){if(this._source)if($q.isConchApp&&this._source.toBase64)this._source.toBase64($j,$O,$V);else{var $l=this._source.toDataURL($j,$O);$V.call(this,$l)}},$g(0,$O,"context",function(){return this._ctx}),$g(0,$O,"asBitmap",null,function($j){}),$V.create=function($j,$O){return new $V($j,$O)},$V.TYPE2D="2D",$V.TYPE3D="3D",$V.TYPEAUTO="AUTO",$V._createContext=null,$V}(),$Aj=(function($j){function $o($j,$O,$V,$l,$T,$S,$m,$p){throw $o.__super.call(this),new Error("不允许new！")}$b($o,"laya.resource.HTMLSubImage",$sj),$o.create=function($j,$O,$V,$l,$T,$S,$m,$p){return void 0===$p&&($p=!1),new $o($j,$O,$V,$l,$T,$S,$m,$p)}}(),function($j){function $e(){this._frames=null,this._url=null,$e.__super.call(this),this._setControlNode(this)}$b($e,"laya.display.Animation",$j);var $O=$e.prototype;$O.destroy=function($j){void 0===$j&&($j=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$j),this._frames=null,this._labels=null},$O.play=function($j,$O,$V,$l){void 0===$j&&($j=0),void 0===$O&&($O=!0),void 0===$V&&($V=""),void 0===$l&&($l=!0),$V&&this._setFramesFromCache($V,$l),this._isPlaying=!0,this.index="string"==typeof $j?this._getFrameByLabel($j):$j,this.loop=$O,this._actionName=$V,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$O._setFramesFromCache=function($j,$O){var $V;return void 0===$O&&($O=!1),this._url&&($j=this._url+"#"+$j),$j&&$e.framesMap[$j]?(($V=$e.framesMap[$j])instanceof Array?(this._frames=$e.framesMap[$j],this._count=this._frames.length):($V.nodeRoot&&($e.framesMap[$j]=this._parseGraphicAnimationByData($V),$V=$e.framesMap[$j]),this._frames=$V.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$V.interval),this._labels=this._copyLabels($V.labels)),!0):($O&&console.log("ani not found:",$j),!1)},$O._copyLabels=function($j){if(!$j)return null;var $O,$V;for($V in $O={},$j)$O[$V]=$Q.copyArray([],$j[$V]);return $O},$O._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$j.prototype._frameLoop.call(this)},$O._displayToIndex=function($j){this._frames&&(this.graphics=this._frames[$j])},$O.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$O.loadImages=function($j,$O){return void 0===$O&&($O=""),this._url="",this._setFramesFromCache($O)||(this.frames=$e.framesMap[$O]?$e.framesMap[$O]:$e.createFrames($j,$O)),this},$O.loadAtlas=function($O,$V,$l){void 0===$l&&($l=""),this._url="";var $T=this;function $j($j){$O===$j&&($T.frames=$e.framesMap[$l]?$e.framesMap[$l]:$e.createFrames($O,$l),$V&&$V.run())}return $T._setFramesFromCache($l)||($pj.getAtlas($O)?$j($O):$E.loader.load($O,$a.create(null,$j,[$O]),null,"atlas")),this},$O.loadAnimation=function($j,$O,$V){this._url=$j;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$O&&$O.run()):!$V||$pj.getAtlas($V)?this._loadAnimationData($j,$O,$V):$E.loader.load($V,$a.create(this,this._loadAnimationData,[$j,$O,$V]),null,"atlas"),this},$O._loadAnimationData=function($p,$o,$j){var $H=this;if(!$j||$pj.getAtlas($j)){var $g=this;$pj.getRes($p)?$O($p):$E.loader.load($p,$a.create(null,$O,[$p]),null,"json"),$pj.clearRes($p)}else console.warn("atlas load fail:"+$j);function $O($j){if($pj.getRes($j)&&$p===$j){var $O;if($e.framesMap[$p+"#"])$g._setFramesFromCache($H._actionName,!0),$H.index=0,$H._checkResumePlaying();else{var $V=$g._parseGraphicAnimation($pj.getRes($p));if(!$V)return;var $l,$T=$V.animationList,$S=0,$m=$T.length;for($S=0;$S<$m;$S++)$O=$T[$S],$e.framesMap[$p+"#"+$O.name]=$O,$l||($l=$O);$l&&($e.framesMap[$p+"#"]=$l,$g._setFramesFromCache($H._actionName,!0),$H.index=0),$H._checkResumePlaying()}$o&&$o.run()}}},$O._parseGraphicAnimation=function($j){return $Ej.parseAnimationData($j)},$O._parseGraphicAnimationByData=function($j){return $Ej.parseAnimationByData($j)},$g(0,$O,"frames",function(){return this._frames},function($j){(this._frames=$j)&&(this._count=$j.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$g(0,$O,"autoPlay",null,function($j){$j?this.play():this.stop()}),$g(0,$O,"source",null,function($j){-1<$j.indexOf(".ani")?this.loadAnimation($j):-1<$j.indexOf(".json")||-1<$j.indexOf("als")||-1<$j.indexOf("atlas")?this.loadAtlas($j):this.loadImages($j.split(","))}),$g(0,$O,"autoAnimation",null,function($j){this.play(0,!0,$j,!1)}),$e.createFrames=function($j,$O){var $V,$l,$T=0,$S=0;if("string"==typeof $j){var $m=$pj.getAtlas($j);if($m&&$m.length)for($V=[],$T=0,$S=$m.length;$T<$S;$T++)($l=new $M.createGraphics).drawTexture($pj.getRes($m[$T]),0,0),$V.push($l)}else if($j instanceof Array)for($V=[],$T=0,$S=$j.length;$T<$S;$T++)($l=new $M.createGraphics).loadImage($j[$T],0,0),$V.push($l);return $O&&($e.framesMap[$O]=$V),$V},$e.clearCache=function($j){var $O,$V=$e.framesMap,$l=$j+"#";for($O in $V)$O!==$j&&0!=$O.indexOf($l)||delete $e.framesMap[$O]},$e.framesMap={}}($bj),function($j){function $S(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$S.__super.call(this),null==$S._sortIndexFun&&($S._sortIndexFun=$x.sortByKey("index",!1,!0))}$b($S,"laya.display.FrameAnimation",$j);var $O=$S.prototype;return $O._setUp=function($j,$O){this._labels=null,this._animationNewFrames=null,this._targetDic=$j,this._animationData=$O,this.interval=1e3/$O.frameRate,$O.parsed?(this._count=$O.count,this._labels=$O.labels,this._animationNewFrames=$O.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$O.parsed=!0,$O.labels=this._labels,$O.count=this._count,$O.animationNewFrames=this._animationNewFrames},$O.clear=function(){$j.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$O._displayToIndex=function($j){if(this._animationData){$j<0&&($j=0),$j>this._count&&($j=this._count);var $O=this._animationData.nodes,$V=0,$l=$O.length;for($V=0;$V<$l;$V++)this._displayNodeToFrame($O[$V],$j)}},$O._displayNodeToFrame=function($j,$O,$V){$V||($V=this._targetDic);var $l=$V[$j.target];if($l){var $T,$S,$m,$p=$j.frames,$o=$j.keys,$H=0,$g=$o.length;for($H=0;$H<$g;$H++)$m=($S=$p[$T=$o[$H]]).length>$O?$S[$O]:$S[$S.length-1],$l[$T]=$m}},$O._calculateDatas=function(){if(this._animationData){var $j,$O=this._animationData.nodes,$V=0,$l=$O.length;for($V=this._count=0;$V<$l;$V++)$j=$O[$V],this._calculateNodeKeyFrames($j);this._count+=1}},$O._calculateNodeKeyFrames=function($j){var $O,$V,$l=$j.keyframes,$T=$j.target;for($O in $j.frames||($j.frames={}),$j.keys?$j.keys.length=0:$j.keys=[],$j.initValues||($j.initValues={}),$l)$V=$l[$O],$j.frames[$O]||($j.frames[$O]=[]),this._targetDic&&this._targetDic[$T]&&($j.initValues[$O]=this._targetDic[$T][$O]),$V.sort($S._sortIndexFun),$j.keys.push($O),this._calculateNodePropFrames($V,$j.frames[$O],$O,$T)},$O.resetToInitState=function(){if(this._targetDic&&this._animationData){var $j,$O,$V=this._animationData.nodes,$l=0,$T=$V.length;for($l=0;$l<$T;$l++)if($O=($j=$V[$l]).initValues){var $S,$m=this._targetDic[$j.target];if($m)for($S in $O)$m[$S]=$O[$S]}}},$O._calculateNodePropFrames=function($j,$O,$V,$l){var $T=0,$S=$j.length-1;if(0<$S){for($O.length=$j[$S].index+1,$T=0;$T<$S;$T++)this._dealKeyFrame($j[$T]),this._calculateFrameValues($j[$T],$j[$T+1],$O);this._dealKeyFrame($j[$T])}0==$S&&($O[$j[0].index]=$j[0].value,this._animationNewFrames&&(this._animationNewFrames[$j[0].index]=!0))},$O._dealKeyFrame=function($j){$j.label&&""!=$j.label&&this.addLabel($j.label,$j.index)},$O._calculateFrameValues=function($j,$O,$V){var $l,$T=0,$S=$j.index,$m=$O.index,$p=$j.value,$o=$O.value-$j.value,$H=$m-$S;if($m>this._count&&(this._count=$m),$j.tween)for(null==($l=$u[$j.tweenMethod])&&($l=$u.linearNone),$T=$S;$T<$m;$T++)$V[$T]=$l($T-$S,$p,$o,$H),this._animationNewFrames&&(this._animationNewFrames[$T]=!0);else for($T=$S;$T<$m;$T++)$V[$T]=$p;this._animationNewFrames&&(this._animationNewFrames[$j.index]=!0,this._animationNewFrames[$O.index]=!0),$V[$O.index]=$O.value},$S._sortIndexFun=null,$S}($bj)),$Zj=function($O){function $T(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$T.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$rj.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$b($T,"laya.display.Input",$O);var $j=$T.prototype;return $j.setSelection=function($j,$O){this.focus=!0,laya.display.Input.inputElement.selectionStart=$j,laya.display.Input.inputElement.selectionEnd=$O},$j._onUnDisplay=function($j){this.focus=!1},$j._onMouseDown=function($j){this.focus=!0},$j._syncInputTransform=function(){var $j=this.nativeInput,$O=$Q.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$V=this._width-this.padding[1]-this.padding[3],$l=this._height-this.padding[0]-this.padding[2];$q.isConchApp?($j.setScale($O.scaleX,$O.scaleY),$j.setSize($V,$l),$j.setPos($O.x,$O.y)):($T.inputContainer.style.transform=$T.inputContainer.style.webkitTransform="scale("+$O.scaleX+","+$O.scaleY+") rotate("+$E.stage.canvasDegree+"deg)",$j.style.width=$V+"px",$j.style.height=$l+"px",$T.inputContainer.style.left=$O.x+"px",$T.inputContainer.style.top=$O.y+"px")},$j.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$j._setInputMethod=function(){$T.input.parentElement&&$T.inputContainer.removeChild($T.input),$T.area.parentElement&&$T.inputContainer.removeChild($T.area),$T.inputElement=this._multiline?$T.area:$T.input,$T.inputContainer.appendChild($T.inputElement),$rj.RightToLeft&&($T.inputElement.style.direction="rtl")},$j._focusIn=function(){laya.display.Input.isInputting=!0;var $j=this.nativeInput;this._focus=!0;var $O=$j.style;$O.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$j.readOnly=!this._editable,$q.isConchApp&&($j.setType(this._type),$j.setForbidEdit(!this._editable)),$j.maxLength=this._maxChars;this.padding;if($j.type=this._type,$j.value=this._content,$j.placeholder=this._prompt,$E.stage.off("keydown",this,this._onKeyDown),$E.stage.on("keydown",this,this._onKeyDown),($E.stage.focus=this).event("focus"),$F.onPC&&$j.focus(),!$F.onMiniGame){this._text;this._text=null}this.typeset(),$j.setColor(this._originColor),$j.setFontSize(this.fontSize),$j.setFontFace($F.onIPhone&&$rj._fontFamilyMap[this.font]||this.font),$q.isConchApp&&$j.setMultiAble&&$j.setMultiAble(this._multiline),$O.lineHeight=this.leading+this.fontSize+"px",$O.fontStyle=this.italic?"italic":"normal",$O.fontWeight=this.bold?"bold":"normal",$O.textAlign=this.align,$O.padding="0 0",this._syncInputTransform(),!$q.isConchApp&&$F.onPC&&$E.timer.frameLoop(1,this,this._syncInputTransform)},$j._setPromptColor=function(){($T.promptStyleDOM=$F.getElementById("promptStyle"))||(($T.promptStyleDOM=$F.createElement("style")).setAttribute("id","promptStyle"),$F.document.head.appendChild($T.promptStyleDOM)),$T.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$j._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($E.superSet($rj,this,"text",this._content),$E.superSet($rj,this,"color",this._originColor)):($E.superSet($rj,this,"text",this._prompt),$E.superSet($rj,this,"color",this._promptColor)),$E.stage.off("keydown",this,this._onKeyDown),$E.stage.focus=null,this.event("blur"),$q.isConchApp&&this.nativeInput.blur(),$F.onPC&&$E.timer.clear(this,this._syncInputTransform)},$j._onKeyDown=function($j){13===$j.keyCode&&($F.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$j.changeText=function($j){this._content=$j,this._focus?(this.nativeInput.value=$j||"",this.event("change")):$O.prototype.changeText.call(this,$j)},$g(0,$j,"color",$O.prototype._$get_color,function($j){this._focus&&this.nativeInput.setColor($j),$E.superSet($rj,this,"color",this._content?$j:this._promptColor),this._originColor=$j}),$g(0,$j,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($j){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$g(0,$j,"multiline",function(){return this._multiline},function($j){this._multiline=$j,this.valign=$j?"top":"middle"}),$g(0,$j,"maxChars",function(){return this._maxChars},function($j){$j<=0&&($j=1e5),this._maxChars=$j}),$g(0,$j,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($j){$E.superSet($rj,this,"color",this._originColor),$j+="",this._focus?(this.nativeInput.value=$j||"",this.event("change")):(this._multiline||($j=$j.replace(/\r?\n/g,"")),(this._content=$j)?$E.superSet($rj,this,"text",$j):($E.superSet($rj,this,"text",this._prompt),$E.superSet($rj,this,"color",this.promptColor)))}),$g(0,$j,"nativeInput",function(){return this._multiline?$T.area:$T.input}),$g(0,$j,"prompt",function(){return this._prompt},function($j){!this._text&&$j&&$E.superSet($rj,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$E.superSet($rj,this,"text",this._text==this._prompt?$j:this._text):$E.superSet($rj,this,"text",$j),this._prompt=$rj.langPacks&&$rj.langPacks[$j]?$rj.langPacks[$j]:$j}),$g(0,$j,"focus",function(){return this._focus},function($j){var $O=this.nativeInput;this._focus!==$j&&($j?($O.target?$O.target._focusOut():this._setInputMethod(),($O.target=this)._focusIn()):($O.target=null,this._focusOut(),$F.document.body.scrollTop=0,$O.blur(),$q.isConchApp?$O.setPos(-1e4,-1e4):$T.inputContainer.contains($O)&&$T.inputContainer.removeChild($O)))}),$g(0,$j,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($j){$j?(-1<($j="[^"+$j+"]").indexOf("^^")&&($j=$j.replace("^^","")),this._restrictPattern=new RegExp($j,"g")):this._restrictPattern=null}),$g(0,$j,"editable",function(){return this._editable},function($j){this._editable=$j,$q.isConchApp&&$T.input.setForbidEdit(!$j)}),$g(0,$j,"promptColor",function(){return this._promptColor},function($j){this._promptColor=$j,this._content||$E.superSet($rj,this,"color",$j)}),$g(0,$j,"type",function(){return this._type},function($j){this._getCSSStyle().password="password"==$j,this._type=$j,$q.isConchApp&&this.nativeInput.setType($j)}),$g(0,$j,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($j){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$g(0,$j,"asPassword",function(){return this._getCSSStyle().password},function($j){this._getCSSStyle().password=$j,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$T.__init__=function(){$T._createInputElement(),$F.onMobile&&$q.canvas.addEventListener($T.IOS_IFRAME?$F.onMiniGame?"touchend":"click":"touchend",$T._popupInputMethod)},$T._popupInputMethod=function($j){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$T._createInputElement=function(){$T._initInput($T.area=$F.createElement("textarea")),$T._initInput($T.input=$F.createElement("input")),($T.inputContainer=$F.createElement("div")).style.position="absolute",$T.inputContainer.style.zIndex=1e5,$F.container.appendChild($T.inputContainer),$T.inputContainer.setPos=function($j,$O){$T.inputContainer.style.left=$j+"px",$T.inputContainer.style.top=$O+"px"}},$T._initInput=function($O){var $j=$O.style;$j.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$j.resize="none",$j.backgroundColor="transparent",$j.border="none",$j.outline="none",$j.zIndex=1,$O.addEventListener("input",$T._processInputting),$O.addEventListener("mousemove",$T._stopEvent),$O.addEventListener("mousedown",$T._stopEvent),$O.addEventListener("touchmove",$T._stopEvent),$O.setFontFace=function($j){$O.style.fontFamily=$j},$q.isConchApp||($O.setColor=function($j){$O.style.color=$j},$O.setFontSize=function($j){$O.style.fontSize=$j+"px"})},$T._processInputting=function($j){var $O=laya.display.Input.inputElement.target;if($O){var $V=laya.display.Input.inputElement.value;$O._restrictPattern&&($V=$V.replace(/\u2006|\x27/g,""),$O._restrictPattern.test($V)&&($V=$V.replace($O._restrictPattern,""),laya.display.Input.inputElement.value=$V)),$O._text=$V,$O.event("input")}},$T._stopEvent=function($j){"touchmove"==$j.type&&$j.preventDefault(),$j.stopPropagation&&$j.stopPropagation()},$T.TYPE_TEXT="text",$T.TYPE_PASSWORD="password",$T.TYPE_EMAIL="email",$T.TYPE_URL="url",$T.TYPE_NUMBER="number",$T.TYPE_RANGE="range",$T.TYPE_DATE="date",$T.TYPE_MONTH="month",$T.TYPE_WEEK="week",$T.TYPE_TIME="time",$T.TYPE_DATE_TIME="datetime",$T.TYPE_DATE_TIME_LOCAL="datetime-local",$T.TYPE_SEARCH="search",$T.input=null,$T.area=null,$T.inputElement=null,$T.inputContainer=null,$T.confirmButton=null,$T.promptStyleDOM=null,$T.inputHeight=45,$T.isInputting=!1,$T.stageMatrix=null,$o($T,["IOS_IFRAME",function(){return this.IOS_IFRAME=$F.onIOS&&$F.window.top!=$F.window.self}]),$T}($rj),$xj=function($j){function $V($j,$O){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$V.__super.call(this),$j&&this._init_($j,$O)}$b($V,"laya.resource.HTMLImage",$aj);var $O=$V.prototype;return $O._init_=function($j,$O){this._src=$j,this._source=new $F.window.Image,$O&&($O.onload&&(this.onload=$O.onload),$O.onerror&&(this.onerror=$O.onerror),$O.onCreate&&$O.onCreate(this)),0!=$j.indexOf("data:image")&&(this._source.crossOrigin=""),$j&&(this._source.src=$j)},$O.recreateResource=function(){var $j=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $O=this;this._source=new $F.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($O._needReleaseAgain)return $O._needReleaseAgain=!1,$O._source.onload=null,void($O._source=null);$O._source.onload=null,$O.memorySize=$j._w*$j._h*4,$O._recreateLock=!1,$O.completeCreate()},this._source.src=this._src}},$O.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$O.onresize=function(){this._w=this._source.width,this._h=this._source.height},$g(0,$O,"onload",null,function($j){var $O=this;this._onload=$j,this._source&&(this._source.onload=null!=this._onload?function(){$O.onresize(),$O._onload()}:null)}),$g(0,$O,"onerror",null,function($j){var $O=this;this._onerror=$j,this._source&&(this._source.onerror=null!=this._onerror?function(){$O._onerror()}:null)}),$g(0,$O,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($j){this._enableMerageInAtlas=$j,$q.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$j)}),$V.create=function($j,$O){return new $V($j,$O)},$V}(),$Ej=(function($S){function $j(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$j.__super.call(this)}$b($j,"laya.display.EffectAnimation",$S);var $O=$j.prototype;$O._onOtherBegin=function($j){$j!=this&&this.stop()},$O.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$O._onPlayAction=function(){this.play(0,!1)},$O.play=function($j,$O,$V,$l){void 0===$j&&($j=0),void 0===$O&&($O=!0),void 0===$V&&($V=""),void 0===$l&&($l=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$j,$O,$V,$l))},$O._recordInitData=function(){if(this._aniKeys){var $j,$O,$V=0;for($j=this._aniKeys.length,$V=0;$V<$j;$V++)$O=this._aniKeys[$V],this._initData[$O]=this._target[$O]}},$O._displayToIndex=function($j){if(this._animationData){$j<0&&($j=0),$j>this._count&&($j=this._count);var $O=this._animationData.nodes,$V=0,$l=$O.length;for($l=1<$l?1:$l,$V=0;$V<$l;$V++)this._displayNodeToFrame($O[$V],$j)}},$O._displayNodeToFrame=function($j,$O,$V){if(this._target){var $l;$l=this._target;var $T,$S,$m,$p,$o=$j.frames,$H=$j.keys,$g=0,$e=$H.length;$p=$j.secondFrames;var $t,$w,$s,$b,$r=0;for($g=0;$g<$e;$g++)$S=$o[$T=$H[$g]],$m=-1==($r=$p[$T])?this._initData[$T]:$O<$r?($s=($w=$j.keyframes[$T])[0]).tween?(null==($t=$u[$s.tweenMethod])&&($t=$u.linearNone),$b=$w[1],$t($O,this._initData[$T],$b.value-this._initData[$T],$b.index)):this._initData[$T]:$S.length>$O?$S[$O]:$S[$S.length-1],$l[$T]=$m}},$O._calculateNodeKeyFrames=function($j){$S.prototype._calculateNodeKeyFrames.call(this,$j);var $O,$V,$l,$T=$j.keyframes;$j.target;for($O in $l={},$j.secondFrames=$l,$T)($V=$T[$O]).length<=1?$l[$O]=-1:$l[$O]=$V[1].index},$g(0,$O,"target",function(){return this._target},function($j){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$j,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$g(0,$O,"playEvent",null,function($j){(this._playEvents=$j)&&this.addEvent()}),$g(0,$O,"effectData",null,function($j){var $O;$j&&(($O=$j.animations)&&$O[0]&&(this._setUp({},$O[0]),$O[0].nodes&&$O[0].nodes[0]&&(this._aniKeys=$O[0].nodes[0].keys)))}),$g(0,$O,"effectClass",null,function($j){var $O,$V;(this._effectClass=$f.getClass($j),this._effectClass)&&(($O=this._effectClass.uiView)&&($V=$O.animations)&&$V[0]&&(this._setUp({},$V[0]),$V[0].nodes&&$V[0].nodes[0]&&(this._aniKeys=$V[0].nodes[0].keys)))}),$j.EffectAnimationBegin="effectanimationbegin"}($Aj),function($O){var $_;function $B(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$B.__super.call(this)}$b($B,"laya.utils.GraphicAnimation",$O);var $j=$B.prototype;return $j._parseNodeList=function($j){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$j.compId]=$j.props,$j.compId&&this._nodeList.push($j.compId);var $O=$j.child;if($O){var $V=0,$l=$O.length;for($V=0;$V<$l;$V++)this._parseNodeList($O[$V])}},$j._calGraphicData=function($j){var $O;if(this._setUp(null,$j),this._createGraphicData(),this._nodeIDAniDic)for($O in this._nodeIDAniDic)this._nodeIDAniDic[$O]=null},$j._createGraphicData=function(){var $j,$O=[],$V=0,$l=this.count,$T=this._animationNewFrames;for($T||($T=[]),$V=0;$V<$l;$V++)!$T[$V]&&$j||($j=this._createFrameGraphic($V)),$O.push($j);this._gList=$O},$j._createFrameGraphic=function($j){var $O=$M.createGraphics();return $B._rootMatrix||($B._rootMatrix=new $v),this._updateNodeGraphic(this._rootNode,$j,$B._rootMatrix,$O),$O},$j._updateNodeGraphic=function($j,$O,$V,$l,$T){var $S;void 0===$T&&($T=1);var $m,$p,$o,$H=($S=this._nodeGDic[$j.compId]=this._getNodeGraphicData($j.compId,$O,this._nodeGDic[$j.compId])).alpha*$T;if(!($H<.01)&&($S.resultTransform||($S.resultTransform=$v.create()),$m=$S.resultTransform,$v.mul($S.transform,$V,$m),$S.skin&&($p=this._getTextureByUrl($S.skin))&&($m._checkTransform()?($l.drawTexture($p,0,0,$S.width,$S.height,$m,$H),$S.resultTransform=null):$l.drawTexture($p,$m.tx,$m.ty,$S.width,$S.height,null,$H)),$o=$j.child)){var $g,$e=0;for($g=$o.length,$e=0;$e<$g;$e++)this._updateNodeGraphic($o[$e],$O,$m,$l,$H)}},$j._updateNoChilds=function($j,$O){if($j.skin){var $V=this._getTextureByUrl($j.skin);if($V){var $l=$j.transform;$l._checkTransform();!$l.bTransform?$O.drawTexture($V,$l.tx,$l.ty,$j.width,$j.height,null,$j.alpha):$O.drawTexture($V,0,0,$j.width,$j.height,$l.clone(),$j.alpha)}}},$j._updateNodeGraphic2=function($j,$O,$V){var $l;if($l=this._nodeGDic[$j.compId]=this._getNodeGraphicData($j.compId,$O,this._nodeGDic[$j.compId]),$j.child){var $T=$l.transform;$T._checkTransform();var $S,$m;$m=($S=!$T.bTransform)&&(0!=$T.tx||0!=$T.ty);var $p,$o,$H;if(($p=$T.bTransform||1!=$l.alpha)&&$V.save(),1!=$l.alpha&&$V.alpha($l.alpha),$S?$m&&$V.translate($T.tx,$T.ty):$V.transform($T.clone()),$o=$j.child,$l.skin&&($H=this._getTextureByUrl($l.skin))&&$V.drawTexture($H,0,0,$l.width,$l.height),$o){var $g,$e=0;for($g=$o.length,$e=0;$e<$g;$e++)this._updateNodeGraphic2($o[$e],$O,$V)}$p?$V.restore():$S?$m&&$V.translate(-$T.tx,-$T.ty):$V.transform($T.clone().invert())}else this._updateNoChilds($l,$V)},$j._calculateNodeKeyFrames=function($j){$O.prototype._calculateNodeKeyFrames.call(this,$j),this._nodeIDAniDic[$j.target]=$j},$j.getNodeDataByID=function($j){return this._nodeIDAniDic[$j]},$j._getParams=function($j,$O,$V,$l){var $T=$B._temParam;$T.length=$O.length;var $S=0,$m=$O.length;for($S=0;$S<$m;$S++)$T[$S]=this._getObjVar($j,$O[$S][0],$V,$O[$S][1],$l);return $T},$j._getObjVar=function($j,$O,$V,$l,$T){if($j.hasOwnProperty($O)){var $S=$j[$O];if($V>=$S.length&&($V=$S.length-1),null!=$j[$O][$V])return $j[$O][$V]}return $T.hasOwnProperty($O)?$T[$O]:$l},$j._getNodeGraphicData=function($j,$O,$V){$V||($V=$_.create()),$V.transform?$V.transform.identity():$V.transform=$v.create();var $l=this.getNodeDataByID($j);if(!$l)return $V;var $T,$S,$m=$l.frames,$p=this._getParams($m,$B._drawTextureCmd,$O,this._nodeDefaultProps[$j]),$o=$p[0],$H=NaN,$g=NaN,$e=$p[5],$t=$p[6],$w=$p[13],$s=$p[14],$b=$p[7],$r=$p[8],$h=$p[9],$a=$p[11],$c=$p[12];$H=$p[3],$g=$p[4],0!=$H&&0!=$g||($o=null),-1==$H&&($H=0),-1==$g&&($g=0),$V.skin=$o,$V.width=$H,$V.height=$g,$o&&(($T=this._getTextureByUrl($o))?($H||($H=$T.sourceWidth),$g||($g=$T.sourceHeight)):console.warn("lost skin:",$o,",you may load pics first")),$V.alpha=$p[10],$S=$V.transform,0!=$w&&($e=$w*$H),0!=$s&&($t=$s*$g),0==$e&&0==$t||$S.translate(-$e,-$t);var $A=null;if($h||1!==$b||1!==$r||$a||$c){($A=$B._tempMt).identity(),$A.bTransform=!0;var $Z=.0174532922222222*($h-$a),$x=.0174532922222222*($h+$c),$E=Math.cos($x),$U=Math.sin($x),$z=Math.sin($Z),$$=Math.cos($Z);$A.a=$b*$E,$A.b=$b*$U,$A.c=-$r*$z,$A.d=$r*$$,$A.tx=$A.ty=0}return $A&&($S=$v.mul($S,$A,$S)),$S.translate($p[1],$p[2]),$V},$j._getTextureByUrl=function($j){return $pj.getRes($j)},$j.setAniData=function($j,$O){if($j.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$j,this._parseNodeList($j);var $V,$l={},$T=[],$S=$j.animations,$m=0,$p=$S.length;for($m=0;$m<$p;$m++)if($V=$S[$m],this._labels=null,(!$O||$O==$V.name)&&$V){try{this._calGraphicData($V)}catch($j){console.warn("parse animation fail:"+$V.name+",empty animation created"),this._gList=[]}var $o={};$o.interval=1e3/$V.frameRate,$o.frames=this._gList,$o.labels=this._labels,$o.name=$V.name,$T.push($o),$l[$V.name]=$o}this.animationList=$T,this.animationDic=$l}$B._temParam.length=0},$j.parseByData=function($j){var $O,$V;$O=$j.nodeRoot,$V=$j.aniO,delete $j.nodeRoot,delete $j.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$O,this._parseNodeList($O),this._labels=null;try{this._calGraphicData($V)}catch($j){console.warn("parse animation fail:"+$V.name+",empty animation created"),this._gList=[]}var $l=$j;return $l.interval=1e3/$V.frameRate,$l.frames=this._gList,$l.labels=this._labels,$l.name=$V.name,$l},$j.setUpAniData=function($j){if($j.animations){var $O,$V={},$l=[],$T=$j.animations,$S=0,$m=$T.length;for($S=0;$S<$m;$S++)if($O=$T[$S]){var $p={};$p.name=$O.name,$p.aniO=$O,$p.nodeRoot=$j,$l.push($p),$V[$O.name]=$p}this.animationList=$l,this.animationDic=$V}},$j._clear=function(){var $j,$O;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($j in this._nodeGDic)($O=this._nodeGDic[$j])&&$O.recover();this._nodeGDic=null},$B.parseAnimationByData=function($j){var $O;return $B._I||($B._I=new $B),$O=$B._I.parseByData($j),$B._I._clear(),$O},$B.parseAnimationData=function($j){var $O;return $B._I||($B._I=new $B),$B._I.setUpAniData($j),($O={}).animationList=$B._I.animationList,$O.animationDic=$B._I.animationDic,$B._I._clear(),$O},$B._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$B._temParam=[],$B._I=null,$B._rootMatrix=null,$o($B,["_tempMt",function(){return this._tempMt=new $v}]),$B.__init$=function(){$_=function(){function $j(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $b($j,""),$j.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$W.recover("GraphicNode",this)},$j.create=function(){return $W.getItemByClass("GraphicNode",$j)},$j}()},$B}($Aj));$E.__init([$H,$oj,$q,$F,$d,$$,$j,$Ej])}(window,document,Laya),function($j,$O,$V){$V.un,$V.uns,$V.static;var $l=$V.class;$V.getset,$V.__newvec;new(function(){function $j(){}return $l($j,"LayaMain"),$j}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($j,$O){"use strict";for(var $V in Object.defineProperty($O,"__esModule",{value:!0}),Laya){var $l=Laya[$V];$l&&$l.__isclass&&($O[$V]=$l)}}),function($j,$O,$x){$x.un,$x.uns;var $m=$x.static,$t=$x.class,$l=$x.getset,$S=$x.__newvec,$g=laya.maths.Arith,$e=laya.maths.Bezier,$V=laya.resource.Bitmap,$w=laya.utils.Browser,$o=laya.utils.Byte,$s=laya.utils.Color,$E=(laya.filters.ColorFilter,$x.Config),$T=laya.resource.Context,$U=(laya.events.Event,laya.filters.Filter),$p=laya.display.Graphics,$H=laya.resource.HTMLCanvas,$b=(laya.utils.HTMLChar,laya.resource.HTMLImage),$r=laya.resource.HTMLSubImage,$z=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$$=laya.maths.Point,$_=laya.maths.Rectangle,$h=laya.renders.Render,$a=(laya.renders.RenderContext,laya.renders.RenderSprite),$c=laya.resource.Resource,$A=laya.resource.ResourceManager,$Z=laya.utils.RunDriver,$B=laya.display.Sprite,$M=laya.display.Stage,$v=laya.utils.Stat,$Y=laya.utils.StringKey,$R=(laya.display.css.Style,laya.system.System),$q=laya.display.Text,$i=laya.resource.Texture,$k=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$n=laya.utils.VectorGraphManager;laya.utils.WordText;$x.interface("laya.webgl.shapes.IShape"),$x.interface("laya.webgl.submit.ISubmit"),$x.interface("laya.webgl.text.ICharSegment"),$x.interface("laya.webgl.canvas.save.ISaveData"),$x.interface("laya.webgl.resource.IMergeAtlasBitmap"),$x.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $G=function(){function $j(){}$t($j,"laya.filters.webgl.FilterActionGL");var $O=$j.prototype;return $x.imps($O,{"laya.filters.IFilterActionGL":!0}),$O.setValue=function($j){},$O.setValueMix=function($j){},$O.apply3d=function($j,$O,$V,$l,$T){return null},$O.apply=function($j){return null},$l(0,$O,"typeMix",function(){return 0}),$j}(),$F=function(){function $j(){}return $t($j,"laya.webgl.shader.ShaderValue"),$j}(),$N=function(){var $l,$T;function $j($j,$O,$V){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $T,void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),this._cells=null,this._rowInfo=null,this._init($j,$O),this._atlasID=$V}$t($j,"laya.webgl.atlas.AtlasGrid");var $O=$j.prototype;return $O.getAltasID=function(){return this._atlasID},$O.setAltasID=function($j){0<=$j&&(this._atlasID=$j)},$O.addTex=function($j,$O,$V){var $l=this._get($O,$V);return 0==$l.ret||(this._fill($l.x,$l.y,$O,$V,$j),this._texCount++),$l},$O._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$O._init=function($j,$O){if(this._width=$j,this._height=$O,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$S(this._height);for(var $V=0;$V<this._height;$V++)this._rowInfo[$V]=new $l;return this._clear(),!0},$O._get=function($j,$O){var $V=new $f;if($j>=this._failSize.width&&$O>=this._failSize.height)return $V;for(var $l=-1,$T=-1,$S=this._width,$m=this._height,$p=this._cells,$o=0;$o<$m;$o++)if(!(this._rowInfo[$o].spaceCount<$j))for(var $H=0;$H<$S;){var $g=3*($o*$S+$H);if(0!=$p[$g]||$p[1+$g]<$j||$p[2+$g]<$O)$H+=$p[1+$g];else{$l=$H,$T=$o;for(var $e=0;$e<$j;$e++)if($p[3*$e+$g+2]<$O){$l=-1;break}if(!($l<0))return $V.ret=!0,$V.x=$l,$V.y=$T,$V;$H+=$p[1+$g]}}return $V},$O._fill=function($j,$O,$V,$l,$T){var $S=this._width,$m=this._height;this._check($j+$V<=$S&&$O+$l<=$m);for(var $p=$O;$p<$l+$O;++$p){this._check(this._rowInfo[$p].spaceCount>=$V),this._rowInfo[$p].spaceCount-=$V;for(var $o=0;$o<$V;$o++){var $H=3*($j+$p*$S+$o);this._check(0==this._cells[$H]),this._cells[$H]=$T,this._cells[1+$H]=$V,this._cells[2+$H]=$l}}if(0<$j)for($p=0;$p<$l;++$p){var $g=0;for($o=$j-1;0<=$o&&0==this._cells[3*(($O+$p)*$S+$o)];--$o,++$g);for($o=$g;0<$o;--$o)this._cells[3*(($O+$p)*$S+$j-$o)+1]=$o,this._check(0<$o)}if(0<$O)for($o=$j;$o<$j+$V;++$o){for($g=0,$p=$O-1;0<=$p&&0==this._cells[3*($o+$p*$S)];--$p,$g++);for($p=$g;0<$p;--$p)this._cells[3*($o+($O-$p)*$S)+2]=$p,this._check(0<$p)}},$O._check=function($j){0==$j&&console.log("xtexMerger 错误啦")},$O._clear=function(){for(var $j=this._texCount=0;$j<this._height;$j++)this._rowInfo[$j].spaceCount=this._width;for(var $O=0;$O<this._height;$O++)for(var $V=0;$V<this._width;$V++){var $l=3*($O*this._width+$V);this._cells[$l]=0,this._cells[1+$l]=this._width-$V,this._cells[2+$l]=this._width-$O}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$j.__init$=function(){$l=function(){function $j(){this.spaceCount=0}return $t($j,""),$j}(),$T=function(){function $j(){this.width=0,this.height=0}return $t($j,""),$j}()},$j}(),$X=function(){function $h($j,$O,$V,$l){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$j,this._height=$O,this._gridSize=$V,this._maxAtlaserCount=$l,this._gridNumX=$j/$V,this._gridNumY=$O/$V,this._curAtlasIndex=0,this._atlaserArray=[]}$t($h,"laya.webgl.atlas.AtlasResourceManager");var $j=$h.prototype;return $j.setAtlasParam=function($j,$O,$V,$l){if(1==this._setAtlasParam)return $h._sid_=0,this._width=$j,this._height=$O,this._gridSize=$V,this._maxAtlaserCount=$l,this._gridNumX=$j/$V,this._gridNumY=$O/$V,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$j.pushData=function($j){var $O,$V=$j.bitmap,$l=-1,$T=null,$S=0,$m=0;for($S=0,$O=this._atlaserArray.length;$S<$O&&($m=(this._curAtlasIndex+$S)%$O,-1==($l=($T=this._atlaserArray[$m]).findBitmapIsExist($V)));$S++);if(-1!=$l){var $p=$T.InAtlasWebGLImagesOffsetValue[$l];return $s=$p[0],$b=$p[1],$T.addToAtlas($j,$s,$b),!0}this._setAtlasParam=!1;for(var $o=Math.ceil(($j.bitmap.width+2)/this._gridSize),$H=Math.ceil(($j.bitmap.height+2)/this._gridSize),$g=!1,$e=0;$e<2;$e++){var $t=this._maxAtlaserCount;for($S=0;$S<$t;$S++){$m=(this._curAtlasIndex+$S)%$t,this._atlaserArray.length-1>=$m||this._atlaserArray.push(new $_j(this._gridNumX,this._gridNumY,this._width,this._height,$h._sid_++));var $w=this._atlaserArray[$m],$s=0,$b=0,$r=$w.addTex(1,$o,$H);if($r.ret){$s=$r.x*this._gridSize+1,$b=$r.y*this._gridSize+1,$V.lock=!0,$w.addToAtlasTexture($V,$s,$b),$w.addToAtlas($j,$s,$b),$g=!0,this._curAtlasIndex=$m;break}}if($g)break;this._atlaserArray.push(new $_j(this._gridNumX,this._gridNumY,this._width,this._height,$h._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $g||console.log(">>>AtlasManager pushData error"),$g},$j.addToAtlas=function($j){laya.webgl.atlas.AtlasResourceManager.instance.pushData($j)},$j.garbageCollection=function(){if(!0===this._needGC){for(var $j=this._atlaserArray.length-this._maxAtlaserCount,$O=0;$O<$j;$O++)this._atlaserArray[$O].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$j),this._atlaserArray.splice(0,$j),this._needGC=!1}return!0},$j.freeAll=function(){for(var $j=0,$O=this._atlaserArray.length;$j<$O;$j++)this._atlaserArray[$j].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$j.getAtlaserCount=function(){return this._atlaserArray.length},$j.getAtlaserByIndex=function($j){return this._atlaserArray[$j]},$l(1,$h,"instance",function(){return $h._Instance||($h._Instance=new $h(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$h._Instance}),$l(1,$h,"enabled",function(){return $E.atlasEnable}),$l(1,$h,"atlasLimitWidth",function(){return $h._atlasLimitWidth},function($j){$h._atlasLimitWidth=$j}),$l(1,$h,"atlasLimitHeight",function(){return $h._atlasLimitHeight},function($j){$h._atlasLimitHeight=$j}),$h._enable=function(){$E.atlasEnable=!0},$h._disable=function(){$E.atlasEnable=!1},$h.__init__=function(){$h.atlasTextureWidth=2048,$h.atlasTextureHeight=2048,$h.maxTextureCount=6,$h.atlasLimitWidth=512,$h.atlasLimitHeight=512},$h._atlasLimitWidth=0,$h._atlasLimitHeight=0,$h.gridSize=16,$h.atlasTextureWidth=0,$h.atlasTextureHeight=0,$h.maxTextureCount=0,$h._atlasRestore=0,$h.BOARDER_TYPE_NO=0,$h.BOARDER_TYPE_RIGHT=1,$h.BOARDER_TYPE_LEFT=2,$h.BOARDER_TYPE_BOTTOM=4,$h.BOARDER_TYPE_TOP=8,$h.BOARDER_TYPE_ALL=15,$h._sid_=0,$h._Instance=null,$h}(),$f=function(){function $j(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $t($j,"laya.webgl.atlas.MergeFillInfo"),$j}(),$C=function(){function $O(){}return $t($O,"laya.webgl.canvas.BlendMode"),$O._init_=function($j){$O.fns=[$O.BlendNormal,$O.BlendAdd,$O.BlendMultiply,$O.BlendScreen,$O.BlendOverlay,$O.BlendLight,$O.BlendMask,$O.BlendDestinationOut],$O.targetFns=[$O.BlendNormalTarget,$O.BlendAddTarget,$O.BlendMultiplyTarget,$O.BlendScreenTarget,$O.BlendOverlayTarget,$O.BlendLightTarget,$O.BlendMask,$O.BlendDestinationOut]},$O.BlendNormal=function($j){$j.blendFunc(1,771)},$O.BlendAdd=function($j){$j.blendFunc(1,772)},$O.BlendMultiply=function($j){$j.blendFunc(774,771)},$O.BlendScreen=function($j){$j.blendFunc(1,1)},$O.BlendOverlay=function($j){$j.blendFunc(1,769)},$O.BlendLight=function($j){$j.blendFunc(1,1)},$O.BlendNormalTarget=function($j){$j.blendFunc(1,771)},$O.BlendAddTarget=function($j){$j.blendFunc(1,772)},$O.BlendMultiplyTarget=function($j){$j.blendFunc(774,771)},$O.BlendScreenTarget=function($j){$j.blendFunc(1,1)},$O.BlendOverlayTarget=function($j){$j.blendFunc(1,769)},$O.BlendLightTarget=function($j){$j.blendFunc(1,1)},$O.BlendMask=function($j){$j.blendFunc(0,770)},$O.BlendDestinationOut=function($j){$j.blendFunc(0,0)},$O.activeBlendFunction=null,$O.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$O.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$O.NORMAL="normal",$O.ADD="add",$O.MULTIPLY="multiply",$O.SCREEN="screen",$O.LIGHT="light",$O.OVERLAY="overlay",$O.DESTINATIONOUT="destination-out",$O.fns=[],$O.targetFns=[],$O}(),$J=function(){function $V($j){this._color=$s.create("black"),this.setValue($j)}$t($V,"laya.webgl.canvas.DrawStyle");var $j=$V.prototype;return $j.setValue=function($j){if($j){if("string"==typeof $j)return void(this._color=$s.create($j));if($j instanceof laya.utils.Color)return void(this._color=$j)}},$j.reset=function(){this._color=$s.create("black")},$j.equal=function($j){return"string"==typeof $j?this._color.strColor===$j:$j instanceof laya.utils.Color&&this._color.numColor===$j.numColor},$j.toColorStr=function(){return this._color.strColor},$V.create=function($j){var $O;if($j&&("string"==typeof $j?$O=$s.create($j):$j instanceof laya.utils.Color&&($O=$j),$O))return $O._drawStyle||($O._drawStyle=new $V($j));return laya.webgl.canvas.DrawStyle.DEFAULT},$m($V,["DEFAULT",function(){return this.DEFAULT=new $V("#000000")}]),$V}(),$u=function(){function $j(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$Aj.mainContext;this.ib=$Ij.create(35048),this.vb=$Pj.create(5)}$t($j,"laya.webgl.canvas.Path");var $O=$j.prototype;return $O.addPoint=function($j,$O){this.tempArray.push($j,$O)},$O.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$O.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$O.polygon=function($j,$O,$V,$l,$T,$S){var $m;return this.geomatrys.push(this._curGeomatry=$m=new $Yj($j,$O,$V,$l,$T,$S)),$l||($m.fill=!1),null==$S&&($m.borderWidth=0),$m},$O.setGeomtry=function($j){this.geomatrys.push(this._curGeomatry=$j)},$O.drawLine=function($j,$O,$V,$l,$T){var $S;return this.closePath?this.geomatrys.push(this._curGeomatry=$S=new $vj($j,$O,$V,$l,$T)):this.geomatrys.push(this._curGeomatry=$S=new $Mj($j,$O,$V,$l,$T)),$S.fill=!1,$S},$O.update=function(){var $j=this.ib._byteLength,$O=this.geomatrys.length;this.offset=$j;for(var $V=this.geoStart;$V<$O;$V++)this.geomatrys[$V].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$O,this.count=(this.ib._byteLength-$j)/$bj.BYTES_PIDX},$O.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$O.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$j}(),$y=function(){function $p(){}$t($p,"laya.webgl.canvas.save.SaveBase");var $j=$p.prototype;return $x.imps($j,{"laya.webgl.canvas.save.ISaveData":!0}),$j.isSaveMark=function(){return!1},$j.restore=function($j){this._dataObj[this._valueName]=this._value,($p._cache[$p._cache._length++]=this)._newSubmit&&($j._curSubmit=$Sj.RENDERBASE,$j._renderKey=0)},$p._createArray=function(){var $j=[];return $j._length=0,$j},$p._init=function(){var $j=$p._namemap={};return $j[1]="ALPHA",$j[2]="fillStyle",$j[8]="font",$j[256]="lineWidth",$j[512]="strokeStyle",$j[8192]="_mergeID",$j[1024]=$j[2048]=$j[4096]=[],$j[16384]="textBaseline",$j[32768]="textAlign",$j[65536]="_nBlendType",$j[1048576]="shader",$j[2097152]="filters",$j},$p.save=function($j,$O,$V,$l){if(($j._saveMark._saveuse&$O)!==$O){$j._saveMark._saveuse|=$O;var $T=$p._cache,$S=0<$T._length?$T[--$T._length]:new $p;$S._value=$V[$S._valueName=$p._namemap[$O]],$S._dataObj=$V,$S._newSubmit=$l;var $m=$j._save;$m[$m._length++]=$S}},$p._cache=laya.webgl.canvas.save.SaveBase._createArray(),$p._namemap=$p._init(),$p}(),$W=function(){function $S(){this._clipRect=new $_}$t($S,"laya.webgl.canvas.save.SaveClipRect");var $j=$S.prototype;return $x.imps($j,{"laya.webgl.canvas.save.ISaveData":!0}),$j.isSaveMark=function(){return!1},$j.restore=function($j){$j._clipRect=this._clipSaveRect,($S._cache[$S._cache._length++]=this)._submitScissor.submitLength=$j._submits._length-this._submitScissor.submitIndex,$j._curSubmit=$Sj.RENDERBASE,$j._renderKey=0},$S.save=function($j,$O){if(131072!=(131072&$j._saveMark._saveuse)){$j._saveMark._saveuse|=131072;var $V=$S._cache,$l=0<$V._length?$V[--$V._length]:new $S;$l._clipSaveRect=$j._clipRect,$j._clipRect=$l._clipRect.copyFrom($j._clipRect),$l._submitScissor=$O;var $T=$j._save;$T[$T._length++]=$l}},$m($S,["_cache",function(){return this._cache=$y._createArray()}]),$S}(),$K=function(){function $w(){this._contextX=0,this._contextY=0,this._clipRect=new $_,this._rect=new $_,this._matrix=new $z}$t($w,"laya.webgl.canvas.save.SaveClipRectStencil");var $j=$w.prototype;return $x.imps($j,{"laya.webgl.canvas.save.ISaveData":!0}),$j.isSaveMark=function(){return!1},$j.restore=function($j){$gj.restore($j,this._rect,this._saveMatrix,this._contextX,this._contextY),$j._clipRect=this._clipSaveRect,$j._curMat=this._saveMatrix,$j._x=this._contextX,$j._y=this._contextY,$w._cache[$w._cache._length++]=this,$j._curSubmit=$Sj.RENDERBASE},$w.save=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){if(262144!=(262144&$j._saveMark._saveuse)){$j._saveMark._saveuse|=262144;var $g=$w._cache,$e=0<$g._length?$g[--$g._length]:new $w;$e._clipSaveRect=$j._clipRect,$e._clipRect.setTo($m,$p,$o,$H),$j._clipRect=$e._clipRect,$e._rect.x=$V,$e._rect.y=$l,$e._rect.width=$T,$e._rect.height=$S,$e._contextX=$j._x,$e._contextY=$j._y,$e._saveMatrix=$j._curMat,$j._curMat.copyTo($e._matrix),$j._curMat=$e._matrix,$e._submitStencil=$O;var $t=$j._save;$t[$t._length++]=$e}},$m($w,["_cache",function(){return this._cache=$y._createArray()}]),$w}(),$d=function(){function $l(){this._saveuse=0}$t($l,"laya.webgl.canvas.save.SaveMark");var $j=$l.prototype;return $x.imps($j,{"laya.webgl.canvas.save.ISaveData":!0}),$j.isSaveMark=function(){return!0},$j.restore=function($j){$j._saveMark=this._preSaveMark,$l._no[$l._no._length++]=this},$l.Create=function($j){var $O=$l._no,$V=0<$O._length?$O[--$O._length]:new $l;return $V._saveuse=0,$V._preSaveMark=$j._saveMark,$j._saveMark=$V},$m($l,["_no",function(){return this._no=$y._createArray()}]),$l}(),$L=function(){function $S(){this._matrix=new $z}$t($S,"laya.webgl.canvas.save.SaveTransform");var $j=$S.prototype;return $x.imps($j,{"laya.webgl.canvas.save.ISaveData":!0}),$j.isSaveMark=function(){return!1},$j.restore=function($j){$j._curMat=this._savematrix,$S._no[$S._no._length++]=this},$S.save=function($j){var $O=$j._saveMark;if(2048!=(2048&$O._saveuse)){$O._saveuse|=2048;var $V=$S._no,$l=0<$V._length?$V[--$V._length]:new $S;$l._savematrix=$j._curMat,$j._curMat=$j._curMat.copyTo($l._matrix);var $T=$j._save;$T[$T._length++]=$l}},$m($S,["_no",function(){return this._no=$y._createArray()}]),$S}(),$Q=function(){function $T(){}$t($T,"laya.webgl.canvas.save.SaveTranslate");var $j=$T.prototype;return $x.imps($j,{"laya.webgl.canvas.save.ISaveData":!0}),$j.isSaveMark=function(){return!1},$j.restore=function($j){$j._curMat;$j._x=this._x,$j._y=this._y,$T._no[$T._no._length++]=this},$T.save=function($j){var $O=$T._no,$V=0<$O._length?$O[--$O._length]:new $T;$V._x=$j._x,$V._y=$j._y;var $l=$j._save;$l[$l._length++]=$V},$m($T,["_no",function(){return this._no=$y._createArray()}]),$T}(),$D=function(){function $j(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $_}$t($j,"laya.webgl.resource.RenderTargetMAX");var $O=$j.prototype;return $O.setSP=function($j){this._sp=$j},$O.size=function($j,$O){var $V=this;this._width!==$j||this._height!==$O?(this.repaint=!0,this._width=$j,this._height=$O,this.target?this.target.size($j,$O):this.target=$nj.create($j,$O),this.target.hasListener("recovered")||this.target.on("recovered",this,function($j){$x.timer.callLater($V._sp,$V._sp.repaint)})):this.target.size($j,$O)},$O._flushToTarget=function($j,$O){if(!$O._destroy){var $V=$aj.worldScissorTest,$l=$aj.worldClipRect;$aj.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$aj.worldScissorTest=!1,$Aj.mainContext.disable(3089);var $T=$aj.worldAlpha,$S=$aj.worldMatrix4,$m=$aj.worldMatrix,$p=$aj.worldFilters,$o=$aj.worldShaderDefines;if($aj.worldMatrix=$z.EMPTY,$aj.restoreTempArray(),$aj.worldMatrix4=$aj.TEMPMAT4_ARRAY,$aj.worldAlpha=1,$aj.worldFilters=null,$aj.worldShaderDefines=null,$kj.activeShader=null,$O.start(),$E.showCanvasMark?$O.clear(0,1,0,.3):$O.clear(0,0,0,0),$j.flush(),$O.end(),$kj.activeShader=null,$aj.worldAlpha=$T,$aj.worldMatrix4=$S,$aj.worldMatrix=$m,$aj.worldFilters=$p,$aj.worldShaderDefines=$o,$aj.worldScissorTest=$V){var $H=$aj.height-$l.y-$l.height;$Aj.mainContext.scissor($l.x,$H,$l.width,$l.height),$Aj.mainContext.enable(3089)}$aj.worldClipRect=$l}},$O.flush=function($j){this.repaint&&(this._flushToTarget($j,this.target),this.repaint=!1)},$O.drawTo=function($j,$O,$V,$l,$T){$j.drawTexture(this.target.getTexture(),$O,$V,$l,$T,0,0)},$O.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$j}(),$I=function(){function $j(){this.ALPHA=1,this.shaderType=0,this.defines=new $Bj}return $t($j,"laya.webgl.shader.d2.Shader2D"),$j.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$j.__init__=function(){var $j,$O;$dj.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$dj.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$dj.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$dj.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$dj.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$dj.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$dj.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$dj.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$j="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$O='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$dj.preCompile2D(0,1,$j,$O,null),$j="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$O='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$dj.preCompile2D(0,2,$j,$O,null),$j="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$O="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$dj.preCompile2D(0,4,$j,$O,null),$j="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$O='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$dj.preCompile2D(0,256,$j,$O,null),$j="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$O="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$dj.preCompile2D(0,512,$j,$O,null)},$j}(),$P=function(){function $O($j,$O,$V){this._value=0,this._name2int=$j,this._int2name=$O,this._int2nameMap=$V}$t($O,"laya.webgl.shader.ShaderDefines");var $j=$O.prototype;return $j.add=function($j){return"string"==typeof $j&&($j=this._name2int[$j]),this._value|=$j,this._value},$j.addInt=function($j){return this._value|=$j,this._value},$j.remove=function($j){return"string"==typeof $j&&($j=this._name2int[$j]),this._value&=~$j,this._value},$j.isDefine=function($j){return(this._value&$j)===$j},$j.getValue=function(){return this._value},$j.setValue=function($j){this._value=$j},$j.toNameDic=function(){var $j=this._int2nameMap[this._value];return $j||$O._toText(this._value,this._int2name,this._int2nameMap)},$O._reg=function($j,$O,$V,$l){$l[$V[$j]=$O]=$j},$O._toText=function($j,$O,$V){var $l=$V[$j];if($l)return $l;for(var $T={},$S=1,$m=0;$m<32&&!($j<($S=1<<$m));$m++)if($j&$S){var $p=$O[$S];$p&&($T[$p]="")}return $V[$j]=$T},$O._toInt=function($j,$O){for(var $V=$j.split("."),$l=0,$T=0,$S=$V.length;$T<$S;$T++){var $m=$O[$V[$T]];if(!$m)throw new Error("Defines to int err:"+$j+"/"+$V[$T]);$l|=$m}return $l},$O}(),$jj=function(){function $m(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $z}$t($m,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $j=$m.prototype;return $j.init=function($j,$O,$V){if($O)this._vs=$O;else{this._vs=[];var $l=$j.width,$T=$j.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($l,0,1,0,1,1,1,1),this._vs.push($l,$T,1,1,1,1,1,1),this._vs.push(0,$T,0,1,1,1,1,1)}$V?this._ps=$V:($m._defaultPS||($m._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$m._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$j},$j.init2=function($j,$O,$V,$l,$T){this.transform&&(this.transform=null),$V?this._ps=$V:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$l,this._uvs=$T,this.mEleNum=this._ps.length,this.mTexture=$j,($h.isConchNode||$h.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$j._initMyData=function(){var $j=0,$O=0,$V=4*this._verticles.length;this._vs=$m._tempVS;var $l=!1;if($h.isConchNode||$h.isConchApp?(this._vs.length=$V,$l=!0):this._vs.length<$V&&(this._vs.length=$V,$l=!0),$m._tVSLen=$V,$l)for(;$j<$V;)this._vs[$j]=this._verticles[$O],this._vs[$j+1]=this._verticles[$O+1],this._vs[$j+2]=this._uvs[$O],this._vs[$j+3]=this._uvs[$O+1],this._vs[$j+4]=1,this._vs[$j+5]=1,this._vs[$j+6]=1,this._vs[$j+7]=1,$j+=8,$O+=2;else for(;$j<$V;)this._vs[$j]=this._verticles[$O],this._vs[$j+1]=this._verticles[$O+1],this._vs[$j+2]=this._uvs[$O],this._vs[$j+3]=this._uvs[$O+1],$j+=8,$O+=2},$j.getData2=function($j,$O,$V){var $l;this.mVBBuffer=$j,this.mIBBuffer=$O,this._initMyData(),$j.appendEx2(this._vs,Float32Array,$m._tVSLen,4),this._indexStart=$O._byteLength,($l=$m._tempIB).length<this._ps.length&&($l.length=this._ps.length);for(var $T=0,$S=this._ps.length;$T<$S;$T++)$l[$T]=this._ps[$T]+$V;$O.appendEx2($l,Uint16Array,this._ps.length,2)},$j.getData=function($j,$O,$V){if(this.mVBBuffer=$j,this.mIBBuffer=$O,$j.append(this.mVBData),this._indexStart=$O._byteLength,this.mIBData.start!=$V){for(var $l=0,$T=this._ps.length;$l<$T;$l++)this.mIBData[$l]=this._ps[$l]+$V;this.mIBData.start=$V}$O.append(this.mIBData)},$j.render=function($j,$O,$V){if($h.isWebGL&&this.mTexture){$j._renderKey=0,$j._shader2D.glTexture=null,$Oj.getInstance().addSkinMesh(this);var $l=$Sj.createShape($j,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$Uj.create(512,0));this.transform||(this.transform=$z.EMPTY),this.transform.translate($O,$V),$z.mul(this.transform,$j._curMat,this._tempMatrix),this.transform.translate(-$O,-$V);var $T=$l.shaderValue,$S=$T.u_mmat2||$aj.getMatrArray();$aj.mat2MatArray(this._tempMatrix,$S),$T.textureHost=this.mTexture,$T.offsetX=0,$T.offsetY=0,$T.u_mmat2=$S,$T.ALPHA=$j._shader2D.ALPHA,$j._submits[$j._submits._length++]=$l}else $h.isConchApp&&this.mTexture&&(this.transform||(this.transform=$z.EMPTY),$j.setSkinMesh&&$j.setSkinMesh($O,$V,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$m._tempVS=[],$m._tempIB=[],$m._defaultPS=null,$m._tVSLen=0,$m}(),$Oj=function(){function $j(){this.ib=null,this.vb=null;$Aj.mainContext;this.ib=$Ij.create(35048),this.vb=$Pj.create(8)}$t($j,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $O=$j.prototype;return $O.addSkinMesh=function($j){$j.getData2(this.vb,this.ib,this.vb._byteLength/32)},$O.reset=function(){this.vb.clear(),this.ib.clear()},$j.getInstance=function(){return $j.instance=$j.instance||new $j},$j.instance=null,$j}(),$Vj=function(){function $j($j,$O,$V,$l,$T,$S,$m,$p,$o){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$o&&($o=0),this.x=$j,this.y=$O,this.width=$V,this.height=$l,this.edges=$T,this.color=$S,this.borderWidth=$m,this.borderColor=$p}$t($j,"laya.webgl.shapes.BasePoly");var $O=$j.prototype;return $x.imps($O,{"laya.webgl.shapes.IShape":!0}),$O.getData=function($j,$O,$V){},$O.rebuild=function($j){},$O.setMatrix=function($j){},$O.needUpdate=function($j){return!0},$O.sector=function($j,$O,$V){var $l=this.x,$T=this.y,$S=this.edges,$m=(this.r1-this.r0)/$S,$p=this.width,$o=this.height,$H=this.color,$g=($H>>16&255)/255,$e=($H>>8&255)/255,$t=(255&$H)/255;$j.push($l,$T,$g,$e,$t);for(var $w=0;$w<$S+1;$w++)$j.push($l+Math.sin($m*$w+this.r0)*$p,$T+Math.cos($m*$w+this.r0)*$o),$j.push($g,$e,$t);for($w=0;$w<$S;$w++)$O.push($V,$V+$w+1,$V+$w+2)},$O.createLine2=function($j,$O,$V,$l,$T,$S){var $m,$p,$o,$H,$g,$e,$t,$w,$s,$b,$r,$h,$a,$c,$A,$Z,$x,$E,$U,$z,$$=$j.concat(),$_=$T,$B=this.borderColor,$M=($B>>16&255)/255,$v=($B>>8&255)/255,$Y=(255&$B)/255,$R=$$.length/2,$q=$l,$i=$V/2;$o=$$[0],$H=$$[1],$b=$o-($g=$$[2]),$s=($s=-($H-($e=$$[3])))/($z=Math.sqrt($s*$s+$b*$b))*$i,$b=$b/$z*$i,$_.push($o-$s+this.x,$H-$b+this.y,$M,$v,$Y,$o+$s+this.x,$H+$b+this.y,$M,$v,$Y);for(var $k=1;$k<$R-1;$k++)$o=$$[2*($k-1)],$H=$$[2*($k-1)+1],$g=$$[2*$k],$e=$$[2*$k+1],$t=$$[2*($k+1)],$w=$$[2*($k+1)+1],$b=$o-$g,$h=$g-$t,$A=(-($s=($s=-($H-$e))/($z=Math.sqrt($s*$s+$b*$b))*$i)+$o)*(-($b=$b/$z*$i)+$e)-(-$s+$g)*(-$b+$H),$E=(-($r=($r=-($e-$w))/($z=Math.sqrt($r*$r+$h*$h))*$i)+$t)*(-($h=$h/$z*$i)+$e)-(-$r+$g)*(-$h+$w),$U=($a=-$b+$H-(-$b+$e))*($x=-$r+$g-(-$r+$t))-($Z=-$h+$w-(-$h+$e))*($c=-$s+$g-(-$s+$o)),Math.abs($U)<.1?($U+=10.1,$_.push($g-$s+this.x,$e-$b+this.y,$M,$v,$Y,$g+$s+this.x,$e+$b+this.y,$M,$v,$Y)):((($m=($c*$E-$x*$A)/$U)-$g)*($m-$g)+(($p=($Z*$A-$a*$E)/$U)-$e)+($p-$e),$_.push($m+this.x,$p+this.y,$M,$v,$Y,$g-($m-$g)+this.x,$e-($p-$e)+this.y,$M,$v,$Y));$o=$$[$$.length-4],$H=$$[$$.length-3],$b=$o-($g=$$[$$.length-2]),$s=($s=-($H-($e=$$[$$.length-1])))/($z=Math.sqrt($s*$s+$b*$b))*$i,$b=$b/$z*$i,$_.push($g-$s+this.x,$e-$b+this.y,$M,$v,$Y,$g+$s+this.x,$e+$b+this.y,$M,$v,$Y);var $n=$S;for($k=1;$k<$n;$k++)$O.push($q+2*($k-1),$q+2*($k-1)+1,$q+2*$k+1,$q+2*$k+1,$q+2*$k,$q+2*($k-1));return $_},$O.createLine=function($j,$O,$V,$l){var $T=$j.concat(),$S=$j,$m=this.borderColor,$p=($m>>16&255)/255,$o=($m>>8&255)/255,$H=(255&$m)/255;$T.splice(0,5);var $g,$e,$t,$w,$s,$b,$r,$h,$a,$c,$A,$Z,$x,$E,$U,$z,$$,$_,$B,$M,$v=$T.length/5,$Y=$l,$R=$V/2;$t=$T[0],$w=$T[1],$c=$t-($s=$T[5]),$a=($a=-($w-($b=$T[6])))/($M=Math.sqrt($a*$a+$c*$c))*$R,$c=$c/$M*$R,$S.push($t-$a,$w-$c,$p,$o,$H,$t+$a,$w+$c,$p,$o,$H);for(var $q=1;$q<$v-1;$q++)$t=$T[5*($q-1)],$w=$T[5*($q-1)+1],$s=$T[5*$q],$b=$T[5*$q+1],$r=$T[5*($q+1)],$h=$T[5*($q+1)+1],$c=$t-$s,$Z=$s-$r,$U=(-($a=($a=-($w-$b))/($M=Math.sqrt($a*$a+$c*$c))*$R)+$t)*(-($c=$c/$M*$R)+$b)-(-$a+$s)*(-$c+$w),$_=(-($A=($A=-($b-$h))/($M=Math.sqrt($A*$A+$Z*$Z))*$R)+$r)*(-($Z=$Z/$M*$R)+$b)-(-$A+$s)*(-$Z+$h),$B=($x=-$c+$w-(-$c+$b))*($$=-$A+$s-(-$A+$r))-($z=-$Z+$h-(-$Z+$b))*($E=-$a+$s-(-$a+$t)),Math.abs($B)<.1?($B+=10.1,$S.push($s-$a,$b-$c,$p,$o,$H,$s+$a,$b+$c,$p,$o,$H)):((($g=($E*$_-$$*$U)/$B)-$s)*($g-$s)+(($e=($z*$U-$x*$_)/$B)-$b)+($e-$b),$S.push($g,$e,$p,$o,$H,$s-($g-$s),$b-($e-$b),$p,$o,$H));$t=$T[$T.length-10],$w=$T[$T.length-9],$c=$t-($s=$T[$T.length-5]),$a=($a=-($w-($b=$T[$T.length-4])))/($M=Math.sqrt($a*$a+$c*$c))*$R,$c=$c/$M*$R,$S.push($s-$a,$b-$c,$p,$o,$H,$s+$a,$b+$c,$p,$o,$H);var $i=this.edges+1;for($q=1;$q<$i;$q++)$O.push($Y+2*($q-1),$Y+2*($q-1)+1,$Y+2*$q+1,$Y+2*$q+1,$Y+2*$q,$Y+2*($q-1));return $S},$O.createLoopLine=function($j,$O,$V,$l,$T,$S){var $m=$j.concat(),$p=$T||$j,$o=this.borderColor,$H=($o>>16&255)/255,$g=($o>>8&255)/255,$e=(255&$o)/255;$m.splice(0,5);var $t=[$m[0],$m[1]],$w=[$m[$m.length-5],$m[$m.length-4]],$s=$w[0]+.5*($t[0]-$w[0]),$b=$w[1]+.5*($t[1]-$w[1]);$m.unshift($s,$b,0,0,0),$m.push($s,$b,0,0,0);var $r,$h,$a,$c,$A,$Z,$x,$E,$U,$z,$$,$_,$B,$M,$v,$Y,$R,$q,$i,$k,$n=$m.length/5,$G=$l,$F=$V/2;$a=$m[0],$c=$m[1],$z=$a-($A=$m[5]),$U=($U=-($c-($Z=$m[6])))/($k=Math.sqrt($U*$U+$z*$z))*$F,$z=$z/$k*$F,$p.push($a-$U,$c-$z,$H,$g,$e,$a+$U,$c+$z,$H,$g,$e);for(var $N=1;$N<$n-1;$N++)$a=$m[5*($N-1)],$c=$m[5*($N-1)+1],$A=$m[5*$N],$Z=$m[5*$N+1],$x=$m[5*($N+1)],$E=$m[5*($N+1)+1],$z=$a-$A,$_=$A-$x,$v=(-($U=($U=-($c-$Z))/($k=Math.sqrt($U*$U+$z*$z))*$F)+$a)*(-($z=$z/$k*$F)+$Z)-(-$U+$A)*(-$z+$c),$q=(-($$=($$=-($Z-$E))/($k=Math.sqrt($$*$$+$_*$_))*$F)+$x)*(-($_=$_/$k*$F)+$Z)-(-$$+$A)*(-$_+$E),$i=($B=-$z+$c-(-$z+$Z))*($R=-$$+$A-(-$$+$x))-($Y=-$_+$E-(-$_+$Z))*($M=-$U+$A-(-$U+$a)),Math.abs($i)<.1?($i+=10.1,$p.push($A-$U,$Z-$z,$H,$g,$e,$A+$U,$Z+$z,$H,$g,$e)):((($r=($M*$q-$R*$v)/$i)-$A)*($r-$A)+(($h=($Y*$v-$B*$q)/$i)-$Z)+($h-$Z),$p.push($r,$h,$H,$g,$e,$A-($r-$A),$Z-($h-$Z),$H,$g,$e));$S&&($O=$S);var $X=this.edges+1;for($N=1;$N<$X;$N++)$O.push($G+2*($N-1),$G+2*($N-1)+1,$G+2*$N+1,$G+2*$N+1,$G+2*$N,$G+2*($N-1));return $O.push($G+2*($N-1),$G+2*($N-1)+1,$G+1,$G+1,$G,$G+2*($N-1)),$p},$j}(),$lj=function(){function $b(){}return $t($b,"laya.webgl.shapes.Earcut"),$b.earcut=function($j,$O,$V){$V=$V||2;var $l,$T,$S,$m,$p,$o,$H,$g=$O&&$O.length,$e=$g?$O[0]*$V:$j.length,$t=$b.linkedList($j,0,$e,$V,!0),$w=[];if(!$t)return $w;if($g&&($t=$b.eliminateHoles($j,$O,$t,$V)),$j.length>80*$V){$l=$S=$j[0],$T=$m=$j[1];for(var $s=$V;$s<$e;$s+=$V)($p=$j[$s])<$l&&($l=$p),($o=$j[$s+1])<$T&&($T=$o),$S<$p&&($S=$p),$m<$o&&($m=$o);$H=0!==($H=Math.max($S-$l,$m-$T))?1/$H:0}return $b.earcutLinked($t,$w,$V,$l,$T,$H),$w},$b.linkedList=function($j,$O,$V,$l,$T){var $S,$m;if($T===0<$b.signedArea($j,$O,$V,$l))for($S=$O;$S<$V;$S+=$l)$m=$b.insertNode($S,$j[$S],$j[$S+1],$m);else for($S=$V-$l;$O<=$S;$S-=$l)$m=$b.insertNode($S,$j[$S],$j[$S+1],$m);return $m&&$b.equals($m,$m.next)&&($b.removeNode($m),$m=$m.next),$m},$b.filterPoints=function($j,$O){if(!$j)return $j;$O||($O=$j);var $V,$l=$j;do{if($V=!1,$l.steiner||!$b.equals($l,$l.next)&&0!==$b.area($l.prev,$l,$l.next))$l=$l.next;else{if($b.removeNode($l),($l=$O=$l.prev)===$l.next)break;$V=!0}}while($V||$l!==$O);return $O},$b.earcutLinked=function($j,$O,$V,$l,$T,$S,$m){if($j){!$m&&$S&&$b.indexCurve($j,$l,$T,$S);for(var $p,$o,$H=$j;$j.prev!==$j.next;)if($p=$j.prev,$o=$j.next,$S?$b.isEarHashed($j,$l,$T,$S):$b.isEar($j))$O.push($p.i/$V),$O.push($j.i/$V),$O.push($o.i/$V),$b.removeNode($j),$j=$o.next,$H=$o.next;else if(($j=$o)===$H){$m?1===$m?($j=$b.cureLocalIntersections($j,$O,$V),$b.earcutLinked($j,$O,$V,$l,$T,$S,2)):2===$m&&$b.splitEarcut($j,$O,$V,$l,$T,$S):$b.earcutLinked($b.filterPoints($j,null),$O,$V,$l,$T,$S,1);break}}},$b.isEar=function($j){var $O=$j.prev,$V=$j,$l=$j.next;if(0<=$b.area($O,$V,$l))return!1;for(var $T=$j.next.next;$T!==$j.prev;){if($b.pointInTriangle($O.x,$O.y,$V.x,$V.y,$l.x,$l.y,$T.x,$T.y)&&0<=$b.area($T.prev,$T,$T.next))return!1;$T=$T.next}return!0},$b.isEarHashed=function($j,$O,$V,$l){var $T=$j.prev,$S=$j,$m=$j.next;if(0<=$b.area($T,$S,$m))return!1;for(var $p=$T.x<$S.x?$T.x<$m.x?$T.x:$m.x:$S.x<$m.x?$S.x:$m.x,$o=$T.y<$S.y?$T.y<$m.y?$T.y:$m.y:$S.y<$m.y?$S.y:$m.y,$H=$T.x>$S.x?$T.x>$m.x?$T.x:$m.x:$S.x>$m.x?$S.x:$m.x,$g=$T.y>$S.y?$T.y>$m.y?$T.y:$m.y:$S.y>$m.y?$S.y:$m.y,$e=$b.zOrder($p,$o,$O,$V,$l),$t=$b.zOrder($H,$g,$O,$V,$l),$w=$j.nextZ;$w&&$w.z<=$t;){if($w!==$j.prev&&$w!==$j.next&&$b.pointInTriangle($T.x,$T.y,$S.x,$S.y,$m.x,$m.y,$w.x,$w.y)&&0<=$b.area($w.prev,$w,$w.next))return!1;$w=$w.nextZ}for($w=$j.prevZ;$w&&$w.z>=$e;){if($w!==$j.prev&&$w!==$j.next&&$b.pointInTriangle($T.x,$T.y,$S.x,$S.y,$m.x,$m.y,$w.x,$w.y)&&0<=$b.area($w.prev,$w,$w.next))return!1;$w=$w.prevZ}return!0},$b.cureLocalIntersections=function($j,$O,$V){var $l=$j;do{var $T=$l.prev,$S=$l.next.next;!$b.equals($T,$S)&&$b.intersects($T,$l,$l.next,$S)&&$b.locallyInside($T,$S)&&$b.locallyInside($S,$T)&&($O.push($T.i/$V),$O.push($l.i/$V),$O.push($S.i/$V),$b.removeNode($l),$b.removeNode($l.next),$l=$j=$S),$l=$l.next}while($l!==$j);return $l},$b.splitEarcut=function($j,$O,$V,$l,$T,$S){var $m=$j;do{for(var $p=$m.next.next;$p!==$m.prev;){if($m.i!==$p.i&&$b.isValidDiagonal($m,$p)){var $o=$b.splitPolygon($m,$p);return $m=$b.filterPoints($m,$m.next),$o=$b.filterPoints($o,$o.next),$b.earcutLinked($m,$O,$V,$l,$T,$S),void $b.earcutLinked($o,$O,$V,$l,$T,$S)}$p=$p.next}$m=$m.next}while($m!==$j)},$b.eliminateHoles=function($j,$O,$V,$l){var $T,$S,$m,$p,$o,$H=[];for($T=0,$S=$O.length;$T<$S;$T++)$m=$O[$T]*$l,$p=$T<$S-1?$O[$T+1]*$l:$j.length,($o=$b.linkedList($j,$m,$p,$l,!1))===$o.next&&($o.steiner=!0),$H.push($b.getLeftmost($o));for($H.sort($b.compareX),$T=0;$T<$H.length;$T++)$b.eliminateHole($H[$T],$V),$V=$b.filterPoints($V,$V.next);return $V},$b.compareX=function($j,$O){return $j.x-$O.x},$b.eliminateHole=function($j,$O){if($O=$b.findHoleBridge($j,$O)){var $V=$b.splitPolygon($O,$j);$b.filterPoints($V,$V.next)}},$b.findHoleBridge=function($j,$O){var $V,$l=$O,$T=$j.x,$S=$j.y,$m=-1/0;do{if($S<=$l.y&&$S>=$l.next.y&&$l.next.y!==$l.y){var $p=$l.x+($S-$l.y)*($l.next.x-$l.x)/($l.next.y-$l.y);if($p<=$T&&$m<$p){if(($m=$p)===$T){if($S===$l.y)return $l;if($S===$l.next.y)return $l.next}$V=$l.x<$l.next.x?$l:$l.next}}$l=$l.next}while($l!==$O);if(!$V)return null;if($T===$m)return $V.prev;var $o,$H=$V,$g=$V.x,$e=$V.y,$t=1/0;for($l=$V.next;$l!==$H;)$T>=$l.x&&$l.x>=$g&&$T!==$l.x&&$b.pointInTriangle($S<$e?$T:$m,$S,$g,$e,$S<$e?$m:$T,$S,$l.x,$l.y)&&(($o=Math.abs($S-$l.y)/($T-$l.x))<$t||$o===$t&&$l.x>$V.x)&&$b.locallyInside($l,$j)&&($V=$l,$t=$o),$l=$l.next;return $V},$b.indexCurve=function($j,$O,$V,$l){for(var $T=$j;null===$T.z&&($T.z=$b.zOrder($T.x,$T.y,$O,$V,$l)),$T.prevZ=$T.prev,$T.nextZ=$T.next,($T=$T.next)!==$j;);$T.prevZ.nextZ=null,$T.prevZ=null,$b.sortLinked($T)},$b.sortLinked=function($j){var $O,$V,$l,$T,$S,$m,$p,$o,$H=1;do{for($V=$j,$S=$j=null,$m=0;$V;){for($m++,$l=$V,$O=$p=0;$O<$H&&($p++,$l=$l.nextZ);$O++);for($o=$H;0<$p||0<$o&&$l;)0!==$p&&(0===$o||!$l||$V.z<=$l.z)?($V=($T=$V).nextZ,$p--):($l=($T=$l).nextZ,$o--),$S?$S.nextZ=$T:$j=$T,$T.prevZ=$S,$S=$T;$V=$l}$S.nextZ=null,$H*=2}while(1<$m);return $j},$b.zOrder=function($j,$O,$V,$l,$T){return($j=1431655765&(($j=858993459&(($j=252645135&(($j=16711935&(($j=32767*($j-$V)*$T)|$j<<8))|$j<<4))|$j<<2))|$j<<1))|($O=1431655765&(($O=858993459&(($O=252645135&(($O=16711935&(($O=32767*($O-$l)*$T)|$O<<8))|$O<<4))|$O<<2))|$O<<1))<<1},$b.getLeftmost=function($j){for(var $O=$j,$V=$j;$O.x<$V.x&&($V=$O),($O=$O.next)!==$j;);return $V},$b.pointInTriangle=function($j,$O,$V,$l,$T,$S,$m,$p){return 0<=($T-$m)*($O-$p)-($j-$m)*($S-$p)&&0<=($j-$m)*($l-$p)-($V-$m)*($O-$p)&&0<=($V-$m)*($S-$p)-($T-$m)*($l-$p)},$b.isValidDiagonal=function($j,$O){return $j.next.i!==$O.i&&$j.prev.i!==$O.i&&!$b.intersectsPolygon($j,$O)&&$b.locallyInside($j,$O)&&$b.locallyInside($O,$j)&&$b.middleInside($j,$O)},$b.area=function($j,$O,$V){return($O.y-$j.y)*($V.x-$O.x)-($O.x-$j.x)*($V.y-$O.y)},$b.equals=function($j,$O){return $j.x===$O.x&&$j.y===$O.y},$b.intersects=function($j,$O,$V,$l){return!!($b.equals($j,$O)&&$b.equals($V,$l)||$b.equals($j,$l)&&$b.equals($V,$O))||0<$b.area($j,$O,$V)!=0<$b.area($j,$O,$l)&&0<$b.area($V,$l,$j)!=0<$b.area($V,$l,$O)},$b.intersectsPolygon=function($j,$O){var $V=$j;do{if($V.i!==$j.i&&$V.next.i!==$j.i&&$V.i!==$O.i&&$V.next.i!==$O.i&&$b.intersects($V,$V.next,$j,$O))return!0;$V=$V.next}while($V!==$j);return!1},$b.locallyInside=function($j,$O){return $b.area($j.prev,$j,$j.next)<0?0<=$b.area($j,$O,$j.next)&&0<=$b.area($j,$j.prev,$O):$b.area($j,$O,$j.prev)<0||$b.area($j,$j.next,$O)<0},$b.middleInside=function($j,$O){for(var $V=$j,$l=!1,$T=($j.x+$O.x)/2,$S=($j.y+$O.y)/2;$V.y>$S!=$V.next.y>$S&&$V.next.y!==$V.y&&$T<($V.next.x-$V.x)*($S-$V.y)/($V.next.y-$V.y)+$V.x&&($l=!$l),($V=$V.next)!==$j;);return $l},$b.splitPolygon=function($j,$O){var $V=new $Tj($j.i,$j.x,$j.y),$l=new $Tj($O.i,$O.x,$O.y),$T=$j.next,$S=$O.prev;return($j.next=$O).prev=$j,($V.next=$T).prev=$V,($l.next=$V).prev=$l,($S.next=$l).prev=$S,$l},$b.insertNode=function($j,$O,$V,$l){var $T=new $Tj($j,$O,$V);return $l?($T.next=$l.next,($T.prev=$l).next.prev=$T,$l.next=$T):($T.prev=$T).next=$T,$T},$b.removeNode=function($j){$j.next.prev=$j.prev,$j.prev.next=$j.next,$j.prevZ&&($j.prevZ.nextZ=$j.nextZ),$j.nextZ&&($j.nextZ.prevZ=$j.prevZ)},$b.signedArea=function($j,$O,$V,$l){for(var $T=0,$S=$O,$m=$V-$l;$S<$V;$S+=$l)$T+=($j[$m]-$j[$S])*($j[$S+1]+$j[$m+1]),$m=$S;return $T},$b}(),$Tj=function(){function $j($j,$O,$V){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$j,this.x=$O,this.y=$V,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $t($j,"laya.webgl.shapes.EarcutNode"),$j}(),$Sj=(function(){function $j($j,$O,$V,$l,$T,$S,$m){this.lineWidth=$j,this.lineColor=$O,this.lineAlpha=$V,this.fillColor=$l,this.fillAlpha=$T,this.shape=$m,this.fill=$S}$t($j,"laya.webgl.shapes.GeometryData");var $O=$j.prototype;$O.clone=function(){return new $j(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$O.getIndexData=function(){return null},$O.getVertexData=function(){return null},$O.destroy=function(){this.shape=null}}(),function(){function $j($j){if($j instanceof Float32Array)this.points=$j;else if($j instanceof Array){$j.length;this.points=new Float32Array($j)}}$t($j,"laya.webgl.shapes.Vertex");var $O=$j.prototype;$x.imps($O,{"laya.webgl.shapes.IShape":!0}),$O.getData=function($j,$O,$V){},$O.needUpdate=function($j){return!1},$O.rebuild=function($j){},$O.setMatrix=function($j){}}(),function(){function $o($j){void 0===$j&&($j=1e4),this._renderType=$j}$t($o,"laya.webgl.submit.Submit");var $j=$o.prototype;return $x.imps($j,{"laya.webgl.submit.ISubmit":!0}),$j.releaseRender=function(){var $j=$o._cache;($j[$j._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$j.getRenderType=function(){return this._renderType},$j.renderSubmit=function(){if(0===this._numEle)return 1;var $j=this.shaderValue.textureHost;if($j){var $O=$j.source;if(!$j.bitmap||!$O)return 1;this.shaderValue.texture=$O,$j.alphaTexture&&$j.alphaTexture.source&&(this.shaderValue.texture1=$j.alphaTexture.source)}this._vb.bind_upload(this._ib);var $V=$Aj.mainContext;return this.shaderValue.upload(),$C.activeBlendFunction!==this._blendFn&&($V.enable(3042),this._blendFn($V),$C.activeBlendFunction=this._blendFn),$v.drawCall++,$v.trianglesFaces+=this._numEle/3,$V.drawElements(4,this._numEle,5123,this._startIdx),1},$o.__init__=function(){var $j=$o.RENDERBASE=new $o(-1);$j.shaderValue=new $Uj(0,0),$j.shaderValue.ALPHA=-1234},$o.createSubmit=function($j,$O,$V,$l,$T){var $S=$o._cache._length?$o._cache[--$o._cache._length]:new $o;null==$V&&(($V=$S._selfVb||($S._selfVb=$Pj.create(-1))).clear(),$l=0),$S._ib=$O,$S._vb=$V,$S._startIdx=$l*$bj.BYTES_PIDX,$S._numEle=0;var $m=$j._nBlendType;$S._blendFn=$j._targets?$C.targetFns[$m]:$C.fns[$m],$S.shaderValue=$T,$S.shaderValue.setValue($j._shader2D);var $p=$j._shader2D.filters;return $p&&$S.shaderValue.setFilters($p),$S},$o.createShape=function($j,$O,$V,$l,$T,$S){var $m=$o._cache._length?$o._cache[--$o._cache._length]:new $o;$m._ib=$O,$m._vb=$V,$m._numEle=$l,$m._startIdx=$T,$m.shaderValue=$S,$m.shaderValue.setValue($j._shader2D);var $p=$j._nBlendType;return $m._blendFn=$j._targets?$C.targetFns[$p]:$C.fns[$p],$m},$o.TYPE_2D=1e4,$o.TYPE_CANVAS=10003,$o.TYPE_CMDSETRT=10004,$o.TYPE_CUSTOM=10005,$o.TYPE_BLURRT=10006,$o.TYPE_CMDDESTORYPRERT=10007,$o.TYPE_DISABLESTENCIL=10008,$o.TYPE_OTHERIBVB=10009,$o.TYPE_PRIMITIVE=10010,$o.TYPE_RT=10011,$o.TYPE_BLUR_RT=10012,$o.TYPE_TARGET=10013,$o.TYPE_CHANGE_VALUE=10014,$o.TYPE_SHAPE=10015,$o.TYPE_TEXTURE=10016,$o.TYPE_FILLTEXTURE=10017,$o.RENDERBASE=null,$o._cache=(($o._cache=[])._length=0,$o._cache),$o}()),$mj=function(){function $l(){this.fun=null,this.args=null}$t($l,"laya.webgl.submit.SubmitCMD");var $j=$l.prototype;return $x.imps($j,{"laya.webgl.submit.ISubmit":!0}),$j.renderSubmit=function(){return this.fun.apply(null,this.args),1},$j.getRenderType=function(){return 0},$j.releaseRender=function(){var $j=$l._cache;$j[$j._length++]=this},$l.create=function($j,$O){var $V=$l._cache._length?$l._cache[--$l._cache._length]:new $l;return $V.fun=$O,$V.args=$j,$V},$l._cache=(($l._cache=[])._length=0,$l._cache),$l}(),$pj=function(){function $O(){this.variables={}}$t($O,"laya.webgl.submit.SubmitCMDScope");var $j=$O.prototype;return $j.getValue=function($j){return this.variables[$j]},$j.addValue=function($j,$O){return this.variables[$j]=$O},$j.setValue=function($j,$O){return this.variables.hasOwnProperty($j)?this.variables[$j]=$O:null},$j.clear=function(){for(var $j in this.variables)delete this.variables[$j]},$j.recycle=function(){this.clear(),$O.POOL.push(this)},$O.create=function(){var $j=$O.POOL.pop();return $j||($j=new $O),$j},$O.POOL=[],$O}(),$oj=function(){function $e(){this.offset=0,this.startIndex=0,this._mat=$z.create()}$t($e,"laya.webgl.submit.SubmitOtherIBVB");var $j=$e.prototype;return $x.imps($j,{"laya.webgl.submit.ISubmit":!0}),$j.releaseRender=function(){var $j=$e._cache;($j[$j._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$j.getRenderType=function(){return 10009},$j.renderSubmit=function(){var $j=this._shaderValue.textureHost;if($j){var $O=$j.source;if(!$j.bitmap||!$O)return 1;this._shaderValue.texture=$O}this._vb.bind_upload(this._ib);var $V=$aj.worldMatrix4,$l=$z.TEMP;$z.mulPre(this._mat,$V[0],$V[1],$V[4],$V[5],$V[12],$V[13],$l);var $T=$aj.worldMatrix4=$e.tempMatrix4;$T[0]=$l.a,$T[1]=$l.b,$T[4]=$l.c,$T[5]=$l.d,$T[12]=$l.tx,$T[13]=$l.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $S=$Aj.mainContext;return $C.activeBlendFunction!==this._blendFn&&($S.enable(3042),this._blendFn($S),$C.activeBlendFunction=this._blendFn),$v.drawCall++,$v.trianglesFaces+=this._numEle/3,$S.drawElements(4,this._numEle,5123,this.startIndex),$aj.worldMatrix4=$V,$kj.activeShader=null,1},$e.create=function($j,$O,$V,$l,$T,$S,$m,$p,$o){void 0===$o&&($o=0);var $H=$e._cache._length?$e._cache[--$e._cache._length]:new $e;$H._ib=$V,$H._vb=$O,$H._numEle=$l,$H._shader=$T,$H._shaderValue=$S;var $g=$j._nBlendType;switch($H._blendFn=$j._targets?$C.targetFns[$g]:$C.fns[$g],$o){case 0:$H.offset=0,$H.startIndex=$p/($bj.BYTES_PE*$O.vertexStride)*1.5,$H.startIndex*=$bj.BYTES_PIDX;break;case 1:$H.startIndex=$m,$H.offset=$p}return $H},$e._cache=(($e._cache=[])._length=0,$e._cache),$e.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$e}(),$Hj=function(){function $V(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $_,this.screenRect=new $_}$t($V,"laya.webgl.submit.SubmitScissor");var $j=$V.prototype;return $x.imps($j,{"laya.webgl.submit.ISubmit":!0}),$j._scissor=function($j,$O,$V,$l){var $T=$aj.worldMatrix4,$S=$T[0],$m=$T[5],$p=$T[12],$o=$T[13];if($l*=$m,($V*=$S)<1||$l<1)return!1;var $H=($j=$j*$S+$p)+$V,$g=($O=$O*$m+$o)+$l;$j<0&&($V=$H-($j=0)),$O<0&&($l=$g-($O=0));var $e=$aj.worldClipRect;if($j=Math.max($j,$e.x),$O=Math.max($O,$e.y),$V=Math.min($H,$e.right)-$j,$l=Math.min($g,$e.bottom)-$O,$V<1||$l<1)return!1;var $t=$aj.worldScissorTest;return this.screenRect.copyFrom($e),$e.x=$j,$e.y=$O,$e.width=$V,$e.height=$l,$aj.worldScissorTest=!0,$O=$aj.height-$O-$l,$Aj.mainContext.scissor($j,$O,$V,$l),$Aj.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$t?($O=$aj.height-this.screenRect.y-this.screenRect.height,$Aj.mainContext.scissor(this.screenRect.x,$O,this.screenRect.width,this.screenRect.height),$Aj.mainContext.enable(3089)):($Aj.mainContext.disable(3089),$aj.worldScissorTest=!1),$e.copyFrom(this.screenRect),!0},$j._scissorWithTagart=function($j,$O,$V,$l){if($V<1||$l<1)return!1;var $T=$j+$V,$S=$O+$l;$j<0&&($V=$T-($j=0)),$O<0&&($l=$S-($O=0));var $m=$aj.worldClipRect;if($j=Math.max($j,$m.x),$O=Math.max($O,$m.y),$V=Math.min($T,$m.right)-$j,$l=Math.min($S,$m.bottom)-$O,$V<1||$l<1)return!1;var $p=$aj.worldScissorTest;return this.screenRect.copyFrom($m),$aj.worldScissorTest=!0,$m.x=$j,$m.y=$O,$m.width=$V,$m.height=$l,$O=$aj.height-$O-$l,$Aj.mainContext.scissor($j,$O,$V,$l),$Aj.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$p?($O=$aj.height-this.screenRect.y-this.screenRect.height,$Aj.mainContext.scissor(this.screenRect.x,$O,this.screenRect.width,this.screenRect.height),$Aj.mainContext.enable(3089)):($Aj.mainContext.disable(3089),$aj.worldScissorTest=!1),$m.copyFrom(this.screenRect),!0},$j.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$j.getRenderType=function(){return 0},$j.releaseRender=function(){var $j=$V._cache;($j[$j._length++]=this).context=null},$V.create=function($j){var $O=$V._cache._length?$V._cache[--$V._cache._length]:new $V;return $O.context=$j,$O},$V._cache=(($V._cache=[])._length=0,$V._cache),$V}(),$gj=function(){function $o(){this.step=0,this.blendMode=null,this.level=0}$t($o,"laya.webgl.submit.SubmitStencil");var $j=$o.prototype;return $x.imps($j,{"laya.webgl.submit.ISubmit":!0}),$j.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$j.getRenderType=function(){return 0},$j.releaseRender=function(){var $j=$o._cache;$j[$j._length++]=this},$j.do1=function(){var $j=$Aj.mainContext;$j.enable(2960),$j.clear(1024),$j.colorMask(!1,!1,!1,!1),$j.stencilFunc(514,this.level,255),$j.stencilOp(7680,7680,7682)},$j.do2=function(){var $j=$Aj.mainContext;$j.stencilFunc(514,this.level+1,255),$j.colorMask(!0,!0,!0,!0),$j.stencilOp(7680,7680,7680)},$j.do3=function(){var $j=$Aj.mainContext;$j.colorMask(!0,!0,!0,!0),$j.stencilOp(7680,7680,7680),$j.clear(1024),$j.disable(2960)},$j.do4=function(){var $j=$Aj.mainContext;0==this.level&&($j.enable(2960),$j.clear(1024)),$j.colorMask(!1,!1,!1,!1),$j.stencilFunc(519,0,255),$j.stencilOp(7680,7680,7682)},$j.do5=function(){var $j=$Aj.mainContext;$j.stencilFunc(514,this.level,255),$j.colorMask(!0,!0,!0,!0),$j.stencilOp(7680,7680,7680)},$j.do6=function(){var $j=$Aj.mainContext;$C.targetFns[$C.TOINT[this.blendMode]]($j)},$j.do7=function(){var $j=$Aj.mainContext;$j.colorMask(!1,!1,!1,!1),$j.stencilOp(7680,7680,7683)},$j.do8=function(){var $j=$Aj.mainContext;$j.colorMask(!0,!0,!0,!0),$j.stencilFunc(514,this.level,255),$j.stencilOp(7680,7680,7680)},$o.restore=function($j,$O,$V,$l,$T){var $S;if(($j._renderKey=0)<$o._mask&&$o._mask--,0==$o._mask)$S=laya.webgl.submit.SubmitStencil.create(3),$j.addRenderObject($S),$j._curSubmit=$Sj.RENDERBASE;else{$S=laya.webgl.submit.SubmitStencil.create(7),$j.addRenderObject($S);var $m=$j._vb;$m._byteLength;if($rj.fillRectImgVb($m,null,$O.x,$O.y,$O.width,$O.height,$i.DEF_UV,$V,$l,$T,0,0)){$j._shader2D.glTexture=null;var $p=$j._curSubmit=$Sj.createSubmit($j,$j._ib,$m,($m._byteLength-64)/32*3,$Uj.create(2,0));$p.shaderValue.ALPHA=1,$j._submits[$j._submits._length++]=$p,$j._curSubmit._numEle+=6,$j._curSubmit=$Sj.RENDERBASE}else alert("clipRect calc stencil rect error");$S=laya.webgl.submit.SubmitStencil.create(8),$j.addRenderObject($S)}},$o.restore2=function($j,$O){var $V;($j._renderKey=0)<$o._mask&&$o._mask--,0==$o._mask?($V=laya.webgl.submit.SubmitStencil.create(3),$j.addRenderObject($V),$j._curSubmit=$Sj.RENDERBASE):($V=laya.webgl.submit.SubmitStencil.create(7),$j.addRenderObject($V),$j._submits[$j._submits._length++]=$O,$V=laya.webgl.submit.SubmitStencil.create(8),$j.addRenderObject($V))},$o.create=function($j){var $O=$o._cache._length?$o._cache[--$o._cache._length]:new $o;return 5==($O.step=$j)&&++$o._mask,$O.level=$o._mask,$O},$o._cache=(($o._cache=[])._length=0,$o._cache),$o._mask=0,$o}(),$ej=function(){function $p(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$t($p,"laya.webgl.submit.SubmitTarget");var $j=$p.prototype;return $x.imps($j,{"laya.webgl.submit.ISubmit":!0}),$j.renderSubmit=function(){this._vb.bind_upload(this._ib);var $j=this.scope.getValue(this.proName);return $j&&(this.shaderValue.texture=$j.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$j.width,$j.height]),this.shaderValue.upload(),this.blend(),$v.drawCall++,$v.trianglesFaces+=this._numEle/3,$Aj.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$j.blend=function(){if($C.activeBlendFunction!==$C.fns[this.blendType]){var $j=$Aj.mainContext;$j.enable(3042),$C.fns[this.blendType]($j),$C.activeBlendFunction=$C.fns[this.blendType]}},$j.getRenderType=function(){return 0},$j.releaseRender=function(){var $j=$p._cache;($j[$j._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$p.create=function($j,$O,$V,$l,$T,$S){var $m=$p._cache._length?$p._cache[--$p._cache._length]:new $p;return $m._ib=$O,$m._vb=$V,$m.proName=$S,$m._startIdx=$l*$bj.BYTES_PIDX,$m._numEle=0,$m.blendType=$j._nBlendType,$m.shaderValue=$T,$m.shaderValue.setValue($j._shader2D),$m},$p._cache=(($p._cache=[])._length=0,$p._cache),$p}(),$tj=function(){function $j(){this._sourceStr=null}$t($j,"laya.webgl.text.CharSegment");var $O=$j.prototype;return $x.imps($O,{"laya.webgl.text.ICharSegment":!0}),$O.textToSpit=function($j){this._sourceStr=$j},$O.getChar=function($j){return this._sourceStr.charAt($j)},$O.getCharCode=function($j){return this._sourceStr.charCodeAt($j)},$O.length=function(){return this._sourceStr.length},$j}(),$wj=function(){var $j;function $v(){}return $t($v,"laya.webgl.text.DrawText"),$v.__init__=function(){$v._charsTemp=new Array,$v._drawValue=new $j,$v._charSeg=new $tj},$v.customCharSeg=function($j){$v._charSeg=$j},$v.getChar=function($j,$O,$V){var $l=$yj.createOneChar($j,$V);return-1!=$O&&($v._charsCache[$O]=$l),$l},$v._drawSlow=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e,$t,$w,$s){var $b,$r,$h=$v._drawValue.value($S,$p,$o,$H,$t,$w,$s),$a=0,$c=0,$A=$v._charsTemp,$Z=0,$x=NaN;if($l)for($A.length=$l.length,$a=0,$c=$l.length;$a<$c;$a++)($r=$l[$a])&&($x=$r.charNum+$h.txtID,$A[$a]=$b=$v._charsCache[$x]||$v.getChar($r.char,$x,$h),$b.active());else{var $E=$V instanceof laya.utils.WordText?$V.toString():$V;if($q.CharacterCache){$v._charSeg.textToSpit($E);var $U=$v._charSeg.length();for($a=0,$c=$A.length=$U;$a<$c;$a++)$x=$v._charSeg.getCharCode($a)+$h.txtID,$A[$a]=$b=$v._charsCache[$x]||$v.getChar($v._charSeg.getChar($a),$x,$h),$b.active(),$Z+=$b.cw}else $A.length=0,($b=$v.getChar($E,-1,$h)).active(),$Z+=$b.cw,$A[0]=$b}var $z=0;null!==$m&&"left"!==$m&&($z=-("center"==$m?$Z/2:$Z));var $$,$_,$B=NaN,$M=0;if($l)for($a=0,$c=$A.length;$a<$c;$a++)$b=$A[$a],$r=$l[$a],$b&&$r&&!$b.isSpace&&($B=$b.borderSize,$$=$b.texture,$O._drawText($$,$g+$z+$r.x*$t-$B,$e+$r.y*$w-$B,$$.width,$$.height,$T,0,0,0,0));else{for($a=0,$c=$A.length;$a<$c;$a++)($b=$A[$a])&&!$b.isSpace&&($B=$b.borderSize,$$=$b.texture,$O._drawText($$,$g+$z-$B,$e-$B,$$.width,$$.height,$T,0,0,0,0),$j&&(($_=$j[$M++])||($_=$j[$M-1]=[]),$_[0]=$$,$_[1]=$z-$B,$_[2]=-$B)),$z+=$b.cw;$j&&($j.length=$M)}},$v._drawFast=function($j,$O,$V,$l,$T){for(var $S,$m,$p=0,$o=$j.length;$p<$o;$p++)($S=($m=$j[$p])[0]).active(),$O._drawText($S,$l+$m[1],$T+$m[2],$S.width,$S.height,$V,0,0,0,0)},$v.drawText=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e){if(void 0===$e&&($e=0),!($O&&0===$O.length||$V&&0===$V.length)){var $t=$l.a,$w=$l.d;(0!==$l.b||0!==$l.c)&&($t=$w=1);var $s=1!==$t||1!==$w;if($s&&$x.stage.transform){var $b=$x.stage.transform;$s=$b.a===$t&&$b.d===$w}else $s=!1;if($s){var $r=($l=$l.copyTo($Ej._tmpMatrix)).tx,$h=$l.ty;$l.scale(1/$t,1/$w),$l._checkTransform(),$H*=$t,$g*=$w,$H+=$r-$l.tx,$g+=$h-$l.ty}else $t=$w=1;if($V)$v._drawSlow(null,$j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$t,$w,$e);else{if(null===$O.toUpperCase){var $a=$t+1e5*$w,$c=$O;return void($c.changed||$c.id!==$a?($c.id=$a,$c.changed=!1,$v._drawSlow($c.save,$j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$t,$w,$e)):$v._drawFast($c.save,$j,$l,$H,$g))}var $A=$O+$T.toString()+$m+$p+$o+$t+$w+$S,$Z=$v._textsCache[$A];$q.CharacterCache?$Z?$v._drawFast($Z,$j,$l,$H,$g):($v._textsCache.__length||($v._textsCache.__length=0),$v._textsCache.__length>$E.WebGLTextCacheCount&&(($v._textsCache={}).__length=0,$v._curPoolIndex=0),$v._textCachesPool[$v._curPoolIndex]?($Z=$v._textsCache[$A]=$v._textCachesPool[$v._curPoolIndex]).length=0:$v._textCachesPool[$v._curPoolIndex]=$Z=$v._textsCache[$A]=[],$v._textsCache.__length++,$v._curPoolIndex++,$v._drawSlow($Z,$j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$t,$w,$e)):$v._drawSlow($Z,$j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$t,$w,$e)}}},$v._charsTemp=null,$v._textCachesPool=[],$v._curPoolIndex=0,$v._charsCache={},$v._textsCache={},$v._drawValue=null,$v.d=[],$v._charSeg=null,$v.__init$=function(){$j=function(){function $o(){}return $t($o,""),$o.prototype.value=function($j,$O,$V,$l,$T,$S,$m){this.font=$j,this.fillColor=$O,this.borderColor=$V,this.lineWidth=$l,this.scaleX=$T,this.scaleY=$S,this.underLine=$m;var $p=$j.toString()+$T+$S+$l+($O?$O.toLowerCase():" ")+($V?$V.toLowerCase():" ")+$m;return this.txtID=$o._keymap[$p],this.txtID||(this.txtID=1e-7*++$o._keymapCount,$o._keymap[$p]=this.txtID),this},$o.clear=function(){$o._keymap={},$o._keymapCount=1},$o._keymap={},$o._keymapCount=1,$o}()},$v}(),$sj=function(){function $T($j){this._index=0,this._size=14,this._italic=-2,$T._cache2=$T._cache2||[],this.setFont($j||"14px Arial")}$t($T,"laya.webgl.text.FontInContext");var $j=$T.prototype;return $j.setFont=function($j){var $O=$T._cache2[$j];if($O)this._words=$O[0],this._size=$O[1];else{this._words=$j.split(" ");for(var $V=0,$l=this._words.length;$V<$l;$V++)if(0<this._words[$V].indexOf("px")){this._index=$V;break}this._size=parseInt(this._words[this._index]),$T._cache2[$j]=[this._words,this._size]}this._text=null,this._italic=-2},$j.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$j.hasType=function($j){for(var $O=0,$V=this._words.length;$O<$V;$O++)if(this._words[$O]===$j)return $O;return-1},$j.removeType=function($j){for(var $O=0,$V=this._words.length;$O<$V;$O++)if(this._words[$O]===$j){this._words.splice($O,1),this._index>$O&&this._index--;break}this._text=null,this._italic=-2},$j.copyTo=function($j){return $j._text=this._text,$j._size=this._size,$j._index=this._index,$j._words=this._words.slice(),$j._italic=-2,$j},$j.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$l(0,$j,"size",function(){return this._size},function($j){this._size=$j,this._words[this._index]=$j+"px",this._text=null}),$T.create=function($j){var $O=$T._cache[$j];return $O||($O=$T._cache[$j]=new $T($j))},$T.EMPTY=new $T,$T._cache={},$T._cache2=null,$T}(),$bj=function(){function $j(){}return $t($j,"laya.webgl.utils.CONST3D2D"),$j.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$j.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$j.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$j._TMPARRAY=[],$j._OFFSETX=0,$j._OFFSETY=0,$m($j,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$j}(),$rj=function(){function $s(){}return $t($s,"laya.webgl.utils.GlUtils"),$s.make2DProjection=function($j,$O,$V){return[2/$j,0,0,0,0,-2/$O,0,0,0,0,2/$V,0,-1,1,0,1]},$s.fillIBQuadrangle=function($j,$O){if(65535/4<$O)throw Error("IBQuadrangle count:"+$O+" must<:"+Math.floor(65535/4));$O=Math.floor($O),$j._resizeBuffer(6*($O+1)*2,!1),$j.byteLength=$j.bufferLength;for(var $V=$j.getUint16Array(),$l=0,$T=0;$T<$O;$T++)$V[$l++]=4*$T,$V[$l++]=4*$T+2,$V[$l++]=4*$T+1,$V[$l++]=4*$T,$V[$l++]=4*$T+3,$V[$l++]=4*$T+2;return $j.setNeedUpload(),!0},$s.expandIBQuadrangle=function($j,$O){$j.bufferLength>=6*$O*2||$s.fillIBQuadrangle($j,$O)},$s.mathCeilPowerOfTwo=function($j){return $j--,$j|=$j>>1,$j|=$j>>2,$j|=$j>>4,$j|=$j>>8,$j|=$j>>16,++$j},$s.fillQuadrangleImgVb=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=16+($j._byteLength>>2);$j.byteLength=$o<<2;var $H=$j.getFloat32Array();$H[($o-=16)+2]=$T[0],$H[$o+3]=$T[1],$H[$o+6]=$T[2],$H[$o+7]=$T[3],$H[$o+10]=$T[4],$H[$o+11]=$T[5],$H[$o+14]=$T[6],$H[$o+15]=$T[7];var $g=$S.a,$e=$S.b,$t=$S.c,$w=$S.d;if(1!==$g||0!==$e||0!==$t||1!==$w){$S.bTransform=!0;var $s=$S.tx+$m,$b=$S.ty+$p;$H[$o]=($l[0]+$O)*$g+($l[1]+$V)*$t+$s,$H[$o+1]=($l[0]+$O)*$e+($l[1]+$V)*$w+$b,$H[$o+4]=($l[2]+$O)*$g+($l[3]+$V)*$t+$s,$H[$o+5]=($l[2]+$O)*$e+($l[3]+$V)*$w+$b,$H[$o+8]=($l[4]+$O)*$g+($l[5]+$V)*$t+$s,$H[$o+9]=($l[4]+$O)*$e+($l[5]+$V)*$w+$b,$H[$o+12]=($l[6]+$O)*$g+($l[7]+$V)*$t+$s,$H[$o+13]=($l[6]+$O)*$e+($l[7]+$V)*$w+$b}else $S.bTransform=!1,$O+=$S.tx+$m,$V+=$S.ty+$p,$H[$o]=$O+$l[0],$H[$o+1]=$V+$l[1],$H[$o+4]=$O+$l[2],$H[$o+5]=$V+$l[3],$H[$o+8]=$O+$l[4],$H[$o+9]=$V+$l[5],$H[$o+12]=$O+$l[6],$H[$o+13]=$V+$l[7];return $j._upload=!0},$s.fillTranglesVB=function($j,$O,$V,$l,$T,$S,$m){var $p=($j._byteLength>>2)+$l.length;$j.byteLength=$p<<2;var $o=$j.getFloat32Array();$p-=$l.length;for(var $H=$l.length,$g=$T.a,$e=$T.b,$t=$T.c,$w=$T.d,$s=0;$s<$H;$s+=4)if($o[$p+$s+2]=$l[$s+2],$o[$p+$s+3]=$l[$s+3],1!==$g||0!==$e||0!==$t||1!==$w){$T.bTransform=!0;var $b=$T.tx+$S,$r=$T.ty+$m;$o[$p+$s]=($l[$s]+$O)*$g+($l[$s+1]+$V)*$t+$b,$o[$p+$s+1]=($l[$s]+$O)*$e+($l[$s+1]+$V)*$w+$r}else $T.bTransform=!1,$O+=$T.tx+$S,$V+=$T.ty+$m,$o[$p+$s]=$O+$l[$s],$o[$p+$s+1]=$V+$l[$s+1];return $j._upload=!0},$s.copyPreImgVb=function($j,$O,$V){var $l=$j._byteLength>>2;$j.byteLength=$l+16<<2;for(var $T=$j.getFloat32Array(),$S=0,$m=$l-16;$S<4;$S++)$T[$l]=$T[$m]+$O,++$m,$T[++$l]=$T[$m]+$V,++$m,$T[++$l]=$T[$m],++$m,$T[++$l]=$T[$m],++$l,++$m;$j._upload=!0},$s.fillRectImgVb=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e,$t){void 0===$t&&($t=!1);var $w,$s,$b,$r,$h,$a,$c,$A,$Z,$x,$E,$U,$z,$$,$_,$B,$M=1,$v=$p.a,$Y=$p.b,$R=$p.c,$q=$p.d,$i=$O&&$O.width<99999999;if(1!==$v||0!==$Y||0!==$R||1!==$q?($p.bTransform=!0,0===$Y&&0===$R&&($M=23,$Z=$T+$V,$x=$S+$l,$w=$v*$V+($E=$p.tx+$o),$b=$v*$Z+$E,$s=$q*$l+($U=$p.ty+$H),$r=$q*$x+$U)):($M=23,$p.bTransform=!1,$b=($w=$V+$p.tx+$o)+$T,$r=($s=$l+$p.ty+$H)+$S),$i&&($h=$O.x,$a=$O.y,$c=$O.width+$h,$A=$O.height+$a),1!==$M){if(Math.min($w,$b)>=$c)return!1;if(Math.min($s,$r)>=$A)return!1;if(Math.max($b,$w)<=$h)return!1;if(Math.max($r,$s)<=$a)return!1}var $k=$j._byteLength>>2;$j.byteLength=16+$k<<2;var $n=$j.getFloat32Array();switch($n[2+$k]=$m[0],$n[3+$k]=$m[1],$n[6+$k]=$m[2],$n[7+$k]=$m[3],$n[10+$k]=$m[4],$n[11+$k]=$m[5],$n[14+$k]=$m[6],$n[15+$k]=$m[7],$M){case 1:$E=$p.tx+$o,$U=$p.ty+$H;var $G=$v*$V,$F=$R*$l,$N=$q*$l,$X=$Y*$V,$f=$v*($Z=$T+$V),$C=$R*($x=$S+$l),$J=$q*$x,$u=$Y*$Z;$t?($z=$G+$F+$E,$_=Math.round($z)-$z,$$=$N+$X+$U,$B=Math.round($$)-$$,$n[$k]=$z+$_,$n[1+$k]=$$+$B,$n[4+$k]=$f+$F+$E+$_,$n[5+$k]=$N+$u+$U+$B,$n[8+$k]=$f+$C+$E+$_,$n[9+$k]=$J+$u+$U+$B,$n[12+$k]=$G+$C+$E+$_,$n[13+$k]=$J+$X+$U+$B):($n[$k]=$G+$F+$E,$n[1+$k]=$N+$X+$U,$n[4+$k]=$f+$F+$E,$n[5+$k]=$N+$u+$U,$n[8+$k]=$f+$C+$E,$n[9+$k]=$J+$u+$U,$n[12+$k]=$G+$C+$E,$n[13+$k]=$J+$X+$U);break;case 23:$t?($z=$w+$g,$_=Math.round($z)-$z,$$=$s,$B=Math.round($$)-$$,$n[$k]=$z+$_,$n[1+$k]=$$+$B,$n[4+$k]=$b+$g+$_,$n[5+$k]=$s+$B,$n[8+$k]=$b+$_,$n[9+$k]=$r+$B,$n[12+$k]=$w+$_,$n[13+$k]=$r+$B):($n[$k]=$w+$g,$n[1+$k]=$s,$n[4+$k]=$b+$g,$n[5+$k]=$s,$n[8+$k]=$b,$n[9+$k]=$r,$n[12+$k]=$w,$n[13+$k]=$r)}return $j._upload=!0},$s.fillLineVb=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=.5*$m,$H=$s._fillLineArray,$g=-($l-$S),$e=$V-$T,$t=Math.sqrt($g*$g+$e*$e);$g/=$t,$e/=$t,$g*=$o,$e*=$o,$H[0]=$V-$g,$H[1]=$l-$e,$H[4]=$V+$g,$H[5]=$l+$e,$H[8]=$T+$g,$H[9]=$S+$e,$H[12]=$T-$g,$H[13]=$S-$e,$p&&$p.transformPointArray($H,$H);var $w=16+($j._byteLength>>2);return $j.byteLength=$w<<2,$j.insertData($H,$w-16),!0},$s._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$s}(),$hj=(function(){function $o(){}$t($o,"laya.webgl.utils.MatirxArray"),$o.ArrayMul=function($j,$O,$V){if($j)if($O)for(var $l=NaN,$T=NaN,$S=NaN,$m=NaN,$p=0;$p<4;$p++)$l=$j[$p],$T=$j[$p+4],$S=$j[$p+8],$m=$j[$p+12],$V[$p]=$l*$O[0]+$T*$O[1]+$S*$O[2]+$m*$O[3],$V[$p+4]=$l*$O[4]+$T*$O[5]+$S*$O[6]+$m*$O[7],$V[$p+8]=$l*$O[8]+$T*$O[9]+$S*$O[10]+$m*$O[11],$V[$p+12]=$l*$O[12]+$T*$O[13]+$S*$O[14]+$m*$O[15];else $o.copyArray($j,$V);else $o.copyArray($O,$V)},$o.copyArray=function($j,$O){if($j&&$O)for(var $V=0;$V<$j.length;$V++)$O[$V]=$j[$V]}}(),function(){function $O($j,$O,$V){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$j,this._vb=new $Pj($j,35048),$O&&this._vb._resizeBuffer($O,!1),this._ib=new $Ij,$V&&this._ib._resizeBuffer($V,!1)}$t($O,"laya.webgl.utils.Mesh2D");var $j=$O.prototype;return $j.cloneWithNewVB=function(){var $j=new $O(this._stride,0,0);return $j._ib=this._ib,$j._quadNum=this._quadNum,$j._attribInfo=this._attribInfo,$j},$j.cloneWithNewVBIB=function(){var $j=new $O(this._stride,0,0);return $j._attribInfo=this._attribInfo,$j},$j.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$j.getVBR=function(){return this._vb},$j.getIBR=function(){return this._ib},$j.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$j.createQuadIB=function($j){this._quadNum=$j,this._ib._resizeBuffer(6*$j*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $O=this._ib.getUint16Array(),$V=0,$l=0,$T=0;$T<$j;$T++)$O[$V++]=$l,$O[$V++]=$l+2,$O[$V++]=$l+1,$O[$V++]=$l,$O[$V++]=$l+3,$O[$V++]=$l+2,$l+=4;this._ib.setNeedUpload()},$j.setAttributes=function($j){if(this._attribInfo=$j,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$j.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$j.releaseMesh=function(){},$j.destroy=function(){},$j.clearVB=function(){this._vb.clear()},$O._gvaoid=0,$O}()),$aj=function(){function $T(){}return $t($T,"laya.webgl.utils.RenderState2D"),$T.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$T.mat2MatArray=function($j,$O){var $V=$j,$l=$O;return $l[0]=$V.a,$l[1]=$V.b,$l[2]=$T.EMPTYMAT4_ARRAY[2],$l[3]=$T.EMPTYMAT4_ARRAY[3],$l[4]=$V.c,$l[5]=$V.d,$l[6]=$T.EMPTYMAT4_ARRAY[6],$l[7]=$T.EMPTYMAT4_ARRAY[7],$l[8]=$T.EMPTYMAT4_ARRAY[8],$l[9]=$T.EMPTYMAT4_ARRAY[9],$l[10]=$T.EMPTYMAT4_ARRAY[10],$l[11]=$T.EMPTYMAT4_ARRAY[11],$l[12]=$V.tx,$l[13]=$V.ty,$l[14]=$T.EMPTYMAT4_ARRAY[14],$l[15]=$T.EMPTYMAT4_ARRAY[15],$O},$T.restoreTempArray=function(){$T.TEMPMAT4_ARRAY[0]=1,$T.TEMPMAT4_ARRAY[1]=0,$T.TEMPMAT4_ARRAY[4]=0,$T.TEMPMAT4_ARRAY[5]=1,$T.TEMPMAT4_ARRAY[12]=0,$T.TEMPMAT4_ARRAY[13]=0},$T.clear=function(){$T.worldScissorTest=!1,$T.worldShaderDefines=null,$T.worldFilters=null,$T.worldAlpha=1,$T.worldClipRect.x=$T.worldClipRect.y=0,$T.worldClipRect.width=$T.width,$T.worldClipRect.height=$T.height,$T.curRenderTarget=null},$T._MAXSIZE=99999999,$T.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$T.worldMatrix4=$T.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$T.worldAlpha=1,$T.worldScissorTest=!1,$T.worldFilters=null,$T.worldShaderDefines=null,$T.curRenderTarget=null,$T.width=0,$T.height=0,$m($T,["worldMatrix",function(){return this.worldMatrix=new $z},"worldClipRect",function(){return this.worldClipRect=new $_(0,0,99999999,99999999)}]),$T}(),$cj=function(){var $a,$V;function $c($j,$O,$V,$l,$T){var $S=this;function $m($j){var $O=[],$V=new $a($O);return $S._compileToTree($V,$j.split("\n"),0,$O,$T),$V}var $p=$w.now();this._VS=$m($O),this._PS=$m($V),this._nameMap=$l,2<$w.now()-$p&&console.log("ShaderCompile use time:"+($w.now()-$p)+"  size:"+$O.length+"/"+$V.length)}$t($c,"laya.webgl.utils.ShaderCompile");var $j=$c.prototype;return $j._compileToTree=function($j,$O,$V,$l,$T){var $S,$m,$p,$o,$H,$g,$e,$t=0,$w=0,$s=0,$b=0;for($w=$V;$w<$O.length;$w++)if(!(($p=$O[$w]).length<1)&&0!==($t=$p.indexOf("//"))){if(0<=$t&&($p=$p.substr(0,$t)),$S=$e||new $a($l),$e=null,$S.text=$p,$S.noCompile=!0,0<=($t=$p.indexOf("#"))){for($o="#",$b=$t+1,$s=$p.length;$b<$s;$b++){var $r=$p.charAt($b);if(" "===$r||"\t"===$r||"\r"===$r||"\n"===$r||"?"===$r)break;$o+=$r}switch($S.name=$o){case"#ifdef":case"#ifndef":if($S.src=$p,$S.noCompile=null!=$p.match(/[!&|()=<>]/),$S.noCompile?console.log("function():Boolean{return "+$p.substr($t+$S.name.length)+"}"):($g=$p.replace(/^\s*/,"").split(/\s+/),$S.setCondition($g[1],"#ifdef"===$o?1:2),$S.text="//"+$S.text),$S.setParent($j),$j=$S,$T)for($g=$p.substr($b).split($c._splitToWordExps3),$b=0;$b<$g.length;$b++)($p=$g[$b]).length&&($T[$p]=!0);continue;case"#if":if($S.src=$p,$S.noCompile=!0,$S.setParent($j),$j=$S,$T)for($g=$p.substr($b).split($c._splitToWordExps3),$b=0;$b<$g.length;$b++)($p=$g[$b]).length&&"defined"!=$p&&($T[$p]=!0);continue;case"#else":$S.src=$p,$m=($j=$j.parent).childs[$j.childs.length-1],$S.noCompile=$m.noCompile,$S.noCompile||($S.condition=$m.condition,$S.conditionType=1==$m.conditionType?2:1,$S.text="//"+$S.text+" "+$m.text+" "+$S.conditionType),$S.setParent($j),$j=$S;continue;case"#endif":$m=($j=$j.parent).childs[$j.childs.length-1],$S.noCompile=$m.noCompile,$S.noCompile||($S.text="//"+$S.text),$S.setParent($j);continue;case"#include":$g=$c.splitToWords($p,null);var $h=$c.includes[$g[1]];if(!$h)throw"ShaderCompile error no this include file:"+$g[1];if(($t=$g[0].indexOf("?"))<0){$S.setParent($j),$p=$h.getWith("with"==$g[2]?$g[3]:null),this._compileToTree($S,$p.split("\n"),0,$l,$T),$S.text="";continue}$S.setCondition($g[0].substr($t+1),1),$S.text=$h.getWith("with"==$g[2]?$g[3]:null);break;case"#import":$H=($g=$c.splitToWords($p,null))[1],$l.push({node:$S,file:$c.includes[$H],ofs:$S.text.length});continue}}else{if(($m=$j.childs[$j.childs.length-1])&&!$m.name){0<$l.length&&$c.splitToWords($p,$m),$e=$S,$m.text+="\n"+$p;continue}0<$l.length&&$c.splitToWords($p,$S)}$S.setParent($j)}},$j.createShader=function($j,$O,$V){var $l={},$T="";if($j)for(var $S in $j)$T+="#define "+$S+"\n",$l[$S]=!0;var $m=this._VS.toscript($l,[]),$p=this._PS.toscript($l,[]);return($V||$dj.create)($T+$m.join("\n"),$T+$p.join("\n"),$O,this._nameMap)},$c._parseOne=function($j,$O,$V,$l,$T,$S){var $m={type:$c.shaderParamsMap[$V[$l+1]],name:$V[$l+2],size:isNaN(parseInt($V[$l+3]))?1:parseInt($V[$l+3])};return $S&&("attribute"==$T?$j.push($m):$O.push($m)),":"==$V[$l+3]&&($m.type=$V[$l+4],$l+=2),$l+=2},$c.addInclude=function($j,$O){if(!$O||0===$O.length)throw new Error("add shader include file err:"+$j);if($c.includes[$j])throw new Error("add shader include file err, has add:"+$j);$c.includes[$j]=new $V($O)},$c.preGetParams=function($j,$O){var $V=[$j,$O],$l={},$T=[],$S=[],$m={},$p=[];$l.attributes=$T,$l.uniforms=$S,$l.defines=$m;for(var $o=0,$H=0,$g=0;$g<2;$g++){$V[$g]=$V[$g].replace($c._removeAnnotation,"");var $e,$t=$V[$g].match($c._reg);for($o=0,$H=$t.length;$o<$H;$o++){var $w=$t[$o];if("attribute"==$w||"uniform"==$w)$o=$c._parseOne($T,$S,$t,$o,$w,!0);else{if("#define"==$w){$p[$w=$t[++$o]]=1;continue}if("#ifdef"==$w){$m[$e=$t[++$o]]=$m[$e]||[];for($o++;$o<$H;$o++)if("attribute"==($w=$t[$o])||"uniform"==$w)$o=$c._parseOne($T,$S,$t,$o,$w,$p[$e]);else if("#else"==$w)for($o++;$o<$H;$o++)if("attribute"==($w=$t[$o])||"uniform"==$w)$o=$c._parseOne($T,$S,$t,$o,$w,!$p[$e]);else if("#endif"==$w)break}}}}return $l},$c.splitToWords=function($j,$O){for(var $V,$l,$T=[],$S=-1,$m=0,$p=$j.length;$m<$p;$m++)if($V=$j.charAt($m),0<=" \t=+-*/&%!<>()'\",;".indexOf($V)){if(0<=$S&&1<$m-$S&&($l=$j.substr($S,$m-$S),$T.push($l)),'"'==$V||"'"==$V){var $o=$j.indexOf($V,$m+1);if($o<0)throw"Sharder err:"+$j;$T.push($j.substr($m+1,$o-$m-1)),$m=$o,$S=-1;continue}"("==$V&&$O&&0<$T.length&&($l=$T[$T.length-1]+";","vec4;main;".indexOf($l)<0&&($O.useFuns+=$l)),$S=-1}else $S<0&&($S=$m);return $S<$p&&1<$p-$S&&($l=$j.substr($S,$p-$S),$T.push($l)),$T},$c.IFDEF_NO=0,$c.IFDEF_YES=1,$c.IFDEF_ELSE=2,$c.IFDEF_PARENT=3,$c._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$c._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$c._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$c.includes={},$m($c,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$c.__init$=function(){$a=function(){function $V($j){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$j}$t($V,"");var $j=$V.prototype;return $j.setParent=function($j){$j.childs.push(this),this.z=$j.z+1,this.parent=$j},$j.setCondition=function($j,$O){$j&&(this.conditionType=$O,$j=$j.replace(/(\s*$)/g,""),this.condition=function(){return this[$j]},this.condition.__condition=$j)},$j.toscript=function($j,$O){return this._toscript($j,$O,++$V.__id)},$j._toscript=function($l,$T,$S){if(this.childs.length<1&&!this.text)return $T;$T.length;if(this.condition){var $j=!!this.condition.call($l);if(2===this.conditionType&&($j=!$j),!$j)return $T}if(this.text&&$T.push(this.text),0<this.childs.length&&this.childs.forEach(function($j,$O,$V){$j._toscript($l,$T,$S)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $O,$V=0,$m=this.includefiles.length;$V<$m;$V++)this.includefiles[$V].curUseID!=$S&&0<($O=this.includefiles[$V].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$V].curUseID=$S,$T[0]=$O+$T[0]);return $T},$V.__id=1,$V}(),$V=function(){function $j($j){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$j;for(var $O=0,$V=0,$l=0;!(($O=$j.indexOf("#begin",$O))<0);){for($l=$O+5;!(($l=$j.indexOf("#end",$l))<0)&&"i"===$j.charAt($l+4);)$l+=5;if($l<0)throw"add include err,no #end:"+$j;$V=$j.indexOf("\n",$O);var $T=$c.splitToWords($j.substr($O,$V-$O),null);"code"==$T[1]?this.codes[$T[2]]=$j.substr($V+1,$l-$V-1):"function"==$T[1]&&($V=$j.indexOf("function",$O),$V+="function".length,this.funs[$T[3]]=$j.substr($V+1,$l-$V-1),this.funnames+=$T[3]+";"),$O=$l+1}}$t($j,"");var $O=$j.prototype;return $O.getWith=function($j){var $O=$j?this.codes[$j]:this.script;if(!$O)throw"get with error:"+$j;return $O},$O.getFunsScript=function($j){var $O="";for(var $V in this.funs)0<=$j.indexOf($V+";")&&($O+=this.funs[$V]);return $O},$j}()},$c}(),$Aj=function(){function $m(){}return $t($m,"laya.webgl.WebGL"),$m._uint8ArraySlice=function(){for(var $j=this.length,$O=new Uint8Array(this.length),$V=0;$V<$j;$V++)$O[$V]=this[$V];return $O},$m._float32ArraySlice=function(){for(var $j=this.length,$O=new Float32Array(this.length),$V=0;$V<$j;$V++)$O[$V]=this[$V];return $O},$m._uint16ArraySlice=function($j){var $O,$V=arguments,$l=0,$T=0;if(0===$V.length)for($l=this.length,$O=new Uint16Array($l),$T=0;$T<$l;$T++)$O[$T]=this[$T];else if(2===$V.length){var $S=$V[0],$m=$V[1];if($S<$m)for($l=$m-$S,$O=new Uint16Array($l),$T=$S;$T<$m;$T++)$O[$T-$S]=this[$T];else $O=new Uint16Array(0)}return $O},$m.expandContext=function(){var $j=$T.prototype,$O=CanvasRenderingContext2D.prototype;$O.fillTrangles=$j.fillTrangles,$Lj.__int__(null),$O.setIBVB=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){void 0===$o&&($o=0),void 0===$H&&($H=0),null===$V&&(this._ib=this._ib||$Ij.QuadrangleIB,$V=this._ib,$rj.expandIBQuadrangle($V,$l._byteLength/64+8)),this._setIBVB($j,$O,$V,$l,$T,$S,$m,$p,$o,$H)},$O.fillTrangles=function($j,$O,$V,$l,$T){this._curMat=this._curMat||$z.create(),this._vb=this._vb||$Pj.create(),this._ib||(this._ib=$Ij.create(),$rj.fillIBQuadrangle(this._ib,$m/4));var $S=this._vb,$m=$l.length>>4;$rj.fillTranglesVB($S,$O,$V,$l,$T||this._curMat,0,0),$rj.expandIBQuadrangle(this._ib,$S._byteLength/64+8);var $p=new $Uj(1,0);$p.textureHost=$j;var $o=new $Dj("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$S._vertType=3,this._setIBVB($O,$V,this._ib,$S,6*$m,$T,$o,$p,0,0)}},$m.enable=function(){if($w.__init__(),$h.isConchApp&&!$h.isConchWebGL)return $Z.skinAniSprite=function(){return new $jj},$m.expandContext(),!1;if($Z.getWebGLContext=function($j){for(var $O,$V=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$l=0;$l<$V.length;$l++){try{$O=$j.getContext($V[$l],{stencil:$E.isStencil,alpha:$E.isAlpha,antialias:$E.isAntialias,premultipliedAlpha:$E.premultipliedAlpha,preserveDrawingBuffer:$E.preserveDrawingBuffer})}catch($j){}if($O)return $O}return null},null==($m.mainContext=$m.mainContext||$Z.getWebGLContext($h._mainCanvas)))return!1;if($h.isWebGL)return!0;$b.create=function($j,$O){return new $jO($j,$O)},$r.create=function($j,$O,$V,$l,$T,$S,$m){return new $Kj($j,$O,$V,$l,$T,$S,$m)},$h.WebGL=$m,$h.isWebGL=!0,$wj.__init__(),$Z.createRenderSprite=function($j,$O){return new $zj($j,$O)},$Z.createWebGLContext2D=function($j){return new $Ej($j)},$Z.changeWebGLSize=function($j,$O){laya.webgl.WebGL.onStageResize($j,$O)},$Z.createGraphics=function(){return new $xj};var $j=$Z.createFilterAction;return $Z.createFilterAction=$j||function($j){return new $$j},$Z.clear=function($j){$aj.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $O=$h.context.ctx,$V=0==$O._submits._length||$E.preserveDrawingBuffer?$s.create($j)._color:$M._wgColor;$V&&$O.clearBG($V[0],$V[1],$V[2],$V[3]),$aj.clear()},$Z.addToAtlas=function($j,$O){void 0===$O&&($O=!1);var $V=$j.bitmap;$h.optimizeTextureMemory($j.url,$j)?$x.__typeof($V,"laya.webgl.resource.IMergeAtlasBitmap")&&$V.allowMerageInAtlas&&$V.on("recovered",$j,$j.addTextureToAtlas):$V.enableMerageInAtlas=!1},$Z.isAtlas=function($j){return $j instanceof laya.webgl.atlas.AtlasWebGLCanvas},$X._enable(),$Z.beginFlush=function(){for(var $j=$X.instance,$O=$j.getAtlaserCount(),$V=0;$V<$O;$V++){var $l=$j.getAtlaserByIndex($V).texture;$l._flashCacheImageNeedFlush&&$Z.flashFlushImage($l)}},$Z.drawToCanvas=function($j,$O,$V,$l,$T,$S){($V<=0||$l<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$V|=0,$l|=0,$T|=0,$S|=0;var $m=$nj.create($V,$l,6408,5121,0,!1);$m.start(),$m.clear(0,0,0,0),$h.context.clear(),$a.renders[$O]._fun($j,$h.context,$T,$aj.height-$l+$S),$h.context.flush(),$m.end();var $p=$m.getData(0,0,$V,$l);if($m.recycle(),$p.byteLength==$V*$l*4){var $o=new $uj;$o._canvas=$w.createElement("canvas"),$o.size($V,$l);var $H=$o._canvas.getContext("2d");$w.canvas.size($V,$l);var $g=$w.context,$e=$g.createImageData($V,$l);return $e.data.set(new Uint8ClampedArray($p.buffer)),$o._imgData=$e,$g.putImageData($e,0,0),$H.save(),$H.translate(0,$l),$H.scale(1,-1),$H.drawImage($w.canvas.source,0,0),$H.restore(),$o}console.log("drawToCanvas error: w:"+$V+",h:"+$l+",datalen:"+$p.byteLength)},$Z.createFilterAction=function($j){var $O;switch($j){case 32:$O=new $$j}return $O},$Z.addTextureToAtlas=function($j){$j._uvID++,$X._atlasRestore++,$j.bitmap.enableMerageInAtlas&&$X.instance.addToAtlas($j)},$Z.getTexturePixels=function($j,$O,$V,$l,$T){$h.context.ctx.clear();var $S=new $B;$S.graphics.drawTexture($j,-$O,-$V);var $m=$nj.create($l,$T);$m.start(),$m.clear(0,0,0,0),$S.render($h.context,0,0),$h.context.ctx.flush(),$m.end();for(var $p=$m.getData(0,0,$l,$T),$o=[],$H=0,$g=$T-1;0<=$g;$g--)for(var $e=0;$e<$l;$e++)$H=4*($g*$l+$e),$o.push($p[$H]),$o.push($p[$H+1]),$o.push($p[$H+2]),$o.push($p[$H+3]);return $o},$Z.skinAniSprite=function(){return new $jj},$H.create=function($j,$O){var $V=new $uj;return $V._imgData=$O,$V.flipY=!1,$V},$U._filterStart=function($j,$O,$V,$l,$T){var $S=$j.getValue("bounds"),$m=$nj.create($S.width,$S.height);if($m.start(),$m.clear(0,0,0,0),$j.addValue("src",$m),$j.addValue("ScissorTest",$aj.worldScissorTest),$aj.worldScissorTest){var $p=new $_;$p.copyFrom($V.ctx._clipRect),$j.addValue("clipRect",$p),$aj.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$U._filterEnd=function($j,$O,$V,$l,$T){var $S=$j.getValue("bounds");$j.getValue("src").end();var $m=$nj.create($S.width,$S.height);$m.start(),$m.clear(0,0,0,0),$j.addValue("out",$m),$O._set$P("_filterCache",$m),$O._set$P("_isHaveGlowFilter",$j.getValue("_isHaveGlowFilter"))},$U._EndTarget=function($j,$O){if($j.getValue("src").recycle(),$j.getValue("out").end(),$j.getValue("ScissorTest")){$aj.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$O.ctx.save();var $V=$j.getValue("clipRect");$O.ctx.clipRect($V.x,$V.y,$V.width,$V.height)}},$U._useSrc=function($j){var $O=$j.getValue("out");$O.end(),($O=$j.getValue("src")).start(),$O.clear(0,0,0,0)},$U._endSrc=function($j){$j.getValue("src").end()},$U._useOut=function($j){var $O=$j.getValue("src");$O.end(),($O=$j.getValue("out")).start(),$O.clear(0,0,0,0)},$U._endOut=function($j){$j.getValue("out").end()},$U._recycleScope=function($j){$j.recycle()},$U._filter=function($j,$O,$V,$l){var $T=this._next;if($T){var $S,$m,$p=$j.filters,$o=$p.length;if(1==$o&&32==$p[0].type)return $O.ctx.save(),$O.ctx.setFilters([$p[0]]),$T._fun.call($T,$j,$O,$V,$l),void $O.ctx.restore();var $H=$pj.create(),$g=$$.TEMP,$e=$O.ctx._getTransformMatrix(),$t=$z.create();$e.copyTo($t);var $w=0,$s=0,$b=!1,$r=$j._$P._filterCache?$j._$P._filterCache:null;if(!$r||$j._repaint){$b=$j._isHaveGlowFilter(),$H.addValue("_isHaveGlowFilter",$b),$b&&($w=50,$s=25),($m=new $_).copyFrom($j.getSelfBounds()),$m.x+=$j.x,$m.y+=$j.y,$m.x-=$j.pivotX+4,$m.y-=$j.pivotY+4;var $h=$m.x,$a=$m.y;if($m.width+=$w+8,$m.height+=$w+8,$g.x=$m.x*$t.a+$m.y*$t.c,$g.y=$m.y*$t.d+$m.x*$t.b,$m.x=$g.x,$m.y=$g.y,$g.x=$m.width*$t.a+$m.height*$t.c,$g.y=$m.height*$t.d+$m.width*$t.b,$m.width=$g.x,$m.height=$g.y,$m.width<=0||$m.height<=0)return;$r&&$r.recycle(),$H.addValue("bounds",$m);var $c=$mj.create([$H,$j,$O,0,0],$U._filterStart);$O.addRenderObject($c),$O.ctx._renderKey=0,$O.ctx._shader2D.glTexture=null;var $A=$j.x-$h+$s,$Z=$j.y-$a+$s;$T._fun.call($T,$j,$O,$A,$Z),$c=$mj.create([$H,$j,$O,0,0],$U._filterEnd),$O.addRenderObject($c);for(var $x=0;$x<$o;$x++){0!=$x&&($c=$mj.create([$H],$U._useSrc),$O.addRenderObject($c),$S=$Uj.create(1,0),$z.TEMP.identity(),$O.ctx.drawTarget($H,0,0,$m.width,$m.height,$z.TEMP,"out",$S,null,$C.TOINT.overlay),$c=$mj.create([$H],$U._useOut),$O.addRenderObject($c)),$p[$x].action.apply3d($H,$j,$O,0,0)}$c=$mj.create([$H,$O],$U._EndTarget),$O.addRenderObject($c)}else{if(($b=!!$j._$P._isHaveGlowFilter&&$j._$P._isHaveGlowFilter)&&($w=50,$s=25),($m=$j.getBounds()).width<=0||$m.height<=0)return;$m.width+=$w,$m.height+=$w,$g.x=$m.x*$t.a+$m.y*$t.c,$g.y=$m.y*$t.d+$m.x*$t.b,$m.x=$g.x,$m.y=$g.y,$g.x=$m.width*$t.a+$m.height*$t.c,$g.y=$m.height*$t.d+$m.width*$t.b,$m.width=$g.x,$m.height=$g.y,$H.addValue("out",$r)}$V=$V-$s-$j.x,$l=$l-$s-$j.y,$g.setTo($V,$l),$t.transformPoint($g),$V=$g.x+$m.x,$l=$g.y+$m.y,$S=$Uj.create(1,0),$z.TEMP.identity(),$O.ctx.drawTarget($H,$V,$l,$m.width,$m.height,$z.TEMP,"out",$S,null,$C.TOINT.overlay),$c=$mj.create([$H],$U._recycleScope),$O.addRenderObject($c),$t.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$m._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$m._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$m._uint8ArraySlice),!0},$m.onStageResize=function($j,$O){null!=$m.mainContext&&($m.mainContext.viewport(0,0,$j,$O),$aj.width=$j,$aj.height=$O)},$m.onInvalidGLRes=function(){$X.instance.freeAll(),$A.releaseContentManagers(!0),$m.doNodeRepaint($x.stage),$m.mainContext.viewport(0,0,$aj.width,$aj.height),$x.stage.event("devicelost")},$m.doNodeRepaint=function($j){0==$j.numChildren&&$j.repaint();for(var $O=0;$O<$j.numChildren;$O++)$m.doNodeRepaint($j.getChildAt($O))},$m.init=function($j,$O,$V){$m.mainCanvas=$j,$H._createContext=function($j){return new $Ej($j)},$uj._createContext=function($j){return new $Ej($j)};var $l=laya.webgl.WebGL.mainContext;if(null!=$l.getShaderPrecisionFormat){var $T=$l.getShaderPrecisionFormat(35633,36338),$S=$l.getShaderPrecisionFormat(35632,36338);$m.shaderHighPrecision=!(!$T.precision||!$S.precision)}else $m.shaderHighPrecision=!1;if($m.compressAstc=$l.getExtension("WEBGL_compressed_texture_astc"),$m.compressAtc=$l.getExtension("WEBGL_compressed_texture_atc"),$m.compressEtc=$l.getExtension("WEBGL_compressed_texture_etc"),$m.compressEtc1=$l.getExtension("WEBGL_compressed_texture_etc1"),$m.compressPvrtc=$l.getExtension("WEBGL_compressed_texture_pvrtc"),$m.compressS3tc=$l.getExtension("WEBGL_compressed_texture_s3tc"),$m.compressS3tc_srgb=$l.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$m.compressAstc=$m.compressAstc?$m.compressAstc:{},$m.compressAtc=$m.compressAtc?$m.compressAtc:{},$m.compressEtc=$m.compressEtc?$m.compressEtc:{},$m.compressEtc1=$m.compressEtc1?$m.compressEtc1:{},$m.compressPvrtc=$m.compressPvrtc?$m.compressPvrtc:{},$m.compressS3tc=$m.compressS3tc?$m.compressS3tc:{},$m.compressS3tc_srgb=$m.compressS3tc_srgb?$m.compressS3tc_srgb:{},$l.deleteTexture1=$l.deleteTexture,$l.deleteTexture=function($j){$j==$Zj.curBindTexValue&&($Zj.curBindTexValue=null),$l.deleteTexture1($j)},$m.onStageResize($O,$V),null==$m.mainContext)throw new Error("webGL getContext err!");$R.__init__(),$X.__init__(),$Bj.__init__(),$Sj.__init__(),$Ej.__init__(),$Uj.__init__(),$I.__init__(),$Lj.__int__($l),$C._init_($l),$h.isConchApp&&conch.setOnInvalidGLRes($m.onInvalidGLRes)},$m.mainCanvas=null,$m.antialias=!0,$m.shaderHighPrecision=!1,$m._bg_null=[0,0,0,0],$m}(),$Zj=function(){function $l(){}return $t($l,"laya.webgl.WebGLContext"),$l.UseProgram=function($j){return $l._useProgram!==$j&&($Aj.mainContext.useProgram($j),$l._useProgram=$j,!0)},$l.setDepthTest=function($j,$O){$O!==$l._depthTest&&(($l._depthTest=$O)?$j.enable(2929):$j.disable(2929))},$l.setDepthMask=function($j,$O){$O!==$l._depthMask&&($l._depthMask=$O,$j.depthMask($O))},$l.setDepthFunc=function($j,$O){$O!==$l._depthFunc&&($l._depthFunc=$O,$j.depthFunc($O))},$l.setBlend=function($j,$O){$O!==$l._blend&&(($l._blend=$O)?$j.enable(3042):$j.disable(3042))},$l.setBlendFunc=function($j,$O,$V){($O!==$l._sFactor||$V!==$l._dFactor)&&($l._sFactor=$O,$l._dFactor=$V,$j.blendFunc($O,$V))},$l.setCullFace=function($j,$O){$O!==$l._cullFace&&(($l._cullFace=$O)?$j.enable(2884):$j.disable(2884))},$l.setFrontFace=function($j,$O){$O!==$l._frontFace&&($l._frontFace=$O,$j.frontFace($O))},$l.bindTexture=function($j,$O,$V){$j.bindTexture($O,$V),$l.curBindTexTarget=$O,$l.curBindTexValue=$V},$l.DEPTH_BUFFER_BIT=256,$l.STENCIL_BUFFER_BIT=1024,$l.COLOR_BUFFER_BIT=16384,$l.POINTS=0,$l.LINES=1,$l.LINE_LOOP=2,$l.LINE_STRIP=3,$l.TRIANGLES=4,$l.TRIANGLE_STRIP=5,$l.TRIANGLE_FAN=6,$l.ZERO=0,$l.ONE=1,$l.SRC_COLOR=768,$l.ONE_MINUS_SRC_COLOR=769,$l.SRC_ALPHA=770,$l.ONE_MINUS_SRC_ALPHA=771,$l.DST_ALPHA=772,$l.ONE_MINUS_DST_ALPHA=773,$l.DST_COLOR=774,$l.ONE_MINUS_DST_COLOR=775,$l.SRC_ALPHA_SATURATE=776,$l.FUNC_ADD=32774,$l.BLEND_EQUATION=32777,$l.BLEND_EQUATION_RGB=32777,$l.BLEND_EQUATION_ALPHA=34877,$l.FUNC_SUBTRACT=32778,$l.FUNC_REVERSE_SUBTRACT=32779,$l.BLEND_DST_RGB=32968,$l.BLEND_SRC_RGB=32969,$l.BLEND_DST_ALPHA=32970,$l.BLEND_SRC_ALPHA=32971,$l.CONSTANT_COLOR=32769,$l.ONE_MINUS_CONSTANT_COLOR=32770,$l.CONSTANT_ALPHA=32771,$l.ONE_MINUS_CONSTANT_ALPHA=32772,$l.BLEND_COLOR=32773,$l.ARRAY_BUFFER=34962,$l.ELEMENT_ARRAY_BUFFER=34963,$l.ARRAY_BUFFER_BINDING=34964,$l.ELEMENT_ARRAY_BUFFER_BINDING=34965,$l.STREAM_DRAW=35040,$l.STATIC_DRAW=35044,$l.DYNAMIC_DRAW=35048,$l.BUFFER_SIZE=34660,$l.BUFFER_USAGE=34661,$l.CURRENT_VERTEX_ATTRIB=34342,$l.FRONT=1028,$l.BACK=1029,$l.CULL_FACE=2884,$l.FRONT_AND_BACK=1032,$l.BLEND=3042,$l.DITHER=3024,$l.STENCIL_TEST=2960,$l.DEPTH_TEST=2929,$l.SCISSOR_TEST=3089,$l.POLYGON_OFFSET_FILL=32823,$l.SAMPLE_ALPHA_TO_COVERAGE=32926,$l.SAMPLE_COVERAGE=32928,$l.NO_ERROR=0,$l.INVALID_ENUM=1280,$l.INVALID_VALUE=1281,$l.INVALID_OPERATION=1282,$l.OUT_OF_MEMORY=1285,$l.CW=2304,$l.CCW=2305,$l.LINE_WIDTH=2849,$l.ALIASED_POINT_SIZE_RANGE=33901,$l.ALIASED_LINE_WIDTH_RANGE=33902,$l.CULL_FACE_MODE=2885,$l.FRONT_FACE=2886,$l.DEPTH_RANGE=2928,$l.DEPTH_WRITEMASK=2930,$l.DEPTH_CLEAR_VALUE=2931,$l.DEPTH_FUNC=2932,$l.STENCIL_CLEAR_VALUE=2961,$l.STENCIL_FUNC=2962,$l.STENCIL_FAIL=2964,$l.STENCIL_PASS_DEPTH_FAIL=2965,$l.STENCIL_PASS_DEPTH_PASS=2966,$l.STENCIL_REF=2967,$l.STENCIL_VALUE_MASK=2963,$l.STENCIL_WRITEMASK=2968,$l.STENCIL_BACK_FUNC=34816,$l.STENCIL_BACK_FAIL=34817,$l.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$l.STENCIL_BACK_PASS_DEPTH_PASS=34819,$l.STENCIL_BACK_REF=36003,$l.STENCIL_BACK_VALUE_MASK=36004,$l.STENCIL_BACK_WRITEMASK=36005,$l.VIEWPORT=2978,$l.SCISSOR_BOX=3088,$l.COLOR_CLEAR_VALUE=3106,$l.COLOR_WRITEMASK=3107,$l.UNPACK_ALIGNMENT=3317,$l.PACK_ALIGNMENT=3333,$l.MAX_TEXTURE_SIZE=3379,$l.MAX_VIEWPORT_DIMS=3386,$l.SUBPIXEL_BITS=3408,$l.RED_BITS=3410,$l.GREEN_BITS=3411,$l.BLUE_BITS=3412,$l.ALPHA_BITS=3413,$l.DEPTH_BITS=3414,$l.STENCIL_BITS=3415,$l.POLYGON_OFFSET_UNITS=10752,$l.POLYGON_OFFSET_FACTOR=32824,$l.TEXTURE_BINDING_2D=32873,$l.SAMPLE_BUFFERS=32936,$l.SAMPLES=32937,$l.SAMPLE_COVERAGE_VALUE=32938,$l.SAMPLE_COVERAGE_INVERT=32939,$l.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$l.COMPRESSED_TEXTURE_FORMATS=34467,$l.DONT_CARE=4352,$l.FASTEST=4353,$l.NICEST=4354,$l.GENERATE_MIPMAP_HINT=33170,$l.BYTE=5120,$l.UNSIGNED_BYTE=5121,$l.SHORT=5122,$l.UNSIGNED_SHORT=5123,$l.INT=5124,$l.UNSIGNED_INT=5125,$l.FLOAT=5126,$l.DEPTH_COMPONENT=6402,$l.ALPHA=6406,$l.RGB=6407,$l.RGBA=6408,$l.LUMINANCE=6409,$l.LUMINANCE_ALPHA=6410,$l.UNSIGNED_SHORT_4_4_4_4=32819,$l.UNSIGNED_SHORT_5_5_5_1=32820,$l.UNSIGNED_SHORT_5_6_5=33635,$l.FRAGMENT_SHADER=35632,$l.VERTEX_SHADER=35633,$l.MAX_VERTEX_ATTRIBS=34921,$l.MAX_VERTEX_UNIFORM_VECTORS=36347,$l.MAX_VARYING_VECTORS=36348,$l.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$l.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$l.MAX_TEXTURE_IMAGE_UNITS=34930,$l.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$l.SHADER_TYPE=35663,$l.DELETE_STATUS=35712,$l.LINK_STATUS=35714,$l.VALIDATE_STATUS=35715,$l.ATTACHED_SHADERS=35717,$l.ACTIVE_UNIFORMS=35718,$l.ACTIVE_ATTRIBUTES=35721,$l.SHADING_LANGUAGE_VERSION=35724,$l.CURRENT_PROGRAM=35725,$l.NEVER=512,$l.LESS=513,$l.EQUAL=514,$l.LEQUAL=515,$l.GREATER=516,$l.NOTEQUAL=517,$l.GEQUAL=518,$l.ALWAYS=519,$l.KEEP=7680,$l.REPLACE=7681,$l.INCR=7682,$l.DECR=7683,$l.INVERT=5386,$l.INCR_WRAP=34055,$l.DECR_WRAP=34056,$l.VENDOR=7936,$l.RENDERER=7937,$l.VERSION=7938,$l.NEAREST=9728,$l.LINEAR=9729,$l.NEAREST_MIPMAP_NEAREST=9984,$l.LINEAR_MIPMAP_NEAREST=9985,$l.NEAREST_MIPMAP_LINEAR=9986,$l.LINEAR_MIPMAP_LINEAR=9987,$l.TEXTURE_MAG_FILTER=10240,$l.TEXTURE_MIN_FILTER=10241,$l.TEXTURE_WRAP_S=10242,$l.TEXTURE_WRAP_T=10243,$l.TEXTURE_2D=3553,$l.TEXTURE=5890,$l.TEXTURE_CUBE_MAP=34067,$l.TEXTURE_BINDING_CUBE_MAP=34068,$l.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$l.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$l.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$l.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$l.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$l.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$l.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$l.TEXTURE0=33984,$l.TEXTURE1=33985,$l.TEXTURE2=33986,$l.TEXTURE3=33987,$l.TEXTURE4=33988,$l.TEXTURE5=33989,$l.TEXTURE6=33990,$l.TEXTURE7=33991,$l.TEXTURE8=33992,$l.TEXTURE9=33993,$l.TEXTURE10=33994,$l.TEXTURE11=33995,$l.TEXTURE12=33996,$l.TEXTURE13=33997,$l.TEXTURE14=33998,$l.TEXTURE15=33999,$l.TEXTURE16=34e3,$l.TEXTURE17=34001,$l.TEXTURE18=34002,$l.TEXTURE19=34003,$l.TEXTURE20=34004,$l.TEXTURE21=34005,$l.TEXTURE22=34006,$l.TEXTURE23=34007,$l.TEXTURE24=34008,$l.TEXTURE25=34009,$l.TEXTURE26=34010,$l.TEXTURE27=34011,$l.TEXTURE28=34012,$l.TEXTURE29=34013,$l.TEXTURE30=34014,$l.TEXTURE31=34015,$l.ACTIVE_TEXTURE=34016,$l.REPEAT=10497,$l.CLAMP_TO_EDGE=33071,$l.MIRRORED_REPEAT=33648,$l.FLOAT_VEC2=35664,$l.FLOAT_VEC3=35665,$l.FLOAT_VEC4=35666,$l.INT_VEC2=35667,$l.INT_VEC3=35668,$l.INT_VEC4=35669,$l.BOOL=35670,$l.BOOL_VEC2=35671,$l.BOOL_VEC3=35672,$l.BOOL_VEC4=35673,$l.FLOAT_MAT2=35674,$l.FLOAT_MAT3=35675,$l.FLOAT_MAT4=35676,$l.SAMPLER_2D=35678,$l.SAMPLER_CUBE=35680,$l.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$l.VERTEX_ATTRIB_ARRAY_SIZE=34339,$l.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$l.VERTEX_ATTRIB_ARRAY_TYPE=34341,$l.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$l.VERTEX_ATTRIB_ARRAY_POINTER=34373,$l.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$l.COMPILE_STATUS=35713,$l.LOW_FLOAT=36336,$l.MEDIUM_FLOAT=36337,$l.HIGH_FLOAT=36338,$l.LOW_INT=36339,$l.MEDIUM_INT=36340,$l.HIGH_INT=36341,$l.FRAMEBUFFER=36160,$l.RENDERBUFFER=36161,$l.RGBA4=32854,$l.RGB5_A1=32855,$l.RGB565=36194,$l.DEPTH_COMPONENT16=33189,$l.STENCIL_INDEX=6401,$l.STENCIL_INDEX8=36168,$l.DEPTH_STENCIL=34041,$l.RENDERBUFFER_WIDTH=36162,$l.RENDERBUFFER_HEIGHT=36163,$l.RENDERBUFFER_INTERNAL_FORMAT=36164,$l.RENDERBUFFER_RED_SIZE=36176,$l.RENDERBUFFER_GREEN_SIZE=36177,$l.RENDERBUFFER_BLUE_SIZE=36178,$l.RENDERBUFFER_ALPHA_SIZE=36179,$l.RENDERBUFFER_DEPTH_SIZE=36180,$l.RENDERBUFFER_STENCIL_SIZE=36181,$l.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$l.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$l.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$l.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$l.COLOR_ATTACHMENT0=36064,$l.DEPTH_ATTACHMENT=36096,$l.STENCIL_ATTACHMENT=36128,$l.DEPTH_STENCIL_ATTACHMENT=33306,$l.NONE=0,$l.FRAMEBUFFER_COMPLETE=36053,$l.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$l.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$l.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$l.FRAMEBUFFER_UNSUPPORTED=36061,$l.FRAMEBUFFER_BINDING=36006,$l.RENDERBUFFER_BINDING=36007,$l.MAX_RENDERBUFFER_SIZE=34024,$l.INVALID_FRAMEBUFFER_OPERATION=1286,$l.UNPACK_FLIP_Y_WEBGL=37440,$l.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$l.CONTEXT_LOST_WEBGL=37442,$l.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$l.BROWSER_DEFAULT_WEBGL=37444,$l._useProgram=null,$l._depthTest=!0,$l._depthMask=!0,$l._blend=!1,$l._cullFace=!1,$l.curBindTexTarget=null,$l.curBindTexValue=null,$m($l,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$l}(),$xj=function($j){function $O(){$O.__super.call(this)}$t($O,"laya.webgl.display.GraphicsGL",$p);var $V=$O.prototype;return $V.setShader=function($j){this._saveToCmd($h.context._setShader,[$j])},$V.setIBVB=function($j,$O,$V,$l,$T,$S){this._saveToCmd($h.context._setIBVB,[$j,$O,$V,$l,$T,$S])},$V.drawParticle=function($j,$O,$V){var $l=$Z.createParticleTemplate2D($V);$l.x=$j,$l.y=$O,this._saveToCmd($h.context._drawParticle,[$l])},$O}(),$Ej=function($j){var $V;function $N($j){this._x=0,this._y=0,this._id=++$N._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$N.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$N.MAXCLIPRECT,this.mOutPoint,this._canvas=$j,this._canvas._addReference(),$N._contextcount++,$h.isFlash?(this._ib=$Ij.create(35044),$rj.fillIBQuadrangle(this._ib,16)):this._ib=$Ij.QuadrangleIB,this.clear()}$t($N,"laya.webgl.canvas.WebGLContext2D",$T);var $O=$N.prototype;return $O.setIsMainContext=function(){this._isMain=!0},$O.clearBG=function($j,$O,$V,$l){var $T=$Aj.mainContext;$T.clearColor($j,$O,$V,$l),$T.clear(16384)},$O._getSubmits=function(){return this._submits},$O._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $j=0,$O=this._submits._length;$j<$O;$j++)this._submits[$j].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$O.destroy=function(){--$N._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$Ij.QuadrangleIB&&this._ib.releaseResource()},$O.clear=function(){this._submits||(this._other=$V.DEFAULT,this._curMat=$z.create(),this._vb=$Pj.create(-1),this._submits=[],this._save=[$d.Create(this)],this._save.length=10,this._shader2D=new $I,this._triangleMesh=$ij.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$V.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$N.MAXCLIPRECT,this._curSubmit=$Sj.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$J.DEFAULT;for(var $j=0,$O=this._submits._length;$j<$O;$j++)this._submits[$j].releaseRender(),this._submits[$j]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$O.size=function($j,$O){if(this._width!=$j||this._height!=$O)if(0==$j||0==$O){0!=this._vb._byteLength&&(this._width=$j,this._height=$O,this._vb.clear(),this._vb.upload());for(var $V=0,$l=this._submits._length;$V<$l;$V++)this._submits[$V].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$j,this._height=$O,this._targets&&this._targets.size($j,$O),this._canvas.memorySize-=this._canvas.memorySize;0===$j&&0===$O&&this._releaseMem()},$O._getTransformMatrix=function(){return this._curMat},$O.translate=function($j,$O){0===$j&&0===$O||($Q.save(this),this._curMat.bTransform&&($L.save(this),this._curMat.transformPointN($$.TEMP.setTo($j,$O)),$j=$$.TEMP.x,$O=$$.TEMP.y),this._x+=$j,this._y+=$O)},$O.save=function(){this._save[this._save._length++]=$d.Create(this)},$O.restore=function(){var $j=this._save._length;if(!($j<1))for(var $O=$j-1;0<=$O;$O--){var $V=this._save[$O];if($V.restore(this),$V.isSaveMark())return void(this._save._length=$O)}},$O._fillText=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){void 0===$H&&($H=0);var $g=this._shader2D,$e=this._curSubmit.shaderValue,$t=$T?$sj.create($T):this._other.font;if($X.enabled)$g.ALPHA!==$e.ALPHA&&($g.glTexture=null),$wj.drawText(this,$j,$O,this._curMat,$t,$o||this._other.textAlign,$S,$m,$p,$V,$l,$H);else{this._shader2D.defines.getValue();var $w=$S?$s.create($S)._color:$g.colorAdd;$g.ALPHA===$e.ALPHA&&$w===$g.colorAdd&&$e.colorAdd===$g.colorAdd||($g.glTexture=null,$g.colorAdd=$w),$wj.drawText(this,$j,$O,this._curMat,$t,$o||this._other.textAlign,$S,$m,$p,$V,$l,$H)}},$O.fillWords=function($j,$O,$V,$l,$T,$S){this._fillText(null,$j,$O,$V,$l,$T,null,-1,null,$S)},$O.fillBorderWords=function($j,$O,$V,$l,$T,$S,$m){this._fillBorderText(null,$j,$O,$V,$l,$T,$S,$m,null)},$O.fillText=function($j,$O,$V,$l,$T,$S){this._fillText($j,null,$O,$V,$l,$T,null,-1,$S)},$O.strokeText=function($j,$O,$V,$l,$T,$S,$m){this._fillText($j,null,$O,$V,$l,null,$T,$S||1,$m)},$O.fillBorderText=function($j,$O,$V,$l,$T,$S,$m,$p){this._fillBorderText($j,null,$O,$V,$l,$T,$S,$m,$p)},$O._fillBorderText=function($j,$O,$V,$l,$T,$S,$m,$p,$o){if(!$X.enabled)return this._fillText($j,$O,$V,$l,$T,null,$m,$p||1,$o),void this._fillText($j,$O,$V,$l,$T,$S,null,-1,$o);var $H=this._shader2D,$g=this._curSubmit.shaderValue;$H.ALPHA!==$g.ALPHA&&($H.glTexture=null);var $e=$T?($N._fontTemp.setFont($T),$N._fontTemp):this._other.font;$wj.drawText(this,$j,$O,this._curMat,$e,$o||this._other.textAlign,$S,$m,$p||1,$V,$l,0)},$O.fillRect=function($j,$O,$V,$l,$T){var $S=this._vb;if($rj.fillRectImgVb($S,this._clipRect,$j,$O,$V,$l,$i.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $m=this._shader2D.fillStyle;$T&&(this._shader2D.fillStyle=$J.create($T));var $p=this._shader2D,$o=this._curSubmit.shaderValue;if($p.fillStyle!==$o.fillStyle||$p.ALPHA!==$o.ALPHA){$p.glTexture=null;var $H=this._curSubmit=$Sj.createSubmit(this,this._ib,$S,($S._byteLength-64)/32*3,$Uj.create(2,0));$H.shaderValue.color=$p.fillStyle._color._color,$H.shaderValue.ALPHA=$p.ALPHA,this._submits[this._submits._length++]=$H}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$m}},$O.fillTexture=function($j,$O,$V,$l,$T,$S,$m,$p){if($j.loaded&&$j.bitmap&&$j.source){var $o=this._vb,$H=$j.bitmap.width,$g=$j.bitmap.height,$e=$j.uv,$t=$m.x%$j.width,$w=$m.y%$j.height;if($H!=$p.w||$g!=$p.h){if(!$p.w&&!$p.h)switch($p.oy=$p.ox=0,$S){case"repeat":$p.width=$l,$p.height=$T;break;case"repeat-x":$p.width=$l,$w<0?$j.height+$w>$T?$p.height=$T:$p.height=$j.height+$w:($p.oy=$w,$j.height+$w>$T?$p.height=$T-$w:$p.height=$j.height);break;case"repeat-y":$t<0?$j.width+$t>$l?$p.width=$l:$p.width=$j.width+$t:($p.ox=$t,$j.width+$t>$l?$p.width=$l-$t:$p.width=$j.width),$p.height=$T;break;case"no-repeat":$t<0?$j.width+$t>$l?$p.width=$l:$p.width=$j.width+$t:($p.ox=$t,$j.width+$t>$l?$p.width=$l-$t:$p.width=$j.width),$w<0?$j.height+$w>$T?$p.height=$T:$p.height=$j.height+$w:($p.oy=$w,$j.height+$w>$T?$p.height=$T-$w:$p.height=$j.height);break;default:$p.width=$l,$p.height=$T}$p.w=$H,$p.h=$g,$p.uv=[0,0,$p.width/$H,0,$p.width/$H,$p.height/$g,0,$p.height/$g]}if($O+=$p.ox,$V+=$p.oy,$t-=$p.ox,$w-=$p.oy,$rj.fillRectImgVb($o,this._clipRect,$O,$V,$p.width,$p.height,$p.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $s=$qj.create(this,this._ib,$o,($o._byteLength-64)/32*3,$Uj.create(256,0)),$b=(this._submits[this._submits._length++]=$s).shaderValue;$b.textureHost=$j;var $r=$e[0]*$H,$h=$e[1]*$g,$a=($e[2]-$e[0])*$H,$c=($e[5]-$e[3])*$g,$A=-$t/$H,$Z=-$w/$g;$b.u_TexRange[0]=$r/$H,$b.u_TexRange[1]=$a/$H,$b.u_TexRange[2]=$h/$g,$b.u_TexRange[3]=$c/$g,$b.u_offset[0]=$A,$b.u_offset[1]=$Z,$X.enabled&&!this._isMain&&$s.addTexture($j,($o._byteLength>>2)-16),(this._curSubmit=$s)._renderType=10017,$s._numEle+=6}}else this.sprite&&$x.timer.callLater(this,this._repaintSprite)},$O.setShader=function($j){$y.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$j},$O.setFilters=function($j){$y.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$j,this._curSubmit=$Sj.RENDERBASE,this._renderKey=0,this._drawCount++},$O.drawTexture=function($j,$O,$V,$l,$T,$S,$m){this._drawTextureM($j,$O,$V,$l,$T,$S,$m,null,1)},$O.addTextureVb=function($j,$O,$V){var $l=this._curSubmit._vb||this._vb,$T=$l._byteLength>>2;$l.byteLength=$T+16<<2;for(var $S=$l.getFloat32Array(),$m=0;$m<16;$m+=4)$S[$T++]=$j[$m]+$O,$S[$T++]=$j[$m+1]+$V,$S[$T++]=$j[$m+2],$S[$T++]=$j[$m+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$l._upload=!0},$O.willDrawTexture=function($j,$O){if(!($j.loaded&&$j.bitmap&&$j.source))return this.sprite&&$x.timer.callLater(this,this._repaintSprite),0;var $V=$j.bitmap,$l=$V.id+this._shader2D.ALPHA*$O+10016;if($l==this._renderKey)return $l;var $T=this._shader2D,$S=$T.ALPHA,$m=this._curSubmit.shaderValue;$T.ALPHA*=$O,this._renderKey=$l,this._drawCount++,$T.glTexture=$V;var $p=this._vb,$o=null,$H=$p._byteLength/32*3,$g=$m.textureHost&&$m.textureHost==$j&&$m.textureHost.alphaTexture==$j.alphaTexture;return $o=$qj.create(this,this._ib,$p,$H,$Uj.create(1,0)),(this._submits[this._submits._length++]=$o).shaderValue.textureHost=$j,$o._renderType=10016,$o._preIsSameTextureShader=10016===this._curSubmit._renderType&&$T.ALPHA===$m.ALPHA&&$g,this._curSubmit=$o,$T.ALPHA=$S,$l},$O.drawTextures=function($j,$O,$V,$l){if($j.loaded&&$j.bitmap&&$j.source){var $T=this._clipRect;if(this._clipRect=$N.MAXCLIPRECT,this._drawTextureM($j,$O[0],$O[1],$j.width,$j.height,$V,$l,null,1)){if(this._clipRect=$T,$v.drawCall++,!($O.length<4)){for(var $S=this._curSubmit._vb||this._vb,$m=this._curMat.a,$p=this._curMat.d,$o=2,$H=$O.length;$o<$H;$o+=2)$rj.copyPreImgVb($S,($O[$o]-$O[$o-2])*$m,($O[$o+1]-$O[$o-1])*$p),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$x.timer.callLater(this,this._repaintSprite)},$O._drawTextureM=function($j,$O,$V,$l,$T,$S,$m,$p,$o){if(!$j.loaded||!$j.source)return this.sprite&&$x.timer.callLater(this,this._repaintSprite),!1;var $H=this._curSubmit._vb||this._vb,$g=$j.bitmap;$O+=$S,$V+=$m,this._drawCount++;var $e=$g.id+this._shader2D.ALPHA*$o+10016;if($e!=this._renderKey){this._renderKey=$e;var $t=this._curSubmit.shaderValue,$w=this._shader2D,$s=$w.ALPHA;$w.ALPHA*=$o,$w.glTexture=$g;var $b=this._vb,$r=null,$h=$b._byteLength/32*3,$a=$t.textureHost&&$t.textureHost==$j&&$t.textureHost.alphaTexture==$j.alphaTexture;$r=$qj.create(this,this._ib,$b,$h,$Uj.create(1,0)),(this._submits[this._submits._length++]=$r).shaderValue.textureHost=$j,$r._renderType=10016,$r._preIsSameTextureShader=10016===this._curSubmit._renderType&&$w.ALPHA===$t.ALPHA&&$a,this._curSubmit=$r,$H=this._curSubmit._vb||this._vb,$w.ALPHA=$s}return!!$rj.fillRectImgVb($H,this._clipRect,$O,$V,$l||$j.width,$T||$j.height,$j.uv,$p||this._curMat,this._x,this._y,0,0)&&($X.enabled&&!this._isMain&&this._curSubmit.addTexture($j,($H._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$O._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$O._drawText=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){var $g=$j.bitmap;this._drawCount++;var $e=$g.id+this._shader2D.ALPHA+10016;if($e!=this._renderKey){this._renderKey=$e;var $t=this._curSubmit.shaderValue,$w=this._shader2D;$w.glTexture=$g;var $s=this._vb,$b=null,$r=$s._byteLength/32*3,$h=$t.textureHost&&$t.textureHost==$j&&$t.textureHost.alphaTexture==$j.alphaTexture;($b=$X.enabled?$qj.create(this,this._ib,$s,$r,$Uj.create(1,0)):$qj.create(this,this._ib,$s,$r,$Qj.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$w.ALPHA===$t.ALPHA&&$h,(this._submits[this._submits._length++]=$b).shaderValue.textureHost=$j,$b._renderType=10016,this._curSubmit=$b}$j.active();var $a=this._curSubmit._vb||this._vb;$rj.fillRectImgVb($a,this._clipRect,$O+$m,$V+$p,$l||$j.width,$T||$j.height,$j.uv,$S||this._curMat,this._x,this._y,$o,$H,!0)&&($X.enabled&&!this._isMain&&this._curSubmit.addTexture($j,($a._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$O.drawTextureWithTransform=function($j,$O,$V,$l,$T,$S,$m,$p,$o){if($S){var $H=this._curMat,$g=this._x,$e=this._y;(0!==$m||0!==$p)&&(this._x=$m*$H.a+$p*$H.c,this._y=$p*$H.d+$m*$H.b),$S&&$H.bTransform?($z.mul($S,$H,$N._tmpMatrix),($S=$N._tmpMatrix)._checkTransform()):(this._x+=$H.tx,this._y+=$H.ty),this._drawTextureM($j,$O,$V,$l,$T,0,0,$S,$o),this._x=$g,this._y=$e}else this._drawTextureM($j,$O,$V,$l,$T,$m,$p,null,$o)},$O.fillQuadrangle=function($j,$O,$V,$l,$T){var $S=this._curSubmit,$m=this._vb,$p=this._shader2D,$o=$S.shaderValue;if(this._renderKey=0,$j.bitmap){var $H=$j.bitmap;$p.glTexture==$H&&$p.ALPHA===$o.ALPHA||($p.glTexture=$H,($S=this._curSubmit=$Sj.createSubmit(this,this._ib,$m,$m._byteLength/32*3,$Uj.create(1,0))).shaderValue.glTexture=$H,this._submits[this._submits._length++]=$S),$rj.fillQuadrangleImgVb($m,$O,$V,$l,$j.uv,$T||this._curMat,this._x,this._y)}else $S.shaderValue.fillStyle&&$S.shaderValue.fillStyle.equal($j)&&$p.ALPHA===$o.ALPHA||($p.glTexture=null,($S=this._curSubmit=$Sj.createSubmit(this,this._ib,$m,$m._byteLength/32*3,$Uj.create(2,0))).shaderValue.defines.add(2),$S.shaderValue.fillStyle=$J.create($j),this._submits[this._submits._length++]=$S),$rj.fillQuadrangleImgVb($m,$O,$V,$l,$i.DEF_UV,$T||this._curMat,this._x,this._y);$S._numEle+=6},$O.drawTexture2=function($j,$O,$V,$l,$T,$S,$m,$p){if(0!=$S){var $o=this._curMat;if(this._x=$j*$o.a+$O*$o.c,this._y=$O*$o.d+$j*$o.b,$T&&($T=$o.bTransform||$T.bTransform?($z.mul($T,$o,$N._tmpMatrix),$N._tmpMatrix):(this._x+=$T.tx+$o.tx,this._y+=$T.ty+$o.ty,$z.EMPTY)),1!==$S||$m){var $H=this._shader2D.ALPHA,$g=this._nBlendType;this._shader2D.ALPHA=$S,$m&&(this._nBlendType=$C.TOINT($m)),this._drawTextureM($p[0],$p[1]-$V,$p[2]-$l,$p[3],$p[4],0,0,$T,1),this._shader2D.ALPHA=$H,this._nBlendType=$g}else this._drawTextureM($p[0],$p[1]-$V,$p[2]-$l,$p[3],$p[4],0,0,$T,1);this._x=this._y=0}},$O.drawCanvas=function($j,$O,$V,$l,$T){var $S=$j.context;if(this._renderKey=0,$S._targets)this._submits[this._submits._length++]=$Rj.create($S,0,null),this._curSubmit=$Sj.RENDERBASE,$S._targets.drawTo(this,$O,$V,$l,$T);else{var $m=this._submits[this._submits._length++]=$Rj.create($S,this._shader2D.ALPHA,this._shader2D.filters),$p=$l/$j.width,$o=$T/$j.height,$H=$m._matrix;this._curMat.copyTo($H),1!=$p&&1!=$o&&$H.scale($p,$o);var $g=$H.tx,$e=$H.ty;$H.tx=$H.ty=0,$H.transformPoint($$.TEMP.setTo($O,$V)),$H.translate($$.TEMP.x+$g,$$.TEMP.y+$e),this._curSubmit=$Sj.RENDERBASE}$E.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$S._targets?"yellow":"green",this.strokeRect($O-1,$V-1,$l+2,$T+2,1),this.strokeRect($O,$V,$l,$T,1),this.restore())},$O.drawTarget=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){void 0===$H&&($H=-1);var $g=this._vb;if($rj.fillRectImgVb($g,this._clipRect,$O,$V,$l,$T,$o||$i.DEF_UV,$S||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $e=this._curSubmit=$ej.create(this,this._ib,$g,($g._byteLength-64)/32*3,$p,$m);$e.blendType=-1==$H?this._nBlendType:$H,$e.scope=$j,this._submits[this._submits._length++]=$e,this._curSubmit._numEle+=6}},$O.mixRGBandAlpha=function($j){return this._mixRGBandAlpha($j,this._shader2D.ALPHA)},$O._mixRGBandAlpha=function($j,$O){var $V=(4278190080&$j)>>>24;return 0!=$V?$V*=$O:$V=255*$O,16777215&$j|$V<<24},$O.drawTriangles=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){if(!$j.loaded||!$j.source)return this.sprite&&$x.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$j.bitmap;var $g=this._mixRGBandAlpha(4294967295,$p),$e=($l.length,$S.length);this._renderKey=-1;var $t=this._curSubmit=$qj.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$Uj.create(1,0));return $t.shaderValue.textureHost=$j,$t._renderType=10016,this._submits[this._submits._length++]=$t,$m?($N._tmpMatrix.a=$m.a,$N._tmpMatrix.b=$m.b,$N._tmpMatrix.c=$m.c,$N._tmpMatrix.d=$m.d,$N._tmpMatrix.tx=$m.tx+$O,$N._tmpMatrix.ty=$m.ty+$V,$z.mul($N._tmpMatrix,this._curMat,$N._tmpMatrix)):($N._tmpMatrix.a=this._curMat.a,$N._tmpMatrix.b=this._curMat.b,$N._tmpMatrix.c=this._curMat.c,$N._tmpMatrix.d=this._curMat.d,$N._tmpMatrix.tx=this._curMat.tx+$O,$N._tmpMatrix.ty=this._curMat.ty+$V),this._triangleMesh.addData($l,$T,$S,$N._tmpMatrix,$g,this),this._curSubmit._numEle+=$e,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$O.transform=function($j,$O,$V,$l,$T,$S){$L.save(this),$z.mul($z.TEMP.setTo($j,$O,$V,$l,$T,$S),this._curMat,this._curMat),this._curMat._checkTransform()},$O.setTransformByMatrix=function($j){$j.copyTo(this._curMat)},$O.transformByMatrix=function($j){$L.save(this),$z.mul($j,this._curMat,this._curMat),this._curMat._checkTransform()},$O.rotate=function($j){$L.save(this),this._curMat.rotateEx($j)},$O.scale=function($j,$O){$L.save(this),this._curMat.scaleEx($j,$O)},$O.clipRect=function($j,$O,$V,$l){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $T=$gj.create(4);this.addRenderObject($T);var $S=this._vb,$m=$S._byteLength>>2;if($rj.fillRectImgVb($S,null,$j,$O,$V,$l,$i.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $p=this._curSubmit=$Sj.createSubmit(this,this._ib,$S,($S._byteLength-64)/32*3,$Uj.create(2,0));$p.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$p,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $o=$gj.create(5);this.addRenderObject($o);var $H=$S.getFloat32Array(),$g=Math.min(Math.min(Math.min($H[0+$m],$H[4+$m]),$H[8+$m]),$H[12+$m]),$e=Math.max(Math.max(Math.max($H[0+$m],$H[4+$m]),$H[8+$m]),$H[12+$m]),$t=Math.min(Math.min(Math.min($H[1+$m],$H[5+$m]),$H[9+$m]),$H[13+$m]),$w=Math.max(Math.max(Math.max($H[1+$m],$H[5+$m]),$H[9+$m]),$H[13+$m]);$K.save(this,$o,$j,$O,$V,$l,$g,$t,$e-$g,$w-$t),this._curSubmit=$Sj.RENDERBASE}else{$V*=this._curMat.a,$l*=this._curMat.d;var $s=$$.TEMP;this._curMat.transformPoint($s.setTo($j,$O)),$V<0&&($s.x=$s.x+$V,$V=-$V),$l<0&&($s.y=$s.y+$l,$l=-$l),this._renderKey=0;var $b=this._curSubmit=$Hj.create(this);(this._submits[this._submits._length++]=$b).submitIndex=this._submits._length,$b.submitLength=9999999,$W.save(this,$b);var $r=this._clipRect,$h=$r.x,$a=$r.y,$c=$s.x+$V,$A=$s.y+$l;$h<$s.x&&($r.x=$s.x),$a<$s.y&&($r.y=$s.y),$r.width=Math.min($c,$h+$r.width)-$r.x,$r.height=Math.min($A,$a+$r.height)-$r.y,this._shader2D.glTexture=null,$b.clipRect.copyFrom($r),this._curSubmit=$Sj.RENDERBASE}},$O.setIBVB=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g){if(void 0===$o&&($o=0),void 0===$H&&($H=0),void 0===$g&&($g=0),null===$V){if($h.isFlash){var $e=$l;$e._selfIB||($e._selfIB=$Ij.create(35044)),$e._selfIB.clear(),$V=$e._selfIB}else $V=this._ib;$rj.expandIBQuadrangle($V,$l._byteLength/(4*$l.vertexStride*4))}if(!$p||!$m)throw Error("setIBVB must input:shader shaderValues");var $t=$oj.create(this,$l,$V,$T,$m,$p,$o,$H,$g);$S||($S=$z.EMPTY),$S.translate($j,$O),$z.mul($S,this._curMat,$t._mat),$S.translate(-$j,-$O),this._submits[this._submits._length++]=$t,this._curSubmit=$Sj.RENDERBASE,this._renderKey=0},$O.addRenderObject=function($j){this._submits[this._submits._length++]=$j},$O.fillTrangles=function($j,$O,$V,$l,$T){var $S=this._curSubmit,$m=this._vb,$p=this._shader2D,$o=$S.shaderValue,$H=$l.length>>4,$g=$j.bitmap;this._renderKey=0,$p.glTexture==$g&&$p.ALPHA===$o.ALPHA||(($S=this._curSubmit=$Sj.createSubmit(this,this._ib,$m,$m._byteLength/32*3,$Uj.create(1,0))).shaderValue.textureHost=$j,this._submits[this._submits._length++]=$S),$rj.fillTranglesVB($m,$O,$V,$l,$T||this._curMat,this._x,this._y),$S._numEle+=6*$H},$O.submitElement=function($j,$O){var $V=this._submits;for($O<0&&($O=$V._length);$j<$O;)$j+=$V[$j].renderSubmit()},$O.finish=function(){$Aj.mainContext.finish()},$O.flush=function(){var $j=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($j>this._ib.bufferLength/12&&$rj.expandIBQuadrangle(this._ib,$j),!this._isMain&&$X.enabled&&$X._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$X._atlasRestore;for(var $O=this._submits,$V=0,$l=$O._length;$V<$l;$V++){var $T=$O[$V];10016===$T.getRenderType()&&$T.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$Oj.instance&&$Oj.getInstance().reset();var $S;for($V=0,$S=this.meshlist.length;$V<$S;$V++){var $m=this.meshlist[$V];$m.canReuse?$m.releaseMesh():$m.destroy()}return this.meshlist.length=0,this._curSubmit=$Sj.RENDERBASE,this._renderKey=0,this._triangleMesh=$ij.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$O.setPathId=function($j){if(this.mId=$j,-1!=this.mId){this.mHaveKey=!1;var $O=$n.getInstance();$O.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$O.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$O.movePath=function($j,$O){var $V=$j,$l=$O;$j=this._curMat.a*$V+this._curMat.c*$l+this._curMat.tx,$O=this._curMat.b*$V+this._curMat.d*$l+this._curMat.ty,this.mX+=$j,this.mY+=$O},$O.beginPath=function(){var $j=this._getPath();$j.tempArray.length=0,$j.closePath=!1,this.mX=0,this.mY=0},$O.closePath=function(){this._path.closePath=!0},$O.fill=function($j){void 0===$j&&($j=!1);var $O=this._getPath();this.drawPoly(0,0,$O.tempArray,this.fillStyle._color.numColor,0,0,$j)},$O.stroke=function(){var $j=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$j.drawLine(0,0,$j.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $O=$n.getInstance().shapeLineDic[this.mId];$O.rebuild($j.tempArray),$j.setGeomtry($O)}else $n.getInstance().addLine(this.mId,$j.drawLine(0,0,$j.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$j.update();var $V=[this.mX,this.mY],$l=$Sj.createShape(this,$j.ib,$j.vb,$j.count,$j.offset,$Uj.create(4,0));$l.shaderValue.ALPHA=this._shader2D.ALPHA,$l.shaderValue.u_pos=$V,$l.shaderValue.u_mmat2=$aj.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$l,this._renderKey=-1}},$O.line=function($j,$O,$V,$l,$T,$S){var $m=this._curSubmit,$p=this._vb;if($rj.fillLineVb($p,this._clipRect,$j,$O,$V,$l,$T,$S)){this._renderKey=0;var $o=this._shader2D,$H=$m.shaderValue;$o.strokeStyle===$H.strokeStyle&&$o.ALPHA===$H.ALPHA||($o.glTexture=null,($m=this._curSubmit=$Sj.createSubmit(this,this._ib,$p,($p._byteLength-64)/32*3,$Uj.create(2,0))).shaderValue.strokeStyle=$o.strokeStyle,$m.shaderValue.mainID=2,$m.shaderValue.ALPHA=$o.ALPHA,this._submits[this._submits._length++]=$m),$m._numEle+=6}},$O.moveTo=function($j,$O,$V){void 0===$V&&($V=!0);var $l=this._getPath();if($V){var $T=$j,$S=$O;$j=this._curMat.a*$T+this._curMat.c*$S,$O=this._curMat.b*$T+this._curMat.d*$S}$l.addPoint($j,$O)},$O.lineTo=function($j,$O,$V){void 0===$V&&($V=!0);var $l=this._getPath();if($V){var $T=$j,$S=$O;$j=this._curMat.a*$T+this._curMat.c*$S,$O=this._curMat.b*$T+this._curMat.d*$S}$l.addPoint($j,$O)},$O.drawCurves=function($j,$O,$V){this.setPathId(-1),this.beginPath(),this.strokeStyle=$V[3],this.lineWidth=$V[4];var $l=$V[2];$j+=$V[0],$O+=$V[1],this.movePath($j,$O),this.moveTo($l[0],$l[1]);for(var $T=2,$S=$l.length;$T<$S;)this.quadraticCurveTo($l[$T++],$l[$T++],$l[$T++],$l[$T++]);this.stroke()},$O.arcTo=function($j,$O,$V,$l,$T){if(-1==this.mId||!this.mHaveKey){var $S=0,$m=0,$p=0,$o=this._getPath();this._curMat.copyTo($N._tmpMatrix),$N._tmpMatrix.tx=$N._tmpMatrix.ty=0,$N._tempPoint.setTo($o.getEndPointX(),$o.getEndPointY()),$N._tmpMatrix.invertTransformPoint($N._tempPoint);var $H=$N._tempPoint.x-$j,$g=$N._tempPoint.y-$O,$e=Math.sqrt($H*$H+$g*$g);if(!($e<=1e-6)){var $t=$H/$e,$w=$g/$e,$s=$V-$j,$b=$l-$O,$r=$s*$s+$b*$b,$h=Math.sqrt($r);if(!($h<=1e-6)){var $a=$s/$h,$c=$b/$h,$A=$t+$a,$Z=$w+$c,$x=Math.sqrt($A*$A+$Z*$Z);if(!($x<=1e-6)){var $E=$A/$x,$U=$Z/$x,$z=Math.acos($E*$t+$U*$w),$$=Math.PI/2-$z,$_=($e=$T/Math.tan($$))*$t+$j,$B=$e*$w+$O,$M=Math.sqrt($e*$e+$T*$T),$v=$j+$E*$M,$Y=$O+$U*$M,$R=0,$q=0;if(0<=$t*$c-$w*$a){var $i=2*$$/$N.SEGNUM;$R=Math.sin($i),$q=Math.cos($i)}else $i=2*-$$/$N.SEGNUM,$R=Math.sin($i),$q=Math.cos($i);$m=this._curMat.a*$_+this._curMat.c*$B,$p=this._curMat.b*$_+this._curMat.d*$B,$m==this._path.getEndPointX()&&$p==this._path.getEndPointY()||$o.addPoint($m,$p);var $k=$_-$v,$n=$B-$Y;for($S=0;$S<$N.SEGNUM;$S++){var $G=$k*$q+$n*$R,$F=-$k*$R+$n*$q;$m=$G+$v,$p=$F+$Y,$j=this._curMat.a*$m+this._curMat.c*$p,$p=$O=this._curMat.b*$m+this._curMat.d*$p,($m=$j)==this._path.getEndPointX()&&$p==this._path.getEndPointY()||$o.addPoint($m,$p),$k=$G,$n=$F}}}}}},$O.arc=function($j,$O,$V,$l,$T,$S,$m){if(void 0===$S&&($S=!1),void 0===$m&&($m=!0),-1!=this.mId){var $p=$n.getInstance().shapeDic[this.mId];if($p&&this.mHaveKey&&!$p.needUpdate(this._curMat))return;$O=$j=0}var $o,$H=0,$g=0,$e=0,$t=0,$w=0,$s=0,$b=0;if($g=$T-$l,$S)if(Math.abs($g)>=2*Math.PI)$g=2*-Math.PI;else for(;0<$g;)$g-=2*Math.PI;else if(Math.abs($g)>=2*Math.PI)$g=2*Math.PI;else for(;$g<0;)$g+=2*Math.PI;$o=$g/($b=$V<101?Math.max(10,$g*$V/5):$V<201?Math.max(10,$g*$V/20):Math.max(10,$g*$V/40))/2,$e=Math.abs(4/3*(1-Math.cos($o))/Math.sin($o)),$S&&($e=-$e);var $r=this._getPath(),$h=NaN,$a=NaN;for($s=0;$s<=$b;$s++)$H=$l+$g*($s/$b),$t=$j+Math.cos($H)*$V,$w=$O+Math.sin($H)*$V,$m&&($h=$t,$a=$w,$t=this._curMat.a*$h+this._curMat.c*$a,$w=this._curMat.b*$h+this._curMat.d*$a),$t==this._path.getEndPointX()&&$w==this._path.getEndPointY()||$r.addPoint($t,$w);$t=$j+Math.cos($T)*$V,$w=$O+Math.sin($T)*$V,$m&&($h=$t,$a=$w,$t=this._curMat.a*$h+this._curMat.c*$a,$w=this._curMat.b*$h+this._curMat.d*$a),$t==this._path.getEndPointX()&&$w==this._path.getEndPointY()||$r.addPoint($t,$w)},$O.quadraticCurveTo=function($j,$O,$V,$l){var $T=$e.I,$S=$V,$m=$l;$V=this._curMat.a*$S+this._curMat.c*$m,$l=this._curMat.b*$S+this._curMat.d*$m,$S=$j,$m=$O,$j=this._curMat.a*$S+this._curMat.c*$m,$O=this._curMat.b*$S+this._curMat.d*$m;for(var $p=$T.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$j,$O,$V,$l],30,2),$o=0,$H=$p.length/2;$o<$H;$o++)this.lineTo($p[2*$o],$p[2*$o+1],!1);this.lineTo($V,$l,!1)},$O.rect=function($j,$O,$V,$l){this._other=this._other.make(),this._other.path||(this._other.path=new $u),this._other.path.rect($j,$O,$V,$l)},$O.strokeRect=function($j,$O,$V,$l,$T){var $S=.5*$T;this.line($j-$S,$O,$j+$V+$S,$O,$T,this._curMat),this.line($j+$V,$O,$j+$V,$O+$l,$T,this._curMat),this.line($j,$O,$j,$O+$l,$T,this._curMat),this.line($j-$S,$O+$l,$j+$V+$S,$O+$l,$T,this._curMat)},$O.clip=function(){},$O.drawPoly=function($j,$O,$V,$l,$T,$S,$m){void 0===$m&&($m=!1),this._renderKey=0,this._shader2D.glTexture=null;var $p=this._getPath();if(-1==this.mId)$p.polygon($j,$O,$V,$l,$T||1,$S);else if(this.mHaveKey){var $o=$n.getInstance().shapeDic[this.mId];$o.setMatrix(this._curMat),$o.rebuild($p.tempArray),$p.setGeomtry($o)}else{var $H=$p.polygon($j,$O,$V,$l,$T||1,$S);$n.getInstance().addShape(this.mId,$H),$H.setMatrix(this._curMat)}$p.update();var $g,$e=[this.mX,this.mY];if(($g=$Sj.createShape(this,$p.ib,$p.vb,$p.count,$p.offset,$Uj.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$g.shaderValue.u_pos=$e,$g.shaderValue.u_mmat2=$aj.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$g,0<$T){if(this.mHaveLineKey){var $t=$n.getInstance().shapeLineDic[this.mId];$t.rebuild($p.tempArray),$p.setGeomtry($t)}else $n.getInstance().addShape(this.mId,$p.drawLine($j,$O,$V,$T,$S));$p.update(),($g=$Sj.createShape(this,$p.ib,$p.vb,$p.count,$p.offset,$Uj.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$g.shaderValue.u_mmat2=$aj.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$g}},$O.drawParticle=function($j,$O,$V){$V.x=$j,$V.y=$O,this._submits[this._submits._length++]=$V},$O._getPath=function(){return this._path||(this._path=new $u)},$l(0,$O,"globalCompositeOperation",function(){return $C.NAMES[this._nBlendType]},function($j){var $O=$C.TOINT[$j];null==$O||this._nBlendType===$O||($y.save(this,65536,this,!0),this._curSubmit=$Sj.RENDERBASE,this._renderKey=0,this._nBlendType=$O)}),$l(0,$O,"strokeStyle",function(){return this._shader2D.strokeStyle},function($j){this._shader2D.strokeStyle.equal($j)||($y.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$J.create($j))}),$l(0,$O,"globalAlpha",function(){return this._shader2D.ALPHA},function($j){($j=Math.floor(1e3*$j)/1e3)!=this._shader2D.ALPHA&&($y.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$j)}),$l(0,$O,"asBitmap",null,function($j){if($j){if(this._targets||(this._targets=new $D),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$l(0,$O,"fillStyle",function(){return this._shader2D.fillStyle},function($j){this._shader2D.fillStyle.equal($j)||($y.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$J.create($j))}),$l(0,$O,"textAlign",function(){return this._other.textAlign},function($j){this._other.textAlign===$j||(this._other=this._other.make(),$y.save(this,32768,this._other,!1),this._other.textAlign=$j)}),$l(0,$O,"lineWidth",function(){return this._other.lineWidth},function($j){this._other.lineWidth===$j||(this._other=this._other.make(),$y.save(this,256,this._other,!1),this._other.lineWidth=$j)}),$l(0,$O,"textBaseline",function(){return this._other.textBaseline},function($j){this._other.textBaseline===$j||(this._other=this._other.make(),$y.save(this,16384,this._other,!1),this._other.textBaseline=$j)}),$l(0,$O,"font",null,function($j){$j!=this._other.font.toString()&&(this._other=this._other.make(),$y.save(this,8,this._other,!1),this._other.font===$sj.EMPTY?this._other.font=new $sj($j):this._other.font.setFont($j))}),$N.__init__=function(){$V.DEFAULT=new $V},$N._tempPoint=new $$,$N._SUBMITVBSIZE=32e3,$N._MAXSIZE=99999999,$N._RECTVBSIZE=16,$N.MAXCLIPRECT=new $_(0,0,99999999,99999999),$N._COUNT=0,$N._tmpMatrix=new $z,$N.SEGNUM=32,$N._contextcount=0,$m($N,["_fontTemp",function(){return this._fontTemp=new $sj},"_drawStyleTemp",function(){return this._drawStyleTemp=new $J(null)}]),$N.__init$=function(){$V=function(){function $j(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$sj.EMPTY}$t($j,"");var $O=$j.prototype;return $O.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$sj.EMPTY},$O.make=function(){return this===$j.DEFAULT?new $j:this},$j.DEFAULT=null,$j}()},$N}(),$Uj=function($j){function $l($j,$O){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$l.__super.call(this),this.defines=new $Bj,this.position=$l._POSITION,this.mainID=$j,this.subID=$O,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$j|$O,this._inClassCache=$l._cache[this._cacheID],0<$j&&!this._inClassCache&&(this._inClassCache=$l._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$t($l,"laya.webgl.shader.d2.value.Value2D",$F);var $O=$l.prototype;return $O.setValue=function($j){},$O.refresh=function(){var $j=this.size;return $j[0]=$aj.width,$j[1]=$aj.height,this.alpha=this.ALPHA*$aj.worldAlpha,this.mmat=$aj.worldMatrix4,this},$O._ShaderWithCompile=function(){return $dj.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$Dj.create)},$O._withWorldShaderDefines=function(){var $j=$aj.worldShaderDefines,$O=$dj.sharders[this.mainID|this.defines._value|$j.getValue()];if(!$O){var $V,$l={};for($V in this.defines.toNameDic())$l[$V]="";for($V in $j.toNameDic())$l[$V]="";$O=$dj.withCompile2D(0,this.mainID,$l,this.mainID|this.defines._value|$j.getValue(),$Dj.create)}var $T=$aj.worldFilters;if(!$T)return $O;for(var $S,$m=$T.length,$p=0;$p<$m;$p++)($S=$T[$p])&&$S.action.setValue(this);return $O},$O.upload=function(){var $j=$aj;this.alpha=this.ALPHA*$j.worldAlpha,$aj.worldMatrix4!==$aj.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$Aj.shaderHighPrecision&&this.defines.add(1024);var $O,$V=$j.worldShaderDefines?this._withWorldShaderDefines():$dj.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$j.width,this.size[1]=$j.height,this.mmat=$j.worldMatrix4,$kj.activeShader!==$V?$V._shaderValueWidth!==$j.width||$V._shaderValueHeight!==$j.height?($V._shaderValueWidth=$j.width,$V._shaderValueHeight=$j.height):$O=$V._params2dQuick2||$V._make2dQuick2():$V._shaderValueWidth!==$j.width||$V._shaderValueHeight!==$j.height?($V._shaderValueWidth=$j.width,$V._shaderValueHeight=$j.height):$O=$V._params2dQuick1||$V._make2dQuick1(),$V.upload(this,$O)},$O.setFilters=function($j){if(this.filters=$j)for(var $O,$V=$j.length,$l=0;$l<$V;$l++)($O=$j[$l])&&(this.defines.add($O.type),$O.action.setValue(this))},$O.clear=function(){this.defines.setValue(this.subID)},$O.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$l._initone=function($j,$O){$l._typeClass[$j]=$O,$l._cache[$j]=[],$l._cache[$j]._length=0},$l.__init__=function(){$l._POSITION=[2,5126,!1,4*$bj.BYTES_PE,0],$l._TEXCOORD=[2,5126,!1,4*$bj.BYTES_PE,2*$bj.BYTES_PE],$l._initone(2,$Nj),$l._initone(4,$Cj),$l._initone(256,$Xj),$l._initone(512,$Fj),$l._initone(1,$fj),$l._initone(65,$Qj),$l._initone(9,$fj)},$l.create=function($j,$O){var $V=$l._cache[$j|$O];return $V._length?$V[--$V._length]:new $l._typeClass[$j|$O]($O)},$l._POSITION=null,$l._TEXCOORD=null,$l._cache=[],$l._typeClass=[],$l.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$l}(),$zj=function($j){function $r($j,$O){$r.__super.call(this,$j,$O)}$t($r,"laya.webgl.utils.RenderSprite3D",$a);var $O=$r.prototype;return $O.onCreate=function($j){switch($j){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$O._mask=function($j,$O,$V,$l){var $T,$S,$m=this._next,$p=$j.mask;if($p){$O.ctx.save();var $o=$O.ctx.globalCompositeOperation,$H=new $_;if($H.copyFrom($p.getBounds()),$H.width=Math.round($H.width),$H.height=Math.round($H.height),$H.x=Math.round($H.x),$H.y=Math.round($H.y),0<$H.width&&0<$H.height){var $g=$j._style._tf,$e=$pj.create();$e.addValue("bounds",$H),$T=$mj.create([$e,$O],laya.webgl.utils.RenderSprite3D.tmpTarget),$O.addRenderObject($T),$p.render($O,-$H.x,-$H.y),$T=$mj.create([$e],laya.webgl.utils.RenderSprite3D.endTmpTarget),$O.addRenderObject($T),$O.ctx.save(),$O.clipRect($V-$g.translateX+$H.x,$l-$g.translateY+$H.y,$H.width,$H.height),$m._fun.call($m,$j,$O,$V,$l),$O.ctx.restore(),$S=$gj.create(6),$o=$O.ctx.globalCompositeOperation,$S.blendMode="mask",$O.addRenderObject($S),$z.TEMP.identity();var $t=$Uj.create(1,0),$w=$i.INV_UV,$s=$H.width,$b=$H.height;($H.width<32||$H.height<32)&&(($w=$r.tempUV)[0]=0,$w[1]=0,$w[2]=32<=$H.width?1:$H.width/32,$w[3]=0,$w[4]=32<=$H.width?1:$H.width/32,$w[5]=32<=$H.height?1:$H.height/32,$w[6]=0,$w[7]=32<=$H.height?1:$H.height/32,$H.width=32<=$H.width?$H.width:32,$H.height=32<=$H.height?$H.height:32,$w[1]*=-1,$w[3]*=-1,$w[5]*=-1,$w[7]*=-1,$w[1]+=1,$w[3]+=1,$w[5]+=1,$w[7]+=1),$O.ctx.drawTarget($e,$V+$H.x-$g.translateX,$l+$H.y-$g.translateY,$s,$b,$z.TEMP,"tmpTarget",$t,$w,6),$T=$mj.create([$e],laya.webgl.utils.RenderSprite3D.recycleTarget),$O.addRenderObject($T),($S=$gj.create(6)).blendMode=$o,$O.addRenderObject($S)}$O.ctx.restore()}else $m._fun.call($m,$j,$O,$V,$l)},$O._blend=function($j,$O,$V,$l){var $T=$j._style,$S=this._next;$T.blendMode?($O.ctx.save(),$O.ctx.globalCompositeOperation=$T.blendMode,$S._fun.call($S,$j,$O,$V,$l),$O.ctx.restore()):$S._fun.call($S,$j,$O,$V,$l)},$O._transform=function($j,$O,$V,$l){var $T=$j.transform,$S=this._next;if($T&&$S!=$a.NORENDER){var $m=$O.ctx;$j._style;$T.tx=$V,$T.ty=$l;var $p=$m._getTransformMatrix(),$o=$p.clone();$z.mul($T,$p,$p),$p._checkTransform(),$T.tx=$T.ty=0,$S._fun.call($S,$j,$O,0,0),$o.copyTo($p),$o.destroy()}else $S._fun.call($S,$j,$O,$V,$l)},$r.tmpTarget=function($j,$O){var $V=$j.getValue("bounds"),$l=$nj.create($V.width,$V.height);$l.start(),$l.clear(0,0,0,0),$j.addValue("tmpTarget",$l)},$r.endTmpTarget=function($j){$j.getValue("tmpTarget").end()},$r.recycleTarget=function($j){$j.getValue("tmpTarget").recycle(),$j.recycle()},$m($r,["tempUV",function(){return this.tempUV=new Array(8)}]),$r}(),$$j=function($j){function $O(){this.data=null,$O.__super.call(this)}$t($O,"laya.filters.webgl.ColorFilterActionGL",$G);var $V=$O.prototype;return $x.imps($V,{"laya.filters.IFilterActionGL":!0}),$V.setValue=function($j){$j.colorMat=this.data._mat,$j.colorAlpha=this.data._alpha},$V.apply3d=function($j,$O,$V,$l,$T){var $S=$j.getValue("bounds"),$m=$Uj.create(1,0);$m.setFilters([this.data]);var $p=$z.TEMP;$p.identity(),$V.ctx.drawTarget($j,0,0,$S.width,$S.height,$p,"src",$m)},$O}(),$_j=function($j){function $S($j,$O,$V,$l,$T){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$S.__super.call(this,$j,$O,$T),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $Jj,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$V,this._atlasCanvas.height=$l,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$t($S,"laya.webgl.atlas.Atlaser",$N);var $O=$S.prototype;return $O.computeUVinAtlasTexture=function($j,$O,$V,$l){var $T=$X.atlasTextureWidth,$S=$X.atlasTextureHeight,$m=$V/$T,$p=$l/$S,$o=($V+$j.bitmap.width)/$T,$H=($l+$j.bitmap.height)/$S,$g=$j.bitmap.width/$T,$e=$j.bitmap.height/$S;$j.uv=[$m+$O[0]*$g,$p+$O[1]*$e,$o-(1-$O[2])*$g,$p+$O[3]*$e,$o-(1-$O[4])*$g,$H-(1-$O[5])*$e,$m+$O[6]*$g,$H-(1-$O[7])*$e]},$O.findBitmapIsExist=function($j){if($j instanceof laya.webgl.resource.WebGLImage){var $O=$j,$V=$O.url,$l=this._InAtlasWebGLImagesKey[$V||$O.id];if($l)return $l.offsetInfoID}return-1},$O.addToAtlasTexture=function($j,$O,$V){if($j instanceof laya.webgl.resource.WebGLImage){var $l=$j,$T=$l.url;this._InAtlasWebGLImagesKey[$T||$l.id]={bitmap:$j,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$O,$V])}this._atlasCanvas.texSubImage2D($O,$V,$j.atlasSource),$j.clearAtlasSource()},$O.addToAtlas=function($j,$O,$V){$j._atlasID=this._inAtlasTextureKey.length;var $l=$j.uv.slice(),$T=$j.bitmap;this._inAtlasTextureKey.push($j),this._inAtlasTextureOriUVValue.push($l),this._inAtlasTextureBitmapValue.push($T),this.computeUVinAtlasTexture($j,$l,$O,$V),$j.bitmap=this._atlasCanvas},$O.clear=function(){for(var $j=0,$O=this._inAtlasTextureKey.length;$j<$O;$j++)this._inAtlasTextureKey[$j].bitmap=this._inAtlasTextureBitmapValue[$j],this._inAtlasTextureKey[$j].uv=this._inAtlasTextureOriUVValue[$j],this._inAtlasTextureKey[$j]._atlasID=-1,this._inAtlasTextureKey[$j].bitmap.lock=!1,this._inAtlasTextureKey[$j].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$O.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$l(0,$O,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$l(0,$O,"texture",function(){return this._atlasCanvas}),$l(0,$O,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$S}(),$Bj=function($j){function $V(){$V.__super.call(this,$V.__name2int,$V.__int2name,$V.__int2nameMap)}return $t($V,"laya.webgl.shader.d2.ShaderDefines2D",$P),$V.__init__=function(){$V.reg("TEXTURE2D",1),$V.reg("COLOR2D",2),$V.reg("PRIMITIVE",4),$V.reg("GLOW_FILTER",8),$V.reg("BLUR_FILTER",16),$V.reg("COLOR_FILTER",32),$V.reg("COLOR_ADD",64),$V.reg("WORLDMAT",128),$V.reg("FILLTEXTURE",256),$V.reg("FSHIGHPRECISION",1024),$V.reg("TXTALPHA",2048),$V.reg("TXTCOMPRESS",4096)},$V.reg=function($j,$O){$P._reg($j,$O,$V.__name2int,$V.__int2name)},$V.toText=function($j,$O,$V){return $P._toText($j,$O,$V)},$V.toInt=function($j){return $P._toInt($j,$V.__name2int)},$V.TEXTURE2D=1,$V.COLOR2D=2,$V.PRIMITIVE=4,$V.FILTERGLOW=8,$V.FILTERBLUR=16,$V.FILTERCOLOR=32,$V.COLORADD=64,$V.WORLDMAT=128,$V.FILLTEXTURE=256,$V.SKINMESH=512,$V.SHADERDEFINE_FSHIGHPRECISION=1024,$V.TXTALPHA=2048,$V.TXTCOMPRESS=4096,$V.__name2int={},$V.__int2name=[],$V.__int2nameMap=[],$V}(),$Mj=(function($j){function $p($j,$O,$V,$l,$T,$S,$m){$p.__super.call(this,$j,$O,$V,$l,40,$T,$S,$m)}$t($p,"laya.webgl.shapes.Ellipse",$Vj)}(),function($j){function $S($j,$O,$V,$l,$T){this._points=[],this.rebuild($V),$S.__super.call(this,$j,$O,0,0,0,$T,$l,$T,0)}$t($S,"laya.webgl.shapes.Line",$Vj);var $O=$S.prototype;return $O.rebuild=function($j){var $O=$j.length;$O!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($O/2-1)),this.mFloat32Array=new Float32Array(5*$O)),this._points.length=0;for(var $V=NaN,$l=NaN,$T=-1,$S=-1,$m=$j.length/2,$p=0;$p<$m;$p++)$V=$j[2*$p],$l=$j[2*$p+1],(.01<Math.abs($T-$V)||.01<Math.abs($S-$l))&&this._points.push($V,$l),$T=$V,$S=$l},$O.getData=function($j,$O,$V){var $l=[],$T=[];0<this.borderWidth&&this.createLine2(this._points,$l,this.borderWidth,$V,$T,this._points.length/2),this.mUint16Array.set($l,0),this.mFloat32Array.set($T,0),$j.append(this.mUint16Array),$O.append(this.mFloat32Array)},$S}()),$vj=function($j){function $e($j,$O,$V,$l,$T){this._points=[];for(var $S=NaN,$m=NaN,$p=-1,$o=-1,$H=$V.length/2-1,$g=0;$g<$H;$g++)$S=$V[2*$g],$m=$V[2*$g+1],(.01<Math.abs($p-$S)||.01<Math.abs($o-$m))&&this._points.push($S,$m),$p=$S,$o=$m;$S=$V[2*$H],$m=$V[2*$H+1],$p=this._points[0],$o=this._points[1],(.01<Math.abs($p-$S)||.01<Math.abs($o-$m))&&this._points.push($S,$m),$e.__super.call(this,$j,$O,0,0,this._points.length/2,0,$l,$T)}$t($e,"laya.webgl.shapes.LoopLine",$Vj);var $O=$e.prototype;return $O.getData=function($j,$O,$V){if(0<this.borderWidth){for(var $l=this.color,$T=($l>>16&255)/255,$S=($l>>8&255)/255,$m=(255&$l)/255,$p=[],$o=0,$H=0,$g=[],$e=Math.floor(this._points.length/2),$t=0;$t<$e;$t++)$o=this._points[2*$t],$H=this._points[2*$t+1],$p.push(this.x+$o,this.y+$H,$T,$S,$m);this.createLoopLine($p,$g,this.borderWidth,$V+$p.length/5),$j.append(new Uint16Array($g)),$O.append(new Float32Array($p))}},$O.createLoopLine=function($j,$O,$V,$l,$T,$S){$j.length;var $m=$j.concat(),$p=$T||$j,$o=this.borderColor,$H=($o>>16&255)/255,$g=($o>>8&255)/255,$e=(255&$o)/255,$t=[$m[0],$m[1]],$w=[$m[$m.length-5],$m[$m.length-4]],$s=$w[0]+.5*($t[0]-$w[0]),$b=$w[1]+.5*($t[1]-$w[1]);$m.unshift($s,$b,0,0,0),$m.push($s,$b,0,0,0);var $r,$h,$a,$c,$A,$Z,$x,$E,$U,$z,$$,$_,$B,$M,$v,$Y,$R,$q,$i,$k,$n=$m.length/5,$G=$l,$F=$V/2;$a=$m[0],$c=$m[1],$z=$a-($A=$m[5]),$U=($U=-($c-($Z=$m[6])))/($k=Math.sqrt($U*$U+$z*$z))*$F,$z=$z/$k*$F,$p.push($a-$U,$c-$z,$H,$g,$e,$a+$U,$c+$z,$H,$g,$e);for(var $N=1;$N<$n-1;$N++)$a=$m[5*($N-1)],$c=$m[5*($N-1)+1],$A=$m[5*$N],$Z=$m[5*$N+1],$x=$m[5*($N+1)],$E=$m[5*($N+1)+1],$z=$a-$A,$_=$A-$x,$v=(-($U=($U=-($c-$Z))/($k=Math.sqrt($U*$U+$z*$z))*$F)+$a)*(-($z=$z/$k*$F)+$Z)-(-$U+$A)*(-$z+$c),$q=(-($$=($$=-($Z-$E))/($k=Math.sqrt($$*$$+$_*$_))*$F)+$x)*(-($_=$_/$k*$F)+$Z)-(-$$+$A)*(-$_+$E),$i=($B=-$z+$c-(-$z+$Z))*($R=-$$+$A-(-$$+$x))-($Y=-$_+$E-(-$_+$Z))*($M=-$U+$A-(-$U+$a)),Math.abs($i)<.1?($i+=10.1,$p.push($A-$U,$Z-$z,$H,$g,$e,$A+$U,$Z+$z,$H,$g,$e)):((($r=($M*$q-$R*$v)/$i)-$A)*($r-$A)+(($h=($Y*$v-$B*$q)/$i)-$Z)+($h-$Z),$p.push($r,$h,$H,$g,$e,$A-($r-$A),$Z-($h-$Z),$H,$g,$e));$S&&($O=$S);var $X=this.edges+1;for($N=1;$N<$X;$N++)$O.push($G+2*($N-1),$G+2*($N-1)+1,$G+2*$N+1,$G+2*$N+1,$G+2*$N,$G+2*($N-1));return $O.push($G+2*($N-1),$G+2*($N-1)+1,$G+1,$G+1,$G,$G+2*($N-1)),$p},$e}(),$Yj=function($j){function $m($j,$O,$V,$l,$T,$S){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$z.create(),this._points=$V.slice(0,$V.length),$m.__super.call(this,$j,$O,0,0,this._points.length/2,$l,$T,$S)}$t($m,"laya.webgl.shapes.Polygon",$Vj);var $O=$m.prototype;return $O.rebuild=function($j){this._repaint||(this._points.length=0,this._points=this._points.concat($j))},$O.setMatrix=function($j){$j.copyTo(this._mat)},$O.needUpdate=function($j){return this._repaint=this._mat.a==$j.a&&this._mat.b==$j.b&&this._mat.c==$j.c&&this._mat.d==$j.d&&this._mat.tx==$j.tx&&this._mat.ty==$j.ty,!this._repaint},$O.getData=function($j,$O,$V){var $l,$T=0,$S=this._points,$m=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$V){for(this._start=$V,$l=[],$m=this.earcutTriangles.length,$T=0;$T<$m;$T++)$l.push(this.earcutTriangles[$T]+$V);this.mUint16Array=new Uint16Array($l)}}else{this._start=$V,$l=[];var $p=[],$o=[],$H=this.color,$g=($H>>16&255)/255,$e=($H>>8&255)/255,$t=(255&$H)/255;for($m=Math.floor($S.length/2),$T=0;$T<$m;$T++)$p.push(this.x+$S[2*$T],this.y+$S[2*$T+1],$g,$e,$t),$o.push(this.x+$S[2*$T],this.y+$S[2*$T+1]);for(this.earcutTriangles=$lj.earcut($o,null,2),$m=this.earcutTriangles.length,$T=0;$T<$m;$T++)$l.push(this.earcutTriangles[$T]+$V);this.mUint16Array=new Uint16Array($l),this.mFloat32Array=new Float32Array($p)}$j.append(this.mUint16Array),$O.append(this.mFloat32Array)},$m}(),$Rj=function($j){function $S(){this._matrix=new $z,this._matrix4=$bj.defaultMatrix4.concat(),$S.__super.call(this,1e4),this.shaderValue=new $Uj(0,0)}$t($S,"laya.webgl.submit.SubmitCanvas",$Sj);var $O=$S.prototype;return $O.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $j=$aj.worldAlpha,$O=$aj.worldMatrix4,$V=$aj.worldMatrix,$l=$aj.worldFilters,$T=$aj.worldShaderDefines,$S=this.shaderValue,$m=this._matrix,$p=this._matrix4,$o=$z.TEMP;return $z.mul($m,$V,$o),$p[0]=$o.a,$p[1]=$o.b,$p[4]=$o.c,$p[5]=$o.d,$p[12]=$o.tx,$p[13]=$o.ty,$aj.worldMatrix=$o.clone(),$aj.worldMatrix4=$p,$aj.worldAlpha=$aj.worldAlpha*$S.alpha,$S.filters&&$S.filters.length&&($aj.worldFilters=$S.filters,$aj.worldShaderDefines=$S.defines),this._ctx_src.flush(),$aj.worldAlpha=$j,$aj.worldMatrix4=$O,$aj.worldMatrix.destroy(),$aj.worldMatrix=$V,$aj.worldFilters=$l,$aj.worldShaderDefines=$T,1},$O.releaseRender=function(){var $j=$S._cache;this._ctx_src=null,$j[$j._length++]=this},$O.getRenderType=function(){return 10003},$S.create=function($j,$O,$V){var $l=$S._cache._length?$S._cache[--$S._cache._length]:new $S;$l._ctx_src=$j;var $T=$l.shaderValue;return $T.alpha=$O,$T.defines.setValue(0),$V&&$V.length&&$T.setFilters($V),$l},$S._cache=(($S._cache=[])._length=0,$S._cache),$S}(),$qj=function($j){function $H($j){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$j&&($j=1e4),$H.__super.call(this,$j)}$t($H,"laya.webgl.submit.SubmitTexture",$Sj);var $O=$H.prototype;return $O.releaseRender=function(){var $j=$H._cache;($j[$j._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$O.addTexture=function($j,$O){this._texsID[this._texs.length]=$j._uvID,this._texs.push($j),this._vbPos.push($O)},$O.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $j=this.shaderValue.textureHost.bitmap;if(null!==$j)for(var $O=this._vb.getFloat32Array(),$V=0,$l=this._texs.length;$V<$l;$V++){var $T=this._texs[$V];$T.active();var $S=$T.uv;if(this._texsID[$V]!==$T._uvID){this._texsID[$V]=$T._uvID;var $m=this._vbPos[$V];$O[$m+2]=$S[0],$O[$m+3]=$S[1],$O[$m+6]=$S[2],$O[$m+7]=$S[3],$O[$m+10]=$S[4],$O[$m+11]=$S[5],$O[$m+14]=$S[6],$O[$m+15]=$S[7],this._vb.setNeedUpload()}$T.bitmap!==$j&&(this._isSameTexture=!1)}}},$O.renderSubmit=function(){if(0===this._numEle)return $H._shaderSet=!1,1;var $j=this.shaderValue.textureHost;if($j){var $O=$j.source;if(!$j.bitmap||!$O)return $H._shaderSet=!1,1;this.shaderValue.texture=$O,$j.alphaTexture&&$j.alphaTexture.source&&(this.shaderValue.texture1=$j.alphaTexture.source)}this._vb.bind_upload(this._ib);var $V=$Aj.mainContext;if($C.activeBlendFunction!==this._blendFn&&($V.enable(3042),this._blendFn($V),$C.activeBlendFunction=this._blendFn),$v.drawCall++,$v.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$kj.activeShader&&$H._shaderSet?($kj.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$kj.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$H._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $l=$j.bitmap,$T=0,$S=$kj.activeShader,$m=0,$p=this._texs.length;$m<$p;$m++){var $o=this._texs[$m];$o.bitmap===$l&&$m+1!==$p||($S.uploadTexture2D($o.source),$V.drawElements(4,6*($m-$T+1),5123,this._startIdx+6*$T*$bj.BYTES_PIDX),$l=$o.bitmap,$T=$m)}else $V.drawElements(4,this._numEle,5123,this._startIdx);return 1},$H.create=function($j,$O,$V,$l,$T){var $S=$H._cache._length?$H._cache[--$H._cache._length]:new $H;null==$V&&(($V=$S._selfVb||($S._selfVb=$Pj.create(-1))).clear(),$l=0),$S._ib=$O,$S._vb=$V,$S._startIdx=$l*$bj.BYTES_PIDX,$S._numEle=0;var $m=$j._nBlendType;$S._blendFn=$j._targets?$C.targetFns[$m]:$C.fns[$m],$S.shaderValue=$T,$S.shaderValue.setValue($j._shader2D);var $p=$j._shader2D.filters;return $p&&$S.shaderValue.setFilters($p),$S},$H._cache=(($H._cache=[])._length=0,$H._cache),$H._shaderSet=!0,$H}(),$ij=function($j){function $h(){$h.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$t($h,"laya.webgl.utils.MeshTexture",$hj);var $O=$h.prototype;return $O.addData=function($j,$O,$V,$l,$T,$S){for(var $m=$j.length/2,$p=this._vb.needSize($m*$h.const_stride)>>2,$o=this._vb.getFloat32Array(),$H=0,$g=0;$g<$m;$g++){var $e=$j[$H],$t=$j[$H+1],$w=$e*$l.a+$t*$l.c+$l.tx,$s=$e*$l.b+$t*$l.d+$l.ty;$o[$p++]=$w,$o[$p++]=$s,$o[$p++]=$O[$H],$o[$p++]=$O[$H+1],$H+=2}this._vb.setNeedUpload();var $b=this.vertNum;if(0<$b){($m=$V.length)>$h.tmpIdx.length&&($h.tmpIdx=new Uint16Array($m));for(var $r=0;$r<$m;$r++)$h.tmpIdx[$r]=$V[$r]+$b;this._ib.appendU16Array($h.tmpIdx,$V.length)}else this._ib.append($V);this._ib.setNeedUpload(),this.vertNum+=$m,this.indexNum+=$V.length},$O.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$O.destroy=function(){this._ib.destroy(),this._vb.destroy()},$h.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $h},$h.const_stride=16,$h._POOL=[],$m($h,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$h}(),$kj=function($j){function $O(){$O.__super.call(this),this.lock=!0}return $t($O,"laya.webgl.shader.BaseShader",$c),$O.activeShader=null,$O.bindShader=null,$O}(),$nj=function($O){function $g($j,$O,$V,$l,$T,$S,$m,$p,$o){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$V&&($V=6408),void 0===$l&&($l=5121),void 0===$T&&($T=34041),void 0===$S&&($S=!1),void 0===$m&&($m=!1),void 0===$p&&($p=-1),void 0===$o&&($o=-1),this._type=1,this._w=$j,this._h=$O,this._surfaceFormat=$V,this._surfaceType=$l,this._depthStencilFormat=$T,$h.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$S,this._repeat=$m,this._minFifter=$p,this._magFifter=$o,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$g.__super.call(this,this.bitmap,$i.INV_UV)}$t($g,"laya.webgl.resource.RenderTarget2D",$O);var $j=$g.prototype;return $x.imps($j,{"laya.resource.IDispose":!0}),$j.getType=function(){return this._type},$j.getTexture=function(){return this},$j.size=function($j,$O){this._w==$j&&this._h==$O||(this._w=$j,this._h=$O,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$j.release=function(){this.destroy()},$j.recycle=function(){$g.POOL.push(this)},$j.start=function(){var $j=$Aj.mainContext;return this._preRenderTarget=$aj.curRenderTarget,$aj.curRenderTarget=this,$j.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($j.viewport(0,0,this._w,this._h),this._svWidth=$aj.width,this._svHeight=$aj.height,$aj.width=this._w,$aj.height=this._h,$kj.activeShader=null),this},$j.clear=function($j,$O,$V,$l){void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=1);var $T=$Aj.mainContext;$T.clearColor($j,$O,$V,$l);var $S=16384;switch(this._depthStencilFormat){case 33189:$S|=256;break;case 36168:$S|=1024;break;case 34041:$S|=256,$S|=1024}$T.clear($S)},$j.end=function(){var $j=$Aj.mainContext;$j.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$aj.curRenderTarget=this._preRenderTarget,1==this._type?($j.viewport(0,0,this._svWidth,this._svHeight),$aj.width=this._svWidth,$aj.height=this._svHeight,$kj.activeShader=null):$j.viewport(0,0,$x.stage.width,$x.stage.height)},$j.getData=function($j,$O,$V,$l){var $T=$Aj.mainContext;if($T.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$T.checkFramebufferStatus(36160)))return $T.bindFramebuffer(36160,null),null;var $S=new Uint8Array(this._w*this._h*4);return $T.readPixels($j,$O,$V,$l,this._surfaceFormat,this._surfaceType,$S),$T.bindFramebuffer(36160,null),$S},$j.destroy=function($j){void 0===$j&&($j=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$O.prototype.destroy.call(this))},$j.dispose=function(){},$j._createWebGLRenderTarget=function(){this.bitmap=new $Wj(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($j){this.event("recovered")})},$l(0,$j,"surfaceFormat",function(){return this._surfaceFormat}),$l(0,$j,"magFifter",function(){return this._magFifter}),$l(0,$j,"surfaceType",function(){return this._surfaceType}),$l(0,$j,"mipMap",function(){return this._mipMap}),$l(0,$j,"depthStencilFormat",function(){return this._depthStencilFormat}),$l(0,$j,"minFifter",function(){return this._minFifter}),$l(0,$j,"source",function(){return this._alreadyResolved?$x.superGet($i,this,"source"):null}),$g.create=function($j,$O,$V,$l,$T,$S,$m,$p,$o){void 0===$V&&($V=6408),void 0===$l&&($l=5121),void 0===$T&&($T=34041),void 0===$S&&($S=!1),void 0===$m&&($m=!1),void 0===$p&&($p=-1),void 0===$o&&($o=-1);var $H=$g.POOL.pop();return $H||($H=new $g($j,$O)),$H.bitmap&&$H._w==$j&&$H._h==$O&&$H._surfaceFormat==$V&&$H._surfaceType==$l&&$H._depthStencilFormat==$T&&$H._mipMap==$S&&$H._repeat==$m&&$H._minFifter==$p&&$H._magFifter==$o||($H._w=$j,$H._h=$O,$H._surfaceFormat=$V,$H._surfaceType=$l,$H._depthStencilFormat=$T,$h.isConchWebGL&&34041===$H._depthStencilFormat&&($H._depthStencilFormat=33189),$H._mipMap=$S,$H._repeat=$m,$H._minFifter=$p,$H._magFifter=$o,$H.release(),$H._createWebGLRenderTarget()),$H},$g.TYPE2D=1,$g.TYPE3D=2,$g.POOL=[],$g}($i),$Gj=function($j){function $O(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$O.__super.call(this),$O._gl=$Aj.mainContext}$t($O,"laya.webgl.utils.Buffer",$c);var $V=$O.prototype;return $V._bind=function(){this.activeResource(),$O._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($O._bindVertexBuffer=this._glBuffer),$O._gl.bindBuffer(this._bufferType,$O._bindActive[this._bufferType]=this._glBuffer),$kj.activeShader=null)},$V.recreateResource=function(){this._glBuffer||(this._glBuffer=$O._gl.createBuffer()),this.completeCreate()},$V.disposeResource=function(){this._glBuffer&&($Aj.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$l(0,$V,"bufferUsage",function(){return this._bufferUsage}),$O._gl=null,$O._bindActive={},$O._bindVertexBuffer=null,$O._enableAtributes=[],$O}(),$Fj=function($j){function $V($j){this.texcoord=null,this.offsetX=300,this.offsetY=0,$V.__super.call(this,512,0);var $O=8*$bj.BYTES_PE;this.position=[2,5126,!1,$O,0],this.texcoord=[2,5126,!1,$O,2*$bj.BYTES_PE],this.color=[4,5126,!1,$O,4*$bj.BYTES_PE]}return $t($V,"laya.webgl.shader.d2.skinAnishader.SkinSV",$Uj),$V}(),$Nj=function($j){function $O($j){$O.__super.call(this,2,0),this.color=[]}return $t($O,"laya.webgl.shader.d2.value.Color2dSV",$Uj),$O.prototype.setValue=function($j){$j.fillStyle&&(this.color=$j.fillStyle._color._color),$j.strokeStyle&&(this.color=$j.strokeStyle._color._color)},$O}(),$Xj=function($j){function $O($j){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$Uj._TEXCOORD,$O.__super.call(this,256,0)}$t($O,"laya.webgl.shader.d2.value.FillTextureSV",$Uj);var $V=$O.prototype;return $V.setValue=function($j){this.ALPHA=$j.ALPHA,$j.filters&&this.setFilters($j.filters)},$V.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$O}(),$fj=function($j){function $O($j){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$Uj._TEXCOORD,void 0===$j&&($j=0),$O.__super.call(this,1,$j)}$t($O,"laya.webgl.shader.d2.value.TextureSV",$Uj);var $V=$O.prototype;return $V.setValue=function($j){this.ALPHA=$j.ALPHA,$j.filters&&this.setFilters($j.filters)},$V.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$O}(),$Cj=function($j){function $O($j){this.a_color=null,this.u_pos=[0,0],$O.__super.call(this,4,0),this.position=[2,5126,!1,5*$bj.BYTES_PE,0],this.a_color=[3,5126,!1,5*$bj.BYTES_PE,2*$bj.BYTES_PE]}return $t($O,"laya.webgl.shader.d2.value.PrimitiveSV",$Uj),$O}(),$Jj=function($j){function $O(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$O.__super.call(this)}$t($O,"laya.webgl.atlas.AtlasWebGLCanvas",$j);var $V=$O.prototype;return $V.recreateResource=function(){var $j=$Aj.mainContext,$O=this._source=$j.createTexture(),$V=$Zj.curBindTexTarget,$l=$Zj.curBindTexValue;$Zj.bindTexture($j,3553,$O),$j.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$j.texParameteri(3553,10241,9729),$j.texParameteri(3553,10240,9729),$j.texParameteri(3553,10242,33071),$j.texParameteri(3553,10243,33071),$V&&$l&&$Zj.bindTexture($j,$V,$l),this.memorySize=this._w*this._h*4,this.completeCreate()},$V.disposeResource=function(){this._source&&($Aj.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$V.texSubImage2D=function($j,$O,$V){if($h.isFlash){this._flashCacheImage||(this._flashCacheImage=$b.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $l=$V.bitmapdata;this._flashCacheImage._image.copyPixels($l,0,0,$l.width,$l.height,$j,$O),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $T=$Aj.mainContext,$S=$Zj.curBindTexTarget,$m=$Zj.curBindTexValue;$Zj.bindTexture($T,3553,this._source),$T.pixelStorei(37441,!0),0<=$j-1&&$T.texSubImage2D(3553,0,$j-1,$O,6408,5121,$V),$j+1<=this._w&&$T.texSubImage2D(3553,0,$j+1,$O,6408,5121,$V),0<=$O-1&&$T.texSubImage2D(3553,0,$j,$O-1,6408,5121,$V),$O+1<=this._h&&$T.texSubImage2D(3553,0,$j,$O+1,6408,5121,$V),$T.texSubImage2D(3553,0,$j,$O,6408,5121,$V),$T.pixelStorei(37441,!1),$S&&$m&&$Zj.bindTexture($T,$S,$m)}},$V.texSubImage2DPixel=function($j,$O,$V,$l,$T){var $S=$Aj.mainContext,$m=$Zj.curBindTexTarget,$p=$Zj.curBindTexValue;$Zj.bindTexture($S,3553,this._source);var $o=new Uint8Array($T.data);$S.pixelStorei(37441,!0),$S.texSubImage2D(3553,0,$j,$O,$V,$l,6408,5121,$o),$S.pixelStorei(37441,!1),$m&&$p&&$Zj.bindTexture($S,$m,$p)},$l(0,$V,"width",$j.prototype._$get_width,function($j){this._w=$j}),$l(0,$V,"height",$j.prototype._$get_height,function($j){this._h=$j}),$O}($V),$uj=function($j){function $T(){this.flipY=!0,this.alwaysChange=!1,$T.__super.call(this)}$t($T,"laya.webgl.resource.WebGLCanvas",$V);var $O=$T.prototype;return $O.getCanvas=function(){return this._canvas},$O.clear=function(){this._ctx&&this._ctx.clear()},$O.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$O._setContext=function($j){this._ctx=$j},$O.getContext=function($j,$O){return this._ctx?this._ctx:this._ctx=$T._createContext(this)},$O.size=function($j,$O){this._w==$j&&this._h==$O||(this._w=$j,this._h=$O,this._ctx&&this._ctx.size($j,$O),this._canvas&&(this._canvas.height=$O,this._canvas.width=$j))},$O.activeResource=function($j){void 0===$j&&($j=!1),this._source||this.recreateResource()},$O.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$O.disposeResource=function(){this._source&&!this.iscpuSource&&($Aj.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$O.createWebGlTexture=function(){var $j=$Aj.mainContext;this._canvas;var $O=this._source=$j.createTexture();this.iscpuSource=!1;var $V=$Zj.curBindTexTarget,$l=$Zj.curBindTexValue;$Zj.bindTexture($j,3553,$O),$j.pixelStorei(37440,this.flipY?1:0),$T.premulAlpha&&$j.pixelStorei(37441,!0),$j.texImage2D(3553,0,6408,6408,5121,this._imgData),$T.premulAlpha&&$j.pixelStorei(37441,!1),$j.texParameteri(3553,10240,9729),$j.texParameteri(3553,10241,9729),$j.texParameteri(3553,10242,33071),$j.texParameteri(3553,10243,33071),$j.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$V&&$l&&$Zj.bindTexture($j,$V,$l)},$O.reloadCanvasData=function(){var $j=$Aj.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $O=$Zj.curBindTexTarget,$V=$Zj.curBindTexValue;$Zj.bindTexture($j,3553,this._source),$T.premulAlpha&&$j.pixelStorei(37441,!0),$j.texImage2D(3553,0,6408,6408,5121,this._imgData),$T.premulAlpha&&$j.pixelStorei(37441,!1),$j.pixelStorei(37440,0),$O&&$V&&$Zj.bindTexture($j,$O,$V)},$O.texSubImage2D=function($j,$O,$V){var $l=$Aj.mainContext,$T=$Zj.curBindTexTarget,$S=$Zj.curBindTexValue;$Zj.bindTexture($l,3553,this._source),$l.pixelStorei(37441,!0),$l.texSubImage2D(3553,0,$O,$V,6408,5121,$j._source),$l.pixelStorei(37441,!1),$T&&$S&&$Zj.bindTexture($l,$T,$S)},$O.toBase64=function($j,$O,$V){var $l=null;this._canvas&&($l=this._canvas.toDataURL($j,$O)),$V.call(this,$l)},$l(0,$O,"context",function(){return this._ctx}),$l(0,$O,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$l(0,$O,"asBitmap",null,function($j){this._ctx&&(this._ctx.asBitmap=$j)}),$T._createContext=null,$T.premulAlpha=!1,$T}(),$yj=function($j){function $S($j,$O){this.CborderSize=12,$S.__super.call(this),this.char=$j,this.isSpace=" "===$j,this.xs=$O.scaleX,this.ys=$O.scaleY,this.font=$O.font.toString(),this.fontSize=$O.font.size,this.fillColor=$O.fillColor,this.borderColor=$O.borderColor,this.lineWidth=$O.lineWidth,this.underLine=$O.underLine;var $V,$l=$h.isConchApp;$l?(($V=ConchTextCanvas)._source=ConchTextCanvas,$V._source.canvas=ConchTextCanvas):$V=$w.canvas.source,this.canvas=$V,this._enableMerageInAtlas=!0,this._ctx=$l?$V:this.canvas.getContext("2d",void 0);var $T=$k.measureText(this.char,this.font);this.cw=$T.width*this.xs,this.ch=($T.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $i(this)}$t($S,"laya.webgl.resource.WebGLCharImage",$V);var $O=$S.prototype;return $x.imps($O,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$O.active=function(){this.texture.active()},$O.recreateResource=function(){var $j=$h.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$j){var $O=this.fontSize;1==this.xs&&1==this.ys||($O=parseInt($O*(this.xs>this.ys?this.xs:this.ys)+""));var $V="normal 100 "+this.font;$V=$V.replace($S._fontSizeReg,$O),this.borderColor&&($V+=" 1 "+this.borderColor),this._ctx.font=$V,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$q.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $l=this._ctx.measureText(this.char);$l||($l={width:16});var $T=$l.width+1;this._ctx.lineTo($T,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$O.onresize=function($j,$O){this._w=$j,this._h=$O,this._allowMerageInAtlas=!0},$O.clearAtlasSource=function(){},$l(0,$O,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$l(0,$O,"atlasSource",function(){return this.canvas}),$l(0,$O,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($j){this._enableMerageInAtlas=$j}),$S.createOneChar=function($j,$O){return new $S($j,$O)},$S._fontSizeReg=new RegExp("\\d+(?=px)","g"),$S}(),$Wj=function($j){function $H($j,$O,$V,$l,$T,$S,$m,$p,$o){void 0===$V&&($V=6408),void 0===$l&&($l=5121),void 0===$T&&($T=34041),void 0===$S&&($S=!1),void 0===$m&&($m=!1),void 0===$p&&($p=-1),void 0===$o&&($o=1),$H.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$j,this._h=$O,this._surfaceFormat=$V,this._surfaceType=$l,this._depthStencilFormat=$T,this._mipMap=$S,this._repeat=$m,this._minFifter=$p,this._magFifter=$o}$t($H,"laya.webgl.resource.WebGLRenderTarget",$V);var $O=$H.prototype;return $O.recreateResource=function(){var $j=$Aj.mainContext;this._frameBuffer||(this._frameBuffer=$j.createFramebuffer()),this._source||(this._source=$j.createTexture());var $O=$Zj.curBindTexTarget,$V=$Zj.curBindTexValue;$Zj.bindTexture($j,3553,this._source),$j.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $l=this._minFifter,$T=this._magFifter,$S=this._repeat?10497:33071,$m=$g.isPOT(this._w,this._h);if($m?(this._mipMap?-1!==$l||($l=9987):-1!==$l||($l=9729),-1!==$T||($T=9729),$j.texParameteri(3553,10241,$l),$j.texParameteri(3553,10240,$T),$j.texParameteri(3553,10242,$S),$j.texParameteri(3553,10243,$S),this._mipMap&&$j.generateMipmap(3553)):(-1!==$l||($l=9729),-1!==$T||($T=9729),$j.texParameteri(3553,10241,$l),$j.texParameteri(3553,10240,$T),$j.texParameteri(3553,10242,33071),$j.texParameteri(3553,10243,33071)),$j.bindFramebuffer(36160,this._frameBuffer),$j.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$j.createRenderbuffer()),$j.bindRenderbuffer(36161,this._depthStencilBuffer),$j.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$j.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$j.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$j.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$j.bindFramebuffer(36160,null),$O&&$V&&$Zj.bindTexture($j,$O,$V),$j.bindRenderbuffer(36161,null),$m&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$O.disposeResource=function(){this._frameBuffer&&($Aj.mainContext.deleteTexture(this._source),$Aj.mainContext.deleteFramebuffer(this._frameBuffer),$Aj.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$l(0,$O,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$l(0,$O,"frameBuffer",function(){return this._frameBuffer}),$H}(),$Kj=function($j){function $p($j,$O,$V,$l,$T,$S,$m){this.offsetX=0,this.offsetY=0,$p.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$S,this.canvas=$j,this._ctx=$j.getContext("2d",void 0),this._w=$l,this._h=$T,this.offsetX=$O,this.offsetY=$V,this.src=$m,this._enableMerageInAtlas=!0,$X.enabled&&this._w<$X.atlasLimitWidth&&this._h<$X.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$t($p,"laya.webgl.resource.WebGLSubImage",$V);var $O=$p.prototype;return $x.imps($O,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$O.size=function($j,$O){this._w=$j,this._h=$O,this._ctx&&this._ctx.size($j,$O),this.canvas&&(this.canvas.height=$O,this.canvas.width=$j)},$O.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$O.createWebGlTexture=function(){var $j=$Aj.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $O=this._source=$j.createTexture(),$V=$Zj.curBindTexTarget,$l=$Zj.curBindTexValue;$Zj.bindTexture($j,3553,$O),$j.pixelStorei(37441,!0),$j.texImage2D(3553,0,6408,6408,5121,this.canvas),$j.pixelStorei(37441,!1);var $T=this.minFifter,$S=this.magFifter,$m=this.repeat?10497:33071,$p=$g.isPOT(this.width,this.height);$p?(this.mipmap?-1!==$T||($T=9987):-1!==$T||($T=9729),-1!==$S||($S=9729),$j.texParameteri(3553,10240,$S),$j.texParameteri(3553,10241,$T),$j.texParameteri(3553,10242,$m),$j.texParameteri(3553,10243,$m),this.mipmap&&$j.generateMipmap(3553)):(-1!==$T||($T=9729),-1!==$S||($S=9729),$j.texParameteri(3553,10241,$T),$j.texParameteri(3553,10240,$S),$j.texParameteri(3553,10242,33071),$j.texParameteri(3553,10243,33071)),$V&&$l&&$Zj.bindTexture($j,$V,$l),this.canvas=null,$p&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$O.disposeResource=function(){$X.enabled&&this._allowMerageInAtlas||!this._source||($Aj.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$O.clearAtlasSource=function(){},$l(0,$O,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$l(0,$O,"atlasSource",function(){return this.canvas}),$l(0,$O,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($j){this._allowMerageInAtlas=$j}),$p}(),$dj=function($j){function $H($j,$O,$V,$l){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$H.__super.call(this),!$j||!$O)throw"Shader Error";this._id=++$H._count,this._vs=$j,this._ps=$O,this._nameMap=$l||{},null!=$V&&($H.sharders[$V]=this)}$t($H,"laya.webgl.shader.Shader",$kj);var $O=$H.prototype;return $O.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$O.disposeResource=function(){$Aj.mainContext.deleteShader(this._vshader),$Aj.mainContext.deleteShader(this._pshader),$Aj.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$O._compile=function(){if(!$Aj.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $j=[this._vs,this._ps],$O=$Aj.mainContext;if(this._program=$O.createProgram(),this._vshader=$H._createShader($O,$j[0],35633),this._pshader=$H._createShader($O,$j[1],35632),$O.attachShader(this._program,this._vshader),$O.attachShader(this._program,this._pshader),$O.linkProgram(this._program),!$h.isConchApp&&!$O.getProgramParameter(this._program,35714))throw $O.getProgramInfoLog(this._program);var $V,$l,$T=0,$S=0;for($S=$h.isConchApp?$O.getProgramParameterEx(this._vs,this._ps,"",35721):$O.getProgramParameter(this._program,35721),$T=0;$T<$S;$T++){var $m=null;$V={vartype:"attribute",glfun:null,ivartype:0,attrib:$m=$h.isConchApp?$O.getActiveAttribEx(this._vs,this._ps,"",$T):$O.getActiveAttrib(this._program,$T),location:$O.getAttribLocation(this._program,$m.name),name:$m.name,type:$m.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($V)}var $p=0;for($p=$h.isConchApp?$O.getProgramParameterEx(this._vs,this._ps,"",35718):$O.getProgramParameter(this._program,35718),$T=0;$T<$p;$T++){var $o=null;$o=$h.isConchApp?$O.getActiveUniformEx(this._vs,this._ps,"",$T):$O.getActiveUniform(this._program,$T),0<($V={vartype:"uniform",glfun:null,ivartype:1,attrib:$m,location:$O.getUniformLocation(this._program,$o.name),name:$o.name,type:$o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($V.name=$V.name.substr(0,$V.name.length-3),$V.isArray=!0,$V.location=$O.getUniformLocation(this._program,$V.name)),this._params.push($V)}for($T=0,$l=this._params.length;$T<$l;$T++)if(($V=this._params[$T]).indexOfParams=$T,$V.index=1,$V.value=[$V.location,null],$V.codename=$V.name,$V.name=this._nameMap[$V.codename]?this._nameMap[$V.codename]:$V.codename,(this._paramsMap[$V.name]=$V)._this=this,$V.uploadedValue=[],"attribute"!==$V.vartype)switch($V.type){case 5124:$V.fun=$V.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$V.fun=$V.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$V.fun=$V.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$V.fun=$V.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$V.fun=$V.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$V.fun=this._uniform_sampler2D;break;case 35680:$V.fun=this._uniform_samplerCube;break;case 35676:$V.glfun=$O.uniformMatrix4fv,$V.fun=this._uniformMatrix4fv;break;case 35670:$V.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $V.fun=this._attribute}},$O.getUniform=function($j){return this._paramsMap[$j]},$O._attribute=function($j,$O){var $V=$Aj.mainContext,$l=$Gj._enableAtributes,$T=$j.location;return $l[$T]||$V.enableVertexAttribArray($T),$V.vertexAttribPointer($T,$O[0],$O[1],$O[2],$O[3],$O[4]+this._offset),$l[$T]=$Gj._bindVertexBuffer,1},$O._uniform1f=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O?($Aj.mainContext.uniform1f($j.location,$V[0]=$O),1):0},$O._uniform1fv=function($j,$O){if($O.length<4){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($Aj.mainContext.uniform1fv($j.location,$O),$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3],1):0}return $Aj.mainContext.uniform1fv($j.location,$O),1},$O._uniform_vec2=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]?($Aj.mainContext.uniform2f($j.location,$V[0]=$O[0],$V[1]=$O[1]),1):0},$O._uniform_vec2v=function($j,$O){if($O.length<2){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($Aj.mainContext.uniform2fv($j.location,$O),$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3],1):0}return $Aj.mainContext.uniform2fv($j.location,$O),1},$O._uniform_vec3=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]?($Aj.mainContext.uniform3f($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2]),1):0},$O._uniform_vec3v=function($j,$O){return $Aj.mainContext.uniform3fv($j.location,$O),1},$O._uniform_vec4=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($Aj.mainContext.uniform4f($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3]),1):0},$O._uniform_vec4v=function($j,$O){return $Aj.mainContext.uniform4fv($j.location,$O),1},$O._uniformMatrix2fv=function($j,$O){return $Aj.mainContext.uniformMatrix2fv($j.location,!1,$O),1},$O._uniformMatrix3fv=function($j,$O){return $Aj.mainContext.uniformMatrix3fv($j.location,!1,$O),1},$O._uniformMatrix4fv=function($j,$O){return $Aj.mainContext.uniformMatrix4fv($j.location,!1,$O),1},$O._uniform1i=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O?($Aj.mainContext.uniform1i($j.location,$V[0]=$O),1):0},$O._uniform1iv=function($j,$O){return $Aj.mainContext.uniform1iv($j.location,$O),1},$O._uniform_ivec2=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]?($Aj.mainContext.uniform2i($j.location,$V[0]=$O[0],$V[1]=$O[1]),1):0},$O._uniform_ivec2v=function($j,$O){return $Aj.mainContext.uniform2iv($j.location,$O),1},$O._uniform_vec3i=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]?($Aj.mainContext.uniform3i($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2]),1):0},$O._uniform_vec3vi=function($j,$O){return $Aj.mainContext.uniform3iv($j.location,$O),1},$O._uniform_vec4i=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($Aj.mainContext.uniform4i($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3]),1):0},$O._uniform_vec4vi=function($j,$O){return $Aj.mainContext.uniform4iv($j.location,$O),1},$O._uniform_sampler2D=function($j,$O){var $V=$Aj.mainContext,$l=$j.uploadedValue;return null==$l[0]?($l[0]=this._curActTexIndex,$V.uniform1i($j.location,this._curActTexIndex),$V.activeTexture($H._TEXTURES[this._curActTexIndex]),$Zj.bindTexture($V,3553,$O),this._curActTexIndex++,1):($V.activeTexture($H._TEXTURES[$l[0]]),$Zj.bindTexture($V,3553,$O),0)},$O._uniform_samplerCube=function($j,$O){var $V=$Aj.mainContext,$l=$j.uploadedValue;return null==$l[0]?($l[0]=this._curActTexIndex,$V.uniform1i($j.location,this._curActTexIndex),$V.activeTexture($H._TEXTURES[this._curActTexIndex]),$Zj.bindTexture($V,34067,$O),this._curActTexIndex++,1):($V.activeTexture($H._TEXTURES[$l[0]]),$Zj.bindTexture($V,34067,$O),0)},$O._noSetValue=function($j){console.log("no....:"+$j.name)},$O.uploadOne=function($j,$O){this.activeResource(),$Zj.UseProgram(this._program);var $V=this._paramsMap[$j];$V.fun.call(this,$V,$O)},$O.uploadTexture2D=function($j){$v.shaderCall++;var $O=$Aj.mainContext;$O.activeTexture(33984),$Zj.bindTexture($O,3553,$j)},$O.uploadTexture2D1=function($j){$v.shaderCall++;var $O=$Aj.mainContext;$O.activeTexture(33985),$Zj.bindTexture($O,3553,$j)},$O.upload=function($j,$O){$kj.activeShader=$kj.bindShader=this,this._lastUseFrameCount===$v.loopCount||this.activeResource(),$Zj.UseProgram(this._program),this._reCompile?($O=this._params,this._reCompile=!1):$O=$O||this._params;$Aj.mainContext;for(var $V,$l,$T=$O.length,$S=0,$m=0;$m<$T;$m++)null!==($l=$j[($V=$O[$m]).name])&&($S+=$V.fun.call(this,$V,$l));$v.shaderCall+=$S},$O.uploadArray=function($j,$O,$V){$kj.activeShader=this,($kj.bindShader=this).activeResource(),$Zj.UseProgram(this._program);this._params;for(var $l,$T,$S=0,$m=$O-2;0<=$m;$m-=2)($T=this._paramsMap[$j[$m]])&&null!=($l=$j[$m+1])&&($V&&$V[$T.name]&&$V[$T.name].bind(),$S+=$T.fun.call(this,$T,$l));$v.shaderCall+=$S},$O.getParams=function(){return this._params},$H.getShader=function($j){return $H.sharders[$j]},$H.create=function($j,$O,$V,$l){return new $H($j,$O,$V,$l)},$H.withCompile=function($j,$O,$V,$l){if($V&&$H.sharders[$V])return $H.sharders[$V];var $T=$H._preCompileShader[2e-4*$j];if(!$T)throw new Error("withCompile shader err!"+$j);return $T.createShader($O,$V,$l)},$H.withCompile2D=function($j,$O,$V,$l,$T){if($l&&$H.sharders[$l])return $H.sharders[$l];var $S=$H._preCompileShader[2e-4*$j+$O];if(!$S)throw new Error("withCompile shader err!"+$j+" "+$O);return $S.createShader($V,$l,$T)},$H.addInclude=function($j,$O){$cj.addInclude($j,$O)},$H.preCompile=function($j,$O,$V,$l){var $T=2e-4*$j;$H._preCompileShader[$T]=new $cj($T,$O,$V,$l)},$H.preCompile2D=function($j,$O,$V,$l,$T){var $S=2e-4*$j+$O;$H._preCompileShader[$S]=new $cj($S,$V,$l,$T)},$H._createShader=function($j,$O,$V){var $l=$j.createShader($V);return $j.shaderSource($l,$O),$j.compileShader($l),$l},$H._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$H._count=0,$H._preCompileShader={},$H.SHADERNAME2ID=2e-4,$H.sharders=(($H.sharders=[]).length=32,$H.sharders),$m($H,["nameKey",function(){return this.nameKey=new $Y}]),$H}(),$Lj=function($j){function $O(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$O.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$t($O,"laya.webgl.utils.Buffer2D",$j);var $V=$O.prototype;return $V.needSize=function($j){var $O=this._byteLength;if($j){var $V=this._byteLength+$j;$V<=this._buffer.byteLength||this._resizeBuffer($V<<1,!0),this._byteLength=$V}return $O},$V._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$v.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$Gj._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$Gj._gl.bufferSubData(this._bufferType,0,this._buffer)},$V._bufferSubData=function($j,$O,$V){if(void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$v.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$Gj._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$O||$V){var $l=this._buffer.slice($O,$V);$Gj._gl.bufferSubData(this._bufferType,$j,$l)}else $Gj._gl.bufferSubData(this._bufferType,$j,this._buffer)},$V._checkArrayUse=function(){},$V._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$V._bind_subUpload=function($j,$O,$V){return void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($j,$O,$V),!0)},$V._resizeBuffer=function($j,$O){if($j<this._buffer.byteLength)return this;if(this.memorySize=$j,$O&&this._buffer&&0<this._buffer.byteLength){var $V=new ArrayBuffer($j);new Uint8Array($V).set(new Uint8Array(this._buffer),0),this._buffer=$V}else this._buffer=new ArrayBuffer($j);return this._checkArrayUse(),this._upload=!0,this},$V.append=function($j){this._upload=!0;var $O,$V;$O=$j.byteLength,$j instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$O,!0),$V=new Uint8Array(this._buffer,this._byteLength)):$j instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$O,!0),$V=new Uint16Array(this._buffer,this._byteLength)):$j instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$O,!0),$V=new Float32Array(this._buffer,this._byteLength)),$V.set($j,0),this._byteLength+=$O,this._checkArrayUse()},$V.appendU16Array=function($j,$O){this._resizeBuffer(this._byteLength+2*$O,!0);for(var $V=new Uint16Array(this._buffer,this._byteLength,$O),$l=0;$l<$O;$l++)$V[$l]=$j[$l];this._byteLength+=2*$O,this._checkArrayUse()},$V.appendEx=function($j,$O){this._upload=!0;var $V;$V=$j.byteLength,this._resizeBuffer(this._byteLength+$V,!0),new $O(this._buffer,this._byteLength).set($j,0),this._byteLength+=$V,this._checkArrayUse()},$V.appendEx2=function($j,$O,$V,$l){void 0===$l&&($l=1),this._upload=!0;var $T,$S;$T=$V*$l,this._resizeBuffer(this._byteLength+$T,!0),$S=new $O(this._buffer,this._byteLength);var $m=0;for($m=0;$m<$V;$m++)$S[$m]=$j[$m];this._byteLength+=$T,this._checkArrayUse()},$V.getBuffer=function(){return this._buffer},$V.setNeedUpload=function(){this._upload=!0},$V.getNeedUpload=function(){return this._upload},$V.upload=function(){var $j=this._bind_upload();return $Gj._gl.bindBuffer(this._bufferType,null),$Gj._bindActive[this._bufferType]=null,$kj.activeShader=null,$j},$V.subUpload=function($j,$O,$V){void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0);var $l=this._bind_subUpload();return $Gj._gl.bindBuffer(this._bufferType,null),$Gj._bindActive[this._bufferType]=null,$kj.activeShader=null,$l},$V.disposeResource=function(){$j.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$V.clear=function(){this._byteLength=0,this._upload=!0},$l(0,$V,"bufferLength",function(){return this._buffer.byteLength}),$l(0,$V,"byteLength",null,function($j){this._byteLength!==$j&&($j<=this._buffer.byteLength||this._resizeBuffer(2*$j+256,!0),this._byteLength=$j)}),$O.__int__=function($j){$Ij.QuadrangleIB=$Ij.create(35044),$rj.fillIBQuadrangle($Ij.QuadrangleIB,16)},$O.FLOAT32=4,$O.SHORT=2,$O}($Gj),$Qj=(function($O){function $V($j){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$V.__super.call(this,9)}$t($V,"laya.webgl.shader.d2.value.GlowSV",$O);var $j=$V.prototype;$j.setValue=function($j){$O.prototype.setValue.call(this,$j)},$j.clear=function(){$O.prototype.clear.call(this)}}($fj),function($j){function $O($j){$O.__super.call(this,64),this.defines.add(64)}$t($O,"laya.webgl.shader.d2.value.TextSV",$j);var $V=$O.prototype;return $V.release=function(){($O.pool[$O._length++]=this).clear()},$V.clear=function(){$j.prototype.clear.call(this)},$O.create=function(){return $O._length?$O.pool[--$O._length]:new $O(null)},$O.pool=[],$O._length=0,$O}($fj)),$Dj=function($j){function $T($j,$O,$V,$l){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$T.__super.call(this,$j,$O,$V,$l)}$t($T,"laya.webgl.shader.d2.Shader2X",$j);var $O=$T.prototype;return $O.upload2dQuick1=function($j){this.upload($j,this._params2dQuick1||this._make2dQuick1())},$O._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $j,$O=this._params,$V=0,$l=$O.length;$V<$l;$V++)$j=$O[$V],($h.isFlash||"size"!==$j.name&&"position"!==$j.name&&"texcoord"!==$j.name)&&this._params2dQuick1.push($j)}return this._params2dQuick1},$O.disposeResource=function(){$j.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$O.upload2dQuick2=function($j){this.upload($j,this._params2dQuick2||this._make2dQuick2())},$O._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $j,$O=this._params,$V=0,$l=$O.length;$V<$l;$V++)$j=$O[$V],($h.isFlash||"size"!==$j.name)&&this._params2dQuick2.push($j)}return this._params2dQuick2},$T.create=function($j,$O,$V,$l){return new $T($j,$O,$V,$l)},$T}($dj),$Ij=function($j){function $O($j){this._uint8Array=null,this._uint16Array=null,void 0===$j&&($j=35044),$O.__super.call(this),this._bufferUsage=$j,this._bufferType=34963,$h.isFlash||(this._buffer=new ArrayBuffer(8))}$t($O,"laya.webgl.utils.IndexBuffer2D",$Lj);var $V=$O.prototype;return $V._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$V.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$V.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$V.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$O.QuadrangleIB=null,$O.create=function($j){return void 0===$j&&($j=35044),new $O($j)},$O}(),$Pj=function($j){function $V($j,$O){this._floatArray32=null,this._vertexStride=0,$V.__super.call(this),this._vertexStride=$j,this._bufferUsage=$O,this._bufferType=34962,$h.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$t($V,"laya.webgl.utils.VertexBuffer2D",$j);var $O=$V.prototype;return $O.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$O.bind=function($j){$j&&$j._bind(),this._bind()},$O.insertData=function($j,$O){this.getFloat32Array().set($j,$O),this._upload=!0},$O.bind_upload=function($j){$j._bind_upload()||$j._bind(),this._bind_upload()||this._bind()},$O._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$O.disposeResource=function(){$j.prototype.disposeResource.call(this)},$O.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$l(0,$O,"vertexStride",function(){return this._vertexStride}),$V.create=function($j,$O){return void 0===$O&&($O=35048),new $V($j,$O)},$V}($Lj),$jO=function($j){function $p($j,$O,$V,$l,$T,$S){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$V&&($V=6408),void 0===$l&&($l=!0),$p.__super.call(this,$j,$O),$j){if(this._format=$V,this._mipmap=$l,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $j)this._url=$j,this._src=$j,this._image=new $w.window.Image,$O&&($O.onload&&(this.onload=$O.onload),$O.onerror&&(this.onerror=$O.onerror),$O.onCreate&&$O.onCreate(this)),this._image.crossOrigin=$j&&0==$j.indexOf("data:")?null:"",$j&&(this._image.src=$j);else if($j instanceof ArrayBuffer){this._src=$O,this._url=this._src;var $m=new $o($j);$m.readUTFBytes(4),$m.readUTFBytes(2),$m.getInt16();$m.endian="bigEndian",this._w=$m.getInt16(),this._h=$m.getInt16();$m.getInt16(),$m.getInt16();this._image=new Uint8Array($j,$m.pos),this._format=$Aj.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$X.enabled&&this._w<$X.atlasLimitWidth&&this._h<$X.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($j instanceof Uint8Array))return this._src=$O,this._url=this._src,this._image=$j.source||$j,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$O,this._url=this._src,this._w=$T,this._h=$S,this._image=$j,this._format=0===$V?$j.byteLength/($T*$S)==4?6408:6407:$V}this._$5__enableMerageInAtlas=!0}}$t($p,"laya.webgl.resource.WebGLImage",$b);var $O=$p.prototype;return $x.imps($O,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$O._init_=function($j,$O){},$O._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $j=$Aj.mainContext,$O=this._source=$j.createTexture(),$V=$Zj.curBindTexTarget,$l=$Zj.curBindTexValue;$Zj.bindTexture($j,3553,$O);var $T=this.minFifter,$S=this.magFifter,$m=this.repeat?10497:33071,$p=$g.isPOT(this._w,this._h),$o=!1;switch($p?(this.mipmap?-1!==$T||($T=9987):-1!==$T||($T=9729),-1!==$S||($S=9729),$j.texParameteri(3553,10241,$T),$j.texParameteri(3553,10240,$S),$j.texParameteri(3553,10242,$m),$j.texParameteri(3553,10243,$m),this.mipmap&&$j.generateMipmap(3553)):(-1!==$T||($T=9729),-1!==$S||($S=9729),$j.texParameteri(3553,10241,$T),$j.texParameteri(3553,10240,$S),$j.texParameteri(3553,10242,33071),$j.texParameteri(3553,10243,33071)),$j.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$j.pixelStorei($j.UNPACK_ALIGNMENT,1),$j.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$j.pixelStorei($j.UNPACK_ALIGNMENT,1),$j.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$o=!0,$j.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $Aj.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$o=!0,$j.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$j.pixelStorei(37441,!1),$V&&$l&&$Zj.bindTexture($j,$V,$l),this.uri||(this.uri=this._url),$o?this.memorySize=this._image.length:$p&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$O.recreateResource=function(){var $j=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $O=this;this._image=new $w.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($O._needReleaseAgain)return $O._needReleaseAgain=!1,$O._image.onload=null,void($O._image=null);$O._allowMerageInAtlas&&$O._enableMerageInAtlas?($j.memorySize=0,$j._recreateLock=!1):$O._createWebGlTexture(),$O.completeCreate()},this._image.src=this._src}},$O.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$Aj.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$O.onresize=function(){this._w=this._image.width,this._h=this._image.height,$X.enabled&&this._w<$X.atlasLimitWidth&&this._h<$X.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$O.clearAtlasSource=function(){this._image=null},$l(0,$O,"format",function(){return this._format}),$l(0,$O,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($j){this._$5__enableMerageInAtlas=$j}),$l(0,$O,"mipmap",function(){return this._mipmap}),$l(0,$O,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$l(0,$O,"atlasSource",function(){return this._image}),$l(0,$O,"onload",null,function($j){var $O=this;this._onload=$j,this._image&&(this._image.onload=null!=this._onload?function(){$O.onresize(),$O._onload()}:null)}),$l(0,$O,"onerror",null,function($j){var $O=this;this._onerror=$j,this._image&&(this._image.onerror=null!=this._onerror?function(){$O._onerror()}:null)}),$p}();$x.__init([$wj,$N,$Ej,$cj])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($j,$O){"use strict";for(var $V in Object.defineProperty($O,"__esModule",{value:!0}),Laya){var $l=Laya[$V];$l&&$l.__isclass&&($O[$V]=$l)}}),function($S,$j,$l){$l.un,$l.uns;var $T=$l.static,$m=$l.class,$p=$l.getset,$o=($l.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$s=laya.utils.ClassUtils,$e=(laya.events.Event,laya.utils.HTMLChar),$H=laya.net.Loader,$g=(laya.display.Node,laya.maths.Rectangle),$t=laya.renders.Render,$w=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$b=laya.utils.Stat,$k=laya.display.Text,$r=laya.resource.Texture,$h=laya.net.URL,$a=laya.utils.Utils,$c=function(){function $w(){}return $m($w,"laya.html.utils.HTMLParse"),$w.parse=function($j,$O,$V){$O=($O="<root>"+($O=$O.replace(/<br>/g,"<br/>"))+"</root>").replace($w.spacePattern,$w.char255);var $l=$a.parseXMLFromString($O);$w._parseXML($j,$l.childNodes[0].childNodes,$V)},$w._parseXML=function($j,$O,$V,$l){var $T=0,$S=0;if($O.join||$O.item)for($T=0,$S=$O.length;$T<$S;++$T)$w._parseXML($j,$O[$T],$V,$l);else{var $m,$p,$o;if(3==$O.nodeType)return void($j instanceof laya.html.dom.HTMLDivElement?(null==$O.nodeName&&($O.nodeName="#text"),$p=$O.nodeName.toLowerCase(),0<($o=$O.textContent.replace(/^\s+|\s+$/g,"")).length&&($m=$s.getInstance($p))&&($j.addChild($m),$m.innerTEXT=$o.replace($w.char255AndOneSpacePattern," "))):0<($o=$O.textContent.replace(/^\s+|\s+$/g,"")).length&&($j.innerTEXT=$o.replace($w.char255AndOneSpacePattern," ")));if("#comment"==($p=$O.nodeName.toLowerCase()))return;if($m=$s.getInstance($p)){($m=$j.addChild($m)).URI=$V,$m.href=$l;var $H=$O.attributes;if($H&&0<$H.length)for($T=0,$S=$H.length;$T<$S;++$T){var $g=$H[$T],$e=$g.nodeName,$t=$g.value;$m._setAttributes($e,$t)}$w._parseXML($m,$O.childNodes,$V,$m.href)}else $w._parseXML($j,$O.childNodes,$V,$l)}},$w.char255=String.fromCharCode(255),$w.spacePattern=/&nbsp;|&#160;/g,$w.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$w}(),$A=function(){function $i(){}return $m($i,"laya.html.utils.Layout"),$i.later=function($j){null==$i._will&&($i._will=[],$l.stage.frameLoop(1,null,function(){if(!($i._will.length<1)){for(var $j=0;$j<$i._will.length;$j++)laya.html.utils.Layout.layout($i._will[$j]);$i._will.length=0}})),$i._will.push($j)},$i.layout=function($j){if(!$j||!$j._style)return null;if(0==(512&$j._style._type))return null;$j.getStyle()._type&=-513;var $O=$i._multiLineLayout($j);return $t.isConchApp&&$j.layaoutCallNative&&$j.layaoutCallNative(),$O},$i._multiLineLayout=function($j){if($k.RightToLeft)return $i._multiLineLayout2($j);var $O=new Array;$j._addChildsToLayout($O);var $V,$l,$T,$S,$m,$p=0,$o=$O.length,$H=$j._getCSSStyle(),$g=$H.letterSpacing,$e=$H.leading,$t=$H.lineHeight,$w=$H._widthAuto()||!$H.wordWrap,$s=$w?999999:$j.width,$b=($j.height,0),$r=$H.italic?$H.fontSize/3:0,$h=$H._getAlign(),$a=$H._getValign(),$c=0!==$a||0!==$h||0!=$t,$A=0,$Z=0,$x=0,$E=0,$U=new Array,$z=$U[0]=new $n,$$=!1,$_=!1;$z.h=0,$H.italic&&($s-=$H.fontSize/3);var $B=0,$M=!0;function $v(){$z.y=$Z,$Z+=$z.h+$e,0==$z.h&&($Z+=$t),$z.mWidth=$B,$B=0,$z=new $n,$U.push($z),$z.h=0,$$=!($M=!($A=0))}for($p=0;$p<$o;$p++)if(null!=($V=$O[$p]))if($M=!1,$V instanceof laya.html.dom.HTMLBrElement)$v(),$z.y=$Z;else{if($V._isChar()){if(($S=$V).isWord)$$=$_||"\n"===$S.char,$z.wordStartIndex=$z.elements.length;else{if($x=$S.width+$S.style.letterSpacin,0<$U.length&&$s<$A+$x&&0<$z.wordStartIndex){var $Y;$Y=$z.elements.length-$z.wordStartIndex+1,$z.elements.length=$z.wordStartIndex,$p-=$Y,$v();continue}$$=!1,$B+=$S.width}$x=$S.width+$g,$E=$S.height,$_=!1,($$=$$||$s<$A+$x)&&$v(),$z.minTextHeight=Math.min($z.minTextHeight,$V.height)}else $l=$V._getCSSStyle(),$m=$V,$T=$l.padding,0===$l._getCssFloat()||($c=!0),$$=$_||$l.lineElement,$x=$m.width*$m._style._tf.scaleX+$T[1]+$T[3]+$g,$E=$m.height*$m._style._tf.scaleY+$T[0]+$T[2],$_=$l.lineElement,($$=$$||$s<$A+$x&&$l.wordWrap)&&$v();$z.elements.push($V),$z.h=Math.max($z.h,$E),$V.x=$A,$V.y=$Z,$A+=$x,$z.w=$A-$g,$z.y=$Z,$b=Math.max($A+$r,$b)}else $M||($A+=$i.DIV_ELEMENT_PADDING),$z.wordStartIndex=$z.elements.length;if($Z=$z.y+$z.h,$c){var $R=0,$q=$s;for($w&&0<$j.width&&($q=$j.width),$p=0,$o=$U.length;$p<$o;$p++)$U[$p].updatePos(0,$q,$p,$R,$h,$a,$t),$R+=Math.max($t,$U[$p].h+$e);$Z=$R}return $w&&($j.width=$b),$Z>$j.height&&($j.height=$Z),[$b,$Z]},$i._multiLineLayout2=function($j){var $O=new Array;$j._addChildsToLayout($O);var $V,$l,$T,$S,$m,$p=0,$o=$O.length,$H=$j._getCSSStyle(),$g=$H.letterSpacing,$e=$H.leading,$t=$H.lineHeight,$w=$H._widthAuto()||!$H.wordWrap,$s=$w?999999:$j.width,$b=($j.height,0),$r=$H.italic?$H.fontSize/3:0,$h=2-$H._getAlign(),$a=$H._getValign(),$c=0!==$a||0!=$h||0!=$t,$A=0,$Z=0,$x=0,$E=0,$U=new Array,$z=$U[0]=new $n,$$=!1,$_=!1;$z.h=0,$H.italic&&($s-=$H.fontSize/3);var $B=0,$M=!0;function $v(){$z.y=$Z,$Z+=$z.h+$e,0==$z.h&&($Z+=$t),$z.mWidth=$B,$B=0,$z=new $n,$U.push($z),$z.h=0,$$=!($M=!($A=0))}for($p=0;$p<$o;$p++)if(null!=($V=$O[$p]))if($M=!1,$V instanceof laya.html.dom.HTMLBrElement)$v(),$z.y=$Z;else{if($V._isChar()){if(($S=$V).isWord)$$=$_||"\n"===$S.char,$z.wordStartIndex=$z.elements.length;else{if(0<$U.length&&$s<$A+$x&&0<$z.wordStartIndex){var $Y;$Y=$z.elements.length-$z.wordStartIndex+1,$z.elements.length=$z.wordStartIndex,$p-=$Y,$v();continue}$$=!1,$B+=$S.width}$x=$S.width+$g,$E=$S.height,$_=!1,($$=$$||$s<$A+$x)&&$v(),$z.minTextHeight=Math.min($z.minTextHeight,$V.height)}else $l=$V._getCSSStyle(),$m=$V,$T=$l.padding,0===$l._getCssFloat()||($c=!0),$$=$_||$l.lineElement,$x=$m.width*$m._style._tf.scaleX+$T[1]+$T[3]+$g,$E=$m.height*$m._style._tf.scaleY+$T[0]+$T[2],$_=$l.lineElement,($$=$$||$s<$A+$x&&$l.wordWrap)&&$v();$z.elements.push($V),$z.h=Math.max($z.h,$E),$V.x=$A,$V.y=$Z,$A+=$x,$z.w=$A-$g,$z.y=$Z,$b=Math.max($A+$r,$b)}else $M||($A+=$i.DIV_ELEMENT_PADDING),$z.wordStartIndex=$z.elements.length;if($Z=$z.y+$z.h,$c){var $R=0,$q=$s;for($p=0,$o=$U.length;$p<$o;$p++)$U[$p].updatePos(0,$q,$p,$R,$h,$a,$t),$R+=Math.max($t,$U[$p].h+$e);$Z=$R}for($w&&($j.width=$b),$Z>$j.height&&($j.height=$Z),$p=0,$o=$U.length;$p<$o;$p++)$U[$p].revertOrder($s);return[$b,$Z]},$i._will=null,$i.DIV_ELEMENT_PADDING=0,$i}(),$n=function(){function $j(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$m($j,"laya.html.utils.LayoutLine");var $O=$j.prototype;return $O.updatePos=function($j,$O,$V,$l,$T,$S,$m){var $p,$o=0;0<this.elements.length&&($o=($p=this.elements[this.elements.length-1]).x+$p.width-this.elements[0].x);var $H=0,$g=NaN;1===$T&&($H=($O-$o)/2),2===$T&&($H=$O-$o),0===$m||0!=$S||($S=1);for(var $e=0,$t=this.elements.length;$e<$t;$e++){var $w=($p=this.elements[$e])._getCSSStyle();switch(0!==$H&&($p.x+=$H),$w._getValign()){case 0:$p.y=$l;break;case 1:var $s=0;99999!=this.minTextHeight&&($s=this.minTextHeight);var $b=($s+$m)/2;$b=Math.max($b,this.h),$g=(laya.html.dom.HTMLImageElement,$l+$b-$p.height),$p.y=$g;break;case 2:$p.y=$l+($m-$p.height)}}},$O.revertOrder=function($j){var $O;if(0<this.elements.length){var $V,$l=0;for($V=this.elements.length,$l=0;$l<$V;$l++)($O=this.elements[$l]).x=$j-$O.x-$O.width}},$j}(),$Z=function($V){function $O(){this.URI=null,this._href=null,$O.__super.call(this),this._text=$O._EMPTYTEXT,this.setStyle(new $o(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$m($O,"laya.html.dom.HTMLElement",$V);var $j=$O.prototype;return $j.layaoutCallNative=function(){var $j=0;if(this._childs&&0<($j=this._childs.length))for(var $O=0;$O<$j;$O++)this._childs[$O].layaoutCallNative&&this._childs[$O].layaoutCallNative();var $V=this._getWords();$V?laya.html.dom.HTMLElement.fillWords(this,$V,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$j.appendChild=function($j){return this.addChild($j)},$j._getWords2=function(){var $j=this._text.text;if(!$j||0===$j.length)return null;var $O,$V,$l=0,$T=0;if(this._text.drawWords)$V=this._text.drawWords;else{for($T=($O=$j.split(" ")).length-1,$V=[],$l=0;$l<$T;$l++)$V.push($O[$l]," ");0<=$T&&$V.push($O[$T]),this._text.drawWords=$V}var $S,$m=this._text.words;if($m&&$m.length===$V.length)return $m;null===$m&&(this._text.words=$m=[]),$m.length=$V.length;var $p=this.style,$o=$p.font;for($l=0,$T=$V.length;$l<$T;$l++){$S=$a.measureText($V[$l],$o);var $H=$m[$l]=new $e($V[$l],$S.width,$S.height||$p.fontSize,$p);if(1<$H.char.length&&($H.charNum=$H.char),this.href){var $g=new $w;this.addChild($g),$H.setSprite($g)}}return $m},$j._getWords=function(){if(!$k.CharacterCache)return this._getWords2();var $j=this._text.text;if(!$j||0===$j.length)return null;var $O,$V=this._text.words;if($V&&$V.length===$j.length)return $V;null===$V&&(this._text.words=$V=[]),$V.length=$j.length;for(var $l=this.style,$T=$l.font,$S=0,$m=$j.length;$S<$m;$S++)if($O=$a.measureText($j.charAt($S),$T)){var $p=$V[$S]=new $e($j.charAt($S),$O.width,$O.height||$l.fontSize,$l);if(this.href){var $o=new $w;this.addChild($o),$p.setSprite($o)}}else console.warn("_getWords size is null"+$j.charAt($S),$T);return $V},$j.showLinkSprite=function(){var $j=this._text.words;if($j)for(var $O,$V,$l=[],$T=0;$T<$j.length;$T++)$V=$j[$T],($O=new $w).graphics.drawRect(0,0,$V.width,$V.height,"#ff0000"),$O.width=$V.width,$O.height=$V.height,this.addChild($O),$l.push($O)},$j._layoutLater=function(){var $j=this.style;512&$j._type||($j.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$j.block?($A.later(this),$j._type|=512):this.parent&&this.parent._layoutLater())},$j._setAttributes=function($j,$O){switch($j){case"style":return void this.style.cssText($O);case"class":return void(this.className=$O)}$V.prototype._setAttributes.call(this,$j,$O)},$j.updateHref=function(){if(null!=this._href){var $j=this._getWords();if($j)for(var $O,$V,$l=0;$l<$j.length;$l++)($V=($O=$j[$l]).getSprite())&&($V.size($O.width,$O.height),$V.on("click",this,this.onLinkHandler))}},$j.onLinkHandler=function($j){switch($j.type){case"click":for(var $O=this;$O;)$O.event("link",[this.href]),$O=$O.parent}},$j.formatURL=function($j){return this.URI?$h.formatURL($j,this.URI?this.URI.path:null):$j},$p(0,$j,"href",function(){return this._href},function($j){null!=(this._href=$j)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$p(0,$j,"color",null,function($j){this.style.color=$j}),$p(0,$j,"onClick",null,function($j){$l._runScript("fn=function(event){"+$j+";}"),this.on("click",this,void 0)}),$p(0,$j,"id",null,function($j){$x.document.setElementById($j,this)}),$p(0,$j,"innerTEXT",function(){return this._text.text},function($j){this.text=$j}),$p(0,$j,"style",function(){return this._style}),$p(0,$j,"text",function(){return this._text.text},function($j){this._text==$O._EMPTYTEXT?this._text={text:$j,words:null}:(this._text.text=$j,this._text.words&&(this._text.words.length=0)),$t.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$p(0,$j,"parent",$V.prototype._$get_parent,function($j){if($j instanceof laya.html.dom.HTMLElement){var $O=$j;this.URI||(this.URI=$O.URI),this.style.inherit($O.style)}$l.superSet($w,this,"parent",$j)}),$p(0,$j,"className",null,function($j){this.style.attrs($x.document.styleSheets["."+$j])}),$O.fillWords=function($j,$O,$V,$l,$T,$S,$m){$j.graphics.clear();for(var $p=0,$o=$O.length;$p<$o;$p++){var $H=$O[$p];$j.graphics.fillText($H.char,$H.x+$V,$H.y+$l,$T,$S,"left",$m)}},$O._EMPTYTEXT={text:null,words:null},$O}($w),$O=(function($j){function $O(){$O.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$m($O,"laya.html.dom.HTMLBrElement",$Z)}(),function($j){function $O(){this.contextHeight=NaN,this.contextWidth=NaN,$O.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$m($O,"laya.html.dom.HTMLDivElement",$j);var $V=$O.prototype;return $V.appendHTML=function($j){$c.parse(this,$j,this.URI),this.layout()},$V._addChildsToLayout=function($O){var $j=this._getWords();if(null==$j&&0==this._childs.length)return!1;$j&&$j.forEach(function($j){$O.push($j)});for(var $V=!0,$l=0,$T=this._childs.length;$l<$T;$l++){var $S=this._childs[$l];$V?$V=!1:$O.push(null),$S._addToLayout($O)}return!0},$V._addToLayout=function($j){this.layout()},$V.layout=function(){if(this.style){this.style._type|=512;var $j=$A.layout(this);if($j){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $g);var $O=this._$P.mHtmlBounds;$O.x=$O.y=0,$O.width=this.contextWidth=$j[0],$O.height=this.contextHeight=$j[1],this.setBounds($O)}}},$p(0,$V,"height",function(){return this._height?this._height:this.contextHeight},$j.prototype._$set_height),$p(0,$V,"innerHTML",null,function($j){this.destroyChildren(),this.appendHTML($j)}),$p(0,$V,"width",function(){return this._width?this._width:this.contextWidth},function($j){var $O=!1;$O=0===$j?$j!=this._width:$j!=this.width,$l.superSet($Z,this,"width",$j),$O&&this.layout()}),$O}($Z)),$x=function($j){function $O(){this.all=new Array,this.styleSheets=$o.styleSheets,$O.__super.call(this)}$m($O,"laya.html.dom.HTMLDocument",$Z);var $V=$O.prototype;return $V.getElementById=function($j){return this.all[$j]},$V.setElementById=function($j,$O){this.all[$j]=$O},$T($O,["document",function(){return this.document=new $O}]),$O}();(function($j){function $O(){this._tex=null,this._url=null,this._renderArgs=[],$O.__super.call(this),this.style.block=!0}$m($O,"laya.html.dom.HTMLImageElement",$Z);var $V=$O.prototype;$V._addToLayout=function($j){!this._style.absolute&&$j.push(this)},$V.render=function($j,$O,$V){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($b.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$j.ctx.drawTexture2($O,$V,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$V.layaoutCallNative=function(){var $j=0;if(this._childs&&0<($j=this._childs.length))for(var $O=0;$O<$j;$O++)this._childs[$O].layaoutCallNative&&this._childs[$O].layaoutCallNative()},$p(0,$V,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($j){this._width!==$j&&(this._width=$j,this._style.width=$j,this.repaint())}),$p(0,$V,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($j){this._height!==$j&&(this._height=$j,this._style.height=$j,this.repaint())}),$V.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$H.clearCache(this,this._url),this._tex=null),$Z.prototype.destroy.call(this)},$V.onloaded=function(){var $j=this._style;$j&&!$j.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$j&&!$j.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$t.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$V._loadImageComplete=function($j,$O,$V){if(!this._destroyed)if(null!=$V)if($V instanceof ArrayBuffer){var $l=new DataView($V);new laya.webgl.resource.WebGLImage(new Uint8Array($V,8),$j,0,!1,$l.getUint32(0),$l.getUint32(4));this.onloaded()}else if($V instanceof $r)$H.imgMgrSet[$j]=$O,$S.imgMgrLock($j,$H.imgMgrSet[$j]),this._url=$j,this._tex=$V,$H.keepCache(this,$j),$H.cacheRes($j,this._tex),this.onloaded();else{var $T=-1!=$j.indexOf(".png",$j.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($V,$j,$T,!1,$V.width,$V.height);this.onloaded()}else this.event("error","Load image failed")},$p(0,$V,"src",null,function($j){($j=this.formatURL($j),this._url!=$j)&&(null!=this._tex&&($H.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$j,(this._tex=$H.getRes($j))?($H.keepCache(this,$j),this.onloaded()):$S.imgMgrLoad($j,this._loadImageComplete.bind(this),2,!1))})})(),function($j){function $O(){this.type=null,$O.__super.call(this),this.visible=!1}$m($O,"laya.html.dom.HTMLLinkElement",$j);var $V=$O.prototype;$V._onload=function($j){switch(this.type){case"text/css":$o.parseCSS($j,this.URI)}},$p(0,$V,"href",$j.prototype._$get_href,function($j){var $O=this;$j=this.formatURL($j),this.URI=new $h($j);var $V=new $H;$V.once("complete",null,function($j){$O._onload($j)}),$V.load($j,"text")}),$O._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($Z),function($j){function $O(){$O.__super.call(this),this.visible=!1}$m($O,"laya.html.dom.HTMLStyleElement",$j),$p(0,$O.prototype,"text",$j.prototype._$get_text,function($j){$o.parseCSS($j,null)})}($Z),function($j){function $O(){$O.__super.call(this),this._getCSSStyle().valign="middle"}$m($O,"laya.html.dom.HTMLIframeElement",$j),$p(0,$O.prototype,"href",$j.prototype._$get_href,function($V){var $l=this;$V=this.formatURL($V);var $j=new $H;$j.once("complete",null,function($j){var $O=$l.URI;$l.URI=new $h($V),$l.innerHTML=$j,!$O||($l.URI=$O)}),$j.load($V,"text")})}($O)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($j,$O){"use strict";for(var $V in Object.defineProperty($O,"__esModule",{value:!0}),Laya){var $l=Laya[$V];$l&&$l.__isclass&&($O[$V]=$l)}}),function($T,$j,$b){$b.un,$b.uns;var $l=$b.static,$S=$b.class,$m=$b.getset,$V=($b.__newvec,laya.display.Animation),$r=(laya.utils.Browser,laya.utils.ClassUtils),$p=laya.filters.ColorFilter,$o=laya.utils.Ease,$H=laya.events.Event,$g=(laya.events.EventDispatcher,laya.display.css.Font),$e=laya.display.FrameAnimation,$O=laya.display.Graphics,$t=laya.utils.Handler,$w=laya.display.Input,$a=laya.net.Loader,$s=(laya.display.Node,laya.maths.Point),$h=laya.maths.Rectangle,$c=laya.renders.Render,$A=laya.display.Sprite,$Z=laya.display.Text,$x=laya.resource.Texture,$E=laya.utils.Tween,$U=laya.utils.Utils,$z=laya.utils.WeakObject;$b.interface("laya.ui.IItem"),$b.interface("laya.ui.ISelect"),$b.interface("laya.ui.IRender"),$b.interface("laya.ui.IComponent"),$b.interface("laya.ui.IBox","IComponent");var $$=function(){function $j(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $S($j,"laya.ui.LayoutStyle"),$l($j,["EMPTY",function(){return this.EMPTY=new $j}]),$j}(),$_=function(){function $j(){}return $S($j,"laya.ui.Styles"),$j.labelColor="#000000",$j.buttonStateNum=3,$j.scrollBarMinNum=15,$j.scrollBarDelayTime=500,$l($j,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$j}(),$B=function(){function $T(){}return $S($T,"laya.ui.UIUtils"),$T.fillArray=function($j,$O,$V){var $l=$j.concat();if($O)for(var $T=$O.split(","),$S=0,$m=Math.min($l.length,$T.length);$S<$m;$S++){var $p=$T[$S];$l[$S]="true"==$p||"false"!=$p&&$p,null!=$V&&($l[$S]=$V($p))}return $l},$T.toColor=function($j){return $U.toHexColor($j)},$T.gray=function($j,$O){void 0===$O&&($O=!0),$O?$T.addFilter($j,$T.grayFilter):$T.clearFilter($j,$p)},$T.addFilter=function($j,$O){var $V=$j.filters||[];$V.push($O),$j.filters=$V},$T.clearFilter=function($j,$O){var $V=$j.filters;if(null!=$V&&0<$V.length){for(var $l=$V.length-1;-1<$l;$l--){var $T=$V[$l];$b.__typeof($T,$O)&&$V.splice($l,1)}$j.filters=$V}},$T._getReplaceStr=function($j){return $T.escapeSequence[$j]},$T.adptString=function($j){return $j.replace(/\\(\w)/g,$T._getReplaceStr)},$T.getBindFun=function($j){var $O=$T._funMap.get($j);if(null==$O){var $V='"'+$j+'"',$l="(function(data){if(data==null)return;with(data){try{\nreturn "+($V=$V.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$O=$b._runScript($l),$T._funMap.set($j,$O)}return $O},$l($T,["grayFilter",function(){return this.grayFilter=new $p([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $z}]),$T}(),$M=function(){function $j(){}return $S($j,"UIConfig"),$j.touchScrollEnable=!0,$j.mouseWheelEnable=!0,$j.showButtons=!0,$j.popupBgColor="#000000",$j.popupBgAlpha=.5,$j.closeDialogOnSide=!0,$j}(),$v=function($V){function $h(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$h.__super.call(this),this._weakKeys=[]}$S($h,"laya.ui.AutoBitmap",$V);var $j=$h.prototype;return $j.destroy=function(){if($a.clearObject(this,this._weakKey),this._weakKeys){for(var $j=0,$O=this._weakKeys.length;$j<$O;++$j)$a.clearObject(this,this._weakKeys[$j]);this._weakKeys=null}$V.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$j._setChanged=function(){this._isChanged||(this._isChanged=!0,$b.timer.callLater(this,this.changeSource))},$j.changeSource=function(){this._isChanged=!1;var $j=this._source;if($j&&$j.bitmap){var $O=this.width,$V=this.height,$l=this._sizeGrid,$T=$j.sourceWidth,$S=$j.sourceHeight;if(!$l||$T===$O&&$S===$V)this.cleanByTexture($j,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$O,$V);else{$a.clearObject(this,this._weakKey),$j.$_GID||($j.$_GID=$U.getGID());var $m=$j.$_GID+"."+$O+"."+$V+"."+$l.join("."),$p=$a.findObject($m);if($U.isOKCmdList($p))return this._weakKey=$m,$a.keepObject(this,this._weakKey),void(this.cmds=$p);this.clear();var $o,$H,$g=$l[0],$e=$l[1],$t=$l[2],$w=$l[3],$s=$l[4],$b=!1;if($O==$T&&($w=$e=0),$V==$S&&($g=$t=0),$O<$w+$e){var $r=$O;$b=!0,$O=$w+$e,this.save(),this.clipRect(0,0,$r,$V)}$w&&$g&&($o=$h.getTexture($j,0,0,$w,$g),$H=this._weakKeys[0],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[0]=$o.weakKey),this.drawTexture($o,0,0,$w,$g)):($a.clearObject(this,$H),this._weakKeys[0]="")),$e&&$g&&($o=$h.getTexture($j,$T-$e,0,$e,$g),$H=this._weakKeys[1],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[1]=$o.weakKey),this.drawTexture($o,$O-$e,0,$e,$g)):($a.clearObject(this,$H),this._weakKeys[1]="")),$w&&$t&&($o=$h.getTexture($j,0,$S-$t,$w,$t),$H=this._weakKeys[2],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[2]=$o.weakKey),this.drawTexture($o,0,$V-$t,$w,$t)):($a.clearObject(this,$H),this._weakKeys[2]="")),$e&&$t&&($o=$h.getTexture($j,$T-$e,$S-$t,$e,$t),$H=this._weakKeys[3],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[3]=$o.weakKey),this.drawTexture($o,$O-$e,$V-$t,$e,$t)):($a.clearObject(this,$H),this._weakKeys[3]="")),$g&&($o=$h.getTexture($j,$w,0,$T-$w-$e,$g),$H=this._weakKeys[4],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[4]=$o.weakKey),this.drawBitmap($s,$o,$w,0,$O-$w-$e,$g)):($a.clearObject(this,$H),this._weakKeys[4]="")),$t&&($o=$h.getTexture($j,$w,$S-$t,$T-$w-$e,$t),$H=this._weakKeys[5],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[5]=$o.weakKey),this.drawBitmap($s,$o,$w,$V-$t,$O-$w-$e,$t)):($a.clearObject(this,$H),this._weakKeys[5]="")),$w&&($o=$h.getTexture($j,0,$g,$w,$S-$g-$t),$H=this._weakKeys[6],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[6]=$o.weakKey),this.drawBitmap($s,$o,0,$g,$w,$V-$g-$t)):($a.clearObject(this,$H),this._weakKeys[6]="")),$e&&($o=$h.getTexture($j,$T-$e,$g,$e,$S-$g-$t),$H=this._weakKeys[7],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[7]=$o.weakKey),this.drawBitmap($s,$o,$O-$e,$g,$e,$V-$g-$t)):($a.clearObject(this,$H),this._weakKeys[7]="")),$o=$h.getTexture($j,$w,$g,$T-$w-$e,$S-$g-$t),$H=this._weakKeys[8],$o?($H!=$o.weakKey&&($a.clearObject(this,$H),$a.keepObject(this,$o.weakKey),this._weakKeys[8]=$o.weakKey),this.drawBitmap($s,$o,$w,$g,$O-$w-$e,$V-$g-$t)):($a.clearObject(this,$H),this._weakKeys[8]=""),$b&&this.restore(),this.autoCacheCmd&&!$c.isConchApp&&($a.saveObject($m,this.cmds,null),this._weakKey=$m,$a.keepObject(this,this._weakKey))}this._repaint()}},$j.drawBitmap=function($j,$O,$V,$l,$T,$S){void 0===$T&&($T=0),void 0===$S&&($S=0),$T<.1||$S<.1||(!$j||$O.width==$T&&$O.height==$S?this.drawTexture($O,$V,$l,$T,$S):this.fillTexture($O,$V,$l,$T,$S))},$j.clear=function($j){void 0===$j&&($j=!0),$V.prototype.clear.call(this,!1)},$m(0,$j,"sizeGrid",function(){return this._sizeGrid},function($j){this._sizeGrid=$j,this._setChanged()}),$m(0,$j,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($j){this._width!=$j&&(this._width=$j,this._setChanged())}),$m(0,$j,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($j){this._height!=$j&&(this._height=$j,this._setChanged())}),$m(0,$j,"source",function(){return this._source},function($j){$j?(this._source=$j,this._setChanged()):(this._source=null,this.clear())}),$h.getTexture=function($j,$O,$V,$l,$T){$l<=0&&($l=1),$T<=0&&($T=1),$j.$_GID||($j.$_GID=$U.getGID());var $S=$j.$_GID+"."+$O+"."+$V+"."+$l+"."+$T,$m=$a.findObject($S);if((!$m||!$m.source)&&($m=$x.createFromTexture($j,$O,$V,$l,$T))){if($j.alphaTexture){var $p=$j.width/$j.alphaTexture.width;$m.alphaTexture=$x.createFromTexture($j.alphaTexture,$O/$p,$V/$p,$l/$p,$T/$p)}$a.saveObject($S,$m),$m.weakKey=$S}return $m},$h}($O),$Y=(function($j){function $O(){$O.__super.call(this)}$S($O,"laya.ui.UIEvent",$H),$O.SHOW_TIP="showtip",$O.HIDE_TIP="hidetip"}(),function($O){function $j(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$j.__super.call(this),this._layout=$$.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$S($j,"laya.ui.Component",$O);var $V=$j.prototype;return $b.imps($V,{"laya.ui.IComponent":!0}),$V.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$V.preinitialize=function(){},$V.createChildren=function(){},$V.initialize=function(){},$V.callLater=function($j,$O){$b.timer.callLater(this,$j,$O)},$V.runCallLater=function($j){$b.timer.runCallLater(this,$j)},$V.commitMeasure=function(){},$V.changeSize=function(){this.event("resize")},$V.getLayout=function(){return this._layout===$$.EMPTY&&(this._layout=new $$),this._layout},$V._setLayoutEnabled=function($j){this._layout&&this._layout.enable!=$j&&(this._layout.enable=$j,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$V.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$V.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$V.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$V.resetLayoutX=function(){var $j=this._layout;if(isNaN($j.anchorX)||(this.pivotX=$j.anchorX*this.width),this.layoutEnabled){var $O=this.parent;$O&&(isNaN($j.centerX)?isNaN($j.left)?isNaN($j.right)||(this.x=Math.round($O.width-this.displayWidth-$j.right+this.pivotX*this.scaleX)):(this.x=Math.round($j.left+this.pivotX*this.scaleX),isNaN($j.right)||(this.width=($O._width-$j.left-$j.right)/(this.scaleX||.01))):this.x=Math.round(.5*($O.width-this.displayWidth)+$j.centerX+this.pivotX*this.scaleX))}},$V.resetLayoutY=function(){var $j=this._layout;if(isNaN($j.anchorY)||(this.pivotY=$j.anchorY*this.height),this.layoutEnabled){var $O=this.parent;$O&&(isNaN($j.centerY)?isNaN($j.top)?isNaN($j.bottom)||(this.y=Math.round($O.height-this.displayHeight-$j.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($j.top+this.pivotY*this.scaleY),isNaN($j.bottom)||(this.height=($O._height-$j.top-$j.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($O.height-this.displayHeight)+$j.centerY+this.pivotY*this.scaleY))}},$V.onMouseOver=function($j){$b.stage.event("showtip",this._toolTip)},$V.onMouseOut=function($j){$b.stage.event("hidetip",this._toolTip)},$m(0,$V,"displayWidth",function(){return this.width*this.scaleX}),$m(0,$V,"width",function(){return this._width?this._width:this.measureWidth},function($j){this._width!=$j&&(this._width=$j,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$m(0,$V,"measureWidth",function(){var $j=0;this.commitMeasure();for(var $O=this.numChildren-1;-1<$O;$O--){var $V=this.getChildAt($O);$V.visible&&($j=Math.max($V.x+$V.width*$V.scaleX,$j))}return $j}),$m(0,$V,"displayHeight",function(){return this.height*this.scaleY}),$m(0,$V,"height",function(){return this._height?this._height:this.measureHeight},function($j){this._height!=$j&&(this._height=$j,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$m(0,$V,"dataSource",function(){return this._dataSource},function($j){for(var $O in this._dataSource=$j,this._dataSource)this.hasOwnProperty($O)&&"function"!=typeof this[$O]&&(this[$O]=this._dataSource[$O])}),$m(0,$V,"scaleY",$O.prototype._$get_scaleY,function($j){$b.superGet($A,this,"scaleY")!=$j&&($b.superSet($A,this,"scaleY",$j),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$m(0,$V,"measureHeight",function(){var $j=0;this.commitMeasure();for(var $O=this.numChildren-1;-1<$O;$O--){var $V=this.getChildAt($O);$V.visible&&($j=Math.max($V.y+$V.height*$V.scaleY,$j))}return $j}),$m(0,$V,"scaleX",$O.prototype._$get_scaleX,function($j){$b.superGet($A,this,"scaleX")!=$j&&($b.superSet($A,this,"scaleX",$j),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$m(0,$V,"top",function(){return this._layout.top},function($j){$j!=this._layout.top&&(this.getLayout().top=$j,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$m(0,$V,"bottom",function(){return this._layout.bottom},function($j){$j!=this._layout.bottom&&(this.getLayout().bottom=$j,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$m(0,$V,"left",function(){return this._layout.left},function($j){$j!=this._layout.left&&(this.getLayout().left=$j,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$m(0,$V,"right",function(){return this._layout.right},function($j){$j!=this._layout.right&&(this.getLayout().right=$j,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$m(0,$V,"centerX",function(){return this._layout.centerX},function($j){$j!=this._layout.centerX&&(this.getLayout().centerX=$j,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$m(0,$V,"centerY",function(){return this._layout.centerY},function($j){$j!=this._layout.centerY&&(this.getLayout().centerY=$j,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$m(0,$V,"anchorX",function(){return this._layout.anchorX},function($j){$j!=this._layout.anchorX&&(this.getLayout().anchorX=$j,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$m(0,$V,"anchorY",function(){return this._layout.anchorY},function($j){$j!=this._layout.anchorY&&(this.getLayout().anchorY=$j,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$m(0,$V,"tag",function(){return this._tag},function($j){this._tag=$j}),$m(0,$V,"toolTip",function(){return this._toolTip},function($j){this._toolTip!=$j&&(null!=(this._toolTip=$j)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$m(0,$V,"comXml",function(){return this._comXml},function($j){this._comXml=$j}),$m(0,$V,"gray",function(){return this._gray},function($j){$j!==this._gray&&(this._gray=$j,$B.gray(this,$j))}),$m(0,$V,"disabled",function(){return this._disabled},function($j){$j!==this._disabled&&(this.gray=this._disabled=$j,this.mouseEnabled=!$j)}),$j}($A)),$R=function($j){function $O(){this.lockLayer=null,this.popupEffect=function($j){$j.scale(1,1),$E.from($j,{x:$b.stage.width/2,y:$b.stage.height/2,scaleX:0,scaleY:0},300,$o.backOut,$t.create(this,this.doOpen,[$j]))},this.closeEffect=function($j,$O){$E.to($j,{x:$b.stage.width/2,y:$b.stage.height/2,scaleX:0,scaleY:0},300,$o.strongOut,$t.create(this,this.doClose,[$j,$O]))},$O.__super.call(this),this.maskLayer=new $A,this.popupEffectHandler=$t.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$t.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$b.stage.addChild(this),$b.stage.on("resize",this,this._onResize),$M.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$S($O,"laya.ui.DialogManager",$A);var $V=$O.prototype;return $V._closeOnSide=function(){var $j=this.getChildAt(this.numChildren-1);$j instanceof laya.ui.Dialog&&$j.close("side")},$V.setLockView=function($j){this.lockLayer||(this.lockLayer=new $q,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($b.stage.width,$b.stage.height)),this.lockLayer.removeChildren(),$j&&($j.centerX=$j.centerY=0,this.lockLayer.addChild($j))},$V._onResize=function($j){var $O=this.maskLayer.width=$b.stage.width,$V=this.maskLayer.height=$b.stage.height;this.lockLayer&&this.lockLayer.size($O,$V),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$O,$V,$M.popupBgColor),this.maskLayer.alpha=$M.popupBgAlpha;for(var $l=this.numChildren-1;-1<$l;$l--){var $T=this.getChildAt($l);$T.popupCenter&&this._centerDialog($T)}},$V._centerDialog=function($j){$j.x=Math.round(($b.stage.width-$j.width>>1)+$j.pivotX),$j.y=Math.round(($b.stage.height-$j.height>>1)+$j.pivotY)},$V.open=function($j,$O,$V){void 0===$O&&($O=!1),void 0===$V&&($V=!1),$O&&this._closeAll(),$j.popupCenter&&this._centerDialog($j),this.addChild($j),($j.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$V&&null!=$j.popupEffect?$j.popupEffect.runWith($j):this.doOpen($j),this.event("open")},$V.doOpen=function($j){$j.onOpened()},$V.lock=function($j){this.lockLayer&&($j?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$V.close=function($j,$O,$V){void 0===$V&&($V=!1),$V&&null!=$j.closeEffect?$j.closeEffect.runWith([$j,$O]):this.doClose($j,$O),this.event("close")},$V.doClose=function($j,$O){$j.removeSelf(),$j.isModal&&this._checkMask(),$j.closeHandler&&$j.closeHandler.runWith($O),$j.onClosed($O)},$V.closeAll=function(){this._closeAll(),this.event("close")},$V._closeAll=function(){for(var $j=this.numChildren-1;-1<$j;$j--){var $O=this.getChildAt($j);$O&&null!=$O.close&&this.doClose($O)}},$V.getDialogsByGroup=function($j){for(var $O=[],$V=this.numChildren-1;-1<$V;$V--){var $l=this.getChildAt($V);$l&&$l.group===$j&&$O.push($l)}return $O},$V.closeByGroup=function($j){for(var $O=[],$V=this.numChildren-1;-1<$V;$V--){var $l=this.getChildAt($V);$l&&$l.group===$j&&($l.close(),$O.push($l))}return $O},$V._checkMask=function(){this.maskLayer.removeSelf();for(var $j=this.numChildren-1;-1<$j;$j--){var $O=this.getChildAt($j);if($O&&$O.isModal)return void this.addChildAt(this.maskLayer,$j)}},$O}(),$q=function($j){function $O(){$O.__super.call(this)}$S($O,"laya.ui.Box",$j);var $V=$O.prototype;return $b.imps($V,{"laya.ui.IBox":!0}),$m(0,$V,"dataSource",$j.prototype._$get_dataSource,function($j){for(var $O in this._dataSource=$j){var $V=this.getChildByName($O);$V?$V.dataSource=$j[$O]:this.hasOwnProperty($O)&&"function"!=typeof this[$O]&&(this[$O]=$j[$O])}}),$O}($Y),$i=function($O){function $V($j,$O){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$V.__super.call(this),this._labelColors=$_.buttonLabelColors,this._stateNum=$_.buttonStateNum,void 0===$O&&($O=""),this.skin=$j,this.label=$O}$S($V,"laya.ui.Button",$O);var $j=$V.prototype;return $b.imps($j,{"laya.ui.ISelect":!0}),$j.destroy=function($j){this.clearEvent(),$a.clearCache(this,this._skin),$a.clearObject(this,this._weakKey),void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($j),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$j.clearEvent=function(){this._skin&&$T.atalsNotify&&$T.atalsNotify.off(this._skin,this,this._setBtnSource)},$j.createChildren=function(){this.graphics=this._bitmap=new $v},$j.createText=function(){this._text||(this._text=new $Z,this._text.overflow=$Z.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$j.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$j.onMouse=function($j){if(!1!==this.toggle||!this._selected)return"click"===$j.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$V.stateMap[$j.type]))},$j.changeClips=function(){var $j=$a.getRes(this._skin);if($j)if(this._skin&&""!=this._skin){$a.clearObject(this,this._weakKey);var $O=$j.sourceWidth,$V=$j.sourceHeight/this._stateNum;$j.$_GID||($j.$_GID=$U.getGID());var $l=$j.$_GID+"-"+this._stateNum,$T=$a.findObject($l);if($U.isOkTextureList($T)||($T=null),$T)this._weakKey=$l,$a.keepObject(this,this._weakKey),this._sources=$T;else{if(this._sources=[],1===this._stateNum)this._sources.push($j);else for(var $S=0;$S<this._stateNum;$S++){var $m=$x.createFromTexture($j,0,$V*$S,$O,$V);if($j.alphaTexture){var $p=$j.width/$j.alphaTexture.width;$m.alphaTexture=$x.createFromTexture($j.alphaTexture,0/$p,$V*$S/$p,$O/$p,$V/$p)}this._sources.push($m)}$a.saveObject($l,this._sources),this._weakKey=$l,$a.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$O,this._bitmap.height=this._height||$V,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$O)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$j.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $j=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$j]),this.label&&(this._text.color=this._labelColors[$j],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$j]))},$j._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$m(0,$j,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($j){this.createText(),this._text.strokeColor=$j}),$m(0,$j,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$m(0,$j,"skin",function(){return this._skin},function($j){if(this._skin!=$j)if(this.clearEvent(),$a.clearCache(this,this._skin),this._skin=$j,$a.keepCache(this,this._skin),$a.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $O=$T.resAtalsObj&&$T.resAtalsObj[this._skin];$O?($T.atalsNotify&&$T.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$O.sourceW),0==this.height&&(this.height=$O.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$j._setBtnSource=function($j,$O){$j===this._skin&&$O&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$m(0,$j,"state",function(){return this._state},function($j){this._state!=$j&&(this._state=$j,this._setStateChanged())}),$m(0,$j,"text",function(){return this.createText(),this._text}),$m(0,$j,"stateNum",function(){return this._stateNum},function($j){"string"==typeof $j&&($j=parseInt($j)),this._stateNum!=$j&&(this._stateNum=$j<1?1:3<$j?3:$j,this.callLater(this.changeClips))}),$m(0,$j,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($j){this._strokeColors=$B.fillArray($_.buttonLabelColors,$j,String),this._setStateChanged()}),$m(0,$j,"labelColors",function(){return this._labelColors.join(",")},function($j){this._labelColors=$B.fillArray($_.buttonLabelColors,$j,String),this._setStateChanged()}),$m(0,$j,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$m(0,$j,"label",function(){return this._text?this._text.text:null},function($j){(this._text||$j)&&(this.createText(),this._text.text!=$j&&($j&&!this._text.parent&&this.addChild(this._text),this._text.text=($j+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$m(0,$j,"selected",function(){return this._selected},function($j){this._selected!=$j&&(this._selected=$j,this.state=this._selected?2:0,this.event("change"))}),$m(0,$j,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($j){this.createText(),this._text.padding=$B.fillArray($_.labelPadding,$j,Number)}),$m(0,$j,"labelSize",function(){return this.createText(),this._text.fontSize},function($j){this.createText(),this._text.fontSize=$j}),$m(0,$j,"labelStroke",function(){return this.createText(),this._text.stroke},function($j){this.createText(),this._text.stroke=$j}),$m(0,$j,"labelBold",function(){return this.createText(),this._text.bold},function($j){this.createText(),this._text.bold=$j}),$m(0,$j,"labelFont",function(){return this.createText(),this._text.font},function($j){this.createText(),this._text.font=$j}),$m(0,$j,"labelAlign",function(){return this.createText(),this._text.align},function($j){this.createText(),this._text.align=$j}),$m(0,$j,"clickHandler",function(){return this._clickHandler},function($j){this._clickHandler=$j}),$m(0,$j,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($j){this._bitmap.sizeGrid=$B.fillArray($_.defaultSizeGrid,$j,Number)}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($Y,this,"width",$j),this._autoSize&&(this._bitmap.width=$j,this._text&&(this._text.width=$j))}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($Y,this,"height",$j),this._autoSize&&(this._bitmap.height=$j,this._text&&(this._text.height=$j))}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)||"string"==typeof $j?this.label=$j+"":$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($j){this._bitmap._offset=$j?$B.fillArray([1,1],$j,Number):[]}),$l($V,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$V}($Y),$k=function($O){function $l($j,$O,$V){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$l.__super.call(this),void 0===$O&&($O=1),void 0===$V&&($V=1),this._clipX=$O,this._clipY=$V,this.skin=$j}$S($l,"laya.ui.Clip",$O);var $j=$l.prototype;return $j.destroy=function($j){this.clearEvent(),this.clearLoad(),$a.clearCache(this,this._skin),$a.clearObject(this,this._weakKey),void 0===$j&&($j=!0),$O.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$j.dispose=function(){this.destroy(!0),$b.loader.clearRes(this._skin)},$j.createChildren=function(){this.graphics=this._bitmap=new $v},$j._onDisplay=function($j){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$j.changeClip=function(){if(this._clipChanged=!1,this._skin){var $j=$a.getRes(this._skin);if($j)this.loadComplete(this._skin,$j);else{if($T.resAtalsObj&&$T.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$t.create(this,this.loadComplete,[this._skin]),this._progress=null,$b.loader.load(this._skin,this._complete,this._progress)}}},$j.loadComplete=function($j,$O){if($j===this._skin&&$O){$a.clearObject(this,this._weakKey);var $V=this._clipWidth||Math.ceil($O.sourceWidth/this._clipX),$l=this._clipHeight||Math.ceil($O.sourceHeight/this._clipY),$T=this._skin+$V+$l,$S=$a.findObject($T);if($U.isOkTextureList($S)||($S=null),$S)this._weakKey=$T,$a.keepObject(this,this._weakKey),this._sources=$S;else{this._sources=[];for(var $m=0;$m<this._clipY;$m++)for(var $p=0;$p<this._clipX;$p++){var $o=$x.createFromTexture($O,$V*$p,$l*$m,$V,$l);if($O.alphaTexture){var $H=$O.width/$O.alphaTexture.width;$o.alphaTexture=$x.createFromTexture($O.alphaTexture,$V*$p/$H,$l*$m/$H,$V/$H,$l/$H)}this._sources.push($o)}$a.saveObject($T,this._sources),this._weakKey=$T,$a.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$j.play=function($j,$O){void 0===$j&&($j=0),void 0===$O&&($O=-1),this._isPlaying=!0,this.index=$j,this._toIndex=$O,this._index++,$b.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$j._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$j.stop=function(){this._isPlaying=!1,$b.timer.clear(this,this._loop),this.event("complete")},$j._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$m(0,$j,"interval",function(){return this._interval},function($j){this._interval!=$j&&(this._interval=$j,this._isPlaying&&this.play())}),$j.clearEvent=function(){this._skin&&$T.atalsNotify&&$T.atalsNotify.off(this._skin,this,this._setBtnSource)},$j.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$b.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$m(0,$j,"skin",function(){return this._skin},function($j){if(this._skin!=$j)if(this.clearLoad(),this.clearEvent(),$a.clearCache(this,this._skin),this._skin=$j){$a.keepCache(this,this._skin);var $O=$a.getRes($j),$V=$T.resAtalsObj&&$T.resAtalsObj[this._skin];!$O&&$V?$T.atalsNotify&&$T.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$j._setBtnSource=function($j,$O){$j===this._skin&&$O&&(this.loadComplete($j,$O),this.clearEvent())},$m(0,$j,"sources",function(){return this._sources},function($j){this._sources=$j,this.index=this._index,this.event("loaded")}),$m(0,$j,"clipX",function(){return this._clipX},function($j){this._clipX=$j||1,this._setClipChanged()}),$m(0,$j,"clipY",function(){return this._clipY},function($j){this._clipY=$j||1,this._setClipChanged()}),$m(0,$j,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$m(0,$j,"clipWidth",function(){return this._clipWidth},function($j){this._clipWidth=$j,this._setClipChanged()}),$m(0,$j,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($j){this._bitmap.sizeGrid=$B.fillArray($_.defaultSizeGrid,$j,Number)}),$m(0,$j,"group",function(){return this._group},function($j){$j&&this._skin&&$a.setGroup(this._skin,$j),this._group=$j}),$m(0,$j,"clipHeight",function(){return this._clipHeight},function($j){this._clipHeight=$j,this._setClipChanged()}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($Y,this,"width",$j),this._bitmap.width=$j}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($Y,this,"height",$j),this._bitmap.height=$j}),$m(0,$j,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$m(0,$j,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$m(0,$j,"index",function(){return this._index},function($j){this._index=$j,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$j]),this.event("change")}),$m(0,$j,"autoPlay",function(){return this._autoPlay},function($j){this._autoPlay!=$j&&((this._autoPlay=$j)?this.play():this.stop())}),$m(0,$j,"isPlaying",function(){return this._isPlaying},function($j){this._isPlaying=$j}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)&&Math.floor($j)==$j||"string"==typeof $j?this.index=parseInt($j):$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"bitmap",function(){return this._bitmap}),$l}($Y),$n=function($O){function $j(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$j.__super.call(this)}$S($j,"laya.ui.ColorPicker",$O);var $V=$j.prototype;return $V.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._colorPanel&&this._colorPanel.destroy($j),this._colorButton&&this._colorButton.destroy($j),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$V.createChildren=function(){this.addChild(this._colorButton=new $i),this._colorPanel=new $q,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $A),this._colorPanel.addChild(this._colorBlock=new $A),this._colorPanel.addChild(this._colorInput=new $w)},$V.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$V.onPanelMouseDown=function($j){$j.stopPropagation()},$V.changePanel=function(){this._panelChanged=!1;var $j=this._colorPanel.graphics;$j.clear(),$j.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($j=this._colorTiles.graphics).clear();for(var $O=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$V=0;$V<12;$V++)for(var $l=0;$l<20;$l++){var $T=0;$T=0===$l?$O[$V]:1===$l?0:51*(((3*$V+$l/6)%3<<0)+3*($V/6<<0))<<16|$l%6*51<<8|($V<<0)%6*51;var $S=$B.toColor($T);this._colors.push($S);var $m=$l*this._gridSize,$p=$V*this._gridSize;$j.drawRect($m,$p,this._gridSize,this._gridSize,$S,"#000000")}},$V.onColorButtonClick=function($j){this._colorPanel.parent?this.close():this.open()},$V.open=function(){var $j=this.localToGlobal(new $s),$O=$j.x+this._colorPanel.width<=$b.stage.width?$j.x:$b.stage.width-this._colorPanel.width,$V=$j.y+this._colorButton.height;$V=$V+this._colorPanel.height<=$b.stage.height?$V:$j.y-this._colorPanel.height,this._colorPanel.pos($O,$V),this._colorPanel.zOrder=1001,$b._currentStage.addChild(this._colorPanel),$b.stage.on("mousedown",this,this.removeColorBox)},$V.close=function(){$b.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$V.removeColorBox=function($j){this.close()},$V.onColorFieldKeyDown=function($j){13==$j.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$j.stopPropagation())},$V.onColorInputChange=function($j){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$V.onColorTilesClick=function($j){this.selectedColor=this.getColorByMouse(),this.close()},$V.onColorTilesMouseMove=function($j){this._colorInput.focus=!1;var $O=this.getColorByMouse();this._colorInput.text=$O,this.drawBlock($O)},$V.getColorByMouse=function(){var $j=this._colorTiles.getMousePoint(),$O=Math.floor($j.x/this._gridSize),$V=Math.floor($j.y/this._gridSize);return this._colors[20*$V+$O]},$V.drawBlock=function($j){var $O=this._colorBlock.graphics;$O.clear();var $V=$j||"#ffffff";$O.drawRect(0,0,50,20,$V,this._borderColor),$j||$O.drawLine(0,0,50,20,"#ff0000")},$V.changeColor=function(){var $j=this.graphics;$j.clear();var $O=this._selectedColor||"#000000";$j.drawRect(0,0,this._colorButton.width,this._colorButton.height,$O)},$V._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$m(0,$V,"inputBgColor",function(){return this._inputBgColor},function($j){this._inputBgColor=$j,this._setPanelChanged()}),$m(0,$V,"selectedColor",function(){return this._selectedColor},function($j){this._selectedColor!=$j&&(this._selectedColor=this._colorInput.text=$j,this.drawBlock($j),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$H.EMPTY.setTo("change",this,this)))}),$m(0,$V,"skin",function(){return this._colorButton.skin},function($j){this._colorButton.skin=$j,this.changeColor()}),$m(0,$V,"bgColor",function(){return this._bgColor},function($j){this._bgColor=$j,this._setPanelChanged()}),$m(0,$V,"borderColor",function(){return this._borderColor},function($j){this._borderColor=$j,this._setPanelChanged()}),$m(0,$V,"inputColor",function(){return this._inputColor},function($j){this._inputColor=$j,this._setPanelChanged()}),$j}($Y),$G=function($O){function $V($j,$O){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$V.__super.call(this),this._itemColors=$_.comboBoxItemColors,this.skin=$j,this.labels=$O}$S($V,"laya.ui.ComboBox",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._button&&this._button.destroy($j),this._list&&this._list.destroy($j),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$j.createChildren=function(){this.addChild(this._button=new $i),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$j._createList=function(){this._list=new $K,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$j._setListEvent=function($j){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$t.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$j.onListDown=function($j){$j.stopPropagation()},$j.onScrollBarDown=function($j){$j.stopPropagation()},$j.onButtonMouseDown=function($j){this.callLater(this.switchTo,[!this._isOpen])},$j.changeList=function(){this._listChanged=!1;var $j=this.width-2,$O=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$j,height:this._itemHeight,fontSize:this._itemSize,color:$O}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$j.onlistItemMouse=function($j,$O){var $V=$j.type;if("mouseover"===$V||"mouseout"===$V){if(this._isCustomList)return;var $l=this._list.getCell($O);if(!$l)return;var $T=$l.getChildByName("label");$T&&("mouseover"===$V?($T.bgColor=this._itemColors[0],$T.color=this._itemColors[1]):($T.bgColor=null,$T.color=this._itemColors[2]))}else"click"===$V&&(this.selectedIndex=$O,this.isOpen=!1)},$j.switchTo=function($j){this.isOpen=$j},$j.changeOpen=function(){this.isOpen=!this._isOpen},$j.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $j=this._list.graphics;$j.clear(),$j.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $O=this._list.array||[],$V=$O.length=0,$l=this._labels.length;$V<$l;$V++)$O.push({label:this._labels[$V]});this._list.height=this._listHeight,this._list.array=$O},$j.changeSelected=function(){this._button.label=this.selectedLabel},$j._onStageMouseWheel=function($j){this._list&&!this._list.contains($j.target)&&this.removeList(null)},$j.removeList=function($j){$b.stage.off("mousedown",this,this.removeList),$b.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$m(0,$j,"selectedIndex",function(){return this._selectedIndex},function($j){this._selectedIndex!=$j&&(this._selectedIndex=$j,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$H.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$m(0,$j,"measureHeight",function(){return this._button.height}),$m(0,$j,"skin",function(){return this._button.skin},function($j){this._button.skin!=$j&&(this._button.skin=$j,this._listChanged=!0)}),$m(0,$j,"measureWidth",function(){return this._button.width}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($Y,this,"width",$j),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$m(0,$j,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($j){this.selectedIndex=this._labels.indexOf($j)}),$m(0,$j,"labels",function(){return this._labels.join(",")},function($j){0<this._labels.length&&(this.selectedIndex=-1),$j?this._labels=$j.split(","):this._labels.length=0,this._itemChanged=!0}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($Y,this,"height",$j),this._button.height=this._height}),$m(0,$j,"selectHandler",function(){return this._selectHandler},function($j){this._selectHandler=$j}),$m(0,$j,"visibleNum",function(){return this._visibleNum},function($j){this._visibleNum=$j,this._listChanged=!0}),$m(0,$j,"labelBold",function(){return this._button.text.bold},function($j){this._button.text.bold=$j}),$m(0,$j,"itemColors",function(){return String(this._itemColors)},function($j){this._itemColors=$B.fillArray(this._itemColors,$j,String),this._listChanged=!0}),$m(0,$j,"itemSize",function(){return this._itemSize},function($j){this._itemSize=$j,this._listChanged=!0}),$m(0,$j,"scrollBar",function(){return this.list.scrollBar}),$m(0,$j,"isOpen",function(){return this._isOpen},function($j){if(this._isOpen!=$j)if(this._isOpen=$j,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $O=this.localToGlobal($s.TEMP.setTo(0,0)),$V=$O.y+this._button.height;$V=$V+this._listHeight<=$b.stage.height?$V:$O.y-this._listHeight,this._list.pos($O.x,$V),this._list.zOrder=1001,$b._currentStage.addChild(this._list),$b.stage.once("mousedown",this,this.removeList),$b.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$m(0,$j,"scrollBarSkin",function(){return this._scrollBarSkin},function($j){this._scrollBarSkin=$j}),$m(0,$j,"sizeGrid",function(){return this._button.sizeGrid},function($j){this._button.sizeGrid=$j}),$m(0,$j,"button",function(){return this._button}),$m(0,$j,"list",function(){return this._list||this._createList(),this._list},function($j){$j&&($j.removeSelf(),this._isCustomList=!0,this._list=$j,this._setListEvent($j),this._itemHeight=$j.getCell(0).height+$j.spaceY)}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)&&Math.floor($j)==$j||"string"==typeof $j?this.selectedIndex=parseInt($j):$j instanceof Array?this.labels=$j.join(","):$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"labelColors",function(){return this._button.labelColors},function($j){this._button.labelColors!=$j&&(this._button.labelColors=$j)}),$m(0,$j,"labelPadding",function(){return this._button.text.padding.join(",")},function($j){this._button.text.padding=$B.fillArray($_.labelPadding,$j,Number)}),$m(0,$j,"labelSize",function(){return this._button.text.fontSize},function($j){this._button.text.fontSize=$j}),$m(0,$j,"labelFont",function(){return this._button.text.font},function($j){this._button.text.font=$j}),$m(0,$j,"stateNum",function(){return this._button.stateNum},function($j){this._button.stateNum=$j}),$V}($Y),$F=function($O){function $V($j){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$V.__super.call(this),this._showButtons=$M.showButtons,this._touchScrollEnable=$M.touchScrollEnable,this._mouseWheelEnable=$M.mouseWheelEnable,this.skin=$j,this.max=1}$S($V,"laya.ui.ScrollBar",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),this.stopScroll(),this.target=null,$O.prototype.destroy.call(this,$j),this.upButton&&this.upButton.destroy($j),this.downButton&&this.downButton.destroy($j),this.slider&&this.slider.destroy($j),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$j.createChildren=function(){this.addChild(this.slider=new $N),this.addChild(this.upButton=new $i),this.addChild(this.downButton=new $i)},$j.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$j.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$j.onButtonMouseDown=function($j){var $O=$j.currentTarget===this.upButton;this.slide($O),$b.timer.once($_.scrollBarDelayTime,this,this.startLoop,[$O]),$b.stage.once("mouseup",this,this.onStageMouseUp)},$j.startLoop=function($j){$b.timer.frameLoop(1,this,this.slide,[$j])},$j.slide=function($j){$j?this.value-=this._scrollSize:this.value+=this._scrollSize},$j.onStageMouseUp=function($j){$b.timer.clear(this,this.startLoop),$b.timer.clear(this,this.slide)},$j.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$j.changeSize=function(){$O.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$j.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$j.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$j.setScroll=function($j,$O,$V){this.runCallLater(this.changeSize),this.slider.setSlider($j,$O,$V),this.slider.bar.visible=0<$O,!this._hide&&this.autoHide&&(this.visible=!1)},$j.onTargetMouseWheel=function($j){this.value-=$j.delta*this._scrollSize,this.target=this._target},$j.onTargetMouseDown=function($j){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $s),this._lastPoint.setTo($b.stage.mouseX,$b.stage.mouseY),$b.timer.clear(this,this.tweenMove),$E.clearTween(this),$b.stage.once("mouseup",this,this.onStageMouseUp2),$b.stage.once("mouseout",this,this.onStageMouseUp2),$b.timer.frameLoop(1,this,this.loop)},$j.loop=function(){var $j=$b.stage.mouseY,$O=$b.stage.mouseX;if(this._lastOffset=this.isVertical?$j-this._lastPoint.y:$O-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$b.stage._canvasTransform.getScaleY():$b.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$O,this._lastPoint.y=$j,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$j.onStageMouseUp2=function($j){if($b.stage.off("mouseup",this,this.onStageMouseUp2),$b.stage.off("mouseout",this,this.onStageMouseUp2),$b.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$E.to(this,{value:this.min},this.elasticBackTime,$o.sineOut,$t.create(this,this.elasticOver)):this._value>this.max&&$E.to(this,{value:this.max},this.elasticBackTime,$o.sineOut,$t.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$b.stage.mouseY-this._lastPoint.y:$b.stage.mouseX-this._lastPoint.x);for(var $O=0,$V=Math.min(this._offsets.length,3),$l=0;$l<$V;$l++)$O+=this._offsets[this._offsets.length-1-$l];if(this._lastOffset=$O/$V,($O=Math.abs(this._lastOffset))<2)return void this.event("end");60<$O&&(this._lastOffset=0<this._lastOffset?60:-60);var $T=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$b.timer.frameLoop(1,this,this.tweenMove,[$T])}},$j.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$E.to(this,{alpha:0},500),this.event("end")},$j.tweenMove=function($j){this._lastOffset*=this.rollRatio;var $O=NaN;if(0<$j&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$O=.5*-(this.min-$j-this.value),this._lastOffset>$O&&(this._lastOffset=$O)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$O=.5*-(this.max+$j-this.value),this._lastOffset<$O&&(this._lastOffset=$O))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($b.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$E.to(this,{value:this.min},this.elasticBackTime,$o.sineOut,$t.create(this,this.elasticOver)):this._value>this.max?$E.to(this,{value:this.max},this.elasticBackTime,$o.sineOut,$t.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$E.to(this,{alpha:0},500)}},$j.stopScroll=function(){this.onStageMouseUp2(null),$b.timer.clear(this,this.tweenMove),$E.clearTween(this)},$m(0,$j,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$m(0,$j,"skin",function(){return this._skin},function($j){this._skin!=$j&&(this._skin=$j,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$m(0,$j,"max",function(){return this.slider.max},function($j){this.slider.max=$j}),$m(0,$j,"showButtons",function(){return this._showButtons},function($j){this._showButtons=$j,this.callLater(this.changeScrollBar)}),$m(0,$j,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$m(0,$j,"min",function(){return this.slider.min},function($j){this.slider.min=$j}),$m(0,$j,"value",function(){return this._value},function($j){$j!==this._value&&(this._value=$j,this._isElastic||(this.slider._value!=$j&&(this.slider._value=$j,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$m(0,$j,"isVertical",function(){return this.slider.isVertical},function($j){this.slider.isVertical=$j}),$m(0,$j,"sizeGrid",function(){return this.slider.sizeGrid},function($j){this.slider.sizeGrid=$j}),$m(0,$j,"scrollSize",function(){return this._scrollSize},function($j){this._scrollSize=$j}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)||"string"==typeof $j?this.value=Number($j):$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"thumbPercent",function(){return this._thumbPercent},function($j){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$j=1<=$j?.99:$j,this._thumbPercent=$j,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$j,$_.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$j,$_.scrollBarMinNum))}),$m(0,$j,"target",function(){return this._target},function($j){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$j)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$m(0,$j,"hide",function(){return this._hide},function($j){this._hide=$j,this.visible=!$j}),$m(0,$j,"touchScrollEnable",function(){return this._touchScrollEnable},function($j){this._touchScrollEnable=$j,this.target=this._target}),$m(0,$j,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($j){this._mouseWheelEnable=$j,this.target=this._target}),$m(0,$j,"tick",function(){return this.slider.tick},function($j){this.slider.tick=$j}),$V}($Y),$N=function($O){function $V($j){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$V.__super.call(this),this.skin=$j}$S($V,"laya.ui.Slider",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._bg&&this._bg.destroy($j),this._bar&&this._bar.destroy($j),this._progress&&this._progress.destroy($j),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$j.createChildren=function(){this.addChild(this._bg=new $X),this.addChild(this._bar=new $i)},$j.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$j.onBarMouseDown=function($j){this._globalSacle||(this._globalSacle=new $s),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$b.stage.mouseX,this._ty=$b.stage.mouseY,$b.stage.on("mousemove",this,this.mouseMove),$b.stage.once("mouseup",this,this.mouseUp),$b.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$j.showValueText=function(){if(this.showLabel){var $j=laya.ui.Slider.label;this.addChild($j),$j.textField.changeText(this._value+""),this.isVertical?($j.x=this._bar.x+20,$j.y=.5*(this._bar.height-$j.height)+this._bar.y):($j.y=this._bar.y-20,$j.x=.5*(this._bar.width-$j.width)+this._bar.x)}},$j.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$j.mouseUp=function($j){$b.stage.off("mousemove",this,this.mouseMove),$b.stage.off("mouseup",this,this.mouseUp),$b.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$j.mouseMove=function($j){var $O=this._value;this.isVertical?(this._bar.y+=($b.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($b.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$b.stage.mouseX,this._ty=$b.stage.mouseY;var $V=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$V)/$V,this._value!=$O&&this.sendChangeEvent(),this.showValueText()},$j.sendChangeEvent=function($j){void 0===$j&&($j="change"),this.event($j),this.changeHandler&&this.changeHandler.runWith(this._value)},$j.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$j.changeSize=function(){$O.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$j.setSlider=function($j,$O,$V){this._value=-1,this._min=$j,this._max=$j<$O?$O:$j,this.value=$V<$j?$j:$O<$V?$O:$V},$j.changeValue=function(){var $j=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$j)/$j,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $O=this._max-this._min;0===$O&&($O=1),this.isVertical?(this._bar.y=(this._value-this._min)/$O*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$O*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$j.onBgMouseDown=function($j){var $O=this._bg.getMousePoint();this.isVertical?this.value=$O.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$O.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$m(0,$j,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$m(0,$j,"skin",function(){return this._skin},function($j){if(this._skin!=$j){this._skin=$j,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $O=this._skin.replace(".png","$progress.png");$a.getRes($O)&&(this._progress||(this.addChild(this._progress=new $X),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$O),this.setBarPoint(),this.callLater(this.changeValue)}}),$m(0,$j,"allowClickBack",function(){return this._allowClickBack},function($j){this._allowClickBack!=$j&&((this._allowClickBack=$j)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$m(0,$j,"max",function(){return this._max},function($j){this._max!=$j&&(this._max=$j,this.callLater(this.changeValue))}),$m(0,$j,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$m(0,$j,"tick",function(){return this._tick},function($j){this._tick!=$j&&(this._tick=$j,this.callLater(this.changeValue))}),$m(0,$j,"sizeGrid",function(){return this._bg.sizeGrid},function($j){this._bg.sizeGrid=$j,this._bar.sizeGrid=$j,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$m(0,$j,"min",function(){return this._min},function($j){this._min!=$j&&(this._min=$j,this.callLater(this.changeValue))}),$m(0,$j,"value",function(){return this._value},function($j){if(this._value!=$j){var $O=this._value;this._value=$j,this.changeValue(),this._value!=$O&&this.sendChangeEvent()}}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)||"string"==typeof $j?this.value=Number($j):$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"bar",function(){return this._bar}),$l($V,["label",function(){return this.label=new $f}]),$V}($Y),$X=function($O){function $V($j){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$V.__super.call(this),this.skin=$j}$S($V,"laya.ui.Image",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$a.clearCache(this,this._skin)},$j.dispose=function(){this.destroy(!0),$a.clearCache(this,this._skin),this.clearEvent()},$j.createChildren=function(){this.graphics=this._bitmap=new $v},$j.setSource=function($j,$O){this.destroyed||$j===this._skin&&$O&&(this.source=$O,this.onCompResize(),this.clearEvent())},$j.clearEvent=function(){this._skin&&$T.atalsNotify&&$T.atalsNotify.off(this._skin,this,this.setSource)},$j.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$b.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$m(0,$j,"source",function(){return this._bitmap.source},function($j){this._bitmap&&(this._bitmap.source=$j,this.event("loaded"),this.repaint())}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"string"==typeof(this._dataSource=$j)?this.skin=$j:$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"measureHeight",function(){return this._bitmap.height}),$m(0,$j,"skin",function(){return this._skin},function($j){if(this._skin!=$j)if($a.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$j){$a.keepCache(this,this._skin);var $O=$a.getRes($j),$V=$T.resAtalsObj&&$T.resAtalsObj[this._skin];$O?(this.source=$O,this.onCompResize()):$V?($T.atalsNotify&&$T.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$V.sourceW),0==this.height&&(this.height=$V.sourceH)):(this._complete=$t.create(this,this.setSource,[this._skin]),this._progress=null,$b.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$m(0,$j,"group",function(){return this._group},function($j){$j&&this._skin&&$a.setGroup(this._skin,$j),this._group=$j}),$m(0,$j,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($j){this._bitmap.sizeGrid=$B.fillArray($_.defaultSizeGrid,$j,Number)}),$m(0,$j,"measureWidth",function(){return this._bitmap.width}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($Y,this,"width",$j),this._bitmap.width=0==$j?1e-7:$j}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($Y,this,"height",$j),this._bitmap.height=0==$j?1e-7:$j}),$V}($Y),$f=function($O){function $V($j){this._tf=null,$V.__super.call(this),void 0===$j&&($j=""),$g.defaultColor=$_.labelColor,this.text=$j}$S($V,"laya.ui.Label",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._tf=null},$j.createChildren=function(){this.addChild(this._tf=new $Z)},$j.changeText=function($j){this._tf.changeText($j)},$m(0,$j,"padding",function(){return this._tf.padding.join(",")},function($j){this._tf.padding=$B.fillArray($_.labelPadding,$j,Number)}),$m(0,$j,"bold",function(){return this._tf.bold},function($j){this._tf.bold=$j}),$m(0,$j,"align",function(){return this._tf.align},function($j){this._tf.align=$j}),$m(0,$j,"text",function(){return this._tf.text},function($j){this._tf.text!=$j&&($j&&($j=$B.adptString($j+"")),this._tf.text=$j,this.event("change"),this._width&&this._height||this.onCompResize())}),$m(0,$j,"italic",function(){return this._tf.italic},function($j){this._tf.italic=$j}),$m(0,$j,"wordWrap",function(){return this._tf.wordWrap},function($j){this._tf.wordWrap=$j}),$m(0,$j,"font",function(){return this._tf.font},function($j){this._tf.font=$j}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)||"string"==typeof $j?this.text=$j+"":$b.superSet($Y,this,"dataSource",$j)}),$m(0,$j,"color",function(){return this._tf.color},function($j){this._tf.color=$j}),$m(0,$j,"valign",function(){return this._tf.valign},function($j){this._tf.valign=$j}),$m(0,$j,"leading",function(){return this._tf.leading},function($j){this._tf.leading=$j}),$m(0,$j,"fontSize",function(){return this._tf.fontSize},function($j){this._tf.fontSize=$j}),$m(0,$j,"bgColor",function(){return this._tf.bgColor},function($j){this._tf.bgColor=$j}),$m(0,$j,"borderColor",function(){return this._tf.borderColor},function($j){this._tf.borderColor=$j}),$m(0,$j,"stroke",function(){return this._tf.stroke},function($j){this._tf.stroke=$j}),$m(0,$j,"strokeColor",function(){return this._tf.strokeColor},function($j){this._tf.strokeColor=$j}),$m(0,$j,"textField",function(){return this._tf}),$m(0,$j,"measureWidth",function(){return this._tf.width}),$m(0,$j,"measureHeight",function(){return this._tf.height}),$m(0,$j,"width",function(){return this._width||this._tf.text?$b.superGet($Y,this,"width"):0},function($j){$b.superSet($Y,this,"width",$j),this._tf.width=$j}),$m(0,$j,"height",function(){return this._height||this._tf.text?$b.superGet($Y,this,"height"):0},function($j){$b.superSet($Y,this,"height",$j),this._tf.height=$j}),$m(0,$j,"overflow",function(){return this._tf.overflow},function($j){this._tf.overflow=$j}),$m(0,$j,"underline",function(){return this._tf.underline},function($j){this._tf.underline=$j}),$m(0,$j,"underlineColor",function(){return this._tf.underlineColor},function($j){this._tf.underlineColor=$j}),$V}($Y),$C=function($O){function $V($j){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$V.__super.call(this),this.skin=$j}$S($V,"laya.ui.ProgressBar",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._bg&&this._bg.destroy($j),this._bar&&this._bar.destroy($j),this._bg=this._bar=null,this.changeHandler=null},$j.createChildren=function(){this.addChild(this._bg=new $X),this.addChild(this._bar=new $X)},$j.changeValue=function(){if(this.sizeGrid){var $j=this.sizeGrid.split(","),$O=Number($j[3]),$V=Number($j[1]),$l=(this.width-$O-$V)*this._value;this._bar.width=$O+$V+$l,this._bar.visible=this._bar.width>$O+$V}else this._bar.width=this.width*this._value},$m(0,$j,"measureHeight",function(){return this._bg.height}),$m(0,$j,"skin",function(){return this._skin},function($j){this._skin!=$j&&(this._skin=$j,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$m(0,$j,"measureWidth",function(){return this._bg.width}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($Y,this,"height",$j),this._bg.height=this._height,this._bar.height=this._height}),$m(0,$j,"bar",function(){return this._bar}),$m(0,$j,"value",function(){return this._value},function($j){this._value!=$j&&($j=1<$j?1:$j<0?0:$j,this._value=$j,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($j))}),$m(0,$j,"bg",function(){return this._bg}),$m(0,$j,"sizeGrid",function(){return this._bg.sizeGrid},function($j){this._bg.sizeGrid=this._bar.sizeGrid=$j}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($Y,this,"width",$j),this._bg.width=this._width,this.callLater(this.changeValue)}),$m(0,$j,"dataSource",$O.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)||"string"==typeof $j?this.value=Number($j):$b.superSet($Y,this,"dataSource",$j)}),$V}($Y),$J=(function($j){function $V(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$V.__super.call(this),this._tipBox=new $Y,this._tipBox.addChild(this._tipText=new $Z),this._tipText.x=this._tipText.y=5,this._tipText.color=$V.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$b.stage.on("showtip",this,this._onStageShowTip),$b.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$S($V,"laya.ui.TipManager",$Y);var $O=$V.prototype;$O._onStageHideTip=function($j){$b.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$O._onStageShowTip=function($j){$b.timer.once($V.tipDelay,this,this._showTip,[$j],!0)},$O._showTip=function($j){if("string"==typeof $j){var $O=String($j);Boolean($O)&&this._defaultTipHandler($O)}else $j instanceof laya.utils.Handler?$j.run():"function"==typeof $j&&$j.apply();$b.stage.on("mousemove",this,this._onStageMouseMove),$b.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$O._onStageMouseDown=function($j){this.closeAll()},$O._onStageMouseMove=function($j){this._showToStage(this,$V.offsetX,$V.offsetY)},$O._showToStage=function($j,$O,$V){void 0===$O&&($O=0),void 0===$V&&($V=0);var $l=$j.getBounds();$j.x=$b.stage.mouseX+$O,$j.y=$b.stage.mouseY+$V,$j.x+$l.width>$b.stage.width&&($j.x-=$l.width+$O),$j.y+$l.height>$b.stage.height&&($j.y-=$l.height+$V)},$O.closeAll=function(){$b.timer.clear(this,this._showTip),$b.stage.off("mousemove",this,this._onStageMouseMove),$b.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$O.showDislayTip=function($j){this.addChild($j),this._showToStage(this),$b._currentStage.addChild(this)},$O._showDefaultTip=function($j){this._tipText.text=$j;var $O=this._tipBox.graphics;$O.clear(),$O.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$V.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$b._currentStage.addChild(this)},$m(0,$O,"defaultTipHandler",function(){return this._defaultTipHandler},function($j){this._defaultTipHandler=$j}),$V.offsetX=10,$V.offsetY=15,$V.tipTextColor="#ffffff",$V.tipBackColor="#111111",$V.tipDelay=200}(),function($j){var $w;function $s(){this._idMap=null,this._aniList=null,this._watchMap={},$s.__super.call(this)}$S($s,"laya.ui.View",$q);var $O=$s.prototype;return $O.createView=function($j){if($j.animations&&!this._idMap&&(this._idMap={}),$s.createComp($j,this,this),$j.animations){var $O,$V,$l=[],$T=$j.animations,$S=0,$m=$T.length;for($S=0;$S<$m;$S++){switch($O=new $e,$V=$T[$S],$O._setUp(this._idMap,$V),(this[$V.name]=$O)._setControlNode(this),$V.action){case 1:$O.play(0,!1);break;case 2:$O.play(0,!0)}$l.push($O)}this._aniList=$l}0<this._width&&null==$j.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$O.onEvent=function($j,$O){},$O.loadUI=function($j){var $O=$s.uiMap[$j];$O&&this.createView($O)},$O.destroy=function($j){void 0===$j&&($j=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$j)},$O.changeData=function($j){var $O=this._watchMap[$j];if($O){console.log("change",$j);for(var $V=0,$l=$O.length;$V<$l;$V++){$O[$V].exe(this)}}},$s._regs=function(){for(var $j in $s.uiClassMap)$r.regClass($j,$s.uiClassMap[$j])},$s.createComp=function($j,$O,$V,$l){if(!($O=$O||$s.getCompInstance($j)))return console.warn("can not create:"+$j.type),null;var $T=$j.child;if($T)for(var $S=$O instanceof laya.ui.List,$m=0,$p=$T.length;$m<$p;$m++){var $o=$T[$m];if(!$O.hasOwnProperty("itemRender")||"render"!=$o.props.name&&"render"!==$o.props.renderType)if("Graphic"==$o.type)$r.addGraphicsToSprite($o,$O);else if($r.isDrawType($o.type))$r.addGraphicToSprite($o,$O,!0);else{if($S){var $H=[],$g=$s.createComp($o,null,$V,$H);$H.length&&($g._$bindData=$H)}else $g=$s.createComp($o,null,$V,$l);"Script"==$o.type?"owner"in $g?$g.owner=$O:"target"in $g&&($g.target=$O):"mask"==$o.props.renderType||"mask"==$o.props.name?$O.mask=$g:$g instanceof laya.display.Sprite&&$O.addChild($g)}else $O.itemRender=$o}var $e=$j.props;for(var $t in $e){var $w=$e[$t];$s.eventDic[$t]?$w&&$V&&$O.on($t,$V,$V.onEvent,[$w]):$s.setCompValue($O,$t,$w,$V,$l)}return $b.__typeof($O,"laya.ui.IItem")&&$O.initItems(),$j.compId&&$V&&$V._idMap&&($V._idMap[$j.compId]=$O),$O},$s.setCompValue=function($j,$O,$V,$l,$T){if("string"==typeof $V&&-1<$V.indexOf("${")){if($s._sheet||($s._sheet=$r.getClass("laya.data.Table")),!$s._sheet)return void console.warn("Can not find class Sheet");if($T)$T.push($j,$O,$V);else if($l){-1==$V.indexOf("].")&&($V=$V.replace(".","[0]."));var $S,$m,$p=new $w($j,$O,$V);$p.exe($l);for(var $o=$V.replace(/\[.*?\]\./g,".");null!=($S=$s._parseWatchData.exec($o));){for(var $H=$S[1];null!=($m=$s._parseKeyWord.exec($H));){var $g=$m[0],$e=$l._watchMap[$g]||($l._watchMap[$g]=[]);$e.push($p),$s._sheet.I.notifer.on($g,$l,$l.changeData,[$g])}($e=$l._watchMap[$H]||($l._watchMap[$H]=[])).push($p),$s._sheet.I.notifer.on($H,$l,$l.changeData,[$H])}}}else if("var"===$O&&$l)$l[$V]=$j;else if("onClick"==$O){var $t=$b._runScript("(function(){"+$V+"})");$j.on("click",$l,$t)}else $j[$O]="true"===$V||"false"!==$V&&$V},$s.getCompInstance=function($j){var $O,$V=$j.props?$j.props.runtime:null;return $O=$V?$s.viewClassMap[$V]||$s.uiClassMap[$V]||$b.__classmap[$V]:$s.uiClassMap[$j.type],$j.props&&$j.props.hasOwnProperty("renderType")&&"instance"==$j.props.renderType?$O.instance:$O?new $O:null},$s.regComponent=function($j,$O){$s.uiClassMap[$j]=$O,$r.regClass($j,$O)},$s.regViewRuntime=function($j,$O){$s.viewClassMap[$j]=$O},$s.uiMap={},$s.viewClassMap={},$s._sheet=null,$l($s,["uiClassMap",function(){return this.uiClassMap={ViewStack:$jj,LinkButton:$i,TextArea:$Hj,ColorPicker:$n,Box:$q,Button:$i,CheckBox:$u,Clip:$k,ComboBox:$G,Component:$Y,HScrollBar:$d,HSlider:$Q,Image:$X,Label:$f,List:$K,Panel:$L,ProgressBar:$C,Radio:$I,RadioGroup:$pj,ScrollBar:$F,Slider:$N,Tab:$oj,TextInput:$Vj,View:$s,VScrollBar:$Oj,VSlider:$lj,Tree:$P,HBox:$Sj,VBox:$mj,Sprite:$A,Animation:$V,Text:$Z,FontClip:$W}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$s.__init$=function(){$s._regs(),$w=function(){function $j($j,$O,$V){this.comp=null,this.prop=null,this.value=null,this.comp=$j,this.prop=$O,this.value=$V}return $S($j,""),$j.prototype.exe=function($j){var $O=$B.getBindFun(this.value);this.comp[this.prop]=$O.call(this,$j)},$j}()},$s}()),$u=function($j){function $V($j,$O){void 0===$O&&($O=""),$V.__super.call(this,$j,$O)}$S($V,"laya.ui.CheckBox",$j);var $O=$V.prototype;return $O.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$O.initialize=function(){$j.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$m(0,$O,"dataSource",$j.prototype._$get_dataSource,function($j){"boolean"==typeof(this._dataSource=$j)?this.selected=$j:"string"==typeof $j?this.selected="true"===$j:$b.superSet($i,this,"dataSource",$j)}),$V}($i),$y=function($j){function $O(){this._space=0,this._align="none",this._itemChanged=!1,$O.__super.call(this)}$S($O,"laya.ui.LayoutBox",$q);var $V=$O.prototype;return $V.addChild=function($j){return $j.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$j)},$V.onResize=function($j){this._setItemChanged()},$V.addChildAt=function($j,$O){return $j.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$j,$O)},$V.removeChild=function($j){return $j.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$j)},$V.removeChildAt=function($j){return this.getChildAt($j).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$j)},$V.refresh=function(){this._setItemChanged()},$V.changeItems=function(){this._itemChanged=!1},$V.sortItem=function($j){$j&&$j.sort(function($j,$O){return $j.y-$O.y})},$V._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$m(0,$V,"space",function(){return this._space},function($j){this._space=$j,this._setItemChanged()}),$m(0,$V,"align",function(){return this._align},function($j){this._align=$j,this._setItemChanged()}),$O}(),$W=function($O){function $V($j,$O){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$V.__super.call(this),$j&&(this.skin=$j),$O&&(this.sheet=$O)}$S($V,"laya.ui.FontClip",$O);var $j=$V.prototype;return $j.createChildren=function(){this._bitmap=new $v,this.on("loaded",this,this._onClipLoaded)},$j._onClipLoaded=function(){this.callLater(this.changeValue)},$j.changeValue=function(){var $j;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$j=this._sources[0]))){var $O="horizontal"===this._direction;$O?(this._wordsW=this._valueArr.length*($j.sourceWidth+this.spaceX),this._wordsH=$j.sourceHeight):(this._wordsW=$j.sourceWidth,this._wordsH=($j.sourceHeight+this.spaceY)*this._valueArr.length);var $V=0;if(this._width)switch(this._align){case"center":$V=.5*(this._width-this._wordsW);break;case"right":$V=this._width-this._wordsW;break;default:$V=0}for(var $l=0,$T=this._valueArr.length;$l<$T;$l++){var $S=this._indexMap[this._valueArr.charAt($l)];this.sources[$S]&&($j=this.sources[$S],$O?this.graphics.drawTexture($j,$V+$l*($j.sourceWidth+this.spaceX),0,$j.sourceWidth,$j.sourceHeight):this.graphics.drawTexture($j,0+$V,$l*($j.sourceHeight+this.spaceY),$j.sourceWidth,$j.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$j.destroy=function($j){void 0===$j&&($j=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$O.prototype.destroy.call(this,$j)},$m(0,$j,"sheet",function(){return this._sheet},function($j){$j+="";var $O=(this._sheet=$j).split(" ");this._clipX=String($O[0]).length,this.clipY=$O.length,this._indexMap={};for(var $V=0;$V<this._clipY;$V++)for(var $l=$O[$V].split(""),$T=0,$S=$l.length;$T<$S;$T++)this._indexMap[$l[$T]]=$V*this._clipX+$T}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($k,this,"height",$j),this.callLater(this.changeValue)}),$m(0,$j,"direction",function(){return this._direction},function($j){this._direction=$j,this.callLater(this.changeValue)}),$m(0,$j,"value",function(){return this._valueArr?this._valueArr:""},function($j){$j+="",this._valueArr=$j,this.callLater(this.changeValue)}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($k,this,"width",$j),this.callLater(this.changeValue)}),$m(0,$j,"spaceX",function(){return this._spaceX},function($j){this._spaceX=$j,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$m(0,$j,"spaceY",function(){return this._spaceY},function($j){this._spaceY=$j,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$m(0,$j,"align",function(){return this._align},function($j){this._align=$j,this.callLater(this.changeValue)}),$m(0,$j,"measureWidth",function(){return this._wordsW}),$m(0,$j,"measureHeight",function(){return this._wordsH}),$V}($k),$K=function($j){function $O(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $s,$O.__super.call(this)}$S($O,"laya.ui.List",$j);var $V=$O.prototype;return $b.imps($V,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$V.destroy=function($j){void 0===$j&&($j=!0),this._content&&this._content.destroy($j),this._scrollBar&&this._scrollBar.destroy($j),laya.ui.Component.prototype.destroy.call(this,$j),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$V.createChildren=function(){this.addChild(this._content=new $q)},$V.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$b.superGet($q,this,"cacheAs")),$b.superSet($q,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$V.onScrollEnd=function(){$b.superSet($q,this,"cacheAs",this._$P.cacheAs)},$V._removePreScrollBar=function(){var $j=this.removeChildByName("scrollBar");$j&&$j.destroy(!0)},$V.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $j=this._getOneCell(),$O=$j.width+this._spaceX||1,$V=$j.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$O):Math.ceil(this._width/$O)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$V):Math.round(this._height/$V));var $l=this._width?this._width:$O*this.repeatX-this._spaceX,$T=this._height?this._height:$V*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$V:$O,this._cellOffset=this._isVertical?$V*Math.max(this._repeatY2,this._repeatY)-$T-this._spaceY:$O*Math.max(this._repeatX2,this._repeatX)-$l-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$T:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$l),this.setContentSize($l,$T);var $S=this._isVertical?this.repeatX:this.repeatY,$m=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$S,$m),this._createdLine=$m,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$V._getOneCell=function(){if(0===this._cells.length){var $j=this.createItem();if(this._offset.setTo($j.x,$j.y),this.cacheContent)return $j;this._cells.push($j)}return this._cells[0]},$V._createItems=function($j,$O,$V){var $l=this._content,$T=this._getOneCell(),$S=$T.width+this._spaceX,$m=$T.height+this._spaceY;if(this.cacheContent){var $p=new $q;$p.cacheAsBitmap=!0,$p.pos((this._isVertical?0:$j)*$S,(this._isVertical?$j:0)*$m),this._content.addChild($p),this._content.optimizeScrollRect=!0,$l=$p}else{for(var $o=[],$H=this._cells.length-1;-1<$H;$H--){var $g=this._cells[$H];$g.removeSelf(),$o.push($g)}this._cells.length=0}for(var $e=$j;$e<$V;$e++)for(var $t=0;$t<$O;$t++)($T=$o&&$o.length?$o.pop():this.createItem()).x=(this._isVertical?$t:$e)*$S-$l.x,$T.y=(this._isVertical?$e:$t)*$m-$l.y,$T.name="item"+($e*$O+$t),$l.addChild($T),this.addCell($T)},$V.createItem=function(){var $j=[];if("function"==typeof this._itemRender)var $O=new this._itemRender;else $O=$J.createComp(this._itemRender,null,null,$j);if(0==$j.length&&$O._watchMap){var $V=$O._watchMap;for(var $l in $V)for(var $T=$V[$l],$S=0;$S<$T.length;$S++){var $m=$T[$S];$j.push($m.comp,$m.prop,$m.value)}}return $j.length&&($O._$bindData=$j),$O},$V.addCell=function($j){$j.on("click",this,this.onCellMouse),$j.on("rightclick",this,this.onCellMouse),$j.on("mouseover",this,this.onCellMouse),$j.on("mouseout",this,this.onCellMouse),$j.on("mousedown",this,this.onCellMouse),$j.on("mouseup",this,this.onCellMouse),this._cells.push($j)},$V.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $j=0,$O=$j=0;$O<1e4;$O++){var $V=this.getChildByName("item"+$O);if(!$V)break;this.addCell($V),$j++}this.repeatY=$j}},$V.setContentSize=function($j,$O){this._content.width=$j,this._content.height=$O,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $h),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$j,$O),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$V.onCellMouse=function($j){"mousedown"===$j.type&&(this._isMoved=!1);var $O=$j.currentTarget,$V=this._startIndex+this._cells.indexOf($O);$V<0||("click"===$j.type||"rightclick"===$j.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$V:this.changeCellState($O,!0,0):"mouseover"!==$j.type&&"mouseout"!==$j.type||this._selectedIndex===$V||this.changeCellState($O,"mouseover"===$j.type,0),this.mouseHandler&&this.mouseHandler.runWith([$j,$V]))},$V.changeCellState=function($j,$O,$V){var $l=$j.getChildByName("selectBox");$l&&(this.selectEnable=!0,$l.visible=$O,$l.index=$V)},$V.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$V.onScrollBarChange=function($j){this.runCallLater(this.changeCells);var $O=this._scrollBar.value,$V=this._isVertical?this.repeatX:this.repeatY,$l=this._isVertical?this.repeatY:this.repeatX,$T=Math.floor($O/this._cellSize);if(this.cacheContent)$m=$l+1,this._createdLine-$T<$m&&(this._createItems(this._createdLine,$V,this._createdLine+$m),this.renderItems(this._createdLine*$V,0),this._createdLine+=$m);else{var $S=$T*$V,$m=0;if($S>this._startIndex){$m=$S-this._startIndex;var $p=!0,$o=this._startIndex+$V*($l+1);this._isMoved=!0}else $S<this._startIndex&&($m=this._startIndex-$S,$p=!1,$o=this._startIndex-1,this._isMoved=!0);for(var $H=0;$H<$m;$H++){if($p){var $g=this._cells.shift();this._cells[this._cells.length]=$g;var $e=$o+$H}else $g=this._cells.pop(),this._cells.unshift($g),$e=$o-$H;var $t=Math.floor($e/$V)*this._cellSize;this._isVertical?$g.y=$t:$g.x=$t,this.renderItem($g,$e)}this._startIndex=$S,this.changeSelectStatus()}var $w=this._content.scrollRect;this._isVertical?($w.y=$O-this._offset.y,$w.x=-this._offset.x):($w.y=-this._offset.y,$w.x=$O-this._offset.x),this._content.scrollRect=$w},$V.posCell=function($j,$O){if(this._scrollBar){var $V=this._isVertical?this.repeatX:this.repeatY,$l=(this._isVertical?this.repeatY:this.repeatX,Math.floor($O/$V)*this._cellSize);this._isVertical?$j.y=$l:$j.x=$l}},$V.changeSelectStatus=function(){for(var $j=0,$O=this._cells.length;$j<$O;$j++)this.changeCellState(this._cells[$j],this._selectedIndex===this._startIndex+$j,1)},$V.renderItems=function($j,$O){void 0===$j&&($j=0),void 0===$O&&($O=0);for(var $V=$j,$l=$O||this._cells.length;$V<$l;$V++)this.renderItem(this._cells[$V],this._startIndex+$V);this.changeSelectStatus(),this._twDone=!0},$V.renderItem=function($j,$O){this._array&&0<=$O&&$O<this._array.length?($j.visible=!0,$j._$bindData?($j._dataSource=this._array[$O],this._bindData($j,this._array[$O])):$j.dataSource=this._array[$O],this.cacheContent||this.posCell($j,$O),this.hasListener("render")&&this.event("render",[$j,$O]),this.renderHandler&&this.renderHandler.runWith([$j,$O]),this.renderTwHandler&&this.renderTwHandler.runWith([$j,$O])):($j.visible=!1,$j.dataSource=null)},$V._bindData=function($j,$O){for(var $V=$j._$bindData,$l=0,$T=$V.length;$l<$T;$l++){var $S=$V[$l++],$m=$V[$l++],$p=$V[$l],$o=$B.getBindFun($p);$S[$m]=$o.call(this,$O)}},$V.refresh=function(){this.array=this._array},$V.getItem=function($j){return-1<$j&&$j<this._array.length?this._array[$j]:null},$V.changeItem=function($j,$O){-1<$j&&$j<this._array.length&&(this._array[$j]=$O,$j>=this._startIndex&&$j<this._startIndex+this._cells.length&&this.renderItem(this.getCell($j),$j))},$V.setItem=function($j,$O){this.changeItem($j,$O)},$V.addItem=function($j){this._array.push($j),this.array=this._array},$V.addItemAt=function($j,$O){this._array.splice($O,0,$j),this.array=this._array},$V.deleteItem=function($j){this._array.splice($j,1),this.array=this._array},$V.getCell=function($j){return this.runCallLater(this.changeCells),-1<$j&&this._cells?this._cells[($j-this._startIndex)%this._cells.length]:null},$V.scrollTo=function($j){if(this._scrollBar){var $O=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($j/$O)*this._cellSize}else this.startIndex=$j},$V.tweenTo=function($j,$O,$V){if(void 0===$O&&($O=200),this._scrollBar){var $l=this._isVertical?this.repeatX:this.repeatY;$E.to(this._scrollBar,{value:Math.floor($j/$l)*this._cellSize},$O,null,$V,0,!0)}else this.startIndex=$j,$V&&$V.run()},$V._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$V.commitMeasure=function(){this.runCallLater(this.changeCells)},$m(0,$V,"cacheAs",$j.prototype._$get_cacheAs,function($j){$b.superSet($q,this,"cacheAs",$j),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$j?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$m(0,$V,"content",function(){return this._content}),$m(0,$V,"height",$j.prototype._$get_height,function($j){$j!=this._height&&($b.superSet($q,this,"height",$j),this._setCellChanged())}),$m(0,$V,"itemRender",function(){return this._itemRender},function($j){if(this._itemRender!=$j){this._itemRender=$j;for(var $O=this._cells.length-1;-1<$O;$O--)this._cells[$O].destroy();this._cells.length=0,this._setCellChanged()}}),$m(0,$V,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($j){this._removePreScrollBar();var $O=new $Oj;$O.name="scrollBar",$O.right=0,$j&&" "!=$j&&($O.skin=$j),this.scrollBar=$O,this.addChild($O),this._setCellChanged()}),$m(0,$V,"page",function(){return this._page},function($j){this._page=$j,this._array&&(this._page=0<$j?$j:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$m(0,$V,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($j){this._removePreScrollBar();var $O=new $d;$O.name="scrollBar",$O.bottom=0,$j&&" "!=$j&&($O.skin=$j),this.scrollBar=$O,this.addChild($O),this._setCellChanged()}),$m(0,$V,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($j){this._repeatX=$j,this._setCellChanged()}),$m(0,$V,"scrollBar",function(){return this._scrollBar},function($j){this._scrollBar!=$j&&(this._scrollBar=$j)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$m(0,$V,"width",$j.prototype._$get_width,function($j){$j!=this._width&&($b.superSet($q,this,"width",$j),this._setCellChanged())}),$m(0,$V,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($j){this._repeatY=$j,this._setCellChanged()}),$m(0,$V,"spaceX",function(){return this._spaceX},function($j){this._spaceX=$j,this._setCellChanged()}),$m(0,$V,"spaceY",function(){return this._spaceY},function($j){this._spaceY=$j,this._setCellChanged()}),$m(0,$V,"selectedIndex",function(){return this._selectedIndex},function($j){this._selectedIndex!=$j&&(this._selectedIndex=$j,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($j),this.startIndex=this._startIndex)}),$m(0,$V,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($j){this.selectedIndex=this._array.indexOf($j)}),$m(0,$V,"length",function(){return this._array?this._array.length:0}),$m(0,$V,"selection",function(){return this.getCell(this._selectedIndex)},function($j){this.selectedIndex=this._startIndex+this._cells.indexOf($j)}),$m(0,$V,"startIndex",function(){return this._startIndex},function($j){this._startIndex=0<$j?$j:0,this.callLater(this.renderItems)}),$m(0,$V,"twSwitch",function(){return this._twSwitch},function($j){this._twSwitch=$j}),$m(0,$V,"twDone",function(){return this._twDone},function($j){this._twDone=$j}),$m(0,$V,"array",function(){return this._array},function($j){this.runCallLater(this.changeCells),this._array=$j||[];var $O=this._array.length;if(this.totalPage=Math.ceil($O/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$O?this._selectedIndex:$O-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $V=this._isVertical?this.repeatX:this.repeatY,$l=this._isVertical?this.repeatY:this.repeatX,$T=Math.ceil($O/$V);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$l/$T,this._scrollBar.setScroll(0,($T-$l)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$m(0,$V,"dataSource",$j.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)&&Math.floor($j)==$j||"string"==typeof $j?this.selectedIndex=parseInt($j):$j instanceof Array?this.array=$j:$b.superSet($q,this,"dataSource",$j)}),$m(0,$V,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$O}($q),$d=function($j){function $O(){$O.__super.call(this)}return $S($O,"laya.ui.HScrollBar",$j),$O.prototype.initialize=function(){$j.prototype.initialize.call(this),this.slider.isVertical=!1},$O}($F),$L=function($j){function $O(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$O.__super.call(this),this.width=this.height=100}$S($O,"laya.ui.Panel",$j);var $V=$O.prototype;return $V.destroy=function($j){void 0===$j&&($j=!0),laya.ui.Component.prototype.destroy.call(this,$j),this._content&&this._content.destroy($j),this._vScrollBar&&this._vScrollBar.destroy($j),this._hScrollBar&&this._hScrollBar.destroy($j),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$V.destroyChildren=function(){this._content.destroyChildren()},$V.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $q)},$V.addChild=function($j){return $j.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($j)},$V.onResize=function(){this._setScrollChanged()},$V.addChildAt=function($j,$O){return $j.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($j,$O)},$V.removeChild=function($j){return $j.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($j)},$V.removeChildAt=function($j){return this.getChildAt($j).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($j)},$V.removeChildren=function($j,$O){return void 0===$j&&($j=0),void 0===$O&&($O=2147483647),this._content.removeChildren($j,$O),this._setScrollChanged(),this},$V.getChildAt=function($j){return this._content.getChildAt($j)},$V.getChildByName=function($j){return this._content.getChildByName($j)},$V.getChildIndex=function($j){return this._content.getChildIndex($j)},$V.changeScroll=function(){this._scrollChanged=!1;var $j=this.contentWidth||1,$O=this.contentHeight||1,$V=this._vScrollBar,$l=this._hScrollBar,$T=$V&&$O>this._height,$S=$l&&$j>this._width,$m=$T?this._width-$V.width:this._width,$p=$S?this._height-$l.height:this._height;$V&&($V.x=this._width-$V.width,$V.y=0,$V.height=this._height-($S?$l.height:0),$V.scrollSize=Math.max(.033*this._height,1),$V.thumbPercent=$p/$O,$V.setScroll(0,$O-$p,$V.value)),$l&&($l.x=0,$l.y=this._height-$l.height,$l.width=this._width-($T?$V.width:0),$l.scrollSize=Math.max(.033*this._width,1),$l.thumbPercent=$m/$j,$l.setScroll(0,$j-$m,$l.value))},$V.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$V.setContentSize=function($j,$O){var $V=this._content;$V.width=$j,$V.height=$O,$V.scrollRect||($V.scrollRect=new $h),$V.scrollRect.setTo(0,0,$j,$O),$V.scrollRect=$V.scrollRect},$V.onScrollBarChange=function($j){var $O=this._content.scrollRect;if($O){var $V=Math.round($j.value);$j.isVertical?$O.y=$V:$O.x=$V,this._content.scrollRect=$O}},$V.scrollTo=function($j,$O){void 0===$j&&($j=0),void 0===$O&&($O=0),this.vScrollBar&&(this.vScrollBar.value=$O),this.hScrollBar&&(this.hScrollBar.value=$j)},$V.refresh=function(){this.changeScroll()},$V.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$b.superGet($q,this,"cacheAs")),$b.superSet($q,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$V.onScrollEnd=function(){$b.superSet($q,this,"cacheAs",this._$P.cacheAs)},$V._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$m(0,$V,"numChildren",function(){return this._content.numChildren}),$m(0,$V,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($j){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $d),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$j}),$m(0,$V,"contentWidth",function(){for(var $j=0,$O=this._content.numChildren-1;-1<$O;$O--){var $V=this._content.getChildAt($O);$j=Math.max($V.x+$V.width*$V.scaleX,$j)}return $j}),$m(0,$V,"contentHeight",function(){for(var $j=0,$O=this._content.numChildren-1;-1<$O;$O--){var $V=this._content.getChildAt($O);$j=Math.max($V.y+$V.height*$V.scaleY,$j)}return $j}),$m(0,$V,"width",$j.prototype._$get_width,function($j){$b.superSet($q,this,"width",$j),this._setScrollChanged()}),$m(0,$V,"hScrollBar",function(){return this._hScrollBar}),$m(0,$V,"content",function(){return this._content}),$m(0,$V,"height",$j.prototype._$get_height,function($j){$b.superSet($q,this,"height",$j),this._setScrollChanged()}),$m(0,$V,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($j){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $Oj),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$j}),$m(0,$V,"vScrollBar",function(){return this._vScrollBar}),$m(0,$V,"cacheAs",$j.prototype._$get_cacheAs,function($j){$b.superSet($q,this,"cacheAs",$j),this._$P.cacheAs=null,"none"!==$j?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$O}($q),$Q=function($j){function $O($j){$O.__super.call(this,$j),this.isVertical=!1}return $S($O,"laya.ui.HSlider",$N),$O}(),$D=function($j){function $V($j,$O){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$V.__super.call(this),this.skin=$O,this.labels=$j}$S($V,"laya.ui.UIGroup",$j);var $O=$V.prototype;return $b.imps($O,{"laya.ui.IItem":!0}),$O.preinitialize=function(){this.mouseEnabled=!0},$O.destroy=function($j){void 0===$j&&($j=!0),laya.ui.Component.prototype.destroy.call(this,$j),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$O.addItem=function($j,$O){void 0===$O&&($O=!0);var $V=$j,$l=this._items.length;if($V.name="item"+$l,this.addChild($V),this.initItems(),$O&&0<$l){var $T=this._items[$l-1];"horizontal"==this._direction?$V.x=$T.x+$T.width+this._space:$V.y=$T.y+$T.height+this._space}else $O&&($V.x=0,$V.y=0);return $l},$O.delItem=function($j,$O){void 0===$O&&($O=!0);var $V=this._items.indexOf($j);if(-1!=$V){var $l=$j;this.removeChild($l);for(var $T=$V+1,$S=this._items.length;$T<$S;$T++){var $m=this._items[$T];$m.name="item"+($T-1),$O&&("horizontal"==this._direction?$m.x-=$l.width+this._space:$m.y-=$l.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $p;$p=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$p}}},$O.initItems=function(){this._items||(this._items=[]);for(var $j=this._items.length=0;$j<1e4;$j++){var $O=this.getChildByName("item"+$j);if(null==$O)break;this._items.push($O),$O.selected=$j===this._selectedIndex,$O.clickHandler=$t.create(this,this.itemClick,[$j],!1)}},$O.itemClick=function($j){this.selectedIndex=$j},$O.setSelect=function($j,$O){this._items&&-1<$j&&$j<this._items.length&&(this._items[$j].selected=$O)},$O.createItem=function($j,$O){return null},$O.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $j=0,$O=0,$V=this._items.length;$O<$V;$O++){var $l=this._items[$O];this._skin&&($l.skin=this._skin),this._labelColors&&($l.labelColors=this._labelColors),this._labelSize&&($l.labelSize=this._labelSize),this._labelStroke&&($l.labelStroke=this._labelStroke),this._labelStrokeColor&&($l.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($l.strokeColors=this._strokeColors),this._labelBold&&($l.labelBold=this._labelBold),this._labelPadding&&($l.labelPadding=this._labelPadding),this._labelAlign&&($l.labelAlign=this._labelAlign),this._stateNum&&($l.stateNum=this._stateNum),this._labelFont&&($l.labelFont=this._labelFont),"horizontal"===this._direction?($l.y=0,$l.x=$j,$j+=$l.width+this._space):($l.x=0,$l.y=$j,$j+=$l.height+this._space)}this.changeSize()},$O.commitMeasure=function(){this.runCallLater(this.changeLabels)},$O._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$m(0,$O,"labelStrokeColor",function(){return this._labelStrokeColor},function($j){this._labelStrokeColor!=$j&&(this._labelStrokeColor=$j,this._setLabelChanged())}),$m(0,$O,"skin",function(){return this._skin},function($j){this._skin!=$j&&(this._skin=$j,this._setLabelChanged())}),$m(0,$O,"selectedIndex",function(){return this._selectedIndex},function($j){this._selectedIndex!=$j&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$j,this.setSelect($j,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$m(0,$O,"labels",function(){return this._labels},function($j){if(this._labels!=$j){if(this._labels=$j,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $O=this._labels.split(","),$V=0,$l=$O.length;$V<$l;$V++){var $T=this.createItem(this._skin,$O[$V]);$T.name="item"+$V,this.addChild($T)}this.initItems()}}),$m(0,$O,"strokeColors",function(){return this._strokeColors},function($j){this._strokeColors!=$j&&(this._strokeColors=$j,this._setLabelChanged())}),$m(0,$O,"labelColors",function(){return this._labelColors},function($j){this._labelColors!=$j&&(this._labelColors=$j,this._setLabelChanged())}),$m(0,$O,"labelStroke",function(){return this._labelStroke},function($j){this._labelStroke!=$j&&(this._labelStroke=$j,this._setLabelChanged())}),$m(0,$O,"labelSize",function(){return this._labelSize},function($j){this._labelSize!=$j&&(this._labelSize=$j,this._setLabelChanged())}),$m(0,$O,"stateNum",function(){return this._stateNum},function($j){this._stateNum!=$j&&(this._stateNum=$j,this._setLabelChanged())}),$m(0,$O,"labelBold",function(){return this._labelBold},function($j){this._labelBold!=$j&&(this._labelBold=$j,this._setLabelChanged())}),$m(0,$O,"labelFont",function(){return this._labelFont},function($j){this._labelFont!=$j&&(this._labelFont=$j,this._setLabelChanged())}),$m(0,$O,"labelPadding",function(){return this._labelPadding},function($j){this._labelPadding!=$j&&(this._labelPadding=$j,this._setLabelChanged())}),$m(0,$O,"direction",function(){return this._direction},function($j){this._direction=$j,this._setLabelChanged()}),$m(0,$O,"space",function(){return this._space},function($j){this._space=$j,this._setLabelChanged()}),$m(0,$O,"items",function(){return this._items}),$m(0,$O,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($j){this.selectedIndex=this._items.indexOf($j)}),$m(0,$O,"dataSource",$j.prototype._$get_dataSource,function($j){"number"==typeof(this._dataSource=$j)&&Math.floor($j)==$j||"string"==typeof $j?this.selectedIndex=parseInt($j):$j instanceof Array?this.labels=$j.join(","):$b.superSet($q,this,"dataSource",$j)}),$V}($q),$I=function($O){function $V($j,$O){this._value=null,void 0===$O&&($O=""),$V.__super.call(this,$j,$O)}$S($V,"laya.ui.Radio",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._value=null},$j.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$j.initialize=function(){$O.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$j.onClick=function($j){this.selected=!0},$m(0,$j,"value",function(){return null!=this._value?this._value:this.label},function($j){this._value=$j}),$V}($i),$P=function($j){function $O(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$O.__super.call(this),this.width=this.height=200}$S($O,"laya.ui.Tree",$j);var $V=$O.prototype;return $b.imps($V,{"laya.ui.IRender":!0}),$V.destroy=function($j){void 0===$j&&($j=!0),laya.ui.Component.prototype.destroy.call(this,$j),this._list&&this._list.destroy($j),this._list=null,this._source=null,this._renderHandler=null},$V.createChildren=function(){this.addChild(this._list=new $K),this._list.renderHandler=$t.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$V.onListChange=function($j){this.event("change")},$V.getArray=function(){var $j,$O=[];for(var $V in this._source)$j=this._source[$V],this.getParentOpenStatus($j)&&($j.x=this._spaceLeft*this.getDepth($j),$O.push($j));return $O},$V.getDepth=function($j,$O){return void 0===$O&&($O=0),null==$j.nodeParent?$O:this.getDepth($j.nodeParent,$O+1)},$V.getParentOpenStatus=function($j){var $O=$j.nodeParent;return null==$O||!!$O.isOpen&&(null==$O.nodeParent||this.getParentOpenStatus($O))},$V.renderItem=function($j,$O){var $V=$j.dataSource;if($V){$j.left=$V.x;var $l=$j.getChildByName("arrow");$l&&($V.hasChild?($l.visible=!0,$l.index=$V.isOpen?1:0,$l.tag=$O,$l.off("click",this,this.onArrowClick),$l.on("click",this,this.onArrowClick)):$l.visible=!1);var $T=$j.getChildByName("folder");$T&&(2==$T.clipY?$T.index=$V.isDirectory?0:1:$T.index=$V.isDirectory?$V.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$j,$O])}},$V.onArrowClick=function($j){var $O=$j.currentTarget.tag;this._list.array[$O].isOpen=!this._list.array[$O].isOpen,this.event("open"),this._list.array=this.getArray()},$V.setItemState=function($j,$O){this._list.array[$j]&&(this._list.array[$j].isOpen=$O,this._list.array=this.getArray())},$V.fresh=function(){this._list.array=this.getArray(),this.repaint()},$V.parseXml=function($j,$O,$V,$l){var $T,$S=$j.childNodes,$m=$S.length;if(!$l){$T={};var $p,$o=$j.attributes;for(var $H in $o){var $g=($p=$o[$H]).nodeName,$e=$p.nodeValue;$T[$g]="true"==$e||"false"!=$e&&$e}$T.nodeParent=$V,0<$m&&($T.isDirectory=!0),$T.hasChild=0<$m,$O.push($T)}for(var $t=0;$t<$m;$t++){var $w=$S[$t];this.parseXml($w,$O,$T,!1)}},$V.parseOpenStatus=function($j,$O){for(var $V=0,$l=$O.length;$V<$l;$V++){var $T=$O[$V];if($T.isDirectory)for(var $S=0,$m=$j.length;$S<$m;$S++){var $p=$j[$S];if($p.isDirectory&&this.isSameParent($p,$T)&&$T.label==$p.label){$T.isOpen=$p.isOpen;break}}}},$V.isSameParent=function($j,$O){return null==$j.nodeParent&&null==$O.nodeParent||null!=$j.nodeParent&&null!=$O.nodeParent&&($j.nodeParent.label==$O.nodeParent.label&&this.isSameParent($j.nodeParent,$O.nodeParent))},$V.filter=function($j){if(Boolean($j)){var $O=[];this.getFilterSource(this._source,$O,$j),this._list.array=$O}else this._list.array=this.getArray()},$V.getFilterSource=function($j,$O,$V){var $l;for(var $T in $V=$V.toLocaleLowerCase(),$j)!($l=$j[$T]).isDirectory&&-1<String($l.label).toLowerCase().indexOf($V)&&($l.x=0,$O.push($l)),$l.child&&0<$l.child.length&&this.getFilterSource($l.child,$O,$V)},$m(0,$V,"spaceBottom",function(){return this._list.spaceY},function($j){this._list.spaceY=$j}),$m(0,$V,"keepStatus",function(){return this._keepStatus},function($j){this._keepStatus=$j}),$m(0,$V,"itemRender",function(){return this._list.itemRender},function($j){this._list.itemRender=$j}),$m(0,$V,"array",function(){return this._list.array},function($j){this._keepStatus&&this._list.array&&$j&&this.parseOpenStatus(this._list.array,$j),this._source=$j,this._list.array=this.getArray()}),$m(0,$V,"mouseHandler",function(){return this._list.mouseHandler},function($j){this._list.mouseHandler=$j}),$m(0,$V,"dataSource",$j.prototype._$get_dataSource,function($j){this._dataSource=$j,$b.superSet($q,this,"dataSource",$j)}),$m(0,$V,"source",function(){return this._source}),$m(0,$V,"scrollBar",function(){return this._list.scrollBar}),$m(0,$V,"list",function(){return this._list}),$m(0,$V,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($j){this._list.vScrollBarSkin=$j}),$m(0,$V,"renderHandler",function(){return this._renderHandler},function($j){this._renderHandler=$j}),$m(0,$V,"selectedIndex",function(){return this._list.selectedIndex},function($j){this._list.selectedIndex=$j}),$m(0,$V,"spaceLeft",function(){return this._spaceLeft},function($j){this._spaceLeft=$j}),$m(0,$V,"selectedItem",function(){return this._list.selectedItem},function($j){this._list.selectedItem=$j}),$m(0,$V,"width",$j.prototype._$get_width,function($j){$b.superSet($q,this,"width",$j),this._list.width=$j}),$m(0,$V,"height",$j.prototype._$get_height,function($j){$b.superSet($q,this,"height",$j),this._list.height=$j}),$m(0,$V,"xml",null,function($j){var $O=[];this.parseXml($j.childNodes[0],$O,null,!0),this.array=$O}),$m(0,$V,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$O}($q),$jj=function($j){function $O(){this._items=null,this._selectedIndex=0,$O.__super.call(this),this._setIndexHandler=$t.create(this,this.setIndex,null,!1)}$S($O,"laya.ui.ViewStack",$j);var $V=$O.prototype;return $b.imps($V,{"laya.ui.IItem":!0}),$V.setItems=function($j){this.removeChildren();for(var $O=0,$V=0,$l=$j.length;$V<$l;$V++){var $T=$j[$V];$T&&($T.name="item"+$O,this.addChild($T),$O++)}this.initItems()},$V.addItem=function($j){$j.name="item"+this._items.length,this.addChild($j),this.initItems()},$V.initItems=function(){this._items=[];for(var $j=0;$j<1e4;$j++){var $O=this.getChildByName("item"+$j);if(null==$O)break;this._items.push($O),$O.visible=$j==this._selectedIndex}},$V.setSelect=function($j,$O){this._items&&-1<$j&&$j<this._items.length&&(this._items[$j].visible=$O)},$V.setIndex=function($j){this.selectedIndex=$j},$m(0,$V,"dataSource",$j.prototype._$get_dataSource,function($j){if("number"==typeof(this._dataSource=$j)&&Math.floor($j)==$j||"string"==typeof $j)this.selectedIndex=parseInt($j);else for(var $O in this._dataSource)this.hasOwnProperty($O)&&(this[$O]=this._dataSource[$O])}),$m(0,$V,"selectedIndex",function(){return this._selectedIndex},function($j){this._selectedIndex!=$j&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$j,this.setSelect(this._selectedIndex,!0))}),$m(0,$V,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($j){this.selectedIndex=this._items.indexOf($j)}),$m(0,$V,"items",function(){return this._items}),$m(0,$V,"setIndexHandler",function(){return this._setIndexHandler},function($j){this._setIndexHandler=$j}),$O}($q),$Oj=function($j){function $O(){$O.__super.call(this)}return $S($O,"laya.ui.VScrollBar",$F),$O}(),$Vj=function($O){function $V($j){this._bg=null,this._skin=null,$V.__super.call(this),void 0===$j&&($j=""),this.text=$j,this.skin=this.skin}$S($V,"laya.ui.TextInput",$O);var $j=$V.prototype;return $j.preinitialize=function(){this.mouseEnabled=!0},$j.destroy=function($j){$a.clearCache(this,this._skin),void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._bg&&this._bg.destroy(),this._bg=null},$j.createChildren=function(){this.addChild(this._tf=new $w),this._tf.padding=$_.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$j._onFocus=function(){this.event("focus",this)},$j._onBlur=function(){this.event("blur",this)},$j._onInput=function(){this.event("input",this)},$j._onEnter=function(){this.event("enter",this)},$j.initialize=function(){this.width=128,this.height=22},$j.select=function(){this._tf.select()},$j.setSelection=function($j,$O){this._tf.setSelection($j,$O)},$m(0,$j,"text",$O.prototype._$get_text,function($j){this._tf.text!=$j&&($j+="",this._tf.text=$j,this.event("change"))}),$m(0,$j,"bg",function(){return this._bg},function($j){this.graphics=this._bg=$j}),$m(0,$j,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($j){this._tf.inputElementYAdjuster=$j}),$m(0,$j,"multiline",function(){return this._tf.multiline},function($j){this._tf.multiline=$j}),$m(0,$j,"skin",function(){return this._skin},function($j){this._skin!=$j&&($a.clearCache(this,this._skin),this._skin=$j,this._bg||(this.graphics=this._bg=new $v),$a.keepCache(this,this._skin),this._bg.source=$a.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$m(0,$j,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($j){this._bg||(this.graphics=this._bg=new $v),this._bg.sizeGrid=$B.fillArray($_.defaultSizeGrid,$j,Number)}),$m(0,$j,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($j){this._tf.inputElementXAdjuster=$j}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($f,this,"width",$j),this._bg&&(this._bg.width=$j)}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($f,this,"height",$j),this._bg&&(this._bg.height=$j)}),$m(0,$j,"editable",function(){return this._tf.editable},function($j){this._tf.editable=$j}),$m(0,$j,"restrict",function(){return this._tf.restrict},function($j){this._tf.restrict=$j}),$m(0,$j,"prompt",function(){return this._tf.prompt},function($j){this._tf.prompt=$j}),$m(0,$j,"promptColor",function(){return this._tf.promptColor},function($j){this._tf.promptColor=$j}),$m(0,$j,"maxChars",function(){return this._tf.maxChars},function($j){this._tf.maxChars=$j}),$m(0,$j,"focus",function(){return this._tf.focus},function($j){this._tf.focus=$j}),$m(0,$j,"type",function(){return this._tf.type},function($j){this._tf.type=$j}),$m(0,$j,"asPassword",function(){return this._tf.asPassword},function($j){this._tf.asPassword=$j}),$V}($f),$lj=function($j){function $O(){$O.__super.call(this)}return $S($O,"laya.ui.VSlider",$N),$O}(),$Tj=function($j){function $l(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$l.__super.call(this)}$S($l,"laya.ui.Dialog",$j);var $O=$l.prototype;return $O.initialize=function(){this.popupEffect=$l.manager.popupEffectHandler,this.closeEffect=$l.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$O._dealDragArea=function(){var $j=this.getChildByName("drag");$j&&(this.dragArea=$j.x+","+$j.y+","+$j.width+","+$j.height,$j.removeSelf())},$O._onClick=function($j){var $O=$j.target;if($O)switch($O.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($O.name)}},$O.show=function($j,$O){void 0===$j&&($j=!1),void 0===$O&&($O=!0),this._open(!1,$j,$O)},$O.popup=function($j,$O){void 0===$j&&($j=!1),void 0===$O&&($O=!0),this._open(!0,$j,$O)},$O._open=function($j,$O,$V){$l.manager.lock(!1),this.isModal=$j,$l.manager.open(this,$O,$V)},$O.onOpened=function(){},$O.close=function($j,$O){void 0===$O&&($O=!0),$l.manager.close(this,$j,$O)},$O.onClosed=function($j){},$O._onMouseDown=function($j){var $O=this.getMousePoint();this._dragArea.contains($O.x,$O.y)?this.startDrag():this.stopDrag()},$m(0,$O,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($j){if($j){var $O=$B.fillArray([0,0,0,0],$j,Number);this._dragArea=new $h($O[0],$O[1],$O[2],$O[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$m(0,$O,"isPopup",function(){return null!=this.parent}),$m(0,$O,"zOrder",$j.prototype._$get_zOrder,function($j){$b.superSet($J,this,"zOrder",$j),$l.manager._checkMask()}),$m(1,$l,"manager",function(){return $l._manager=$l._manager||new $R},function($j){$l._manager=$j}),$l.setLockView=function($j){$l.manager.setLockView($j)},$l.lock=function($j){$l.manager.lock($j)},$l.closeAll=function(){$l.manager.closeAll()},$l.getDialogsByGroup=function($j){return $l.manager.getDialogsByGroup($j)},$l.closeByGroup=function($j){return $l.manager.closeByGroup($j)},$l.CLOSE="close",$l.CANCEL="cancel",$l.SURE="sure",$l.NO="no",$l.OK="ok",$l.YES="yes",$l._manager=null,$l}($J),$Sj=function($j){function $O(){$O.__super.call(this)}$S($O,"laya.ui.HBox",$j);var $V=$O.prototype;return $V.sortItem=function($j){$j&&$j.sort(function($j,$O){return $j.x-$O.x})},$V.changeItems=function(){this._itemChanged=!1;for(var $j=[],$O=0,$V=0,$l=this.numChildren;$V<$l;$V++){var $T=this.getChildAt($V);$T&&$T.layoutEnabled&&($j.push($T),$O=this._height?this._height:Math.max($O,$T.height*$T.scaleY))}this.sortItem($j);var $S=0;for($V=0,$l=$j.length;$V<$l;$V++)($T=$j[$V]).x=$S,$S+=$T.width*$T.scaleX+this._space,"top"==this._align?$T.y=0:"middle"==this._align?$T.y=.5*($O-$T.height*$T.scaleY):"bottom"==this._align&&($T.y=$O-$T.height*$T.scaleY);this.changeSize()},$m(0,$V,"height",$j.prototype._$get_height,function($j){this._height!=$j&&($b.superSet($y,this,"height",$j),this.callLater(this.changeItems))}),$O.NONE="none",$O.TOP="top",$O.MIDDLE="middle",$O.BOTTOM="bottom",$O}($y),$mj=function($j){function $O(){$O.__super.call(this)}$S($O,"laya.ui.VBox",$j);var $V=$O.prototype;return $V.changeItems=function(){this._itemChanged=!1;for(var $j=[],$O=0,$V=0,$l=this.numChildren;$V<$l;$V++){var $T=this.getChildAt($V);$T&&$T.layoutEnabled&&($j.push($T),$O=this._width?this._width:Math.max($O,$T.width*$T.scaleX))}this.sortItem($j);var $S=0;for($V=0,$l=$j.length;$V<$l;$V++)($T=$j[$V]).y=$S,$S+=$T.height*$T.scaleY+this._space,"left"==this._align?$T.x=0:"center"==this._align?$T.x=.5*($O-$T.width*$T.scaleX):"right"==this._align&&($T.x=$O-$T.width*$T.scaleX);this.changeSize()},$m(0,$V,"width",$j.prototype._$get_width,function($j){this._width!=$j&&($b.superSet($y,this,"width",$j),this.callLater(this.changeItems))}),$O.NONE="none",$O.LEFT="left",$O.CENTER="center",$O.RIGHT="right",$O}($y),$pj=function($j){function $O(){$O.__super.call(this)}return $S($O,"laya.ui.RadioGroup",$D),$O.prototype.createItem=function($j,$O){return new $I($j,$O)},$O}(),$oj=function($j){function $O(){$O.__super.call(this)}return $S($O,"laya.ui.Tab",$D),$O.prototype.createItem=function($j,$O){return new $i($j,$O)},$O}(),$Hj=function($O){function $V($j){this._vScrollBar=null,this._hScrollBar=null,void 0===$j&&($j=""),$V.__super.call(this,$j)}$S($V,"laya.ui.TextArea",$O);var $j=$V.prototype;return $j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$j.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$j.onVBarChanged=function($j){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$j.onHBarChanged=function($j){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$j.changeScroll=function(){var $j=this._vScrollBar&&0<this._tf.maxScrollY,$O=this._hScrollBar&&0<this._tf.maxScrollX,$V=$j?this._width-this._vScrollBar.width:this._width,$l=$O?this._height-this._hScrollBar.height:this._height,$T=this._tf.padding||$_.labelPadding;this._tf.width=$V,this._tf.height=$l,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$T[2],this._vScrollBar.y=$T[1],this._vScrollBar.height=this._height-($O?this._hScrollBar.height:0)-$T[1]-$T[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$l/Math.max(this._tf.textHeight,$l),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$j),this._hScrollBar&&(this._hScrollBar.x=$T[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$T[3],this._hScrollBar.width=this._width-($j?this._vScrollBar.width:0)-$T[0]-$T[2],this._hScrollBar.scrollSize=Math.max(.033*$V,1),this._hScrollBar.thumbPercent=$V/Math.max(this._tf.textWidth,$V),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$O)},$j.scrollTo=function($j){this.commitMeasure(),this._tf.scrollY=$j},$m(0,$j,"scrollY",function(){return this._tf.scrollY}),$m(0,$j,"width",$O.prototype._$get_width,function($j){$b.superSet($Vj,this,"width",$j),this.callLater(this.changeScroll)}),$m(0,$j,"hScrollBar",function(){return this._hScrollBar}),$m(0,$j,"height",$O.prototype._$get_height,function($j){$b.superSet($Vj,this,"height",$j),this.callLater(this.changeScroll)}),$m(0,$j,"maxScrollX",function(){return this._tf.maxScrollX}),$m(0,$j,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($j){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $Oj),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$j}),$m(0,$j,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($j){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $d),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$j}),$m(0,$j,"vScrollBar",function(){return this._vScrollBar}),$m(0,$j,"maxScrollY",function(){return this._tf.maxScrollY}),$m(0,$j,"scrollX",function(){return this._tf.scrollX}),$V}($Vj);!function($j){function $O(){this._uiView=null,this.isCloseOther=!1,$O.__super.call(this)}$S($O,"laya.ui.AsynDialog",$Tj);var $V=$O.prototype;$V.createView=function($j){this._uiView=$j},$V._open=function($j,$O,$V){this.isModal=$j,this.isCloseOther=$O,$Tj.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$V.onCreated=function(){this.createUI(),this.onOpen()},$V.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$V.onOpen=function(){$Tj.manager.open(this,this.isCloseOther),$Tj.manager.lock(!1)},$V.close=function($j,$O){void 0===$O&&($O=!0),$Tj.manager.close(this),this.onClose()},$V.onClose=function(){},$V.destroy=function($j){void 0===$j&&($j=!0),laya.ui.View.prototype.destroy.call(this,$j),this._uiView=null,this.onDestroy()},$V.onDestroy=function(){}}();$b.__init([$J])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($j,$O){"use strict";for(var $V in Object.defineProperty($O,"__esModule",{value:!0}),Laya){var $l=Laya[$V];$l&&$l.__isclass&&($O[$V]=$l)}}),function($t,$j,$Z){$Z.un,$Z.uns;var $e=$Z.static,$w=$Z.class,$s=$Z.getset,$l=$Z.__newvec,$A=laya.maths.Arith,$m=laya.webgl.atlas.AtlasResourceManager,$V=laya.webgl.shader.BaseShader,$Y=laya.utils.Browser,$p=laya.webgl.utils.Buffer,$x=laya.utils.Byte,$T=laya.utils.ClassUtils,$o=$Z.Config,$S=(laya.events.Event,laya.events.EventDispatcher),$_=laya.utils.Handler,$h=laya.net.Loader,$O=laya.net.LoaderManager,$H=(laya.maths.MathUtil,laya.display.Node),$b=laya.renders.Render,$g=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$r=laya.resource.Resource,$a=laya.utils.RunDriver,$c=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$E=laya.display.Sprite,$U=laya.utils.Stat,$z=laya.utils.StringKey,$B=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$$=laya.utils.Utils,$M=laya.webgl.WebGL,$v=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$Z.interface("laya.d3.core.IClone"),$Z.interface("laya.d3.graphics.IVertex"),$Z.interface("laya.d3.core.render.IUpdate"),$Z.interface("laya.d3.core.scene.ITreeNode"),$Z.interface("laya.d3.core.render.IRenderable");(function(){function $i(){}$w($i,"laya.d3.animation.AnimationClipParser01"),$i.READ_DATA=function(){$i._DATA.offset=$i._reader.getUint32(),$i._DATA.size=$i._reader.getUint32()},$i.READ_BLOCK=function(){for(var $j=$i._BLOCK.count=$i._reader.getUint16(),$O=$i._BLOCK.blockStarts=[],$V=$i._BLOCK.blockLengths=[],$l=0;$l<$j;$l++)$O.push($i._reader.getUint32()),$V.push($i._reader.getUint32())},$i.READ_STRINGS=function(){var $j=$i._reader.getUint32(),$O=$i._reader.getUint16(),$V=$i._reader.pos;$i._reader.pos=$j+$i._DATA.offset;for(var $l=0;$l<$O;$l++)$i._strings[$l]=$i._reader.readUTFString();$i._reader.pos=$V},$i.parse=function($j,$O){$i._animationClip=$j;($i._reader=$O).__getBuffer();$i.READ_DATA(),$i.READ_BLOCK(),$i.READ_STRINGS();for(var $V=0,$l=$i._BLOCK.count;$V<$l;$V++){var $T=$O.getUint16(),$S=$i._strings[$T],$m=$i["READ_"+$S];if(null==$m)throw new Error("model file err,no this function:"+$T+" "+$S);$m.call()}},$i.READ_ANIMATIONS=function(){var $j,$O=0,$V=0,$l=$i._reader,$T=$l.__getBuffer(),$S=[],$m=$l.getUint8();for($S.length=$m,$O=0;$O<$m;$O++)$S[$O]=$l.getUint16();var $p=[],$o=$l.getUint16();for($p.length=$o,$O=0;$O<$o;$O++)$p[$O]=$l.getFloat32();var $H=$i._animationClip;$H.name=$i._strings[$l.getUint16()];var $g=$H._duration=$l.getFloat32();$H.islooping=!!$l.getByte(),$H._frameRate=$l.getInt16();var $e=$l.getInt16(),$t=$H._nodes=new Array;$t.length=$e,($H._publicClipDatas=[]).length=$e;var $w=$H._nodesMap={},$s=0,$b=0;for($O=0;$O<$e;$O++){$j=$t[$O]=new $C;var $r=$l.getUint16(),$h=$j.path=[];for($h.length=$r,$V=0;$V<$r;$V++)$h[$V]=$i._strings[$l.getUint16()];var $a=$h.join("/"),$c=$w[$a];$c||($w[$a]=$c=[]),$c.push($j);var $A=$l.getInt16();-1!==$A&&($j.componentType=$i._strings[$A]);var $Z=$X._propertyIndexDic[$i._strings[$l.getUint16()]];if(null==$Z)throw new Error("AnimationClipParser01:unknown property name.");var $x=$Z<4,$E=!$x||$x&&""===$h[0];($j._cacheProperty=$E)?$s++:$b++,$j.propertyNameID=$Z;var $U=$S[$l.getUint8()];$j.keyFrameWidth=$U/4;var $z=$j.keyFrames=[],$$=$z.length=$l.getUint16(),$_=null,$B=NaN;for($V=0;$V<$$;$V++){var $M=$z[$V]=new $f;$B=$M.startTime=$p[$l.getUint16()];var $v=$l.pos;$M.inTangent=new Float32Array($T.slice($v,$v+$U)),$l.pos+=$U,$v=$l.pos,$M.outTangent=new Float32Array($T.slice($v,$v+$U)),$l.pos+=$U,$v=$l.pos,$M.data=new Float32Array($T.slice($v,$v+$U)),$l.pos+=$U,$_&&($_.next=$M,$_.duration=$B-$_.startTime),$_=$M}$M.next=null,$M.duration=$g-$B}var $Y=$H._nodeToCachePropertyMap=new Int32Array($e),$R=$H._cachePropertyMap=new Int32Array($s),$q=$H._unCachePropertyMap=new Int32Array($b);for($s=$b=0,$O=0;$O<$e;$O++)($j=$t[$O])._cacheProperty?($Y[$O]=$s,$R[$s++]=$O):$q[$b++]=$O},$i._animationClip=null,$i._reader=null,$i._strings=[],$e($i,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $F(){}$w($F,"laya.d3.animation.AnimationClipParser02"),$F.READ_DATA=function(){$F._DATA.offset=$F._reader.getUint32(),$F._DATA.size=$F._reader.getUint32()},$F.READ_BLOCK=function(){for(var $j=$F._BLOCK.count=$F._reader.getUint16(),$O=$F._BLOCK.blockStarts=[],$V=$F._BLOCK.blockLengths=[],$l=0;$l<$j;$l++)$O.push($F._reader.getUint32()),$V.push($F._reader.getUint32())},$F.READ_STRINGS=function(){var $j=$F._reader.getUint32(),$O=$F._reader.getUint16(),$V=$F._reader.pos;$F._reader.pos=$j+$F._DATA.offset;for(var $l=0;$l<$O;$l++)$F._strings[$l]=$F._reader.readUTFString();$F._reader.pos=$V},$F.parse=function($j,$O){$F._animationClip=$j;($F._reader=$O).__getBuffer();$F.READ_DATA(),$F.READ_BLOCK(),$F.READ_STRINGS();for(var $V=0,$l=$F._BLOCK.count;$V<$l;$V++){var $T=$O.getUint16(),$S=$F._strings[$T],$m=$F["READ_"+$S];if(null==$m)throw new Error("model file err,no this function:"+$T+" "+$S);$m.call()}},$F.READ_ANIMATIONS=function(){var $j,$O=0,$V=0,$l=$F._reader,$T=$l.__getBuffer(),$S=[],$m=$l.getUint8();for($S.length=$m,$O=0;$O<$m;$O++)$S[$O]=$l.getUint16();var $p=[],$o=$l.getUint16();for($p.length=$o,$O=0;$O<$o;$O++)$p[$O]=$l.getFloat32();var $H=$F._animationClip;$H.name=$F._strings[$l.getUint16()];var $g=$H._duration=$l.getFloat32();$H.islooping=!!$l.getByte(),$H._frameRate=$l.getInt16();var $e=$l.getInt16(),$t=$H._nodes=new Array;$t.length=$e,($H._publicClipDatas=[]).length=$e;var $w=$H._nodesMap={},$s=0,$b=0;for($O=0;$O<$e;$O++){$j=$t[$O]=new $C;var $r=$l.getUint16(),$h=$j.path=[];for($h.length=$r,$V=0;$V<$r;$V++)$h[$V]=$F._strings[$l.getUint16()];var $a=$h.join("/"),$c=$w[$a];$c||($w[$a]=$c=[]),$c.push($j);var $A=$l.getInt16();-1!==$A&&($j.componentType=$F._strings[$A]);var $Z=$X._propertyIndexDic[$F._strings[$l.getUint16()]];if(null==$Z)throw new Error("AnimationClipParser02:unknown property name.");var $x=$Z<4,$E=!$x||$x&&""===$h[0];($j._cacheProperty=$E)?$s++:$b++,$j.propertyNameID=$Z;var $U=$S[$l.getUint8()];$j.keyFrameWidth=$U/4;var $z=$j.keyFrames=[],$$=$z.length=$l.getUint16(),$_=null,$B=NaN;for($V=0;$V<$$;$V++){var $M=$z[$V]=new $f;$B=$M.startTime=$p[$l.getUint16()];var $v=$l.pos;$M.inTangent=new Float32Array($T.slice($v,$v+$U)),$l.pos+=$U,$v=$l.pos,$M.outTangent=new Float32Array($T.slice($v,$v+$U)),$l.pos+=$U,$v=$l.pos,$M.data=new Float32Array($T.slice($v,$v+$U)),$l.pos+=$U,$_&&($_.next=$M,$_.duration=$B-$_.startTime),$_=$M}$M.next=null,$M.duration=$g-$B}var $Y=$l.getUint16();for($O=0;$O<$Y;$O++){var $R,$q=new $N;$q.time=$l.getFloat32(),$q.eventName=$F._strings[$l.getUint16()];var $i=$l.getUint16();for(0<$i&&($q.params=$R=[]),$V=0;$V<$i;$V++){switch($l.getByte()){case 0:$R.push(!!$l.getByte());break;case 1:$R.push($l.getInt32());break;case 2:$R.push($l.getFloat32());break;case 3:$R.push($F._strings[$l.getUint16()]);break;default:throw new Error("unknown type.")}}$H.addEvent($q)}var $k=$H._nodeToCachePropertyMap=new Int32Array($e),$n=$H._cachePropertyMap=new Int32Array($s),$G=$H._unCachePropertyMap=new Int32Array($b);for($s=$b=0,$O=0;$O<$e;$O++)($j=$t[$O])._cacheProperty?($k[$O]=$s,$n[$s++]=$O):$G[$b++]=$O},$F._animationClip=null,$F._reader=null,$F._strings=[],$e($F,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $N=function(){function $j(){this.time=NaN,this.eventName=null,this.params=null}return $w($j,"laya.d3.animation.AnimationEvent"),$j}(),$X=function(){function $l(){this._childs=[],this.transform=new $aO(this)}$w($l,"laya.d3.animation.AnimationNode");var $j=$l.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.addChild=function($j){$j._parent=this,$j.transform.setParent(this.transform),this._childs.push($j)},$j.removeChild=function($j){var $O=this._childs.indexOf($j);-1!==$O&&this._childs.splice($O,1)},$j.getChildByName=function($j){for(var $O=0,$V=this._childs.length;$O<$V;$O++){var $l=this._childs[$O];if($l.name===$j)return $l}return null},$j.getChildByIndex=function($j){return this._childs[$j]},$j.getChildCount=function(){return this._childs.length},$j.cloneTo=function($j){var $O=$j;$O.name=this.name;for(var $V=0,$l=this._childs.length;$V<$l;$V++){var $T=this._childs[$V],$S=$T.clone();$O.addChild($S);var $m=$T.transform,$p=$S.transform;$p.setLocalPosition($m.getLocalPosition()),$p.setLocalRotation($m.getLocalRotation()),$p.setLocalScale($m.getLocalScale()),$p._localRotationEuler=$m._localRotationEuler,$p._setWorldMatrixIgnoreUpdate($m.getWorldMatrix())}},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$l.__init__=function(){$l.registerAnimationNodeProperty("localPosition",$l._getLocalPosition,$l._setLocalPosition),$l.registerAnimationNodeProperty("localRotation",$l._getLocalRotation,$l._setLocalRotation),$l.registerAnimationNodeProperty("localScale",$l._getLocalScale,$l._setLocalScale),$l.registerAnimationNodeProperty("localRotationEuler",$l._getLocalRotationEuler,$l._setLocalRotationEuler),$l.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$l._getParticleRenderSharedMaterialTintColor,$l._setParticleRenderSharedMaterialTintColor),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$l._getMeshRenderSharedMaterialTilingOffset,$l._setMeshRenderSharedMaterialTilingOffset),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$l._getMeshRenderSharedMaterialAlbedo,$l._setMeshRenderSharedMaterialAlbedo),$l.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$l._getSkinnedMeshRenderSharedMaterialTilingOffset,$l._setSkinnedMeshRenderSharedMaterialTilingOffset),$l.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$l._getSkinnedMeshRenderSharedMaterialAlbedo,$l._setSkinnedMeshRenderSharedMaterialAlbedo),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$l._getMeshRenderSharedMaterialAlbedo,$l._setMeshRenderSharedMaterialAlbedo),$l.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$l._getSkinnedMeshRenderSharedMaterialAlbedo,$l._setSkinnedMeshRenderSharedMaterialAlbedo),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$l._getMeshRenderSharedMaterialIntensity,$l._setMeshRenderSharedMaterialIntensity),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$l._getMeshRenderSharedMaterialAlpha,$l._setMeshRenderSharedMaterialAlpha),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$l._getMeshRenderSharedMaterialAlphaColor,$l._setMeshRenderSharedMaterialAlphaColor),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$l._getMeshRenderSharedMaterialBaseColor,$l._setMeshRenderSharedMaterialBaseColor),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$l._getMeshRenderSharedMaterialDissolve,$l._setMeshRenderSharedMaterialDissolve),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$l._getMeshRenderSharedMaterialDissolveSpeed,$l._setMeshRenderSharedMaterialDissolveSpeed),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$l._getMeshRenderSharedMaterialMMultiplier,$l._setMeshRenderSharedMaterialMMultiplier),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$l._getMeshRenderSharedMaterialBaseScrollSpeedX,$l._setMeshRenderSharedMaterialBaseScrollSpeedX),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$l._getMeshRenderSharedMaterialBaseScrollSpeedY,$l._setMeshRenderSharedMaterialBaseScrollSpeedY),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$l._getMeshRenderSharedMaterialSecondScrollSpeedX,$l._setMeshRenderSharedMaterialSecondScrollSpeedX),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$l._getMeshRenderSharedMaterialSecondScrollSpeedY,$l._setMeshRenderSharedMaterialSecondScrollSpeedY),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$l._getMeshRenderSharedMaterialDetailTilingOffset,$l._setMeshRenderSharedMaterialDetailTilingOffset),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$l._getMeshRenderSharedMaterialDissolveTilingOffset,$l._setMeshRenderSharedMaterialDissolveTilingOffset),$l.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$l._getMeshRenderSharedMaterialMaskTilingOffset,$l._setMeshRenderSharedMaterialMaskTilingOffset)},$l.registerAnimationNodeProperty=function($j,$O,$V){if($l._propertyIndexDic[$j])throw new Error("AnimationNode: this propertyName has registered.");$l._propertyIndexDic[$j]=$l._propertyIDCounter,$l._propertyGetFuncs[$l._propertyIDCounter]=$O,$l._propertySetFuncs[$l._propertyIDCounter]=$V,$l._propertyIDCounter++},$l._getLocalPosition=function($j,$O){return $j?$j.transform.getLocalPosition():$O._transform.localPosition.elements},$l._setLocalPosition=function($j,$O,$V){if($j)$j.transform.setLocalPosition($V);else{var $l=$O._transform,$T=$l.localPosition;$T.elements=$V,$l.localPosition=$T}},$l._getLocalRotation=function($j,$O){return $j?$j.transform.getLocalRotation():$O._transform.localRotation.elements},$l._setLocalRotation=function($j,$O,$V){if($j)$j.transform.setLocalRotation($V);else{var $l=$O._transform,$T=$l.localRotation;$T.elements=$V,$l.localRotation=$T}},$l._getLocalScale=function($j,$O){return $j?$j.transform.getLocalScale():$O._transform.localScale.elements},$l._setLocalScale=function($j,$O,$V){if($j)$j.transform.setLocalScale($V);else{var $l=$O._transform,$T=$l.localScale;$T.elements=$V,$l.localScale=$T}},$l._getLocalRotationEuler=function($j,$O){return $j?$j.transform.getLocalRotationEuler():$O._transform.localRotationEuler.elements},$l._setLocalRotationEuler=function($j,$O,$V){if($j)$j.transform.setLocalRotationEuler($V);else{var $l=$O._transform,$T=$l.localRotationEuler;$T.elements=$V,$l.localRotationEuler=$T}},$l._getMeshRenderSharedMaterialTilingOffset=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $O.meshRender.sharedMaterial.tilingOffset.elements},$l._setMeshRenderSharedMaterialTilingOffset=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).tilingOffset).elements=$V,$l.tilingOffset=$T)}else($T=($l=$O.meshRender.material).tilingOffset).elements=$V,$l.tilingOffset=$T},$l._getMeshRenderSharedMaterialAlbedo=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $O.meshRender.sharedMaterial.albedoColor.elements},$l._setMeshRenderSharedMaterialAlbedo=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).albedoColor).elements=$V,$l.albedoColor=$T)}else($T=($l=$O.meshRender.material).albedoColor).elements=$V,$l.albedoColor=$T},$l._getSkinnedMeshRenderSharedMaterialTilingOffset=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $O.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$l._setSkinnedMeshRenderSharedMaterialTilingOffset=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.skinnedMeshRender.material).tilingOffset).elements=$V,$l.tilingOffset=$T)}else($T=($l=$O.skinnedMeshRender.material).tilingOffset).elements=$V,$l.tilingOffset=$T},$l._getSkinnedMeshRenderSharedMaterialAlbedo=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $O.skinnedMeshRender.sharedMaterial.albedoColor.elements},$l._setSkinnedMeshRenderSharedMaterialAlbedo=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.skinnedMeshRender.material).albedoColor).elements=$V,$l.albedoColor=$T)}else($T=($l=$O.skinnedMeshRender.material).albedoColor).elements=$V,$l.albedoColor=$T},$l._getParticleRenderSharedMaterialTintColor=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.particleRender.sharedMaterial.tintColor.elements:null}return $O.particleRender.sharedMaterial.tintColor.elements},$l._setParticleRenderSharedMaterialTintColor=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.particleRender.material).tintColor).elements=$V,$l.tintColor=$T)}else($T=($l=$O.particleRender.material).tintColor).elements=$V,$l.tintColor=$T},$l._getMeshRenderSharedMaterialAlphaColor=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $O.meshRender.sharedMaterial.alphaColor.elements},$l._setMeshRenderSharedMaterialAlphaColor=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).alphaColor).elements=$V,$l.alphaColor=$T)}else($T=($l=$O.meshRender.material).alphaColor).elements=$V,$l.alphaColor=$T},$l._getMeshRenderSharedMaterialBaseColor=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.baseColor.elements:null}return $O.meshRender.sharedMaterial.baseColor.elements},$l._setMeshRenderSharedMaterialBaseColor=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).baseColor).elements=$V,$l.baseColor=$T)}else($T=($l=$O.meshRender.material).baseColor).elements=$V,$l.baseColor=$T},$l._getMeshRenderSharedMaterialDissolve=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.dissolve:0}return $O.meshRender.sharedMaterial.dissolve},$l._setMeshRenderSharedMaterialDissolve=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.dissolve=$V[0])}else $O.meshRender.material.dissolve=$V[0]},$l._getMeshRenderSharedMaterialDissolveSpeed=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $O.meshRender.sharedMaterial.dissolveSpeed},$l._setMeshRenderSharedMaterialDissolveSpeed=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.dissolveSpeed=$V[0])}else $O.meshRender.material.dissolveSpeed=$V[0]},$l._getMeshRenderSharedMaterialMMultiplier=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.mMultiplier:0}return $O.meshRender.sharedMaterial.mMultiplier},$l._setMeshRenderSharedMaterialMMultiplier=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.mMultiplier=$V[0])}else $O.meshRender.material.mMultiplier=$V[0]},$l._getMeshRenderSharedMaterialBaseScrollSpeedX=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $O.meshRender.sharedMaterial.baseScrollSpeedX},$l._setMeshRenderSharedMaterialBaseScrollSpeedX=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.baseScrollSpeedX=$V[0])}else $O.meshRender.material.baseScrollSpeedX=$V[0]},$l._getMeshRenderSharedMaterialBaseScrollSpeedY=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $O.meshRender.sharedMaterial.baseScrollSpeedY},$l._setMeshRenderSharedMaterialBaseScrollSpeedY=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.baseScrollSpeedY=$V[0])}else $O.meshRender.material.baseScrollSpeedY=$V[0]},$l._getMeshRenderSharedMaterialSecondScrollSpeedX=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $O.meshRender.sharedMaterial.secondScrollSpeedX},$l._setMeshRenderSharedMaterialSecondScrollSpeedX=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.secondScrollSpeedX=$V[0])}else $O.meshRender.material.secondScrollSpeedX=$V[0]},$l._getMeshRenderSharedMaterialSecondScrollSpeedY=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $O.meshRender.sharedMaterial.secondScrollSpeedY},$l._setMeshRenderSharedMaterialSecondScrollSpeedY=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.secondScrollSpeedY=$V[0])}else $O.meshRender.material.secondScrollSpeedY=$V[0]},$l._getMeshRenderSharedMaterialAlpha=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.alpha:0}return $O.meshRender.sharedMaterial.alpha},$l._setMeshRenderSharedMaterialAlpha=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.alpha=$V[0])}else $O.meshRender.material.alpha=$V[0]},$l._getMeshRenderSharedMaterialIntensity=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.intensity:0}return $O.meshRender.sharedMaterial.intensity},$l._setMeshRenderSharedMaterialIntensity=function($j,$O,$V){if($j){var $l=$j.transform._entity;$l&&($l.owner.meshRender.material.intensity=$V[0])}else $O.meshRender.material.intensity=$V[0]},$l._getMeshRenderSharedMaterialDetailTilingOffset=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $O.meshRender.sharedMaterial.detailTilingOffset.elements},$l._setMeshRenderSharedMaterialDetailTilingOffset=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).detailTilingOffset).elements=$V,$l.detailTilingOffset=$T)}else($T=($l=$O.meshRender.material).detailTilingOffset).elements=$V,$l.detailTilingOffset=$T},$l._getMeshRenderSharedMaterialDissolveTilingOffset=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $O.meshRender.sharedMaterial.dissolveTilingOffset.elements},$l._setMeshRenderSharedMaterialDissolveTilingOffset=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).dissolveTilingOffset).elements=$V,$l.dissolveTilingOffset=$T)}else($T=($l=$O.meshRender.material).dissolveTilingOffset).elements=$V,$l.dissolveTilingOffset=$T},$l._getMeshRenderSharedMaterialMaskTilingOffset=function($j,$O){if($j){var $V=$j.transform._entity;return $V?$V.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $O.meshRender.sharedMaterial.maskTilingOffset.elements},$l._setMeshRenderSharedMaterialMaskTilingOffset=function($j,$O,$V){var $l,$T;if($j){var $S=$j.transform._entity;$S&&(($T=($l=$S.owner.meshRender.material).maskTilingOffset).elements=$V,$l.maskTilingOffset=$T)}else($T=($l=$O.meshRender.material).maskTilingOffset).elements=$V,$l.maskTilingOffset=$T},$l._propertyIDCounter=0,$l._propertyIndexDic={},$l._propertySetFuncs=[],$l._propertyGetFuncs=[],$l}(),$f=function(){function $j(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $w($j,"laya.d3.animation.Keyframe"),$j}(),$C=function(){function $j(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $w($j,"laya.d3.animation.KeyframeNode"),$j}(),$R=(function(){function $j(){this._tempVector30=new $mO,this._tempVector31=new $mO,this._tempVector32=new $mO,this._a=new $mO,this._b=new $mO,this._c=new $mO,this._d=new $mO}$w($j,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $O=$j.prototype;$O.Init=function($j,$O,$V,$l){$j.cloneTo(this._d),$O.cloneTo(this._c),$mO.scale($j,2,this._a),$mO.scale($V,2,this._tempVector30),$mO.subtract(this._a,this._tempVector30,this._a),$mO.add(this._a,$O,this._a),$mO.add(this._a,$l,this._a),$mO.scale($V,3,this._b),$mO.scale($j,3,this._tempVector30),$mO.subtract(this._b,this._tempVector30,this._b),$mO.subtract(this._b,$l,this._b),$mO.scale($O,2,this._tempVector30),$mO.subtract(this._b,this._tempVector30,this._b)},$O.Slerp=function($j,$O){$mO.scale(this._a,$j*$j*$j,this._tempVector30),$mO.scale(this._b,$j*$j,this._tempVector31),$mO.scale(this._c,$j,this._tempVector32),$mO.add(this._tempVector30,this._tempVector31,$O),$mO.add($O,this._tempVector32,$O),$mO.add($O,this._d,$O)}}(),function(){function $n($j,$O,$V,$l){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$j,this._h=$O,this._minHeight=$V,this._maxHeight=$l}$w($n,"laya.d3.core.HeightMap");var $j=$n.prototype;$j._inBounds=function($j,$O){return 0<=$j&&$j<this._h&&0<=$O&&$O<this._w},$j.getHeight=function($j,$O){return this._inBounds($j,$O)?this._datas[$j][$O]:NaN},$s(0,$j,"width",function(){return this._w}),$s(0,$j,"height",function(){return this._h}),$s(0,$j,"maxHeight",function(){return this._maxHeight}),$s(0,$j,"minHeight",function(){return this._minHeight}),$n.creatFromMesh=function($j,$O,$V,$l){for(var $T=[],$S=[],$m=$j.getSubMeshCount(),$p=0;$p<$m;$p++){for(var $o=$j.getSubMesh($p),$H=$o._getVertexBuffer(),$g=$H.getData(),$e=[],$t=0;$t<$g.length;$t+=$H.vertexDeclaration.vertexStride/4){var $w=new $mO($g[$t+0],$g[$t+1],$g[$t+2]);$e.push($w)}$T.push($e);var $s=$o._getIndexBuffer();$S.push($s.getData())}var $b=$j.boundingBox,$r=$b.min.x,$h=$b.min.z,$a=$b.max.x,$c=$b.max.z,$A=$b.min.y,$Z=$b.max.y,$x=$a-$r,$E=$c-$h,$U=$l.elements[0]=$x/($O-1),$z=$l.elements[1]=$E/($V-1),$$=new $n($O,$V,$A,$Z),$_=$n._tempRay,$B=$_.direction.elements;$B[0]=0,$B[1]=-1,$B[2]=0;var $M=$Z+.1;$_.origin.elements[1]=$M;for(var $v=0;$v<$V;$v++){var $Y=$h+$v*$z;$$._datas[$v]=[];for(var $R=0;$R<$O;$R++){var $q=$r+$R*$U,$i=$_.origin.elements;$i[0]=$q,$i[2]=$Y;var $k=$n._getPosition($_,$T,$S);$$._datas[$v][$R]=$k===Number.MAX_VALUE?NaN:$M-$k}}return $$},$n.createFromImage=function($j,$O,$V){for(var $l=$j.width,$T=$j.height,$S=new $n($l,$T,$O,$V),$m=($V-$O)/254,$p=$j.getPixels(),$o=0,$H=0;$H<$T;$H++)for(var $g=$S._datas[$H]=[],$e=0;$e<$l;$e++){var $t=$p[$o++],$w=$p[$o++],$s=$p[$o++],$b=$p[$o++];$g[$e]=255==$t&&255==$w&&255==$s&&255==$b?NaN:($t+$w+$s)/3*$m+$O}return $S},$n._getPosition=function($j,$O,$V){for(var $l=Number.MAX_VALUE,$T=0;$T<$O.length;$T++)for(var $S=$O[$T],$m=$V[$T],$p=0;$p<$m.length;$p+=3){var $o=$S[$m[$p+0]],$H=$S[$m[$p+1]],$g=$S[$m[$p+2]],$e=$sO.rayIntersectsTriangle($j,$o,$H,$g);!isNaN($e)&&$e<$l&&($l=$e)}return $l},$e($n,["_tempRay",function(){return this._tempRay=new $TO(new $mO,new $mO)}])}(),function(){function $T(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$w($T,"laya.d3.core.Layer");var $j=$T.prototype;return $j._binarySearchIndex=function(){for(var $j=0,$O=$T._collsionTestList.length-1,$V=0;$j<=$O;){$V=Math.floor(($j+$O)/2);var $l=$T._collsionTestList[$V];if($l==this._number)return $V;$l>this._number?$O=$V-1:$j=$V+1}return $j},$j._addCollider=function($j){0===this._colliders.length&&$T._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$j._isRigidbody?(this._colliders.unshift($j),this._nonRigidbodyOffset++):this._colliders.push($j)},$j._removeCollider=function($j){var $O=this._colliders.indexOf($j);$O<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($O,1),0===this._colliders.length&&$T._collsionTestList.splice($T._collsionTestList.indexOf(this._number),1)},$s(0,$j,"number",function(){return this._number}),$s(0,$j,"visible",function(){return this._visible},function($j){this._visible=$j,$T._visibleLayers=$j?$T._visibleLayers|this.mask:$T._visibleLayers&~this.mask}),$s(0,$j,"mask",function(){return this._mask}),$s(1,$T,"visibleLayers",function(){return $T._visibleLayers},function($j){$T._visibleLayers=$j;for(var $O=0,$V=$T._layerList.length;$O<$V;$O++){var $l=$T._layerList[$O];$l._visible=0!=($l._mask&$T._visibleLayers)}}),$T.__init__=function(){$T._layerList.length=31;for(var $j=0;$j<31;$j++){var $O=new $T;$T._layerList[$j]=$O,0===$j?($O.name="Default Layer",$O.visible=!0):($O.name="Layer-"+$j,$O.visible=!1),$O._number=$j,$O._mask=Math.pow(2,$j)}$T.currentCreationLayer=$T._layerList[0]},$T.getLayerByNumber=function($j){if($j<0||30<$j)throw new Error("无法返回指定Layer，该number超出范围！");return $T._layerList[$j]},$T.getLayerByName=function($j){for(var $O=0;$O<31;$O++)if($T._layerList[$O].name===$j)return $T._layerList[$O];throw new Error("无法返回指定Layer,该name不存在")},$T.isVisible=function($j){return 0!=($j&$T._currentCameraCullingMask&$T._visibleLayers)},$T._layerList=[],$T._visibleLayers=2147483647,$T._collsionTestList=[],$T._currentCameraCullingMask=2147483647,$T.maxCount=31,$T.currentCreationLayer=null,$T}()),$q=(function(){function $j($j,$O,$V){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$j,this._minCount=$O,this._maxCount=$V}$w($j,"laya.d3.core.particleShuriKen.module.Burst");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.cloneTo=function($j){var $O=$j;$O._time=this._time,$O._minCount=this._minCount,$O._maxCount=this._maxCount},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"time",function(){return this._time}),$s(0,$O,"minCount",function(){return this._minCount}),$s(0,$O,"maxCount",function(){return this._maxCount})}(),function(){function $j($j){this._color=null,this.enbale=!1,this._color=$j}$w($j,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $O=$j.prototype;$O.cloneTo=function($j){var $O=$j;this._color.cloneTo($O._color),$O.enbale=this.enbale},$O.clone=function(){var $j;switch(this._color.type){case 0:$j=$k.createByConstant(this._color.constant.clone());break;case 1:$j=$k.createByGradient(this._color.gradient.clone());break;case 2:$j=$k.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$j=$k.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $O=new this.constructor($j);return $O.enbale=this.enbale,$O},$s(0,$O,"color",function(){return this._color})}(),function(){function $j(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$w($j,"laya.d3.core.particleShuriKen.module.Emission");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$O._destroy=function(){this._bursts=null,this._destroyed=!0},$O.getBurstsCount=function(){return this._bursts.length},$O.getBurstByIndex=function($j){return this._bursts[$j]},$O.addBurst=function($j){var $O=this._bursts.length;if(0<$O)for(var $V=0;$V<$O;$V++)this._bursts[$V].time>$j.time&&this._bursts.splice($V,0,$j);this._bursts.push($j)},$O.removeBurst=function($j){var $O=this._bursts.indexOf($j);-1!==$O&&this._bursts.splice($O,1)},$O.removeBurstByIndex=function($j){this._bursts.splice($j,1)},$O.clearBurst=function(){this._bursts.length=0},$O.cloneTo=function($j){var $O=$j,$V=$O._bursts;$V.length=this._bursts.length;for(var $l=0,$T=this._bursts.length;$l<$T;$l++){var $S=$V[$l];$S?this._bursts[$l].cloneTo($S):$V[$l]=this._bursts[$l].clone()}$O._emissionRate=this._emissionRate,$O.enbale=this.enbale},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"destroyed",function(){return this._destroyed}),$s(0,$O,"emissionRate",function(){return this._emissionRate},function($j){if($j<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$j})}(),function(){function $l(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$w($l,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $j=$l.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.cloneTo=function($j){var $O=$j;$O._type=this._type,$O._constant=this._constant,this._overTime.cloneTo($O._overTime),$O._constantMin=this._constantMin,$O._constantMax=this._constantMax,this._overTimeMin.cloneTo($O._overTimeMin),this._overTimeMax.cloneTo($O._overTimeMax)},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$j,"frameOverTimeData",function(){return this._overTime}),$s(0,$j,"constant",function(){return this._constant}),$s(0,$j,"type",function(){return this._type}),$s(0,$j,"frameOverTimeDataMin",function(){return this._overTimeMin}),$s(0,$j,"constantMin",function(){return this._constantMin}),$s(0,$j,"frameOverTimeDataMax",function(){return this._overTimeMax}),$s(0,$j,"constantMax",function(){return this._constantMax}),$l.createByConstant=function($j){var $O=new $l;return $O._type=0,$O._constant=$j,$O},$l.createByOverTime=function($j){var $O=new $l;return $O._type=1,$O._overTime=$j,$O},$l.createByRandomTwoConstant=function($j,$O){var $V=new $l;return $V._type=2,$V._constantMin=$j,$V._constantMax=$O,$V},$l.createByRandomTwoOverTime=function($j,$O){var $V=new $l;return $V._type=3,$V._overTimeMin=$j,$V._overTimeMax=$O,$V},$l}()),$i=function(){function $H(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$w($H,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $j=$H.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.cloneTo=function($j){var $O=$j;$O._type=this._type,$O._separateAxes=this._separateAxes,$O._constant=this._constant,this._constantSeparate.cloneTo($O._constantSeparate),this._gradient.cloneTo($O._gradient),this._gradientX.cloneTo($O._gradientX),this._gradientY.cloneTo($O._gradientY),this._gradientZ.cloneTo($O._gradientZ),$O._constantMin=this._constantMin,$O._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($O._constantMinSeparate),this._constantMaxSeparate.cloneTo($O._constantMaxSeparate),this._gradientMin.cloneTo($O._gradientMin),this._gradientMax.cloneTo($O._gradientMax),this._gradientXMin.cloneTo($O._gradientXMin),this._gradientXMax.cloneTo($O._gradientXMax),this._gradientYMin.cloneTo($O._gradientYMin),this._gradientYMax.cloneTo($O._gradientYMax),this._gradientZMin.cloneTo($O._gradientZMin),this._gradientZMax.cloneTo($O._gradientZMax)},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$j,"gradientZ",function(){return this._gradientZ}),$s(0,$j,"constant",function(){return this._constant}),$s(0,$j,"gradient",function(){return this._gradient}),$s(0,$j,"separateAxes",function(){return this._separateAxes}),$s(0,$j,"type",function(){return this._type}),$s(0,$j,"constantSeparate",function(){return this._constantSeparate}),$s(0,$j,"gradientX",function(){return this._gradientX}),$s(0,$j,"gradientY",function(){return this._gradientY}),$s(0,$j,"gradientW",function(){return this._gradientW}),$s(0,$j,"gradientMin",function(){return this._gradientMin}),$s(0,$j,"constantMin",function(){return this._constantMin}),$s(0,$j,"gradientMax",function(){return this._gradientMax}),$s(0,$j,"constantMax",function(){return this._constantMax}),$s(0,$j,"gradientWMin",function(){return this._gradientWMin}),$s(0,$j,"constantMinSeparate",function(){return this._constantMinSeparate}),$s(0,$j,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$s(0,$j,"gradientXMin",function(){return this._gradientXMin}),$s(0,$j,"gradientXMax",function(){return this._gradientXMax}),$s(0,$j,"gradientWMax",function(){return this._gradientWMax}),$s(0,$j,"gradientYMin",function(){return this._gradientYMin}),$s(0,$j,"gradientYMax",function(){return this._gradientYMax}),$s(0,$j,"gradientZMin",function(){return this._gradientZMin}),$s(0,$j,"gradientZMax",function(){return this._gradientZMax}),$H.createByConstant=function($j){var $O=new $H;return $O._type=0,$O._separateAxes=!1,$O._constant=$j,$O},$H.createByConstantSeparate=function($j){var $O=new $H;return $O._type=0,$O._separateAxes=!0,$O._constantSeparate=$j,$O},$H.createByGradient=function($j){var $O=new $H;return $O._type=1,$O._separateAxes=!1,$O._gradient=$j,$O},$H.createByGradientSeparate=function($j,$O,$V,$l){var $T=new $H;return $T._type=1,$T._separateAxes=!0,$T._gradientX=$j,$T._gradientY=$O,$T._gradientZ=$V,$T._gradientW=$l,$T},$H.createByRandomTwoConstant=function($j,$O){var $V=new $H;return $V._type=2,$V._separateAxes=!1,$V._constantMin=$j,$V._constantMax=$O,$V},$H.createByRandomTwoConstantSeparate=function($j,$O){var $V=new $H;return $V._type=2,$V._separateAxes=!0,$V._constantMinSeparate=$j,$V._constantMaxSeparate=$O,$V},$H.createByRandomTwoGradient=function($j,$O){var $V=new $H;return $V._type=3,$V._separateAxes=!1,$V._gradientMin=$j,$V._gradientMax=$O,$V},$H.createByRandomTwoGradientSeparate=function($j,$O,$V,$l,$T,$S,$m,$p){var $o=new $H;return $o._type=3,$o._separateAxes=!0,$o._gradientXMin=$j,$o._gradientXMax=$O,$o._gradientYMin=$V,$o._gradientYMax=$l,$o._gradientZMin=$T,$o._gradientZMax=$S,$o._gradientWMin=$m,$o._gradientWMax=$p,$o},$H}(),$k=function(){function $l(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$w($l,"laya.d3.core.particleShuriKen.module.GradientColor");var $j=$l.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.cloneTo=function($j){var $O=$j;$O._type=this._type,this._constant.cloneTo($O._constant),this._constantMin.cloneTo($O._constantMin),this._constantMax.cloneTo($O._constantMax),this._gradient.cloneTo($O._gradient),this._gradientMin.cloneTo($O._gradientMin),this._gradientMax.cloneTo($O._gradientMax)},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$j,"gradient",function(){return this._gradient}),$s(0,$j,"constant",function(){return this._constant}),$s(0,$j,"type",function(){return this._type}),$s(0,$j,"gradientMin",function(){return this._gradientMin}),$s(0,$j,"constantMin",function(){return this._constantMin}),$s(0,$j,"gradientMax",function(){return this._gradientMax}),$s(0,$j,"constantMax",function(){return this._constantMax}),$l.createByConstant=function($j){var $O=new $l;return $O._type=0,$O._constant=$j,$O},$l.createByGradient=function($j){var $O=new $l;return $O._type=1,$O._gradient=$j,$O},$l.createByRandomTwoConstant=function($j,$O){var $V=new $l;return $V._type=2,$V._constantMin=$j,$V._constantMax=$O,$V},$l.createByRandomTwoGradient=function($j,$O){var $V=new $l;return $V._type=3,$V._gradientMin=$j,$V._gradientMax=$O,$V},$l}(),$n=(function(){function $j(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$w($j,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.addAlpha=function($j,$O){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$j&&($j=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$j,this._alphaElements[this._alphaCurrentLength++]=$O):DEBUG},$O.addRGB=function($j,$O){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$j&&($j=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$j,this._rgbElements[this._rgbCurrentLength++]=$O.x,this._rgbElements[this._rgbCurrentLength++]=$O.y,this._rgbElements[this._rgbCurrentLength++]=$O.z):DEBUG},$O.cloneTo=function($j){var $O=$j,$V=0,$l=0;$O._alphaCurrentLength=this._alphaCurrentLength;var $T=$O._alphaElements;for($T.length=this._alphaElements.length,$V=0,$l=this._alphaElements.length;$V<$l;$V++)$T[$V]=this._alphaElements[$V];$O._rgbCurrentLength=this._rgbCurrentLength;var $S=$O._rgbElements;for($S.length=this._rgbElements.length,$V=0,$l=this._rgbElements.length;$V<$l;$V++)$S[$V]=this._rgbElements[$V]},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$s(0,$O,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $j(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$w($j,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.add=function($j,$O){this._currentLength<8?(6===this._currentLength&&1!==$j&&($j=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$j,this._elements[this._currentLength++]=$O):console.log("Warning:data count must lessEqual than 4")},$O.cloneTo=function($j){var $O=$j;$O._currentLength=this._currentLength;var $V=$O._elements;$V.length=this._elements.length;for(var $l=0,$T=this._elements.length;$l<$T;$l++)$V[$l]=this._elements[$l]},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"gradientCount",function(){return this._currentLength/2})}(),function(){function $j(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$w($j,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.add=function($j,$O){this._currentLength<8?(6===this._currentLength&&1!==$j&&($j=1,DEBUG),this._elements[this._currentLength++]=$j,this._elements[this._currentLength++]=$O):DEBUG},$O.getKeyByIndex=function($j){return this._elements[2*$j]},$O.getValueByIndex=function($j){return this._elements[2*$j+1]},$O.getAverageValue=function(){for(var $j=0,$O=this._currentLength-2;$j<$O;$j+=2){this._elements[$j+1];this._elements[$j+3],this._elements[$j+2]-this._elements[$j]}return 0},$O.cloneTo=function($j){var $O=$j;$O._currentLength=this._currentLength;var $V=$O._elements;$V.length=this._elements.length;for(var $l=0,$T=this._elements.length;$l<$T;$l++)$V[$l]=this._elements[$l]},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"gradientCount",function(){return this._currentLength/2})}(),function(){function $j(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$w($j,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.add=function($j,$O){this._currentLength<8?(6===this._currentLength&&1!==$j&&($j=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$j,this._elements[this._currentLength++]=$O.x,this._elements[this._currentLength++]=$O.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$O.cloneTo=function($j){var $O=$j;$O._currentLength=this._currentLength;var $V=$O._elements;$V.length=this._elements.length;for(var $l=0,$T=this._elements.length;$l<$T;$l++)$V[$l]=this._elements[$l]},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"gradientCount",function(){return this._currentLength/3})}(),function(){function $p(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$w($p,"laya.d3.core.particleShuriKen.module.GradientSize");var $j=$p.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.getMaxSizeInGradient=function(){var $j=0,$O=0,$V=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($j=0,$O=this._gradientX.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientX.getValueByIndex($j));for($j=0,$O=this._gradientY.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientY.getValueByIndex($j))}else for($j=0,$O=this._gradient.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradient.getValueByIndex($j));break;case 1:$V=this._separateAxes?($V=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$V=Math.max($V,this._constantMinSeparate.y),Math.max($V,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($j=0,$O=this._gradientXMin.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientXMin.getValueByIndex($j));for($j=0,$O=this._gradientXMax.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientXMax.getValueByIndex($j));for($j=0,$O=this._gradientYMin.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientYMin.getValueByIndex($j));for($j=0,$O=this._gradientZMax.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientZMax.getValueByIndex($j))}else{for($j=0,$O=this._gradientMin.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientMin.getValueByIndex($j));for($j=0,$O=this._gradientMax.gradientCount;$j<$O;$j++)$V=Math.max($V,this._gradientMax.getValueByIndex($j))}}return $V},$j.cloneTo=function($j){var $O=$j;$O._type=this._type,$O._separateAxes=this._separateAxes,this._gradient.cloneTo($O._gradient),this._gradientX.cloneTo($O._gradientX),this._gradientY.cloneTo($O._gradientY),this._gradientZ.cloneTo($O._gradientZ),$O._constantMin=this._constantMin,$O._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($O._constantMinSeparate),this._constantMaxSeparate.cloneTo($O._constantMaxSeparate),this._gradientMin.cloneTo($O._gradientMin),this._gradientMax.cloneTo($O._gradientMax),this._gradientXMin.cloneTo($O._gradientXMin),this._gradientXMax.cloneTo($O._gradientXMax),this._gradientYMin.cloneTo($O._gradientYMin),this._gradientYMax.cloneTo($O._gradientYMax),this._gradientZMin.cloneTo($O._gradientZMin),this._gradientZMax.cloneTo($O._gradientZMax)},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$j,"gradientZ",function(){return this._gradientZ}),$s(0,$j,"gradient",function(){return this._gradient}),$s(0,$j,"separateAxes",function(){return this._separateAxes}),$s(0,$j,"type",function(){return this._type}),$s(0,$j,"gradientMin",function(){return this._gradientMin}),$s(0,$j,"constantMin",function(){return this._constantMin}),$s(0,$j,"gradientX",function(){return this._gradientX}),$s(0,$j,"gradientY",function(){return this._gradientY}),$s(0,$j,"gradientMax",function(){return this._gradientMax}),$s(0,$j,"constantMax",function(){return this._constantMax}),$s(0,$j,"constantMinSeparate",function(){return this._constantMinSeparate}),$s(0,$j,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$s(0,$j,"gradientXMin",function(){return this._gradientXMin}),$s(0,$j,"gradientXMax",function(){return this._gradientXMax}),$s(0,$j,"gradientYMin",function(){return this._gradientYMin}),$s(0,$j,"gradientYMax",function(){return this._gradientYMax}),$s(0,$j,"gradientZMin",function(){return this._gradientZMin}),$s(0,$j,"gradientZMax",function(){return this._gradientZMax}),$p.createByGradient=function($j){var $O=new $p;return $O._type=0,$O._separateAxes=!1,$O._gradient=$j,$O},$p.createByGradientSeparate=function($j,$O,$V){var $l=new $p;return $l._type=0,$l._separateAxes=!0,$l._gradientX=$j,$l._gradientY=$O,$l._gradientZ=$V,$l},$p.createByRandomTwoConstant=function($j,$O){var $V=new $p;return $V._type=1,$V._separateAxes=!1,$V._constantMin=$j,$V._constantMax=$O,$V},$p.createByRandomTwoConstantSeparate=function($j,$O){var $V=new $p;return $V._type=1,$V._separateAxes=!0,$V._constantMinSeparate=$j,$V._constantMaxSeparate=$O,$V},$p.createByRandomTwoGradient=function($j,$O){var $V=new $p;return $V._type=2,$V._separateAxes=!1,$V._gradientMin=$j,$V._gradientMax=$O,$V},$p.createByRandomTwoGradientSeparate=function($j,$O,$V,$l,$T,$S){var $m=new $p;return $m._type=2,$m._separateAxes=!0,$m._gradientXMin=$j,$m._gradientXMax=$O,$m._gradientYMin=$V,$m._gradientYMax=$l,$m._gradientZMin=$T,$m._gradientZMax=$S,$m},$p}()),$G=function(){function $p(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$w($p,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $j=$p.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.cloneTo=function($j){var $O=$j;$O._type=this._type,this._constant.cloneTo($O._constant),this._gradientX.cloneTo($O._gradientX),this._gradientY.cloneTo($O._gradientY),this._gradientZ.cloneTo($O._gradientZ),this._constantMin.cloneTo($O._constantMin),this._constantMax.cloneTo($O._constantMax),this._gradientXMin.cloneTo($O._gradientXMin),this._gradientXMax.cloneTo($O._gradientXMax),this._gradientYMin.cloneTo($O._gradientYMin),this._gradientYMax.cloneTo($O._gradientYMax),this._gradientZMin.cloneTo($O._gradientZMin),this._gradientZMax.cloneTo($O._gradientZMax)},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$j,"gradientZ",function(){return this._gradientZ}),$s(0,$j,"constant",function(){return this._constant}),$s(0,$j,"type",function(){return this._type}),$s(0,$j,"gradientXMax",function(){return this._gradientXMax}),$s(0,$j,"constantMin",function(){return this._constantMin}),$s(0,$j,"gradientX",function(){return this._gradientX}),$s(0,$j,"gradientY",function(){return this._gradientY}),$s(0,$j,"gradientXMin",function(){return this._gradientXMin}),$s(0,$j,"constantMax",function(){return this._constantMax}),$s(0,$j,"gradientYMin",function(){return this._gradientYMin}),$s(0,$j,"gradientYMax",function(){return this._gradientYMax}),$s(0,$j,"gradientZMin",function(){return this._gradientZMin}),$s(0,$j,"gradientZMax",function(){return this._gradientZMax}),$p.createByConstant=function($j){var $O=new $p;return $O._type=0,$O._constant=$j,$O},$p.createByGradient=function($j,$O,$V){var $l=new $p;return $l._type=1,$l._gradientX=$j,$l._gradientY=$O,$l._gradientZ=$V,$l},$p.createByRandomTwoConstant=function($j,$O){var $V=new $p;return $V._type=2,$V._constantMin=$j,$V._constantMax=$O,$V},$p.createByRandomTwoGradient=function($j,$O,$V,$l,$T,$S){var $m=new $p;return $m._type=3,$m._gradientXMin=$j,$m._gradientXMax=$O,$m._gradientYMin=$V,$m._gradientYMax=$l,$m._gradientZMin=$T,$m._gradientZMax=$S,$m},$p}(),$F=(function(){function $j($j){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$j}$w($j,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.cloneTo=function($j){var $O=$j;this._angularVelocity.cloneTo($O._angularVelocity),$O.enbale=this.enbale},$O.clone=function(){var $j;switch(this._angularVelocity.type){case 0:$j=this._angularVelocity.separateAxes?$i.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$i.createByConstant(this._angularVelocity.constant);break;case 1:$j=this._angularVelocity.separateAxes?$i.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$i.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$j=this._angularVelocity.separateAxes?$i.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$i.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$j=this._angularVelocity.separateAxes?$i.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$i.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $O=new this.constructor($j);return $O.enbale=this.enbale,$O},$s(0,$O,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $j(){this.enable=!1,this.randomDirection=!1}$w($j,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.core.IClone":!0}),$O._getShapeBoundBox=function($j){throw new Error("BaseShape: must override it.")},$O._getSpeedBoundBox=function($j){throw new Error("BaseShape: must override it.")},$O.generatePositionAndDirection=function($j,$O,$V,$l){throw new Error("BaseShape: must override it.")},$O._calculateProceduralBounds=function($j,$O,$V){this._getShapeBoundBox($j);var $l=$j.min,$T=$j.max;$mO.multiply($l,$O,$l),$mO.multiply($T,$O,$T);var $S=new $Lj(new $mO,new $mO);this.randomDirection?($S.min=new $mO(-1,-1,-1),$S.max=new $mO(1,1,1)):this._getSpeedBoundBox($S);var $m=new $Lj(new $mO,new $mO),$p=$m.min,$o=$m.max;$mO.scale($S.min,$V.y,$p),$mO.scale($S.max,$V.y,$o),$mO.add($j.min,$p,$p),$mO.add($j.max,$o,$o),$mO.min($j.min,$p,$j.min),$mO.max($j.max,$p,$j.max);var $H=new $Lj(new $mO,new $mO),$g=$H.min,$e=$H.max;$mO.scale($S.min,$V.x,$g),$mO.scale($S.max,$V.x,$e),$mO.min($H.min,$e,$p),$mO.max($H.min,$e,$o),$mO.min($j.min,$p,$j.min),$mO.max($j.max,$p,$j.max)},$O.cloneTo=function($j){$j.enable=this.enable},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$j}()),$J=function(){function $S(){}return $w($S,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$S._randomPointUnitArcCircle=function($j,$O,$V){var $l=$O.elements,$T=NaN;$T=$V?$V.getFloat()*$j:Math.random()*$j,$l[0]=Math.cos($T),$l[1]=Math.sin($T)},$S._randomPointInsideUnitArcCircle=function($j,$O,$V){var $l=$O.elements;$S._randomPointUnitArcCircle($j,$O,$V);var $T=NaN;$T=$V?Math.pow($V.getFloat(),.5):Math.pow(Math.random(),.5),$l[0]=$l[0]*$T,$l[1]=$l[1]*$T},$S._randomPointUnitCircle=function($j,$O){var $V=$j.elements,$l=NaN;$l=$O?$O.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$V[0]=Math.cos($l),$V[1]=Math.sin($l)},$S._randomPointInsideUnitCircle=function($j,$O){var $V=$j.elements;$S._randomPointUnitCircle($j);var $l=NaN;$l=$O?Math.pow($O.getFloat(),.5):Math.pow(Math.random(),.5),$V[0]=$V[0]*$l,$V[1]=$V[1]*$l},$S._randomPointUnitSphere=function($j,$O){var $V=$j.elements,$l=NaN,$T=NaN;$T=$O?($l=$V[2]=2*$O.getFloat()-1,$O.getFloat()*Math.PI*2):($l=$V[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $S=Math.sqrt(1-$l*$l);$V[0]=$S*Math.cos($T),$V[1]=$S*Math.sin($T)},$S._randomPointInsideUnitSphere=function($j,$O){var $V=$j.elements;$S._randomPointUnitSphere($j);var $l=NaN;$l=$O?Math.pow($O.getFloat(),1/3):Math.pow(Math.random(),1/3),$V[0]=$V[0]*$l,$V[1]=$V[1]*$l,$V[2]=$V[2]*$l},$S._randomPointInsideHalfUnitBox=function($j,$O){var $V=$j.elements;$O?($V[0]=$O.getFloat()-.5,$V[1]=$O.getFloat()-.5,$V[2]=$O.getFloat()-.5):($V[0]=Math.random()-.5,$V[1]=Math.random()-.5,$V[2]=Math.random()-.5)},$S}(),$u=(function(){function $j($j){this._size=null,this.enbale=!1,this._size=$j}$w($j,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.cloneTo=function($j){var $O=$j;this._size.cloneTo($O._size),$O.enbale=this.enbale},$O.clone=function(){var $j;switch(this._size.type){case 0:$j=this._size.separateAxes?$n.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$n.createByGradient(this._size.gradient.clone());break;case 1:$j=this._size.separateAxes?$n.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$n.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$j=this._size.separateAxes?$n.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$n.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $O=new this.constructor($j);return $O.enbale=this.enbale,$O},$s(0,$O,"size",function(){return this._size})}(),function(){function $l(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$w($l,"laya.d3.core.particleShuriKen.module.StartFrame");var $j=$l.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.cloneTo=function($j){var $O=$j;$O._type=this._type,$O._constant=this._constant,$O._constantMin=this._constantMin,$O._constantMax=this._constantMax},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$j,"constant",function(){return this._constant}),$s(0,$j,"type",function(){return this._type}),$s(0,$j,"constantMin",function(){return this._constantMin}),$s(0,$j,"constantMax",function(){return this._constantMax}),$l.createByConstant=function($j){var $O=new $l;return $O._type=0,$O._constant=$j,$O},$l.createByRandomTwoConstant=function($j,$O){var $V=new $l;return $V._type=1,$V._constantMin=$j,$V._constantMax=$O,$V},$l}()),$y=(function(){function $j($j,$O){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $SO(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$j,this._startFrame=$O}$w($j,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.cloneTo=function($j){var $O=$j;this.tiles.cloneTo($O.tiles),$O.type=this.type,$O.randomRow=this.randomRow,this._frame.cloneTo($O._frame),this._startFrame.cloneTo($O._startFrame),$O.cycles=this.cycles,$O.enableUVChannels=this.enableUVChannels,$O.enable=this.enable},$O.clone=function(){var $j,$O;switch(this._frame.type){case 0:$j=$q.createByConstant(this._frame.constant);break;case 1:$j=$q.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$j=$q.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$j=$q.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$O=$u.createByConstant(this._startFrame.constant);break;case 1:$O=$u.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $V=new this.constructor($j,$O);return this.tiles.cloneTo($V.tiles),$V.type=this.type,$V.randomRow=this.randomRow,$V.cycles=this.cycles,$V.enableUVChannels=this.enableUVChannels,$V.enable=this.enable,$V},$s(0,$O,"frame",function(){return this._frame}),$s(0,$O,"startFrame",function(){return this._startFrame})}(),function(){function $j($j){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$j}$w($j,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $O=$j.prototype;$Z.imps($O,{"laya.d3.core.IClone":!0}),$O.cloneTo=function($j){var $O=$j;this._velocity.cloneTo($O._velocity),$O.enbale=this.enbale,$O.space=this.space},$O.clone=function(){var $j;switch(this._velocity.type){case 0:$j=$G.createByConstant(this._velocity.constant.clone());break;case 1:$j=$G.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$j=$G.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$j=$G.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $O=new this.constructor($j);return $O.enbale=this.enbale,$O.space=this.space,$O},$s(0,$O,"velocity",function(){return this._velocity})}(),function(){function $j(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $tO,this._vb=$FO.create($j._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$GO.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$kO.nameKey.getID("LINE"),this._shaderCompile=$UO._preCompileShader[this._sharderNameID]}$w($j,"laya.d3.core.PhasorSpriter3D");var $O=$j.prototype;return $O.line=function($j,$O,$V,$l){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($j.x,$j.y,$j.z,$O.x,$O.y,$O.z,$O.w),this.addVertex($V.x,$V.y,$V.z,$l.x,$l.y,$l.z,$l.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$O.circle=function($j,$O,$V,$l,$T,$S){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$O,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$O,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$j,Math.cos(this._tempNumver0)*$j,0,$V,$l,$T,$S),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$O.plane=function($j,$O,$V,$l,$T,$S,$m,$p,$o){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$l/2,this._tempNumver1=$T/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($j-this._tempNumver0,$O+this._tempNumver1,$V,$S,$m,$p,$o),this.addVertex($j+this._tempNumver0,$O+this._tempNumver1,$V,$S,$m,$p,$o),this.addVertex($j-this._tempNumver0,$O-this._tempNumver1,$V,$S,$m,$p,$o),this.addVertex($j+this._tempNumver0,$O-this._tempNumver1,$V,$S,$m,$p,$o),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$O.box=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$l/2,this._tempNumver1=$T/2,this._tempNumver2=$S/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($j-this._tempNumver0,$O+this._tempNumver1,$V+this._tempNumver2,$m,$p,$o,$H),this.addVertex($j+this._tempNumver0,$O+this._tempNumver1,$V+this._tempNumver2,$m,$p,$o,$H),this.addVertex($j-this._tempNumver0,$O-this._tempNumver1,$V+this._tempNumver2,$m,$p,$o,$H),this.addVertex($j+this._tempNumver0,$O-this._tempNumver1,$V+this._tempNumver2,$m,$p,$o,$H),this.addVertex($j+this._tempNumver0,$O+this._tempNumver1,$V-this._tempNumver2,$m,$p,$o,$H),this.addVertex($j-this._tempNumver0,$O+this._tempNumver1,$V-this._tempNumver2,$m,$p,$o,$H),this.addVertex($j+this._tempNumver0,$O-this._tempNumver1,$V-this._tempNumver2,$m,$p,$o,$H),this.addVertex($j-this._tempNumver0,$O-this._tempNumver1,$V-this._tempNumver2,$m,$p,$o,$H),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$O.cone=function($j,$O,$V,$l,$T,$S,$m){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$V+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$V>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$V,this.addVertexIndex(0,$O,0,$l,$T,$S,$m,this._tempUint0),this.addVertexIndex(0,0,0,$l,$T,$S,$m,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$V;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($j*this._tempNumver2,0,$j*this._tempNumver3,$l,$T,$S,$m,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$V-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($j*this._tempNumver2,0,$j*this._tempNumver3,$l,$T,$S,$m,this._tempUint0+(this._tempInt0+$V)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$V-1?this.addIndexes(this._tempUint1+$V+2):this.addIndexes(this._tempUint1+this._tempInt0+$V+1),this.addIndexes(this._tempUint1+this._tempInt0+$V),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$O.boundingBoxLine=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($j,$T,$S,$m,$p,$o,$H),this.addVertex($l,$T,$S,$m,$p,$o,$H),this.addVertex($j,$O,$S,$m,$p,$o,$H),this.addVertex($l,$O,$S,$m,$p,$o,$H),this.addVertex($l,$T,$V,$m,$p,$o,$H),this.addVertex($j,$T,$V,$m,$p,$o,$H),this.addVertex($l,$O,$V,$m,$p,$o,$H),this.addVertex($j,$O,$V,$m,$p,$o,$H),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$O.addVertex=function($j,$O,$V,$l,$T,$S,$m){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$j,this._vbData[this._posInVBData+1]=$O,this._vbData[this._posInVBData+2]=$V,this._vbData[this._posInVBData+3]=$l,this._vbData[this._posInVBData+4]=$T,this._vbData[this._posInVBData+5]=$S,this._vbData[this._posInVBData+6]=$m,this._posInVBData+=this._floatSizePerVer,this},$O.addVertexIndex=function($j,$O,$V,$l,$T,$S,$m,$p){return this._hasBegun||this.addVertexIndexException(),this._vbData[$p]=$j,this._vbData[$p+1]=$O,this._vbData[$p+2]=$V,this._vbData[$p+3]=$l,this._vbData[$p+4]=$T,this._vbData[$p+5]=$S,this._vbData[$p+6]=$m,($p+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$p),this},$O.addIndexes=function($j){var $O=arguments;this._hasBegun||this.addVertexIndexException();for(var $V=0;$V<$O.length;$V++)this._ibData[this._posInIBData]=$O[$V],this._posInIBData++;return this},$O.begin=function($j,$O){return this._hasBegun&&this.beginException0(),1!==$j&&4!==$j&&this.beginException1(),this._primitiveType=$j,this._camera=$O,this._hasBegun=!0,this},$O.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$O.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($j._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$U.drawCall++,$M.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$O.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$O.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$O.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$O.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$O.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$O.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(28,[new $mj(0,"vector3",0),new $mj(12,"vector4",1)])}]),$j}()),$W=function(){function $j(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$j._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $tO}$w($j,"laya.d3.core.render.RenderElement");var $O=$j.prototype;return $O.getDynamicBatchBakedVertexs=function($j){for(var $O=this._renderObj._getVertexBuffer($j),$V=$O.getData().slice(),$l=$O.vertexDeclaration,$T=$l.getVertexElementByUsage(0).offset/4,$S=$l.getVertexElementByUsage(3).offset/4,$m=this._sprite3D.transform,$p=$m.worldMatrix,$o=$m.rotation,$H=$l.vertexStride/4,$g=0,$e=$V.length;$g<$e;$g+=$H){var $t=$g+$T,$w=$g+$S;$rO.transformVector3ArrayToVector3ArrayCoordinate($V,$t,$p,$V,$t),$rO.transformVector3ArrayByQuat($V,$w,$o,$V,$w)}return $V},$O.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$O._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$s(0,$O,"id",function(){return this._id}),$s(0,$O,"renderObj",function(){return this._renderObj},function($j){this._renderObj!==$j&&(this._renderObj=$j)}),$j._uniqueIDCounter=0,$j}(),$K=function(){function $O($j){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$O._uniqueIDCounter,this._needSort=!1,this._scene=$j,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$w($O,"laya.d3.core.render.RenderQueue");var $j=$O.prototype;return $j._sortOpaqueFunc=function($j,$O){if($j._render&&$O._render){var $V=$j._material.renderQueue-$O._material.renderQueue;return 0==$V?$j._render._distanceForSort-$O._render._distanceForSort:$V}return 0},$j._sortAlphaFunc=function($j,$O){if($j._render&&$O._render){var $V=$j._material.renderQueue-$O._material.renderQueue;return 0==$V?$O._render._distanceForSort-$j._render._distanceForSort:$V}return 0},$j._begainRenderElement=function($j,$O,$V){return!!$O._beforeRender($j)},$j._sortAlpha=function($j){$O._cameraPosition=$j,this._finalElements.sort(this._sortAlphaFunc)},$j._sortOpaque=function($j){$O._cameraPosition=$j,this._finalElements.sort(this._sortOpaqueFunc)},$j._preRender=function($j){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$j._render=function($j,$O){for(var $V,$l,$T,$S,$m,$p,$o=$U.loopCount,$H=this._scene,$g=$j.camera,$e=($g.id,!1),$t=0,$w=this._finalElements.length;$t<$w;$t++){var $s,$b,$r,$h=this._finalElements[$t];if(null!=$h._onPreRenderFunction&&$h._onPreRenderFunction.call($h._sprite3D,$j),0===$h._type){if($j.owner=$r=$h._sprite3D,$j.renderElement=$h,$r._preRenderUpdateComponents($j),$s=$h.renderObj,$b=$h._material,this._begainRenderElement($j,$s,$b)){if($V=$s._getVertexBuffers(),!($T=($l=$s._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$l.id]){this._errorRecord[$l.id]=1;var $a="vertexBuffer:"+("("+$l._destroyed+","+$l._released+","+$l._referenceCount+","+$l._buffer+")")+", material:"+($b?$b.__className+"("+$b._destroyed+","+$b._released+")":"null")+", owner:"+($r?$r.__className+"("+$r._destroyed+","+$r._activeInHierarchy+","+$r._displayedInStage+")":"null")+", renderObj:"+($s?$s.__className+"("+$s._destroyed+","+$s._released+","+$s._referenceCount+")":"")+", parent:, url:"+($r?$r.url:"")+", disposeStack:"+$l.disposeStack;$Z.recordError("报错：unknown vertexDeclaration  "+$a)}continue}if($e=($S=$j._shader=$b._getShader($H._shaderDefineValue,$T.shaderDefineValue,$r._shaderDefineValue)).bind()||$o!==$S._uploadLoopCount,$V){if($S._uploadVertexBuffer!==$V||$e){for(var $c=0;$c<$V.length;$c++){var $A=$V[$c];$S.uploadAttributesX($A.vertexDeclaration.shaderValues.data,$A)}$S._uploadVertexBuffer=$V}}else($S._uploadVertexBuffer!==$l||$e)&&($S.uploadAttributes($T.shaderValues.data,null),$S._uploadVertexBuffer=$l);($S._uploadScene!==$H||$e)&&($S.uploadSceneUniforms($H._shaderValues.data),$S._uploadScene=$H),($g!==$S._uploadCamera||$S._uploadSprite3D!==$r||$e)&&($S.uploadSpriteUniforms($r._shaderValues.data),$S._uploadSprite3D=$r),($g!==$S._uploadCamera||$e)&&($S.uploadCameraUniforms($g._shaderValues.data),$S._uploadCamera=$g),($S._uploadMaterial!==$b||$e)&&($b._upload(),$S._uploadMaterial=$b),$m!==$b?($b._setRenderStateBlendDepth(),$b._setRenderStateFrontFace($O,$r.transform),$m=$b,$p=$r):$p!==$r&&($b._setRenderStateFrontFace($O,$r.transform),$p=$r),$s._render($j),$S._uploadLoopCount=$o}$r._postRenderUpdateComponents($j)}else if(2===$h._type){$h.renderObj;$j.owner=$r=$h._sprite3D,$j.renderElement=$h,$j._batchIndexStart=$h._tempBatchIndexStart,$j._batchIndexEnd=$h._tempBatchIndexEnd,$s=$h.renderObj,$b=$h._material,this._begainRenderElement($j,$s,$b)&&($T=($l=$s._getVertexBuffer(0)).vertexDeclaration,$e=($S=$j._shader=$b._getShader($H._shaderDefineValue,$T.shaderDefineValue,$r._shaderDefineValue)).bind()||$o!==$S._uploadLoopCount,($S._uploadVertexBuffer!==$l||$e)&&($S.uploadAttributes($T.shaderValues.data,null),$S._uploadVertexBuffer=$l),($S._uploadScene!==$H||$e)&&($S.uploadSceneUniforms($H._shaderValues.data),$S._uploadScene=$H),($g!==$S._uploadCamera||$S._uploadSprite3D!==$r||$e)&&($S.uploadSpriteUniforms($r._shaderValues.data),$S._uploadSprite3D=$r),($g!==$S._uploadCamera||$e)&&($S.uploadCameraUniforms($g._shaderValues.data),$S._uploadCamera=$g),($S._uploadMaterial!==$b||$e)&&($b._upload(),$S._uploadMaterial=$b),$m!==$b?($b._setRenderStateBlendDepth(),$b._setRenderStateFrontFace($O,$r.transform),$m=$b,$p=$r):$p!==$r&&($b._setRenderStateFrontFace($O,$r.transform),$p=$r),$s._render($j),$S._uploadLoopCount=$o)}}},$j._renderShadow=function($j,$O){for(var $V,$l,$T,$S,$m,$p=$U.loopCount,$o=this._scene,$H=$j.camera,$g=!1,$e=0,$t=this._finalElements.length;$e<$t;$e++){var $w,$s,$b,$r=this._finalElements[$e];0===$r._type&&($j.owner=$b=$r._sprite3D,$O||$b._projectionViewWorldUpdateCamera===$H&&$b._projectionViewWorldUpdateLoopCount===$U.loopCount||($b._render._renderUpdate($j._projectionViewMatrix),$b._projectionViewWorldUpdateLoopCount=$U.loopCount,$b._projectionViewWorldUpdateCamera=$H),$j.renderElement=$r,$b._preRenderUpdateComponents($j),$w=$r.renderObj,$s=$r._material,this._begainRenderElement($j,$w,null)&&($l=($V=$w._getVertexBuffer(0)).vertexDeclaration,$g=($T=$j._shader=$s._getShader($o._shaderDefineValue,$l.shaderDefineValue,$b._shaderDefineValue)).bind()||$p!==$T._uploadLoopCount,($T._uploadVertexBuffer!==$V||$g)&&($T.uploadAttributes($l.shaderValues.data,null),$T._uploadVertexBuffer=$V),($H!==$T._uploadCamera||$T._uploadSprite3D!==$b||$g)&&($T.uploadSpriteUniforms($b._shaderValues.data),$T._uploadSprite3D=$b),($H!==$T._uploadCamera||$g)&&($T.uploadCameraUniforms($H._shaderValues.data),$T._uploadCamera=$H),($T._uploadMaterial!==$s||$g)&&($s._upload(),$T._uploadMaterial=$s),$T._uploadRenderElement,$S!==$s?($s._setRenderStateFrontFace(!1,$b.transform),$S=$s,$m=$b):$m!==$b&&($s._setRenderStateFrontFace(!1,$b.transform),$m=$b),$w._render($j),$T._uploadLoopCount=$p),$b._postRenderUpdateComponents($j))}},$j._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$j._addRenderElement=function($j){this._renderElements.push($j),this._needSort=!0},$j._addDynamicBatchElement=function($j){this._dynamicBatchCombineRenderElements.push($j)},$s(0,$j,"id",function(){return this._id}),$O._uniqueIDCounter=0,$O._cameraPosition=null,$O}(),$d=function(){function $j(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $w($j,"laya.d3.core.render.RenderState"),$j.clientWidth=0,$j.clientHeight=0,$j}(),$L=function(){function $m($j,$O){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $Dj(new $mO,0),this._corners=[new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO],this._boundingBoxCenter=new $mO,this._children=$l(8),this._objects=[],this._tempBoundBoxCorners=[new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO],this._scene=$j,this._currentDepth=$O}$w($m,"laya.d3.core.scene.OctreeNode");var $j=$m.prototype;return $Z.imps($j,{"laya.d3.core.scene.ITreeNode":!0}),$j.init=function($j,$O){var $V=new $mO,$l=new $mO;$mO.scale($O,-.5,$V),$mO.scale($O,.5,$l),$mO.add($V,$j,$V),$mO.add($l,$j,$l),this.exactBox=new $Lj($V,$l),this.relaxBox=new $Lj($V,$l)},$j.addTreeNode=function($j){1===Collision.boxContainsBox(this._relaxBox,$j.boundingBox)?this.addNodeDown($j,0):this.addObject($j)},$j.addChild=function($j){var $O=this._children[$j];if(null==$O){$O=new $m(this._scene,this._currentDepth+1),(this._children[$j]=$O)._parent=this,$mO.subtract(this._exactBox.max,this._exactBox.min,$m.tempSize),$mO.multiply($m.tempSize,$m._octreeSplit[$j],$m.tempCenter),$mO.add(this._exactBox.min,$m.tempCenter,$m.tempCenter),$mO.scale($m.tempSize,.25,$m.tempSize);var $V=new $mO,$l=new $mO;$mO.subtract($m.tempCenter,$m.tempSize,$V),$mO.add($m.tempCenter,$m.tempSize,$l),$O.exactBox=new $Lj($V,$l),$mO.scale($m.tempSize,$m.relax,$m.tempSize);var $T=new $mO,$S=new $mO;$mO.subtract($m.tempCenter,$m.tempSize,$T),$mO.add($m.tempCenter,$m.tempSize,$S),$O.relaxBox=new $Lj($T,$S)}return $O},$j.addObject=function($j){($j._treeNode=this)._objects.push($j)},$j.removeObject=function($j){if($j._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $O=this._objects.indexOf($j);return-1!==$O&&(this._objects.splice($O,1),!0)},$j.clearObject=function(){this._objects.length=0},$j.addNodeUp=function($j,$O){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$j.boundingBox)?this._parent.addNodeUp($j,$O-1):this.addNodeDown($j,$O)},$j.addNodeDown=function($j,$O){if($O<this._scene.treeLevel){var $V=this.inChildIndex($j.boundingBoxCenter),$l=this.addChild($V);1===Collision.boxContainsBox($l._relaxBox,$j.boundingBox)?$l.addNodeDown($j,++$O):this.addObject($j)}else this.addObject($j)},$j.inChildIndex=function($j){return 4*($j.z<this._boundingBoxCenter.z?0:1)+2*($j.y<this._boundingBoxCenter.y?0:1)+($j.x<this._boundingBoxCenter.x?0:1)},$j.updateObject=function($j){1===Collision.boxContainsBox(this._relaxBox,$j.boundingBox)?(this.removeObject($j),$j._treeNode=null,this.addNodeDown($j,this._currentDepth)):this._parent&&(this.removeObject($j),$j._treeNode=null,this._parent.addNodeUp($j,this._currentDepth-1))},$j.cullingObjects=function($j,$O,$V,$l,$T){var $S,$m=0,$p=0,$o=0,$H=this._scene._dynamicBatchManager;for($m=0,$S=this._objects.length;$m<$S;$m++){var $g=this._objects[$m];if($R.isVisible($g._owner.layer.mask)&&$g.enable){if($O&&($U.treeSpriteCollision+=1,0===$j.containsBoundSphere($g.boundingSphere)))continue;$g._renderUpdate($T),$g._distanceForSort=$mO.distance($g.boundingSphere.center,$l)+$g.sortingFudge;var $e=$g._renderElements;for($p=0,$o=$e.length;$p<$o;$p++){var $t=$e[$p],$w=$t._staticBatch;if($w&&$w._material===$t._material)$w._addBatchRenderElement($t);else{var $s=$t.renderObj;$s.triangleCount<10&&1===$s._vertexBufferCount&&$s._getIndexBuffer()&&$t._material.renderQueue<2&&$t._canDynamicBatch&&!$g._owner.isStatic?$H._addPrepareRenderElement($t):this._scene.getRenderQueue($t._material.renderQueue)._addRenderElement($t)}}}}for($m=0;$m<8;$m++){var $b=this._children[$m];if(null!=$b){var $r=$O;if($O){var $h=$j.containsBoundBox($b._relaxBox);if($U.treeNodeCollision+=1,0===$h)continue;$r=2===$h}$b.cullingObjects($j,$r,$V,$l,$T)}}},$j.cullingShadowObjects=function($j,$O,$V,$l,$T){var $S,$m=0,$p=0,$o=0;this._scene._dynamicBatchManager;for($m=0,$S=this._objects.length;$m<$S;$m++){var $H=this._objects[$m];if($H.castShadow&&$R.isVisible($H._owner.layer.mask)&&$H.enable){if($V&&0===$j[0].containsBoundSphere($H.boundingSphere))continue;for(var $g=1,$e=$j.length;$g<$e;$g++){var $t=$O[$g-1];if(0!==$j[$g].containsBoundSphere($H.boundingSphere)){var $w=$H._renderElements;for($p=0,$o=$w.length;$p<$o;$p++)$t._addRenderElement($w[$p])}}}}for($m=0;$m<8;$m++){var $s=this._children[$m];if(null!=$s){var $b=$V;if($V){var $r=$j[0].containsBoundBox($s._relaxBox);if(0===$r)continue;$b=2===$r}$s.cullingShadowObjects($j,$O,$b,$l,$T)}}},$j.cullingShadowObjectsOnePSSM=function($j,$O,$V,$l,$T,$S){var $m,$p=$O[0],$o=0,$H=0,$g=0;for($o=0,$m=this._objects.length;$o<$m;$o++){var $e=this._objects[$o];if($e.castShadow&&$R.isVisible($e._owner.layer.mask)&&$e.enable){if($l&&0===$j.containsBoundSphere($e.boundingSphere))continue;$e._renderUpdate($V);var $t=$e._renderElements;for($H=0,$g=$t.length;$H<$g;$H++)$p._addRenderElement($t[$H])}}for($o=0;$o<8;$o++){var $w=this._children[$o];if(null!=$w){var $s=$l;if($l){var $b=$j.containsBoundBox($w._relaxBox);if(0===$b)continue;$s=2===$b}$w.cullingShadowObjectsOnePSSM($j,$O,$V,$s,$T,$S)}}},$j.renderBoudingBox=function($j){this._renderBoudingBox($j);for(var $O=0;$O<8;++$O){var $V=this._children[$O];$V&&$V.renderBoudingBox($j)}},$j.buildAllChild=function($j){if($j<this._scene.treeLevel)for(var $O=0;$O<8;$O++){this.addChild($O).buildAllChild($j+1)}},$j._renderBoudingBox=function($j){},$s(0,$j,"exactBox",function(){return this._exactBox},function($j){this._exactBox=$j,$mO.add($j.min,$j.max,this._boundingBoxCenter),$mO.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$s(0,$j,"relaxBox",function(){return this._relaxBox},function($j){(this._relaxBox=$j).getCorners(this._corners),$Dj.createfromPoints(this._corners,this._boundingSphere)}),$m.debugMode=!1,$m.relax=1.15,$m.CHILDNUM=8,$e($m,["tempVector0",function(){return this.tempVector0=new $mO},"tempSize",function(){return this.tempSize=new $mO},"tempCenter",function(){return this.tempCenter=new $mO},"_octreeSplit",function(){return this._octreeSplit=[new $mO(.25,.25,.25),new $mO(.75,.25,.25),new $mO(.25,.75,.25),new $mO(.75,.75,.25),new $mO(.25,.25,.75),new $mO(.75,.25,.75),new $mO(.25,.75,.75),new $mO(.75,.75,.75)]}]),$m}(),$Q=(function(){function $j(){}$w($j,"laya.d3.core.scene.SceneManager")}(),function(){function $j($j,$O,$V,$l){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$j&&($j=1),void 0===$O&&($O=1),void 0===$V&&($V=1),void 0===$l&&($l=1),this._r=$j,this._g=$O,this._b=$V,this._a=$l}return $w($j,"laya.d3.core.trail.module.Color",null,"Color$1"),$j.prototype.cloneTo=function($j){$j._r=this._r,$j._g=this._g,$j._b=this._b,$j._a=this._a},$e($j,["RED",function(){return this.RED=new $j(1,0,0,1)},"GREEN",function(){return this.GREEN=new $j(0,1,0,1)},"BLUE",function(){return this.BLUE=new $j(0,0,1,1)},"CYAN",function(){return this.CYAN=new $j(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $j(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $j(1,0,1,1)},"GRAY",function(){return this.GRAY=new $j(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $j(1,1,1,1)},"BLACK",function(){return this.BLACK=new $j(0,0,0,1)}]),$j}()),$D=(function(){function $j(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$w($j,"laya.d3.core.trail.module.Gradient");var $O=$j.prototype;$O.setKeys=function($j,$O){var $V,$l;this._colorKeys=$j;for(var $T=this.index=0;$T<$j.length;$T++){var $S=($V=$j[$T]).color;this._colorKeyData[this.index++]=$S._r,this._colorKeyData[this.index++]=$S._g,this._colorKeyData[this.index++]=$S._b,this._colorKeyData[this.index++]=$V.time}this._alphaKeys=$O;for(var $m=this.index=0;$m<$O.length;$m++)$l=$O[$m],this._alphaKeyData[this.index++]=$l.alpha,this._alphaKeyData[this.index++]=$l.time},$O.cloneTo=function($j){var $O=0,$V=0,$l=this.colorKeys,$T=[];for($O=0,$V=$l.length;$O<$V;$O++){var $S=new $I;$l[$O].cloneTo($S),$T.push($S)}var $m=this.alphaKeys,$p=[];for($O=0,$V=$m.length;$O<$V;$O++){var $o=new $D;$m[$O].cloneTo($o),$p.push($o)}$j.setKeys($T,$p)},$s(0,$O,"mode",function(){return this._mode},function($j){this._mode=$j}),$s(0,$O,"colorKeys",function(){return this._colorKeys},function($j){this._colorKeys=$j;for(var $O=this.index=0;$O<$j.length;$O++){var $V=$j[$O],$l=$V.color;this._colorKeyData[this.index++]=$l._r,this._colorKeyData[this.index++]=$l._g,this._colorKeyData[this.index++]=$l._b,this._colorKeyData[this.index++]=$V.time}}),$s(0,$O,"alphaKeys",function(){return this._alphaKeys},function($j){this._alphaKeys=$j;for(var $O=this.index=0;$O<$j.length;$O++){var $V=$j[$O];this._alphaKeyData[this.index++]=$V.alpha,this._alphaKeyData[this.index++]=$V.time}})}(),function(){function $j($j,$O){this._alpha=NaN,this._time=NaN,void 0===$j&&($j=0),void 0===$O&&($O=0),this._alpha=$j,this._time=$O}$w($j,"laya.d3.core.trail.module.GradientAlphaKey");var $O=$j.prototype;return $O.cloneTo=function($j){$j.alpha=this.alpha,$j.time=this.time},$s(0,$O,"alpha",function(){return this._alpha},function($j){this._alpha=$j}),$s(0,$O,"time",function(){return this._time},function($j){this._time=$j}),$j}()),$I=function(){function $j($j,$O){this._color=null,this._time=NaN,void 0===$O&&($O=0),this._color=$j||new $Q,this._time=$O}$w($j,"laya.d3.core.trail.module.GradientColorKey");var $O=$j.prototype;return $O.cloneTo=function($j){this.color.cloneTo($j.color),$j.time=this.time},$s(0,$O,"color",function(){return this._color},function($j){this._color=$j}),$s(0,$O,"time",function(){return this._time},function($j){this._time=$j}),$j}(),$P=(function(){function $j(){}$w($j,"laya.d3.core.trail.module.GradientMode"),$j.Blend=0,$j.Fixed=1}(),function(){function $j(){}$w($j,"laya.d3.core.trail.module.TextureMode"),$j.Stretch=0,$j.Tile=1}(),function(){function $j(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$w($j,"laya.d3.core.trail.module.TrailKeyFrame"),$j.prototype.cloneTo=function($j){$j.time=this.time,$j.inTangent=this.inTangent,$j.outTangent=this.outTangent,$j.value=this.value}}(),function(){function $O($j){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $mO,this._curPosition=new $mO,this._delVector3=new $mO,this._lastFixedVertexPosition=new $mO,this._pointAtoBVector3=new $mO,this._pointA=new $mO,this._pointB=new $mO,this._owner=$j,this._id=$O.renderElementCount++,0==this._id?$j._owner.transform.position.cloneTo(this._lastPosition):$j._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $FO($P.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $FO($P.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$w($O,"laya.d3.core.trail.TrailRenderElement");var $j=$O.prototype;$Z.imps($j,{"laya.d3.core.render.IRenderable":!0}),$j._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$j._addTrailByFirstPosition=function($j,$O){$mO.subtract($O,$j,this._delVector3),$mO.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$mO.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$mO.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($j),$j.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$j._addTrailByNextPosition=function($j){$mO.subtract($j,this._lastFixedVertexPosition,this._delVector3),$mO.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$mO.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$mO.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$mO.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$Ij.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($j),$j.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($j),this._virtualVerticesCount=2)},$j._updateVerticesByPosition=function($j){this._pointe=$j.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$j._updateVertexBuffer2=function(){var $j,$O=0,$V=0,$l=0;for($l=0,$j=(this._verticesCount+this._virtualVerticesCount)/2;$l<$j;$l++)$V=0==this._owner.textureMode?(this._VerticesToTailLength[$l]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$l],this._vertices2[$O++]=1-$V,this._vertices2[$O++]=1-$V;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$j._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$j._updateDisappear=function(){var $j,$O=0;for($O=this._curDisappearIndex,$j=(this._verticesCount+this._virtualVerticesCount)/2;$O<$j;$O++)this._owner._curtime-this._everyGroupVertexBirthTime[$O]>=this._owner.time+$Ij.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$j._beforeRender=function($j){return this._camera=$j.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$mO.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$j._render=function($j){this._isDead||($M.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$U.drawCall++,$U.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$j._getVertexBuffer=function($j){return void 0===$j&&($j=0),0===$j?this._vertexBuffer1:1===$j?this._vertexBuffer2:null},$j._getVertexBuffers=function(){return this._vertexBuffers},$j._getIndexBuffer=function(){return null},$j.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$j._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$s(0,$j,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$s(0,$j,"triangleCount",function(){return 0}),$O.renderElementCount=0}(),function(){function $j(){}$w($j,"laya.d3.core.trail.VertexTrail");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration1}),$s(1,$j,"vertexDeclaration1",function(){return $j._vertexDeclaration1}),$s(1,$j,"vertexDeclaration2",function(){return $j._vertexDeclaration2}),$e($j,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $Sj(32,[new $mj(0,"vector3",0),new $mj(12,"vector3",41),new $mj(24,"single",33),new $mj(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $Sj(4,[new $mj(0,"single",38)])}]),$j}()),$jj=function(){function $A($j){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$j}$w($A,"laya.d3.graphics.DynamicBatch");var $j=$A.prototype;return $Z.imps($j,{"laya.d3.core.render.IRenderable":!0}),$j._getVertexBuffer=function($j){return void 0===$j&&($j=0),0===$j?this._vertexBuffer:null},$j._getIndexBuffer=function(){return this._indexBuffer},$j._getCombineRenderElementFromPool=function($j,$O,$V){var $l=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $l||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$l=new $W,$l._sprite3D=new $KO),$l._sprite3D._render._renderUpdate($V),$l},$j._getRenderElement=function($j,$O,$V){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$A.maxVertexCount),this._indexDatas=new Uint16Array($A.maxIndexCount),this._vertexBuffer=$FO.create(this._vertexDeclaration,$A.maxVertexCount,35048),this._indexBuffer=$GO.create("ushort",$A.maxIndexCount,35048));for(var $l=this._merageElements.length=0,$T=0,$S=0,$m=this._combineRenderElements.length;$S<$m;$S++){var $p=this._combineRenderElements[$S],$o=$p.getDynamicBatchBakedVertexs(0),$H=$p.getBakedIndices(),$g=$p._sprite3D.transform._isFrontFaceInvert,$e=$l/(this._vertexDeclaration.vertexStride/4),$t=$T,$w=$t+$H.length;$p._tempBatchIndexStart=$t,$p._tempBatchIndexEnd=$w,this._indexDatas.set($H,$T);var $s=0;if($g)for($s=$t;$s<$w;$s+=3){this._indexDatas[$s]=$e+this._indexDatas[$s];var $b=this._indexDatas[$s+1],$r=this._indexDatas[$s+2];this._indexDatas[$s+1]=$e+$r,this._indexDatas[$s+2]=$e+$b}else for($s=$t;$s<$w;$s+=3)this._indexDatas[$s]=$e+this._indexDatas[$s],this._indexDatas[$s+1]=$e+this._indexDatas[$s+1],this._indexDatas[$s+2]=$e+this._indexDatas[$s+2];$T+=$H.length,this._vertexDatas.set($o,$l),$l+=$o.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$S=this._combineRenderElementPoolIndex=0,$m=this._materials.length;$S<$m;$S++){var $h=this._getCombineRenderElementFromPool($j,$O,$V);$h._type=2,$h._staticBatch=null;var $a=($h.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$S]]._tempBatchIndexStart,$c=$S+1===this._materialToRenderElementsOffsets.length?$T:this._combineRenderElements[this._materialToRenderElementsOffsets[$S+1]]._tempBatchIndexStart;$h._tempBatchIndexStart=$a,$h._tempBatchIndexEnd=$c,$h._material=this._materials[$S],this._merageElements.push($h)}},$j._addCombineRenderObjTest=function($j){var $O=$j.renderObj,$V=this._currentCombineIndexCount+$O._getIndexBuffer().indexCount,$l=this._currentCombineVertexCount+$O._getVertexBuffer().vertexCount;return!($A.maxVertexCount<$l||$A.maxIndexCount<$V)},$j._addCombineRenderObj=function($j){var $O=$j.renderObj;this._combineRenderElements.push($j),this._currentCombineIndexCount=this._currentCombineIndexCount+$O._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$O._getVertexBuffer().vertexCount},$j._addCombineMaterial=function($j){this._materials.push($j)},$j._addMaterialToRenderElementOffset=function($j){this._materialToRenderElementsOffsets.push($j)},$j._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$j._addToRenderQueue=function($j,$O,$V,$l){this._getRenderElement($O,$V,$l);for(var $T=0,$S=this._materials.length;$T<$S;$T++)$j.getRenderQueue(this._materials[$T].renderQueue)._addDynamicBatchElement(this._merageElements[$T])},$j._beforeRender=function($j){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$j._render=function($j){var $O=$j._batchIndexEnd-$j._batchIndexStart;$M.mainContext.drawElements(4,$O,5123,2*$j._batchIndexStart),$U.drawCall++,$U.trianglesFaces+=$O/3},$j._getVertexBuffers=function(){return null},$s(0,$j,"_vertexBufferCount",function(){return 1}),$s(0,$j,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$s(0,$j,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$A.maxVertexCount=2e4,$A.maxIndexCount=4e4,$A.maxCombineTriangleCount=10,$A}(),$Oj=function(){function $A(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$w($A,"laya.d3.graphics.DynamicBatchManager");var $j=$A.prototype;return $j.getDynamicBatch=function($j,$O){var $V,$l=$j.id.toString()+$O;return this._dynamicBatches[$l]?$V=this._dynamicBatches[$l]:this._dynamicBatches[$l]=$V=new $jj($j),$V},$j._garbageCollection=function(){for(var $j in this._dynamicBatches)0===this._dynamicBatches[$j].combineRenderElementsCount&&delete this._dynamicBatches[$j]},$j._addPrepareRenderElement=function($j){this._prepareDynamicBatchCombineElements.push($j)},$j._finishCombineDynamicBatch=function($j){var $O,$V,$l;this._prepareDynamicBatchCombineElements.sort($A._sortPrepareDynamicBatch);for(var $T,$S,$m,$p,$o,$H=-1,$g=!0,$e=0,$t=-1,$w=0,$s=this._prepareDynamicBatchCombineElements.length;$w<$s;$w++){var $b=($S=this._prepareDynamicBatchCombineElements[$w]).renderObj._getVertexBuffer(0).vertexDeclaration,$r=$V!==$b;$r&&($e=0,$V=$b);var $h=$e!==$H;if($h&&($H=$e),($r||$h)&&($m=this.getDynamicBatch($b,$e),$O=null),$g)if($m._addCombineRenderObjTest($S)){if($O!==($T=$S._material))$p&&($j.getRenderQueue($o._material.renderQueue)._addRenderElement($o),$o=$p=null,$t=-1),$p=$T,$t=$m.combineRenderElementsCount,$o=$S,$O=$T;else if($p){var $a=$o.renderObj,$c=$S.renderObj;$a._getVertexBuffer().vertexCount+$c._getVertexBuffer().vertexCount>$jj.maxVertexCount||$a._getIndexBuffer().indexCount+$c._getIndexBuffer().indexCount>$jj.maxIndexCount?($j.getRenderQueue($o._material.renderQueue)._addRenderElement($o),$p=$T,$t=$m.combineRenderElementsCount,$o=$S):($m._addCombineMaterial($p),$m._addMaterialToRenderElementOffset($t),$m._addCombineRenderObj($o),$o=$p=null,$t=-1,$m._addCombineRenderObj($S))}else $m._addCombineRenderObj($S);$g=!0}else $p&&($j.getRenderQueue($o._material.renderQueue)._addRenderElement($o),$o=$p=null,$t=-1),$e++,$g=!1;else $l=this._prepareDynamicBatchCombineElements[$w-1],$m._addMaterialToRenderElementOffset($m.combineRenderElementsCount),$O=$l._material,$m._addCombineMaterial($O),$m._addCombineRenderObj($l),$g=!0,$O!==($T=$S._material)?($p=$T,$t=$m.combineRenderElementsCount,$o=$S):$m._addCombineRenderObj($S),$O=$T}$p&&($j.getRenderQueue($o._material.renderQueue)._addRenderElement($o),$o=$p=null,$t=-1),this._prepareDynamicBatchCombineElements.length=0},$j._clearRenderElements=function(){for(var $j in this._dynamicBatches)this._dynamicBatches[$j]._clearRenderElements()},$j._addToRenderQueue=function($j,$O,$V,$l){for(var $T in this._dynamicBatches){var $S=this._dynamicBatches[$T];0<$S.combineRenderElementsCount&&$S._addToRenderQueue($j,$O,$V,$l)}},$j.dispose=function(){this._dynamicBatches=null},$A._sortPrepareDynamicBatch=function($j,$O){return $j._mainSortID-$O._mainSortID},$A}(),$Vj=function(){function $j(){}return $w($j,"laya.d3.graphics.FrustumCulling"),$j.renderShadowObjectCulling=function($j,$O,$V,$l,$T){var $S=0,$m=0,$p=0,$o=0;for($S=0,$p=$V.length;$S<$p;$S++){var $H=$V[$S];$H&&$H._clearRenderElements()}var $g,$e,$t,$w=$j._cullingRenders;if(1<$T){for($S=0,$p=$j._cullingRendersLength;$S<$p;$S++)if(($g=$w[$S]).castShadow&&$R.isVisible($g._owner.layer.mask)&&$g.enable)for(var $s=1,$b=$O.length;$s<$b;$s++)if($e=$V[$s-1],0!==$O[$s].containsBoundSphere($g.boundingSphere))for($m=0,$o=($t=$g._renderElements).length;$m<$o;$m++)$e._addRenderElement($t[$m])}else for($S=0,$p=$j._cullingRendersLength;$S<$p;$S++)if(($g=$w[$S]).castShadow&&$R.isVisible($g._owner.layer.mask)&&$g.enable&&0!==$O[0].containsBoundSphere($g.boundingSphere))for($g._renderUpdate($l),$e=$V[0],$m=0,$o=($t=$g._renderElements).length;$m<$o;$m++)$e._addRenderElement($t[$m])},$j.renderShadowObjectCullingOctree=function($j,$O,$V,$l,$T){for(var $S=0,$m=$V.length;$S<$m;$S++){var $p=$V[$S];$p&&$p._clearRenderElements()}1<$T?$j.treeRoot.cullingShadowObjects($O,$V,!0,0,$j):$j.treeRoot.cullingShadowObjectsOnePSSM($O[0],$V,$l,!0,0,$j)},$j.renderObjectCulling=function($j,$O,$V,$l,$T,$S){var $m=0,$p=0,$o=0,$H=0,$g=$O._quenes,$e=$O._dynamicBatchManager,$t=$O._cullingRenders;for($m=0,$p=$g.length;$m<$p;$m++){var $w=$g[$m];$w&&$w._clearRenderElements()}var $s=$lj._staticBatchManagers;for($m=0,$p=$s.length;$m<$p;$m++)$s[$m]._clearRenderElements();$e._clearRenderElements();var $b=$V.transform.position;for($m=0,$p=$O._cullingRendersLength;$m<$p;$m++){var $r=$t[$m];if($R.isVisible($r._owner.layer.mask)&&$r.enable&&0!==$j.containsBoundSphere($r.boundingSphere)&&$r._renderUpdate($S)){$r._distanceForSort=$mO.distance($r.boundingSphere.center,$b)+$r.sortingFudge;var $h=$r._renderElements;for($o=0,$H=$h.length;$o<$H;$o++){var $a=$h[$o],$c=$a._staticBatch;if($c&&$c._material===$a._material)$c._addBatchRenderElement($a);else{var $A=$a.renderObj;$A.triangleCount<10&&1===$A._vertexBufferCount&&$A._getIndexBuffer()&&$a._material.renderQueue<2&&$a._canDynamicBatch&&!$r._owner.isStatic?$e._addPrepareRenderElement($a):$O.getRenderQueue($a._material.renderQueue)._addRenderElement($a)}}}}for($m=0,$p=$s.length;$m<$p;$m++)$s[$m]._addToRenderQueue($O,$l,$T,$S);$e._finishCombineDynamicBatch($O),$e._addToRenderQueue($O,$l,$T,$S)},$j.renderObjectCullingOctree=function($j,$O,$V,$l,$T,$S){var $m=0,$p=0,$o=$O._quenes,$H=$O._dynamicBatchManager;for($m=0,$p=$o.length;$m<$p;$m++){var $g=$o[$m];$g&&$g._clearRenderElements()}var $e=$lj._staticBatchManagers;for($m=0,$p=$e.length;$m<$p;$m++)$e[$m]._clearRenderElements();for($H._clearRenderElements(),$O._cullingRenders.length=0,$O.treeRoot.cullingObjects($j,!0,0,$V.transform.position,$S),$m=0,$p=$e.length;$m<$p;$m++)$e[$m]._addToRenderQueue($O,$l,$T,$S);$H._finishCombineDynamicBatch($O),$H._addToRenderQueue($O,$l,$T,$S)},$j.renderObjectCullingNoBoundFrustum=function($j,$O,$V,$l,$T){var $S=0,$m=0,$p=0,$o=0,$H=$j._quenes,$g=$j._dynamicBatchManager,$e=$j._cullingRenders;for($S=0,$m=$H.length;$S<$m;$S++){var $t=$H[$S];$t&&$t._clearRenderElements()}var $w=$lj._staticBatchManagers;for($S=0,$m=$w.length;$S<$m;$S++)$w[$S]._clearRenderElements();$g._clearRenderElements();var $s=$O.transform.position;for($S=0,$m=$j._cullingRendersLength;$S<$m;$S++){var $b=$e[$S];if($R.isVisible($b._owner.layer.mask)&&$b.enable){$b._renderUpdate($T),$b._distanceForSort=$mO.distance($b.boundingSphere.center,$s)+$b.sortingFudge;var $r=$b._renderElements;for($p=0,$o=$r.length;$p<$o;$p++){var $h=$r[$p],$a=$h._staticBatch;if($a&&$a._material===$h._material)$a._addBatchRenderElement($h);else{var $c=$h.renderObj;$c.triangleCount<10&&1===$c._vertexBufferCount&&$c._getIndexBuffer()&&$h._material.renderQueue<2&&$h._canDynamicBatch&&!$b._owner.isStatic?$g._addPrepareRenderElement($h):$j.getRenderQueue($h._material.renderQueue)._addRenderElement($h)}}}}for($S=0,$m=$w.length;$S<$m;$S++)$w[$S]._addToRenderQueue($j,$V,$l,$T);$g._finishCombineDynamicBatch($j),$g._addToRenderQueue($j,$V,$l,$T)},$j}(),$lj=function(){function $S(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$w($S,"laya.d3.graphics.StaticBatchManager");var $j=$S.prototype;return $j._finishInit=function(){for(var $j in this._staticBatches)this._staticBatches[$j]._finishInit();this._initBatchRenderElements.length=0},$j._initStaticBatchs=function($j){throw new Error("StaticBatchManager:must override this function.")},$j._addInitBatchSprite=function($j){for(var $O=$j._render._renderElements,$V=0,$l=$O.length;$V<$l;$V++)this._initBatchRenderElements.push($O[$V])},$j._clearRenderElements=function(){for(var $j in this._staticBatches)this._staticBatches[$j]._clearRenderElements()},$j._garbageCollection=function($j){var $O=$j._staticBatch,$V=$O._initBatchRenderElements,$l=$V.indexOf($j);$V.splice($l,1),0===$V.length&&($O.dispose(),delete this._staticBatches[$O._key])},$j._addToRenderQueue=function($j,$O,$V,$l){for(var $T in this._staticBatches){var $S=this._staticBatches[$T];0<$S._batchRenderElements.length&&$S._updateToRenderQueue($j,$l)}},$j.dispose=function(){this._staticBatches=null},$S._addToStaticBatchQueue=function($j){$j instanceof laya.d3.core.RenderableSprite3D&&$j._addToInitStaticBatchManager();for(var $O=0,$V=$j.numChildren;$O<$V;$O++)$S._addToStaticBatchQueue($j._childs[$O])},$S.combine=function($j,$O){var $V,$l=0,$T=0;if($O)for($l=0,$T=$O.length;$l<$T;$l++){$O[$l]._addToInitStaticBatchManager()}else $j&&$S._addToStaticBatchQueue($j);for($l=0,$T=$S._staticBatchManagers.length;$l<$T;$l++)($V=$S._staticBatchManagers[$l])._initStaticBatchs($j),$V._finishInit()},$S._staticBatchManagers=[],$S}(),$Tj=function(){function $j($j,$O,$V){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$j,this._manager=$O,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$V}$w($j,"laya.d3.graphics.StaticBatch");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$O._binarySearch=function($j){for(var $O=0,$V=this._batchRenderElements.length-1,$l=0;$O<=$V;)$l=Math.floor(($O+$V)/2),this._compareBatchRenderElement(this._batchRenderElements[$l],$j)?$V=$l-1:$O=$l+1;return $O},$O._compareBatchRenderElement=function($j,$O){throw new Error("StaticBatch:must override this function.")},$O._getVertexDecLightMap=function($j){return $j===$Gj.vertexDeclaration?$Rj.vertexDeclaration:$j===$nj.vertexDeclaration?$Yj.vertexDeclaration:$j===$zj.vertexDeclaration?$Aj.vertexDeclaration:$j===$fj.vertexDeclaration?null:$j===$bj.vertexDeclaration?$rj.vertexDeclaration:$j===$Nj.vertexDeclaration?$ij.vertexDeclaration:$j===$Mj.vertexDeclaration?$vj.vertexDeclaration:$j===$Fj.vertexDeclaration?$qj.vertexDeclaration:$j===$nj.vertexDeclaration?$Yj.vertexDeclaration:$j===$$j.vertexDeclaration?$Zj.vertexDeclaration:$j===$fj.vertexDeclaration?null:$j===$bj.vertexDeclaration?$rj.vertexDeclaration:$j===$Xj.vertexDeclaration?$kj.vertexDeclaration:$j===$Mj.vertexDeclaration?$vj.vertexDeclaration:$j},$O._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$O._addBatchRenderElement=function($j){this._batchRenderElements.splice(this._binarySearch($j),0,$j)},$O._updateToRenderQueue=function($j,$O){this._combineRenderElementPoolIndex=0,this._getRenderElement($j.getRenderQueue(this._material.renderQueue)._renderElements,$j,$O)},$O._getRenderElement=function($j,$O,$V){throw new Error("StaticBatch:must override this function.")},$O._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$O._clearRenderElements=function(){this._batchRenderElements.length=0},$O.dispose=function(){},$O._getVertexBuffer=function($j){return void 0===$j&&($j=0),null},$O._getIndexBuffer=function(){return null},$O._beforeRender=function($j){return!0},$O._render=function($j){},$O._getVertexBuffers=function(){return null},$s(0,$O,"_vertexBufferCount",function(){return 1}),$s(0,$O,"triangleCount",function(){return 0}),$j.combine=function($j){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$lj.combine($j)},$j.maxBatchVertexCount=65535,$j}(),$Sj=function(){function $m($j,$O){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$m._uniqueIDCounter,this._id>$m.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$m.maxVertexDeclaration);this._shaderValues=new $tO,this._vertexElementsDic={},this._vertexStride=$j,this._vertexElements=$O;for(var $V=0;$V<$O.length;$V++){var $l=$O[$V],$T=$l.elementUsage;this._vertexElementsDic[$T]=$l;var $S=[$m._getTypeSize($l.elementFormat)/4,5126,!1,this._vertexStride,$l.offset];switch(this._shaderValues.setValue($T,$S),$T){case 1:this._addShaderDefine($UO.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($UO.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($UO.SHADERDEFINE_UV1)}}}$w($m,"laya.d3.graphics.VertexDeclaration");var $j=$m.prototype;return $j._addShaderDefine=function($j){this._shaderDefineValue|=$j},$j._removeShaderDefine=function($j){this._shaderDefineValue&=~$j},$j.getVertexElements=function(){return this._vertexElements.slice()},$j.getVertexElementByUsage=function($j){return this._vertexElementsDic[$j]},$j.unBinding=function(){},$s(0,$j,"shaderDefineValue",function(){return this._shaderDefineValue}),$s(0,$j,"id",function(){return this._id}),$s(0,$j,"vertexStride",function(){return this._vertexStride}),$s(0,$j,"shaderValues",function(){return this._shaderValues}),$m._getTypeSize=function($j){switch($j){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$m.getVertexStride=function($j){for(var $O=0,$V=0;$V<$j.Length;$V++){var $l=$j[$V],$T=$l.offset+$m._getTypeSize($l.elementFormat);$O<$T&&($O=$T)}return $O},$m._maxVertexDeclarationBit=1e3,$m._uniqueIDCounter=1,$e($m,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$m}(),$mj=function(){function $j($j,$O,$V){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$j,this.elementFormat=$O,this.elementUsage=$V}return $w($j,"laya.d3.graphics.VertexElement"),$j}(),$pj=(function(){function $j(){}$w($j,"laya.d3.graphics.VertexElementFormat"),$j.Single="single",$j.Vector2="vector2",$j.Vector3="vector3",$j.Vector4="vector4",$j.Color="color",$j.Byte4="byte4",$j.Short2="short2",$j.Short4="short4",$j.NormalizedShort2="normalizedshort2",$j.NormalizedShort4="normalizedshort4",$j.HalfVector2="halfvector2",$j.HalfVector4="halfvector4"}(),function(){function $j(){}$w($j,"laya.d3.graphics.VertexElementUsage"),$j.POSITION0=0,$j.COLOR0=1,$j.TEXTURECOORDINATE0=2,$j.NORMAL0=3,$j.BINORMAL0=4,$j.TANGENT0=5,$j.BLENDINDICES0=6,$j.BLENDWEIGHT0=7,$j.DEPTH0=8,$j.FOG0=9,$j.POINTSIZE0=10,$j.SAMPLE0=11,$j.TESSELLATEFACTOR0=12,$j.COLOR1=13,$j.NEXTTEXTURECOORDINATE0=14,$j.TEXTURECOORDINATE1=15,$j.NEXTTEXTURECOORDINATE1=16,$j.CORNERTEXTURECOORDINATE0=17,$j.VELOCITY0=18,$j.STARTCOLOR0=19,$j.STARTSIZE=20,$j.AGEADDSCALE0=21,$j.STARTROTATION=22,$j.ENDCOLOR0=23,$j.STARTLIFETIME=24,$j.TIME0=33,$j.SHAPEPOSITIONSTARTLIFETIME=30,$j.DIRECTIONTIME=32,$j.SIZEROTATION0=27,$j.RADIUS0=28,$j.RADIAN0=29,$j.STARTSPEED=31,$j.RANDOM0=34,$j.RANDOM1=35,$j.SIMULATIONWORLDPOSTION=36,$j.SIMULATIONWORLDROTATION=37,$j.TEXTURECOORDINATE0X=38,$j.TEXTURECOORDINATE0X1=39,$j.TEXTURECOORDINATE0Y=40,$j.OFFSETVECTOR=41}(),function(){function $j($j,$O,$V){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$j,this._textureCoordinate0=$O,this._time=$V}$w($j,"laya.d3.graphics.VertexGlitter");var $O=$j.prototype;$Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate0}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"time",function(){return this._time}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(24,[new $mj(0,"vector3",0),new $mj(12,"vector2",2),new $mj(20,"single",33)])}])}(),function(){function $j($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$j,this._position=$O,this._velocity=$V,this._startColor=$l,this._endColor=$T,this._sizeRotation=$S,this._radius=$m,this._radian=$p,this._ageAddScale=$o,this._time=$H}$w($j,"laya.d3.graphics.VertexParticle");var $O=$j.prototype;$Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"endColor",function(){return this._endColor}),$s(0,$O,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$s(0,$O,"sizeRotation",function(){return this._sizeRotation}),$s(0,$O,"velocity",function(){return this._velocity}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"startColor",function(){return this._startColor}),$s(0,$O,"radius",function(){return this._radius}),$s(0,$O,"radian",function(){return this._radian}),$s(0,$O,"ageAddScale",function(){return this._ageAddScale}),$s(0,$O,"time",function(){return this._time}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(116,[new $mj(0,"vector4",17),new $mj(16,"vector3",0),new $mj(28,"vector3",18),new $mj(40,"vector4",19),new $mj(56,"vector4",23),new $mj(72,"vector3",27),new $mj(84,"vector2",28),new $mj(92,"vector4",29),new $mj(108,"single",24),new $mj(112,"single",33)])}])}(),function(){function $j($j){this._position=null,this._position=$j}$w($j,"laya.d3.graphics.VertexPosition");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(12,[new $mj(0,"vector3",0)])}]),$j}()),$oj=function(){function $j($j,$O){this._position=null,this._normal=null,this._position=$j,this._normal=$O}$w($j,"laya.d3.graphics.VertexPositionNormal");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(24,[new $mj(0,"vector3",0),new $mj(12,"vector3",3)])}]),$j}(),$Hj=function(){function $j($j,$O,$V){this._position=null,this._normal=null,this._color=null,this._position=$j,this._normal=$O,this._color=$V}$w($j,"laya.d3.graphics.VertexPositionNormalColor");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(40,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1)])}]),$j}(),$gj=function(){function $j($j,$O,$V,$l,$T){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$j,this._normal=$O,this._color=$V,this._blendIndex=$l,this._blendWeight=$T}$w($j,"laya.d3.graphics.VertexPositionNormalColorSkin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(72,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector4",7),new $mj(56,"vector4",6)])}]),$j}(),$ej=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._tangent=$l,this._blendIndex=$T,this._blendWeight=$S}$w($j,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(88,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector4",7),new $mj(56,"vector4",6),new $mj(72,"vector4",5)])}]),$j}(),$tj=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._tangent=$l,this._blendIndex=$T,this._blendWeight=$S}$w($j,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(84,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector4",7),new $mj(56,"vector4",6),new $mj(72,"vector3",5)])}]),$j}(),$wj=function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._tangent=$l}$w($j,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(56,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector4",5)])}]),$j}(),$sj=function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._tangent=$l}$w($j,"laya.d3.graphics.VertexPositionNormalColorTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(52,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector3",5)])}]),$j}(),$bj=function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate=$l}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(48,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2)])}]),$j}(),$rj=function(){function $j($j,$O,$V,$l,$T){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate0=$l,this._textureCoordinate1=$T}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(56,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector2",15)])}]),$j}(),$hj=function(){function $j($j,$O,$V,$l,$T,$S,$m){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate0=$l,this._textureCoordinate1=$T,this._blendIndex=$S,this._blendWeight=$m}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(88,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector2",15),new $mj(56,"vector4",7),new $mj(72,"vector4",6)])}]),$j}(),$aj=function(){function $j($j,$O,$V,$l,$T,$S,$m,$p){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate0=$l,this._textureCoordinate1=$T,this._tangent=$S,this._blendIndex=$m,this._blendWeight=$p}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(104,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector2",15),new $mj(56,"vector4",7),new $mj(72,"vector4",6),new $mj(88,"vector4",5)])}]),$j}(),$cj=function(){function $j(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$O.VertexPositionNormalColorTexture0SkinTangent=function($j,$O,$V,$l,$T,$S,$m,$p){this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate0=$l,this._textureCoordinate1=$T,this._tangent=$S,this._blendIndex=$m,this._blendWeight=$p},$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(100,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector2",15),new $mj(56,"vector4",7),new $mj(72,"vector4",6),new $mj(88,"vector3",5)])}]),$j}(),$Aj=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate0=$l,this._textureCoordinate1=$T,this._tangent=$S}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(72,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector2",15),new $mj(56,"vector4",5)])}]),$j}(),$Zj=function(){function $j(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$w($j,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$O.VertexPositionNormalColorTexture0Tangent=function($j,$O,$V,$l,$T,$S){this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate0=$l,this._textureCoordinate1=$T,this._tangent=$S},$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(68,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector2",15),new $mj(56,"vector3",5)])}]),$j}(),$xj=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate=$l,this._blendIndex=$T,this._blendWeight=$S}$w($j,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(80,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector4",7),new $mj(64,"vector4",6)])}]),$j}(),$Ej=function(){function $j($j,$O,$V,$l,$T,$S,$m){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate=$l,this._tangent=$T,this._blendIndex=$S,this._blendWeight=$m}$w($j,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(96,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector4",7),new $mj(64,"vector4",6),new $mj(80,"vector4",5)])}]),$j}(),$Uj=function(){function $j($j,$O,$V,$l,$T,$S,$m){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate=$l,this._tangent=$T,this._blendIndex=$S,this._blendWeight=$m}$w($j,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(92,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector4",7),new $mj(64,"vector4",6),new $mj(80,"vector3",5)])}]),$j}(),$zj=function(){function $j($j,$O,$V,$l,$T){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate=$l,this._tangent=$T}$w($j,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(64,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector4",5)])}]),$j}(),$$j=function(){function $j($j,$O,$V,$l,$T){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$j,this._normal=$O,this._color=$V,this._textureCoordinate=$l,this._tangent=$T}$w($j,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"color",function(){return this._color}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(60,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",1),new $mj(40,"vector2",2),new $mj(48,"vector3",5)])}]),$j}(),$_j=function(){function $j($j,$O,$V){this._position=null,this._normal=null,this._tangent=null,this._position=$j,this._normal=$O,this._tangent=$V}$w($j,"laya.d3.graphics.VertexPositionNormalSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(40,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector4",5)])}]),$j}(),$Bj=function(){function $j($j,$O,$V){this._position=null,this._normal=null,this._tangent=null,this._position=$j,this._normal=$O,this._tangent=$V}$w($j,"laya.d3.graphics.VertexPositionNormalTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(36,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector3",5)])}]),$j}(),$Mj=function(){function $j($j,$O,$V){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V}$w($j,"laya.d3.graphics.VertexPositionNormalTexture");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(32,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2)])}]),$j}(),$vj=function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$j,this._normal=$O,this._textureCoordinate0=$V,this._textureCoordinate1=$l}$w($j,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(40,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15)])}]),$j}(),$Yj=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$j,this._normal=$O,this._textureCoordinate0=$V,this._textureCoordinate1=$l,this._blendIndex=$T,this._blendWeight=$S}$w($j,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(72,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15),new $mj(40,"vector4",7),new $mj(56,"vector4",6)])}]),$j}(),$Rj=function(){function $j($j,$O,$V,$l,$T,$S,$m){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._textureCoordinate0=$V,this._textureCoordinate1=$l,this._tangent=$T,this._blendIndex=$S,this._blendWeight=$m}$w($j,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(88,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15),new $mj(40,"vector4",7),new $mj(56,"vector4",6),new $mj(72,"vector4",5)])}]),$j}(),$qj=function(){function $j(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$w($j,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$O.VertexPositionNormalTexture0SkinTangent=function($j,$O,$V,$l,$T,$S,$m){this._position=$j,this._normal=$O,this._textureCoordinate0=$V,this._textureCoordinate1=$l,this._tangent=$T,this._blendIndex=$S,this._blendWeight=$m},$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(84,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15),new $mj(40,"vector4",7),new $mj(56,"vector4",6),new $mj(72,"vector3",5)])}]),$j}(),$ij=function(){function $j($j,$O,$V,$l,$T){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$j,this._normal=$O,this._textureCoordinate0=$V,this._textureCoordinate1=$l,this._tangent=$T}$w($j,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(56,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15),new $mj(40,"vector4",5)])}]),$j}(),$kj=function(){function $j(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$w($j,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$O.VertexPositionNormalTexture0Tangent=function($j,$O,$V,$l,$T){this._position=$j,this._normal=$O,this._textureCoordinate0=$V,this._textureCoordinate1=$l,this._tangent=$T},$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(52,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15),new $mj(40,"vector3",5)])}]),$j}(),$nj=function(){function $j($j,$O,$V,$l,$T){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V,this._blendIndex=$l,this._blendWeight=$T}$w($j,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(64,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector4",7),new $mj(48,"vector4",6)])}]),$j}(),$Gj=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V,this._tangent=$l,this._blendIndex=$T,this._blendWeight=$S}$w($j,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(80,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector4",7),new $mj(48,"vector4",6),new $mj(64,"vector4",5)])}]),$j}(),$Fj=function(){function $j($j,$O,$V,$l,$T,$S){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V,this._tangent=$l,this._blendIndex=$T,this._blendWeight=$S}$w($j,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(76,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector4",7),new $mj(48,"vector4",6),new $mj(64,"vector3",5)])}]),$j}(),$Nj=function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V,this._tangent=$l}$w($j,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(48,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector4",5)])}]),$j}(),$Xj=function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V,this._tangent=$l}$w($j,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(44,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector3",5)])}]),$j}(),$fj=function(){function $j($j,$O,$V){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V}$w($j,"laya.d3.graphics.VertexPositionNTBTexture");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(56,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector3",5),new $mj(36,"vector3",4),new $mj(48,"vector2",2)])}]),$j}(),$Cj=function(){function $j($j,$O,$V,$l,$T,$S,$m,$p){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$j,this._normal=$O,this._textureCoordinate0=$l,this._textureCoordinate1=$T,this._tangent=$S,$V=$V,this._blendIndex=$m,this._blendWeight=$p}$w($j,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"tangent",function(){return this._tangent}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(0,$O,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$O,"blendIndex",function(){return this._blendIndex}),$s(0,$O,"blendWeight",function(){return this._blendWeight}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(96,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector3",5),new $mj(36,"vector3",4),new $mj(48,"vector2",2),new $mj(56,"vector2",15),new $mj(64,"vector4",7),new $mj(80,"vector4",6)])}]),$j}(),$Jj=function(){function $j($j,$O,$V){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$j,this._normal=$O,this._textureCoordinate=$V}$w($j,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(88,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector3",5),new $mj(36,"vector3",4),new $mj(48,"vector2",2),new $mj(56,"vector4",7),new $mj(72,"vector4",6)])}]),$j}(),$uj=(function(){function $j($j,$O,$V,$l){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$j,this._normal=$O,this._textureCoord0=$V,this._textureCoord1=$l}$w($j,"laya.d3.graphics.VertexPositionTerrain");var $O=$j.prototype;$Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"normal",function(){return this._normal}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoord0",function(){return this._textureCoord0}),$s(0,$O,"textureCoord1",function(){return this._textureCoord1}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(40,[new $mj(0,"vector3",0),new $mj(12,"vector3",3),new $mj(24,"vector2",2),new $mj(32,"vector2",15)])}])}(),function(){function $j($j,$O){this._position=null,this._textureCoordinate0=null,this._position=$j,this._textureCoordinate0=$O}$w($j,"laya.d3.graphics.VertexPositionTexture0");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"position",function(){return this._position}),$s(0,$O,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(20,[new $mj(0,"vector3",0),new $mj(12,"vector2",2)])}]),$j}()),$yj=(function(){function $j($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e,$t,$w){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$j,this._positionStartLifeTime=$O,this._velocity=$V,this._startColor=$l,this._startSize=$T,this._startRotation0=$S,this._startRotation1=$m,this._startRotation2=$p,this._startLifeTime=$o,this._time=$H,this._startSpeed=$g,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$w}$w($j,"laya.d3.graphics.VertexShurikenParticleBillboard");var $O=$j.prototype;$Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$s(0,$O,"random1",function(){return this._randoms1}),$s(0,$O,"startRotation2",function(){return this._startRotation2}),$s(0,$O,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$s(0,$O,"velocity",function(){return this._velocity}),$s(0,$O,"random0",function(){return this._randoms0}),$s(0,$O,"startSize",function(){return this._startSize}),$s(0,$O,"startColor",function(){return this._startColor}),$s(0,$O,"startRotation0",function(){return this._startRotation0}),$s(0,$O,"startRotation1",function(){return this._startRotation1}),$s(0,$O,"startLifeTime",function(){return this._startLifeTime}),$s(0,$O,"time",function(){return this._time}),$s(0,$O,"startSpeed",function(){return this._startSpeed}),$s(0,$O,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(152,[new $mj(0,"vector4",17),new $mj(16,"vector4",30),new $mj(32,"vector4",32),new $mj(48,"vector4",19),new $mj(64,"vector3",20),new $mj(76,"vector3",22),new $mj(88,"single",31),new $mj(92,"vector4",34),new $mj(108,"vector4",35),new $mj(124,"vector3",36),new $mj(136,"vector4",37)])}])}(),function(){function $j($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e,$t,$w){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$j,this._positionStartLifeTime=$O,this._velocity=$V,this._startColor=$l,this._startSize=$T,this._startRotation0=$S,this._startRotation1=$m,this._startRotation2=$p,this._startLifeTime=$o,this._time=$H,this._startSpeed=$g,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$w}$w($j,"laya.d3.graphics.VertexShurikenParticleMesh");var $O=$j.prototype;$Z.imps($O,{"laya.d3.graphics.IVertex":!0}),$s(0,$O,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$s(0,$O,"velocity",function(){return this._velocity}),$s(0,$O,"position",function(){return this._positionStartLifeTime}),$s(0,$O,"random0",function(){return this._randoms0}),$s(0,$O,"startSize",function(){return this._startSize}),$s(0,$O,"startColor",function(){return this._startColor}),$s(0,$O,"startRotation0",function(){return this._startRotation0}),$s(0,$O,"startRotation1",function(){return this._startRotation1}),$s(0,$O,"random1",function(){return this._randoms1}),$s(0,$O,"startRotation2",function(){return this._startRotation2}),$s(0,$O,"startLifeTime",function(){return this._startLifeTime}),$s(0,$O,"time",function(){return this._time}),$s(0,$O,"startSpeed",function(){return this._startSpeed}),$s(0,$O,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$s(0,$O,"vertexDeclaration",function(){return $j._vertexDeclaration}),$s(1,$j,"vertexDeclaration",function(){return $j._vertexDeclaration}),$e($j,["_vertexDeclaration",function(){return this._vertexDeclaration=new $Sj(172,[new $mj(0,"vector3",0),new $mj(12,"vector4",1),new $mj(28,"vector2",2),new $mj(36,"vector4",30),new $mj(52,"vector4",32),new $mj(68,"vector4",19),new $mj(84,"vector3",20),new $mj(96,"vector3",22),new $mj(108,"single",31),new $mj(112,"vector4",34),new $mj(128,"vector4",35),new $mj(144,"vector3",36),new $mj(156,"vector4",37)])}])}(),function(){function $c($j,$O,$V,$l,$T,$S){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$V,this._materials=$l,this._subMeshes=$T,this._materialMap=$S,this._version=$O,this._onLoaded($j)}$w($c,"laya.d3.loaders.LoadModelV01");var $j=$c.prototype;return $j._onLoaded=function($j){this._readData=$j,this.READ_BLOCK();for(var $O=0;$O<this._BLOCK.count;$O++){var $V=this._readData.getUint16(),$l=this._strings[$V],$T=this["READ_"+$l];if(null==$T)throw new Error("model file err,no this function:"+$V+" "+$l);if(!$T.call(this))break}return this._mesh},$j.onError=function(){},$j._readString=function(){return this._strings[this._readData.getUint16()]},$j.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$j.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$j.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $j=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $O=0;$O<this._STRINGS.size;$O++)this._strings[$O]=this._readData.readUTFString();return this._readData.pos=$j,!0},$j.READ_MATERIAL=function(){var $j=this._readData.getUint16(),$O=(this._readString(),this._readString());return this._materials[$j]="null"!==$O?$h.getRes(this._materialMap[$O]):new $BO,!0},$j.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $j,$O=this._readData.__getBuffer(),$V=0,$l=this._readData.getUint32(),$T=this._readData.getUint32(),$S=(new Float32Array($O.slice($l+this._DATA.offset,$l+this._DATA.offset+$T)),this._readData.getUint32()),$m=this._readData.getUint32(),$p=new Float32Array($O.slice($S+this._DATA.offset,$S+this._DATA.offset+$m));for(this.mesh._inverseBindPoses=[],$V=0,$j=$p.length;$V<$j;$V+=16){var $o=new $jO($p[$V+0],$p[$V+1],$p[$V+2],$p[$V+3],$p[$V+4],$p[$V+5],$p[$V+6],$p[$V+7],$p[$V+8],$p[$V+9],$p[$V+10],$p[$V+11],$p[$V+12],$p[$V+13],$p[$V+14],$p[$V+15]);this.mesh._inverseBindPoses.push($o)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$j.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $j=this._readString();this._shaderAttributes=$j.match($c._attrReg);var $O=this._readData.getUint32(),$V=this._readData.getUint32(),$l=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$T=this._readData.getUint32(),$S=this._readData.getUint32(),$m=this._readData.getUint32(),$p=this._readData.__getBuffer(),$o=new $HO(this._mesh),$H=this._getVertexDeclaration(),$g=$FO.create($H,$T/$H.vertexStride,35044,!0),$e=$l+this._DATA.offset,$t=$p.slice($e,$e+$T);$g.setData(new Float32Array($t));for(var $w=($o._vertexBuffer=$g).vertexDeclaration.getVertexElements(),$s=0;$s<$w.length;$s++)$o._bufferUsage[$w[$s].elementUsage]=$g;var $b=$GO.create("ushort",$V/2,35044,!0),$r=$O+this._DATA.offset,$h=$p.slice($r,$r+$V);$b.setData(new Uint16Array($h)),$o._indexBuffer=$b;var $a=$p.slice($S+this._DATA.offset,$S+this._DATA.offset+$m);return $o._boneIndicesList[0]=new Uint8Array($a),this._subMeshes.push($o),!0},$j.READ_DATAAREA=function(){return!1},$j._getVertexDeclaration=function(){for(var $j,$O=!1,$V=!1,$l=!1,$T=!1,$S=!1,$m=!1,$p=!1,$o=!1,$H=!1,$g=0;$g<this._shaderAttributes.length;$g+=8)switch(this._shaderAttributes[$g]){case"POSITION":$O=!0;break;case"NORMAL":$V=!0;break;case"COLOR":$l=!0;break;case"UV":$T=!0;break;case"UV1":$S=!0;break;case"BLENDWEIGHT":$p=!0;break;case"BLENDINDICES":$o=!0;break;case"TANGENT":$m=!0;break;case"BINORMAL":$H=!0}return $O&&$V&&$l&&$T&&$S&&$p&&$o&&$m?$j=$cj.vertexDeclaration:$O&&$V&&$l&&$T&&$S&&$p&&$o?$j=$hj.vertexDeclaration:$O&&$V&&$T&&$S&&$p&&$o&&$m?$j=$qj.vertexDeclaration:$O&&$V&&$T&&$S&&$p&&$o?$j=$Yj.vertexDeclaration:$O&&$V&&$l&&$T&&$p&&$o&&$m?$j=$Uj.vertexDeclaration:$O&&$V&&$l&&$T&&$p&&$o?$j=$xj.vertexDeclaration:$O&&$V&&$m&&$H&&$T&&$p&&$o?$j=$Jj.vertexDeclaration:$O&&$V&&$T&&$p&&$o&&$m?$j=$Fj.vertexDeclaration:$O&&$V&&$T&&$p&&$o?$j=$nj.vertexDeclaration:$O&&$V&&$l&&$p&&$o&&$m?$j=$tj.vertexDeclaration:$O&&$V&&$l&&$p&&$o?$j=$gj.vertexDeclaration:$O&&$V&&$l&&$T&&$S&&$m?$j=$Zj.vertexDeclaration:$O&&$V&&$l&&$T&&$S?$j=$rj.vertexDeclaration:$O&&$V&&$T&&$S&&$m?$j=$kj.vertexDeclaration:$O&&$V&&$T&&$S?$j=$vj.vertexDeclaration:$O&&$V&&$l&&$T&&$m?$j=$$j.vertexDeclaration:$O&&$V&&$T&&$m&&$H?$j=$fj.vertexDeclaration:$O&&$V&&$l&&$T?$j=$bj.vertexDeclaration:$O&&$V&&$T&&$m?$j=$Xj.vertexDeclaration:$O&&$V&&$T?$j=$Mj.vertexDeclaration:$O&&$V&&$l&&$m?$j=$sj.vertexDeclaration:$O&&$V&&$l&&($j=$Hj.vertexDeclaration),$j},$s(0,$j,"mesh",function(){return this._mesh}),$c._attrReg=new RegExp("(\\w+)|([:,;])","g"),$c}()),$Wj=function(){function $E(){}return $w($E,"laya.d3.loaders.LoadModelV02"),$E.parse=function($j,$O,$V,$l,$T,$S){$E._mesh=$V,$E._materials=$l,$E._subMeshes=$T,$E._materialMap=$S,$E._version=$O,$E._readData=$j,$E.READ_DATA(),$E.READ_BLOCK(),$E.READ_STRINGS();for(var $m=0,$p=$E._BLOCK.count;$m<$p;$m++){$E._readData.pos=$E._BLOCK.blockStarts[$m];var $o=$E._readData.getUint16(),$H=$E._strings[$o],$g=$E["READ_"+$H];if(null==$g)throw new Error("model file err,no this function:"+$o+" "+$H);$g.call()}$E._strings.length=0,$E._readData=null,$E._version=null,$E._mesh=null,$E._materials=null,$E._subMeshes=null,$E._materialMap=null},$E._readString=function(){return $E._strings[$E._readData.getUint16()]},$E.READ_DATA=function(){$E._DATA.offset=$E._readData.getUint32(),$E._DATA.size=$E._readData.getUint32()},$E.READ_BLOCK=function(){for(var $j=$E._BLOCK.count=$E._readData.getUint16(),$O=$E._BLOCK.blockStarts=[],$V=$E._BLOCK.blockLengths=[],$l=0;$l<$j;$l++)$O.push($E._readData.getUint32()),$V.push($E._readData.getUint32())},$E.READ_STRINGS=function(){var $j=$E._readData.getUint32(),$O=$E._readData.getUint16(),$V=$E._readData.pos;$E._readData.pos=$j+$E._DATA.offset;for(var $l=0;$l<$O;$l++)$E._strings[$l]=$E._readData.readUTFString();$E._readData.pos=$V},$E.READ_MATERIAL=function(){$E._readString(),$E._readString();var $j=$E._readString();return""!==$j&&$E._materials.push($h.getRes($E._materialMap[$j])),!0},$E.READ_MESH=function(){$E._readString();var $j,$O=$E._readData.__getBuffer(),$V=0,$l=$E._readData.getInt16(),$T=$E._DATA.offset;for($V=0;$V<$l;$V++){var $S=$T+$E._readData.getUint32(),$m=$E._readData.getUint32(),$p=new Float32Array($O.slice($S,$S+$m)),$o=$E._readString().match($E._attrReg),$H=$E._getVertexDeclaration($o),$g=$FO.create($H,4*$p.length/$H.vertexStride,35044,!0);$g.setData($p),$E._mesh._vertexBuffers.push($g)}var $e=$T+$E._readData.getUint32(),$t=$E._readData.getUint32(),$w=new Uint16Array($O.slice($e,$e+$t)),$s=$GO.create("ushort",$t/2,35044,!0);$s.setData($w),$E._mesh._indexBuffer=$s;var $b=$E._mesh._boneNames=[],$r=$E._readData.getUint16();for($b.length=$r,$V=0;$V<$r;$V++)$b[$V]=$E._strings[$E._readData.getUint16()];var $h=$E._readData.getUint32(),$a=$E._readData.getUint32(),$c=(new Float32Array($O.slice($T+$h,$T+$h+$a)),$E._readData.getUint32()),$A=$E._readData.getUint32(),$Z=new Float32Array($O.slice($T+$c,$T+$c+$A));for($E._mesh._inverseBindPoses=[],$V=0,$j=$Z.length;$V<$j;$V+=16){var $x=new $jO($Z[$V+0],$Z[$V+1],$Z[$V+2],$Z[$V+3],$Z[$V+4],$Z[$V+5],$Z[$V+6],$Z[$V+7],$Z[$V+8],$Z[$V+9],$Z[$V+10],$Z[$V+11],$Z[$V+12],$Z[$V+13],$Z[$V+14],$Z[$V+15]);$E._mesh._inverseBindPoses.push($x)}return $E._mesh._skinnedDatas=new Float32Array(16*$Z.length),!0},$E.READ_SUBMESH=function(){var $j=$E._readData.__getBuffer(),$O=new $HO($E._mesh),$V=$E._readData.getInt16(),$l=$E._readData.getUint32(),$T=$E._readData.getUint32();$O._vertexBuffer=$E._mesh._vertexBuffers[$V],$O._vertexStart=$l,$O._vertexCount=$T;var $S=$E._readData.getUint32(),$m=$E._readData.getUint32(),$p=$E._mesh._indexBuffer;$O._indexBuffer=$p,$O._indexStart=$S,$O._indexCount=$m,$O._indices=new Uint16Array($p.getData().buffer,2*$S,$m);var $o=$E._DATA.offset,$H=$O._subIndexBufferStart,$g=$O._subIndexBufferCount,$e=$O._boneIndicesList,$t=$E._readData.getUint16();$H.length=$t,$g.length=$t,$e.length=$t;for(var $w=0;$w<$t;$w++){$H[$w]=$E._readData.getUint32(),$g[$w]=$E._readData.getUint32();var $s=$E._readData.getUint32(),$b=$E._readData.getUint32();$O._boneIndicesList[$w]=new Uint8Array($j.slice($o+$s,$o+$s+$b))}return $E._subMeshes.push($O),!0},$E._getVertexDeclaration=function($j){for(var $O,$V=!1,$l=!1,$T=!1,$S=!1,$m=!1,$p=!1,$o=!1,$H=!1,$g=!1,$e=0;$e<$j.length;$e++)switch($j[$e]){case"POSITION":$V=!0;break;case"NORMAL":$l=!0;break;case"COLOR":$T=!0;break;case"UV":$S=!0;break;case"UV1":$m=!0;break;case"BLENDWEIGHT":$o=!0;break;case"BLENDINDICES":$H=!0;break;case"TANGENT":$p=!0;break;case"BINORMAL":$g=!0}return $V&&$l&&$T&&$S&&$m&&$o&&$H&&$p?$O=$cj.vertexDeclaration:$V&&$l&&$T&&$S&&$m&&$o&&$H?$O=$hj.vertexDeclaration:$V&&$l&&$S&&$m&&$o&&$H&&$p?$O=$qj.vertexDeclaration:$V&&$l&&$S&&$m&&$o&&$H?$O=$Yj.vertexDeclaration:$V&&$l&&$T&&$S&&$o&&$H&&$p?$O=$Uj.vertexDeclaration:$V&&$l&&$T&&$S&&$o&&$H?$O=$xj.vertexDeclaration:$V&&$l&&$S&&$o&&$H&&$p?$O=$Fj.vertexDeclaration:$V&&$l&&$S&&$o&&$H?$O=$nj.vertexDeclaration:$V&&$l&&$T&&$o&&$H&&$p?$O=$tj.vertexDeclaration:$V&&$l&&$T&&$o&&$H?$O=$gj.vertexDeclaration:$V&&$l&&$T&&$S&&$m&&$p?$O=$Zj.vertexDeclaration:$V&&$l&&$T&&$S&&$m?$O=$rj.vertexDeclaration:$V&&$l&&$S&&$m&&$p?$O=$kj.vertexDeclaration:$V&&$l&&$S&&$m?$O=$vj.vertexDeclaration:$V&&$l&&$T&&$S&&$p?$O=$$j.vertexDeclaration:$V&&$l&&$S&&$p&&$g?$O=$fj.vertexDeclaration:$V&&$l&&$T&&$S?$O=$bj.vertexDeclaration:$V&&$l&&$S&&$p?$O=$Xj.vertexDeclaration:$V&&$l&&$S?$O=$Mj.vertexDeclaration:$V&&$l&&$T&&$p?$O=$sj.vertexDeclaration:$V&&$l&&$T&&($O=$Hj.vertexDeclaration),$O},$E._attrReg=new RegExp("(\\w+)|([:,;])","g"),$E._strings=[],$E._readData=null,$E._version=null,$E._mesh=null,$E._materials=null,$E._subMeshes=null,$E._materialMap=null,$e($E,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$E}(),$Kj=function(){function $x(){}return $w($x,"laya.d3.loaders.LoadModelV03"),$x.parse=function($j,$O,$V,$l,$T){$x._mesh=$V,$x._subMeshes=$l,$x._materialMap=$T,$x._version=$O,$x._readData=$j,$x.READ_DATA(),$x.READ_BLOCK(),$x.READ_STRINGS();for(var $S=0,$m=$x._BLOCK.count;$S<$m;$S++){$x._readData.pos=$x._BLOCK.blockStarts[$S];var $p=$x._readData.getUint16(),$o=$x._strings[$p],$H=$x["READ_"+$o];if(null==$H)throw new Error("model file err,no this function:"+$p+" "+$o);$H.call()}$x._strings.length=0,$x._readData=null,$x._version=null,$x._mesh=null,$x._subMeshes=null,$x._materialMap=null},$x._readString=function(){return $x._strings[$x._readData.getUint16()]},$x.READ_DATA=function(){$x._DATA.offset=$x._readData.getUint32(),$x._DATA.size=$x._readData.getUint32()},$x.READ_BLOCK=function(){for(var $j=$x._BLOCK.count=$x._readData.getUint16(),$O=$x._BLOCK.blockStarts=[],$V=$x._BLOCK.blockLengths=[],$l=0;$l<$j;$l++)$O.push($x._readData.getUint32()),$V.push($x._readData.getUint32())},$x.READ_STRINGS=function(){var $j=$x._readData.getUint32(),$O=$x._readData.getUint16(),$V=$x._readData.pos;$x._readData.pos=$j+$x._DATA.offset;for(var $l=0;$l<$O;$l++)$x._strings[$l]=$x._readData.readUTFString();$x._readData.pos=$V},$x.READ_MESH=function(){var $j,$O=$x._readString(),$V=$x._readData.__getBuffer(),$l=0,$T=$x._readData.getInt16(),$S=$x._DATA.offset;for($l=0;$l<$T;$l++){var $m,$p=$S+$x._readData.getUint32(),$o=$x._readData.getUint32(),$H=new Float32Array($V.slice($p,$p+$o)),$g=$x._readString();switch($x._version){case"LAYAMODEL:03":$m=$x._vertexDeclarationMap_Discard[$g];break;case"LAYAMODEL:0301":$m=$x._vertexDeclarationMap[$g];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$m)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$x._version+"  bufferAttribute="+$g+"  name="+$O+"  url="+($x._mesh?$x._mesh.url:"null"));var $e=$FO.create($m,4*$H.length/$m.vertexStride,35044,!0,$x._mesh._url+"_"+$l);$e.setData($H),$x._mesh._vertexBuffers.push($e)}var $t=$S+$x._readData.getUint32(),$w=$x._readData.getUint32(),$s=new Uint16Array($V.slice($t,$t+$w)),$b=$GO.create("ushort",$w/2,35044,!0,$x._mesh._url);$b.setData($s),$x._mesh._indexBuffer=$b;var $r=$x._mesh._boneNames=[],$h=$x._readData.getUint16();for($r.length=$h,$l=0;$l<$h;$l++)$r[$l]=$x._strings[$x._readData.getUint16()];$x._readData.pos+=8;var $a=$x._readData.getUint32(),$c=$x._readData.getUint32(),$A=new Float32Array($V.slice($S+$a,$S+$a+$c));for($x._mesh._inverseBindPoses=[],$l=0,$j=$A.length;$l<$j;$l+=16){var $Z=new $jO($A[$l+0],$A[$l+1],$A[$l+2],$A[$l+3],$A[$l+4],$A[$l+5],$A[$l+6],$A[$l+7],$A[$l+8],$A[$l+9],$A[$l+10],$A[$l+11],$A[$l+12],$A[$l+13],$A[$l+14],$A[$l+15]);$x._mesh._inverseBindPoses.push($Z)}return $x._mesh._skinnedDatas=new Float32Array(16*$A.length),!0},$x.READ_SUBMESH=function(){var $j=$x._readData.__getBuffer(),$O=new $HO($x._mesh),$V=$x._readData.getInt16(),$l=$x._readData.getUint32(),$T=$x._readData.getUint32();$O._vertexBuffer=$x._mesh._vertexBuffers[$V],$O._vertexStart=$l,$O._vertexCount=$T;var $S=$x._readData.getUint32(),$m=$x._readData.getUint32(),$p=$x._mesh._indexBuffer;$O._indexBuffer=$p,$O._indexStart=$S,$O._indexCount=$m,$O._indices=new Uint16Array($p.getData().buffer,2*$S,$m);var $o=$x._DATA.offset,$H=$O._subIndexBufferStart,$g=$O._subIndexBufferCount,$e=$O._boneIndicesList,$t=$x._readData.getUint16();$H.length=$t,$g.length=$t,$e.length=$t;for(var $w=0;$w<$t;$w++){$H[$w]=$x._readData.getUint32(),$g[$w]=$x._readData.getUint32();var $s=$x._readData.getUint32(),$b=$x._readData.getUint32();$e[$w]=new Uint8Array($j.slice($o+$s,$o+$s+$b))}return $x._subMeshes.push($O),!0},$x._strings=[],$x._readData=null,$x._version=null,$x._mesh=null,$x._subMeshes=null,$x._materialMap=null,$e($x,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$cj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$hj.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Cj.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$qj.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Yj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Uj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$xj.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Fj.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$nj.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$tj.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$gj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Zj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$rj.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$kj.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$vj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$$j.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$fj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$bj.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Xj.vertexDeclaration,"POSITION,NORMAL,UV":$Mj.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$sj.vertexDeclaration,"POSITION,NORMAL,COLOR":$Hj.vertexDeclaration,"POSITION,NORMAL,TANGENT":$Bj.vertexDeclaration,"POSITION,NORMAL":$oj.vertexDeclaration,"POSITION,UV":$uj.vertexDeclaration,POSITION:$pj.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$aj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$hj.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Cj.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Rj.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Yj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Ej.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$xj.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Gj.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$nj.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$ej.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$gj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Aj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$rj.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$ij.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$vj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$zj.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$fj.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$bj.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Nj.vertexDeclaration,"POSITION,NORMAL,UV":$Mj.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$wj.vertexDeclaration,"POSITION,NORMAL,COLOR":$Hj.vertexDeclaration,"POSITION,NORMAL,TANGENT":$_j.vertexDeclaration,"POSITION,NORMAL":$oj.vertexDeclaration,"POSITION,UV":$uj.vertexDeclaration,POSITION:$pj.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$x}(),$dj=function(){function $p(){}return $w($p,"laya.d3.loaders.MeshReader"),$p.read=function($j,$O,$V,$l,$T){var $S=new $x($j);$S.pos=0;var $m=$S.readUTFString();switch($m){case"LAYAMODEL:01":case"LAYASKINANI:01":$p._readVersion01($S,$m,$O,$V,$l,$T);break;case"LAYAMODEL:02":$Wj.parse($S,$m,$O,$V,$l,$T);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$Kj.parse($S,$m,$O,$l,$T);break;default:throw new Error("MeshReader: unknown mesh version.")}$O._setSubMeshes($l)},$p._readVersion01=function($j,$O,$V,$l,$T,$S){new $yj($j,$O,$V,$l,$T,$S)},$p}(),$Lj=function(){function $j($j,$O){this.min=null,this.max=null,this.min=$j,this.max=$O}$w($j,"laya.d3.math.BoundBox");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.core.IClone":!0}),$O.getCorners=function($j){$j.length=8;var $O=this.min.elements,$V=this.max.elements,$l=$O[0],$T=$O[1],$S=$O[2],$m=$V[0],$p=$V[1],$o=$V[2];$j[0]=new $mO($l,$p,$o),$j[1]=new $mO($m,$p,$o),$j[2]=new $mO($m,$T,$o),$j[3]=new $mO($l,$T,$o),$j[4]=new $mO($l,$p,$S),$j[5]=new $mO($m,$p,$S),$j[6]=new $mO($m,$T,$S),$j[7]=new $mO($l,$T,$S)},$O.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$O.cloneTo=function($j){var $O=$j;this.min.cloneTo($O.min),this.max.cloneTo($O.max)},$O.clone=function(){var $j=new this.constructor(new $mO,new $mO);return this.cloneTo($j),$j},$j.createfromPoints=function($j,$O){if(null==$j)throw new Error("points");var $V=$O.min,$l=$O.max,$T=$V.elements;$T[0]=Number.MAX_VALUE,$T[1]=Number.MAX_VALUE,$T[2]=Number.MAX_VALUE;var $S=$l.elements;$S[0]=-Number.MAX_VALUE,$S[1]=-Number.MAX_VALUE,$S[2]=-Number.MAX_VALUE;for(var $m=0,$p=$j.length;$m<$p;++$m)$mO.min($V,$j[$m],$V),$mO.max($l,$j[$m],$l)},$j.merge=function($j,$O,$V){$mO.min($j.min,$O.min,$V.min),$mO.max($j.max,$O.max,$V.max)},$j}(),$Qj=function(){function $H($j){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$j,this._near=new $OO(new $mO),this._far=new $OO(new $mO),this._left=new $OO(new $mO),this._right=new $OO(new $mO),this._top=new $OO(new $mO),this._bottom=new $OO(new $mO),$H._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$w($H,"laya.d3.math.BoundFrustum");var $j=$H.prototype;return $j.equalsBoundFrustum=function($j){return this._matrix.equalsOtherMatrix($j.matrix)},$j.equalsObj=function($j){if($j instanceof laya.d3.math.BoundFrustum){var $O=$j;return this.equalsBoundFrustum($O)}return!1},$j.getPlane=function($j){switch($j){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$j.getCorners=function($j){$H._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($j[0]),$H._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($j[1]),$H._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($j[2]),$H._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($j[3]),$H._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($j[4]),$H._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($j[5]),$H._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($j[6]),$H._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($j[7])},$j.containsPoint=function($j){for(var $O=$OO.PlaneIntersectionType_Front,$V=$OO.PlaneIntersectionType_Front,$l=0;$l<6;$l++){switch($l){case 0:$V=Collision.intersectsPlaneAndPoint(this._near,$j);break;case 1:$V=Collision.intersectsPlaneAndPoint(this._far,$j);break;case 2:$V=Collision.intersectsPlaneAndPoint(this._left,$j);break;case 3:$V=Collision.intersectsPlaneAndPoint(this._right,$j);break;case 4:$V=Collision.intersectsPlaneAndPoint(this._top,$j);break;case 5:$V=Collision.intersectsPlaneAndPoint(this._bottom,$j)}switch($V){case $OO.PlaneIntersectionType_Back:return 0;case $OO.PlaneIntersectionType_Intersecting:$O=$OO.PlaneIntersectionType_Intersecting}}switch($O){case $OO.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$j.containsBoundBox=function($j){for(var $O,$V=$H._tempV30,$l=$H._tempV31,$T=1,$S=0;$S<6;$S++){if($O=this.getPlane($S),this._getBoxToPlanePVertexNVertex($j,$O.normal,$V,$l),Collision.intersectsPlaneAndPoint($O,$V)===$OO.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($O,$l)===$OO.PlaneIntersectionType_Back&&($T=2)}return $T},$j.containsBoundSphere=function($j){for(var $O=$OO.PlaneIntersectionType_Front,$V=$OO.PlaneIntersectionType_Front,$l=0;$l<6;$l++){switch($l){case 0:$V=Collision.intersectsPlaneAndSphere(this._near,$j);break;case 1:$V=Collision.intersectsPlaneAndSphere(this._far,$j);break;case 2:$V=Collision.intersectsPlaneAndSphere(this._left,$j);break;case 3:$V=Collision.intersectsPlaneAndSphere(this._right,$j);break;case 4:$V=Collision.intersectsPlaneAndSphere(this._top,$j);break;case 5:$V=Collision.intersectsPlaneAndSphere(this._bottom,$j)}switch($V){case $OO.PlaneIntersectionType_Back:return 0;case $OO.PlaneIntersectionType_Intersecting:$O=$OO.PlaneIntersectionType_Intersecting}}switch($O){case $OO.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$j._getBoxToPlanePVertexNVertex=function($j,$O,$V,$l){var $T=$j.min,$S=$T.elements,$m=$j.max,$p=$m.elements,$o=$O.elements,$H=$o[0],$g=$o[1],$e=$o[2];$T.cloneTo($V);var $t=$V.elements;0<=$H&&($t[0]=$p[0]),0<=$g&&($t[1]=$p[1]),0<=$e&&($t[2]=$p[2]),$m.cloneTo($l);var $w=$l.elements;0<=$H&&($w[0]=$S[0]),0<=$g&&($w[1]=$S[1]),0<=$e&&($w[2]=$S[2])},$s(0,$j,"top",function(){return this._top}),$s(0,$j,"matrix",function(){return this._matrix},function($j){this._matrix=$j,$H._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$s(0,$j,"near",function(){return this._near}),$s(0,$j,"far",function(){return this._far}),$s(0,$j,"left",function(){return this._left}),$s(0,$j,"right",function(){return this._right}),$s(0,$j,"bottom",function(){return this._bottom}),$H._getPlanesFromMatrix=function($j,$O,$V,$l,$T,$S,$m){var $p=$j.elements,$o=$p[0],$H=$p[1],$g=$p[2],$e=$p[3],$t=$p[4],$w=$p[5],$s=$p[6],$b=$p[7],$r=$p[8],$h=$p[9],$a=$p[10],$c=$p[11],$A=$p[12],$Z=$p[13],$x=$p[14],$E=$p[15],$U=$O.normal.elements;$U[0]=$e+$g,$U[1]=$b+$s,$U[2]=$c+$a,$O.distance=$E+$x,$O.normalize();var $z=$V.normal.elements;$z[0]=$e-$g,$z[1]=$b-$s,$z[2]=$c-$a,$V.distance=$E-$x,$V.normalize();var $$=$l.normal.elements;$$[0]=$e+$o,$$[1]=$b+$t,$$[2]=$c+$r,$l.distance=$E+$A,$l.normalize();var $_=$T.normal.elements;$_[0]=$e-$o,$_[1]=$b-$t,$_[2]=$c-$r,$T.distance=$E-$A,$T.normalize();var $B=$S.normal.elements;$B[0]=$e-$H,$B[1]=$b-$w,$B[2]=$c-$h,$S.distance=$E-$Z,$S.normalize();var $M=$m.normal.elements;$M[0]=$e+$H,$M[1]=$b+$w,$M[2]=$c+$h,$m.distance=$E+$Z,$m.normalize()},$H._get3PlaneInterPoint=function($j,$O,$V){var $l=$j.normal,$T=$O.normal,$S=$V.normal;$mO.cross($T,$S,$H._tempV30),$mO.cross($S,$l,$H._tempV31),$mO.cross($l,$T,$H._tempV32);var $m=$mO.dot($l,$H._tempV30),$p=$mO.dot($T,$H._tempV31),$o=$mO.dot($S,$H._tempV32);return $mO.scale($H._tempV30,-$j.distance/$m,$H._tempV33),$mO.scale($H._tempV31,-$O.distance/$p,$H._tempV34),$mO.scale($H._tempV32,-$V.distance/$o,$H._tempV35),$mO.add($H._tempV33,$H._tempV34,$H._tempV36),$mO.add($H._tempV35,$H._tempV36,$H._tempV37),$H._tempV37},$e($H,["_tempV30",function(){return this._tempV30=new $mO},"_tempV31",function(){return this._tempV31=new $mO},"_tempV32",function(){return this._tempV32=new $mO},"_tempV33",function(){return this._tempV33=new $mO},"_tempV34",function(){return this._tempV34=new $mO},"_tempV35",function(){return this._tempV35=new $mO},"_tempV36",function(){return this._tempV36=new $mO},"_tempV37",function(){return this._tempV37=new $mO}]),$H}(),$Dj=function(){function $g($j,$O){this.center=null,this.radius=NaN,this.center=$j,this.radius=$O}$w($g,"laya.d3.math.BoundSphere");var $j=$g.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.toDefault=function(){this.center.toDefault(),this.radius=0},$j.intersectsRayDistance=function($j){return Collision.intersectsRayAndSphereRD($j,this)},$j.intersectsRayPoint=function($j,$O){return Collision.intersectsRayAndSphereRP($j,this,$O)},$j.cloneTo=function($j){var $O=$j;this.center.cloneTo($O.center),$O.radius=this.radius},$j.clone=function(){var $j=new this.constructor(new $mO,new $mO);return this.cloneTo($j),$j},$g.createFromSubPoints=function($j,$O,$V,$l){if(null==$j)throw new Error("points");if($O<0||$O>=$j.length)throw new Error("start"+$O+"Must be in the range [0, "+($j.length-1)+"]");if($V<0||$O+$V>$j.length)throw new Error("count"+$V+"Must be in the range <= "+$j.length+"}");var $T=$O+$V,$S=$g._tempVector3;$S.elements[0]=0,$S.elements[1]=0,$S.elements[2]=0;for(var $m=$O;$m<$T;++$m)$mO.add($j[$m],$S,$S);var $p=$l.center;$mO.scale($S,1/$V,$p);var $o=0;for($m=$O;$m<$T;++$m){var $H=$mO.distanceSquared($p,$j[$m]);$o<$H&&($o=$H)}$l.radius=Math.sqrt($o)},$g.createfromPoints=function($j,$O){if(null==$j)throw new Error("points");$g.createFromSubPoints($j,0,$j.length,$O)},$e($g,["_tempVector3",function(){return this._tempVector3=new $mO}]),$g}(),$Ij=(function(){function $j(){}$w($j,"laya.d3.math.ContainmentType"),$j.Disjoint=0,$j.Contains=1,$j.Intersects=2}(),function(){function $V(){}return $w($V,"laya.d3.math.MathUtils3D"),$V.isZero=function($j){return Math.abs($j)<$V.zeroTolerance},$V.nearEqual=function($j,$O){return!!$V.isZero($j-$O)},$V.fastInvSqrt=function($j){return $V.isZero($j)?$j:1/Math.sqrt($j)},$e($V,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$V}()),$Pj=function(){function $o(){var $j=this.elements=new Float32Array(9);$j[0]=1,$j[1]=0,$j[2]=0,$j[3]=0,$j[4]=1,$j[5]=0,$j[6]=0,$j[7]=0,$j[8]=1}$w($o,"laya.d3.math.Matrix3x3");var $j=$o.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.determinant=function(){var $j=this.elements,$O=$j[0],$V=$j[1],$l=$j[2],$T=$j[3],$S=$j[4],$m=$j[5],$p=$j[6],$o=$j[7],$H=$j[8];return $O*($H*$S-$m*$o)+$V*(-$H*$T+$m*$p)+$l*($o*$T-$S*$p)},$j.translate=function($j,$O){var $V=$O.elements,$l=this.elements,$T=$j.elements,$S=$l[0],$m=$l[1],$p=$l[2],$o=$l[3],$H=$l[4],$g=$l[5],$e=$l[6],$t=$l[7],$w=$l[8],$s=$T[0],$b=$T[1];$V[0]=$S,$V[1]=$m,$V[2]=$p,$V[3]=$o,$V[4]=$H,$V[5]=$g,$V[6]=$s*$S+$b*$o+$e,$V[7]=$s*$m+$b*$H+$t,$V[8]=$s*$p+$b*$g+$w},$j.rotate=function($j,$O){var $V=$O.elements,$l=this.elements,$T=$l[0],$S=$l[1],$m=$l[2],$p=$l[3],$o=$l[4],$H=$l[5],$g=$l[6],$e=$l[7],$t=$l[8],$w=Math.sin($j),$s=Math.cos($j);$V[0]=$s*$T+$w*$p,$V[1]=$s*$S+$w*$o,$V[2]=$s*$m+$w*$H,$V[3]=$s*$p-$w*$T,$V[4]=$s*$o-$w*$S,$V[5]=$s*$H-$w*$m,$V[6]=$g,$V[7]=$e,$V[8]=$t},$j.scale=function($j,$O){var $V=$O.elements,$l=this.elements,$T=$j.elements,$S=$T[0],$m=$T[1];$V[0]=$S*$l[0],$V[1]=$S*$l[1],$V[2]=$S*$l[2],$V[3]=$m*$l[3],$V[4]=$m*$l[4],$V[5]=$m*$l[5],$V[6]=$l[6],$V[7]=$l[7],$V[8]=$l[8]},$j.invert=function($j){var $O=$j.elements,$V=this.elements,$l=$V[0],$T=$V[1],$S=$V[2],$m=$V[3],$p=$V[4],$o=$V[5],$H=$V[6],$g=$V[7],$e=$V[8],$t=$e*$p-$o*$g,$w=-$e*$m+$o*$H,$s=$g*$m-$p*$H,$b=$l*$t+$T*$w+$S*$s;$b||($j=null),$b=1/$b,$O[0]=$t*$b,$O[1]=(-$e*$T+$S*$g)*$b,$O[2]=($o*$T-$S*$p)*$b,$O[3]=$w*$b,$O[4]=($e*$l-$S*$H)*$b,$O[5]=(-$o*$l+$S*$m)*$b,$O[6]=$s*$b,$O[7]=(-$g*$l+$T*$H)*$b,$O[8]=($p*$l-$T*$m)*$b},$j.transpose=function($j){var $O=$j.elements,$V=this.elements;if($j===this){var $l=$V[1],$T=$V[2],$S=$V[5];$O[1]=$V[3],$O[2]=$V[6],$O[3]=$l,$O[5]=$V[7],$O[6]=$T,$O[7]=$S}else $O[0]=$V[0],$O[1]=$V[3],$O[2]=$V[6],$O[3]=$V[1],$O[4]=$V[4],$O[5]=$V[7],$O[6]=$V[2],$O[7]=$V[5],$O[8]=$V[8]},$j.identity=function(){var $j=this.elements;$j[0]=1,$j[1]=0,$j[2]=0,$j[3]=0,$j[4]=1,$j[5]=0,$j[6]=0,$j[7]=0,$j[8]=1},$j.cloneTo=function($j){var $O,$V,$l;if(($V=this.elements)!==($l=$j.elements))for($O=0;$O<9;++$O)$l[$O]=$V[$O]},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$o.createFromTranslation=function($j,$O){$O.elements;var $V=$j.elements;$O[0]=1,$O[1]=0,$O[2]=0,$O[3]=0,$O[4]=1,$O[5]=0,$O[6]=$V[0],$O[7]=$V[1],$O[8]=1},$o.createFromRotation=function($j,$O){var $V=$O.elements,$l=Math.sin($j),$T=Math.cos($j);$V[0]=$T,$V[1]=$l,$V[2]=0,$V[3]=-$l,$V[4]=$T,$V[5]=0,$V[6]=0,$V[7]=0,$V[8]=1},$o.createFromScaling=function($j,$O){var $V=$O.elements,$l=$j.elements;$V[0]=$l[0],$V[1]=0,$V[2]=0,$V[3]=0,$V[4]=$l[1],$V[5]=0,$V[6]=0,$V[7]=0,$V[8]=1},$o.createFromMatrix4x4=function($j,$O){$O[0]=$j[0],$O[1]=$j[1],$O[2]=$j[2],$O[3]=$j[4],$O[4]=$j[5],$O[5]=$j[6],$O[6]=$j[8],$O[7]=$j[9],$O[8]=$j[10]},$o.multiply=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements,$m=$T[0],$p=$T[1],$o=$T[2],$H=$T[3],$g=$T[4],$e=$T[5],$t=$T[6],$w=$T[7],$s=$T[8],$b=$S[0],$r=$S[1],$h=$S[2],$a=$S[3],$c=$S[4],$A=$S[5],$Z=$S[6],$x=$S[7],$E=$S[8];$l[0]=$b*$m+$r*$H+$h*$t,$l[1]=$b*$p+$r*$g+$h*$w,$l[2]=$b*$o+$r*$e+$h*$s,$l[3]=$a*$m+$c*$H+$A*$t,$l[4]=$a*$p+$c*$g+$A*$w,$l[5]=$a*$o+$c*$e+$A*$s,$l[6]=$Z*$m+$x*$H+$E*$t,$l[7]=$Z*$p+$x*$g+$E*$w,$l[8]=$Z*$o+$x*$e+$E*$s},$o.lookAt=function($j,$O,$V,$l){$mO.subtract($j,$O,$o._tempV30),$mO.normalize($o._tempV30,$o._tempV30),$mO.cross($V,$o._tempV30,$o._tempV31),$mO.normalize($o._tempV31,$o._tempV31),$mO.cross($o._tempV30,$o._tempV31,$o._tempV32);var $T=$o._tempV30.elements,$S=$o._tempV31.elements,$m=$o._tempV32.elements,$p=$l.elements;$p[0]=$S[0],$p[3]=$S[1],$p[6]=$S[2],$p[1]=$m[0],$p[4]=$m[1],$p[7]=$m[2],$p[2]=$T[0],$p[5]=$T[1],$p[8]=$T[2]},$o.DEFAULT=new $o,$e($o,["_tempV30",function(){return this._tempV30=new $mO},"_tempV31",function(){return this._tempV31=new $mO},"_tempV32",function(){return this._tempV32=new $mO}]),$o}(),$jO=function(){function $z($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e,$t,$w,$s,$b){void 0===$j&&($j=1),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$S&&($S=1),void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$o&&($o=0),void 0===$H&&($H=0),void 0===$g&&($g=1),void 0===$e&&($e=0),void 0===$t&&($t=0),void 0===$w&&($w=0),void 0===$s&&($s=0),void 0===$b&&($b=1);var $r=this.elements=new Float32Array(16);$r[0]=$j,$r[1]=$O,$r[2]=$V,$r[3]=$l,$r[4]=$T,$r[5]=$S,$r[6]=$m,$r[7]=$p,$r[8]=$o,$r[9]=$H,$r[10]=$g,$r[11]=$e,$r[12]=$t,$r[13]=$w,$r[14]=$s,$r[15]=$b}$w($z,"laya.d3.math.Matrix4x4");var $j=$z.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.getElementByRowColumn=function($j,$O){if($j<0||3<$j)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($O<0||3<$O)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$j+$O]},$j.setElementByRowColumn=function($j,$O,$V){if($j<0||3<$j)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($O<0||3<$O)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$j+$O]=$V},$j.equalsOtherMatrix=function($j){var $O=this.elements,$V=$j.elements;return $Ij.nearEqual($O[0],$V[0])&&$Ij.nearEqual($O[1],$V[1])&&$Ij.nearEqual($O[2],$V[2])&&$Ij.nearEqual($O[3],$V[3])&&$Ij.nearEqual($O[4],$V[4])&&$Ij.nearEqual($O[5],$V[5])&&$Ij.nearEqual($O[6],$V[6])&&$Ij.nearEqual($O[7],$V[7])&&$Ij.nearEqual($O[8],$V[8])&&$Ij.nearEqual($O[9],$V[9])&&$Ij.nearEqual($O[10],$V[10])&&$Ij.nearEqual($O[11],$V[11])&&$Ij.nearEqual($O[12],$V[12])&&$Ij.nearEqual($O[13],$V[13])&&$Ij.nearEqual($O[14],$V[14])&&$Ij.nearEqual($O[15],$V[15])},$j.decomposeTransRotScale=function($j,$O,$V){var $l=$z._tempMatrix4x4;return this.decomposeTransRotMatScale($j,$l,$V)?($VO.createFromMatrix4x4($l,$O),!0):($O.identity(),!1)},$j.decomposeTransRotMatScale=function($j,$O,$V){var $l=this.elements,$T=$j.elements,$S=$O.elements,$m=$V.elements;$T[0]=$l[12],$T[1]=$l[13],$T[2]=$l[14];var $p=$l[0],$o=$l[1],$H=$l[2],$g=$l[4],$e=$l[5],$t=$l[6],$w=$l[8],$s=$l[9],$b=$l[10],$r=$m[0]=Math.sqrt($p*$p+$o*$o+$H*$H),$h=$m[1]=Math.sqrt($g*$g+$e*$e+$t*$t),$a=$m[2]=Math.sqrt($w*$w+$s*$s+$b*$b);if($Ij.isZero($r)||$Ij.isZero($h)||$Ij.isZero($a))return $S[1]=$S[2]=$S[3]=$S[4]=$S[6]=$S[7]=$S[8]=$S[9]=$S[11]=$S[12]=$S[13]=$S[14]=0,$S[0]=$S[5]=$S[10]=$S[15]=1,!1;var $c=$z._tempVector0,$A=$c.elements;$A[0]=$w/$a,$A[1]=$s/$a,$A[2]=$b/$a;var $Z=$z._tempVector1,$x=$Z.elements;$x[0]=$p/$r,$x[1]=$o/$r,$x[2]=$H/$r;var $E=$z._tempVector2;$mO.cross($c,$Z,$E);var $U=$z._tempVector1;return $mO.cross($E,$c,$U),$S[3]=$S[7]=$S[11]=$S[12]=$S[13]=$S[14]=0,$S[15]=1,$S[0]=$U.x,$S[1]=$U.y,$S[2]=$U.z,$S[4]=$E.x,$S[5]=$E.y,$S[6]=$E.z,$S[8]=$c.x,$S[9]=$c.y,$S[10]=$c.z,$S[0]*$p+$S[1]*$o+$S[2]*$H<0&&($m[0]=-$r),$S[4]*$g+$S[5]*$e+$S[6]*$t<0&&($m[1]=-$h),$S[8]*$w+$S[9]*$s+$S[10]*$b<0&&($m[2]=-$a),!0},$j.decomposeYawPitchRoll=function($j){var $O=$j.elements,$V=Math.asin(-this.elements[9]);$O[1]=$V,Math.cos($V)>$Ij.zeroTolerance?($O[2]=Math.atan2(this.elements[1],this.elements[5]),$O[0]=Math.atan2(this.elements[8],this.elements[10])):($O[2]=Math.atan2(-this.elements[4],this.elements[0]),$O[0]=0)},$j.normalize=function(){var $j=this.elements,$O=$j[0],$V=$j[1],$l=$j[2],$T=Math.sqrt($O*$O+$V*$V+$l*$l);if(!$T)return $j[0]=0,$j[1]=0,void($j[2]=0);1!=$T&&($T=1/$T,$j[0]=$O*$T,$j[1]=$V*$T,$j[2]=$l*$T)},$j.transpose=function(){var $j,$O;return $O=($j=this.elements)[1],$j[1]=$j[4],$j[4]=$O,$O=$j[2],$j[2]=$j[8],$j[8]=$O,$O=$j[3],$j[3]=$j[12],$j[12]=$O,$O=$j[6],$j[6]=$j[9],$j[9]=$O,$O=$j[7],$j[7]=$j[13],$j[13]=$O,$O=$j[11],$j[11]=$j[14],$j[14]=$O,this},$j.invert=function($j){var $O=this.elements,$V=$j.elements,$l=$O[0],$T=$O[1],$S=$O[2],$m=$O[3],$p=$O[4],$o=$O[5],$H=$O[6],$g=$O[7],$e=$O[8],$t=$O[9],$w=$O[10],$s=$O[11],$b=$O[12],$r=$O[13],$h=$O[14],$a=$O[15],$c=$l*$o-$T*$p,$A=$l*$H-$S*$p,$Z=$l*$g-$m*$p,$x=$T*$H-$S*$o,$E=$T*$g-$m*$o,$U=$S*$g-$m*$H,$z=$e*$r-$t*$b,$$=$e*$h-$w*$b,$_=$e*$a-$s*$b,$B=$t*$h-$w*$r,$M=$t*$a-$s*$r,$v=$w*$a-$s*$h,$Y=$c*$v-$A*$M+$Z*$B+$x*$_-$E*$$+$U*$z;0!==Math.abs($Y)&&($Y=1/$Y,$V[0]=($o*$v-$H*$M+$g*$B)*$Y,$V[1]=($S*$M-$T*$v-$m*$B)*$Y,$V[2]=($r*$U-$h*$E+$a*$x)*$Y,$V[3]=($w*$E-$t*$U-$s*$x)*$Y,$V[4]=($H*$_-$p*$v-$g*$$)*$Y,$V[5]=($l*$v-$S*$_+$m*$$)*$Y,$V[6]=($h*$Z-$b*$U-$a*$A)*$Y,$V[7]=($e*$U-$w*$Z+$s*$A)*$Y,$V[8]=($p*$M-$o*$_+$g*$z)*$Y,$V[9]=($T*$_-$l*$M-$m*$z)*$Y,$V[10]=($b*$E-$r*$Z+$a*$c)*$Y,$V[11]=($t*$Z-$e*$E-$s*$c)*$Y,$V[12]=($o*$$-$p*$B-$H*$z)*$Y,$V[13]=($l*$B-$T*$$+$S*$z)*$Y,$V[14]=($r*$A-$b*$x-$h*$c)*$Y,$V[15]=($e*$x-$t*$A+$w*$c)*$Y)},$j.identity=function(){var $j=this.elements;$j[1]=$j[2]=$j[3]=$j[4]=$j[6]=$j[7]=$j[8]=$j[9]=$j[11]=$j[12]=$j[13]=$j[14]=0,$j[0]=$j[5]=$j[10]=$j[15]=1},$j.cloneTo=function($j){var $O,$V,$l;if(($V=this.elements)!==($l=$j.elements))for($O=0;$O<16;++$O)$l[$O]=$V[$O]},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$j.getTranslationVector=function($j){var $O=this.elements,$V=$j.elements;$V[0]=$O[12],$V[1]=$O[13],$V[2]=$O[14]},$j.setTranslationVector=function($j){var $O=this.elements,$V=$j.elements;$O[12]=$V[0],$O[13]=$V[1],$O[14]=$V[2]},$j.getForward=function($j){var $O=this.elements,$V=$j.elements;$V[0]=-$O[8],$V[1]=-$O[9],$V[2]=-$O[10]},$j.setForward=function($j){var $O=this.elements,$V=$j.elements;$O[8]=-$V[0],$O[9]=-$V[1],$O[10]=-$V[2]},$z.createRotationX=function($j,$O){var $V=$O.elements,$l=Math.sin($j),$T=Math.cos($j);$V[1]=$V[2]=$V[3]=$V[4]=$V[7]=$V[8]=$V[11]=$V[12]=$V[13]=$V[14]=0,$V[0]=$V[15]=1,$V[5]=$V[10]=$T,$V[6]=$l,$V[9]=-$l},$z.createRotationY=function($j,$O){var $V=$O.elements,$l=Math.sin($j),$T=Math.cos($j);$V[1]=$V[3]=$V[4]=$V[6]=$V[7]=$V[9]=$V[11]=$V[12]=$V[13]=$V[14]=0,$V[5]=$V[15]=1,$V[0]=$V[10]=$T,$V[2]=-$l,$V[8]=$l},$z.createRotationZ=function($j,$O){var $V=$O.elements,$l=Math.sin($j),$T=Math.cos($j);$V[2]=$V[3]=$V[6]=$V[7]=$V[8]=$V[9]=$V[11]=$V[12]=$V[13]=$V[14]=0,$V[10]=$V[15]=1,$V[0]=$V[5]=$T,$V[1]=$l,$V[4]=-$l},$z.createRotationYawPitchRoll=function($j,$O,$V,$l){$VO.createFromYawPitchRoll($j,$O,$V,$z._tempQuaternion),$z.createRotationQuaternion($z._tempQuaternion,$l)},$z.createRotationAxis=function($j,$O,$V){var $l=$j.elements,$T=$l[0],$S=$l[1],$m=$l[2],$p=Math.cos($O),$o=Math.sin($O),$H=$T*$T,$g=$S*$S,$e=$m*$m,$t=$T*$S,$w=$T*$m,$s=$S*$m,$b=$V.elements;$b[3]=$b[7]=$b[11]=$b[12]=$b[13]=$b[14]=0,$b[15]=1,$b[0]=$H+$p*(1-$H),$b[1]=$t-$p*$t+$o*$m,$b[2]=$w-$p*$w-$o*$S,$b[4]=$t-$p*$t-$o*$m,$b[5]=$g+$p*(1-$g),$b[6]=$s-$p*$s+$o*$T,$b[8]=$w-$p*$w+$o*$S,$b[9]=$s-$p*$s-$o*$T,$b[10]=$e+$p*(1-$e)},$z.createRotationQuaternion=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$V[0],$S=$V[1],$m=$V[2],$p=$V[3],$o=$T*$T,$H=$S*$S,$g=$m*$m,$e=$T*$S,$t=$m*$p,$w=$m*$T,$s=$S*$p,$b=$S*$m,$r=$T*$p;$l[3]=$l[7]=$l[11]=$l[12]=$l[13]=$l[14]=0,$l[15]=1,$l[0]=1-2*($H+$g),$l[1]=2*($e+$t),$l[2]=2*($w-$s),$l[4]=2*($e-$t),$l[5]=1-2*($g+$o),$l[6]=2*($b+$r),$l[8]=2*($w+$s),$l[9]=2*($b-$r),$l[10]=1-2*($H+$o)},$z.createTranslate=function($j,$O){var $V=$j.elements,$l=$O.elements;$l[4]=$l[8]=$l[1]=$l[9]=$l[2]=$l[6]=$l[3]=$l[7]=$l[11]=0,$l[0]=$l[5]=$l[10]=$l[15]=1,$l[12]=$V[0],$l[13]=$V[1],$l[14]=$V[2]},$z.createScaling=function($j,$O){var $V=$j.elements,$l=$O.elements;$l[0]=$V[0],$l[5]=$V[1],$l[10]=$V[2],$l[1]=$l[4]=$l[8]=$l[12]=$l[9]=$l[13]=$l[2]=$l[6]=$l[14]=$l[3]=$l[7]=$l[11]=0,$l[15]=1},$z.multiply=function($j,$O,$V){var $l,$T,$S,$m,$p,$o,$H,$g;for($T=$V.elements,$S=$j.elements,$T===($m=$O.elements)&&($m=$m.slice()),$l=0;$l<4;$l++)$p=$S[$l],$o=$S[$l+4],$H=$S[$l+8],$g=$S[$l+12],$T[$l]=$p*$m[0]+$o*$m[1]+$H*$m[2]+$g*$m[3],$T[$l+4]=$p*$m[4]+$o*$m[5]+$H*$m[6]+$g*$m[7],$T[$l+8]=$p*$m[8]+$o*$m[9]+$H*$m[10]+$g*$m[11],$T[$l+12]=$p*$m[12]+$o*$m[13]+$H*$m[14]+$g*$m[15]},$z.createFromQuaternion=function($j,$O){var $V=$O.elements,$l=$j.elements,$T=$l[0],$S=$l[1],$m=$l[2],$p=$l[3],$o=$T+$T,$H=$S+$S,$g=$m+$m,$e=$T*$o,$t=$S*$o,$w=$S*$H,$s=$m*$o,$b=$m*$H,$r=$m*$g,$h=$p*$o,$a=$p*$H,$c=$p*$g;$V[0]=1-$w-$r,$V[1]=$t+$c,$V[2]=$s-$a,$V[3]=0,$V[4]=$t-$c,$V[5]=1-$e-$r,$V[6]=$b+$h,$V[7]=0,$V[8]=$s+$a,$V[9]=$b-$h,$V[10]=1-$e-$w,$V[11]=0,$V[12]=0,$V[13]=0,$V[14]=0,$V[15]=1},$z.createAffineTransformation=function($j,$O,$V,$l){var $T=$j.elements,$S=$O.elements,$m=$V.elements,$p=$l.elements,$o=$S[0],$H=$S[1],$g=$S[2],$e=$S[3],$t=$o+$o,$w=$H+$H,$s=$g+$g,$b=$o*$t,$r=$o*$w,$h=$o*$s,$a=$H*$w,$c=$H*$s,$A=$g*$s,$Z=$e*$t,$x=$e*$w,$E=$e*$s,$U=$m[0],$z=$m[1],$$=$m[2];$p[0]=(1-($a+$A))*$U,$p[1]=($r+$E)*$U,$p[2]=($h-$x)*$U,$p[3]=0,$p[4]=($r-$E)*$z,$p[5]=(1-($b+$A))*$z,$p[6]=($c+$Z)*$z,$p[7]=0,$p[8]=($h+$x)*$$,$p[9]=($c-$Z)*$$,$p[10]=(1-($b+$a))*$$,$p[11]=0,$p[12]=$T[0],$p[13]=$T[1],$p[14]=$T[2],$p[15]=1},$z.createLookAt=function($j,$O,$V,$l){var $T=$l.elements,$S=$z._tempVector0,$m=$z._tempVector1,$p=$z._tempVector2;$mO.subtract($j,$O,$p),$mO.normalize($p,$p),$mO.cross($V,$p,$S),$mO.normalize($S,$S),$mO.cross($p,$S,$m),$l.identity(),$T[0]=$S.x,$T[4]=$S.y,$T[8]=$S.z,$T[1]=$m.x,$T[5]=$m.y,$T[9]=$m.z,$T[2]=$p.x,$T[6]=$p.y,$T[10]=$p.z,$T[12]=-$mO.dot($S,$j),$T[13]=-$mO.dot($m,$j),$T[14]=-$mO.dot($p,$j)},$z.createPerspective=function($j,$O,$V,$l,$T){var $S=$T.elements,$m=1/Math.tan($j/2),$p=1/($V-$l);$S[0]=$m/$O,$S[5]=$m,$S[10]=($l+$V)*$p,$S[11]=-1,$S[14]=2*$l*$V*$p,$S[1]=$S[2]=$S[3]=$S[4]=$S[6]=$S[7]=$S[8]=$S[9]=$S[12]=$S[13]=$S[15]=0},$z.createOrthoOffCenterRH=function($j,$O,$V,$l,$T,$S,$m){var $p=$m.elements,$o=1/($j-$O),$H=1/($V-$l),$g=1/($T-$S);$p[1]=$p[2]=$p[3]=$p[4]=$p[6]=$p[7]=$p[8]=$p[9]=$p[11]=0,$p[15]=1,$p[0]=-2*$o,$p[5]=-2*$H,$p[10]=2*$g,$p[12]=($j+$O)*$o,$p[13]=($l+$V)*$H,$p[14]=($S+$T)*$g},$z.translation=function($j,$O){var $V=$j.elements,$l=$O.elements;$l[0]=$l[5]=$l[10]=$l[15]=1,$l[12]=$V[0],$l[13]=$V[1],$l[14]=$V[2]},$e($z,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $z},"_tempVector0",function(){return this._tempVector0=new $mO},"_tempVector1",function(){return this._tempVector1=new $mO},"_tempVector2",function(){return this._tempVector2=new $mO},"_tempQuaternion",function(){return this._tempQuaternion=new $VO},"DEFAULT",function(){return this.DEFAULT=new $z},"ZERO",function(){return this.ZERO=new $z(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$z}(),$OO=(function(){function $c($j,$O){this.extents=null,this.transformation=null,this.extents=$j,this.transformation=$O}$w($c,"laya.d3.math.OrientedBoundBox");var $j=$c.prototype;$j.getCorners=function($j){var $O=$c._tempV30.elements,$V=$c._tempV31.elements,$l=$c._tempV32.elements,$T=this.extents.elements;$O[0]=$T[0],$O[1]=$O[2]=0,$V[1]=$T[1],$V[0]=$V[2]=0,$l[2]=$T[2],$l[0]=$l[1]=0,$mO.TransformNormal($c._tempV30,this.transformation,$c._tempV30),$mO.TransformNormal($c._tempV31,this.transformation,$c._tempV31),$mO.TransformNormal($c._tempV32,this.transformation,$c._tempV32);var $S=$c._tempV33;this.transformation.getTranslationVector($S),$j.length=8,$mO.add($S,$c._tempV30,$c._tempV34),$mO.add($c._tempV34,$c._tempV31,$c._tempV34),$mO.add($c._tempV34,$c._tempV32,$j[0]),$mO.add($S,$c._tempV30,$c._tempV34),$mO.add($c._tempV34,$c._tempV31,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV32,$j[1]),$mO.subtract($S,$c._tempV30,$c._tempV34),$mO.add($c._tempV34,$c._tempV31,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV32,$j[2]),$mO.subtract($S,$c._tempV30,$c._tempV34),$mO.add($c._tempV34,$c._tempV31,$c._tempV34),$mO.add($c._tempV34,$c._tempV32,$j[3]),$mO.add($S,$c._tempV30,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV31,$c._tempV34),$mO.add($c._tempV34,$c._tempV32,$j[4]),$mO.add($S,$c._tempV30,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV31,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV32,$j[5]),$mO.subtract($S,$c._tempV30,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV31,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV32,$j[6]),$mO.subtract($S,$c._tempV30,$c._tempV34),$mO.subtract($c._tempV34,$c._tempV31,$c._tempV34),$mO.add($c._tempV34,$c._tempV32,$j[7])},$j.transform=function($j){$jO.multiply(this.transformation,$j,this.transformation)},$j.scale=function($j){$mO.multiply(this.extents,$j,this.extents)},$j.translate=function($j){this.transformation.getTranslationVector($c._tempV30),$mO.add($c._tempV30,$j,$c._tempV31),this.transformation.setTranslationVector($c._tempV31)},$j.Size=function($j){$mO.scale(this.extents,2,$j)},$j.getSize=function($j){var $O=this.extents.elements;$c._tempV30.x=$O[0],$c._tempV31.y=$O[1],$c._tempV32.z=$O[2],$mO.TransformNormal($c._tempV30,this.transformation,$c._tempV30),$mO.TransformNormal($c._tempV31,this.transformation,$c._tempV31),$mO.TransformNormal($c._tempV31,this.transformation,$c._tempV32);var $V=$j.elements;$V[0]=$mO.scalarLength($c._tempV30),$V[1]=$mO.scalarLength($c._tempV31),$V[2]=$mO.scalarLength($c._tempV32)},$j.getSizeSquared=function($j){var $O=this.extents.elements;$c._tempV30.x=$O[0],$c._tempV31.y=$O[1],$c._tempV32.z=$O[2],$mO.TransformNormal($c._tempV30,this.transformation,$c._tempV30),$mO.TransformNormal($c._tempV31,this.transformation,$c._tempV31),$mO.TransformNormal($c._tempV31,this.transformation,$c._tempV32);var $V=$j.elements;$V[0]=$mO.scalarLengthSquared($c._tempV30),$V[1]=$mO.scalarLengthSquared($c._tempV31),$V[2]=$mO.scalarLengthSquared($c._tempV32)},$j.getCenter=function($j){this.transformation.getTranslationVector($j)},$j.containsPoint=function($j){var $O=this.extents.elements,$V=$O[0],$l=$O[1],$T=$O[2];this.transformation.invert($c._tempM0),$mO.transformCoordinate($j,$c._tempM0,$c._tempV30);var $S=$c._tempV30.elements,$m=Math.abs($S[0]),$p=Math.abs($S[1]),$o=Math.abs($S[2]);return $Ij.nearEqual($m,$V)&&$Ij.nearEqual($p,$l)&&$Ij.nearEqual($o,$T)?2:$m<$V&&$p<$l&&$o<$T?1:0},$j.containsPoints=function($j){var $O=this.extents.elements,$V=$O[0],$l=$O[1],$T=$O[2];this.transformation.invert($c._tempM0);for(var $S=!0,$m=!1,$p=0;$p<$j.length;$p++){$mO.transformCoordinate($j[$p],$c._tempM0,$c._tempV30);var $o=$c._tempV30.elements,$H=Math.abs($o[0]),$g=Math.abs($o[1]),$e=Math.abs($o[2]);$Ij.nearEqual($H,$V)&&$Ij.nearEqual($g,$l)&&$Ij.nearEqual($e,$T)&&($m=!0),$H<$V&&$g<$l&&$e<$T?$m=!0:$S=!1}return $S?1:$m?2:0},$j.containsSphere=function($j,$O){void 0===$O&&($O=!1);var $V=this.extents.elements,$l=$V[0],$T=$V[1],$S=$V[2],$m=$j.radius;this.transformation.invert($c._tempM0),$mO.transformCoordinate($j.center,$c._tempM0,$c._tempV30);var $p=NaN;if($p=$O?$m:($mO.scale($mO.UnitX,$m,$c._tempV31),$mO.TransformNormal($c._tempV31,$c._tempM0,$c._tempV31),$mO.scalarLength($c._tempV31)),$mO.scale(this.extents,-1,$c._tempV32),$mO.Clamp($c._tempV30,$c._tempV32,this.extents,$c._tempV33),$p*$p<$mO.distanceSquared($c._tempV30,$c._tempV33))return 0;var $o=$c._tempV30.elements,$H=$o[0],$g=$o[1],$e=$o[2],$t=$c._tempV32.elements,$w=$t[0],$s=$t[1],$b=$t[2];return $w+$p<=$H&&$H<=$l-$p&&$p<$l-$w&&$s+$p<=$g&&$g<=$T-$p&&$p<$T-$s&&$b+$p<=$e&&$e<=$S-$p&&$p<$S-$b?1:2},$j.containsOrientedBoundBox=function($j){var $O=0,$V=0;$j.getCorners($c._corners);var $l=this.containsPoints($c._corners);if(0!=$l)return $l;var $T=this.extents.elements;$j.extents.cloneTo($c._tempV35);var $S=$c._tempV35.elements;$c._getRows(this.transformation,$c._rows1),$c._getRows($j.transformation,$c._rows2);var $m=NaN;for($O=0;$O<4;$O++)for($V=0;$V<4;$V++)3==$O||3==$V?($c._tempM0.setElementByRowColumn($O,$V,0),$c._tempM1.setElementByRowColumn($O,$V,0)):($m=$mO.dot($c._rows1[$O],$c._rows2[$V]),$c._tempM0.setElementByRowColumn($O,$V,$m),$c._tempM1.setElementByRowColumn($O,$V,Math.abs($m)));$j.getCenter($c._tempV34),this.getCenter($c._tempV36),$mO.subtract($c._tempV34,$c._tempV36,$c._tempV30);var $p=$c._tempV31.elements;$p[0]=$mO.dot($c._tempV30,$c._rows1[0]),$p[1]=$mO.dot($c._tempV30,$c._rows1[1]),$p[2]=$mO.dot($c._tempV30,$c._rows1[2]);var $o=$c._tempV32.elements,$H=$c._tempV33.elements;for($O=0;$O<3;$O++)if($o[0]=$c._tempM1.getElementByRowColumn($O,0),$o[1]=$c._tempM1.getElementByRowColumn($O,1),$o[2]=$c._tempM1.getElementByRowColumn($O,2),$T[$O]+$mO.dot($c._tempV35,$c._tempV32)<Math.abs($p[$O]))return 0;for($V=0;$V<3;$V++)if($o[0]=$c._tempM1.getElementByRowColumn(0,$V),$o[1]=$c._tempM1.getElementByRowColumn(1,$V),$o[2]=$c._tempM1.getElementByRowColumn(2,$V),$H[0]=$c._tempM0.getElementByRowColumn(0,$V),$H[1]=$c._tempM0.getElementByRowColumn(1,$V),$H[2]=$c._tempM0.getElementByRowColumn(2,$V),$mO.dot(this.extents,$c._tempV32)+$S[$V]<Math.abs($mO.dot($c._tempV31,$c._tempV33)))return 0;for($O=0;$O<3;$O++)for($V=0;$V<3;$V++){var $g=($O+1)%3,$e=($O+2)%3,$t=($V+1)%3,$w=($V+2)%3;if($T[$g]*$c._tempM1.getElementByRowColumn($e,$V)+$T[$e]*$c._tempM1.getElementByRowColumn($g,$V)+($S[$t]*$c._tempM1.getElementByRowColumn($O,$w)+$S[$w]*$c._tempM1.getElementByRowColumn($O,$t))<Math.abs($p[$e]*$c._tempM0.getElementByRowColumn($g,$V)-$p[$g]*$c._tempM0.getElementByRowColumn($e,$V)))return 0}return 2},$j.containsLine=function($j,$O){$c._corners[0]=$j,$c._corners[1]=$O;var $V=this.containsPoints($c._corners);if(0!=$V)return $V;var $l=this.extents.elements,$T=$l[0],$S=$l[1],$m=$l[2];this.transformation.invert($c._tempM0),$mO.transformCoordinate($j,$c._tempM0,$c._tempV30),$mO.transformCoordinate($O,$c._tempM0,$c._tempV31),$mO.add($c._tempV30,$c._tempV31,$c._tempV32),$mO.scale($c._tempV32,.5,$c._tempV32),$mO.subtract($c._tempV30,$c._tempV32,$c._tempV33);var $p=$c._tempV33.elements,$o=$p[0],$H=$p[1],$g=$p[2],$e=$c._tempV34.elements,$t=$e[0]=Math.abs($p[0]),$w=$e[1]=Math.abs($p[1]),$s=$e[2]=Math.abs($p[2]),$b=$c._tempV32.elements,$r=$b[0],$h=$b[1],$a=$b[2];return Math.abs($r)>$T+$t?0:Math.abs($h)>$S+$w?0:Math.abs($a)>$m+$s?0:Math.abs($h*$g-$a*$H)>$S*$s+$m*$w?0:Math.abs($r*$g-$a*$o)>$T*$s+$m*$t?0:Math.abs($r*$H-$h*$o)>$T*$w+$S*$t?0:2},$j.containsBoundBox=function($j){var $O=0,$V=0,$l=$j.min,$T=$j.max;$j.getCorners($c._corners);var $S=this.containsPoints($c._corners);if(0!=$S)return $S;$mO.subtract($T,$l,$c._tempV30),$mO.scale($c._tempV30,.5,$c._tempV30),$mO.add($l,$c._tempV30,$c._tempV30),$mO.subtract($T,$c._tempV30,$c._tempV31);var $m=this.extents.elements,$p=$c._tempV31.elements;$c._getRows(this.transformation,$c._rows1),this.transformation.invert($c._tempM0);for($O=0;$O<3;$O++)for($V=0;$V<3;$V++)$c._tempM1.setElementByRowColumn($O,$V,Math.abs($c._tempM0.getElementByRowColumn($O,$V)));this.getCenter($c._tempV35),$mO.subtract($c._tempV30,$c._tempV35,$c._tempV32);var $o=$c._tempV31.elements;$o[0]=$mO.dot($c._tempV32,$c._rows1[0]),$o[1]=$mO.dot($c._tempV32,$c._rows1[1]),$o[2]=$mO.dot($c._tempV32,$c._rows1[2]);var $H=$c._tempV33.elements,$g=$c._tempV34.elements;for($O=0;$O<3;$O++)if($H[0]=$c._tempM1.getElementByRowColumn($O,0),$H[1]=$c._tempM1.getElementByRowColumn($O,1),$H[2]=$c._tempM1.getElementByRowColumn($O,2),$m[$O]+$mO.dot($c._tempV31,$c._tempV33)<Math.abs($o[$O]))return 0;for($V=0;$V<3;$V++)if($H[0]=$c._tempM1.getElementByRowColumn(0,$V),$H[1]=$c._tempM1.getElementByRowColumn(1,$V),$H[2]=$c._tempM1.getElementByRowColumn(2,$V),$g[0]=$c._tempM0.getElementByRowColumn(0,$V),$g[1]=$c._tempM0.getElementByRowColumn(1,$V),$g[2]=$c._tempM0.getElementByRowColumn(2,$V),$mO.dot(this.extents,$c._tempV33)+$p[$V]<Math.abs($mO.dot($c._tempV31,$c._tempV34)))return 0;for($O=0;$O<3;$O++)for($V=0;$V<3;$V++){var $e=($O+1)%3,$t=($O+2)%3,$w=($V+1)%3,$s=($V+2)%3;if($m[$e]*$c._tempM1.getElementByRowColumn($t,$V)+$m[$t]*$c._tempM1.getElementByRowColumn($e,$V)+($p[$w]*$c._tempM1.getElementByRowColumn($O,$s)+$p[$s]*$c._tempM1.getElementByRowColumn($O,$w))<Math.abs($o[$t]*$c._tempM0.getElementByRowColumn($e,$V)-$o[$e]*$c._tempM0.getElementByRowColumn($t,$V)))return 0}return 2},$j.intersectsRay=function($j,$O){$mO.scale(this.extents,-1,$c._tempV30),this.transformation.invert($c._tempM0),$mO.TransformNormal($j.direction,$c._tempM0,$c._ray.direction),$mO.transformCoordinate($j.origin,$c._tempM0,$c._ray.origin),$c._boxBound1.min=$c._tempV30,$c._boxBound1.max=this.extents;var $V=Collision.intersectsRayAndBoxRP($c._ray,$c._boxBound1,$O);return-1!==$V&&$mO.transformCoordinate($O,this.transformation,$O),$V},$j._getLocalCorners=function($j){$j.length=8;var $O=this.extents.elements;$c._tempV30.x=$O[0],$c._tempV31.y=$O[1],$c._tempV32.z=$O[2],$mO.add($c._tempV30,$c._tempV31,$c._tempV33),$mO.add($c._tempV33,$c._tempV32,$j[0]),$mO.add($c._tempV30,$c._tempV31,$c._tempV33),$mO.subtract($c._tempV33,$c._tempV32,$j[1]),$mO.subtract($c._tempV31,$c._tempV30,$c._tempV33),$mO.subtract($c._tempV33,$c._tempV30,$j[2]),$mO.subtract($c._tempV31,$c._tempV30,$c._tempV33),$mO.add($c._tempV33,$c._tempV32,$j[3]),$mO.subtract($c._tempV30,$c._tempV31,$c._tempV33),$mO.add($c._tempV33,$c._tempV32,$j[4]),$mO.subtract($c._tempV30,$c._tempV31,$c._tempV33),$mO.subtract($c._tempV33,$c._tempV32,$j[5]),$mO.scale($j[0],-1,$j[6]),$mO.subtract($c._tempV32,$c._tempV30,$c._tempV33),$mO.subtract($c._tempV33,$c._tempV31,$j[7])},$j.equals=function($j){return this.extents==$j.extents&&this.transformation==$j.transformation},$j.cloneTo=function($j){var $O=$j;this.extents.cloneTo($O.extents),this.transformation.cloneTo($O.transformation)},$c.createByBoundBox=function($j,$O){var $V=$j.min,$l=$j.max;$mO.subtract($l,$V,$c._tempV30),$mO.scale($c._tempV30,.5,$c._tempV30),$mO.add($V,$c._tempV30,$c._tempV31),$mO.subtract($l,$c._tempV31,$c._tempV32),$jO.translation($c._tempV31,$c._tempM0);var $T=$c._tempV32.clone(),$S=$c._tempM0.clone();$O.extents=$T,$O.transformation=$S},$c.createByMinAndMaxVertex=function($j,$O){return $mO.subtract($O,$j,$c._tempV30),$mO.scale($c._tempV30,.5,$c._tempV30),$mO.add($j,$c._tempV30,$c._tempV31),$mO.subtract($O,$c._tempV31,$c._tempV32),$jO.translation($c._tempV31,$c._tempM0),new $c($c._tempV32,$c._tempM0)},$c._getRows=function($j,$O){$O.length=3;var $V=$j.elements,$l=$O[0].elements;$l[0]=$V[0],$l[1]=$V[1],$l[2]=$V[2];var $T=$O[1].elements;$T[0]=$V[4],$T[1]=$V[5],$T[2]=$V[6];var $S=$O[2].elements;$S[0]=$V[8],$S[1]=$V[9],$S[2]=$V[10]},$c.getObbtoObbMatrix4x4=function($j,$O,$V,$l){var $T=$j.transformation,$S=$O.transformation;if($V){$c._getRows($T,$c._rows1),$c._getRows($S,$c._rows2);for(var $m=0;$m<3;$m++)for(var $p=0;$p<3;$p++)$l.setElementByRowColumn($m,$p,$mO.dot($c._rows2[$m],$c._rows1[$p]));$O.getCenter($c._tempV30),$j.getCenter($c._tempV31),$mO.subtract($c._tempV30,$c._tempV31,$c._tempV32);var $o=$l.elements;$o[12]=$mO.dot($c._tempV32,$c._rows1[0]),$o[13]=$mO.dot($c._tempV32,$c._rows1[1]),$o[14]=$mO.dot($c._tempV32,$c._rows1[2]),$o[15]=1}else $T.invert($c._tempM0),$jO.multiply($S,$c._tempM0,$l)},$c.merge=function($j,$O,$V){var $l=$j.extents,$T=$j.transformation;$c.getObbtoObbMatrix4x4($j,$O,$V,$c._tempM0),$O._getLocalCorners($c._corners),$mO.transformCoordinate($c._corners[0],$c._tempM0,$c._corners[0]),$mO.transformCoordinate($c._corners[1],$c._tempM0,$c._corners[1]),$mO.transformCoordinate($c._corners[2],$c._tempM0,$c._corners[2]),$mO.transformCoordinate($c._corners[3],$c._tempM0,$c._corners[3]),$mO.transformCoordinate($c._corners[4],$c._tempM0,$c._corners[4]),$mO.transformCoordinate($c._corners[5],$c._tempM0,$c._corners[5]),$mO.transformCoordinate($c._corners[6],$c._tempM0,$c._corners[6]),$mO.transformCoordinate($c._corners[7],$c._tempM0,$c._corners[7]),$mO.scale($l,-1,$c._boxBound1.min),$l.cloneTo($c._boxBound1.max),$Lj.createfromPoints($c._corners,$c._boxBound2),$Lj.merge($c._boxBound2,$c._boxBound1,$c._boxBound3);var $S=$c._boxBound3.min,$m=$c._boxBound3.max;$mO.subtract($m,$S,$c._tempV30),$mO.scale($c._tempV30,.5,$c._tempV30),$mO.add($S,$c._tempV30,$c._tempV32),$mO.subtract($m,$c._tempV32,$l),$mO.transformCoordinate($c._tempV32,$T,$c._tempV33)},$e($c,["_tempV30",function(){return this._tempV30=new $mO},"_tempV31",function(){return this._tempV31=new $mO},"_tempV32",function(){return this._tempV32=new $mO},"_tempV33",function(){return this._tempV33=new $mO},"_tempV34",function(){return this._tempV34=new $mO},"_tempV35",function(){return this._tempV35=new $mO},"_tempV36",function(){return this._tempV36=new $mO},"_tempM0",function(){return this._tempM0=new $jO},"_tempM1",function(){return this._tempM1=new $jO},"_corners",function(){return this._corners=[new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO]},"_rows1",function(){return this._rows1=[new $mO,new $mO,new $mO]},"_rows2",function(){return this._rows2=[new $mO,new $mO,new $mO]},"_ray",function(){return this._ray=new $TO(new $mO,new $mO)},"_boxBound1",function(){return this._boxBound1=new $Lj(new $mO,new $mO)},"_boxBound2",function(){return this._boxBound2=new $Lj(new $mO,new $mO)},"_boxBound3",function(){return this._boxBound3=new $Lj(new $mO,new $mO)}])}(),function(){function $Z($j,$O){this.normal=null,this.distance=NaN,void 0===$O&&($O=0),this.normal=$j,this.distance=$O}return $w($Z,"laya.d3.math.Plane"),$Z.prototype.normalize=function(){var $j=this.normal.elements,$O=$j[0],$V=$j[1],$l=$j[2],$T=1/Math.sqrt($O*$O+$V*$V+$l*$l);$j[0]=$O*$T,$j[1]=$V*$T,$j[2]=$l*$T,this.distance*=$T},$Z.createPlaneBy3P=function($j,$O,$V){var $l=$j.elements,$T=$O.elements,$S=$V.elements,$m=$T[0]-$l[0],$p=$T[1]-$l[1],$o=$T[2]-$l[2],$H=$S[0]-$l[0],$g=$S[1]-$l[1],$e=$S[2]-$l[2],$t=$p*$e-$o*$g,$w=$o*$H-$m*$e,$s=$m*$g-$p*$H,$b=1/Math.sqrt($t*$t+$w*$w+$s*$s),$r=$t*$b,$h=$w*$b,$a=$s*$b,$c=$Z._TEMPVec3.elements;$c[0]=$r,$c[1]=$h,$c[2]=$a;var $A=-($r*$l[0]+$h*$l[1]+$a*$l[2]);return new $Z($Z._TEMPVec3,$A)},$Z.PlaneIntersectionType_Back=0,$Z.PlaneIntersectionType_Front=1,$Z.PlaneIntersectionType_Intersecting=2,$e($Z,["_TEMPVec3",function(){return this._TEMPVec3=new $mO}]),$Z}()),$VO=function(){function $T($j,$O,$V,$l){this.elements=new Float32Array(4),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=1),this.elements[0]=$j,this.elements[1]=$O,this.elements[2]=$V,this.elements[3]=$l}$w($T,"laya.d3.math.Quaternion");var $j=$T.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.scaling=function($j,$O){var $V=$O.elements,$l=this.elements;$V[0]=$l[0]*$j,$V[1]=$l[1]*$j,$V[2]=$l[2]*$j,$V[3]=$l[3]*$j},$j.normalize=function($j){var $O=$j.elements,$V=this.elements,$l=$V[0],$T=$V[1],$S=$V[2],$m=$V[3],$p=$l*$l+$T*$T+$S*$S+$m*$m;0<$p&&($p=1/Math.sqrt($p),$O[0]=$l*$p,$O[1]=$T*$p,$O[2]=$S*$p,$O[3]=$m*$p)},$j.length=function(){var $j=this.elements,$O=$j[0],$V=$j[1],$l=$j[2],$T=$j[3];return Math.sqrt($O*$O+$V*$V+$l*$l+$T*$T)},$j.rotateX=function($j,$O){var $V=$O.elements,$l=this.elements;$j*=.5;var $T=$l[0],$S=$l[1],$m=$l[2],$p=$l[3],$o=Math.sin($j),$H=Math.cos($j);$V[0]=$T*$H+$p*$o,$V[1]=$S*$H+$m*$o,$V[2]=$m*$H-$S*$o,$V[3]=$p*$H-$T*$o},$j.rotateY=function($j,$O){var $V=$O.elements,$l=this.elements;$j*=.5;var $T=$l[0],$S=$l[1],$m=$l[2],$p=$l[3],$o=Math.sin($j),$H=Math.cos($j);$V[0]=$T*$H-$m*$o,$V[1]=$S*$H+$p*$o,$V[2]=$m*$H+$T*$o,$V[3]=$p*$H-$S*$o},$j.rotateZ=function($j,$O){var $V=$O.elements,$l=this.elements;$j*=.5;var $T=$l[0],$S=$l[1],$m=$l[2],$p=$l[3],$o=Math.sin($j),$H=Math.cos($j);$V[0]=$T*$H+$S*$o,$V[1]=$S*$H-$T*$o,$V[2]=$m*$H+$p*$o,$V[3]=$p*$H-$m*$o},$j.getYawPitchRoll=function($j){$mO.transformQuat($mO.ForwardRH,this,$T.TEMPVector31),$mO.transformQuat($mO.Up,this,$T.TEMPVector32);var $O=$T.TEMPVector32.elements;$T.angleTo($mO.ZERO,$T.TEMPVector31,$T.TEMPVector33);var $V=$T.TEMPVector33.elements;$V[0]==Math.PI/2?($V[1]=$T.arcTanAngle($O[2],$O[0]),$V[2]=0):$V[0]==-Math.PI/2?($V[1]=$T.arcTanAngle(-$O[2],-$O[0]),$V[2]=0):($jO.createRotationY(-$V[1],$T.TEMPMatrix0),$jO.createRotationX(-$V[0],$T.TEMPMatrix1),$mO.transformCoordinate($T.TEMPVector32,$T.TEMPMatrix0,$T.TEMPVector32),$mO.transformCoordinate($T.TEMPVector32,$T.TEMPMatrix1,$T.TEMPVector32),$V[2]=$T.arcTanAngle($O[1],-$O[0])),$V[1]<=-Math.PI&&($V[1]=Math.PI),$V[2]<=-Math.PI&&($V[2]=Math.PI),$V[1]>=Math.PI&&$V[2]>=Math.PI&&($V[1]=0,$V[2]=0,$V[0]=Math.PI-$V[0]);var $l=$j.elements;$l[0]=$V[1],$l[1]=$V[0],$l[2]=$V[2]},$j.invert=function($j){var $O=$j.elements,$V=this.elements,$l=$V[0],$T=$V[1],$S=$V[2],$m=$V[3],$p=$l*$l+$T*$T+$S*$S+$m*$m,$o=$p?1/$p:0;$O[0]=-$l*$o,$O[1]=-$T*$o,$O[2]=-$S*$o,$O[3]=$m*$o},$j.identity=function(){var $j=this.elements;$j[0]=0,$j[1]=0,$j[2]=0,$j[3]=1},$j.fromArray=function($j,$O){void 0===$O&&($O=0),this.elements[0]=$j[$O+0],this.elements[1]=$j[$O+1],this.elements[2]=$j[$O+2],this.elements[3]=$j[$O+3]},$j.cloneTo=function($j){var $O,$V,$l;if(($V=this.elements)!==($l=$j.elements))for($O=0;$O<4;++$O)$l[$O]=$V[$O]},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$j.equals=function($j){var $O=this.elements,$V=$j.elements;return $Ij.nearEqual($O[0],$V[0])&&$Ij.nearEqual($O[1],$V[1])&&$Ij.nearEqual($O[2],$V[2])&&$Ij.nearEqual($O[3],$V[3])},$j.lengthSquared=function(){var $j=this.elements[0],$O=this.elements[1],$V=this.elements[2],$l=this.elements[3];return $j*$j+$O*$O+$V*$V+$l*$l},$s(0,$j,"x",function(){return this.elements[0]}),$s(0,$j,"y",function(){return this.elements[1]}),$s(0,$j,"z",function(){return this.elements[2]}),$s(0,$j,"w",function(){return this.elements[3]}),$T.createFromYawPitchRoll=function($j,$O,$V,$l){var $T=.5*$V,$S=.5*$O,$m=.5*$j,$p=Math.sin($T),$o=Math.cos($T),$H=Math.sin($S),$g=Math.cos($S),$e=Math.sin($m),$t=Math.cos($m),$w=$l.elements;$w[0]=$t*$H*$o+$e*$g*$p,$w[1]=$e*$g*$o-$t*$H*$p,$w[2]=$t*$g*$p-$e*$H*$o,$w[3]=$t*$g*$o+$e*$H*$p},$T.multiply=function($j,$O,$V){var $l=$j.elements,$T=$O.elements,$S=$V.elements,$m=$l[0],$p=$l[1],$o=$l[2],$H=$l[3],$g=$T[0],$e=$T[1],$t=$T[2],$w=$T[3],$s=$p*$t-$o*$e,$b=$o*$g-$m*$t,$r=$m*$e-$p*$g,$h=$m*$g+$p*$e+$o*$t;$S[0]=$m*$w+$g*$H+$s,$S[1]=$p*$w+$e*$H+$b,$S[2]=$o*$w+$t*$H+$r,$S[3]=$H*$w-$h},$T.arcTanAngle=function($j,$O){return 0==$j?1==$O?Math.PI/2:-Math.PI/2:0<$j?Math.atan($O/$j):$j<0?0<$O?Math.atan($O/$j)+Math.PI:Math.atan($O/$j)-Math.PI:0},$T.angleTo=function($j,$O,$V){$mO.subtract($O,$j,$T.TEMPVector30),$mO.normalize($T.TEMPVector30,$T.TEMPVector30),$V.elements[0]=Math.asin($T.TEMPVector30.y),$V.elements[1]=$T.arcTanAngle(-$T.TEMPVector30.z,-$T.TEMPVector30.x)},$T.createFromAxisAngle=function($j,$O,$V){var $l=$V.elements,$T=$j.elements;$O*=.5;var $S=Math.sin($O);$l[0]=$S*$T[0],$l[1]=$S*$T[1],$l[2]=$S*$T[2],$l[3]=Math.cos($O)},$T.createFromMatrix3x3=function($j,$O){var $V,$l=$O.elements,$T=$j.elements,$S=$T[0]+$T[4]+$T[8];if(0<$S)$V=Math.sqrt($S+1),$l[3]=.5*$V,$V=.5/$V,$l[0]=($T[5]-$T[7])*$V,$l[1]=($T[6]-$T[2])*$V,$l[2]=($T[1]-$T[3])*$V;else{var $m=0;$T[4]>$T[0]&&($m=1),$T[8]>$T[3*$m+$m]&&($m=2);var $p=($m+1)%3,$o=($m+2)%3;$V=Math.sqrt($T[3*$m+$m]-$T[3*$p+$p]-$T[3*$o+$o]+1),$l[$m]=.5*$V,$V=.5/$V,$l[3]=($T[3*$p+$o]-$T[3*$o+$p])*$V,$l[$p]=($T[3*$p+$m]+$T[3*$m+$p])*$V,$l[$o]=($T[3*$o+$m]+$T[3*$m+$o])*$V}},$T.createFromMatrix4x4=function($j,$O){var $V,$l,$T=$j.elements,$S=$O.elements,$m=$T[0]+$T[5]+$T[10];0<$m?($V=Math.sqrt($m+1),$S[3]=.5*$V,$V=.5/$V,$S[0]=($T[6]-$T[9])*$V,$S[1]=($T[8]-$T[2])*$V,$S[2]=($T[1]-$T[4])*$V):$T[0]>=$T[5]&&$T[0]>=$T[10]?($l=.5/($V=Math.sqrt(1+$T[0]-$T[5]-$T[10])),$S[0]=.5*$V,$S[1]=($T[1]+$T[4])*$l,$S[2]=($T[2]+$T[8])*$l,$S[3]=($T[6]-$T[9])*$l):$T[5]>$T[10]?($l=.5/($V=Math.sqrt(1+$T[5]-$T[0]-$T[10])),$S[0]=($T[4]+$T[1])*$l,$S[1]=.5*$V,$S[2]=($T[9]+$T[6])*$l,$S[3]=($T[8]-$T[2])*$l):($l=.5/($V=Math.sqrt(1+$T[10]-$T[0]-$T[5])),$S[0]=($T[8]+$T[2])*$l,$S[1]=($T[9]+$T[6])*$l,$S[2]=.5*$V,$S[3]=($T[1]-$T[4])*$l)},$T.slerp=function($j,$O,$V,$l){var $T,$S,$m,$p,$o,$H=$j.elements,$g=$O.elements,$e=$l.elements,$t=$H[0],$w=$H[1],$s=$H[2],$b=$H[3],$r=$g[0],$h=$g[1],$a=$g[2],$c=$g[3];return($S=$t*$r+$w*$h+$s*$a+$b*$c)<0&&($S=-$S,$r=-$r,$h=-$h,$a=-$a,$c=-$c),$o=1e-6<1-$S?($T=Math.acos($S),$m=Math.sin($T),$p=Math.sin((1-$V)*$T)/$m,Math.sin($V*$T)/$m):($p=1-$V,$V),$e[0]=$p*$t+$o*$r,$e[1]=$p*$w+$o*$h,$e[2]=$p*$s+$o*$a,$e[3]=$p*$b+$o*$c,$e},$T.lerp=function($j,$O,$V,$l){var $T=$l.elements,$S=$j.elements,$m=$O.elements,$p=$S[0],$o=$S[1],$H=$S[2],$g=$S[3];$T[0]=$p+$V*($m[0]-$p),$T[1]=$o+$V*($m[1]-$o),$T[2]=$H+$V*($m[2]-$H),$T[3]=$g+$V*($m[3]-$g)},$T.add=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]+$S[0],$l[1]=$T[1]+$S[1],$l[2]=$T[2]+$S[2],$l[3]=$T[3]+$S[3]},$T.dot=function($j,$O){var $V=$j.elements,$l=$O.elements;return $V[0]*$l[0]+$V[1]*$l[1]+$V[2]*$l[2]+$V[3]*$l[3]},$T.rotationLookAt=function($j,$O,$V){$T.lookAt($mO.ZERO,$j,$O,$V)},$T.lookAt=function($j,$O,$V,$l){$Pj.lookAt($j,$O,$V,$T._tempMatrix3x3),$T.rotationMatrix($T._tempMatrix3x3,$l)},$T.invert=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$j.lengthSquared();$Ij.isZero($T)||($T=1/$T,$l[0]=-$V[0]*$T,$l[1]=-$V[1]*$T,$l[2]=-$V[2]*$T,$l[3]=$V[3]*$T)},$T.rotationMatrix=function($j,$O){var $V=$j.elements,$l=$V[0],$T=$V[1],$S=$V[2],$m=$V[3],$p=$V[4],$o=$V[5],$H=$V[6],$g=$V[7],$e=$V[8],$t=$O.elements,$w=NaN,$s=NaN,$b=$l+$p+$e;0<$b?($w=Math.sqrt($b+1),$t[3]=.5*$w,$w=.5/$w,$t[0]=($o-$g)*$w,$t[1]=($H-$S)*$w,$t[2]=($T-$m)*$w):$p<=$l&&$e<=$l?($s=.5/($w=Math.sqrt(1+$l-$p-$e)),$t[0]=.5*$w,$t[1]=($T+$m)*$s,$t[2]=($S+$H)*$s,$t[3]=($o-$g)*$s):$e<$p?($s=.5/($w=Math.sqrt(1+$p-$l-$e)),$t[0]=($m+$T)*$s,$t[1]=.5*$w,$t[2]=($g+$o)*$s,$t[3]=($H-$S)*$s):($s=.5/($w=Math.sqrt(1+$e-$l-$p)),$t[0]=($H+$S)*$s,$t[1]=($g+$o)*$s,$t[2]=.5*$w,$t[3]=($T-$m)*$s)},$T.DEFAULT=new $T,$e($T,["TEMPVector30",function(){return this.TEMPVector30=new $mO},"TEMPVector31",function(){return this.TEMPVector31=new $mO},"TEMPVector32",function(){return this.TEMPVector32=new $mO},"TEMPVector33",function(){return this.TEMPVector33=new $mO},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $jO},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $jO},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $Pj},"NAN",function(){return this.NAN=new $T(NaN,NaN,NaN,NaN)}]),$T}(),$lO=function(){function $j($j){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$j,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$w($j,"laya.d3.math.Rand");var $O=$j.prototype;return $O.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$O.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$O.getSignedFloat=function(){return 2*this.getFloat()-1},$s(0,$O,"seed",function(){return this.seeds[0]},function($j){this.seeds[0]=$j,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$j.getFloatFromInt=function($j){return 1/8388607*(8388607&$j)},$j.getByteFromInt=function($j){return(8388607&$j)>>>15},$j}(),$TO=(function(){function $T($j){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($j instanceof Array)||4!==$j.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$j[0],this._state0L=0|$j[1],this._state1U=0|$j[2],this._state1L=0|$j[3]}$w($T,"laya.d3.math.RandX");var $j=$T.prototype;$j.randomint=function(){var $j=this._state0U,$O=this._state0L,$V=this._state1U,$l=this._state1L,$T=($l>>>0)+($O>>>0),$S=$V+$j+($T/2>>>31)>>>0,$m=$T>>>0,$p=0,$o=0;$p=($j^=$p=$j<<23|(-512&$O)>>>9)^(this._state0U=$V),$o=($O^=$o=$O<<23)^(this._state0L=$l);$p^=$j>>>18,$o^=$O>>>18|(262143&$j)<<14;return $p^=$V>>>5,$o^=$l>>>5|(31&$V)<<27,this._state1U=$p,this._state1L=$o,[$S,$m]},$j.random=function(){var $j=this.randomint(),$O=$j[0],$V=1023<<20|$O>>>12,$l=0|($j[1]>>>12|(4095&$O)<<20);return $T._CONVERTION_BUFFER.setUint32(0,$V,!1),$T._CONVERTION_BUFFER.setUint32(4,$l,!1),$lO._CONVERTION_BUFFER.getFloat64(0,!1)-1},$e($T,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $lO([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $j($j,$O){this.origin=null,this.direction=null,this.origin=$j,this.direction=$O}return $w($j,"laya.d3.math.Ray"),$j}()),$SO=function(){function $j($j,$O){this.elements=new Float32Array(2),void 0===$j&&($j=0),void 0===$O&&($O=0);var $V=this.elements;$V[0]=$j,$V[1]=$O}$w($j,"laya.d3.math.Vector2");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.core.IClone":!0}),$O.fromArray=function($j,$O){void 0===$O&&($O=0),this.elements[0]=$j[$O+0],this.elements[1]=$j[$O+1]},$O.cloneTo=function($j){var $O=$j.elements,$V=this.elements;$O[0]=$V[0],$O[1]=$V[1]},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"x",function(){return this.elements[0]},function($j){this.elements[0]=$j}),$s(0,$O,"y",function(){return this.elements[1]},function($j){this.elements[1]=$j}),$j.scale=function($j,$O,$V){var $l=$V.elements,$T=$j.elements;$l[0]=$T[0]*$O,$l[1]=$T[1]*$O},$e($j,["ZERO",function(){return this.ZERO=new $j(0,0)},"ONE",function(){return this.ONE=new $j(1,1)}]),$j}(),$mO=function(){function $g($j,$O,$V){this.elements=new Float32Array(3),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0);var $l=this.elements;$l[0]=$j,$l[1]=$O,$l[2]=$V}$w($g,"laya.d3.math.Vector3");var $j=$g.prototype;return $Z.imps($j,{"laya.d3.core.IClone":!0}),$j.fromArray=function($j,$O){void 0===$O&&($O=0),this.elements[0]=$j[$O+0],this.elements[1]=$j[$O+1],this.elements[2]=$j[$O+2]},$j.cloneTo=function($j){var $O=$j.elements,$V=this.elements;$O[0]=$V[0],$O[1]=$V[1],$O[2]=$V[2]},$j.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$j.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$j.reset=function($j,$O,$V){this.elements[0]=$j,this.elements[1]=$O,this.elements[2]=$V},$s(0,$j,"x",function(){return this.elements[0]},function($j){this.elements[0]=$j}),$s(0,$j,"y",function(){return this.elements[1]},function($j){this.elements[1]=$j}),$s(0,$j,"z",function(){return this.elements[2]},function($j){this.elements[2]=$j}),$g.distanceSquared=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$V[0]-$l[0],$S=$V[1]-$l[1],$m=$V[2]-$l[2];return $T*$T+$S*$S+$m*$m},$g.distance=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$V[0]-$l[0],$S=$V[1]-$l[1],$m=$V[2]-$l[2];return Math.sqrt($T*$T+$S*$S+$m*$m)},$g.min=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=Math.min($T[0],$S[0]),$l[1]=Math.min($T[1],$S[1]),$l[2]=Math.min($T[2],$S[2])},$g.max=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=Math.max($T[0],$S[0]),$l[1]=Math.max($T[1],$S[1]),$l[2]=Math.max($T[2],$S[2])},$g.transformQuat=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements,$m=$T[0],$p=$T[1],$o=$T[2],$H=$S[0],$g=$S[1],$e=$S[2],$t=$S[3],$w=$t*$m+$g*$o-$e*$p,$s=$t*$p+$e*$m-$H*$o,$b=$t*$o+$H*$p-$g*$m,$r=-$H*$m-$g*$p-$e*$o;$l[0]=$w*$t+$r*-$H+$s*-$e-$b*-$g,$l[1]=$s*$t+$r*-$g+$b*-$H-$w*-$e,$l[2]=$b*$t+$r*-$e+$w*-$g-$s*-$H},$g.scalarLength=function($j){var $O=$j.elements,$V=$O[0],$l=$O[1],$T=$O[2];return Math.sqrt($V*$V+$l*$l+$T*$T)},$g.scalarLengthSquared=function($j){var $O=$j.elements,$V=$O[0],$l=$O[1],$T=$O[2];return $V*$V+$l*$l+$T*$T},$g.normalize=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$V[0],$S=$V[1],$m=$V[2],$p=$T*$T+$S*$S+$m*$m;0<$p&&($p=1/Math.sqrt($p),$l[0]=$V[0]*$p,$l[1]=$V[1]*$p,$l[2]=$V[2]*$p)},$g.multiply=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]*$S[0],$l[1]=$T[1]*$S[1],$l[2]=$T[2]*$S[2]},$g.scale=function($j,$O,$V){var $l=$V.elements,$T=$j.elements;$l[0]=$T[0]*$O,$l[1]=$T[1]*$O,$l[2]=$T[2]*$O},$g.lerp=function($j,$O,$V,$l){var $T=$l.elements,$S=$j.elements,$m=$O.elements,$p=$S[0],$o=$S[1],$H=$S[2];$T[0]=$p+$V*($m[0]-$p),$T[1]=$o+$V*($m[1]-$o),$T[2]=$H+$V*($m[2]-$H)},$g.transformV3ToV3=function($j,$O,$V){var $l=$g._tempVector4;$g.transformV3ToV4($j,$O,$l);var $T=$l.elements,$S=$V.elements;$S[0]=$T[0],$S[1]=$T[1],$S[2]=$T[2]},$g.transformV3ToV4=function($j,$O,$V){var $l=$j.elements,$T=$l[0],$S=$l[1],$m=$l[2],$p=$O.elements,$o=$V.elements;$o[0]=$T*$p[0]+$S*$p[4]+$m*$p[8]+$p[12],$o[1]=$T*$p[1]+$S*$p[5]+$m*$p[9]+$p[13],$o[2]=$T*$p[2]+$S*$p[6]+$m*$p[10]+$p[14],$o[3]=$T*$p[3]+$S*$p[7]+$m*$p[11]+$p[15]},$g.TransformNormal=function($j,$O,$V){var $l=$j.elements,$T=$l[0],$S=$l[1],$m=$l[2],$p=$O.elements,$o=$V.elements;$o[0]=$T*$p[0]+$S*$p[4]+$m*$p[8],$o[1]=$T*$p[1]+$S*$p[5]+$m*$p[9],$o[2]=$T*$p[2]+$S*$p[6]+$m*$p[10]},$g.transformCoordinate=function($j,$O,$V){var $l=$g._tempVector4.elements,$T=$j.elements,$S=$T[0],$m=$T[1],$p=$T[2],$o=$O.elements;$l[0]=$S*$o[0]+$m*$o[4]+$p*$o[8]+$o[12],$l[1]=$S*$o[1]+$m*$o[5]+$p*$o[9]+$o[13],$l[2]=$S*$o[2]+$m*$o[6]+$p*$o[10]+$o[14],$l[3]=1/($S*$o[3]+$m*$o[7]+$p*$o[11]+$o[15]);var $H=$V.elements;$H[0]=$l[0]*$l[3],$H[1]=$l[1]*$l[3],$H[2]=$l[2]*$l[3]},$g.Clamp=function($j,$O,$V,$l){var $T=$j.elements,$S=$T[0],$m=$T[1],$p=$T[2],$o=$O.elements,$H=$o[0],$g=$o[1],$e=$o[2],$t=$V.elements,$w=$t[0],$s=$t[1],$b=$t[2],$r=$l.elements;$S=($S=$w<$S?$w:$S)<$H?$H:$S,$m=($m=$s<$m?$s:$m)<$g?$g:$m,$p=($p=$b<$p?$b:$p)<$e?$e:$p,$r[0]=$S,$r[1]=$m,$r[2]=$p},$g.add=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]+$S[0],$l[1]=$T[1]+$S[1],$l[2]=$T[2]+$S[2]},$g.subtract=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]-$S[0],$l[1]=$T[1]-$S[1],$l[2]=$T[2]-$S[2]},$g.cross=function($j,$O,$V){var $l=$j.elements,$T=$O.elements,$S=$V.elements,$m=$l[0],$p=$l[1],$o=$l[2],$H=$T[0],$g=$T[1],$e=$T[2];$S[0]=$p*$e-$o*$g,$S[1]=$o*$H-$m*$e,$S[2]=$m*$g-$p*$H},$g.dot=function($j,$O){var $V=$j.elements,$l=$O.elements;return $V[0]*$l[0]+$V[1]*$l[1]+$V[2]*$l[2]},$g.equals=function($j,$O){var $V=$j.elements,$l=$O.elements;return $Ij.nearEqual(Math.abs($V[0]),Math.abs($l[0]))&&$Ij.nearEqual(Math.abs($V[1]),Math.abs($l[1]))&&$Ij.nearEqual(Math.abs($V[2]),Math.abs($l[2]))},$g.ZERO=new $g(0,0,0),$g.ONE=new $g(1,1,1),$g.NegativeUnitX=new $g(-1,0,0),$g.UnitX=new $g(1,0,0),$g.UnitY=new $g(0,1,0),$g.UnitZ=new $g(0,0,1),$g.ForwardRH=new $g(0,0,-1),$g.ForwardLH=new $g(0,0,1),$g.Up=new $g(0,1,0),$g.NAN=new $g(NaN,NaN,NaN),$e($g,["_tempVector4",function(){return this._tempVector4=new $pO}]),$g}(),$pO=function(){function $j($j,$O,$V,$l){this.elements=new Float32Array(4),void 0===$j&&($j=0),void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=0);var $T=this.elements;$T[0]=$j,$T[1]=$O,$T[2]=$V,$T[3]=$l}$w($j,"laya.d3.math.Vector4");var $O=$j.prototype;return $Z.imps($O,{"laya.d3.core.IClone":!0}),$O.fromArray=function($j,$O){void 0===$O&&($O=0),this.elements[0]=$j[$O+0],this.elements[1]=$j[$O+1],this.elements[2]=$j[$O+2],this.elements[3]=$j[$O+3]},$O.cloneTo=function($j){var $O=$j.elements,$V=this.elements;$O[0]=$V[0],$O[1]=$V[1],$O[2]=$V[2],$O[3]=$V[3]},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$O.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$O.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$s(0,$O,"x",function(){return this.elements[0]},function($j){this.elements[0]=$j}),$s(0,$O,"y",function(){return this.elements[1]},function($j){this.elements[1]=$j}),$s(0,$O,"z",function(){return this.elements[2]},function($j){this.elements[2]=$j}),$s(0,$O,"w",function(){return this.elements[3]},function($j){this.elements[3]=$j}),$j.lerp=function($j,$O,$V,$l){var $T=$l.elements,$S=$j.elements,$m=$O.elements,$p=$S[0],$o=$S[1],$H=$S[2],$g=$S[3];$T[0]=$p+$V*($m[0]-$p),$T[1]=$o+$V*($m[1]-$o),$T[2]=$H+$V*($m[2]-$H),$T[3]=$g+$V*($m[3]-$g)},$j.transformByM4x4=function($j,$O,$V){var $l=$j.elements,$T=$l[0],$S=$l[1],$m=$l[2],$p=$l[3],$o=$O.elements,$H=$V.elements;$H[0]=$T*$o[0]+$S*$o[4]+$m*$o[8]+$p*$o[12],$H[1]=$T*$o[1]+$S*$o[5]+$m*$o[9]+$p*$o[13],$H[2]=$T*$o[2]+$S*$o[6]+$m*$o[10]+$p*$o[14],$H[3]=$T*$o[3]+$S*$o[7]+$m*$o[11]+$p*$o[15]},$j.equals=function($j,$O){var $V=$j.elements,$l=$O.elements;return $Ij.nearEqual(Math.abs($V[0]),Math.abs($l[0]))&&$Ij.nearEqual(Math.abs($V[1]),Math.abs($l[1]))&&$Ij.nearEqual(Math.abs($V[2]),Math.abs($l[2]))&&$Ij.nearEqual(Math.abs($V[3]),Math.abs($l[3]))},$j.normalize=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$j.length();0<$T&&($l[0]=$V[0]*$T,$l[1]=$V[1]*$T,$l[2]=$V[2]*$T,$l[3]=$V[3]*$T)},$j.add=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]+$S[0],$l[1]=$T[1]+$S[1],$l[2]=$T[2]+$S[2],$l[3]=$T[3]+$S[3]},$j.subtract=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]-$S[0],$l[1]=$T[1]-$S[1],$l[2]=$T[2]-$S[2],$l[3]=$T[3]-$S[3]},$j.multiply=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=$T[0]*$S[0],$l[1]=$T[1]*$S[1],$l[2]=$T[2]*$S[2],$l[3]=$T[3]*$S[3]},$j.scale=function($j,$O,$V){var $l=$V.elements,$T=$j.elements;$l[0]=$T[0]*$O,$l[1]=$T[1]*$O,$l[2]=$T[2]*$O,$l[3]=$T[3]*$O},$j.Clamp=function($j,$O,$V,$l){var $T=$j.elements,$S=$T[0],$m=$T[1],$p=$T[2],$o=$T[3],$H=$O.elements,$g=$H[0],$e=$H[1],$t=$H[2],$w=$H[3],$s=$V.elements,$b=$s[0],$r=$s[1],$h=$s[2],$a=$s[3],$c=$l.elements;$S=($S=$b<$S?$b:$S)<$g?$g:$S,$m=($m=$r<$m?$r:$m)<$e?$e:$m,$p=($p=$h<$p?$h:$p)<$t?$t:$p,$o=($o=$a<$o?$a:$o)<$w?$w:$o,$c[0]=$S,$c[1]=$m,$c[2]=$p,$c[3]=$o},$j.distanceSquared=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$V[0]-$l[0],$S=$V[1]-$l[1],$m=$V[2]-$l[2],$p=$V[3]-$l[3];return $T*$T+$S*$S+$m*$m+$p*$p},$j.distance=function($j,$O){var $V=$j.elements,$l=$O.elements,$T=$V[0]-$l[0],$S=$V[1]-$l[1],$m=$V[2]-$l[2],$p=$V[3]-$l[3];return Math.sqrt($T*$T+$S*$S+$m*$m+$p*$p)},$j.dot=function($j,$O){var $V=$j.elements,$l=$O.elements;return $V[0]*$l[0]+$V[1]*$l[1]+$V[2]*$l[2]+$V[3]*$l[3]},$j.min=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=Math.min($T[0],$S[0]),$l[1]=Math.min($T[1],$S[1]),$l[2]=Math.min($T[2],$S[2]),$l[3]=Math.min($T[3],$S[3])},$j.max=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O.elements;$l[0]=Math.max($T[0],$S[0]),$l[1]=Math.max($T[1],$S[1]),$l[2]=Math.max($T[2],$S[2]),$l[3]=Math.max($T[3],$S[3])},$e($j,["ZERO",function(){return this.ZERO=new $j},"ONE",function(){return this.ONE=new $j(1,1,1,1)},"UnitX",function(){return this.UnitX=new $j(1,0,0,0)},"UnitY",function(){return this.UnitY=new $j(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $j(0,0,1,0)},"UnitW",function(){return this.UnitW=new $j(0,0,0,1)}]),$j}(),$oO=function(){function $S($j,$O,$V,$l){this.minDepth=0,this.maxDepth=1,this.x=$j,this.y=$O,this.width=$V,this.height=$l}$w($S,"laya.d3.math.Viewport");var $j=$S.prototype;return $j.project=function($j,$O,$V){$mO.transformV3ToV3($j,$O,$V);var $l=$j.elements,$T=$O.elements,$S=$V.elements,$m=$l[0]*$T[3]+$l[1]*$T[7]+$l[2]*$T[11]+$T[15];1!==$m&&($S[0]=$S[0]/$m,$S[1]=$S[1]/$m,$S[2]=$S[2]/$m),$S[0]=.5*($S[0]+1)*this.width+this.x,$S[1]=.5*(1-$S[1])*this.height+this.y,$S[2]=$S[2]*(this.maxDepth-this.minDepth)+this.minDepth},$j.unprojectFromMat=function($j,$O,$V){var $l=$j.elements,$T=$O.elements,$S=$V.elements;$S[0]=($l[0]-this.x)/this.width*2-1,$S[1]=-(($l[1]-this.y)/this.height*2-1);var $m=(this.maxDepth-this.minDepth)/2;$S[2]=($l[2]-this.minDepth-$m)/$m;var $p=$S[0]*$T[3]+$S[1]*$T[7]+$S[2]*$T[11]+$T[15];$mO.transformV3ToV3($V,$O,$V),1!==$p&&($S[0]=$S[0]/$p,$S[1]=$S[1]/$p,$S[2]=$S[2]/$p)},$j.unprojectFromWVP=function($j,$O,$V,$l,$T){$jO.multiply($O,$V,$S._tempMatrix4x4),$l&&$jO.multiply($S._tempMatrix4x4,$l,$S._tempMatrix4x4),$S._tempMatrix4x4.invert($S._tempMatrix4x4),this.unprojectFromMat($j,$S._tempMatrix4x4,$T)},$e($S,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $jO}]),$S}(),$HO=function(){function $B($j){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$j,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$w($B,"laya.d3.resource.models.SubMesh");var $j=$B.prototype;return $Z.imps($j,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$j._getVertexBuffer=function($j){return void 0===$j&&($j=0),0===$j?this._vertexBuffer:null},$j._getIndexBuffer=function(){return this._indexBuffer},$j._getStaticBatchBakedVertexs=function($j,$O){var $V,$l,$T=this._vertexBuffer,$S=$T.vertexDeclaration,$m=$S.getVertexElementByUsage(0).offset/4,$p=$S.getVertexElementByUsage(3).offset/4,$o=$O.meshRender.lightmapScaleOffset,$H=0,$g=0,$e=0,$t=0,$w=0,$s=0;if($o)if($l=$S.getVertexElementByUsage(15))$e=$S.vertexStride/4,$V=0<this._vertexCount?$T.getData().slice(this._vertexStart*$e,(this._vertexStart+this._vertexCount)*$e):$T.getData().slice(),$t=$l.offset/4;else{$e=($s=$S.vertexStride/4)+2,$V=this._vertexCount?new Float32Array(this._vertexCount*($T.vertexDeclaration.vertexStride/4+2)):new Float32Array($T.vertexCount*($T.vertexDeclaration.vertexStride/4+2)),$t=($w=$S.getVertexElementByUsage(2).offset/4)+2;var $b=$T.getData();for($H=0,$g=$b.length/$s;$H<$g;$H++){var $r=0;$r=0<this._vertexCount?(this._vertexStart+$H)*$s:$H*$s;var $h=$H*$e,$a=0;for($a=0;$a<$t;$a++)$V[$h+$a]=$b[$r+$a];for($a=$t;$a<$s;$a++)$V[$h+$a+2]=$b[$r+$a]}}else $e=$S.vertexStride/4,$V=this._vertexCount?$T.getData().slice(this._vertexStart*$e,(this._vertexStart+this._vertexCount)*$e):$T.getData().slice();if($j){var $c=$j.worldMatrix,$A=$B._tempMatrix4x40;$c.invert($A);var $Z=$B._tempMatrix4x41,$x=$O.transform.worldMatrix;$jO.multiply($A,$x,$Z)}else $Z=$O.transform.worldMatrix;var $E=$B._tempQuaternion0;for($Z.decomposeTransRotScale($B._tempVector30,$E,$B._tempVector31),$H=0,$g=$V.length/$e;$H<$g;$H++){var $U=$H*$e+$m,$z=$H*$e+$p;if($rO.transformVector3ArrayToVector3ArrayCoordinate($V,$U,$Z,$V,$U),$rO.transformVector3ArrayByQuat($V,$z,$E,$V,$z),$o){var $$=$H*$e+$t;if($l)$rO.transformLightingMapTexcoordByUV1Array($V,$$,$o,$V,$$);else{var $_=$H*$s+$w;$rO.transformLightingMapTexcoordByUV0Array($b,$_,$o,$V,$$)}}}return $V},$j._getVertexBuffers=function(){return null},$j._beforeRender=function($j){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$j._render=function($j){var $O,$V=0,$l=$j.renderElement;if(1<this._indexCount){var $T=this._boneIndicesList.length;if(1<$T){for(var $S=0;$S<$T;$S++)($O=$l._skinAnimationDatas||this._skinAnimationDatas)&&($l._shaderValue.setValue(0,$O[$S]),$j._shader.uploadRenderElementUniforms($l._shaderValue.data)),$M.mainContext.drawElements(4,this._subIndexBufferCount[$S],5123,2*this._subIndexBufferStart[$S]);$U.drawCall+=$T}else($O=$l._skinAnimationDatas||this._skinAnimationDatas)&&($l._shaderValue.setValue(0,$O[0]),$j._shader.uploadRenderElementUniforms($l._shaderValue.data)),$M.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$U.drawCall++;$V=this._indexCount}else $V=this._indexBuffer.indexCount,($O=$l._skinAnimationDatas||this._skinAnimationDatas)&&($l._shaderValue.setValue(0,$O[0]),$j._shader.uploadRenderElementUniforms($l._shaderValue.data)),$M.mainContext.drawElements(4,$V,5123,0),$U.drawCall++;$U.trianglesFaces+=$V/3},$j.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$j.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$s(0,$j,"_vertexBufferCount",function(){return 1}),$s(0,$j,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$e($B,["_tempVector30",function(){return this._tempVector30=new $mO},"_tempVector31",function(){return this._tempVector31=new $mO},"_tempQuaternion0",function(){return this._tempQuaternion0=new $VO},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $jO},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $jO}]),$B}(),$gO=function(){function $j($j){this.defineCounter=0,this.defines=null,$j?(this.defineCounter=$j.defineCounter,this.defines=$j.defines.slice()):(this.defineCounter=0,this.defines=[])}return $w($j,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$j.prototype.registerDefine=function($j){var $O=Math.pow(2,this.defineCounter++);return this.defines[$O]=$j,$O},$j}(),$eO=function(){function $j(){}return $w($j,"laya.d3.shader.ShaderInit3D"),$j.__init__=function(){var $j,$O;$UO._globalRegDefine("HIGHPRECISION",$UO.SHADERDEFINE_HIGHPRECISION),$UO._globalRegDefine("FOG",$UO.SHADERDEFINE_FOG),$UO._globalRegDefine("DIRECTIONLIGHT",$UO.SHADERDEFINE_DIRECTIONLIGHT),$UO._globalRegDefine("POINTLIGHT",$UO.SHADERDEFINE_POINTLIGHT),$UO._globalRegDefine("SPOTLIGHT",$UO.SHADERDEFINE_SPOTLIGHT),$UO._globalRegDefine("UV",$UO.SHADERDEFINE_UV0),$UO._globalRegDefine("COLOR",$UO.SHADERDEFINE_COLOR),$UO._globalRegDefine("UV1",$UO.SHADERDEFINE_UV1),$UO._globalRegDefine("CASTSHADOW",$wO.SHADERDEFINE_CAST_SHADOW),$UO._globalRegDefine("SHADOWMAP_PSSM1",$wO.SHADERDEFINE_SHADOW_PSSM1),$UO._globalRegDefine("SHADOWMAP_PSSM2",$wO.SHADERDEFINE_SHADOW_PSSM2),$UO._globalRegDefine("SHADOWMAP_PSSM3",$wO.SHADERDEFINE_SHADOW_PSSM3),$UO._globalRegDefine("SHADOWMAP_PCF_NO",$wO.SHADERDEFINE_SHADOW_PCF_NO),$UO._globalRegDefine("SHADOWMAP_PCF1",$wO.SHADERDEFINE_SHADOW_PCF1),$UO._globalRegDefine("SHADOWMAP_PCF2",$wO.SHADERDEFINE_SHADOW_PCF2),$UO._globalRegDefine("SHADOWMAP_PCF3",$wO.SHADERDEFINE_SHADOW_PCF3),$UO._globalRegDefine("DEPTHFOG",$UO.SAHDERDEFINE_DEPTHFOG),$kO.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$kO.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$j={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$O={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $V=$kO.nameKey.add("SIMPLE");shaderCompile=$UO.add($V,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$j,$O),$nO.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$nO.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$nO.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$nO.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$nO.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$nO.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$nO.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$nO.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$nO.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$j}(),$tO=function(){function $j(){this._data=null,this._data=[]}$w($j,"laya.d3.shader.ValusArray");var $O=$j.prototype;return $O.setValue=function($j,$O){this._data[$j]=$O},$s(0,$O,"data",function(){return this._data}),$j}(),$wO=function(){function $j(){}return $j.SHADERDEFINE_RECEIVE_SHADOW=1,$j.SHADERDEFINE_CAST_SHADOW=512,$j.SHADERDEFINE_SHADOW_PSSM1=1024,$j.SHADERDEFINE_SHADOW_PSSM2=2048,$j.SHADERDEFINE_SHADOW_PSSM3=4096,$j.SHADERDEFINE_SHADOW_PCF_NO=8192,$j.SHADERDEFINE_SHADOW_PCF1=16384,$j.SHADERDEFINE_SHADOW_PCF2=32768,$j.SHADERDEFINE_SHADOW_PCF3=65536,$j.MAX_PSSM_COUNT=3,$j}(),$sO=function(){function $K(){}return $w($K,"laya.d3.utils.Picker"),$K.calculateCursorRay=function($j,$O,$V,$l,$T,$S){var $m=$j.elements[0],$p=$j.elements[1],$o=$K._tempVector30,$H=$o.elements;$H[0]=$m,$H[1]=$p,$H[2]=$O.minDepth;var $g=$K._tempVector31,$e=$g.elements;$e[0]=$m,$e[1]=$p,$e[2]=$O.maxDepth;var $t=$S.origin,$w=$K._tempVector32;$O.unprojectFromWVP($o,$V,$l,$T,$t),$O.unprojectFromWVP($g,$V,$l,$T,$w);var $s=$S.direction.elements;$s[0]=$w.x-$t.x,$s[1]=$w.y-$t.y,$s[2]=$w.z-$t.z,$mO.normalize($S.direction,$S.direction)},$K.rayIntersectsPositionsAndIndices=function($j,$O,$V,$l,$T){for(var $S=$V.vertexStride/4,$m=$V.getVertexElementByUsage(0).offset/4,$p=Number.MAX_VALUE,$o=-1,$H=-1,$g=-1,$e=0;$e<$l.length;$e+=3){var $t=$K._tempVector35,$w=$t.elements,$s=$l[$e]*$S,$b=$s+$m;$w[0]=$O[$b],$w[1]=$O[1+$b],$w[2]=$O[2+$b];var $r=$K._tempVector36,$h=$r.elements,$a=$l[$e+1]*$S,$c=$a+$m;$h[0]=$O[$c],$h[1]=$O[1+$c],$h[2]=$O[2+$c];var $A=$K._tempVector37,$Z=$A.elements,$x=$l[$e+2]*$S,$E=$x+$m;$Z[0]=$O[$E],$Z[1]=$O[1+$E],$Z[2]=$O[2+$E];var $U=laya.d3.utils.Picker.rayIntersectsTriangle($j,$t,$r,$A);!isNaN($U)&&$U<$p&&($p=$U,$o=$s,$H=$a,$g=$x)}if($p===Number.MAX_VALUE)return $T.position.toDefault(),$T.distance=Number.MAX_VALUE,$T.trianglePositions[0].toDefault(),$T.trianglePositions[1].toDefault(),$T.trianglePositions[2].toDefault(),$T.triangleNormals[0].toDefault(),$T.triangleNormals[1].toDefault(),$T.triangleNormals[2].toDefault(),!1;$T.distance=$p,$mO.scale($j.direction,$p,$T.position),$mO.add($j.origin,$T.position,$T.position);var $z=$T.trianglePositions,$$=$z[0],$_=$z[1],$B=$z[2],$M=$$.elements,$v=$_.elements,$Y=$B.elements,$R=$o+$m;$M[0]=$O[$R],$M[1]=$O[$R+1],$M[2]=$O[$R+2];var $q=$H+$m;$v[0]=$O[$q],$v[1]=$O[$q+1],$v[2]=$O[$q+2];var $i=$g+$m;$Y[0]=$O[$i],$Y[1]=$O[$i+1],$Y[2]=$O[$i+2];var $k=$V.getVertexElementByUsage(3);if($k){var $n=$k.offset/4,$G=$T.triangleNormals,$F=$G[0],$N=$G[1],$X=$G[2],$f=$F.elements,$C=$N.elements,$J=$X.elements,$u=$o+$n;$f[0]=$O[$u],$f[1]=$O[$u+1],$f[2]=$O[$u+2];var $y=$H+$n;$C[0]=$O[$y],$C[1]=$O[$y+1],$C[2]=$O[$y+2];var $W=$g+$n;$J[0]=$O[$W],$J[1]=$O[$W+1],$J[2]=$O[$W+2]}return!0},$K.rayIntersectsTriangle=function($j,$O,$V,$l){var $T=$K._tempVector30,$S=$K._tempVector31;$mO.subtract($V,$O,$T),$mO.subtract($l,$O,$S);var $m,$p=$K._tempVector32;if($mO.cross($j.direction,$S,$p),($m=$mO.dot($T,$p))>-Number.MIN_VALUE&&$m<Number.MIN_VALUE)return Number.NaN;var $o,$H=1/$m,$g=$K._tempVector33;if($mO.subtract($j.origin,$O,$g),$o=$mO.dot($g,$p),($o*=$H)<0||1<$o)return Number.NaN;var $e,$t,$w=$K._tempVector34;return $mO.cross($g,$T,$w),$e=$mO.dot($j.direction,$w),($e*=$H)<0||1<$o+$e?Number.NaN:($t=$mO.dot($S,$w),($t*=$H)<0?Number.NaN:$t)},$e($K,["_tempVector30",function(){return this._tempVector30=new $mO},"_tempVector31",function(){return this._tempVector31=new $mO},"_tempVector32",function(){return this._tempVector32=new $mO},"_tempVector33",function(){return this._tempVector33=new $mO},"_tempVector34",function(){return this._tempVector34=new $mO},"_tempVector35",function(){return this._tempVector35=new $mO},"_tempVector36",function(){return this._tempVector36=new $mO},"_tempVector37",function(){return this._tempVector37=new $mO}]),$K}(),$bO=(function(){function $j(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $mO,new $mO,new $mO],this.trianglePositions.length=3,this.triangleNormals=[new $mO,new $mO,new $mO],this.triangleNormals.length=3,this.position=new $mO}$w($j,"laya.d3.utils.RaycastHit"),$j.prototype.cloneTo=function($j){$j.distance=this.distance,this.trianglePositions[0].cloneTo($j.trianglePositions[0]),this.trianglePositions[1].cloneTo($j.trianglePositions[1]),this.trianglePositions[2].cloneTo($j.trianglePositions[2]),this.triangleNormals[0].cloneTo($j.triangleNormals[0]),this.triangleNormals[1].cloneTo($j.triangleNormals[1]),this.triangleNormals[2].cloneTo($j.triangleNormals[2]),this.position.cloneTo($j.position),$j.sprite3D=this.sprite3D}}(),function(){function $j($j,$O){this._width=0,this._height=0,this._width=$j,this._height=$O}$w($j,"laya.d3.utils.Size");var $O=$j.prototype;return $s(0,$O,"width",function(){return-1===this._width?$d.clientWidth:this._width}),$s(0,$O,"height",function(){return-1===this._height?$d.clientHeight:this._height}),$s(1,$j,"fullScreen",function(){return new $j(-1,-1)}),$j}()),$rO=function(){function $R(){}return $w($R,"laya.d3.utils.Utils3D"),$R._rotationTransformScaleSkinAnimation=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e){var $t,$w,$s,$b,$r,$h=$R._tempArray16_0,$a=$R._tempArray16_1,$c=$R._tempArray16_2,$A=$l+$l,$Z=$T+$T,$x=$S+$S,$E=$l*$A,$U=$T*$A,$z=$T*$Z,$$=$S*$A,$_=$S*$Z,$B=$S*$x,$M=$m*$A,$v=$m*$Z,$Y=$m*$x;for($h[15]=1,$h[0]=1-$z-$B,$h[1]=$U+$Y,$h[2]=$$-$v,$h[4]=$U-$Y,$h[5]=1-$E-$B,$h[6]=$_+$M,$h[8]=$$+$v,$h[9]=$_-$M,$h[10]=1-$E-$z,$a[15]=1,$a[0]=$p,$a[5]=$o,$a[10]=$H,$t=0;$t<4;$t++)$w=$h[$t],$s=$h[$t+4],$b=$h[$t+8],$r=$h[$t+12],$c[$t]=$w,$c[$t+4]=$s,$c[$t+8]=$b,$c[$t+12]=$w*$j+$s*$O+$b*$V+$r;for($t=0;$t<4;$t++)$w=$c[$t],$s=$c[$t+4],$b=$c[$t+8],$r=$c[$t+12],$g[$t+$e]=$w*$a[0]+$s*$a[1]+$b*$a[2]+$r*$a[3],$g[$t+$e+4]=$w*$a[4]+$s*$a[5]+$b*$a[6]+$r*$a[7],$g[$t+$e+8]=$w*$a[8]+$s*$a[9]+$b*$a[10]+$r*$a[11],$g[$t+$e+12]=$w*$a[12]+$s*$a[13]+$b*$a[14]+$r*$a[15]},$R._createNodeByJson=function($j,$O,$V,$l){if(!$V)switch($O.type){case"Sprite3D":$V=new $iO;break;case"MeshSprite3D":$V=new $KO;break;case"SkinnedMeshSprite3D":$V=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$V=new ShuriKenParticle3D;break;case"TrailSprite3D":$V=new TrailSprite3D;break;case"Terrain":$V=new Terrain;break;case"Camera":$V=new $WO;break;case"DirectionLight":$V=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $T=$O.props;if($T)for(var $S in $T)$V[$S]=$T[$S];var $m=$O.customProps;$m&&($V instanceof laya.d3.core.Sprite3D?($V._parseBaseCustomProps($m),$V._parseCustomProps($j,$l,$m,$O),$V._parseCustomComponent($j,$l,$O.components)):$V._parseCustomProps($j,$l,$m,$O));var $p=$O.child;if($p)for(var $o=0,$H=$p.length;$o<$H;$o++){var $g=$R._createNodeByJson($j,$p[$o],null,$l);$V.addChild($g)}return $V},$R._computeBoneAndAnimationDatasByBindPoseMatrxix=function($j,$O,$V,$l,$T,$S){var $m,$p,$o=0,$H=0,$g=$j.length;for($m=0;$m<$g;$o+=$j[$m].keyframeWidth,$H+=16,$m++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($O[$o+0],$O[$o+1],$O[$o+2],$O[$o+3],$O[$o+4],$O[$o+5],$O[$o+6],$O[$o+7],$O[$o+8],$O[$o+9],$l,$H),0!=$m&&($p=16*$j[$m].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($l,$p,$l,$H,$l,$H));var $e=$V.length;for($m=0;$m<$e;$m++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($l,16*$S[$m],$V[$m],$T,16*$m)},$R._computeAnimationDatasByArrayAndMatrixFast=function($j,$O,$V,$l){for(var $T=0,$S=$j.length;$T<$S;$T++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($O,16*$l[$T],$j[$T],$V,16*$T)},$R._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($j,$O,$V,$l,$T){var $S,$m,$p=0,$o=0,$H=$j.length;for($S=0;$S<$H;$p+=$j[$S].keyframeWidth,$o+=16,$S++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($O[$p+7],$O[$p+8],$O[$p+9],$O[$p+3],$O[$p+4],$O[$p+5],$O[$p+6],$O[$p+0],$O[$p+1],$O[$p+2],$l,$o),0!=$S&&($m=16*$j[$S].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($l,$m,$l,$o,$l,$o));var $g=$V.length;for($S=0;$S<$g;$S++){var $e=16*$S;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($l,$e,$V[$S],$T,$e)}},$R._computeAnimationDatasByArrayAndMatrixFastOld=function($j,$O,$V){for(var $l=$j.length,$T=0;$T<$l;$T++){var $S=16*$T;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($O,$S,$j[$T],$V,$S)}},$R._computeRootAnimationData=function($j,$O,$V){for(var $l=0,$T=0,$S=0,$m=$j.length;$l<$m;$T+=$j[$l].keyframeWidth,$S+=16,$l++)laya.d3.utils.Utils3D.createAffineTransformationArray($O[$T+0],$O[$T+1],$O[$T+2],$O[$T+3],$O[$T+4],$O[$T+5],$O[$T+6],$O[$T+7],$O[$T+8],$O[$T+9],$V,$S)},$R.transformVector3ArrayByQuat=function($j,$O,$V,$l,$T){var $S=$V.elements,$m=$j[$O],$p=$j[$O+1],$o=$j[$O+2],$H=$S[0],$g=$S[1],$e=$S[2],$t=$S[3],$w=$t*$m+$g*$o-$e*$p,$s=$t*$p+$e*$m-$H*$o,$b=$t*$o+$H*$p-$g*$m,$r=-$H*$m-$g*$p-$e*$o;$l[$T]=$w*$t+$r*-$H+$s*-$e-$b*-$g,$l[$T+1]=$s*$t+$r*-$g+$b*-$H-$w*-$e,$l[$T+2]=$b*$t+$r*-$e+$w*-$g-$s*-$H},$R.mulMatrixByArray=function($j,$O,$V,$l,$T,$S){var $m,$p,$o,$H,$g;if($T===$V){for($V=$R._tempArray16_3,$m=0;$m<16;++$m)$V[$m]=$T[$S+$m];$l=0}for($m=0;$m<4;$m++)$p=$j[$O+$m],$o=$j[$O+$m+4],$H=$j[$O+$m+8],$g=$j[$O+$m+12],$T[$S+$m]=$p*$V[$l+0]+$o*$V[$l+1]+$H*$V[$l+2]+$g*$V[$l+3],$T[$S+$m+4]=$p*$V[$l+4]+$o*$V[$l+5]+$H*$V[$l+6]+$g*$V[$l+7],$T[$S+$m+8]=$p*$V[$l+8]+$o*$V[$l+9]+$H*$V[$l+10]+$g*$V[$l+11],$T[$S+$m+12]=$p*$V[$l+12]+$o*$V[$l+13]+$H*$V[$l+14]+$g*$V[$l+15]},$R.mulMatrixByArrayFast=function($j,$O,$V,$l,$T,$S){var $m,$p,$o,$H,$g;for($m=0;$m<4;$m++)$p=$j[$O+$m],$o=$j[$O+$m+4],$H=$j[$O+$m+8],$g=$j[$O+$m+12],$T[$S+$m]=$p*$V[$l+0]+$o*$V[$l+1]+$H*$V[$l+2]+$g*$V[$l+3],$T[$S+$m+4]=$p*$V[$l+4]+$o*$V[$l+5]+$H*$V[$l+6]+$g*$V[$l+7],$T[$S+$m+8]=$p*$V[$l+8]+$o*$V[$l+9]+$H*$V[$l+10]+$g*$V[$l+11],$T[$S+$m+12]=$p*$V[$l+12]+$o*$V[$l+13]+$H*$V[$l+14]+$g*$V[$l+15]},$R.mulMatrixByArrayAndMatrixFast=function($j,$O,$V,$l,$T){var $S,$m,$p,$o,$H,$g=$V.elements,$e=$g[0],$t=$g[1],$w=$g[2],$s=$g[3],$b=$g[4],$r=$g[5],$h=$g[6],$a=$g[7],$c=$g[8],$A=$g[9],$Z=$g[10],$x=$g[11],$E=$g[12],$U=$g[13],$z=$g[14],$$=$g[15],$_=$O,$B=$O+4,$M=$O+8,$v=$O+12,$Y=$T,$R=$T+4,$q=$T+8,$i=$T+12;for($S=0;$S<4;$S++)$m=$j[$_+$S],$p=$j[$B+$S],$o=$j[$M+$S],$H=$j[$v+$S],$l[$Y+$S]=$m*$e+$p*$t+$o*$w+$H*$s,$l[$R+$S]=$m*$b+$p*$r+$o*$h+$H*$a,$l[$q+$S]=$m*$c+$p*$A+$o*$Z+$H*$x,$l[$i+$S]=$m*$E+$p*$U+$o*$z+$H*$$},$R.createAffineTransformationArray=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e){var $t=$l+$l,$w=$T+$T,$s=$S+$S,$b=$l*$t,$r=$l*$w,$h=$l*$s,$a=$T*$w,$c=$T*$s,$A=$S*$s,$Z=$m*$t,$x=$m*$w,$E=$m*$s;$g[$e+0]=(1-($a+$A))*$p,$g[$e+1]=($r+$E)*$p,$g[$e+2]=($h-$x)*$p,$g[$e+3]=0,$g[$e+4]=($r-$E)*$o,$g[$e+5]=(1-($b+$A))*$o,$g[$e+6]=($c+$Z)*$o,$g[$e+7]=0,$g[$e+8]=($h+$x)*$H,$g[$e+9]=($c-$Z)*$H,$g[$e+10]=(1-($b+$a))*$H,$g[$e+11]=0,$g[$e+12]=$j,$g[$e+13]=$O,$g[$e+14]=$V,$g[$e+15]=1},$R.transformVector3ArrayToVector3ArrayCoordinate=function($j,$O,$V,$l,$T){var $S=$R._tempArray4_0,$m=$j[$O+0],$p=$j[$O+1],$o=$j[$O+2],$H=$V.elements;$S[0]=$m*$H[0]+$p*$H[4]+$o*$H[8]+$H[12],$S[1]=$m*$H[1]+$p*$H[5]+$o*$H[9]+$H[13],$S[2]=$m*$H[2]+$p*$H[6]+$o*$H[10]+$H[14],$S[3]=1/($m*$H[3]+$p*$H[7]+$o*$H[11]+$H[15]),$l[$T+0]=$S[0]*$S[3],$l[$T+1]=$S[1]*$S[3],$l[$T+2]=$S[2]*$S[3]},$R.transformLightingMapTexcoordByUV0Array=function($j,$O,$V,$l,$T){var $S=$V.elements;$l[$T+0]=$j[$O+0]*$S[0]+$S[2],$l[$T+1]=($j[$O+1]-1)*$S[1]+$S[3]},$R.transformLightingMapTexcoordByUV1Array=function($j,$O,$V,$l,$T){var $S=$V.elements;$l[$T+0]=$j[$O+0]*$S[0]+$S[2],$l[$T+1]=1+$j[$O+1]*$S[1]+$S[3]},$R.getURLVerion=function($j){var $O=$j.indexOf("?");return 0<=$O?$j.substr($O):null},$R._quaternionCreateFromYawPitchRollArray=function($j,$O,$V,$l){var $T=.5*$V,$S=.5*$O,$m=.5*$j,$p=Math.sin($T),$o=Math.cos($T),$H=Math.sin($S),$g=Math.cos($S),$e=Math.sin($m),$t=Math.cos($m);$l[0]=$t*$H*$o+$e*$g*$p,$l[1]=$e*$g*$o-$t*$H*$p,$l[2]=$t*$g*$p-$e*$H*$o,$l[3]=$t*$g*$o+$e*$H*$p},$R._createAffineTransformationArray=function($j,$O,$V,$l){var $T=$O[0],$S=$O[1],$m=$O[2],$p=$O[3],$o=$T+$T,$H=$S+$S,$g=$m+$m,$e=$T*$o,$t=$T*$H,$w=$T*$g,$s=$S*$H,$b=$S*$g,$r=$m*$g,$h=$p*$o,$a=$p*$H,$c=$p*$g,$A=$V[0],$Z=$V[1],$x=$V[2];$l[0]=(1-($s+$r))*$A,$l[1]=($t+$c)*$A,$l[2]=($w-$a)*$A,$l[3]=0,$l[4]=($t-$c)*$Z,$l[5]=(1-($e+$r))*$Z,$l[6]=($b+$h)*$Z,$l[7]=0,$l[8]=($w+$a)*$x,$l[9]=($b-$h)*$x,$l[10]=(1-($e+$s))*$x,$l[11]=0,$l[12]=$j[0],$l[13]=$j[1],$l[14]=$j[2],$l[15]=1},$R._mulMatrixArray=function($j,$O,$V,$l){var $T,$S,$m,$p,$o,$H=$O.elements,$g=$H[0],$e=$H[1],$t=$H[2],$w=$H[3],$s=$H[4],$b=$H[5],$r=$H[6],$h=$H[7],$a=$H[8],$c=$H[9],$A=$H[10],$Z=$H[11],$x=$H[12],$E=$H[13],$U=$H[14],$z=$H[15],$$=$l,$_=$l+4,$B=$l+8,$M=$l+12;for($T=0;$T<4;$T++)$S=$j[$T],$m=$j[$T+4],$p=$j[$T+8],$o=$j[$T+12],$V[$$+$T]=$S*$g+$m*$e+$p*$t+$o*$w,$V[$_+$T]=$S*$s+$m*$b+$p*$r+$o*$h,$V[$B+$T]=$S*$a+$m*$c+$p*$A+$o*$Z,$V[$M+$T]=$S*$x+$m*$E+$p*$U+$o*$z},$R.getYawPitchRoll=function($j,$O){$R.transformQuat($mO.ForwardRH,$j,$VO.TEMPVector31),$R.transformQuat($mO.Up,$j,$VO.TEMPVector32);var $V=$VO.TEMPVector32.elements;$R.angleTo($mO.ZERO,$VO.TEMPVector31,$VO.TEMPVector33);var $l=$VO.TEMPVector33.elements;$l[0]==Math.PI/2?($l[1]=$R.arcTanAngle($V[2],$V[0]),$l[2]=0):$l[0]==-Math.PI/2?($l[1]=$R.arcTanAngle(-$V[2],-$V[0]),$l[2]=0):($jO.createRotationY(-$l[1],$VO.TEMPMatrix0),$jO.createRotationX(-$l[0],$VO.TEMPMatrix1),$mO.transformCoordinate($VO.TEMPVector32,$VO.TEMPMatrix0,$VO.TEMPVector32),$mO.transformCoordinate($VO.TEMPVector32,$VO.TEMPMatrix1,$VO.TEMPVector32),$l[2]=$R.arcTanAngle($V[1],-$V[0])),$l[1]<=-Math.PI&&($l[1]=Math.PI),$l[2]<=-Math.PI&&($l[2]=Math.PI),$l[1]>=Math.PI&&$l[2]>=Math.PI&&($l[1]=0,$l[2]=0,$l[0]=Math.PI-$l[0]),$O[0]=$l[1],$O[1]=$l[0],$O[2]=$l[2]},$R.arcTanAngle=function($j,$O){return 0==$j?1==$O?Math.PI/2:-Math.PI/2:0<$j?Math.atan($O/$j):$j<0?0<$O?Math.atan($O/$j)+Math.PI:Math.atan($O/$j)-Math.PI:0},$R.angleTo=function($j,$O,$V){$mO.subtract($O,$j,$VO.TEMPVector30),$mO.normalize($VO.TEMPVector30,$VO.TEMPVector30),$V.elements[0]=Math.asin($VO.TEMPVector30.y),$V.elements[1]=$R.arcTanAngle(-$VO.TEMPVector30.z,-$VO.TEMPVector30.x)},$R.transformQuat=function($j,$O,$V){var $l=$V.elements,$T=$j.elements,$S=$O,$m=$T[0],$p=$T[1],$o=$T[2],$H=$S[0],$g=$S[1],$e=$S[2],$t=$S[3],$w=$t*$m+$g*$o-$e*$p,$s=$t*$p+$e*$m-$H*$o,$b=$t*$o+$H*$p-$g*$m,$r=-$H*$m-$g*$p-$e*$o;$l[0]=$w*$t+$r*-$H+$s*-$e-$b*-$g,$l[1]=$s*$t+$r*-$g+$b*-$H-$w*-$e,$l[2]=$b*$t+$r*-$e+$w*-$g-$s*-$H},$R.quaterionNormalize=function($j,$O){var $V=$j[0],$l=$j[1],$T=$j[2],$S=$j[3],$m=$V*$V+$l*$l+$T*$T+$S*$S;0<$m&&($m=1/Math.sqrt($m),$O[0]=$V*$m,$O[1]=$l*$m,$O[2]=$T*$m,$O[3]=$S*$m)},$R.matrix4x4MultiplyFFF=function($j,$O,$V){var $l,$T,$S,$m,$p;if($V===$O)for($O=new Float32Array(16),$l=0;$l<16;++$l)$O[$l]=$V[$l];for($l=0;$l<4;$l++)$T=$j[$l],$S=$j[$l+4],$m=$j[$l+8],$p=$j[$l+12],$V[$l]=$T*$O[0]+$S*$O[1]+$m*$O[2]+$p*$O[3],$V[$l+4]=$T*$O[4]+$S*$O[5]+$m*$O[6]+$p*$O[7],$V[$l+8]=$T*$O[8]+$S*$O[9]+$m*$O[10]+$p*$O[11],$V[$l+12]=$T*$O[12]+$S*$O[13]+$m*$O[14]+$p*$O[15]},$R.matrix4x4MultiplyMFM=function($j,$O,$V){$R.matrix4x4MultiplyFFF($j.elements,$O,$V.elements)},$e($R,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $mO},"_tempVector3_1",function(){return this._tempVector3_1=new $mO},"_tempVector3_2",function(){return this._tempVector3_2=new $mO},"_tempVector3_3",function(){return this._tempVector3_3=new $mO},"_tempVector3_4",function(){return this._tempVector3_4=new $mO},"_tempVector3_5",function(){return this._tempVector3_5=new $mO},"_tempVector3_6",function(){return this._tempVector3_6=new $mO},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$R}(),$hO=function(){function $v(){}return $w($v,"Laya3D"),$v._cancelLoadByUrl=function($j){$Z.loader.cancelLoadByUrl($j),$v._innerFirstLevelLoaderManager.cancelLoadByUrl($j),$v._innerSecondLevelLoaderManager.cancelLoadByUrl($j),$v._innerThirdLevelLoaderManager.cancelLoadByUrl($j),$v._innerFourthLevelLoaderManager.cancelLoadByUrl($j)},$v._changeWebGLSize=function($j,$O){$M.onStageResize($j,$O),$d.clientWidth=$j,$d.clientHeight=$O},$v.__init__=function(){var $j=$O.createMap;$j.lh=[$iO,"SPRITE3DHIERARCHY"],$j.ls=[$qO,"SPRITE3DHIERARCHY"],$j.lm=[$fO,"MESH"],$j.lmat=[$nO,"MATERIAL"],$j.jpg=[$JO,"nativeimage"],$j.jpeg=[$JO,"nativeimage"],$j.png=[$JO,"nativeimage"],$j.pkm=[$JO,"arraybuffer"],$j.raw=[$NO,"arraybuffer"],$j.mipmaps=[$NO,"arraybuffer"],$h.parserMap.SPRITE3DHIERARCHY=$v._loadHierarchy,$h.parserMap.MESH=$v._loadMesh,$h.parserMap.MATERIAL=$v._loadMaterial,$h.parserMap.TEXTURECUBE=$v._loadTextureCube,$h.parserMap.TERRAIN=$v._loadTerrain,$v._innerFirstLevelLoaderManager.on("error",null,$v._eventLoadManagerError),$v._innerSecondLevelLoaderManager.on("error",null,$v._eventLoadManagerError),$v._innerThirdLevelLoaderManager.on("error",null,$v._eventLoadManagerError),$v._innerFourthLevelLoaderManager.on("error",null,$v._eventLoadManagerError)},$v.READ_BLOCK=function(){return $v._readData.pos+=4,!0},$v.READ_DATA=function(){return $v._DATA.offset=$v._readData.getUint32(),$v._DATA.size=$v._readData.getUint32(),!0},$v.READ_STRINGS=function(){var $j=[],$O={offset:0,size:0};$O.offset=$v._readData.getUint16(),$O.size=$v._readData.getUint16();$v._readData.pos;$v._readData.pos=$O.offset+$v._DATA.offset;for(var $V=0;$V<$O.size;$V++){var $l=$v._readData.readUTFString();-1===$l.lastIndexOf(".lmat")&&-1===$l.lastIndexOf(".lpbr")||$j.push($l)}return $j},$v.formatRelativePath=function($j,$O){var $V;if("."===$O.charAt(0)){for(var $l=($j+$O).split("/"),$T=0,$S=$l.length;$T<$S;$T++)if(".."==$l[$T]){var $m=$T-1;0<$m&&".."!==$l[$m]&&($l.splice($m,2),$T-=2)}$V=$l.join("/")}else $V=$j+$O;return null!=$B.customFormat&&($V=$B.customFormat($V,null)),$V},$v._eventLoadManagerError=function($j){$Z.loader.event("error",$j)},$v._addHierarchyInnerUrls=function($j,$O,$V,$l,$T,$S){var $m=$v.formatRelativePath($l,$T);$V&&($m+=$V),$j.push({url:$m,clas:$S}),$O[$T]=$m},$v._getSprite3DHierarchyInnerUrls=function($j,$O,$V,$l,$T,$S,$m){var $p,$o=0,$H=0;switch($j.type){case"Scene":var $g=$j.customProps.lightmaps;for($o=0,$H=$g.length;$o<$H;$o++){var $e=$g[$o].replace(".exr",".png");$v._addHierarchyInnerUrls($l,$T,$S,$m,$e,$JO)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $t;if($j.instanceParams)($t=$j.instanceParams.loadPath)&&$v._addHierarchyInnerUrls($O,$T,$S,$m,$t,$fO);else{($t=($p=$j.customProps).meshPath)&&$v._addHierarchyInnerUrls($O,$T,$S,$m,$t,$fO);var $w=$p.materials;if($w)for($o=0,$H=$w.length;$o<$H;$o++){for(var $s=$w[$o],$b=$s.type.split("."),$r=$Y.window,$h=0,$a=$b.length;$h<$a;++$h){$r=$r[this.clasPaths[$h]]}if("function"!=typeof $r)throw"_getSprite3DHierarchyInnerUrls 错误: "+$s.type+" 不是类";$v._addHierarchyInnerUrls($V,$T,$S,$m,$s.path,$r)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $c=($p=$j.customProps).meshPath;$c&&$v._addHierarchyInnerUrls($O,$T,$S,$m,$c,$fO);var $A=$p.material;if($A){$b=$A.type.split("."),$r=$Y.window;for($h=0,$a=$b.length;$h<$a;++$h){$r=$r[this.clasPaths[$h]]}$v._addHierarchyInnerUrls($V,$T,$S,$m,$A.path,$r)}else{var $Z=$p.materialPath;if($Z)$v._addHierarchyInnerUrls($V,$T,$S,$m,$Z,ShurikenParticleMaterial);else{var $x=$p.texturePath;$x&&$v._addHierarchyInnerUrls($l,$T,$S,$m,$x,$JO)}}break;case"Terrain":$v._addHierarchyInnerUrls($l,$T,$S,$m,$j.customProps.dataPath,TerrainRes)}var $E=$j.components;for(var $U in $E){var $z=$E[$U];switch($U){case"Animator":var $$=$z.avatarPath;if($$)$v._addHierarchyInnerUrls($l,$T,$S,$m,$$,Avatar);else{var $_=$z.avatar;$_&&$v._addHierarchyInnerUrls($l,$T,$S,$m,$_.path,Avatar)}var $B=$z.clipPaths;for($o=0,$H=$B.length;$o<$H;$o++)$v._addHierarchyInnerUrls($l,$T,$S,$m,$B[$o],AnimationClip)}}var $M=$j.child;for($o=0,$H=$M.length;$o<$H;$o++)$v._getSprite3DHierarchyInnerUrls($M[$o],$O,$V,$l,$T,$S,$m)},$v._loadHierarchy=function($j){$j.on("loaded",null,$v._onHierarchylhLoaded,[$j,$j._class._getGroup()]),$j.load($j.url,"json",!1,null,!0)},$v._onHierarchylhLoaded=function($j,$O,$V){if($j._class.destroyed)$j.endLoad();else{var $l=$j.url,$T=$rO.getURLVerion($l),$S=$B.getPath($l),$m=[],$p=[],$o=[],$H={};$v._getSprite3DHierarchyInnerUrls($V,$m,$p,$o,$H,$T,$S);var $g=$m.length+$p.length+$o.length,$e=$g+1,$t=1/$e;if($v._onProcessChange($j,0,$t,1),0<$o.length){var $w=$g/$e,$s=$_.create(null,$v._onProcessChange,[$j,$t,$w],!1);$v._innerFourthLevelLoaderManager.create($o,$_.create(null,$v._onHierarchyInnerForthLevResouLoaded,[$j,$O,$s,$V,$H,$m,$p,$t+$w*$o.length,$w]),$s,null,null,1,!0,$O)}else $v._onHierarchyInnerForthLevResouLoaded($j,$O,null,$V,$H,$m,$p,$t,$w)}},$v._onHierarchyInnerForthLevResouLoaded=function($j,$O,$V,$l,$T,$S,$m,$p,$o){if($j._class.destroyed)$j.endLoad();else if($V&&$V.recover(),0<$m.length){var $H=$_.create(null,$v._onProcessChange,[$j,$p,$o],!1);$v._innerSecondLevelLoaderManager.create($m,$_.create(null,$v._onHierarchyInnerSecondLevResouLoaded,[$j,$O,$H,$l,$T,$S,$p+$o*$m.length,$o]),$V,null,null,1,!0,$O)}else $v._onHierarchyInnerSecondLevResouLoaded($j,$O,null,$l,$T,$S,$p,$o)},$v._onHierarchyInnerSecondLevResouLoaded=function($j,$O,$V,$l,$T,$S,$m,$p){if($j._class.destroyed)$j.endLoad();else if($V&&$V.recover(),0<$S.length){var $o=$_.create(null,$v._onProcessChange,[$j,$m,$p],!1);$v._innerFirstLevelLoaderManager.create($S,$_.create(null,$v._onHierarchyInnerFirstLevResouLoaded,[$j,$o,$l,$T]),$V,null,null,1,!0,$O)}else $v._onHierarchyInnerFirstLevResouLoaded($j,null,$l,$T)},$v._onHierarchyInnerFirstLevResouLoaded=function($j,$O,$V,$l){$O&&$O.recover(),$j.endLoad([$V,$l])},$v._loadTerrain=function($j){$j.on("loaded",null,$v._onTerrainLtLoaded,[$j,$j._class._getGroup()]),$j.load($j.url,"json",!1,null,!0)},$v._onTerrainLtLoaded=function($j,$O,$V){if($j._class.destroyed)$j.endLoad();else{var $l,$T,$S=$j.url,$m=$rO.getURLVerion($S),$p=$B.getPath($S),$o=[],$H={},$g=0,$e=0,$t=$V.heightData;$l=$t.url,$T=$v.formatRelativePath($p,$l),$m&&($T+=$m),$l=$H[$l]=$T;var $w=$V.detailTexture;for($g=0,$e=$w.length;$g<$e;$g++)$o.push({url:$w[$g].diffuse});var $s=$V.normalMap;for($g=0,$e=$s.length;$g<$e;$g++)$o.push({url:$s[$g]});var $b=$V.alphaMap;for($g=0,$e=$b.length;$g<$e;$g++)$o.push({url:$b[$g],params:[!1,!1,6408,!0]});for($g=0,$e=$o.length;$g<$e;$g++){var $r=$o[$g].url;$T=$v.formatRelativePath($p,$r),$m&&($T+=$m),$o[$g].url=$T,$H[$r]=$T}var $h=$o.length,$a=$h+2,$c=1/$a;$v._onProcessChange($j,0,$c,1);var $A={heightMapLoaded:!1,texturesLoaded:!1},$Z=$_.create(null,$v._onProcessChange,[$j,$c,$c],!1);$v._innerFourthLevelLoaderManager.create($l,$_.create(null,$v._onTerrainHeightMapLoaded,[$j,$Z,$V,$H,$A]),$Z,null,[$t.numX,$t.numZ,$t.bitType,$t.value],1,!0,$O);var $x=$_.create(null,$v._onProcessChange,[$j,2*$c,$h/$a],!1);$v._innerFourthLevelLoaderManager.create($o,$_.create(null,$v._onTerrainTexturesLoaded,[$j,$x,$V,$H,$A]),$x,null,null,1,!0,$O)}},$v._onTerrainHeightMapLoaded=function($j,$O,$V,$l,$T){$T.heightMapLoaded=!0,$T.texturesLoaded&&($j.endLoad([$V,$l]),$O.recover())},$v._onTerrainTexturesLoaded=function($j,$O,$V,$l,$T){$T.texturesLoaded=!0,$T.heightMapLoaded&&($j.endLoad([$V,$l]),$O.recover())},$v._loadMesh=function($j){$j.on("loaded",null,$v._onMeshLmLoaded,[$j,$j._class._getGroup()]),$j.load($j.url,"arraybuffer",!1,null,!0)},$v._onMeshLmLoaded=function($j,$O,$V){if($j._class.destroyed)$j.endLoad();else{var $l,$T,$S,$m=$j.url,$p=$rO.getURLVerion($m),$o=$B.getPath($m),$H={},$g=0,$e=0;switch(($v._readData=new $x($V)).pos=0,$v._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $t=$v._readData.getUint32();$v._readData.pos=$v._readData.pos+4,$e=$v._readData.getUint16(),$v._readData.pos=$v._readData.pos+8*$e;var $w=$v._readData.getUint32();for($e=$v._readData.getUint16(),$v._readData.pos=$t+$w,$l=[],$g=0;$g<$e;$g++){var $s=$v._readData.readUTFString();-1!==$s.lastIndexOf(".lmat")&&$l.push($s)}break;default:for($v.READ_BLOCK(),$g=0;$g<2;$g++){var $b=$v._readData.getUint16(),$r=$v._strings[$b],$h=$v["READ_"+$r];if(null==$h)throw new Error("model file err,no this function:"+$b+" "+$r);1===$g?$l=$h.call():$h.call()}}for($g=0,$S=$l.length;$g<$S;$g++){var $a=$l[$g];$T=$v.formatRelativePath($o,$a),$p&&($T+=$p),$l[$g]=$T,$H[$a]=$T}if(0<$l.length){$v._onProcessChange($j,0,.5,1);var $c=$_.create(null,$v._onProcessChange,[$j,.5,.5],!1);$v._innerSecondLevelLoaderManager.create($l,$_.create(null,$v._onMeshMateialLoaded,[$j,$c,$V,$H]),$c,null,null,1,!0,$O)}else $j.endLoad([$V,$H])}},$v._onMeshMateialLoaded=function($j,$O,$V,$l){$j.endLoad([$V,$l]),$O.recover()},$v._getMaterialTexturePath=function($j,$O,$V){var $l=$j.length-4;return $j.indexOf(".dds")!=$l&&$j.indexOf(".tga")!=$l&&$j.indexOf(".exr")!=$l&&$j.indexOf(".DDS")!=$l&&$j.indexOf(".TGA")!=$l&&$j.indexOf(".EXR")!=$l||($j=$j.substr(0,$l)+".png"),$j=$v.formatRelativePath($V,$j),$O&&($j+=$O),$j},$v._loadMaterial=function($j){$j.on("loaded",null,$v._onMaterilLmatLoaded,[$j,$j._class._getGroup()]),$j.load($j.url,"json",!1,null,!0)},$v._onMaterilLmatLoaded=function($j,$O,$V){if($j._class.destroyed)$j.endLoad();else{var $l,$T=$j.url,$S=$rO.getURLVerion($T),$m=$B.getPath($T),$p=[],$o={},$H=$V.customProps,$g=$V.version;if($g)switch($g){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $e=$V.props.textures,$t=0,$w=$e.length;$t<$w;$t++){var $s=$e[$t],$b=$s.path;if($b){var $r=$b.length-4;$b.indexOf(".exr")!=$r&&$b.indexOf(".EXR")!=$r||($b=$b.substr(0,$r)+".png"),$l=$v.formatRelativePath($m,$b),$S&&($l+=$S),$p.push({url:$l,params:$s.params}),$o[$b]=$l}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $h=$H.diffuseTexture.texture2D;if($h&&($l=$v._getMaterialTexturePath($h,$S,$m),$p.push($l),$o[$h]=$l),$H.normalTexture){var $a=$H.normalTexture.texture2D;$a&&($l=$v._getMaterialTexturePath($a,$S,$m),$p.push($l),$o[$a]=$l)}if($H.specularTexture){var $c=$H.specularTexture.texture2D;$c&&($l=$v._getMaterialTexturePath($c,$S,$m),$p.push($l),$o[$c]=$l)}if($H.emissiveTexture){var $A=$H.emissiveTexture.texture2D;$A&&($l=$v._getMaterialTexturePath($A,$S,$m),$p.push($l),$o[$A]=$l)}if($H.ambientTexture){var $Z=$H.ambientTexture.texture2D;$Z&&($l=$v._getMaterialTexturePath($Z,$S,$m),$p.push($l),$o[$Z]=$l)}if($H.reflectTexture){var $x=$H.reflectTexture.texture2D;$x&&($l=$v._getMaterialTexturePath($x,$S,$m),$p.push($l),$o[$x]=$l)}}var $E=$p.length,$U=$E+1,$z=1/$U;if($v._onProcessChange($j,0,$z,1),0<$E){var $$=$_.create(null,$v._onProcessChange,[$j,$z,$E/$U],!1);$v._innerFourthLevelLoaderManager.create($p,$_.create(null,$v._onMateialTexturesLoaded,[$j,$$,$V,$o]),$$,$JO,null,1,!0,$O)}else $v._onMateialTexturesLoaded($j,null,$V,null)}},$v._onMateialTexturesLoaded=function($j,$O,$V,$l){$j.endLoad([$V,$l]),$O&&$O.recover()},$v._loadTextureCube=function($j){$j.on("loaded",null,$v._onTextureCubeLtcLoaded,[$j]),$j.load($j.url,"json",!1,null,!0)},$v._onTextureCubeLtcLoaded=function($j,$O){if($j._class.destroyed)$j.endLoad();else{var $V=$B.getPath($j.url),$l=[$v.formatRelativePath($V,$O.px),$v.formatRelativePath($V,$O.nx),$v.formatRelativePath($V,$O.py),$v.formatRelativePath($V,$O.ny),$v.formatRelativePath($V,$O.pz),$v.formatRelativePath($V,$O.nz)];$v._onProcessChange($j,0,1/7,1);var $T=$_.create(null,$v._onProcessChange,[$j,1/7,6/7],!1);$v._innerFourthLevelLoaderManager.load($l,$_.create(null,$v._onTextureCubeImagesLoaded,[$j,$l,$T]),$T,"nativeimage")}},$v._onTextureCubeImagesLoaded=function($j,$O,$V){var $l=[];$l.length=6;for(var $T=0;$T<6;$T++){var $S=$O[$T];$l[$T]=$h.getRes($S),$h.clearRes($S)}$j.endLoad($l),$V.recover()},$v._onProcessChange=function($j,$O,$V,$l){($l=$O+$l*$V)<1&&$j.event("progress",$l)},$v.init=function($j,$O,$V,$l,$T,$S){if(void 0===$V&&($V=!1),void 0===$l&&($l=!1),void 0===$T&&($T=!0),void 0===$S&&($S=!0),$a.update3DLoop=function(){},$a.cancelLoadByUrl=function($j){$v._cancelLoadByUrl($j)},$o.isAntialias=$V,$o.isAlpha=$l,$o.premultipliedAlpha=$T,$o.isStencil=$S,!$M.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$a.changeWebGLSize=$v._changeWebGLSize,$b.is3DMode=!0,$Z.init($j,$O),$R.__init__(),$eO.__init__(),$KO.__init__(),$X.__init__(),$v.__init__(),$m.maxTextureCount=2,($v.debugMode||$L.debugMode)&&($v._debugPhasorSprite=new $y)},$v.HIERARCHY="SPRITE3DHIERARCHY",$v.MESH="MESH",$v.MATERIAL="MATERIAL",$v.PBRMATERIAL="PBRMTL",$v.TEXTURECUBE="TEXTURECUBE",$v.TERRAIN="TERRAIN",$v._readData=null,$v._debugPhasorSprite=null,$v.debugMode=!1,$e($v,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $O},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $O},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $O},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $O}]),$v}(),$aO=function($j){function $T($j){$T.__super.call(this),this._owner=$j,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$w($T,"laya.d3.animation.AnimationTransform3D",$S);var $O=$T.prototype;return $O._getlocalMatrix=function(){return this._localUpdate&&($rO._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$O._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldTransform()}},$O._setWorldMatrixAndUpdate=function($j){if(this._worldMatrix=$j,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $O=this._getlocalMatrix(),$V=0;$V<16;++$V)this._worldMatrix[$V]=$O[$V];else $rO.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$O._setWorldMatrixNoUpdate=function($j){this._worldMatrix=$j},$O._setWorldMatrixIgnoreUpdate=function($j){this._worldMatrix=$j,this._worldUpdate=!1},$O.getLocalPosition=function(){return this._localPosition},$O.setLocalPosition=function($j){if(this._parent)this._localPosition=$j,this._localUpdate=!0,this._onWorldTransform();else{var $O=this._entity.owner._transform,$V=this._entity.localPosition,$l=$V.elements;$l[0]=$j[0],$l[1]=$j[1],$l[2]=$j[2],$O.localPosition=$V}},$O.getLocalRotation=function(){if(this._localQuaternionUpdate){var $j=this._localRotationEuler;$rO._quaternionCreateFromYawPitchRollArray($j[1]/$T._angleToRandin,$j[0]/$T._angleToRandin,$j[2]/$T._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$O.setLocalRotation=function($j){if(this._parent)this._localRotation=$j,$rO.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $O=this._entity.owner._transform,$V=this._entity.localRotation,$l=$V.elements;$l[0]=$j[0],$l[1]=$j[1],$l[2]=$j[2],$l[3]=$j[3],$O.localRotation=$V}},$O.getLocalScale=function(){return this._localScale},$O.setLocalScale=function($j){if(this._parent)this._localScale=$j,this._localUpdate=!0,this._onWorldTransform();else{var $O=this._entity.owner._transform,$V=this._entity.localScale,$l=$V.elements;$l[0]=$j[0],$l[1]=$j[1],$l[2]=$j[2],$O.localScale=$V}},$O.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$rO.getYawPitchRoll(this._localRotation,$T._tempVector3);var $j=$T._tempVector3,$O=this._localRotationEuler;$O[0]=$j[1]*$T._angleToRandin,$O[1]=$j[0]*$T._angleToRandin,$O[2]=$j[2]*$T._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$O.setLocalRotationEuler=function($j){if(this._parent)$rO._quaternionCreateFromYawPitchRollArray($j[1]/$T._angleToRandin,$j[0]/$T._angleToRandin,$j[2]/$T._angleToRandin,this._localRotation),this._localRotationEuler=$j,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $O=this._entity.owner._transform,$V=this._entity.localRotationEuler,$l=$V.elements;$l[0]=$j[0],$l[1]=$j[1],$l[2]=$j[2],$O.localRotationEuler=$V}},$O.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$rO.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $j=this._getlocalMatrix(),$O=0;$O<16;++$O)this._worldMatrix[$O]=$j[$O];this._worldUpdate=!1}return this._worldMatrix},$O.setParent=function($j){if(this._parent!==$j){if(this._parent){var $O=this._parent._childs,$V=$O.indexOf(this);$O.splice($V,1)}$j&&($j._childs.push(this),$j&&this._onWorldTransform()),this._parent=$j}},$e($T,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$T}(),$cO=function($j){function $O(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$O.__super.call(this),this._destroyed=!1,this._id=$O._uniqueIDCounter,$O._uniqueIDCounter++}$w($O,"laya.d3.component.Component3D",$S);var $V=$O.prototype;return $Z.imps($V,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$V._initialize=function($j){this._owner=$j,this._enable=!0,this.started=!1,this._load($j)},$V._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$V._load=function($j){},$V._start=function($j){},$V._update=function($j){},$V._lateUpdate=function($j){},$V._preRenderUpdate=function($j){},$V._postRenderUpdate=function($j){},$V._unload=function($j){this.offAll()},$V._cloneTo=function($j){},$s(0,$V,"id",function(){return this._id}),$s(0,$V,"destroyed",function(){return this._destroyed}),$s(0,$V,"owner",function(){return this._owner}),$s(0,$V,"enable",function(){return this._enable},function($j){this._enable!==$j&&(this._enable=$j,this.event("enablechanged",this._enable))}),$s(0,$V,"isSingleton",function(){return $O._isSingleton}),$O._isSingleton=!0,$O._uniqueIDCounter=1,$O}(),$AO=function($j){function $O(){this._destroyed=!1,$O.__super.call(this),this._destroyed=!1}$w($O,"laya.d3.core.GeometryFilter",$S);var $V=$O.prototype;return $Z.imps($V,{"laya.resource.IDestroy":!0}),$V._destroy=function(){this.offAll(),this._destroyed=!0},$s(0,$V,"_isAsyncLoaded",function(){return!0}),$s(0,$V,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$s(0,$V,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$s(0,$V,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$s(0,$V,"destroyed",function(){return this._destroyed}),$O}(),$ZO=function($j){function $l($j){$l.__super.call(this),this._id=++$l._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $Lj(new $mO,new $mO),this._boundingBoxCenter=new $mO,this._boundingSphere=new $Dj(new $mO,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$j,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$w($l,"laya.d3.core.render.BaseRender",$S);var $O=$l.prototype;return $Z.imps($O,{"laya.resource.IDestroy":!0}),$O._changeMaterialReference=function($j,$O){$j&&$j._removeReference(),$O._addReference()},$O._getInstanceMaterial=function($j,$O){var $V=new $j.constructor;return $j.cloneTo($V),$V.name=$V.name+"(Instance)",this._materialsInstance[$O]=!0,this._changeMaterialReference(this._materials[$O],$V),this._materials[$O]=$V},$O._setShaderValuelightMap=function($j){this._setShaderValueTexture(3,$j)},$O._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$O._renderRenderableBoundBox=function(){var $j=$hO._debugPhasorSprite,$O=this.boundingBox,$V=$l._tempBoundBoxCorners;$O.getCorners($V),$j.line($V[0],$l._greenColor,$V[1],$l._greenColor),$j.line($V[2],$l._greenColor,$V[3],$l._greenColor),$j.line($V[4],$l._greenColor,$V[5],$l._greenColor),$j.line($V[6],$l._greenColor,$V[7],$l._greenColor),$j.line($V[0],$l._greenColor,$V[3],$l._greenColor),$j.line($V[1],$l._greenColor,$V[2],$l._greenColor),$j.line($V[2],$l._greenColor,$V[6],$l._greenColor),$j.line($V[3],$l._greenColor,$V[7],$l._greenColor),$j.line($V[0],$l._greenColor,$V[4],$l._greenColor),$j.line($V[1],$l._greenColor,$V[5],$l._greenColor),$j.line($V[4],$l._greenColor,$V[7],$l._greenColor),$j.line($V[5],$l._greenColor,$V[6],$l._greenColor)},$O._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$O._calculateBoundingBox=function(){throw"BaseRender: must override it."},$O._setShaderValueTexture=function($j,$O){this._owner._shaderValues.setValue($j,$O)},$O._setShaderValueMatrix4x4=function($j,$O){this._owner._shaderValues.setValue($j,$O?$O.elements:null)},$O._setShaderValueColor=function($j,$O){this._owner._shaderValues.setValue($j,$O?$O.elements:null)},$O._setShaderValueBuffer=function($j,$O){this._owner._shaderValues.setValue($j,$O)},$O._setShaderValueInt=function($j,$O){this._owner._shaderValues.setValue($j,$O)},$O._setShaderValueBool=function($j,$O){this._owner._shaderValues.setValue($j,$O)},$O._setShaderValueNumber=function($j,$O){this._owner._shaderValues.setValue($j,$O)},$O._setShaderValueVector2=function($j,$O){this._owner._shaderValues.setValue($j,$O?$O.elements:null)},$O._addShaderDefine=function($j){this._owner._shaderDefineValue|=$j},$O._removeShaderDefine=function($j){this._owner._shaderDefineValue&=~$j},$O._renderUpdate=function($j){return!0},$O._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $j=this._owner.scene;if($j){var $O=$j.getlightmaps()[this._lightmapIndex];$O?(this._addShaderDefine($yO.SAHDERDEFINE_LIGHTMAP),$O.loaded?this._setShaderValuelightMap($O):$O.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($yO.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($yO.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($yO.SAHDERDEFINE_LIGHTMAP)},$O._updateOctreeNode=function(){var $j=this._treeNode;$j&&this._octreeNodeNeedChange&&($j.updateObject(this),this._octreeNodeNeedChange=!1)},$O._destroy=function(){this.offAll();var $j=0,$O=0;for($j=0,$O=this._renderElements.length;$j<$O;$j++)this._renderElements[$j]._destroy();for($j=0,$O=this._materials.length;$j<$O;$j++)this._materials[$j]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$s(0,$O,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$s(0,$O,"id",function(){return this._id}),$s(0,$O,"material",function(){var $j=this._materials[0];if($j&&!this._materialsInstance[0]){var $O=this._getInstanceMaterial($j,0);this.event("materialchanged",[this,0,$O])}return this._materials[0]},function($j){this.sharedMaterial=$j}),$s(0,$O,"sharedMaterial",function(){return this._materials[0]},function($j){var $O=this._materials[0];$O!==$j&&(this._materials[0]=$j,this._materialsInstance[0]=!1,this._changeMaterialReference($O,$j),this.event("materialchanged",[this,0,$j]))}),$s(0,$O,"lightmapIndex",function(){return this._lightmapIndex},function($j){this._lightmapIndex=$j,this._applyLightMapParams()}),$s(0,$O,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($j){this._lightmapScaleOffset=$j,this._setShaderValueColor(2,$j),this._addShaderDefine($yO.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$s(0,$O,"enable",function(){return this._enable},function($j){this._enable=$j,this.event("enablechanged",[this,$j])}),$s(0,$O,"materials",function(){for(var $j=0,$O=this._materials.length;$j<$O;$j++)if(!this._materialsInstance[$j]){var $V=this._getInstanceMaterial(this._materials[$j],$j);this.event("materialchanged",[this,$j,$V])}return this._materials.slice()},function($j){this.sharedMaterials=$j}),$s(0,$O,"sharedMaterials",function(){return this._materials.slice()},function($j){if(!$j)throw new Error("MeshRender: shadredMaterials value can't be null.");var $O=$j.length;this._materialsInstance.length=$O;for(var $V=0;$V<$O;$V++){var $l=this._materials[$V];$l!==$j[$V]&&(this._materialsInstance[$V]=!1,this._changeMaterialReference($l,$j[$V]),this.event("materialchanged",[this,$V,$j[$V]]))}this._materials=$j}),$s(0,$O,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$s(0,$O,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $j=this.boundingBox;$mO.add($j.min,$j.max,this._boundingBoxCenter),$mO.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$s(0,$O,"receiveShadow",function(){return this._receiveShadow},function($j){this._receiveShadow!==$j&&((this._receiveShadow=$j)?this._addShaderDefine($wO.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($wO.SHADERDEFINE_RECEIVE_SHADOW))}),$s(0,$O,"destroyed",function(){return this._destroyed}),$l._uniqueIDCounter=0,$e($l,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO,new $mO]},"_greenColor",function(){return this._greenColor=new $pO(0,1,0,1)}]),$l}(),$xO=function($j){function $p($j){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$p.__super.call(this),this._localPosition=new $mO,this._localRotation=new $VO(0,0,0,1),this._localScale=new $mO(1,1,1),this._localRotationEuler=new $mO,this._localMatrix=new $jO,this._position=new $mO,this._rotation=new $VO(0,0,0,1),this._scale=new $mO(1,1,1),this._worldMatrix=new $jO,this._forward=new $mO,this._up=new $mO,this._right=new $mO,this._owner=$j,this._childs=[]}$w($p,"laya.d3.core.Transform3D",$S);var $O=$p.prototype;return $O._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$jO.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $j=$p._tempVector30;$mO.multiply(this.pivot,this._localScale,$j);var $O=$p._tempVector31;$mO.subtract($j,this.pivot,$O);var $V=$p._tempVector32,$l=this.localRotation;$mO.transformQuat($j,$l,$V),$mO.subtract($V,$j,$V);var $T=$p._tempVector33;$mO.subtract(this._localPosition,$O,$T),$mO.subtract($T,$V,$T),$jO.createAffineTransformation($T,$l,this._localScale,this._localMatrix)}},$O._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldPositionRotationTransform()}},$O._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldPositionScaleTransform()}},$O._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldPositionTransform()}},$O._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldPositionRotationTransform()}},$O._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldPositionScaleTransform()}},$O._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._onWorldTransform()}},$O.translate=function($j,$O){void 0===$O&&($O=!0),$O?($jO.createFromQuaternion(this.localRotation,$p._tempMatrix0),$mO.transformCoordinate($j,$p._tempMatrix0,$p._tempVector30),$mO.add(this.localPosition,$p._tempVector30,this._localPosition),this.localPosition=this._localPosition):($mO.add(this.position,$j,this._position),this.position=this._position)},$O.rotate=function($j,$O,$V){var $l;void 0===$O&&($O=!0),void 0===$V&&($V=!0),$l=$V?$j:($mO.scale($j,Math.PI/180,$p._tempVector30),$p._tempVector30),$VO.createFromYawPitchRoll($l.y,$l.x,$l.z,$p._tempQuaternion0),$O?($VO.multiply(this._localRotation,$p._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($VO.multiply($p._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$O.lookAt=function($j,$O,$V){void 0===$V&&($V=!1);var $l,$T=$j.elements;if($V){if($l=this._localPosition.elements,Math.abs($l[0]-$T[0])<$Ij.zeroTolerance&&Math.abs($l[1]-$T[1])<$Ij.zeroTolerance&&Math.abs($l[2]-$T[2])<$Ij.zeroTolerance)return;$VO.lookAt(this._localPosition,$j,$O,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $S=this.position;if($l=$S.elements,Math.abs($l[0]-$T[0])<$Ij.zeroTolerance&&Math.abs($l[1]-$T[1])<$Ij.zeroTolerance&&Math.abs($l[2]-$T[2])<$Ij.zeroTolerance)return;$VO.lookAt($S,$j,$O,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$s(0,$O,"_isFrontFaceInvert",function(){var $j=this.scale,$O=$j.x<0;return $j.y<0&&($O=!$O),$j.z<0&&($O=!$O),$O}),$s(0,$O,"owner",function(){return this._owner}),$s(0,$O,"localRotation",function(){if(this._localQuaternionUpdate){var $j=this._localRotationEuler.elements;$VO.createFromYawPitchRoll($j[1]/$p._angleToRandin,$j[0]/$p._angleToRandin,$j[2]/$p._angleToRandin,this._localRotation)}return this._localRotation},function($j){this._localRotation=$j,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$s(0,$O,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$jO.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($j){null===this._parent?$j.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$jO.multiply(this._localMatrix,$j,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$j,this._worldUpdate=!1}),$s(0,$O,"worldNeedUpdate",function(){return this._worldUpdate}),$s(0,$O,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($j){this._localMatrix=$j,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$s(0,$O,"dummy",function(){return this._dummy},function($j){this._dummy!==$j&&(this._dummy&&(this._dummy._entity=null),$j&&($j._entity=this),this._dummy=$j)}),$s(0,$O,"localPosition",function(){return this._localPosition},function($j){this._localPosition=$j,this._localUpdate=!0,this._onWorldPositionTransform()}),$s(0,$O,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $j=this._parent.position;$mO.multiply(this._localPosition,this._parent.scale,$p._tempVector30),$mO.transformQuat($p._tempVector30,this._parent.rotation,$p._tempVector30),$mO.add($j,$p._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($j){if(null!=this._parent){$mO.subtract($j,this._parent.position,this._localPosition);var $O=this._parent.scale.elements,$V=$O[0],$l=$O[1],$T=$O[2];if(1!==$V||1!==$l||1!==$T){var $S=$p._tempVector30,$m=$S.elements;$m[0]=1/$V,$m[1]=1/$l,$m[2]=1/$T,$mO.multiply(this._localPosition,$S,this._localPosition)}this._parent.rotation.invert($p._tempQuaternion0),$mO.transformQuat(this._localPosition,$p._tempQuaternion0,this._localPosition)}else $j.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$j,this._positionUpdate=!1}),$s(0,$O,"localScale",function(){return this._localScale},function($j){this._localScale=$j,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$s(0,$O,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($p._tempVector30);var $j=$p._tempVector30.elements,$O=this._localRotationEuler.elements;$O[0]=$j[1]*$p._angleToRandin,$O[1]=$j[0]*$p._angleToRandin,$O[2]=$j[2]*$p._angleToRandin}return this._localRotationEuler},function($j){this._localRotationEuler=$j,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$s(0,$O,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$VO.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($j){null!=this._parent?(this._parent.rotation.invert($p._tempQuaternion0),$VO.multiply($j,$p._tempQuaternion0,this._localRotation)):$j.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$j,this._rotationUpdate=!1}),$s(0,$O,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$mO.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($j){if(null!==this._parent){var $O=this._parent.scale.elements,$V=$p._tempVector30.elements;$V[0]=1/$O[0],$V[1]=1/$O[1],$V[2]=1/$O[2],$mO.multiply($j,$p._tempVector30,this._localScale)}else $j.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$j,this._scaleUpdate=!1}),$s(0,$O,"rotationEuler",null,function($j){$VO.createFromYawPitchRoll($j.y,$j.x,$j.z,this._rotation),this.rotation=this._rotation}),$s(0,$O,"forward",function(){var $j=this.worldMatrix.elements;return this._forward.elements[0]=-$j[8],this._forward.elements[1]=-$j[9],this._forward.elements[2]=-$j[10],this._forward}),$s(0,$O,"up",function(){var $j=this.worldMatrix.elements;return this._up.elements[0]=$j[4],this._up.elements[1]=$j[5],this._up.elements[2]=$j[6],this._up}),$s(0,$O,"right",function(){var $j=this.worldMatrix.elements;return this._right.elements[0]=$j[0],this._right.elements[1]=$j[1],this._right.elements[2]=$j[2],this._right}),$s(0,$O,"parent",function(){return this._parent},function($j){if(this._parent!==$j){if(this._parent){var $O=this._parent._childs,$V=$O.indexOf(this);$O.splice($V,1)}$j&&($j._childs.push(this),$j&&this._onWorldTransform()),this._parent=$j}}),$e($p,["_tempVector30",function(){return this._tempVector30=new $mO},"_tempVector31",function(){return this._tempVector31=new $mO},"_tempVector32",function(){return this._tempVector32=new $mO},"_tempVector33",function(){return this._tempVector33=new $mO},"_tempQuaternion0",function(){return this._tempQuaternion0=new $VO},"_tempMatrix0",function(){return this._tempMatrix0=new $jO},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$p}(),$EO=(function($j){function $O(){this._rotation=0,this._matNeedUpdte=!1,$O.__super.call(this),this._matrix=new $jO,this._offset=new $SO,this._tiling=new $SO(1,1)}$w($O,"laya.d3.core.TransformUV",$S);var $V=$O.prototype;$Z.imps($V,{"laya.d3.core.IClone":!0}),$V._updateMatrix=function(){$O._tempOffsetV3.elements[0]=this._offset.x,$O._tempOffsetV3.elements[1]=this._offset.y,$VO.createFromYawPitchRoll(0,0,this._rotation,$O._tempRotationQua),$O._tempTitlingV3.elements[0]=this._tiling.x,$O._tempTitlingV3.elements[1]=this._tiling.y,$jO.createAffineTransformation($O._tempOffsetV3,$O._tempRotationQua,$O._tempTitlingV3,this._matrix)},$V.cloneTo=function($j){$j._matrix=this._matrix.clone(),$j._offset=this._offset.clone(),$j._rotation=this._rotation,$j._tiling=this._tiling.clone()},$V.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$V,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$s(0,$V,"tiling",function(){return this._tiling},function($j){this._tiling=$j,this._matNeedUpdte=!0}),$s(0,$V,"offset",function(){return this._offset},function($j){this._offset=$j,this._matNeedUpdte=!0}),$s(0,$V,"rotation",function(){return this._rotation},function($j){this._rotation=$j,this._matNeedUpdte=!0}),$e($O,["_tempOffsetV3",function(){return this._tempOffsetV3=new $mO(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $VO},"_tempTitlingV3",function(){return this._tempTitlingV3=new $mO(1,1,1)}])}(),function($V){function $j(){this.x=NaN,this.y=NaN,this.z=NaN,$j.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$w($j,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$V);var $O=$j.prototype;$O._getShapeBoundBox=function($j){var $O=$j.min.elements;$O[0]=.5*-this.x,$O[1]=.5*-this.y,$O[2]=.5*-this.z;var $V=$j.max.elements;$V[0]=.5*this.x,$V[1]=.5*this.y,$V[2]=.5*this.z},$O._getSpeedBoundBox=function($j){var $O=$j.min.elements;$O[0]=0,$O[1]=0,$O[2]=0;var $V=$j.max.elements;$V[0]=0,$V[1]=1,$V[2]=0},$O.generatePositionAndDirection=function($j,$O,$V,$l){var $T=$j.elements,$S=$O.elements;$V?($V.seed=$l[16],$J._randomPointInsideHalfUnitBox($j,$V),$l[16]=$V.seed):$J._randomPointInsideHalfUnitBox($j),$T[0]=this.x*$T[0],$T[1]=this.y*$T[1],$T[2]=this.z*$T[2],this.randomDirection?$V?($V.seed=$l[17],$J._randomPointUnitSphere($O,$V),$l[17]=$V.seed):$J._randomPointUnitSphere($O):($S[0]=0,$S[1]=0,$S[2]=1)},$O.cloneTo=function($j){$V.prototype.cloneTo.call(this,$j);var $O=$j;$O.x=this.x,$O.y=this.y,$O.z=this.z,$O.randomDirection=this.randomDirection}}($F),function($V){function $m(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$m.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$w($m,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$V);var $j=$m.prototype;$j._getShapeBoundBox=function($j){var $O=$j.min.elements;$O[0]=$O[2]=-this.radius,$O[1]=0;var $V=$j.max.elements;$V[0]=$V[2]=this.radius,$V[1]=0},$j._getSpeedBoundBox=function($j){var $O=$j.min.elements;$O[0]=$O[1]=-1,$O[2]=0;var $V=$j.max.elements;$V[0]=$V[1]=1,$V[2]=0},$j.generatePositionAndDirection=function($j,$O,$V,$l){var $T=$j.elements,$S=$m._tempPositionPoint.elements;$V?($V.seed=$l[16],this.emitFromEdge?$J._randomPointUnitArcCircle(this.arc,$m._tempPositionPoint,$V):$J._randomPointInsideUnitArcCircle(this.arc,$m._tempPositionPoint,$V),$l[16]=$V.seed):this.emitFromEdge?$J._randomPointUnitArcCircle(this.arc,$m._tempPositionPoint):$J._randomPointInsideUnitArcCircle(this.arc,$m._tempPositionPoint),$T[0]=-$S[0],$T[1]=$S[1],$T[2]=0,$mO.scale($j,this.radius,$j),this.randomDirection?$V?($V.seed=$l[17],$J._randomPointUnitSphere($O,$V),$l[17]=$V.seed):$J._randomPointUnitSphere($O):$j.cloneTo($O)},$j.cloneTo=function($j){$V.prototype.cloneTo.call(this,$j);var $O=$j;$O.radius=this.radius,$O.arc=this.arc,$O.emitFromEdge=this.emitFromEdge,$O.randomDirection=this.randomDirection},$e($m,["_tempPositionPoint",function(){return this._tempPositionPoint=new $SO}])}($F),function($V){function $t(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$t.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$w($t,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$V);var $j=$t.prototype;$j._getShapeBoundBox=function($j){var $O=this.radius+this.length*Math.sin(this.angle),$V=this.length*Math.cos(this.angle),$l=$j.min.elements;$l[0]=$l[1]=-$O,$l[2]=0;var $T=$j.max.elements;$T[0]=$T[1]=$O,$T[2]=$V},$j._getSpeedBoundBox=function($j){var $O=Math.sin(this.angle),$V=$j.min.elements;$V[0]=$V[1]=-$O,$V[2]=0;var $l=$j.max.elements;$l[0]=$V[1]=$O,$l[2]=1},$j.generatePositionAndDirection=function($j,$O,$V,$l){var $T,$S=$j.elements,$m=$O.elements,$p=$t._tempPositionPoint.elements,$o=NaN,$H=NaN,$g=Math.cos(this.angle),$e=Math.sin(this.angle);switch(this.emitType){case 0:$V?($V.seed=$l[16],$J._randomPointInsideUnitCircle($t._tempPositionPoint,$V),$l[16]=$V.seed):$J._randomPointInsideUnitCircle($t._tempPositionPoint),$o=$p[0],$H=$p[1],$S[0]=$o*this.radius,$S[1]=$H*this.radius,$S[2]=0,this.randomDirection?($V?($V.seed=$l[17],$J._randomPointInsideUnitCircle($t._tempDirectionPoint,$V),$l[17]=$V.seed):$J._randomPointInsideUnitCircle($t._tempDirectionPoint),$T=$t._tempDirectionPoint.elements,$m[0]=$T[0]*$e,$m[1]=$T[1]*$e):($m[0]=$o*$e,$m[1]=$H*$e),$m[2]=$g;break;case 1:$V?($V.seed=$l[16],$J._randomPointUnitCircle($t._tempPositionPoint,$V),$l[16]=$V.seed):$J._randomPointUnitCircle($t._tempPositionPoint),$o=$p[0],$H=$p[1],$S[0]=$o*this.radius,$S[1]=$H*this.radius,$S[2]=0,this.randomDirection?($V?($V.seed=$l[17],$J._randomPointInsideUnitCircle($t._tempDirectionPoint,$V),$l[17]=$V.seed):$J._randomPointInsideUnitCircle($t._tempDirectionPoint),$T=$t._tempDirectionPoint.elements,$m[0]=$T[0]*$e,$m[1]=$T[1]*$e):($m[0]=$o*$e,$m[1]=$H*$e),$m[2]=$g;break;case 2:$V?($V.seed=$l[16],$J._randomPointInsideUnitCircle($t._tempPositionPoint,$V)):$J._randomPointInsideUnitCircle($t._tempPositionPoint),$o=$p[0],$H=$p[1],$S[0]=$o*this.radius,$S[1]=$H*this.radius,$m[$S[2]=0]=$o*$e,$m[1]=$H*$e,$m[2]=$g,$mO.normalize($O,$O),$V?($mO.scale($O,this.length*$V.getFloat(),$O),$l[16]=$V.seed):$mO.scale($O,this.length*Math.random(),$O),$mO.add($j,$O,$j),this.randomDirection&&($V?($V.seed=$l[17],$J._randomPointUnitSphere($O,$V),$l[17]=$V.seed):$J._randomPointUnitSphere($O));break;case 3:$V?($V.seed=$l[16],$J._randomPointUnitCircle($t._tempPositionPoint,$V)):$J._randomPointUnitCircle($t._tempPositionPoint),$o=$p[0],$H=$p[1],$S[0]=$o*this.radius,$S[1]=$H*this.radius,$m[$S[2]=0]=$o*$e,$m[1]=$H*$e,$m[2]=$g,$mO.normalize($O,$O),$V?($mO.scale($O,this.length*$V.getFloat(),$O),$l[16]=$V.seed):$mO.scale($O,this.length*Math.random(),$O),$mO.add($j,$O,$j),this.randomDirection&&($V?($V.seed=$l[17],$J._randomPointUnitSphere($O,$V),$l[17]=$V.seed):$J._randomPointUnitSphere($O));break;default:throw new Error("ConeShape:emitType is invalid.")}},$j.cloneTo=function($j){$V.prototype.cloneTo.call(this,$j);var $O=$j;$O.angle=this.angle,$O.radius=this.radius,$O.length=this.length,$O.emitType=this.emitType,$O.randomDirection=this.randomDirection},$e($t,["_tempPositionPoint",function(){return this._tempPositionPoint=new $SO},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $SO}])}($F),function($V){function $j(){this.radius=NaN,this.emitFromShell=!1,$j.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$w($j,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$V);var $O=$j.prototype;$O._getShapeBoundBox=function($j){var $O=$j.min.elements;$O[0]=$O[1]=$O[2]=-this.radius;var $V=$j.max.elements;$V[0]=$V[1]=this.radius,$V[2]=0},$O._getSpeedBoundBox=function($j){var $O=$j.min.elements;$O[0]=$O[1]=-1,$O[2]=0;var $V=$j.max.elements;$V[0]=$V[1]=$V[2]=1},$O.generatePositionAndDirection=function($j,$O,$V,$l){var $T=$j.elements;$V?($V.seed=$l[16],this.emitFromShell?$J._randomPointUnitSphere($j,$V):$J._randomPointInsideUnitSphere($j,$V),$l[16]=$V.seed):this.emitFromShell?$J._randomPointUnitSphere($j):$J._randomPointInsideUnitSphere($j),$mO.scale($j,this.radius,$j);var $S=$T[2];$S<0&&($T[2]=-1*$S),this.randomDirection?$V?($V.seed=$l[17],$J._randomPointUnitSphere($O,$V),$l[17]=$V.seed):$J._randomPointUnitSphere($O):$j.cloneTo($O)},$O.cloneTo=function($j){$V.prototype.cloneTo.call(this,$j);var $O=$j;$O.radius=this.radius,$O.emitFromShell=this.emitFromShell,$O.randomDirection=this.randomDirection}}($F),function($V){function $j(){this.radius=NaN,this.emitFromShell=!1,$j.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$w($j,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$V);var $O=$j.prototype;$O._getShapeBoundBox=function($j){var $O=$j.min.elements;$O[0]=$O[1]=$O[2]=-this.radius;var $V=$j.max.elements;$V[0]=$V[1]=$V[2]=this.radius},$O._getSpeedBoundBox=function($j){var $O=$j.min.elements;$O[0]=$O[1]=$O[2]=-1;var $V=$j.max.elements;$V[0]=$V[1]=$V[2]=1},$O.generatePositionAndDirection=function($j,$O,$V,$l){$V?($V.seed=$l[16],this.emitFromShell?$J._randomPointUnitSphere($j,$V):$J._randomPointInsideUnitSphere($j,$V),$l[16]=$V.seed):this.emitFromShell?$J._randomPointUnitSphere($j):$J._randomPointInsideUnitSphere($j),$mO.scale($j,this.radius,$j),this.randomDirection?$V?($V.seed=$l[17],$J._randomPointUnitSphere($O,$V),$l[17]=$V.seed):$J._randomPointUnitSphere($O):$j.cloneTo($O)},$O.cloneTo=function($j){$V.prototype.cloneTo.call(this,$j);var $O=$j;$O.radius=this.radius,$O.emitFromShell=this.emitFromShell,$O.randomDirection=this.randomDirection}}($F),function($j){function $O(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$O.__super.call(this)}return $w($O,"laya.d3.core.render.SubMeshRenderElement",$W),$O}()),$UO=function($j){function $r($j,$O,$V,$l,$T,$S){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$j,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$wO.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$yO.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$yO.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$BO.SHADERDEFINE_ALPHATEST]="ALPHATEST";$r.__super.call(this,$j,$O,$V,null,{}),this._attributeMap=$l;var $m;for($m in $T){var $p=$T[$m];switch($p[1]){case 0:this._renderElementUniformMap[$m]=$p[0];break;case 1:this._materialUniformMap[$m]=$p[0];break;case 2:this._spriteUniformMap[$m]=$p[0];break;case 3:this._cameraUniformMap[$m]=$p[0];break;case 4:this._sceneUniformMap[$m]=$p[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$w($r,"laya.d3.shader.ShaderCompile3D",$c);var $O=$r.prototype;return $O._definesToNameDic=function($j,$O){for(var $V={},$l=1,$T=0;$T<32&&!($j<($l=1<<$T));$T++)if($j&$l){var $S=$O[$l];$S&&($V[$S]="")}return $V},$O.withCompile=function($j,$O,$V,$l){var $T,$S,$m;if($S=this.sharders[$j])if($m=$S[$O]){if($T=$m[$V])return $T}else $m=$S[$O]=[];else $m=($S=this.sharders[$j]=[])[$O]=[];var $p,$o=this._definesToNameDic($j,$r._globalInt2name),$H=this._definesToNameDic($O,this._spriteInt2name),$g=this._definesToNameDic($V,this._materialInt2name),$e={},$t="";if($o)for($p in $o)$t+="#define "+$p+"\n",$e[$p]=!0;if($H)for($p in $H)$t+="#define "+$p+"\n",$e[$p]=!0;if($g)for($p in $g)$t+="#define "+$p+"\n",$e[$p]=!0;var $w=$kO.nameKey.getName(this._name)+" compile ("+$j+","+$O+","+$V+")",$s=this._VS.toscript($e,[]),$b=this._PS.toscript($e,[]);$Y.now();if($T=$kO.create($t+$s.join("\n"),$t+$b.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$l,$w),$m[$V]=$T,laya.d3.shader.ShaderCompile3D.debugMode)$Y.now();return $T},$O.precompileShaderWithShaderDefine=function($j,$O,$V){this.withCompile($j,$O,$V,!0)},$O.addMaterialDefines=function($j){var $O=$j.defines;for(var $V in $O){var $l=$O[$V],$T=parseInt($V);this._materialInt2name[$T]=$l,this._materialName2Int[$l]=$T}},$O.addSpriteDefines=function($j){var $O=$j.defines;for(var $V in $O){var $l=$O[$V],$T=parseInt($V);this._spriteInt2name[$T]=$l,this._spriteName2Int[$l]=$T}},$O.getMaterialDefineByName=function($j){return this._materialName2Int[$j]},$O.registerMaterialDefine=function($j){var $O=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$O]=$j,this._materialName2Int[$j]=$O},$O.registerSpriteDefine=function($j){var $O=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$O]=$j,this._spriteName2Int[$j]=$O},$r._globalRegDefine=function($j,$O){$r._globalInt2name[$O]=$j},$r.add=function($j,$O,$V,$l,$T){return laya.d3.shader.ShaderCompile3D._preCompileShader[$j]=new $r($j,$O,$V,$l,$T,$c.includes)},$r.get=function($j){return laya.d3.shader.ShaderCompile3D._preCompileShader[$kO.nameKey.getID($j)]},$r._preCompileShader={},$r._globalInt2name=[],$r.debugMode=!1,$r.SHADERDEFINE_HIGHPRECISION=1,$r.SHADERDEFINE_FOG=4,$r.SHADERDEFINE_DIRECTIONLIGHT=8,$r.SHADERDEFINE_POINTLIGHT=16,$r.SHADERDEFINE_SPOTLIGHT=32,$r.SHADERDEFINE_UV0=64,$r.SHADERDEFINE_COLOR=128,$r.SHADERDEFINE_UV1=256,$r.SAHDERDEFINE_DEPTHFOG=131072,$r}(),$zO=function($j){function $s(){$s.__super.call(this)}$w($s,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$lj);var $O=$s.prototype;return $O._getStaticBatch=function($j,$O,$V,$l){var $T,$S;return $S=$j?$j.id.toString()+$V.id.toString()+$O.id.toString()+$l.toString():$V.id.toString()+$O.id.toString()+$l.toString(),this._staticBatches[$S]?$T=this._staticBatches[$S]:this._staticBatches[$S]=$T=new $$O($S,this,$j,$O,$V),$T},$O._initStaticBatchs=function($j){var $O,$V;this._initBatchRenderElements.sort($s._sortPrepareStaticBatch);for(var $l,$T=!1,$S=0,$m=0,$p=this._initBatchRenderElements.length;$m<$p;$m++){var $o,$H=this._initBatchRenderElements[$m],$g=$H.renderObj._getVertexBuffer(0);$H._sprite3D;if($V===$g.vertexDeclaration&&$O===$H._material)if($T)$l._addCombineBatchRenderObjTest($H)?($o=$H._staticBatch)!==$l&&($o&&$o._deleteCombineBatchRenderObj($H),$l._addCombineBatchRenderObj($H)):($T=!1,$S++);else{var $e=this._initBatchRenderElements[$m-1],$t=$e.renderObj,$w=$H.renderObj;$T=!(65535<$t._getVertexBuffer().vertexCount+$w._getVertexBuffer().vertexCount)&&($l=this._getStaticBatch($j,$V,$O,$S),($o=$e._staticBatch)!==$l&&($o&&$o._deleteCombineBatchRenderObj($e),$l._addCombineBatchRenderObj($e)),($o=$H._staticBatch)!==$l&&($o&&$o._deleteCombineBatchRenderObj($H),$l._addCombineBatchRenderObj($H)),!0)}else $T=!1,$S=0;$O=$H._material,$V=$g.vertexDeclaration}},$s._sortPrepareStaticBatch=function($j,$O){var $V=$j._render,$l=$O._render,$T=$V.lightmapIndex-$l.lightmapIndex;if(0!=$T)return $T;var $S=$V.receiveShadow-$l.receiveShadow;if(0!=$S)return $S;var $m=$j._mainSortID-$O._mainSortID;return 0==$m?$j.renderObj.triangleCount-$O.renderObj.triangleCount:$m},$s}(),$$O=function($j){function $S($j,$O,$V,$l,$T){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$S.__super.call(this,$j,$O,$V),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$l,this._material=$T}$w($S,"laya.d3.graphics.SubMeshStaticBatch",$Tj);var $O=$S.prototype;return $O._compareBatchRenderElement=function($j,$O){return $j._batchIndexStart>$O._batchIndexStart},$O._addCombineBatchRenderObjTest=function($j){var $O=$j.renderObj._vertexCount;return!(65535<(0<$O?this._currentCombineVertexCount+$O:this._currentCombineVertexCount+$j.renderObj._getVertexBuffer().vertexCount))},$O._addCombineBatchRenderObj=function($j){var $O=$j.renderObj,$V=$O._vertexCount;this._initBatchRenderElements.push($j),$j._staticBatch=this,0<$V?(this._currentCombineIndexCount+=$O._indexCount,this._currentCombineVertexCount+=$V):(this._currentCombineIndexCount=this._currentCombineIndexCount+$O._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$O._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$O._deleteCombineBatchRenderObj=function($j){var $O=$j.renderObj,$V=this._initBatchRenderElements.indexOf($j);if(-1!==$V){this._initBatchRenderElements.splice($V,1),$j._staticBatch=null;var $l=$O._vertexCount;0<$l?(this._currentCombineIndexCount=this._currentCombineIndexCount-$O._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$l):(this._currentCombineIndexCount=this._currentCombineIndexCount-$O._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$O._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$O._finishInit=function(){if(this._needFinishCombine){var $j=0,$O=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $V=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$l=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$FO.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$GO.create("ushort",this._currentCombineIndexCount,35044);for(var $T=0,$S=this._initBatchRenderElements.length;$T<$S;$T++){var $m=this._initBatchRenderElements[$T],$p=$m.renderObj,$o=$p._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$m._sprite3D),$H=$p.getIndices(),$g=$m._sprite3D.transform._isFrontFaceInvert,$e=$j/(this._vertexDeclaration.vertexStride/4)-$p._vertexStart,$t=$O,$w=$t+$H.length;$m._batchIndexStart=$t,$m._batchIndexEnd=$w,$l.set($H,$O);var $s=0;if($g)for($s=$t;$s<$w;$s+=3){$l[$s]=$e+$l[$s];var $b=$l[$s+1],$r=$l[$s+2];$l[$s+1]=$e+$r,$l[$s+2]=$e+$b}else for($s=$t;$s<$w;$s+=3)$l[$s]=$e+$l[$s],$l[$s+1]=$e+$l[$s+1],$l[$s+2]=$e+$l[$s+2];$O+=$H.length,$V.set($o,$j),$j+=$o.length}this._vertexBuffer.setData($V),this._indexBuffer.setData($l),this._needFinishCombine=!1}},$O._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $EO)},$O._getRenderElement=function($j,$O,$V){for(var $l,$T,$S=this._batchRenderElements.length,$m=!0,$p=0;$p<$S;$p++){var $o,$H,$g=($T=this._batchRenderElements[$p])._sprite3D._render;if(0!==$p&&($m=($o=($l=this._batchRenderElements[$p-1])._sprite3D._render).lightmapIndex!==$g.lightmapIndex||$o.receiveShadow!==$g.receiveShadow||$l._batchIndexEnd!==$T._batchIndexStart),$m){($H=this._getCombineRenderElementFromPool()).renderObj=this,$H._material=this._material,$H._batchIndexStart=$T._batchIndexStart,$H._batchIndexEnd=$T._batchIndexEnd;var $e=$g.lightmapIndex,$t=$e+1,$w=this._batchOwnerIndices[$t];$w||($w=this._batchOwnerIndices[$t]=[]);var $s,$b=$w[$T._render.receiveShadow?1:0];void 0===$b?($w[$g.receiveShadow?1:0]=this._batchOwners.length,($s=new $KO(null,"StaticBatchMeshSprite3D"))._scene=$O,$s._transform=this._rootOwner?this._rootOwner._transform:null,$s._render.lightmapIndex=$e,$s._render.receiveShadow=$T._render.receiveShadow,this._batchOwners.push($s)):$s=this._batchOwners[$b],$s._render._renderUpdate($V),$H._sprite3D=$s,$j.push($H)}else $H._batchIndexEnd=$T._batchIndexEnd}},$O._beforeRender=function($j){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$O._render=function($j){var $O=$j.renderElement,$V=$O._batchIndexStart,$l=$O._batchIndexEnd-$V;$M.mainContext.drawElements(4,$l,5123,2*$V),$U.drawCall++,$U.trianglesFaces+=$l/3},$O.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$O._getVertexBuffer=function($j){return void 0===$j&&($j=0),this._vertexBuffer},$S}(),$_O=function($j){function $O(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$O.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$w($O,"laya.d3.core.ComponentNode",$H);var $V=$O.prototype;return $V.addComponent=function($j){var $O,$V=this._componentsMap.indexOf($j);if(-1===$V)$O=[],this._componentsMap.push($j),this._typeComponentsIndices.push($O);else if($O=this._typeComponentsIndices[$V],this._components[$O[0]].isSingleton)throw new Error("无法单实例创建"+$j+"组件，"+$j+"组件已存在！");var $l=$T.getInstance($j);return $O.push(this._components.length),this._components.push($l),$l instanceof laya.d3.component.Script&&this._scripts.push($l),$l._initialize(this),$l},$V._removeComponent=function($j,$O){var $V=this._typeComponentsIndices[$j],$l=$V[$O],$T=this._components[$l];this._components.splice($l,1),$T instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($T),1),$V.splice($O,1),0===$V.length&&(this._typeComponentsIndices.splice($j,1),this._componentsMap.splice($j,1));for(var $S=0,$m=this._componentsMap.length;$S<$m;$S++)for(var $p=($V=this._typeComponentsIndices[$S]).length-1;0<=$p;$p--){var $o=$V[$p];if(!($l<$o))break;$V[$p]=--$o}$T._destroy()},$V.getComponentByType=function($j,$O){void 0===$O&&($O=0);var $V=this._componentsMap.indexOf($j);return-1===$V?null:this._components[this._typeComponentsIndices[$V][$O]]},$V.getComponentsByType=function($j,$O){var $V=this._componentsMap.indexOf($j);if(-1!==$V){var $l=this._typeComponentsIndices[$V],$T=$l.length;$O.length=$T;for(var $S=0;$S<$T;$S++)$O[$S]=this._components[$l[$S]]}else $O.length=0},$V.getComponentByIndex=function($j){return this._components[$j]},$V.removeComponentByType=function($j,$O){void 0===$O&&($O=0);var $V=this._componentsMap.indexOf($j);-1!==$V&&this._removeComponent($V,$O)},$V.removeComponentsByType=function($j){var $O=this._componentsMap.indexOf($j);if(-1!==$O)for(var $V=this._typeComponentsIndices[$O],$l=0,$T=$V.length;$l<$T;$V.length<$T?$T--:$l++)this._removeComponent($O,$l)},$V.removeAllComponent=function(){for(var $j=0,$O=this._componentsMap.length;$j<$O;this._componentsMap.length<$O?$O--:$j++)this.removeComponentsByType(this._componentsMap[$j])},$V._updateComponents=function($j){for(var $O=0,$V=this._components.length;$O<$V;$O++){var $l=this._components[$O];!$l.started&&($l._start($j),$l.started=!0),$l.enable&&$l._update($j)}},$V._lateUpdateComponents=function($j){for(var $O=0;$O<this._components.length;$O++){var $V=this._components[$O];!$V.started&&($V._start($j),$V.started=!0),$V.enable&&$V._lateUpdate($j)}},$V._preRenderUpdateComponents=function($j){for(var $O=0;$O<this._components.length;$O++){var $V=this._components[$O];!$V.started&&($V._start($j),$V.started=!0),$V.enable&&$V._preRenderUpdate($j)}},$V._postRenderUpdateComponents=function($j){for(var $O=0;$O<this._components.length;$O++){var $V=this._components[$O];!$V.started&&($V._start($j),$V.started=!0),$V.enable&&$V._postRenderUpdate($j)}},$O}(),$BO=function($l){function $j(){$j.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $tO,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $pO(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$w($j,"laya.d3.core.material.BaseMaterial",$l);var $O=$j.prototype;return $Z.imps($O,{"laya.d3.core.IClone":!0}),$O._addShaderDefine=function($j){this._shaderDefineValue|=$j},$O._removeShaderDefine=function($j){this._shaderDefineValue&=~$j},$O._addDisablePublicShaderDefine=function($j){this._disablePublicShaderDefine|=$j},$O._removeDisablePublicShaderDefine=function($j){this._disablePublicShaderDefine&=~$j},$O._setBuffer=function($j,$O){this._shaderValues.setValue($j,$O),this._values[$j]=$O},$O._getBuffer=function($j){return this._values[$j]},$O._setMatrix4x4=function($j,$O){this._shaderValues.setValue($j,$O?$O.elements:null),this._values[$j]=$O},$O._getMatrix4x4=function($j){return this._values[$j]},$O._setInt=function($j,$O){this._shaderValues.setValue($j,$O),this._values[$j]=$O},$O._getInt=function($j){return this._values[$j]},$O._setNumber=function($j,$O){this._shaderValues.setValue($j,$O),this._values[$j]=$O},$O._getNumber=function($j){return this._values[$j]},$O._setBool=function($j,$O){this._shaderValues.setValue($j,$O),this._values[$j]=$O},$O._getBool=function($j){return this._values[$j]},$O._setVector2=function($j,$O){this._shaderValues.setValue($j,$O?$O.elements:null),this._values[$j]=$O},$O._getVector2=function($j){return this._values[$j]},$O._setColor=function($j,$O){this._shaderValues.setValue($j,$O?$O.elements:null),this._values[$j]=$O},$O._getColor=function($j){return this._values[$j]},$O._setTexture=function($j,$O){var $V=this._values[$j];this._values[$j]=$O,this._shaderValues.setValue($j,$O),0<this.referenceCount&&($V&&$V._removeReference(),$O&&$O._addReference())},$O._getTexture=function($j){return this._values[$j]},$O._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$O._getShader=function($j,$O,$V){var $l=($j|$O)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($l,$V,this._shaderDefineValue),this._shader},$O._setRenderStateBlendDepth=function(){var $j=$M.mainContext;switch($v.setDepthMask($j,this.depthWrite),0===this.depthTest?$v.setDepthTest($j,!1):($v.setDepthTest($j,!0),$v.setDepthFunc($j,this.depthTest)),this.blend){case 0:$v.setBlend($j,!1);break;case 1:$v.setBlend($j,!0),$v.setBlendFunc($j,this.srcBlend,this.dstBlend);break;case 2:$v.setBlend($j,!0)}},$O._setRenderStateFrontFace=function($j,$O){var $V=$M.mainContext,$l=0;switch(this.cull){case 0:$v.setCullFace($V,!1);break;case 1:$v.setCullFace($V,!0),$l=$j?$O&&$O._isFrontFaceInvert?2305:2304:$O&&$O._isFrontFaceInvert?2304:2305,$v.setFrontFace($V,$l);break;case 2:$v.setCullFace($V,!0),$l=$j?$O&&$O._isFrontFaceInvert?2304:2305:$O&&$O._isFrontFaceInvert?2305:2304,$v.setFrontFace($V,$l)}},$O.onAsynLoaded=function($j,$O,$V){var $l=$O[0],$T=$O[1];switch($l.version){case"LAYAMATERIAL:01":var $S=0,$m=0,$p=$l.props;for(var $o in $p)switch($o){case"vectors":var $H=$p[$o];for($S=0,$m=$H.length;$S<$m;$S++){var $g=$H[$S],$e=$g.value;switch($e.length){case 2:this[$g.name]=new $SO($e[0],$e[1]);break;case 3:this[$g.name]=new $mO($e[0],$e[1],$e[2]);break;case 4:this[$g.name]=new $pO($e[0],$e[1],$e[2],$e[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $t=$p[$o];for($S=0,$m=$t.length;$S<$m;$S++){var $w=$t[$S],$s=$w.path;$s&&(this[$w.name]=$h.getRes($T[$s]))}break;case"defines":var $b=$p[$o];for($S=0,$m=$b.length;$S<$m;$S++){var $r=this._shaderCompile.getMaterialDefineByName($b[$S]);this._addShaderDefine($r)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$o]=$p[$o];break;case"renderQueue":switch($p[$o]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$o]=$p[$o]}break;case"LAYAMATERIAL:02":for($o in $p=$l.props)switch($o){case"vectors":for($S=0,$m=($H=$p[$o]).length;$S<$m;$S++)switch(($e=($g=$H[$S]).value).length){case 2:this[$g.name]=new $SO($e[0],$e[1]);break;case 3:this[$g.name]=new $mO($e[0],$e[1],$e[2]);break;case 4:this[$g.name]=new $pO($e[0],$e[1],$e[2],$e[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($S=0,$m=($t=$p[$o]).length;$S<$m;$S++)($s=($w=$t[$S]).path)&&(this[$w.name]=$h.getRes($T[$s]));break;case"defines":for($S=0,$m=($b=$p[$o]).length;$S<$m;$S++)$r=this._shaderCompile.getMaterialDefineByName($b[$S]),this._addShaderDefine($r);break;default:this[$o]=$p[$o]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$O._addReference=function(){$l.prototype._addReference.call(this);for(var $j=0,$O=this._values.length;$j<$O;$j++){var $V=this._values[$j];$V&&$V instanceof laya.d3.resource.BaseTexture&&$V._addReference()}},$O._removeReference=function(){$l.prototype._removeReference.call(this);for(var $j=0,$O=this._values.length;$j<$O;$j++){var $V=this._values[$j];$V&&$V instanceof laya.d3.resource.BaseTexture&&$V._removeReference()}},$O.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$O.setShaderName=function($j){var $O=$kO.nameKey.getID($j);if(-1===$O)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$UO._preCompileShader[$O]},$O.cloneTo=function($j){var $O=$j;$O.name=this.name,$O.cull=this.cull,$O.blend=this.blend,$O.srcBlend=this.srcBlend,$O.dstBlend=this.dstBlend,$O.srcBlendRGB=this.srcBlendRGB,$O.dstBlendRGB=this.dstBlendRGB,$O.srcBlendAlpha=this.srcBlendAlpha,$O.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($O.blendConstColor),$O.blendEquation=this.blendEquation,$O.blendEquationRGB=this.blendEquationRGB,$O.blendEquationAlpha=this.blendEquationAlpha,$O.depthTest=this.depthTest,$O.depthWrite=this.depthWrite,$O.renderQueue=this.renderQueue,$O._shader=this._shader,$O._disablePublicShaderDefine=this._disablePublicShaderDefine,$O._shaderDefineValue=this._shaderDefineValue;var $V,$l=0,$T=$O._shaderValues;$O._shaderValues.data.length=this._shaderValues.data.length;var $S=this._values.length,$m=$O._values;for($l=0,$V=$m.length=$S;$l<$V;$l++){var $p=this._values[$l];if($p)if("number"==typeof $p)$m[$l]=$p,$T.data[$l]=$p;else if("number"==typeof $p&&Math.floor($p)==$p)$m[$l]=$p,$T.data[$l]=$p;else if("boolean"==typeof $p)$m[$l]=$p,$T.data[$l]=$p;else if($p instanceof laya.d3.math.Vector2){var $o=$m[$l]||($m[$l]=new $SO);$p.cloneTo($o),$T.data[$l]=$o.elements}else if($p instanceof laya.d3.math.Vector3){var $H=$m[$l]||($m[$l]=new $mO);$p.cloneTo($H),$T.data[$l]=$H.elements}else if($p instanceof laya.d3.math.Vector4){var $g=$m[$l]||($m[$l]=new $pO);$p.cloneTo($g),$T.data[$l]=$g.elements}else if($p instanceof laya.d3.math.Matrix4x4){var $e=$m[$l]||($m[$l]=new $jO);$p.cloneTo($e),$T.data[$l]=$e.elements}else $p instanceof laya.d3.resource.BaseTexture&&($m[$l]=$p,$T.data[$l]=$p)}},$O.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$s(0,$O,"alphaTestValue",function(){return this._getNumber(0)},function($j){this._setNumber(0,$j)}),$s(0,$O,"alphaTest",function(){return this._alphaTest},function($j){(this._alphaTest=$j)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$j.__init__=function(){$j.SHADERDEFINE_ALPHATEST=$j.shaderDefines.registerDefine("ALPHATEST")},$j.RENDERQUEUE_OPAQUE=2e3,$j.RENDERQUEUE_ALPHATEST=2450,$j.RENDERQUEUE_TRANSPARENT=3e3,$j.CULL_NONE=0,$j.CULL_FRONT=1,$j.CULL_BACK=2,$j.BLEND_DISABLE=0,$j.BLEND_ENABLE_ALL=1,$j.BLEND_ENABLE_SEPERATE=2,$j.BLENDPARAM_ZERO=0,$j.BLENDPARAM_ONE=1,$j.BLENDPARAM_SRC_COLOR=768,$j.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$j.BLENDPARAM_DST_COLOR=774,$j.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$j.BLENDPARAM_SRC_ALPHA=770,$j.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$j.BLENDPARAM_DST_ALPHA=772,$j.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$j.BLENDPARAM_SRC_ALPHA_SATURATE=776,$j.BLENDEQUATION_ADD=0,$j.BLENDEQUATION_SUBTRACT=1,$j.BLENDEQUATION_REVERSE_SUBTRACT=2,$j.DEPTHTEST_OFF=0,$j.DEPTHTEST_NEVER=512,$j.DEPTHTEST_LESS=513,$j.DEPTHTEST_EQUAL=514,$j.DEPTHTEST_LEQUAL=515,$j.DEPTHTEST_GREATER=516,$j.DEPTHTEST_NOTEQUAL=517,$j.DEPTHTEST_GEQUAL=518,$j.DEPTHTEST_ALWAYS=519,$j.SHADERDEFINE_ALPHATEST=1,$j.ALPHATESTVALUE=0,$e($j,["shaderDefines",function(){return this.shaderDefines=new $gO}]),$j}($r),$MO=function($j){function $O(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$O.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$w($O,"laya.d3.resource.BaseTexture",$r);var $V=$O.prototype;return $s(0,$V,"width",function(){return this._width}),$s(0,$V,"repeat",function(){return this._repeat},function($j){if(this._repeat!==$j&&(this._repeat=$j,this._source)){var $O=$M.mainContext;$v.bindTexture($O,this._type,this._source),$A.isPOT(this._width,this._height)&&this._repeat?($O.texParameteri(this._type,10242,10497),$O.texParameteri(this._type,10243,10497)):($O.texParameteri(this._type,10242,33071),$O.texParameteri(this._type,10243,33071))}}),$s(0,$V,"height",function(){return this._height}),$s(0,$V,"magFifter",function(){return this._magFifter},function($j){(this._magFifter=$j)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($j)}),$s(0,$V,"wrapModeV",function(){return this._wrapModeV}),$s(0,$V,"size",function(){return this._size}),$s(0,$V,"wrapModeU",function(){return this._wrapModeU}),$s(0,$V,"mipmap",function(){return this._mipmap},function($j){this._mipmap=$j,this._mipmap!=$j&&this._conchTexture&&this._conchTexture.setMipMap($j)}),$s(0,$V,"minFifter",function(){return this._minFifter},function($j){this._minFifter=$j,this._minFifter!=$j&&this._conchTexture&&this._conchTexture.setMinFifter($j)}),$s(0,$V,"format",function(){return this._format}),$s(0,$V,"source",function(){return this.activeResource(),this._source}),$s(0,$V,"defaulteTexture",function(){return $CO.grayTexture}),$O.WARPMODE_REPEAT=0,$O.WARPMODE_CLAMP=1,$O}(),$vO=function($j){function $O(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$O.__super.call(this),this._boundingBoxCorners=$l(8,null)}$w($O,"laya.d3.resource.models.BaseMesh",$r);var $V=$O.prototype;return $V._getPositions=function(){throw new Error("未Override,请重载该属性！")},$V._generateBoundingObject=function(){this._boundingSphere=new $Dj(new $mO,0),$Dj.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $Lj(new $mO,new $mO),$Lj.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$V.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$V.getRenderElement=function($j){throw new Error("未Override,请重载该属性！")},$s(0,$V,"subMeshCount",function(){return this._subMeshCount}),$s(0,$V,"boundingBox",function(){return this._boundingBox}),$s(0,$V,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$s(0,$V,"boundingSphere",function(){return this._boundingSphere}),$O}(),$YO=(function($j){function $O(){$O.__super.call(this)}$w($O,"laya.d3.component.Script",$cO);var $V=$O.prototype;$V.onTriggerEnter=function($j){},$V.onTriggerExit=function($j){},$V.onTriggerStay=function($j){},$s(0,$V,"isSingleton",function(){return $O._isSingleton}),$O._isSingleton=!1}(),function($j){function $O($j){this._owner=null,this._sharedMesh=null,$O.__super.call(this),this._owner=$j}$w($O,"laya.d3.core.MeshFilter",$j);var $V=$O.prototype;return $V._sharedMeshLoaded=function(){this.event("loaded")},$V._destroy=function(){$j.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$s(0,$V,"sharedMesh",function(){return this._sharedMesh},function($j){var $O=this._sharedMesh;$O&&$O._removeReference(),(this._sharedMesh=$j)._addReference(),this.event("meshchanged",[this,$O,$j]),$j.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$s(0,$V,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$s(0,$V,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$s(0,$V,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$s(0,$V,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$O}($AO)),$RO=function($j){function $O($j){$O.__super.call(this,$j),$j.meshFilter.on("meshchanged",this,this._onMeshChanged)}$w($O,"laya.d3.core.MeshRender",$ZO);var $V=$O.prototype;return $V._onMeshChanged=function($j,$O,$V){$V.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$V.once("loaded",this,this._onMeshLoaed)},$V._onMeshLoaed=function($j,$O){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$V._calculateBoundingSphereByInitSphere=function($j){var $O=NaN,$V=this._owner.transform,$l=$V.scale.elements,$T=Math.abs($l[0]),$S=Math.abs($l[1]),$m=Math.abs($l[2]);$O=$S<=$T&&$m<=$T?$T:$m<=$S?$S:$m,$mO.transformCoordinate($j.center,$V.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$j.radius*$O},$V._calculateBoundBoxByInitCorners=function($j){for(var $O=this._owner.transform.worldMatrix,$V=0;$V<8;$V++)$mO.transformCoordinate($j[$V],$O,$ZO._tempBoundBoxCorners[$V]);$Lj.createfromPoints($ZO._tempBoundBoxCorners,this._boundingBox)},$V._calculateBoundingSphere=function(){var $j=this._owner.meshFilter.sharedMesh;null==$j||null==$j.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($j.boundingSphere)},$V._calculateBoundingBox=function(){var $j=this._owner.meshFilter.sharedMesh;null==$j||null==$j.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($j.boundingBoxCorners)},$V._renderUpdate=function($j){var $O=this._owner.transform;if($O){this._setShaderValueMatrix4x4(0,$O.worldMatrix);var $V=this._owner.getProjectionViewWorldMatrix($j);this._setShaderValueMatrix4x4(1,$V)}else this._setShaderValueMatrix4x4(0,$jO.DEFAULT),this._setShaderValueMatrix4x4(1,$j);return $hO.debugMode&&this._renderRenderableBoundBox(),!0},$O}(),$qO=function($O){function $l(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$l.__super.call(this),this._renderState=new $d,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $tO,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $Oj,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $mO(.7,.7,.7),this.ambientColor=new $mO(.212,.227,.259),$M.shaderHighPrecision&&this.addShaderDefine($UO.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$w($l,"laya.d3.core.scene.Scene",$O);var $j=$l.prototype;return $Z.imps($j,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$j._setUrl=function($j){this._url=$j},$j._getGroup=function(){return this._group},$j._setGroup=function($j){this._group=$j},$j._display=function(){$Z.stage._scenes.push(this),$Z.stage._scenes.sort($l._sortScenes);for(var $j=0,$O=this._childs.length;$j<$O;$j++){var $V=this._childs[$j];$V.active&&$V._activeHierarchy()}},$j._unDisplay=function(){var $j=$Z.stage._scenes;$j.splice($j.indexOf(this),1);for(var $O=0,$V=this._childs.length;$O<$V;$O++){var $l=this._childs[$O];$l.active&&$l._inActiveHierarchy()}},$j._addChild3D=function($j){$j.transform._onWorldTransform(),$j._setBelongScene(this),this.displayedInStage&&$j.active&&$j._activeHierarchy()},$j._removeChild3D=function($j){$j.transform.parent=null,this.displayedInStage&&$j.active&&$j._inActiveHierarchy(),$j._setUnBelongScene()},$j.initOctree=function($j,$O,$V,$l,$T){void 0===$T&&($T=6),this.treeSize=new $mO($j,$O,$V),this.treeLevel=$T,this.treeRoot=new $L(this,0),this.treeRoot.init($l,this.treeSize)},$j._prepareUpdateToRenderState=function($j,$O){$O.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$O.scene=this},$j._prepareSceneToRender=function($j){var $O=this._lights.length;if(0<$O)for(var $V=0,$l=0;$l<$O&&!(this._lights[$l]._prepareToScene($j)&&++$V>=this._enableLightCount);$l++);},$j._updateChilds=function($j){for(var $O=0,$V=this._childs.length;$O<$V;++$O)this._childs[$O]._update($j)},$j._preRenderScene=function($j,$O,$V){var $l,$T=$O._viewMatrix,$S=$O._projectionMatrix,$m=$O._projectionViewMatrix,$p=0,$o=$O.camera;for($o.useOcclusionCulling?this.treeRoot?$Vj.renderObjectCullingOctree($V,this,$o,$T,$S,$m):$Vj.renderObjectCulling($V,this,$o,$T,$S,$m):$Vj.renderObjectCullingNoBoundFrustum(this,$o,$T,$S,$m),$p=0,$l=this._quenes.length;$p<$l;$p++)this._quenes[$p]&&this._quenes[$p]._preRender($O)},$j._clear=function($j,$O){var $V=$O._viewport,$l=$O.camera,$T=$V.x,$S=$l.renderTargetSize.height-$V.y-$V.height,$m=$V.width,$p=$V.height;$j.viewport($T,$S,$m,$p);var $o=256,$H=$l.renderTarget;switch($l.clearFlag){case 0:var $g=$l.clearColor;if($g){$j.enable(3089),$j.scissor($T,$S,$m,$p);var $e=$g.elements;$j.clearColor($e[0],$e[1],$e[2],$e[3]),$o|=16384}if($H)switch($g||($o=16384),$H.depthStencilFormat){case 33189:$o|=256;break;case 36168:$o|=1024;break;case 34041:$o|=256,$o|=1024}$j.clear($o),$g&&$j.disable(3089);break;case 1:case 2:if($H)switch($o=16384,$H.depthStencilFormat){case 33189:$o|=256;break;case 36168:$o|=1024;break;case 34041:$o|=256,$o|=1024}$j.clear($o);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$j._renderScene=function($j,$O){var $V,$l,$T=$O.camera,$S=0;for($S=0;$S<2;$S++)($l=this._quenes[$S])&&($T.renderTarget?$l._render($O,!0):$l._render($O,!1));if(1===$T.clearFlag){var $m=$T.sky;$m&&($v.setCullFace($j,!1),$v.setDepthFunc($j,515),$v.setDepthMask($j,!1),$m._render($O),$v.setDepthFunc($j,513),$v.setDepthMask($j,!0))}for($S=2,$V=this._quenes.length;$S<$V;$S++)($l=this._quenes[$S])&&($l._sortAlpha($O.camera.transform.position),$T.renderTarget?$l._render($O,!0):$l._render($O,!1))},$j._set3DRenderConfig=function($j){$j.disable(3042),$v._blend=!1,$j.blendFunc(770,771),$v._sFactor=770,$v._dFactor=771,$j.disable(2929),$v._depthTest=!1,$j.enable(2884),$v._cullFace=!0,$j.depthMask(1),$v._depthMask=!0,$j.frontFace(2304),$v._frontFace=2304},$j._set2DRenderConfig=function($j){$v.setBlend($j,!0),$v.setBlendFunc($j,1,771),$v.setDepthTest($j,!1),$v.setCullFace($j,!1),$v.setDepthMask($j,!0),$v.setFrontFace($j,2305),$j.viewport(0,0,$g.width,$g.height)},$j._parseCustomProps=function($j,$O,$V,$l){var $T=$l.customProps.lightmaps,$S=$T.length,$m=this._lightmaps;$m.length=$S;for(var $p=0;$p<$S;$p++)$m[$p]=$h.getRes($O[$T[$p].replace(".exr",".png")]);this.setlightmaps($m);var $o=$l.customProps.ambientColor;$o&&(this.ambientColor=new $mO($o[0],$o[1],$o[2]));var $H=$l.customProps.fogColor;$H&&(this.fogColor=new $mO($H[0],$H[1],$H[2]))},$j._addLight=function($j){this._lights.indexOf($j)<0&&this._lights.push($j)},$j._removeLight=function($j){var $O=this._lights.indexOf($j);0<=$O&&this._lights.splice($O,1)},$j._updateScene=function(){var $j=this._renderState;this._prepareUpdateToRenderState($M.mainContext,$j),this._updateComponents($j),this._updateChilds($j),this._lateUpdateComponents($j),this._time+=$j.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$j._updateSceneConch=function(){var $j=this._renderState;this._prepareUpdateToRenderState($M.mainContext,$j),this._updateComponents($j),this._lateUpdateComponents($j),this._prepareSceneToRender($j);for(var $O=0,$V=this._cameraPool.length;$O<$V;$O++){var $l=this._cameraPool[$O];($j.camera=$l)._prepareCameraToRender()}},$j._preRenderShadow=function($j,$O,$V,$l,$T){this.treeRoot?$Vj.renderShadowObjectCullingOctree(this,$O,$V,$l,$T):$Vj.renderShadowObjectCulling(this,$O,$V,$l,$T);for(var $S=0,$m=$V.length;$S<$m;$S++)$V[$S]&&$V[$S]._preRender($j)},$j._renderShadowMap=function($j,$O,$V){var $l=this.parallelSplitShadowMaps[0];$l._calcAllLightCameraInfo($V);var $T,$S,$m,$p=$l.PSSMNum;if(this._preRenderShadow($O,$l._lightCulling,$l._shadowQuenes,$l._lightVPMatrix[0],$p),this.addShaderDefine($wO.SHADERDEFINE_CAST_SHADOW),1<$p)for(var $o=0;$o<$p;$o++)$T=$l.getRenderTarget($o+1),$l.beginRenderTarget($o+1),$j.clearColor(1,1,1,1),$j.clear(16640),$j.viewport(0,0,$T.width,$T.height),$O.camera=$m=$l.getLightCamera($o),$m._prepareCameraToRender(),$m._prepareCameraViewProject($m.viewMatrix,$m.projectionMatrix),$O._projectionViewMatrix=$l._lightVPMatrix[$o+1],($S=$l._shadowQuenes[$o])._preRender($O),$S._renderShadow($O,!1),$l.endRenderTarget($o+1);else $T=$l.getRenderTarget(1),$l.beginRenderTarget(1),$j.clearColor(1,1,1,1),$j.clear(16640),$j.viewport(0,0,$T.width,$T.height),$O.camera=$m=$l.getLightCamera(0),$m._prepareCameraToRender(),$m._prepareCameraViewProject($m.viewMatrix,$m.projectionMatrix),$O._projectionViewMatrix=$l._lightVPMatrix[0],($S=$l._shadowQuenes[0])._preRender($O),$S._renderShadow($O,!0),$l.endRenderTarget(1);this.removeShaderDefine($wO.SHADERDEFINE_CAST_SHADOW)},$j.addTreeNode=function($j){this.treeRoot.addTreeNode($j)},$j.removeTreeNode=function($j){this.treeSize&&$j._treeNode&&$j._treeNode.removeObject($j)},$j.setlightmaps=function($j){this._lightmaps=$j;for(var $O=0,$V=this._renderableSprite3Ds.length;$O<$V;$O++)this._renderableSprite3Ds[$O]._render._applyLightMapParams()},$j.getlightmaps=function(){return this._lightmaps},$j.addChildAt=function($j,$O){if(!($j instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($j&&$j.__className));if(!$j||this.destroyed||$j===this)return $j;if($j.zOrder&&this._set$P("hasZorder",!0),0<=$O&&$O<=this._childs.length){if($j._parent===this){var $V=this.getChildIndex($j);this._childs.splice($V,1),this._childs.splice($O,0,$j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,$O)),this._childChanged()}else $j.parent&&$j.parent.removeChild($j),this._childs===$H.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($O,0,$j),this.conchModel&&this.conchModel.addChildAt($j.conchModel,$O),($j.parent=this)._addChild3D($j);return $j}throw new Error("appendChildAt:The index is out of bounds")},$j.addChild=function($j){if(!($j instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$j||this.destroyed||$j===this)return $j;if($j.zOrder&&this._set$P("hasZorder",!0),$j._parent===this){var $O=this.getChildIndex($j);$O!==this._childs.length-1&&(this._childs.splice($O,1),this._childs.push($j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,this._childs.length-1)),this._childChanged())}else $j.parent&&$j.parent.removeChild($j),this._childs===$H.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($j),this.conchModel&&this.conchModel.addChildAt($j.conchModel,this._childs.length-1),($j.parent=this)._childChanged(),this._addChild3D($j);return $j},$j.removeChildAt=function($j){var $O=this.getChildAt($j);return $O&&(this._removeChild3D($O),this._childs.splice($j,1),this.conchModel&&this.conchModel.removeChild($O.conchModel),$O.parent=null),$O},$j.removeChildren=function($j,$O){if(void 0===$j&&($j=0),void 0===$O&&($O=2147483647),this._childs&&0<this._childs.length){var $V=this._childs;if(0===$j&&$S<=$O){var $l=$V;this._childs=$H.ARRAY_EMPTY}else $l=$V.splice($j,$O-$j);for(var $T=0,$S=$l.length;$T<$S;$T++)this._removeChild3D($l[$T]),$l[$T].parent=null,this.conchModel&&this.conchModel.removeChild($l[$T].conchModel)}return this},$j.addFrustumCullingObject=function($j){this.treeRoot?this.addTreeNode($j):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($j):this._cullingRenders[this._cullingRendersLength]=$j,$j._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$j.removeFrustumCullingObject=function($j){if(this.treeRoot)this.removeTreeNode($j);else{this._cullingRendersLength--;var $O=$j._indexInSceneFrustumCullingObjects;if($O!==this._cullingRendersLength){var $V=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$O]=$V)._indexInSceneFrustumCullingObjects=$O,$j._indexInSceneFrustumCullingObjects=-1}}},$j.getRenderQueue=function($j){return $j<3e3?this._quenes[1]||(this._quenes[1]=new $K(this)):this._quenes[2]||(this._quenes[2]=new $K(this))},$j.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $K(this)},$j.addShaderDefine=function($j){this._shaderDefineValue|=$j},$j.removeShaderDefine=function($j){this._shaderDefineValue&=~$j},$j.addScript=function($j){return this._addComponent($j)},$j.getScriptByType=function($j,$O){return void 0===$O&&($O=0),this._getComponentByType($j,$O)},$j.getScriptsByType=function($j,$O){this._getComponentsByType($j,$O)},$j.getScriptByIndex=function($j){return this._getComponentByIndex($j)},$j.removeScriptByType=function($j,$O){void 0===$O&&($O=0),this._removeComponentByType($j,$O)},$j.removeScriptsByType=function($j){this._removeComponentByType($j)},$j.removeAllScript=function(){this._removeAllComponent()},$j.render=function($j,$O,$V){($b._context.ctx._renderKey=0)<this._childs.length&&$j.addRenderObject(this)},$j.renderSubmit=function(){var $j=$M.mainContext,$O=this._renderState;this._set3DRenderConfig($j),this._prepareSceneToRender(this._renderState);var $V,$l=0,$T=0;if($hO.debugMode||$L.debugMode)for($l=0,$T=this._cameraPool.length;$l<$T;$l++)$V=this._cameraPool[$l],$hO._debugPhasorSprite.begin(1,$V),$V.activeInHierarchy&&$V._renderCamera($j,$O,this),$hO._debugPhasorSprite.end();else for($l=0,$T=this._cameraPool.length;$l<$T;$l++)($V=this._cameraPool[$l]).activeInHierarchy&&$V._renderCamera($j,$O,this);return this._set2DRenderConfig($j),1},$j.onAsynLoaded=function($j,$O,$V){var $l=$O[0];if("Scene"!==$l.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $T=$O[1];$rO._createNodeByJson(this,$l,this,$T),this.event("hierarchyloaded",[this]),this.__loaded=!0},$j.destroy=function($j){void 0===$j&&($j=!0),this.destroyed||($O.prototype.destroy.call(this,$j),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$h.clearRes(this.url),this.loaded||$hO._cancelLoadByUrl(this.url))},$j.getRenderType=function(){return 0},$j.releaseRender=function(){},$j._addComponent=function($j){var $O,$V=this._componentsMap.indexOf($j);if(-1===$V)$O=[],this._componentsMap.push($j),this._typeComponentsIndices.push($O);else if($O=this._typeComponentsIndices[$V],this._components[$O[0]].isSingleton)throw new Error("无法单实例创建"+$j+"组件，"+$j+"组件已存在！");var $l=$T.getInstance($j);$O.push(this._components.length),this._components.push($l);return $l._initialize(this),$l},$j._removeComponent=function($j,$O){var $V=this._typeComponentsIndices[$j],$l=$V[$O],$T=this._components[$l];this._components.splice($l,1),$V.splice($O,1),0===$V.length&&(this._typeComponentsIndices.splice($j,1),this._componentsMap.splice($j,1));for(var $S=0,$m=this._componentsMap.length;$S<$m;$S++)for(var $p=($V=this._typeComponentsIndices[$S]).length-1;0<=$p;$p--){var $o=$V[$p];if(!($l<$o))break;$V[$p]=--$o}$T._destroy()},$j._getComponentByType=function($j,$O){void 0===$O&&($O=0);var $V=this._componentsMap.indexOf($j);return-1===$V?null:this._components[this._typeComponentsIndices[$V][$O]]},$j._getComponentsByType=function($j,$O){var $V=this._componentsMap.indexOf($j);if(-1!==$V){var $l=this._typeComponentsIndices[$V],$T=$l.length;$O.length=$T;for(var $S=0;$S<$T;$S++)$O[$S]=this._components[$l[$S]]}else $O.length=0},$j._getComponentByIndex=function($j){return this._components[$j]},$j._removeComponentByType=function($j,$O){void 0===$O&&($O=0);var $V=this._componentsMap.indexOf($j);-1!==$V&&this._removeComponent($V,$O)},$j._removeComponentsByType=function($j){var $O=this._componentsMap.indexOf($j);if(-1!==$O)for(var $V=this._typeComponentsIndices[$O],$l=0,$T=$V.length;$l<$T;$V.length<$T?$T--:$l++)this._removeComponent($O,$l)},$j._removeAllComponent=function(){for(var $j=0,$O=this._componentsMap.length;$j<$O;this._componentsMap.length<$O?$O--:$j++)this._removeComponentsByType(this._componentsMap[$j])},$j._updateComponents=function($j){for(var $O=0,$V=this._components.length;$O<$V;$O++){var $l=this._components[$O];!$l.started&&($l._start($j),$l.started=!0),$l.enable&&$l._update($j)}},$j._lateUpdateComponents=function($j){for(var $O=0;$O<this._components.length;$O++){var $V=this._components[$O];!$V.started&&($V._start($j),$V.started=!0),$V.enable&&$V._lateUpdate($j)}},$j._preRenderUpdateComponents=function($j){for(var $O=0;$O<this._components.length;$O++){var $V=this._components[$O];!$V.started&&($V._start($j),$V.started=!0),$V.enable&&$V._preRenderUpdate($j)}},$j._postRenderUpdateComponents=function($j){for(var $O=0;$O<this._components.length;$O++){var $V=this._components[$O];!$V.started&&($V._start($j),$V.started=!0),$V.enable&&$V._postRenderUpdate($j)}},$s(0,$j,"_loaded",null,function($j){this.__loaded=$j}),$s(0,$j,"fogColor",function(){return this._fogColor},function($j){this._fogColor=$j,this._shaderValues.setValue(0,$j.elements)}),$s(0,$j,"enableFog",function(){return this._enableFog},function($j){this._enableFog!==$j&&((this._enableFog=$j)?(this.addShaderDefine($UO.SHADERDEFINE_FOG),this.removeShaderDefine($UO.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($UO.SHADERDEFINE_FOG))}),$s(0,$j,"url",function(){return this._url}),$s(0,$j,"loaded",function(){return this.__loaded}),$s(0,$j,"enableDepthFog",function(){return this._enableDepthFog},function($j){this._enableDepthFog!=$j&&((this._enableDepthFog=$j)?(this.addShaderDefine($UO.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($UO.SHADERDEFINE_FOG)):this.removeShaderDefine($UO.SAHDERDEFINE_DEPTHFOG))}),$s(0,$j,"fogStart",function(){return this._fogStart},function($j){this._fogStart=$j,this._shaderValues.setValue(1,$j)}),$s(0,$j,"fogRange",function(){return this._fogRange},function($j){this._fogRange=$j,this._shaderValues.setValue(2,$j)}),$s(0,$j,"ambientColor",function(){return this._ambientColor},function($j){this._ambientColor=$j,this._shaderValues.setValue(21,$j.elements)}),$s(0,$j,"scene",function(){return this}),$s(0,$j,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$l._sortScenes=function($j,$O){if($j.parent!==$Z.stage||$O.parent!==$Z.stage)return $j.parent!==$Z.stage&&$O.parent!==$Z.stage?$l._sortScenes($j.parent,$O.parent):$j.parent===$Z.stage?-1:1;var $V=$Z.stage._childs;return $V.indexOf($j)-$V.indexOf($O)},$l.load=function($j){return $Z.loader.create($j,null,null,$l)},$l.FOGCOLOR=0,$l.FOGSTART=1,$l.FOGRANGE=2,$l.LIGHTDIRECTION=3,$l.LIGHTDIRCOLOR=4,$l.POINTLIGHTPOS=5,$l.POINTLIGHTRANGE=6,$l.POINTLIGHTATTENUATION=7,$l.POINTLIGHTCOLOR=8,$l.SPOTLIGHTPOS=9,$l.SPOTLIGHTDIRECTION=10,$l.SPOTLIGHTSPOT=11,$l.SPOTLIGHTRANGE=12,$l.SPOTLIGHTATTENUATION=13,$l.SPOTLIGHTCOLOR=14,$l.SHADOWDISTANCE=15,$l.SHADOWLIGHTVIEWPROJECT=16,$l.SHADOWMAPPCFOFFSET=17,$l.SHADOWMAPTEXTURE1=18,$l.SHADOWMAPTEXTURE2=19,$l.SHADOWMAPTEXTURE3=20,$l.AMBIENTCOLOR=21,$l.TIME=22,$l}($E),$iO=function($j){function $O($j){$O.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $jO,this._shaderValues=new $tO,this._colliders=[],this._id=++$O._uniqueIDCounter,this._transform=new $xO(this),this.name=$j||"Sprite3D-"+$O._nameNumberCounter++,this.layer=$R.currentCreationLayer,this.active=!0}$w($O,"laya.d3.core.Sprite3D",$_O);var $V=$O.prototype;return $Z.imps($V,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$V._setUrl=function($j){this._url=$j},$V._getGroup=function(){return this._group},$V._setGroup=function($j){this._group=$j},$V._addChild3D=function($j){$j.transform.parent=this.transform,this._hierarchyAnimator&&(!$j._hierarchyAnimator&&$j._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($j,!0,[$j.name])),this._scene&&($j._setBelongScene(this._scene),this._activeInHierarchy&&$j._active&&$j._activeHierarchy())},$V._removeChild3D=function($j){$j.transform.parent=null,this._scene&&(this._activeInHierarchy&&$j._active&&$j._inActiveHierarchy(),$j._setUnBelongScene()),this._hierarchyAnimator&&($j._hierarchyAnimator==this._hierarchyAnimator&&$j._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($j,!1,[$j.name]))},$V._parseBaseCustomProps=function($j){var $O=this.transform.localPosition;$j.translate?($O.fromArray($j.translate),$O.x*=100,$O.y*=100,$O.z*=100):$O.elements.fill(0),this.transform.localPosition=$O;var $V=this.transform.localRotation;$j.rotation?$V.fromArray($j.rotation):$V.fromArray([0,0,0,-1]),this.transform.localRotation=$V;var $l=this.transform.localScale;$j.scale?$l.fromArray($j.scale):$l.elements.fill(1),this.transform.localScale=$l;var $T=$j.layer;null!=$T&&(this.layer=$R.getLayerByNumber($T))},$V._parseCustomComponent=function($j,$O,$V){for(var $l in $V){var $T=$V[$l];switch($l){case"Animator":var $S=this.addComponent(Animator);if($T.avatarPath)$S.avatar=$h.getRes($O[$T.avatarPath]);else{var $m=$T.avatar;if($m){$S.avatar=$h.getRes($O[$m.path]);var $p=$m.linkSprites;$p&&$j.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$S,$p])}}for(var $o=$T.clipPaths,$H=$o.length,$g=0;$g<$H;$g++)$S.addClip($h.getRes($O[$o[$g]]));$S.clip=$h.getRes($O[$o[0]]);var $e=$T.playOnWake;void 0!==$e&&($S.playOnWake=$e);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $t=this.addComponent(SphereCollider);$t.isTrigger=$T.isTrigger;var $w=$t.center;$w.fromArray($T.center),$t.center=$w,$t.radius=$T.radius;break;case"BoxCollider":var $s=this.addComponent(BoxCollider);$s.isTrigger=$T.isTrigger,$s.center.fromArray($T.center);var $b=$s.size;$b.fromArray($T.size),$s.size=$b;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$V._onRootNodeHierarchyLoaded=function($j,$O){for(var $V in $O){for(var $l=this,$T=$O[$V],$S=0,$m=$T.length;$S<$m;$S++){var $p=$T[$S];if(""===$p)break;if(!($l=$l.getChildByName($p)))break}$l&&$j.linkSprite3DToAvatarNode($V,$l)}},$V._setHierarchyAnimator=function($j,$O){this._changeHierarchyAnimator($j);for(var $V=0,$l=this._childs.length;$V<$l;$V++){var $T=this._childs[$V];$T._hierarchyAnimator==$O&&$T._setHierarchyAnimator($j,$O)}},$V._clearHierarchyAnimator=function($j,$O){this._changeHierarchyAnimator($O);for(var $V=0,$l=this._childs.length;$V<$l;$V++){var $T=this._childs[$V];$T._hierarchyAnimator==$j&&$T._clearHierarchyAnimator($j,$O)}},$V._getAnimatorToLinkSprite3D=function($j,$O,$V){var $l=this.getComponentByType(Animator);if($l&&($l.avatar?$l.avatar._version||$j._setAnimatorToLinkAvatar($l,$O):$j._setAnimatorToLinkSprite3DNoAvatar($l,$O,$V)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$V.unshift(this._parent.name);var $T=this._parent;$T._hierarchyAnimator&&$T._getAnimatorToLinkSprite3D($j,$O,$V)}},$V._setAnimatorToLinkSprite3DNoAvatar=function($j,$O,$V){var $l=0,$T=0;for($l=0,$T=$j.getClipCount();$l<$T;$l++)$j._handleSpriteOwnersBySprite($l,$O,$V,this);for($l=0,$T=this._childs.length;$l<$T;$l++){var $S=this._childs[$l],$m=$V.length;$V.push($S.name),$S._setAnimatorToLinkSprite3DNoAvatar($j,$O,$V),$V.splice($m,1)}},$V._changeHierarchyAnimator=function($j){this._hierarchyAnimator=$j},$V._isLinkSpriteToAnimationNode=function($j,$O,$V){var $l=$j._avatarNodes.indexOf($O),$T=$j._cacheSpriteToNodesMap;if($V)this._transform.dummy=$O.transform,$j._cacheNodesToSpriteMap[$l]=$T.length,$T.push($l);else{this._transform.dummy=null;var $S=$j._cacheNodesToSpriteMap[$l];$j._cacheNodesToSpriteMap[$l]=null,$T.splice($S,1)}},$V._setBelongScene=function($j){this._scene=$j;for(var $O=0,$V=this._childs.length;$O<$V;$O++)this._childs[$O]._setBelongScene($j)},$V._setUnBelongScene=function(){this._scene=null;for(var $j=0,$O=this._childs.length;$j<$O;$j++)this._childs[$j]._setUnBelongScene()},$V._activeHierarchy=function(){var $j=0,$O=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$j=0,$O=this._colliders.length;$j<$O;$j++)this._layer._addCollider(this._colliders[$j]);for(this.event("activeinhierarchychanged",!0),$j=0,$O=this._childs.length;$j<$O;$j++){var $V=this._childs[$j];$V._active&&$V._activeHierarchy()}},$V._inActiveHierarchy=function(){var $j=0,$O=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$j=0,$O=this._colliders.length;$j<$O;$j++){var $V=this._colliders[$j];$V._clearCollsionMap(),this._layer._removeCollider($V)}for(this.event("activeinhierarchychanged",!1),$j=0,$O=this._childs.length;$j<$O;$j++){var $l=this._childs[$j];$l._active&&$l._inActiveHierarchy()}},$V.addComponent=function($j){var $O,$V=this._componentsMap.indexOf($j);if(-1===$V)$O=[],this._componentsMap.push($j),this._typeComponentsIndices.push($O);else if($O=this._typeComponentsIndices[$V],this._components[$O[0]].isSingleton)throw new Error("无法单实例创建"+$j+"组件，"+$j+"组件已存在！");var $l=$T.getInstance($j);return $O.push(this._components.length),this._components.push($l),$l instanceof laya.d3.component.Script&&this._scripts.push($l),$l._initialize(this),$l},$V._removeComponent=function($j,$O){var $V,$l=0,$T=this._typeComponentsIndices[$j],$S=$T[$O],$m=this._components[$S];for($m instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($m),1),$T.splice($O,1),0===$T.length&&(this._typeComponentsIndices.splice($j,1),this._componentsMap.splice($j,1)),$l=0,$V=this._componentsMap.length;$l<$V;$l++)for(var $p=($T=this._typeComponentsIndices[$l]).length-1;0<=$p;$p--){var $o=$T[$p];if(!($S<$o))break;$T[$p]=--$o}$m._destroy()},$V._clearSelfRenderObjects=function(){},$V._addSelfRenderObjects=function(){},$V._parseCustomProps=function($j,$O,$V,$l){},$V._updateChilds=function($j){var $O=this._childs.length;if(0!==$O)for(var $V=0;$V<$O;++$V)this._childs[$V]._update($j)},$V._getSortID=function($j,$O){return 1e3*$O.id+$j._getVertexBuffer().vertexDeclaration.id},$V._update=function($j){($j.owner=this)._activeInHierarchy&&(this._updateComponents($j),this._lateUpdateComponents($j),$U.spriteCount++,this._childs.length&&this._updateChilds($j))},$V.getProjectionViewWorldMatrix=function($j){return $jO.multiply($j,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$V.loadHierarchy=function($j){this.addChild(laya.d3.core.Sprite3D.load($j))},$V.addChildAt=function($j,$O){if(!($j instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$j||this.destroyed||$j===this)return $j;if($j.zOrder&&this._set$P("hasZorder",!0),0<=$O&&$O<=this._childs.length){if($j._parent===this){var $V=this.getChildIndex($j);this._childs.splice($V,1),this._childs.splice($O,0,$j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,$O)),this._childChanged()}else $j.parent&&$j.parent.removeChild($j),this._childs===$H.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($O,0,$j),this.conchModel&&this.conchModel.addChildAt($j.conchModel,$O),($j.parent=this)._addChild3D($j);return $j}throw new Error("appendChildAt:The index is out of bounds")},$V.addChild=function($j){if(!($j instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$j||this.destroyed||$j===this)return $j;if($j.zOrder&&this._set$P("hasZorder",!0),$j._parent===this){var $O=this.getChildIndex($j);$O!==this._childs.length-1&&(this._childs.splice($O,1),this._childs.push($j),this.conchModel&&(this.conchModel.removeChild($j.conchModel),this.conchModel.addChildAt($j.conchModel,this._childs.length-1)),this._childChanged())}else $j.parent&&$j.parent.removeChild($j),this._childs===$H.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($j),this.conchModel&&this.conchModel.addChildAt($j.conchModel,this._childs.length-1),($j.parent=this)._childChanged(),this._addChild3D($j);return $j},$V.removeChildAt=function($j){var $O=this.getChildAt($j);return $O&&(this._removeChild3D($O),this._childs.splice($j,1),this.conchModel&&this.conchModel.removeChild($O.conchModel),$O.parent=null),$O},$V.removeChildren=function($j,$O){if(void 0===$j&&($j=0),void 0===$O&&($O=2147483647),this._childs&&0<this._childs.length){var $V=this._childs;if(0===$j&&$S<=$O){var $l=$V;this._childs=$H.ARRAY_EMPTY}else $l=$V.splice($j,$O-$j);for(var $T=0,$S=$l.length;$T<$S;$T++)this._removeChild3D($l[$T]),$l[$T].parent=null,this.conchModel&&this.conchModel.removeChild($l[$T].conchModel)}return this},$V.onAsynLoaded=function($j,$O,$V){var $l=$O[0];if("Sprite3D"!==$l.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $T=$O[1];$rO._createNodeByJson(this,$l,this,$T),this.event("hierarchyloaded",[this]),this.__loaded=!0},$V.cloneTo=function($j){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $O=$j;$O.name=this.name,$O._destroyed=this._destroyed,$O.timer=this.timer,$O._$P=this._$P,$O.active=this._active;var $V=$O.transform.localPosition;this.transform.localPosition.cloneTo($V),$O.transform.localPosition=$V;var $l=$O.transform.localRotation;this.transform.localRotation.cloneTo($l),$O.transform.localRotation=$l;var $T=$O.transform.localScale;this.transform.localScale.cloneTo($T),$O.transform.localScale=$T,$O.isStatic=this.isStatic;var $S=0,$m=0;for($S=0,$m=this._componentsMap.length;$S<$m;$S++){var $p=$O.addComponent(this._componentsMap[$S]);this._components[$S]._cloneTo($p)}for($S=0,$m=this._childs.length;$S<$m;$S++)$O.addChild(this._childs[$S].clone());var $o=$O.getComponentByType(Animator);if($o){var $H=$o._linkSpritesData;if($H)for(var $g in $H){for(var $e=$H[$g],$t=$O,$w=0,$s=$e.length;$w<$s&&($t=$t.getChildByName($e[$w]));$w++);if($t){var $b=$o._avatarNodeMap[$g];$t._isLinkSpriteToAnimationNode($o,$b,!0)}}}},$V.clone=function(){var $j=new this.constructor;return this.cloneTo($j),$j},$V.destroy=function($j){if(void 0===$j&&($j=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$j);var $O,$V=0;for($V=0,$O=this._components.length;$V<$O;$V++)this._components[$V]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$h.clearRes(this.url),this.loaded||$hO._cancelLoadByUrl(this.url)}},$V._handleSpriteToAvatar=function($j,$O){$j._avatarNodes;var $V=$j._avatarNodeMap[this.name];$V&&$V.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($j,$V,$O)},$V._setAnimatorToLinkAvatar=function($j,$O){this._handleSpriteToAvatar($j,$O);for(var $V=0,$l=this._childs.length;$V<$l;$V++){this._childs[$V]._setAnimatorToLinkAvatar($j,$O)}},$s(0,$V,"activeInHierarchy",function(){return this._activeInHierarchy}),$s(0,$V,"_loaded",null,function($j){this.__loaded=$j}),$s(0,$V,"active",function(){return this._active},function($j){this._active!==$j&&(this._active=$j,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($j?this._activeHierarchy():this._inActiveHierarchy()))}),$s(0,$V,"componentsCount",function(){return this._components.length}),$s(0,$V,"loaded",function(){return this.__loaded}),$s(0,$V,"id",function(){return this._id}),$s(0,$V,"url",function(){return this._url}),$s(0,$V,"layer",function(){return this._layer},function($j){if(this._layer!==$j){if(!$j)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $O=0,$V=this._colliders.length;if(this._layer)for($O=0;$O<$V;$O++)this._layer._removeCollider(this._colliders[$O]);for($O=0;$O<$V;$O++)$j._addCollider(this._colliders[$O])}this._layer=$j,this.event("layerchanged",$j)}}),$s(0,$V,"scene",function(){return this._scene}),$s(0,$V,"transform",function(){return this._transform}),$O.instantiate=function($j,$O,$V,$l,$T){void 0===$V&&($V=!0);var $S=$j.clone();$O&&$O.addChild($S);var $m=$S.transform;if($V){var $p=$m.worldMatrix;$j.transform.worldMatrix.cloneTo($p),$m.worldMatrix=$p}else $l&&($m.position=$l),$T&&($m.rotation=$T);return $S},$O.load=function($j){return $Z.loader.create($j,null,null,$O)},$O.WORLDMATRIX=0,$O.MVPMATRIX=1,$O._uniqueIDCounter=0,$O._nameNumberCounter=0,$O}(),$kO=function($j){function $g($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$g.__super.call(this),!$j||!$O)throw"Shader Error";this._id=++$g._count,this._vs=$j,this._ps=$O,this._attributeMap=$V,this._sceneUniformMap=$l,this._cameraUniformMap=$T,this._spriteUniformMap=$S,this._materialUniformMap=$m,this._renderElementUniformMap=$p,this._precompile=$o,this._define=$H,this._precompile&&$g.extCompileObj&&$g.extCompileFunc?$g.extCompileFunc.call($g.extCompileObj,$j,$O,$H):this.recreateResource()}$w($g,"laya.d3.shader.Shader3D",$V);var $O=$g.prototype;return $O.recreateResource=function(){$Y.now();this._compile(),this.completeCreate(),this.memorySize=0},$O.disposeResource=function(){$M.mainContext.deleteShader(this._vshader),$M.mainContext.deleteShader(this._pshader),$M.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$O._compile=function(){if(!$M.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $j=[this._vs,this._ps],$O=$M.mainContext;if(this._program=$O.createProgram(),this._vshader=$g._createShader($O,$j[0],35633),this._pshader=$g._createShader($O,$j[1],35632),$O.attachShader(this._program,this._vshader),$O.attachShader(this._program,this._pshader),$O.linkProgram(this._program),!$b.isConchApp&&$UO.debugMode&&!$O.getProgramParameter(this._program,35714))throw $O.getProgramInfoLog(this._program);var $V,$l=0,$T=0,$S=0;for($S=$b.isConchApp?$O.getProgramParameterEx(this._vs,this._ps,"",35721):$O.getProgramParameter(this._program,35721),$l=0;$l<$S;$l++){var $m=null;$V={vartype:"attribute",ivartype:0,attrib:$m=$b.isConchApp?$O.getActiveAttribEx(this._vs,this._ps,"",$l):$O.getActiveAttrib(this._program,$l),location:$O.getAttribLocation(this._program,$m.name),name:$m.name,type:$m.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($V)}var $p=0;for($p=$b.isConchApp?$O.getProgramParameterEx(this._vs,this._ps,"",35718):$O.getProgramParameter(this._program,35718),$l=0;$l<$p;$l++){var $o=null;$o=$b.isConchApp?$O.getActiveUniformEx(this._vs,this._ps,"",$l):$O.getActiveUniform(this._program,$l),0<($V={vartype:"uniform",ivartype:1,attrib:$m,location:$O.getUniformLocation(this._program,$o.name),name:$o.name,type:$o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($V.name=$V.name.substr(0,$V.name.length-3),$V.isArray=!0,$V.location=$O.getUniformLocation(this._program,$V.name)),this._uniformParams.push($V)}for($l=0,$T=this._attributeParams.length;$l<$T;$l++)($V=this._attributeParams[$l]).indexOfParams=$l,$V.index=1,$V.value=[$V.location,null],$V.codename=$V.name,$V.name=null!=this._attributeMap[$V.codename]?this._attributeMap[$V.codename]:$V.codename,this._attributeParamsMap.push($V.name),this._attributeParamsMap.push($V),$V._this=this,$V.uploadedValue=[],$V.fun=this._attribute;for($l=0,$T=this._uniformParams.length;$l<$T;$l++)switch(($V=this._uniformParams[$l]).indexOfParams=$l,$V.index=1,$V.value=[$V.location,null],$V.codename=$V.name,null!=this._sceneUniformMap[$V.codename]?($V.name=this._sceneUniformMap[$V.codename],this._sceneUniformParamsMap.push($V.name),this._sceneUniformParamsMap.push($V)):null!=this._cameraUniformMap[$V.codename]?($V.name=this._cameraUniformMap[$V.codename],this._cameraUniformParamsMap.push($V.name),this._cameraUniformParamsMap.push($V)):null!=this._spriteUniformMap[$V.codename]?($V.name=this._spriteUniformMap[$V.codename],this._spriteUniformParamsMap.push($V.name),this._spriteUniformParamsMap.push($V)):null!=this._materialUniformMap[$V.codename]?($V.name=this._materialUniformMap[$V.codename],this._materialUniformParamsMap.push($V.name),this._materialUniformParamsMap.push($V)):null!=this._renderElementUniformMap[$V.codename]?($V.name=this._renderElementUniformMap[$V.codename],this._renderElementUniformParamsMap.push($V.name),this._renderElementUniformParamsMap.push($V)):console.log("Shader:can't find uinform name:"+$V.codename+" in shader file."),$V._this=this,$V.uploadedValue=[],$V.type){case 5124:$V.fun=$V.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$V.fun=$V.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$V.fun=$V.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$V.fun=$V.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$V.fun=$V.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$V.fun=this._uniform_sampler2D;break;case 35680:$V.fun=this._uniform_samplerCube;break;case 35676:$V.fun=this._uniformMatrix4fv;break;case 35670:$V.fun=this._uniform1i;break;case 35674:$V.fun=this._uinformMatrix2fv;break;case 35675:$V.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$O._attribute=function($j,$O){var $V=$M.mainContext,$l=$p._enableAtributes,$T=$j.location;return $l[$T]||$V.enableVertexAttribArray($T),$V.vertexAttribPointer($T,$O[0],$O[1],$O[2],$O[3],$O[4]),$l[$T]=$p._bindVertexBuffer,1},$O._uniform1f=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O?($M.mainContext.uniform1f($j.location,$V[0]=$O),1):0},$O._uniform1fv=function($j,$O){if($O.length<4){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($M.mainContext.uniform1fv($j.location,$O),$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3],1):0}return $M.mainContext.uniform1fv($j.location,$O),1},$O._uniform_vec2=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]?($M.mainContext.uniform2f($j.location,$V[0]=$O[0],$V[1]=$O[1]),1):0},$O._uniform_vec2v=function($j,$O){if($O.length<2){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($M.mainContext.uniform2fv($j.location,$O),$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3],1):0}return $M.mainContext.uniform2fv($j.location,$O),1},$O._uniform_vec3=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]?($M.mainContext.uniform3f($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2]),1):0},$O._uniform_vec3v=function($j,$O){return $M.mainContext.uniform3fv($j.location,$O),1},$O._uniform_vec4=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($M.mainContext.uniform4f($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3]),1):0},$O._uniform_vec4v=function($j,$O){return $M.mainContext.uniform4fv($j.location,$O),1},$O._uniformMatrix2fv=function($j,$O){return $M.mainContext.uniformMatrix2fv($j.location,!1,$O),1},$O._uniformMatrix3fv=function($j,$O){return $M.mainContext.uniformMatrix3fv($j.location,!1,$O),1},$O._uniformMatrix4fv=function($j,$O){return $M.mainContext.uniformMatrix4fv($j.location,!1,$O),1},$O._uinformMatrix2fv=function($j,$O){return $M.mainContext.uniformMatrix2fv($j.location,!1,$O),1},$O._uinformMatrix3fv=function($j,$O){return $M.mainContext.uniformMatrix3fv($j.location,!1,$O),1},$O._uniform1i=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O?($M.mainContext.uniform1i($j.location,$V[0]=$O),1):0},$O._uniform1iv=function($j,$O){return $M.mainContext.uniform1iv($j.location,$O),1},$O._uniform_ivec2=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]?($M.mainContext.uniform2i($j.location,$V[0]=$O[0],$V[1]=$O[1]),1):0},$O._uniform_ivec2v=function($j,$O){return $M.mainContext.uniform2iv($j.location,$O),1},$O._uniform_vec3i=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]?($M.mainContext.uniform3i($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2]),1):0},$O._uniform_vec3vi=function($j,$O){return $M.mainContext.uniform3iv($j.location,$O),1},$O._uniform_vec4i=function($j,$O){var $V=$j.uploadedValue;return $V[0]!==$O[0]||$V[1]!==$O[1]||$V[2]!==$O[2]||$V[3]!==$O[3]?($M.mainContext.uniform4i($j.location,$V[0]=$O[0],$V[1]=$O[1],$V[2]=$O[2],$V[3]=$O[3]),1):0},$O._uniform_vec4vi=function($j,$O){return $M.mainContext.uniform4iv($j.location,$O),1},$O._uniform_sampler2D=function($j,$O){var $V=$O.source||$O.defaulteTexture.source,$l=$M.mainContext,$T=$j.uploadedValue;if(null!=$T[0])return $l.activeTexture($g._TEXTURES[$T[0]]),$V&&$v.bindTexture($l,3553,$V),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $T[0]=this._curActTexIndex,$l.uniform1i($j.location,this._curActTexIndex),$l.activeTexture($g._TEXTURES[this._curActTexIndex]),$V&&$v.bindTexture($l,3553,$V),this._curActTexIndex++,1},$O._uniform_samplerCube=function($j,$O){var $V=$O.source||$O.defaulteTexture.source,$l=$M.mainContext,$T=$j.uploadedValue;if(null!=$T[0])return $l.activeTexture($g._TEXTURES[$T[0]]),$V?$v.bindTexture($l,34067,$V):$v.bindTexture($l,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $T[0]=this._curActTexIndex,$l.uniform1i($j.location,this._curActTexIndex),$l.activeTexture($g._TEXTURES[this._curActTexIndex]),$V?$v.bindTexture($l,34067,$V):$v.bindTexture($l,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$O._noSetValue=function($j){console.log("no....:"+$j.name)},$O.bind=function(){return $V.activeShader=this,($V.bindShader=this).activeResource(),$v.UseProgram(this._program)},$O.uploadAttributes=function($j,$O){for(var $V,$l,$T=0,$S=0,$m=this._attributeParamsMap.length;$S<$m;$S+=2)$l=this._attributeParamsMap[$S+1],null!=($V=$j[this._attributeParamsMap[$S]])&&($O&&$O[$l.name]&&$O[$l.name].bind(),$T+=$l.fun.call(this,$l,$V));$U.shaderCall+=$T},$O.uploadAttributesX=function($j,$O){for(var $V,$l,$T=0,$S=0,$m=this._attributeParamsMap.length;$S<$m;$S+=2)$l=this._attributeParamsMap[$S+1],null!=($V=$j[this._attributeParamsMap[$S]])&&($O._bind(),$T+=$l.fun.call(this,$l,$V));$U.shaderCall+=$T},$O.uploadSceneUniforms=function($j){for(var $O,$V,$l=0,$T=0,$S=this._sceneUniformParamsMap.length;$T<$S;$T+=2)$V=this._sceneUniformParamsMap[$T+1],null!=($O=$j[this._sceneUniformParamsMap[$T]])&&($l+=$V.fun.call(this,$V,$O));$U.shaderCall+=$l},$O.uploadCameraUniforms=function($j){for(var $O,$V,$l=0,$T=0,$S=this._cameraUniformParamsMap.length;$T<$S;$T+=2)$V=this._cameraUniformParamsMap[$T+1],null!=($O=$j[this._cameraUniformParamsMap[$T]])&&($l+=$V.fun.call(this,$V,$O));$U.shaderCall+=$l},$O.uploadSpriteUniforms=function($j){for(var $O,$V,$l=0,$T=0,$S=this._spriteUniformParamsMap.length;$T<$S;$T+=2)$V=this._spriteUniformParamsMap[$T+1],null!=($O=$j[this._spriteUniformParamsMap[$T]])&&($l+=$V.fun.call(this,$V,$O));$U.shaderCall+=$l},$O.uploadMaterialUniforms=function($j){for(var $O,$V,$l=0,$T=0,$S=this._materialUniformParamsMap.length;$T<$S;$T+=2)$V=this._materialUniformParamsMap[$T+1],null!=($O=$j[this._materialUniformParamsMap[$T]])&&($l+=$V.fun.call(this,$V,$O));$U.shaderCall+=$l},$O.uploadRenderElementUniforms=function($j){for(var $O,$V,$l=0,$T=0,$S=this._renderElementUniformParamsMap.length;$T<$S;$T+=2)$V=this._renderElementUniformParamsMap[$T+1],null!=($O=$j[this._renderElementUniformParamsMap[$T]])&&($l+=$V.fun.call(this,$V,$O));$U.shaderCall+=$l},$g.create=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){return new $g($j,$O,$V,$l,$T,$S,$m,$p,$o,$H)},$g.addInclude=function($j,$O){$c.addInclude($j,$O)},$g._createShader=function($j,$O,$V){var $l=$j.createShader($V);if($j.shaderSource($l,$O),$j.compileShader($l),$UO.debugMode&&!$j.getShaderParameter($l,35713))throw $j.getShaderInfoLog($l);return $l},$g.PERIOD_RENDERELEMENT=0,$g.PERIOD_MATERIAL=1,$g.PERIOD_SPRITE=2,$g.PERIOD_CAMERA=3,$g.PERIOD_SCENE=4,$g._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$g._count=0,$g._preCompile=!1,$g.extCompileFunc=null,$g.extCompileObj=null,$e($g,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $z}]),$g}(),$nO=function($p){function $o(){this._transformUV=null,$o.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $mO(.6,.6,.6)),this._setColor(10,new $mO(1,1,1)),this._setColor(11,new $pO(1,1,1,8)),this._setColor(12,new $mO(1,1,1)),this._setColor(7,new $pO(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $pO(1,1,0,0)),this.renderMode=1}$w($o,"laya.d3.core.material.StandardMaterial",$p);var $j=$o.prototype;return $j.disableLight=function(){this._addDisablePublicShaderDefine($UO.SHADERDEFINE_POINTLIGHT|$UO.SHADERDEFINE_SPOTLIGHT|$UO.SHADERDEFINE_DIRECTIONLIGHT)},$j.disableFog=function(){this._addDisablePublicShaderDefine($UO.SHADERDEFINE_FOG)},$j.onAsynLoaded=function($j,$O,$V){var $l=$O[0];if($l.version)$p.prototype.onAsynLoaded.call(this,$j,$O,$V);else{var $T=$O[1],$S=$l.props;for(var $m in $S)this[$m]=$S[$m];$o._parseStandardMaterial($T,this,$l),this._endLoaded()}},$j.cloneTo=function($j){$p.prototype.cloneTo.call(this,$j);var $O=$j;this._transformUV&&($O._transformUV=this._transformUV.clone())},$s(0,$j,"ambientColor",function(){return this._getColor(9)},function($j){this._setColor(9,$j)}),$s(0,$j,"ambientTexture",function(){return this._getTexture(5)},function($j){$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$j)}),$s(0,$j,"renderMode",null,function($j){switch($j){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($o.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($j)}),$s(0,$j,"reflectColor",function(){return this._getColor(12)},function($j){this._setColor(12,$j)}),$s(0,$j,"tilingOffset",function(){return this._getColor(15)},function($j){if($j){var $O=$j.elements;1!=$O[0]||1!=$O[1]||0!=$O[2]||0!=$O[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$j)}),$s(0,$j,"albedo",function(){return this._getColor(7)},function($j){this._setColor(7,$j)}),$s(0,$j,"diffuseColor",function(){return this._getColor(10)},function($j){this._setColor(10,$j)}),$s(0,$j,"albedoColor",function(){return this._getColor(7)},function($j){this._setColor(7,$j)}),$s(0,$j,"specularColor",function(){return this._getColor(11)},function($j){this._setColor(11,$j)}),$s(0,$j,"diffuseTexture",function(){return this._getTexture(1)},function($j){$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$j)}),$s(0,$j,"normalTexture",function(){return this._getTexture(2)},function($j){$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$j)}),$s(0,$j,"specularTexture",function(){return this._getTexture(3)},function($j){$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$j)}),$s(0,$j,"emissiveTexture",function(){return this._getTexture(4)},function($j){$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$j)}),$s(0,$j,"reflectTexture",function(){return this._getTexture(6)},function($j){$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$j)}),$s(0,$j,"transformUV",function(){return this._transformUV},function($j){this._transformUV=$j,this._setMatrix4x4(13,$j.matrix),$j?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$j.matrix.elements,0)}),$o.__init__=function(){$o.SHADERDEFINE_DIFFUSEMAP=$o.shaderDefines.registerDefine("DIFFUSEMAP"),$o.SHADERDEFINE_NORMALMAP=$o.shaderDefines.registerDefine("NORMALMAP"),$o.SHADERDEFINE_SPECULARMAP=$o.shaderDefines.registerDefine("SPECULARMAP"),$o.SHADERDEFINE_EMISSIVEMAP=$o.shaderDefines.registerDefine("EMISSIVEMAP"),$o.SHADERDEFINE_AMBIENTMAP=$o.shaderDefines.registerDefine("AMBIENTMAP"),$o.SHADERDEFINE_REFLECTMAP=$o.shaderDefines.registerDefine("REFLECTMAP"),$o.SHADERDEFINE_UVTRANSFORM=$o.shaderDefines.registerDefine("UVTRANSFORM"),$o.SHADERDEFINE_TILINGOFFSET=$o.shaderDefines.registerDefine("TILINGOFFSET"),$o.SHADERDEFINE_ADDTIVEFOG=$o.shaderDefines.registerDefine("ADDTIVEFOG")},$o.load=function($j){return $Z.loader.create($j,null,null,$o)},$o._parseStandardMaterial=function($j,$O,$V){var $l=$V.customProps,$T=$l.ambientColor;$O.ambientColor=new $mO($T[0],$T[1],$T[2]);var $S=$l.diffuseColor;$O.diffuseColor=new $mO($S[0],$S[1],$S[2]);var $m=$l.specularColor;$O.specularColor=new $pO($m[0],$m[1],$m[2],$m[3]);var $p=$l.reflectColor;$O.reflectColor=new $mO($p[0],$p[1],$p[2]);var $o=$l.albedoColor;$o&&($O.albedo=new $pO($o[0],$o[1],$o[2],$o[3]));var $H=$l.diffuseTexture.texture2D;$H&&($O.diffuseTexture=$h.getRes($j[$H]));var $g=$l.normalTexture.texture2D;$g&&($O.normalTexture=$h.getRes($j[$g]));var $e=$l.specularTexture.texture2D;$e&&($O.specularTexture=$h.getRes($j[$e]));var $t=$l.emissiveTexture.texture2D;$t&&($O.emissiveTexture=$h.getRes($j[$t]));var $w=$l.ambientTexture.texture2D;$w&&($O.ambientTexture=$h.getRes($j[$w]));var $s=$l.reflectTexture.texture2D;$s&&($O.reflectTexture=$h.getRes($j[$s]))},$o.RENDERMODE_OPAQUE=1,$o.RENDERMODE_OPAQUEDOUBLEFACE=2,$o.RENDERMODE_CUTOUT=3,$o.RENDERMODE_CUTOUTDOUBLEFACE=4,$o.RENDERMODE_TRANSPARENT=13,$o.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$o.RENDERMODE_ADDTIVE=15,$o.RENDERMODE_ADDTIVEDOUBLEFACE=16,$o.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$o.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$o.RENDERMODE_DEPTHREAD_ADDTIVE=7,$o.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$o.RENDERMODE_NONDEPTH_TRANSPARENT=9,$o.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$o.RENDERMODE_NONDEPTH_ADDTIVE=11,$o.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$o.SHADERDEFINE_DIFFUSEMAP=0,$o.SHADERDEFINE_NORMALMAP=0,$o.SHADERDEFINE_SPECULARMAP=0,$o.SHADERDEFINE_EMISSIVEMAP=0,$o.SHADERDEFINE_AMBIENTMAP=0,$o.SHADERDEFINE_REFLECTMAP=0,$o.SHADERDEFINE_UVTRANSFORM=0,$o.SHADERDEFINE_TILINGOFFSET=0,$o.SHADERDEFINE_ADDTIVEFOG=0,$o.DIFFUSETEXTURE=1,$o.NORMALTEXTURE=2,$o.SPECULARTEXTURE=3,$o.EMISSIVETEXTURE=4,$o.AMBIENTTEXTURE=5,$o.REFLECTTEXTURE=6,$o.ALBEDO=7,$o.UVANIAGE=8,$o.MATERIALAMBIENT=9,$o.MATERIALDIFFUSE=10,$o.MATERIALSPECULAR=11,$o.MATERIALREFLECT=12,$o.UVMATRIX=13,$o.UVAGE=14,$o.TILINGOFFSET=15,$e($o,["defaultMaterial",function(){var $j=new $o;return $j.lock=!0,this.defaultMaterial=$j},"shaderDefines",function(){return this.shaderDefines=new $gO($BO.shaderDefines)}]),$o}($BO),$GO=function($j){function $m($j,$O,$V,$l,$T){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$V&&($V=35044),void 0===$l&&($l=!1),$m.__super.call(this),this._indexType=$j,this._indexCount=$O,this._bufferUsage=$V,this._bufferType=34963,this._canRead=$l;var $S;if("ushort"==$j)this._indexTypeByteCount=2;else{if("ubyte"!=$j)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$S=this._indexTypeByteCount*$O,this._byteLength=$S,this._bind(),$p._gl.bufferData(this._bufferType,$S,this._bufferUsage),this.uri=$T,$l?("ushort"==$j?this._buffer=new Uint16Array($O):"ubyte"==$j&&(this._buffer=new Uint8Array($O)),this.memorySize=2*$S):this.memorySize=$S}$w($m,"laya.d3.graphics.IndexBuffer3D",$j);var $O=$m.prototype;return $O.setData=function($j,$O,$V,$l){void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=4294967295);var $T=0;if("ushort"==this._indexType?($T=2,0===$V&&4294967295===$l||($j=new Uint16Array($j.buffer,$V*$T,$l))):"ubyte"==this._indexType&&($T=1,0===$V&&4294967295===$l||($j=new Uint8Array($j.buffer,$V*$T,$l))),this._bind(),$p._gl.bufferSubData(this._bufferType,$O*$T,$j),this._canRead)if(0!==$O||0!==$V||4294967295!==$l){var $S=this._buffer.length-$O;$S<$l&&($l=$S);for(var $m=0;$m<$l;$m++)this._buffer[$O+$m]=$j[$m]}else this._buffer=$j},$O.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$O.disposeResource=function(){$j.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$s(0,$O,"indexType",function(){return this._indexType}),$s(0,$O,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$s(0,$O,"indexCount",function(){return this._indexCount}),$s(0,$O,"canRead",function(){return this._canRead}),$m.INDEXTYPE_UBYTE="ubyte",$m.INDEXTYPE_USHORT="ushort",$m.create=function($j,$O,$V,$l,$T){return void 0===$V&&($V=35044),void 0===$l&&($l=!1),new $m($j,$O,$V,$l,$T)},$m}($p),$FO=function($S){function $m($j,$O,$V,$l,$T){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$l&&($l=!1),$m.__super.call(this),this._vertexDeclaration=$j,this._vertexCount=$O,this._bufferUsage=$V,this._bufferType=34962,this._canRead=$l,this.uri=$T,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$O,this._bind(),$p._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$l&&(this._buffer=new Float32Array(this._byteLength/4))}$w($m,"laya.d3.graphics.VertexBuffer3D",$S);var $j=$m.prototype;return $j.bindWithIndexBuffer=function($j){$j&&$j._bind(),this._bind()},$j.setData=function($j,$O,$V,$l){if(void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=4294967295),0===$V&&4294967295===$l||($j=new Float32Array($j.buffer,4*$V,$l)),this._bind(),$p._gl.bufferSubData(this._bufferType,4*$O,$j),this._canRead)if(0!==$O||0!==$V||4294967295!==$l){var $T=this._buffer.length-$O;$T<$l&&($l=$T);for(var $S=0;$S<$l;$S++)this._buffer[$O+$S]=$j[$S]}else this._buffer=$j},$j.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$j.disposeResource=function(){for(var $j=$M.mainContext,$O=this._vertexDeclaration.getVertexElements(),$V=$p._enableAtributes,$l=0,$T=$O.length;$l<$T;$l++)$V[$l]===this._glBuffer&&($j.disableVertexAttribArray($l),$V[$l]=null);$S.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$s(0,$j,"vertexDeclaration",function(){return this._vertexDeclaration}),$s(0,$j,"vertexCount",function(){return this._vertexCount}),$s(0,$j,"canRead",function(){return this._canRead}),$m.create=function($j,$O,$V,$l,$T){return void 0===$V&&($V=35044),void 0===$l&&($l=!1),new $m($j,$O,$V,$l,$T)},$m}($p),$NO=function($j){function $c(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$c.__super.call(this),this._type=3553}$w($c,"laya.d3.resource.DataTexture2D",$MO);var $O=$c.prototype;return $O.genDebugMipmaps=function(){var $j=[];return $j.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$j.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$j.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$j.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$j.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$j.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$j.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$j.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$j.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$j.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$j},$O._onTextureLoaded=function($j){},$O._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $j=$M.mainContext,$O=this._source=$j.createTexture(),$V=this._width,$l=this._height,$T=$v.curBindTexTarget,$S=$v.curBindTexValue,$m=!1;if($v.bindTexture($j,this._type,$O),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $p=0;$j.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $o=0;$o<this._mipmaps.length;$o++){if(this._mipmaps[$o].byteLength!=$H*$g*4)throw"mipmap size error  level:"+$o;$j.texSubImage2D(this._type,0,$c.simLodRect[$p++],$c.simLodRect[$p++],$c.simLodRect[$p++],$c.simLodRect[$p++],6408,5121,new Uint8Array(this._mipmaps[$o]))}this.minFifter=9729,this.magFifter=9729}else{var $H=this._width,$g=this._height;for($p=0,$j.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$o=0;$o<this._mipmaps.length;$o++){if(this._mipmaps[$o].byteLength!=$H*$g*4)throw"mipmap size error  level:"+$o;$j.texImage2D(this._type,$o,6408,$H,$g,0,6408,5121,new Uint8Array(this._mipmaps[$o])),($H/=2)<1&&($H=1),($g/=2)<1&&($g=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$j.pixelStorei($j.UNPACK_ALIGNMENT,1),$j.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $e=0,$t=!1,$w=!1;this._buffer.byteLength==4*$V*$l?($e=6408,$t=!0):this._buffer.byteLength==3*$V*$l?($e=6407,$w=!0):$e=this._format,$t||$w?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$w&&$j.pixelStorei($j.UNPACK_ALIGNMENT,1),$j.texImage2D(this._type,0,$e,$V,$l,0,$e,5121,this._buffer)):$j&&$e==$j.ALPHA?($j.texImage2D(3553,0,$e,$V,$l,0,$e,$j.UNSIGNED_BYTE,this._buffer),$m=!0):0!=$e&&($j.compressedTexImage2D(3553,0,$e,$V,$l,0,this._buffer),$m=!0)}var $s=this._minFifter,$b=this._magFifter,$r=0==this._wrapModeU?10497:33071,$h=0==this._wrapModeV?10497:33071,$a=$A.isPOT($V,$l);$a?(this._mipmap||this._mipmaps?-1!==$s||($s=9987):-1!==$s||($s=9729),-1!==$b||($b=9729),$j.texParameteri(this._type,10241,$s),$j.texParameteri(this._type,10240,$b),$j.texParameteri(this._type,10242,$r),$j.texParameteri(this._type,10243,$h),this._mipmap&&$j.generateMipmap(this._type)):(-1!==$s||($s=9729),-1!==$b||($b=9729),$j.texParameteri(this._type,10241,$s),$j.texParameteri(this._type,10240,$b),$j.texParameteri(this._type,10242,33071),$j.texParameteri(this._type,10243,33071)),$T&&$S&&$v.bindTexture($j,$T,$S),this.memorySize=$m?this._buffer.length:$a?$V*$l*4*(1+1/3):$V*$l*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$O.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$O.onAsynLoaded=function($j,$O,$V){var $l;$V&&($l=$V[0].call(this,$O)),$l&&(this._width=$l.width,this._height=$l.height,this._buffer=$l.data),this._src=$j,this._size=new $bO(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$O.getPixels=function(){return new Uint8Array(this._buffer)},$O.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($M.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$s(0,$O,"src",function(){return this._src}),$c.create=function($j,$O,$V,$l,$T,$S,$m){if(void 0===$l&&($l=9729),void 0===$T&&($T=9729),void 0===$S&&($S=!0),!$j||$j.byteLength<$O*$V*4)throw"DataTexture2D create error";var $p=new $c;return $p.uri=$m,$p._buffer=$j,$p._width=$O,$p._height=$V,$p._mipmap=$S,$p._magFifter=$l,$p._minFifter=$T,$p._size=new $bO($p._width,$p._height),$p._conchTexture?alert("怎么给runtime传递datatexture数据"):$p.activeResource(),$p},$c.load=function($j,$O,$V,$l,$T){if(void 0===$O&&($O=0),void 0===$V&&($V=0),void 0===$l&&($l=9729),void 0===$T&&($T=9729),"mipmaps"===$$.getFileExtension($j)){var $S=$Z.loader.create($j,null,null,$c,[function($j){this._mipmaps=[];var $O=new Uint32Array($j);this._width=$O[0];var $V=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$V=1024),this._width!=$V)throw"现在只支持512x256的环境贴图。当前的是"+$O[0];this._height=$O[1];for(var $l=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$T=this._height,$S=8;;){var $m=$l*$T*4;if($S+$m>$j.byteLength)throw"load mipmaps data size error ";var $p=new Uint8Array($j,$S,$m);if(this._mipmaps.push($p),$S+=$m,1==$l&&1==$T)break;($l/=2)<1&&($l=1),($T/=2)<1&&($T=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$S.simLodInfo=new Float32Array(40);for(var $m=0;$m<$S.simLodInfo.length;)$S.simLodInfo[$m]=($c.simLodRect[$m]+.5)/1024,$m++,$S.simLodInfo[$m]=($c.simLodRect[$m]+.5)/256,$m++,$S.simLodInfo[$m]=Math.max($c.simLodRect[$m]-1,.1)/1024,$m++,$S.simLodInfo[$m]=Math.max($c.simLodRect[$m]-1.5,.1)/256,$m++}return $S}if("number"==typeof $O)return $Z.loader.create($j,null,null,$c,[function($j){return this._width=$O,this._height=$V,this._buffer=$j,null}]);if("function"==typeof $O)return $Z.loader.create($j,null,null,$c,[$O]);throw new Error("unknown params.")},$c.lodasatlas=!1,$e($c,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$c}(),$XO=function($j){function $O(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$O.__super.call(this)}$w($O,"laya.d3.resource.models.PrimitiveMesh",$vO);var $V=$O.prototype;return $Z.imps($V,{"laya.d3.core.render.IRenderable":!0}),$V._getVertexBuffer=function($j){return void 0===$j&&($j=0),0===$j?this._vertexBuffer:null},$V._getVertexBuffers=function(){return null},$V._getIndexBuffer=function(){return this._indexBuffer},$V._getPositions=function(){var $j,$O=[],$V=this._vertexBuffer.vertexDeclaration.getVertexElements(),$l=0;for($l=0;$l<$V.length;$l++){var $T=$V[$l];if("vector3"===$T.elementFormat&&0===$T.elementUsage){$j=$T;break}}var $S=this._vertexBuffer.getData();for($l=0;$l<$S.length;$l+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $m=$l+$j.offset/4,$p=new $mO($S[$m+0],$S[$m+1],$S[$m+2]);$O.push($p)}return $O},$V.getRenderElement=function($j){return this},$V.getRenderElementsCount=function(){return 1},$V.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$V._beforeRender=function($j){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$V._render=function($j){$M.mainContext.drawElements(4,this._numberIndices,5123,0),$U.drawCall++,$U.trianglesFaces+=this._numberIndices/3},$s(0,$V,"_vertexBufferCount",function(){return 1}),$s(0,$V,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$O}(),$fO=function($j){function $O(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$O.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$w($O,"laya.d3.resource.models.Mesh",$vO);var $V=$O.prototype;return $V._getPositions=function(){var $j,$O,$V,$l,$T,$S=[],$m=0,$p=0,$o=0;if(0!==this._vertexBuffers.length){var $H=this._vertexBuffers.length;for($m=0;$m<$H;$m++){for($V=($j=this._vertexBuffers[$m]).vertexDeclaration.getVertexElements(),$p=0;$p<$V.length;$p++)if("vector3"===($l=$V[$p]).elementFormat&&0===$l.elementUsage){$O=$l;break}for($T=$j.getData(),$p=0;$p<$T.length;$p+=$j.vertexDeclaration.vertexStride/4)$o=$p+$O.offset/4,$S.push(new $mO($T[$o+0],$T[$o+1],$T[$o+2]))}}else{var $g=this._subMeshes.length;for($m=0;$m<$g;$m++){for($V=($j=this._subMeshes[$m]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$p=0;$p<$V.length;$p++)if("vector3"===($l=$V[$p]).elementFormat&&0===$l.elementUsage){$O=$l;break}for($T=$j.getData(),$p=0;$p<$T.length;$p+=$j.vertexDeclaration.vertexStride/4)$o=$p+$O.offset/4,$S.push(new $mO($T[$o+0],$T[$o+1],$T[$o+2]))}}return $S},$V._setSubMeshes=function($j){this._subMeshes=$j,this._subMeshCount=$j.length;for(var $O=0;$O<this._subMeshCount;$O++)$j[$O]._indexInMesh=$O;this._positions=this._getPositions(),this._generateBoundingObject()},$V.onAsynLoaded=function($j,$O,$V){var $l=$O[0],$T=$O[1];$dj.read($l,this,this._materials,this._subMeshes,$T),this.completeCreate(),this._endLoaded()},$V.getSubMesh=function($j){return this._subMeshes[$j]},$V.getSubMeshCount=function(){return this._subMeshes.length},$V.getRenderElementsCount=function(){return this._subMeshes.length},$V.getRenderElement=function($j){return this._subMeshes[$j]},$V.disposeResource=function(){for(var $j=0;$j<this._subMeshes.length;$j++)this._subMeshes[$j].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$s(0,$V,"materials",function(){return this._materials.slice()}),$s(0,$V,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$O.load=function($j){return $Z.loader.create($j,null,null,$O)},$O}(),$CO=(function($j){function $H($j,$O,$V,$l,$T,$S,$m,$p,$o){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$V&&($V=6408),void 0===$l&&($l=5121),void 0===$T&&($T=33189),void 0===$S&&($S=!1),void 0===$m&&($m=!1),void 0===$p&&($p=-1),void 0===$o&&($o=-1),$H.__super.call(this),this._type=3553,this._width=$j,this._height=$O,this._size=new $bO($j,$O),this._surfaceFormat=$V,this._surfaceType=$l,this._depthStencilFormat=$T,$b.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$S,this._repeat=$m,this._minFifter=$p,this._magFifter=$o,this.activeResource(),this._alreadyResolved=!0}$w($H,"laya.d3.resource.RenderTexture",$MO);var $O=$H.prototype;$O.recreateResource=function(){var $j=$M.mainContext;this._frameBuffer=$j.createFramebuffer(),this._source=$j.createTexture();var $O=$v.curBindTexTarget,$V=$v.curBindTexValue;$v.bindTexture($j,this._type,this._source),$j.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $l=this._minFifter,$T=this._magFifter,$S=this._repeat?10497:33071;if($A.isPOT(this._width,this._height)?(this._mipmap?-1!==$l||($l=9987):-1!==$l||($l=9729),-1!==$T||($T=9729),$j.texParameteri(this._type,10241,$l),$j.texParameteri(this._type,10240,$T),$j.texParameteri(this._type,10242,$S),$j.texParameteri(this._type,10243,$S),this._mipmap&&$j.generateMipmap(this._type)):(-1!==$l||($l=9729),-1!==$T||($T=9729),$j.texParameteri(this._type,10241,$l),$j.texParameteri(this._type,10240,$T),$j.texParameteri(this._type,10242,33071),$j.texParameteri(this._type,10243,33071)),$O&&$V&&$v.bindTexture($j,$O,$V),$j.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$j.createRenderbuffer(),$j.bindRenderbuffer(36161,this._depthStencilBuffer),$j.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$j.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$j.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$j.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$j.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$j.framebufferTexture2D(36160,36064,3553,this._source,0),$j.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$O.start=function(){$M.mainContext.bindFramebuffer(36160,this.frameBuffer),($H._currentRenderTarget=this)._alreadyResolved=!1},$O.end=function(){$M.mainContext.bindFramebuffer(36160,null),$H._currentRenderTarget=null,this._alreadyResolved=!0},$O.getData=function($j,$O,$V,$l){var $T=$M.mainContext;if($T.bindFramebuffer(36160,this._frameBuffer),!(36053===$T.checkFramebufferStatus(36160)))return $T.bindFramebuffer(36160,null),null;var $S=new Uint8Array(this._width*this._height*4);return $T.readPixels($j,$O,$V,$l,this._surfaceFormat,this._surfaceType,$S),$T.bindFramebuffer(36160,null),$S},$O.disposeResource=function(){if(this._frameBuffer){var $j=$M.mainContext;$j.deleteTexture(this._source),$j.deleteFramebuffer(this._frameBuffer),$j.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$s(0,$O,"surfaceFormat",function(){return this._surfaceFormat}),$s(0,$O,"surfaceType",function(){return this._surfaceType}),$s(0,$O,"depthStencilFormat",function(){return this._depthStencilFormat}),$s(0,$O,"source",function(){return this._alreadyResolved?$Z.superGet($MO,this,"source"):null}),$s(0,$O,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$s(0,$O,"frameBuffer",function(){return this._frameBuffer}),$H._currentRenderTarget=null}(),function($j){function $O($j){this._color=null,this._pixels=null,$O.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $bO(this.width,this.height),this._color=$j,this._pixels=new Uint8Array([255*$j.x,255*$j.y,255*$j.z,255*$j.w]),this.uri="SolidColorTexture2D_"+this.id}$w($O,"laya.d3.resource.SolidColorTexture2D",$MO);var $V=$O.prototype;return $V._createWebGlTexture=function(){var $j=$M.mainContext,$O=this._source=$j.createTexture(),$V=this._width,$l=this._height,$T=$v.curBindTexTarget,$S=$v.curBindTexValue;$v.bindTexture($j,this._type,$O),$j.texImage2D(this._type,0,6408,$V,$l,0,6408,5121,this._pixels);var $m=this._minFifter,$p=this._magFifter,$o=this._repeat?10497:33071,$H=$A.isPOT($V,$l);$H?(this._mipmap?-1!==$m||($m=9987):-1!==$m||($m=9729),-1!==$p||($p=9729),$j.texParameteri(this._type,10241,$m),$j.texParameteri(this._type,10240,$p),$j.texParameteri(this._type,10242,$o),$j.texParameteri(this._type,10243,$o),this._mipmap&&$j.generateMipmap(this._type)):(-1!==$m||($m=9729),-1!==$p||($p=9729),$j.texParameteri(this._type,10241,$m),$j.texParameteri(this._type,10240,$p),$j.texParameteri(this._type,10242,33071),$j.texParameteri(this._type,10243,33071)),$T&&$S&&$v.bindTexture($j,$T,$S),this.memorySize=$H?$V*$l*4*(1+1/3):$V*$l*4},$V.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$V.disposeResource=function(){this._source&&($M.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$e($O,["magentaTexture",function(){var $j=new $O(new $pO(1,0,1,1));return $j.lock=!0,this.magentaTexture=$j},"grayTexture",function(){var $j=new $O(new $pO(.5,.5,.5,1));return $j.lock=!0,this.grayTexture=$j}]),$O}()),$JO=function($j){function $T($j,$O,$V,$l){this._canRead=!1,this._image=null,this._pixels=null,void 0===$j&&($j=!1),void 0===$O&&($O=!0),void 0===$V&&($V=6408),void 0===$l&&($l=!0),$T.__super.call(this),this._type=3553,this._repeat=$O,this._canRead=$j,this._format=$V,this._mipmap=$l}$w($T,"laya.d3.resource.Texture2D",$MO);var $O=$T.prototype;return $O._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $j=$M.mainContext,$O=this._source=$j.createTexture(),$V=this._width,$l=this._height,$T=$v.curBindTexTarget,$S=$v.curBindTexValue;switch($v.bindTexture($j,this._type,$O),this._format){case 6407:case 6408:this._canRead?$j.texImage2D(this._type,0,this._format,$V,$l,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$j.texImage2D(this._type,0,this._image._format,$V,$l,0,this._image._format,5121,this._image.atlasSource):$j.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $M.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$j.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $m=this._minFifter,$p=this._magFifter,$o=this._repeat?10497:33071,$H=0==this._wrapModeU?10497:33071,$g=0==this._wrapModeV?10497:33071,$e=$A.isPOT($V,$l);$e?(this._mipmap?-1!==$m||($m=9987):-1!==$m||($m=9729),-1!==$p||($p=9729),$j.texParameteri(this._type,10241,$m),$j.texParameteri(this._type,10240,$p),$j.texParameteri(this._type,10242,$o),$j.texParameteri(this._type,10243,$o),$j.texParameteri(this._type,10242,$H),$j.texParameteri(this._type,10243,$g),this._mipmap&&$j.generateMipmap(this._type)):(-1!==$m||($m=9729),-1!==$p||($p=9729),$j.texParameteri(this._type,10241,$m),$j.texParameteri(this._type,10240,$p),$j.texParameteri(this._type,10242,33071),$j.texParameteri(this._type,10243,33071)),$T&&$S&&$v.bindTexture($j,$T,$S),this._image.onload=null,this._image=null,this.memorySize=$e?$V*$l*4*(1+1/3):$V*$l*4},$O.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$O.onAsynLoaded=function($j,$O,$V){if($V){var $l=$V[0];void 0!==$l&&(this._canRead=$l);var $T=$V[1];void 0!==$T&&(this._repeat=$T);var $S=$V[2];void 0!==$S&&(this._format=$S);var $m=$V[3];void 0!==$m&&(this._mipmap=$m);var $p=$V.wrapModeU;void 0!==$p&&(this._wrapModeU=$p);var $o=$V.wrapModeV;void 0!==$o&&(this._wrapModeV=$o)}switch(this._format){case 6407:case 6408:var $H=(this._image=$O).width,$g=$O.height;this._width=$H,this._height=$g,this._size=new $bO($H,$g),this._canRead&&($b.isConchApp?$O instanceof $t.HTMLElement&&(this._pixels=new Uint8Array($O.getImageData(0,0,$H,$g))):($Y.canvas.size($H,$g),$Y.canvas.clear(),$Y.context.drawImage($O,0,0,$H,$g),this._pixels=new Uint8Array($Y.context.getImageData(0,0,$H,$g).data.buffer)));break;case $M.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $e=new $x($O);$e.readUTFBytes(4),$e.readUTFBytes(2),$e.getInt16();$e.endian="bigEndian",this._width=$e.getInt16(),this._height=$e.getInt16(),this._size=new $bO(this._width,this._height);$e.getInt16(),$e.getInt16();this._image=new Uint8Array($O,$e.pos)}this.recreateResource(),this._endLoaded()},$O.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$O.disposeResource=function(){this._source&&($M.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$s(0,$O,"_src",function(){return this.url}),$s(0,$O,"src",function(){return this.url}),$T.load=function($j){return $Z.loader.create($j,null,null,$T)},$T}(),$uO=function($O){function $V($j,$O){$V.__super.call(this),void 0===$j&&($j=.3),void 0===$O&&($O=1e3),this._tempVector3=new $mO,this._position=new $mO,this._up=new $mO,this._forward=new $mO,this._right=new $mO,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$bO.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$j,this._farPlane=$O,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$Z.stage.on("resize",this,this._onScreenSizeChanged)}$w($V,"laya.d3.core.BaseCamera",$O);var $j=$V.prototype;return $j._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $j=this.scene._cameraPool,$O=$j.length-1,$V=0;$V<$O;$V++)if($j[$V].renderingOrder>$j[$O].renderingOrder){var $l=$j[$V];$j[$V]=$j[$O],$j[$O]=$l}},$j._calculateProjectionMatrix=function(){},$j._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$j._prepareCameraToRender=function(){$R._currentCameraCullingMask=this.cullingMask;var $j=this._shaderValues;$j.setValue(0,this.transform.position.elements),$j.setValue(5,this.forward.elements),$j.setValue(6,this.up.elements)},$j._prepareCameraViewProject=function($j,$O){var $V=this._shaderValues;$V.setValue(1,$j.elements),$V.setValue(2,$O.elements)},$j._renderCamera=function($j,$O,$V){},$j.addLayer=function($j){29!==$j.number&&30!=$j.number&&(this.cullingMask=this.cullingMask|$j.mask)},$j.removeLayer=function($j){29!==$j.number&&30!=$j.number&&(this.cullingMask=this.cullingMask&~$j.mask)},$j.addAllLayers=function(){this.cullingMask=2147483647},$j.removeAllLayers=function(){this.cullingMask=0|$R.getLayerByNumber(29).mask|$R.getLayerByNumber(30).mask},$j.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$j.moveForward=function($j){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$j,this.transform.translate(this._tempVector3)},$j.moveRight=function($j){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$j,this.transform.translate(this._tempVector3)},$j.moveVertical=function($j){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$j,this.transform.translate(this._tempVector3,!1)},$j._addSelfRenderObjects=function(){var $j=this.scene._cameraPool,$O=$j.length;if(0<$O){for(var $V=$O-1;0<=$V;$V--)if(this.renderingOrder<=$j[$V].renderingOrder){$j.splice($V+1,0,this);break}}else $j.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$j._clearSelfRenderObjects=function(){var $j=this.scene._cameraPool;$j.splice($j.indexOf(this),1)},$j.destroy=function($j){void 0===$j&&($j=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$Z.stage.off("resize",this,this._onScreenSizeChanged),$O.prototype.destroy.call(this,$j)},$s(0,$j,"sky",function(){return this._sky},function($j){(this._sky=$j)._ownerCamera=this}),$s(0,$j,"forward",function(){var $j=this.transform.worldMatrix.elements,$O=this._forward.elements;return $O[0]=-$j[8],$O[1]=-$j[9],$O[2]=-$j[10],this._forward}),$s(0,$j,"position",function(){var $j=this.transform.worldMatrix.elements,$O=this._position.elements;return $O[0]=$j[12],$O[1]=$j[13],$O[2]=$j[14],this._position}),$s(0,$j,"renderTarget",function(){return this._renderTarget},function($j){null!=(this._renderTarget=$j)&&(this._renderTargetSize=$j.size)}),$s(0,$j,"up",function(){var $j=this.transform.worldMatrix.elements,$O=this._up.elements;return $O[0]=$j[4],$O[1]=$j[5],$O[2]=$j[6],this._up}),$s(0,$j,"right",function(){var $j=this.transform.worldMatrix.elements,$O=this._right.elements;return $O[0]=$j[0],$O[1]=$j[1],$O[2]=$j[2],this._right}),$s(0,$j,"renderTargetSize",function(){return this._renderTargetSize},function($j){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$j,this._calculateProjectionMatrix()}),$s(0,$j,"fieldOfView",function(){return this._fieldOfView},function($j){this._fieldOfView=$j,this._calculateProjectionMatrix()}),$s(0,$j,"nearPlane",function(){return this._nearPlane},function($j){this._nearPlane=$j,this._calculateProjectionMatrix()}),$s(0,$j,"farPlane",function(){return this._farPlane},function($j){this._farPlane=$j,this._calculateProjectionMatrix()}),$s(0,$j,"orthographic",function(){return this._orthographic},function($j){this._orthographic=$j,this._calculateProjectionMatrix()}),$s(0,$j,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($j){this._orthographicVerticalSize=$j,this._calculateProjectionMatrix()}),$s(0,$j,"renderingOrder",function(){return this._renderingOrder},function($j){this._renderingOrder=$j,this._sortCamerasByRenderingOrder()}),$V.CAMERAPOS=0,$V.VIEWMATRIX=1,$V.PROJECTMATRIX=2,$V.VPMATRIX=3,$V.VPMATRIX_NO_TRANSLATE=4,$V.CAMERADIRECTION=5,$V.CAMERAUP=6,$V.ENVIRONMENTDIFFUSE=7,$V.ENVIRONMENTSPECULAR=8,$V.SIMLODINFO=9,$V.DIFFUSEIRRADMATR=10,$V.DIFFUSEIRRADMATG=11,$V.DIFFUSEIRRADMATB=12,$V.HDREXPOSURE=13,$V.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$V.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$V.CLEARFLAG_SOLIDCOLOR=0,$V.CLEARFLAG_SKY=1,$V.CLEARFLAG_DEPTHONLY=2,$V.CLEARFLAG_NONE=3,$e($V,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $jO(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $jO},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $jO}]),$V}($iO),$yO=function($V){function $O($j){this._render=null,this._geometryFilter=null,$O.__super.call(this,$j)}$w($O,"laya.d3.core.RenderableSprite3D",$V);var $j=$O.prototype;return $j._addToInitStaticBatchManager=function(){},$j._setBelongScene=function($j){$V.prototype._setBelongScene.call(this,$j),$j._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$j._setUnBelongScene=function(){var $j=this._scene._renderableSprite3Ds,$O=$j.indexOf(this);$j.splice($O,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$V.prototype._setUnBelongScene.call(this)},$j._update=function($j){($j.owner=this)._activeInHierarchy&&(this._updateComponents($j),this._render._updateOctreeNode(),this._lateUpdateComponents($j),$U.spriteCount++,this._childs.length&&this._updateChilds($j))},$j.destroy=function($j){void 0===$j&&($j=!0),$V.prototype.destroy.call(this,$j),this._render._destroy(),this._render=null},$O.__init__=function(){$O.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$O.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$O.SAHDERDEFINE_LIGHTMAP=$O.shaderDefines.registerDefine("LIGHTMAP")},$O.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$O.SAHDERDEFINE_LIGHTMAP=4,$O.LIGHTMAPSCALEOFFSET=2,$O.LIGHTMAP=3,$e($O,["shaderDefines",function(){return this.shaderDefines=new $gO}]),$O}($iO),$WO=(function($j){function $l($j,$O,$V){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$j&&($j=1),void 0===$O&&($O=1),void 0===$V&&($V=1),$l.__super.call(this),this._long=$j,this._width=$O,this._height=$V,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$w($l,"laya.d3.resource.models.BoxMesh",$XO);var $O=$l.prototype;$O.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $j=$Mj.vertexDeclaration,$O=($j.vertexStride,this._long/2),$V=this._height/2,$l=this._width/2,$T=new Float32Array([-$O,$V,-$l,0,1,0,0,0,$O,$V,-$l,0,1,0,1,0,$O,$V,$l,0,1,0,1,1,-$O,$V,$l,0,1,0,0,1,-$O,-$V,-$l,0,-1,0,0,1,$O,-$V,-$l,0,-1,0,1,1,$O,-$V,$l,0,-1,0,1,0,-$O,-$V,$l,0,-1,0,0,0,-$O,$V,-$l,-1,0,0,0,0,-$O,$V,$l,-1,0,0,1,0,-$O,-$V,$l,-1,0,0,1,1,-$O,-$V,-$l,-1,0,0,0,1,$O,$V,-$l,1,0,0,1,0,$O,$V,$l,1,0,0,0,0,$O,-$V,$l,1,0,0,0,1,$O,-$V,-$l,1,0,0,1,1,-$O,$V,$l,0,0,1,0,0,$O,$V,$l,0,0,1,1,0,$O,-$V,$l,0,0,1,1,1,-$O,-$V,$l,0,0,1,0,1,-$O,$V,-$l,0,0,-1,1,0,$O,$V,-$l,0,0,-1,0,0,$O,-$V,-$l,0,0,-1,0,1,-$O,-$V,-$l,0,0,-1,1,1]),$S=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $FO($j,this._numberVertices,35044,!0),this._indexBuffer=new $GO("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($T),this._indexBuffer.setData($S),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$s(0,$O,"long",function(){return this._long},function($j){this._long!==$j&&(this._long=$j,this.releaseResource(),this.activeResource())}),$s(0,$O,"width",function(){return this._width},function($j){this._width!==$j&&(this._width=$j,this.releaseResource(),this.activeResource())}),$s(0,$O,"height",function(){return this._height},function($j){this._height!==$j&&(this._height=$j,this.releaseResource(),this.activeResource())})}(),function($j){function $T($j,$O,$V,$l){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$j&&($j=10),void 0===$O&&($O=10),void 0===$V&&($V=10),void 0===$l&&($l=10),$T.__super.call(this),this._long=$j,this._width=$O,this._stacks=$V,this._slices=$l,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$w($T,"laya.d3.resource.models.PlaneMesh",$XO);var $O=$T.prototype;$O.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $j=new Uint16Array(this._numberIndices),$O=$Mj.vertexDeclaration,$V=$O.vertexStride/4,$l=new Float32Array(this._numberVertices*$V),$T=this._long/2,$S=this._width/2,$m=this._long/this._stacks,$p=this._width/this._slices,$o=0,$H=0;$H<=this._slices;$H++)for(var $g=0;$g<=this._stacks;$g++)$l[$o++]=$g*$m-$T,$l[$o++]=0,$l[$o++]=$H*$p-$S,$l[$o++]=0,$l[$o++]=1,$l[$o++]=0,$l[$o++]=1*$g/this._stacks,$l[$o++]=1*$H/this._slices;var $e=0;for($H=0;$H<this._slices;$H++)for($g=0;$g<this._stacks;$g++)$j[$e++]=($H+1)*(this._stacks+1)+$g,$j[$e++]=$H*(this._stacks+1)+$g,$j[$e++]=($H+1)*(this._stacks+1)+$g+1,$j[$e++]=$H*(this._stacks+1)+$g,$j[$e++]=$H*(this._stacks+1)+$g+1,$j[$e++]=($H+1)*(this._stacks+1)+$g+1;this._vertexBuffer=new $FO($O,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $GO("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($l),this._indexBuffer.setData($j),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$s(0,$O,"long",function(){return this._long},function($j){this._long!==$j&&(this._long=$j,this.releaseResource(),this.activeResource())}),$s(0,$O,"width",function(){return this._width},function($j){this._width!==$j&&(this._width=$j,this.releaseResource(),this.activeResource())}),$s(0,$O,"stacks",function(){return this._stacks},function($j){this._stacks!==$j&&(this._stacks=$j,this.releaseResource(),this.activeResource())}),$s(0,$O,"slices",function(){return this._slices},function($j){this._slices!==$j&&(this._slices=$j,this.releaseResource(),this.activeResource())})}(),function($j){function $m($j,$O,$V){void 0===$j&&($j=0),void 0===$O&&($O=.3),void 0===$V&&($V=1e3),this._viewMatrix=new $jO,this._projectionMatrix=new $jO,this._projectionViewMatrix=new $jO,this._viewport=new $oO(0,0,0,0),this._normalizedViewport=new $oO(0,0,1,1),this._aspectRatio=$j,this._boundFrustumUpdate=!0,this._boundFrustum=new $Qj($jO.DEFAULT),$m.__super.call(this,$O,$V),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$w($m,"laya.d3.core.Camera",$uO);var $O=$m.prototype;return $O._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$O._parseCustomProps=function($j,$O,$V,$l){var $T=$V.clearColor;this.clearColor=new $pO($T[0],$T[1],$T[2],$T[3]);var $S=$V.viewport;this.normalizedViewport=new $oO($S[0],$S[1],$S[2],$S[3])},$O._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $j=this.orthographicVerticalSize*this.aspectRatio*.5,$O=.5*this.orthographicVerticalSize;$jO.createOrthoOffCenterRH(-$j,$j,-$O,$O,this.nearPlane,this.farPlane,this._projectionMatrix)}else $jO.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$O._update=function($j){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$j)},$O._renderCamera=function($j,$O,$V){var $l,$T;$V.parallelSplitShadowMaps[0]&&$V._renderShadowMap($j,$O,this),($O.camera=this)._prepareCameraToRender(),$V._preRenderUpdateComponents($O),$l=$O._viewMatrix=this.viewMatrix;var $S=this._renderTarget;$S?($S.start(),$jO.multiply($uO._invertYScaleMatrix,this._projectionMatrix,$uO._invertYProjectionMatrix),$jO.multiply($uO._invertYScaleMatrix,this.projectionViewMatrix,$uO._invertYProjectionViewMatrix),$T=$O._projectionMatrix=$uO._invertYProjectionMatrix,$O._projectionViewMatrix=$uO._invertYProjectionViewMatrix):($T=$O._projectionMatrix=this._projectionMatrix,$O._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($l,$T),$O._viewport=this.viewport,$V._preRenderScene($j,$O,this.boundFrustum),$V._clear($j,$O),$V._renderScene($j,$O),$V._postRenderUpdateComponents($O),$S&&$S.end()},$O.viewportPointToRay=function($j,$O){$sO.calculateCursorRay($j,this.viewport,this._projectionMatrix,this.viewMatrix,null,$O)},$O.normalizedViewportPointToRay=function($j,$O){var $V=$m._tempVector20,$l=this.viewport,$T=$j.elements,$S=$V.elements;$S[0]=$T[0]*$l.width,$S[1]=$T[1]*$l.height,$sO.calculateCursorRay($V,this.viewport,this._projectionMatrix,this.viewMatrix,null,$O)},$O.worldToViewportPoint=function($j,$O){$jO.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($j,this._projectionViewMatrix,$O);var $V=$O.elements;$V[0]=$V[0]/$Z.stage.clientScaleX,$V[1]=$V[1]/$Z.stage.clientScaleY},$O.worldToNormalizedViewportPoint=function($j,$O){$jO.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($j,this._projectionViewMatrix,$O);var $V=$O.elements;$V[0]=$V[0]/$Z.stage.clientScaleX,$V[1]=$V[1]/$Z.stage.clientScaleY},$O.convertScreenCoordToOrthographicCoord=function($j,$O){if(this._orthographic){var $V=$d.clientWidth,$l=$d.clientHeight,$T=this.orthographicVerticalSize*this.aspectRatio/$V,$S=this.orthographicVerticalSize/$l,$m=$j.elements,$p=$O.elements;return $p[0]=(-$V/2+$m[0])*$T,$p[1]=($l/2-$m[1])*$S,$p[2]=(this.nearPlane-this.farPlane)*($m[2]+1)/2-this.nearPlane,$mO.transformCoordinate($O,this.transform.worldMatrix,$O),!0}return!1},$s(0,$O,"projectionViewMatrix",function(){return $jO.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$s(0,$O,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $j=this.viewport;return $j.width/$j.height},function($j){if($j<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$j,this._calculateProjectionMatrix()}),$s(0,$O,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$s(0,$O,"needViewport",function(){var $j=this.normalizedViewport;return 0===$j.x&&0===$j.y&&1===$j.width&&1===$j.height}),$s(0,$O,"viewport",function(){if(this._viewportExpressedInClipSpace){var $j=this._normalizedViewport,$O=this.renderTargetSize,$V=$O.width,$l=$O.height;this._viewport.x=$j.x*$V,this._viewport.y=$j.y*$l,this._viewport.width=$j.width*$V,this._viewport.height=$j.height*$l}return this._viewport},function($j){if(null!=this.renderTarget&&($j.x<0||$j.y<0||0==$j.width||0==$j.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$j,this._calculateProjectionMatrix()}),$s(0,$O,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $j=this._viewport,$O=this.renderTargetSize,$V=$O.width,$l=$O.height;this._normalizedViewport.x=$j.x/$V,this._normalizedViewport.y=$j.y/$l,this._normalizedViewport.width=$j.width/$V,this._normalizedViewport.height=$j.height/$l}return this._normalizedViewport},function($j){$j.x<0&&($j.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$j.y<0&&($j.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$j.x+$j.width&&($j.width=1-$j.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$j.y+$j.height&&($j.height=1-$j.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$j,this._calculateProjectionMatrix()}),$s(0,$O,"projectionMatrix",function(){return this._projectionMatrix},function($j){this._projectionMatrix=$j,this._useUserProjectionMatrix=!0}),$s(0,$O,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$e($m,["_tempVector20",function(){return this._tempVector20=new $SO}]),$m}()),$KO=function($V){function $l($j,$O){$l.__super.call(this,$O),this._geometryFilter=new $YO(this),this._render=new $RO(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$j&&(this._geometryFilter.sharedMesh=$j)instanceof laya.d3.resource.models.Mesh&&($j.loaded?this._render.sharedMaterials=$j.materials:$j.once("loaded",this,this._applyMeshMaterials))}$w($l,"laya.d3.core.MeshSprite3D",$V);var $j=$l.prototype;return $j._changeRenderObjectByMesh=function($j){var $O=this._render._renderElements,$V=$O[$j];$V||($V=$O[$j]=new $EO),$V._render=this._render;var $l=this._render.sharedMaterials[$j];$l||($l=$nO.defaultMaterial);var $T=this._geometryFilter.sharedMesh.getRenderElement($j);return $V._mainSortID=this._getSortID($T,$l),$V._sprite3D=this,$V.renderObj=$T,$V._material=$l,$V},$j._changeRenderObjectByMaterial=function($j,$O){var $V=this._render._renderElements[$j];$O||($O=$nO.defaultMaterial);var $l=this._geometryFilter.sharedMesh.getRenderElement($j);return $V._mainSortID=this._getSortID($l,$O),$V._sprite3D=this,$V.renderObj=$l,$V._material=$O,$V},$j._changeRenderObjectsByMesh=function(){var $j=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$j;for(var $O=0;$O<$j;$O++)this._changeRenderObjectByMesh($O)},$j._onMeshChanged=function($j){var $O=$j.sharedMesh;$O.loaded?this._changeRenderObjectsByMesh():$O.once("loaded",this,this._onMeshLoaded)},$j._onMeshLoaded=function($j){$j===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$j._onMaterialChanged=function($j,$O,$V){$O<this._render._renderElements.length&&this._changeRenderObjectByMaterial($O,$V)},$j._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$j._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$j._parseCustomProps=function($j,$O,$V,$l){var $T=this.meshRender,$S=$V.lightmapIndex;null!=$S&&($T.lightmapIndex=$S);var $m,$p,$o=$V.lightmapScaleOffset;if($o&&($T.lightmapScaleOffset=new $pO($o[0],$o[1],$o[2],$o[3])),$l.instanceParams)($m=$l.instanceParams.loadPath)&&($p=$h.getRes($O[$m]),(this.meshFilter.sharedMesh=$p).loaded?$T.sharedMaterials=$p.materials:$p.once("loaded",this,this._applyMeshMaterials));else{($m=$V.meshPath)&&($p=$h.getRes($O[$m]),this.meshFilter.sharedMesh=$p);var $H=$V.materials;if($H){var $g=$T.sharedMaterials,$e=$H.length;$g.length=$e;for(var $t=0;$t<$e;$t++)$g[$t]=$h.getRes($O[$H[$t].path]);$T.sharedMaterials=$g}}},$j._applyMeshMaterials=function($j){for(var $O=this._render.sharedMaterials,$V=$j.materials,$l=0,$T=$V.length;$l<$T;$l++)$O[$l]||($O[$l]=$V[$l]);this._render.sharedMaterials=$O},$j._addToInitStaticBatchManager=function(){$l._staticBatchManager._addInitBatchSprite(this)},$j.cloneTo=function($j){var $O=$j;$O._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $V=this._render,$l=$O._render;$l.enable=$V.enable,$l.sharedMaterials=$V.sharedMaterials,$l.castShadow=$V.castShadow;var $T=$V.lightmapScaleOffset;$T&&($l.lightmapScaleOffset=$T.clone()),$l.lightmapIndex=$V.lightmapIndex,$l.receiveShadow=$V.receiveShadow,$l.sortingFudge=$V.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$j)},$j.destroy=function($j){if(void 0===$j&&($j=!0),!this.destroyed){var $O=this.meshFilter.sharedMesh;null!=$O&&($O.loaded||$O.off("loaded",this,this._applyMeshMaterials)),$V.prototype.destroy.call(this,$j),this._geometryFilter._destroy()}},$s(0,$j,"meshFilter",function(){return this._geometryFilter}),$s(0,$j,"meshRender",function(){return this._render}),$l.__init__=function(){$lj._staticBatchManagers.push($l._staticBatchManager)},$l.load=function($j){return $Z.loader.create($j,null,null,$l)},$e($l,["_staticBatchManager",function(){return this._staticBatchManager=new $zO}]),$l}($yO)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($j,$O){"use strict";for(var $V in Object.defineProperty($O,"__esModule",{value:!0}),Laya){var $l=Laya[$V];$l&&$l.__isclass&&($O[$V]=$l)}}),function($j,$O,$Tj){$Tj.un,$Tj.uns;var $V=$Tj.static,$l=$Tj.class,$S=$Tj.getset,$b=$Tj.__newvec,$p=laya.maths.Bezier,$e=laya.utils.Browser,$Mj=laya.utils.Byte,$T=(laya.events.Event,laya.events.EventDispatcher),$m=laya.display.Graphics,$o=(laya.resource.HTMLCanvas,laya.utils.Handler),$H=laya.net.Loader,$t=laya.maths.MathUtil,$vj=laya.maths.Matrix,$r=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$g=(laya.renders.RenderContext,laya.resource.Resource),$w=laya.utils.RunDriver,$Sj=laya.display.Sprite,$s=laya.utils.Stat,$Yj=laya.resource.Texture,$h=(laya.net.URL,laya.utils.Utils),$v=function(){function $j(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $l($j,"laya.ani.AnimationContent"),$j}(),$Y=function(){function $j(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $l($j,"laya.ani.AnimationNodeContent"),$j}(),$c=function(){function $j(){}return $l($j,"laya.ani.AnimationParser01"),$j.parse=function($j,$O){var $V=$O.__getBuffer(),$l=0,$T=0,$S=0,$m=0,$p=0,$o=0,$H=0,$g=$O.readUTFString();$j._aniClassName=$g;var $e,$t=$O.readUTFString().split("\n"),$w=$O.getUint8(),$s=$O.getUint32(),$b=$O.getUint32();0<$s&&($e=$V.slice($s,$b));var $r=new $Mj($e);for(0<$b&&($j._publicExtData=$V.slice($b,$V.byteLength)),$j._useParent=!!$O.getUint8(),$j._anis.length=$w,$l=0;$l<$w;$l++){var $h=$j._anis[$l]=new $v;$h.nodes=new Array;var $a=$h.name=$t[$O.getUint16()];$j._aniMap[$a]=$l,$h.bone3DMap={},$h.playTime=$O.getFloat32(),$h.playTime<=0&&console.error("播放时间不能为0  url="+$j.url+" name="+$h.name);var $c=$h.nodes.length=$O.getUint8();for($T=$h.totalKeyframeDatasLength=0;$T<$c;$T++){var $A=$h.nodes[$T]=new $Y;$A.childs=[];var $Z=$O.getInt16();0<=$Z&&($A.name=$t[$Z],$h.bone3DMap[$A.name]=$T),$A.keyFrame=new Array,$A.parentIndex=$O.getInt16(),-1==$A.parentIndex?$A.parent=null:$A.parent=$h.nodes[$A.parentIndex],$A.lerpType=$O.getUint8();var $x=$O.getUint32();$r.pos=$x;var $E=$A.keyframeWidth=$r.getUint16();if($h.totalKeyframeDatasLength+=$E,0===$A.lerpType||1===$A.lerpType)for($A.interpolationMethod=[],$A.interpolationMethod.length=$E,$S=0;$S<$E;$S++)$A.interpolationMethod[$S]=$i.interpolation[$r.getUint8()];null!=$A.parent&&$A.parent.childs.push($A);var $U=$O.getUint16();0<$U&&($A.extenData=$V.slice($O.pos,$O.pos+$U),$O.pos+=$U);var $z,$$=$O.getUint16(),$_=0;for($S=0,$m=$A.keyFrame.length=$$;$S<$m;$S++){if(($z=$A.keyFrame[$S]=new $R).duration=$O.getFloat32(),$z.startTime=$_,2===$A.lerpType){$z.interpolationData=[];var $B,$M=$O.getUint8();switch($B=$O.getFloat32()){case 254:for($z.interpolationData.length=$E,$H=0;$H<$E;$H++)$z.interpolationData[$H]=0;break;case 255:for($z.interpolationData.length=$E,$H=0;$H<$E;$H++)$z.interpolationData[$H]=5;break;default:for($z.interpolationData.push($B),$o=1;$o<$M;$o++)$z.interpolationData.push($O.getFloat32())}}for($z.data=new Float32Array($E),$p=0;$p<$E;$p++)$z.data[$p]=$O.getFloat32(),-1e-8<$z.data[$p]&&$z.data[$p]<1e-8&&($z.data[$p]=0);$_+=$z.duration}$z.startTime=$h.playTime,$A.playTime=$h.playTime,$j._calculateKeyFrame($A,$$,$E)}}},$j}(),$A=function(){function $Z(){}return $l($Z,"laya.ani.AnimationParser02"),$Z.READ_DATA=function(){$Z._DATA.offset=$Z._reader.getUint32(),$Z._DATA.size=$Z._reader.getUint32()},$Z.READ_BLOCK=function(){for(var $j=$Z._BLOCK.count=$Z._reader.getUint16(),$O=$Z._BLOCK.blockStarts=[],$V=$Z._BLOCK.blockLengths=[],$l=0;$l<$j;$l++)$O.push($Z._reader.getUint32()),$V.push($Z._reader.getUint32())},$Z.READ_STRINGS=function(){var $j=$Z._reader.getUint32(),$O=$Z._reader.getUint16(),$V=$Z._reader.pos;$Z._reader.pos=$j+$Z._DATA.offset;for(var $l=0;$l<$O;$l++)$Z._strings[$l]=$Z._reader.readUTFString();$Z._reader.pos=$V},$Z.parse=function($j,$O){$Z._templet=$j;($Z._reader=$O).__getBuffer();$Z.READ_DATA(),$Z.READ_BLOCK(),$Z.READ_STRINGS();for(var $V=0,$l=$Z._BLOCK.count;$V<$l;$V++){var $T=$O.getUint16(),$S=$Z._strings[$T],$m=$Z["READ_"+$S];if(null==$m)throw new Error("model file err,no this function:"+$T+" "+$S);$m.call()}},$Z.READ_ANIMATIONS=function(){var $j=$Z._reader,$O=$j.__getBuffer(),$V=0,$l=0,$T=0,$S=0,$m=$j.getUint16(),$p=[];for($p.length=$m,$V=0;$V<$m;$V++)$p[$V]=$i.interpolation[$j.getByte()];var $o=$j.getUint8();for($Z._templet._anis.length=$o,$V=0;$V<$o;$V++){var $H=$Z._templet._anis[$V]={};$H.nodes=new Array;var $g=$H.name=$Z._strings[$j.getUint16()];$Z._templet._aniMap[$g]=$V,$H.bone3DMap={},$H.playTime=$j.getFloat32();var $e=$H.nodes.length=$j.getInt16();for($l=$H.totalKeyframeDatasLength=0;$l<$e;$l++){var $t=$H.nodes[$l]={};$t.keyframeWidth=$m,$t.childs=[];var $w=$j.getUint16();0<=$w&&($t.name=$Z._strings[$w],$H.bone3DMap[$t.name]=$l),$t.keyFrame=new Array,$t.parentIndex=$j.getInt16(),-1==$t.parentIndex?$t.parent=null:$t.parent=$H.nodes[$t.parentIndex],$H.totalKeyframeDatasLength+=$m,$t.interpolationMethod=$p,null!=$t.parent&&$t.parent.childs.push($t);var $s=$j.getUint16(),$b=null,$r=null;for($T=0,$S=$t.keyFrame.length=$s;$T<$S;$T++){($b=$t.keyFrame[$T]={}).startTime=$j.getFloat32(),$r&&($r.duration=$b.startTime-$r.startTime);var $h=$Z._DATA.offset,$a=$j.getUint32(),$c=4*$m,$A=$O.slice($h+$a,$h+$a+$c);$b.data=new Float32Array($A),$r=$b}$b.duration=0,$t.playTime=$H.playTime,$Z._templet._calculateKeyFrame($t,$s,$m)}}},$Z._templet=null,$Z._reader=null,$Z._strings=[],$V($Z,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$Z}(),$Rj=(function(){function $j(){}$l($j,"laya.ani.AnimationState"),$j.stopped=0,$j.paused=1,$j.playing=2}(),function(){function $T(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $yj,this.resultMatrix=new $vj,this._children=[]}$l($T,"laya.ani.bone.Bone");var $j=$T.prototype;return $j.setTempMatrix=function($j){this._tempMatrix=$j;var $O,$V=0;for($V=0,$O=this._children.length;$V<$O;$V++)this._children[$V].setTempMatrix(this._tempMatrix)},$j.update=function($j){var $O;if(this.rotation=this.transform.skX,$j)$O=this.resultTransform.getMatrix(),$vj.mul($O,$j,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$O=this.resultTransform.getMatrix(),$vj.mul($O,this.parentBone.resultMatrix,this.resultMatrix);else{var $V=this.parentBone,$l=NaN,$T=NaN,$S=NaN,$m=this.parentBone.resultMatrix;$O=this.resultTransform.getMatrix();var $p=$m.a*$O.tx+$m.c*$O.ty+$m.tx,$o=$m.b*$O.tx+$m.d*$O.ty+$m.ty,$H=new $vj;this.inheritRotation?($l=Math.atan2($V.resultMatrix.b,$V.resultMatrix.a),$T=Math.cos($l),$S=Math.sin($l),$H.setTo($T,$S,-$S,$T,0,0),$vj.mul(this._tempMatrix,$H,$vj.TEMP),$vj.TEMP.copyTo($H),$O=this.resultTransform.getMatrix(),$vj.mul($O,$H,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$O=this.resultTransform.getMatrix(),$vj.TEMP.identity(),$vj.TEMP.d=this.d,$vj.mul($O,$vj.TEMP,this.resultMatrix)),this.resultMatrix.tx=$p,this.resultMatrix.ty=$o}else($O=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $g,$e=0;for($e=0,$g=this._children.length;$e<$g;$e++)this._children[$e].update()},$j.updateChild=function(){var $j,$O=0;for($O=0,$j=this._children.length;$O<$j;$O++)this._children[$O].update()},$j.setRotation=function($j){this._sprite&&(this._sprite.rotation=180*$j/Math.PI)},$j.updateDraw=function($j,$O){$T.ShowBones&&!$T.ShowBones[this.name]||(this._sprite||(this._sprite=new $Sj,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$Tj.stage.addChild(this._sprite)),this._sprite.x=$j+this.resultMatrix.tx,this._sprite.y=$O+this.resultMatrix.ty);var $V,$l=0;for($l=0,$V=this._children.length;$l<$V;$l++)this._children[$l].updateDraw($j,$O)},$j.addChild=function($j){this._children.push($j),$j.parentBone=this},$j.findBone=function($j){if(this.name==$j)return this;var $O,$V,$l=0;for($l=0,$O=this._children.length;$l<$O;$l++)if($V=this._children[$l].findBone($j))return $V;return null},$j.localToWorld=function($j){var $O=$j[0],$V=$j[1];$j[0]=$O*this.resultMatrix.a+$V*this.resultMatrix.c+this.resultMatrix.tx,$j[1]=$O*this.resultMatrix.b+$V*this.resultMatrix.d+this.resultMatrix.ty},$T.ShowBones={},$T}()),$qj=function(){function $b(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$l($b,"laya.ani.bone.BoneSlot");var $j=$b.prototype;return $j.showSlotData=function($j,$O){void 0===$O&&($O=!0),this.currSlotData=$j,$O&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$j.showDisplayByName=function($j){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($j))},$j.replaceDisplayByName=function($j,$O){if(this.currSlotData){var $V;$V=this.currSlotData.getDisplayByName($j);var $l;$l=this.currSlotData.getDisplayByName($O),this.replaceDisplayByIndex($V,$l)}},$j.replaceDisplayByIndex=function($j,$O){this.currSlotData&&(this._replaceDic[$j]=$O,this.displayIndex==$j&&this.showDisplayByIndex($j))},$j.showDisplayByIndex=function($j){if(null!=this._replaceDic[$j]&&($j=this._replaceDic[$j]),this.currSlotData&&-1<$j&&$j<this.currSlotData.displayArr.length){if(this.displayIndex=$j,this.currDisplayData=this.currSlotData.displayArr[$j],this.currDisplayData){var $O=this.currDisplayData.name;this.currTexture=this.templet.getTexture($O),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$r.isConchApp||$r.isConchApp&&"0.9.15"<$Sj.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$j.replaceSkin=function($j){this._diyTexture=$j,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$j.setParentMatrix=function($j){this._parentMatrix=$j},$j.draw=function($j,$O,$V,$l){if(void 0===$V&&($V=!1),void 0===$l&&($l=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $T,$S=this.currTexture;switch(this._diyTexture&&($S=this._diyTexture),this.currDisplayData.type){case 0:if($j){var $m=this.getDisplayMatrix();if(this._parentMatrix){var $p=!1;if($m){var $o;if($vj.mul($m,this._parentMatrix,$vj.TEMP),$o=$V?(null==this._resultMatrix&&(this._resultMatrix=new $vj),this._resultMatrix):new $vj,!$r.isWebGL&&this.currDisplayData.uvs||$r.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $H=$b._tempMatrix;$H.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($H.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($p=!0,$H.rotate(-Math.PI/2)),$vj.mul($H,$vj.TEMP,$o)}else $vj.TEMP.copyTo($o);$p?$j.drawTexture($S,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$o):$j.drawTexture($S,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$o)}}}break;case 1:if(null==($T=$V?(null==this._skinSprite&&(this._skinSprite=$b.createSkinMesh()),this._skinSprite):$b.createSkinMesh()))return;var $g;if(null==this.currDisplayData.bones){var $e,$t=this.currDisplayData.weights;this.deformData&&($t=this.deformData),$e=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$E.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$E.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$t;this.currDisplayData.triangles.length;$g=this.currDisplayData.triangles,$T.init2($S,null,$g,this._mVerticleArr,$e);var $w,$s=this.getDisplayMatrix();if(this._parentMatrix)if($s)$vj.mul($s,this._parentMatrix,$vj.TEMP),$w=$V?(null==this._resultMatrix&&(this._resultMatrix=new $vj),this._resultMatrix):new $vj,$vj.TEMP.copyTo($w),$T.transform=$w}else this.skinMesh($O,$T,$l);$j.drawSkin($T);break;case 2:if(null==($T=$V?(null==this._skinSprite&&(this._skinSprite=$b.createSkinMesh()),this._skinSprite):$b.createSkinMesh()))return;this.skinMesh($O,$T,$l),$j.drawSkin($T)}}},$j.skinMesh=function($j,$O,$V){var $l,$T=this.currTexture,$S=this.currDisplayData.bones;$l=this._diyTexture?($T=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$E.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$E.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $m,$p,$o=this.currDisplayData.weights,$H=this.currDisplayData.triangles,$g=0,$e=0,$t=0,$w=NaN,$s=NaN,$b=0,$r=0,$h=[],$a=0,$c=0;if(this.deformData&&0<this.deformData.length){var $A=0;for($a=0,$c=$S.length;$a<$c;){for($t=$S[$a++]+$a,$e=$g=0;$a<$t;$a++)$p=$j[$S[$a]],$w=$o[$b]+this.deformData[$A++],$s=$o[$b+1]+this.deformData[$A++],$r=$o[$b+2],$g+=($w*$p.a+$s*$p.c+$p.tx)*$r,$e+=($w*$p.b+$s*$p.d+$p.ty)*$r,$b+=3;$h.push($g,$e)}}else for($a=0,$c=$S.length;$a<$c;){for($t=$S[$a++]+$a,$e=$g=0;$a<$t;$a++)$p=$j[$S[$a]],$w=$o[$b],$s=$o[$b+1],$r=$o[$b+2],$g+=($w*$p.a+$s*$p.c+$p.tx)*$r,$e+=($w*$p.b+$s*$p.d+$p.ty)*$r,$b+=3;$h.push($g,$e)}this._mVerticleArr=$h,$m=$H,$O.init2($T,null,$m,this._mVerticleArr,$l)},$j.drawBonePoint=function($j){$j&&this._parentMatrix&&$j.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$j.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$j.getMatrix=function(){return this._resultMatrix},$j.copy=function(){var $j=new $b;return $j.type="copy",$j.name=this.name,$j.attachmentName=this.attachmentName,$j.srcDisplayIndex=this.srcDisplayIndex,$j.parent=this.parent,$j.displayIndex=this.displayIndex,$j.templet=this.templet,$j.currSlotData=this.currSlotData,$j.currTexture=this.currTexture,$j.currDisplayData=this.currDisplayData,$j},$b.createSkinMesh=function(){return $r.isWebGL||$r.isConchApp?$w.skinAniSprite():($r.isWebGL,null)},$V($b,["_tempMatrix",function(){return this._tempMatrix=new $vj}]),$b}(),$ij=function(){function $j(){this.skinName=null,this.deformSlotDataList=[]}return $l($j,"laya.ani.bone.DeformAniData"),$j}(),$kj=function(){function $j(){this.deformSlotDisplayList=[]}return $l($j,"laya.ani.bone.DeformSlotData"),$j}(),$nj=function(){function $j(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$l($j,"laya.ani.bone.DeformSlotDisplayData");var $O=$j.prototype;return $O.binarySearch1=function($j,$O){var $V=0,$l=$j.length-2;if(0==$l)return 1;for(var $T=$l>>>1;;){if($j[Math.floor($T+1)]<=$O?$V=$T+1:$l=$T,$V==$l)return $V+1;$T=$V+$l>>>1}return 0},$O.apply=function($j,$O,$V){if(void 0===$V&&($V=1),$j+=.05,!(this.timeList.length<=0)){var $l=0;if(!($j<this.timeList[0])){var $T=this.vectices[0].length,$S=[],$m=this.binarySearch1(this.timeList,$j);if(this.frameIndex=$m,$j>=this.timeList[this.timeList.length-1]){var $p=this.vectices[this.vectices.length-1];if($V<1)for($l=0;$l<$T;$l++)$S[$l]+=($p[$l]-$S[$l])*$V;else for($l=0;$l<$T;$l++)$S[$l]=$p[$l];this.deformData=$S}else{this.tweenKeyList[this.frameIndex];var $o=this.vectices[this.frameIndex-1],$H=this.vectices[this.frameIndex],$g=this.timeList[this.frameIndex-1],$e=this.timeList[this.frameIndex];$V=this.tweenKeyList[$m-1]?($j-$g)/($e-$g):0;var $t=NaN;for($l=0;$l<$T;$l++)$t=$o[$l],$S[$l]=$t+($H[$l]-$t)*$V;this.deformData=$S}}}},$j}(),$Gj=function(){function $j(){this.time=NaN,this.drawOrder=[]}return $l($j,"laya.ani.bone.DrawOrderData"),$j}(),$Fj=function(){function $j(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $l($j,"laya.ani.bone.EventData"),$j}(),$a=function(){function $lj($j,$O){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$j,this._targetBone=$O[$j.targetBoneIndex],this.isSpine=$j.isSpine,null==this._bones&&(this._bones=[]);for(var $V=this._bones.length=0,$l=$j.boneIndexs.length;$V<$l;$V++)this._bones.push($O[$j.boneIndexs[$V]]);this.name=$j.name,this.mix=$j.mix,this.bendDirection=$j.bendDirection}$l($lj,"laya.ani.bone.IkConstraint");var $j=$lj.prototype;return $j.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$j._applyIk1=function($j,$O,$V,$l){var $T=$j.parentBone,$S=1/($T.resultMatrix.a*$T.resultMatrix.d-$T.resultMatrix.b*$T.resultMatrix.c),$m=$O-$T.resultMatrix.tx,$p=$V-$T.resultMatrix.ty,$o=($m*$T.resultMatrix.d-$p*$T.resultMatrix.c)*$S-$j.transform.x,$H=($p*$T.resultMatrix.a-$m*$T.resultMatrix.b)*$S-$j.transform.y,$g=Math.atan2($H,$o)*$lj.radDeg-0-$j.transform.skX;$j.transform.scX<0&&($g+=180),180<$g?$g-=360:$g<-180&&($g+=360),$j.transform.skX=$j.transform.skY=$j.transform.skX+$g*$l,$j.update()},$j.updatePos=function($j,$O){this._sp&&this._sp.pos($j,$O)},$j._applyIk2=function($j,$O,$V,$l,$T,$S){if(0!=$S){var $m=$j.resultTransform.x,$p=$j.resultTransform.y,$o=$j.transform.scX,$H=$j.transform.scY,$g=$O.transform.scX,$e=0,$t=0,$w=0;$w=$o<0?($o=-$o,$e=180,-1):($e=0,1),$H<0&&($H=-$H,$w=-$w),$t=$g<0?($g=-$g,180):0;var $s=$O.resultTransform.x,$b=NaN,$r=NaN,$h=NaN,$a=$j.resultMatrix.a,$c=$j.resultMatrix.c,$A=$j.resultMatrix.b,$Z=$j.resultMatrix.d,$x=Math.abs($o-$H)<=1e-4;$h=$x?($r=$a*$s+$c*($b=$O.resultTransform.y)+$j.resultMatrix.tx,$A*$s+$Z*$b+$j.resultMatrix.ty):($b=0,$r=$a*$s+$j.resultMatrix.tx,$A*$s+$j.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $Sj,$Tj.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($V,$l,15,"#ffff00"),this._sp.graphics.drawCircle($r,$h,15,"#ff00ff")),$j.setRotation(Math.atan2($h-$j.resultMatrix.ty,$r-$j.resultMatrix.tx));var $E=$j.parentBone;$a=$E.resultMatrix.a,$c=$E.resultMatrix.c,$A=$E.resultMatrix.b;var $U=1/($a*($Z=$E.resultMatrix.d)-$c*$A),$z=$V-$E.resultMatrix.tx,$$=$l-$E.resultMatrix.ty,$_=($z*$Z-$$*$c)*$U-$m,$B=($$*$a-$z*$A)*$U-$p,$M=(($z=$r-$E.resultMatrix.tx)*$Z-($$=$h-$E.resultMatrix.ty)*$c)*$U-$m,$v=($$*$a-$z*$A)*$U-$p,$Y=Math.sqrt($M*$M+$v*$v),$R=$O.length*$g,$q=NaN,$i=NaN;if($x){var $k=($_*$_+$B*$B-$Y*$Y-($R*=$o)*$R)/(2*$Y*$R);$k<-1?$k=-1:1<$k&&($k=1),$i=Math.acos($k)*$T,$a=$Y+$R*$k,$c=$R*Math.sin($i),$q=Math.atan2($B*$a-$_*$c,$_*$a+$B*$c)}else{var $n=($a=$o*$R)*$a,$G=($c=$H*$R)*$c,$F=$_*$_+$B*$B,$N=Math.atan2($B,$_),$X=-2*$G*$Y,$f=$G-$n;if(0<($Z=$X*$X-4*$f*($A=$G*$Y*$Y+$n*$F-$n*$G))){var $C=Math.sqrt($Z);$X<0&&($C=-$C);var $J=($C=-($X+$C)/2)/$f,$u=$A/$C,$y=Math.abs($J)<Math.abs($u)?$J:$u;$y*$y<=$F&&($$=Math.sqrt($F-$y*$y)*$T,$q=$N-Math.atan2($$,$y),$i=Math.atan2($$/$H,($y-$Y)/$o))}var $W=0,$K=Number.MAX_VALUE,$d=0,$L=0,$Q=0,$D=0,$I=0,$P=0;$D<($Z=($z=$Y+$a)*$z)&&($Q=0,$D=$Z,$I=$z),($Z=($z=$Y-$a)*$z)<$K&&($W=Math.PI,$K=$Z,$d=$z);var $jj=Math.acos(-$a*$Y/($n-$G));($Z=($z=$a*Math.cos($jj)+$Y)*$z+($$=$c*Math.sin($jj))*$$)<$K&&($W=$jj,$K=$Z,$d=$z,$L=$$),$D<$Z&&($Q=$jj,$D=$Z,$I=$z,$P=$$),$i=$F<=($K+$D)/2?($q=$N-Math.atan2($L*$T,$d),$W*$T):($q=$N-Math.atan2($P*$T,$I),$Q*$T)}var $Oj=Math.atan2($b,$s)*$w,$Vj=$j.resultTransform.skX;180<($q=($q-$Oj)*$lj.radDeg+$e-$Vj)?$q-=360:$q<-180&&($q+=360),$j.resultTransform.x=$m,$j.resultTransform.y=$p,$j.resultTransform.skX=$j.resultTransform.skY=$Vj+$q*$S,$Vj=$O.resultTransform.skX,180<($i=(($i+$Oj)*$lj.radDeg-0)*$w+$t-($Vj%=360))?$i-=360:$i<-180&&($i+=360),$O.resultTransform.x=$s,$O.resultTransform.y=$b,$O.resultTransform.skX=$O.resultTransform.skY=$O.resultTransform.skY+$i*$S,$j.update()}},$j._applyIk3=function($j,$O,$V,$l,$T,$S){if(0!=$S){var $m,$p,$o=$O.resultMatrix.a*$O.length,$H=$O.resultMatrix.b*$O.length,$g=$o*$o+$H*$H,$e=Math.sqrt($g),$t=$j.resultMatrix.tx,$w=$j.resultMatrix.ty,$s=$O.resultMatrix.tx,$b=$O.resultMatrix.ty,$r=$s-$t,$h=$b-$w,$a=$r*$r+$h*$h,$c=Math.sqrt($a),$A=($r=$V-$j.resultMatrix.tx)*$r+($h=$l-$j.resultMatrix.ty)*$h,$Z=Math.sqrt($A);if($e+$c<=$Z||$Z+$e<=$c||$Z+$c<=$e){var $x=NaN;$s=$t+($x=$e+$c<=$Z?1:-1)*($V-$t)*$c/$Z,$b=$w+$x*($l-$w)*$c/$Z}else{var $E=($a-$g+$A)/(2*$A),$U=Math.sqrt($a-$E*$E*$A)/$Z,$z=$t+$r*$E,$$=$w+$h*$E,$_=-$h*$U,$B=$r*$U;$b=0<$T?($s=$z-$_,$$-$B):($s=$z+$_,$$+$B)}$m=$s,$p=$b,this.isDebug&&(this._sp||(this._sp=new $Sj,$Tj.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($t,$w,15,"#ff00ff"),this._sp.graphics.drawCircle($V,$l,15,"#ffff00"),this._sp.graphics.drawCircle($m,$p,15,"#ff00ff"));var $M,$v;$M=Math.atan2($p-$j.resultMatrix.ty,$m-$j.resultMatrix.tx),$j.setRotation($M),($v=$lj._tempMatrix).identity(),$v.rotate($M),$v.scale($j.resultMatrix.getScaleX(),$j.resultMatrix.getScaleY()),$v.translate($j.resultMatrix.tx,$j.resultMatrix.ty),$v.copyTo($j.resultMatrix),$j.updateChild();var $Y,$R;$Y=Math.atan2($l-$p,$V-$m),$O.setRotation($Y),($R=$lj._tempMatrix).identity(),$R.rotate($Y),$R.scale($O.resultMatrix.getScaleX(),$O.resultMatrix.getScaleY()),$R.translate($m,$p),$v.copyTo($O.resultMatrix),$O.updateChild()}},$V($lj,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $vj}]),$lj}(),$Nj=function(){function $j(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $l($j,"laya.ani.bone.IkConstraintData"),$j}(),$Z=function(){function $R($j,$O){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$j,this.position=$j.position,this.spacing=$j.spacing,this.rotateMix=$j.rotateMix,this.translateMix=$j.translateMix,this.bones=[];for(var $V=this.data.bones,$l=0,$T=$V.length;$l<$T;$l++)this.bones.push($O[$V[$l]])}$l($R,"laya.ani.bone.PathConstraint");var $j=$R.prototype;return $j.apply=function($j,$O){if(this.target){var $V=this.translateMix,$l=this.translateMix,$T=0<$l,$S=this.data.spacingMode,$m="length"==$S,$p=this.data.rotateMode,$o="tangent"==$p,$H="chainScale"==$p,$g=[],$e=this.bones.length,$t=$o?$e:$e+1,$w=[];(this._spaces=$w)[0]=this.position;var $s=this.spacing;if($H||$m)for(var $b=0,$r=$t-1;$b<$r;){var $h=this.bones[$b],$a=$h.length,$c=$a*$h.resultMatrix.a,$A=$a*$h.resultMatrix.b;$a=Math.sqrt($c*$c+$A*$A),$H&&($g[$b]=$a),$w[++$b]=$m?Math.max(0,$a+$s):$s}else for($b=1;$b<$t;$b++)$w[$b]=$s;var $Z=this.computeWorldPositions(this.target,$j,$O,$t,$o,"percent"==this.data.positionMode,"percent"==$S);if(this._debugKey){for($b=0;$b<$Z.length;$b++)$O.drawCircle($Z[$b++],$Z[$b++],5,"#00ff00");var $x=[];for($b=0;$b<$Z.length;$b++)$x.push($Z[$b++],$Z[$b++]);$O.drawLines(0,0,$x,"#ff0000")}var $E=$Z[0],$U=$Z[1],$z=this.data.offsetRotation,$$="chain"==$p&&0==$z,$_=NaN;for($b=0,$_=3;$b<$e;$b++,$_+=3){($h=this.bones[$b]).resultMatrix.tx+=($E-$h.resultMatrix.tx)*$V,$h.resultMatrix.ty+=($U-$h.resultMatrix.ty)*$V;var $B=($c=$Z[$_])-$E,$M=($A=$Z[$_+1])-$U;if($H&&0!=($a=$g[$b])){var $v=(Math.sqrt($B*$B+$M*$M)/$a-1)*$l+1;$h.resultMatrix.a*=$v,$h.resultMatrix.c*=$v}if($E=$c,$U=$A,$T){var $Y=$h.resultMatrix.a,$R=$h.resultMatrix.c,$q=$h.resultMatrix.b,$i=$h.resultMatrix.d,$k=NaN,$n=NaN,$G=NaN;$k=$o?$Z[$_-1]:0==$w[$b+1]?$Z[$_+2]:Math.atan2($M,$B),$k-=Math.atan2($q,$Y)-$z/180*Math.PI,$$&&($n=Math.cos($k),$G=Math.sin($k),$E+=(($a=$h.length)*($n*$Y-$G*$q)-$B)*$l,$U+=($a*($G*$Y+$n*$q)-$M)*$l),$k>Math.PI?$k-=2*Math.PI:$k<-Math.PI&&($k+=2*Math.PI),$k*=$l,$n=Math.cos($k),$G=Math.sin($k),$h.resultMatrix.a=$n*$Y-$G*$q,$h.resultMatrix.c=$n*$R-$G*$i,$h.resultMatrix.b=$G*$Y+$n*$q,$h.resultMatrix.d=$G*$R+$n*$i}}}},$j.computeWorldVertices2=function($j,$O,$V,$l,$T,$S){var $m,$p,$o=$j.currDisplayData.bones,$H=$j.currDisplayData.weights,$g=$j.currDisplayData.triangles,$e=0,$t=0,$w=0,$s=0,$b=0,$r=0,$h=0,$a=0,$c=0,$A=0,$Z=0;if(null!=$o){for($e=0;$e<$V;$e+=2)$t+=($s=$o[$t])+1,$w+=$s;var $x=$O;for($b=$S,$r=3*$w;$b<$l;$b+=2){for($a=$h=0,$s=$o[$t++],$s+=$t;$t<$s;$t++,$r+=3){$m=$x[$o[$t]].resultMatrix,$c=$H[$r],$A=$H[$r+1];var $E=$H[$r+2];$h+=($c*$m.a+$A*$m.c+$m.tx)*$E,$a+=($c*$m.b+$A*$m.d+$m.ty)*$E}$T[$b]=$h,$T[$b+1]=$a}}else{var $U,$z;if($g||($g=$H),$j.deformData&&($g=$j.deformData),$U=$j.parent,$O)for($Z=$O.length,$e=0;$e<$Z;$e++)if($O[$e].name==$U){$p=$O[$e];break}$p&&($z=$p.resultMatrix),$z||($z=$R._tempMt);var $$=$z.tx,$_=$z.ty,$B=$z.a,$M=$z.b,$v=$z.c,$Y=$z.d;for($p&&($Y*=$p.d),$t=$V,$b=$S;$b<$l;$t+=2,$b+=2)$c=$g[$t],$A=$g[$t+1],$T[$b]=$c*$B+$A*$M+$$,$T[$b+1]=-($c*$v+$A*$Y+$_)}},$j.computeWorldPositions=function($j,$O,$V,$l,$T,$S,$m){$j.currDisplayData.bones,$j.currDisplayData.weights,$j.currDisplayData.triangles;var $p=[],$o=0,$H=$j.currDisplayData.verLen,$g=this.position,$e=this._spaces,$t=[],$w=[],$s=$H/6,$b=-1,$r=NaN,$h=0,$a=0,$c=NaN,$A=NaN,$Z=NaN,$x=NaN;if($s--,$H-=4,this.computeWorldVertices2($j,$O,2,$H,$p,0),this._debugKey)for($o=0;$o<$p.length;)$V.drawCircle($p[$o++],$p[$o++],10,"#ff0000");$t=$p,this._curves.length=$s;var $E=this._curves,$U=$t[$r=0],$z=$t[1],$$=0,$_=0,$B=0,$M=0,$v=0,$Y=0,$R=NaN,$q=NaN,$i=NaN,$k=NaN,$n=NaN,$G=NaN,$F=NaN,$N=NaN,$X=0;for($o=0,$X=2;$o<$s;$o++,$X+=6)$$=$t[$X],$_=$t[$X+1],$B=$t[$X+2],$M=$t[$X+3],$n=2*($R=.1875*($U-2*$$+$B))+($i=.09375*(3*($$-$B)-$U+($v=$t[$X+4]))),$G=2*($q=.1875*($z-2*$_+$M))+($k=.09375*(3*($_-$M)-$z+($Y=$t[$X+5]))),$F=.75*($$-$U)+$R+.16666667*$i,$N=.75*($_-$z)+$q+.16666667*$k,$r+=Math.sqrt($F*$F+$N*$N),$F+=$n,$N+=$G,$n+=$i,$G+=$k,$r+=Math.sqrt($F*$F+$N*$N),$F+=$n,$N+=$G,$r+=Math.sqrt($F*$F+$N*$N),$F+=$n+$i,$N+=$G+$k,$r+=Math.sqrt($F*$F+$N*$N),$E[$o]=$r,$U=$v,$z=$Y;if($S&&($g*=$r),$m)for($o=0;$o<$l;$o++)$e[$o]*=$r;var $f=this._segments,$C=0,$J=0;for($J=$a=$h=$o=0;$o<$l;$o++,$h+=3)if(($c=$g+=$A=$e[$o])<0)this.addBeforePosition($c,$t,0,$w,$h);else if($r<$c)this.addAfterPosition($c-$r,$t,$H-4,$w,$h);else{for(;;$a++)if(!(($x=$E[$a])<$c)){0==$a?$c/=$x:$c=($c-($Z=$E[$a-1]))/($x-$Z);break}if($a!=$b){var $u=6*($b=$a);for($U=$t[$u],$z=$t[$u+1],$$=$t[$u+2],$_=$t[$u+3],$B=$t[$u+4],$M=$t[$u+5],$n=2*($R=.03*($U-2*$$+$B))+($i=.006*(3*($$-$B)-$U+($v=$t[$u+6]))),$G=2*($q=.03*($z-2*$_+$M))+($k=.006*(3*($_-$M)-$z+($Y=$t[$u+7]))),$F=.3*($$-$U)+$R+.16666667*$i,$N=.3*($_-$z)+$q+.16666667*$k,$C=Math.sqrt($F*$F+$N*$N),$f[0]=$C,$u=1;$u<8;$u++)$F+=$n,$N+=$G,$n+=$i,$G+=$k,$C+=Math.sqrt($F*$F+$N*$N),$f[$u]=$C;$F+=$n,$N+=$G,$C+=Math.sqrt($F*$F+$N*$N),$f[8]=$C,$F+=$n+$i,$N+=$G+$k,$C+=Math.sqrt($F*$F+$N*$N),$f[9]=$C,$J=0}for($c*=$C;;$J++)if(!(($x=$f[$J])<$c)){0==$J?$c/=$x:$c=$J+($c-($Z=$f[$J-1]))/($x-$Z);break}this.addCurvePosition(.1*$c,$U,$z,$$,$_,$B,$M,$v,$Y,$w,$h,$T||0<$o&&0==$A)}return $w},$j.addBeforePosition=function($j,$O,$V,$l,$T){var $S=$O[$V],$m=$O[$V+1],$p=$O[$V+2]-$S,$o=$O[$V+3]-$m,$H=Math.atan2($o,$p);$l[$T]=$S+$j*Math.cos($H),$l[$T+1]=$m+$j*Math.sin($H),$l[$T+2]=$H},$j.addAfterPosition=function($j,$O,$V,$l,$T){var $S=$O[$V+2],$m=$O[$V+3],$p=$S-$O[$V],$o=$m-$O[$V+1],$H=Math.atan2($o,$p);$l[$T]=$S+$j*Math.cos($H),$l[$T+1]=$m+$j*Math.sin($H),$l[$T+2]=$H},$j.addCurvePosition=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g,$e){0==$j&&($j=1e-4);var $t=$j*$j,$w=$t*$j,$s=1-$j,$b=$s*$s,$r=$b*$s,$h=$s*$j,$a=3*$h,$c=$s*$a,$A=$a*$j,$Z=$O*$r+$l*$c+$S*$A+$p*$w,$x=$V*$r+$T*$c+$m*$A+$o*$w;$H[$g]=$Z,$H[$g+1]=$x,$H[$g+2]=$e?Math.atan2($x-($V*$b+$T*$h*2+$m*$t),$Z-($O*$b+$l*$h*2+$S*$t)):0},$R.NONE=-1,$R.BEFORE=-2,$R.AFTER=-3,$V($R,["_tempMt",function(){return this._tempMt=new $vj}]),$R}(),$Xj=function(){function $j(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $l($j,"laya.ani.bone.PathConstraintData"),$j}(),$fj=function(){function $j(){this.name=null,this.slotArr=[]}return $l($j,"laya.ani.bone.SkinData"),$j}(),$Cj=function(){function $j(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$l($j,"laya.ani.bone.SkinSlotDisplayData");var $O=$j.prototype;return $O.createTexture=function($j){return this.texture||(this.texture=new $Yj($j.bitmap,this.uvs),$j.bitmap.alphaTexture&&(this.texture.alphaTexture=new $Yj($j.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$j.height,this.texture.height=$j.width,this.texture.offsetX=-$j.offsetX,this.texture.offsetY=-$j.offsetY,this.texture.sourceWidth=$j.sourceHeight,this.texture.sourceHeight=$j.sourceWidth):(this.texture.width=$j.width,this.texture.height=$j.height,this.texture.offsetX=-$j.offsetX,this.texture.offsetY=-$j.offsetY,this.texture.sourceWidth=$j.sourceWidth,this.texture.sourceHeight=$j.sourceHeight),$r.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$O.destory=function(){this.texture&&this.texture.destroy()},$j}(),$Jj=function(){function $j(){this.name=null,this.displayArr=[]}return $l($j,"laya.ani.bone.SlotData"),$j.prototype.getDisplayByName=function($j){for(var $O=0,$V=this.displayArr.length;$O<$V;$O++)if(this.displayArr[$O].attachmentName==$j)return $O;return-1},$j}(),$x=function(){function $j($j,$O){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$b(2,0),this._data=$j,null==this._bones&&(this._bones=[]),this.target=$O[$j.targetIndex];var $V,$l=0;for($l=0,$V=$j.boneIndexs.length;$l<$V;$l++)this._bones.push($O[$j.boneIndexs[$l]]);this.rotateMix=$j.rotateMix,this.translateMix=$j.translateMix,this.scaleMix=$j.scaleMix,this.shearMix=$j.shearMix}return $l($j,"laya.ani.bone.TfConstraint"),$j.prototype.apply=function(){for(var $j,$O=this.target.resultMatrix.a,$V=this.target.resultMatrix.b,$l=this.target.resultMatrix.c,$T=this.target.resultMatrix.d,$S=0,$m=this._bones.length;$S<$m;$S++){if($j=this._bones[$S],0<this.rotateMix){var $p=$j.resultMatrix.a,$o=$j.resultMatrix.b,$H=$j.resultMatrix.c,$g=$j.resultMatrix.d,$e=Math.atan2($l,$O)-Math.atan2($H,$p)+this._data.offsetRotation*Math.PI/180;$e>Math.PI?$e-=2*Math.PI:$e<-Math.PI&&($e+=2*Math.PI),$e*=this.rotateMix;var $t=Math.cos($e),$w=Math.sin($e);$j.resultMatrix.a=$t*$p-$w*$H,$j.resultMatrix.b=$t*$o-$w*$g,$j.resultMatrix.c=$w*$p+$t*$H,$j.resultMatrix.d=$w*$o+$t*$g}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$j.resultMatrix.tx+=(this._temp[0]-$j.resultMatrix.tx)*this.translateMix,$j.resultMatrix.ty+=(this._temp[1]-$j.resultMatrix.ty)*this.translateMix,$j.updateChild()),0<this.scaleMix){var $s=Math.sqrt($j.resultMatrix.a*$j.resultMatrix.a+$j.resultMatrix.c*$j.resultMatrix.c),$b=Math.sqrt($O*$O+$l*$l),$r=1e-5<$s?($s+($b-$s+this._data.offsetScaleX)*this.scaleMix)/$s:0;$j.resultMatrix.a*=$r,$j.resultMatrix.c*=$r,$s=Math.sqrt($j.resultMatrix.b*$j.resultMatrix.b+$j.resultMatrix.d*$j.resultMatrix.d),$b=Math.sqrt($V*$V+$T*$T),$r=1e-5<$s?($s+($b-$s+this._data.offsetScaleY)*this.scaleMix)/$s:0,$j.resultMatrix.b*=$r,$j.resultMatrix.d*=$r}if(0<this.shearMix){$o=$j.resultMatrix.b,$g=$j.resultMatrix.d;var $h=Math.atan2($g,$o);($e=Math.atan2($T,$V)-Math.atan2($l,$O)-($h-Math.atan2($j.resultMatrix.c,$j.resultMatrix.a)))>Math.PI?$e-=2*Math.PI:$e<-Math.PI&&($e+=2*Math.PI),$e=$h+($e+this._data.offsetShearY*Math.PI/180)*this.shearMix,$r=Math.sqrt($o*$o+$g*$g),$j.resultMatrix.b=Math.cos($e)*$r,$j.resultMatrix.d=Math.sin($e)*$r}}},$j}(),$uj=function(){function $j(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $l($j,"laya.ani.bone.TfConstraintData"),$j}(),$yj=function(){function $j(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$l($j,"laya.ani.bone.Transform");var $O=$j.prototype;return $O.initData=function($j){null!=$j.x&&(this.x=$j.x),null!=$j.y&&(this.y=$j.y),null!=$j.skX&&(this.skX=$j.skX),null!=$j.skY&&(this.skY=$j.skY),null!=$j.scX&&(this.scX=$j.scX),null!=$j.scY&&(this.scY=$j.scY)},$O.getMatrix=function(){var $j;return($j=this.mMatrix?this.mMatrix:this.mMatrix=new $vj).identity(),$j.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($j,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$j.rotate(this.skX*Math.PI/180),$j.translate(this.x,this.y),$j},$O.skew=function($j,$O,$V){var $l=Math.sin($V),$T=Math.cos($V),$S=Math.sin($O),$m=Math.cos($O);return $j.setTo($j.a*$m-$j.b*$l,$j.a*$S+$j.b*$T,$j.c*$m-$j.d*$l,$j.c*$S+$j.d*$T,$j.tx*$m-$j.ty*$l,$j.tx*$S+$j.ty*$T),$j},$j}(),$E=function(){function $j(){}return $l($j,"laya.ani.bone.UVTools"),$j.getRelativeUV=function($j,$O,$V){var $l=$j[0],$T=$j[2]-$j[0],$S=$j[1],$m=$j[5]-$j[1];$V||($V=[]),$V.length=$O.length;var $p,$o=0;$p=$V.length;var $H=1/$T,$g=1/$m;for($o=0;$o<$p;$o+=2)$V[$o]=($O[$o]-$l)*$H,$V[$o+1]=($O[$o+1]-$S)*$g;return $V},$j.getAbsoluteUV=function($j,$O,$V){if(0==$j[0]&&0==$j[1]&&1==$j[4]&&1==$j[5])return $V?($h.copyArray($V,$O),$V):$O;var $l=$j[0],$T=$j[2]-$j[0],$S=$j[1],$m=$j[5]-$j[1];$V||($V=[]),$V.length=$O.length;var $p,$o=0;for($p=$V.length,$o=0;$o<$p;$o+=2)$V[$o]=$O[$o]*$T+$l,$V[$o+1]=$O[$o+1]*$m+$S;return $V},$j}(),$R=function(){function $j(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $l($j,"laya.ani.KeyFramesContent"),$j}(),$U=function(){function $g(){}return $l($g,"laya.ani.math.BezierLerp"),$g.getBezierRate=function($j,$O,$V,$l,$T){var $S=$g._getBezierParamKey($O,$V,$l,$T),$m=100*$S+$j;if($g._bezierResultCache[$m])return $g._bezierResultCache[$m];var $p,$o=$g._getBezierPoints($O,$V,$l,$T,$S),$H=0;for($p=$o.length,$H=0;$H<$p;$H+=2)if($j<=$o[$H])return $g._bezierResultCache[$m]=$o[$H+1],$o[$H+1];return $g._bezierResultCache[$m]=1},$g._getBezierParamKey=function($j,$O,$V,$l){return 100*(100*(100*(100*$j+$O)+$V)+$l)},$g._getBezierPoints=function($j,$O,$V,$l,$T){return $g._bezierPointsCache[$T]?$g._bezierPointsCache[$T]:($S=[0,0,$j,$O,$V,$l,1,1],$m=(new $p).getBezierPoints($S,100,3),$g._bezierPointsCache[$T]=$m);var $S,$m},$g._bezierResultCache={},$g._bezierPointsCache={},$g}(),$z=function($j){function $O(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$O.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$l($O,"laya.ani.AnimationPlayer",$T);var $V=$O.prototype;return $Tj.imps($V,{"laya.resource.IDestroy":!0}),$V._onTempletLoadedComputeFullKeyframeIndices=function($j,$O,$V){this._templet===$V&&this._cachePlayRate===$j&&this._cacheFrameRate===$O&&this._computeFullKeyframeIndices()},$V._computeFullKeyframeIndices=function(){for(var $j=this._fullFrames=[],$O=this._templet,$V=this._cacheFrameRateInterval*this._cachePlayRate,$l=0,$T=$O.getAnimationCount();$l<$T;$l++){for(var $S=[],$m=0,$p=$O.getAnimation($l).nodes.length;$m<$p;$m++){for(var $o=$O.getAnimation($l).nodes[$m],$H=Math.floor($o.playTime/$V+.01),$g=new Uint16Array($H+1),$e=-1,$t=0,$w=$o.keyFrame.length;$t<$w;$t++){var $s=$o.keyFrame[$t],$b=$s.startTime,$r=$b+$s.duration+$V;do{for(var $h=Math.floor($b/$V+.5),$a=$e+1;$a<$h;$a++)$g[$a]=$t;$g[$e=$h]=$t,$b+=$V}while($b<=$r)}$S.push($g)}$j.push($S)}},$V._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$V._calculatePlayDuration=function(){if(0!==this.state){var $j=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$j),this._playEnd>$j&&(this._playEnd=$j),this._playDuration=this._playEnd-this._playStart}},$V._setPlayParams=function($j,$O){this._currentTime=$j,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$O+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$O},$V._setPlayParamsWhenStop=function($j,$O){this._currentTime=$j,this._currentKeyframeIndex=Math.max(Math.floor($j/$O+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$O,this._currentAnimationClipIndex=-1},$V._update=function($j){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $O=this._cacheFrameRateInterval*this._cachePlayRate,$V=0;this._startUpdateLoopCount!==$s.loopCount&&($V=$j*this.playbackRate,this._elapsedPlaybackTime+=$V);var $l=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$l)return this._setPlayParamsWhenStop($l,$O),void this.event("stopped");if($V+=this._currentTime,0<$l)if($l<=$V)do{if($V-=$l,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($l,$O),this._stopWhenCircleFinish=!1,void this.event("stopped");$V<$l&&(this._setPlayParams($V,$O),this.event("complete"))}while($l<=$V);else this._setPlayParams($V,$O);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($l,$O),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$V._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$V.play=function($j,$O,$V,$l,$T){if(void 0===$j&&($j=0),void 0===$O&&($O=1),void 0===$V&&($V=2147483647),void 0===$l&&($l=0),void 0===$T&&($T=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($V<0||$l<0||$T<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$T&&$T<$l)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$O,this._overallDuration=$V,this._playStart=$l,this._playEnd=$T,this._paused=!1,this._currentAnimationClipIndex=$j,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$s.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$V.playByFrame=function($j,$O,$V,$l,$T,$S){void 0===$j&&($j=0),void 0===$O&&($O=1),void 0===$V&&($V=2147483647),void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$S&&($S=30);var $m=1e3/$S;this.play($j,$O,$V,$l*$m,$T*$m)},$V.stop=function($j){void 0===$j&&($j=!0),$j?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$S(0,$V,"playEnd",function(){return this._playEnd}),$S(0,$V,"templet",function(){return this._templet},function($j){0===!this.state&&this.stop(!0),this._templet!==$j&&((this._templet=$j).loaded?this._computeFullKeyframeIndices():$j.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$S(0,$V,"playStart",function(){return this._playStart}),$S(0,$V,"playDuration",function(){return this._playDuration}),$S(0,$V,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$S(0,$V,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$S(0,$V,"overallDuration",function(){return this._overallDuration}),$S(0,$V,"currentFrameTime",function(){return this._currentFrameTime}),$S(0,$V,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$S(0,$V,"currentPlayTime",function(){return this._currentTime+this._playStart}),$S(0,$V,"cachePlayRate",function(){return this._cachePlayRate},function($j){this._cachePlayRate!==$j&&(this._cachePlayRate=$j,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$j,this._cacheFrameRate])))}),$S(0,$V,"cacheFrameRate",function(){return this._cacheFrameRate},function($j){this._cacheFrameRate!==$j&&(this._cacheFrameRate=$j,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$j])))}),$S(0,$V,"currentTime",null,function($j){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($j<this._playStart||$j>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$s.loopCount;var $O=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$j,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$O),0),this._currentFrameTime=this._currentKeyframeIndex*$O}}),$S(0,$V,"paused",function(){return this._paused},function($j){(this._paused=$j)&&this.event("paused")}),$S(0,$V,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$S(0,$V,"destroyed",function(){return this._destroyed}),$O}(),$q=function($j){function $O(){$O.__super.call(this),$r.isConchNode&&(this.drawSkin=function($j){$j.transform||($j.transform=$vj.EMPTY),this._addCmd([$j]),this.setSkinMesh&&this.setSkinMesh($j._ps,$j.mVBData,$j.mEleNum,0,$j.mTexture,$j.transform)})}return $l($O,"laya.ani.GraphicsAni",$m),$O.prototype.drawSkin=function($j){var $O=[$j];this._saveToCmd($r._context._drawSkin,$O)},$O.create=function(){return $O._caches.pop()||new $O},$O.recycle=function($j){$j.clear(),$O._caches.push($j)},$O._caches=[],$O}(),$i=function($j){function $a(){this._aniMap={},this.unfixedLastAniIndex=-1,$a.__super.call(this),this._anis=new Array}$l($a,"laya.ani.AnimationTemplet",$g);var $O=$a.prototype;return $O.parse=function($j){var $O=new $Mj($j);this._aniVersion=$O.readUTFString(),$c.parse(this,$O)},$O._calculateKeyFrame=function($j,$O,$V){var $l=$j.keyFrame;$l[$O]=$l[0];for(var $T=0;$T<$O;$T++){var $S=$l[$T];$S.nextData=0===$S.duration?$S.data:$l[$T+1].data}$l.length--},$O.onAsynLoaded=function($j,$O,$V){var $l=new $Mj($O);switch(this._aniVersion=$l.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$A.parse(this,$l);break;default:$c.parse(this,$l)}this._endLoaded()},$O.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$O.getAnimationCount=function(){return this._anis.length},$O.getAnimation=function($j){return this._anis[$j]},$O.getAniDuration=function($j){return this._anis[$j].playTime},$O.getNodes=function($j){return this._anis[$j].nodes},$O.getNodeIndexWithName=function($j,$O){return this._anis[$j].bone3DMap[$O]},$O.getNodeCount=function($j){return this._anis[$j].nodes.length},$O.getTotalkeyframesLength=function($j){return this._anis[$j].totalKeyframeDatasLength},$O.getPublicExtData=function(){return this._publicExtData},$O.getAnimationDataWithCache=function($j,$O,$V,$l){var $T=$O[$V];if($T){var $S=$T[$j];return $S?$S[$l]:null}return null},$O.setAnimationDataWithCache=function($j,$O,$V,$l,$T){var $S=$O[$V]||($O[$V]={});($S[$j]||($S[$j]=[]))[$l]=$T},$O.getOriginalData=function($j,$O,$V,$l,$T){for(var $S=this._anis[$j].nodes,$m=0,$p=0,$o=$S.length,$H=0;$p<$o;$p++){var $g,$e=$S[$p];$g=$e.keyFrame[$V[$p][$l]],$e.dataOffset=$H;var $t=$T-$g.startTime,$w=$e.lerpType;if($w)switch($w){case 0:case 1:for($m=0;$m<$e.keyframeWidth;)$m+=$e.interpolationMethod[$m]($e,$m,$O,$H+$m,$g.data,$t,null,$g.duration,$g.nextData);break;case 2:var $s=$g.interpolationData,$b=$s.length,$r=0;for($m=0;$m<$b;){var $h=$s[$m];switch($h){case 6:case 7:$m+=$a.interpolation[$h]($e,$r,$O,$H+$r,$g.data,$t,null,$g.duration,$g.nextData,$s,$m+1);break;default:$m+=$a.interpolation[$h]($e,$r,$O,$H+$r,$g.data,$t,null,$g.duration,$g.nextData)}$r++}}else for($m=0;$m<$e.keyframeWidth;)$m+=$e.interpolationMethod[$m]($e,$m,$O,$H+$m,$g.data,$t,null,$g.duration,$g.nextData);$H+=$e.keyframeWidth}},$O.getNodesCurrentFrameIndex=function($j,$O){var $V=this._anis[$j].nodes;$j!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($V.length),this.unfixedCurrentTimes=new Float32Array($V.length),this.unfixedLastAniIndex=$j);for(var $l=0,$T=$V.length;$l<$T;$l++){var $S=$V[$l];for($O<this.unfixedCurrentTimes[$l]&&(this.unfixedCurrentFrameIndexes[$l]=0),this.unfixedCurrentTimes[$l]=$O;this.unfixedCurrentFrameIndexes[$l]<$S.keyFrame.length&&!($S.keyFrame[this.unfixedCurrentFrameIndexes[$l]].startTime>this.unfixedCurrentTimes[$l]);)this.unfixedCurrentFrameIndexes[$l]++;this.unfixedCurrentFrameIndexes[$l]--}return this.unfixedCurrentFrameIndexes},$O.getOriginalDataUnfixedRate=function($j,$O,$V){var $l=this._anis[$j].nodes;$j!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($l.length),this.unfixedCurrentTimes=new Float32Array($l.length),this.unfixedKeyframes=$b($l.length),this.unfixedLastAniIndex=$j);for(var $T=0,$S=0,$m=$l.length,$p=0;$S<$m;$S++){var $o=$l[$S];for($V<this.unfixedCurrentTimes[$S]&&(this.unfixedCurrentFrameIndexes[$S]=0),this.unfixedCurrentTimes[$S]=$V;this.unfixedCurrentFrameIndexes[$S]<$o.keyFrame.length&&!($o.keyFrame[this.unfixedCurrentFrameIndexes[$S]].startTime>this.unfixedCurrentTimes[$S]);)this.unfixedKeyframes[$S]=$o.keyFrame[this.unfixedCurrentFrameIndexes[$S]],this.unfixedCurrentFrameIndexes[$S]++;var $H=this.unfixedKeyframes[$S];$o.dataOffset=$p;var $g=$V-$H.startTime;if($o.lerpType)switch($o.lerpType){case 0:case 1:for($T=0;$T<$o.keyframeWidth;)$T+=$o.interpolationMethod[$T]($o,$T,$O,$p+$T,$H.data,$g,null,$H.duration,$H.nextData);break;case 2:var $e=$H.interpolationData,$t=$e.length,$w=0;for($T=0;$T<$t;){var $s=$e[$T];switch($s){case 6:case 7:$T+=$a.interpolation[$s]($o,$w,$O,$p+$w,$H.data,$g,null,$H.duration,$H.nextData,$e,$T+1);break;default:$T+=$a.interpolation[$s]($o,$w,$O,$p+$w,$H.data,$g,null,$H.duration,$H.nextData)}$w++}}else for($T=0;$T<$o.keyframeWidth;)$T+=$o.interpolationMethod[$T]($o,$T,$O,$p+$T,$H.data,$g,null,$H.duration,$H.nextData);$p+=$o.keyframeWidth}},$a._LinearInterpolation_0=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){var $g=0===$p?0:$S/$p;return $V[$l]=(1-$g)*$T[$O]+$g*$o[$O],1},$a._QuaternionInterpolation_1=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){var $g=0===$p?0:$S/$p;return $t.slerpQuaternionArray($T,$O,$o,$O,$g,$V,$l),4},$a._AngleInterpolation_2=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){return 0},$a._RadiansInterpolation_3=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){return 0},$a._Matrix4x4Interpolation_4=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){for(var $g=0;$g<16;$g++,$O++)$V[$l+$g]=$T[$O]+$S*$m[$O];return 16},$a._NoInterpolation_5=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H){return $V[$l]=$T[$O],1},$a._BezierInterpolation_6=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g){return void 0===$g&&($g=0),$V[$l]=$T[$O]+($o[$O]-$T[$O])*$U.getBezierRate($S/$p,$H[$g],$H[$g+1],$H[$g+2],$H[$g+3]),5},$a._BezierInterpolation_7=function($j,$O,$V,$l,$T,$S,$m,$p,$o,$H,$g){return void 0===$g&&($g=0),$V[$l]=$H[$g+4]+$H[$g+5]*$U.getBezierRate((.001*$S+$H[$g+6])/$H[$g+7],$H[$g],$H[$g+1],$H[$g+2],$H[$g+3]),9},$a.load=function($j){return $Tj.loader.create($j,null,null,$a)},$a.interpolation=[$a._LinearInterpolation_0,$a._QuaternionInterpolation_1,$a._AngleInterpolation_2,$a._RadiansInterpolation_3,$a._Matrix4x4Interpolation_4,$a._NoInterpolation_5,$a._BezierInterpolation_6,$a._BezierInterpolation_7],$a}(),$$=function($O){function $V($j,$O){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$V.__super.call(this),void 0===$O&&($O=0),$j&&this.init($j,$O)}$l($V,"laya.ani.bone.Skeleton",$O);var $j=$V.prototype;return $j.init=function($j,$O){void 0===$O&&($O=0);var $V,$l,$T,$S=0,$m=0;if(1==$O)for(this._graphicsCache=[],$S=0,$m=$j.getAnimationCount();$S<$m;$S++)this._graphicsCache.push([]);if(this._yReverseMatrix=$j.yReverseMatrix,this._aniMode=$O,this._templet=$j,this._player=new $z,this._player.cacheFrameRate=$j.rate,this._player.templet=$j,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$j.mBoneArr,this._rootBone=$j.mRootBone,this._aniSectionDic=$j.aniSectionDic,0<$j.ikArr.length)for(this._ikArr=[],$S=0,$m=$j.ikArr.length;$S<$m;$S++)this._ikArr.push(new $a($j.ikArr[$S],this._boneList));if(0<$j.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$S=0,$m=$j.pathArr.length;$S<$m;$S++)$V=$j.pathArr[$S],$l=new $Z($V,this._boneList),($T=this._boneSlotDic[$V.name])&&(($l=new $Z($V,this._boneList)).target=$T),this._pathDic[$V.name]=$l;if(0<$j.tfArr.length)for(this._tfArr=[],$S=0,$m=$j.tfArr.length;$S<$m;$S++)this._tfArr.push(new $x($j.tfArr[$S],this._boneList));if(0<$j.skinDataArray.length){var $p=this._templet.skinDataArray[this._skinIndex];this._skinName=$p.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$j.load=function($j,$O,$V){},$j._onLoaded=function(){},$j._parseComplete=function(){var $j=$_.TEMPLET_DICTIONARY[this._aniPath];$j&&(this.init($j,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$j._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$j._onPlay=function(){this.event("played")},$j._onStop=function(){var $j,$O=this._templet.eventAniArr[this._aniClipIndex];if($O&&this._eventIndex<$O.length)for(;this._eventIndex<$O.length;this._eventIndex++)($j=$O[this._eventIndex]).time>=this._player.playStart&&$j.time<=this._player.playEnd&&this.event("label",$j);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$j._onPause=function(){this.event("paused")},$j._parseSrcBoneMatrix=function(){var $j=0,$O=0;for($O=this._templet.srcBoneMatrixArr.length,$j=0;$j<$O;$j++)this._boneMatrixArray.push(new $vj);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $V,$l,$T=this._templet.boneSlotArray;for($j=0,$O=$T.length;$j<$O;$j++)$V=$T[$j],null==($l=this._bindBoneBoneSlotDic[$V.parent])&&(this._bindBoneBoneSlotDic[$V.parent]=$l=[]),this._boneSlotDic[$V.name]=$V=$V.copy(),$l.push($V),this._boneSlotArray.push($V)}},$j._emitMissedEvents=function($j,$O,$V){void 0===$V&&($V=0);var $l=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($l){var $T,$S,$m=0;for($T=$l.length,$m=$V;$m<$T;$m++)($S=$l[$m]).time>=this._player.playStart&&$S.time<=this._player.playEnd&&this.event("label",$S)}},$j._update=function($j){if(void 0===$j&&($j=!0),!(this._pause||$j&&this._indexControl)){var $O=this.timer.currTimer,$V=this._player.currentKeyframeIndex,$l=$O-this._lastTime;if($j?this._player._update($l):$V=-1,this._lastTime=$O,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$l&&this._clipIndex==$V&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $T;this._lastUpdateAniClipIndex=this._aniClipIndex,$V>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $S,$m=this._templet.eventAniArr[this._aniClipIndex];if($m&&this._eventIndex<$m.length&&(($T=$m[this._eventIndex]).time>=this._player.playStart&&$T.time<=this._player.playEnd?this._player.currentPlayTime>=$T.time&&(this.event("label",$T),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($S=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$S&&(this.graphics=$S));var $p=0,$o=0;for($o=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$o-1)&&0<$o;)$o--;if($o<this._clipIndex)for($p=$o;$p<this._clipIndex;$p++)this._createGraphics($p)}else if(1==this._aniMode){if($S=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$S&&(this.graphics=$S));for($o=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$o-1)&&0<$o;)$o--;if($o<this._clipIndex)for($p=$o;$p<this._clipIndex;$p++)this._createGraphics($p)}this._createGraphics()}}},$j._createGraphics=function($j){void 0===$j&&($j=-1),-1==$j&&($j=this._clipIndex);var $O,$V,$l=$j*this._player.cacheFrameRateInterval,$T=this._templet.drawOrderAniArr[this._aniClipIndex];if($T&&0<$T.length)for(this._drawOrderIndex=0,$O=$T[this._drawOrderIndex];$l>=$O.time&&(this._drawOrder=$O.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$T.length));)$O=$T[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$q.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$q.create(),$V=this.graphics;var $S=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$j,$l);var $m,$p,$o,$H,$g=this._aniSectionDic[this._aniClipIndex],$e=0,$t=0,$w=0,$s=0,$b=0,$r=this._templet.srcBoneMatrixArr.length;for($b=$g[$t=0];$t<$r;$t++)$H=this._boneList[$t],$o=this._templet.srcBoneMatrixArr[$t],$H.resultTransform.scX=$o.scX*this._curOriginalData[$e++],$H.resultTransform.skX=$o.skX+this._curOriginalData[$e++],$H.resultTransform.skY=$o.skY+this._curOriginalData[$e++],$H.resultTransform.scY=$o.scY*this._curOriginalData[$e++],$H.resultTransform.x=$o.x+this._curOriginalData[$e++],$H.resultTransform.y=$o.y+this._curOriginalData[$e++],8===this._templet.tMatrixDataLen&&($H.resultTransform.skewX=$o.skewX+this._curOriginalData[$e++],$H.resultTransform.skewY=$o.skewY+this._curOriginalData[$e++]);var $h,$a={},$c={};for($b+=$g[1];$t<$b;$t++)$a[($h=$S[$t]).name]=this._curOriginalData[$e++],$c[$h.name]=this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++];var $A,$Z,$x={},$E={};for($b+=$g[2];$t<$b;$t++)$x[($h=$S[$t]).name]=this._curOriginalData[$e++],$E[$h.name]=this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++],this._curOriginalData[$e++];if(this._pathDic)for($b+=$g[3];$t<$b;$t++){if($h=$S[$t],$A=this._pathDic[$h.name])switch(new $Mj($h.extenData).getByte()){case 1:$A.position=this._curOriginalData[$e++];break;case 2:$A.spacing=this._curOriginalData[$e++];break;case 3:$A.rotateMix=this._curOriginalData[$e++],$A.translateMix=this._curOriginalData[$e++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($vj.TEMP.identity()),this._ikArr)for($t=0,$b=this._ikArr.length;$t<$b;$t++)$Z=this._ikArr[$t],$x.hasOwnProperty($Z.name)&&($Z.bendDirection=$x[$Z.name]),$E.hasOwnProperty($Z.name)&&($Z.mix=$E[$Z.name]),$Z.apply();if(this._pathDic)for(var $U in this._pathDic)($A=this._pathDic[$U]).apply(this._boneList,$V);if(this._tfArr)for($t=0,$s=this._tfArr.length;$t<$s;$t++)this._tfArr[$t].apply();for($t=0,$s=this._boneList.length;$t<$s;$t++)if($H=this._boneList[$t],$p=this._bindBoneBoneSlotDic[$H.name],$H.resultMatrix.copyTo(this._boneMatrixArray[$t]),$p)for($w=0,$b=$p.length;$w<$b;$w++)($m=$p[$w])&&$m.setParentMatrix($H.resultMatrix);var $z,$$,$_,$B,$M={},$v=this._templet.deformAniArr;if($v&&0<$v.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$t=0,$b=this._boneSlotArray.length;$t<$b;$t++)($m=this._boneSlotArray[$t]).deformData=null;var $Y,$R=$v[this._aniClipIndex];for($Y in $z=$R.default,this._setDeform($z,$M,this._boneSlotArray,$l),$R)"default"!=$Y&&$Y!=this._skinName&&($z=$R[$Y],this._setDeform($z,$M,this._boneSlotArray,$l));$z=$R[this._skinName],this._setDeform($z,$M,this._boneSlotArray,$l)}if(this._drawOrder)for($t=0,$b=this._drawOrder.length;$t<$b;$t++)$$=$a[($m=this._boneSlotArray[this._drawOrder[$t]]).name],$_=$c[$m.name],isNaN($_)||($V.save(),$V.alpha($_)),isNaN($$)||-2==$$||(this._templet.attachmentNames?$m.showDisplayByName(this._templet.attachmentNames[$$]):$m.showDisplayByIndex($$)),$M[this._drawOrder[$t]]?($B=$M[this._drawOrder[$t]],$m.currDisplayData&&$B[$m.currDisplayData.attachmentName]?$m.deformData=$B[$m.currDisplayData.attachmentName]:$m.deformData=null):$m.deformData=null,isNaN($_)?$m.draw($V,this._boneMatrixArray,2==this._aniMode):$m.draw($V,this._boneMatrixArray,2==this._aniMode,$_),isNaN($_)||$V.restore();else for($t=0,$b=this._boneSlotArray.length;$t<$b;$t++)$$=$a[($m=this._boneSlotArray[$t]).name],$_=$c[$m.name],isNaN($_)||($V.save(),$V.alpha($_)),isNaN($$)||-2==$$||(this._templet.attachmentNames?$m.showDisplayByName(this._templet.attachmentNames[$$]):$m.showDisplayByIndex($$)),$M[$t]?($B=$M[$t],$m.currDisplayData&&$B[$m.currDisplayData.attachmentName]?$m.deformData=$B[$m.currDisplayData.attachmentName]:$m.deformData=null):$m.deformData=null,isNaN($_)?$m.draw($V,this._boneMatrixArray,2==this._aniMode):$m.draw($V,this._boneMatrixArray,2==this._aniMode,$_),isNaN($_)||$V.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$j,$V):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$j,$V)},$j._setDeform=function($j,$O,$V,$l){if($j){var $T,$S,$m,$p=0,$o=0,$H=0;if($j)for($p=0,$o=$j.deformSlotDataList.length;$p<$o;$p++)for($T=$j.deformSlotDataList[$p],$H=0;$H<$T.deformSlotDisplayList.length;$H++)$m=$V[($S=$T.deformSlotDisplayList[$H]).slotIndex],$S.apply($l,$m),$O[$S.slotIndex]||($O[$S.slotIndex]={}),$O[$S.slotIndex][$S.attachment]=$S.deformData}},$j.getAnimNum=function(){return this._templet.getAnimationCount()},$j.getAniNameByIndex=function($j){return this._templet.getAniNameByIndex($j)},$j.getSlotByName=function($j){return this._boneSlotDic[$j]},$j.showSkinByName=function($j,$O){void 0===$O&&($O=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($j),$O)},$j.showSkinByIndex=function($j,$O){void 0===$O&&($O=!0);for(var $V=0;$V<this._boneSlotArray.length;$V++)this._boneSlotArray[$V].showSlotData(null,$O);if(this._templet.showSkinByIndex(this._boneSlotDic,$j,$O)){var $l=this._templet.skinDataArray[$j];this._skinIndex=$j,this._skinName=$l.name}this._clearCache()},$j.showSlotSkinByIndex=function($j,$O){if(0!=this._aniMode){var $V=this.getSlotByName($j);$V&&$V.showDisplayByIndex($O),this._clearCache()}},$j.showSlotSkinByName=function($j,$O){if(0!=this._aniMode){var $V=this.getSlotByName($j);$V&&$V.showDisplayByName($O),this._clearCache()}},$j.replaceSlotSkinName=function($j,$O,$V){if(0!=this._aniMode){var $l=this.getSlotByName($j);$l&&$l.replaceDisplayByName($O,$V),this._clearCache()}},$j.replaceSlotSkinByIndex=function($j,$O,$V){if(0!=this._aniMode){var $l=this.getSlotByName($j);$l&&$l.replaceDisplayByIndex($O,$V),this._clearCache()}},$j.setSlotSkin=function($j,$O){if(0!=this._aniMode){var $V=this.getSlotByName($j);$V&&$V.replaceSkin($O),this._clearCache()}},$j._clearCache=function(){if(1==this._aniMode)for(var $j=0,$O=this._graphicsCache.length;$j<$O;$j++){for(var $V=0,$l=this._graphicsCache[$j].length;$V<$l;$V++){var $T=this._graphicsCache[$j][$V];$T!=this.graphics&&$q.recycle($T)}this._graphicsCache[$j].length=0}},$j.play=function($j,$O,$V,$l,$T,$S){void 0===$V&&($V=!0),void 0===$l&&($l=0),void 0===$T&&($T=0),void 0===$S&&($S=!0),this._indexControl=!1;var $m=-1,$p=NaN;if($p=$O?2147483647:0,"string"==typeof $j)for(var $o=0,$H=this._templet.getAnimationCount();$o<$H;$o++){var $g=this._templet.getAnimation($o);if($g&&$j==$g.name){$m=$o;break}}else $m=$j;-1<$m&&$m<this.getAnimNum()&&(this._aniClipIndex=$m,($V||this._pause||this._currAniIndex!=$m)&&(this._currAniIndex=$m,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($m)),this._drawOrder=null,this._eventIndex=0,this._player.play($m,this._player.playbackRate,$p,$l,$T),$S&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$e.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$j.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$j.playbackRate=function($j){this._player&&(this._player.playbackRate=$j)},$j.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$j.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$e.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$j._getGrahicsDataWithCache=function($j,$O){return this._graphicsCache[$j][$O]},$j._setGrahicsDataWithCache=function($j,$O,$V){this._graphicsCache[$j][$O]=$V},$j.destroy=function($j){void 0===$j&&($j=!0),$O.prototype.destroy.call(this,$j),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$S(0,$j,"url",function(){return this._aniPath},function($j){this.load($j)}),$S(0,$j,"index",function(){return this._index},function($j){this.player&&(this._index=$j,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$S(0,$j,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$S(0,$j,"templet",function(){return this._templet}),$S(0,$j,"player",function(){return this._player}),$V.useSimpleMeshInCanvas=!1,$V}($Sj),$_=function($O){function $T(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$T.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$l($T,"laya.ani.bone.Templet",$O);var $j=$T.prototype;return $j.getLoadList=function(){return this._loadList},$j.loadAni=function($j){this._skBufferUrl=$j,$Tj.loader.load($j,$o.create(this,this.onComplete),null,"arraybuffer")},$j.onComplete=function($j){if(this._isDestroyed)this.destroy();else{var $O=$H.getRes(this._skBufferUrl);$O?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$O)):this.event("error","load failed:"+this._skBufferUrl)}},$j.parseData=function($j,$O,$V){void 0===$V&&($V=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$j,this._mainTexture&&$r.isWebGL&&$j.bitmap&&($j.bitmap.enableMerageInAtlas=!1),this._rate=$V,this.parse($O)},$j.buildArmature=function($j){return void 0===$j&&($j=0),new $$(this,$j)},$j.parse=function($j){$O.prototype.parse.call(this,$j),this._endLoaded(),this._aniVersion!=$T.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$T.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$j._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $j=0;this._loadList=[];var $O,$V=new $Mj(this.getPublicExtData()),$l=0,$T=0,$S=0,$m=$V.getInt32(),$p=$V.readUTFString(),$o=$p.split("\n");for($j=0;$j<$m;$j++)$O=this._path+$o[2*$j],$p=$o[2*$j+1],$V.getFloat32(),$V.getFloat32(),$l=$V.getFloat32(),$T=$V.getFloat32(),$S=$V.getFloat32(),isNaN($S)?0:$S,$S=$V.getFloat32(),isNaN($S)?0:$S,$S=$V.getFloat32(),isNaN($S)?$l:$S,$S=$V.getFloat32(),isNaN($S)?$T:$S,-1==this._loadList.indexOf($O)&&this._loadList.push($O);this.event("inited",this)}},$j._textureComplete=function(){for(var $j,$O,$V=0,$l=this._loadList.length;$V<$l;$V++)$O=this._loadList[$V],$j=this._textureDic[$O]=$H.getRes($O),$r.isWebGL&&$j&&$j.bitmap&&($j.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$j._parsePublicExtData=function(){var $j=0,$O=0,$V=0,$l=0,$T=0;for($j=0,$T=this.getAnimationCount();$j<$T;$j++)this._graphicsCache.push([]);var $S;$S="Dragon"!=this._aniClassName;var $m,$p,$o=new $Mj(this.getPublicExtData()),$H=0,$g=0,$e=0,$t=0,$w=0,$s=0,$b=0,$r=0,$h=0,$a=$o.getInt32(),$c=$o.readUTFString(),$A=$c.split("\n");for($j=0;$j<$a;$j++){if($m=this._mainTexture,$p=this._path+$A[2*$j],$c=$A[2*$j+1],null==this._mainTexture&&($m=this._textureDic[$p]),!$m)return this.event("error",this),void(this.isParseFail=!0);$H=$o.getFloat32(),$g=$o.getFloat32(),$e=$o.getFloat32(),$t=$o.getFloat32(),$h=$o.getFloat32(),$w=isNaN($h)?0:$h,$h=$o.getFloat32(),$s=isNaN($h)?0:$h,$h=$o.getFloat32(),$b=isNaN($h)?$e:$h,$h=$o.getFloat32(),$r=isNaN($h)?$t:$h,this.subTextureDic[$c]=$Yj.create($m,$H,$g,$e,$t,-$w,-$s,$b,$r),$m.alphaTexture&&(this.subTextureDic[$c].alphaTexture=$Yj.create($m.alphaTexture,$H,$g,$e,$t,-$w,-$s,$b,$r))}this._mainTexture=$m;var $Z,$x,$E,$U,$z,$$=$o.getUint16();for($j=0;$j<$$;$j++)($Z=[]).push($o.getUint16()),$Z.push($o.getUint16()),$Z.push($o.getUint16()),$Z.push($o.getUint16()),this.aniSectionDic[$j]=$Z;var $_,$B=$o.getInt16(),$M={};for($j=0;$j<$B;$j++)$x=new $Rj,0==$j?$_=$x:$x.root=$_,$x.d=$S?-1:1,$U=$o.readUTFString(),$z=$o.readUTFString(),$x.length=$o.getFloat32(),1==$o.getByte()&&($x.inheritRotation=!1),1==$o.getByte()&&($x.inheritScale=!1),$x.name=$U,$z&&(($E=$M[$z])?$E.addChild($x):this.mRootBone=$x),$M[$U]=$x,this.mBoneArr.push($x);this.tMatrixDataLen=$o.getUint16();var $v,$Y,$R=$o.getUint16(),$q=Math.floor($R/this.tMatrixDataLen),$i=this.srcBoneMatrixArr;for($j=0;$j<$q;$j++)($v=new $yj).scX=$o.getFloat32(),$v.skX=$o.getFloat32(),$v.skY=$o.getFloat32(),$v.scY=$o.getFloat32(),$v.x=$o.getFloat32(),$v.y=$o.getFloat32(),8===this.tMatrixDataLen&&($v.skewX=$o.getFloat32(),$v.skewY=$o.getFloat32()),$i.push($v),($x=this.mBoneArr[$j]).transform=$v;var $k,$n=$o.getUint16(),$G=0;for($j=0;$j<$n;$j++){for($Y=new $Nj,$G=$o.getUint16(),$O=0;$O<$G;$O++)$Y.boneNames.push($o.readUTFString()),$Y.boneIndexs.push($o.getInt16());$Y.name=$o.readUTFString(),$Y.targetBoneName=$o.readUTFString(),$Y.targetBoneIndex=$o.getInt16(),$Y.bendDirection=$o.getFloat32(),$Y.mix=$o.getFloat32(),$Y.isSpine=$S,this.ikArr.push($Y)}var $F,$N=$o.getUint16(),$X=0;for($j=0;$j<$N;$j++){for($k=new $uj,$X=$o.getUint16(),$O=0;$O<$X;$O++)$k.boneIndexs.push($o.getInt16());$k.name=$o.getUTFString(),$k.targetIndex=$o.getInt16(),$k.rotateMix=$o.getFloat32(),$k.translateMix=$o.getFloat32(),$k.scaleMix=$o.getFloat32(),$k.shearMix=$o.getFloat32(),$k.offsetRotation=$o.getFloat32(),$k.offsetX=$o.getFloat32(),$k.offsetY=$o.getFloat32(),$k.offsetScaleX=$o.getFloat32(),$k.offsetScaleY=$o.getFloat32(),$k.offsetShearY=$o.getFloat32(),this.tfArr.push($k)}var $f=$o.getUint16(),$C=0;for($j=0;$j<$f;$j++){for(($F=new $Xj).name=$o.readUTFString(),$C=$o.getUint16(),$O=0;$O<$C;$O++)$F.bones.push($o.getInt16());$F.target=$o.readUTFString(),$F.positionMode=$o.readUTFString(),$F.spacingMode=$o.readUTFString(),$F.rotateMode=$o.readUTFString(),$F.offsetRotation=$o.getFloat32(),$F.position=$o.getFloat32(),$F.spacing=$o.getFloat32(),$F.rotateMix=$o.getFloat32(),$F.translateMix=$o.getFloat32(),this.pathArr.push($F)}var $J,$u,$y,$W,$K,$d=0,$L=0,$Q=0,$D=NaN,$I=0,$P=$o.getInt16();for($j=0;$j<$P;$j++){var $jj=$o.getUint8(),$Oj={};this.deformAniArr.push($Oj);for(var $Vj=0;$Vj<$jj;$Vj++)for(($J=new $ij).skinName=$o.getUTFString(),$Oj[$J.skinName]=$J,$d=$o.getInt16(),$O=0;$O<$d;$O++)for($u=new $kj,$J.deformSlotDataList.push($u),$L=$o.getInt16(),$V=0;$V<$L;$V++)for($y=new $nj,$u.deformSlotDisplayList.push($y),$y.slotIndex=$o.getInt16(),$y.attachment=$o.getUTFString(),$Q=$o.getInt16(),$l=0;$l<$Q;$l++)for(1==$o.getByte()?$y.tweenKeyList.push(!0):$y.tweenKeyList.push(!1),$D=$o.getFloat32(),$y.timeList.push($D),$W=[],$y.vectices.push($W),$I=$o.getInt16(),$T=0;$T<$I;$T++)$W.push($o.getFloat32())}var $lj,$Tj,$Sj=$o.getInt16(),$mj=0,$pj=0;for($j=0;$j<$Sj;$j++){for($mj=$o.getInt16(),$K=[],$O=0;$O<$mj;$O++){for(($lj=new $Gj).time=$o.getFloat32(),$pj=$o.getInt16(),$V=0;$V<$pj;$V++)$lj.drawOrder.push($o.getInt16());$K.push($lj)}this.drawOrderAniArr.push($K)}var $oj,$Hj=$o.getInt16(),$gj=0;for($j=0;$j<$Hj;$j++){for($gj=$o.getInt16(),$Tj=[],$O=0;$O<$gj;$O++)($oj=new $Fj).name=$o.getUTFString(),$oj.intValue=$o.getInt32(),$oj.floatValue=$o.getFloat32(),$oj.stringValue=$o.getUTFString(),$oj.time=$o.getFloat32(),$Tj.push($oj);this.eventAniArr.push($Tj)}var $ej=$o.getInt16();if(0<$ej)for(this.attachmentNames=[],$j=0;$j<$ej;$j++)this.attachmentNames.push($o.getUTFString());var $tj,$wj,$sj=$o.getInt16();for($j=0;$j<$sj;$j++)($tj=new $qj).name=$o.readUTFString(),$tj.parent=$o.readUTFString(),$tj.attachmentName=$o.readUTFString(),$tj.srcDisplayIndex=$tj.displayIndex=$o.getInt16(),($tj.templet=this).boneSlotDic[$tj.name]=$tj,null==($wj=this.bindBoneBoneSlotDic[$tj.parent])&&(this.bindBoneBoneSlotDic[$tj.parent]=$wj=[]),$wj.push($tj),this.boneSlotArray.push($tj);var $bj,$rj,$hj,$aj=$o.readUTFString().split("\n"),$cj=0,$Aj=$o.getUint8(),$Zj=0,$xj=0,$Ej=0,$Uj=0,$zj=0,$$j=0,$_j=0;for($j=0;$j<$Aj;$j++){for(($bj=new $fj).name=$aj[$cj++],$Zj=$o.getUint8(),$O=0;$O<$Zj;$O++){for(($rj=new $Jj).name=$aj[$cj++],$tj=this.boneSlotDic[$rj.name],$xj=$o.getUint8(),$V=0;$V<$xj;$V++){if($hj=new $Cj,this.skinSlotDisplayDataArr.push($hj),$hj.name=$aj[$cj++],$hj.attachmentName=$aj[$cj++],$hj.transform=new $yj,$hj.transform.scX=$o.getFloat32(),$hj.transform.skX=$o.getFloat32(),$hj.transform.skY=$o.getFloat32(),$hj.transform.scY=$o.getFloat32(),$hj.transform.x=$o.getFloat32(),$hj.transform.y=$o.getFloat32(),$rj.displayArr.push($hj),$hj.width=$o.getFloat32(),$hj.height=$o.getFloat32(),$hj.type=$o.getUint8(),$hj.verLen=$o.getUint16(),0<($B=$o.getUint16()))for($hj.bones=[],$l=0;$l<$B;$l++){var $Bj=$o.getUint16();$hj.bones.push($Bj)}if(0<($Ej=$o.getUint16()))for($hj.uvs=[],$l=0;$l<$Ej;$l++)$hj.uvs.push($o.getFloat32());if(0<($Uj=$o.getUint16()))for($hj.weights=[],$l=0;$l<$Uj;$l++)$hj.weights.push($o.getFloat32());if(0<($zj=$o.getUint16()))for($hj.triangles=[],$l=0;$l<$zj;$l++)$hj.triangles.push($o.getUint16());if(0<($$j=$o.getUint16()))for($hj.vertices=[],$l=0;$l<$$j;$l++)$hj.vertices.push($o.getFloat32());if(0<($_j=$o.getUint16()))for($hj.lengths=[],$l=0;$l<$_j;$l++)$hj.lengths.push($o.getFloat32())}$bj.slotArr.push($rj)}this.skinDic[$bj.name]=$bj,this.skinDataArray.push($bj)}1==$o.getUint8()?(this.yReverseMatrix=new $vj(1,0,0,-1,0,0),$_&&$_.setTempMatrix(this.yReverseMatrix)):$_&&$_.setTempMatrix(new $vj),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$j.getTexture=function($j){var $O=this.subTextureDic[$j];return $O||($O=this.subTextureDic[$j.substr(0,$j.length-1)]),null==$O?this._mainTexture:$O},$j.showSkinByIndex=function($j,$O,$V){if(void 0===$V&&($V=!0),$O<0&&$O>=this.skinDataArray.length)return!1;var $l,$T,$S=0,$m=0,$p=this.skinDataArray[$O];if($p){for($S=0,$m=$p.slotArr.length;$S<$m;$S++)($T=$p.slotArr[$S])&&($l=$j[$T.name])&&($l.showSlotData($T,$V),$V&&"undefined"!=$l.attachmentName&&"null"!=$l.attachmentName?$l.showDisplayByName($l.attachmentName):$l.showDisplayByIndex($l.displayIndex));return!0}return!1},$j.getSkinIndexByName=function($j){for(var $O=0,$V=this.skinDataArray.length;$O<$V;$O++)if(this.skinDataArray[$O].name==$j)return $O;return-1},$j.getGrahicsDataWithCache=function($j,$O){return this._graphicsCache[$j][$O]},$j.setGrahicsDataWithCache=function($j,$O,$V){this._graphicsCache[$j][$O]=$V},$j.destroy=function(){var $j;for(var $O in this._isDestroyed=!0,this.subTextureDic)($j=this.subTextureDic[$O])&&$j.destroy();for($O in this._textureDic)($j=this._textureDic[$O])&&$j.destroy();for(var $V=0,$l=this.skinSlotDisplayDataArr.length;$V<$l;$V++)this.skinSlotDisplayDataArr[$V].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $T.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$j.getAniNameByIndex=function($j){var $O=this.getAnimation($j);return $O?$O.name:null},$S(0,$j,"rate",function(){return this._rate},function($j){this._rate=$j}),$T.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$T.TEMPLET_DICTIONARY=null,$T}($i)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($j,$O){"use strict";for(var $V in Object.defineProperty($O,"__esModule",{value:!0}),Laya){var $l=Laya[$V];$l&&$l.__isclass&&($O[$V]=$l)}});