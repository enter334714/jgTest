var Laya=window.Laya=function(tE,tD){var tI={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(tD,tY){return 1==arguments.length?tI.__presubstr.call(this,tD):tI.__presubstr.call(this,tD,0<tY?tY:this.length+tY)},__init:function(tD){tD.forEach(function(tD){tD.__init$&&tD.__init$()})},__isClass:function(tD){return tD&&(tD.__isclass||tD==Object||tD==String||tD==Array)},__newvec:function(tD,tY){var tg=[];tg.length=tD;for(var tT=0;tT<tD;tT++)tg[tT]=tY;return tg},__extend:function(tD,tY){for(var tg in tY)if(tY.hasOwnProperty(tg)){var tT=Object.getOwnPropertyDescriptor(tY,tg),tr=tT.get,ts=tT.set;tr||ts?tr&&ts?Object.defineProperty(tD,tg,tT):(tr&&Object.defineProperty(tD,tg,tr),ts&&Object.defineProperty(tD,tg,ts)):tD[tg]=tY[tg]}function ta(){tI.un(this,"constructor",tD)}ta.prototype=tY.prototype,tD.prototype=new ta,tI.un(tD.prototype,"__imps",tI.__copy({},tY.prototype.__imps))},__copy:function(tD,tY){if(!tY)return null;for(var tg in tD=tD||{},tY)tD[tg]=tY[tg];return tD},__package:function(tD,tY){if(!tI.__packages[tD]){tI.__packages[tD]=!0;var tg=tE,tT=tD.split(".");if(1<tT.length)for(var tr=0,ts=tT.length-1;tr<ts;tr++){var ta=tg[tT[tr]];tg=ta||(tg[tT[tr]]={})}tg[tT[tT.length-1]]||(tg[tT[tT.length-1]]=tY||{})}},__hasOwnProperty:function(tD,tY){return tY=tY||this,Object.hasOwnProperty.call(tY,tD)||function tD(tY,tg){if(Object.hasOwnProperty.call(tg.prototype,tY))return!0;var tT=tg.prototype.__super;return null==tT?null:tD(tY,tT)}(tD,tY.__class)},__typeof:function(tD,tY){if(!tD||!tY)return!1;if(tY===String)return"string"==typeof tD;if(tY===Number)return"number"==typeof tD;if(tY.__interface__)tY=tY.__interface__;else if("string"!=typeof tY)return tD instanceof tY;return tD.__imps&&tD.__imps[tY]||tD.__class==tY},__as:function(tD,tY){return this.__typeof(tD,tY)?tD:null},__int:function(tD){return tD?parseInt(tD):0},interface:function(tD,tY){tI.__package(tD,{});var tg=tI.__internals,tT=tg[tD]=tg[tD]||{self:tD};if(tY){var tr=tY.split(",");tT.extend=[];for(var ts=0;ts<tr.length;ts++){var ta=tr[ts];tg[ta]=tg[ta]||{self:ta},tT.extend.push(tg[ta])}}var tW=tE,tM=tD.split(".");for(ts=0;ts<tM.length-1;ts++)tW=tW[tM[ts]];tW[tM[tM.length-1]]={__interface__:tD}},class:function(tD,tY,tg,tT){if(tg&&tI.__extend(tD,tg),tY)if(tI.__package(tY,tD),tI.__classmap[tY]=tD,0<tY.indexOf(".")){if(0==tY.indexOf("laya.")){var tr=tY.split(".");tT=tT||tr[tr.length-1],tI[tT]&&console.log("Warning!,this class["+tT+"] already exist:",tI[tT]),tI[tT]=tD}}else"Main"==tY?tE.Main=tD:"MainWX"==tY?tE.MainWX=tD:(tI[tY]&&console.log("Error!,this class["+tY+"] already exist:",tI[tY]),tI[tY]=tD);var ts=tI.un,ta=tD.prototype;ts(ta,"hasOwnProperty",tI.__hasOwnProperty),ts(ta,"__class",tD),ts(ta,"__super",tg),ts(ta,"__className",tY),ts(tD,"__super",tg),ts(tD,"__className",tY),ts(tD,"__isclass",!0),ts(tD,"super",function(tD){this.__super.call(tD)})},imps:function(tD,tY){if(!tY)return null;var tr=tD.__imps||tI.un(tD,"__imps",{});function ts(tD){var tY,tg;if((tY=tI.__internals[tD])&&(tr[tD]=!0,tg=tY.extend))for(var tT=0;tT<tg.length;tT++)ts(tg[tT].self)}for(var tg in tY)ts(tg)},superSet:function(tD,tY,tg,tT){var tr=tD.prototype["_$set_"+tg];tr&&tr.call(tY,tT)},superGet:function(tD,tY,tg){var tT=tD.prototype["_$get_"+tg];return tT?tT.call(tY):null},getset:function(tD,tY,tg,tT,tr){tD?(tT&&(tY["_$GET_"+tg]=tT),tr&&(tY["_$SET_"+tg]=tr)):(tT&&tI.un(tY,"_$get_"+tg,tT),tr&&tI.un(tY,"_$set_"+tg,tr)),tT&&tr?Object.defineProperty(tY,tg,{get:tT,set:tr,enumerable:!1,configurable:!0}):(tT&&Object.defineProperty(tY,tg,{get:tT,enumerable:!1,configurable:!0}),tr&&Object.defineProperty(tY,tg,{set:tr,enumerable:!1,configurable:!0}))},static:function(tg,tT){for(var tr=0,tD=tT.length;tr<tD;tr+=2)if("length"==tT[tr])tg.length=tT[tr+1].call(tg);else{function tY(){var tY=tT[tr],tD=tT[tr+1];Object.defineProperty(tg,tY,{get:function(){return delete this[tY],this[tY]=tD.call(this)},set:function(tD){delete this[tY],this[tY]=tD},enumerable:!0,configurable:!0})}tY()}},un:function(tD,tY,tg){return tg||(tg=tD[tY]),tI.__propun.value=tg,Object.defineProperty(tD,tY,tI.__propun),tg},uns:function(tY,tD){tD.forEach(function(tD){tI.un(tY,tD)})}};return tE.console=tE.console||{log:function(){}},tE.trace=tE.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),tI}(window,document);!function(tD,tY,tg){tg.un,tg.uns,tg.static,tg.class,tg.getset,tg.__newvec}(window,document,Laya),function(tN,tY,t_){t_.un,t_.uns;var ta=t_.static,tJ=t_.class,tI=t_.getset;t_.__newvec;t_.interface("laya.runtime.IMarket"),t_.interface("laya.filters.IFilter"),t_.interface("laya.display.ILayout"),t_.interface("laya.resource.IDispose"),t_.interface("laya.runtime.IPlatform"),t_.interface("laya.resource.IDestroy"),t_.interface("laya.runtime.IConchNode"),t_.interface("laya.filters.IFilterAction"),t_.interface("laya.runtime.ICPlatformClass"),t_.interface("laya.resource.ICreateResource"),t_.interface("laya.runtime.IConchRenderObject"),t_.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var tz=function(){function ts(){}return tJ(ts,"laya.utils.RunDriver"),ts.FILTER_ACTIONS=[],ts.pixelRatio=-1,ts._charSizeTestDiv=null,ts.now=function(){return Date.now()},ts.getWindow=function(){return tN},ts.getPixelRatio=function(){if(ts.pixelRatio<0){var tD=tU.context,tY=tD.backingStorePixelRatio||tD.webkitBackingStorePixelRatio||tD.mozBackingStorePixelRatio||tD.msBackingStorePixelRatio||tD.oBackingStorePixelRatio||tD.backingStorePixelRatio||1;(ts.pixelRatio=(tU.window.devicePixelRatio||1)/tY)<1&&(ts.pixelRatio=1)}return ts.pixelRatio},ts.getIncludeStr=function(tD){return null},ts.createShaderCondition=function(tD){var tY="(function() {return "+tD+";})";return t_._runScript(tY)},ts.fontMap=[],ts.measureText=function(tD,tY){var tg=ts.hanzi.test(tD);if(tg&&ts.fontMap[tY])return ts.fontMap[tY];var tT=tU.context;tT.font=tY;var tr=tT.measureText(tD);return tr||(tr={width:16,height:16}),tg&&(ts.fontMap[tY]=tr),tr},ts.getWebGLContext=function(tD){},ts.beginFlush=function(){},ts.endFinish=function(){},ts.addToAtlas=null,ts.flashFlushImage=function(tD){},ts.drawToCanvas=function(tD,tY,tg,tT,tr,ts){var ta=tZD.create("2D"),tW=new tB(tg,tT,ta);return tH.renders[tY]._fun(tD,tW,tr,ts),ta},ts.createParticleTemplate2D=null,ts.createGLTextur=null,ts.createWebGLContext2D=null,ts.changeWebGLSize=function(tD,tY){},ts.createRenderSprite=function(tD,tY){return new tH(tD,tY)},ts.createFilterAction=function(tD){return new tZ},ts.createGraphics=function(){return new tC},ts.clear=function(tD){tP._context.ctx.clear()},ts.cancelLoadByUrl=function(tD){},ts.clearAtlas=function(tD){},ts.isAtlas=function(tD){return!1},ts.addTextureToAtlas=function(tD){},ts.getTexturePixels=function(tD,tY,tg,tT,tr){return null},ts.skinAniSprite=function(){return null},ts.update3DLoop=function(){},ta(ts,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),ts}(),tT=(tI(1,t_,"alertGlobalError",null,function(tD){var ts=0;tU.window.onerror=tD?function(tD,tY,tg,tT,tr){ts++<5&&tr&&alert(tr.stack||tr)}:null}),t_.init=function(tD,tY,tg){for(var tT=[],tr=2,ts=arguments.length;tr<ts;tr++)tT.push(arguments[tr]);if(!t_._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=t_._arrayBufferSlice),t_._isinit=!0,tU.__init__(),tv.__init__(),tC.__init__(),t_.timer=new tR,t_.scaleTimer=new tR,t_.loader=new tMD,tu.__init__(),tr=0;for(var ta=tT.length;tr<ta;tr++)tT[tr].enable&&tT[tr].enable();return tE.__init__(),tW.__init__(),tS.__init__(),tV.beginCheck(),t_._currentStage=t_.stage=new txD,t_.stage.conchModel&&t_.stage.conchModel.setRootNode(),t_._getUrlPath(),t_.render=new tP(0,0),t_.stage.size(tD,tY),tH.__init__(),tO.__init__(),t$.instance.__init__(t_.stage,tP.canvas),tlD.__init__(),tX.autoStopMusic=!0,tb.__init__(),tP.canvas}},t_._getUrlPath=function(){var tD=tU.window.location,tY=tD.pathname;tY=tY&&":"==tY.charAt(2)?tY.substring(1):tY,ti.rootPath=ti.basePath=ti.getPath("file:"==tD.protocol?tY:tD.protocol+"//"+tD.host+tD.pathname)},t_._arrayBufferSlice=function(tD,tY){var tg=new Uint8Array(this,tD,tY-tD),tT=new Uint8Array(tg.length);return tT.set(tg),tT.buffer},t_._runScript=function(tD){return tU.window[t_._evcode](tD)},t_.stage=null,t_.timer=null,t_.scaleTimer=null,t_.loader=null,t_.version="1.8.6",t_.render=null,t_._currentStage=null,t_._isinit=!1,t_.isDebug=!1,t_.MiniAdpter={init:function(){tN.navigator&&tN.navigator.userAgent&&-1<tN.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},ta(t_,["conchMarket",function(){return this.conchMarket=tN.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=tN.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function tD(){}return tJ(tD,"Config"),tD.WebGLTextCacheCount=500,tD.atlasEnable=!1,tD.showCanvasMark=!1,tD.animationInterval=50,tD.isAntialias=!1,tD.isAlpha=!1,tD.premultipliedAlpha=!0,tD.isStencil=!0,tD.preserveDrawingBuffer=!1,tD}()),tM=function(){function tE(){this._events=null}tJ(tE,"laya.events.EventDispatcher");var tD=tE.prototype;return tD.hasListener=function(tD){return!!(this._events&&this._events[tD])},tD.getListener=function(tD){return this._events?this._events[tD]:null},tD.event=function(tD,tY){if(!this._events||!this._events[tD])return!1;var tg=this._events[tD];if(tg.lock)tg.queue||(tg.queue=[]),tg.queue.push(tY);else{var tT;for(tg.lock=!0,tg.cursor=tg.head;tg.cursor;)(tT=tg.cursor).recover?(tg.head=tg.tail=tg.cursor=null,console.error("node is recover："+tT.id)):(tg.cursor=tT.next,tT.once&&tE.delNode(tg,tT),tT.method&&(null!=tY?tT.args?tT.method.apply(tT.caller,tT.args.concat(tY)):tY instanceof Array?tT.method.apply(tT.caller,tY):tT.caller?tT.method.call(tT.caller,tY):t_.recordError("事件派发错误","node.caller:"+tT.caller+"node.method:"+tT.method+"data:"+tY+"node.prev"+tT.prev):tT.method.apply(tT.caller,tT.args)),tT.once&&tE.recoverHandler(tT));tg.lock=!1,!tg.head&&this._events&&this._events[tD]==tg&&delete this._events[tD],tg.queue&&tg.queue.length&&this.event(tD,tg.queue.shift())}return!0},tD.on=function(tD,tY,tg,tT){return this._createListener(tD,tY,tg,tT,!1)},tD.once=function(tD,tY,tg,tT){return this._createListener(tD,tY,tg,tT,!0)},tD._createListener=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=!0),ts&&this.off(tD,tY,tg,tr);var ta=tE.createHandler(tY||this,tg,tT,tr);this._events||(this._events={});var tW=this._events,tM=tW[tD];return tM?tM.tail?(ta.prev=tM.tail,tM.tail.next=ta,tM.tail=ta):tM.head=tM.tail=ta:tW[tD]={head:ta,tail:ta,cursor:null,lock:!1},this},tD.off=function(tD,tY,tg,tT){if(void 0===tT&&(tT=!1),!this._events||!this._events[tD])return this;for(var tr=this._events[tD],ts=tr.head;ts;){if((!tY||ts.caller===tY)&&ts.method===tg&&(!tT||ts.once)){tE.delNode(tr,ts),tr.cursor==ts&&(tr.cursor=ts.next),tE.recoverHandler(ts);break}ts=ts.next}return this},tD.offAll=function(tD){var tY=this._events;if(!tY)return this;if(tD)this._recoverHandlers(tY[tD]),delete tY[tD];else{for(var tg in tY)this._recoverHandlers(tY[tg]);this._events=null}return this},tD._recoverHandlers=function(tD){if(tD){for(var tY=tD.head;tY;){tE.delNode(tD,tY);var tg=tY.next;tE.recoverHandler(tY),tY=tg}tD.cursor=null}},tD.isMouseEvent=function(tD){return tE.MOUSE_EVENTS[tD]},tE.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},tE.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},tE.delNode=function(tD,tY){tY.prev?tY.prev.next=tY.next:tD.head=tY.next,tY.next?tY.next.prev=tY.prev:tD.tail=tY.prev},tE.createHandler=function(tD,tY,tg,tT){var tr=500<tE._freeHandler.length?tE._freeHandler.shift():null;if(tr)if(tr.recover)tr.recover=!1,tr.caller=tD,tr.method=tY,tr.args=tg,tr.once=tT;else{var ts="";try{arguments.propertyIsEnumerable.caller}catch(tD){ts=tD.stack}var ta=tr.caller?(tr.caller.__proto__&&tr.caller.__proto__.constructor&&tr.caller.__proto__.constructor.name)+"|"+tr.caller.__className+"|"+tr.caller.name:"",tW=tr.method?tr.method.name:"";t_.recordError("EventDispatcher重复创建","caller="+ta+"  method="+tW+"  stack="+ts),tr={id:++tE._nodeCount,caller:tD,method:tY,args:tg,once:tT,recover:!1}}else tr={id:++tE._nodeCount,caller:tD,method:tY,args:tg,once:tT,recover:!1};return tr.prev=tr.next=null,tr},tE.recoverHandler=function(tD){if(tD.recover){if(tE._errorCount<5){tE._errorCount++;var tY="";try{arguments.propertyIsEnumerable.caller}catch(tD){tY=tD.stack}var tg=tD.caller?(tD.caller.__proto__&&tD.caller.__proto__.constructor&&tD.caller.__proto__.constructor.name)+"|"+tD.caller.__className+"|"+tD.caller.name:"",tT=tD.method?tD.method.name:"";t_.recordError("EventDispatcher重复回收","id="+tD.id+"  caller="+tg+"  method="+tT+"  stack="+tY)}tD.caller=tD.method=tD.args=tD.prev=null}else tD.recover=!0,tD.caller=tD.method=tD.args=tD.prev=tD.next=null,tE._freeHandler&&tE._freeHandler.length<3e3&&tE._freeHandler.push(tD)},tE._freeHandler=[],tE._nodeCount=0,tE._errorCount=0,tE}(),tj=function(){function tr(tD,tY,tg,tT){this.once=!1,void(this._id=0)===tT&&(tT=!1),this.setTo(tD,tY,tg,tT)}tJ(tr,"laya.utils.Handler");var tD=tr.prototype;return tD.setTo=function(tD,tY,tg,tT){return this._id=tr._gid++,this.caller=tD,this.method=tY,this.args=tg,this.once=tT,this},tD.run=function(){if(null==this.method)return null;var tD=this._id,tY=this.method.apply(this.caller,this.args);return this._id===tD&&this.once&&this.recover(),tY},tD.runWith=function(tD){if(null==this.method)return null;var tY=this._id;if(null==tD)var tg=this.method.apply(this.caller,this.args);else tg=this.args||tD.unshift?this.args?this.method.apply(this.caller,this.args.concat(tD)):this.method.apply(this.caller,tD):this.method.call(this.caller,tD);return this._id===tY&&this.once&&this.recover(),tg},tD.clear=function(){return this.caller=null,this.method=null,this.args=null,this},tD.recover=function(){0<this._id&&(this._id=0,this.clear())},tr.create=function(tD,tY,tg,tT){return void 0===tT&&(tT=!0),new tr(tD,tY,tg,tT)},tr._gid=1,tr}(),tG=function(){function tD(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}tJ(tD,"laya.display.BitmapFont");var tY=tD.prototype;return tY.loadFont=function(tD,tY){this._path=tD,this._complete=tY,t_.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],tj.create(this,this.onLoaded))},tY.onLoaded=function(){this.parseFont(tWD.getRes(this._path),tWD.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},tY.parseFont=function(tD,tY){if(null!=tD&&null!=tY){this._texture=tY;var tg=tD.getElementsByTagName("info");if(!tg[0].getAttributeNode)return this.parseFont2(tD,tY);this.fontSize=parseInt(tg[0].getAttributeNode("size").nodeValue);var tT,tr=tg[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(tr[0]),parseInt(tr[1]),parseInt(tr[2]),parseInt(tr[3])],tT=tD.getElementsByTagName("char");var ts=0;for(ts=0;ts<tT.length;ts++){var ta=tT[ts],tW=parseInt(ta.getAttributeNode("id").nodeValue),tM=parseInt(ta.getAttributeNode("xoffset").nodeValue)/1,tE=parseInt(ta.getAttributeNode("yoffset").nodeValue)/1,tI=parseInt(ta.getAttributeNode("xadvance").nodeValue)/1,tO=new tq;tO.x=parseInt(ta.getAttributeNode("x").nodeValue),tO.y=parseInt(ta.getAttributeNode("y").nodeValue),tO.width=parseInt(ta.getAttributeNode("width").nodeValue),tO.height=parseInt(ta.getAttributeNode("height").nodeValue);var tC=tID.create(tY,tO.x,tO.y,tO.width,tO.height,tM,tE);this._maxWidth=Math.max(this._maxWidth,tI+this.letterSpacing),this._fontCharDic[tW]=tC,this._fontWidthMap[tW]=tI}}},tY.parseFont2=function(tD,tY){if(null!=tD&&null!=tY){this._texture=tY;var tg=tD.getElementsByTagName("info");this.fontSize=parseInt(tg[0].attributes.size.nodeValue);var tT=tg[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(tT[0]),parseInt(tT[1]),parseInt(tT[2]),parseInt(tT[3])];var tr=tD.getElementsByTagName("char"),ts=0;for(ts=0;ts<tr.length;ts++){var ta=tr[ts].attributes,tW=parseInt(ta.id.nodeValue),tM=parseInt(ta.xoffset.nodeValue)/1,tE=parseInt(ta.yoffset.nodeValue)/1,tI=parseInt(ta.xadvance.nodeValue)/1,tO=new tq;tO.x=parseInt(ta.x.nodeValue),tO.y=parseInt(ta.y.nodeValue),tO.width=parseInt(ta.width.nodeValue),tO.height=parseInt(ta.height.nodeValue);var tC=tID.create(tY,tO.x,tO.y,tO.width,tO.height,tM,tE);this._maxWidth=Math.max(this._maxWidth,tI+this.letterSpacing),this._fontCharDic[tW]=tC,this._fontWidthMap[tW]=tI}}},tY.getCharTexture=function(tD){return this._fontCharDic[tD.charCodeAt(0)]},tY.destroy=function(){if(this._texture){for(var tD in this._fontCharDic){var tY=this._fontCharDic[tD];tY&&tY.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},tY.setSpaceWidth=function(tD){this._spaceWidth=tD},tY.getCharWidth=function(tD){var tY=tD.charCodeAt(0);return this._fontWidthMap[tY]?this._fontWidthMap[tY]+this.letterSpacing:" "==tD?this._spaceWidth+this.letterSpacing:0},tY.getTextWidth=function(tD){for(var tY=0,tg=0,tT=tD.length;tg<tT;tg++)tY+=this.getCharWidth(tD.charAt(tg));return tY},tY.getMaxWidth=function(){return this._maxWidth},tY.getMaxHeight=function(){return this.fontSize},tY.drawText=function(tD,tY,tg,tT,tr,ts){var ta,tW=this.getTextWidth(tD),tM=0;"center"===tr&&(tM=(ts-tW)/2),"right"===tr&&(tM=ts-tW);for(var tE=0,tI=0,tO=tD.length;tI<tO;tI++)(ta=this.getCharTexture(tD.charAt(tI)))&&(tY.graphics.drawTexture(ta,tg+tE+tM,tT),tE+=this.getCharWidth(tD.charAt(tI)))},tD}(),tW=function(){function tg(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=tg._TF_EMPTY}tJ(tg,"laya.display.css.Style");var tD=tg.prototype;return tD.getTransform=function(){return this._tf},tD.setTransform=function(tD){this._tf="none"!==tD&&tD?tD:tg._TF_EMPTY},tD.setTranslateX=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.translateX=tD},tD.setTranslateY=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.translateY=tD},tD.setScaleX=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.scaleX=tD},tD.setScale=function(tD,tY){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.scaleX=tD,this._tf.scaleY=tY},tD.setScaleY=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.scaleY=tD},tD.setRotate=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.rotate=tD},tD.setSkewX=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.skewX=tD},tD.setSkewY=function(tD){this._tf===tg._TF_EMPTY&&(this._tf=new tr),this._tf.skewY=tD},tD.destroy=function(){this.scrollRect=null},tD.render=function(tD,tY,tg,tT){},tD.getCSSStyle=function(){return tYD.EMPTY},tD._enableLayout=function(){return!1},tI(0,tD,"scaleX",function(){return this._tf.scaleX},function(tD){this.setScaleX(tD)}),tI(0,tD,"transform",function(){return this.getTransform()},function(tD){this.setTransform(tD)}),tI(0,tD,"translateX",function(){return this._tf.translateX},function(tD){this.setTranslateX(tD)}),tI(0,tD,"translateY",function(){return this._tf.translateY},function(tD){this.setTranslateY(tD)}),tI(0,tD,"scaleY",function(){return this._tf.scaleY},function(tD){this.setScaleY(tD)}),tI(0,tD,"block",function(){return 0!=(1&this._type)}),tI(0,tD,"skewY",function(){return this._tf.skewY},function(tD){this.setSkewY(tD)}),tI(0,tD,"rotate",function(){return this._tf.rotate},function(tD){this.setRotate(tD)}),tI(0,tD,"skewX",function(){return this._tf.skewX},function(tD){this.setSkewX(tD)}),tI(0,tD,"paddingLeft",function(){return 0}),tI(0,tD,"paddingTop",function(){return 0}),tI(0,tD,"absolute",function(){return!0}),tg.__init__=function(){tg._TF_EMPTY=new tr,tg.EMPTY=new tg},tg.EMPTY=null,tg._TF_EMPTY=null,tg}(),tE=function(){function tY(tD){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=tf.create(tY.defaultColor),this.family=tY.defaultFamily,this.stroke=tY._STROKE,this.size=tY.defaultSize,tD&&tD!==tY.EMPTY&&tD.copyTo(this)}tJ(tY,"laya.display.css.Font");var tD=tY.prototype;return tD.set=function(tD){this._text=null;for(var tY=tD.split(" "),tg=0,tT=tY.length;tg<tT;tg++){var tr=tY[tg];switch(tr){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<tr.indexOf("px")&&(this.size=parseInt(tr),this.family=tY[tg+1],tg++)}},tD.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},tD.copyTo=function(tD){tD._type=this._type,tD._text=this._text,tD._weight=this._weight,tD._color=this._color,tD.family=this.family,tD.stroke=this.stroke!=tY._STROKE?this.stroke.slice():tY._STROKE,tD.indent=this.indent,tD.size=this.size},tI(0,tD,"password",function(){return 0!=(1024&this._type)},function(tD){tD?this._type|=1024:this._type&=-1025}),tI(0,tD,"color",function(){return this._color.strColor},function(tD){this._color=tf.create(tD)}),tI(0,tD,"italic",function(){return 0!=(512&this._type)},function(tD){tD?this._type|=512:this._type&=-513}),tI(0,tD,"bold",function(){return 0!=(2048&this._type)},function(tD){tD?this._type|=2048:this._type&=-2049}),tI(0,tD,"weight",function(){return""+this._weight},function(tD){var tY=0;switch(tD){case"normal":break;case"bold":this.bold=!0,tY=700;break;case"bolder":tY=800;break;case"lighter":tY=100;break;default:tY=parseInt(tD)}this._weight=tY,this._text=null}),tI(0,tD,"decoration",function(){return this._decoration?this._decoration.value:null},function(tD){var tY=tD.split(" ");switch(this._decoration||(this._decoration={}),tY[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=tY[0]}tY[1]&&(this._decoration.color=tf.create(tY)),this._decoration.value=tD}),tY.__init__=function(){tY.EMPTY=new tY(null)},tY.EMPTY=null,tY.defaultColor="#000000",tY.defaultSize=12,tY.defaultFamily="Arial",tY.defaultFont="12px Arial",tY._STROKE=[0,"#000000"],tY._ITALIC=512,tY._PASSWORD=1024,tY._BOLD=2048,tY}(),tr=function(){function tD(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return tJ(tD,"laya.display.css.TransformInfo"),tD}(),tC=function(){function tO(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,tP.isConchNode){this._nativeObj=new tN._conchGraphics,this.id=this._nativeObj.conchID}}tJ(tO,"laya.display.Graphics");var tD=tO.prototype;return tD.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},tD.clear=function(tD){void 0===tD&&(tD=!1);var tY=0,tg=0;if(tD){var tT=this._one;if(this._cmds){for(tg=this._cmds.length,tY=0;tY<tg;tY++)!(tT=this._cmds[tY])||tT.callee!==tP._context._drawTexture&&tT.callee!==tP._context._drawTextureWithTransform||(tT[0]=null,tO._cache.push(tT));this._cmds.length=0}else tT&&(!tT||tT.callee!==tP._context._drawTexture&&tT.callee!==tP._context._drawTextureWithTransform||(tT[0]=null,tO._cache.push(tT)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(tY=0,tg=this._vectorgraphArray.length;tY<tg;tY++)ty.getInstance().deleteShape(this._vectorgraphArray[tY]);this._vectorgraphArray.length=0}},tD._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},tD._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new tg,this._graphicBounds._graphics=this)},tD._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},tD._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},tD.getBounds=function(tD){return void 0===tD&&(tD=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(tD)},tD.getBoundPoints=function(tD){return void 0===tD&&(tD=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(tD)},tD._addCmd=function(tD){this._cmds=this._cmds||[],tD.callee=tD.shift(),this._cmds.push(tD)},tD.setFilters=function(tD){this._saveToCmd(tP._context._setFilters,tD)},tD.drawTexture=function(tD,tY,tg,tT,tr,ts,ta){if(void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ta&&(ta=1),!tD||ta<.01)return null;tT||(tT=tD.sourceWidth),tr||(tr=tD.sourceHeight),ta=ta<0?0:1<ta?1:ta;var tW,tM=!tP.isWebGL&&(tU.onFirefox||tU.onEdge||tU.onIE||tU.onSafari)?.5:0,tE=tT/tD.sourceWidth,tI=tr/tD.sourceHeight;return tT=tD.width*tE,tr=tD.height*tI,tD.loaded&&(tT<=0||tr<=0)?null:(tY+=tD.offsetX*tE,tg+=tD.offsetY*tI,this._sp&&(this._sp._renderType|=512),tY-=tM,tg-=tM,tT+=2*tM,tr+=2*tM,tO._cache.length?((tW=tO._cache.pop())[0]=tD,tW[1]=tY,tW[2]=tg,tW[3]=tT,tW[4]=tr,tW[5]=ts,tW[6]=ta):tW=[tD,tY,tg,tT,tr,ts,ta],tW.callee=ts||1!=ta?tP._context._drawTextureWithTransform:tP._context._drawTexture,null!=this._one||ts||1!=ta?this._saveToCmd(tW.callee,tW):(this._one=tW,this._render=this._renderOneImg),tD.loaded||tD.once("loaded",this,this._textureLoaded,[tD,tW]),this._repaint(),tW)},tD.cleanByTexture=function(tD,tY,tg,tT,tr){if(void 0===tT&&(tT=0),void 0===tr&&(tr=0),!tD)return this.clear();if(this._one&&this._render===this._renderOneImg){tT||(tT=tD.sourceWidth),tr||(tr=tD.sourceHeight);var ts=tT/tD.sourceWidth,ta=tr/tD.sourceHeight;tT=tD.width*ts,tr=tD.height*ta,tY+=tD.offsetX*ts,tg+=tD.offsetY*ta,this._one[0]=tD,this._one[1]=tY,this._one[2]=tg,this._one[3]=tT,this._one[4]=tr,this._repaint()}else this.clear(),tD&&this.drawTexture(tD,tY,tg,tT,tr)},tD.drawTextures=function(tD,tY){tD&&this._saveToCmd(tP._context._drawTextures,[tD,tY])},tD.fillTexture=function(tD,tY,tg,tT,tr,ts,ta){if(void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ts&&(ts="repeat"),tD){var tW=[tD,tY,tg,tT,tr,ts,ta||tA.EMPTY,{}];tD.loaded||tD.once("loaded",this,this._textureLoaded,[tD,tW]),this._saveToCmd(tP._context._fillTexture,tW)}},tD._textureLoaded=function(tD,tY){tY[3]=tY[3]||tD.width,tY[4]=tY[4]||tD.height,this._repaint()},tD.fillCircle=function(tD,tY,tg,tT,tr,ts,ta){tg.bitmap.enableMerageInAtlas=!1;var tW=new Float32Array(2*(ta+1)),tM=new Float32Array(2*(ta+1)),tE=new Uint16Array(3*ta),tI=2*Math.PI/ta,tO=0;tW[0]=tT,tW[1]=tr,tM[0]=tT/tg.width,tM[1]=tr/tg.height;for(var tC=2,tN=0;tN<ta;tN++){var t$=ts*Math.cos(tO)+tT,td=ts*Math.sin(tO)+tr;tW[tC]=t$,tW[tC+1]=td,tM[tC]=t$/tg.width,tM[tC+1]=td/tg.height,tO+=tI,tC+=2}for(tN=tC=0;tN<ta;tN++)tE[tC++]=0,tE[tC++]=tN+1,tE[tC++]=ta+1<=tN+2?1:tN+2;this.drawTriangles(tg,tD,tY,tW,tM,tE)},tD.drawTriangles=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){void 0===tW&&(tW=1),this._saveToCmd(tP._context.drawTriangles,[tD,tY,tg,tT,tr,ts,ta,tW,tM,tE])},tD._saveToCmd=function(tD,tY){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=tY,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(tY)),tY.callee=tD,this._repaint(),tY},tD.clipRect=function(tD,tY,tg,tT){this._saveToCmd(tP._context._clipRect,[tD,tY,tg,tT])},tD.fillText=function(tD,tY,tg,tT,tr,ts,ta){void 0===ta&&(ta=0),this._saveToCmd(tP._context._fillText,[tD,tY,tg,tT||tE.defaultFont,tr,ts])},tD.fillBorderText=function(tD,tY,tg,tT,tr,ts,ta,tW){this._saveToCmd(tP._context._fillBorderText,[tD,tY,tg,tT||tE.defaultFont,tr,ts,ta,tW])},tD.strokeText=function(tD,tY,tg,tT,tr,ts,ta){this._saveToCmd(tP._context._strokeText,[tD,tY,tg,tT||tE.defaultFont,tr,ts,ta])},tD.alpha=function(tD){tD=tD<0?0:1<tD?1:tD,this._saveToCmd(tP._context._alpha,[tD])},tD.setAlpha=function(tD){tD=tD<0?0:1<tD?1:tD,this._saveToCmd(tP._context._setAlpha,[tD])},tD.transform=function(tD,tY,tg){void 0===tY&&(tY=0),void 0===tg&&(tg=0),this._saveToCmd(tP._context._transform,[tD,tY,tg])},tD.rotate=function(tD,tY,tg){void 0===tY&&(tY=0),void 0===tg&&(tg=0),this._saveToCmd(tP._context._rotate,[tD,tY,tg])},tD.scale=function(tD,tY,tg,tT){void 0===tg&&(tg=0),void 0===tT&&(tT=0),this._saveToCmd(tP._context._scale,[tD,tY,tg,tT])},tD.translate=function(tD,tY){this._saveToCmd(tP._context._translate,[tD,tY])},tD.save=function(){this._saveToCmd(tP._context._save,[])},tD.restore=function(){this._saveToCmd(tP._context._restore,[])},tD.replaceText=function(tD){this._repaint();var tY=this._cmds;if(tY){for(var tg=tY.length-1;-1<tg;tg--)if(this._isTextCmd(tY[tg].callee))return tY[tg][0].toUpperCase?tY[tg][0]=tD:tY[tg][0].setText(tD),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=tD:this._one[0].setText(tD),!0;return!1},tD._isTextCmd=function(tD){return tD===tP._context._fillText||tD===tP._context._fillBorderText||tD===tP._context._strokeText},tD.replaceTextColor=function(tD){this._repaint();var tY=this._cmds;if(tY)for(var tg=tY.length-1;-1<tg;tg--)this._isTextCmd(tY[tg].callee)&&(tY[tg][4]=tD,tY[tg][0].toUpperCase||(tY[tg][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=tD,this._one[0].toUpperCase||(this._one[0].changed=!0))},tD.loadImage=function(tD,tY,tg,tT,tr,ts){var ta=this;void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0),void 0===tr&&(tr=0);var tW=tWD.getRes(tD);function tM(tD){tD&&(ta.drawTexture(tD,tY,tg,tT,tr),null!=ts&&ts.call(ta._sp,tD))}tW?tM(tW):t_.loader.load(tD,tj.create(null,tM),null,"image")},tD._renderEmpty=function(tD,tY,tg,tT){},tD._renderAll=function(tD,tY,tg,tT){for(var tr,ts=this._cmds,ta=0,tW=ts.length;ta<tW;ta++)(tr=ts[ta]).callee.call(tY,tg,tT,tr)},tD._renderOne=function(tD,tY,tg,tT){this._one.callee.call(tY,tg,tT,this._one)},tD._renderOneImg=function(tD,tY,tg,tT){this._one.callee.call(tY,tg,tT,this._one),2305!==tD._renderType&&(tD._renderType|=1)},tD.drawLine=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=1);var ta=0;tP.isWebGL&&(ta=ty.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(ta));var tW=ts%2==0?0:.5,tM=[tD+tW,tY+tW,tg+tW,tT+tW,tr,ts,ta];this._saveToCmd(tP._context._drawLine,tM)},tD.drawLines=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=1);var ts=0;if(tg&&!(tg.length<4)){tP.isWebGL&&(ts=ty.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(ts));var ta=tr%2==0?0:.5,tW=[tD+ta,tY+ta,tg,tT,tr,ts];this._saveToCmd(tP._context._drawLines,tW)}},tD.drawCurves=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=1);var ts=[tD,tY,tg,tT,tr];this._saveToCmd(tP._context._drawCurves,ts)},tD.drawRect=function(tD,tY,tg,tT,tr,ts,ta){void 0===ta&&(ta=1);var tW=ts?ta/2:0,tM=ts?ta:0,tE=[tD+tW,tY+tW,tg-tM,tT-tM,tr,ts,ta];this._saveToCmd(tP._context._drawRect,tE)},tD.drawCircle=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=1);var ta=tr?ts/2:0,tW=0;tP.isWebGL&&(tW=ty.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tW));var tM=[tD,tY,tg-ta,tT,tr,ts,tW];this._saveToCmd(tP._context._drawCircle,tM)},tD.drawPie=function(tD,tY,tg,tT,tr,ts,ta,tW){void 0===tW&&(tW=1);var tM=ta?tW/2:0,tE=ta?tW:0,tI=0;tP.isWebGL&&(tI=ty.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tI));var tO=[tD+tM,tY+tM,tg-tE,tT,tr,ts,ta,tW,tI];tO[3]=tL.toRadian(tT),tO[4]=tL.toRadian(tr),this._saveToCmd(tP._context._drawPie,tO)},tD.drawPoly=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=1);var ta=0,tW=!1;tP.isWebGL&&(ta=ty.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(ta),tW=!(6<tg.length));var tM=tr?ts%2==0?0:.5:0,tE=[tD+tM,tY+tM,tg,tT,tr,ts,ta,tW];this._saveToCmd(tP._context._drawPoly,tE)},tD.drawPath=function(tD,tY,tg,tT,tr){var ts=[tD,tY,tg,tT,tr];this._saveToCmd(tP._context._drawPath,ts)},tI(0,tD,"cmds",function(){return this._cmds},function(tD){this._sp&&(this._sp._renderType|=512),this._cmds=tD,this._render=this._renderAll,this._repaint()}),tO.__init__=function(){if(tP.isConchNode){for(var tD=laya.display.Graphics.prototype,tY=tU.window.ConchGraphics.prototype,tg=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],tT=0,tr=tg.length;tT<=tr;tT++){var ts=tg[tT];tD[ts]=tY[ts]}tD._saveToCmd=null,tY.drawImageS&&(tD.drawTextures=function(tD,tY){if(tD&&tD.loaded&&tD.bitmap&&tD.source){var tg=tD.uv,tT=tD.bitmap.width,tr=tD.bitmap.height;this.drawImageS(tD.bitmap.source,tg[0]*tT,tg[1]*tr,(tg[2]-tg[0])*tT,(tg[5]-tg[3])*tr,tD.offsetX,tD.offsetY,tD.width,tD.height,tY)}}),tD.drawTexture=function(tD,tY,tg,tT,tr,ts,ta){if(void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ta&&(ta=1),tD)if(tD.loaded){if(tD.loaded&&tD.bitmap&&tD.source&&(tT||(tT=tD.sourceWidth),tr||(tr=tD.sourceHeight),ta=ta<0?0:1<ta?1:ta,tT=tT-tD.sourceWidth+tD.width,tr=tr-tD.sourceHeight+tD.height,!(tT<=0||tr<=0))){tY+=tD.offsetX,tg+=tD.offsetY;var tW=tD.uv,tM=tD.bitmap.width,tE=tD.bitmap.height;tW[4]<tW[0]&&tW[5]<tW[1]?this.drawImageM(tD.bitmap.source,tW[4]*tM,tW[5]*tE,(tW[0]-tW[4])*tM,(tW[1]-tW[5])*tE,tY,tg,tT,tr,ts,ta):this.drawImageM(tD.bitmap.source,tW[0]*tM,tW[1]*tE,(tW[2]-tW[0])*tM,(tW[5]-tW[3])*tE,tY,tg,tT,tr,ts,ta),this._repaint()}}else tD.once("loaded",this,function(){this.drawTexture(tD,tY,tg,tT,tr,ts)})},tD.fillTexture=function(tD,tY,tg,tT,tr,ts,ta){if(void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ts&&(ts="repeat"),tD&&tD.loaded){var tW,tM=tP._context.ctx,tE=tD.bitmap.width,tI=tD.bitmap.height,tO=tD.uv;tW=tD.uv!=tID.DEF_UV?tM.createPattern(tD.bitmap.source,ts,tO[0]*tE,tO[1]*tI,(tO[2]-tO[0])*tE,(tO[5]-tO[3])*tI):tM.createPattern(tD.bitmap.source,ts);var tC=0,tN=0;ta&&(tY+=ta.x%tD.width,tg+=ta.y%tD.height,tC-=ta.x%tD.width,tN-=ta.y%tD.height),this._fillImage(tW,tY,tg,tC,tN,tT,tr)}}}},tO._cache=[],tO}(),tg=function(){function tZ(){this._cacheBoundsType=!1}tJ(tZ,"laya.display.GraphicsBounds");var tD=tZ.prototype;return tD.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},tD.reset=function(){this._temp&&(this._temp.length=0)},tD.getBounds=function(tD){return void 0===tD&&(tD=!1),(!this._bounds||!this._temp||this._temp.length<1||tD!=this._cacheBoundsType)&&(this._bounds=tq._getWrapRec(this.getBoundPoints(tD),this._bounds)),this._cacheBoundsType=tD,this._bounds},tD.getBoundPoints=function(tD){return void 0===tD&&(tD=!1),(!this._temp||this._temp.length<1||tD!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(tD)),this._cacheBoundsType=tD,this._rstBoundPoints=tL.copyArray(this._rstBoundPoints,this._temp)},tD._getCmdPoints=function(tD){void 0===tD&&(tD=!1);var tY,tg,tT=tP._context,tr=this._graphics.cmds;if((tY=this._temp||(this._temp=[])).length=0,tr||null==this._graphics._one||(tZ._tempCmds.length=0,tZ._tempCmds.push(this._graphics._one),tr=tZ._tempCmds),!tr)return tY;(tg=tZ._tempMatrixArrays).length=0;var ts=tZ._initMatrix;ts.identity();for(var ta,tW,tM=tZ._tempMatrix,tE=NaN,tI=NaN,tO=NaN,tC=NaN,tN=NaN,t$=NaN,td=0,tJ=tr.length;td<tJ;td++)if((ta=tr[td]).callee)switch(ta.callee){case tT._save:case 7:tg.push(ts),ts=ts.clone();break;case tT._restore:case 8:ts=tg.pop();break;case tT._scale:case 5:tM.identity(),tM.translate(-ta[2],-ta[3]),tM.scale(ta[0],ta[1]),tM.translate(ta[2],ta[3]),this._switchMatrix(ts,tM);break;case tT._rotate:case 3:tM.identity(),tM.translate(-ta[1],-ta[2]),tM.rotate(ta[0]),tM.translate(ta[1],ta[2]),this._switchMatrix(ts,tM);break;case tT._translate:case 6:tM.identity(),tM.translate(ta[0],ta[1]),this._switchMatrix(ts,tM);break;case tT._transform:case 4:tM.identity(),tM.translate(-ta[1],-ta[2]),tM.concat(ta[0]),tM.translate(ta[1],ta[2]),this._switchMatrix(ts,tM);break;case 16:case 24:tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[0],ta[1],ta[2],ta[3]),ts);break;case 17:ts.copyTo(tM),tM.concat(ta[4]),tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[0],ta[1],ta[2],ta[3]),tM);break;case tT._drawTexture:tW=ta[0],tD?ta[3]&&ta[4]?tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1],ta[2],ta[3],ta[4]),ts):(tW=ta[0],tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1],ta[2],tW.width,tW.height),ts)):(tE=(ta[3]||tW.sourceWidth)/tW.width,tI=(ta[4]||tW.sourceHeight)/tW.height,tO=tE*tW.sourceWidth,tC=tI*tW.sourceHeight,tN=0<tW.offsetX?tW.offsetX:0,t$=0<tW.offsetY?tW.offsetY:0,tN*=tE,t$*=tI,tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1]-tN,ta[2]-t$,tO,tC),ts));break;case tT._fillTexture:ta[3]&&ta[4]?tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1],ta[2],ta[3],ta[4]),ts):(tW=ta[0],tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1],ta[2],tW.width,tW.height),ts));break;case tT._drawTextureWithTransform:var tx;tx=ta[5]?(ts.copyTo(tM),tM.concat(ta[5]),tM):ts,tD?ta[3]&&ta[4]?tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1],ta[2],ta[3],ta[4]),tx):(tW=ta[0],tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1],ta[2],tW.width,tW.height),tx)):(tW=ta[0],tE=(ta[3]||tW.sourceWidth)/tW.width,tI=(ta[4]||tW.sourceHeight)/tW.height,tO=tE*tW.sourceWidth,tC=tI*tW.sourceHeight,tN=0<tW.offsetX?tW.offsetX:0,t$=0<tW.offsetY?tW.offsetY:0,tN*=tE,t$*=tI,tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[1]-tN,ta[2]-t$,tO,tC),tx));break;case tT._drawRect:case 13:tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[0],ta[1],ta[2],ta[3]),ts);break;case tT._drawCircle:case tT._fillCircle:case 14:tZ._addPointArrToRst(tY,tq._getBoundPointS(ta[0]-ta[2],ta[1]-ta[2],ta[2]+ta[2],ta[2]+ta[2]),ts);break;case tT._drawLine:case 20:tZ._tempPoints.length=0;var tj;tj=.5*ta[5],ta[0]==ta[2]?tZ._tempPoints.push(ta[0]+tj,ta[1],ta[2]+tj,ta[3],ta[0]-tj,ta[1],ta[2]-tj,ta[3]):ta[1]==ta[3]?tZ._tempPoints.push(ta[0],ta[1]+tj,ta[2],ta[3]+tj,ta[0],ta[1]-tj,ta[2],ta[3]-tj):tZ._tempPoints.push(ta[0],ta[1],ta[2],ta[3]),tZ._addPointArrToRst(tY,tZ._tempPoints,ts);break;case tT._drawCurves:case 22:tZ._addPointArrToRst(tY,tp.I.getBezierPoints(ta[2]),ts,ta[0],ta[1]);break;case tT._drawPoly:case tT._drawLines:case 18:tZ._addPointArrToRst(tY,ta[2],ts,ta[0],ta[1]);break;case tT._drawPath:case 19:tZ._addPointArrToRst(tY,this._getPathPoints(ta[2]),ts,ta[0],ta[1]);break;case tT._drawPie:case 15:tZ._addPointArrToRst(tY,this._getPiePoints(ta[0],ta[1],ta[2],ta[3],ta[4]),ts)}return 200<tY.length?tY=tL.copyArray(tY,tq._getWrapRec(tY)._getBoundPoints()):8<tY.length&&(tY=tl.scanPList(tY)),tY},tD._switchMatrix=function(tD,tY){tY.concat(tD),tY.copyTo(tD)},tD._getPiePoints=function(tD,tY,tg,tT,tr){var ts=tZ._tempPoints;tZ._tempPoints.length=0,ts.push(tD,tY);var ta=(tr-tT)%(2*Math.PI)/10,tW=NaN,tM=tT;for(tW=0;tW<=10;tW++)ts.push(tD+tg*Math.cos(tM),tY+tg*Math.sin(tM)),tM+=ta;return ts},tD._getPathPoints=function(tD){var tY,tg,tT=0,tr=tZ._tempPoints;for(tr.length=0,tY=tD.length,tT=0;tT<tY;tT++)1<(tg=tD[tT]).length&&(tr.push(tg[1],tg[2]),3<tg.length&&tr.push(tg[3],tg[4]));return tr},tZ._addPointArrToRst=function(tD,tY,tg,tT,tr){void 0===tT&&(tT=0),void 0===tr&&(tr=0);var ts,ta=0;for(ts=tY.length,ta=0;ta<ts;ta+=2)tZ._addPointToRst(tD,tY[ta]+tT,tY[ta+1]+tr,tg)},tZ._addPointToRst=function(tD,tY,tg,tT){var tr=tA.TEMP;tr.setTo(tY||0,tg||0),tT.transformPoint(tr),tD.push(tr.x,tr.y)},tZ._tempPoints=[],tZ._tempMatrixArrays=[],tZ._tempCmds=[],ta(tZ,["_tempMatrix",function(){return this._tempMatrix=new tm},"_initMatrix",function(){return this._initMatrix=new tm}]),tZ}(),ts=function(){function tD(){}tJ(tD,"laya.events.Event");var tY=tD.prototype;return tY.setTo=function(tD,tY,tg){return this.type=tD,this.currentTarget=tY,this.target=tg,this},tY.stopPropagation=function(){this._stoped=!0},tI(0,tY,"stageY",function(){return t_.stage.mouseY}),tI(0,tY,"charCode",function(){return this.nativeEvent.charCode}),tI(0,tY,"touches",function(){var tD=this.nativeEvent.touches;if(tD)for(var tY=t_.stage,tg=0,tT=tD.length;tg<tT;tg++){var tr=tD[tg],ts=tA.TEMP;ts.setTo(tr.clientX,tr.clientY),tY._canvasTransform.invertTransformPoint(ts),tY.transform.invertTransformPoint(ts),tr.stageX=ts.x,tr.stageY=ts.y}return tD}),tI(0,tY,"keyLocation",function(){return this.nativeEvent.keyLocation}),tI(0,tY,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),tI(0,tY,"altKey",function(){return this.nativeEvent.altKey}),tI(0,tY,"shiftKey",function(){return this.nativeEvent.shiftKey}),tI(0,tY,"stageX",function(){return t_.stage.mouseX}),tD.EMPTY=new tD,tD.MOUSE_DOWN="mousedown",tD.MOUSE_UP="mouseup",tD.CLICK="click",tD.RIGHT_MOUSE_DOWN="rightmousedown",tD.RIGHT_MOUSE_UP="rightmouseup",tD.RIGHT_CLICK="rightclick",tD.MOUSE_MOVE="mousemove",tD.MOUSE_OVER="mouseover",tD.MOUSE_OUT="mouseout",tD.MOUSE_WHEEL="mousewheel",tD.ROLL_OVER="mouseover",tD.ROLL_OUT="mouseout",tD.DOUBLE_CLICK="doubleclick",tD.CHANGE="change",tD.CHANGED="changed",tD.RESIZE="resize",tD.ADDED="added",tD.REMOVED="removed",tD.DISPLAY="display",tD.UNDISPLAY="undisplay",tD.ERROR="error",tD.COMPLETE="complete",tD.LOADED="loaded",tD.INITED="inited",tD.PROGRESS="progress",tD.INPUT="input",tD.RENDER="render",tD.OPEN="open",tD.MESSAGE="message",tD.CLOSE="close",tD.KEY_DOWN="keydown",tD.KEY_PRESS="keypress",tD.KEY_UP="keyup",tD.FRAME="enterframe",tD.DRAG_START="dragstart",tD.DRAG_MOVE="dragmove",tD.DRAG_END="dragend",tD.ENTER="enter",tD.SELECT="select",tD.BLUR="blur",tD.FOCUS="focus",tD.VISIBILITY_CHANGE="visibilitychange",tD.FOCUS_CHANGE="focuschange",tD.PLAYED="played",tD.PAUSED="paused",tD.STOPPED="stopped",tD.START="start",tD.END="end",tD.ENABLE_CHANGED="enablechanged",tD.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",tD.COMPONENT_ADDED="componentadded",tD.COMPONENT_REMOVED="componentremoved",tD.LAYER_CHANGED="layerchanged",tD.HIERARCHY_LOADED="hierarchyloaded",tD.RECOVERED="recovered",tD.RELEASED="released",tD.LINK="link",tD.LABEL="label",tD.FULL_SCREEN_CHANGE="fullscreenchange",tD.DEVICE_LOST="devicelost",tD.MESH_CHANGED="meshchanged",tD.MATERIAL_CHANGED="materialchanged",tD.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",tD.ANIMATION_CHANGED="animationchanged",tD.TRIGGER_ENTER="triggerenter",tD.TRIGGER_STAY="triggerstay",tD.TRIGGER_EXIT="triggerexit",tD.TRAIL_FILTER_CHANGE="trailfilterchange",tD.DOMINO_FILTER_CHANGE="dominofilterchange",tD}(),tO=(function(){function tD(){}tJ(tD,"laya.events.Keyboard"),tD.NUMBER_0=48,tD.NUMBER_1=49,tD.NUMBER_2=50,tD.NUMBER_3=51,tD.NUMBER_4=52,tD.NUMBER_5=53,tD.NUMBER_6=54,tD.NUMBER_7=55,tD.NUMBER_8=56,tD.NUMBER_9=57,tD.A=65,tD.B=66,tD.C=67,tD.D=68,tD.E=69,tD.F=70,tD.G=71,tD.H=72,tD.I=73,tD.J=74,tD.K=75,tD.L=76,tD.M=77,tD.N=78,tD.O=79,tD.P=80,tD.Q=81,tD.R=82,tD.S=83,tD.T=84,tD.U=85,tD.V=86,tD.W=87,tD.X=88,tD.Y=89,tD.Z=90,tD.F1=112,tD.F2=113,tD.F3=114,tD.F4=115,tD.F5=116,tD.F6=117,tD.F7=118,tD.F8=119,tD.F9=120,tD.F10=121,tD.F11=122,tD.F12=123,tD.F13=124,tD.F14=125,tD.F15=126,tD.NUMPAD=21,tD.NUMPAD_0=96,tD.NUMPAD_1=97,tD.NUMPAD_2=98,tD.NUMPAD_3=99,tD.NUMPAD_4=100,tD.NUMPAD_5=101,tD.NUMPAD_6=102,tD.NUMPAD_7=103,tD.NUMPAD_8=104,tD.NUMPAD_9=105,tD.NUMPAD_ADD=107,tD.NUMPAD_DECIMAL=110,tD.NUMPAD_DIVIDE=111,tD.NUMPAD_ENTER=108,tD.NUMPAD_MULTIPLY=106,tD.NUMPAD_SUBTRACT=109,tD.SEMICOLON=186,tD.EQUAL=187,tD.COMMA=188,tD.MINUS=189,tD.PERIOD=190,tD.SLASH=191,tD.BACKQUOTE=192,tD.LEFTBRACKET=219,tD.BACKSLASH=220,tD.RIGHTBRACKET=221,tD.QUOTE=222,tD.ALTERNATE=18,tD.BACKSPACE=8,tD.CAPS_LOCK=20,tD.COMMAND=15,tD.CONTROL=17,tD.DELETE=46,tD.ENTER=13,tD.ESCAPE=27,tD.PAGE_UP=33,tD.PAGE_DOWN=34,tD.END=35,tD.HOME=36,tD.LEFT=37,tD.UP=38,tD.RIGHT=39,tD.DOWN=40,tD.SHIFT=16,tD.SPACE=32,tD.TAB=9,tD.INSERT=45}(),function(){function tr(){}return tJ(tr,"laya.events.KeyBoardManager"),tr.__init__=function(){tr._addEvent("keydown"),tr._addEvent("keypress"),tr._addEvent("keyup")},tr._addEvent=function(tY){tU.document.addEventListener(tY,function(tD){laya.events.KeyBoardManager._dispatch(tD,tY)},!0)},tr._dispatch=function(tD,tY){if(tr.enabled){tr._event._stoped=!1,tr._event.nativeEvent=tD,tr._event.keyCode=tD.keyCode||tD.which||tD.charCode,"keydown"===tY?tr._pressKeys[tr._event.keyCode]=!0:"keyup"===tY&&(tr._pressKeys[tr._event.keyCode]=null);for(var tg=t_.stage.focus&&null!=t_.stage.focus.event&&t_.stage.focus.displayedInStage?t_.stage.focus:t_.stage,tT=tg;tT;)tT.event(tY,tr._event.setTo(tY,tT,tg)),tT=tT.parent}},tr.hasKeyDown=function(tD){return tr._pressKeys[tD]},tr._pressKeys={},tr.enabled=!0,ta(tr,["_event",function(){return this._event=new ts}]),tr}()),t$=(function(){function tD(){}tJ(tD,"laya.events.KeyLocation"),tD.STANDARD=0,tD.LEFT=1,tD.RIGHT=2,tD.NUM_PAD=3}(),function(){function tI(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=tU.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new ts,this._matrix=new tm,this._point=new tA,this._rect=new tq,this._prePoint=new tA,this._curTouchID=NaN}tJ(tI,"laya.events.MouseManager");var tD=tI.prototype;return tD.__init__=function(tD,tY){var tg=this;this._stage=tD;var tT=this,tr=this._eventList;tY.oncontextmenu=function(tD){if(tI.enabled)return!1},tY.addEventListener("mousedown",function(tD){tI.enabled&&(tU.onIE||tD.preventDefault(),tr.push(tD),tT.mouseDownTime=tU.now())}),tY.addEventListener("mouseup",function(tD){tI.enabled&&(tD.preventDefault(),tr.push(tD),tT.mouseDownTime=-tU.now())},!0),tY.addEventListener("mousemove",function(tD){if(tI.enabled){tD.preventDefault();var tY=tU.now();if(tY-tT._lastMoveTimer<10)return;tT._lastMoveTimer=tY,tr.push(tD)}},!0),tY.addEventListener("mouseout",function(tD){tI.enabled&&tr.push(tD)}),tY.addEventListener("mouseover",function(tD){tI.enabled&&tr.push(tD)}),tY.addEventListener("touchstart",function(tD){tI.enabled&&(tr.push(tD),tI._isFirstTouch||tlD.isInputting||tD.preventDefault(),tT.mouseDownTime=tU.now())}),tY.addEventListener("touchend",function(tD){tI.enabled?(tI._isFirstTouch||tlD.isInputting||tD.preventDefault(),tI._isFirstTouch=!1,tr.push(tD),tT.mouseDownTime=-tU.now()):tg._curTouchID=NaN},!0),tY.addEventListener("touchmove",function(tD){tI.enabled&&(tD.preventDefault(),tr.push(tD))},!0),tY.addEventListener("touchcancel",function(tD){tI.enabled?(tD.preventDefault(),tr.push(tD)):tg._curTouchID=NaN},!0),tY.addEventListener("mousewheel",function(tD){tI.enabled&&tr.push(tD)}),tY.addEventListener("DOMMouseScroll",function(tD){tI.enabled&&tr.push(tD)})},tD.initEvent=function(tD,tY){var tg;this._event._stoped=!1,this._event.nativeEvent=tY||tD,this._target=null,this._point.setTo(tD.pageX||tD.clientX,tD.pageY||tD.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=tD.identifier||0,this._tTouchID=this._event.touchId,(tg=td.I._event)._stoped=!1,tg.nativeEvent=this._event.nativeEvent,tg.touchId=this._event.touchId},tD.checkMouseWheel=function(tD){this._event.delta=tD.wheelDelta?.025*tD.wheelDelta:-tD.detail;for(var tY=td.I.getLastOvers(),tg=0,tT=tY.length;tg<tT;tg++){var tr=tY[tg];tr.event("mousewheel",this._event.setTo("mousewheel",tr,this._target))}},tD.onMouseMove=function(tD){td.I.onMouseMove(tD,this._tTouchID)},tD.onMouseDown=function(tD){if(tlD.isInputting&&t_.stage.focus&&t_.stage.focus.focus&&!t_.stage.focus.contains(this._target)){var tY=t_.stage.focus._tf||t_.stage.focus,tg=tD._tf||tD;tg instanceof laya.display.Input&&tg.multiline==tY.multiline?tY._focusOut():tY.focus=!1}td.I.onMouseDown(tD,this._tTouchID,this._isLeftMouse)},tD.onMouseUp=function(tD){td.I.onMouseUp(tD,this._tTouchID,this._isLeftMouse)},tD.check=function(tD,tY,tg,tT){this._point.setTo(tY,tg),tD.fromParentPoint(this._point),tY=this._point.x,tg=this._point.y;var tr=tD.scrollRect;if(tr&&(this._rect.setTo(tr.x,tr.y,tr.width,tr.height),!this._rect.contains(tY,tg)))return!1;if(!this.disableMouseEvent){if(tD.hitTestPrior&&!tD.mouseThrough&&!this.hitTest(tD,tY,tg))return!1;for(var ts=tD._childs.length-1;-1<ts;ts--){var ta=tD._childs[ts];if(!ta.destroyed&&ta.mouseEnabled&&ta.visible&&this.check(ta,tY,tg,tT))return!0}}var tW=!(!tD.hitTestPrior||tD.mouseThrough||this.disableMouseEvent)||this.hitTest(tD,tY,tg);return tW?(this._target=tD,tT.call(this,tD)):tT===this.onMouseUp&&tD===this._stage&&(this._target=this._stage,tT.call(this,this._target)),tW},tD.hitTest=function(tD,tY,tg){var tT=!1;if(tD.scrollRect&&(tY-=tD.scrollRect.x,tg-=tD.scrollRect.y),tD.hitArea instanceof laya.utils.HitArea)return tD.hitArea.isHit(tY,tg);if(0<tD.width&&0<tD.height||tD.mouseThrough||tD.hitArea)if(tD.mouseThrough)tT=tD.getGraphicBounds().contains(tY,tg);else{var tr=this._rect;tD.hitArea?tr=tD.hitArea:tr.setTo(0,0,tD.width,tD.height),tT=tr.contains(tY,tg)}return tT},tD.runEvent=function(){var tD=this._eventList.length;if(tD){var tY=this;tY.mouseEventTime=tU.now();var tg,tT=0,tr=0,ts=0;try{for(;tT<tD;){var ta=this._eventList[tT];switch("mousemove"!==ta.type&&(this._prePoint.x=this._prePoint.y=-1e6),ta.type){case"mousedown":this._touchIDs[0]=this._id++,tI._isTouchRespond?tI._isTouchRespond=!1:(tY._isLeftMouse=0===ta.button,tY.initEvent(ta),tY.check(tY._stage,tY.mouseX,tY.mouseY,tY.onMouseDown));break;case"mouseup":tY._isLeftMouse=0===ta.button,tY.initEvent(ta),tY.check(tY._stage,tY.mouseX,tY.mouseY,tY.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-ta.clientX)+Math.abs(this._prePoint.y-ta.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=ta.clientX,this._prePoint.y=ta.clientY,tY.initEvent(ta),tY.check(tY._stage,tY.mouseX,tY.mouseY,tY.onMouseMove));break;case"touchstart":tI._isTouchRespond=!0,tY._isLeftMouse=!0;var tW=ta.changedTouches;for(tr=0,ts=tW.length;tr<ts;tr++)tg=tW[tr],(tI.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=tg.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[tg.identifier]=this._id++,tY.initEvent(tg,ta),tY.check(tY._stage,tY.mouseX,tY.mouseY,tY.onMouseDown));break;case"touchend":case"touchcancel":tI._isTouchRespond=!0,tY._isLeftMouse=!0;var tM=ta.changedTouches;for(tr=0,ts=tM.length;tr<ts;tr++)if(tg=tM[tr],tI.multiTouchEnabled||tg.identifier==this._curTouchID){this._curTouchID=NaN,tY.initEvent(tg,ta);tY.check(tY._stage,tY.mouseX,tY.mouseY,tY.onMouseUp)||tY.onMouseUp(null)}break;case"touchmove":var tE=ta.changedTouches;for(tr=0,ts=tE.length;tr<ts;tr++)tg=tE[tr],(tI.multiTouchEnabled||tg.identifier==this._curTouchID)&&(tY.initEvent(tg,ta),tY.check(tY._stage,tY.mouseX,tY.mouseY,tY.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":tY.checkMouseWheel(ta);break;case"mouseout":td.I.stageMouseOut();break;case"mouseover":tY._stage.event("mouseover",tY._event.setTo("mouseover",tY._stage,tY._stage))}tT++}}catch(tD){throw this._eventList.length=0,tD}this._eventList.length=0}},tI.enabled=!0,tI.multiTouchEnabled=!0,tI._isTouchRespond=!1,tI._isFirstTouch=!0,ta(tI,["instance",function(){return this.instance=new tI}]),tI}()),td=function(){function t$(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new ts}tJ(t$,"laya.events.TouchManager");var tD=t$.prototype;return tD._clearTempArrs=function(){t$._oldArr.length=0,t$._newArr.length=0,t$._tEleArr.length=0},tD.getTouchFromArr=function(tD,tY){var tg,tT,tr=0;for(tg=tY.length,tr=0;tr<tg;tr++)if((tT=tY[tr]).id==tD)return tT;return null},tD.removeTouchFromArr=function(tD,tY){var tg=0;for(tg=tY.length-1;0<=tg;tg--)tY[tg].id==tD&&tY.splice(tg,1)},tD.createTouchO=function(tD,tY){var tg;return(tg=tK.getItem("TouchData")||{}).id=tY,tg.tar=tD,tg},tD.onMouseDown=function(tD,tY,tg){var tT,tr,ts,ta;(void 0===tg&&(tg=!1),this.enable)&&(tT=this.getTouchFromArr(tY,this.preOvers),ts=this.getEles(tD,null,t$._tEleArr),tT?tT.tar=tD:(tr=this.createTouchO(tD,tY),this.preOvers.push(tr)),tU.onMobile&&this.sendEvents(ts,"mouseover",tY),ta=tg?this.preDowns:this.preRightDowns,(tT=this.getTouchFromArr(tY,ta))?tT.tar=tD:(tr=this.createTouchO(tD,tY),ta.push(tr)),this.sendEvents(ts,tg?"mousedown":"rightmousedown",tY),this._clearTempArrs())},tD.sendEvents=function(tD,tY,tg){void 0===tg&&(tg=0);var tT,tr,ts,ta=0;for(tT=tD.length,this._event._stoped=!1,tr=tD[0],ta=0;ta<tT;ta++){if((ts=tD[ta]).destroyed)return;if(ts.event(tY,this._event.setTo(tY,ts,tr)),this._event._stoped)break}},tD.getEles=function(tD,tY,tg){for(tg?tg.length=0:tg=[];tD&&tD!=tY;)tg.push(tD),tD=tD.parent;return tg},tD.checkMouseOutAndOverOfMove=function(tD,tY,tg){if(void 0===tg&&(tg=0),tY!=tD){var tT,tr,ts=0,ta=0;if(tY.contains(tD))tr=this.getEles(tD,tY,t$._tEleArr),this.sendEvents(tr,"mouseover",tg);else if(tD.contains(tY))tr=this.getEles(tY,tD,t$._tEleArr),this.sendEvents(tr,"mouseout",tg);else{var tW,tM;(tr=t$._tEleArr).length=0,tW=this.getEles(tY,null,t$._oldArr),tM=this.getEles(tD,null,t$._newArr),ta=tW.length;var tE=0;for(ts=0;ts<ta;ts++){if(tT=tW[ts],0<=(tE=tM.indexOf(tT))){tM.splice(tE,tM.length-tE);break}tr.push(tT)}0<tr.length&&this.sendEvents(tr,"mouseout",tg),0<tM.length&&this.sendEvents(tM,"mouseover",tg)}}},tD.onMouseMove=function(tD,tY){var tg,tT;this.enable&&((tg=this.getTouchFromArr(tY,this.preOvers))?(this.checkMouseOutAndOverOfMove(tD,tg.tar),tg.tar=tD,tT=this.getEles(tD,null,t$._tEleArr)):(tT=this.getEles(tD,null,t$._tEleArr),this.sendEvents(tT,"mouseover",tY),this.preOvers.push(this.createTouchO(tD,tY))),this.sendEvents(tT,"mousemove",tY),this._clearTempArrs())},tD.getLastOvers=function(){return(t$._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,t$._tEleArr):(t$._tEleArr.push(t_.stage),t$._tEleArr)},tD.stageMouseOut=function(){var tD;tD=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(tD,"mouseout",0)},tD.onMouseUp=function(tD,tY,tg){if(void 0===tg&&(tg=!1),this.enable){var tT,tr,ts,ta,tW,tM,tE=0,tI=0,tO=tU.onMobile;if(tr=this.getEles(tD,null,t$._tEleArr),this.sendEvents(tr,tg?"mouseup":"rightmouseup",tY),tM=tg?this.preDowns:this.preRightDowns,tT=this.getTouchFromArr(tY,tM)){var tC,tN=tU.now();if(tC=tN-this._lastClickTime<300,this._lastClickTime=tN,tD==tT.tar)tW=tr;else for(ts=this.getEles(tT.tar,null,t$._oldArr),(tW=t$._newArr).length=0,tI=ts.length,tE=0;tE<tI;tE++)ta=ts[tE],0<=tr.indexOf(ta)&&tW.push(ta);0<tW.length&&this.sendEvents(tW,tg?"click":"rightclick",tY),tg&&tC&&this.sendEvents(tW,"doubleclick",tY),this.removeTouchFromArr(tY,tM),tT.tar=null,tK.recover("TouchData",tT)}else;(tT=this.getTouchFromArr(tY,this.preOvers))&&tO&&((tW=this.getEles(tT.tar,null,tW))&&0<tW.length&&this.sendEvents(tW,"mouseout",tY),this.removeTouchFromArr(tY,this.preOvers),tT.tar=null,tK.recover("TouchData",tT)),this._clearTempArrs()}},t$._oldArr=[],t$._newArr=[],t$._tEleArr=[],ta(t$,["I",function(){return this.I=new t$}]),t$}(),tx=function(){function tD(){this._action=null}tJ(tD,"laya.filters.Filter");var tY=tD.prototype;return t_.imps(tY,{"laya.filters.IFilter":!0}),tY.callNative=function(tD){},tI(0,tY,"type",function(){return-1}),tI(0,tY,"action",function(){return this._action}),tD.BLUR=16,tD.COLOR=32,tD.GLOW=8,tD._filterStart=null,tD._filterEnd=null,tD._EndTarget=null,tD._recycleScope=null,tD._filter=null,tD._useSrc=null,tD._endSrc=null,tD._useOut=null,tD._endOut=null,tD}(),tZ=function(){function tD(){this.data=null}tJ(tD,"laya.filters.ColorFilterAction");var tY=tD.prototype;return t_.imps(tY,{"laya.filters.IFilterAction":!0}),tY.apply=function(tD){var tY=tD.ctx.ctx,tg=tD.ctx.ctx.canvas;if(0==tg.width||0==tg.height)return tg;for(var tT,tr=tY.getImageData(0,0,tg.width,tg.height),ts=tr.data,ta=0,tW=ts.length;ta<tW;ta+=4)tT=this.getColor(ts[ta],ts[ta+1],ts[ta+2],ts[ta+3]),0!=ts[ta+3]&&(ts[ta]=tT[0],ts[ta+1]=tT[1],ts[ta+2]=tT[2],ts[ta+3]=tT[3]);return tY.putImageData(tr,0,0),tD},tY.getColor=function(tD,tY,tg,tT){var tr=[];if(this.data._mat&&this.data._alpha){var ts=this.data._mat,ta=this.data._alpha;tr[0]=ts[0]*tD+ts[1]*tY+ts[2]*tg+ts[3]*tT+ta[0],tr[1]=ts[4]*tD+ts[5]*tY+ts[6]*tg+ts[7]*tT+ta[1],tr[2]=ts[8]*tD+ts[9]*tY+ts[10]*tg+ts[11]*tT+ta[2],tr[3]=ts[12]*tD+ts[13]*tY+ts[14]*tg+ts[15]*tT+ta[3]}return tr},tD}(),tp=(function(){function tD(){}tJ(tD,"laya.maths.Arith"),tD.formatR=function(tD){return tD>Math.PI&&(tD-=2*Math.PI),tD<-Math.PI&&(tD+=2*Math.PI),tD},tD.isPOT=function(tD,tY){return 0<tD&&0==(tD&tD-1)&&0<tY&&0==(tY&tY-1)},tD.setMatToArray=function(tD,tY){tD.a,tD.b,tD.c,tD.d,tD.tx,tD.ty,tY[0]=tD.a,tY[1]=tD.b,tY[4]=tD.c,tY[5]=tD.d,tY[12]=tD.tx,tY[13]=tD.ty}}(),function(){function tD(){this._controlPoints=[new tA,new tA,new tA],this._calFun=this.getPoint2}tJ(tD,"laya.maths.Bezier");var tY=tD.prototype;return tY._switchPoint=function(tD,tY){var tg=this._controlPoints.shift();tg.setTo(tD,tY),this._controlPoints.push(tg)},tY.getPoint2=function(tD,tY){var tg=this._controlPoints[0],tT=this._controlPoints[1],tr=this._controlPoints[2],ts=Math.pow(1-tD,2)*tg.x+2*tD*(1-tD)*tT.x+Math.pow(tD,2)*tr.x,ta=Math.pow(1-tD,2)*tg.y+2*tD*(1-tD)*tT.y+Math.pow(tD,2)*tr.y;tY.push(ts,ta)},tY.getPoint3=function(tD,tY){var tg=this._controlPoints[0],tT=this._controlPoints[1],tr=this._controlPoints[2],ts=this._controlPoints[3],ta=Math.pow(1-tD,3)*tg.x+3*tT.x*tD*(1-tD)*(1-tD)+3*tr.x*tD*tD*(1-tD)+ts.x*Math.pow(tD,3),tW=Math.pow(1-tD,3)*tg.y+3*tT.y*tD*(1-tD)*(1-tD)+3*tr.y*tD*tD*(1-tD)+ts.y*Math.pow(tD,3);tY.push(ta,tW)},tY.insertPoints=function(tD,tY){var tg,tT=NaN;for(tg=1/(tD=0<tD?tD:5),tT=0;tT<=1;tT+=tg)this._calFun(tT,tY)},tY.getBezierPoints=function(tD,tY,tg){void 0===tY&&(tY=5),void 0===tg&&(tg=2);var tT,tr,ts=0;if((tT=tD.length)<2*(tg+1))return[];switch(tr=[],tg){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=tg;)this._controlPoints.push(new tA);for(ts=0;ts<2*tg;ts+=2)this._switchPoint(tD[ts],tD[ts+1]);for(ts=2*tg;ts<tT;ts+=2)this._switchPoint(tD[ts],tD[ts+1]),ts/2%tg==0&&this.insertPoints(tY,tr);return tr},ta(tD,["I",function(){return this.I=new tD}]),tD}()),tl=function(){function tE(){}return tJ(tE,"laya.maths.GrahamScan"),tE.multiply=function(tD,tY,tg){return(tD.x-tg.x)*(tY.y-tg.y)-(tY.x-tg.x)*(tD.y-tg.y)},tE.dis=function(tD,tY){return(tD.x-tY.x)*(tD.x-tY.x)+(tD.y-tY.y)*(tD.y-tY.y)},tE._getPoints=function(tD,tY,tg){for(void 0===tY&&(tY=!1),tE._mPointList||(tE._mPointList=[]);tE._mPointList.length<tD;)tE._mPointList.push(new tA);return tg||(tg=[]),tg.length=0,tY?tE.getFrom(tg,tE._mPointList,tD):tE.getFromR(tg,tE._mPointList,tD),tg},tE.getFrom=function(tD,tY,tg){var tT=0;for(tT=0;tT<tg;tT++)tD.push(tY[tT]);return tD},tE.getFromR=function(tD,tY,tg){var tT=0;for(tT=0;tT<tg;tT++)tD.push(tY.pop());return tD},tE.pListToPointList=function(tD,tY){void 0===tY&&(tY=!1);var tg=0,tT=tD.length/2,tr=tE._getPoints(tT,tY,tE._tempPointList);for(tg=0;tg<tT;tg++)tr[tg].setTo(tD[tg+tg],tD[tg+tg+1]);return tr},tE.pointListToPlist=function(tD){var tY,tg=0,tT=tD.length,tr=tE._temPList;for(tg=tr.length=0;tg<tT;tg++)tY=tD[tg],tr.push(tY.x,tY.y);return tr},tE.scanPList=function(tD){return tL.copyArray(tD,tE.pointListToPlist(tE.scan(tE.pListToPointList(tD,!0))))},tE.scan=function(tD){var tY,tg,tT,tr=0,ts=0,ta=0,tW=tD.length,tM={};for((tg=tE._temArr).length=0,tr=(tW=tD.length)-1;0<=tr;tr--)tT=(tY=tD[tr]).x+"_"+tY.y,tM.hasOwnProperty(tT)||(tM[tT]=!0,tg.push(tY));for(tW=tg.length,tL.copyArray(tD,tg),tr=1;tr<tW;tr++)(tD[tr].y<tD[ta].y||tD[tr].y==tD[ta].y&&tD[tr].x<tD[ta].x)&&(ta=tr);for(tY=tD[0],tD[0]=tD[ta],tD[ta]=tY,tr=1;tr<tW-1;tr++){for(ts=(ta=tr)+1;ts<tW;ts++)(0<tE.multiply(tD[ts],tD[ta],tD[0])||0==tE.multiply(tD[ts],tD[ta],tD[0])&&tE.dis(tD[0],tD[ts])<tE.dis(tD[0],tD[ta]))&&(ta=ts);tY=tD[tr],tD[tr]=tD[ta],tD[ta]=tY}if((tg=tE._temArr).length=0,tD.length<3)return tL.copyArray(tg,tD);for(tg.push(tD[0],tD[1],tD[2]),tr=3;tr<tW;tr++){for(;2<=tg.length&&0<=tE.multiply(tD[tr],tg[tg.length-1],tg[tg.length-2]);)tg.pop();tD[tr]&&tg.push(tD[tr])}return tg},tE._mPointList=null,tE._tempPointList=[],tE._temPList=[],tE._temArr=[],tE}(),tt=function(){function tr(){}return tJ(tr,"laya.maths.MathUtil"),tr.subtractVector3=function(tD,tY,tg){tg[0]=tD[0]-tY[0],tg[1]=tD[1]-tY[1],tg[2]=tD[2]-tY[2]},tr.lerp=function(tD,tY,tg){return tD*(1-tg)+tY*tg},tr.scaleVector3=function(tD,tY,tg){tg[0]=tD[0]*tY,tg[1]=tD[1]*tY,tg[2]=tD[2]*tY},tr.lerpVector3=function(tD,tY,tg,tT){var tr=tD[0],ts=tD[1],ta=tD[2];tT[0]=tr+tg*(tY[0]-tr),tT[1]=ts+tg*(tY[1]-ts),tT[2]=ta+tg*(tY[2]-ta)},tr.lerpVector4=function(tD,tY,tg,tT){var tr=tD[0],ts=tD[1],ta=tD[2],tW=tD[3];tT[0]=tr+tg*(tY[0]-tr),tT[1]=ts+tg*(tY[1]-ts),tT[2]=ta+tg*(tY[2]-ta),tT[3]=tW+tg*(tY[3]-tW)},tr.slerpQuaternionArray=function(tD,tY,tg,tT,tr,ts,ta){var tW,tM,tE,tI,tO,tC=tD[tY+0],tN=tD[tY+1],t$=tD[tY+2],td=tD[tY+3],tJ=tg[tT+0],tx=tg[tT+1],tj=tg[tT+2],tZ=tg[tT+3];return(tM=tC*tJ+tN*tx+t$*tj+td*tZ)<0&&(tM=-tM,tJ=-tJ,tx=-tx,tj=-tj,tZ=-tZ),tO=1e-6<1-tM?(tW=Math.acos(tM),tE=Math.sin(tW),tI=Math.sin((1-tr)*tW)/tE,Math.sin(tr*tW)/tE):(tI=1-tr,tr),ts[ta+0]=tI*tC+tO*tJ,ts[ta+1]=tI*tN+tO*tx,ts[ta+2]=tI*t$+tO*tj,ts[ta+3]=tI*td+tO*tZ,ts},tr.getRotation=function(tD,tY,tg,tT){return Math.atan2(tT-tY,tg-tD)/Math.PI*180},tr.sortBigFirst=function(tD,tY){return tD==tY?0:tD<tY?1:-1},tr.sortSmallFirst=function(tD,tY){return tD==tY?0:tD<tY?-1:1},tr.sortNumBigFirst=function(tD,tY){return parseFloat(tY)-parseFloat(tD)},tr.sortNumSmallFirst=function(tD,tY){return parseFloat(tD)-parseFloat(tY)},tr.sortByKey=function(tg,tD,tY){var tT;return void 0===tD&&(tD=!1),void 0===tY&&(tY=!0),tT=tD?tY?tr.sortNumBigFirst:tr.sortBigFirst:tY?tr.sortNumSmallFirst:tr.sortSmallFirst,function(tD,tY){return tT(tD[tg],tY[tg])}},tr}(),tm=function(){function tg(tD,tY,tg,tT,tr,ts){this.inPool=!1,this.bTransform=!1,void 0===tD&&(tD=1),void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=1),void 0===tr&&(tr=0),void 0===ts&&(ts=0),this.a=tD,this.b=tY,this.c=tg,this.d=tT,this.tx=tr,this.ty=ts,this._checkTransform()}tJ(tg,"laya.maths.Matrix");var tD=tg.prototype;return tD.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},tD._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},tD.setTranslate=function(tD,tY){return this.tx=tD,this.ty=tY,this},tD.translate=function(tD,tY){return this.tx+=tD,this.ty+=tY,this},tD.scale=function(tD,tY){this.a*=tD,this.d*=tY,this.c*=tD,this.b*=tY,this.tx*=tD,this.ty*=tY,this.bTransform=!0},tD.rotate=function(tD){var tY=Math.cos(tD),tg=Math.sin(tD),tT=this.a,tr=this.c,ts=this.tx;this.a=tT*tY-this.b*tg,this.b=tT*tg+this.b*tY,this.c=tr*tY-this.d*tg,this.d=tr*tg+this.d*tY,this.tx=ts*tY-this.ty*tg,this.ty=ts*tg+this.ty*tY,this.bTransform=!0},tD.skew=function(tD,tY){var tg=Math.tan(tD),tT=Math.tan(tY),tr=this.a,ts=this.b;return this.a+=tT*this.c,this.b+=tT*this.d,this.c+=tg*tr,this.d+=tg*ts,this},tD.invertTransformPoint=function(tD){var tY=this.a,tg=this.b,tT=this.c,tr=this.d,ts=this.tx,ta=tY*tr-tg*tT,tW=tr/ta,tM=-tg/ta,tE=-tT/ta,tI=tY/ta,tO=(tT*this.ty-tr*ts)/ta,tC=-(tY*this.ty-tg*ts)/ta;return tD.setTo(tW*tD.x+tE*tD.y+tO,tM*tD.x+tI*tD.y+tC)},tD.transformPoint=function(tD){return tD.setTo(this.a*tD.x+this.c*tD.y+this.tx,this.b*tD.x+this.d*tD.y+this.ty)},tD.transformPointN=function(tD){return tD.setTo(this.a*tD.x+this.c*tD.y,this.b*tD.x+this.d*tD.y)},tD.transformPointArray=function(tD,tY){for(var tg=tD.length,tT=0;tT<tg;tT+=2){var tr=tD[tT],ts=tD[tT+1];tY[tT]=this.a*tr+this.c*ts+this.tx,tY[tT+1]=this.b*tr+this.d*ts+this.ty}return tY},tD.transformPointArrayScale=function(tD,tY){for(var tg=tD.length,tT=0;tT<tg;tT+=2){var tr=tD[tT],ts=tD[tT+1];tY[tT]=this.a*tr+this.c*ts,tY[tT+1]=this.b*tr+this.d*ts}return tY},tD.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},tD.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},tD.invert=function(){var tD=this.a,tY=this.b,tg=this.c,tT=this.d,tr=this.tx,ts=tD*tT-tY*tg;return this.a=tT/ts,this.b=-tY/ts,this.c=-tg/ts,this.d=tD/ts,this.tx=(tg*this.ty-tT*tr)/ts,this.ty=-(tD*this.ty-tY*tr)/ts,this},tD.setTo=function(tD,tY,tg,tT,tr,ts){return this.a=tD,this.b=tY,this.c=tg,this.d=tT,this.tx=tr,this.ty=ts,this},tD.concat=function(tD){var tY=this.a,tg=this.c,tT=this.tx;return this.a=tY*tD.a+this.b*tD.c,this.b=tY*tD.b+this.b*tD.d,this.c=tg*tD.a+this.d*tD.c,this.d=tg*tD.b+this.d*tD.d,this.tx=tT*tD.a+this.ty*tD.c+tD.tx,this.ty=tT*tD.b+this.ty*tD.d+tD.ty,this},tD.scaleEx=function(tD,tY){var tg=this.a,tT=this.b,tr=this.c,ts=this.d;0!==tT||0!==tr?(this.a=tD*tg,this.b=tD*tT,this.c=tY*tr):(this.a=tD*tg,this.b=0*ts,this.c=0*tg),this.d=tY*ts,this.bTransform=!0},tD.rotateEx=function(tD){var tY=Math.cos(tD),tg=Math.sin(tD),tT=this.a,tr=this.b,ts=this.c,ta=this.d;0!==tr||0!==ts?(this.a=tY*tT+tg*ts,this.b=tY*tr+tg*ta,this.c=-tg*tT+tY*ts,this.d=-tg*tr+tY*ta):(this.a=tY*tT,this.b=tg*ta,this.c=-tg*tT,this.d=tY*ta),this.bTransform=!0},tD.clone=function(){var tD=tg.create();return tD.a=this.a,tD.b=this.b,tD.c=this.c,tD.d=this.d,tD.tx=this.tx,tD.ty=this.ty,tD.bTransform=this.bTransform,tD},tD.copyTo=function(tD){return tD.a=this.a,tD.b=this.b,tD.c=this.c,tD.d=this.d,tD.tx=this.tx,tD.ty=this.ty,tD.bTransform=this.bTransform,tD},tD.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},tD.destroy=function(){if(!this.inPool){var tD=tg._cache;this.inPool=!0,tD._length||(tD._length=0),(tD[tD._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},tg.mul=function(tD,tY,tg){var tT=tD.a,tr=tD.b,ts=tD.c,ta=tD.d,tW=tD.tx,tM=tD.ty,tE=tY.a,tI=tY.b,tO=tY.c,tC=tY.d,tN=tY.tx,t$=tY.ty;return 0!==tI||0!==tO?(tg.a=tT*tE+tr*tO,tg.b=tT*tI+tr*tC,tg.c=ts*tE+ta*tO,tg.d=ts*tI+ta*tC,tg.tx=tE*tW+tO*tM+tN,tg.ty=tI*tW+tC*tM+t$):(tg.a=tT*tE,tg.b=tr*tC,tg.c=ts*tE,tg.d=ta*tC,tg.tx=tE*tW+tN,tg.ty=tC*tM+t$),tg},tg.mul16=function(tD,tY,tg){var tT=tD.a,tr=tD.b,ts=tD.c,ta=tD.d,tW=tD.tx,tM=tD.ty,tE=tY.a,tI=tY.b,tO=tY.c,tC=tY.d,tN=tY.tx,t$=tY.ty;return 0!==tI||0!==tO?(tg[0]=tT*tE+tr*tO,tg[1]=tT*tI+tr*tC,tg[4]=ts*tE+ta*tO,tg[5]=ts*tI+ta*tC,tg[12]=tE*tW+tO*tM+tN,tg[13]=tI*tW+tC*tM+t$):(tg[0]=tT*tE,tg[1]=tr*tC,tg[4]=ts*tE,tg[5]=ta*tC,tg[12]=tE*tW+tN,tg[13]=tC*tM+t$),tg},tg.mulPre=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=tD.a,tE=tD.b,tI=tD.c,tO=tD.d,tC=tD.tx,tN=tD.ty;return 0!==tg||0!==tT?(tW.a=tM*tY+tE*tT,tW.b=tM*tg+tE*tr,tW.c=tI*tY+tO*tT,tW.d=tI*tg+tO*tr,tW.tx=tY*tC+tT*tN+ts,tW.ty=tg*tC+tr*tN+ta):(tW.a=tM*tY,tW.b=tE*tr,tW.c=tI*tY,tW.d=tO*tr,tW.tx=tY*tC+ts,tW.ty=tr*tN+ta),tW},tg.mulPos=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=tD.a,tE=tD.b,tI=tD.c,tO=tD.d,tC=tD.tx,tN=tD.ty;return 0!==tE||0!==tI?(tW.a=tY*tM+tg*tI,tW.b=tY*tE+tg*tO,tW.c=tT*tM+tr*tI,tW.d=tT*tE+tr*tO,tW.tx=tM*ts+tI*ta+tC,tW.ty=tE*ts+tO*ta+tN):(tW.a=tY*tM,tW.b=tg*tO,tW.c=tT*tM,tW.d=tr*tO,tW.tx=tM*ts+tC,tW.ty=tO*ta+tN),tW},tg.preMul=function(tD,tY,tg){var tT=tD.a,tr=tD.b,ts=tD.c,ta=tD.d,tW=tY.a,tM=tY.b,tE=tY.c,tI=tY.d,tO=tY.tx,tC=tY.ty;return tg.a=tW*tT,tg.b=tg.c=0,tg.d=tI*ta,tg.tx=tO*tT+tD.tx,tg.ty=tC*ta+tD.ty,0===tM&&0===tE&&0===tr&&0===ts||(tg.a+=tM*ts,tg.d+=tE*tr,tg.b+=tW*tr+tM*ta,tg.c+=tE*tT+tI*ts,tg.tx+=tC*ts,tg.ty+=tO*tr),tg},tg.preMulXY=function(tD,tY,tg,tT){var tr=tD.a,ts=tD.b,ta=tD.c,tW=tD.d;return tT.a=tr,tT.b=ts,tT.c=ta,tT.d=tW,tT.tx=tY*tr+tD.tx+tg*ta,tT.ty=tg*tW+tD.ty+tY*ts,tT},tg.create=function(){var tD=tg._cache,tY=tD._length?tD[--tD._length]:new tg;return tY.inPool=!1,tY},tg.EMPTY=new tg,tg.TEMP=new tg,tg._cache=[],tg}(),tA=function(){function tD(tD,tY){void 0===tD&&(tD=0),void 0===tY&&(tY=0),this.x=tD,this.y=tY}tJ(tD,"laya.maths.Point");var tY=tD.prototype;return tY.setTo=function(tD,tY){return this.x=tD,this.y=tY,this},tY.distance=function(tD,tY){return Math.sqrt((this.x-tD)*(this.x-tD)+(this.y-tY)*(this.y-tY))},tY.toString=function(){return this.x+","+this.y},tY.normalize=function(){var tD=Math.sqrt(this.x*this.x+this.y*this.y);if(0<tD){var tY=1/tD;this.x*=tY,this.y*=tY}},tD.TEMP=new tD,tD.EMPTY=new tD,tD}(),tq=function(){function tE(tD,tY,tg,tT){void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0),this.x=tD,this.y=tY,this.width=tg,this.height=tT}tJ(tE,"laya.maths.Rectangle");var tD=tE.prototype;return tD.setTo=function(tD,tY,tg,tT){return this.x=tD,this.y=tY,this.width=tg,this.height=tT,this},tD.copyFrom=function(tD){return this.x=tD.x,this.y=tD.y,this.width=tD.width,this.height=tD.height,this},tD.contains=function(tD,tY){return!(this.width<=0||this.height<=0)&&(tD>=this.x&&tD<this.right&&tY>=this.y&&tY<this.bottom)},tD.intersects=function(tD){return!(tD.x>this.x+this.width||tD.x+tD.width<this.x||tD.y>this.y+this.height||tD.y+tD.height<this.y)},tD.intersection=function(tD,tY){return this.intersects(tD)?(tY||(tY=new tE),tY.x=Math.max(this.x,tD.x),tY.y=Math.max(this.y,tD.y),tY.width=Math.min(this.right,tD.right)-tY.x,tY.height=Math.min(this.bottom,tD.bottom)-tY.y,tY):null},tD.union=function(tD,tY){return tY||(tY=new tE),this.clone(tY),tD.width<=0||tD.height<=0?tY:(tY.addPoint(tD.x,tD.y),tY.addPoint(tD.right,tD.bottom),this)},tD.clone=function(tD){return tD||(tD=new tE),tD.x=this.x,tD.y=this.y,tD.width=this.width,tD.height=this.height,tD},tD.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},tD.equals=function(tD){return!(!tD||tD.x!==this.x||tD.y!==this.y||tD.width!==this.width||tD.height!==this.height)},tD.addPoint=function(tD,tY){return this.x>tD&&(this.width+=this.x-tD,this.x=tD),this.y>tY&&(this.height+=this.y-tY,this.y=tY),this.width<tD-this.x&&(this.width=tD-this.x),this.height<tY-this.y&&(this.height=tY-this.y),this},tD._getBoundPoints=function(){var tD=tE._temB;return(tD.length=0)==this.width||0==this.height||tD.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),tD},tD.isEmpty=function(){return this.width<=0||this.height<=0},tI(0,tD,"right",function(){return this.x+this.width}),tI(0,tD,"bottom",function(){return this.y+this.height}),tE._getBoundPointS=function(tD,tY,tg,tT){var tr=tE._temA;return(tr.length=0)==tg||0==tT||tr.push(tD,tY,tD+tg,tY,tD,tY+tT,tD+tg,tY+tT),tr},tE._getWrapRec=function(tD,tY){if(!tD||tD.length<1)return tY?tY.setTo(0,0,0,0):tE.TEMP.setTo(0,0,0,0);tY=tY||new tE;var tg,tT,tr,ts,ta,tW=tD.length,tM=tA.TEMP;for(tr=ta=-(tT=ts=99999),tg=0;tg<tW;tg+=2)tM.x=tD[tg],tM.y=tD[tg+1],tT=tT<tM.x?tT:tM.x,ts=ts<tM.y?ts:tM.y,tr=tr>tM.x?tr:tM.x,ta=ta>tM.y?ta:tM.y;return tY.setTo(tT,ts,tr-tT,ta-ts)},tE.EMPTY=new tE,tE.TEMP=new tE,tE._temB=[],tE._temA=[],tE}(),tX=function(){function tM(){}return tJ(tM,"laya.media.SoundManager"),tI(1,tM,"useAudioMusic",function(){return tM._useAudioMusic},function(tD){tM._useAudioMusic=tD,tM._musicClass=tD?tgD:null}),tI(1,tM,"autoStopMusic",function(){return tM._autoStopMusic},function(tD){t_.stage.off("blur",null,tM._stageOnBlur),t_.stage.off("focus",null,tM._stageOnFocus),t_.stage.off("visibilitychange",null,tM._visibilityChange),(tM._autoStopMusic=tD)&&(t_.stage.on("blur",null,tM._stageOnBlur),t_.stage.on("focus",null,tM._stageOnFocus),t_.stage.on("visibilitychange",null,tM._visibilityChange))}),tI(1,tM,"muted",function(){return tM._muted},function(tD){tD!=tM._muted&&(tD&&tM.stopAllSound(),tM.musicMuted=tD,tM._muted=tD)}),tI(1,tM,"musicMuted",function(){return tM._musicMuted},function(tD){tD!=tM._musicMuted&&(tD?(tM._tMusic&&tM._musicChannel&&!tM._musicChannel.isStopped?tM._musicChannel.pause():tM._musicChannel=null,tM._musicMuted=tD):(tM._musicMuted=tD,tM._tMusic&&tM._musicChannel&&tM._musicChannel.resume()))}),tI(1,tM,"soundMuted",function(){return tM._soundMuted},function(tD){tM._soundMuted=tD}),tM.addChannel=function(tD){0<=tM._channels.indexOf(tD)||(tM._channels.push(tD),tM.autoReleaseSound&&0!=tM._notUsedCount&&tM._notUsedUrls[tD.url]&&(delete tM._notUsedUrls[tD.url],0==--tM._notUsedCount&&t_.timer.clear(tM,tM.disposeSoundIfNotUsed)))},tM.removeChannel=function(tD){var tY=tM._channels,tg=tY.indexOf(tD);if(-1!=tg&&(tY.splice(tg,1),tM.autoReleaseSound)){var tT=tD.url,tr=tM.defaultIntervals[tT]||2e4;if(0<tr){var ts=!0;for(tg=tY.length-1;0<=tg;tg--)if(tY[tg].url==tT){ts=!1;break}ts&&(tM._notUsedUrls[tT]=Date.now()+tr,0==tM._notUsedCount++&&t_.timer.loop(1e4,tM,tM.disposeSoundIfNotUsed))}}},tM.disposeSoundIfNotUsed=function(){var tD=tM._notUsedUrls;if(0!=tM._notUsedCount){var tY=Date.now();for(var tg in tD)tY>=tD[tg]&&(delete tD[tg],--tM._notUsedCount,tM.destroySound(tg));if(0!=tM._notUsedCount)return}t_.timer.clear(tM,tM.disposeSoundIfNotUsed)},tM._visibilityChange=function(){t_.stage.isVisibility?tM._stageOnFocus():tM._stageOnBlur()},tM._stageOnBlur=function(){tM._isActive=!1,tM._musicChannel&&(tM._musicChannel.isStopped||(tM._blurPaused=!0,tM._musicChannel.pause())),tM.stopAllSound(),t_.stage.once("mousedown",null,tM._stageOnFocus)},tM._recoverWebAudio=function(){tsD.ctx&&"running"!=tsD.ctx.state&&tsD.ctx.resume&&tsD.ctx.resume()},tM._stageOnFocus=function(){if(tM._isActive=!0,tM._recoverWebAudio(),t_.stage.off("mousedown",null,tM._stageOnFocus),tM._blurPaused){var tD=tM._musicChannel;tD&&tM._music&&tD.isStopped&&(tM._blurPaused=!1,tM._music._disposed?tM.playMusic(tD.url,tD.loops,tD.startHandler,tD.completeHandler,tD.startTime):tD.audioBuffer?tD.resume():tM._music.play(tD.startTime,tD.loops,tD.startHandler,tD))}},tM.playSound=function(tD,tY,tg,tT,tr,ts){if(void 0===tY&&(tY=1),void 0===ts&&(ts=0),!tD)return null;if(tM._muted)return null;if(tM._recoverWebAudio(),tD==tM._tMusic){if(tM._musicMuted)return null}else{if(!tM._isActive)return null;if(tM._soundMuted)return null}var ta,tW=tM._pool[tD];return tr||(tr=tM._soundClass),tW||((tW=new tr).load(tD),tM._pool[tD]=tW),(ta=tW.play(ts,tY,tg))?(tD==tM._tMusic&&(tM._music=tW,tM._isActive||(tM._blurPaused=!0,ta.pause())),ta.url=tD,ta.volume=tD==tM._tMusic?tM.musicVolume:tM.soundVolume,ta.completeHandler=tT,ta):null},tM.destroySound=function(tD){var tY=tM._pool[tD];tY&&(delete tM._pool[tD],tY.dispose())},tM.playMusic=function(tD,tY,tg,tT,tr){return void 0===tY&&(tY=0),void 0===tr&&(tr=0),tM._tMusic=tD,tM._musicChannel&&tM._musicChannel.stop(),tM._musicChannel=tM.playSound(tD,tY,tg,tT,null,tr)},tM.stopSound=function(tD){for(var tY,tg=tM._channels.length-1;0<=tg;tg--)(tY=tM._channels[tg]).url==tD&&tY.stop()},tM.stopAll=function(){tM._tMusic=null;var tD=0;for(tD=tM._channels.length-1;0<=tD;tD--)tM._channels[tD].stop()},tM.stopAllSound=function(){var tD,tY=0;for(tY=tM._channels.length-1;0<=tY;tY--)(tD=tM._channels[tY]).url!=tM._tMusic&&tD.stop()},tM.stopMusic=function(){tM._musicChannel&&tM._musicChannel.stop(),tM._tMusic=null},tM.setSoundVolume=function(tD,tY){if(tY)tM._setVolume(tY,tD);else{tM.soundVolume=tD;var tg,tT=0;for(tT=tM._channels.length-1;0<=tT;tT--)(tg=tM._channels[tT]).url!=tM._tMusic&&(tg.volume=tD)}},tM.setMusicVolume=function(tD){tM.musicVolume=tD,tM._setVolume(tM._tMusic,tD)},tM._setVolume=function(tD,tY){for(var tg,tT=tM._channels.length-1;0<=tT;tT--)(tg=tM._channels[tT]).url==tD&&(tg.volume=tY)},tM.musicVolume=1,tM.soundVolume=1,tM.playbackRate=1,tM._useAudioMusic=!0,tM._muted=!1,tM._soundMuted=!1,tM._musicMuted=!1,tM._tMusic=null,tM._musicChannel=null,tM._music=null,tM._channels=[],tM._autoStopMusic=!1,tM._blurPaused=!1,tM._isActive=!0,tM._soundClass=null,tM._musicClass=null,tM.autoReleaseSound=!0,tM._pool={},tM.defaultIntervals={},tM._notUsedUrls={},tM._notUsedCount=0,tM}(),tb=function(){var tD;function tg(){}return tJ(tg,"laya.net.LocalStorage"),tg.__init__=function(){tg._baseClass||(tg._baseClass=tD).init(),tg.items=tg._baseClass.items,tg.support=tg._baseClass.support},tg.setItem=function(tD,tY){tg._baseClass.setItem(tD,tY)},tg.getItem=function(tD){return tg._baseClass.getItem(tD)},tg.setJSON=function(tD,tY){tg._baseClass.setJSON(tD,tY)},tg.getJSON=function(tD){return tg._baseClass.getJSON(tD)},tg.removeItem=function(tD){tg._baseClass.removeItem(tD)},tg.clear=function(){tg._baseClass.clear()},tg._baseClass=null,tg.items=null,tg.support=!1,tg.__init$=function(){tD=function(){function tg(){}return tJ(tg,""),tg.init=function(){try{tg.support=!0,tg.items=tN.localStorage,tg.setItem("laya","1"),tg.removeItem("laya")}catch(tD){tg.support=!1}tg.support||console.log("LocalStorage is not supprot or browser is private mode.")},tg.setItem=function(tD,tY){try{tg.support&&tg.items.setItem(tD,tY)}catch(tD){console.warn("set localStorage failed",tD)}},tg.getItem=function(tD){return tg.support?tg.items.getItem(tD):null},tg.setJSON=function(tD,tY){try{tg.support&&tg.items.setItem(tD,JSON.stringify(tY))}catch(tD){console.warn("set localStorage failed",tD)}},tg.getJSON=function(tD){return JSON.parse(tg.support?tg.items.getItem(tD):null)},tg.removeItem=function(tD){tg.support&&tg.items.removeItem(tD)},tg.clear=function(){tg.support&&tg.items.clear()},tg.items=null,tg.support=!1,tg}()},tg}(),th=(function(){function tT(){}tJ(tT,"laya.net.ResourceVersion"),tT.enable=function(tD,tY,tg){void 0===tg&&(tg=2),laya.net.ResourceVersion.type=tg,t_.loader.load(tD,tj.create(null,tT.onManifestLoaded,[tY]),null,"json"),ti.customFormat=tT.addVersionPrefix},tT.onManifestLoaded=function(tD,tY){tT.manifest=tY,tD.run(),tY||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},tT.addVersionPrefix=function(tD){return tT.manifest&&tT.manifest[tD]?2==tT.type?tT.manifest[tD]:tT.manifest[tD]+"/"+tD:tD},tT.FOLDER_VERSION=1,tT.FILENAME_VERSION=2,tT.manifest=null,tT.type=1}(),function(){function tD(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}tJ(tD,"laya.net.TTFLoader");var tY=tD.prototype;return tY.load=function(tD){var tY=(this._url=tD).split(".ttf")[0].split("/");this.fontName=tY[tY.length-1],tU.window.conch?this._loadConch():tU.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},tY._loadConch=function(){this._http=new taD,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},tY._onHttpLoaded=function(tD){tU.window.conch.setFontFaceFromBuffer(this.fontName,tD),this._clearHttp(),this._complete()},tY._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},tY._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},tY._complete=function(){t_.timer.clear(this,this._complete),t_.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},tY._checkComplete=function(){tz.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},tY._loadWithFontFace=function(){var tD=new tU.window.FontFace(this.fontName,"url('"+this._url+"')");tU.window.document.fonts.add(tD);var tY=this;tD.loaded.then(function(){tY._complete()}),tD.load()},tY._createDiv=function(){this._div=tU.createElement("div"),this._div.innerHTML="laya";var tD=this._div.style;tD.fontFamily=this.fontName,tD.position="absolute",tD.left="-100px",tD.top="-100px",tU.document.body.appendChild(this._div)},tY._loadWithCSS=function(){var tD=this,tY=tU.createElement("style");tY.type="text/css",tU.document.body.appendChild(tY),tY.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=tz.measureText("LayaTTFFont",this._fontTxt).width;var tg=this;tY.onload=function(){t_.timer.once(1e4,tg,tD._complete)},t_.timer.loop(20,this,this._checkComplete),this._createDiv()},tD._testString="LayaTTFFont",tD}()),ti=function(){function tT(tD){this._url=null,this._path=null,this._url=tT.formatURL(tD),this._path=tT.getPath(tD)}tJ(tT,"laya.net.URL");var tD=tT.prototype;return tI(0,tD,"path",function(){return this._path}),tI(0,tD,"url",function(){return this._url}),tT.formatURL=function(tD,tY){if(!tD)return"null path";if(0<tD.indexOf(":"))return tD;null!=tT.customFormat&&(tD=tT.customFormat(tD,tY));var tg=tD.charAt(0);if("."===tg)return tT.formatRelativePath((tY||tT.basePath)+tD);if("~"===tg)return tT.rootPath+tD.substring(1);if("d"===tg){if(0===tD.indexOf("data:image"))return tD}else if("/"===tg)return tD;return(tY||tT.basePath)+tD},tT.formatRelativePath=function(tD){for(var tY=tD.split("/"),tg=0,tT=tY.length;tg<tT;tg++)".."==tY[tg]&&(tY.splice(tg-1,2),tg-=2);return tY.join("/")},tT.isAbsolute=function(tD){return 0<tD.indexOf(":")||"/"==tD.charAt(0)},tT.getPath=function(tD){var tY=tD.lastIndexOf("/");return 0<tY?tD.substr(0,tY+1):""},tT.getFileName=function(tD){var tY=tD.lastIndexOf("/");return 0<tY?tD.substr(tY+1):tD},tT.version={},tT.basePath="",tT.rootPath="",tT.customFormat=function(tD){var tY=tT.version[tD];return!tP.isConchApp&&tY&&(tD+="?v="+tY),tD},tT}(),tP=function(){function tr(tD,tY){this._timeId=0;var tg=tr._mainCanvas.source.style;tg.position="absolute",tg.top=tg.left="0px",tg.background="#000000",tr._mainCanvas.source.id="layaCanvas";var tT=laya.renders.Render.isWebGL;tr._mainCanvas.source.width=tD,tr._mainCanvas.source.height=tY,tT&&tr.WebGL.init(tr._mainCanvas,tD,tY),tU.container.appendChild(tr._mainCanvas.source),(tr._context=new tB(tD,tY,tT?null:tr._mainCanvas)).ctx.setIsMainContext(),tU.window.requestAnimationFrame(function tD(tY){tU.window.requestAnimationFrame(tD);t_.stage._loop(tY)}),t_.stage.on("visibilitychange",this,this._onVisibilitychange)}tJ(tr,"laya.renders.Render");var tD=tr.prototype;return tD._onVisibilitychange=function(){t_.stage.isVisibility?0!=this._timeId&&tU.window.clearInterval(this._timeId):this._timeId=tU.window.setInterval(this._enterFrame,1e3)},tD._enterFrame=function(tD){t_.stage._loop(0)},tI(1,tr,"context",function(){return tr._context}),tI(1,tr,"canvas",function(){return tr._mainCanvas.source}),tr._context=null,tr._mainCanvas=null,tr.WebGL=null,tr.isConchNode=!1,tr.isConchApp=!1,tr.isConchWebGL=!1,tr.isWebGL=!1,tr.is3DMode=!1,tr.optimizeTextureMemory=function(tD,tY){return!0},tr.__init$=function(){tN.ConchRenderType=tN.ConchRenderType||1,tN.ConchRenderType|=tN.conch?4:0,tr.isConchNode=5==(5&tN.ConchRenderType),tr.isConchApp=4==(4&tN.ConchRenderType),tr.isConchWebGL=6==tN.ConchRenderType},tr}(),tB=function(){function ta(tD,tY,tg){this.x=0,this.y=0,this._drawTexture=function(tD,tY,tg){tg[0].loaded&&this.ctx.drawTexture(tg[0],tg[1],tg[2],tg[3],tg[4],tD,tY)},this._fillTexture=function(tD,tY,tg){tg[0].loaded&&this.ctx.fillTexture(tg[0],tg[1]+tD,tg[2]+tY,tg[3],tg[4],tg[5],tg[6],tg[7])},this._drawTextureWithTransform=function(tD,tY,tg){tg[0].loaded&&this.ctx.drawTextureWithTransform(tg[0],tg[1],tg[2],tg[3],tg[4],tg[5],tD,tY,tg[6])},this._fillQuadrangle=function(tD,tY,tg){this.ctx.fillQuadrangle(tg[0],tg[1],tg[2],tg[3],tg[4])},this._drawRect=function(tD,tY,tg){var tT=this.ctx;null!=tg[4]&&(tT.fillStyle=tg[4],tT.fillRect(tD+tg[0],tY+tg[1],tg[2],tg[3],null)),null!=tg[5]&&(tT.strokeStyle=tg[5],tT.lineWidth=tg[6],tT.strokeRect(tD+tg[0],tY+tg[1],tg[2],tg[3],tg[6]))},this._drawPie=function(tD,tY,tg){var tT=this.ctx;tP.isWebGL&&tT.setPathId(tg[8]),tT.beginPath(),tP.isWebGL?(tT.movePath(tg[0]+tD,tg[1]+tY),tT.moveTo(0,0)):tT.moveTo(tD+tg[0],tY+tg[1]),tT.arc(tD+tg[0],tY+tg[1],tg[2],tg[3],tg[4]),tT.closePath(),this._fillAndStroke(tg[5],tg[6],tg[7],!0)},this._clipRect=function(tD,tY,tg){this.ctx.clipRect(tD+tg[0],tY+tg[1],tg[2],tg[3])},this._fillRect=function(tD,tY,tg){this.ctx.fillRect(tD+tg[0],tY+tg[1],tg[2],tg[3],tg[4])},this._drawCircle=function(tD,tY,tg){var tT=this.ctx;tP.isWebGL&&tT.setPathId(tg[6]),to.drawCall++,tT.beginPath(),tP.isWebGL&&tT.movePath(tg[0]+tD,tg[1]+tY),tT.arc(tg[0]+tD,tg[1]+tY,tg[2],0,ta.PI2),tT.closePath(),this._fillAndStroke(tg[3],tg[4],tg[5],!0)},this._fillCircle=function(tD,tY,tg){to.drawCall++;var tT=this.ctx;tT.beginPath(),tT.fillStyle=tg[3],tT.arc(tg[0]+tD,tg[1]+tY,tg[2],0,ta.PI2),tT.fill()},this._setShader=function(tD,tY,tg){this.ctx.setShader(tg[0])},this._drawLine=function(tD,tY,tg){var tT=this.ctx;tP.isWebGL&&tT.setPathId(tg[6]),tT.beginPath(),tT.strokeStyle=tg[4],tT.lineWidth=tg[5],tP.isWebGL?(tT.movePath(tD,tY),tT.moveTo(tg[0],tg[1]),tT.lineTo(tg[2],tg[3])):(tT.moveTo(tD+tg[0],tY+tg[1]),tT.lineTo(tD+tg[2],tY+tg[3])),tT.stroke()},this._drawLines=function(tD,tY,tg){var tT=this.ctx;tP.isWebGL&&tT.setPathId(tg[5]),tT.beginPath(),tD+=tg[0],tY+=tg[1],tP.isWebGL&&tT.movePath(tD,tY),tT.strokeStyle=tg[3],tT.lineWidth=tg[4];var tr=tg[2],ts=2,ta=tr.length;if(tP.isWebGL)for(tT.moveTo(tr[0],tr[1]);ts<ta;)tT.lineTo(tr[ts++],tr[ts++]);else for(tT.moveTo(tD+tr[0],tY+tr[1]);ts<ta;)tT.lineTo(tD+tr[ts++],tY+tr[ts++]);tT.stroke()},this._drawLinesWebGL=function(tD,tY,tg){this.ctx.drawLines(tD+this.x+tg[0],tY+this.y+tg[1],tg[2],tg[3],tg[4])},this._drawCurves=function(tD,tY,tg){this.ctx.drawCurves(tD,tY,tg)},this._draw=function(tD,tY,tg){tg[0].call(null,this,tD,tY)},this._transformByMatrix=function(tD,tY,tg){this.ctx.transformByMatrix(tg[0])},this._setTransform=function(tD,tY,tg){this.ctx.setTransform(tg[0],tg[1],tg[2],tg[3],tg[4],tg[5])},this._setTransformByMatrix=function(tD,tY,tg){this.ctx.setTransformByMatrix(tg[0])},this._save=function(tD,tY,tg){this.ctx.save()},this._restore=function(tD,tY,tg){this.ctx.restore()},this._translate=function(tD,tY,tg){this.ctx.translate(tg[0],tg[1])},this._transform=function(tD,tY,tg){this.ctx.translate(tg[1]+tD,tg[2]+tY);var tT=tg[0];this.ctx.transform(tT.a,tT.b,tT.c,tT.d,tT.tx,tT.ty),this.ctx.translate(-tD-tg[1],-tY-tg[2])},this._rotate=function(tD,tY,tg){this.ctx.translate(tg[1]+tD,tg[2]+tY),this.ctx.rotate(tg[0]),this.ctx.translate(-tD-tg[1],-tY-tg[2])},this._scale=function(tD,tY,tg){this.ctx.translate(tg[2]+tD,tg[3]+tY),this.ctx.scale(tg[0],tg[1]),this.ctx.translate(-tD-tg[2],-tY-tg[3])},this._alpha=function(tD,tY,tg){this.ctx.globalAlpha*=tg[0]},this._setAlpha=function(tD,tY,tg){this.ctx.globalAlpha=tg[0]},this._fillText=function(tD,tY,tg){this.ctx.fillText(tg[0],tg[1]+tD,tg[2]+tY,tg[3],tg[4],tg[5])},this._strokeText=function(tD,tY,tg){this.ctx.strokeText(tg[0],tg[1]+tD,tg[2]+tY,tg[3],tg[4],tg[5],tg[6])},this._fillBorderText=function(tD,tY,tg){this.ctx.fillBorderText(tg[0],tg[1]+tD,tg[2]+tY,tg[3],tg[4],tg[5],tg[6],tg[7])},this._blendMode=function(tD,tY,tg){this.ctx.globalCompositeOperation=tg[0]},this._beginClip=function(tD,tY,tg){this.ctx.beginClip&&this.ctx.beginClip(tD+tg[0],tY+tg[1],tg[2],tg[3])},this._setIBVB=function(tD,tY,tg){this.ctx.setIBVB(tg[0]+tD,tg[1]+tY,tg[2],tg[3],tg[4],tg[5],tg[6],tg[7])},this._fillTrangles=function(tD,tY,tg){this.ctx.fillTrangles(tg[0],tg[1]+tD,tg[2]+tY,tg[3],tg[4])},this._drawPath=function(tD,tY,tg){var tT=this.ctx;tP.isWebGL&&tT.setPathId(-1),tT.beginPath(),tD+=tg[0],tY+=tg[1],tP.isWebGL&&tT.movePath(tD,tY);for(var tr=tg[2],ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts];switch(tW[0]){case"moveTo":tP.isWebGL?tT.moveTo(tW[1],tW[2]):tT.moveTo(tD+tW[1],tY+tW[2]);break;case"lineTo":tP.isWebGL?tT.lineTo(tW[1],tW[2]):tT.lineTo(tD+tW[1],tY+tW[2]);break;case"arcTo":tP.isWebGL?tT.arcTo(tW[1],tW[2],tW[3],tW[4],tW[5]):tT.arcTo(tD+tW[1],tY+tW[2],tD+tW[3],tY+tW[4],tW[5]);break;case"closePath":tT.closePath()}}var tM=tg[3];null!=tM&&(tT.fillStyle=tM.fillStyle,tT.fill());var tE=tg[4];null!=tE&&(tT.strokeStyle=tE.strokeStyle,tT.lineWidth=tE.lineWidth||1,tT.lineJoin=tE.lineJoin,tT.lineCap=tE.lineCap,tT.miterLimit=tE.miterLimit,tT.stroke())},this.drawPoly=function(tD,tY,tg){this.ctx.drawPoly(tD+this.x+tg[0],tY+this.y+tg[1],tg[2],tg[3],tg[4],tg[5],tg[6])},this._drawPoly=function(tD,tY,tg){var tT=this.ctx,tr=tg[2],ts=2,ta=tr.length;if(tP.isWebGL)for(tT.setPathId(tg[6]),tT.beginPath(),tD+=tg[0],tY+=tg[1],tT.movePath(tD,tY),tT.moveTo(tr[0],tr[1]);ts<ta;)tT.lineTo(tr[ts++],tr[ts++]);else for(tT.beginPath(),tD+=tg[0],tY+=tg[1],tT.moveTo(tD+tr[0],tY+tr[1]);ts<ta;)tT.lineTo(tD+tr[ts++],tY+tr[ts++]);tT.closePath(),this._fillAndStroke(tg[3],tg[4],tg[5],tg[7])},this._drawSkin=function(tD,tY,tg){var tT=tg[0];if(tT){var tr=this.ctx;tT.render(tr,tD,tY)}},this._drawParticle=function(tD,tY,tg){this.ctx.drawParticle(tD+this.x,tY+this.y,tg[0])},this._setFilters=function(tD,tY,tg){this.ctx.setFilters(tg)},tg?this.ctx=tg.getContext("2d"):(tg=tZD.create("3D"),this.ctx=tz.createWebGLContext2D(tg),tg._setContext(this.ctx)),tg.size(tD,tY),this.canvas=tg}tJ(ta,"laya.renders.RenderContext");var tD=ta.prototype;return tD.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},tD.drawTexture=function(tD,tY,tg,tT,tr){tD.loaded&&this.ctx.drawTexture(tD,tY,tg,tT,tr,this.x,this.y)},tD._drawTextures=function(tD,tY,tg){tg[0].loaded&&this.ctx.drawTextures(tg[0],tg[1],tD+this.x,tY+this.y)},tD.drawTextureWithTransform=function(tD,tY,tg,tT,tr,ts,ta){tD.loaded&&this.ctx.drawTextureWithTransform(tD,tY,tg,tT,tr,ts,this.x,this.y,ta)},tD.fillQuadrangle=function(tD,tY,tg,tT,tr){this.ctx.fillQuadrangle(tD,tY,tg,tT,tr)},tD.drawCanvas=function(tD,tY,tg,tT,tr){this.ctx.drawCanvas(tD,tY+this.x,tg+this.y,tT,tr)},tD.drawRect=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=1);var ta=this.ctx;ta.strokeStyle=tr,ta.lineWidth=ts,ta.strokeRect(tD+this.x,tY+this.y,tg,tT,ts)},tD._fillAndStroke=function(tD,tY,tg,tT){void 0===tT&&(tT=!1);var tr=this.ctx;null!=tD&&(tr.fillStyle=tD,tP.isWebGL?tr.fill(tT):tr.fill()),null!=tY&&0<tg&&(tr.strokeStyle=tY,tr.lineWidth=tg,tr.stroke())},tD.clipRect=function(tD,tY,tg,tT){this.ctx.clipRect(tD+this.x,tY+this.y,tg,tT)},tD.fillRect=function(tD,tY,tg,tT,tr){this.ctx.fillRect(tD+this.x,tY+this.y,tg,tT,tr)},tD.drawCircle=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=1),to.drawCall++;var ts=this.ctx;ts.beginPath(),ts.strokeStyle=tT,ts.lineWidth=tr,ts.arc(tD+this.x,tY+this.y,tg,0,ta.PI2),ts.stroke()},tD.drawTriangles=function(tD,tY,tg){if(tP.isWebGL)this.ctx.drawTriangles(tg[0],tD+tg[1],tY+tg[2],tg[3],tg[4],tg[5],tg[6],tg[7],tg[8],tg[9]);else{var tT=tg[5],tr=0,ts=tT.length,ta=this.ctx;for(tr=0;tr<ts;tr+=3){var tW=2*tT[tr],tM=2*tT[tr+1],tE=2*tT[tr+2];ta.drawTriangle(tg[0],tg[3],tg[4],tW,tM,tE,tg[6],!0)}}},tD.fillCircle=function(tD,tY,tg,tT){to.drawCall++;var tr=this.ctx;tr.beginPath(),tr.fillStyle=tT,tr.arc(tD+this.x,tY+this.y,tg,0,ta.PI2),tr.fill()},tD.setShader=function(tD){this.ctx.setShader(tD)},tD.drawLine=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=1);var ta=this.ctx;ta.beginPath(),ta.strokeStyle=tr,ta.lineWidth=ts,ta.moveTo(this.x+tD,this.y+tY),ta.lineTo(this.x+tg,this.y+tT),ta.stroke()},tD.clear=function(){this.ctx.clear()},tD.transformByMatrix=function(tD){this.ctx.transformByMatrix(tD)},tD.setTransform=function(tD,tY,tg,tT,tr,ts){this.ctx.setTransform(tD,tY,tg,tT,tr,ts)},tD.setTransformByMatrix=function(tD){this.ctx.setTransformByMatrix(tD)},tD.save=function(){this.ctx.save()},tD.restore=function(){this.ctx.restore()},tD.translate=function(tD,tY){this.ctx.translate(tD,tY)},tD.transform=function(tD,tY,tg,tT,tr,ts){this.ctx.transform(tD,tY,tg,tT,tr,ts)},tD.rotate=function(tD){this.ctx.rotate(tD)},tD.scale=function(tD,tY){this.ctx.scale(tD,tY)},tD.alpha=function(tD){this.ctx.globalAlpha*=tD},tD.setAlpha=function(tD){this.ctx.globalAlpha=tD},tD.fillWords=function(tD,tY,tg,tT,tr,ts){void 0===ts&&(ts=0),this.ctx.fillWords(tD,tY,tg,tT,tr,ts)},tD.fillBorderWords=function(tD,tY,tg,tT,tr,ts,ta){this.ctx.fillBorderWords(tD,tY,tg,tT,tr,ts,ta)},tD.fillText=function(tD,tY,tg,tT,tr,ts){this.ctx.fillText(tD,tY+this.x,tg+this.y,tT,tr,ts)},tD.strokeText=function(tD,tY,tg,tT,tr,ts,ta){this.ctx.strokeText(tD,tY+this.x,tg+this.y,tT,tr,ts,ta)},tD.blendMode=function(tD){this.ctx.globalCompositeOperation=tD},tD.flush=function(){this.ctx.flush&&this.ctx.flush()},tD.addRenderObject=function(tD){this.ctx.addRenderObject(tD)},tD.beginClip=function(tD,tY,tg,tT){this.ctx.beginClip&&this.ctx.beginClip(tD,tY,tg,tT)},tD.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},tD.fillTrangles=function(tD,tY,tg){this.ctx.fillTrangles(tg[0],tg[1],tg[2],tg[3],4<tg.length?tg[4]:null)},ta.PI2=2*Math.PI,ta}(),tH=function(){function ta(tD,tY){switch(this._next=tY||ta.NORENDER,tD){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=tx._filter);case 69905:return void(this._fun=ta._initRenderFun)}this.onCreate(tD)}tJ(ta,"laya.renders.RenderSprite");var tD=ta.prototype;return tD.onCreate=function(tD){},tD._style=function(tD,tY,tg,tT){tD._style.render(tD,tY,tg,tT);var tr=this._next;tr._fun.call(tr,tD,tY,tg,tT)},tD._no=function(tD,tY,tg,tT){},tD._custom=function(tD,tY,tg,tT){tD.customRender(tY,tg,tT);var tr=tD._style._tf;this._next._fun.call(this._next,tD,tY,tg-tr.translateX,tT-tr.translateY)},tD._clip=function(tD,tY,tg,tT){var tr=this._next;if(tr!=ta.NORENDER){var ts=tD._style.scrollRect;tY.ctx.save(),tY.ctx.clipRect(tg,tT,ts.width,ts.height),tr._fun.call(tr,tD,tY,tg-ts.x,tT-ts.y),tY.ctx.restore()}},tD._blend=function(tD,tY,tg,tT){var tr=tD._style;tr.blendMode&&(tY.ctx.globalCompositeOperation=tr.blendMode);var ts=this._next;ts._fun.call(ts,tD,tY,tg,tT),tY.ctx.globalCompositeOperation="source-over"},tD._mask=function(tD,tY,tg,tT){var tr=this._next;tr._fun.call(tr,tD,tY,tg,tT);var ts=tD.mask;ts&&(tY.ctx.globalCompositeOperation="destination-in",(0<ts.numChildren||!ts.graphics._isOnlyOne())&&(ts.cacheAsBitmap=!0),ts.render(tY,tg-tD.pivotX,tT-tD.pivotY)),tY.ctx.globalCompositeOperation="source-over"},tD._graphics=function(tD,tY,tg,tT){var tr=tD._style._tf;tD._graphics&&tD._graphics._render(tD,tY,tg-tr.translateX,tT-tr.translateY);var ts=this._next;ts._fun.call(ts,tD,tY,tg,tT)},tD._image=function(tD,tY,tg,tT){var tr=tD._style;tY.ctx.drawTexture2(tg,tT,tr._tf.translateX,tr._tf.translateY,tD.transform,tr.alpha,tr.blendMode,tD._graphics._one)},tD._image2=function(tD,tY,tg,tT){var tr=tD._style._tf;tY.ctx.drawTexture2(tg,tT,tr.translateX,tr.translateY,tD.transform,1,null,tD._graphics._one)},tD._alpha=function(tD,tY,tg,tT){var tr;if(.01<(tr=tD._style.alpha)||tD._needRepaint()){var ts=tY.ctx.globalAlpha;tY.ctx.globalAlpha*=tr;var ta=this._next;ta._fun.call(ta,tD,tY,tg,tT),tY.ctx.globalAlpha=ts}},tD._transform=function(tD,tY,tg,tT){var tr=tD.transform,ts=this._next;tr&&ts!=ta.NORENDER?(tY.save(),tY.transform(tr.a,tr.b,tr.c,tr.d,tr.tx+tg,tr.ty+tT),ts._fun.call(ts,tD,tY,0,0),tY.restore()):ts._fun.call(ts,tD,tY,tg,tT)},tD._childs=function(tD,tY,tg,tT){var tr=tD._style,ts=tr._tf;if(tg=tg-ts.translateX+tr.paddingLeft,tT=tT-ts.translateY+tr.paddingTop,tr._calculation){var ta=tD._getWords();if(ta){var tW=tr;tW&&(tW.stroke?tY.fillBorderWords(ta,tg,tT,tW.font,tW.color,tW.strokeColor,tW.stroke):tY.fillWords(ta,tg,tT,tW.font,tW.color,"none"!=tW.textDecoration&&tW.underLine?1:0))}}var tM,tE=tD._childs,tI=tE.length;if(tD.viewport||tD.optimizeScrollRect&&tD._style.scrollRect){var tO=tD.viewport||tD._style.scrollRect,tC=tO.x,tN=tO.y,t$=tO.right,td=tO.bottom,tJ=NaN,tx=NaN;for(tj=0;tj<tI;++tj)(tM=tE[tj]).visible&&(tJ=tM._x)<t$&&tJ+tM.width>tC&&(tx=tM._y)<td&&tx+tM.height>tN&&tM.render(tY,tg,tT)}else for(var tj=0;tj<tI;++tj)(tM=tE[tj])._style.visible&&tM.render(tY,tg,tT)},tD._canvas=function(tD,tY,tg,tT){var tr=tD._$P.cacheCanvas;if(tr){"bitmap"===tr.type?to.canvasBitmap++:to.canvasNormal++;var ts=tr.ctx;if(tD._needRepaint()||!ts)this._canvas_repaint(tD,tY,tg,tT);else{var ta=tr._cacheRec;tY.drawCanvas(ts.canvas,tg+ta.x,tT+ta.y,ta.width,ta.height)}}else this._next._fun.call(this._next,tD,tY,tg,tT)},tD._canvas_repaint=function(tD,tY,tg,tT){var tr=tD._$P.cacheCanvas,ts=this._next;if(tr){var ta,tW,tM,tE,tI=tr.ctx,tO=tD._needRepaint()||!tI,tC=tr.type;if("bitmap"===tC?to.canvasBitmap++:to.canvasNormal++,tO){var tN,t$;tr._cacheRec||(tr._cacheRec=new tq),tP.isWebGL&&"bitmap"!==tC?tr._cacheRec.setTo(-tD.pivotX,-tD.pivotY,1,1):((tE=tD.getSelfBounds()).x=tE.x-tD.pivotX,tE.y=tE.y-tD.pivotY,tE.x=tE.x-16,tE.y=tE.y-16,tE.width=tE.width+32,tE.height=tE.height+32,tE.x=Math.floor(tE.x+tg)-tg,tE.y=Math.floor(tE.y+tT)-tT,tE.width=Math.floor(tE.width),tE.height=Math.floor(tE.height),tr._cacheRec.copyFrom(tE)),tE=tr._cacheRec;var td,tJ=tP.isWebGL?1:tU.pixelRatio*t_.stage.clientScaleX,tx=tP.isWebGL?1:tU.pixelRatio*t_.stage.clientScaleY;if(!tP.isWebGL){var tj,tZ=1,tp=1;for(tj=tD;tj&&tj!=t_.stage;)tZ*=tj.scaleX,tp*=tj.scaleY,tj=tj.parent;tP.isWebGL?(tZ<1&&(tJ*=tZ),tp<1&&(tx*=tp)):(1<tZ&&(tJ*=tZ),1<tp&&(tx*=tp))}if(tD.scrollRect){var tl=tD.scrollRect;tE.x-=tl.x,tE.y-=tl.y}if(tN=tE.width*tJ,t$=tE.height*tx,tW=tE.x,tM=tE.y,tP.isWebGL&&"bitmap"===tC&&(2048<tN||2048<t$))return console.warn("cache bitmap size larger than 2048,cache ignored"),tr.ctx&&(tK.recover("RenderContext",tr.ctx),tr.ctx.canvas.size(0,0),tr.ctx=null),void ts._fun.call(ts,tD,tY,tg,tT);if(tI||(tI=tr.ctx=tK.getItem("RenderContext")||new tB(tN,t$,tZD.create("AUTO"))),tI.ctx.sprite=tD,(ta=tI.canvas).clear(),(ta.width!=tN||ta.height!=t$)&&ta.size(tN,t$),"bitmap"===tC?ta.context.asBitmap=!0:"normal"===tC&&(ta.context.asBitmap=!1),1!=tJ||1!=tx){var tt=tI.ctx;tt.save(),tt.scale(tJ,tx),!tP.isConchWebGL&&tP.isConchApp&&(td=tD._$P.cf)&&tt.setFilterMatrix&&tt.setFilterMatrix(td._mat,td._alpha),ts._fun.call(ts,tD,tI,-tW,-tM),tt.restore(),tP.isConchApp&&!tP.isConchWebGL||tD._applyFilters()}else tt=tI.ctx,!tP.isConchWebGL&&tP.isConchApp&&(td=tD._$P.cf)&&tt.setFilterMatrix&&tt.setFilterMatrix(td._mat,td._alpha),ts._fun.call(ts,tD,tI,-tW,-tM),tP.isConchApp&&!tP.isConchWebGL||tD._applyFilters();tD._$P.staticCache&&(tr.reCache=!1),to.canvasReCache++}else tW=(tE=tr._cacheRec).x,tM=tE.y,ta=tI.canvas;tY.drawCanvas(ta,tg+tW,tT+tM,tE.width,tE.height)}else ts._fun.call(ts,tD,tI,tg,tT)},ta.__init__=function(){var tD,tY,tg=0;for(tY=tz.createRenderSprite(69905,null),tD=ta.renders.length=4096,tg=0;tg<tD;tg++)ta.renders[tg]=tY;ta.renders[0]=tz.createRenderSprite(0,null),function(tD,tY){for(var tg=0,tT=0;tT<tD.length;tT++)tg|=tD[tT],ta.renders[tg]=tY}([1,512,4,2],new ta(1,null)),ta.renders[513]=tz.createRenderSprite(513,null),ta.renders[517]=new ta(517,null)},ta._initRenderFun=function(tD,tY,tg,tT){var tr=tD._renderType;(ta.renders[tr]=ta._getTypeRender(tr))._fun(tD,tY,tg,tT)},ta._getTypeRender=function(tD){for(var tY=null,tg=2048;1<tg;)tg&tD&&(tY=tz.createRenderSprite(tg,tY)),tg>>=1;return tY},ta.IMAGE=1,ta.ALPHA=2,ta.TRANSFORM=4,ta.BLEND=8,ta.CANVAS=16,ta.FILTERS=32,ta.MASK=64,ta.CLIP=128,ta.STYLE=256,ta.GRAPHICS=512,ta.CUSTOM=1024,ta.CHILDS=2048,ta.INIT=69905,ta.renders=[],ta.NORENDER=new ta(0,null),ta}(),tv=function(){function tW(){this._repaint=!1}tJ(tW,"laya.resource.Context");var tD=tW.prototype;return tD.replaceReset=function(){var tD,tY,tg=0;for(tD=tW.replaceKeys.length,tg=0;tg<tD;tg++)tY=tW.replaceKeys[tg],this[tW.newKeys[tg]]=this[tY]},tD.replaceResotre=function(){this.__restore(),this.__reset()},tD.setIsMainContext=function(){},tD.drawTextures=function(tD,tY,tg,tT){to.drawCall+=tY.length/2;for(var tr=tD.width,ts=tD.height,ta=0,tW=tY.length;ta<tW;ta+=2)this.drawTexture(tD,tY[ta],tY[ta+1],tr,ts,tg,tT)},tD.drawCanvas=function(tD,tY,tg,tT,tr){to.drawCall++,this.drawImage(tD.source,tY,tg,tT,tr)},tD.fillRect=function(tD,tY,tg,tT,tr){to.drawCall++,tr&&(this.fillStyle=tr),this.__fillRect(tD,tY,tg,tT)},tD.fillText=function(tD,tY,tg,tT,tr,ts){to.drawCall++,3<arguments.length&&null!=tT&&(this.font=tT,this.fillStyle=tr,this.textAlign=ts,this.textBaseline="top"),this.__fillText(tD,tY,tg)},tD.fillBorderText=function(tD,tY,tg,tT,tr,ts,ta,tW){to.drawCall++,this.font=tT,this.fillStyle=tr,this.textBaseline="top",this.strokeStyle=ts,this.lineWidth=ta,this.textAlign=tW,this.__strokeText(tD,tY,tg),this.__fillText(tD,tY,tg)},tD.strokeText=function(tD,tY,tg,tT,tr,ts,ta){to.drawCall++,3<arguments.length&&null!=tT&&(this.font=tT,this.strokeStyle=tr,this.lineWidth=ts,this.textAlign=ta,this.textBaseline="top"),this.__strokeText(tD,tY,tg)},tD.transformByMatrix=function(tD){this.transform(tD.a,tD.b,tD.c,tD.d,tD.tx,tD.ty)},tD.setTransformByMatrix=function(tD){this.setTransform(tD.a,tD.b,tD.c,tD.d,tD.tx,tD.ty)},tD.clipRect=function(tD,tY,tg,tT){to.drawCall++,this.beginPath(),this.rect(tD,tY,tg,tT),this.clip()},tD.drawTexture=function(tD,tY,tg,tT,tr,ts,ta){to.drawCall++;var tW=tD.uv,tM=tD.bitmap.width,tE=tD.bitmap.height;this.drawImage(tD.source,tW[0]*tM,tW[1]*tE,(tW[2]-tW[0])*tM,(tW[5]-tW[3])*tE,tY+ts,tg+ta,tT,tr)},tD.drawTextureWithTransform=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){to.drawCall++;var tE=tD.uv,tI=tD.bitmap.width,tO=tD.bitmap.height;this.save(),1!=tM&&(this.globalAlpha*=tM),ts?(this.transform(ts.a,ts.b,ts.c,ts.d,ts.tx+ta,ts.ty+tW),this.drawImage(tD.source,tE[0]*tI,tE[1]*tO,(tE[2]-tE[0])*tI,(tE[5]-tE[3])*tO,tY,tg,tT,tr)):this.drawImage(tD.source,tE[0]*tI,tE[1]*tO,(tE[2]-tE[0])*tI,(tE[5]-tE[3])*tO,tY+ta,tg+tW,tT,tr),this.restore()},tD.drawTexture2=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=tW[0];if(tM.loaded&&tM.bitmap&&tM.source){to.drawCall++;var tE=1!==ts;if(tE){var tI=this.globalAlpha;this.globalAlpha*=ts}var tO=tM.uv,tC=tM.bitmap.width,tN=tM.bitmap.height;tr?(this.save(),this.transform(tr.a,tr.b,tr.c,tr.d,tr.tx+tD,tr.ty+tY),this.drawImage(tM.source,tO[0]*tC,tO[1]*tN,(tO[2]-tO[0])*tC,(tO[5]-tO[3])*tN,tW[1]-tg,tW[2]-tT,tW[3],tW[4]),this.restore()):this.drawImage(tM.source,tO[0]*tC,tO[1]*tN,(tO[2]-tO[0])*tC,(tO[5]-tO[3])*tN,tW[1]-tg+tD,tW[2]-tT+tY,tW[3],tW[4]),tE&&(this.globalAlpha=tI)}},tD.fillTexture=function(tD,tY,tg,tT,tr,ts,ta,tW){if(!tW.pat){if(tD.uv!=tID.DEF_UV){var tM=new tZD("2D");tM.getContext("2d"),tM.size(tD.width,tD.height),tM.context.drawTexture(tD,0,0,tD.width,tD.height,0,0),tD=new tID(tM)}tW.pat=this.createPattern(tD.bitmap.source,ts)}var tE=tY,tI=tg,tO=0,tC=0;ta&&(tE+=ta.x%tD.width,tI+=ta.y%tD.height,tO-=ta.x%tD.width,tC-=ta.y%tD.height),this.translate(tE,tI),this.fillRect(tO,tC,tT,tr,tW.pat),this.translate(-tE,-tI)},tD.drawTriangle=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=tD.bitmap,tE=tM.source,tI=tD.width,tO=tD.height,tC=tM.width,tN=tM.height,t$=tg[tT]*tC,td=tg[tr]*tC,tJ=tg[ts]*tC,tx=tg[tT+1]*tN,tj=tg[tr+1]*tN,tZ=tg[ts+1]*tN,tp=tY[tT],tl=tY[tr],tt=tY[ts],t_=tY[tT+1],tA=tY[tr+1],tq=tY[ts+1];if(tW){var tb=(tp+tl+tt)/3,tG=(t_+tA+tq)/3,tX=tp-tb,tz=t_-tG,tm=Math.sqrt(tX*tX+tz*tz);tp=tb+tX/tm*(tm+1),t_=tG+tz/tm*(tm+1),tz=tA-tG,tl=tb+(tX=tl-tb)/(tm=Math.sqrt(tX*tX+tz*tz))*(tm+1),tA=tG+tz/tm*(tm+1),tz=tq-tG,tt=tb+(tX=tt-tb)/(tm=Math.sqrt(tX*tX+tz*tz))*(tm+1),tq=tG+tz/tm*(tm+1)}this.save(),ta&&this.transform(ta.a,ta.b,ta.c,ta.d,ta.tx,ta.ty),this.beginPath(),this.moveTo(tp,t_),this.lineTo(tl,tA),this.lineTo(tt,tq),this.closePath(),this.clip();var th=1/(t$*tj+tx*tJ+td*tZ-tj*tJ-tx*td-t$*tZ),ti=tp*tj+tx*tt+tl*tZ-tj*tt-tx*tl-tp*tZ,tP=t$*tl+tp*tJ+td*tt-tl*tJ-tp*td-t$*tt,tB=t$*tj*tt+tx*tl*tJ+tp*td*tZ-tp*tj*tJ-tx*td*tt-t$*tl*tZ,tH=t_*tj+tx*tq+tA*tZ-tj*tq-tx*tA-t_*tZ,tv=t$*tA+t_*tJ+td*tq-tA*tJ-t_*td-t$*tq,tS=t$*tj*tq+tx*tA*tJ+t_*td*tZ-t_*tj*tJ-tx*td*tq-t$*tA*tZ;this.transform(ti*th,tH*th,tP*th,tv*th,tB*th,tS*th),this.drawImage(tE,tD.uv[0]*tC,tD.uv[1]*tN,tI,tO,tD.uv[0]*tC,tD.uv[1]*tN,tI,tO),this.restore()},tD.flush=function(){return 0},tD.fillWords=function(tD,tY,tg,tT,tr,ts){tT&&(this.font=tT),tr&&(this.fillStyle=tr);this.textBaseline="top",this.textAlign="left";for(var ta=0,tW=tD.length;ta<tW;ta++){var tM=tD[ta];if(this.__fillText(tM.char,tM.x+tY,tM.y+tg),1===ts){var tE=tM.height,tI=.5*tM.style.letterSpacing;tI||(tI=0),this.beginPath(),this.strokeStyle=tr,this.lineWidth=1,this.moveTo(tY+tM.x-tI+.5,tg+tM.y+tE+.5),this.lineTo(tY+tM.x+tM.width+tI+.5,tg+tM.y+tE+.5),this.stroke()}}},tD.fillBorderWords=function(tD,tY,tg,tT,tr,ts,ta){tT&&(this.font=tT),tr&&(this.fillStyle=tr),this.textBaseline="top",this.lineWidth=ta,this.textAlign="left",this.strokeStyle=ts;for(var tW=0,tM=tD.length;tW<tM;tW++){var tE=tD[tW];this.__strokeText(tE.char,tE.x+tY,tE.y+tg),this.__fillText(tE.char,tE.x+tY,tE.y+tg)}},tD.destroy=function(){this.canvas.width=this.canvas.height=0},tD.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},tD.drawCurves=function(tD,tY,tg){this.beginPath(),this.strokeStyle=tg[3],this.lineWidth=tg[4];var tT=tg[2];tD+=tg[0],tY+=tg[1],this.moveTo(tD+tT[0],tY+tT[1]);for(var tr=2,ts=tT.length;tr<ts;)this.quadraticCurveTo(tD+tT[tr++],tY+tT[tr++],tD+tT[tr++],tY+tT[tr++]);this.stroke()},tW.__init__=function(tY){var tg=laya.resource.Context.prototype;if(!(tY=tY||CanvasRenderingContext2D.prototype).inited){tY.inited=!0,tY.__fillText=tY.fillText,tY.__fillRect=tY.fillRect,tY.__strokeText=tY.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(tD){tY[tD]=tg[tD]})}},tW.replaceCanvasGetSet=function(tD,tY){var tg=Object.getOwnPropertyDescriptor(tD,tY);if(!tg||!tg.configurable)return!1;var tT,tr={};for(tT in tg)"set"!=tT&&(tr[tT]=tg[tT]);var ts=tg.set;return tr.set=function(tD){ts.call(this,tD);var tY=this.getContext("2d");tY&&"__reset"in tY&&tY.__reset()},Object.defineProperty(tD,tY,tr),!0},tW.replaceGetSet=function(tD,tY){var tg=Object.getOwnPropertyDescriptor(tD,tY);if(!tg||!tg.configurable)return!1;var tT,tr={};for(tT in tg)"set"!=tT&&(tr[tT]=tg[tT]);var ts=tg.set,ta="___"+tY+"__";return tW.newKeys.push(ta),tr.set=function(tD){tD!=this[ta]&&(this[ta]=tD,ts.call(this,tD))},Object.defineProperty(tD,tY,tr),!0},tW._default=new tW,tW.newKeys=[],ta(tW,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),tW}(),tS=function(){function ts(tD){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++ts._uniqueIDCounter,this._name=tD||"Content Manager",ts._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,ts._resourceManagers.push(this),this._resources=[],this._records={}}tJ(ts,"laya.resource.ResourceManager");var tD=ts.prototype;return t_.imps(tD,{"laya.resource.IDispose":!0}),tD.getResourceByIndex=function(tD){return this._resources[tD]},tD.getResourcesLength=function(){return this._resources.length},tD.addResource=function(tD){return tD.resourceManager&&tD.resourceManager.removeResource(tD),-1===this._resources.indexOf(tD)&&((tD._resourceManager=this)._resources.push(tD),this.addRecord(tD.uri,tD.__className,tD.memorySize),this.addSize(tD.memorySize),!0)},tD.removeResource=function(tD){var tY=this._resources.indexOf(tD);return-1!==tY&&(this._resources.splice(tY,1),tD._resourceManager=null,this._memorySize-=tD.memorySize,this.addRecord(tD.uri,tD.__className,-tD.memorySize),!0)},tD.unload=function(){for(var tD=this._resources.slice(0,this._resources.length),tY=0;tY<tD.length;tY++){tD[tY].destroy()}tD.length=0},tD.dispose=function(){if(this===ts._systemResourceManager)throw new Error("systemResourceManager不能被释放！");ts._resourceManagers.splice(ts._resourceManagers.indexOf(this),1),ts._isResourceManagersSorted=!1;for(var tD=this._resources.slice(0,this._resources.length),tY=0;tY<tD.length;tY++){var tg=tD[tY];tg.resourceManager.removeResource(tg),tg.destroy()}tD.length=0},tD.addSize=function(tD){tD&&(this.autoRelease&&0<tD&&this._memorySize+tD>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=tD)},tD.addRecord=function(tD,tY,tg){DEBUG&&tg&&!tD&&console.error(tD,tY,tg)},tD.garbageCollection=function(tD){var tY=this._resources;(tY=tY.slice()).sort(function(tD,tY){if(!tD||!tY)throw new Error("a或b不能为空！");return tD.released&&tY.released?0:tD.released?1:tY.released?-1:tD._lastUseFrameCount-tY._lastUseFrameCount});for(var tg=to.loopCount,tT=0,tr=tY.length;tT<tr;tT++){var ts=tY[tT];if(!(1<tg-ts._lastUseFrameCount))return void(this._memorySize>=tD&&(this._isOverflow=!0));if(ts.releaseResource(),this._memorySize<tD)return void(this._isOverflow=!1)}},tI(0,tD,"id",function(){return this._id}),tI(0,tD,"name",function(){return this._name},function(tD){!tD&&""===tD||this._name===tD||(this._name=tD,ts._isResourceManagersSorted=!1)}),tI(0,tD,"memorySize",function(){return this._memorySize}),tI(0,tD,"records",function(){return this._records}),tI(1,ts,"systemResourceManager",function(){return ts._systemResourceManager}),ts.__init__=function(){ts.currentResourceManager=ts.systemResourceManager},ts.getLoadedResourceManagerByIndex=function(tD){return ts._resourceManagers[tD]},ts.getLoadedResourceManagersCount=function(){return ts._resourceManagers.length},ts.recreateContentManagers=function(tD){void 0===tD&&(tD=!1);for(var tY=ts.currentResourceManager,tg=0;tg<ts._resourceManagers.length;tg++){ts.currentResourceManager=ts._resourceManagers[tg];for(var tT=0;tT<ts.currentResourceManager._resources.length;tT++)ts.currentResourceManager._resources[tT].releaseResource(tD),ts.currentResourceManager._resources[tT].activeResource(tD)}ts.currentResourceManager=tY},ts.releaseContentManagers=function(tD){void 0===tD&&(tD=!1);for(var tY=ts.currentResourceManager,tg=0;tg<ts._resourceManagers.length;tg++){ts.currentResourceManager=ts._resourceManagers[tg];for(var tT=0;tT<ts.currentResourceManager._resources.length;tT++){var tr=ts.currentResourceManager._resources[tT];!tr.released&&tr.releaseResource(tD)}}ts.currentResourceManager=tY},ts._uniqueIDCounter=0,ts._isResourceManagersSorted=!1,ts._resourceManagers=[],ta(ts,["_systemResourceManager",function(){return this._systemResourceManager=new ts("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=ts._systemResourceManager}]),ts}(),tU=(function(){function tD(){}tJ(tD,"laya.system.System"),tD.changeDefinition=function(tD,tY){t_[tD]=tY;var tg=tD+"=classObj";t_._runScript(tg)},tD.__init__=function(){tP.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function tg(){}return tJ(tg,"laya.utils.Browser"),tI(1,tg,"pixelRatio",function(){return tg.__init__(),-1<tg.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:tz.getPixelRatio()}),tI(1,tg,"height",function(){return tg.__init__(),(t_.stage&&t_.stage.canvasRotation?tg.clientWidth:tg.clientHeight)*tg.pixelRatio}),tI(1,tg,"clientWidth",function(){return tg.__init__(),tg.window.innerWidth||tg.document.body.clientWidth}),tI(1,tg,"window",function(){return tg.__init__(),tg._window}),tI(1,tg,"clientHeight",function(){return tg.__init__(),tg.window.innerHeight||tg.document.body.clientHeight||tg.document.documentElement.clientHeight}),tI(1,tg,"width",function(){return tg.__init__(),(t_.stage&&t_.stage.canvasRotation?tg.clientHeight:tg.clientWidth)*tg.pixelRatio}),tI(1,tg,"container",function(){return tg.__init__(),tg._container||((tg._container=tg.createElement("div")).id="layaContainer",tg.document.body.appendChild(tg._container)),tg._container},function(tD){tg._container=tD}),tI(1,tg,"document",function(){return tg.__init__(),tg._document}),tg.__init__=function(){if(!tg._window){tg._window=tz.getWindow(),tg._document=tg.window.document,tg._window.addEventListener("message",function(tD){laya.utils.Browser._onMessage(tD)},!1),tg.document.__createElement=tg.document.createElement,tN.requestAnimationFrame=tN.requestAnimationFrame||tN.webkitRequestAnimationFrame||tN.mozRequestAnimationFrame||tN.oRequestAnimationFrame||tN.msRequestAnimationFrame||function(tD){return tN.setTimeout(tD,1e3/60)};var tD=tN.document.body.style;tD["-webkit-user-select"]="none",tD["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",tg.userAgent=tg.window.navigator.userAgent,tg.onIOS=!!(tg.u=tg.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),tg.onMobile=-1<tg.u.indexOf("Mobile"),tg.onIPhone=-1<tg.u.indexOf("iPhone"),tg.onMac=-1<tg.u.indexOf("Mac OS X"),tg.onIPad=-1<tg.u.indexOf("iPad"),tg.onAndroid=-1<tg.u.indexOf("Android")||-1<tg.u.indexOf("Adr"),tg.onWP=-1<tg.u.indexOf("Windows Phone"),tg.onQQBrowser=-1<tg.u.indexOf("QQBrowser"),tg.onMQQBrowser=-1<tg.u.indexOf("MQQBrowser")||-1<tg.u.indexOf("Mobile")&&-1<tg.u.indexOf("QQ"),tg.onIE=!!tg.window.ActiveXObject||"ActiveXObject"in tg.window,tg.onWeiXin=-1<tg.u.indexOf("MicroMessenger"),tg.onPC=!tg.onMobile,tg.onSafari=-1<tg.u.indexOf("Safari"),tg.onFirefox=-1<tg.u.indexOf("Firefox"),tg.onEdge=-1<tg.u.indexOf("Edge"),tg.onMiniGame=-1<tg.u.indexOf("MiniGame"),tg.onLimixiu=-1<tg.u.indexOf("limixiu"),tg.httpProtocol="http:"==tg.window.location.protocol,tg.onMiniGame&&null==tg.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),tg.webAudioEnabled=!!(tg.window.AudioContext||tg.window.webkitAudioContext||tg.window.mozAudioContext),tg.soundType=tg.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",trD=tg.webAudioEnabled?tsD:tgD,tg.webAudioEnabled&&tsD.initWebAudio(),tgD._initMusicAudio(),tg.enableTouch="ontouchstart"in tN||tN.DocumentTouch&&tY instanceof DocumentTouch,tN.focus(),tX._soundClass=trD,tX._musicClass=tgD,tP._mainCanvas=tP._mainCanvas||tZD.create("2D"),tg.canvas||(tg.canvas=tZD.create("2D"),tg.context=tg.canvas.getContext("2d"))}},tg._onMessage=function(tD){if(tD.data&&"size"==tD.data.name){if(tg.window.innerWidth=tD.data.width,tg.window.innerHeight=tD.data.height,tg.window.__innerHeight=tD.data.clientHeight,!tg.document.createEvent)return void console.warn("no document.createEvent");var tY=tg.document.createEvent("HTMLEvents");return tY.initEvent("resize",!1,!1),void tg.window.dispatchEvent(tY)}},tg.createElement=function(tD){return tg.__init__(),tg.document.__createElement(tD)},tg.getElementById=function(tD){return tg.__init__(),tg.document.getElementById(tD)},tg.removeElement=function(tD){tD&&tD.parentNode&&tD.parentNode.removeChild(tD)},tg.now=function(){return tz.now()},tg._window=null,tg._document=null,tg._container=null,tg.userAgent=null,tg.u=null,tg.onIOS=!1,tg.onMac=!1,tg.onMobile=!1,tg.onIPhone=!1,tg.onIPad=!1,tg.onAndroid=!1,tg.onWP=!1,tg.onQQBrowser=!1,tg.onMQQBrowser=!1,tg.onSafari=!1,tg.onFirefox=!1,tg.onEdge=!1,tg.onIE=!1,tg.onWeiXin=!1,tg.onMiniGame=!1,tg.onLimixiu=!1,tg.onPC=!1,tg.httpProtocol=!1,tg.webAudioEnabled=!1,tg.soundType=null,tg.enableTouch=!1,tg.canvas=null,tg.context=null,tg.__init$=function(){},tg}()),tF=function(){function tY(tD){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,tD?(this._u8d_=new Uint8Array(tD),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}tJ(tY,"laya.utils.Byte");var tD=tY.prototype;return tD.___resizeBuffer=function(tY){try{var tD=new Uint8Array(tY);null!=this._u8d_&&(this._u8d_.length<=tY?tD.set(this._u8d_):tD.set(this._u8d_.subarray(0,tY))),this._u8d_=tD,this._d_=new DataView(tD.buffer)}catch(tD){throw"___resizeBuffer err:"+tY}},tD.getString=function(){return this.rUTF(this.getUint16())},tD.getFloat32Array=function(tD,tY){var tg=tD+tY;tg=tg>this._length?this._length:tg;var tT=new Float32Array(this._d_.buffer.slice(tD,tg));return this._pos_=tg,tT},tD.getUint8Array=function(tD,tY){var tg=tD+tY;tg=tg>this._length?this._length:tg;var tT=new Uint8Array(this._d_.buffer.slice(tD,tg));return this._pos_=tg,tT},tD.getInt16Array=function(tD,tY){var tg=tD+tY;tg=tg>this._length?this._length:tg;var tT=new Int16Array(this._d_.buffer.slice(tD,tg));return this._pos_=tg,tT},tD.getFloat32=function(){if(this._pos_+4>this._length)throw new Error("getFloat32 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var tD=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,tD},tD.getFloat64=function(){if(this._pos_+8>this._length)throw new Error("getFloat64 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var tD=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,tD},tD.writeFloat32=function(tD){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,tD,this._xd_),this._pos_+=4},tD.writeFloat64=function(tD){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,tD,this._xd_),this._pos_+=8},tD.getInt32=function(){if(this._pos_+4>this._length)throw new Error("getInt32 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var tD=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,tD},tD.getUint32=function(){if(this._pos_+4>this._length)throw new Error("getUint32 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var tD=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,tD},tD.writeInt32=function(tD){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,tD,this._xd_),this._pos_+=4},tD.writeUint32=function(tD){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,tD,this._xd_),this._pos_+=4},tD.getInt16=function(){if(this._pos_+2>this._length)throw new Error("getInt16 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var tD=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,tD},tD.getUint16=function(){if(this._pos_+2>this._length)throw new Error("getUint16 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var tD=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,tD},tD.writeUint16=function(tD){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,tD,this._xd_),this._pos_+=2},tD.writeInt16=function(tD){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,tD,this._xd_),this._pos_+=2},tD.getUint8=function(){if(this._pos_+1>this._length)throw new Error("getUint8 error - Out of bounds, pos="+this._pos_+"， length="+this._length);return this._d_.getUint8(this._pos_++)},tD.writeUint8=function(tD){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,tD),this._pos_++},tD._getUInt8=function(tD){return this._d_.getUint8(tD)},tD._getUint16=function(tD){return this._d_.getUint16(tD,this._xd_)},tD._getMatrix=function(){return new tm(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},tD.rUTF=function(tD){for(var tY=[],tg=this._pos_+tD,tT=0,tr=0,ts=0,ta=String.fromCharCode,tW=this._u8d_;this._pos_<tg;)(tT=tW[this._pos_++])<128?0!=tT&&tY.push(ta(tT)):tT<224?tY.push(ta((63&tT)<<6|127&tW[this._pos_++])):tT<240?(tr=tW[this._pos_++],tY.push(ta((31&tT)<<12|(127&tr)<<6|127&tW[this._pos_++]))):(tr=tW[this._pos_++],ts=tW[this._pos_++],tY.push(ta((15&tT)<<18|(127&tr)<<12|ts<<6&127|127&tW[this._pos_++]))),0;return tY.join("")},tD.getCustomString=function(tD){for(var tY=[],tg=0,tT=0,tr=0,ts=String.fromCharCode,ta=this._u8d_;0<tD;)if((tT=ta[this._pos_])<128)tY.push(ts(tT)),this._pos_++,tD--;else for(tg=tT-128,this._pos_++,tD-=tg;0<tg;)tT=ta[this._pos_++],tr=ta[this._pos_++],tY.push(ts(tr<<8|tT)),tg--;return tY.join("")},tD.clear=function(){this._pos_=0,this.length=0},tD.__getBuffer=function(){return this._d_.buffer},tD.writeUTFBytes=function(tD){for(var tY=0,tg=(tD+="").length;tY<tg;tY++){var tT=tD.charCodeAt(tY);tT<=127?this.writeByte(tT):tT<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|tT>>6,128|63&tT],this._pos_),this._pos_+=2):tT<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|tT>>12,128|tT>>6&63,128|63&tT],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|tT>>18,128|tT>>12&63,128|tT>>6&63,128|63&tT],this._pos_),this._pos_+=4)}},tD.writeUTFString=function(tD){var tY=this.pos;this.writeUint16(1),this.writeUTFBytes(tD);var tg=this.pos-tY-2;if(65536<=tg)throw new Error("writeUTFString byte len more than 65536");this._d_.setUint16(tY,tg,this._xd_)},tD.readUTFString=function(){return this.readUTFBytes(this.getUint16())},tD.getUTFString=function(){return this.readUTFString()},tD.readUTFBytes=function(tD){if(void 0===tD&&(tD=-1),0==tD)return"";var tY=this.bytesAvailable;if(tY<tD)throw new Error("readUTFBytes error - Out of bounds, pos="+this._pos_+"， length="+this._length);return tD=0<tD?tD:tY,this.rUTF(tD)},tD.getUTFBytes=function(tD){return void 0===tD&&(tD=-1),this.readUTFBytes(tD)},tD.writeByte=function(tD){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,tD),this._pos_+=1},tD.readByte=function(){if(this._pos_+1>this._length)throw new Error("readByte error - Out of bounds, pos="+this._pos_+"， length="+this._length);return this._d_.getInt8(this._pos_++)},tD.getByte=function(){return this.readByte()},tD.ensureWrite=function(tD){this._length<tD&&(this._length=tD),this._allocated_<tD&&(this.length=tD)},tD.writeArrayBuffer=function(tD,tY,tg){if(void 0===tY&&(tY=0),void 0===tg&&(tg=0),tY<0||tg<0)throw new Error("writeArrayBuffer error - Out of bounds");0==tg&&(tg=tD.byteLength-tY),this.ensureWrite(this._pos_+tg);var tT=new Uint8Array(tD);this._u8d_.set(tT.subarray(tY,tY+tg),this._pos_),this._pos_+=tg},tI(0,tD,"buffer",function(){var tD=this._d_.buffer;return tD.byteLength==this.length?tD:tD.slice(0,this.length)}),tI(0,tD,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(tD){this._xd_="littleEndian"==tD}),tI(0,tD,"length",function(){return this._length},function(tD){this._allocated_<tD?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(tD,2*this._allocated_))):this._allocated_>tD&&this.___resizeBuffer(this._allocated_=tD),this._length=tD}),tI(0,tD,"pos",function(){return this._pos_},function(tD){this._pos_=tD}),tI(0,tD,"bytesAvailable",function(){return this._length-this._pos_}),tY.getSystemEndian=function(){if(!tY._sysEndian){var tD=new ArrayBuffer(2);new DataView(tD).setInt16(0,256,!0),tY._sysEndian=256===new Int16Array(tD)[0]?"littleEndian":"bigEndian"}return tY._sysEndian},tY.BIG_ENDIAN="bigEndian",tY.LITTLE_ENDIAN="littleEndian",tY._sysEndian=null,tY}(),tV=function(){function tr(){}return tJ(tr,"laya.utils.CacheManager"),tr.regCacheByFunction=function(tD,tY){var tg;tr.unRegCacheByFunction(tD,tY),tg={tryDispose:tD,getCacheList:tY},tr._cacheList.push(tg)},tr.unRegCacheByFunction=function(tD,tY){var tg,tT=0;for(tg=tr._cacheList.length,tT=0;tT<tg;tT++)if(tr._cacheList[tT].tryDispose==tD&&tr._cacheList[tT].getCacheList==tY)return void tr._cacheList.splice(tT,1)},tr.forceDispose=function(){var tD=0,tY=tr._cacheList.length;for(tD=0;tD<tY;tD++)tr._cacheList[tD].tryDispose(!0)},tr.beginCheck=function(tD){void 0===tD&&(tD=15e3),t_.timer.loop(tD,null,tr._checkLoop)},tr.stopCheck=function(){t_.timer.clear(null,tr._checkLoop)},tr._checkLoop=function(){var tD=tr._cacheList;if(!(tD.length<1)){var tY,tg=tU.now(),tT=0;for(tY=tT=tD.length;0<tT&&(tD[tr._index=++tr._index%tY].tryDispose(!1),!(tU.now()-tg>tr.loopTimeLimit));)tT--}},tr.loopTimeLimit=2,tr._cacheList=[],tr._index=0,tr}(),tc=function(){function tN(){}return tJ(tN,"laya.utils.ClassUtils"),tN.regClass=function(tD,tY){tN._classMap[tD]=tY},tN.getRegClass=function(tD){return tN._classMap[tD]},tN.getInstance=function(tD){var tY=tN.getClass(tD);return tY?new tY:(console.warn("[error] Undefined class:",tD),null)},tN.createByJson=function(tD,tY,tg,tT,tr){"string"==typeof tD&&(tD=JSON.parse(tD));var ts=tD.props;if(!tY&&!(tY=tr?tr.runWith(tD):tN.getInstance(ts.runtime||tD.type)))return null;var ta=tD.child;if(ta)for(var tW=0,tM=ta.length;tW<tM;tW++){var tE=ta[tW];if("render"!==tE.props.name&&"render"!==tE.props.renderType||!tY._$set_itemRender)if("Graphic"==tE.type)tN.addGraphicsToSprite(tE,tY);else if(tN.isDrawType(tE.type))tN.addGraphicToSprite(tE,tY,!0);else{var tI=tN.createByJson(tE,null,tg,tT,tr);"Script"==tE.type?tI.hasOwnProperty("owner")?tI.owner=tY:tI.hasOwnProperty("target")&&(tI.target=tY):"mask"==tE.props.renderType?tY.mask=tI:tY.addChild(tI)}else tY.itemRender=tE}if(ts)for(var tO in ts){var tC=ts[tO];"var"===tO&&tg?tg[tC]=tY:tC instanceof Array&&"function"==typeof tY[tO]?tY[tO].apply(tY,tC):tY[tO]=tC}return tT&&tD.customProps&&tT.runWith([tY,tD]),tY.created&&tY.created(),tY},tN.addGraphicsToSprite=function(tD,tY){var tg;if((tg=tD.child)&&!(tg.length<1)){var tT;tT=tN._getGraphicsFromSprite(tD,tY);var tr=0,ts=0;tD.props&&(tr=tN._getObjVar(tD.props,"x",0),ts=tN._getObjVar(tD.props,"y",0)),0!=tr&&0!=ts&&tT.translate(tr,ts);var ta,tW=0;for(ta=tg.length,tW=0;tW<ta;tW++)tN._addGraphicToGraphics(tg[tW],tT);0!=tr&&0!=ts&&tT.translate(-tr,-ts)}},tN.addGraphicToSprite=function(tD,tY,tg){var tT;void 0===tg&&(tg=!1),tT=tg?tN._getGraphicsFromSprite(tD,tY):tY.graphics,tN._addGraphicToGraphics(tD,tT)},tN._getGraphicsFromSprite=function(tD,tY){var tg,tT;if(!tD||!tD.props)return tY.graphics;switch(tT=tD.props.renderType){case"hit":case"unHit":var tr;tY.hitArea||(tY.hitArea=new tw),(tr=tY.hitArea)[tT]||(tr[tT]=new tC),tg=tr[tT]}return tg||(tg=tY.graphics),tg},tN._getTransformData=function(tD){var tY;(tD.hasOwnProperty("pivotX")||tD.hasOwnProperty("pivotY"))&&(tY=tY||new tm).translate(-tN._getObjVar(tD,"pivotX",0),-tN._getObjVar(tD,"pivotY",0));var tg=tN._getObjVar(tD,"scaleX",1),tT=tN._getObjVar(tD,"scaleY",1),tr=tN._getObjVar(tD,"rotation",0);tN._getObjVar(tD,"skewX",0),tN._getObjVar(tD,"skewY",0);return 1==tg&&1==tT&&0==tr||((tY=tY||new tm).scale(tg,tT),tY.rotate(.0174532922222222*tr)),tY},tN._addGraphicToGraphics=function(tD,tY){var tg,tT;if((tg=tD.props)&&(tT=tN.DrawTypeDic[tD.type])){var tr,ts;tr=tY;var ta=tN._getParams(tg,tT[1],tT[2],tT[3]);((ts=tN._tM)||1!=tN._alpha)&&(tr.save(),ts&&tr.transform(ts),1!=tN._alpha&&tr.alpha(tN._alpha)),tr[tT[0]].apply(tr,ta),(ts||1!=tN._alpha)&&tr.restore()}},tN._adptLineData=function(tD){return tD[2]=parseFloat(tD[0])+parseFloat(tD[2]),tD[3]=parseFloat(tD[1])+parseFloat(tD[3]),tD},tN._adptTextureData=function(tD){return tD[0]=tWD.getRes(tD[0]),tD},tN._adptLinesData=function(tD){return tD[2]=tN._getPointListByStr(tD[2]),tD},tN.isDrawType=function(tD){return"Image"!=tD&&tN.DrawTypeDic.hasOwnProperty(tD)},tN._getParams=function(tD,tY,tg,tT){var tr;void 0===tg&&(tg=0),(tr=tN._temParam).length=tY.length;var ts,ta,tW=0;for(ts=tY.length,tW=0;tW<ts;tW++)tr[tW]=tN._getObjVar(tD,tY[tW][0],tY[tW][1]);return tN._alpha=tN._getObjVar(tD,"alpha",1),ta=tN._getTransformData(tD),tN._tM=ta?(tg||(tg=0),ta.translate(tr[tg],tr[tg+1]),tr[tg]=tr[tg+1]=0,ta):null,tT&&tN[tT]&&(tr=tN[tT](tr)),tr},tN._getPointListByStr=function(tD){var tY,tg,tT=0;for(tg=(tY=tD.split(",")).length,tT=0;tT<tg;tT++)tY[tT]=parseFloat(tY[tT]);return tY},tN._getObjVar=function(tD,tY,tg){return tD.hasOwnProperty(tY)?tD[tY]:tg},tN._temParam=[],tN._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},tN.getClass=function(tD){var tY=tN._classMap[tD]||tD;return"string"==typeof tY?t_.__classmap[tY]:tY},tN._tM=null,tN._alpha=NaN,ta(tN,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),tN}(),tf=function(){function ts(tD){if(this._color=[],"string"==typeof tD){null===(this.strColor=tD)&&(tD="#000000"),"#"==tD.charAt(0)&&(tD=tD.substr(1));var tY=tD.length;if(3==tY||4==tY){for(var tg="",tT=0;tT<tY;tT++)tg+=tD[tT]+tD[tT];tD=tg}var tr=this.numColor=parseInt(tD,16);if(8==tD.length)return void(this._color=[parseInt(tD.substr(0,2),16)/255,((16711680&tr)>>16)/255,((65280&tr)>>8)/255,(255&tr)/255])}else tr=this.numColor=tD,this.strColor=tL.toHexColor(tr);this._color=[((16711680&tr)>>16)/255,((65280&tr)>>8)/255,(255&tr)/255,1],this._color.__id=++ts._COLODID}return tJ(ts,"laya.utils.Color"),ts._initDefault=function(){for(var tD in ts._DEFAULT={},ts._COLOR_MAP)ts._SAVE[tD]=ts._DEFAULT[tD]=new ts(ts._COLOR_MAP[tD]);return ts._DEFAULT},ts._initSaveMap=function(){for(var tD in ts._SAVE_SIZE=0,ts._SAVE={},ts._DEFAULT)ts._SAVE[tD]=ts._DEFAULT[tD]},ts.create=function(tD){var tY=ts._SAVE[tD+""];return null!=tY?tY:(ts._SAVE_SIZE<1e3||ts._initSaveMap(),ts._SAVE[tD+""]=new ts(tD))},ts._SAVE={},ts._SAVE_SIZE=0,ts._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},ts._DEFAULT=ts._initDefault(),ts._COLODID=1,ts}(),te=(function(){function tD(){this._values=[],this._keys=[]}tJ(tD,"laya.utils.Dictionary");var tY=tD.prototype;tY.set=function(tD,tY){var tg=this.indexOf(tD);0<=tg?this._values[tg]=tY:(this._keys.push(tD),this._values.push(tY))},tY.indexOf=function(tD){var tY=this._keys.indexOf(tD);return 0<=tY?tY:(tD="string"==typeof tD?Number(tD):"number"==typeof tD?tD.toString():tD,this._keys.indexOf(tD))},tY.get=function(tD){var tY=this.indexOf(tD);return tY<0?null:this._values[tY]},tY.remove=function(tD){var tY=this.indexOf(tD);return 0<=tY&&(this._keys.splice(tY,1),this._values.splice(tY,1),!0)},tY.clear=function(){this._values.length=0,this._keys.length=0},tI(0,tY,"values",function(){return this._values}),tI(0,tY,"keys",function(){return this._keys})}(),function(){function tD(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}tJ(tD,"laya.utils.Dragging");var tY=tD.prototype;return tY.start=function(tD,tY,tg,tT,tr,ts,ta,tW){void 0===tW&&(tW=.92),this.clearTimer(),this.target=tD,this.area=tY,this.hasInertia=tg,this.elasticDistance=tY?tT:0,this.elasticBackTime=tr,this.data=ts,this._disableMouseEvent=ta,this.ratio=tW,1!=tD.globalScaleX||1!=tD.globalScaleY?this._parent=tD.parent:this._parent=t_.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,t_.stage.on("mouseup",this,this.onStageMouseUp),t_.stage.on("mouseout",this,this.onStageMouseUp),t_.timer.frameLoop(1,this,this.loop)},tY.clearTimer=function(){t_.timer.clear(this,this.loop),t_.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},tY.stop=function(){this._dragging&&(t$.instance.disableMouseEvent=!1,t_.stage.off("mouseup",this,this.onStageMouseUp),t_.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},tY.loop=function(){var tD=this._parent.getMousePoint(),tY=tD.x,tg=tD.y,tT=tY-this._lastX,tr=tg-this._lastY;if(this._clickOnly){if(!(1<Math.abs(tT*t_.stage._canvasTransform.getScaleX())||1<Math.abs(tr*t_.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),t$.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(tT,tr);0==tT&&0==tr||(this._lastX=tY,this._lastY=tg,this.target.x+=tT*this._elasticRateX,this.target.y+=tr*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},tY.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var tD=this.area.x-this.target.x;else tD=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-tD/this.elasticDistance),this.target.y<this.area.y)var tY=this.area.y-this.target.y;else tY=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-tY/this.elasticDistance)}},tY.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},tY.onStageMouseUp=function(tD){if(t$.instance.disableMouseEvent=!1,t_.stage.off("mouseup",this,this.onStageMouseUp),t_.stage.off("mouseout",this,this.onStageMouseUp),t_.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var tY=this._offsets.length,tg=Math.min(tY,6),tT=this._offsets.length-tg,tr=tY-1;tT<tr;tr--)this._offsetY+=this._offsets[tr--],this._offsetX+=this._offsets[tr];this._offsetX=this._offsetX/tg*2,this._offsetY=this._offsetY/tg*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),t_.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},tY.checkElastic=function(){var tD=NaN,tY=NaN;if(this.target.x<this.area.x?tD=this.area.x:this.target.x>this.area.x+this.area.width&&(tD=this.area.x+this.area.width),this.target.y<this.area.y?tY=this.area.y:this.target.y>this.area.y+this.area.height&&(tY=this.area.y+this.area.height),isNaN(tD)&&isNaN(tY))this.clear();else{var tg={};isNaN(tD)||(tg.x=tD),isNaN(tY)||(tg.y=tY),this._tween=tQ.to(this.target,tg,this.elasticBackTime,tk.sineOut,tj.create(this,this.clear),0,!1,!1)}},tY.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(t_.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},tY.clear=function(){if(this.target){this.clearTimer();var tD=this.target;this.target=null,this._parent=null,tD.event("dragend",this.data)}},tD}()),tk=function(){function tW(){}return tJ(tW,"laya.utils.Ease"),tW.linearNone=function(tD,tY,tg,tT){return tg*tD/tT+tY},tW.linearIn=function(tD,tY,tg,tT){return tg*tD/tT+tY},tW.linearInOut=function(tD,tY,tg,tT){return tg*tD/tT+tY},tW.linearOut=function(tD,tY,tg,tT){return tg*tD/tT+tY},tW.bounceIn=function(tD,tY,tg,tT){return tg-tW.bounceOut(tT-tD,0,tg,tT)+tY},tW.bounceInOut=function(tD,tY,tg,tT){return tD<.5*tT?.5*tW.bounceIn(2*tD,0,tg,tT)+tY:.5*tW.bounceOut(2*tD-tT,0,tg,tT)+.5*tg+tY},tW.bounceOut=function(tD,tY,tg,tT){return(tD/=tT)<1/2.75?tg*(7.5625*tD*tD)+tY:tD<2/2.75?tg*(7.5625*(tD-=1.5/2.75)*tD+.75)+tY:tD<2.5/2.75?tg*(7.5625*(tD-=2.25/2.75)*tD+.9375)+tY:tg*(7.5625*(tD-=2.625/2.75)*tD+.984375)+tY},tW.backIn=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=1.70158),tg*(tD/=tT)*tD*((tr+1)*tD-tr)+tY},tW.backInOut=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=1.70158),(tD/=.5*tT)<1?.5*tg*(tD*tD*((1+(tr*=1.525))*tD-tr))+tY:tg/2*((tD-=2)*tD*((1+(tr*=1.525))*tD+tr)+2)+tY},tW.backOut=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=1.70158),tg*((tD=tD/tT-1)*tD*((tr+1)*tD+tr)+1)+tY},tW.elasticIn=function(tD,tY,tg,tT,tr,ts){var ta;return void 0===tr&&(tr=0),void 0===ts&&(ts=0),0==tD?tY:1==(tD/=tT)?tY+tg:(ts||(ts=.3*tT),ta=!tr||0<tg&&tr<tg||tg<0&&tr<-tg?(tr=tg,ts/4):ts/tW.PI2*Math.asin(tg/tr),-tr*Math.pow(2,10*(tD-=1))*Math.sin((tD*tT-ta)*tW.PI2/ts)+tY)},tW.elasticInOut=function(tD,tY,tg,tT,tr,ts){var ta;return void 0===tr&&(tr=0),void 0===ts&&(ts=0),0==tD?tY:2==(tD/=.5*tT)?tY+tg:(ts||(ts=tT*(.3*1.5)),ta=!tr||0<tg&&tr<tg||tg<0&&tr<-tg?(tr=tg,ts/4):ts/tW.PI2*Math.asin(tg/tr),tD<1?tr*Math.pow(2,10*(tD-=1))*Math.sin((tD*tT-ta)*tW.PI2/ts)*-.5+tY:tr*Math.pow(2,-10*(tD-=1))*Math.sin((tD*tT-ta)*tW.PI2/ts)*.5+tg+tY)},tW.elasticOut=function(tD,tY,tg,tT,tr,ts){var ta;return void 0===tr&&(tr=0),void 0===ts&&(ts=0),0==tD?tY:1==(tD/=tT)?tY+tg:(ts||(ts=.3*tT),ta=!tr||0<tg&&tr<tg||tg<0&&tr<-tg?(tr=tg,ts/4):ts/tW.PI2*Math.asin(tg/tr),tr*Math.pow(2,-10*tD)*Math.sin((tD*tT-ta)*tW.PI2/ts)+tg+tY)},tW.strongIn=function(tD,tY,tg,tT){return tg*(tD/=tT)*tD*tD*tD*tD+tY},tW.strongInOut=function(tD,tY,tg,tT){return(tD/=.5*tT)<1?.5*tg*tD*tD*tD*tD*tD+tY:.5*tg*((tD-=2)*tD*tD*tD*tD+2)+tY},tW.strongOut=function(tD,tY,tg,tT){return tg*((tD=tD/tT-1)*tD*tD*tD*tD+1)+tY},tW.sineInOut=function(tD,tY,tg,tT){return.5*-tg*(Math.cos(Math.PI*tD/tT)-1)+tY},tW.sineIn=function(tD,tY,tg,tT){return-tg*Math.cos(tD/tT*tW.HALF_PI)+tg+tY},tW.sineOut=function(tD,tY,tg,tT){return tg*Math.sin(tD/tT*tW.HALF_PI)+tY},tW.quintIn=function(tD,tY,tg,tT){return tg*(tD/=tT)*tD*tD*tD*tD+tY},tW.quintInOut=function(tD,tY,tg,tT){return(tD/=.5*tT)<1?.5*tg*tD*tD*tD*tD*tD+tY:.5*tg*((tD-=2)*tD*tD*tD*tD+2)+tY},tW.quintOut=function(tD,tY,tg,tT){return tg*((tD=tD/tT-1)*tD*tD*tD*tD+1)+tY},tW.quartIn=function(tD,tY,tg,tT){return tg*(tD/=tT)*tD*tD*tD+tY},tW.quartInOut=function(tD,tY,tg,tT){return(tD/=.5*tT)<1?.5*tg*tD*tD*tD*tD+tY:.5*-tg*((tD-=2)*tD*tD*tD-2)+tY},tW.quartOut=function(tD,tY,tg,tT){return-tg*((tD=tD/tT-1)*tD*tD*tD-1)+tY},tW.cubicIn=function(tD,tY,tg,tT){return tg*(tD/=tT)*tD*tD+tY},tW.cubicInOut=function(tD,tY,tg,tT){return(tD/=.5*tT)<1?.5*tg*tD*tD*tD+tY:.5*tg*((tD-=2)*tD*tD+2)+tY},tW.cubicOut=function(tD,tY,tg,tT){return tg*((tD=tD/tT-1)*tD*tD+1)+tY},tW.quadIn=function(tD,tY,tg,tT){return tg*(tD/=tT)*tD+tY},tW.quadInOut=function(tD,tY,tg,tT){return(tD/=.5*tT)<1?.5*tg*tD*tD+tY:.5*-tg*(--tD*(tD-2)-1)+tY},tW.quadOut=function(tD,tY,tg,tT){return-tg*(tD/=tT)*(tD-2)+tY},tW.expoIn=function(tD,tY,tg,tT){return 0==tD?tY:tg*Math.pow(2,10*(tD/tT-1))+tY-.001*tg},tW.expoInOut=function(tD,tY,tg,tT){return 0==tD?tY:tD==tT?tY+tg:(tD/=.5*tT)<1?.5*tg*Math.pow(2,10*(tD-1))+tY:.5*tg*(2-Math.pow(2,-10*--tD))+tY},tW.expoOut=function(tD,tY,tg,tT){return tD==tT?tY+tg:tg*(1-Math.pow(2,-10*tD/tT))+tY},tW.circIn=function(tD,tY,tg,tT){return-tg*(Math.sqrt(1-(tD/=tT)*tD)-1)+tY},tW.circInOut=function(tD,tY,tg,tT){return(tD/=.5*tT)<1?.5*-tg*(Math.sqrt(1-tD*tD)-1)+tY:.5*tg*(Math.sqrt(1-(tD-=2)*tD)+1)+tY},tW.circOut=function(tD,tY,tg,tT){return tg*Math.sqrt(1-(tD=tD/tT-1)*tD)+tY},tW.HALF_PI=.5*Math.PI,tW.PI2=2*Math.PI,tW}(),tw=function(){function tO(){this._hit=null,this._unHit=null}tJ(tO,"laya.utils.HitArea");var tD=tO.prototype;return tD.isHit=function(tD,tY){return!!tO.isHitGraphic(tD,tY,this.hit)&&!tO.isHitGraphic(tD,tY,this.unHit)},tD.contains=function(tD,tY){return this.isHit(tD,tY)},tI(0,tD,"hit",function(){return this._hit||(this._hit=new tC),this._hit},function(tD){this._hit=tD}),tI(0,tD,"unHit",function(){return this._unHit||(this._unHit=new tC),this._unHit},function(tD){this._unHit=tD}),tO.isHitGraphic=function(tD,tY,tg){if(!tg)return!1;var tT;if(!(tT=tg.cmds)&&tg._one&&((tT=tO._cmds).length=1,tT[0]=tg._one),!tT)return!1;var tr,ts,ta=0;for(tr=tT.length,ta=0;ta<tr;ta++)if(ts=tT[ta]){var tW=tP._context;switch(ts.callee){case tW._translate:case 6:tD-=ts[0],tY-=ts[1]}if(tO.isHitCmd(tD,tY,ts))return!0}return!1},tO.isHitCmd=function(tD,tY,tg){if(!tg)return!1;var tT=tP._context,tr=!1;switch(tg.callee){case tT._drawRect:case 13:tO._rec.setTo(tg[0],tg[1],tg[2],tg[3]),tr=tO._rec.contains(tD,tY);break;case tT._drawCircle:case tT._fillCircle:case 14:tr=(tD-=tg[0])*tD+(tY-=tg[1])*tY<tg[2]*tg[2];break;case tT._drawPoly:case 18:tD-=tg[0],tY-=tg[1],tr=tO.ptInPolygon(tD,tY,tg[2])}return tr},tO.ptInPolygon=function(tD,tY,tg){var tT;(tT=tO._ptPoint).setTo(tD,tY);var tr,ts=0,ta=NaN,tW=NaN,tM=NaN,tE=NaN;tr=tg.length;for(var tI=0;tI<tr;tI+=2){if(ta=tg[tI],tW=tg[tI+1],tM=tg[(tI+2)%tr],tW!=(tE=tg[(tI+3)%tr]))if(!(tT.y<Math.min(tW,tE)))if(!(tT.y>=Math.max(tW,tE)))(tT.y-tW)*(tM-ta)/(tE-tW)+ta>tT.x&&ts++}return ts%2==1},tO._cmds=[],ta(tO,["_rec",function(){return this._rec=new tq},"_ptPoint",function(){return this._ptPoint=new tA}]),tO}(),tK=(function(){function tr(tD,tY,tg,tT){this.char=tD,this.charNum=tD.charCodeAt(0),this._x=this._y=0,this.width=tY,this.height=tg,this.style=tT,this.isWord=!tr._isWordRegExp.test(tD)}tJ(tr,"laya.utils.HTMLChar");var tD=tr.prototype;t_.imps(tD,{"laya.display.ILayout":!0}),tD.setSprite=function(tD){this._sprite=tD},tD.getSprite=function(){return this._sprite},tD._isChar=function(){return!0},tD._getCSSStyle=function(){return this.style},tI(0,tD,"width",function(){return this._w},function(tD){this._w=tD}),tI(0,tD,"x",function(){return this._x},function(tD){this._sprite&&(this._sprite.x=tD),this._x=tD}),tI(0,tD,"y",function(){return this._y},function(tD){this._sprite&&(this._sprite.y=tD),this._y=tD}),tI(0,tD,"height",function(){return this._h},function(tD){this._h=tD}),tr._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function tY(){}tJ(tY,"laya.utils.Log"),tY.enable=function(){tY._logdiv||(tY._logdiv=tU.window.document.createElement("div"),tU.window.document.body.appendChild(tY._logdiv),tY._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},tY.toggle=function(){var tD=tY._logdiv.style;"1px"==tD.width?tD.width=tD.height="50%":tD.width=tD.height="1px"},tY.print=function(tD){tY._logdiv&&(tY.maxCount<=tY._count&&tY.clear(),tY._count++,tY._logdiv.innerText+=tD+"\n",tY._logdiv.scrollTop=tY._logdiv.scrollHeight)},tY.clear=function(){tY._logdiv.innerText="",tY._count=0},tY._logdiv=null,tY._count=0,tY.maxCount=20}(),function(){function tY(){}tJ(tY,"laya.utils.Mouse"),tI(1,tY,"cursor",function(){return tY._style.cursor},function(tD){tY._style.cursor=tD}),tY.hide=function(){"none"!=tY.cursor&&(tY._preCursor=tY.cursor,tY.cursor="none")},tY.show=function(){"none"==tY.cursor&&(tY.cursor=tY._preCursor?tY._preCursor:"auto")},tY._preCursor=null,ta(tY,["_style",function(){return this._style=tU.document.body.style}])}(),function(){function ts(){}return tJ(ts,"laya.utils.Pool"),ts.getPoolBySign=function(tD){return ts._poolDic[tD]||(ts._poolDic[tD]=[])},ts.clearBySign=function(tD){ts._poolDic[tD]&&(ts._poolDic[tD].length=0)},ts.recover=function(tD,tY){tY.__InPool||(tY.__InPool=!0,ts.getPoolBySign(tD).push(tY))},ts.getItemByClass=function(tD,tY){var tg=ts.getPoolBySign(tD),tT=tg.length?tg.pop():new tY;return tT.__InPool=!1,tT},ts.getItemByCreateFun=function(tD,tY,tg){var tT=ts.getPoolBySign(tD),tr=tT.length?tT.pop():tY.call(tg);return tr.__InPool=!1,tr},ts.getItem=function(tD){var tY=ts.getPoolBySign(tD),tg=tY.length?tY.pop():null;return tg&&(tg.__InPool=!1),tg},ts._poolDic={},ts.InPoolSign="__InPool",ts}()),to=function(){function tM(){}return tJ(tM,"laya.utils.Stat"),tI(1,tM,"onclick",null,function(tD){tM._sp&&tM._sp.on("click",tM._sp,tD),tM._canvas&&(tM._canvas.source.onclick=tD,tM._canvas.source.style.pointerEvents="")}),tM.show=function(tD,tY,tg){if(void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),!tP.isConchApp||tP.isConchWebGL){if(tP.isConchWebGL||tU.onMiniGame||tU.onLimixiu||(tM._useCanvas=!0),tM._show=!0,tM._fpsData.length=60,tM._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},tM._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},tM._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},tM._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},tP.isWebGL)if(tM._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},tP.is3DMode){if(tM._view[0].title="FPS(3D)",tM._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},tM._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},tM._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==tg){var tT=8;tM._view[tT++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},tM._view[tT++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},tM._view[tT++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==tg){tT=8;tM._view[tT++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},tM._view[tT++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},tM._view[tT++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},tM._view[tT++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},tM._view[tT++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},tM._view[tT++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},tM._view[tT++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else tM._view[0].title="FPS(WebGL)",tM._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else tM._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};tM._useCanvas?tM.createUIPre(tD,tY):tM.createUI(tD,tY),tM.enable()}else tU.window.conch.showFPS&&tU.window.conch.showFPS(tD,tY)},tM.createUIPre=function(tD,tY){var tg=tU.pixelRatio;tM._width=170*tg,tM._vx=75*tg,tM._height=tg*(12*tM._view.length+3*tg)+4,tM._fontSize=12*tg;for(var tT=0;tT<tM._view.length;tT++)tM._view[tT].x=4,tM._view[tT].y=tT*tM._fontSize+2*tg;tM._canvas||((tM._canvas=new tZD("2D")).size(tM._width,tM._height),(tM._ctx=tM._canvas.getContext("2d")).textBaseline="top",tM._ctx.font=tM._fontSize+"px Sans-serif",tM._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+tD+"px;top:"+tY+"px;width:"+tM._width/tg+"px;height:"+tM._height/tg+"px;"),tM._first=!0,tM.loop(),tM._first=!1,tU.container.appendChild(tM._canvas.source)},tM.createUI=function(tD,tY){var tg=tM._sp,tT=tU.pixelRatio;tg||(tg=new tOD,(tM._leftText=new tJD).pos(5,5),tM._leftText.color="#ffffff",tg.addChild(tM._leftText),(tM._txt=new tJD).pos(80*tT,5),tM._txt.color="#ffffff",tg.addChild(tM._txt),tM._sp=tg),tg.pos(tD,tY);for(var tr="",ts=0;ts<tM._view.length;ts++){tr+=tM._view[ts].title+"\n"}tM._leftText.text=tr;var ta=170*tT,tW=tT*(12*tM._view.length+3*tT)+4;tM._txt.fontSize=tM._fontSize*tT,tM._leftText.fontSize=tM._fontSize*tT,tg.size(ta,tW),tg.graphics.clear(),tg.graphics.setAlpha(.5),tg.graphics.drawRect(0,0,ta,tW,"#999999"),tg.graphics.setAlpha(1),tM.loop()},tM.enable=function(){t_.timer.frameLoop(1,tM,tM.loop)},tM.hide=function(){tM._show=!1,t_.timer.clear(tM,tM.loop),tM._canvas&&tU.removeElement(tM._canvas.source)},tM.clear=function(){tM.trianglesFaces=tM.drawCall=tM.shaderCall=tM.spriteCount=tM.spriteRenderUseCacheCount=tM.treeNodeCollision=tM.treeSpriteCollision=tM.canvasNormal=tM.canvasBitmap=tM.canvasReCache=0},tM.loop=function(){tM._count++;var tD=tU.now();if(!(tD-tM._timer<1e3)){var tY=tM._count;if(tM.FPS=Math.round(1e3*tY/(tD-tM._timer)),tM._show){tM.trianglesFaces=Math.round(tM.trianglesFaces/tY),tM.spriteCount=tM._useCanvas?(tM.drawCall=Math.round(tM.drawCall/tY)-2,tM.shaderCall=Math.round(tM.shaderCall/tY),Math.round(tM.spriteCount/tY)-1):(tM.drawCall=Math.round(tM.drawCall/tY)-2,tM.shaderCall=Math.round(tM.shaderCall/tY)-4,Math.round(tM.spriteCount/tY)-4),tM.spriteRenderUseCacheCount=Math.round(tM.spriteRenderUseCacheCount/tY),tM.canvasNormal=Math.round(tM.canvasNormal/tY),tM.canvasBitmap=Math.round(tM.canvasBitmap/tY),tM.canvasReCache=Math.ceil(tM.canvasReCache/tY),tM.treeNodeCollision=Math.round(tM.treeNodeCollision/tY),tM.treeSpriteCollision=Math.round(tM.treeSpriteCollision/tY);var tg=0<tM.FPS?Math.floor(1e3/tM.FPS).toString():" ";tM._fpsStr=tM.FPS+(tM.renderSlow?" slow":"")+" "+tg,tM._spriteStr=tM.spriteCount+(tM.spriteRenderUseCacheCount?"/"+tM.spriteRenderUseCacheCount:""),tM._canvasStr=tM.canvasReCache+"/"+tM.canvasNormal+"/"+tM.canvasBitmap,tM.currentMemorySize=tS.systemResourceManager.memorySize,tM._useCanvas?tM.renderInfoPre():tM.renderInfo(),tM.clear()}tM._count=0,tM._timer=tD}},tM.renderInfoPre=function(){if(tM._canvas){var tD=tM._ctx;tD.clearRect(tM._first?0:tM._vx,0,tM._width,tM._height);for(var tY=tP.WebGL.mainContext,tg=0;tg<tM._view.length;tg++){var tT=tM._view[tg];tM._first&&(tD.fillStyle="white",tD.fillText(tT.title,tT.x,tT.y,null,null,null)),tD.fillStyle=tT.color;var tr=-1;if((tT=tM._view[tg]).varying){if(tY)switch(tT.varying){case 1:tr=tY.getParameter(tY[tT.value]);break;case 2:tr=tY.getExtension(tT.value)}}else tr=tM[tT.value];"M"==tT.units&&(tr=Math.floor(tr/1048576*100)/100+" M"),"K"==tT.units&&(tr=Math.floor(tr/1024*100)/100+" K"),"string"==tT.units&&(tr=tr.match(/\d+\.?\d/i)),tD.fillText(tr+"",tT.x+tM._vx,tT.y,null,null,null)}}},tM.renderInfo=function(){for(var tD="",tY=tP.WebGL.mainContext,tg=0;tg<tM._view.length;tg++){var tT=tM._view[tg],tr=-1;if(tT.varying){if(tY)switch(tT.varying){case 1:tr=tY.getParameter(tY[tT.value]);break;case 2:tr=tY.getExtension(tT.value)}}else tr=tM[tT.value];"M"==tT.units&&(tr=Math.floor(tr/1048576*100)/100+" M"),"K"==tT.units&&(tr=Math.floor(tr/1024*100)/100+" K"),"string"==tT.units&&(tr=tr.match(/\d+\.?\d/i)),tD+=tr+"\n"}tM._txt.text=tD},tM.FPS=0,tM.loopCount=0,tM.shaderCall=0,tM.drawCall=0,tM.trianglesFaces=0,tM.spriteCount=0,tM.spriteRenderUseCacheCount=0,tM.treeNodeCollision=0,tM.treeSpriteCollision=0,tM.canvasNormal=0,tM.canvasBitmap=0,tM.canvasReCache=0,tM.renderSlow=!1,tM.currentMemorySize=0,tM._fpsStr=null,tM._canvasStr=null,tM._spriteStr=null,tM._fpsData=[],tM._timer=0,tM._count=0,tM._view=[],tM._fontSize=12,tM._txt=null,tM._leftText=null,tM._sp=null,tM._show=!1,tM._useCanvas=!1,tM._canvas=null,tM._ctx=null,tM._first=!1,tM._vx=NaN,tM._width=0,tM._height=100,tM}(),tR=(function(){function tD(){this._strsToID={},this._idToStrs=[],this._length=0}tJ(tD,"laya.utils.StringKey");var tY=tD.prototype;tY.add=function(tD){var tY=this._strsToID[tD];return null!=tY?tY:(this._idToStrs[this._length]=tD,this._strsToID[tD]=this._length++)},tY.getID=function(tD){var tY=this._strsToID[tD];return null==tY?-1:tY},tY.getName=function(tD){var tY=this._idToStrs[tD];return null==tY?void 0:tY}}(),function(){var tE;function tD(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}tJ(tD,"laya.utils.Timer");var tY=tD.prototype;return tY._init=function(){t_.timer&&t_.timer.frameLoop(1,this,this._update)},tY._now=function(){return Date.now()},tY._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var tD=this.currFrame=this.currFrame+this.scale,tY=this._now();this._delta=(tY-this._lastTimer)*this.scale;var tg=this.currTimer=this.currTimer+this._delta;t_.isDebug&&6e4<Math.abs(tY-this._lastTimer)&&console.error("系统时间错误！"+(tY-this._lastTimer)),this._lastTimer=tY;var tT=this._handlers;for(ta=this._count=0,tW=tT.length;ta<tW;ta++)if(null!==(tM=tT[ta]).method){var tr=tM.userFrame?tD:tg;if(tr>=tM.exeTime)if(tM.repeat)if(tM.jumpFrame)for(;tr>=tM.exeTime;)tM.exeTime+=tM.delay,tM.run(!1);else tM.exeTime+=tM.delay,tM.run(!1),tr>tM.exeTime&&(tM.exeTime+=Math.ceil((tr-tM.exeTime)/tM.delay)*tM.delay);else tM.run(!0)}else this._count++;(30<this._count||tD%200==0)&&this._clearHandlers();for(var ts=this._laters,ta=0,tW=ts.length-1;ta<=tW;ta++){var tM=ts[ta];this._isIgnoreRecover(tM)||(null!==tM.method&&(delete this._map[tM.key],tM.run(!1)),this._recoverHandler(tM)),ta===tW&&(tW=ts.length-1)}ts.length=0}},tY._clearHandlers=function(){for(var tD=this._handlers,tY=0,tg=tD.length;tY<tg;tY++){var tT=tD[tY];null!==tT.method?this._temp.push(tT):this._isIgnoreRecover(tT)?this._temp.push(tT):this._recoverHandler(tT)}this._handlers=this._temp,this._temp=tD,this._temp.length=0},tY._recoverHandler=function(tD){this._map[tD.key]==tD&&delete this._map[tD.key],tD.recover()},tY._create=function(tD,tY,tg,tT,tr,ts,ta,tW){if(!tg)return tr.apply(tT,ts),null;if(ta){var tM=this._getHandler(tT,tr);if(tM)return tM.repeat=tY,tM.userFrame=tD,tM.delay=tg,tM.ignoreRecover=tW,tM.caller=tT,tM.method=tr,tM.args=ts,tM.exeTime=tg+(tD?this.currFrame:this.currTimer+this._now()-this._lastTimer),tM}return(tM=tE.create()).repeat=tY,tM.userFrame=tD,tM.delay=tg,tM.ignoreRecover=tW,tM.caller=tT,tM.method=tr,tM.args=ts,tM.exeTime=tg+(tD?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(tM),this._handlers.push(tM),tM},tY._indexHandler=function(tD){var tY=tD.caller,tg=tD.method,tT=tY?tY.$_GID||(tY.$_GID=tL.getGID()):0,tr=tg.$_TID||(tg.$_TID=this._mid++);tD.key=tT+"_"+tr,this._map[tD.key]=tD},tY.once=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=!0),this._create(!1,!1,tD,tY,tg,tT,tr,!1)},tY.loop=function(tD,tY,tg,tT,tr,ts,ta){void 0===tr&&(tr=!0),void 0===ts&&(ts=!1),void 0===ta&&(ta=!1);var tW=this._create(!1,!0,tD,tY,tg,tT,tr,ta);tW&&(tW.jumpFrame=ts)},tY.frameOnce=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=!0),this._create(!0,!1,tD,tY,tg,tT,tr,!1)},tY.frameLoop=function(tD,tY,tg,tT,tr,ts){void 0===tr&&(tr=!0),void 0===ts&&(ts=!1),this._create(!0,!0,tD,tY,tg,tT,tr,ts)},tY.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+tE._freeCount},tY.clear=function(tD,tY){var tg=this._getHandler(tD,tY);return!(!tg||this._isIgnoreRecover(tg))&&(delete this._map[tg.key],tg.key=null,tg.clear(),!0)},tY.clearAll=function(tD){if(tD)for(var tY=0,tg=this._handlers.length;tY<tg;tY++){var tT=this._handlers[tY];tT.caller===tD&&(this._isIgnoreRecover(tT)||(delete this._map[tT.key],tT.key=null,tT.clear()))}},tY._getHandler=function(tD,tY){var tg=tD?tD.$_GID||(tD.$_GID=tL.getGID()):0,tT=tY.$_TID||(tY.$_TID=this._mid++);return this._map[tg+"_"+tT]},tY._isIgnoreRecover=function(tD){if(tD.ignoreRecover||tD.caller&&"IgnoreRecover"==tD.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var tY="";try{arguments.propertyIsEnumerable.caller}catch(tD){tY=tD.stack}t_.recordError("报错：核心定时器销毁忽略  "+tY)}return!0}return!1},tY.hasHandler=function(tD,tY){return this._map[tD.$_GID+"_"+tY.$_TID]},tY.callLater=function(tD,tY,tg){if(null==this._getHandler(tD,tY)){var tT=tE.create();tT.caller=tD,tT.method=tY,tT.args=tg,this._indexHandler(tT),this._laters.push(tT)}},tY.runCallLater=function(tD,tY){var tg=this._getHandler(tD,tY);tg&&null!=tg.method&&(this._isIgnoreRecover(tg)||(delete this._map[tg.key],tg.run(!0)))},tY.runTimer=function(tD,tY){this.runCallLater(tD,tY)},tI(0,tY,"delta",function(){return this._delta}),tD.__init$=function(){tE=function(){function tY(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}tJ(tY,"");var tD=tY.prototype;return tD.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},tD.recover=function(){this.clear(),this.args=tY._freeHandler,tY._freeHandler=this,tY._freeCount++},tD.run=function(tD){var tY=this.caller;if(tY&&tY.destroyed)return this.clear();var tg=this.method,tT=this.args;tD&&this.clear(),null!=tg&&(tT?tg.apply(tY,tT):tg.call(tY))},tY._freeHandler=null,tY._freeCount=0,tY.create=function(){var tD=tY._freeHandler;return tD?(tY._freeHandler=tD.args,--tY._freeCount,tD.args=null,tD):new tY},tY}()},tD}()),tQ=function(){function tO(){this.gid=0}tJ(tO,"laya.utils.Tween");var tD=tO.prototype;return tD.to=function(tD,tY,tg,tT,tr,ts,ta){return void 0===ts&&(ts=0),void 0===ta&&(ta=!1),this._create(tD,tY,tg,tT,tr,ts,ta,!0,!1,!0)},tD.from=function(tD,tY,tg,tT,tr,ts,ta){return void 0===ts&&(ts=0),void 0===ta&&(ta=!1),this._create(tD,tY,tg,tT,tr,ts,ta,!1,!1,!0)},tD._create=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){if(!tD)throw new Error("Tween:target is null");this._target=tD,this._duration=tg,this._ease=tT||tY.ease||tO.easeNone,this._complete=tr||tY.complete,this._delay=ts,this._props=[],this._usedTimer=0,this._startTimer=tU.now(),this._usedPool=tM,this._delayParam=null,this.update=tY.update;var tI=tD.$_GID||(tD.$_GID=tL.getGID());return tO.tweenMap[tI]?(ta&&tO.clearTween(tD),tO.tweenMap[tI].push(this)):tO.tweenMap[tI]=[this],tE?ts<=0?this.firstStart(tD,tY,tW):(this._delayParam=[tD,tY,tW],t_.scaleTimer.once(ts,this,this.firstStart,this._delayParam)):this._initProps(tD,tY,tW),this},tD.firstStart=function(tD,tY,tg){this._delayParam=null,tD.destroyed?this.clear():(this._initProps(tD,tY,tg),this._beginLoop())},tD._initProps=function(tD,tY,tg){for(var tT in tY)if("number"==typeof tD[tT]){var tr=tg?tD[tT]:tY[tT],ts=tg?tY[tT]:tD[tT];this._props.push([tT,tr,ts-tr]),tg||(tD[tT]=tr)}},tD._beginLoop=function(){t_.scaleTimer.frameLoop(1,this,this._doEase)},tD._doEase=function(){this._updateEase(tU.now())},tD._updateEase=function(tD){var tY=this._target;if(tY){if(tY.destroyed)return tO.clearTween(tY);var tg=this._usedTimer=tD-this._startTimer-this._delay;if(!(tg<0)){if(tg>=this._duration)return this.complete();for(var tT=0<tg?this._ease(tg,0,1,this._duration):0,tr=this._props,ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts];tY[tW[0]]=tW[1]+tT*tW[2]}this.update&&this.update.run()}}},tD.complete=function(){if(this._target){t_.scaleTimer.runTimer(this,this.firstStart);for(var tD=this._target,tY=this._props,tg=this._complete,tT=0,tr=tY.length;tT<tr;tT++){var ts=tY[tT];tD[ts[0]]=ts[1]+ts[2]}this.update&&this.update.run(),this.clear(),tg&&tg.run()}},tD.pause=function(){t_.scaleTimer.clear(this,this._beginLoop),t_.scaleTimer.clear(this,this._doEase),t_.scaleTimer.clear(this,this.firstStart);var tD;(tD=tU.now()-this._startTimer-this._delay)<0&&(this._usedTimer=tD)},tD.setStartTime=function(tD){this._startTimer=tD},tD.clear=function(){this._target&&(this._remove(),this._clear())},tD._clear=function(){this.pause(),t_.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,tK.recover("tween",this))},tD.recover=function(){this._usedPool=!0,this._clear()},tD._remove=function(){var tD=tO.tweenMap[this._target.$_GID];if(tD)for(var tY=0,tg=tD.length;tY<tg;tY++)if(tD[tY]===this){tD.splice(tY,1);break}},tD.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=tU.now(),this._delayParam)t_.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var tD=this._props,tY=0,tg=tD.length;tY<tg;tY++){var tT=tD[tY];this._target[tT[0]]=tT[1]}t_.scaleTimer.once(this._delay,this,this._beginLoop)}},tD.resume=function(){this._usedTimer>=this._duration||(this._startTimer=tU.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?t_.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},tI(0,tD,"progress",null,function(tD){var tY=tD*this._duration;this._startTimer=tU.now()-this._delay-tY}),tO.to=function(tD,tY,tg,tT,tr,ts,ta,tW){return void 0===ts&&(ts=0),void 0===ta&&(ta=!1),void 0===tW&&(tW=!0),tK.getItemByClass("tween",tO)._create(tD,tY,tg,tT,tr,ts,ta,!0,tW,!0)},tO.from=function(tD,tY,tg,tT,tr,ts,ta,tW){return void 0===ts&&(ts=0),void 0===ta&&(ta=!1),void 0===tW&&(tW=!0),tK.getItemByClass("tween",tO)._create(tD,tY,tg,tT,tr,ts,ta,!1,tW,!0)},tO.clearAll=function(tD){if(tD&&tD.$_GID){var tY=tO.tweenMap[tD.$_GID];if(tY){for(var tg=0,tT=tY.length;tg<tT;tg++)tY[tg]._clear();tY.length=0}}},tO.clear=function(tD){tD.clear()},tO.clearTween=function(tD){tO.clearAll(tD)},tO.easeNone=function(tD,tY,tg,tT){return tg*tD/tT+tY},tO.tweenMap={},tO}(),tL=function(){function tW(){}return tJ(tW,"laya.utils.Utils"),tW.toRadian=function(tD){return tD*tW._pi2},tW.toAngle=function(tD){return tD*tW._pi},tW.toHexColor=function(tD){if(tD<0||isNaN(tD))return null;for(var tY=tD.toString(16);tY.length<6;)tY="0"+tY;return"#"+tY},tW.getGID=function(){return tW._gid++},tW.concatArray=function(tD,tY){if(!tY)return tD;if(!tD)return tY;var tg=0,tT=tY.length;for(tg=0;tg<tT;tg++)tD.push(tY[tg]);return tD},tW.clearArray=function(tD){return tD&&(tD.length=0),tD},tW.copyArray=function(tD,tY){if(tD||(tD=[]),!tY)return tD;tD.length=tY.length;var tg=0,tT=tY.length;for(tg=0;tg<tT;tg++)tD[tg]=tY[tg];return tD},tW.getGlobalRecByPoints=function(tD,tY,tg,tT,tr){var ts,ta;return ts=new tA(tY,tg),ts=tD.localToGlobal(ts),ta=new tA(tT,tr),ta=tD.localToGlobal(ta),tq._getWrapRec([ts.x,ts.y,ta.x,ta.y])},tW.getGlobalPosAndScale=function(tD){return tW.getGlobalRecByPoints(tD,0,0,1,1)},tW.bind=function(tD,tY){return tD.bind(tY)},tW.measureText=function(tD,tY){return tz.measureText(tD,tY)},tW.contextMeasureText=function(tD){var tY=tU.context.measureText(tD);return tY||(tY={width:16,height:16}),tY},tW.updateOrder=function(tD){if(!tD||tD.length<2)return!1;for(var tY,tg=1,tT=0,tr=tD.length,ts=NaN;tg<tr;){for(tY=tD[tT=tg],ts=tD[tT]._zOrder;-1<--tT&&tD[tT]._zOrder>ts;)tD[tT+1]=tD[tT];tD[tT+1]=tY,tg++}var ta=tY.parent.conchModel;if(ta)if(null!=ta.updateZOrder)ta.updateZOrder();else{for(tg=0;tg<tr;tg++)ta.removeChild(tD[tg].conchModel);for(tg=0;tg<tr;tg++)ta.addChildAt(tD[tg].conchModel,tg)}return!0},tW.transPointList=function(tD,tY,tg){var tT=0,tr=tD.length;for(tT=0;tT<tr;tT+=2)tD[tT]+=tY,tD[tT+1]+=tg},tW.parseInt=function(tD,tY){void 0===tY&&(tY=0);var tg=tU.window.parseInt(tD,tY);return isNaN(tg)?0:tg},tW.getFileExtension=function(tD){tW._extReg.lastIndex=tD.lastIndexOf(".");var tY=tW._extReg.exec(tD);return tY&&1<tY.length?tY[1].toLowerCase():null},tW.getTransformRelativeToWindow=function(tD,tY,tg){var tT=t_.stage,tr=laya.utils.Utils.getGlobalPosAndScale(tD),ts=tT._canvasTransform.clone(),ta=ts.tx,tW=ts.ty;ts.rotate(-Math.PI/180*t_.stage.canvasDegree),ts.scale(t_.stage.clientScaleX,t_.stage.clientScaleY);var tM=t_.stage.canvasDegree%180!=0,tE=NaN,tI=NaN;tM?(tE=tg+tr.y,tI=tY+tr.x,tE*=ts.d,tI*=ts.a,90==t_.stage.canvasDegree?(tE=ta-tE,tI+=tW):(tE+=ta,tI=tW-tI)):(tE=tY+tr.x,tI=tg+tr.y,tE*=ts.a,tI*=ts.d,tE+=ta,tI+=tW);var tO=NaN,tC=NaN;return tC=tM?(tO=ts.d*tr.height,ts.a*tr.width):(tO=ts.a*tr.width,ts.d*tr.height),{x:tE,y:tI,scaleX:tO,scaleY:tC}},tW.fitDOMElementInArea=function(tD,tY,tg,tT,tr,ts){tD._fitLayaAirInitialized||(tD._fitLayaAirInitialized=!0,tD.style.transformOrigin=tD.style.webKittransformOrigin="left top",tD.style.position="absolute");var ta=tW.getTransformRelativeToWindow(tY,tg,tT);tD.style.transform=tD.style.webkitTransform="scale("+ta.scaleX+","+ta.scaleY+") rotate("+t_.stage.canvasDegree+"deg)",tD.style.width=tr+"px",tD.style.height=ts+"px",tD.style.left=ta.x+"px",tD.style.top=ta.y+"px"},tW.isOkTextureList=function(tD){if(!tD)return!1;var tY,tg=0,tT=tD.length;for(tg=0;tg<tT;tg++)if(!(tY=tD[tg])||!tY.source)return!1;return!0},tW.isOKCmdList=function(tD){if(!tD)return!1;var tY,tg,tT=0,tr=tD.length,ts=tP._context;for(tT=0;tT<tr;tT++)switch((tY=tD[tT]).callee){case ts._drawTexture:case ts._fillTexture:case ts._drawTextureWithTransform:if(!(tg=tY[0])||!tg.source)return!1}return!0},tW._gid=1,tW._pi=180/Math.PI,tW._pi2=Math.PI/180,tW._extReg=/\.(\w+)\??/g,tW.parseXMLFromString=function(tD){var tY;if(tD=tD.replace(/>\s+</g,"><"),-1<(tY=(new DOMParser).parseFromString(tD,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))if(console.error("html error    ===============>>>>>>>  "+tD),-1!=tD.indexOf("&")||-1!=tD.indexOf('"')||-1!=tD.indexOf(">")||-1!=tD.indexOf("<")){var tg=tD.slice(6,tD.length-7);tg="<root>"+(tg=(tg=(tg=(tg=tg.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/>/g,"&gt;")).replace(/</g,"&lt;"))+"</root>",tY=(new DOMParser).parseFromString(tg,"text/xml")}else tY=(new DOMParser).parseFromString("<root>error...</root>","text/xml");return tY},tW}(),ty=function(){function tD(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],tP.isWebGL&&tV.regCacheByFunction(tL.bind(this.startDispose,this),tL.bind(this.getCacheList,this))}tJ(tD,"laya.utils.VectorGraphManager");var tY=tD.prototype;return tY.getId=function(){return this._id++},tY.addShape=function(tD,tY){this.shapeDic[tD]=tY,this.useDic[tD]||(this.useDic[tD]=!0)},tY.addLine=function(tD,tY){this.shapeLineDic[tD]=tY,this.shapeLineDic[tD]||(this.shapeLineDic[tD]=!0)},tY.getShape=function(tD){this._checkKey&&null!=this.useDic[tD]&&(this.useDic[tD]=!0)},tY.deleteShape=function(tD){this.shapeDic[tD]&&(this.shapeDic[tD]=null,delete this.shapeDic[tD]),this.shapeLineDic[tD]&&(this.shapeLineDic[tD]=null,delete this.shapeLineDic[tD]),null!=this.useDic[tD]&&delete this.useDic[tD]},tY.getCacheList=function(){var tD,tY=[];for(tD in this.shapeDic)tY.push(this.shapeDic[tD]);for(tD in this.shapeLineDic)tY.push(this.shapeLineDic[tD]);return tY},tY.startDispose=function(tD){var tY;for(tY in this.useDic)this.useDic[tY]=!1;this._checkKey=!0},tY.endDispose=function(){if(this._checkKey){var tD;for(tD in this.useDic)this.useDic[tD]||this.deleteShape(tD);this._checkKey=!1}},tD.getInstance=function(){return tD.instance=tD.instance||new tD},tD.instance=null,tD}(),tu=function(){function tT(){this._obj=null,this._obj=tT.supportWeakMap?new tU.window.WeakMap:{},tT.supportWeakMap||tT._maps.push(this)}tJ(tT,"laya.utils.WeakObject");var tD=tT.prototype;return tD.set=function(tD,tY){if(null!=tD)if(tT.supportWeakMap){var tg=tD;"string"!=typeof tD&&"number"!=typeof tD||(tg=tT._keys[tD])||(tg=tT._keys[tD]={k:tD}),this._obj.set(tg,tY)}else"string"==typeof tD||"number"==typeof tD?this._obj[tD]=tY:(tD.$_GID||(tD.$_GID=tL.getGID()),this._obj[tD.$_GID]=tY)},tD.get=function(tD){if(null==tD)return null;if(tT.supportWeakMap){var tY="string"==typeof tD||"number"==typeof tD?tT._keys[tD]:tD;return tY?this._obj.get(tY):null}return"string"==typeof tD||"number"==typeof tD?this._obj[tD]:this._obj[tD.$_GID]},tD.del=function(tD){if(null!=tD)if(tT.supportWeakMap){var tY="string"==typeof tD||"number"==typeof tD?tT._keys[tD]:tD;if(!tY)return;this._obj.delete(tY)}else"string"==typeof tD||"number"==typeof tD?delete this._obj[tD]:delete this._obj[this._obj.$_GID]},tD.has=function(tD){if(null==tD)return!1;if(tT.supportWeakMap){var tY="string"==typeof tD||"number"==typeof tD?tT._keys[tD]:tD;return this._obj.has(tY)}return"string"==typeof tD||"number"==typeof tD?null!=this._obj[tD]:null!=this._obj[this._obj.$_GID]},tT.__init__=function(){(tT.supportWeakMap=null!=tU.window.WeakMap)||t_.timer.loop(tT.delInterval,null,tT.clearCache)},tT.clearCache=function(){for(var tD=0,tY=tT._maps.length;tD<tY;tD++){tT._maps[tD]._obj={}}},tT.supportWeakMap=!1,tT.delInterval=3e5,tT._keys={},tT._maps=[],ta(tT,["I",function(){return this.I=new tT}]),tT}(),tn=function(){function tD(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}tJ(tD,"laya.utils.WordText");var tY=tD.prototype;return tY.setText=function(tD){this.changed=!0,this._text=tD},tY.toString=function(){return this._text},tY.charCodeAt=function(tD){return this._text?this._text.charCodeAt(tD):NaN},tY.charAt=function(tD){return this._text?this._text.charAt(tD):null},tI(0,tY,"length",function(){return this._text?this._text.length:0}),tD}(),tDD=function(tD){function ta(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,ta.__super.call(this),this._childs=ta.ARRAY_EMPTY,this._$P=ta.PROP_EMPTY,this.timer=t_.scaleTimer,this.conchModel=tP.isConchNode?this.createConchModel():null}tJ(ta,"laya.display.Node",tM);var tY=ta.prototype;return tY._setBit=function(tD,tY){1==tD&&(this._getBit(tD)!=tY&&this._updateDisplayedInstage());tY?this._bits|=tD:this._bits&=~tD},tY._getBit=function(tD){return 0!=(this._bits&tD)},tY._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},tY._setUpNoticeType=function(tD){var tY=this;for(tY._setBit(tD,!0),tY=tY.parent;tY;){if(tY._getBit(tD))return;tY._setBit(tD,!0),tY=tY.parent}},tY.on=function(tD,tY,tg,tT){return"display"!==tD&&"undisplay"!==tD||this._getBit(1)||this._setUpNoticeType(1),this._createListener(tD,tY,tg,tT,!1)},tY.once=function(tD,tY,tg,tT){return"display"!==tD&&"undisplay"!==tD||this._getBit(1)||this._setUpNoticeType(1),this._createListener(tD,tY,tg,tT,!0)},tY.createConchModel=function(){return null},tY.destroy=function(tD){void 0===tD&&(tD=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(tD?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},tY.destroyChildren=function(){if(this._childs)for(var tD=this._childs.length-1;-1<tD;tD--)this._childs[tD].destroy(!0)},tY.addChild=function(tD){if(!tD||this.destroyed||tD===this)return tD;if(tD.zOrder&&this._set$P("hasZorder",!0),tD._parent===this){var tY=this.getChildIndex(tD);tY!==this._childs.length-1&&(this._childs.splice(tY,1),this._childs.push(tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,this._childs.length-1)),this._childChanged())}else tD.parent&&tD.parent.removeChild(tD),this._childs===ta.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(tD),this.conchModel&&this.conchModel.addChildAt(tD.conchModel,this._childs.length-1),(tD.parent=this)._childChanged();return tD},tY.addChildren=function(tD){for(var tY=arguments,tg=0,tT=tY.length;tg<tT;)this.addChild(tY[tg++])},tY.addChildAt=function(tD,tY){if(!tD||this.destroyed||tD===this)return tD;if(tD.zOrder&&this._set$P("hasZorder",!0),0<=tY&&tY<=this._childs.length){if(tD._parent===this){var tg=this.getChildIndex(tD);this._childs.splice(tg,1),this._childs.splice(tY,0,tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,tY)),this._childChanged()}else tD.parent&&tD.parent.removeChild(tD),this._childs===ta.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(tY,0,tD),this.conchModel&&this.conchModel.addChildAt(tD.conchModel,tY),tD.parent=this;return tD}throw new Error("appendChildAt:The index is out of bounds")},tY.getChildIndex=function(tD){return this._childs.indexOf(tD)},tY.getChildByName=function(tD){var tY=this._childs;if(tY)for(var tg=0,tT=tY.length;tg<tT;tg++){var tr=tY[tg];if(tr.name===tD)return tr}return null},tY._get$P=function(tD){return this._$P[tD]},tY._set$P=function(tD,tY){return this.destroyed||(this._$P===ta.PROP_EMPTY&&(this._$P={}),this._$P[tD]=tY),tY},tY.getChildAt=function(tD){return this._childs[tD]},tY.setChildIndex=function(tD,tY){var tg=this._childs;if(tY<0||tY>=tg.length)throw new Error("setChildIndex:The index is out of bounds.");var tT=this.getChildIndex(tD);if(tT<0)throw new Error("setChildIndex:node is must child of this object.");return tg.splice(tT,1),tg.splice(tY,0,tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,tY)),this._childChanged(),tD},tY._childChanged=function(tD){},tY.removeChild=function(tD){if(!this._childs)return tD;var tY=this._childs.indexOf(tD);return this.removeChildAt(tY)},tY.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},tY.removeChildByName=function(tD){var tY=this.getChildByName(tD);return tY&&this.removeChild(tY),tY},tY.removeChildAt=function(tD){var tY=this.getChildAt(tD);if(tY){for(var tg=this._childs.length-1,tT=tD;tT<tg;++tT)this._childs[tT]=this._childs[tT+1];this._childs.length=tg,this.conchModel&&this.conchModel.removeChild(tY.conchModel),tY.parent=null}return tY},tY.removeChildren=function(tD,tY){if(void 0===tD&&(tD=0),void 0===tY&&(tY=2147483647),this._childs&&0<this._childs.length){var tg=this._childs;if(0===tD&&ts<=tY){var tT=tg;this._childs=ta.ARRAY_EMPTY}else tT=tg.splice(tD,tY-tD);for(var tr=0,ts=tT.length;tr<ts;tr++)tT[tr].parent=null,this.conchModel&&this.conchModel.removeChild(tT[tr].conchModel)}return this},tY.replaceChild=function(tD,tY){var tg=this._childs.indexOf(tY);return-1<tg?(this._childs.splice(tg,1,tD),this.conchModel&&(this.conchModel.removeChild(tY.conchModel),this.conchModel.addChildAt(tD.conchModel,tg)),tY.parent=null,tD.parent=this,tD):null},tY._updateDisplayedInstage=function(){var tD;tD=this;var tY=t_.stage;for(this._displayedInStage=!1;tD;){if(tD._getBit(1)){this._displayedInStage=tD._displayedInStage;break}if(tD==tY||tD._displayedInStage){this._displayedInStage=!0;break}tD=tD.parent}},tY._setDisplay=function(tD){this._displayedInStage!==tD&&((this._displayedInStage=tD)?this.event("display"):this.event("undisplay"))},tY._displayChild=function(tD,tY){var tg=tD._childs;if(tg)for(var tT=0;tT<tg.length;tT++){var tr=tg[tT];tr&&tr._getBit(1)&&(0<tr._childs.length?this._displayChild(tr,tY):tr._setDisplay(tY))}tD._setDisplay(tY)},tY.contains=function(tD){if(tD===this)return!0;for(;tD;){if(tD.parent===this)return!0;tD=tD.parent}return!1},tY.timerLoop=function(tD,tY,tg,tT,tr,ts){void 0===tr&&(tr=!0),void 0===ts&&(ts=!1),this.timer.loop(tD,tY,tg,tT,tr,ts)},tY.timerOnce=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=!0),this.timer._create(!1,!1,tD,tY,tg,tT,tr)},tY.frameLoop=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=!0),this.timer._create(!0,!0,tD,tY,tg,tT,tr)},tY.frameOnce=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=!0),this.timer._create(!0,!1,tD,tY,tg,tT,tr)},tY.clearTimer=function(tD,tY){this.timer.clear(tD,tY)},tI(0,tY,"numChildren",function(){return this._childs.length}),tI(0,tY,"destroyed",function(){return this._destroyed}),tI(0,tY,"parent",function(){return this._parent},function(tD){this._parent!==tD&&(tD?(this._parent=tD,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),tD.displayedInStage&&this._displayChild(this,!0)),tD._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=tD))}),tI(0,tY,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),ta.ARRAY_EMPTY=[],ta.PROP_EMPTY={},ta.NOTICE_DISPLAY=1,ta.MOUSEENABLE=2,ta}(),tYD=function(tD){function tC(tD){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,tC.__super.call(this),this._padding=tC._PADDING,this._spacing=tC._SPACING,this._aligns=tC._ALIGNS,this._font=tE.EMPTY,this._ower=tD}tJ(tC,"laya.display.css.CSSStyle",tD);var tY=tC.prototype;return tY.destroy=function(){this._ower=null,this._font=null,this._rect=null},tY.inherit=function(tD){this._font=tD._font,this._spacing=tD._spacing===tC._SPACING?tC._SPACING:tD._spacing.slice(),this.lineHeight=tD.lineHeight},tY._widthAuto=function(){return 0!=(262144&this._type)},tY.widthed=function(tD){return 0!=(8&this._type)},tY._calculation=function(tD,tY){if(tY.indexOf("%")<0)return!1;var tT=this._ower,tr=tT.parent,ts=this._rect;function ta(tD,tY,tg){return tD*tg[0]+tY*tg[1]+tg[2]}function tg(tD){var tY=tr.width,tg=tT.width;ts.width&&(tT.width=ta(tY,tg,ts.width)),ts.height&&(tT.height=ta(tY,tg,ts.height)),ts.left&&(tT.x=ta(tY,tg,ts.left)),ts.top&&(tT.y=ta(tY,tg,ts.top))}null===ts&&(tr._getCSSStyle()._type|=524288,tr.on("resize",this,tg),this._rect=ts={input:{}});var tW=tY.split(" ");return tW[0]=parseFloat(tW[0])/100,1==tW.length?tW[1]=tW[2]=0:(tW[1]=parseFloat(tW[1])/100,tW[2]=parseFloat(tW[2])),ts[tD]=tW,ts.input[tD]=tY,tg(),!0},tY.heighted=function(tD){return 0!=(8192&this._type)},tY.size=function(tD,tY){var tg=this._ower,tT=!1;-1!==tD&&tD!=this._ower.width&&(this._type|=8,this._ower.width=tD,tT=!0),-1!==tY&&tY!=this._ower.height&&(this._type|=8192,this._ower.height=tY,tT=!0),tT&&(tg._layoutLater(),524288&this._type&&tg.event("resize",this))},tY._getAlign=function(){return this._aligns[0]},tY._getValign=function(){return this._aligns[1]},tY._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},tY._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new tE(this._font))},tY.render=function(tD,tY,tg,tT){var tr=tD.width,ts=tD.height;tg-=tD.pivotX,tT-=tD.pivotY,this._bgground&&null!=this._bgground.color&&tY.ctx.fillRect(tg,tT,tr,ts,this._bgground.color),this._border&&this._border.color&&tY.drawRect(tg,tT,tr,ts,this._border.color.strColor,this._border.size)},tY.getCSSStyle=function(){return this},tY.cssText=function(tD){this.attrs(tC.parseOneCSS(tD,";"))},tY.attrs=function(tD){if(tD)for(var tY=0,tg=tD.length;tY<tg;tY++){var tT=tD[tY];this[tT[0]]=tT[1]}},tY.setTransform=function(tD){"none"===tD?this._tf=tW._TF_EMPTY:this.attrs(tC.parseOneCSS(tD,","))},tY.translate=function(tD,tY){this._tf===tW._TF_EMPTY&&(this._tf=new tr),this._tf.translateX=tD,this._tf.translateY=tY},tY.scale=function(tD,tY){this._tf===tW._TF_EMPTY&&(this._tf=new tr),this._tf.scaleX=tD,this._tf.scaleY=tY},tY._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},tI(0,tY,"block",tD.prototype._$get_block,function(tD){tD?this._type|=1:this._type&=-2}),tI(0,tY,"valign",function(){return tC._valigndef[this._aligns[1]]},function(tD){this._aligns===tC._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=tC._valigndef[tD]}),tI(0,tY,"height",null,function(tD){if(this._type|=8192,"string"==typeof tD){if(this._calculation("height",tD))return;tD=parseInt(tD)}this.size(-1,tD)}),tI(0,tY,"width",null,function(tD){if(this._type|=8,"string"==typeof tD){var tY=tD.indexOf("auto");if(0<=tY&&(this._type|=262144,tD=tD.substr(0,tY)),this._calculation("width",tD))return;tD=parseInt(tD)}this.size(tD,-1)}),tI(0,tY,"fontWeight",function(){return this._font.weight},function(tD){this._createFont().weight=tD}),tI(0,tY,"left",null,function(tD){var tY=this._ower;if("string"==typeof tD){if("center"===tD?tD="50% -50% 0":"right"===tD&&(tD="100% -100% 0"),this._calculation("left",tD))return;tD=parseInt(tD)}tY.x=tD}),tI(0,tY,"_translate",null,function(tD){this.translate(tD[0],tD[1])}),tI(0,tY,"absolute",function(){return 0!=(4&this._type)}),tI(0,tY,"top",null,function(tD){var tY=this._ower;if("string"==typeof tD){if("middle"===tD?tD="50% -50% 0":"bottom"===tD&&(tD="100% -100% 0"),this._calculation("top",tD))return;tD=parseInt(tD)}tY.y=tD}),tI(0,tY,"align",function(){return tC._aligndef[this._aligns[0]]},function(tD){this._aligns===tC._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=tC._aligndef[tD]}),tI(0,tY,"bold",function(){return this._font.bold},function(tD){this._createFont().bold=tD}),tI(0,tY,"padding",function(){return this._padding},function(tD){this._padding=tD}),tI(0,tY,"leading",function(){return this._spacing[1]},function(tD){"string"==typeof tD&&(tD=parseInt(tD+"")),this._spacing===tC._SPACING&&(this._spacing=[0,0]),this._spacing[1]=tD}),tI(0,tY,"lineElement",function(){return 0!=(65536&this._type)},function(tD){tD?this._type|=65536:this._type&=-65537}),tI(0,tY,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(tD){this.lineElement=!1,"right"===tD?this._type|=32768:this._type&=-32769}),tI(0,tY,"textDecoration",function(){return this._font.decoration},function(tD){this._createFont().decoration=tD}),tI(0,tY,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(tD){"nowrap"===tD&&(this._type|=131072),"none"===tD&&(this._type&=-131073)}),tI(0,tY,"background",null,function(tD){tD?(this._bgground||(this._bgground={}),this._bgground.color=tD,this._ower.conchModel&&this._ower.conchModel.bgColor(tD),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),tI(0,tY,"wordWrap",function(){return 0==(131072&this._type)},function(tD){tD?this._type&=-131073:this._type|=131072}),tI(0,tY,"color",function(){return this._font.color},function(tD){this._createFont().color=tD}),tI(0,tY,"password",function(){return this._font.password},function(tD){this._createFont().password=tD}),tI(0,tY,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(tD){"none"===tD?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=tD),this._ower.conchModel&&this._ower.conchModel.bgColor(tD),this._ower._renderType|=256}),tI(0,tY,"font",function(){return this._font.toString()},function(tD){this._createFont().set(tD)}),tI(0,tY,"weight",null,function(tD){this._createFont().weight=tD}),tI(0,tY,"letterSpacing",function(){return this._spacing[0]},function(tD){"string"==typeof tD&&(tD=parseInt(tD+"")),this._spacing===tC._SPACING&&(this._spacing=[0,0]),this._spacing[0]=tD}),tI(0,tY,"fontSize",function(){return this._font.size},function(tD){this._createFont().size=tD}),tI(0,tY,"italic",function(){return this._font.italic},function(tD){this._createFont().italic=tD}),tI(0,tY,"fontFamily",function(){return this._font.family},function(tD){this._createFont().family=tD}),tI(0,tY,"stroke",function(){return this._font.stroke[0]},function(tD){this._createFont().stroke===tE._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=tD}),tI(0,tY,"strokeColor",function(){return this._font.stroke[1]},function(tD){this._createFont().stroke===tE._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=tD}),tI(0,tY,"border",function(){return this._border?this._border.value:""},function(tD){if("none"!=tD){this._border||(this._border={});var tY=(this._border.value=tD).split(" ");if(this._border.color=tf.create(tY[tY.length-1]),1==tY.length)return this._border.size=1,void(this._border.type="solid");var tg=0;0<tY[0].indexOf("px")?(this._border.size=parseInt(tY[0]),tg++):this._border.size=1,this._border.type=tY[tg],this._ower._renderType|=256}else this._border=null}),tI(0,tY,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(tD){tD?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==tD?null:tf.create(tD),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),tI(0,tY,"position",function(){return 4&this._type?"absolute":""},function(tD){"absolute"==tD?this._type|=4:this._type&=-5}),tI(0,tY,"display",null,function(tD){switch(tD){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),tI(0,tY,"paddingLeft",function(){return this.padding[3]}),tI(0,tY,"paddingTop",function(){return this.padding[0]}),tI(0,tY,"_scale",null,function(tD){this._ower.scale(tD[0],tD[1])}),tI(0,tY,"_rotate",null,function(tD){this._ower.rotation=tD}),tC.parseOneCSS=function(tD,tY){for(var tg,tT=[],tr=tD.split(tY),ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts],tM=tW.indexOf(":"),tE=tW.substr(0,tM).replace(/^\s+|\s+$/g,"");if(0!=tE.length){var tI=tW.substr(tM+1).replace(/^\s+|\s+$/g,""),tO=[tE,tI];switch(tE){case"italic":case"bold":tO[1]="true"==tI;break;case"line-height":tO[0]="lineHeight",tO[1]=parseInt(tI);break;case"font-size":tO[0]="fontSize",tO[1]=parseInt(tI);break;case"padding":1<(tg=tI.split(" ")).length||(tg[1]=tg[2]=tg[3]=tg[0]),tO[1]=[parseInt(tg[0]),parseInt(tg[1]),parseInt(tg[2]),parseInt(tg[3])];break;case"rotate":tO[0]="_rotate",tO[1]=parseFloat(tI);break;case"scale":tg=tI.split(" "),tO[0]="_scale",tO[1]=[parseFloat(tg[0]),parseFloat(tg[1])];break;case"translate":tg=tI.split(" "),tO[0]="_translate",tO[1]=[parseInt(tg[0]),parseInt(tg[1])];break;default:(tO[0]=tC._CSSTOVALUE[tE])||(tO[0]=tE)}tT.push(tO)}}return tT},tC.parseCSS=function(tD,tY){for(var tg;null!=(tg=tC._parseCSSRegExp.exec(tD));)tC.styleSheets[tg[1]]=tC.parseOneCSS(tg[2],";")},tC.EMPTY=new tC(null),tC._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},tC._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),tC._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},tC._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},tC.styleSheets={},tC.ALIGN_CENTER=1,tC.ALIGN_RIGHT=2,tC.VALIGN_MIDDLE=1,tC.VALIGN_BOTTOM=2,tC._CSS_BLOCK=1,tC._DISPLAY_NONE=2,tC._ABSOLUTE=4,tC._WIDTH_SET=8,tC._PADDING=[0,0,0,0],tC._RECT=[-1,-1,-1,-1],tC._SPACING=[0,0],tC._ALIGNS=[0,0,0],tC.ADDLAYOUTED=512,tC._NEWFONT=4096,tC._HEIGHT_SET=8192,tC._BACKGROUND_SET=16384,tC._FLOAT_RIGHT=32768,tC._LINE_ELEMENT=65536,tC._NOWARP=131072,tC._WIDTHAUTO=262144,tC._LISTERRESZIE=524288,tC}(tW),tgD=function(tD){function ta(){this.url=null,this.audio=null,this.loaded=!1,ta.__super.call(this)}tJ(ta,"laya.media.h5audio.AudioSound",tM);var tY=ta.prototype;return tY.dispose=function(){var tD=ta._audioCache[this.url];tD&&(tD.src="",delete ta._audioCache[this.url])},tY.load=function(tD){var tY;if(tD=ti.formatURL(tD),(this.url=tD)==tX._tMusic?(ta._initMusicAudio(),(tY=ta._musicAudio).src!=tD&&(ta._audioCache[tY.src]=null,tY=null)):tY=ta._audioCache[tD],tY&&2<=tY.readyState)this.event("complete");else{tY||(tY=tD==tX._tMusic?(ta._initMusicAudio(),ta._musicAudio):tU.createElement("audio"),(ta._audioCache[tD]=tY).src=tD),tY.addEventListener("canplaythrough",tT),tY.addEventListener("error",tr);var tg=this;(this.audio=tY).load?tY.load():tr()}function tT(){ts(),tg.loaded=!0,tg.event("complete")}function tr(){tY.load=null,ts(),tg.event("error")}function ts(){tY.removeEventListener("canplaythrough",tT),tY.removeEventListener("error",tr)}},tY.play=function(tD,tY,tg){if(void 0===tD&&(tD=0),void 0===tY&&(tY=0),!this.url)return null;var tT,tr;if(!(tT=this.url==tX._tMusic?ta._musicAudio:ta._audioCache[this.url]))return null;tr=tK.getItem("audio:"+this.url),tP.isConchApp?tr||((tr=tU.createElement("audio")).src=this.url):this.url==tX._tMusic?(ta._initMusicAudio(),(tr=ta._musicAudio).src=this.url):tr=tr||tT.cloneNode(!0);var ts=new tCD(tr);return ts.url=this.url,ts.loops=tY,ts.startTime=tD,ts.startHandler=tg,ts.play(!1),tX.addChannel(ts),ts},tI(0,tY,"duration",function(){var tD;return(tD=ta._audioCache[this.url])?tD.duration:0}),ta._initMusicAudio=function(){ta._musicAudio||(ta._musicAudio||(ta._musicAudio=tU.createElement("audio")),tP.isConchApp||tU.document.addEventListener("mousedown",ta._makeMusicOK))},ta._makeMusicOK=function(){tU.document.removeEventListener("mousedown",ta._makeMusicOK),ta._musicAudio.src?ta._musicAudio.play():(ta._musicAudio.src="",ta._musicAudio.load())},ta._audioCache={},ta._musicAudio=null,ta}(),tTD=function(tD){function tY(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,tY.__super.call(this)}tJ(tY,"laya.media.SoundChannel",tM);var tg=tY.prototype;return tg.play=function(){},tg.stop=function(){},tg.pause=function(){},tg.resume=function(){},tg.__runComplete=function(tD){tD&&tD.run()},tI(0,tg,"volume",function(){return 1},function(tD){}),tI(0,tg,"position",function(){return 0}),tI(0,tg,"duration",function(){return 0}),tY}(),trD=function(tD){function tY(){tY.__super.call(this)}tJ(tY,"laya.media.Sound",tM);var tg=tY.prototype;return tg.load=function(tD){},tg.play=function(tD,tY,tg){return void 0===tD&&(tD=0),void 0===tY&&(tY=0),null},tg.dispose=function(){},tI(0,tg,"duration",function(){return 0}),tY}(),tsD=function(tD){function tr(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,tr.__super.call(this)}tJ(tr,"laya.media.webaudio.WebAudioSound",tM);var tY=tr.prototype;return tY.load=function(tD){this.url=tD,this.audioBuffer=tr._dataCache[tD],this.audioBuffer?this._loaded(this.audioBuffer):(tr.e.on("loaded:"+tD,this,this._loaded),tr.e.on("err:"+tD,this,this._err),tr.__loadingSound[tD]||(tr.__loadingSound[tD]=!0,t_.loader.load(tD,tj.create(this,this.onloaded),null,tWD.BUFFER,4,!1,null,!0)))},tY.onloaded=function(tD){tD||this._err(),this._disposed?this._removeLoadEvents():(this.data=tD,tr.buffs.push({buffer:this.data,url:this.url}),tr.decode())},tY._err=function(){if(this._removeLoadEvents(),tr.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var tD,tY,tg,tT=0;for(tD=(tY=this.__toPlays).length,tT=0;tT<tD;tT++)(tg=tY[tT])[3]&&!tg[3].isStopped&&tg[3].event("error");this.__toPlays.length=0}},tY._loaded=function(tD){this._removeLoadEvents(),this._disposed||(this.audioBuffer=tD,this.loaded=!0,this.event("complete"))},tY._removeLoadEvents=function(){tr.e.off("loaded:"+this.url,this,this._loaded),tr.e.off("err:"+this.url,this,this._err)},tY.__playAfterLoaded=function(){if(this.__toPlays){var tD,tY,tg,tT=0;for(tD=(tY=this.__toPlays).length,tT=0;tT<tD;tT++)(tg=tY[tT])[3]&&!tg[3].isStopped&&this.play(tg[0],tg[1],tg[2],tg[3]);this.__toPlays.length=0}},tY.play=function(tD,tY,tg,tT){return void 0===tD&&(tD=0),void 0===tY&&(tY=0),tT=tT||new tND,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([tD,tY,tg,tT]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),tT.url=this.url,tT.loops=tY,tT.audioBuffer=this.audioBuffer,tT.startTime=tD,tT.startHandler=tg,tT.play(!1),tX.addChannel(tT),tT},tY.dispose=function(){this._disposed=!0,delete tr._dataCache[this.url],delete tr.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},tI(0,tY,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),tr.decode=function(){if(!(tr.buffs.length<=0||tr.isDecoding))if(tr.isDecoding=!0,(tr.tInfo=tr.buffs.shift())&&tr.tInfo.buffer&&tr.tInfo.buffer.byteLength)try{tr.ctx.decodeAudioData(tr.tInfo.buffer,tr._done,tr._fail)}catch(tD){console.error("decodeAudioData error  byteLength:"+tr.tInfo.buffer.byteLength+"  url:"+tr.tInfo.url)}else tr._fail()},tr._done=function(tD){tr.e.event("loaded:"+tr.tInfo.url,tD),tr._dataCache[tr.tInfo.url]=tD,tr.isDecoding=!1,tr.decode()},tr._fail=function(){tr.e.event("err:"+tr.tInfo.url,null),tr.isDecoding=!1,tr.decode()},tr._playEmptySound=function(){if(null!=tr.ctx){if(tr._emptySource&&(tr._emptySource.stop(),tr._emptySource.disconnect(0),!tND._tryCleanFailed))try{tr._emptySource.buffer=null}catch(tD){tND._tryCleanFailed=!0}var tD=tr.ctx.createBufferSource();tD.buffer=tr._miniBuffer,tD.connect(tr.ctx.destination),tD.start(0,0,0),tr._emptySource=tD}},tr._unlock=function(){tr._unlocked||(tr._playEmptySound(),"running"==tr.ctx.state?(tU.document.removeEventListener("mousedown",tr._unlock,!0),tU.document.removeEventListener("touchend",tr._unlock,!0),tU.document.removeEventListener("touchstart",tr._unlock,!0),tr._unlocked=!0):"suspended"==tr.ctx.state&&tX._recoverWebAudio())},tr.initWebAudio=function(){"running"!=tr.ctx.state&&(tr._unlock(),tU.document.addEventListener("mousedown",tr._unlock,!0),tU.document.addEventListener("touchend",tr._unlock,!0),tU.document.addEventListener("touchstart",tr._unlock,!0))},tr._emptySource=null,tr._dataCache={},tr.buffs=[],tr.isDecoding=!1,tr._unlocked=!1,tr.tInfo=null,tr.__loadingSound={},ta(tr,["window",function(){return this.window=tU.window},"webAudioEnabled",function(){return this.webAudioEnabled=tr.window.AudioContext||tr.window.webkitAudioContext||tr.window.mozAudioContext},"ctx",function(){return this.ctx=tr.webAudioEnabled?new(tr.window.AudioContext||tr.window.webkitAudioContext||tr.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=tr.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new tM}]),tr}(),taD=function(tD){function tY(){this._responseType=null,this._data=null,tY.__super.call(this),this._http=new tU.window.XMLHttpRequest}tJ(tY,"laya.net.HttpRequest",tM);var tg=tY.prototype;return tg.send=function(tD,tY,tg,tT,tr){void 0===tg&&(tg="get"),void 0===tT&&(tT="text"),this._responseType=tT,this._data=null;var ts=this,ta=this._http;if(ta.open(tg,tD,!0),tr)for(var tW=0;tW<tr.length;tW++)ta.setRequestHeader(tr[tW++],tr[tW]);else tP.isConchApp||(tY&&"string"!=typeof tY?ta.setRequestHeader("Content-Type","application/json"):ta.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));ta.responseType="arraybuffer"!==tT?"text":"arraybuffer",ta.onerror=function(tD){ts._onError(tD)},ta.onabort=function(tD){ts._onAbort(tD)},ta.onprogress=function(tD){ts._onProgress(tD)},ta.onload=function(tD){ts._onLoad(tD)},ta.send(tY)},tg._onProgress=function(tD){tD&&tD.lengthComputable&&this.event("progress",tD.loaded/tD.total)},tg._onAbort=function(tD){this.error("Request was aborted by user")},tg._onError=function(tD){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},tg._onLoad=function(tD){var tY=this._http,tg=void 0!==tY.status?tY.status:200;200===tg||204===tg||0===tg?this.complete():this.error("["+tY.status+"]"+tY.statusText+":"+tY.responseURL)},tg.error=function(tD){this.clear(),this.event("error",tD)},tg.complete=function(){this.clear();var tY=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=tL.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(tD){tY=!1,this.error(tD.message)}tY&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},tg.clear=function(){var tD=this._http;tD.onerror=tD.onabort=tD.onprogress=tD.onload=null},tI(0,tg,"url",function(){return this._http.responseURL}),tI(0,tg,"http",function(){return this._http}),tI(0,tg,"data",function(){return this._data}),tY}(),tWD=function(tD){function tb(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,tb.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}tJ(tb,"laya.net.Loader",tM);var tY=tb.prototype;return tY.load=function(tD,tY,tg,tT,tr){if(tD&&""!=tD||console.error("Loader 加载的url不合法 "+tD),void 0===tg&&(tg=!0),void 0===tr&&(tr=!1),this._url=tD,this._base64=!1,0===tD.indexOf("data:image")?(this._base64=!0,this._type=tY="image"):this._type=tY||(tY=this.getTypeFromUrl(tD)),this._cache=tg,this._data=null,!tr&&tb.loadedMap[tD])return this._data=tb.loadedMap[tD],this.event("progress",1),void this.event("complete",this._data);if(tT&&tb.setGroup(tD,tT),null!=tb.parserMap[tY])return this._customParse=!0,void(tb.parserMap[tY]instanceof laya.utils.Handler?tb.parserMap[tY].runWith(this):tb.parserMap[tY].call(null,this));if("image"===tY||"htmlimage"===tY||"nativeimage"===tY)return this._loadImage(tD);if("ttf"===tY)return this._loadTTF(tD);switch(tY){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:tY}tb.preLoadedMap[tD]?this.onLoaded(tb.preLoadedMap[tD]):tN.resMgrLoad(tD,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},tY.getTypeFromUrl=function(tD){var tY=tL.getFileExtension(tD);return tY?tb.typeMap[tY]:(console.warn("Not recognize the resources suffix",tD),"text")},tY._loadTTF=function(tD){tD=ti.formatURL(tD);var tY=new th;tY.complete=tj.create(this,this.onLoaded),tY.load(tD)},tY._loadBase64Image=function(tY){tY=ti.formatURL(tY);var tg,tD=this;function tT(){tg.onload=null,tg.onerror=null,delete tb.imgCache[tY]}function tr(){tT(),tD.onLoaded(tg)}function ts(){tT(),tD.event("error","Load image failed")}"nativeimage"===this._type?((tg=new tU.window.Image).crossOrigin="",tg.onload=tr,tg.onerror=ts,tg.src=tY,tb.imgCache[tY]=tg):new ttD.create(tY,{onload:tr,onerror:ts,onCreate:function(tD){tg=tD,tb.imgCache[tY]=tD}})},tY._loadImage=function(tD){this._base64?this._loadBase64Image(tD):tN.imgMgrLoad(tD,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},tY._loadImageComplete=function(tD,tY,tg){if(null!=tg)if(tg instanceof ArrayBuffer){var tT=new DataView(tg),tr=new laya.webgl.resource.WebGLImage(new Uint8Array(tg,8),tD,0,!1,tT.getUint32(0),tT.getUint32(4));this.onLoaded(tr)}else if(tg instanceof tID)tb.imgMgrSet[tD]=tY,tN.imgMgrLock(tD,tb.imgMgrSet[tD]),this._url=tD,this.complete(tg);else{var ts=-1!=tD.indexOf(".png",tD.length-4)?6408:6407;tr=new laya.webgl.resource.WebGLImage(tg,tD,ts,!1,tg.width,tg.height);this.onLoaded(tr)}else this.event("error","Load image failed")},tY.imageCancel=function(tD,tY,tg){tN.imgMgrCancel&&tN.imgMgrCancel(tD,this._onImageCallback)},tY._loadSound=function(tD){var tY=new tX._soundClass,tg=this;function tT(){tY.offAll()}tY.on("complete",this,function(){tT(),tg.onLoaded(tY)}),tY.on("error",this,function(){tT(),tY.dispose(),tg.event("error","Load sound failed")}),tY.load(tD)},tY.onProgress=function(tD){"atlas"===this._type?this.event("progress",.3*tD):this.event("progress",tD)},tY.onError=function(tD){this.event("error",tD)},tY._loadedComplete=function(tD,tY,tg){if(null!=tg)switch(this._type){case"atlas":case"plf":case"json":var tT=new tF(tg);this.onLoaded(JSON.parse(tT.readUTFBytes()));break;case"font":tT=new tF(tg);this.onLoaded(tL.parseXMLFromString(tT.readUTFBytes()));break;default:this.onLoaded(tg)}else this.event("error",tD)},tY.onLoaded=function(tD){var tY=this._type;if("plf"==tY)this.parsePLFData(tD),this.complete(tD);else if("image"===tY){var tg=new tID(tD);tg.url=this._url,this.complete(tg)}else if("sound"===tY||"htmlimage"===tY||"nativeimage"===tY)this.complete(tD);else if("atlas"===tY){if(!tD.src&&!tD._setContext){if(!this._data){if((this._data=tD).meta&&tD.meta.image)for(var tT=tD.meta.image.split(","),tr=0<=this._url.indexOf("/")?"/":"\\",ts=this._url.lastIndexOf(tr),ta=0<=ts?this._url.substr(0,ts+1):"",tW=0,tM=tT.length;tW<tM;tW++)tT[tW]=ta+tT[tW];else tT=[this._url.replace(".json",".png")];tT.reverse(),tD.toLoads=tT,tD.pics=[]}return this.event("progress",.3+1/tT.length*.6),this._loadImage(tT.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(tD),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var tE=this._data.frames,tI=this._url.split("?")[0],tO=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:tI.substring(0,tI.lastIndexOf("."))+"/",tC=this._data.pics,tN=ti.formatURL(this._url),t$=tb.atlasMap[tN]||(tb.atlasMap[tN]=[]);t$.dir=tO;var td=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var tJ in td=parseFloat(this._data.meta.scale),tE){var tx,tj=tE[tJ],tZ=tC[tj.frame.idx?tj.frame.idx:0],tp=ti.formatURL(tO+tJ);tZ.scaleRate=td,tx=tID.create(tZ,tj.frame.x,tj.frame.y,tj.frame.w,tj.frame.h,tj.spriteSourceSize.x,tj.spriteSourceSize.y,tj.sourceSize.w,tj.sourceSize.h),tb.cacheRes(tp,tx),tb.keepCache(this._url,tO+tJ),tx.url=tp,t$.push(tp)}else for(tJ in tE)tZ=tC[(tj=tE[tJ]).frame.idx?tj.frame.idx:0],tp=ti.formatURL(tO+tJ),tb.cacheRes(tp,tID.create(tZ,tj.frame.x,tj.frame.y,tj.frame.w,tj.frame.h,tj.spriteSourceSize.x,tj.spriteSourceSize.y,tj.sourceSize.w,tj.sourceSize.h)),tb.loadedMap[tp].url=tp,tb.keepCache(this._url,tO+tJ),t$.push(tp);delete this._data.pics,this.complete(this._data)}else if("font"==tY){if(!tD.src)return this._data=tD,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var tl=new tG;tl.parseFont(this._data,tD);var tt=this._url.split(".fnt")[0].split("/"),t_=tt[tt.length-1];tJD.registerBitmapFont(t_,tl),this._data=tl,this.complete(this._data)}else if("pkm"==tY){var tA=ttD.create(tD,this._url),tq=new tID(tA);tq.url=this._url,this.complete(tq)}else this.complete(tD)},tY.parsePLFData=function(tD){var tY,tg,tT;for(tY in tD)switch(tT=tD[tY],tY){case"json":case"text":for(tg in tT)tb.preLoadedMap[ti.formatURL(tg)]=tT[tg];break;default:for(tg in tT)tb.preLoadedMap[ti.formatURL(tg)]=tT[tg]}},tY.complete=function(tD){this._data=tD,this._customParse?this.event("loaded",tD instanceof Array?[tD]:tD):(tb._loaders.push(this),tb._isWorking||tb.checkNext())},tY.endLoad=function(tD){tD&&(this._data=tD),this._cache&&tb.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},tI(0,tY,"url",function(){return this._url}),tI(0,tY,"data",function(){return this._data}),tI(0,tY,"cache",function(){return this._cache}),tI(0,tY,"type",function(){return this._type}),tb.checkNext=function(){tb._isWorking=!0;for(var tD=tU.now();tb._startIndex<tb._loaders.length;)if(tU.now(),tb._loaders[tb._startIndex].endLoad(),tb._startIndex++,tU.now()-tD>tb.maxTimeOut)return console.warn("loader callback cost a long time:"+(tU.now()-tD)+" url="+tb._loaders[tb._startIndex-1].url),void t_.timer.frameOnce(1,null,tb.checkNext);tb._loaders.length=0,tb._startIndex=0,tb._isWorking=!1},tb.clearRes=function(tD,tY){if(null!=tD){void 0===tY&&(tY=!1),tD=ti.formatURL(tD);var tg=tb.getAtlas(tD);if(tg){for(var tT=0,tr=tg.length;tT<tr;tT++){var ts=tg[tT],ta=tb.getRes(ts);delete tb.loadedMap[ts],tb.clearCache(tD.substring(ti.basePath.length),ts.substring(ti.basePath.length)),ta&&ta.destroy(tY)}tg.length=0,delete tb.atlasMap[tD],delete tb.loadedMap[tD]}else{var tW=tb.loadedMap[tD];tW&&(delete tb.loadedMap[tD],tW instanceof laya.resource.Texture&&tW.bitmap&&tW.destroy(tY))}}},tb.clearTextureRes=function(tD){tD=ti.formatURL(tD);var tY=laya.net.Loader.getAtlas(tD),tg=tY&&0<tY.length?laya.net.Loader.getRes(tY[0]):laya.net.Loader.getRes(tD);tg&&tg.bitmap&&(tP.isConchApp&&!tP.isConchWebGL?tg.bitmap.source.releaseTexture&&tg.bitmap.source.releaseTexture():null==tg.bitmap._atlaser&&tg.bitmap.releaseResource(!0))},tb.getRes=function(tD){return tb.loadedMap[ti.formatURL(tD)]},tb.getAtlas=function(tD){return tb.atlasMap[ti.formatURL(tD)]},tb.cacheRes=function(tD,tY){tD=ti.formatURL(tD),null!=tb.loadedMap[tD]?console.warn("Resources already exist,is repeated loading:",tD):tb.loadedMap[tD]=tY},tb.setGroup=function(tD,tY){tb.groupMap[tY]||(tb.groupMap[tY]=[]),tb.groupMap[tY].push(tD)},tb.clearResByGroup=function(tD){if(tb.groupMap[tD]){var tY=tb.groupMap[tD],tg=0,tT=tY.length;for(tg=0;tg<tT;tg++)tb.clearRes(tY[tg]);tY.length=0}},tb.keepCache=function(tD,tY){if(tD&&tY){var tg=tb.cacheSet[tY];tg?-1==tg.indexOf(tD)&&tg.push(tD):tb.cacheSet[tY]=[tD]}},tb.clearCache=function(tD,tY){if(tD&&tY){var tg=tb.cacheSet[tY];if(tg){var tT=tg.indexOf(tD);if(-1!==tT){var tr=tg.length-1;0==tr?(delete tb.cacheSet[tY],0<tb.imgMgrSet[tY]?tN.imgMgrFree(tY,tb.imgMgrSet[tY]):tb.clearRes(tY,!0)):(tg[tT]=tg[tr],tg.length=tr)}}}},tb.saveObject=function(tD,tY,tg){if(tY&&tD){var tT=tb.objectSet[tD];tT?(console.warn("Loader.saveObject: "+tD),tT[0]=tY,tT[1]=tg):tb.objectSet[tD]=[tY,tg,[]]}},tb.findObject=function(tD){if(tD){var tY=tb.objectSet[tD];if(tY)return tY[0]}return null},tb.keepObject=function(tD,tY){if(tD&&tY){var tg=tb.objectSet[tY];tg&&-1===tg[2].indexOf(tD)&&tg[2].push(tD)}},tb.clearObject=function(tD,tY){if(tD&&tY){var tg=tb.objectSet[tY];if(tg){var tT=tg[2],tr=tT.indexOf(tD);if(-1!==tr){var ts=tT.length-1;0==ts?(delete tb.objectSet[tY],tg[1]&&tg[1].call(null,tg[0])):(tT[tr]=tT[ts],tT.length=ts)}}}},tb.TEXT="text",tb.JSON="json",tb.XML="xml",tb.BUFFER="arraybuffer",tb.IMAGE="image",tb.SOUND="sound",tb.ATLAS="atlas",tb.FONT="font",tb.TTF="ttf",tb.PLF="plf",tb.PKM="pkm",tb.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},tb.parserMap={},tb.groupMap={},tb.maxTimeOut=100,tb.loadedMap={},tb.preLoadedMap={},tb.atlasMap={},tb._loaders=[],tb._isWorking=!1,tb._startIndex=0,tb.imgCache={},tb.cacheSet={},tb.objectSet={},tb.imgMgrSet={},tb}(),tMD=function(tD){var tC;function tN(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},tN.__super.call(this);for(var tD=0;tD<this._maxPriority;tD++)this._resInfos[tD]=[]}tJ(tN,"laya.net.LoaderManager",tM);var tY=tN.prototype;return tY.create=function(tD,tg,tY,tT,tr,ts,ta,tW){if(null==ts&&(ts=2),null==ta&&(ta=!0),tD instanceof Array){var tM=tD,tE=tM.length,tI=0;if(tY)var tO=tj.create(tY.caller,tY.method,tY.args,!1);for(var tC=0;tC<tE;tC++){var tN=tM[tC];"string"==typeof tN&&(tN=tM[tC]={url:tN}),tN.progress=0}for(tC=0;tC<tE;tC++){tN=tM[tC];var t$=tY?tj.create(null,tx,[tN],!1):null,td=tY||tg?tj.create(null,tJ,[tN]):null;this._create(tN.url,td,t$,tN.clas||tT,tN.params||tr,null!=tN.priority&&0<=tN.priority?tN.priority:ts,ta,tN.group||tW)}function tJ(tD,tY){tI++,tD.progress=1,tI===tE&&tg&&tg.run()}function tx(tD,tY){tD.progress=tY;for(var tg=0,tT=0;tT<tE;tT++){tg+=tM[tT].progress}var tr=tg/tE;tO.runWith(tr)}return!0}return this._create(tD,tg,tY,tT,tr,ts,ta,tW)},tY._create=function(tY,tg,tD,tT,tr,ts,ta,tW){tY&&""!=tY||console.error("加载的url不合法 "+tY),null==ts&&(ts=2),null==ta&&(ta=!0);var tM=ti.formatURL(tY),tE=this.getRes(tM);if(tE)!tE.hasOwnProperty("loaded")||tE.loaded?(tD&&tD.runWith(1),tg&&tg.run()):tg&&t_.loader._createListener(tY,tg.caller,tg.method,tg.args,!0,!1);else{var tI=tL.getFileExtension(tY),tO=tN.createMap[tI];if(!tO)throw new Error("LoaderManager:unknown file("+tY+") extension with: "+tI+".");tT||(tT=tO[0]);var tC=tO[1];if("atlas"==tI)this.load(tY,tg,tD,tC,ts,ta);else{tT===tID&&(tC="htmlimage"),(tE=tT?new tT:null).hasOwnProperty("_loaded")&&(tE._loaded=!1),tE._setUrl(tY),tW&&tE._setGroup(tW),this._createLoad(tE,tY,tj.create(null,function(tD){tE&&!tE.destroyed&&tD&&tE.onAsynLoaded.call(tE,tY,tD,tr),tg&&tg.run();t_.loader.event(tY)}),tD,tC,ts,!1,tW,!0),ta&&this.cacheRes(tM,tE)}}return tE},tY.load=function(tD,tY,tg,tT,tr,ts,ta,tW){tD&&""!=tD||console.error("加载的url不合法 "+tD);var tM=this;if(null==tr&&(tr=2),null==ts&&(ts=!0),void 0===tW&&(tW=!1),tD instanceof Array)return this._loadAssets(tD,tY,tg,tT,tr,ts,ta);var tE=tWD.getRes(tD);if(null!=tE)t_.timer.frameOnce(1,null,function(){tg&&tg.runWith(1),tY&&tY.runWith(tE),tM._loaderCount||tM.event("complete")});else{var tI=tN._resMap[tD];tI?(tY&&tI._createListener("complete",tY.caller,tY.method,tY.args,!1,!1),tg&&tI._createListener("progress",tg.caller,tg.method,tg.args,!1,!1)):((tI=this._infoPool.length?this._infoPool.pop():new tC).url=tD,tI.clas=null,tI.type=tT,tI.cache=ts,tI.group=ta,tI.ignoreCache=tW,tI.priority=tr,tY&&tI.on("complete",tY.caller,tY.method,tY.args),tg&&tI.on("progress",tg.caller,tg.method,tg.args),tN._resMap[tD]=tI,tr=tr<this._maxPriority?0<=tr?tr:0:this._maxPriority-1,this._resInfos[tr].push(tI),this._next())}return this},tY.cancel=function(tD,tY,tg){if(tE=tN._resMap[tD]){tY&&tE.off("complete",tY.caller,tY.method,!1),tg&&tE.off("progress",tg.caller,tg.method,!1);var tT=tE.getListener("complete"),tr=tE.getListener("progress");if(!(tT&&tT.head||tr&&tr.head)){if(tE.loader){var ts=tE.loader;ts.imageCancel(tD),ts.offAll(),ts._data=null,ts._customParse=!1,ts._url=null,ts._class=null,ts._type=null,this._loaders.push(ts),this._loaderCount--,delete this._loaderMap[tE.url]}for(var ta=0;ta<this._maxPriority;ta++)for(var tW=this._resInfos[ta],tM=tW.length-1;-1<tM;tM--){var tE;(tE=tW[tM])&&tE.url===tD&&(tW[tM]=null,tE.destroy(),tE.offAll(),this._infoPool.push(tE))}delete tN._resMap[tD],this._next()}}},tY._createLoad=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){var tE=this;if(null==ts&&(ts=2),null==ta&&(ta=!0),void 0===tM&&(tM=!1),tY instanceof Array)return this._loadAssets(tY,tg,tT,tr,ts,ta,tW);var tI=tWD.getRes(tY);if(null!=tI)t_.timer.frameOnce(1,null,function(){tT&&tT.runWith(1),tg&&tg.runWith(tI),tE._loaderCount||tE.event("complete")});else{var tO=tN._resMap[tY];tO?(tg&&tO._createListener("complete",tg.caller,tg.method,tg.args,!1,!1),tT&&tO._createListener("progress",tT.caller,tT.method,tT.args,!1,!1)):((tO=this._infoPool.length?this._infoPool.pop():new tC).url=tY,tO.clas=tD,tO.type=tr,tO.cache=ta,tO.group=tW,tO.ignoreCache=tM,tO.priority=ts,tg&&tO.on("complete",tg.caller,tg.method,tg.args),tT&&tO.on("progress",tT.caller,tT.method,tT.args),tN._resMap[tY]=tO,ts=ts<this._maxPriority?0<=ts?ts:0:this._maxPriority-1,this._resInfos[ts].push(tO),this._next())}return this},tY._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var tD=0;tD<this._maxPriority;tD++)for(var tY=this._resInfos[tD];0<tY.length;){var tg=tY.shift();if(tg)return this._doLoad(tg)}this._loaderCount||this.event("complete")}},tY._doLoad=function(tY){var tg=this._loaders.length?this._loaders.pop():new tWD;this._loaderCount++,(this._loaderMap[tY.url]=tg).on("complete",null,tr),tg.on("progress",null,function(tD){tY.event("progress",tD)}),tg.on("error",null,function(tD){tr(null)}),tY.loader=tg;var tT=this;function tr(tD){tg.offAll(),tg._data=null,tg._customParse=!1,tg._url=null,tg._class=null,tg._type=null,tT._loaders.push(tg),tT._loaderCount--,delete tT._loaderMap[tY.url],tT._endLoad(tY,tD instanceof Array?[tD]:tD),tT._next()}tg._class=tY.clas,1<=tY.priority?(tg.priority=tY.priority,tg.realTime=!1):(tg.priority=0,tg.realTime=!0),tg.load(tY.url,tY.type,tY.cache,tY.group,tY.ignoreCache)},tY._endLoad=function(tD,tY){var tg=tD.url;if(null==tY){var tT=this._failRes[tg]||0;if(tT<this.retryNum)return console.warn("[warn]Retry to load:",tg),this._failRes[tg]=tT+1,void t_.timer.once(this.retryDelay,this,this._addReTry,[tD],!1);console.warn("[error]Failed to load:",tg),this.event("error",tg)}this._failRes[tg]&&(this._failRes[tg]=0),delete tN._resMap[tg],tD.event("complete",tY),tD.destroy(),tD.offAll(),this._infoPool.push(tD)},tY._addReTry=function(tD){this._resInfos[this._maxPriority-1].push(tD),this._next()},tY.clearRes=function(tD,tY){void 0===tY&&(tY=!1),tWD.clearRes(tD,tY)},tY.getRes=function(tD){return tWD.getRes(tD)},tY.cacheRes=function(tD,tY){tWD.cacheRes(tD,tY)},tY.clearTextureRes=function(tD){tWD.clearTextureRes(tD)},tY.setGroup=function(tD,tY){tWD.setGroup(tD,tY)},tY.clearResByGroup=function(tD){tWD.clearResByGroup(tD)},tY.clearUnLoaded=function(){for(var tD=0;tD<this._maxPriority;tD++){for(var tY=this._resInfos[tD],tg=tY.length-1;-1<tg;tg--){var tT=tY[tg];tT&&(tT.destroy(),tT.offAll(),this._infoPool.push(tT))}tY.length=0}this._loaderCount=0,tN._resMap={}},tY.cancelLoadByUrls=function(tD){if(tD)for(var tY=0,tg=tD.length;tY<tg;tY++)this.cancelLoadByUrl(tD[tY])},tY.cancelLoadByUrl=function(tD){for(var tY=0;tY<this._maxPriority;tY++)for(var tg=this._resInfos[tY],tT=tg.length-1;-1<tT;tT--){var tr=tg[tT];tr&&tr.url===tD&&(tg[tT]=null,tr.destroy(),tr.offAll(),this._infoPool.push(tr))}tN._resMap[tD]&&delete tN._resMap[tD]},tY._loadAssets=function(tD,tg,ta,tY,tT,tr,ts){null==tT&&(tT=2),null==tr&&(tr=!0);for(var tW=tD.length,tM=0,tE=0,tI=[],tO=!0,tC=0;tC<tW;tC++){var tN=tD[tC];if(!tN)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+tD);"string"==typeof tN&&(tN={url:tN,type:tY,size:1,priority:tT}),tN.size||(tN.size=1),tN.progress=0,tE+=tN.size,tI.push(tN);var t$=ta?tj.create(null,tx,[tN],!1):null,td=tg||ta?tj.create(null,tJ,[tN]):null;this.load(tN.url,td,t$,tN.type,null!=tN.priority&&0<=tN.priority?tN.priority:2,tr,tN.group||ts)}function tJ(tD,tY){tM++,tD.progress=1,tY||(tO=!1),tM===tW&&tg&&tg.runWith(tO)}function tx(tD,tY){if(null!=ta){tD.progress=tY;for(var tg=0,tT=0;tT<tI.length;tT++){var tr=tI[tT];tg+=tr.size*tr.progress}var ts=tg/tE;ta.runWith(ts)}}return this},tN.cacheRes=function(tD,tY){tWD.cacheRes(tD,tY)},tN._resMap={},ta(tN,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),tN.__init$=function(){tC=function(tD){function tY(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,tY.__super.call(this)}return tJ(tY,"",tM),tY.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},tY}()},tN}(),tED=(function(tD){function tr(tD){tr.__super.call(this),tD||(tD=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var tY=0,tg=0,tT=0;tT<20;tT++)tT%5!=4?this._mat[tY++]=tD[tT]:this._alpha[tg++]=tD[tT];this._action=tz.createFilterAction(32),this._action.data=this}tJ(tr,"laya.filters.ColorFilter",tx);var tY=tr.prototype;t_.imps(tY,{"laya.filters.IFilter":!0}),tY.callNative=function(tD){tD._$P.cf=this;tD.conchModel&&tD.conchModel.setFilterMatrix&&tD.conchModel.setFilterMatrix(this._mat,this._alpha)},tI(0,tY,"type",function(){return 32}),tI(0,tY,"action",function(){return this._action})}(),function(tD){function tT(tD,tY,tg){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===tY&&(tY=0),tT.__super.call(this),this._byteClass=tg||tF,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,tD&&0<tY&&tY<65535&&this.connect(tD,tY)}tJ(tT,"laya.net.Socket",tM);var tY=tT.prototype;tY.connect=function(tD,tY){var tg="ws://"+tD+":"+tY;tg="https:"==tU.window.location.protocol?"wss://"+tD+":"+tY:"ws://"+tD+":"+tY,this.connectByUrl(tg)},tY.connectByUrl=function(tD){var tY=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new tU.window.WebSocket(tD,this.protocols):this._socket=new tU.window.WebSocket(tD),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(tD){tY._onOpen(tD)},this._socket.onmessage=function(tD){tY._onMessage(tD)},this._socket.onclose=function(tD){tY._onClose(tD)},this._socket.onerror=function(tD){tY._onError(tD)}},tY.cleanSocket=function(){try{this._socket.close()}catch(tD){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},tY.close=function(){if(null!=this._socket)try{this._socket.close()}catch(tD){}},tY._onOpen=function(tD){this._connected=!0,this.event("open",tD)},tY._onMessage=function(tD){if(tD&&tD.data){var tY=tD.data;if(this.disableInput&&tY)this.event("message",tY);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var tg=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,tY&&("string"==typeof tY?this._input.writeUTFBytes(tY):this._input.writeArrayBuffer(tY),this._addInputPosition=this._input.pos,this._input.pos=tg),this.event("message",tY)}}},tY._onClose=function(tD){this._connected=!1,this.event("close",tD)},tY._onError=function(tD){this.event("error",tD)},tY.send=function(tD){this._socket.send(tD)},tY.flush=function(){if(this._output&&0<this._output.length){var tY;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(tD){tY=tD}this._output.endian=this.endian,this._output.clear(),tY&&this.event("error",tY)}},tI(0,tY,"input",function(){return this._input}),tI(0,tY,"output",function(){return this._output}),tI(0,tY,"connected",function(){return this._connected}),tI(0,tY,"endian",function(){return this._endian},function(tD){this._endian=tD,null!=this._input&&(this._input.endian=tD),null!=this._output&&(this._output.endian=tD)}),tT.LITTLE_ENDIAN="littleEndian",tT.BIG_ENDIAN="bigEndian"}(),function(tD){function tW(){tW.__super.call(this),this._$1__id=++tW._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(tW._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,tS.currentResourceManager&&tS.currentResourceManager.addResource(this)}tJ(tW,"laya.resource.Resource",tM);var tY=tW.prototype;return t_.imps(tY,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),tY._setUrl=function(tD){var tY;this._url!==tD&&(this._url&&((tY=tW._urlResourcesMap[this._url]).splice(tY.indexOf(this),1),0===tY.length&&delete tW._urlResourcesMap[this._url]),tD&&((tY=tW._urlResourcesMap[tD])||(tW._urlResourcesMap[tD]=tY=[]),tY.push(this)),this._url=tD)},tY._getGroup=function(){return this._group},tY._setGroup=function(tD){var tY;this._group!==tD&&(this._group&&((tY=tW._groupResourcesMap[this._group]).splice(tY.indexOf(this),1),0===tY.length&&delete tW._groupResourcesMap[this._group]),tD&&((tY=tW._groupResourcesMap[tD])||(tW._groupResourcesMap[tD]=tY=[]),tY.push(this)),this._group=tD)},tY._addReference=function(){this._referenceCount++},tY._removeReference=function(){this._referenceCount--},tY._clearReference=function(){this._referenceCount=0},tY._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},tY.recreateResource=function(){this.completeCreate()},tY.disposeResource=function(){},tY.activeResource=function(tD){void 0===tD&&(tD=!1),this._lastUseFrameCount=to.loopCount,!this._destroyed&&this.__loaded&&(this._released||tD)&&this.recreateResource()},tY.releaseResource=function(tD){return void 0===tD&&(tD=!0),!(!tD&&this.lock)&&(!(this._released&&!tD)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},tY.onAsynLoaded=function(tD,tY,tg){throw new Error("Resource: must override this function!")},tY.destroy=function(){var tD;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete tW._idResourcesMap[this.id],this._url&&((tD=tW._urlResourcesMap[this._url])&&(tD.splice(tD.indexOf(this),1),0===tD.length&&delete tW._urlResourcesMap[this.url]),tWD.clearRes(this._url),this.__loaded||tz.cancelLoadByUrl(this._url)),this._group&&((tD=tW._groupResourcesMap[this._group]).splice(tD.indexOf(this),1),0===tD.length&&delete tW._groupResourcesMap[this.url]))},tY.completeCreate=function(){this._released=!1,this.event("recovered",this)},tY.dispose=function(){this.destroy()},tI(0,tY,"memorySize",function(){return this._memorySize},function(tD){var tY=tD-this._memorySize;this._memorySize=tD,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,tY),this.resourceManager&&this.resourceManager.addSize(tY)}),tI(0,tY,"_loaded",null,function(tD){this.__loaded=tD}),tI(0,tY,"loaded",function(){return this.__loaded}),tI(0,tY,"id",function(){return this._$1__id}),tI(0,tY,"destroyed",function(){return this._destroyed}),tI(0,tY,"group",function(){return this._getGroup()},function(tD){this._setGroup(tD)}),tI(0,tY,"resourceManager",function(){return this._resourceManager}),tI(0,tY,"url",function(){return this._url}),tI(0,tY,"released",function(){return this._released}),tI(0,tY,"referenceCount",function(){return this._referenceCount}),tW.getResourceByID=function(tD){return tW._idResourcesMap[tD]},tW.getResourceByURL=function(tD,tY){return void 0===tY&&(tY=0),null==tW._urlResourcesMap[tD]?null:tW._urlResourcesMap[tD][tY]},tW.getResourceCountByURL=function(tD){return tW._urlResourcesMap[tD].length},tW.destroyUnusedResources=function(tD){var tY;if(tD){var tg=tW._groupResourcesMap[tD];if(tg)for(var tT=tg.slice(),tr=0,ts=tT.length;tr<ts;tr++)(tY=tT[tr]).lock||0!==tY._referenceCount||tY.destroy()}else for(var ta in tW._idResourcesMap)(tY=tW._idResourcesMap[ta]).lock||0!==tY._referenceCount||tY.destroy()},tW._uniqueIDCounter=0,tW._idResourcesMap={},tW._urlResourcesMap={},tW._groupResourcesMap={},tW}()),tID=function(tD){function tb(tD,tY){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,tb.__super.call(this),tD&&null!=tD._addReference&&tD._addReference(),this.setTo(tD,tY)}tJ(tb,"laya.resource.Texture",tM);var tY=tb.prototype;return tY._setUrl=function(tD){this.url=tD},tY.setTo=function(tD,tY){if(tD instanceof tN.HTMLElement){var tg=tZD.create("2D",tD);this.bitmap=tg}else this.bitmap=tD;if(this.uv=tY||tb.DEF_UV,tD){this._w=tD.width,this._h=tD.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var tT=this;if(this._loaded)tz.addToAtlas&&tz.addToAtlas(tT);else{var tr=tD;tr instanceof laya.resource.HTMLImage&&tr.image&&tr.image.addEventListener("load",function(tD){tz.addToAtlas&&tz.addToAtlas(tT)},!1)}}},tY.active=function(){this.bitmap&&this.bitmap.activeResource()},tY.destroy=function(tD){if(void 0===tD&&(tD=!1),this.alphaTexture&&(this.alphaTexture.destroy(tD),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var tY=this.bitmap;tD?(tP.isConchApp&&tY.source&&tY.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,tY.dispose(),tY._clearReference()):(tY._removeReference(),0==tY.referenceCount&&(tP.isConchApp&&tY.source&&tY.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,tY.dispose())),this.url&&this===t_.loader.getRes(this.url)&&t_.loader.clearRes(this.url,tD),this._loaded=!1}},tY.load=function(tD){var tY=this;this._loaded=!1,tD=ti.customFormat(tD);var tg=this.bitmap||(this.bitmap=ttD.create(tD));tg.uri=tD,tg&&tg._addReference();var tT=this;tg.onload=function(){tg.onload=null,tT._loaded=!0,tY.sourceWidth=tY._w=tg.width,tY.sourceHeight=tY._h=tg.height,tT.event("loaded",this),tz.addToAtlas&&tz.addToAtlas(tT)}},tY.addTextureToAtlas=function(tD){tz.addTextureToAtlas(this)},tY.getPixels=function(tD,tY,tg,tT){if(tP.isConchApp){var tr=this.bitmap;if(tr.source&&tr.source.getImageData){var ts=tr.source.getImageData(tD,tY,tg,tT),ta=new Uint8Array(ts);return Array.from(ta)}return null}return tP.isWebGL?tz.getTexturePixels(this,tD,tY,tg,tT):(tU.canvas.size(tg,tT),tU.canvas.clear(),tU.context.drawTexture(this,-tD,-tY,this.width,this.height,0,0),tU.context.getImageData(0,0,tg,tT).data)},tY.onAsynLoaded=function(tD,tY){if(tY){if("function"!=typeof tY._addReference)throw new Error("bitmap._addReference is not a function. "+tY.className+" "+typeof tY._addReference+" "+tY.constructor);tY._addReference()}this.setTo(tY,this.uv),this._loaded&&this.event("loaded",this)},tI(0,tY,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),tI(0,tY,"loaded",function(){return this._loaded}),tI(0,tY,"released",function(){return!this.bitmap||this.bitmap.released}),tI(0,tY,"width",function(){return this._w?this._w:this.uv&&this.uv!==tb.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(tD){this._w=tD,this.sourceWidth||(this.sourceWidth=tD)}),tI(0,tY,"repeat",function(){return!tP.isWebGL||!this.bitmap||this.bitmap.repeat},function(tD){tD&&tP.isWebGL&&this.bitmap&&(this.bitmap.repeat=tD)&&(this.bitmap.enableMerageInAtlas=!1)}),tI(0,tY,"height",function(){return this._h?this._h:this.uv&&this.uv!==tb.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(tD){this._h=tD,this.sourceHeight||(this.sourceHeight=tD)}),tI(0,tY,"isLinearSampling",function(){return!tP.isWebGL||9728!=this.bitmap.minFifter},function(tD){!tD&&tP.isWebGL&&(tD||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),tb.moveUV=function(tD,tY,tg){for(var tT=0;tT<8;tT+=2)tg[tT]+=tD,tg[tT+1]+=tY;return tg},tb.create=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){void 0===ts&&(ts=0),void 0===ta&&(ta=0),void 0===tW&&(tW=0),void 0===tM&&(tM=0);var tE=tD instanceof laya.resource.Texture,tI=tE?tD.uv:tb.DEF_UV,tO=tE?tD.bitmap:tD,tC=tz.isAtlas(tO);if(tC){var tN=tO._atlaser,t$=tD._atlasID;if(-1==t$)throw new Error("create texture error");tO=tN._inAtlasTextureBitmapValue[t$],tI=tN._inAtlasTextureOriUVValue[t$]}var td=new tb(tO,null);if(!tO)return null;tO.width&&tY+tT>tO.width&&(tT=tO.width-tY),tO.height&&tg+tr>tO.height&&(tr=tO.height-tg),td.width=tT,td.height=tr,td.offsetX=ts,td.offsetY=ta,td.sourceWidth=tW||tT,td.sourceHeight=tM||tr;var tJ=1/tO.width,tx=1/tO.height;tY*=tJ,tg*=tx,tT*=tJ,tr*=tx;var tj=td.uv[0],tZ=td.uv[1],tp=td.uv[4],tl=td.uv[5],tt=tp-tj,t_=tl-tZ,tA=tb.moveUV(tI[0],tI[1],[tY,tg,tY+tT,tg,tY+tT,tg+tr,tY,tg+tr]);td.uv=[tj+tA[0]*tt,tZ+tA[1]*t_,tp-(1-tA[2])*tt,tZ+tA[3]*t_,tp-(1-tA[4])*tt,tl-(1-tA[5])*t_,tj+tA[6]*tt,tl-(1-tA[7])*t_],tC&&td.addTextureToAtlas();var tq=tO.scaleRate;return tq&&1!=tq?(td.sourceWidth/=tq,td.sourceHeight/=tq,td.width/=tq,td.height/=tq,td.scaleRate=tq,td.offsetX/=tq,td.offsetY/=tq):td.scaleRate=1,td},tb.createFromTexture=function(tD,tY,tg,tT,tr){var ts=tD.scaleRate;1!=ts&&(tY*=ts,tg*=ts,tT*=ts,tr*=ts);var ta=tq.TEMP.setTo(tY-tD.offsetX,tg-tD.offsetY,tT,tr),tW=ta.intersection(tb._rect1.setTo(0,0,tD.width,tD.height),tb._rect2);if(!tW)return null;var tM=tb.create(tD,tW.x,tW.y,tW.width,tW.height,tW.x-ta.x,tW.y-ta.y,tT,tr);if(tM.bitmap&&tM.bitmap._removeReference)return tM.bitmap._removeReference(),tM;var tE="bitmap:"+(tM.bitmap?tM.bitmap.constructor?tM.bitmap.constructor.name:tM.bitmap.__className:"")+", url:"+(tD.url+" | "+(tM.bitmap?tM.bitmap.url:tD.url))+", x="+tY+",y="+tg+",width="+tT+",height="+tr+", result="+(tW?tW.x+","+tW.y+","+tW.width+","+tW.height:"null")+", rect="+ta.x+","+ta.y+","+ta.width+","+ta.height;throw new Error("报错：bitmap._removeReference is not a function  "+tE)},tb.DEF_UV=[0,0,1,0,1,1,0,1],tb.INV_UV=[0,1,1,1,1,0,0,0],tb._rect1=new tq,tb._rect2=new tq,tb}(),tD=function(tD){var tW;function ts(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,ts.__super.call(this)}tJ(ts,"laya.utils.TimeLine",tM);var tY=ts.prototype;return tY.to=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=0),this._create(tD,tY,tg,tT,tr,!0)},tY.from=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=0),this._create(tD,tY,tg,tT,tr,!1)},tY._create=function(tD,tY,tg,tT,tr,ts){var ta=tK.getItemByClass("tweenData",tW);return ta.isTo=ts,ta.type=0,ta.target=tD,ta.duration=tg,ta.data=tY,ta.startTime=this._startTime+tr,ta.endTime=ta.startTime+ta.duration,ta.ease=tT,this._startTime=Math.max(ta.endTime,this._startTime),this._tweenDataList.push(ta),this._startTimeSort=!0,this._endTimeSort=!0,this},tY.addLabel=function(tD,tY){var tg=tK.getItemByClass("tweenData",tW);return tg.type=1,tg.data=tD,tg.endTime=tg.startTime=this._startTime+tY,this._labelDic||(this._labelDic={}),this._labelDic[tD]=tg,this._tweenDataList.push(tg),this},tY.removeLabel=function(tD){if(this._labelDic&&this._labelDic[tD]){var tY=this._labelDic[tD];if(tY){var tg=this._tweenDataList.indexOf(tY);-1<tg&&this._tweenDataList.splice(tg,1)}delete this._labelDic[tD]}},tY.gotoTime=function(tD){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var tY,tg,tT,tr;for(var ts in this._firstTweenDic)if(tg=this._firstTweenDic[ts])for(var ta in tg)tg.diyTarget.hasOwnProperty(ta)&&(tg.diyTarget[ta]=tg[ta]);for(ts in this._tweenDic)(tY=this._tweenDic[ts]).clear(),delete this._tweenDic[ts];if(this._index=0,this._gidIndex=0,this._currTime=tD,this._lastTime=tU.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=tT=this._tweenDataList.concat(),tT.sort(function(tD,tY){return tD.endTime>tY.endTime?1:tD.endTime<tY.endTime?-1:0})}else tT=this._endTweenDataList;for(var tW=0,tM=tT.length;tW<tM;tW++)if(0==(tr=tT[tW]).type){if(!(tD>=tr.endTime))break;this._index=Math.max(this._index,tW+1);var tE=tr.data;if(tr.isTo)for(var tI in tE)tr.target[tI]=tE[tI]}for(tW=0,tM=this._tweenDataList.length;tW<tM;tW++)0==(tr=this._tweenDataList[tW]).type&&tD>=tr.startTime&&tD<tr.endTime&&(this._index=Math.max(this._index,tW+1),this._gidIndex++,(tY=tK.getItemByClass("tween",tQ))._create(tr.target,tr.data,tr.duration,tr.ease,tj.create(this,this._animComplete,[this._gidIndex]),0,!1,tr.isTo,!0,!1),tY.setStartTime(this._currTime-(tD-tr.startTime)),tY._updateEase(this._currTime),tY.gid=this._gidIndex,this._tweenDic[this._gidIndex]=tY)}},tY.gotoLabel=function(tD){if(null!=this._labelDic){var tY=this._labelDic[tD];tY&&this.gotoTime(tY.startTime)}},tY.pause=function(){t_.timer.clear(this,this._update)},tY.resume=function(){this.play(this._currTime,this._loopKey)},tY.play=function(tD,tY){if(void 0===tD&&(tD=0),void 0===tY&&(tY=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(tD,tY){return tD.startTime>tY.startTime?1:tD.startTime<tY.startTime?-1:0});for(var tg=0,tT=this._tweenDataList.length;tg<tT;tg++){var tr=this._tweenDataList[tg];if(null!=tr&&0==tr.type){var ts=tr.target,ta=ts.$_GID||(ts.$_GID=tL.getGID()),tW=null;for(var tM in null==this._firstTweenDic[ta]?((tW={}).diyTarget=ts,this._firstTweenDic[ta]=tW):tW=this._firstTweenDic[ta],tr.data)null==tW[tM]&&(tW[tM]=ts[tM])}}}"string"==typeof tD?this.gotoLabel(tD):this.gotoTime(tD),this._loopKey=tY,this._lastTime=tU.now(),t_.timer.frameLoop(1,this,this._update)}},tY._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var tD in this._tweenDic)(tY=this._tweenDic[tD]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var tY,tg=tU.now(),tT=tg-this._lastTime,tr=this._currTime+=tT*this.scale;for(tD in this._lastTime=tg,this._tweenDic)(tY=this._tweenDic[tD])._updateEase(tr);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var ts=this._tweenDataList[this._index];tr>=ts.startTime&&(this._index++,0==ts.type?(this._gidIndex++,(tY=tK.getItemByClass("tween",tQ))._create(ts.target,ts.data,ts.duration,ts.ease,tj.create(this,this._animComplete,[this._gidIndex]),0,!1,ts.isTo,!0,!1),tY.setStartTime(tr),tY.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=tY)._updateEase(tr)):this.event("label",ts.data))}},tY._animComplete=function(tD){this._tweenDic[tD]&&delete this._tweenDic[tD]},tY._complete=function(){this.event("complete")},tY.reset=function(){var tD;if(this._labelDic)for(tD in this._labelDic)delete this._labelDic[tD];for(tD in this._tweenDic)this._tweenDic[tD].clear(),delete this._tweenDic[tD];for(tD in this._firstTweenDic)delete this._firstTweenDic[tD];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var tY,tg=0;for(tY=this._tweenDataList.length,tg=0;tg<tY;tg++)this._tweenDataList[tg]&&this._tweenDataList[tg].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,t_.timer.clear(this,this._update)},tY.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},tI(0,tY,"index",function(){return this._frameIndex},function(tD){this._frameIndex=tD,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),tI(0,tY,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),ts.to=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=0),(new ts).to(tD,tY,tg,tT,tr)},ts.from=function(tD,tY,tg,tT,tr){return void 0===tr&&(tr=0),(new ts).from(tD,tY,tg,tT,tr)},ts.__init$=function(){tW=function(){function tD(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return tJ(tD,""),tD.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,tK.recover("tweenData",this)},tD}()},ts}(),tOD=function(tr){function tg(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,tg.__super.call(this),this._style=tW.EMPTY}tJ(tg,"laya.display.Sprite",tr);var tD=tg.prototype;return t_.imps(tD,{"laya.display.ILayout":!0}),tD.createConchModel=function(){return new ConchNode},tD.destroy=function(tD){if(void 0===tD&&(tD=!0),this._releaseMem(),!this._destroyed){this.filters=null;var tY=this.mask;tY&&(this.mask=null,tY.destroy(tD))}tr.prototype.destroy.call(this,tD),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},tD.updateZOrder=function(){tL.updateOrder(this._childs)&&this.repaint()},tD.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},tD.setBounds=function(tD){this._set$P("uBounds",tD)},tD.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new tq),tq._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},tD.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new tq),tq._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},tD._boundPointsToParent=function(tD){void 0===tD&&(tD=!1);var tY=0,tg=0;this._style&&(tY=this._style._tf.translateX,tg=this._style._tf.translateY,tD=tD||0!==this._style._tf.rotate,this._style.scrollRect&&(tY+=this._style.scrollRect.x,tg+=this._style.scrollRect.y));var tT=this._getBoundPointsM(tD);if(!tT||tT.length<1)return tT;if(8!=tT.length&&(tT=tD?tl.scanPList(tT):tq._getWrapRec(tT,tq.TEMP)._getBoundPoints()),!this.transform)return tL.transPointList(tT,this._x-tY,this._y-tg),tT;var tr=tA.TEMP,ts=0,ta=tT.length;for(ts=0;ts<ta;ts+=2)tr.x=tT[ts],tr.y=tT[ts+1],this.toParentPoint(tr),tT[ts]=tr.x,tT[ts+1]=tr.y;return tT},tD.getGraphicBounds=function(tD){return void 0===tD&&(tD=!1),this._graphics?this._graphics.getBounds(tD):tq.TEMP.setTo(0,0,0,0)},tD._getBoundPointsM=function(tD){if(void 0===tD&&(tD=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var tY=tL.clearArray(this._$P.temBM),tg=tq.TEMP;return tg.copyFrom(this.scrollRect),tL.concatArray(tY,tg._getBoundPoints()),tY}for(var tT,tr,ts,ta=this._graphics?this._graphics.getBoundPoints():tL.clearArray(this._$P.temBM),tW=0,tM=(ts=this._childs).length;tW<tM;tW++)(tT=ts[tW])instanceof laya.display.Sprite&&1==tT.visible&&(tr=tT._boundPointsToParent(tD))&&(ta=ta?tL.concatArray(ta,tr):tr);return ta},tD.getStyle=function(){return this._style===tW.EMPTY&&(this._style=new tW),this._style},tD.setStyle=function(tD){this._style=tD},tD._adjustTransform=function(){this._tfChanged=!1;var tD,tY=this._style._tf,tg=tY.scaleX,tT=tY.scaleY;if(tY.rotate||1!==tg||1!==tT||tY.skewX||tY.skewY){(tD=this._transform||(this._transform=tm.create())).bTransform=!0;var tr=.0174532922222222*(tY.rotate-tY.skewX),ts=.0174532922222222*(tY.rotate+tY.skewY),ta=Math.cos(ts),tW=Math.sin(ts),tM=Math.sin(tr),tE=Math.cos(tr);return tD.a=tg*ta,tD.b=tg*tW,tD.c=-tT*tM,tD.d=tT*tE,tD.tx=tD.ty=0,tD}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,tD},tD.pos=function(tD,tY,tg){if(void 0===tg&&(tg=!1),this._x!==tD||this._y!==tY){if(this.destroyed)return this;if(tg){this._x=tD,this._y=tY,this.conchModel&&this.conchModel.pos(this._x,this._y);var tT=this._parent;tT&&0===tT._repaint&&(tT._repaint=1,tT.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=tD,this.y=tY}return this},tD.pivot=function(tD,tY){return this.pivotX=tD,this.pivotY=tY,this},tD.size=function(tD,tY){return this.width=tD,this.height=tY,this},tD.scale=function(tD,tY,tg){void 0===tg&&(tg=!1);var tT=this.getStyle(),tr=tT._tf;if(tr.scaleX!=tD||tr.scaleY!=tY){if(this.destroyed)return this;if(tg){tT.setScale(tD,tY),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(tD,tY),this._renderType|=4;var ts=this._parent;ts&&0===ts._repaint&&(ts._repaint=1,ts.parentRepaint())}else this.scaleX=tD,this.scaleY=tY}return this},tD.skew=function(tD,tY){return this.skewX=tD,this.skewY=tY,this},tD.render=function(tD,tY,tg){to.spriteCount++,tH.renders[this._renderType]._fun(this,tD,tY+this._x,tg+this._y),this._repaint=0},tD.drawToCanvas=function(tD,tY,tg,tT){if(tP.isConchNode){var tr=tZD.create("2D");return new tB(tD,tY,tr).ctx.setCanvasType(1),this.conchModel.drawToCanvas(tr.source,tg,tT),tr}return tz.drawToCanvas(this,this._renderType,tD,tY,tg,tT)},tD.customRender=function(tD,tY,tg){this._renderType|=1024},tD._applyFilters=function(){var tD;if(!tP.isWebGL&&((tD=this._$P.filters)&&!(tD.length<1)))for(var tY=0,tg=tD.length;tY<tg;tY++)tD[tY].action.apply(this._$P.cacheCanvas)},tD._isHaveGlowFilter=function(){var tD,tY=0;if(this.filters)for(tY=0;tY<this.filters.length;tY++)if(8==this.filters[tY].type)return!0;for(tY=0,tD=this._childs.length;tY<tD;tY++)if(this._childs[tY]._isHaveGlowFilter())return!0;return!1},tD.localToGlobal=function(tD,tY){void 0===tY&&(tY=!1),!0===tY&&(tD=new tA(tD.x,tD.y));for(var tg=this;tg&&tg!=t_.stage;)tD=tg.toParentPoint(tD),tg=tg.parent;return tD},tD.globalToLocal=function(tD,tY){void 0===tY&&(tY=!1),tY&&(tD=new tA(tD.x,tD.y));for(var tg=this,tT=[];tg&&tg!=t_.stage;)tT.push(tg),tg=tg.parent;for(var tr=tT.length-1;0<=tr;)tD=(tg=tT[tr]).fromParentPoint(tD),tr--;return tD},tD.toParentPoint=function(tD){if(!tD)return tD;tD.x-=this.pivotX,tD.y-=this.pivotY,this.transform&&this._transform.transformPoint(tD),tD.x+=this._x,tD.y+=this._y;var tY=this._style.scrollRect;return tY&&(tD.x-=tY.x,tD.y-=tY.y),tD},tD.fromParentPoint=function(tD){if(!tD)return tD;tD.x-=this._x,tD.y-=this._y;var tY=this._style.scrollRect;return tY&&(tD.x+=tY.x,tD.y+=tY.y),this.transform&&this._transform.invertTransformPoint(tD),tD.x+=this.pivotX,tD.y+=this.pivotY,tD},tD.on=function(tD,tY,tg,tT){return 1!==this._mouseEnableState&&this.isMouseEvent(tD)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(tD,tY,tg,tT,!1)):tr.prototype.on.call(this,tD,tY,tg,tT)},tD.once=function(tD,tY,tg,tT){return 1!==this._mouseEnableState&&this.isMouseEvent(tD)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(tD,tY,tg,tT,!0)):tr.prototype.once.call(this,tD,tY,tg,tT)},tD._$2__onDisplay=function(){if(1!==this._mouseEnableState){var tD=this;for(tD=tD.parent;tD&&1!==tD._mouseEnableState&&!tD._getBit(2);)tD.mouseEnabled=!0,tD._setBit(2,!0),tD=tD.parent}},tD.loadImage=function(tD,tY,tg,tT,tr,ts){var ta=this;return void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0),void 0===tr&&(tr=0),this.graphics.loadImage(tD,tY,tg,tT,tr,function(tD){ta.destroyed||(ta.size(tY+(tT||tD.width),tg+(tr||tD.height)),ta.repaint(),ts&&ts.runWith(tD))}),this},tD.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},tD._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},tD._childChanged=function(tD){this._childs.length?this._renderType|=2048:this._renderType&=-2049,tD&&this._get$P("hasZorder")&&t_.timer.callLater(this,this.updateZOrder),this.repaint()},tD.parentRepaint=function(){var tD=this._parent;tD&&0===tD._repaint&&(tD._repaint=1,tD.parentRepaint())},tD.startDrag=function(tD,tY,tg,tT,tr,ts,ta){void 0===tY&&(tY=!1),void 0===tg&&(tg=0),void 0===tT&&(tT=300),void 0===ts&&(ts=!1),void 0===ta&&(ta=.92),this._$P.dragging||this._set$P("dragging",new te),this._$P.dragging.start(this,tD,tY,tg,tT,tr,ts,ta)},tD.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},tD._releaseMem=function(){if(this._$P){var tD=this._$P.cacheCanvas;tD&&tD.ctx&&(tK.recover("RenderContext",tD.ctx),tD.ctx.canvas.size(0,0),tD.ctx=null);var tY=this._$P._filterCache;tY&&(tY.destroy(),tY.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},tD._setDisplay=function(tD){tD||this._releaseMem(),tr.prototype._setDisplay.call(this,tD)},tD.hitTestPoint=function(tD,tY){var tg=this.globalToLocal(tA.TEMP.setTo(tD,tY));return tD=tg.x,tY=tg.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?tq.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(tD,tY)},tD.getMousePoint=function(){return this.globalToLocal(tA.TEMP.setTo(t_.stage.mouseX,t_.stage.mouseY))},tD._getWords=function(){return null},tD._addChildsToLayout=function(tD){var tY=this._getWords();if(null==tY&&0==this._childs.length)return!1;if(tY)for(var tg=0,tT=tY.length;tg<tT;tg++)tD.push(tY[tg]);tg=0;for(var tr=this._childs.length;tg<tr;++tg){var ts=this._childs[tg];ts._style._enableLayout()&&ts._addToLayout(tD)}return!0},tD._addToLayout=function(tD){this._style.absolute||(this._style.block?tD.push(this):this._addChildsToLayout(tD)&&(this.x=this.y=0))},tD._isChar=function(){return!1},tD._getCSSStyle=function(){return this._style.getCSSStyle()},tD._setAttributes=function(tD,tY){switch(tD){case"x":this.x=parseFloat(tY);break;case"y":this.y=parseFloat(tY);break;case"width":this.width=parseFloat(tY);break;case"height":this.height=parseFloat(tY);break;default:this[tD]=tY}},tD._layoutLater=function(){this.parent&&this.parent._layoutLater()},tI(0,tD,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(tD){this._optimizeScrollRect!=tD&&(this._optimizeScrollRect=tD,this.conchModel&&this.conchModel.optimizeScrollRect(tD))}),tI(0,tD,"customRenderEnable",null,function(tD){if(tD&&(this._renderType|=1024,tP.isConchNode)){tg.CustomList.push(this);var tY=new tZD("2d");tY._setContext(new CanvasRenderingContext2D),this.customContext=new tB(0,0,tY),tY.context.setCanvasType&&tY.context.setCanvasType(2),this.conchModel.custom(tY.context)}}),tI(0,tD,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(tD){this.cacheAs=tD?this._$P.hasFilter?"none":"normal":"none"}),tI(0,tD,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(tD){var tY=this._$P.cacheCanvas;if(tD!==(tY?tY.type:"none")){if("none"!==tD)this._getBit(1)||this._setUpNoticeType(1),tY||(tY=this._set$P("cacheCanvas",tK.getItemByClass("cacheCanvas",Object))),tY.type=tD,tY.reCache=!0,this._renderType|=16,"bitmap"==tD&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(tY){var tg=tY;tg&&tg.ctx&&(tK.recover("RenderContext",tg.ctx),tg.ctx.canvas.size(0,0),tg.ctx=null),tK.recover("cacheCanvas",tY)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),tI(0,tD,"zOrder",function(){return this._zOrder},function(tD){this._zOrder!=tD&&(this._zOrder=tD,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(tD),this._parent&&(tD&&this._parent._set$P("hasZorder",!0),t_.timer.callLater(this._parent,this.updateZOrder)))}),tI(0,tD,"rotation",function(){return this._style._tf.rotate},function(tD){var tY=this.getStyle();if(tY._tf.rotate!==tD){tY.setRotate(tD),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(tD),this._renderType|=4;var tg=this._parent;tg&&0===tg._repaint&&(tg._repaint=1,tg.parentRepaint())}}),tI(0,tD,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(tD){this._width!==tD&&(this._width=tD,this.conchModel&&this.conchModel.size(tD,this._height),this.repaint())}),tI(0,tD,"x",function(){return this._x},function(tD){if(this._x!==tD){if(this.destroyed)return;this._x=tD,this.conchModel&&this.conchModel.pos(tD,this._y);var tY=this._parent;tY&&0===tY._repaint&&(tY._repaint=1,tY.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),tI(0,tD,"globalScaleY",function(){for(var tD=1,tY=this;tY&&tY!==t_.stage;)tD*=tY.scaleY,tY=tY.parent;return tD}),tI(0,tD,"hitArea",function(){return this._$P.hitArea},function(tD){this._set$P("hitArea",tD)}),tI(0,tD,"staticCache",function(){return this._$P.staticCache},function(tD){this._set$P("staticCache",tD),tD||this.reCache()}),tI(0,tD,"texture",function(){return this._texture},function(tD){this._texture!=tD&&(this._texture=tD,this.graphics.cleanByTexture(tD,0,0))}),tI(0,tD,"y",function(){return this._y},function(tD){if(this._y!==tD){if(this.destroyed)return;this._y=tD,this.conchModel&&this.conchModel.pos(this._x,tD);var tY=this._parent;tY&&0===tY._repaint&&(tY._repaint=1,tY.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),tI(0,tD,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(tD){this._height!==tD&&(this._height=tD,this.conchModel&&this.conchModel.size(this._width,tD),this.repaint())}),tI(0,tD,"blendMode",function(){return this._style.blendMode},function(tD){this.getStyle().blendMode=tD,this.conchModel&&this.conchModel.blendMode(tD),tD&&"source-over"!=tD?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),tI(0,tD,"scaleX",function(){return this._style._tf.scaleX},function(tD){var tY=this.getStyle();if(tY._tf.scaleX!==tD){tY.setScaleX(tD),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(tD,tY._tf.scaleY),this._renderType|=4;var tg=this._parent;tg&&0===tg._repaint&&(tg._repaint=1,tg.parentRepaint())}}),tI(0,tD,"scaleY",function(){return this._style._tf.scaleY},function(tD){var tY=this.getStyle();if(tY._tf.scaleY!==tD){tY.setScaleY(tD),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(tY._tf.scaleX,tD),this._renderType|=4;var tg=this._parent;tg&&0===tg._repaint&&(tg._repaint=1,tg.parentRepaint())}}),tI(0,tD,"stage",function(){return t_.stage}),tI(0,tD,"skewX",function(){return this._style._tf.skewX},function(tD){var tY=this.getStyle();if(tY._tf.skewX!==tD){tY.setSkewX(tD),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(tD,tY._tf.skewY),this._renderType|=4;var tg=this._parent;tg&&0===tg._repaint&&(tg._repaint=1,tg.parentRepaint())}}),tI(0,tD,"scrollRect",function(){return this._style.scrollRect},function(tD){this.getStyle().scrollRect=tD,this.repaint(),tD?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(tD.x,tD.y,tD.width,tD.height)):(this._renderType&=-129,this.conchModel&&(tg.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),tI(0,tD,"skewY",function(){return this._style._tf.skewY},function(tD){var tY=this.getStyle();if(tY._tf.skewY!==tD){tY.setSkewY(tD),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(tY._tf.skewX,tD),this._renderType|=4;var tg=this._parent;tg&&0===tg._repaint&&(tg._repaint=1,tg.parentRepaint())}}),tI(0,tD,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(tD){this._tfChanged=!1,(this._transform=tD)&&(this._x=tD.tx,this._y=tD.ty,tD.tx=tD.ty=0,this.conchModel&&this.conchModel.transform(tD.a,tD.b,tD.c,tD.d,this._x,this._y)),tD?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),tI(0,tD,"pivotX",function(){return this._style._tf.translateX},function(tD){this.getStyle().setTranslateX(tD),this.conchModel&&this.conchModel.pivot(tD,this._style._tf.translateY),this.repaint()}),tI(0,tD,"pivotY",function(){return this._style._tf.translateY},function(tD){this.getStyle().setTranslateY(tD),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,tD),this.repaint()}),tI(0,tD,"alpha",function(){return this._style.alpha},function(tD){this._style&&this._style.alpha!==tD&&(tD=tD<0?0:1<tD?1:tD,this.getStyle().alpha=tD,this.conchModel&&this.conchModel.alpha(tD),1!==tD?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),tI(0,tD,"visible",function(){return this._style.visible},function(tD){this._style&&this._style.visible!==tD&&(this.getStyle().visible=tD,this.conchModel&&this.conchModel.visible(tD),this.parentRepaint())}),tI(0,tD,"graphics",function(){return this._graphics||(this.graphics=tz.createGraphics())},function(tD){this._graphics&&(this._graphics._sp=null),(this._graphics=tD)?(this._renderType&=-2,this._renderType|=512,(tD._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(tg.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),tI(0,tD,"filters",function(){return this._$P.filters},function(tD){tD&&0===tD.length&&(tD=null),this._$P.filters!=tD&&(this._set$P("filters",tD?tD.slice():null),tP.isConchApp&&(this.conchModel&&(tg.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),tP.isWebGL&&(tD&&tD.length?this._renderType|=32:this._renderType&=-33),tD&&0<tD.length?(this._getBit(1)||this._setUpNoticeType(1),tP.isWebGL&&1==tD.length&&tD[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(tP.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),tI(0,tD,"parent",tr.prototype._$get_parent,function(tD){t_.superSet(tDD,this,"parent",tD),tD&&this._getBit(2)&&this._$2__onDisplay()}),tI(0,tD,"mask",function(){return this._$P._mask},function(tD){tD&&this.mask&&this.mask._$P.maskParent||(tD?(this.cacheAs="bitmap",this._set$P("_mask",tD),tD._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",tD),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(tD?tD.conchModel:null),this._renderType|=64,this.parentRepaint())}),tI(0,tD,"mouseEnabled",function(){return 1<this._mouseEnableState},function(tD){this._mouseEnableState=tD?2:1}),tI(0,tD,"globalScaleX",function(){for(var tD=1,tY=this;tY&&tY!==t_.stage;)tD*=tY.scaleX,tY=tY.parent;return tD}),tI(0,tD,"mouseX",function(){return this.getMousePoint().x}),tI(0,tD,"mouseY",function(){return this.getMousePoint().y}),tg.fromImage=function(tD){return(new tg).loadImage(tD)},tg._cachePool=[],tg.CustomList=[],ta(tg,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=tN.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),tg}(tDD),tCD=function(tD){function tY(tD){this._audio=null,this._onEnd=null,this._resumePlay=null,tY.__super.call(this),this._onEnd=tL.bind(this.__onEnd,this),this._resumePlay=tL.bind(this.__resumePlay,this),tD.addEventListener("ended",this._onEnd),this._audio=tD}tJ(tY,"laya.media.h5audio.AudioSoundChannel",tTD);var tg=tY.prototype;return tg.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(t_.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},tg.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,tU.container.appendChild(this._audio),this._audio.play()}catch(tD){this.event("error")}},tg.play=function(tD){this.isStopped=!1;try{this._audio.playbackRate=tX.playbackRate,this._audio.currentTime=this.startTime}catch(tD){return void this._audio.addEventListener("canplay",this._resumePlay)}tX.addChannel(this),tU.container.appendChild(this._audio),!tD&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},tg.stop=function(){this.isStopped=!0,tX.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&tP.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),tU.onIE||this._audio!=tgD._musicAudio&&tK.recover("audio:"+this.url,this._audio),tU.removeElement(this._audio),this._audio=null)},tg.pause=function(){this.isStopped=!0,tX.removeChannel(this),"pause"in this._audio&&this._audio.pause()},tg.resume=function(){this._audio&&(this.isStopped=!1,tX.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},tI(0,tg,"position",function(){return this._audio?this._audio.currentTime:0}),tI(0,tg,"duration",function(){return this._audio?this._audio.duration:0}),tI(0,tg,"volume",function(){return this._audio?this._audio.volume:1},function(tD){this._audio&&(this._audio.volume=tD)}),tY}(),tND=function(tD){function tY(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=tsD.ctx,tY.__super.call(this),this._onPlayEnd=tL.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}tJ(tY,"laya.media.webaudio.WebAudioSoundChannel",tTD);var tg=tY.prototype;return tg.play=function(tD){if(tX.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var tY=this.context,tg=this.gain,tT=tY.createBufferSource();(this.bufferSource=tT).buffer=this.audioBuffer,tT.connect(tg),tg&&tg.disconnect(),tg.connect(tY.destination),tT.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=tU.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(tT.loop=!0),tT.playbackRate.setTargetAtTime?tT.playbackRate.setTargetAtTime(tX.playbackRate,this.context.currentTime,.1):tT.playbackRate.value=tX.playbackRate,tT.start(0,this.startTime),!tD&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},tg.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(t_.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},tg._clearBufferSource=function(){if(this.bufferSource){var tD=this.bufferSource;tD.stop?tD.stop(0):tD.noteOff(0),tD.disconnect(0),tD.onended=null,tY._tryCleanFailed||this._tryClearBuffer(tD),this.bufferSource=null}},tg._tryClearBuffer=function(tD){try{tD.buffer=null}catch(tD){tY._tryCleanFailed=!0}},tg.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,tX.removeChannel(this),this.startHandler=null,this.completeHandler=null},tg.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,tX.removeChannel(this)},tg.resume=function(){this.startTime=this._pauseTime,this.play(!1)},tI(0,tg,"position",function(){return this.bufferSource?(tU.now()-this._startTime)/1e3+this.startTime:0}),tI(0,tg,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),tI(0,tg,"volume",function(){return this._volume},function(tD){this.isStopped||(this._volume=tD,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(tD,this.context.currentTime,.1):this.gain.gain.value=tD)}),tY._tryCleanFailed=!1,tY}(),t$D=function(tD){function tY(){tY.__super.call(this),this._w=0,this._h=0}tJ(tY,"laya.resource.Bitmap",tED);var tg=tY.prototype;return tI(0,tg,"width",function(){return this._w}),tI(0,tg,"height",function(){return this._h}),tI(0,tg,"source",function(){return this._source}),tY}(),tdD=function(tY){function tD(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,tD.__super.call(this),this._interval=tT.animationInterval,this._setUpNoticeType(1)}tJ(tD,"laya.display.AnimationPlayerBase",tY);var tg=tD.prototype;return tg.play=function(tD,tY,tg,tT){void 0===tD&&(tD=0),void 0===tY&&(tY=!0),void 0===tg&&(tg=""),void 0===tT&&(tT=!0),this._isPlaying=!0,this.index="string"==typeof tD?this._getFrameByLabel(tD):tD,this.loop=tY,this._actionName=tg,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},tg._getFrameByLabel=function(tD){var tY=0;for(tY=0;tY<this._count;tY++)if(this._labels[tY]&&0<=this._labels[tY].indexOf(tD))return tY;return 0},tg._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},tg._setControlNode=function(tD){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=tD)&&tD!=this&&(tD.on("display",this,this._checkResumePlaying),tD.on("undisplay",this,this._checkResumePlaying))},tg._setDisplay=function(tD){tY.prototype._setDisplay.call(this,tD),this._checkResumePlaying()},tg._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},tg.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},tg.addLabel=function(tD,tY){this._labels||(this._labels={}),this._labels[tY]||(this._labels[tY]=[]),this._labels[tY].push(tD)},tg.removeLabel=function(tD){if(tD){if(this._labels)for(var tY in this._labels)this._removeLabelFromLabelList(this._labels[tY],tD)}else this._labels=null},tg._removeLabelFromLabelList=function(tD,tY){if(tD)for(var tg=tD.length-1;0<=tg;tg--)tD[tg]==tY&&tD.splice(tg,1)},tg.gotoAndStop=function(tD){this.index="string"==typeof tD?this._getFrameByLabel(tD):tD,this.stop()},tg._displayToIndex=function(tD){},tg.clear=function(){this.stop(),this._labels=null},tI(0,tg,"interval",function(){return this._interval},function(tD){this._interval!=tD&&(this._frameRateChanged=!0,this._interval=tD,this._isPlaying&&0<tD&&this.timerLoop(tD,this,this._frameLoop,null,!0,!0))}),tI(0,tg,"isPlaying",function(){return this._isPlaying}),tI(0,tg,"index",function(){return this._index},function(tD){if(this._index=tD,this._displayToIndex(tD),this._labels&&this._labels[tD])for(var tY=this._labels[tD],tg=0,tT=tY.length;tg<tT;tg++)this.event("label",tY[tg])}),tI(0,tg,"count",function(){return this._count}),tD.WRAP_POSITIVE=0,tD.WRAP_REVERSE=1,tD.WRAP_PINGPONG=2,tD}(tOD),tJD=function(tY){function td(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,td.__super.call(this),this.overflow=td.VISIBLE,this._style=new tYD(this),this._style.wordWrap=!1}tJ(td,"laya.display.Text",tY);var tD=td.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._lines=null,this._words&&(this._words.length=0,this._words=null)},tD._getBoundPointsM=function(tD){void 0===tD&&(tD=!1);var tY=tq.TEMP;return tY.setTo(0,0,this.width,this.height),tY._getBoundPoints()},tD.getGraphicBounds=function(tD){void 0===tD&&(tD=!1);var tY=tq.TEMP;return tY.setTo(0,0,this.width,this.height),tY},tD._getCSSStyle=function(){return this._style},tD.lang=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI){if(tD=td.langPacks&&td.langPacks[tD]?td.langPacks[tD]:tD,arguments.length<2)this._text=tD;else{for(var tO=0,tC=arguments.length;tO<tC;tO++)tD=tD.replace("{"+tO+"}",arguments[tO+1]);this._text=tD}},tD._isPassWordMode=function(){var tD=this._style.password;return"prompt"in this&&this.prompt==this._text&&(tD=!1),tD},tD._getPassWordTxt=function(tD){var tY;tY="";for(var tg=tD.length;0<tg;tg--)tY+="●";return tY},tD.renderText=function(tD,tY){var tg=this.graphics;tg.clear(!0);var tT=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(tU.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);tU.context.font=tT;var tr=this.padding,ts=tr[3],ta="left",tW=this._lines,tM=this.leading+this._charSize.height,tE=this._currBitmapFont;tE&&(tM=this.leading+tE.getMaxHeight());var tI=tr[0];if(!tE&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(ta="right",ts=this._width-tr[1]):"center"==this.align&&(ta="center",ts=.5*this._width+tr[3]-tr[1])),0<this._height){var tO=this._textHeight>this._height?"top":this.valign;"middle"===tO?tI=.5*(this._height-tY*tM)+tr[0]-tr[2]:"bottom"===tO&&(tI=this._height-tY*tM-tr[2])}var tC=this._style;if(tE&&tE.autoScaleSize)var tN=tE.fontSize/this.fontSize;if(this._clipPoint)if(tg.save(),tE&&tE.autoScaleSize){var t$=0,td=0;t$=this._width?this._width-tr[3]-tr[1]:this._textWidth,td=this._height?this._height-tr[0]-tr[2]:this._textHeight,t$*=tN,td*=tN,tg.clipRect(tr[3],tr[0],t$,td)}else tg.clipRect(tr[3],tr[0],this._width?this._width-tr[3]-tr[1]:this._textWidth,this._height?this._height-tr[0]-tr[2]:this._textHeight);var tJ=tC.password;"prompt"in this&&this.prompt==this._text&&(tJ=!1);for(var tx=0,tj=0,tZ=Math.min(this._lines.length,tY+tD)||1,tp=tD;tp<tZ;tp++){var tl,tt=tW[tp];if(tJ){var t_=tt.length;tt="";for(var tA=t_;0<tA;tA--)tt+="●"}if(tx=ts-(this._clipPoint?this._clipPoint.x:0),tj=tI+tM*tp-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(ta,tx,tj,tp),tE){var tq=this.width;tE.autoScaleSize&&(tq=this.width*tN),tE.drawText(tt,this,tx,tj,this.align,tq)}else tP.isWebGL?(this._words||(this._words=[]),(tl=this._words.length>tp-tD?this._words[tp-tD]:new tn).setText(tt)):tl=tt,tC.stroke?tg.fillBorderText(tl,tx,tj,tT,this.color,tC.strokeColor,tC.stroke,ta):tg.fillText(tl,tx,tj,tT,this.color,ta)}if(tE&&tE.autoScaleSize){var tb=1/tN;this.scale(tb,tb)}this._clipPoint&&tg.restore(),this._startX=ts,this._startY=tI},tD.drawUnderline=function(tD,tY,tg,tT){var tr=this._lineWidths[tT];switch(tD){case"center":tY-=tr/2;break;case"right":tY-=tr}tg+=this._charSize.height,this._graphics.drawLine(tY,tg,tY+tr,tg,this.underlineColor||this.color,1)},tD.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);tU.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new tA(0,0)):this._clipPoint=null;var tD=this._lines.length;if(this.overflow!=td.VISIBLE){var tY=this.overflow==td.HIDDEN?Math.floor:Math.ceil;tD=Math.min(tD,tY((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var tg=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(tg,tD),this.repaint()},tD.evalTextSize=function(){var tD,tY=NaN;tD=Math.max.apply(this,this._lineWidths),tY=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],tD==this._textWidth&&tY==this._textHeight||(this._textWidth=tD,this._textHeight=tY,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},tD.checkEnabledViewportOrNot=function(){return this.overflow==td.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},tD.changeText=function(tD){this._text!==tD&&(this.lang(tD+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},tD.parseLines=function(tD){var tY=this.wordWrap||this.overflow==td.HIDDEN;if(tY)var tg=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var tT=tL.contextMeasureText(td._testWord);tP.isConchApp&&0===tT.width&&0===tT.height&&(tT=tL.contextMeasureText("W")),this._charSize.width=tT.width,this._charSize.height=tT.height||this.fontSize}for(var tr=tD.replace(/\r\n/g,"\n").split("\n"),ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts];tY?this.parseLine(tW,tg):(this._lineWidths.push(this.getTextWidth(tW)),this._lines.push(tW))}},tD.parseLine=function(tD,tY){tU.context;var tg,tT=this._lines,tr=0,ts=NaN,ta=NaN,tW=0;if((ts=this.getTextWidth(tD))<=tY)return tT.push(tD),void this._lineWidths.push(ts);if(td.WordSplitStr&&0==new RegExp(td.WordSplitStr,"g").test(tD))return tT.push(tD),void this._lineWidths.push(ts);ts=this._charSize.width,0==(tr=Math.floor(tY/ts))&&(tr=1),ta=ts=this.getTextWidth(tD.substring(0,tr));for(var tM=tr,tE=tD.length;tM<tE;tM++)if(tY<(ta+=ts=this.getTextWidth(tD.charAt(tM))))if(this.wordWrap){var tI=tD.substring(tW,tM);if(td.WordSplitArr){var tO=-1,tC=0;for(tC=0;tC<td.WordSplitArr.length;tC++)tO=Math.max(tO,tI.lastIndexOf(td.WordSplitArr[tC]));if(-1==tO){var tN=tD.substring(tW,tD.length);for(tC=0;tC<td.WordSplitArr.length;tC++){var t$=tN.indexOf(td.WordSplitArr[tC]);tO=0<=tO?0<=t$?Math.min(tO,t$):tO:t$}tI=-1==tO?(tM=tD.length,tN):(tM=tO+1+tW,tD.substring(tW,tM))}else tM=tO+1+tW,tI=tD.substring(tW,tM);tT.push(tI),this._lineWidths.push(this.getTextWidth(tT[tT.length-1])),ta=0,tW=tM}else{if(tI.charCodeAt(tI.length-1)<255?(tg=/(?:\w|-)+$/.exec(tI))&&(tM=tg.index+tW,0==tg.index?tM+=tI.length:tI=tD.substring(tW,tM)):td.RightToLeft&&(tg=/([\u0600-\u06FF])+$/.exec(tI))&&(tM=tg.index+tW,0==tg.index?tM+=tI.length:tI=tD.substring(tW,tM)),tT.push(tI),this._lineWidths.push(ta-ts),!((tW=tM)+tr<tE)){tT.push(tD.substring(tW,tE)),this._lineWidths.push(this.getTextWidth(tT[tT.length-1])),tW=-1;break}tM+=tr,ta=ts=this.getTextWidth(tD.substring(tW,tM)),tM--}}else if(this.overflow==td.HIDDEN)return tT.push(tD.substring(0,tM)),void this._lineWidths.push(this.getTextWidth(tT[tT.length-1]));this.wordWrap&&-1!=tW&&tW<tE&&(tT.push(tD.substring(tW,tE)),this._lineWidths.push(this.getTextWidth(tT[tT.length-1])))},tD.getTextWidth=function(tD){return this._currBitmapFont?this._currBitmapFont.getTextWidth(tD):tL.contextMeasureText(tD).width},tD.getWordWrapWidth=function(){var tD=this.padding,tY=NaN;return(tY=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(tY=this.wordWrap?100:tU.width),tY<=0&&(tY=100),tY-tD[3]-tD[1]},tD.getCharPoint=function(tD,tY){this._isChanged&&t_.timer.runCallLater(this,this.typeset);for(var tg=0,tT=this._lines,tr=0,ts=0,ta=tT.length;ts<ta;ts++){if(tD<(tg+=tT[ts].length)){var tW=ts;break}tr=tg}var tM=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;tU.context.font=tM;var tE=this.getTextWidth(this._text.substring(tr,tD));return(tY||new tA).setTo(this._startX+tE-(this._clipPoint?this._clipPoint.x:0),this._startY+tW*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},tI(0,tD,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(tD){tD!=this._width&&(t_.superSet(tOD,this,"width",tD),this.isChanged=!0)}),tI(0,tD,"textWidth",function(){return this._isChanged&&t_.timer.runCallLater(this,this.typeset),this._textWidth}),tI(0,tD,"height",function(){return this._height?this._height:this.textHeight},function(tD){tD!=this._height&&(t_.superSet(tOD,this,"height",tD),this.isChanged=!0)}),tI(0,tD,"textHeight",function(){return this._isChanged&&t_.timer.runCallLater(this,this.typeset),this._textHeight}),tI(0,tD,"padding",function(){return this._getCSSStyle().padding},function(tD){this._getCSSStyle().padding=tD,this.isChanged=!0}),tI(0,tD,"bold",function(){return this._getCSSStyle().bold},function(tD){this._getCSSStyle().bold=tD,this.isChanged=!0}),tI(0,tD,"text",function(){return this._text||""},function(tD){this._text!==tD&&(this.lang(tD+""),this.isChanged=!0,this.event("change"))}),tI(0,tD,"color",function(){return this._getCSSStyle().color},function(tD){this._getCSSStyle().color!=tD&&(this._getCSSStyle().color=tD,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),tI(0,tD,"font",function(){return this._getCSSStyle().fontFamily},function(tD){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),td._bitmapFonts&&td._bitmapFonts[tD]&&(this._currBitmapFont=td._bitmapFonts[tD]),this._getCSSStyle().fontFamily=tD,this.isChanged=!0}),tI(0,tD,"fontSize",function(){return this._getCSSStyle().fontSize},function(tD){this._getCSSStyle().fontSize=tD,this.isChanged=!0}),tI(0,tD,"italic",function(){return this._getCSSStyle().italic},function(tD){this._getCSSStyle().italic=tD,this.isChanged=!0}),tI(0,tD,"align",function(){return this._getCSSStyle().align},function(tD){this._getCSSStyle().align=tD,this.isChanged=!0}),tI(0,tD,"valign",function(){return this._getCSSStyle().valign},function(tD){this._getCSSStyle().valign=tD,this.isChanged=!0}),tI(0,tD,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(tD){this._getCSSStyle().wordWrap=tD,this.isChanged=!0}),tI(0,tD,"leading",function(){return this._getCSSStyle().leading},function(tD){this._getCSSStyle().leading=tD,this.isChanged=!0}),tI(0,tD,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(tD){this._getCSSStyle().backgroundColor=tD,this.isChanged=!0}),tI(0,tD,"borderColor",function(){return this._getCSSStyle().borderColor},function(tD){this._getCSSStyle().borderColor=tD,this.isChanged=!0}),tI(0,tD,"stroke",function(){return this._getCSSStyle().stroke},function(tD){this._getCSSStyle().stroke=tD,this.isChanged=!0}),tI(0,tD,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(tD){this._getCSSStyle().strokeColor=tD,this.isChanged=!0}),tI(0,tD,"isChanged",null,function(tD){this._isChanged!==tD&&(this._isChanged=tD)&&t_.timer.callLater(this,this.typeset)}),tI(0,tD,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(tD){if(!(this.overflow!=td.SCROLL||this.textWidth<this._width)&&this._clipPoint){tD=tD<this.padding[3]?this.padding[3]:tD;var tY=this._textWidth-this._width;tD=tY<tD?tY:tD;var tg=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=tD,this.renderText(this._lastVisibleLineIndex,tg)}}),tI(0,tD,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(tD){if(!(this.overflow!=td.SCROLL||this.textHeight<this._height)&&this._clipPoint){tD=tD<this.padding[0]?this.padding[0]:tD;var tY=this._textHeight-this._height,tg=(tD=tY<tD?tY:tD)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=tg;var tT=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=tD,this.renderText(tg,tT)}}),tI(0,tD,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),tI(0,tD,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),tI(0,tD,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),tI(0,tD,"underlineColor",function(){return this._underlineColor},function(tD){this._underlineColor=tD,this._isChanged=!0,this.typeset()}),td.registerBitmapFont=function(tD,tY){td._bitmapFonts||(td._bitmapFonts={}),td._bitmapFonts[tD]=tY},td.unregisterBitmapFont=function(tD,tY){if(void 0===tY&&(tY=!0),td._bitmapFonts&&td._bitmapFonts[tD]){var tg=td._bitmapFonts[tD];tY&&tg.destroy(),delete td._bitmapFonts[tD]}},td.setTextRightToLeft=function(){var tD;(tD=tU.canvas.source.style).display="none",tD.position="absolute",tD.direction="rtl",tP._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,tU.document.body.appendChild(tU.canvas.source)},td.supportFont=function(tD){tU.context.font="10px sans-serif";var tY=tL.contextMeasureText("abcji").width;tU.context.font="10px "+tD;var tg=tL.contextMeasureText("abcji").width;return console.log(tY,tg),tY!==tg},td._testWord="游",td.langPacks=null,td.VISIBLE="visible",td.SCROLL="scroll",td.HIDDEN="hidden",td.CharacterCache=!0,td.RightToLeft=!1,td.WordSplitArr=null,td.WordSplitStr=null,td._bitmapFonts=null,ta(td,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),td}(tOD),txD=function(tC){function tM(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",tM.__super.call(this),this.offset=new tA,this._canvasTransform=new tm,this._previousOrientation=tU.window.orientation;var tY=this;this.transform=tm.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0,this._lastStamp=0;var tD=tU.window,tg=this;function tT(){tY._isFocused=!0,console.info("-------------focus"),tg.event("focus"),tg.event("focuschange")}function tr(){tY._isFocused=!1,console.info("-------------blur"),tg.event("blur"),tg.event("focuschange"),tg._isInputting()&&(tlD.inputElement.target.focus=!1)}tD.addEventListener("message",function(tD){tD&&tD.data&&("focus"==tD.data.type?tT():"blur"==tD.data.type&&tr())}),tD.addEventListener("focus",tT),tD.addEventListener("blur",tr);var ts="visibilityState",ta="visibilitychange",tW=tD.document;void 0!==tW.hidden?(ta="visibilitychange",ts="visibilityState"):void 0!==tW.mozHidden?(ta="mozvisibilitychange",ts="mozVisibilityState"):void 0!==tW.msHidden?(ta="msvisibilitychange",ts="msVisibilityState"):void 0!==tW.webkitHidden&&(ta="webkitvisibilitychange",ts="webkitVisibilityState"),tD.document.addEventListener(ta,function(){"hidden"==tU.document[ts]?tg._setStageVisible(!1):tg._setStageVisible(!0)}),tD.document.addEventListener("qbrowserVisibilityChange",function(tD){tg._setStageVisible(!tD.hidden)}),tD.addEventListener("resize",function(){var tD=tU.window.orientation;null!=tD&&tD!=tY._previousOrientation&&tg._isInputting()&&(tlD.inputElement.target.focus=!1),tY._previousOrientation=tD,tg._isInputting()||tg._resetCanvas()}),tD.addEventListener("orientationchange",function(tD){tg._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),tU.onMobile&&this.on("mousedown",this,this._onmouseMove)}tJ(tM,"laya.display.Stage",tC);var tD=tM.prototype;return tD._setStageVisible=function(tD){this._isVisibility!=tD&&(this._isVisibility=tD,this._isVisibility||this._isInputting()&&(tlD.inputElement.target.focus=!1),this.event("visibilitychange"))},tD._isInputting=function(){return tU.onMobile&&tlD.isInputting},tD._changeCanvasSize=function(){this.setScreenSize(tU.clientWidth*tU.pixelRatio,tU.clientHeight*tU.pixelRatio)},tD._resetCanvas=function(){if(this.screenAdaptationEnabled){var tD=tP._mainCanvas;tD.source.style;tD.size(1,1),t_.timer.once(100,this,this._changeCanvasSize)}},tD.setScreenSize=function(tD,tY){var tg=!1;if("none"!==this._screenMode&&(tg=(tD/tY<1?"vertical":"horizontal")!==this._screenMode)){var tT=tY;tY=tD,tD=tT}this.canvasRotation=tg;var tr=tP._mainCanvas,ts=tr.source.style,ta=this._canvasTransform.identity(),tW=this._scaleMode,tM=tD/this.designWidth,tE=tY/this.designHeight,tI=this.designWidth,tO=this.designHeight,tC=tD,tN=tY,t$=tU.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,tW){case"noscale":tM=tE=1,tC=this.designWidth,tN=this.designHeight;break;case"showall":tM=tE=Math.min(tM,tE),tI=tC=Math.round(this.designWidth*tM),tO=tN=Math.round(this.designHeight*tE);break;case"noborder":tM=tE=Math.max(tM,tE),tC=Math.round(this.designWidth*tM),tN=Math.round(this.designHeight*tE);break;case"full":tM=tE=1,this._width=tI=tD,this._height=tO=tY;break;case"fixedwidth":tE=tM,this._height=tO=Math.round(tY/tM);break;case"fixedheight":tM=tE,this._width=tI=Math.round(tD/tE);break;case"fixedauto":tD/tY<this.designWidth/this.designHeight?(tE=tM,this._height=tO=Math.round(tY/tM)):(tM=tE,this._width=tI=Math.round(tD/tE))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,tI=tI+1&2147483646,tO=tO+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),tM*=this.scaleX,tE*=this.scaleY,1===tM&&1===tE?this.transform.identity():(this.transform.a=this._formatData(tM/(tC/tI)),this.transform.d=this._formatData(tE/(tN/tO)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),tr.size(tI,tO),tz.changeWebGLSize(tI,tO),ta.scale(tC/tI/t$,tN/tO/t$),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(tD-tC)/t$:this.offset.x=.5*(tD-tC)/t$,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(tY-tN)/t$:this.offset.y=.5*(tY-tN)/t$,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),ta.translate(this.offset.x,this.offset.y),this.canvasDegree=0,tg&&("horizontal"===this._screenMode?(ta.rotate(Math.PI/2),ta.translate(tY/t$,0),this.canvasDegree=90):(ta.rotate(-Math.PI/2),ta.translate(0,tD/t$),this.canvasDegree=-90)),ta.a=this._formatData(ta.a),ta.d=this._formatData(ta.d),ta.tx=this._formatData(ta.tx),ta.ty=this._formatData(ta.ty),ts.transformOrigin=ts.webkitTransformOrigin=ts.msTransformOrigin=ts.mozTransformOrigin=ts.oTransformOrigin="0px 0px 0px",ts.transform=ts.webkitTransform=ts.msTransform=ts.mozTransform=ts.oTransform="matrix("+ta.toString()+")",ta.translate(parseInt(ts.left)||0,parseInt(ts.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},tD._formatData=function(tD){return Math.abs(tD)<1e-6?0:Math.abs(1-tD)<.001?0<tD?1:-1:tD},tD.getMousePoint=function(){return tA.TEMP.setTo(this.mouseX,this.mouseY)},tD.repaint=function(){this._repaint=1},tD.parentRepaint=function(){},tD._loop=function(tD){return this.render(tP.context,0,0,tD),!0},tD._onmouseMove=function(tD){this._mouseMoveTime=tU.now()},tD.getTimeFromFrameStart=function(){return tU.now()-this._frameStartTime},tD.render=function(tD,tY,tg,tT){if(!(3!=tN.ENV&&6!=tN.ENV&&0<tT&&tT-this._lastStamp<16)){if(this._lastStamp=tT,"sleep"===this._frameRate&&!tP.isConchApp){var tr=tU.now();if(!(200<=tr-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(to.loopCount++,t$.instance.runEvent(),t_.timer._update()));this._frameStartTime=tr}if(this._renderCount++,tP.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=tU.now();var ts="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),ta=this._renderCount%2==0;if(to.renderSlow=!ts,ts||ta||tP.isConchApp){var tW;to.loopCount++,t$.instance.runEvent(),t_.timer._update(),tz.update3DLoop();var tM=0,tE=0;if(tP.isConchNode)for(tM=0,tE=this._scenes.length;tM<tE;tM++)(tW=this._scenes[tM])&&tW._updateSceneConch();else for(tM=0,tE=this._scenes.length;tM<tE;tM++)(tW=this._scenes[tM])&&tW._updateScene();if(tP.isConchNode){var tI=tOD.CustomList;for(tM=0,tE=tI.length;tM<tE;tM++){var tO=tI[tM];tO.customRender(tO.customContext,0,0)}return}}tP.isConchNode||this.renderingEnabled&&(ts||!ta||tP.isConchWebGL)&&(tP.isWebGL?tP.WebGL.mainContext&&!tP.WebGL.mainContext.isContextLost()&&(tD.clear(),tC.prototype.render.call(this,tD,tY,tg),to._show&&to._sp&&to._sp.render(tD,tY,tg),tz.clear(this._bgColor),tz.beginFlush(),tD.flush(),tz.endFinish(),ty.instance&&ty.getInstance().endDispose()):(tz.clear(this._bgColor),tC.prototype.render.call(this,tD,tY,tg),to._show&&to._sp&&to._sp.render(tD,tY,tg)))}else this._renderCount%5==0&&(to.loopCount++,t$.instance.runEvent(),t_.timer._update())}},tD._requestFullscreen=function(){var tD=tU.document.documentElement;tD.requestFullscreen?tD.requestFullscreen():tD.mozRequestFullScreen?tD.mozRequestFullScreen():tD.webkitRequestFullscreen?tD.webkitRequestFullscreen():tD.msRequestFullscreen&&tD.msRequestFullscreen()},tD._fullScreenChanged=function(){t_.stage.event("fullscreenchange")},tD.exitFullscreen=function(){var tD=tU.document;tD.exitFullscreen?tD.exitFullscreen():tD.mozCancelFullScreen?tD.mozCancelFullScreen():tD.webkitExitFullscreen&&tD.webkitExitFullscreen()},tI(0,tD,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),tI(0,tD,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),tI(0,tD,"frameRate",function(){return this._frameRate},function(tD){if(this._frameRate=tD,tP.isConchApp)switch(this._frameRate){case"slow":tU.window.conch&&tU.window.conchConfig.setSlowFrame&&tU.window.conchConfig.setSlowFrame(!0);break;case"fast":tU.window.conch&&tU.window.conchConfig.setSlowFrame&&tU.window.conchConfig.setSlowFrame(!1);break;case"mouse":tU.window.conch&&tU.window.conchConfig.setMouseFrame&&tU.window.conchConfig.setMouseFrame(2e3);break;case"sleep":tU.window.conch&&tU.window.conchConfig.setLimitFPS&&tU.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),tI(0,tD,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),tI(0,tD,"width",tC.prototype._$get_width,function(tD){this.designWidth=tD,t_.superSet(tOD,this,"width",tD),t_.timer.callLater(this,this._changeCanvasSize)}),tI(0,tD,"alignH",function(){return this._alignH},function(tD){this._alignH=tD,t_.timer.callLater(this,this._changeCanvasSize)}),tI(0,tD,"isFocused",function(){return this._isFocused}),tI(0,tD,"height",tC.prototype._$get_height,function(tD){this.designHeight=tD,t_.superSet(tOD,this,"height",tD),t_.timer.callLater(this,this._changeCanvasSize)}),tI(0,tD,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||tm.create()},tC.prototype._$set_transform),tI(0,tD,"isVisibility",function(){return this._isVisibility}),tI(0,tD,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),tI(0,tD,"scaleMode",function(){return this._scaleMode},function(tD){this._scaleMode=tD,t_.timer.callLater(this,this._changeCanvasSize)}),tI(0,tD,"alignV",function(){return this._alignV},function(tD){this._alignV=tD,t_.timer.callLater(this,this._changeCanvasSize)}),tI(0,tD,"bgColor",function(){return this._bgColor},function(tD){this._bgColor=tD,this.conchModel&&this.conchModel.bgColor(tD),tP.isWebGL&&(tD?tM._wgColor=tf.create(tD)._color:tU.onMiniGame||(tM._wgColor=null)),tU.onLimixiu?tM._wgColor=tf.create(tD)._color:tP.canvas.style.background=tD||"none"}),tI(0,tD,"mouseX",function(){return Math.round(t$.instance.mouseX/this.clientScaleX)}),tI(0,tD,"mouseY",function(){return Math.round(t$.instance.mouseY/this.clientScaleY)}),tI(0,tD,"screenMode",function(){return this._screenMode},function(tD){this._screenMode=tD}),tI(0,tD,"visible",tC.prototype._$get_visible,function(tD){this.visible!==tD&&(t_.superSet(tOD,this,"visible",tD),tP._mainCanvas.source.style.visibility=tD?"visible":"hidden")}),tI(0,tD,"fullScreenEnabled",null,function(tD){var tY=tU.document,tg=tP.canvas;tD?(tg.addEventListener("mousedown",this._requestFullscreen),tg.addEventListener("touchstart",this._requestFullscreen),tY.addEventListener("fullscreenchange",this._fullScreenChanged),tY.addEventListener("mozfullscreenchange",this._fullScreenChanged),tY.addEventListener("webkitfullscreenchange",this._fullScreenChanged),tY.addEventListener("msfullscreenchange",this._fullScreenChanged)):(tg.removeEventListener("mousedown",this._requestFullscreen),tg.removeEventListener("touchstart",this._requestFullscreen),tY.removeEventListener("fullscreenchange",this._fullScreenChanged),tY.removeEventListener("mozfullscreenchange",this._fullScreenChanged),tY.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),tY.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),tM.SCALE_NOSCALE="noscale",tM.SCALE_EXACTFIT="exactfit",tM.SCALE_SHOWALL="showall",tM.SCALE_NOBORDER="noborder",tM.SCALE_FULL="full",tM.SCALE_FIXED_WIDTH="fixedwidth",tM.SCALE_FIXED_HEIGHT="fixedheight",tM.SCALE_FIXED_AUTO="fixedauto",tM.ALIGN_LEFT="left",tM.ALIGN_RIGHT="right",tM.ALIGN_CENTER="center",tM.ALIGN_TOP="top",tM.ALIGN_MIDDLE="middle",tM.ALIGN_BOTTOM="bottom",tM.SCREEN_NONE="none",tM.SCREEN_HORIZONTAL="horizontal",tM.SCREEN_VERTICAL="vertical",tM.FRAME_FAST="fast",tM.FRAME_SLOW="slow",tM.FRAME_MOUSE="mouse",tM.FRAME_SLEEP="sleep",tM.FRAME_MOUSE_THREDHOLD=2e3,ta(tM,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),tM}(tOD),tjD=(function(tD){function tY(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,tY.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}tJ(tY,"laya.media.SoundNode",tOD);var tg=tY.prototype;tg._onParentChange=function(){this.target=this.parent},tg.play=function(tD,tY){void 0===tD&&(tD=1),isNaN(tD)&&(tD=1),this.url&&(this.stop(),this._channel=tX.playSound(this.url,tD,null,tY))},tg.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},tg._setPlayAction=function(tD,tY,tg,tT){void 0===tT&&(tT=!0),this[tg]&&tD&&(tT?tD.on(tY,this,this[tg]):tD.off(tY,this,this[tg]))},tg._setPlayActions=function(tD,tY,tg,tT){if(void 0===tT&&(tT=!0),tD&&tY){var tr,ts=tY.split(","),ta=0;for(tr=ts.length,ta=0;ta<tr;ta++)this._setPlayAction(tD,ts[ta],tg,tT)}},tI(0,tg,"playEvent",null,function(tD){(this._playEvents=tD)&&this._tar&&this._setPlayActions(this._tar,tD,"play")}),tI(0,tg,"target",null,function(tD){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=tD,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),tI(0,tg,"stopEvent",null,function(tD){(this._stopEvents=tD)&&this._tar&&this._setPlayActions(this._tar,tD,"stop")})}(),function(tD){function tY(){this._src=null,this._onload=null,this._onerror=null,tY.__super.call(this)}tJ(tY,"laya.resource.FileBitmap",t$D);var tg=tY.prototype;return tI(0,tg,"src",function(){return this._src},function(tD){this._src=tD}),tI(0,tg,"onload",null,function(tD){}),tI(0,tg,"onerror",null,function(tD){}),tY}()),tZD=function(tD){function tg(tD,tY){this._is2D=!1,tg.__super.call(this);var tT=this;if(this._source=this,"2D"===tD||"AUTO"===tD&&!tP.isWebGL){this._is2D=!0,this._source=tY||tU.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var tr=this;tr.getContext=function(tD,tY){if(tT._ctx)return tT._ctx;var tg=tT._ctx=tT._source.getContext(tD,tY);return tg&&(tg._canvas=tr,tP.isFlash||tU.onLimixiu||(tg.size=function(tD,tY){})),tg}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}tJ(tg,"laya.resource.HTMLCanvas",t$D);var tY=tg.prototype;return tY.clear=function(){this._ctx&&this._ctx.clear()},tY.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},tY.release=function(){},tY._setContext=function(tD){this._ctx=tD},tY.getContext=function(tD,tY){return this._ctx?this._ctx:this._ctx=tg._createContext(this)},tY.getMemSize=function(){return 0},tY.size=function(tD,tY){(this._w!=tD||this._h!=tY||this._source&&(this._source.width!=tD||this._source.height!=tY))&&(this._w=tD,this._h=tY,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(tD,tY),this._source&&(this._source.height=tY,this._source.width=tD))},tY.getCanvas=function(){return this._source},tY.toBase64=function(tD,tY,tg){if(this._source)if(tP.isConchApp&&this._source.toBase64)this._source.toBase64(tD,tY,tg);else{var tT=this._source.toDataURL(tD,tY);tg.call(this,tT)}},tI(0,tY,"context",function(){return this._ctx}),tI(0,tY,"asBitmap",null,function(tD){}),tg.create=function(tD,tY){return new tg(tD,tY)},tg.TYPE2D="2D",tg.TYPE3D="3D",tg.TYPEAUTO="AUTO",tg._createContext=null,tg}(),tpD=(function(tD){function tM(tD,tY,tg,tT,tr,ts,ta,tW){throw tM.__super.call(this),new Error("不允许new！")}tJ(tM,"laya.resource.HTMLSubImage",t$D),tM.create=function(tD,tY,tg,tT,tr,ts,ta,tW){return void 0===tW&&(tW=!1),new tM(tD,tY,tg,tT,tr,ts,ta,tW)}}(),function(tD){function tO(){this._frames=null,this._url=null,tO.__super.call(this),this._setControlNode(this)}tJ(tO,"laya.display.Animation",tD);var tY=tO.prototype;tY.destroy=function(tD){void 0===tD&&(tD=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,tD),this._frames=null,this._labels=null},tY.play=function(tD,tY,tg,tT){void 0===tD&&(tD=0),void 0===tY&&(tY=!0),void 0===tg&&(tg=""),void 0===tT&&(tT=!0),tg&&this._setFramesFromCache(tg,tT),this._isPlaying=!0,this.index="string"==typeof tD?this._getFrameByLabel(tD):tD,this.loop=tY,this._actionName=tg,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},tY._setFramesFromCache=function(tD,tY){var tg;return void 0===tY&&(tY=!1),this._url&&(tD=this._url+"#"+tD),tD&&tO.framesMap[tD]?((tg=tO.framesMap[tD])instanceof Array?(this._frames=tO.framesMap[tD],this._count=this._frames.length):(tg.nodeRoot&&(tO.framesMap[tD]=this._parseGraphicAnimationByData(tg),tg=tO.framesMap[tD]),this._frames=tg.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=tg.interval),this._labels=this._copyLabels(tg.labels)),!0):(tY&&console.log("ani not found:",tD),!1)},tY._copyLabels=function(tD){if(!tD)return null;var tY,tg;for(tg in tY={},tD)tY[tg]=tL.copyArray([],tD[tg]);return tY},tY._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&tD.prototype._frameLoop.call(this)},tY._displayToIndex=function(tD){this._frames&&(this.graphics=this._frames[tD])},tY.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},tY.loadImages=function(tD,tY){return void 0===tY&&(tY=""),this._url="",this._setFramesFromCache(tY)||(this.frames=tO.framesMap[tY]?tO.framesMap[tY]:tO.createFrames(tD,tY)),this},tY.loadAtlas=function(tY,tg,tT){void 0===tT&&(tT=""),this._url="";var tr=this;function tD(tD){tY===tD&&(tr.frames=tO.framesMap[tT]?tO.framesMap[tT]:tO.createFrames(tY,tT),tg&&tg.run())}return tr._setFramesFromCache(tT)||(tWD.getAtlas(tY)?tD(tY):t_.loader.load(tY,tj.create(null,tD,[tY]),null,"atlas")),this},tY.loadAnimation=function(tD,tY,tg){this._url=tD;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,tY&&tY.run()):!tg||tWD.getAtlas(tg)?this._loadAnimationData(tD,tY,tg):t_.loader.load(tg,tj.create(this,this._loadAnimationData,[tD,tY,tg]),null,"atlas"),this},tY._loadAnimationData=function(tW,tM,tD){var tE=this;if(!tD||tWD.getAtlas(tD)){var tI=this;tWD.getRes(tW)?tY(tW):t_.loader.load(tW,tj.create(null,tY,[tW]),null,"json"),tWD.clearRes(tW)}else console.warn("atlas load fail:"+tD);function tY(tD){if(tWD.getRes(tD)&&tW===tD){var tY;if(tO.framesMap[tW+"#"])tI._setFramesFromCache(tE._actionName,!0),tE.index=0,tE._checkResumePlaying();else{var tg=tI._parseGraphicAnimation(tWD.getRes(tW));if(!tg)return;var tT,tr=tg.animationList,ts=0,ta=tr.length;for(ts=0;ts<ta;ts++)tY=tr[ts],tO.framesMap[tW+"#"+tY.name]=tY,tT||(tT=tY);tT&&(tO.framesMap[tW+"#"]=tT,tI._setFramesFromCache(tE._actionName,!0),tE.index=0),tE._checkResumePlaying()}tM&&tM.run()}}},tY._parseGraphicAnimation=function(tD){return t_D.parseAnimationData(tD)},tY._parseGraphicAnimationByData=function(tD){return t_D.parseAnimationByData(tD)},tI(0,tY,"frames",function(){return this._frames},function(tD){(this._frames=tD)&&(this._count=tD.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),tI(0,tY,"autoPlay",null,function(tD){tD?this.play():this.stop()}),tI(0,tY,"source",null,function(tD){-1<tD.indexOf(".ani")?this.loadAnimation(tD):-1<tD.indexOf(".json")||-1<tD.indexOf("als")||-1<tD.indexOf("atlas")?this.loadAtlas(tD):this.loadImages(tD.split(","))}),tI(0,tY,"autoAnimation",null,function(tD){this.play(0,!0,tD,!1)}),tO.createFrames=function(tD,tY){var tg,tT,tr=0,ts=0;if("string"==typeof tD){var ta=tWD.getAtlas(tD);if(ta&&ta.length)for(tg=[],tr=0,ts=ta.length;tr<ts;tr++)(tT=new tz.createGraphics).drawTexture(tWD.getRes(ta[tr]),0,0),tg.push(tT)}else if(tD instanceof Array)for(tg=[],tr=0,ts=tD.length;tr<ts;tr++)(tT=new tz.createGraphics).loadImage(tD[tr],0,0),tg.push(tT);return tY&&(tO.framesMap[tY]=tg),tg},tO.clearCache=function(tD){var tY,tg=tO.framesMap,tT=tD+"#";for(tY in tg)tY!==tD&&0!=tY.indexOf(tT)||delete tO.framesMap[tY]},tO.framesMap={}}(tdD),function(tD){function ts(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,ts.__super.call(this),null==ts._sortIndexFun&&(ts._sortIndexFun=tt.sortByKey("index",!1,!0))}tJ(ts,"laya.display.FrameAnimation",tD);var tY=ts.prototype;return tY._setUp=function(tD,tY){this._labels=null,this._animationNewFrames=null,this._targetDic=tD,this._animationData=tY,this.interval=1e3/tY.frameRate,tY.parsed?(this._count=tY.count,this._labels=tY.labels,this._animationNewFrames=tY.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),tY.parsed=!0,tY.labels=this._labels,tY.count=this._count,tY.animationNewFrames=this._animationNewFrames},tY.clear=function(){tD.prototype.clear.call(this),this._targetDic=null,this._animationData=null},tY._displayToIndex=function(tD){if(this._animationData){tD<0&&(tD=0),tD>this._count&&(tD=this._count);var tY=this._animationData.nodes,tg=0,tT=tY.length;for(tg=0;tg<tT;tg++)this._displayNodeToFrame(tY[tg],tD)}},tY._displayNodeToFrame=function(tD,tY,tg){tg||(tg=this._targetDic);var tT=tg[tD.target];if(tT){var tr,ts,ta,tW=tD.frames,tM=tD.keys,tE=0,tI=tM.length;for(tE=0;tE<tI;tE++)ta=(ts=tW[tr=tM[tE]]).length>tY?ts[tY]:ts[ts.length-1],tT[tr]=ta}},tY._calculateDatas=function(){if(this._animationData){var tD,tY=this._animationData.nodes,tg=0,tT=tY.length;for(tg=this._count=0;tg<tT;tg++)tD=tY[tg],this._calculateNodeKeyFrames(tD);this._count+=1}},tY._calculateNodeKeyFrames=function(tD){var tY,tg,tT=tD.keyframes,tr=tD.target;for(tY in tD.frames||(tD.frames={}),tD.keys?tD.keys.length=0:tD.keys=[],tD.initValues||(tD.initValues={}),tT)tg=tT[tY],tD.frames[tY]||(tD.frames[tY]=[]),this._targetDic&&this._targetDic[tr]&&(tD.initValues[tY]=this._targetDic[tr][tY]),tg.sort(ts._sortIndexFun),tD.keys.push(tY),this._calculateNodePropFrames(tg,tD.frames[tY],tY,tr)},tY.resetToInitState=function(){if(this._targetDic&&this._animationData){var tD,tY,tg=this._animationData.nodes,tT=0,tr=tg.length;for(tT=0;tT<tr;tT++)if(tY=(tD=tg[tT]).initValues){var ts,ta=this._targetDic[tD.target];if(ta)for(ts in tY)ta[ts]=tY[ts]}}},tY._calculateNodePropFrames=function(tD,tY,tg,tT){var tr=0,ts=tD.length-1;if(0<ts){for(tY.length=tD[ts].index+1,tr=0;tr<ts;tr++)this._dealKeyFrame(tD[tr]),this._calculateFrameValues(tD[tr],tD[tr+1],tY);this._dealKeyFrame(tD[tr])}0==ts&&(tY[tD[0].index]=tD[0].value,this._animationNewFrames&&(this._animationNewFrames[tD[0].index]=!0))},tY._dealKeyFrame=function(tD){tD.label&&""!=tD.label&&this.addLabel(tD.label,tD.index)},tY._calculateFrameValues=function(tD,tY,tg){var tT,tr=0,ts=tD.index,ta=tY.index,tW=tD.value,tM=tY.value-tD.value,tE=ta-ts;if(ta>this._count&&(this._count=ta),tD.tween)for(null==(tT=tk[tD.tweenMethod])&&(tT=tk.linearNone),tr=ts;tr<ta;tr++)tg[tr]=tT(tr-ts,tW,tM,tE),this._animationNewFrames&&(this._animationNewFrames[tr]=!0);else for(tr=ts;tr<ta;tr++)tg[tr]=tW;this._animationNewFrames&&(this._animationNewFrames[tD.index]=!0,this._animationNewFrames[tY.index]=!0),tg[tY.index]=tY.value},ts._sortIndexFun=null,ts}(tdD)),tlD=function(tY){function ts(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",ts.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=tJD.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}tJ(ts,"laya.display.Input",tY);var tD=ts.prototype;return tD.setSelection=function(tD,tY){this.focus=!0,laya.display.Input.inputElement.selectionStart=tD,laya.display.Input.inputElement.selectionEnd=tY},tD._onUnDisplay=function(tD){this.focus=!1},tD._onMouseDown=function(tD){this.focus=!0},tD._syncInputTransform=function(){var tD=this.nativeInput,tY=tL.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),tg=this._width-this.padding[1]-this.padding[3],tT=this._height-this.padding[0]-this.padding[2];if(tP.isConchApp)tD.setScale(tY.scaleX,tY.scaleY),tD.setSize(tg,tT),tD.setPos(tY.x,tY.y);else{var tr=1===tU.scroll_input_top;tr&&tD.style.backgroundColor&&(tD.style.backgroundColor=null),ts.inputContainer.style.transform=ts.inputContainer.style.webkitTransform="scale("+tY.scaleX+","+tY.scaleY+") rotate("+t_.stage.canvasDegree+"deg)",tD.style.width=tr?"720px":tg+"px",tD.style.height=tT+"px",ts.inputContainer.style.left=tr?"0px":tY.x+"px",ts.inputContainer.style.top=tr?"0px":tY.y+"px"}},tD.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},tD._setInputMethod=function(){ts.input.parentElement&&ts.inputContainer.removeChild(ts.input),ts.area.parentElement&&ts.inputContainer.removeChild(ts.area),ts.inputElement=this._multiline?ts.area:ts.input,ts.inputContainer.appendChild(ts.inputElement),tJD.RightToLeft&&(ts.inputElement.style.direction="rtl")},tD._focusIn=function(){laya.display.Input.isInputting=!0;var tD=this.nativeInput;this._focus=!0;var tY=tD.style;tY.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),tD.readOnly=!this._editable,tP.isConchApp&&(tD.setType(this._type),tD.setForbidEdit(!this._editable)),tD.maxLength=this._maxChars;this.padding;if(tD.type=this._type,tD.value=this._content,tD.placeholder=this._prompt,t_.stage.off("keydown",this,this._onKeyDown),t_.stage.on("keydown",this,this._onKeyDown),(t_.stage.focus=this).event("focus"),tU.onPC&&tD.focus(),!tU.onMiniGame){this._text;this._text=null}this.typeset(),tD.setColor(this._originColor),tD.setFontSize(this.fontSize),tD.setFontFace(tU.onIPhone&&tJD._fontFamilyMap[this.font]||this.font),tP.isConchApp&&tD.setMultiAble&&tD.setMultiAble(this._multiline),tY.lineHeight=this.leading+this.fontSize+"px",tY.fontStyle=this.italic?"italic":"normal",tY.fontWeight=this.bold?"bold":"normal",tY.textAlign=this.align,tY.padding="0 0",this._syncInputTransform(),!tP.isConchApp&&tU.onPC&&t_.timer.frameLoop(1,this,this._syncInputTransform)},tD._setPromptColor=function(){(ts.promptStyleDOM=tU.getElementById("promptStyle"))||((ts.promptStyleDOM=tU.createElement("style")).setAttribute("id","promptStyle"),tU.document.head.appendChild(ts.promptStyleDOM)),ts.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},tD._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(t_.superSet(tJD,this,"text",this._content),t_.superSet(tJD,this,"color",this._originColor)):(t_.superSet(tJD,this,"text",this._prompt),t_.superSet(tJD,this,"color",this._promptColor)),t_.stage.off("keydown",this,this._onKeyDown),t_.stage.focus=null,this.event("blur"),tP.isConchApp&&this.nativeInput.blur(),tU.onPC&&t_.timer.clear(this,this._syncInputTransform)},tD._onKeyDown=function(tD){13===tD.keyCode&&(tU.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},tD.changeText=function(tD){this._content=tD,this._focus?(this.nativeInput.value=tD||"",this.event("change")):tY.prototype.changeText.call(this,tD)},tI(0,tD,"color",tY.prototype._$get_color,function(tD){this._focus&&this.nativeInput.setColor(tD),t_.superSet(tJD,this,"color",this._content?tD:this._promptColor),this._originColor=tD}),tI(0,tD,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(tD){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),tI(0,tD,"multiline",function(){return this._multiline},function(tD){this._multiline=tD,this.valign=tD?"top":"middle"}),tI(0,tD,"maxChars",function(){return this._maxChars},function(tD){tD<=0&&(tD=1e5),this._maxChars=tD}),tI(0,tD,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(tD){t_.superSet(tJD,this,"color",this._originColor),tD+="",this._focus?(this.nativeInput.value=tD||"",this.event("change")):(this._multiline||(tD=tD.replace(/\r?\n/g,"")),(this._content=tD)?t_.superSet(tJD,this,"text",tD):(t_.superSet(tJD,this,"text",this._prompt),t_.superSet(tJD,this,"color",this.promptColor)))}),tI(0,tD,"nativeInput",function(){return this._multiline?ts.area:ts.input}),tI(0,tD,"prompt",function(){return this._prompt},function(tD){!this._text&&tD&&t_.superSet(tJD,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?t_.superSet(tJD,this,"text",this._text==this._prompt?tD:this._text):t_.superSet(tJD,this,"text",tD),this._prompt=tJD.langPacks&&tJD.langPacks[tD]?tJD.langPacks[tD]:tD}),tI(0,tD,"focus",function(){return this._focus},function(tD){var tY=this.nativeInput;this._focus!==tD&&(tD?(tY.target?tY.target._focusOut():this._setInputMethod(),(tY.target=this)._focusIn()):(tY.target=null,this._focusOut(),tU.document.body.scrollTop=0,tY.blur(),tP.isConchApp?tY.setPos(-1e4,-1e4):ts.inputContainer.contains(tY)&&ts.inputContainer.removeChild(tY)))}),tI(0,tD,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(tD){tD?(-1<(tD="[^"+tD+"]").indexOf("^^")&&(tD=tD.replace("^^","")),this._restrictPattern=new RegExp(tD,"g")):this._restrictPattern=null}),tI(0,tD,"editable",function(){return this._editable},function(tD){this._editable=tD,tP.isConchApp&&ts.input.setForbidEdit(!tD)}),tI(0,tD,"promptColor",function(){return this._promptColor},function(tD){this._promptColor=tD,this._content||t_.superSet(tJD,this,"color",tD)}),tI(0,tD,"type",function(){return this._type},function(tD){this._getCSSStyle().password="password"==tD,this._type=tD,tP.isConchApp&&this.nativeInput.setType(tD)}),tI(0,tD,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(tD){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),tI(0,tD,"asPassword",function(){return this._getCSSStyle().password},function(tD){this._getCSSStyle().password=tD,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),ts.__init__=function(){ts._createInputElement(),tU.onMobile&&tP.canvas.addEventListener(ts.IOS_IFRAME?tU.onMiniGame?"touchend":"click":"touchend",ts._popupInputMethod)},ts._popupInputMethod=function(tD){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},ts._createInputElement=function(){ts._initInput(ts.area=tU.createElement("textarea")),ts._initInput(ts.input=tU.createElement("input")),(ts.inputContainer=tU.createElement("div")).style.position="absolute",ts.inputContainer.style.zIndex=1e5,tU.container.appendChild(ts.inputContainer),ts.inputContainer.setPos=function(tD,tY){ts.inputContainer.style.left=tD+"px",ts.inputContainer.style.top=tY+"px"}},ts._initInput=function(tY){var tD=tY.style;tD.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",tD.resize="none",tD.backgroundColor="transparent",tD.border="none",tD.outline="none",tD.zIndex=1,tY.addEventListener("input",ts._processInputting),tY.addEventListener("mousemove",ts._stopEvent),tY.addEventListener("mousedown",ts._stopEvent),tY.addEventListener("touchmove",ts._stopEvent),tY.setFontFace=function(tD){tY.style.fontFamily=tD},tP.isConchApp||(tY.setColor=function(tD){tY.style.color=tD},tY.setFontSize=function(tD){tY.style.fontSize=tD+"px"})},ts._processInputting=function(tD){var tY=laya.display.Input.inputElement.target;if(tY){var tg=laya.display.Input.inputElement.value;tY._restrictPattern&&(tg=tg.replace(/\u2006|\x27/g,""),tY._restrictPattern.test(tg)&&(tg=tg.replace(tY._restrictPattern,""),laya.display.Input.inputElement.value=tg)),tY._text=tg,tY.event("input")}},ts._stopEvent=function(tD){"touchmove"==tD.type&&tD.preventDefault(),tD.stopPropagation&&tD.stopPropagation()},ts.TYPE_TEXT="text",ts.TYPE_PASSWORD="password",ts.TYPE_EMAIL="email",ts.TYPE_URL="url",ts.TYPE_NUMBER="number",ts.TYPE_RANGE="range",ts.TYPE_DATE="date",ts.TYPE_MONTH="month",ts.TYPE_WEEK="week",ts.TYPE_TIME="time",ts.TYPE_DATE_TIME="datetime",ts.TYPE_DATE_TIME_LOCAL="datetime-local",ts.TYPE_SEARCH="search",ts.input=null,ts.area=null,ts.inputElement=null,ts.inputContainer=null,ts.confirmButton=null,ts.promptStyleDOM=null,ts.inputHeight=45,ts.isInputting=!1,ts.stageMatrix=null,ta(ts,["IOS_IFRAME",function(){return this.IOS_IFRAME=tU.onIOS&&tU.window.top!=tU.window.self}]),ts}(tJD),ttD=function(tD){function tg(tD,tY){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,tg.__super.call(this),tD&&this._init_(tD,tY)}tJ(tg,"laya.resource.HTMLImage",tjD);var tY=tg.prototype;return tY._init_=function(tD,tY){this._src=tD,this._source=new tU.window.Image,tY&&(tY.onload&&(this.onload=tY.onload),tY.onerror&&(this.onerror=tY.onerror),tY.onCreate&&tY.onCreate(this)),0!=tD.indexOf("data:image")&&(this._source.crossOrigin=""),tD&&(this._source.src=tD)},tY.recreateResource=function(){var tD=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var tY=this;this._source=new tU.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(tY._needReleaseAgain)return tY._needReleaseAgain=!1,tY._source.onload=null,void(tY._source=null);tY._source.onload=null,tY.memorySize=tD._w*tD._h*4,tY._recreateLock=!1,tY.completeCreate()},this._source.src=this._src}},tY.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},tY.onresize=function(){this._w=this._source.width,this._h=this._source.height},tI(0,tY,"onload",null,function(tD){var tY=this;this._onload=tD,this._source&&(this._source.onload=null!=this._onload?function(){tY.onresize(),tY._onload()}:null)}),tI(0,tY,"onerror",null,function(tD){var tY=this;this._onerror=tD,this._source&&(this._source.onerror=null!=this._onerror?function(){tY._onerror()}:null)}),tI(0,tY,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(tD){this._enableMerageInAtlas=tD,tP.isConchApp&&this._source&&(this._source.enableMerageInAtlas=tD)}),tg.create=function(tD,tY){return new tg(tD,tY)},tg}(),t_D=(function(ts){function tD(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,tD.__super.call(this)}tJ(tD,"laya.display.EffectAnimation",ts);var tY=tD.prototype;tY._onOtherBegin=function(tD){tD!=this&&this.stop()},tY.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},tY._onPlayAction=function(){this.play(0,!1)},tY.play=function(tD,tY,tg,tT){void 0===tD&&(tD=0),void 0===tY&&(tY=!0),void 0===tg&&(tg=""),void 0===tT&&(tT=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,tD,tY,tg,tT))},tY._recordInitData=function(){if(this._aniKeys){var tD,tY,tg=0;for(tD=this._aniKeys.length,tg=0;tg<tD;tg++)tY=this._aniKeys[tg],this._initData[tY]=this._target[tY]}},tY._displayToIndex=function(tD){if(this._animationData){tD<0&&(tD=0),tD>this._count&&(tD=this._count);var tY=this._animationData.nodes,tg=0,tT=tY.length;for(tT=1<tT?1:tT,tg=0;tg<tT;tg++)this._displayNodeToFrame(tY[tg],tD)}},tY._displayNodeToFrame=function(tD,tY,tg){if(this._target){var tT;tT=this._target;var tr,ts,ta,tW,tM=tD.frames,tE=tD.keys,tI=0,tO=tE.length;tW=tD.secondFrames;var tC,tN,t$,td,tJ=0;for(tI=0;tI<tO;tI++)ts=tM[tr=tE[tI]],ta=-1==(tJ=tW[tr])?this._initData[tr]:tY<tJ?(t$=(tN=tD.keyframes[tr])[0]).tween?(null==(tC=tk[t$.tweenMethod])&&(tC=tk.linearNone),td=tN[1],tC(tY,this._initData[tr],td.value-this._initData[tr],td.index)):this._initData[tr]:ts.length>tY?ts[tY]:ts[ts.length-1],tT[tr]=ta}},tY._calculateNodeKeyFrames=function(tD){ts.prototype._calculateNodeKeyFrames.call(this,tD);var tY,tg,tT,tr=tD.keyframes;tD.target;for(tY in tT={},tD.secondFrames=tT,tr)(tg=tr[tY]).length<=1?tT[tY]=-1:tT[tY]=tg[1].index},tI(0,tY,"target",function(){return this._target},function(tD){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=tD,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),tI(0,tY,"playEvent",null,function(tD){(this._playEvents=tD)&&this.addEvent()}),tI(0,tY,"effectData",null,function(tD){var tY;tD&&((tY=tD.animations)&&tY[0]&&(this._setUp({},tY[0]),tY[0].nodes&&tY[0].nodes[0]&&(this._aniKeys=tY[0].nodes[0].keys)))}),tI(0,tY,"effectClass",null,function(tD){var tY,tg;(this._effectClass=tc.getClass(tD),this._effectClass)&&((tY=this._effectClass.uiView)&&(tg=tY.animations)&&tg[0]&&(this._setUp({},tg[0]),tg[0].nodes&&tg[0].nodes[0]&&(this._aniKeys=tg[0].nodes[0].keys)))}),tD.EffectAnimationBegin="effectanimationbegin"}(tpD),function(tY){var tG;function tX(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,tX.__super.call(this)}tJ(tX,"laya.utils.GraphicAnimation",tY);var tD=tX.prototype;return tD._parseNodeList=function(tD){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[tD.compId]=tD.props,tD.compId&&this._nodeList.push(tD.compId);var tY=tD.child;if(tY){var tg=0,tT=tY.length;for(tg=0;tg<tT;tg++)this._parseNodeList(tY[tg])}},tD._calGraphicData=function(tD){var tY;if(this._setUp(null,tD),this._createGraphicData(),this._nodeIDAniDic)for(tY in this._nodeIDAniDic)this._nodeIDAniDic[tY]=null},tD._createGraphicData=function(){var tD,tY=[],tg=0,tT=this.count,tr=this._animationNewFrames;for(tr||(tr=[]),tg=0;tg<tT;tg++)!tr[tg]&&tD||(tD=this._createFrameGraphic(tg)),tY.push(tD);this._gList=tY},tD._createFrameGraphic=function(tD){var tY=tz.createGraphics();return tX._rootMatrix||(tX._rootMatrix=new tm),this._updateNodeGraphic(this._rootNode,tD,tX._rootMatrix,tY),tY},tD._updateNodeGraphic=function(tD,tY,tg,tT,tr){var ts;void 0===tr&&(tr=1);var ta,tW,tM,tE=(ts=this._nodeGDic[tD.compId]=this._getNodeGraphicData(tD.compId,tY,this._nodeGDic[tD.compId])).alpha*tr;if(!(tE<.01)&&(ts.resultTransform||(ts.resultTransform=tm.create()),ta=ts.resultTransform,tm.mul(ts.transform,tg,ta),ts.skin&&(tW=this._getTextureByUrl(ts.skin))&&(ta._checkTransform()?(tT.drawTexture(tW,0,0,ts.width,ts.height,ta,tE),ts.resultTransform=null):tT.drawTexture(tW,ta.tx,ta.ty,ts.width,ts.height,null,tE)),tM=tD.child)){var tI,tO=0;for(tI=tM.length,tO=0;tO<tI;tO++)this._updateNodeGraphic(tM[tO],tY,ta,tT,tE)}},tD._updateNoChilds=function(tD,tY){if(tD.skin){var tg=this._getTextureByUrl(tD.skin);if(tg){var tT=tD.transform;tT._checkTransform();!tT.bTransform?tY.drawTexture(tg,tT.tx,tT.ty,tD.width,tD.height,null,tD.alpha):tY.drawTexture(tg,0,0,tD.width,tD.height,tT.clone(),tD.alpha)}}},tD._updateNodeGraphic2=function(tD,tY,tg){var tT;if(tT=this._nodeGDic[tD.compId]=this._getNodeGraphicData(tD.compId,tY,this._nodeGDic[tD.compId]),tD.child){var tr=tT.transform;tr._checkTransform();var ts,ta;ta=(ts=!tr.bTransform)&&(0!=tr.tx||0!=tr.ty);var tW,tM,tE;if((tW=tr.bTransform||1!=tT.alpha)&&tg.save(),1!=tT.alpha&&tg.alpha(tT.alpha),ts?ta&&tg.translate(tr.tx,tr.ty):tg.transform(tr.clone()),tM=tD.child,tT.skin&&(tE=this._getTextureByUrl(tT.skin))&&tg.drawTexture(tE,0,0,tT.width,tT.height),tM){var tI,tO=0;for(tI=tM.length,tO=0;tO<tI;tO++)this._updateNodeGraphic2(tM[tO],tY,tg)}tW?tg.restore():ts?ta&&tg.translate(-tr.tx,-tr.ty):tg.transform(tr.clone().invert())}else this._updateNoChilds(tT,tg)},tD._calculateNodeKeyFrames=function(tD){tY.prototype._calculateNodeKeyFrames.call(this,tD),this._nodeIDAniDic[tD.target]=tD},tD.getNodeDataByID=function(tD){return this._nodeIDAniDic[tD]},tD._getParams=function(tD,tY,tg,tT){var tr=tX._temParam;tr.length=tY.length;var ts=0,ta=tY.length;for(ts=0;ts<ta;ts++)tr[ts]=this._getObjVar(tD,tY[ts][0],tg,tY[ts][1],tT);return tr},tD._getObjVar=function(tD,tY,tg,tT,tr){if(tD.hasOwnProperty(tY)){var ts=tD[tY];if(tg>=ts.length&&(tg=ts.length-1),null!=tD[tY][tg])return tD[tY][tg]}return tr.hasOwnProperty(tY)?tr[tY]:tT},tD._getNodeGraphicData=function(tD,tY,tg){tg||(tg=tG.create()),tg.transform?tg.transform.identity():tg.transform=tm.create();var tT=this.getNodeDataByID(tD);if(!tT)return tg;var tr,ts,ta=tT.frames,tW=this._getParams(ta,tX._drawTextureCmd,tY,this._nodeDefaultProps[tD]),tM=tW[0],tE=NaN,tI=NaN,tO=tW[5],tC=tW[6],tN=tW[13],t$=tW[14],td=tW[7],tJ=tW[8],tx=tW[9],tj=tW[11],tZ=tW[12];tE=tW[3],tI=tW[4],0!=tE&&0!=tI||(tM=null),-1==tE&&(tE=0),-1==tI&&(tI=0),tg.skin=tM,tg.width=tE,tg.height=tI,tM&&((tr=this._getTextureByUrl(tM))?(tE||(tE=tr.sourceWidth),tI||(tI=tr.sourceHeight)):console.warn("lost skin:",tM,",you may load pics first")),tg.alpha=tW[10],ts=tg.transform,0!=tN&&(tO=tN*tE),0!=t$&&(tC=t$*tI),0==tO&&0==tC||ts.translate(-tO,-tC);var tp=null;if(tx||1!==td||1!==tJ||tj||tZ){(tp=tX._tempMt).identity(),tp.bTransform=!0;var tl=.0174532922222222*(tx-tj),tt=.0174532922222222*(tx+tZ),t_=Math.cos(tt),tA=Math.sin(tt),tq=Math.sin(tl),tb=Math.cos(tl);tp.a=td*t_,tp.b=td*tA,tp.c=-tJ*tq,tp.d=tJ*tb,tp.tx=tp.ty=0}return tp&&(ts=tm.mul(ts,tp,ts)),ts.translate(tW[1],tW[2]),tg},tD._getTextureByUrl=function(tD){return tWD.getRes(tD)},tD.setAniData=function(tD,tY){if(tD.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=tD,this._parseNodeList(tD);var tg,tT={},tr=[],ts=tD.animations,ta=0,tW=ts.length;for(ta=0;ta<tW;ta++)if(tg=ts[ta],this._labels=null,(!tY||tY==tg.name)&&tg){try{this._calGraphicData(tg)}catch(tD){console.warn("parse animation fail:"+tg.name+",empty animation created"),this._gList=[]}var tM={};tM.interval=1e3/tg.frameRate,tM.frames=this._gList,tM.labels=this._labels,tM.name=tg.name,tr.push(tM),tT[tg.name]=tM}this.animationList=tr,this.animationDic=tT}tX._temParam.length=0},tD.parseByData=function(tD){var tY,tg;tY=tD.nodeRoot,tg=tD.aniO,delete tD.nodeRoot,delete tD.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=tY,this._parseNodeList(tY),this._labels=null;try{this._calGraphicData(tg)}catch(tD){console.warn("parse animation fail:"+tg.name+",empty animation created"),this._gList=[]}var tT=tD;return tT.interval=1e3/tg.frameRate,tT.frames=this._gList,tT.labels=this._labels,tT.name=tg.name,tT},tD.setUpAniData=function(tD){if(tD.animations){var tY,tg={},tT=[],tr=tD.animations,ts=0,ta=tr.length;for(ts=0;ts<ta;ts++)if(tY=tr[ts]){var tW={};tW.name=tY.name,tW.aniO=tY,tW.nodeRoot=tD,tT.push(tW),tg[tY.name]=tW}this.animationList=tT,this.animationDic=tg}},tD._clear=function(){var tD,tY;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(tD in this._nodeGDic)(tY=this._nodeGDic[tD])&&tY.recover();this._nodeGDic=null},tX.parseAnimationByData=function(tD){var tY;return tX._I||(tX._I=new tX),tY=tX._I.parseByData(tD),tX._I._clear(),tY},tX.parseAnimationData=function(tD){var tY;return tX._I||(tX._I=new tX),tX._I.setUpAniData(tD),(tY={}).animationList=tX._I.animationList,tY.animationDic=tX._I.animationDic,tX._I._clear(),tY},tX._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],tX._temParam=[],tX._I=null,tX._rootMatrix=null,ta(tX,["_tempMt",function(){return this._tempMt=new tm}]),tX.__init$=function(){tG=function(){function tD(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return tJ(tD,""),tD.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),tK.recover("GraphicNode",this)},tD.create=function(){return tK.getItemByClass("GraphicNode",tD)},tD}()},tX}(tpD));t_.__init([tM,tMD,tP,tU,tR,tb,tD,t_D])}(window,document,Laya),function(tD,tY,tg){tg.un,tg.uns,tg.static;var tT=tg.class;tg.getset,tg.__newvec;new(function(){function tD(){}return tT(tD,"LayaMain"),tD}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(tD,tY){"use strict";for(var tg in Object.defineProperty(tY,"__esModule",{value:!0}),Laya){var tT=Laya[tg];tT&&tT.__isclass&&(tY[tg]=tT)}}),function(ts,tD,tt){tt.un,tt.uns;var ta=tt.static,tC=tt.class,tT=tt.getset,tW=tt.__newvec,tI=laya.maths.Arith,tO=laya.maths.Bezier,tg=laya.resource.Bitmap,tN=laya.utils.Browser,tM=laya.utils.Byte,t$=laya.utils.Color,t_=(laya.filters.ColorFilter,tt.Config),tr=laya.resource.Context,tA=(laya.events.Event,laya.filters.Filter),tE=laya.display.Graphics,td=laya.resource.HTMLCanvas,tJ=(laya.utils.HTMLChar,laya.resource.HTMLImage),tY=laya.resource.HTMLSubImage,tq=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),tb=laya.maths.Point,tG=laya.maths.Rectangle,tx=laya.renders.Render,tj=(laya.renders.RenderContext,laya.renders.RenderSprite),tZ=laya.resource.Resource,tp=laya.resource.ResourceManager,tl=laya.utils.RunDriver,tX=laya.display.Sprite,tz=laya.display.Stage,tm=laya.utils.Stat,th=laya.utils.StringKey,ti=(laya.display.css.Style,laya.system.System),tP=laya.display.Text,tB=laya.resource.Texture,tH=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),tv=laya.utils.VectorGraphManager;laya.utils.WordText;tt.interface("laya.webgl.shapes.IShape"),tt.interface("laya.webgl.submit.ISubmit"),tt.interface("laya.webgl.text.ICharSegment"),tt.interface("laya.webgl.canvas.save.ISaveData"),tt.interface("laya.webgl.resource.IMergeAtlasBitmap"),tt.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var tS=function(){function tD(){}tC(tD,"laya.filters.webgl.FilterActionGL");var tY=tD.prototype;return tt.imps(tY,{"laya.filters.IFilterActionGL":!0}),tY.setValue=function(tD){},tY.setValueMix=function(tD){},tY.apply3d=function(tD,tY,tg,tT,tr){return null},tY.apply=function(tD){return null},tT(0,tY,"typeMix",function(){return 0}),tD}(),tU=function(){function tD(){}return tC(tD,"laya.webgl.shader.ShaderValue"),tD}(),tF=function(){var tT,tr;function tD(tD,tY,tg){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new tr,void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),this._cells=null,this._rowInfo=null,this._init(tD,tY),this._atlasID=tg}tC(tD,"laya.webgl.atlas.AtlasGrid");var tY=tD.prototype;return tY.getAltasID=function(){return this._atlasID},tY.setAltasID=function(tD){0<=tD&&(this._atlasID=tD)},tY.addTex=function(tD,tY,tg){var tT=this._get(tY,tg);return 0==tT.ret||(this._fill(tT.x,tT.y,tY,tg,tD),this._texCount++),tT},tY._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},tY._init=function(tD,tY){if(this._width=tD,this._height=tY,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=tW(this._height);for(var tg=0;tg<this._height;tg++)this._rowInfo[tg]=new tT;return this._clear(),!0},tY._get=function(tD,tY){var tg=new tc;if(tD>=this._failSize.width&&tY>=this._failSize.height)return tg;for(var tT=-1,tr=-1,ts=this._width,ta=this._height,tW=this._cells,tM=0;tM<ta;tM++)if(!(this._rowInfo[tM].spaceCount<tD))for(var tE=0;tE<ts;){var tI=3*(tM*ts+tE);if(0!=tW[tI]||tW[1+tI]<tD||tW[2+tI]<tY)tE+=tW[1+tI];else{tT=tE,tr=tM;for(var tO=0;tO<tD;tO++)if(tW[3*tO+tI+2]<tY){tT=-1;break}if(!(tT<0))return tg.ret=!0,tg.x=tT,tg.y=tr,tg;tE+=tW[1+tI]}}return tg},tY._fill=function(tD,tY,tg,tT,tr){var ts=this._width,ta=this._height;this._check(tD+tg<=ts&&tY+tT<=ta);for(var tW=tY;tW<tT+tY;++tW){this._check(this._rowInfo[tW].spaceCount>=tg),this._rowInfo[tW].spaceCount-=tg;for(var tM=0;tM<tg;tM++){var tE=3*(tD+tW*ts+tM);this._check(0==this._cells[tE]),this._cells[tE]=tr,this._cells[1+tE]=tg,this._cells[2+tE]=tT}}if(0<tD)for(tW=0;tW<tT;++tW){var tI=0;for(tM=tD-1;0<=tM&&0==this._cells[3*((tY+tW)*ts+tM)];--tM,++tI);for(tM=tI;0<tM;--tM)this._cells[3*((tY+tW)*ts+tD-tM)+1]=tM,this._check(0<tM)}if(0<tY)for(tM=tD;tM<tD+tg;++tM){for(tI=0,tW=tY-1;0<=tW&&0==this._cells[3*(tM+tW*ts)];--tW,tI++);for(tW=tI;0<tW;--tW)this._cells[3*(tM+(tY-tW)*ts)+2]=tW,this._check(0<tW)}},tY._check=function(tD){0==tD&&console.log("xtexMerger 错误啦")},tY._clear=function(){for(var tD=this._texCount=0;tD<this._height;tD++)this._rowInfo[tD].spaceCount=this._width;for(var tY=0;tY<this._height;tY++)for(var tg=0;tg<this._width;tg++){var tT=3*(tY*this._width+tg);this._cells[tT]=0,this._cells[1+tT]=this._width-tg,this._cells[2+tT]=this._width-tY}this._failSize.width=this._width+1,this._failSize.height=this._height+1},tD.__init$=function(){tT=function(){function tD(){this.spaceCount=0}return tC(tD,""),tD}(),tr=function(){function tD(){this.width=0,this.height=0}return tC(tD,""),tD}()},tD}(),tV=function(){function tx(tD,tY,tg,tT){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=tD,this._height=tY,this._gridSize=tg,this._maxAtlaserCount=tT,this._gridNumX=tD/tg,this._gridNumY=tY/tg,this._curAtlasIndex=0,this._atlaserArray=[]}tC(tx,"laya.webgl.atlas.AtlasResourceManager");var tD=tx.prototype;return tD.setAtlasParam=function(tD,tY,tg,tT){if(1==this._setAtlasParam)return tx._sid_=0,this._width=tD,this._height=tY,this._gridSize=tg,this._maxAtlaserCount=tT,this._gridNumX=tD/tg,this._gridNumY=tY/tg,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},tD.pushData=function(tD){var tY,tg=tD.bitmap,tT=-1,tr=null,ts=0,ta=0;for(ts=0,tY=this._atlaserArray.length;ts<tY&&(ta=(this._curAtlasIndex+ts)%tY,-1==(tT=(tr=this._atlaserArray[ta]).findBitmapIsExist(tg)));ts++);if(-1!=tT){var tW=tr.InAtlasWebGLImagesOffsetValue[tT];return t$=tW[0],td=tW[1],tr.addToAtlas(tD,t$,td),!0}this._setAtlasParam=!1;for(var tM=Math.ceil((tD.bitmap.width+2)/this._gridSize),tE=Math.ceil((tD.bitmap.height+2)/this._gridSize),tI=!1,tO=0;tO<2;tO++){var tC=this._maxAtlaserCount;for(ts=0;ts<tC;ts++){ta=(this._curAtlasIndex+ts)%tC,this._atlaserArray.length-1>=ta||this._atlaserArray.push(new tGD(this._gridNumX,this._gridNumY,this._width,this._height,tx._sid_++));var tN=this._atlaserArray[ta],t$=0,td=0,tJ=tN.addTex(1,tM,tE);if(tJ.ret){t$=tJ.x*this._gridSize+1,td=tJ.y*this._gridSize+1,tg.lock=!0,tN.addToAtlasTexture(tg,t$,td),tN.addToAtlas(tD,t$,td),tI=!0,this._curAtlasIndex=ta;break}}if(tI)break;this._atlaserArray.push(new tGD(this._gridNumX,this._gridNumY,this._width,this._height,tx._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return tI||console.log(">>>AtlasManager pushData error"),tI},tD.addToAtlas=function(tD){laya.webgl.atlas.AtlasResourceManager.instance.pushData(tD)},tD.garbageCollection=function(){if(!0===this._needGC){for(var tD=this._atlaserArray.length-this._maxAtlaserCount,tY=0;tY<tD;tY++)this._atlaserArray[tY].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+tD),this._atlaserArray.splice(0,tD),this._needGC=!1}return!0},tD.freeAll=function(){for(var tD=0,tY=this._atlaserArray.length;tD<tY;tD++)this._atlaserArray[tD].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},tD.getAtlaserCount=function(){return this._atlaserArray.length},tD.getAtlaserByIndex=function(tD){return this._atlaserArray[tD]},tT(1,tx,"instance",function(){return tx._Instance||(tx._Instance=new tx(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),tx._Instance}),tT(1,tx,"enabled",function(){return t_.atlasEnable}),tT(1,tx,"atlasLimitWidth",function(){return tx._atlasLimitWidth},function(tD){tx._atlasLimitWidth=tD}),tT(1,tx,"atlasLimitHeight",function(){return tx._atlasLimitHeight},function(tD){tx._atlasLimitHeight=tD}),tx._enable=function(){t_.atlasEnable=!0},tx._disable=function(){t_.atlasEnable=!1},tx.__init__=function(){tx.atlasTextureWidth=2048,tx.atlasTextureHeight=2048,tx.maxTextureCount=6,tx.atlasLimitWidth=512,tx.atlasLimitHeight=512},tx._atlasLimitWidth=0,tx._atlasLimitHeight=0,tx.gridSize=16,tx.atlasTextureWidth=0,tx.atlasTextureHeight=0,tx.maxTextureCount=0,tx._atlasRestore=0,tx.BOARDER_TYPE_NO=0,tx.BOARDER_TYPE_RIGHT=1,tx.BOARDER_TYPE_LEFT=2,tx.BOARDER_TYPE_BOTTOM=4,tx.BOARDER_TYPE_TOP=8,tx.BOARDER_TYPE_ALL=15,tx._sid_=0,tx._Instance=null,tx}(),tc=function(){function tD(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return tC(tD,"laya.webgl.atlas.MergeFillInfo"),tD}(),tf=function(){function tY(){}return tC(tY,"laya.webgl.canvas.BlendMode"),tY._init_=function(tD){tY.fns=[tY.BlendNormal,tY.BlendAdd,tY.BlendMultiply,tY.BlendScreen,tY.BlendOverlay,tY.BlendLight,tY.BlendMask,tY.BlendDestinationOut],tY.targetFns=[tY.BlendNormalTarget,tY.BlendAddTarget,tY.BlendMultiplyTarget,tY.BlendScreenTarget,tY.BlendOverlayTarget,tY.BlendLightTarget,tY.BlendMask,tY.BlendDestinationOut]},tY.BlendNormal=function(tD){tD.blendFunc(1,771)},tY.BlendAdd=function(tD){tD.blendFunc(1,772)},tY.BlendMultiply=function(tD){tD.blendFunc(774,771)},tY.BlendScreen=function(tD){tD.blendFunc(1,1)},tY.BlendOverlay=function(tD){tD.blendFunc(1,769)},tY.BlendLight=function(tD){tD.blendFunc(1,1)},tY.BlendNormalTarget=function(tD){tD.blendFunc(1,771)},tY.BlendAddTarget=function(tD){tD.blendFunc(1,772)},tY.BlendMultiplyTarget=function(tD){tD.blendFunc(774,771)},tY.BlendScreenTarget=function(tD){tD.blendFunc(1,1)},tY.BlendOverlayTarget=function(tD){tD.blendFunc(1,769)},tY.BlendLightTarget=function(tD){tD.blendFunc(1,1)},tY.BlendMask=function(tD){tD.blendFunc(0,770)},tY.BlendDestinationOut=function(tD){tD.blendFunc(0,0)},tY.activeBlendFunction=null,tY.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],tY.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},tY.NORMAL="normal",tY.ADD="add",tY.MULTIPLY="multiply",tY.SCREEN="screen",tY.LIGHT="light",tY.OVERLAY="overlay",tY.DESTINATIONOUT="destination-out",tY.fns=[],tY.targetFns=[],tY}(),te=function(){function tg(tD){this._color=t$.create("black"),this.setValue(tD)}tC(tg,"laya.webgl.canvas.DrawStyle");var tD=tg.prototype;return tD.setValue=function(tD){if(tD){if("string"==typeof tD)return void(this._color=t$.create(tD));if(tD instanceof laya.utils.Color)return void(this._color=tD)}},tD.reset=function(){this._color=t$.create("black")},tD.equal=function(tD){return"string"==typeof tD?this._color.strColor===tD:tD instanceof laya.utils.Color&&this._color.numColor===tD.numColor},tD.toColorStr=function(){return this._color.strColor},tg.create=function(tD){var tY;if(tD&&("string"==typeof tD?tY=t$.create(tD):tD instanceof laya.utils.Color&&(tY=tD),tY))return tY._drawStyle||(tY._drawStyle=new tg(tD));return laya.webgl.canvas.DrawStyle.DEFAULT},ta(tg,["DEFAULT",function(){return this.DEFAULT=new tg("#000000")}]),tg}(),tk=function(){function tD(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];tpD.mainContext;this.ib=tuD.create(35048),this.vb=tnD.create(5)}tC(tD,"laya.webgl.canvas.Path");var tY=tD.prototype;return tY.addPoint=function(tD,tY){this.tempArray.push(tD,tY)},tY.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},tY.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},tY.polygon=function(tD,tY,tg,tT,tr,ts){var ta;return this.geomatrys.push(this._curGeomatry=ta=new thD(tD,tY,tg,tT,tr,ts)),tT||(ta.fill=!1),null==ts&&(ta.borderWidth=0),ta},tY.setGeomtry=function(tD){this.geomatrys.push(this._curGeomatry=tD)},tY.drawLine=function(tD,tY,tg,tT,tr){var ts;return this.closePath?this.geomatrys.push(this._curGeomatry=ts=new tmD(tD,tY,tg,tT,tr)):this.geomatrys.push(this._curGeomatry=ts=new tzD(tD,tY,tg,tT,tr)),ts.fill=!1,ts},tY.update=function(){var tD=this.ib._byteLength,tY=this.geomatrys.length;this.offset=tD;for(var tg=this.geoStart;tg<tY;tg++)this.geomatrys[tg].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=tY,this.count=(this.ib._byteLength-tD)/tdD.BYTES_PIDX},tY.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},tY.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},tD}(),tw=function(){function tW(){}tC(tW,"laya.webgl.canvas.save.SaveBase");var tD=tW.prototype;return tt.imps(tD,{"laya.webgl.canvas.save.ISaveData":!0}),tD.isSaveMark=function(){return!1},tD.restore=function(tD){this._dataObj[this._valueName]=this._value,(tW._cache[tW._cache._length++]=this)._newSubmit&&(tD._curSubmit=tsD.RENDERBASE,tD._renderKey=0)},tW._createArray=function(){var tD=[];return tD._length=0,tD},tW._init=function(){var tD=tW._namemap={};return tD[1]="ALPHA",tD[2]="fillStyle",tD[8]="font",tD[256]="lineWidth",tD[512]="strokeStyle",tD[8192]="_mergeID",tD[1024]=tD[2048]=tD[4096]=[],tD[16384]="textBaseline",tD[32768]="textAlign",tD[65536]="_nBlendType",tD[1048576]="shader",tD[2097152]="filters",tD},tW.save=function(tD,tY,tg,tT){if((tD._saveMark._saveuse&tY)!==tY){tD._saveMark._saveuse|=tY;var tr=tW._cache,ts=0<tr._length?tr[--tr._length]:new tW;ts._value=tg[ts._valueName=tW._namemap[tY]],ts._dataObj=tg,ts._newSubmit=tT;var ta=tD._save;ta[ta._length++]=ts}},tW._cache=laya.webgl.canvas.save.SaveBase._createArray(),tW._namemap=tW._init(),tW}(),tK=function(){function ts(){this._clipRect=new tG}tC(ts,"laya.webgl.canvas.save.SaveClipRect");var tD=ts.prototype;return tt.imps(tD,{"laya.webgl.canvas.save.ISaveData":!0}),tD.isSaveMark=function(){return!1},tD.restore=function(tD){tD._clipRect=this._clipSaveRect,(ts._cache[ts._cache._length++]=this)._submitScissor.submitLength=tD._submits._length-this._submitScissor.submitIndex,tD._curSubmit=tsD.RENDERBASE,tD._renderKey=0},ts.save=function(tD,tY){if(131072!=(131072&tD._saveMark._saveuse)){tD._saveMark._saveuse|=131072;var tg=ts._cache,tT=0<tg._length?tg[--tg._length]:new ts;tT._clipSaveRect=tD._clipRect,tD._clipRect=tT._clipRect.copyFrom(tD._clipRect),tT._submitScissor=tY;var tr=tD._save;tr[tr._length++]=tT}},ta(ts,["_cache",function(){return this._cache=tw._createArray()}]),ts}(),to=function(){function tN(){this._contextX=0,this._contextY=0,this._clipRect=new tG,this._rect=new tG,this._matrix=new tq}tC(tN,"laya.webgl.canvas.save.SaveClipRectStencil");var tD=tN.prototype;return tt.imps(tD,{"laya.webgl.canvas.save.ISaveData":!0}),tD.isSaveMark=function(){return!1},tD.restore=function(tD){tID.restore(tD,this._rect,this._saveMatrix,this._contextX,this._contextY),tD._clipRect=this._clipSaveRect,tD._curMat=this._saveMatrix,tD._x=this._contextX,tD._y=this._contextY,tN._cache[tN._cache._length++]=this,tD._curSubmit=tsD.RENDERBASE},tN.save=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){if(262144!=(262144&tD._saveMark._saveuse)){tD._saveMark._saveuse|=262144;var tI=tN._cache,tO=0<tI._length?tI[--tI._length]:new tN;tO._clipSaveRect=tD._clipRect,tO._clipRect.setTo(ta,tW,tM,tE),tD._clipRect=tO._clipRect,tO._rect.x=tg,tO._rect.y=tT,tO._rect.width=tr,tO._rect.height=ts,tO._contextX=tD._x,tO._contextY=tD._y,tO._saveMatrix=tD._curMat,tD._curMat.copyTo(tO._matrix),tD._curMat=tO._matrix,tO._submitStencil=tY;var tC=tD._save;tC[tC._length++]=tO}},ta(tN,["_cache",function(){return this._cache=tw._createArray()}]),tN}(),tR=function(){function tT(){this._saveuse=0}tC(tT,"laya.webgl.canvas.save.SaveMark");var tD=tT.prototype;return tt.imps(tD,{"laya.webgl.canvas.save.ISaveData":!0}),tD.isSaveMark=function(){return!0},tD.restore=function(tD){tD._saveMark=this._preSaveMark,tT._no[tT._no._length++]=this},tT.Create=function(tD){var tY=tT._no,tg=0<tY._length?tY[--tY._length]:new tT;return tg._saveuse=0,tg._preSaveMark=tD._saveMark,tD._saveMark=tg},ta(tT,["_no",function(){return this._no=tw._createArray()}]),tT}(),tQ=function(){function ts(){this._matrix=new tq}tC(ts,"laya.webgl.canvas.save.SaveTransform");var tD=ts.prototype;return tt.imps(tD,{"laya.webgl.canvas.save.ISaveData":!0}),tD.isSaveMark=function(){return!1},tD.restore=function(tD){tD._curMat=this._savematrix,ts._no[ts._no._length++]=this},ts.save=function(tD){var tY=tD._saveMark;if(2048!=(2048&tY._saveuse)){tY._saveuse|=2048;var tg=ts._no,tT=0<tg._length?tg[--tg._length]:new ts;tT._savematrix=tD._curMat,tD._curMat=tD._curMat.copyTo(tT._matrix);var tr=tD._save;tr[tr._length++]=tT}},ta(ts,["_no",function(){return this._no=tw._createArray()}]),ts}(),tL=function(){function tr(){}tC(tr,"laya.webgl.canvas.save.SaveTranslate");var tD=tr.prototype;return tt.imps(tD,{"laya.webgl.canvas.save.ISaveData":!0}),tD.isSaveMark=function(){return!1},tD.restore=function(tD){tD._curMat;tD._x=this._x,tD._y=this._y,tr._no[tr._no._length++]=this},tr.save=function(tD){var tY=tr._no,tg=0<tY._length?tY[--tY._length]:new tr;tg._x=tD._x,tg._y=tD._y;var tT=tD._save;tT[tT._length++]=tg},ta(tr,["_no",function(){return this._no=tw._createArray()}]),tr}(),ty=function(){function tD(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new tG}tC(tD,"laya.webgl.resource.RenderTargetMAX");var tY=tD.prototype;return tY.setSP=function(tD){this._sp=tD},tY.size=function(tD,tY){var tg=this;this._width!==tD||this._height!==tY?(this.repaint=!0,this._width=tD,this._height=tY,this.target?this.target.size(tD,tY):this.target=tvD.create(tD,tY),this.target.hasListener("recovered")||this.target.on("recovered",this,function(tD){tt.timer.callLater(tg._sp,tg._sp.repaint)})):this.target.size(tD,tY)},tY._flushToTarget=function(tD,tY){if(!tY._destroy){var tg=tjD.worldScissorTest,tT=tjD.worldClipRect;tjD.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,tjD.worldScissorTest=!1,tpD.mainContext.disable(3089);var tr=tjD.worldAlpha,ts=tjD.worldMatrix4,ta=tjD.worldMatrix,tW=tjD.worldFilters,tM=tjD.worldShaderDefines;if(tjD.worldMatrix=tq.EMPTY,tjD.restoreTempArray(),tjD.worldMatrix4=tjD.TEMPMAT4_ARRAY,tjD.worldAlpha=1,tjD.worldFilters=null,tjD.worldShaderDefines=null,tHD.activeShader=null,tY.start(),t_.showCanvasMark?tY.clear(0,1,0,.3):tY.clear(0,0,0,0),tD.flush(),tY.end(),tHD.activeShader=null,tjD.worldAlpha=tr,tjD.worldMatrix4=ts,tjD.worldMatrix=ta,tjD.worldFilters=tW,tjD.worldShaderDefines=tM,tjD.worldScissorTest=tg){var tE=tjD.height-tT.y-tT.height;tpD.mainContext.scissor(tT.x,tE,tT.width,tT.height),tpD.mainContext.enable(3089)}tjD.worldClipRect=tT}},tY.flush=function(tD){this.repaint&&(this._flushToTarget(tD,this.target),this.repaint=!1)},tY.drawTo=function(tD,tY,tg,tT,tr){tD.drawTexture(this.target.getTexture(),tY,tg,tT,tr,0,0)},tY.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},tD}(),tu=function(){function tD(){this.ALPHA=1,this.shaderType=0,this.defines=new tXD}return tC(tD,"laya.webgl.shader.d2.Shader2D"),tD.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},tD.__init__=function(){var tD,tY;tRD.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),tRD.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),tRD.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),tRD.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),tRD.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),tRD.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),tRD.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),tRD.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),tD="attribute vec4 position;\n",tD+="attribute vec2 texcoord;\n",tD+="uniform vec2 size;\n\n",tD+="#ifdef WORLDMAT\n",tD+="  uniform mat4 mmat;\n",tD+="#endif\n",tD+="varying vec2 v_texcoord;\n",tD+="void main() {\n",tD+="  #ifdef WORLDMAT\n",tD+="  vec4 pos=mmat*position;\n",tD+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",tD+="  #else\n",tD+="  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n",tD+="  #endif\n\n",tD+="  v_texcoord = texcoord;\n",tD+="}",tY="precision mediump float;\n",tY+="varying vec2 v_texcoord;\n",tY+="uniform sampler2D texture;\n\n",tY+="#ifdef COLORMUL\n",tY+="  uniform vec4 colorMul;\n",tY+="#endif\n\n",tY+="#ifdef TXTALPHA\n",tY+="  uniform sampler2D texture1;\n",tY+="#endif\n\n",tY+="uniform float alpha;\n",tY+='#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n',tY+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',tY+='#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n',tY+='#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\n',tY+="void main() {\n",tY+="   vec4 color= texture2D(texture, v_texcoord);\n\n",tY+="   #ifdef TXTCOMPRESS\n",tY+="      color.rgb *= color.a;\n",tY+="   #endif\n\n",tY+="   #ifdef TXTALPHA\n",tY+="      color.rgba *= texture2D(texture1, v_texcoord).a;\n",tY+="   #endif\n\n",tY+="   color.a*=alpha;\n",tY+="   color.rgb*=alpha;\n",tY+="   #ifdef COLORMUL\n",tY+="      color.rgba *= colorMul;\n",tY+="   #endif\n\n",tY+="   gl_FragColor=color;\n",tY+='   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";\n',tY+='   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n',tY+='   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',tY+='   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n',tY+="}",tRD.preCompile2D(0,1,tD,tY,null),tD="attribute vec4 position;\n",tD+="uniform vec2 size;\n",tD+="uniform mat4 mmat;\n",tD+="void main() {\n",tD+="  vec4 pos=mmat*position;\n",tD+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",tD+="}",tY="precision mediump float;\n",tY+="uniform vec4 color;\n",tY+="uniform float alpha;\n",tY+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',tY+="void main() {\n",tY+="\t vec4 a = vec4(color.r, color.g, color.b, color.a);\n",tY+="\t a.w = alpha;\n",tY+="\t a.xyz *= alpha;\n",tY+="\t gl_FragColor = a;\n",tY+='\t #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',tY+="}",tRD.preCompile2D(0,2,tD,tY,null),tD="attribute vec4 position;\n",tD+="attribute vec3 a_color;\n",tD+="uniform mat4 mmat;\n",tD+="uniform mat4 u_mmat2;\n",tD+="uniform vec2 u_pos;\n",tD+="uniform vec2 size;\n",tD+="varying vec3 color;\n",tD+="void main(){\n",tD+="  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n",tD+="  vec4 pos=mmat*u_mmat2*tPos;\n",tD+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",tD+="  color=a_color;\n",tD+="}",tY="precision mediump float;\n",tY+="varying vec3 color;\n",tY+="uniform float alpha;\n",tY+="void main(){\n",tY+="  gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n",tY+="\t gl_FragColor.rgb*=alpha;\n",tY+="}",tRD.preCompile2D(0,4,tD,tY,null),tD="attribute vec4 position;\n",tD+="attribute vec2 texcoord;\n",tD+="uniform vec2 size;\n\n",tD+="#ifdef WORLDMAT\n",tD+="  uniform mat4 mmat;\n",tD+="#endif\n",tD+="varying vec2 v_texcoord;\n",tD+="void main() {\n",tD+="  #ifdef WORLDMAT\n",tD+="    vec4 pos=mmat*position;\n",tD+="    gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",tD+="  #else\n",tD+="    gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n",tD+="  #endif\n\n",tD+="  v_texcoord = texcoord;\n",tD+="}",tY="#ifdef FSHIGHPRECISION\n",tY+="   precision highp float;\n",tY+="#else\n",tY+="   precision mediump float;\n",tY+="#endif\n",tY+="varying vec2 v_texcoord;\n",tY+="uniform sampler2D texture;\n\n",tY+="#ifdef TXTALPHA\n",tY+="   uniform sampler2D texture1;\n",tY+="#endif\n\n",tY+="uniform float alpha;\n",tY+="uniform vec4 u_TexRange;\n",tY+="uniform vec2 u_offset;\n",tY+='#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n',tY+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',tY+='#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n',tY+='#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\n',tY+="void main() {\n",tY+="   vec2 newTexCoord;\n",tY+="   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n",tY+="   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n",tY+="   vec4 color= texture2D(texture, newTexCoord);\n\n",tY+="   #ifdef TXTALPHA\n",tY+="      color.a = texture2D(texture1, newTexCoord).a;\n",tY+="   #endif\n\n",tY+="   color.a*=alpha;\n",tY+="   gl_FragColor=color;\n",tY+='   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";\n',tY+='   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n',tY+='   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',tY+='   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n',tY+="}",tRD.preCompile2D(0,256,tD,tY,null),tD="attribute vec2 position;\n",tD+="attribute vec2 texcoord;\n",tD+="attribute vec4 color;\n",tD+="uniform vec2 size;\n",tD+="uniform float offsetX;\n",tD+="uniform float offsetY;\n",tD+="uniform mat4 mmat;\n",tD+="uniform mat4 u_mmat2;\n",tD+="varying vec2 v_texcoord;\n",tD+="varying vec4 v_color;\n",tD+="void main() {\n",tD+="  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n",tD+="  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",tD+="  v_color = color;\n",tD+="  v_color.rgb *= v_color.a;\n",tD+="  v_texcoord = texcoord;  \n",tD+="}",tY="precision mediump float;\n",tY+="varying vec2 v_texcoord;\n",tY+="varying vec4 v_color;\n",tY+="uniform sampler2D texture;\n\n",tY+="#ifdef TXTALPHA\n",tY+="  uniform sampler2D texture1;\n",tY+="#endif\n\n",tY+="uniform float alpha;\n",tY+="void main() {\n",tY+="\t vec4 t_color = texture2D(texture, v_texcoord);\n\n",tY+="  #ifdef TXTALPHA\n",tY+="    t_color.a = texture2D(texture1, v_texcoord).a;\n",tY+="  #endif\n\n",tY+="\t gl_FragColor = t_color.rgba * v_color;\n",tY+="\t gl_FragColor *= alpha;\n",tY+="}",tRD.preCompile2D(0,512,tD,tY,null)},tD}(),tn=function(){function tY(tD,tY,tg){this._value=0,this._name2int=tD,this._int2name=tY,this._int2nameMap=tg}tC(tY,"laya.webgl.shader.ShaderDefines");var tD=tY.prototype;return tD.add=function(tD){return"string"==typeof tD&&(tD=this._name2int[tD]),this._value|=tD,this._value},tD.addInt=function(tD){return this._value|=tD,this._value},tD.remove=function(tD){return"string"==typeof tD&&(tD=this._name2int[tD]),this._value&=~tD,this._value},tD.isDefine=function(tD){return(this._value&tD)===tD},tD.getValue=function(){return this._value},tD.setValue=function(tD){this._value=tD},tD.toNameDic=function(){var tD=this._int2nameMap[this._value];return tD||tY._toText(this._value,this._int2name,this._int2nameMap)},tY._reg=function(tD,tY,tg,tT){tT[tg[tD]=tY]=tD},tY._toText=function(tD,tY,tg){var tT=tg[tD];if(tT)return tT;for(var tr={},ts=1,ta=0;ta<32&&!(tD<(ts=1<<ta));ta++)if(tD&ts){var tW=tY[ts];tW&&(tr[tW]="")}return tg[tD]=tr},tY._toInt=function(tD,tY){for(var tg=tD.split("."),tT=0,tr=0,ts=tg.length;tr<ts;tr++){var ta=tY[tg[tr]];if(!ta)throw new Error("Defines to int err:"+tD+"/"+tg[tr]);tT|=ta}return tT},tY}(),tDD=function(){function ta(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new tq}tC(ta,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var tD=ta.prototype;return tD.init=function(tD,tY,tg){if(tY)this._vs=tY;else{this._vs=[];var tT=tD.width,tr=tD.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(tT,0,1,0,1,1,1,1),this._vs.push(tT,tr,1,1,1,1,1,1),this._vs.push(0,tr,0,1,1,1,1,1)}tg?this._ps=tg:(ta._defaultPS||(ta._defaultPS=[]).push(0,1,3,3,1,2),this._ps=ta._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=tD},tD.init2=function(tD,tY,tg,tT,tr){this.transform&&(this.transform=null),tg?this._ps=tg:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=tT,this._uvs=tr,this.mEleNum=this._ps.length,this.mTexture=tD,(tx.isConchNode||tx.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},tD._initMyData=function(){var tD=0,tY=0,tg=4*this._verticles.length;this._vs=ta._tempVS;var tT=!1;if(tx.isConchNode||tx.isConchApp?(this._vs.length=tg,tT=!0):this._vs.length<tg&&(this._vs.length=tg,tT=!0),ta._tVSLen=tg,tT)for(;tD<tg;)this._vs[tD]=this._verticles[tY],this._vs[tD+1]=this._verticles[tY+1],this._vs[tD+2]=this._uvs[tY],this._vs[tD+3]=this._uvs[tY+1],this._vs[tD+4]=1,this._vs[tD+5]=1,this._vs[tD+6]=1,this._vs[tD+7]=1,tD+=8,tY+=2;else for(;tD<tg;)this._vs[tD]=this._verticles[tY],this._vs[tD+1]=this._verticles[tY+1],this._vs[tD+2]=this._uvs[tY],this._vs[tD+3]=this._uvs[tY+1],tD+=8,tY+=2},tD.getData2=function(tD,tY,tg){var tT;this.mVBBuffer=tD,this.mIBBuffer=tY,this._initMyData(),tD.appendEx2(this._vs,Float32Array,ta._tVSLen,4),this._indexStart=tY._byteLength,(tT=ta._tempIB).length<this._ps.length&&(tT.length=this._ps.length);for(var tr=0,ts=this._ps.length;tr<ts;tr++)tT[tr]=this._ps[tr]+tg;tY.appendEx2(tT,Uint16Array,this._ps.length,2)},tD.getData=function(tD,tY,tg){if(this.mVBBuffer=tD,this.mIBBuffer=tY,tD.append(this.mVBData),this._indexStart=tY._byteLength,this.mIBData.start!=tg){for(var tT=0,tr=this._ps.length;tT<tr;tT++)this.mIBData[tT]=this._ps[tT]+tg;this.mIBData.start=tg}tY.append(this.mIBData)},tD.render=function(tD,tY,tg){if(tx.isWebGL&&this.mTexture){tD._renderKey=0,tD._shader2D.glTexture=null,tYD.getInstance().addSkinMesh(this);var tT=tsD.createShape(tD,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,tAD.create(512,0));this.transform||(this.transform=tq.EMPTY),this.transform.translate(tY,tg),tq.mul(this.transform,tD._curMat,this._tempMatrix),this.transform.translate(-tY,-tg);var tr=tT.shaderValue,ts=tr.u_mmat2||tjD.getMatrArray();tjD.mat2MatArray(this._tempMatrix,ts),tr.textureHost=this.mTexture,tr.offsetX=0,tr.offsetY=0,tr.u_mmat2=ts,tr.ALPHA=tD._shader2D.ALPHA,tD._submits[tD._submits._length++]=tT}else tx.isConchApp&&this.mTexture&&(this.transform||(this.transform=tq.EMPTY),tD.setSkinMesh&&tD.setSkinMesh(tY,tg,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},ta._tempVS=[],ta._tempIB=[],ta._defaultPS=null,ta._tVSLen=0,ta}(),tYD=function(){function tD(){this.ib=null,this.vb=null;tpD.mainContext;this.ib=tuD.create(35048),this.vb=tnD.create(8)}tC(tD,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var tY=tD.prototype;return tY.addSkinMesh=function(tD){tD.getData2(this.vb,this.ib,this.vb._byteLength/32)},tY.reset=function(){this.vb.clear(),this.ib.clear()},tD.getInstance=function(){return tD.instance=tD.instance||new tD},tD.instance=null,tD}(),tgD=function(){function tD(tD,tY,tg,tT,tr,ts,ta,tW,tM){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===tM&&(tM=0),this.x=tD,this.y=tY,this.width=tg,this.height=tT,this.edges=tr,this.color=ts,this.borderWidth=ta,this.borderColor=tW}tC(tD,"laya.webgl.shapes.BasePoly");var tY=tD.prototype;return tt.imps(tY,{"laya.webgl.shapes.IShape":!0}),tY.getData=function(tD,tY,tg){},tY.rebuild=function(tD){},tY.setMatrix=function(tD){},tY.needUpdate=function(tD){return!0},tY.sector=function(tD,tY,tg){var tT=this.x,tr=this.y,ts=this.edges,ta=(this.r1-this.r0)/ts,tW=this.width,tM=this.height,tE=this.color,tI=(tE>>16&255)/255,tO=(tE>>8&255)/255,tC=(255&tE)/255;tD.push(tT,tr,tI,tO,tC);for(var tN=0;tN<ts+1;tN++)tD.push(tT+Math.sin(ta*tN+this.r0)*tW,tr+Math.cos(ta*tN+this.r0)*tM),tD.push(tI,tO,tC);for(tN=0;tN<ts;tN++)tY.push(tg,tg+tN+1,tg+tN+2)},tY.createLine2=function(tD,tY,tg,tT,tr,ts){var ta,tW,tM,tE,tI,tO,tC,tN,t$,td,tJ,tx,tj,tZ,tp,tl,tt,t_,tA,tq,tb=tD.concat(),tG=tr,tX=this.borderColor,tz=(tX>>16&255)/255,tm=(tX>>8&255)/255,th=(255&tX)/255,ti=tb.length/2,tP=tT,tB=tg/2;tM=tb[0],tE=tb[1],td=tM-(tI=tb[2]),t$=(t$=-(tE-(tO=tb[3])))/(tq=Math.sqrt(t$*t$+td*td))*tB,td=td/tq*tB,tG.push(tM-t$+this.x,tE-td+this.y,tz,tm,th,tM+t$+this.x,tE+td+this.y,tz,tm,th);for(var tH=1;tH<ti-1;tH++)tM=tb[2*(tH-1)],tE=tb[2*(tH-1)+1],tI=tb[2*tH],tO=tb[2*tH+1],tC=tb[2*(tH+1)],tN=tb[2*(tH+1)+1],td=tM-tI,tx=tI-tC,tp=(-(t$=(t$=-(tE-tO))/(tq=Math.sqrt(t$*t$+td*td))*tB)+tM)*(-(td=td/tq*tB)+tO)-(-t$+tI)*(-td+tE),t_=(-(tJ=(tJ=-(tO-tN))/(tq=Math.sqrt(tJ*tJ+tx*tx))*tB)+tC)*(-(tx=tx/tq*tB)+tO)-(-tJ+tI)*(-tx+tN),tA=(tj=-td+tE-(-td+tO))*(tt=-tJ+tI-(-tJ+tC))-(tl=-tx+tN-(-tx+tO))*(tZ=-t$+tI-(-t$+tM)),Math.abs(tA)<.1?(tA+=10.1,tG.push(tI-t$+this.x,tO-td+this.y,tz,tm,th,tI+t$+this.x,tO+td+this.y,tz,tm,th)):(((ta=(tZ*t_-tt*tp)/tA)-tI)*(ta-tI)+((tW=(tl*tp-tj*t_)/tA)-tO)+(tW-tO),tG.push(ta+this.x,tW+this.y,tz,tm,th,tI-(ta-tI)+this.x,tO-(tW-tO)+this.y,tz,tm,th));tM=tb[tb.length-4],tE=tb[tb.length-3],td=tM-(tI=tb[tb.length-2]),t$=(t$=-(tE-(tO=tb[tb.length-1])))/(tq=Math.sqrt(t$*t$+td*td))*tB,td=td/tq*tB,tG.push(tI-t$+this.x,tO-td+this.y,tz,tm,th,tI+t$+this.x,tO+td+this.y,tz,tm,th);var tv=ts;for(tH=1;tH<tv;tH++)tY.push(tP+2*(tH-1),tP+2*(tH-1)+1,tP+2*tH+1,tP+2*tH+1,tP+2*tH,tP+2*(tH-1));return tG},tY.createLine=function(tD,tY,tg,tT){var tr=tD.concat(),ts=tD,ta=this.borderColor,tW=(ta>>16&255)/255,tM=(ta>>8&255)/255,tE=(255&ta)/255;tr.splice(0,5);var tI,tO,tC,tN,t$,td,tJ,tx,tj,tZ,tp,tl,tt,t_,tA,tq,tb,tG,tX,tz,tm=tr.length/5,th=tT,ti=tg/2;tC=tr[0],tN=tr[1],tZ=tC-(t$=tr[5]),tj=(tj=-(tN-(td=tr[6])))/(tz=Math.sqrt(tj*tj+tZ*tZ))*ti,tZ=tZ/tz*ti,ts.push(tC-tj,tN-tZ,tW,tM,tE,tC+tj,tN+tZ,tW,tM,tE);for(var tP=1;tP<tm-1;tP++)tC=tr[5*(tP-1)],tN=tr[5*(tP-1)+1],t$=tr[5*tP],td=tr[5*tP+1],tJ=tr[5*(tP+1)],tx=tr[5*(tP+1)+1],tZ=tC-t$,tl=t$-tJ,tA=(-(tj=(tj=-(tN-td))/(tz=Math.sqrt(tj*tj+tZ*tZ))*ti)+tC)*(-(tZ=tZ/tz*ti)+td)-(-tj+t$)*(-tZ+tN),tG=(-(tp=(tp=-(td-tx))/(tz=Math.sqrt(tp*tp+tl*tl))*ti)+tJ)*(-(tl=tl/tz*ti)+td)-(-tp+t$)*(-tl+tx),tX=(tt=-tZ+tN-(-tZ+td))*(tb=-tp+t$-(-tp+tJ))-(tq=-tl+tx-(-tl+td))*(t_=-tj+t$-(-tj+tC)),Math.abs(tX)<.1?(tX+=10.1,ts.push(t$-tj,td-tZ,tW,tM,tE,t$+tj,td+tZ,tW,tM,tE)):(((tI=(t_*tG-tb*tA)/tX)-t$)*(tI-t$)+((tO=(tq*tA-tt*tG)/tX)-td)+(tO-td),ts.push(tI,tO,tW,tM,tE,t$-(tI-t$),td-(tO-td),tW,tM,tE));tC=tr[tr.length-10],tN=tr[tr.length-9],tZ=tC-(t$=tr[tr.length-5]),tj=(tj=-(tN-(td=tr[tr.length-4])))/(tz=Math.sqrt(tj*tj+tZ*tZ))*ti,tZ=tZ/tz*ti,ts.push(t$-tj,td-tZ,tW,tM,tE,t$+tj,td+tZ,tW,tM,tE);var tB=this.edges+1;for(tP=1;tP<tB;tP++)tY.push(th+2*(tP-1),th+2*(tP-1)+1,th+2*tP+1,th+2*tP+1,th+2*tP,th+2*(tP-1));return ts},tY.createLoopLine=function(tD,tY,tg,tT,tr,ts){var ta=tD.concat(),tW=tr||tD,tM=this.borderColor,tE=(tM>>16&255)/255,tI=(tM>>8&255)/255,tO=(255&tM)/255;ta.splice(0,5);var tC=[ta[0],ta[1]],tN=[ta[ta.length-5],ta[ta.length-4]],t$=tN[0]+.5*(tC[0]-tN[0]),td=tN[1]+.5*(tC[1]-tN[1]);ta.unshift(t$,td,0,0,0),ta.push(t$,td,0,0,0);var tJ,tx,tj,tZ,tp,tl,tt,t_,tA,tq,tb,tG,tX,tz,tm,th,ti,tP,tB,tH,tv=ta.length/5,tS=tT,tU=tg/2;tj=ta[0],tZ=ta[1],tq=tj-(tp=ta[5]),tA=(tA=-(tZ-(tl=ta[6])))/(tH=Math.sqrt(tA*tA+tq*tq))*tU,tq=tq/tH*tU,tW.push(tj-tA,tZ-tq,tE,tI,tO,tj+tA,tZ+tq,tE,tI,tO);for(var tF=1;tF<tv-1;tF++)tj=ta[5*(tF-1)],tZ=ta[5*(tF-1)+1],tp=ta[5*tF],tl=ta[5*tF+1],tt=ta[5*(tF+1)],t_=ta[5*(tF+1)+1],tq=tj-tp,tG=tp-tt,tm=(-(tA=(tA=-(tZ-tl))/(tH=Math.sqrt(tA*tA+tq*tq))*tU)+tj)*(-(tq=tq/tH*tU)+tl)-(-tA+tp)*(-tq+tZ),tP=(-(tb=(tb=-(tl-t_))/(tH=Math.sqrt(tb*tb+tG*tG))*tU)+tt)*(-(tG=tG/tH*tU)+tl)-(-tb+tp)*(-tG+t_),tB=(tX=-tq+tZ-(-tq+tl))*(ti=-tb+tp-(-tb+tt))-(th=-tG+t_-(-tG+tl))*(tz=-tA+tp-(-tA+tj)),Math.abs(tB)<.1?(tB+=10.1,tW.push(tp-tA,tl-tq,tE,tI,tO,tp+tA,tl+tq,tE,tI,tO)):(((tJ=(tz*tP-ti*tm)/tB)-tp)*(tJ-tp)+((tx=(th*tm-tX*tP)/tB)-tl)+(tx-tl),tW.push(tJ,tx,tE,tI,tO,tp-(tJ-tp),tl-(tx-tl),tE,tI,tO));ts&&(tY=ts);var tV=this.edges+1;for(tF=1;tF<tV;tF++)tY.push(tS+2*(tF-1),tS+2*(tF-1)+1,tS+2*tF+1,tS+2*tF+1,tS+2*tF,tS+2*(tF-1));return tY.push(tS+2*(tF-1),tS+2*(tF-1)+1,tS+1,tS+1,tS,tS+2*(tF-1)),tW},tD}(),tTD=function(){function td(){}return tC(td,"laya.webgl.shapes.Earcut"),td.earcut=function(tD,tY,tg){tg=tg||2;var tT,tr,ts,ta,tW,tM,tE,tI=tY&&tY.length,tO=tI?tY[0]*tg:tD.length,tC=td.linkedList(tD,0,tO,tg,!0),tN=[];if(!tC)return tN;if(tI&&(tC=td.eliminateHoles(tD,tY,tC,tg)),tD.length>80*tg){tT=ts=tD[0],tr=ta=tD[1];for(var t$=tg;t$<tO;t$+=tg)(tW=tD[t$])<tT&&(tT=tW),(tM=tD[t$+1])<tr&&(tr=tM),ts<tW&&(ts=tW),ta<tM&&(ta=tM);tE=0!==(tE=Math.max(ts-tT,ta-tr))?1/tE:0}return td.earcutLinked(tC,tN,tg,tT,tr,tE),tN},td.linkedList=function(tD,tY,tg,tT,tr){var ts,ta;if(tr===0<td.signedArea(tD,tY,tg,tT))for(ts=tY;ts<tg;ts+=tT)ta=td.insertNode(ts,tD[ts],tD[ts+1],ta);else for(ts=tg-tT;tY<=ts;ts-=tT)ta=td.insertNode(ts,tD[ts],tD[ts+1],ta);return ta&&td.equals(ta,ta.next)&&(td.removeNode(ta),ta=ta.next),ta},td.filterPoints=function(tD,tY){if(!tD)return tD;tY||(tY=tD);var tg,tT=tD;do{if(tg=!1,tT.steiner||!td.equals(tT,tT.next)&&0!==td.area(tT.prev,tT,tT.next))tT=tT.next;else{if(td.removeNode(tT),(tT=tY=tT.prev)===tT.next)break;tg=!0}}while(tg||tT!==tY);return tY},td.earcutLinked=function(tD,tY,tg,tT,tr,ts,ta){if(tD){!ta&&ts&&td.indexCurve(tD,tT,tr,ts);for(var tW,tM,tE=tD;tD.prev!==tD.next;)if(tW=tD.prev,tM=tD.next,ts?td.isEarHashed(tD,tT,tr,ts):td.isEar(tD))tY.push(tW.i/tg),tY.push(tD.i/tg),tY.push(tM.i/tg),td.removeNode(tD),tD=tM.next,tE=tM.next;else if((tD=tM)===tE){ta?1===ta?(tD=td.cureLocalIntersections(tD,tY,tg),td.earcutLinked(tD,tY,tg,tT,tr,ts,2)):2===ta&&td.splitEarcut(tD,tY,tg,tT,tr,ts):td.earcutLinked(td.filterPoints(tD,null),tY,tg,tT,tr,ts,1);break}}},td.isEar=function(tD){var tY=tD.prev,tg=tD,tT=tD.next;if(0<=td.area(tY,tg,tT))return!1;for(var tr=tD.next.next;tr!==tD.prev;){if(td.pointInTriangle(tY.x,tY.y,tg.x,tg.y,tT.x,tT.y,tr.x,tr.y)&&0<=td.area(tr.prev,tr,tr.next))return!1;tr=tr.next}return!0},td.isEarHashed=function(tD,tY,tg,tT){var tr=tD.prev,ts=tD,ta=tD.next;if(0<=td.area(tr,ts,ta))return!1;for(var tW=tr.x<ts.x?tr.x<ta.x?tr.x:ta.x:ts.x<ta.x?ts.x:ta.x,tM=tr.y<ts.y?tr.y<ta.y?tr.y:ta.y:ts.y<ta.y?ts.y:ta.y,tE=tr.x>ts.x?tr.x>ta.x?tr.x:ta.x:ts.x>ta.x?ts.x:ta.x,tI=tr.y>ts.y?tr.y>ta.y?tr.y:ta.y:ts.y>ta.y?ts.y:ta.y,tO=td.zOrder(tW,tM,tY,tg,tT),tC=td.zOrder(tE,tI,tY,tg,tT),tN=tD.nextZ;tN&&tN.z<=tC;){if(tN!==tD.prev&&tN!==tD.next&&td.pointInTriangle(tr.x,tr.y,ts.x,ts.y,ta.x,ta.y,tN.x,tN.y)&&0<=td.area(tN.prev,tN,tN.next))return!1;tN=tN.nextZ}for(tN=tD.prevZ;tN&&tN.z>=tO;){if(tN!==tD.prev&&tN!==tD.next&&td.pointInTriangle(tr.x,tr.y,ts.x,ts.y,ta.x,ta.y,tN.x,tN.y)&&0<=td.area(tN.prev,tN,tN.next))return!1;tN=tN.prevZ}return!0},td.cureLocalIntersections=function(tD,tY,tg){var tT=tD;do{var tr=tT.prev,ts=tT.next.next;!td.equals(tr,ts)&&td.intersects(tr,tT,tT.next,ts)&&td.locallyInside(tr,ts)&&td.locallyInside(ts,tr)&&(tY.push(tr.i/tg),tY.push(tT.i/tg),tY.push(ts.i/tg),td.removeNode(tT),td.removeNode(tT.next),tT=tD=ts),tT=tT.next}while(tT!==tD);return tT},td.splitEarcut=function(tD,tY,tg,tT,tr,ts){var ta=tD;do{for(var tW=ta.next.next;tW!==ta.prev;){if(ta.i!==tW.i&&td.isValidDiagonal(ta,tW)){var tM=td.splitPolygon(ta,tW);return ta=td.filterPoints(ta,ta.next),tM=td.filterPoints(tM,tM.next),td.earcutLinked(ta,tY,tg,tT,tr,ts),void td.earcutLinked(tM,tY,tg,tT,tr,ts)}tW=tW.next}ta=ta.next}while(ta!==tD)},td.eliminateHoles=function(tD,tY,tg,tT){var tr,ts,ta,tW,tM,tE=[];for(tr=0,ts=tY.length;tr<ts;tr++)ta=tY[tr]*tT,tW=tr<ts-1?tY[tr+1]*tT:tD.length,(tM=td.linkedList(tD,ta,tW,tT,!1))===tM.next&&(tM.steiner=!0),tE.push(td.getLeftmost(tM));for(tE.sort(td.compareX),tr=0;tr<tE.length;tr++)td.eliminateHole(tE[tr],tg),tg=td.filterPoints(tg,tg.next);return tg},td.compareX=function(tD,tY){return tD.x-tY.x},td.eliminateHole=function(tD,tY){if(tY=td.findHoleBridge(tD,tY)){var tg=td.splitPolygon(tY,tD);td.filterPoints(tg,tg.next)}},td.findHoleBridge=function(tD,tY){var tg,tT=tY,tr=tD.x,ts=tD.y,ta=-1/0;do{if(ts<=tT.y&&ts>=tT.next.y&&tT.next.y!==tT.y){var tW=tT.x+(ts-tT.y)*(tT.next.x-tT.x)/(tT.next.y-tT.y);if(tW<=tr&&ta<tW){if((ta=tW)===tr){if(ts===tT.y)return tT;if(ts===tT.next.y)return tT.next}tg=tT.x<tT.next.x?tT:tT.next}}tT=tT.next}while(tT!==tY);if(!tg)return null;if(tr===ta)return tg.prev;var tM,tE=tg,tI=tg.x,tO=tg.y,tC=1/0;for(tT=tg.next;tT!==tE;)tr>=tT.x&&tT.x>=tI&&tr!==tT.x&&td.pointInTriangle(ts<tO?tr:ta,ts,tI,tO,ts<tO?ta:tr,ts,tT.x,tT.y)&&((tM=Math.abs(ts-tT.y)/(tr-tT.x))<tC||tM===tC&&tT.x>tg.x)&&td.locallyInside(tT,tD)&&(tg=tT,tC=tM),tT=tT.next;return tg},td.indexCurve=function(tD,tY,tg,tT){for(var tr=tD;null===tr.z&&(tr.z=td.zOrder(tr.x,tr.y,tY,tg,tT)),tr.prevZ=tr.prev,tr.nextZ=tr.next,(tr=tr.next)!==tD;);tr.prevZ.nextZ=null,tr.prevZ=null,td.sortLinked(tr)},td.sortLinked=function(tD){var tY,tg,tT,tr,ts,ta,tW,tM,tE=1;do{for(tg=tD,ts=tD=null,ta=0;tg;){for(ta++,tT=tg,tY=tW=0;tY<tE&&(tW++,tT=tT.nextZ);tY++);for(tM=tE;0<tW||0<tM&&tT;)0!==tW&&(0===tM||!tT||tg.z<=tT.z)?(tg=(tr=tg).nextZ,tW--):(tT=(tr=tT).nextZ,tM--),ts?ts.nextZ=tr:tD=tr,tr.prevZ=ts,ts=tr;tg=tT}ts.nextZ=null,tE*=2}while(1<ta);return tD},td.zOrder=function(tD,tY,tg,tT,tr){return(tD=1431655765&((tD=858993459&((tD=252645135&((tD=16711935&((tD=32767*(tD-tg)*tr)|tD<<8))|tD<<4))|tD<<2))|tD<<1))|(tY=1431655765&((tY=858993459&((tY=252645135&((tY=16711935&((tY=32767*(tY-tT)*tr)|tY<<8))|tY<<4))|tY<<2))|tY<<1))<<1},td.getLeftmost=function(tD){for(var tY=tD,tg=tD;tY.x<tg.x&&(tg=tY),(tY=tY.next)!==tD;);return tg},td.pointInTriangle=function(tD,tY,tg,tT,tr,ts,ta,tW){return 0<=(tr-ta)*(tY-tW)-(tD-ta)*(ts-tW)&&0<=(tD-ta)*(tT-tW)-(tg-ta)*(tY-tW)&&0<=(tg-ta)*(ts-tW)-(tr-ta)*(tT-tW)},td.isValidDiagonal=function(tD,tY){return tD.next.i!==tY.i&&tD.prev.i!==tY.i&&!td.intersectsPolygon(tD,tY)&&td.locallyInside(tD,tY)&&td.locallyInside(tY,tD)&&td.middleInside(tD,tY)},td.area=function(tD,tY,tg){return(tY.y-tD.y)*(tg.x-tY.x)-(tY.x-tD.x)*(tg.y-tY.y)},td.equals=function(tD,tY){return tD.x===tY.x&&tD.y===tY.y},td.intersects=function(tD,tY,tg,tT){return!!(td.equals(tD,tY)&&td.equals(tg,tT)||td.equals(tD,tT)&&td.equals(tg,tY))||0<td.area(tD,tY,tg)!=0<td.area(tD,tY,tT)&&0<td.area(tg,tT,tD)!=0<td.area(tg,tT,tY)},td.intersectsPolygon=function(tD,tY){var tg=tD;do{if(tg.i!==tD.i&&tg.next.i!==tD.i&&tg.i!==tY.i&&tg.next.i!==tY.i&&td.intersects(tg,tg.next,tD,tY))return!0;tg=tg.next}while(tg!==tD);return!1},td.locallyInside=function(tD,tY){return td.area(tD.prev,tD,tD.next)<0?0<=td.area(tD,tY,tD.next)&&0<=td.area(tD,tD.prev,tY):td.area(tD,tY,tD.prev)<0||td.area(tD,tD.next,tY)<0},td.middleInside=function(tD,tY){for(var tg=tD,tT=!1,tr=(tD.x+tY.x)/2,ts=(tD.y+tY.y)/2;tg.y>ts!=tg.next.y>ts&&tg.next.y!==tg.y&&tr<(tg.next.x-tg.x)*(ts-tg.y)/(tg.next.y-tg.y)+tg.x&&(tT=!tT),(tg=tg.next)!==tD;);return tT},td.splitPolygon=function(tD,tY){var tg=new trD(tD.i,tD.x,tD.y),tT=new trD(tY.i,tY.x,tY.y),tr=tD.next,ts=tY.prev;return(tD.next=tY).prev=tD,(tg.next=tr).prev=tg,(tT.next=tg).prev=tT,(ts.next=tT).prev=ts,tT},td.insertNode=function(tD,tY,tg,tT){var tr=new trD(tD,tY,tg);return tT?(tr.next=tT.next,(tr.prev=tT).next.prev=tr,tT.next=tr):(tr.prev=tr).next=tr,tr},td.removeNode=function(tD){tD.next.prev=tD.prev,tD.prev.next=tD.next,tD.prevZ&&(tD.prevZ.nextZ=tD.nextZ),tD.nextZ&&(tD.nextZ.prevZ=tD.prevZ)},td.signedArea=function(tD,tY,tg,tT){for(var tr=0,ts=tY,ta=tg-tT;ts<tg;ts+=tT)tr+=(tD[ta]-tD[ts])*(tD[ts+1]+tD[ta+1]),ta=ts;return tr},td}(),trD=function(){function tD(tD,tY,tg){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=tD,this.x=tY,this.y=tg,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return tC(tD,"laya.webgl.shapes.EarcutNode"),tD}(),tsD=(function(){function tD(tD,tY,tg,tT,tr,ts,ta){this.lineWidth=tD,this.lineColor=tY,this.lineAlpha=tg,this.fillColor=tT,this.fillAlpha=tr,this.shape=ta,this.fill=ts}tC(tD,"laya.webgl.shapes.GeometryData");var tY=tD.prototype;tY.clone=function(){return new tD(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},tY.getIndexData=function(){return null},tY.getVertexData=function(){return null},tY.destroy=function(){this.shape=null}}(),function(){function tD(tD){if(tD instanceof Float32Array)this.points=tD;else if(tD instanceof Array){tD.length;this.points=new Float32Array(tD)}}tC(tD,"laya.webgl.shapes.Vertex");var tY=tD.prototype;tt.imps(tY,{"laya.webgl.shapes.IShape":!0}),tY.getData=function(tD,tY,tg){},tY.needUpdate=function(tD){return!1},tY.rebuild=function(tD){},tY.setMatrix=function(tD){}}(),function(){function tM(tD){void 0===tD&&(tD=1e4),this._renderType=tD}tC(tM,"laya.webgl.submit.Submit");var tD=tM.prototype;return tt.imps(tD,{"laya.webgl.submit.ISubmit":!0}),tD.releaseRender=function(){var tD=tM._cache;(tD[tD._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},tD.getRenderType=function(){return this._renderType},tD.renderSubmit=function(){if(0===this._numEle)return 1;var tD=this.shaderValue.textureHost;if(tD){var tY=tD.source;if(!tD.bitmap||!tY)return 1;this.shaderValue.texture=tY,tD.alphaTexture&&tD.alphaTexture.source&&(this.shaderValue.texture1=tD.alphaTexture.source)}this._vb.bind_upload(this._ib);var tg=tpD.mainContext;return this.shaderValue.upload(),tf.activeBlendFunction!==this._blendFn&&(tg.enable(3042),this._blendFn(tg),tf.activeBlendFunction=this._blendFn),tm.drawCall++,tm.trianglesFaces+=this._numEle/3,tg.drawElements(4,this._numEle,5123,this._startIdx),1},tM.__init__=function(){var tD=tM.RENDERBASE=new tM(-1);tD.shaderValue=new tAD(0,0),tD.shaderValue.ALPHA=-1234},tM.createSubmit=function(tD,tY,tg,tT,tr){var ts=tM._cache._length?tM._cache[--tM._cache._length]:new tM;null==tg&&((tg=ts._selfVb||(ts._selfVb=tnD.create(-1))).clear(),tT=0),ts._ib=tY,ts._vb=tg,ts._startIdx=tT*tdD.BYTES_PIDX,ts._numEle=0;var ta=tD._nBlendType;ts._blendFn=tD._targets?tf.targetFns[ta]:tf.fns[ta],ts.shaderValue=tr,ts.shaderValue.setValue(tD._shader2D);var tW=tD._shader2D.filters;return tW&&ts.shaderValue.setFilters(tW),ts},tM.createShape=function(tD,tY,tg,tT,tr,ts){var ta=tM._cache._length?tM._cache[--tM._cache._length]:new tM;ta._ib=tY,ta._vb=tg,ta._numEle=tT,ta._startIdx=tr,ta.shaderValue=ts,ta.shaderValue.setValue(tD._shader2D);var tW=tD._nBlendType;return ta._blendFn=tD._targets?tf.targetFns[tW]:tf.fns[tW],ta},tM.TYPE_2D=1e4,tM.TYPE_CANVAS=10003,tM.TYPE_CMDSETRT=10004,tM.TYPE_CUSTOM=10005,tM.TYPE_BLURRT=10006,tM.TYPE_CMDDESTORYPRERT=10007,tM.TYPE_DISABLESTENCIL=10008,tM.TYPE_OTHERIBVB=10009,tM.TYPE_PRIMITIVE=10010,tM.TYPE_RT=10011,tM.TYPE_BLUR_RT=10012,tM.TYPE_TARGET=10013,tM.TYPE_CHANGE_VALUE=10014,tM.TYPE_SHAPE=10015,tM.TYPE_TEXTURE=10016,tM.TYPE_FILLTEXTURE=10017,tM.RENDERBASE=null,tM._cache=((tM._cache=[])._length=0,tM._cache),tM}()),taD=function(){function tT(){this.fun=null,this.args=null}tC(tT,"laya.webgl.submit.SubmitCMD");var tD=tT.prototype;return tt.imps(tD,{"laya.webgl.submit.ISubmit":!0}),tD.renderSubmit=function(){return this.fun.apply(null,this.args),1},tD.getRenderType=function(){return 0},tD.releaseRender=function(){var tD=tT._cache;tD[tD._length++]=this},tT.create=function(tD,tY){var tg=tT._cache._length?tT._cache[--tT._cache._length]:new tT;return tg.fun=tY,tg.args=tD,tg},tT._cache=((tT._cache=[])._length=0,tT._cache),tT}(),tWD=function(){function tY(){this.variables={}}tC(tY,"laya.webgl.submit.SubmitCMDScope");var tD=tY.prototype;return tD.getValue=function(tD){return this.variables[tD]},tD.addValue=function(tD,tY){return this.variables[tD]=tY},tD.setValue=function(tD,tY){return this.variables.hasOwnProperty(tD)?this.variables[tD]=tY:null},tD.clear=function(){for(var tD in this.variables)delete this.variables[tD]},tD.recycle=function(){this.clear(),tY.POOL.push(this)},tY.create=function(){var tD=tY.POOL.pop();return tD||(tD=new tY),tD},tY.POOL=[],tY}(),tMD=function(){function tO(){this.offset=0,this.startIndex=0,this._mat=tq.create()}tC(tO,"laya.webgl.submit.SubmitOtherIBVB");var tD=tO.prototype;return tt.imps(tD,{"laya.webgl.submit.ISubmit":!0}),tD.releaseRender=function(){var tD=tO._cache;(tD[tD._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},tD.getRenderType=function(){return 10009},tD.renderSubmit=function(){var tD=this._shaderValue.textureHost;if(tD){var tY=tD.source;if(!tD.bitmap||!tY)return 1;this._shaderValue.texture=tY}this._vb.bind_upload(this._ib);var tg=tjD.worldMatrix4,tT=tq.TEMP;tq.mulPre(this._mat,tg[0],tg[1],tg[4],tg[5],tg[12],tg[13],tT);var tr=tjD.worldMatrix4=tO.tempMatrix4;tr[0]=tT.a,tr[1]=tT.b,tr[4]=tT.c,tr[5]=tT.d,tr[12]=tT.tx,tr[13]=tT.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var ts=tpD.mainContext;return tf.activeBlendFunction!==this._blendFn&&(ts.enable(3042),this._blendFn(ts),tf.activeBlendFunction=this._blendFn),tm.drawCall++,tm.trianglesFaces+=this._numEle/3,ts.drawElements(4,this._numEle,5123,this.startIndex),tjD.worldMatrix4=tg,tHD.activeShader=null,1},tO.create=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){void 0===tM&&(tM=0);var tE=tO._cache._length?tO._cache[--tO._cache._length]:new tO;tE._ib=tg,tE._vb=tY,tE._numEle=tT,tE._shader=tr,tE._shaderValue=ts;var tI=tD._nBlendType;switch(tE._blendFn=tD._targets?tf.targetFns[tI]:tf.fns[tI],tM){case 0:tE.offset=0,tE.startIndex=tW/(tdD.BYTES_PE*tY.vertexStride)*1.5,tE.startIndex*=tdD.BYTES_PIDX;break;case 1:tE.startIndex=ta,tE.offset=tW}return tE},tO._cache=((tO._cache=[])._length=0,tO._cache),tO.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tO}(),tED=function(){function tg(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new tG,this.screenRect=new tG}tC(tg,"laya.webgl.submit.SubmitScissor");var tD=tg.prototype;return tt.imps(tD,{"laya.webgl.submit.ISubmit":!0}),tD._scissor=function(tD,tY,tg,tT){var tr=tjD.worldMatrix4,ts=tr[0],ta=tr[5],tW=tr[12],tM=tr[13];if(tT*=ta,(tg*=ts)<1||tT<1)return!1;var tE=(tD=tD*ts+tW)+tg,tI=(tY=tY*ta+tM)+tT;tD<0&&(tg=tE-(tD=0)),tY<0&&(tT=tI-(tY=0));var tO=tjD.worldClipRect;if(tD=Math.max(tD,tO.x),tY=Math.max(tY,tO.y),tg=Math.min(tE,tO.right)-tD,tT=Math.min(tI,tO.bottom)-tY,tg<1||tT<1)return!1;var tC=tjD.worldScissorTest;return this.screenRect.copyFrom(tO),tO.x=tD,tO.y=tY,tO.width=tg,tO.height=tT,tjD.worldScissorTest=!0,tY=tjD.height-tY-tT,tpD.mainContext.scissor(tD,tY,tg,tT),tpD.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),tC?(tY=tjD.height-this.screenRect.y-this.screenRect.height,tpD.mainContext.scissor(this.screenRect.x,tY,this.screenRect.width,this.screenRect.height),tpD.mainContext.enable(3089)):(tpD.mainContext.disable(3089),tjD.worldScissorTest=!1),tO.copyFrom(this.screenRect),!0},tD._scissorWithTagart=function(tD,tY,tg,tT){if(tg<1||tT<1)return!1;var tr=tD+tg,ts=tY+tT;tD<0&&(tg=tr-(tD=0)),tY<0&&(tT=ts-(tY=0));var ta=tjD.worldClipRect;if(tD=Math.max(tD,ta.x),tY=Math.max(tY,ta.y),tg=Math.min(tr,ta.right)-tD,tT=Math.min(ts,ta.bottom)-tY,tg<1||tT<1)return!1;var tW=tjD.worldScissorTest;return this.screenRect.copyFrom(ta),tjD.worldScissorTest=!0,ta.x=tD,ta.y=tY,ta.width=tg,ta.height=tT,tY=tjD.height-tY-tT,tpD.mainContext.scissor(tD,tY,tg,tT),tpD.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),tW?(tY=tjD.height-this.screenRect.y-this.screenRect.height,tpD.mainContext.scissor(this.screenRect.x,tY,this.screenRect.width,this.screenRect.height),tpD.mainContext.enable(3089)):(tpD.mainContext.disable(3089),tjD.worldScissorTest=!1),ta.copyFrom(this.screenRect),!0},tD.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},tD.getRenderType=function(){return 0},tD.releaseRender=function(){var tD=tg._cache;(tD[tD._length++]=this).context=null},tg.create=function(tD){var tY=tg._cache._length?tg._cache[--tg._cache._length]:new tg;return tY.context=tD,tY},tg._cache=((tg._cache=[])._length=0,tg._cache),tg}(),tID=function(){function tM(){this.step=0,this.blendMode=null,this.level=0}tC(tM,"laya.webgl.submit.SubmitStencil");var tD=tM.prototype;return tt.imps(tD,{"laya.webgl.submit.ISubmit":!0}),tD.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},tD.getRenderType=function(){return 0},tD.releaseRender=function(){var tD=tM._cache;tD[tD._length++]=this},tD.do1=function(){var tD=tpD.mainContext;tD.enable(2960),tD.clear(1024),tD.colorMask(!1,!1,!1,!1),tD.stencilFunc(514,this.level,255),tD.stencilOp(7680,7680,7682)},tD.do2=function(){var tD=tpD.mainContext;tD.stencilFunc(514,this.level+1,255),tD.colorMask(!0,!0,!0,!0),tD.stencilOp(7680,7680,7680)},tD.do3=function(){var tD=tpD.mainContext;tD.colorMask(!0,!0,!0,!0),tD.stencilOp(7680,7680,7680),tD.clear(1024),tD.disable(2960)},tD.do4=function(){var tD=tpD.mainContext;0==this.level&&(tD.enable(2960),tD.clear(1024)),tD.colorMask(!1,!1,!1,!1),tD.stencilFunc(519,0,255),tD.stencilOp(7680,7680,7682)},tD.do5=function(){var tD=tpD.mainContext;tD.stencilFunc(514,this.level,255),tD.colorMask(!0,!0,!0,!0),tD.stencilOp(7680,7680,7680)},tD.do6=function(){var tD=tpD.mainContext;tf.targetFns[tf.TOINT[this.blendMode]](tD)},tD.do7=function(){var tD=tpD.mainContext;tD.colorMask(!1,!1,!1,!1),tD.stencilOp(7680,7680,7683)},tD.do8=function(){var tD=tpD.mainContext;tD.colorMask(!0,!0,!0,!0),tD.stencilFunc(514,this.level,255),tD.stencilOp(7680,7680,7680)},tM.restore=function(tD,tY,tg,tT,tr){var ts;if((tD._renderKey=0)<tM._mask&&tM._mask--,0==tM._mask)ts=laya.webgl.submit.SubmitStencil.create(3),tD.addRenderObject(ts),tD._curSubmit=tsD.RENDERBASE;else{ts=laya.webgl.submit.SubmitStencil.create(7),tD.addRenderObject(ts);var ta=tD._vb;ta._byteLength;if(tJD.fillRectImgVb(ta,null,tY.x,tY.y,tY.width,tY.height,tB.DEF_UV,tg,tT,tr,0,0)){tD._shader2D.glTexture=null;var tW=tD._curSubmit=tsD.createSubmit(tD,tD._ib,ta,(ta._byteLength-64)/32*3,tAD.create(2,0));tW.shaderValue.ALPHA=1,tD._submits[tD._submits._length++]=tW,tD._curSubmit._numEle+=6,tD._curSubmit=tsD.RENDERBASE}else alert("clipRect calc stencil rect error");ts=laya.webgl.submit.SubmitStencil.create(8),tD.addRenderObject(ts)}},tM.restore2=function(tD,tY){var tg;(tD._renderKey=0)<tM._mask&&tM._mask--,0==tM._mask?(tg=laya.webgl.submit.SubmitStencil.create(3),tD.addRenderObject(tg),tD._curSubmit=tsD.RENDERBASE):(tg=laya.webgl.submit.SubmitStencil.create(7),tD.addRenderObject(tg),tD._submits[tD._submits._length++]=tY,tg=laya.webgl.submit.SubmitStencil.create(8),tD.addRenderObject(tg))},tM.create=function(tD){var tY=tM._cache._length?tM._cache[--tM._cache._length]:new tM;return 5==(tY.step=tD)&&++tM._mask,tY.level=tM._mask,tY},tM._cache=((tM._cache=[])._length=0,tM._cache),tM._mask=0,tM}(),tOD=function(){function tW(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}tC(tW,"laya.webgl.submit.SubmitTarget");var tD=tW.prototype;return tt.imps(tD,{"laya.webgl.submit.ISubmit":!0}),tD.renderSubmit=function(){this._vb.bind_upload(this._ib);var tD=this.scope.getValue(this.proName);return tD&&(this.shaderValue.texture=tD.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[tD.width,tD.height]),this.shaderValue.upload(),this.blend(),tm.drawCall++,tm.trianglesFaces+=this._numEle/3,tpD.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},tD.blend=function(){if(tf.activeBlendFunction!==tf.fns[this.blendType]){var tD=tpD.mainContext;tD.enable(3042),tf.fns[this.blendType](tD),tf.activeBlendFunction=tf.fns[this.blendType]}},tD.getRenderType=function(){return 0},tD.releaseRender=function(){var tD=tW._cache;(tD[tD._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},tW.create=function(tD,tY,tg,tT,tr,ts){var ta=tW._cache._length?tW._cache[--tW._cache._length]:new tW;return ta._ib=tY,ta._vb=tg,ta.proName=ts,ta._startIdx=tT*tdD.BYTES_PIDX,ta._numEle=0,ta.blendType=tD._nBlendType,ta.shaderValue=tr,ta.shaderValue.setValue(tD._shader2D),ta},tW._cache=((tW._cache=[])._length=0,tW._cache),tW}(),tCD=function(){function tD(){this._sourceStr=null}tC(tD,"laya.webgl.text.CharSegment");var tY=tD.prototype;return tt.imps(tY,{"laya.webgl.text.ICharSegment":!0}),tY.textToSpit=function(tD){this._sourceStr=tD},tY.getChar=function(tD){return this._sourceStr.charAt(tD)},tY.getCharCode=function(tD){return this._sourceStr.charCodeAt(tD)},tY.length=function(){return this._sourceStr.length},tD}(),tND=function(){var tD;function tm(){}return tC(tm,"laya.webgl.text.DrawText"),tm.__init__=function(){tm._charsTemp=new Array,tm._drawValue=new tD,tm._charSeg=new tCD},tm.customCharSeg=function(tD){tm._charSeg=tD},tm.getChar=function(tD,tY,tg){var tT=twD.createOneChar(tD,tg);return-1!=tY&&(tm._charsCache[tY]=tT),tT},tm._drawSlow=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO,tC,tN,t$){var td,tJ,tx=tm._drawValue.value(ts,tW,tM,tE,tC,tN,t$),tj=0,tZ=0,tp=tm._charsTemp,tl=0,tt=NaN;if(tT)for(tp.length=tT.length,tj=0,tZ=tT.length;tj<tZ;tj++)(tJ=tT[tj])&&(tt=tJ.charNum+tx.txtID,tp[tj]=td=tm._charsCache[tt]||tm.getChar(tJ.char,tt,tx),td.active());else{var t_=tg instanceof laya.utils.WordText?tg.toString():tg;if(tP.CharacterCache){tm._charSeg.textToSpit(t_);var tA=tm._charSeg.length();for(tj=0,tZ=tp.length=tA;tj<tZ;tj++)tt=tm._charSeg.getCharCode(tj)+tx.txtID,tp[tj]=td=tm._charsCache[tt]||tm.getChar(tm._charSeg.getChar(tj),tt,tx),td.active(),tl+=td.cw}else tp.length=0,(td=tm.getChar(t_,-1,tx)).active(),tl+=td.cw,tp[0]=td}var tq=0;null!==ta&&"left"!==ta&&(tq=-("center"==ta?tl/2:tl));var tb,tG,tX=NaN,tz=0;if(tT)for(tj=0,tZ=tp.length;tj<tZ;tj++)td=tp[tj],tJ=tT[tj],td&&tJ&&!td.isSpace&&(tX=td.borderSize,tb=td.texture,tY._drawText(tb,tI+tq+tJ.x*tC-tX,tO+tJ.y*tN-tX,tb.width,tb.height,tr,0,0,0,0));else{for(tj=0,tZ=tp.length;tj<tZ;tj++)(td=tp[tj])&&!td.isSpace&&(tX=td.borderSize,tb=td.texture,tY._drawText(tb,tI+tq-tX,tO-tX,tb.width,tb.height,tr,0,0,0,0),tD&&((tG=tD[tz++])||(tG=tD[tz-1]=[]),tG[0]=tb,tG[1]=tq-tX,tG[2]=-tX)),tq+=td.cw;tD&&(tD.length=tz)}},tm._drawFast=function(tD,tY,tg,tT,tr){for(var ts,ta,tW=0,tM=tD.length;tW<tM;tW++)(ts=(ta=tD[tW])[0]).active(),tY._drawText(ts,tT+ta[1],tr+ta[2],ts.width,ts.height,tg,0,0,0,0)},tm.drawText=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO){if(void 0===tO&&(tO=0),!(tY&&0===tY.length||tg&&0===tg.length)){var tC=tT.a,tN=tT.d;(0!==tT.b||0!==tT.c)&&(tC=tN=1);var t$=1!==tC||1!==tN;if(t$&&tt.stage.transform){var td=tt.stage.transform;t$=td.a===tC&&td.d===tN}else t$=!1;if(t$){var tJ=(tT=tT.copyTo(t_D._tmpMatrix)).tx,tx=tT.ty;tT.scale(1/tC,1/tN),tT._checkTransform(),tE*=tC,tI*=tN,tE+=tJ-tT.tx,tI+=tx-tT.ty}else tC=tN=1;if(tg)tm._drawSlow(null,tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tC,tN,tO);else{if(null===tY.toUpperCase){var tj=tC+1e5*tN,tZ=tY;return void(tZ.changed||tZ.id!==tj?(tZ.id=tj,tZ.changed=!1,tm._drawSlow(tZ.save,tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tC,tN,tO)):tm._drawFast(tZ.save,tD,tT,tE,tI))}var tp=tY+tr.toString()+ta+tW+tM+tC+tN+ts,tl=tm._textsCache[tp];tP.CharacterCache?tl?tm._drawFast(tl,tD,tT,tE,tI):(tm._textsCache.__length||(tm._textsCache.__length=0),tm._textsCache.__length>t_.WebGLTextCacheCount&&((tm._textsCache={}).__length=0,tm._curPoolIndex=0),tm._textCachesPool[tm._curPoolIndex]?(tl=tm._textsCache[tp]=tm._textCachesPool[tm._curPoolIndex]).length=0:tm._textCachesPool[tm._curPoolIndex]=tl=tm._textsCache[tp]=[],tm._textsCache.__length++,tm._curPoolIndex++,tm._drawSlow(tl,tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tC,tN,tO)):tm._drawSlow(tl,tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tC,tN,tO)}}},tm._charsTemp=null,tm._textCachesPool=[],tm._curPoolIndex=0,tm._charsCache={},tm._textsCache={},tm._drawValue=null,tm.d=[],tm._charSeg=null,tm.__init$=function(){tD=function(){function tM(){}return tC(tM,""),tM.prototype.value=function(tD,tY,tg,tT,tr,ts,ta){this.font=tD,this.fillColor=tY,this.borderColor=tg,this.lineWidth=tT,this.scaleX=tr,this.scaleY=ts,this.underLine=ta;var tW=tD.toString()+tr+ts+tT+(tY?tY.toLowerCase():" ")+(tg?tg.toLowerCase():" ")+ta;return this.txtID=tM._keymap[tW],this.txtID||(this.txtID=1e-7*++tM._keymapCount,tM._keymap[tW]=this.txtID),this},tM.clear=function(){tM._keymap={},tM._keymapCount=1},tM._keymap={},tM._keymapCount=1,tM}()},tm}(),t$D=function(){function tr(tD){this._index=0,this._size=14,this._italic=-2,tr._cache2=tr._cache2||[],this.setFont(tD||"14px Arial")}tC(tr,"laya.webgl.text.FontInContext");var tD=tr.prototype;return tD.setFont=function(tD){var tY=tr._cache2[tD];if(tY)this._words=tY[0],this._size=tY[1];else{this._words=tD.split(" ");for(var tg=0,tT=this._words.length;tg<tT;tg++)if(0<this._words[tg].indexOf("px")){this._index=tg;break}this._size=parseInt(this._words[this._index]),tr._cache2[tD]=[this._words,this._size]}this._text=null,this._italic=-2},tD.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},tD.hasType=function(tD){for(var tY=0,tg=this._words.length;tY<tg;tY++)if(this._words[tY]===tD)return tY;return-1},tD.removeType=function(tD){for(var tY=0,tg=this._words.length;tY<tg;tY++)if(this._words[tY]===tD){this._words.splice(tY,1),this._index>tY&&this._index--;break}this._text=null,this._italic=-2},tD.copyTo=function(tD){return tD._text=this._text,tD._size=this._size,tD._index=this._index,tD._words=this._words.slice(),tD._italic=-2,tD},tD.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},tT(0,tD,"size",function(){return this._size},function(tD){this._size=tD,this._words[this._index]=tD+"px",this._text=null}),tr.create=function(tD){var tY=tr._cache[tD];return tY||(tY=tr._cache[tD]=new tr(tD))},tr.EMPTY=new tr,tr._cache={},tr._cache2=null,tr}(),tdD=function(){function tD(){}return tC(tD,"laya.webgl.utils.CONST3D2D"),tD.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tD.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],tD.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],tD._TMPARRAY=[],tD._OFFSETX=0,tD._OFFSETY=0,ta(tD,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),tD}(),tJD=function(){function t$(){}return tC(t$,"laya.webgl.utils.GlUtils"),t$.make2DProjection=function(tD,tY,tg){return[2/tD,0,0,0,0,-2/tY,0,0,0,0,2/tg,0,-1,1,0,1]},t$.fillIBQuadrangle=function(tD,tY){if(65535/4<tY)throw Error("IBQuadrangle count:"+tY+" must<:"+Math.floor(65535/4));tY=Math.floor(tY),tD._resizeBuffer(6*(tY+1)*2,!1),tD.byteLength=tD.bufferLength;for(var tg=tD.getUint16Array(),tT=0,tr=0;tr<tY;tr++)tg[tT++]=4*tr,tg[tT++]=4*tr+2,tg[tT++]=4*tr+1,tg[tT++]=4*tr,tg[tT++]=4*tr+3,tg[tT++]=4*tr+2;return tD.setNeedUpload(),!0},t$.expandIBQuadrangle=function(tD,tY){tD.bufferLength>=6*tY*2||t$.fillIBQuadrangle(tD,tY)},t$.mathCeilPowerOfTwo=function(tD){return tD--,tD|=tD>>1,tD|=tD>>2,tD|=tD>>4,tD|=tD>>8,tD|=tD>>16,++tD},t$.fillQuadrangleImgVb=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=16+(tD._byteLength>>2);tD.byteLength=tM<<2;var tE=tD.getFloat32Array();tE[(tM-=16)+2]=tr[0],tE[tM+3]=tr[1],tE[tM+6]=tr[2],tE[tM+7]=tr[3],tE[tM+10]=tr[4],tE[tM+11]=tr[5],tE[tM+14]=tr[6],tE[tM+15]=tr[7];var tI=ts.a,tO=ts.b,tC=ts.c,tN=ts.d;if(1!==tI||0!==tO||0!==tC||1!==tN){ts.bTransform=!0;var t$=ts.tx+ta,td=ts.ty+tW;tE[tM]=(tT[0]+tY)*tI+(tT[1]+tg)*tC+t$,tE[tM+1]=(tT[0]+tY)*tO+(tT[1]+tg)*tN+td,tE[tM+4]=(tT[2]+tY)*tI+(tT[3]+tg)*tC+t$,tE[tM+5]=(tT[2]+tY)*tO+(tT[3]+tg)*tN+td,tE[tM+8]=(tT[4]+tY)*tI+(tT[5]+tg)*tC+t$,tE[tM+9]=(tT[4]+tY)*tO+(tT[5]+tg)*tN+td,tE[tM+12]=(tT[6]+tY)*tI+(tT[7]+tg)*tC+t$,tE[tM+13]=(tT[6]+tY)*tO+(tT[7]+tg)*tN+td}else ts.bTransform=!1,tY+=ts.tx+ta,tg+=ts.ty+tW,tE[tM]=tY+tT[0],tE[tM+1]=tg+tT[1],tE[tM+4]=tY+tT[2],tE[tM+5]=tg+tT[3],tE[tM+8]=tY+tT[4],tE[tM+9]=tg+tT[5],tE[tM+12]=tY+tT[6],tE[tM+13]=tg+tT[7];return tD._upload=!0},t$.fillTranglesVB=function(tD,tY,tg,tT,tr,ts,ta){var tW=(tD._byteLength>>2)+tT.length;tD.byteLength=tW<<2;var tM=tD.getFloat32Array();tW-=tT.length;for(var tE=tT.length,tI=tr.a,tO=tr.b,tC=tr.c,tN=tr.d,t$=0;t$<tE;t$+=4)if(tM[tW+t$+2]=tT[t$+2],tM[tW+t$+3]=tT[t$+3],1!==tI||0!==tO||0!==tC||1!==tN){tr.bTransform=!0;var td=tr.tx+ts,tJ=tr.ty+ta;tM[tW+t$]=(tT[t$]+tY)*tI+(tT[t$+1]+tg)*tC+td,tM[tW+t$+1]=(tT[t$]+tY)*tO+(tT[t$+1]+tg)*tN+tJ}else tr.bTransform=!1,tY+=tr.tx+ts,tg+=tr.ty+ta,tM[tW+t$]=tY+tT[t$],tM[tW+t$+1]=tg+tT[t$+1];return tD._upload=!0},t$.copyPreImgVb=function(tD,tY,tg){var tT=tD._byteLength>>2;tD.byteLength=tT+16<<2;for(var tr=tD.getFloat32Array(),ts=0,ta=tT-16;ts<4;ts++)tr[tT]=tr[ta]+tY,++ta,tr[++tT]=tr[ta]+tg,++ta,tr[++tT]=tr[ta],++ta,tr[++tT]=tr[ta],++tT,++ta;tD._upload=!0},t$.fillRectImgVb=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO,tC){void 0===tC&&(tC=!1);var tN,t$,td,tJ,tx,tj,tZ,tp,tl,tt,t_,tA,tq,tb,tG,tX,tz=1,tm=tW.a,th=tW.b,ti=tW.c,tP=tW.d,tB=tY&&tY.width<99999999;if(1!==tm||0!==th||0!==ti||1!==tP?(tW.bTransform=!0,0===th&&0===ti&&(tz=23,tl=tr+tg,tt=ts+tT,tN=tm*tg+(t_=tW.tx+tM),td=tm*tl+t_,t$=tP*tT+(tA=tW.ty+tE),tJ=tP*tt+tA)):(tz=23,tW.bTransform=!1,td=(tN=tg+tW.tx+tM)+tr,tJ=(t$=tT+tW.ty+tE)+ts),tB&&(tx=tY.x,tj=tY.y,tZ=tY.width+tx,tp=tY.height+tj),1!==tz){if(Math.min(tN,td)>=tZ)return!1;if(Math.min(t$,tJ)>=tp)return!1;if(Math.max(td,tN)<=tx)return!1;if(Math.max(tJ,t$)<=tj)return!1}var tH=tD._byteLength>>2;tD.byteLength=16+tH<<2;var tv=tD.getFloat32Array();switch(tv[2+tH]=ta[0],tv[3+tH]=ta[1],tv[6+tH]=ta[2],tv[7+tH]=ta[3],tv[10+tH]=ta[4],tv[11+tH]=ta[5],tv[14+tH]=ta[6],tv[15+tH]=ta[7],tz){case 1:t_=tW.tx+tM,tA=tW.ty+tE;var tS=tm*tg,tU=ti*tT,tF=tP*tT,tV=th*tg,tc=tm*(tl=tr+tg),tf=ti*(tt=ts+tT),te=tP*tt,tk=th*tl;tC?(tq=tS+tU+t_,tG=Math.round(tq)-tq,tb=tF+tV+tA,tX=Math.round(tb)-tb,tv[tH]=tq+tG,tv[1+tH]=tb+tX,tv[4+tH]=tc+tU+t_+tG,tv[5+tH]=tF+tk+tA+tX,tv[8+tH]=tc+tf+t_+tG,tv[9+tH]=te+tk+tA+tX,tv[12+tH]=tS+tf+t_+tG,tv[13+tH]=te+tV+tA+tX):(tv[tH]=tS+tU+t_,tv[1+tH]=tF+tV+tA,tv[4+tH]=tc+tU+t_,tv[5+tH]=tF+tk+tA,tv[8+tH]=tc+tf+t_,tv[9+tH]=te+tk+tA,tv[12+tH]=tS+tf+t_,tv[13+tH]=te+tV+tA);break;case 23:tC?(tq=tN+tI,tG=Math.round(tq)-tq,tb=t$,tX=Math.round(tb)-tb,tv[tH]=tq+tG,tv[1+tH]=tb+tX,tv[4+tH]=td+tI+tG,tv[5+tH]=t$+tX,tv[8+tH]=td+tG,tv[9+tH]=tJ+tX,tv[12+tH]=tN+tG,tv[13+tH]=tJ+tX):(tv[tH]=tN+tI,tv[1+tH]=t$,tv[4+tH]=td+tI,tv[5+tH]=t$,tv[8+tH]=td,tv[9+tH]=tJ,tv[12+tH]=tN,tv[13+tH]=tJ)}return tD._upload=!0},t$.fillLineVb=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=.5*ta,tE=t$._fillLineArray,tI=-(tT-ts),tO=tg-tr,tC=Math.sqrt(tI*tI+tO*tO);tI/=tC,tO/=tC,tI*=tM,tO*=tM,tE[0]=tg-tI,tE[1]=tT-tO,tE[4]=tg+tI,tE[5]=tT+tO,tE[8]=tr+tI,tE[9]=ts+tO,tE[12]=tr-tI,tE[13]=ts-tO,tW&&tW.transformPointArray(tE,tE);var tN=16+(tD._byteLength>>2);return tD.byteLength=tN<<2,tD.insertData(tE,tN-16),!0},t$._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t$}(),txD=(function(){function tM(){}tC(tM,"laya.webgl.utils.MatirxArray"),tM.ArrayMul=function(tD,tY,tg){if(tD)if(tY)for(var tT=NaN,tr=NaN,ts=NaN,ta=NaN,tW=0;tW<4;tW++)tT=tD[tW],tr=tD[tW+4],ts=tD[tW+8],ta=tD[tW+12],tg[tW]=tT*tY[0]+tr*tY[1]+ts*tY[2]+ta*tY[3],tg[tW+4]=tT*tY[4]+tr*tY[5]+ts*tY[6]+ta*tY[7],tg[tW+8]=tT*tY[8]+tr*tY[9]+ts*tY[10]+ta*tY[11],tg[tW+12]=tT*tY[12]+tr*tY[13]+ts*tY[14]+ta*tY[15];else tM.copyArray(tD,tg);else tM.copyArray(tY,tg)},tM.copyArray=function(tD,tY){if(tD&&tY)for(var tg=0;tg<tD.length;tg++)tY[tg]=tD[tg]}}(),function(){function tY(tD,tY,tg){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=tD,this._vb=new tnD(tD,35048),tY&&this._vb._resizeBuffer(tY,!1),this._ib=new tuD,tg&&this._ib._resizeBuffer(tg,!1)}tC(tY,"laya.webgl.utils.Mesh2D");var tD=tY.prototype;return tD.cloneWithNewVB=function(){var tD=new tY(this._stride,0,0);return tD._ib=this._ib,tD._quadNum=this._quadNum,tD._attribInfo=this._attribInfo,tD},tD.cloneWithNewVBIB=function(){var tD=new tY(this._stride,0,0);return tD._attribInfo=this._attribInfo,tD},tD.getVBW=function(){return this._vb.setNeedUpload(),this._vb},tD.getVBR=function(){return this._vb},tD.getIBR=function(){return this._ib},tD.getIBW=function(){return this._ib.setNeedUpload(),this._ib},tD.createQuadIB=function(tD){this._quadNum=tD,this._ib._resizeBuffer(6*tD*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var tY=this._ib.getUint16Array(),tg=0,tT=0,tr=0;tr<tD;tr++)tY[tg++]=tT,tY[tg++]=tT+2,tY[tg++]=tT+1,tY[tg++]=tT,tY[tg++]=tT+3,tY[tg++]=tT+2,tT+=4;this._ib.setNeedUpload()},tD.setAttributes=function(tD){if(this._attribInfo=tD,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},tD.getEleNum=function(){return this._ib.getBuffer().byteLength/2},tD.releaseMesh=function(){},tD.destroy=function(){},tD.clearVB=function(){this._vb.clear()},tY._gvaoid=0,tY}()),tjD=function(){function tr(){}return tC(tr,"laya.webgl.utils.RenderState2D"),tr.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},tr.mat2MatArray=function(tD,tY){var tg=tD,tT=tY;return tT[0]=tg.a,tT[1]=tg.b,tT[2]=tr.EMPTYMAT4_ARRAY[2],tT[3]=tr.EMPTYMAT4_ARRAY[3],tT[4]=tg.c,tT[5]=tg.d,tT[6]=tr.EMPTYMAT4_ARRAY[6],tT[7]=tr.EMPTYMAT4_ARRAY[7],tT[8]=tr.EMPTYMAT4_ARRAY[8],tT[9]=tr.EMPTYMAT4_ARRAY[9],tT[10]=tr.EMPTYMAT4_ARRAY[10],tT[11]=tr.EMPTYMAT4_ARRAY[11],tT[12]=tg.tx,tT[13]=tg.ty,tT[14]=tr.EMPTYMAT4_ARRAY[14],tT[15]=tr.EMPTYMAT4_ARRAY[15],tY},tr.restoreTempArray=function(){tr.TEMPMAT4_ARRAY[0]=1,tr.TEMPMAT4_ARRAY[1]=0,tr.TEMPMAT4_ARRAY[4]=0,tr.TEMPMAT4_ARRAY[5]=1,tr.TEMPMAT4_ARRAY[12]=0,tr.TEMPMAT4_ARRAY[13]=0},tr.clear=function(){tr.worldScissorTest=!1,tr.worldShaderDefines=null,tr.worldFilters=null,tr.worldAlpha=1,tr.worldClipRect.x=tr.worldClipRect.y=0,tr.worldClipRect.width=tr.width,tr.worldClipRect.height=tr.height,tr.curRenderTarget=null},tr._MAXSIZE=99999999,tr.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tr.worldMatrix4=tr.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tr.worldAlpha=1,tr.worldScissorTest=!1,tr.worldFilters=null,tr.worldShaderDefines=null,tr.curRenderTarget=null,tr.width=0,tr.height=0,ta(tr,["worldMatrix",function(){return this.worldMatrix=new tq},"worldClipRect",function(){return this.worldClipRect=new tG(0,0,99999999,99999999)}]),tr}(),tZD=function(){var tj,tg;function tZ(tD,tY,tg,tT,tr){var ts=this;function ta(tD){var tY=[],tg=new tj(tY);return ts._compileToTree(tg,tD.split("\n"),0,tY,tr),tg}var tW=tN.now();this._VS=ta(tY),this._PS=ta(tg),this._nameMap=tT,2<tN.now()-tW&&console.log("ShaderCompile use time:"+(tN.now()-tW)+"  size:"+tY.length+"/"+tg.length)}tC(tZ,"laya.webgl.utils.ShaderCompile");var tD=tZ.prototype;return tD._compileToTree=function(tD,tY,tg,tT,tr){var ts,ta,tW,tM,tE,tI,tO,tC=0,tN=0,t$=0,td=0;for(tN=tg;tN<tY.length;tN++)if(!((tW=tY[tN]).length<1)&&0!==(tC=tW.indexOf("//"))){if(0<=tC&&(tW=tW.substr(0,tC)),ts=tO||new tj(tT),tO=null,ts.text=tW,ts.noCompile=!0,0<=(tC=tW.indexOf("#"))){for(tM="#",td=tC+1,t$=tW.length;td<t$;td++){var tJ=tW.charAt(td);if(" "===tJ||"\t"===tJ||"\r"===tJ||"\n"===tJ||"?"===tJ)break;tM+=tJ}switch(ts.name=tM){case"#ifdef":case"#ifndef":if(ts.src=tW,ts.noCompile=null!=tW.match(/[!&|()=<>]/),ts.noCompile?console.log("function():Boolean{return "+tW.substr(tC+ts.name.length)+"}"):(tI=tW.replace(/^\s*/,"").split(/\s+/),ts.setCondition(tI[1],"#ifdef"===tM?1:2),ts.text="//"+ts.text),ts.setParent(tD),tD=ts,tr)for(tI=tW.substr(td).split(tZ._splitToWordExps3),td=0;td<tI.length;td++)(tW=tI[td]).length&&(tr[tW]=!0);continue;case"#if":if(ts.src=tW,ts.noCompile=!0,ts.setParent(tD),tD=ts,tr)for(tI=tW.substr(td).split(tZ._splitToWordExps3),td=0;td<tI.length;td++)(tW=tI[td]).length&&"defined"!=tW&&(tr[tW]=!0);continue;case"#else":ts.src=tW,ta=(tD=tD.parent).childs[tD.childs.length-1],ts.noCompile=ta.noCompile,ts.noCompile||(ts.condition=ta.condition,ts.conditionType=1==ta.conditionType?2:1,ts.text="//"+ts.text+" "+ta.text+" "+ts.conditionType),ts.setParent(tD),tD=ts;continue;case"#endif":ta=(tD=tD.parent).childs[tD.childs.length-1],ts.noCompile=ta.noCompile,ts.noCompile||(ts.text="//"+ts.text),ts.setParent(tD);continue;case"#include":tI=tZ.splitToWords(tW,null);var tx=tZ.includes[tI[1]];if(!tx)throw"ShaderCompile error no this include file:"+tI[1];if((tC=tI[0].indexOf("?"))<0){ts.setParent(tD),tW=tx.getWith("with"==tI[2]?tI[3]:null),this._compileToTree(ts,tW.split("\n"),0,tT,tr),ts.text="";continue}ts.setCondition(tI[0].substr(tC+1),1),ts.text=tx.getWith("with"==tI[2]?tI[3]:null);break;case"#import":tE=(tI=tZ.splitToWords(tW,null))[1],tT.push({node:ts,file:tZ.includes[tE],ofs:ts.text.length});continue}}else{if((ta=tD.childs[tD.childs.length-1])&&!ta.name){0<tT.length&&tZ.splitToWords(tW,ta),tO=ts,ta.text+="\n"+tW;continue}0<tT.length&&tZ.splitToWords(tW,ts)}ts.setParent(tD)}},tD.createShader=function(tD,tY,tg){var tT={},tr="";if(tD)for(var ts in tD)tr+="#define "+ts+"\n",tT[ts]=!0;var ta=this._VS.toscript(tT,[]),tW=this._PS.toscript(tT,[]);return(tg||tRD.create)(tr+ta.join("\n"),tr+tW.join("\n"),tY,this._nameMap)},tZ._parseOne=function(tD,tY,tg,tT,tr,ts){var ta={type:tZ.shaderParamsMap[tg[tT+1]],name:tg[tT+2],size:isNaN(parseInt(tg[tT+3]))?1:parseInt(tg[tT+3])};return ts&&("attribute"==tr?tD.push(ta):tY.push(ta)),":"==tg[tT+3]&&(ta.type=tg[tT+4],tT+=2),tT+=2},tZ.addInclude=function(tD,tY){if(!tY||0===tY.length)throw new Error("add shader include file err:"+tD);if(tZ.includes[tD])throw new Error("add shader include file err, has add:"+tD);tZ.includes[tD]=new tg(tY)},tZ.preGetParams=function(tD,tY){var tg=[tD,tY],tT={},tr=[],ts=[],ta={},tW=[];tT.attributes=tr,tT.uniforms=ts,tT.defines=ta;for(var tM=0,tE=0,tI=0;tI<2;tI++){tg[tI]=tg[tI].replace(tZ._removeAnnotation,"");var tO,tC=tg[tI].match(tZ._reg);for(tM=0,tE=tC.length;tM<tE;tM++){var tN=tC[tM];if("attribute"==tN||"uniform"==tN)tM=tZ._parseOne(tr,ts,tC,tM,tN,!0);else{if("#define"==tN){tW[tN=tC[++tM]]=1;continue}if("#ifdef"==tN){ta[tO=tC[++tM]]=ta[tO]||[];for(tM++;tM<tE;tM++)if("attribute"==(tN=tC[tM])||"uniform"==tN)tM=tZ._parseOne(tr,ts,tC,tM,tN,tW[tO]);else if("#else"==tN)for(tM++;tM<tE;tM++)if("attribute"==(tN=tC[tM])||"uniform"==tN)tM=tZ._parseOne(tr,ts,tC,tM,tN,!tW[tO]);else if("#endif"==tN)break}}}}return tT},tZ.splitToWords=function(tD,tY){for(var tg,tT,tr=[],ts=-1,ta=0,tW=tD.length;ta<tW;ta++)if(tg=tD.charAt(ta),0<=" \t=+-*/&%!<>()'\",;".indexOf(tg)){if(0<=ts&&1<ta-ts&&(tT=tD.substr(ts,ta-ts),tr.push(tT)),'"'==tg||"'"==tg){var tM=tD.indexOf(tg,ta+1);if(tM<0)throw"Sharder err:"+tD;tr.push(tD.substr(ta+1,tM-ta-1)),ta=tM,ts=-1;continue}"("==tg&&tY&&0<tr.length&&(tT=tr[tr.length-1]+";","vec4;main;".indexOf(tT)<0&&(tY.useFuns+=tT)),ts=-1}else ts<0&&(ts=ta);return ts<tW&&1<tW-ts&&(tT=tD.substr(ts,tW-ts),tr.push(tT)),tr},tZ.IFDEF_NO=0,tZ.IFDEF_YES=1,tZ.IFDEF_ELSE=2,tZ.IFDEF_PARENT=3,tZ._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),tZ._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),tZ._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),tZ.includes={},ta(tZ,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),tZ.__init$=function(){tj=function(){function tg(tD){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=tD}tC(tg,"");var tD=tg.prototype;return tD.setParent=function(tD){tD.childs.push(this),this.z=tD.z+1,this.parent=tD},tD.setCondition=function(tD,tY){tD&&(this.conditionType=tY,tD=tD.replace(/(\s*$)/g,""),this.condition=function(){return this[tD]},this.condition.__condition=tD)},tD.toscript=function(tD,tY){return this._toscript(tD,tY,++tg.__id)},tD._toscript=function(tT,tr,ts){if(this.childs.length<1&&!this.text)return tr;tr.length;if(this.condition){var tD=!!this.condition.call(tT);if(2===this.conditionType&&(tD=!tD),!tD)return tr}if(this.text&&tr.push(this.text),0<this.childs.length&&this.childs.forEach(function(tD,tY,tg){tD._toscript(tT,tr,ts)}),0<this.includefiles.length&&0<this.useFuns.length)for(var tY,tg=0,ta=this.includefiles.length;tg<ta;tg++)this.includefiles[tg].curUseID!=ts&&0<(tY=this.includefiles[tg].file.getFunsScript(this.useFuns)).length&&(this.includefiles[tg].curUseID=ts,tr[0]=tY+tr[0]);return tr},tg.__id=1,tg}(),tg=function(){function tD(tD){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=tD;for(var tY=0,tg=0,tT=0;!((tY=tD.indexOf("#begin",tY))<0);){for(tT=tY+5;!((tT=tD.indexOf("#end",tT))<0)&&"i"===tD.charAt(tT+4);)tT+=5;if(tT<0)throw"add include err,no #end:"+tD;tg=tD.indexOf("\n",tY);var tr=tZ.splitToWords(tD.substr(tY,tg-tY),null);"code"==tr[1]?this.codes[tr[2]]=tD.substr(tg+1,tT-tg-1):"function"==tr[1]&&(tg=tD.indexOf("function",tY),tg+="function".length,this.funs[tr[3]]=tD.substr(tg+1,tT-tg-1),this.funnames+=tr[3]+";"),tY=tT+1}}tC(tD,"");var tY=tD.prototype;return tY.getWith=function(tD){var tY=tD?this.codes[tD]:this.script;if(!tY)throw"get with error:"+tD;return tY},tY.getFunsScript=function(tD){var tY="";for(var tg in this.funs)0<=tD.indexOf(tg+";")&&(tY+=this.funs[tg]);return tY},tD}()},tZ}(),tpD=function(){function ta(){}return tC(ta,"laya.webgl.WebGL"),ta._uint8ArraySlice=function(){for(var tD=this.length,tY=new Uint8Array(this.length),tg=0;tg<tD;tg++)tY[tg]=this[tg];return tY},ta._float32ArraySlice=function(){for(var tD=this.length,tY=new Float32Array(this.length),tg=0;tg<tD;tg++)tY[tg]=this[tg];return tY},ta._uint16ArraySlice=function(tD){var tY,tg=arguments,tT=0,tr=0;if(0===tg.length)for(tT=this.length,tY=new Uint16Array(tT),tr=0;tr<tT;tr++)tY[tr]=this[tr];else if(2===tg.length){var ts=tg[0],ta=tg[1];if(ts<ta)for(tT=ta-ts,tY=new Uint16Array(tT),tr=ts;tr<ta;tr++)tY[tr-ts]=this[tr];else tY=new Uint16Array(0)}return tY},ta.expandContext=function(){var tD=tr.prototype,tY=CanvasRenderingContext2D.prototype;tY.fillTrangles=tD.fillTrangles,tQD.__int__(null),tY.setIBVB=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){void 0===tM&&(tM=0),void 0===tE&&(tE=0),null===tg&&(this._ib=this._ib||tuD.QuadrangleIB,tg=this._ib,tJD.expandIBQuadrangle(tg,tT._byteLength/64+8)),this._setIBVB(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE)},tY.fillTrangles=function(tD,tY,tg,tT,tr){this._curMat=this._curMat||tq.create(),this._vb=this._vb||tnD.create(),this._ib||(this._ib=tuD.create(),tJD.fillIBQuadrangle(this._ib,ta/4));var ts=this._vb,ta=tT.length>>4;tJD.fillTranglesVB(ts,tY,tg,tT,tr||this._curMat,0,0),tJD.expandIBQuadrangle(this._ib,ts._byteLength/64+8);var tW=new tAD(1,0);tW.textureHost=tD;var tM=new tyD("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");ts._vertType=3,this._setIBVB(tY,tg,this._ib,ts,6*ta,tr,tM,tW,0,0)}},ta.enable=function(){if(tN.__init__(),tx.isConchApp&&!tx.isConchWebGL)return tl.skinAniSprite=function(){return new tDD},ta.expandContext(),!1;if(tl.getWebGLContext=function(tD){for(var tY,tg=["webgl","experimental-webgl","webkit-3d","moz-webgl"],tT=0;tT<tg.length;tT++){try{tY=tD.getContext(tg[tT],{stencil:t_.isStencil,alpha:t_.isAlpha,antialias:t_.isAntialias,premultipliedAlpha:t_.premultipliedAlpha,preserveDrawingBuffer:t_.preserveDrawingBuffer})}catch(tD){}if(tY)return tY}return null},null==(ta.mainContext=ta.mainContext||tl.getWebGLContext(tx._mainCanvas)))return!1;if(tx.isWebGL)return!0;tJ.create=function(tD,tY){return new tDY(tD,tY)},tY.create=function(tD,tY,tg,tT,tr,ts,ta){return new toD(tD,tY,tg,tT,tr,ts,ta)},tx.WebGL=ta,tx.isWebGL=!0,tND.__init__(),tl.createRenderSprite=function(tD,tY){return new tqD(tD,tY)},tl.createWebGLContext2D=function(tD){return new t_D(tD)},tl.changeWebGLSize=function(tD,tY){laya.webgl.WebGL.onStageResize(tD,tY)},tl.createGraphics=function(){return new ttD};var tD=tl.createFilterAction;return tl.createFilterAction=tD||function(tD){return new tbD},tl.clear=function(tD){tjD.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var tY=tx.context.ctx,tg=0==tY._submits._length||t_.preserveDrawingBuffer?t$.create(tD)._color:tz._wgColor;tg&&tY.clearBG(tg[0],tg[1],tg[2],tg[3]),tjD.clear()},tl.addToAtlas=function(tD,tY){void 0===tY&&(tY=!1);var tg=tD.bitmap;tx.optimizeTextureMemory(tD.url,tD)?tt.__typeof(tg,"laya.webgl.resource.IMergeAtlasBitmap")&&tg.allowMerageInAtlas&&tg.on("recovered",tD,tD.addTextureToAtlas):tg.enableMerageInAtlas=!1},tl.isAtlas=function(tD){return tD instanceof laya.webgl.atlas.AtlasWebGLCanvas},tV._enable(),tl.beginFlush=function(){for(var tD=tV.instance,tY=tD.getAtlaserCount(),tg=0;tg<tY;tg++){var tT=tD.getAtlaserByIndex(tg).texture;tT._flashCacheImageNeedFlush&&tl.flashFlushImage(tT)}},tl.drawToCanvas=function(tD,tY,tg,tT,tr,ts){(tg<=0||tT<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),tg|=0,tT|=0,tr|=0,ts|=0;var ta=tvD.create(tg,tT,6408,5121,0,!1);ta.start(),ta.clear(0,0,0,0),tx.context.clear(),tj.renders[tY]._fun(tD,tx.context,tr,tjD.height-tT+ts),tx.context.flush(),ta.end();var tW=ta.getData(0,0,tg,tT);if(ta.recycle(),tW.byteLength==tg*tT*4){var tM=new tkD;tM._canvas=tN.createElement("canvas"),tM.size(tg,tT);var tE=tM._canvas.getContext("2d");tN.canvas.size(tg,tT);var tI=tN.context,tO=tI.createImageData(tg,tT);return tO.data.set(new Uint8ClampedArray(tW.buffer)),tM._imgData=tO,tI.putImageData(tO,0,0),tE.save(),tE.translate(0,tT),tE.scale(1,-1),tE.drawImage(tN.canvas.source,0,0),tE.restore(),tM}console.log("drawToCanvas error: w:"+tg+",h:"+tT+",datalen:"+tW.byteLength)},tl.createFilterAction=function(tD){var tY;switch(tD){case 32:tY=new tbD}return tY},tl.addTextureToAtlas=function(tD){tD._uvID++,tV._atlasRestore++,tD.bitmap.enableMerageInAtlas&&tV.instance.addToAtlas(tD)},tl.getTexturePixels=function(tD,tY,tg,tT,tr){tx.context.ctx.clear();var ts=new tX;ts.graphics.drawTexture(tD,-tY,-tg);var ta=tvD.create(tT,tr);ta.start(),ta.clear(0,0,0,0),ts.render(tx.context,0,0),tx.context.ctx.flush(),ta.end();for(var tW=ta.getData(0,0,tT,tr),tM=[],tE=0,tI=tr-1;0<=tI;tI--)for(var tO=0;tO<tT;tO++)tE=4*(tI*tT+tO),tM.push(tW[tE]),tM.push(tW[tE+1]),tM.push(tW[tE+2]),tM.push(tW[tE+3]);return tM},tl.skinAniSprite=function(){return new tDD},td.create=function(tD,tY){var tg=new tkD;return tg._imgData=tY,tg.flipY=!1,tg},tA._filterStart=function(tD,tY,tg,tT,tr){var ts=tD.getValue("bounds"),ta=tvD.create(ts.width,ts.height);if(ta.start(),ta.clear(0,0,0,0),tD.addValue("src",ta),tD.addValue("ScissorTest",tjD.worldScissorTest),tjD.worldScissorTest){var tW=new tG;tW.copyFrom(tg.ctx._clipRect),tD.addValue("clipRect",tW),tjD.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},tA._filterEnd=function(tD,tY,tg,tT,tr){var ts=tD.getValue("bounds");tD.getValue("src").end();var ta=tvD.create(ts.width,ts.height);ta.start(),ta.clear(0,0,0,0),tD.addValue("out",ta),tY._set$P("_filterCache",ta),tY._set$P("_isHaveGlowFilter",tD.getValue("_isHaveGlowFilter"))},tA._EndTarget=function(tD,tY){if(tD.getValue("src").recycle(),tD.getValue("out").end(),tD.getValue("ScissorTest")){tjD.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),tY.ctx.save();var tg=tD.getValue("clipRect");tY.ctx.clipRect(tg.x,tg.y,tg.width,tg.height)}},tA._useSrc=function(tD){var tY=tD.getValue("out");tY.end(),(tY=tD.getValue("src")).start(),tY.clear(0,0,0,0)},tA._endSrc=function(tD){tD.getValue("src").end()},tA._useOut=function(tD){var tY=tD.getValue("src");tY.end(),(tY=tD.getValue("out")).start(),tY.clear(0,0,0,0)},tA._endOut=function(tD){tD.getValue("out").end()},tA._recycleScope=function(tD){tD.recycle()},tA._filter=function(tD,tY,tg,tT){var tr=this._next;if(tr){var ts,ta,tW=tD.filters,tM=tW.length;if(1==tM&&32==tW[0].type)return tY.ctx.save(),tY.ctx.setFilters([tW[0]]),tr._fun.call(tr,tD,tY,tg,tT),void tY.ctx.restore();var tE=tWD.create(),tI=tb.TEMP,tO=tY.ctx._getTransformMatrix(),tC=tq.create();tO.copyTo(tC);var tN=0,t$=0,td=!1,tJ=tD._$P._filterCache?tD._$P._filterCache:null;if(!tJ||tD._repaint){td=tD._isHaveGlowFilter(),tE.addValue("_isHaveGlowFilter",td),td&&(tN=50,t$=25),(ta=new tG).copyFrom(tD.getSelfBounds()),ta.x+=tD.x,ta.y+=tD.y,ta.x-=tD.pivotX+4,ta.y-=tD.pivotY+4;var tx=ta.x,tj=ta.y;if(ta.width+=tN+8,ta.height+=tN+8,tI.x=ta.x*tC.a+ta.y*tC.c,tI.y=ta.y*tC.d+ta.x*tC.b,ta.x=tI.x,ta.y=tI.y,tI.x=ta.width*tC.a+ta.height*tC.c,tI.y=ta.height*tC.d+ta.width*tC.b,ta.width=tI.x,ta.height=tI.y,ta.width<=0||ta.height<=0)return;tJ&&tJ.recycle(),tE.addValue("bounds",ta);var tZ=taD.create([tE,tD,tY,0,0],tA._filterStart);tY.addRenderObject(tZ),tY.ctx._renderKey=0,tY.ctx._shader2D.glTexture=null;var tp=tD.x-tx+t$,tl=tD.y-tj+t$;tr._fun.call(tr,tD,tY,tp,tl),tZ=taD.create([tE,tD,tY,0,0],tA._filterEnd),tY.addRenderObject(tZ);for(var tt=0;tt<tM;tt++){0!=tt&&(tZ=taD.create([tE],tA._useSrc),tY.addRenderObject(tZ),ts=tAD.create(1,0),tq.TEMP.identity(),tY.ctx.drawTarget(tE,0,0,ta.width,ta.height,tq.TEMP,"out",ts,null,tf.TOINT.overlay),tZ=taD.create([tE],tA._useOut),tY.addRenderObject(tZ)),tW[tt].action.apply3d(tE,tD,tY,0,0)}tZ=taD.create([tE,tY],tA._EndTarget),tY.addRenderObject(tZ)}else{if((td=!!tD._$P._isHaveGlowFilter&&tD._$P._isHaveGlowFilter)&&(tN=50,t$=25),(ta=tD.getBounds()).width<=0||ta.height<=0)return;ta.width+=tN,ta.height+=tN,tI.x=ta.x*tC.a+ta.y*tC.c,tI.y=ta.y*tC.d+ta.x*tC.b,ta.x=tI.x,ta.y=tI.y,tI.x=ta.width*tC.a+ta.height*tC.c,tI.y=ta.height*tC.d+ta.width*tC.b,ta.width=tI.x,ta.height=tI.y,tE.addValue("out",tJ)}tg=tg-t$-tD.x,tT=tT-t$-tD.y,tI.setTo(tg,tT),tC.transformPoint(tI),tg=tI.x+ta.x,tT=tI.y+ta.y,ts=tAD.create(1,0),tq.TEMP.identity(),tY.ctx.drawTarget(tE,tg,tT,ta.width,ta.height,tq.TEMP,"out",ts,null,tf.TOINT.overlay),tZ=taD.create([tE],tA._recycleScope),tY.addRenderObject(tZ),tC.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=ta._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=ta._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=ta._uint8ArraySlice),!0},ta.onStageResize=function(tD,tY){null!=ta.mainContext&&(ta.mainContext.viewport(0,0,tD,tY),tjD.width=tD,tjD.height=tY)},ta.onInvalidGLRes=function(){tV.instance.freeAll(),tp.releaseContentManagers(!0),ta.doNodeRepaint(tt.stage),ta.mainContext.viewport(0,0,tjD.width,tjD.height),tt.stage.event("devicelost")},ta.doNodeRepaint=function(tD){0==tD.numChildren&&tD.repaint();for(var tY=0;tY<tD.numChildren;tY++)ta.doNodeRepaint(tD.getChildAt(tY))},ta.init=function(tD,tY,tg){ta.mainCanvas=tD,td._createContext=function(tD){return new t_D(tD)},tkD._createContext=function(tD){return new t_D(tD)};var tT=laya.webgl.WebGL.mainContext;if(null!=tT.getShaderPrecisionFormat){var tr=tT.getShaderPrecisionFormat(35633,36338),ts=tT.getShaderPrecisionFormat(35632,36338);ta.shaderHighPrecision=!!(tr&&ts&&tr.precision&&ts.precision)}else ta.shaderHighPrecision=!1;if(ta.compressAstc=tT.getExtension("WEBGL_compressed_texture_astc"),ta.compressAtc=tT.getExtension("WEBGL_compressed_texture_atc"),ta.compressEtc=tT.getExtension("WEBGL_compressed_texture_etc"),ta.compressEtc1=tT.getExtension("WEBGL_compressed_texture_etc1"),ta.compressPvrtc=tT.getExtension("WEBGL_compressed_texture_pvrtc"),ta.compressS3tc=tT.getExtension("WEBGL_compressed_texture_s3tc"),ta.compressS3tc_srgb=tT.getExtension("WEBGL_compressed_texture_s3tc_srgb"),ta.compressAstc=ta.compressAstc?ta.compressAstc:{},ta.compressAtc=ta.compressAtc?ta.compressAtc:{},ta.compressEtc=ta.compressEtc?ta.compressEtc:{},ta.compressEtc1=ta.compressEtc1?ta.compressEtc1:{},ta.compressPvrtc=ta.compressPvrtc?ta.compressPvrtc:{},ta.compressS3tc=ta.compressS3tc?ta.compressS3tc:{},ta.compressS3tc_srgb=ta.compressS3tc_srgb?ta.compressS3tc_srgb:{},tT.deleteTexture1=tT.deleteTexture,tT.deleteTexture=function(tD){tD==tlD.curBindTexValue&&(tlD.curBindTexValue=null),tT.deleteTexture1(tD)},ta.onStageResize(tY,tg),null==ta.mainContext)throw new Error("webGL getContext err!");ti.__init__(),tV.__init__(),tXD.__init__(),tsD.__init__(),t_D.__init__(),tAD.__init__(),tu.__init__(),tQD.__int__(tT),tf._init_(tT),tx.isConchApp&&conch.setOnInvalidGLRes(ta.onInvalidGLRes)},ta.mainCanvas=null,ta.antialias=!0,ta.shaderHighPrecision=!1,ta._bg_null=[0,0,0,0],ta}(),tlD=function(){function tT(){}return tC(tT,"laya.webgl.WebGLContext"),tT.UseProgram=function(tD){return tT._useProgram!==tD&&(tpD.mainContext.useProgram(tD),tT._useProgram=tD,!0)},tT.setDepthTest=function(tD,tY){tY!==tT._depthTest&&((tT._depthTest=tY)?tD.enable(2929):tD.disable(2929))},tT.setDepthMask=function(tD,tY){tY!==tT._depthMask&&(tT._depthMask=tY,tD.depthMask(tY))},tT.setDepthFunc=function(tD,tY){tY!==tT._depthFunc&&(tT._depthFunc=tY,tD.depthFunc(tY))},tT.setBlend=function(tD,tY){tY!==tT._blend&&((tT._blend=tY)?tD.enable(3042):tD.disable(3042))},tT.setBlendFunc=function(tD,tY,tg){(tY!==tT._sFactor||tg!==tT._dFactor)&&(tT._sFactor=tY,tT._dFactor=tg,tD.blendFunc(tY,tg))},tT.setCullFace=function(tD,tY){tY!==tT._cullFace&&((tT._cullFace=tY)?tD.enable(2884):tD.disable(2884))},tT.setFrontFace=function(tD,tY){tY!==tT._frontFace&&(tT._frontFace=tY,tD.frontFace(tY))},tT.bindTexture=function(tD,tY,tg){tD.bindTexture(tY,tg),tT.curBindTexTarget=tY,tT.curBindTexValue=tg},tT.DEPTH_BUFFER_BIT=256,tT.STENCIL_BUFFER_BIT=1024,tT.COLOR_BUFFER_BIT=16384,tT.POINTS=0,tT.LINES=1,tT.LINE_LOOP=2,tT.LINE_STRIP=3,tT.TRIANGLES=4,tT.TRIANGLE_STRIP=5,tT.TRIANGLE_FAN=6,tT.ZERO=0,tT.ONE=1,tT.SRC_COLOR=768,tT.ONE_MINUS_SRC_COLOR=769,tT.SRC_ALPHA=770,tT.ONE_MINUS_SRC_ALPHA=771,tT.DST_ALPHA=772,tT.ONE_MINUS_DST_ALPHA=773,tT.DST_COLOR=774,tT.ONE_MINUS_DST_COLOR=775,tT.SRC_ALPHA_SATURATE=776,tT.FUNC_ADD=32774,tT.BLEND_EQUATION=32777,tT.BLEND_EQUATION_RGB=32777,tT.BLEND_EQUATION_ALPHA=34877,tT.FUNC_SUBTRACT=32778,tT.FUNC_REVERSE_SUBTRACT=32779,tT.BLEND_DST_RGB=32968,tT.BLEND_SRC_RGB=32969,tT.BLEND_DST_ALPHA=32970,tT.BLEND_SRC_ALPHA=32971,tT.CONSTANT_COLOR=32769,tT.ONE_MINUS_CONSTANT_COLOR=32770,tT.CONSTANT_ALPHA=32771,tT.ONE_MINUS_CONSTANT_ALPHA=32772,tT.BLEND_COLOR=32773,tT.ARRAY_BUFFER=34962,tT.ELEMENT_ARRAY_BUFFER=34963,tT.ARRAY_BUFFER_BINDING=34964,tT.ELEMENT_ARRAY_BUFFER_BINDING=34965,tT.STREAM_DRAW=35040,tT.STATIC_DRAW=35044,tT.DYNAMIC_DRAW=35048,tT.BUFFER_SIZE=34660,tT.BUFFER_USAGE=34661,tT.CURRENT_VERTEX_ATTRIB=34342,tT.FRONT=1028,tT.BACK=1029,tT.CULL_FACE=2884,tT.FRONT_AND_BACK=1032,tT.BLEND=3042,tT.DITHER=3024,tT.STENCIL_TEST=2960,tT.DEPTH_TEST=2929,tT.SCISSOR_TEST=3089,tT.POLYGON_OFFSET_FILL=32823,tT.SAMPLE_ALPHA_TO_COVERAGE=32926,tT.SAMPLE_COVERAGE=32928,tT.NO_ERROR=0,tT.INVALID_ENUM=1280,tT.INVALID_VALUE=1281,tT.INVALID_OPERATION=1282,tT.OUT_OF_MEMORY=1285,tT.CW=2304,tT.CCW=2305,tT.LINE_WIDTH=2849,tT.ALIASED_POINT_SIZE_RANGE=33901,tT.ALIASED_LINE_WIDTH_RANGE=33902,tT.CULL_FACE_MODE=2885,tT.FRONT_FACE=2886,tT.DEPTH_RANGE=2928,tT.DEPTH_WRITEMASK=2930,tT.DEPTH_CLEAR_VALUE=2931,tT.DEPTH_FUNC=2932,tT.STENCIL_CLEAR_VALUE=2961,tT.STENCIL_FUNC=2962,tT.STENCIL_FAIL=2964,tT.STENCIL_PASS_DEPTH_FAIL=2965,tT.STENCIL_PASS_DEPTH_PASS=2966,tT.STENCIL_REF=2967,tT.STENCIL_VALUE_MASK=2963,tT.STENCIL_WRITEMASK=2968,tT.STENCIL_BACK_FUNC=34816,tT.STENCIL_BACK_FAIL=34817,tT.STENCIL_BACK_PASS_DEPTH_FAIL=34818,tT.STENCIL_BACK_PASS_DEPTH_PASS=34819,tT.STENCIL_BACK_REF=36003,tT.STENCIL_BACK_VALUE_MASK=36004,tT.STENCIL_BACK_WRITEMASK=36005,tT.VIEWPORT=2978,tT.SCISSOR_BOX=3088,tT.COLOR_CLEAR_VALUE=3106,tT.COLOR_WRITEMASK=3107,tT.UNPACK_ALIGNMENT=3317,tT.PACK_ALIGNMENT=3333,tT.MAX_TEXTURE_SIZE=3379,tT.MAX_VIEWPORT_DIMS=3386,tT.SUBPIXEL_BITS=3408,tT.RED_BITS=3410,tT.GREEN_BITS=3411,tT.BLUE_BITS=3412,tT.ALPHA_BITS=3413,tT.DEPTH_BITS=3414,tT.STENCIL_BITS=3415,tT.POLYGON_OFFSET_UNITS=10752,tT.POLYGON_OFFSET_FACTOR=32824,tT.TEXTURE_BINDING_2D=32873,tT.SAMPLE_BUFFERS=32936,tT.SAMPLES=32937,tT.SAMPLE_COVERAGE_VALUE=32938,tT.SAMPLE_COVERAGE_INVERT=32939,tT.NUM_COMPRESSED_TEXTURE_FORMATS=34466,tT.COMPRESSED_TEXTURE_FORMATS=34467,tT.DONT_CARE=4352,tT.FASTEST=4353,tT.NICEST=4354,tT.GENERATE_MIPMAP_HINT=33170,tT.BYTE=5120,tT.UNSIGNED_BYTE=5121,tT.SHORT=5122,tT.UNSIGNED_SHORT=5123,tT.INT=5124,tT.UNSIGNED_INT=5125,tT.FLOAT=5126,tT.DEPTH_COMPONENT=6402,tT.ALPHA=6406,tT.RGB=6407,tT.RGBA=6408,tT.LUMINANCE=6409,tT.LUMINANCE_ALPHA=6410,tT.UNSIGNED_SHORT_4_4_4_4=32819,tT.UNSIGNED_SHORT_5_5_5_1=32820,tT.UNSIGNED_SHORT_5_6_5=33635,tT.FRAGMENT_SHADER=35632,tT.VERTEX_SHADER=35633,tT.MAX_VERTEX_ATTRIBS=34921,tT.MAX_VERTEX_UNIFORM_VECTORS=36347,tT.MAX_VARYING_VECTORS=36348,tT.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,tT.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,tT.MAX_TEXTURE_IMAGE_UNITS=34930,tT.MAX_FRAGMENT_UNIFORM_VECTORS=36349,tT.SHADER_TYPE=35663,tT.DELETE_STATUS=35712,tT.LINK_STATUS=35714,tT.VALIDATE_STATUS=35715,tT.ATTACHED_SHADERS=35717,tT.ACTIVE_UNIFORMS=35718,tT.ACTIVE_ATTRIBUTES=35721,tT.SHADING_LANGUAGE_VERSION=35724,tT.CURRENT_PROGRAM=35725,tT.NEVER=512,tT.LESS=513,tT.EQUAL=514,tT.LEQUAL=515,tT.GREATER=516,tT.NOTEQUAL=517,tT.GEQUAL=518,tT.ALWAYS=519,tT.KEEP=7680,tT.REPLACE=7681,tT.INCR=7682,tT.DECR=7683,tT.INVERT=5386,tT.INCR_WRAP=34055,tT.DECR_WRAP=34056,tT.VENDOR=7936,tT.RENDERER=7937,tT.VERSION=7938,tT.NEAREST=9728,tT.LINEAR=9729,tT.NEAREST_MIPMAP_NEAREST=9984,tT.LINEAR_MIPMAP_NEAREST=9985,tT.NEAREST_MIPMAP_LINEAR=9986,tT.LINEAR_MIPMAP_LINEAR=9987,tT.TEXTURE_MAG_FILTER=10240,tT.TEXTURE_MIN_FILTER=10241,tT.TEXTURE_WRAP_S=10242,tT.TEXTURE_WRAP_T=10243,tT.TEXTURE_2D=3553,tT.TEXTURE=5890,tT.TEXTURE_CUBE_MAP=34067,tT.TEXTURE_BINDING_CUBE_MAP=34068,tT.TEXTURE_CUBE_MAP_POSITIVE_X=34069,tT.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,tT.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,tT.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,tT.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,tT.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,tT.MAX_CUBE_MAP_TEXTURE_SIZE=34076,tT.TEXTURE0=33984,tT.TEXTURE1=33985,tT.TEXTURE2=33986,tT.TEXTURE3=33987,tT.TEXTURE4=33988,tT.TEXTURE5=33989,tT.TEXTURE6=33990,tT.TEXTURE7=33991,tT.TEXTURE8=33992,tT.TEXTURE9=33993,tT.TEXTURE10=33994,tT.TEXTURE11=33995,tT.TEXTURE12=33996,tT.TEXTURE13=33997,tT.TEXTURE14=33998,tT.TEXTURE15=33999,tT.TEXTURE16=34e3,tT.TEXTURE17=34001,tT.TEXTURE18=34002,tT.TEXTURE19=34003,tT.TEXTURE20=34004,tT.TEXTURE21=34005,tT.TEXTURE22=34006,tT.TEXTURE23=34007,tT.TEXTURE24=34008,tT.TEXTURE25=34009,tT.TEXTURE26=34010,tT.TEXTURE27=34011,tT.TEXTURE28=34012,tT.TEXTURE29=34013,tT.TEXTURE30=34014,tT.TEXTURE31=34015,tT.ACTIVE_TEXTURE=34016,tT.REPEAT=10497,tT.CLAMP_TO_EDGE=33071,tT.MIRRORED_REPEAT=33648,tT.FLOAT_VEC2=35664,tT.FLOAT_VEC3=35665,tT.FLOAT_VEC4=35666,tT.INT_VEC2=35667,tT.INT_VEC3=35668,tT.INT_VEC4=35669,tT.BOOL=35670,tT.BOOL_VEC2=35671,tT.BOOL_VEC3=35672,tT.BOOL_VEC4=35673,tT.FLOAT_MAT2=35674,tT.FLOAT_MAT3=35675,tT.FLOAT_MAT4=35676,tT.SAMPLER_2D=35678,tT.SAMPLER_CUBE=35680,tT.VERTEX_ATTRIB_ARRAY_ENABLED=34338,tT.VERTEX_ATTRIB_ARRAY_SIZE=34339,tT.VERTEX_ATTRIB_ARRAY_STRIDE=34340,tT.VERTEX_ATTRIB_ARRAY_TYPE=34341,tT.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,tT.VERTEX_ATTRIB_ARRAY_POINTER=34373,tT.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,tT.COMPILE_STATUS=35713,tT.LOW_FLOAT=36336,tT.MEDIUM_FLOAT=36337,tT.HIGH_FLOAT=36338,tT.LOW_INT=36339,tT.MEDIUM_INT=36340,tT.HIGH_INT=36341,tT.FRAMEBUFFER=36160,tT.RENDERBUFFER=36161,tT.RGBA4=32854,tT.RGB5_A1=32855,tT.RGB565=36194,tT.DEPTH_COMPONENT16=33189,tT.STENCIL_INDEX=6401,tT.STENCIL_INDEX8=36168,tT.DEPTH_STENCIL=34041,tT.RENDERBUFFER_WIDTH=36162,tT.RENDERBUFFER_HEIGHT=36163,tT.RENDERBUFFER_INTERNAL_FORMAT=36164,tT.RENDERBUFFER_RED_SIZE=36176,tT.RENDERBUFFER_GREEN_SIZE=36177,tT.RENDERBUFFER_BLUE_SIZE=36178,tT.RENDERBUFFER_ALPHA_SIZE=36179,tT.RENDERBUFFER_DEPTH_SIZE=36180,tT.RENDERBUFFER_STENCIL_SIZE=36181,tT.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,tT.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,tT.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,tT.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,tT.COLOR_ATTACHMENT0=36064,tT.DEPTH_ATTACHMENT=36096,tT.STENCIL_ATTACHMENT=36128,tT.DEPTH_STENCIL_ATTACHMENT=33306,tT.NONE=0,tT.FRAMEBUFFER_COMPLETE=36053,tT.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,tT.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,tT.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,tT.FRAMEBUFFER_UNSUPPORTED=36061,tT.FRAMEBUFFER_BINDING=36006,tT.RENDERBUFFER_BINDING=36007,tT.MAX_RENDERBUFFER_SIZE=34024,tT.INVALID_FRAMEBUFFER_OPERATION=1286,tT.UNPACK_FLIP_Y_WEBGL=37440,tT.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,tT.CONTEXT_LOST_WEBGL=37442,tT.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,tT.BROWSER_DEFAULT_WEBGL=37444,tT._useProgram=null,tT._depthTest=!0,tT._depthMask=!0,tT._blend=!1,tT._cullFace=!1,tT.curBindTexTarget=null,tT.curBindTexValue=null,ta(tT,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),tT}(),ttD=function(tD){function tY(){tY.__super.call(this)}tC(tY,"laya.webgl.display.GraphicsGL",tE);var tg=tY.prototype;return tg.setShader=function(tD){this._saveToCmd(tx.context._setShader,[tD])},tg.setIBVB=function(tD,tY,tg,tT,tr,ts){this._saveToCmd(tx.context._setIBVB,[tD,tY,tg,tT,tr,ts])},tg.drawParticle=function(tD,tY,tg){var tT=tl.createParticleTemplate2D(tg);tT.x=tD,tT.y=tY,this._saveToCmd(tx.context._drawParticle,[tT])},tY}(),t_D=function(tD){var tg;function tF(tD){this._x=0,this._y=0,this._id=++tF._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,tF.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=tF.MAXCLIPRECT,this.mOutPoint,this._canvas=tD,this._canvas._addReference(),tF._contextcount++,tx.isFlash?(this._ib=tuD.create(35044),tJD.fillIBQuadrangle(this._ib,16)):this._ib=tuD.QuadrangleIB,this.clear()}tC(tF,"laya.webgl.canvas.WebGLContext2D",tr);var tY=tF.prototype;return tY.setIsMainContext=function(){this._isMain=!0},tY.clearBG=function(tD,tY,tg,tT){var tr=tpD.mainContext;tr.clearColor(tD,tY,tg,tT),tr.clear(16384)},tY._getSubmits=function(){return this._submits},tY._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var tD=0,tY=this._submits._length;tD<tY;tD++)this._submits[tD].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},tY.destroy=function(){--tF._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=tuD.QuadrangleIB&&this._ib.releaseResource()},tY.clear=function(){this._submits||(this._other=tg.DEFAULT,this._curMat=tq.create(),this._vb=tnD.create(-1),this._submits=[],this._save=[tR.Create(this)],this._save.length=10,this._shader2D=new tu,this._triangleMesh=tBD.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=tg.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=tF.MAXCLIPRECT,this._curSubmit=tsD.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=te.DEFAULT;for(var tD=0,tY=this._submits._length;tD<tY;tD++)this._submits[tD].releaseRender(),this._submits[tD]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},tY.size=function(tD,tY){if(this._width!=tD||this._height!=tY)if(0==tD||0==tY){0!=this._vb._byteLength&&(this._width=tD,this._height=tY,this._vb.clear(),this._vb.upload());for(var tg=0,tT=this._submits._length;tg<tT;tg++)this._submits[tg].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=tD,this._height=tY,this._targets&&this._targets.size(tD,tY),this._canvas.memorySize-=this._canvas.memorySize;0===tD&&0===tY&&this._releaseMem()},tY._getTransformMatrix=function(){return this._curMat},tY.translate=function(tD,tY){0===tD&&0===tY||(tL.save(this),this._curMat.bTransform&&(tQ.save(this),this._curMat.transformPointN(tb.TEMP.setTo(tD,tY)),tD=tb.TEMP.x,tY=tb.TEMP.y),this._x+=tD,this._y+=tY)},tY.save=function(){this._save[this._save._length++]=tR.Create(this)},tY.restore=function(){var tD=this._save._length;if(!(tD<1))for(var tY=tD-1;0<=tY;tY--){var tg=this._save[tY];if(tg.restore(this),tg.isSaveMark())return void(this._save._length=tY)}},tY._fillText=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){void 0===tE&&(tE=0);var tI=this._shader2D,tO=this._curSubmit.shaderValue,tC=tr?t$D.create(tr):this._other.font;if(tV.enabled)tI.ALPHA!==tO.ALPHA&&(tI.glTexture=null),tND.drawText(this,tD,tY,this._curMat,tC,tM||this._other.textAlign,ts,ta,tW,tg,tT,tE);else{this._shader2D.defines.getValue();var tN=ts?t$.create(ts)._color:tI.colorAdd;tI.ALPHA===tO.ALPHA&&tN===tI.colorAdd&&tO.colorAdd===tI.colorAdd||(tI.glTexture=null,tI.colorAdd=tN),tND.drawText(this,tD,tY,this._curMat,tC,tM||this._other.textAlign,ts,ta,tW,tg,tT,tE)}},tY.fillWords=function(tD,tY,tg,tT,tr,ts){this._fillText(null,tD,tY,tg,tT,tr,null,-1,null,ts)},tY.fillBorderWords=function(tD,tY,tg,tT,tr,ts,ta){this._fillBorderText(null,tD,tY,tg,tT,tr,ts,ta,null)},tY.fillText=function(tD,tY,tg,tT,tr,ts){this._fillText(tD,null,tY,tg,tT,tr,null,-1,ts)},tY.strokeText=function(tD,tY,tg,tT,tr,ts,ta){this._fillText(tD,null,tY,tg,tT,null,tr,ts||1,ta)},tY.fillBorderText=function(tD,tY,tg,tT,tr,ts,ta,tW){this._fillBorderText(tD,null,tY,tg,tT,tr,ts,ta,tW)},tY._fillBorderText=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){if(!tV.enabled)return this._fillText(tD,tY,tg,tT,tr,null,ta,tW||1,tM),void this._fillText(tD,tY,tg,tT,tr,ts,null,-1,tM);var tE=this._shader2D,tI=this._curSubmit.shaderValue;tE.ALPHA!==tI.ALPHA&&(tE.glTexture=null);var tO=tr?(tF._fontTemp.setFont(tr),tF._fontTemp):this._other.font;tND.drawText(this,tD,tY,this._curMat,tO,tM||this._other.textAlign,ts,ta,tW||1,tg,tT,0)},tY.fillRect=function(tD,tY,tg,tT,tr){var ts=this._vb;if(tJD.fillRectImgVb(ts,this._clipRect,tD,tY,tg,tT,tB.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var ta=this._shader2D.fillStyle;tr&&(this._shader2D.fillStyle=te.create(tr));var tW=this._shader2D,tM=this._curSubmit.shaderValue;if(tW.fillStyle!==tM.fillStyle||tW.ALPHA!==tM.ALPHA){tW.glTexture=null;var tE=this._curSubmit=tsD.createSubmit(this,this._ib,ts,(ts._byteLength-64)/32*3,tAD.create(2,0));tE.shaderValue.color=tW.fillStyle._color._color,tE.shaderValue.ALPHA=tW.ALPHA,this._submits[this._submits._length++]=tE}this._curSubmit._numEle+=6,this._shader2D.fillStyle=ta}},tY.fillTexture=function(tD,tY,tg,tT,tr,ts,ta,tW){if(tD.loaded&&tD.bitmap&&tD.source){var tM=this._vb,tE=tD.bitmap.width,tI=tD.bitmap.height,tO=tD.uv,tC=ta.x%tD.width,tN=ta.y%tD.height;if(tE!=tW.w||tI!=tW.h){if(!tW.w&&!tW.h)switch(tW.oy=tW.ox=0,ts){case"repeat":tW.width=tT,tW.height=tr;break;case"repeat-x":tW.width=tT,tN<0?tD.height+tN>tr?tW.height=tr:tW.height=tD.height+tN:(tW.oy=tN,tD.height+tN>tr?tW.height=tr-tN:tW.height=tD.height);break;case"repeat-y":tC<0?tD.width+tC>tT?tW.width=tT:tW.width=tD.width+tC:(tW.ox=tC,tD.width+tC>tT?tW.width=tT-tC:tW.width=tD.width),tW.height=tr;break;case"no-repeat":tC<0?tD.width+tC>tT?tW.width=tT:tW.width=tD.width+tC:(tW.ox=tC,tD.width+tC>tT?tW.width=tT-tC:tW.width=tD.width),tN<0?tD.height+tN>tr?tW.height=tr:tW.height=tD.height+tN:(tW.oy=tN,tD.height+tN>tr?tW.height=tr-tN:tW.height=tD.height);break;default:tW.width=tT,tW.height=tr}tW.w=tE,tW.h=tI,tW.uv=[0,0,tW.width/tE,0,tW.width/tE,tW.height/tI,0,tW.height/tI]}if(tY+=tW.ox,tg+=tW.oy,tC-=tW.ox,tN-=tW.oy,tJD.fillRectImgVb(tM,this._clipRect,tY,tg,tW.width,tW.height,tW.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var t$=tPD.create(this,this._ib,tM,(tM._byteLength-64)/32*3,tAD.create(256,0)),td=(this._submits[this._submits._length++]=t$).shaderValue;td.textureHost=tD;var tJ=tO[0]*tE,tx=tO[1]*tI,tj=(tO[2]-tO[0])*tE,tZ=(tO[5]-tO[3])*tI,tp=-tC/tE,tl=-tN/tI;td.u_TexRange[0]=tJ/tE,td.u_TexRange[1]=tj/tE,td.u_TexRange[2]=tx/tI,td.u_TexRange[3]=tZ/tI,td.u_offset[0]=tp,td.u_offset[1]=tl,tV.enabled&&!this._isMain&&t$.addTexture(tD,(tM._byteLength>>2)-16),(this._curSubmit=t$)._renderType=10017,t$._numEle+=6}}else this.sprite&&tt.timer.callLater(this,this._repaintSprite)},tY.setShader=function(tD){tw.save(this,1048576,this._shader2D,!0),this._shader2D.shader=tD},tY.setFilters=function(tD){tw.save(this,2097152,this._shader2D,!0),this._shader2D.filters=tD,this._curSubmit=tsD.RENDERBASE,this._renderKey=0,this._drawCount++},tY.drawTexture=function(tD,tY,tg,tT,tr,ts,ta){this._drawTextureM(tD,tY,tg,tT,tr,ts,ta,null,1)},tY.addTextureVb=function(tD,tY,tg){var tT=this._curSubmit._vb||this._vb,tr=tT._byteLength>>2;tT.byteLength=tr+16<<2;for(var ts=tT.getFloat32Array(),ta=0;ta<16;ta+=4)ts[tr++]=tD[ta]+tY,ts[tr++]=tD[ta+1]+tg,ts[tr++]=tD[ta+2],ts[tr++]=tD[ta+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),tT._upload=!0},tY.willDrawTexture=function(tD,tY){if(!(tD.loaded&&tD.bitmap&&tD.source))return this.sprite&&tt.timer.callLater(this,this._repaintSprite),0;var tg=tD.bitmap,tT=tg.id+this._shader2D.ALPHA*tY+10016;if(tT==this._renderKey)return tT;var tr=this._shader2D,ts=tr.ALPHA,ta=this._curSubmit.shaderValue;tr.ALPHA*=tY,this._renderKey=tT,this._drawCount++,tr.glTexture=tg;var tW=this._vb,tM=null,tE=tW._byteLength/32*3,tI=ta.textureHost&&ta.textureHost==tD&&ta.textureHost.alphaTexture==tD.alphaTexture;return tM=tPD.create(this,this._ib,tW,tE,tAD.create(1,0)),(this._submits[this._submits._length++]=tM).shaderValue.textureHost=tD,tM._renderType=10016,tM._preIsSameTextureShader=10016===this._curSubmit._renderType&&tr.ALPHA===ta.ALPHA&&tI,this._curSubmit=tM,tr.ALPHA=ts,tT},tY.drawTextures=function(tD,tY,tg,tT){if(tD.loaded&&tD.bitmap&&tD.source){var tr=this._clipRect;if(this._clipRect=tF.MAXCLIPRECT,this._drawTextureM(tD,tY[0],tY[1],tD.width,tD.height,tg,tT,null,1)){if(this._clipRect=tr,tm.drawCall++,!(tY.length<4)){for(var ts=this._curSubmit._vb||this._vb,ta=this._curMat.a,tW=this._curMat.d,tM=2,tE=tY.length;tM<tE;tM+=2)tJD.copyPreImgVb(ts,(tY[tM]-tY[tM-2])*ta,(tY[tM+1]-tY[tM-1])*tW),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&tt.timer.callLater(this,this._repaintSprite)},tY._drawTextureM=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){if(!tD.loaded||!tD.source)return this.sprite&&tt.timer.callLater(this,this._repaintSprite),!1;var tE=this._curSubmit._vb||this._vb,tI=tD.bitmap;tY+=ts,tg+=ta,this._drawCount++;var tO=tI.id+this._shader2D.ALPHA*tM+10016;if(tO!=this._renderKey){this._renderKey=tO;var tC=this._curSubmit.shaderValue,tN=this._shader2D,t$=tN.ALPHA;tN.ALPHA*=tM,tN.glTexture=tI;var td=this._vb,tJ=null,tx=td._byteLength/32*3,tj=tC.textureHost&&tC.textureHost==tD&&tC.textureHost.alphaTexture==tD.alphaTexture;tJ=tPD.create(this,this._ib,td,tx,tAD.create(1,0)),(this._submits[this._submits._length++]=tJ).shaderValue.textureHost=tD,tJ._renderType=10016,tJ._preIsSameTextureShader=10016===this._curSubmit._renderType&&tN.ALPHA===tC.ALPHA&&tj,this._curSubmit=tJ,tE=this._curSubmit._vb||this._vb,tN.ALPHA=t$}return!!tJD.fillRectImgVb(tE,this._clipRect,tY,tg,tT||tD.width,tr||tD.height,tD.uv,tW||this._curMat,this._x,this._y,0,0)&&(tV.enabled&&!this._isMain&&this._curSubmit.addTexture(tD,(tE._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},tY._repaintSprite=function(){this.sprite&&this.sprite.repaint()},tY._drawText=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){var tI=tD.bitmap;this._drawCount++;var tO=tI.id+this._shader2D.ALPHA+10016;if(tO!=this._renderKey){this._renderKey=tO;var tC=this._curSubmit.shaderValue,tN=this._shader2D;tN.glTexture=tI;var t$=this._vb,td=null,tJ=t$._byteLength/32*3,tx=tC.textureHost&&tC.textureHost==tD&&tC.textureHost.alphaTexture==tD.alphaTexture;(td=tV.enabled?tPD.create(this,this._ib,t$,tJ,tAD.create(1,0)):tPD.create(this,this._ib,t$,tJ,tLD.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&tN.ALPHA===tC.ALPHA&&tx,(this._submits[this._submits._length++]=td).shaderValue.textureHost=tD,td._renderType=10016,this._curSubmit=td}tD.active();var tj=this._curSubmit._vb||this._vb;tJD.fillRectImgVb(tj,this._clipRect,tY+ta,tg+tW,tT||tD.width,tr||tD.height,tD.uv,ts||this._curMat,this._x,this._y,tM,tE,!0)&&(tV.enabled&&!this._isMain&&this._curSubmit.addTexture(tD,(tj._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},tY.drawTextureWithTransform=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){if(ts){var tE=this._curMat,tI=this._x,tO=this._y;(0!==ta||0!==tW)&&(this._x=ta*tE.a+tW*tE.c,this._y=tW*tE.d+ta*tE.b),ts&&tE.bTransform?(tq.mul(ts,tE,tF._tmpMatrix),(ts=tF._tmpMatrix)._checkTransform()):(this._x+=tE.tx,this._y+=tE.ty),this._drawTextureM(tD,tY,tg,tT,tr,0,0,ts,tM),this._x=tI,this._y=tO}else this._drawTextureM(tD,tY,tg,tT,tr,ta,tW,null,tM)},tY.fillQuadrangle=function(tD,tY,tg,tT,tr){var ts=this._curSubmit,ta=this._vb,tW=this._shader2D,tM=ts.shaderValue;if(this._renderKey=0,tD.bitmap){var tE=tD.bitmap;tW.glTexture==tE&&tW.ALPHA===tM.ALPHA||(tW.glTexture=tE,(ts=this._curSubmit=tsD.createSubmit(this,this._ib,ta,ta._byteLength/32*3,tAD.create(1,0))).shaderValue.glTexture=tE,this._submits[this._submits._length++]=ts),tJD.fillQuadrangleImgVb(ta,tY,tg,tT,tD.uv,tr||this._curMat,this._x,this._y)}else ts.shaderValue.fillStyle&&ts.shaderValue.fillStyle.equal(tD)&&tW.ALPHA===tM.ALPHA||(tW.glTexture=null,(ts=this._curSubmit=tsD.createSubmit(this,this._ib,ta,ta._byteLength/32*3,tAD.create(2,0))).shaderValue.defines.add(2),ts.shaderValue.fillStyle=te.create(tD),this._submits[this._submits._length++]=ts),tJD.fillQuadrangleImgVb(ta,tY,tg,tT,tB.DEF_UV,tr||this._curMat,this._x,this._y);ts._numEle+=6},tY.drawTexture2=function(tD,tY,tg,tT,tr,ts,ta,tW){if(0!=ts){var tM=this._curMat;if(this._x=tD*tM.a+tY*tM.c,this._y=tY*tM.d+tD*tM.b,tr&&(tr=tM.bTransform||tr.bTransform?(tq.mul(tr,tM,tF._tmpMatrix),tF._tmpMatrix):(this._x+=tr.tx+tM.tx,this._y+=tr.ty+tM.ty,tq.EMPTY)),1!==ts||ta){var tE=this._shader2D.ALPHA,tI=this._nBlendType;this._shader2D.ALPHA=ts,ta&&(this._nBlendType=tf.TOINT(ta)),this._drawTextureM(tW[0],tW[1]-tg,tW[2]-tT,tW[3],tW[4],0,0,tr,1),this._shader2D.ALPHA=tE,this._nBlendType=tI}else this._drawTextureM(tW[0],tW[1]-tg,tW[2]-tT,tW[3],tW[4],0,0,tr,1);this._x=this._y=0}},tY.drawCanvas=function(tD,tY,tg,tT,tr){var ts=tD.context;if(this._renderKey=0,ts._targets)this._submits[this._submits._length++]=tiD.create(ts,0,null),this._curSubmit=tsD.RENDERBASE,ts._targets.drawTo(this,tY,tg,tT,tr);else{var ta=this._submits[this._submits._length++]=tiD.create(ts,this._shader2D.ALPHA,this._shader2D.filters),tW=tT/tD.width,tM=tr/tD.height,tE=ta._matrix;this._curMat.copyTo(tE),1!=tW&&1!=tM&&tE.scale(tW,tM);var tI=tE.tx,tO=tE.ty;tE.tx=tE.ty=0,tE.transformPoint(tb.TEMP.setTo(tY,tg)),tE.translate(tb.TEMP.x+tI,tb.TEMP.y+tO),this._curSubmit=tsD.RENDERBASE}t_.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=ts._targets?"yellow":"green",this.strokeRect(tY-1,tg-1,tT+2,tr+2,1),this.strokeRect(tY,tg,tT,tr,1),this.restore())},tY.drawTarget=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){void 0===tE&&(tE=-1);var tI=this._vb;if(tJD.fillRectImgVb(tI,this._clipRect,tY,tg,tT,tr,tM||tB.DEF_UV,ts||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var tO=this._curSubmit=tOD.create(this,this._ib,tI,(tI._byteLength-64)/32*3,tW,ta);tO.blendType=-1==tE?this._nBlendType:tE,tO.scope=tD,this._submits[this._submits._length++]=tO,this._curSubmit._numEle+=6}},tY.mixRGBandAlpha=function(tD){return this._mixRGBandAlpha(tD,this._shader2D.ALPHA)},tY._mixRGBandAlpha=function(tD,tY){var tg=(4278190080&tD)>>>24;return 0!=tg?tg*=tY:tg=255*tY,16777215&tD|tg<<24},tY.drawTriangles=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){if(!tD.loaded||!tD.source)return this.sprite&&tt.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;tD.bitmap;var tI=this._mixRGBandAlpha(4294967295,tW),tO=(tT.length,ts.length);this._renderKey=-1;var tC=this._curSubmit=tPD.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,tAD.create(1,0));return tC.shaderValue.textureHost=tD,tC._renderType=10016,this._submits[this._submits._length++]=tC,ta?(tF._tmpMatrix.a=ta.a,tF._tmpMatrix.b=ta.b,tF._tmpMatrix.c=ta.c,tF._tmpMatrix.d=ta.d,tF._tmpMatrix.tx=ta.tx+tY,tF._tmpMatrix.ty=ta.ty+tg,tq.mul(tF._tmpMatrix,this._curMat,tF._tmpMatrix)):(tF._tmpMatrix.a=this._curMat.a,tF._tmpMatrix.b=this._curMat.b,tF._tmpMatrix.c=this._curMat.c,tF._tmpMatrix.d=this._curMat.d,tF._tmpMatrix.tx=this._curMat.tx+tY,tF._tmpMatrix.ty=this._curMat.ty+tg),this._triangleMesh.addData(tT,tr,ts,tF._tmpMatrix,tI,this),this._curSubmit._numEle+=tO,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},tY.transform=function(tD,tY,tg,tT,tr,ts){tQ.save(this),tq.mul(tq.TEMP.setTo(tD,tY,tg,tT,tr,ts),this._curMat,this._curMat),this._curMat._checkTransform()},tY.setTransformByMatrix=function(tD){tD.copyTo(this._curMat)},tY.transformByMatrix=function(tD){tQ.save(this),tq.mul(tD,this._curMat,this._curMat),this._curMat._checkTransform()},tY.rotate=function(tD){tQ.save(this),this._curMat.rotateEx(tD)},tY.scale=function(tD,tY){tQ.save(this),this._curMat.scaleEx(tD,tY)},tY.clipRect=function(tD,tY,tg,tT){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var tr=tID.create(4);this.addRenderObject(tr);var ts=this._vb,ta=ts._byteLength>>2;if(tJD.fillRectImgVb(ts,null,tD,tY,tg,tT,tB.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var tW=this._curSubmit=tsD.createSubmit(this,this._ib,ts,(ts._byteLength-64)/32*3,tAD.create(2,0));tW.shaderValue.ALPHA=1,this._submits[this._submits._length++]=tW,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var tM=tID.create(5);this.addRenderObject(tM);var tE=ts.getFloat32Array(),tI=Math.min(Math.min(Math.min(tE[0+ta],tE[4+ta]),tE[8+ta]),tE[12+ta]),tO=Math.max(Math.max(Math.max(tE[0+ta],tE[4+ta]),tE[8+ta]),tE[12+ta]),tC=Math.min(Math.min(Math.min(tE[1+ta],tE[5+ta]),tE[9+ta]),tE[13+ta]),tN=Math.max(Math.max(Math.max(tE[1+ta],tE[5+ta]),tE[9+ta]),tE[13+ta]);to.save(this,tM,tD,tY,tg,tT,tI,tC,tO-tI,tN-tC),this._curSubmit=tsD.RENDERBASE}else{tg*=this._curMat.a,tT*=this._curMat.d;var t$=tb.TEMP;this._curMat.transformPoint(t$.setTo(tD,tY)),tg<0&&(t$.x=t$.x+tg,tg=-tg),tT<0&&(t$.y=t$.y+tT,tT=-tT),this._renderKey=0;var td=this._curSubmit=tED.create(this);(this._submits[this._submits._length++]=td).submitIndex=this._submits._length,td.submitLength=9999999,tK.save(this,td);var tJ=this._clipRect,tx=tJ.x,tj=tJ.y,tZ=t$.x+tg,tp=t$.y+tT;tx<t$.x&&(tJ.x=t$.x),tj<t$.y&&(tJ.y=t$.y),tJ.width=Math.min(tZ,tx+tJ.width)-tJ.x,tJ.height=Math.min(tp,tj+tJ.height)-tJ.y,this._shader2D.glTexture=null,td.clipRect.copyFrom(tJ),this._curSubmit=tsD.RENDERBASE}},tY.setIBVB=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI){if(void 0===tM&&(tM=0),void 0===tE&&(tE=0),void 0===tI&&(tI=0),null===tg){if(tx.isFlash){var tO=tT;tO._selfIB||(tO._selfIB=tuD.create(35044)),tO._selfIB.clear(),tg=tO._selfIB}else tg=this._ib;tJD.expandIBQuadrangle(tg,tT._byteLength/(4*tT.vertexStride*4))}if(!tW||!ta)throw Error("setIBVB must input:shader shaderValues");var tC=tMD.create(this,tT,tg,tr,ta,tW,tM,tE,tI);ts||(ts=tq.EMPTY),ts.translate(tD,tY),tq.mul(ts,this._curMat,tC._mat),ts.translate(-tD,-tY),this._submits[this._submits._length++]=tC,this._curSubmit=tsD.RENDERBASE,this._renderKey=0},tY.addRenderObject=function(tD){this._submits[this._submits._length++]=tD},tY.fillTrangles=function(tD,tY,tg,tT,tr){var ts=this._curSubmit,ta=this._vb,tW=this._shader2D,tM=ts.shaderValue,tE=tT.length>>4,tI=tD.bitmap;this._renderKey=0,tW.glTexture==tI&&tW.ALPHA===tM.ALPHA||((ts=this._curSubmit=tsD.createSubmit(this,this._ib,ta,ta._byteLength/32*3,tAD.create(1,0))).shaderValue.textureHost=tD,this._submits[this._submits._length++]=ts),tJD.fillTranglesVB(ta,tY,tg,tT,tr||this._curMat,this._x,this._y),ts._numEle+=6*tE},tY.submitElement=function(tD,tY){var tg=this._submits;for(tY<0&&(tY=tg._length);tD<tY;)tD+=tg[tD].renderSubmit()},tY.finish=function(){tpD.mainContext.finish()},tY.flush=function(){var tD=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(tD>this._ib.bufferLength/12&&tJD.expandIBQuadrangle(this._ib,tD),!this._isMain&&tV.enabled&&tV._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=tV._atlasRestore;for(var tY=this._submits,tg=0,tT=tY._length;tg<tT;tg++){var tr=tY[tg];10016===tr.getRenderType()&&tr.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),tYD.instance&&tYD.getInstance().reset();var ts;for(tg=0,ts=this.meshlist.length;tg<ts;tg++){var ta=this.meshlist[tg];ta.canReuse?ta.releaseMesh():ta.destroy()}return this.meshlist.length=0,this._curSubmit=tsD.RENDERBASE,this._renderKey=0,this._triangleMesh=tBD.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},tY.setPathId=function(tD){if(this.mId=tD,-1!=this.mId){this.mHaveKey=!1;var tY=tv.getInstance();tY.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,tY.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},tY.movePath=function(tD,tY){var tg=tD,tT=tY;tD=this._curMat.a*tg+this._curMat.c*tT+this._curMat.tx,tY=this._curMat.b*tg+this._curMat.d*tT+this._curMat.ty,this.mX+=tD,this.mY+=tY},tY.beginPath=function(){var tD=this._getPath();tD.tempArray.length=0,tD.closePath=!1,this.mX=0,this.mY=0},tY.closePath=function(){this._path.closePath=!0},tY.fill=function(tD){void 0===tD&&(tD=!1);var tY=this._getPath();this.drawPoly(0,0,tY.tempArray,this.fillStyle._color.numColor,0,0,tD)},tY.stroke=function(){var tD=this._getPath();if(0<this.lineWidth){if(-1==this.mId)tD.drawLine(0,0,tD.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var tY=tv.getInstance().shapeLineDic[this.mId];tY.rebuild(tD.tempArray),tD.setGeomtry(tY)}else tv.getInstance().addLine(this.mId,tD.drawLine(0,0,tD.tempArray,this.lineWidth,this.strokeStyle._color.numColor));tD.update();var tg=[this.mX,this.mY],tT=tsD.createShape(this,tD.ib,tD.vb,tD.count,tD.offset,tAD.create(4,0));tT.shaderValue.ALPHA=this._shader2D.ALPHA,tT.shaderValue.u_pos=tg,tT.shaderValue.u_mmat2=tjD.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=tT,this._renderKey=-1}},tY.line=function(tD,tY,tg,tT,tr,ts){var ta=this._curSubmit,tW=this._vb;if(tJD.fillLineVb(tW,this._clipRect,tD,tY,tg,tT,tr,ts)){this._renderKey=0;var tM=this._shader2D,tE=ta.shaderValue;tM.strokeStyle===tE.strokeStyle&&tM.ALPHA===tE.ALPHA||(tM.glTexture=null,(ta=this._curSubmit=tsD.createSubmit(this,this._ib,tW,(tW._byteLength-64)/32*3,tAD.create(2,0))).shaderValue.strokeStyle=tM.strokeStyle,ta.shaderValue.mainID=2,ta.shaderValue.ALPHA=tM.ALPHA,this._submits[this._submits._length++]=ta),ta._numEle+=6}},tY.moveTo=function(tD,tY,tg){void 0===tg&&(tg=!0);var tT=this._getPath();if(tg){var tr=tD,ts=tY;tD=this._curMat.a*tr+this._curMat.c*ts,tY=this._curMat.b*tr+this._curMat.d*ts}tT.addPoint(tD,tY)},tY.lineTo=function(tD,tY,tg){void 0===tg&&(tg=!0);var tT=this._getPath();if(tg){var tr=tD,ts=tY;tD=this._curMat.a*tr+this._curMat.c*ts,tY=this._curMat.b*tr+this._curMat.d*ts}tT.addPoint(tD,tY)},tY.drawCurves=function(tD,tY,tg){this.setPathId(-1),this.beginPath(),this.strokeStyle=tg[3],this.lineWidth=tg[4];var tT=tg[2];tD+=tg[0],tY+=tg[1],this.movePath(tD,tY),this.moveTo(tT[0],tT[1]);for(var tr=2,ts=tT.length;tr<ts;)this.quadraticCurveTo(tT[tr++],tT[tr++],tT[tr++],tT[tr++]);this.stroke()},tY.arcTo=function(tD,tY,tg,tT,tr){if(-1==this.mId||!this.mHaveKey){var ts=0,ta=0,tW=0,tM=this._getPath();this._curMat.copyTo(tF._tmpMatrix),tF._tmpMatrix.tx=tF._tmpMatrix.ty=0,tF._tempPoint.setTo(tM.getEndPointX(),tM.getEndPointY()),tF._tmpMatrix.invertTransformPoint(tF._tempPoint);var tE=tF._tempPoint.x-tD,tI=tF._tempPoint.y-tY,tO=Math.sqrt(tE*tE+tI*tI);if(!(tO<=1e-6)){var tC=tE/tO,tN=tI/tO,t$=tg-tD,td=tT-tY,tJ=t$*t$+td*td,tx=Math.sqrt(tJ);if(!(tx<=1e-6)){var tj=t$/tx,tZ=td/tx,tp=tC+tj,tl=tN+tZ,tt=Math.sqrt(tp*tp+tl*tl);if(!(tt<=1e-6)){var t_=tp/tt,tA=tl/tt,tq=Math.acos(t_*tC+tA*tN),tb=Math.PI/2-tq,tG=(tO=tr/Math.tan(tb))*tC+tD,tX=tO*tN+tY,tz=Math.sqrt(tO*tO+tr*tr),tm=tD+t_*tz,th=tY+tA*tz,ti=0,tP=0;if(0<=tC*tZ-tN*tj){var tB=2*tb/tF.SEGNUM;ti=Math.sin(tB),tP=Math.cos(tB)}else tB=2*-tb/tF.SEGNUM,ti=Math.sin(tB),tP=Math.cos(tB);ta=this._curMat.a*tG+this._curMat.c*tX,tW=this._curMat.b*tG+this._curMat.d*tX,ta==this._path.getEndPointX()&&tW==this._path.getEndPointY()||tM.addPoint(ta,tW);var tH=tG-tm,tv=tX-th;for(ts=0;ts<tF.SEGNUM;ts++){var tS=tH*tP+tv*ti,tU=-tH*ti+tv*tP;ta=tS+tm,tW=tU+th,tD=this._curMat.a*ta+this._curMat.c*tW,tW=tY=this._curMat.b*ta+this._curMat.d*tW,(ta=tD)==this._path.getEndPointX()&&tW==this._path.getEndPointY()||tM.addPoint(ta,tW),tH=tS,tv=tU}}}}}},tY.arc=function(tD,tY,tg,tT,tr,ts,ta){if(void 0===ts&&(ts=!1),void 0===ta&&(ta=!0),-1!=this.mId){var tW=tv.getInstance().shapeDic[this.mId];if(tW&&this.mHaveKey&&!tW.needUpdate(this._curMat))return;tY=tD=0}var tM,tE=0,tI=0,tO=0,tC=0,tN=0,t$=0,td=0;if(tI=tr-tT,ts)if(Math.abs(tI)>=2*Math.PI)tI=2*-Math.PI;else for(;0<tI;)tI-=2*Math.PI;else if(Math.abs(tI)>=2*Math.PI)tI=2*Math.PI;else for(;tI<0;)tI+=2*Math.PI;tM=tI/(td=tg<101?Math.max(10,tI*tg/5):tg<201?Math.max(10,tI*tg/20):Math.max(10,tI*tg/40))/2,tO=Math.abs(4/3*(1-Math.cos(tM))/Math.sin(tM)),ts&&(tO=-tO);var tJ=this._getPath(),tx=NaN,tj=NaN;for(t$=0;t$<=td;t$++)tE=tT+tI*(t$/td),tC=tD+Math.cos(tE)*tg,tN=tY+Math.sin(tE)*tg,ta&&(tx=tC,tj=tN,tC=this._curMat.a*tx+this._curMat.c*tj,tN=this._curMat.b*tx+this._curMat.d*tj),tC==this._path.getEndPointX()&&tN==this._path.getEndPointY()||tJ.addPoint(tC,tN);tC=tD+Math.cos(tr)*tg,tN=tY+Math.sin(tr)*tg,ta&&(tx=tC,tj=tN,tC=this._curMat.a*tx+this._curMat.c*tj,tN=this._curMat.b*tx+this._curMat.d*tj),tC==this._path.getEndPointX()&&tN==this._path.getEndPointY()||tJ.addPoint(tC,tN)},tY.quadraticCurveTo=function(tD,tY,tg,tT){var tr=tO.I,ts=tg,ta=tT;tg=this._curMat.a*ts+this._curMat.c*ta,tT=this._curMat.b*ts+this._curMat.d*ta,ts=tD,ta=tY,tD=this._curMat.a*ts+this._curMat.c*ta,tY=this._curMat.b*ts+this._curMat.d*ta;for(var tW=tr.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),tD,tY,tg,tT],30,2),tM=0,tE=tW.length/2;tM<tE;tM++)this.lineTo(tW[2*tM],tW[2*tM+1],!1);this.lineTo(tg,tT,!1)},tY.rect=function(tD,tY,tg,tT){this._other=this._other.make(),this._other.path||(this._other.path=new tk),this._other.path.rect(tD,tY,tg,tT)},tY.strokeRect=function(tD,tY,tg,tT,tr){var ts=.5*tr;this.line(tD-ts,tY,tD+tg+ts,tY,tr,this._curMat),this.line(tD+tg,tY,tD+tg,tY+tT,tr,this._curMat),this.line(tD,tY,tD,tY+tT,tr,this._curMat),this.line(tD-ts,tY+tT,tD+tg+ts,tY+tT,tr,this._curMat)},tY.clip=function(){},tY.drawPoly=function(tD,tY,tg,tT,tr,ts,ta){void 0===ta&&(ta=!1),this._renderKey=0,this._shader2D.glTexture=null;var tW=this._getPath();if(-1==this.mId)tW.polygon(tD,tY,tg,tT,tr||1,ts);else if(this.mHaveKey){var tM=tv.getInstance().shapeDic[this.mId];tM.setMatrix(this._curMat),tM.rebuild(tW.tempArray),tW.setGeomtry(tM)}else{var tE=tW.polygon(tD,tY,tg,tT,tr||1,ts);tv.getInstance().addShape(this.mId,tE),tE.setMatrix(this._curMat)}tW.update();var tI,tO=[this.mX,this.mY];if((tI=tsD.createShape(this,tW.ib,tW.vb,tW.count,tW.offset,tAD.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,tI.shaderValue.u_pos=tO,tI.shaderValue.u_mmat2=tjD.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=tI,0<tr){if(this.mHaveLineKey){var tC=tv.getInstance().shapeLineDic[this.mId];tC.rebuild(tW.tempArray),tW.setGeomtry(tC)}else tv.getInstance().addShape(this.mId,tW.drawLine(tD,tY,tg,tr,ts));tW.update(),(tI=tsD.createShape(this,tW.ib,tW.vb,tW.count,tW.offset,tAD.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,tI.shaderValue.u_mmat2=tjD.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=tI}},tY.drawParticle=function(tD,tY,tg){tg.x=tD,tg.y=tY,this._submits[this._submits._length++]=tg},tY._getPath=function(){return this._path||(this._path=new tk)},tT(0,tY,"globalCompositeOperation",function(){return tf.NAMES[this._nBlendType]},function(tD){var tY=tf.TOINT[tD];null==tY||this._nBlendType===tY||(tw.save(this,65536,this,!0),this._curSubmit=tsD.RENDERBASE,this._renderKey=0,this._nBlendType=tY)}),tT(0,tY,"strokeStyle",function(){return this._shader2D.strokeStyle},function(tD){this._shader2D.strokeStyle.equal(tD)||(tw.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=te.create(tD))}),tT(0,tY,"globalAlpha",function(){return this._shader2D.ALPHA},function(tD){(tD=Math.floor(1e3*tD)/1e3)!=this._shader2D.ALPHA&&(tw.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=tD)}),tT(0,tY,"asBitmap",null,function(tD){if(tD){if(this._targets||(this._targets=new ty),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),tT(0,tY,"fillStyle",function(){return this._shader2D.fillStyle},function(tD){this._shader2D.fillStyle.equal(tD)||(tw.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=te.create(tD))}),tT(0,tY,"textAlign",function(){return this._other.textAlign},function(tD){this._other.textAlign===tD||(this._other=this._other.make(),tw.save(this,32768,this._other,!1),this._other.textAlign=tD)}),tT(0,tY,"lineWidth",function(){return this._other.lineWidth},function(tD){this._other.lineWidth===tD||(this._other=this._other.make(),tw.save(this,256,this._other,!1),this._other.lineWidth=tD)}),tT(0,tY,"textBaseline",function(){return this._other.textBaseline},function(tD){this._other.textBaseline===tD||(this._other=this._other.make(),tw.save(this,16384,this._other,!1),this._other.textBaseline=tD)}),tT(0,tY,"font",null,function(tD){tD!=this._other.font.toString()&&(this._other=this._other.make(),tw.save(this,8,this._other,!1),this._other.font===t$D.EMPTY?this._other.font=new t$D(tD):this._other.font.setFont(tD))}),tF.__init__=function(){tg.DEFAULT=new tg},tF._tempPoint=new tb,tF._SUBMITVBSIZE=32e3,tF._MAXSIZE=99999999,tF._RECTVBSIZE=16,tF.MAXCLIPRECT=new tG(0,0,99999999,99999999),tF._COUNT=0,tF._tmpMatrix=new tq,tF.SEGNUM=32,tF._contextcount=0,ta(tF,["_fontTemp",function(){return this._fontTemp=new t$D},"_drawStyleTemp",function(){return this._drawStyleTemp=new te(null)}]),tF.__init$=function(){tg=function(){function tD(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=t$D.EMPTY}tC(tD,"");var tY=tD.prototype;return tY.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=t$D.EMPTY},tY.make=function(){return this===tD.DEFAULT?new tD:this},tD.DEFAULT=null,tD}()},tF}(),tAD=function(tD){function tT(tD,tY){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,tT.__super.call(this),this.defines=new tXD,this.position=tT._POSITION,this.mainID=tD,this.subID=tY,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.colorMul=ts.ShieldColor?t$.create(ts.ShieldColor)._color:null,this.glTexture=null,this.u_mmat2=null,this._cacheID=tD|tY,this._inClassCache=tT._cache[this._cacheID],0<tD&&!this._inClassCache&&(this._inClassCache=tT._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}tC(tT,"laya.webgl.shader.d2.value.Value2D",tU);var tY=tT.prototype;return tY.setValue=function(tD){},tY.refresh=function(){var tD=this.size;return tD[0]=tjD.width,tD[1]=tjD.height,this.alpha=this.ALPHA*tjD.worldAlpha,this.mmat=tjD.worldMatrix4,this},tY._ShaderWithCompile=function(){return tRD.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,tyD.create)},tY._withWorldShaderDefines=function(){var tD=tjD.worldShaderDefines,tY=tRD.sharders[this.mainID|this.defines._value|tD.getValue()];if(!tY){var tg,tT={};for(tg in this.defines.toNameDic())tT[tg]="";for(tg in tD.toNameDic())tT[tg]="";tY=tRD.withCompile2D(0,this.mainID,tT,this.mainID|this.defines._value|tD.getValue(),tyD.create)}var tr=tjD.worldFilters;if(!tr)return tY;for(var ts,ta=tr.length,tW=0;tW<ta;tW++)(ts=tr[tW])&&ts.action.setValue(this);return tY},tY.upload=function(){var tD=tjD;this.alpha=this.ALPHA*tD.worldAlpha,tjD.worldMatrix4!==tjD.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),ts.ShieldColor&&!this.colorMul?this.colorMul=ts.ShieldColor?t$.create(ts.ShieldColor)._color:null:!ts.ShieldColor&&this.colorMul&&(this.colorMul=null),this.colorMul?this.defines.add(16384):this.defines.remove(16384),tpD.shaderHighPrecision&&this.defines.add(1024);var tY,tg=tD.worldShaderDefines?this._withWorldShaderDefines():tRD.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=tD.width,this.size[1]=tD.height,this.mmat=tD.worldMatrix4,tHD.activeShader!==tg?tg._shaderValueWidth!==tD.width||tg._shaderValueHeight!==tD.height?(tg._shaderValueWidth=tD.width,tg._shaderValueHeight=tD.height):tY=tg._params2dQuick2||tg._make2dQuick2():tg._shaderValueWidth!==tD.width||tg._shaderValueHeight!==tD.height?(tg._shaderValueWidth=tD.width,tg._shaderValueHeight=tD.height):tY=tg._params2dQuick1||tg._make2dQuick1(),tg.upload(this,tY)},tY.setFilters=function(tD){if(this.filters=tD)for(var tY,tg=tD.length,tT=0;tT<tg;tT++)(tY=tD[tT])&&(this.defines.add(tY.type),tY.action.setValue(this))},tY.clear=function(){this.defines.setValue(this.subID)},tY.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},tT._initone=function(tD,tY){tT._typeClass[tD]=tY,tT._cache[tD]=[],tT._cache[tD]._length=0},tT.__init__=function(){tT._POSITION=[2,5126,!1,4*tdD.BYTES_PE,0],tT._TEXCOORD=[2,5126,!1,4*tdD.BYTES_PE,2*tdD.BYTES_PE],tT._initone(2,tFD),tT._initone(4,tfD),tT._initone(256,tVD),tT._initone(512,tUD),tT._initone(1,tcD),tT._initone(65,tLD),tT._initone(9,tcD)},tT.create=function(tD,tY){var tg=tT._cache[tD|tY];return tg._length?tg[--tg._length]:new tT._typeClass[tD|tY](tY)},tT._POSITION=null,tT._TEXCOORD=null,tT._cache=[],tT._typeClass=[],tT.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tT}(),tqD=function(tD){function tJ(tD,tY){tJ.__super.call(this,tD,tY)}tC(tJ,"laya.webgl.utils.RenderSprite3D",tj);var tY=tJ.prototype;return tY.onCreate=function(tD){switch(tD){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},tY._mask=function(tD,tY,tg,tT){var tr,ts,ta=this._next,tW=tD.mask;if(tW){tY.ctx.save();var tM=tY.ctx.globalCompositeOperation,tE=new tG;if(tE.copyFrom(tW.getBounds()),tE.width=Math.round(tE.width),tE.height=Math.round(tE.height),tE.x=Math.round(tE.x),tE.y=Math.round(tE.y),0<tE.width&&0<tE.height){var tI=tD._style._tf,tO=tWD.create();tO.addValue("bounds",tE),tr=taD.create([tO,tY],laya.webgl.utils.RenderSprite3D.tmpTarget),tY.addRenderObject(tr),tW.render(tY,-tE.x,-tE.y),tr=taD.create([tO],laya.webgl.utils.RenderSprite3D.endTmpTarget),tY.addRenderObject(tr),tY.ctx.save(),tY.clipRect(tg-tI.translateX+tE.x,tT-tI.translateY+tE.y,tE.width,tE.height),ta._fun.call(ta,tD,tY,tg,tT),tY.ctx.restore(),ts=tID.create(6),tM=tY.ctx.globalCompositeOperation,ts.blendMode="mask",tY.addRenderObject(ts),tq.TEMP.identity();var tC=tAD.create(1,0),tN=tB.INV_UV,t$=tE.width,td=tE.height;(tE.width<32||tE.height<32)&&((tN=tJ.tempUV)[0]=0,tN[1]=0,tN[2]=32<=tE.width?1:tE.width/32,tN[3]=0,tN[4]=32<=tE.width?1:tE.width/32,tN[5]=32<=tE.height?1:tE.height/32,tN[6]=0,tN[7]=32<=tE.height?1:tE.height/32,tE.width=32<=tE.width?tE.width:32,tE.height=32<=tE.height?tE.height:32,tN[1]*=-1,tN[3]*=-1,tN[5]*=-1,tN[7]*=-1,tN[1]+=1,tN[3]+=1,tN[5]+=1,tN[7]+=1),tY.ctx.drawTarget(tO,tg+tE.x-tI.translateX,tT+tE.y-tI.translateY,t$,td,tq.TEMP,"tmpTarget",tC,tN,6),tr=taD.create([tO],laya.webgl.utils.RenderSprite3D.recycleTarget),tY.addRenderObject(tr),(ts=tID.create(6)).blendMode=tM,tY.addRenderObject(ts)}tY.ctx.restore()}else ta._fun.call(ta,tD,tY,tg,tT)},tY._blend=function(tD,tY,tg,tT){var tr=tD._style,ts=this._next;tr.blendMode?(tY.ctx.save(),tY.ctx.globalCompositeOperation=tr.blendMode,ts._fun.call(ts,tD,tY,tg,tT),tY.ctx.restore()):ts._fun.call(ts,tD,tY,tg,tT)},tY._transform=function(tD,tY,tg,tT){var tr=tD.transform,ts=this._next;if(tr&&ts!=tj.NORENDER){var ta=tY.ctx;tD._style;tr.tx=tg,tr.ty=tT;var tW=ta._getTransformMatrix(),tM=tW.clone();tq.mul(tr,tW,tW),tW._checkTransform(),tr.tx=tr.ty=0,ts._fun.call(ts,tD,tY,0,0),tM.copyTo(tW),tM.destroy()}else ts._fun.call(ts,tD,tY,tg,tT)},tJ.tmpTarget=function(tD,tY){var tg=tD.getValue("bounds"),tT=tvD.create(tg.width,tg.height);tT.start(),tT.clear(0,0,0,0),tD.addValue("tmpTarget",tT)},tJ.endTmpTarget=function(tD){tD.getValue("tmpTarget").end()},tJ.recycleTarget=function(tD){tD.getValue("tmpTarget").recycle(),tD.recycle()},ta(tJ,["tempUV",function(){return this.tempUV=new Array(8)}]),tJ}(),tbD=function(tD){function tY(){this.data=null,tY.__super.call(this)}tC(tY,"laya.filters.webgl.ColorFilterActionGL",tS);var tg=tY.prototype;return tt.imps(tg,{"laya.filters.IFilterActionGL":!0}),tg.setValue=function(tD){tD.colorMat=this.data._mat,tD.colorAlpha=this.data._alpha},tg.apply3d=function(tD,tY,tg,tT,tr){var ts=tD.getValue("bounds"),ta=tAD.create(1,0);ta.setFilters([this.data]);var tW=tq.TEMP;tW.identity(),tg.ctx.drawTarget(tD,0,0,ts.width,ts.height,tW,"src",ta)},tY}(),tGD=function(tD){function ts(tD,tY,tg,tT,tr){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,ts.__super.call(this,tD,tY,tr),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new teD,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=tg,this._atlasCanvas.height=tT,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}tC(ts,"laya.webgl.atlas.Atlaser",tF);var tY=ts.prototype;return tY.computeUVinAtlasTexture=function(tD,tY,tg,tT){var tr=tV.atlasTextureWidth,ts=tV.atlasTextureHeight,ta=tg/tr,tW=tT/ts,tM=(tg+tD.bitmap.width)/tr,tE=(tT+tD.bitmap.height)/ts,tI=tD.bitmap.width/tr,tO=tD.bitmap.height/ts;tD.uv=[ta+tY[0]*tI,tW+tY[1]*tO,tM-(1-tY[2])*tI,tW+tY[3]*tO,tM-(1-tY[4])*tI,tE-(1-tY[5])*tO,ta+tY[6]*tI,tE-(1-tY[7])*tO]},tY.findBitmapIsExist=function(tD){if(tD instanceof laya.webgl.resource.WebGLImage){var tY=tD,tg=tY.url,tT=this._InAtlasWebGLImagesKey[tg||tY.id];if(tT)return tT.offsetInfoID}return-1},tY.addToAtlasTexture=function(tD,tY,tg){if(tD instanceof laya.webgl.resource.WebGLImage){var tT=tD,tr=tT.url;this._InAtlasWebGLImagesKey[tr||tT.id]={bitmap:tD,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([tY,tg])}this._atlasCanvas.texSubImage2D(tY,tg,tD.atlasSource),tD.clearAtlasSource()},tY.addToAtlas=function(tD,tY,tg){tD._atlasID=this._inAtlasTextureKey.length;var tT=tD.uv.slice(),tr=tD.bitmap;this._inAtlasTextureKey.push(tD),this._inAtlasTextureOriUVValue.push(tT),this._inAtlasTextureBitmapValue.push(tr),this.computeUVinAtlasTexture(tD,tT,tY,tg),tD.bitmap=this._atlasCanvas},tY.clear=function(){for(var tD=0,tY=this._inAtlasTextureKey.length;tD<tY;tD++)this._inAtlasTextureKey[tD].bitmap=this._inAtlasTextureBitmapValue[tD],this._inAtlasTextureKey[tD].uv=this._inAtlasTextureOriUVValue[tD],this._inAtlasTextureKey[tD]._atlasID=-1,this._inAtlasTextureKey[tD].bitmap.lock=!1,this._inAtlasTextureKey[tD].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},tY.dispose=function(){this.clear(),this._atlasCanvas.destroy()},tT(0,tY,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),tT(0,tY,"texture",function(){return this._atlasCanvas}),tT(0,tY,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),ts}(),tXD=function(tD){function tg(){tg.__super.call(this,tg.__name2int,tg.__int2name,tg.__int2nameMap)}return tC(tg,"laya.webgl.shader.d2.ShaderDefines2D",tn),tg.__init__=function(){tg.reg("TEXTURE2D",1),tg.reg("COLOR2D",2),tg.reg("PRIMITIVE",4),tg.reg("GLOW_FILTER",8),tg.reg("BLUR_FILTER",16),tg.reg("COLOR_FILTER",32),tg.reg("COLOR_ADD",64),tg.reg("WORLDMAT",128),tg.reg("FILLTEXTURE",256),tg.reg("FSHIGHPRECISION",1024),tg.reg("TXTALPHA",2048),tg.reg("TXTCOMPRESS",4096),tg.reg("COLORMUL",16384)},tg.reg=function(tD,tY){tn._reg(tD,tY,tg.__name2int,tg.__int2name)},tg.toText=function(tD,tY,tg){return tn._toText(tD,tY,tg)},tg.toInt=function(tD){return tn._toInt(tD,tg.__name2int)},tg.TEXTURE2D=1,tg.COLOR2D=2,tg.PRIMITIVE=4,tg.FILTERGLOW=8,tg.FILTERBLUR=16,tg.FILTERCOLOR=32,tg.COLORADD=64,tg.WORLDMAT=128,tg.FILLTEXTURE=256,tg.SKINMESH=512,tg.SHADERDEFINE_FSHIGHPRECISION=1024,tg.TXTALPHA=2048,tg.TXTCOMPRESS=4096,tg.COLORMUL=16384,tg.__name2int={},tg.__int2name=[],tg.__int2nameMap=[],tg}(),tzD=(function(tD){function tW(tD,tY,tg,tT,tr,ts,ta){tW.__super.call(this,tD,tY,tg,tT,40,tr,ts,ta)}tC(tW,"laya.webgl.shapes.Ellipse",tgD)}(),function(tD){function ts(tD,tY,tg,tT,tr){this._points=[],this.rebuild(tg),ts.__super.call(this,tD,tY,0,0,0,tr,tT,tr,0)}tC(ts,"laya.webgl.shapes.Line",tgD);var tY=ts.prototype;return tY.rebuild=function(tD){var tY=tD.length;tY!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(tY/2-1)),this.mFloat32Array=new Float32Array(5*tY)),this._points.length=0;for(var tg=NaN,tT=NaN,tr=-1,ts=-1,ta=tD.length/2,tW=0;tW<ta;tW++)tg=tD[2*tW],tT=tD[2*tW+1],(.01<Math.abs(tr-tg)||.01<Math.abs(ts-tT))&&this._points.push(tg,tT),tr=tg,ts=tT},tY.getData=function(tD,tY,tg){var tT=[],tr=[];0<this.borderWidth&&this.createLine2(this._points,tT,this.borderWidth,tg,tr,this._points.length/2),this.mUint16Array.set(tT,0),this.mFloat32Array.set(tr,0),tD.append(this.mUint16Array),tY.append(this.mFloat32Array)},ts}()),tmD=function(tD){function tO(tD,tY,tg,tT,tr){this._points=[];for(var ts=NaN,ta=NaN,tW=-1,tM=-1,tE=tg.length/2-1,tI=0;tI<tE;tI++)ts=tg[2*tI],ta=tg[2*tI+1],(.01<Math.abs(tW-ts)||.01<Math.abs(tM-ta))&&this._points.push(ts,ta),tW=ts,tM=ta;ts=tg[2*tE],ta=tg[2*tE+1],tW=this._points[0],tM=this._points[1],(.01<Math.abs(tW-ts)||.01<Math.abs(tM-ta))&&this._points.push(ts,ta),tO.__super.call(this,tD,tY,0,0,this._points.length/2,0,tT,tr)}tC(tO,"laya.webgl.shapes.LoopLine",tgD);var tY=tO.prototype;return tY.getData=function(tD,tY,tg){if(0<this.borderWidth){for(var tT=this.color,tr=(tT>>16&255)/255,ts=(tT>>8&255)/255,ta=(255&tT)/255,tW=[],tM=0,tE=0,tI=[],tO=Math.floor(this._points.length/2),tC=0;tC<tO;tC++)tM=this._points[2*tC],tE=this._points[2*tC+1],tW.push(this.x+tM,this.y+tE,tr,ts,ta);this.createLoopLine(tW,tI,this.borderWidth,tg+tW.length/5),tD.append(new Uint16Array(tI)),tY.append(new Float32Array(tW))}},tY.createLoopLine=function(tD,tY,tg,tT,tr,ts){tD.length;var ta=tD.concat(),tW=tr||tD,tM=this.borderColor,tE=(tM>>16&255)/255,tI=(tM>>8&255)/255,tO=(255&tM)/255,tC=[ta[0],ta[1]],tN=[ta[ta.length-5],ta[ta.length-4]],t$=tN[0]+.5*(tC[0]-tN[0]),td=tN[1]+.5*(tC[1]-tN[1]);ta.unshift(t$,td,0,0,0),ta.push(t$,td,0,0,0);var tJ,tx,tj,tZ,tp,tl,tt,t_,tA,tq,tb,tG,tX,tz,tm,th,ti,tP,tB,tH,tv=ta.length/5,tS=tT,tU=tg/2;tj=ta[0],tZ=ta[1],tq=tj-(tp=ta[5]),tA=(tA=-(tZ-(tl=ta[6])))/(tH=Math.sqrt(tA*tA+tq*tq))*tU,tq=tq/tH*tU,tW.push(tj-tA,tZ-tq,tE,tI,tO,tj+tA,tZ+tq,tE,tI,tO);for(var tF=1;tF<tv-1;tF++)tj=ta[5*(tF-1)],tZ=ta[5*(tF-1)+1],tp=ta[5*tF],tl=ta[5*tF+1],tt=ta[5*(tF+1)],t_=ta[5*(tF+1)+1],tq=tj-tp,tG=tp-tt,tm=(-(tA=(tA=-(tZ-tl))/(tH=Math.sqrt(tA*tA+tq*tq))*tU)+tj)*(-(tq=tq/tH*tU)+tl)-(-tA+tp)*(-tq+tZ),tP=(-(tb=(tb=-(tl-t_))/(tH=Math.sqrt(tb*tb+tG*tG))*tU)+tt)*(-(tG=tG/tH*tU)+tl)-(-tb+tp)*(-tG+t_),tB=(tX=-tq+tZ-(-tq+tl))*(ti=-tb+tp-(-tb+tt))-(th=-tG+t_-(-tG+tl))*(tz=-tA+tp-(-tA+tj)),Math.abs(tB)<.1?(tB+=10.1,tW.push(tp-tA,tl-tq,tE,tI,tO,tp+tA,tl+tq,tE,tI,tO)):(((tJ=(tz*tP-ti*tm)/tB)-tp)*(tJ-tp)+((tx=(th*tm-tX*tP)/tB)-tl)+(tx-tl),tW.push(tJ,tx,tE,tI,tO,tp-(tJ-tp),tl-(tx-tl),tE,tI,tO));ts&&(tY=ts);var tV=this.edges+1;for(tF=1;tF<tV;tF++)tY.push(tS+2*(tF-1),tS+2*(tF-1)+1,tS+2*tF+1,tS+2*tF+1,tS+2*tF,tS+2*(tF-1));return tY.push(tS+2*(tF-1),tS+2*(tF-1)+1,tS+1,tS+1,tS,tS+2*(tF-1)),tW},tO}(),thD=function(tD){function ta(tD,tY,tg,tT,tr,ts){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=tq.create(),this._points=tg.slice(0,tg.length),ta.__super.call(this,tD,tY,0,0,this._points.length/2,tT,tr,ts)}tC(ta,"laya.webgl.shapes.Polygon",tgD);var tY=ta.prototype;return tY.rebuild=function(tD){this._repaint||(this._points.length=0,this._points=this._points.concat(tD))},tY.setMatrix=function(tD){tD.copyTo(this._mat)},tY.needUpdate=function(tD){return this._repaint=this._mat.a==tD.a&&this._mat.b==tD.b&&this._mat.c==tD.c&&this._mat.d==tD.d&&this._mat.tx==tD.tx&&this._mat.ty==tD.ty,!this._repaint},tY.getData=function(tD,tY,tg){var tT,tr=0,ts=this._points,ta=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=tg){for(this._start=tg,tT=[],ta=this.earcutTriangles.length,tr=0;tr<ta;tr++)tT.push(this.earcutTriangles[tr]+tg);this.mUint16Array=new Uint16Array(tT)}}else{this._start=tg,tT=[];var tW=[],tM=[],tE=this.color,tI=(tE>>16&255)/255,tO=(tE>>8&255)/255,tC=(255&tE)/255;for(ta=Math.floor(ts.length/2),tr=0;tr<ta;tr++)tW.push(this.x+ts[2*tr],this.y+ts[2*tr+1],tI,tO,tC),tM.push(this.x+ts[2*tr],this.y+ts[2*tr+1]);for(this.earcutTriangles=tTD.earcut(tM,null,2),ta=this.earcutTriangles.length,tr=0;tr<ta;tr++)tT.push(this.earcutTriangles[tr]+tg);this.mUint16Array=new Uint16Array(tT),this.mFloat32Array=new Float32Array(tW)}tD.append(this.mUint16Array),tY.append(this.mFloat32Array)},ta}(),tiD=function(tD){function ts(){this._matrix=new tq,this._matrix4=tdD.defaultMatrix4.concat(),ts.__super.call(this,1e4),this.shaderValue=new tAD(0,0)}tC(ts,"laya.webgl.submit.SubmitCanvas",tsD);var tY=ts.prototype;return tY.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var tD=tjD.worldAlpha,tY=tjD.worldMatrix4,tg=tjD.worldMatrix,tT=tjD.worldFilters,tr=tjD.worldShaderDefines,ts=this.shaderValue,ta=this._matrix,tW=this._matrix4,tM=tq.TEMP;return tq.mul(ta,tg,tM),tW[0]=tM.a,tW[1]=tM.b,tW[4]=tM.c,tW[5]=tM.d,tW[12]=tM.tx,tW[13]=tM.ty,tjD.worldMatrix=tM.clone(),tjD.worldMatrix4=tW,tjD.worldAlpha=tjD.worldAlpha*ts.alpha,ts.filters&&ts.filters.length&&(tjD.worldFilters=ts.filters,tjD.worldShaderDefines=ts.defines),this._ctx_src.flush(),tjD.worldAlpha=tD,tjD.worldMatrix4=tY,tjD.worldMatrix.destroy(),tjD.worldMatrix=tg,tjD.worldFilters=tT,tjD.worldShaderDefines=tr,1},tY.releaseRender=function(){var tD=ts._cache;this._ctx_src=null,tD[tD._length++]=this},tY.getRenderType=function(){return 10003},ts.create=function(tD,tY,tg){var tT=ts._cache._length?ts._cache[--ts._cache._length]:new ts;tT._ctx_src=tD;var tr=tT.shaderValue;return tr.alpha=tY,tr.defines.setValue(0),tg&&tg.length&&tr.setFilters(tg),tT},ts._cache=((ts._cache=[])._length=0,ts._cache),ts}(),tPD=function(tD){function tE(tD){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===tD&&(tD=1e4),tE.__super.call(this,tD)}tC(tE,"laya.webgl.submit.SubmitTexture",tsD);var tY=tE.prototype;return tY.releaseRender=function(){var tD=tE._cache;(tD[tD._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},tY.addTexture=function(tD,tY){this._texsID[this._texs.length]=tD._uvID,this._texs.push(tD),this._vbPos.push(tY)},tY.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var tD=this.shaderValue.textureHost.bitmap;if(null!==tD)for(var tY=this._vb.getFloat32Array(),tg=0,tT=this._texs.length;tg<tT;tg++){var tr=this._texs[tg];tr.active();var ts=tr.uv;if(this._texsID[tg]!==tr._uvID){this._texsID[tg]=tr._uvID;var ta=this._vbPos[tg];tY[ta+2]=ts[0],tY[ta+3]=ts[1],tY[ta+6]=ts[2],tY[ta+7]=ts[3],tY[ta+10]=ts[4],tY[ta+11]=ts[5],tY[ta+14]=ts[6],tY[ta+15]=ts[7],this._vb.setNeedUpload()}tr.bitmap!==tD&&(this._isSameTexture=!1)}}},tY.renderSubmit=function(){if(0===this._numEle)return tE._shaderSet=!1,1;var tD=this.shaderValue.textureHost;if(tD){var tY=tD.source;if(!tD.bitmap||!tY)return tE._shaderSet=!1,1;this.shaderValue.texture=tY,tD.alphaTexture&&tD.alphaTexture.source&&(this.shaderValue.texture1=tD.alphaTexture.source)}this._vb.bind_upload(this._ib);var tg=tpD.mainContext;if(tf.activeBlendFunction!==this._blendFn&&(tg.enable(3042),this._blendFn(tg),tf.activeBlendFunction=this._blendFn),tm.drawCall++,tm.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&tHD.activeShader&&tE._shaderSet?(tHD.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&tHD.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),tE._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var tT=tD.bitmap,tr=0,ts=tHD.activeShader,ta=0,tW=this._texs.length;ta<tW;ta++){var tM=this._texs[ta];tM.bitmap===tT&&ta+1!==tW||(ts.uploadTexture2D(tM.source),tg.drawElements(4,6*(ta-tr+1),5123,this._startIdx+6*tr*tdD.BYTES_PIDX),tT=tM.bitmap,tr=ta)}else tg.drawElements(4,this._numEle,5123,this._startIdx);return 1},tE.create=function(tD,tY,tg,tT,tr){var ts=tE._cache._length?tE._cache[--tE._cache._length]:new tE;null==tg&&((tg=ts._selfVb||(ts._selfVb=tnD.create(-1))).clear(),tT=0),ts._ib=tY,ts._vb=tg,ts._startIdx=tT*tdD.BYTES_PIDX,ts._numEle=0;var ta=tD._nBlendType;ts._blendFn=tD._targets?tf.targetFns[ta]:tf.fns[ta],ts.shaderValue=tr,ts.shaderValue.setValue(tD._shader2D);var tW=tD._shader2D.filters;return tW&&ts.shaderValue.setFilters(tW),ts},tE._cache=((tE._cache=[])._length=0,tE._cache),tE._shaderSet=!0,tE}(),tBD=function(tD){function tx(){tx.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}tC(tx,"laya.webgl.utils.MeshTexture",txD);var tY=tx.prototype;return tY.addData=function(tD,tY,tg,tT,tr,ts){for(var ta=tD.length/2,tW=this._vb.needSize(ta*tx.const_stride)>>2,tM=this._vb.getFloat32Array(),tE=0,tI=0;tI<ta;tI++){var tO=tD[tE],tC=tD[tE+1],tN=tO*tT.a+tC*tT.c+tT.tx,t$=tO*tT.b+tC*tT.d+tT.ty;tM[tW++]=tN,tM[tW++]=t$,tM[tW++]=tY[tE],tM[tW++]=tY[tE+1],tE+=2}this._vb.setNeedUpload();var td=this.vertNum;if(0<td){(ta=tg.length)>tx.tmpIdx.length&&(tx.tmpIdx=new Uint16Array(ta));for(var tJ=0;tJ<ta;tJ++)tx.tmpIdx[tJ]=tg[tJ]+td;this._ib.appendU16Array(tx.tmpIdx,tg.length)}else this._ib.append(tg);this._ib.setNeedUpload(),this.vertNum+=ta,this.indexNum+=tg.length},tY.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},tY.destroy=function(){this._ib.destroy(),this._vb.destroy()},tx.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new tx},tx.const_stride=16,tx._POOL=[],ta(tx,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),tx}(),tHD=function(tD){function tY(){tY.__super.call(this),this.lock=!0}return tC(tY,"laya.webgl.shader.BaseShader",tZ),tY.activeShader=null,tY.bindShader=null,tY}(),tvD=function(tY){function tI(tD,tY,tg,tT,tr,ts,ta,tW,tM){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===tg&&(tg=6408),void 0===tT&&(tT=5121),void 0===tr&&(tr=34041),void 0===ts&&(ts=!1),void 0===ta&&(ta=!1),void 0===tW&&(tW=-1),void 0===tM&&(tM=-1),this._type=1,this._w=tD,this._h=tY,this._surfaceFormat=tg,this._surfaceType=tT,this._depthStencilFormat=tr,tx.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=ts,this._repeat=ta,this._minFifter=tW,this._magFifter=tM,this._createWebGLRenderTarget(),this.bitmap.lock=!0,tI.__super.call(this,this.bitmap,tB.INV_UV)}tC(tI,"laya.webgl.resource.RenderTarget2D",tY);var tD=tI.prototype;return tt.imps(tD,{"laya.resource.IDispose":!0}),tD.getType=function(){return this._type},tD.getTexture=function(){return this},tD.size=function(tD,tY){this._w==tD&&this._h==tY||(this._w=tD,this._h=tY,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},tD.release=function(){this.destroy()},tD.recycle=function(){tI.POOL.push(this)},tD.start=function(){var tD=tpD.mainContext;return this._preRenderTarget=tjD.curRenderTarget,tjD.curRenderTarget=this,tD.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(tD.viewport(0,0,this._w,this._h),this._svWidth=tjD.width,this._svHeight=tjD.height,tjD.width=this._w,tjD.height=this._h,tHD.activeShader=null),this},tD.clear=function(tD,tY,tg,tT){void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=1);var tr=tpD.mainContext;tr.clearColor(tD,tY,tg,tT);var ts=16384;switch(this._depthStencilFormat){case 33189:ts|=256;break;case 36168:ts|=1024;break;case 34041:ts|=256,ts|=1024}tr.clear(ts)},tD.end=function(){var tD=tpD.mainContext;tD.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,tjD.curRenderTarget=this._preRenderTarget,1==this._type?(tD.viewport(0,0,this._svWidth,this._svHeight),tjD.width=this._svWidth,tjD.height=this._svHeight,tHD.activeShader=null):tD.viewport(0,0,tt.stage.width,tt.stage.height)},tD.getData=function(tD,tY,tg,tT){var tr=tpD.mainContext;if(tr.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===tr.checkFramebufferStatus(36160)))return tr.bindFramebuffer(36160,null),null;var ts=new Uint8Array(this._w*this._h*4);return tr.readPixels(tD,tY,tg,tT,this._surfaceFormat,this._surfaceType,ts),tr.bindFramebuffer(36160,null),ts},tD.destroy=function(tD){void 0===tD&&(tD=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,tY.prototype.destroy.call(this))},tD.dispose=function(){},tD._createWebGLRenderTarget=function(){this.bitmap=new tKD(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(tD){this.event("recovered")})},tT(0,tD,"surfaceFormat",function(){return this._surfaceFormat}),tT(0,tD,"magFifter",function(){return this._magFifter}),tT(0,tD,"surfaceType",function(){return this._surfaceType}),tT(0,tD,"mipMap",function(){return this._mipMap}),tT(0,tD,"depthStencilFormat",function(){return this._depthStencilFormat}),tT(0,tD,"minFifter",function(){return this._minFifter}),tT(0,tD,"source",function(){return this._alreadyResolved?tt.superGet(tB,this,"source"):null}),tI.create=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){void 0===tg&&(tg=6408),void 0===tT&&(tT=5121),void 0===tr&&(tr=34041),void 0===ts&&(ts=!1),void 0===ta&&(ta=!1),void 0===tW&&(tW=-1),void 0===tM&&(tM=-1);var tE=tI.POOL.pop();return tE||(tE=new tI(tD,tY)),tE.bitmap&&tE._w==tD&&tE._h==tY&&tE._surfaceFormat==tg&&tE._surfaceType==tT&&tE._depthStencilFormat==tr&&tE._mipMap==ts&&tE._repeat==ta&&tE._minFifter==tW&&tE._magFifter==tM||(tE._w=tD,tE._h=tY,tE._surfaceFormat=tg,tE._surfaceType=tT,tE._depthStencilFormat=tr,tx.isConchWebGL&&34041===tE._depthStencilFormat&&(tE._depthStencilFormat=33189),tE._mipMap=ts,tE._repeat=ta,tE._minFifter=tW,tE._magFifter=tM,tE.release(),tE._createWebGLRenderTarget()),tE},tI.TYPE2D=1,tI.TYPE3D=2,tI.POOL=[],tI}(tB),tSD=function(tD){function tY(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,tY.__super.call(this),tY._gl=tpD.mainContext}tC(tY,"laya.webgl.utils.Buffer",tZ);var tg=tY.prototype;return tg._bind=function(){this.activeResource(),tY._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(tY._bindVertexBuffer=this._glBuffer),tY._gl.bindBuffer(this._bufferType,tY._bindActive[this._bufferType]=this._glBuffer),tHD.activeShader=null)},tg.recreateResource=function(){this._glBuffer||(this._glBuffer=tY._gl.createBuffer()),this.completeCreate()},tg.disposeResource=function(){this._glBuffer&&(tpD.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},tT(0,tg,"bufferUsage",function(){return this._bufferUsage}),tY._gl=null,tY._bindActive={},tY._bindVertexBuffer=null,tY._enableAtributes=[],tY}(),tUD=function(tD){function tg(tD){this.texcoord=null,this.offsetX=300,this.offsetY=0,tg.__super.call(this,512,0);var tY=8*tdD.BYTES_PE;this.position=[2,5126,!1,tY,0],this.texcoord=[2,5126,!1,tY,2*tdD.BYTES_PE],this.color=[4,5126,!1,tY,4*tdD.BYTES_PE]}return tC(tg,"laya.webgl.shader.d2.skinAnishader.SkinSV",tAD),tg}(),tFD=function(tD){function tY(tD){tY.__super.call(this,2,0),this.color=[]}return tC(tY,"laya.webgl.shader.d2.value.Color2dSV",tAD),tY.prototype.setValue=function(tD){tD.fillStyle&&(this.color=tD.fillStyle._color._color),tD.strokeStyle&&(this.color=tD.strokeStyle._color._color)},tY}(),tVD=function(tD){function tY(tD){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=tAD._TEXCOORD,tY.__super.call(this,256,0)}tC(tY,"laya.webgl.shader.d2.value.FillTextureSV",tAD);var tg=tY.prototype;return tg.setValue=function(tD){this.ALPHA=tD.ALPHA,tD.filters&&this.setFilters(tD.filters)},tg.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},tY}(),tcD=function(tD){function tY(tD){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=tAD._TEXCOORD,void 0===tD&&(tD=0),tY.__super.call(this,1,tD)}tC(tY,"laya.webgl.shader.d2.value.TextureSV",tAD);var tg=tY.prototype;return tg.setValue=function(tD){this.ALPHA=tD.ALPHA,tD.filters&&this.setFilters(tD.filters)},tg.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},tY}(),tfD=function(tD){function tY(tD){this.a_color=null,this.u_pos=[0,0],tY.__super.call(this,4,0),this.position=[2,5126,!1,5*tdD.BYTES_PE,0],this.a_color=[3,5126,!1,5*tdD.BYTES_PE,2*tdD.BYTES_PE]}return tC(tY,"laya.webgl.shader.d2.value.PrimitiveSV",tAD),tY}(),teD=function(tD){function tY(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,tY.__super.call(this)}tC(tY,"laya.webgl.atlas.AtlasWebGLCanvas",tD);var tg=tY.prototype;return tg.recreateResource=function(){var tD=tpD.mainContext,tY=this._source=tD.createTexture(),tg=tlD.curBindTexTarget,tT=tlD.curBindTexValue;tlD.bindTexture(tD,3553,tY),tD.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),tD.texParameteri(3553,10241,9729),tD.texParameteri(3553,10240,9729),tD.texParameteri(3553,10242,33071),tD.texParameteri(3553,10243,33071),tg&&tT&&tlD.bindTexture(tD,tg,tT),this.memorySize=this._w*this._h*4,this.completeCreate()},tg.disposeResource=function(){this._source&&(tpD.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},tg.texSubImage2D=function(tD,tY,tg){if(tx.isFlash){this._flashCacheImage||(this._flashCacheImage=tJ.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var tT=tg.bitmapdata;this._flashCacheImage._image.copyPixels(tT,0,0,tT.width,tT.height,tD,tY),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var tr=tpD.mainContext,ts=tlD.curBindTexTarget,ta=tlD.curBindTexValue;tlD.bindTexture(tr,3553,this._source),tr.pixelStorei(37441,!0),tx.isConchApp?tr.texSubImage2D(3553,0,tD,tY,tg.width,tg.height,6408,5121,tg.data):(0<=tD-1&&tr.texSubImage2D(3553,0,tD-1,tY,6408,5121,tg),tD+1<=this._w&&tr.texSubImage2D(3553,0,tD+1,tY,6408,5121,tg),0<=tY-1&&tr.texSubImage2D(3553,0,tD,tY-1,6408,5121,tg),tY+1<=this._h&&tr.texSubImage2D(3553,0,tD,tY+1,6408,5121,tg),tr.texSubImage2D(3553,0,tD,tY,6408,5121,tg)),tr.pixelStorei(37441,!1),ts&&ta&&tlD.bindTexture(tr,ts,ta)}},tg.texSubImage2DPixel=function(tD,tY,tg,tT,tr){var ts=tpD.mainContext,ta=tlD.curBindTexTarget,tW=tlD.curBindTexValue;tlD.bindTexture(ts,3553,this._source);var tM=new Uint8Array(tr.data);ts.pixelStorei(37441,!0),ts.texSubImage2D(3553,0,tD,tY,tg,tT,6408,5121,tM),ts.pixelStorei(37441,!1),ta&&tW&&tlD.bindTexture(ts,ta,tW)},tT(0,tg,"width",tD.prototype._$get_width,function(tD){this._w=tD}),tT(0,tg,"height",tD.prototype._$get_height,function(tD){this._h=tD}),tY}(tg),tkD=function(tD){function tr(){this.flipY=!0,this.alwaysChange=!1,tr.__super.call(this)}tC(tr,"laya.webgl.resource.WebGLCanvas",tg);var tY=tr.prototype;return tY.getCanvas=function(){return this._canvas},tY.clear=function(){this._ctx&&this._ctx.clear()},tY.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},tY._setContext=function(tD){this._ctx=tD},tY.getContext=function(tD,tY){return this._ctx?this._ctx:this._ctx=tr._createContext(this)},tY.size=function(tD,tY){this._w==tD&&this._h==tY||(this._w=tD,this._h=tY,this._ctx&&this._ctx.size(tD,tY),this._canvas&&(this._canvas.height=tY,this._canvas.width=tD))},tY.activeResource=function(tD){void 0===tD&&(tD=!1),this._source||this.recreateResource()},tY.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},tY.disposeResource=function(){this._source&&!this.iscpuSource&&(tpD.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},tY.createWebGlTexture=function(){var tD=tpD.mainContext;this._canvas;var tY=this._source=tD.createTexture();this.iscpuSource=!1;var tg=tlD.curBindTexTarget,tT=tlD.curBindTexValue;tlD.bindTexture(tD,3553,tY),tD.pixelStorei(37440,this.flipY?1:0),tr.premulAlpha&&tD.pixelStorei(37441,!0),tD.texImage2D(3553,0,6408,6408,5121,this._imgData),tr.premulAlpha&&tD.pixelStorei(37441,!1),tD.texParameteri(3553,10240,9729),tD.texParameteri(3553,10241,9729),tD.texParameteri(3553,10242,33071),tD.texParameteri(3553,10243,33071),tD.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,tg&&tT&&tlD.bindTexture(tD,tg,tT)},tY.reloadCanvasData=function(){var tD=tpD.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var tY=tlD.curBindTexTarget,tg=tlD.curBindTexValue;tlD.bindTexture(tD,3553,this._source),tr.premulAlpha&&tD.pixelStorei(37441,!0),tD.texImage2D(3553,0,6408,6408,5121,this._imgData),tr.premulAlpha&&tD.pixelStorei(37441,!1),tD.pixelStorei(37440,0),tY&&tg&&tlD.bindTexture(tD,tY,tg)},tY.texSubImage2D=function(tD,tY,tg){var tT=tpD.mainContext,tr=tlD.curBindTexTarget,ts=tlD.curBindTexValue;tlD.bindTexture(tT,3553,this._source),tT.pixelStorei(37441,!0),tT.texSubImage2D(3553,0,tY,tg,6408,5121,tD._source),tT.pixelStorei(37441,!1),tr&&ts&&tlD.bindTexture(tT,tr,ts)},tY.toBase64=function(tD,tY,tg){var tT=null;this._canvas&&(tT=this._canvas.toDataURL(tD,tY)),tg.call(this,tT)},tT(0,tY,"context",function(){return this._ctx}),tT(0,tY,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),tT(0,tY,"asBitmap",null,function(tD){this._ctx&&(this._ctx.asBitmap=tD)}),tr._createContext=null,tr.premulAlpha=!1,tr}(),twD=function(tD){function ta(tD,tY){this.CborderSize=12,ta.__super.call(this),this.char=tD,this.isSpace=" "===tD,this.xs=tY.scaleX,this.ys=tY.scaleY,this.font=tY.font.toString(),this.fontSize=tY.font.size,this.fillColor=tY.fillColor,this.borderColor=tY.borderColor,this.lineWidth=tY.lineWidth,this.underLine=tY.underLine;var tg,tT=tx.isConchApp;tT?(this.CborderSize=0,(tg=ts.conchTextCanvas)._source=ts.conchTextCanvas,tg._source.canvas=ts.conchTextCanvas):tg=tN.canvas.source,this.canvas=tg,this._enableMerageInAtlas=!0,this._ctx=tT?tg:this.canvas.getContext("2d",void 0);var tr=tH.measureText(this.char,this.font);this.cw=tr.width*this.xs,this.ch=(tr.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new tB(this)}tC(ta,"laya.webgl.resource.WebGLCharImage",tg);var tY=ta.prototype;return tt.imps(tY,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),tY.active=function(){this.texture.active()},tY.recreateResource=function(){var tD=tx.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),tD){var tY=this.fontSize;1==this.xs&&1==this.ys||(tY=parseInt(tY*(this.xs>this.ys?this.xs:this.ys)+""));var tg="normal 100 "+this.font;tg=tg.replace(ta._fontSizeReg,tY);var tT=this.CborderSize;this.borderColor&&(tg+=" 1 "+this.borderColor,tT=1),this._ctx.font=tg,this.canvas=this._ctx.getTextBitmapData(this.char,this.fillColor,tT,this.borderColor),this.onresize(this.canvas.width,this.canvas.height)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,tP.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var tr=this._ctx.measureText(this.char);tr||(tr={width:16});var ts=tr.width+1;this._ctx.lineTo(ts,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},tY.onresize=function(tD,tY){this._w=tD,this._h=tY,this._allowMerageInAtlas=!0},tY.clearAtlasSource=function(){},tT(0,tY,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),tT(0,tY,"atlasSource",function(){return this.canvas}),tT(0,tY,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(tD){this._enableMerageInAtlas=tD}),ta.createOneChar=function(tD,tY){return new ta(tD,tY)},ta._fontSizeReg=new RegExp("\\d+(?=px)","g"),ta}(),tKD=function(tD){function tE(tD,tY,tg,tT,tr,ts,ta,tW,tM){void 0===tg&&(tg=6408),void 0===tT&&(tT=5121),void 0===tr&&(tr=34041),void 0===ts&&(ts=!1),void 0===ta&&(ta=!1),void 0===tW&&(tW=-1),void 0===tM&&(tM=1),tE.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=tD,this._h=tY,this._surfaceFormat=tg,this._surfaceType=tT,this._depthStencilFormat=tr,this._mipMap=ts,this._repeat=ta,this._minFifter=tW,this._magFifter=tM}tC(tE,"laya.webgl.resource.WebGLRenderTarget",tg);var tY=tE.prototype;return tY.recreateResource=function(){var tD=tpD.mainContext;this._frameBuffer||(this._frameBuffer=tD.createFramebuffer()),this._source||(this._source=tD.createTexture());var tY=tlD.curBindTexTarget,tg=tlD.curBindTexValue;tlD.bindTexture(tD,3553,this._source),tD.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var tT=this._minFifter,tr=this._magFifter,ts=this._repeat?10497:33071,ta=tI.isPOT(this._w,this._h);if(ta?(this._mipMap?-1!==tT||(tT=9987):-1!==tT||(tT=9729),-1!==tr||(tr=9729),tD.texParameteri(3553,10241,tT),tD.texParameteri(3553,10240,tr),tD.texParameteri(3553,10242,ts),tD.texParameteri(3553,10243,ts),this._mipMap&&tD.generateMipmap(3553)):(-1!==tT||(tT=9729),-1!==tr||(tr=9729),tD.texParameteri(3553,10241,tT),tD.texParameteri(3553,10240,tr),tD.texParameteri(3553,10242,33071),tD.texParameteri(3553,10243,33071)),tD.bindFramebuffer(36160,this._frameBuffer),tD.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=tD.createRenderbuffer()),tD.bindRenderbuffer(36161,this._depthStencilBuffer),tD.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:tD.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:tD.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:tD.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}tD.bindFramebuffer(36160,null),tY&&tg&&tlD.bindTexture(tD,tY,tg),tD.bindRenderbuffer(36161,null),ta&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},tY.disposeResource=function(){this._frameBuffer&&(tpD.mainContext.deleteTexture(this._source),tpD.mainContext.deleteFramebuffer(this._frameBuffer),tpD.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},tT(0,tY,"depthStencilBuffer",function(){return this._depthStencilBuffer}),tT(0,tY,"frameBuffer",function(){return this._frameBuffer}),tE}(),toD=function(tD){function tW(tD,tY,tg,tT,tr,ts,ta){this.offsetX=0,this.offsetY=0,tW.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=ts,this.canvas=tD,this._ctx=tD.getContext("2d",void 0),this._w=tT,this._h=tr,this.offsetX=tY,this.offsetY=tg,this.src=ta,this._enableMerageInAtlas=!0,tV.enabled&&this._w<tV.atlasLimitWidth&&this._h<tV.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}tC(tW,"laya.webgl.resource.WebGLSubImage",tg);var tY=tW.prototype;return tt.imps(tY,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),tY.size=function(tD,tY){this._w=tD,this._h=tY,this._ctx&&this._ctx.size(tD,tY),this.canvas&&(this.canvas.height=tY,this.canvas.width=tD)},tY.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},tY.createWebGlTexture=function(){var tD=tpD.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var tY=this._source=tD.createTexture(),tg=tlD.curBindTexTarget,tT=tlD.curBindTexValue;tlD.bindTexture(tD,3553,tY),tD.pixelStorei(37441,!0),tD.texImage2D(3553,0,6408,6408,5121,this.canvas),tD.pixelStorei(37441,!1);var tr=this.minFifter,ts=this.magFifter,ta=this.repeat?10497:33071,tW=tI.isPOT(this.width,this.height);tW?(this.mipmap?-1!==tr||(tr=9987):-1!==tr||(tr=9729),-1!==ts||(ts=9729),tD.texParameteri(3553,10240,ts),tD.texParameteri(3553,10241,tr),tD.texParameteri(3553,10242,ta),tD.texParameteri(3553,10243,ta),this.mipmap&&tD.generateMipmap(3553)):(-1!==tr||(tr=9729),-1!==ts||(ts=9729),tD.texParameteri(3553,10241,tr),tD.texParameteri(3553,10240,ts),tD.texParameteri(3553,10242,33071),tD.texParameteri(3553,10243,33071)),tg&&tT&&tlD.bindTexture(tD,tg,tT),this.canvas=null,tW&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},tY.disposeResource=function(){tV.enabled&&this._allowMerageInAtlas||!this._source||(tpD.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},tY.clearAtlasSource=function(){},tT(0,tY,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),tT(0,tY,"atlasSource",function(){return this.canvas}),tT(0,tY,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(tD){this._allowMerageInAtlas=tD}),tW}(),tRD=function(tD){function tE(tD,tY,tg,tT){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,tE.__super.call(this),!tD||!tY)throw"Shader Error";this._id=++tE._count,this._vs=tD,this._ps=tY,this._nameMap=tT||{},null!=tg&&(tE.sharders[tg]=this)}tC(tE,"laya.webgl.shader.Shader",tHD);var tY=tE.prototype;return tY.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},tY.disposeResource=function(){tpD.mainContext.deleteShader(this._vshader),tpD.mainContext.deleteShader(this._pshader),tpD.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},tY._compile=function(){if(!tpD.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var tD=[this._vs,this._ps],tY=tpD.mainContext;if(this._program=tY.createProgram(),this._vshader=tE._createShader(tY,tD[0],35633),this._pshader=tE._createShader(tY,tD[1],35632),tY.attachShader(this._program,this._vshader),tY.attachShader(this._program,this._pshader),tY.linkProgram(this._program),!tx.isConchApp&&!tY.getProgramParameter(this._program,35714))throw tY.getProgramInfoLog(this._program);var tg,tT,tr=0,ts=0;for(ts=tx.isConchApp?tY.getProgramParameterEx(this._vs,this._ps,"",35721):tY.getProgramParameter(this._program,35721),tr=0;tr<ts;tr++){var ta=null;tg={vartype:"attribute",glfun:null,ivartype:0,attrib:ta=tx.isConchApp?tY.getActiveAttribEx(this._vs,this._ps,"",tr):tY.getActiveAttrib(this._program,tr),location:tY.getAttribLocation(this._program,ta.name),name:ta.name,type:ta.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(tg)}var tW=0;for(tW=tx.isConchApp?tY.getProgramParameterEx(this._vs,this._ps,"",35718):tY.getProgramParameter(this._program,35718),tr=0;tr<tW;tr++){var tM=null;tM=tx.isConchApp?tY.getActiveUniformEx(this._vs,this._ps,"",tr):tY.getActiveUniform(this._program,tr),0<(tg={vartype:"uniform",glfun:null,ivartype:1,attrib:ta,location:tY.getUniformLocation(this._program,tM.name),name:tM.name,type:tM.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(tg.name=tg.name.substr(0,tg.name.length-3),tg.isArray=!0,tg.location=tY.getUniformLocation(this._program,tg.name)),this._params.push(tg)}for(tr=0,tT=this._params.length;tr<tT;tr++)if((tg=this._params[tr]).indexOfParams=tr,tg.index=1,tg.value=[tg.location,null],tg.codename=tg.name,tg.name=this._nameMap[tg.codename]?this._nameMap[tg.codename]:tg.codename,(this._paramsMap[tg.name]=tg)._this=this,tg.uploadedValue=[],"attribute"!==tg.vartype)switch(tg.type){case 5124:tg.fun=tg.isArray?this._uniform1iv:this._uniform1i;break;case 5126:tg.fun=tg.isArray?this._uniform1fv:this._uniform1f;break;case 35664:tg.fun=tg.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:tg.fun=tg.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:tg.fun=tg.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:tg.fun=this._uniform_sampler2D;break;case 35680:tg.fun=this._uniform_samplerCube;break;case 35676:tg.glfun=tY.uniformMatrix4fv,tg.fun=this._uniformMatrix4fv;break;case 35670:tg.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else tg.fun=this._attribute}},tY.getUniform=function(tD){return this._paramsMap[tD]},tY._attribute=function(tD,tY){var tg=tpD.mainContext,tT=tSD._enableAtributes,tr=tD.location;return tT[tr]||tg.enableVertexAttribArray(tr),tg.vertexAttribPointer(tr,tY[0],tY[1],tY[2],tY[3],tY[4]+this._offset),tT[tr]=tSD._bindVertexBuffer,1},tY._uniform1f=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY?(tpD.mainContext.uniform1f(tD.location,tg[0]=tY),1):0},tY._uniform1fv=function(tD,tY){if(tY.length<4){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tpD.mainContext.uniform1fv(tD.location,tY),tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3],1):0}return tpD.mainContext.uniform1fv(tD.location,tY),1},tY._uniform_vec2=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]?(tpD.mainContext.uniform2f(tD.location,tg[0]=tY[0],tg[1]=tY[1]),1):0},tY._uniform_vec2v=function(tD,tY){if(tY.length<2){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tpD.mainContext.uniform2fv(tD.location,tY),tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3],1):0}return tpD.mainContext.uniform2fv(tD.location,tY),1},tY._uniform_vec3=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]?(tpD.mainContext.uniform3f(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2]),1):0},tY._uniform_vec3v=function(tD,tY){return tpD.mainContext.uniform3fv(tD.location,tY),1},tY._uniform_vec4=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tpD.mainContext.uniform4f(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3]),1):0},tY._uniform_vec4v=function(tD,tY){return tpD.mainContext.uniform4fv(tD.location,tY),1},tY._uniformMatrix2fv=function(tD,tY){return tpD.mainContext.uniformMatrix2fv(tD.location,!1,tY),1},tY._uniformMatrix3fv=function(tD,tY){return tpD.mainContext.uniformMatrix3fv(tD.location,!1,tY),1},tY._uniformMatrix4fv=function(tD,tY){return tpD.mainContext.uniformMatrix4fv(tD.location,!1,tY),1},tY._uniform1i=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY?(tpD.mainContext.uniform1i(tD.location,tg[0]=tY),1):0},tY._uniform1iv=function(tD,tY){return tpD.mainContext.uniform1iv(tD.location,tY),1},tY._uniform_ivec2=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]?(tpD.mainContext.uniform2i(tD.location,tg[0]=tY[0],tg[1]=tY[1]),1):0},tY._uniform_ivec2v=function(tD,tY){return tpD.mainContext.uniform2iv(tD.location,tY),1},tY._uniform_vec3i=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]?(tpD.mainContext.uniform3i(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2]),1):0},tY._uniform_vec3vi=function(tD,tY){return tpD.mainContext.uniform3iv(tD.location,tY),1},tY._uniform_vec4i=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tpD.mainContext.uniform4i(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3]),1):0},tY._uniform_vec4vi=function(tD,tY){return tpD.mainContext.uniform4iv(tD.location,tY),1},tY._uniform_sampler2D=function(tD,tY){var tg=tpD.mainContext,tT=tD.uploadedValue;return null==tT[0]?(tT[0]=this._curActTexIndex,tg.uniform1i(tD.location,this._curActTexIndex),tg.activeTexture(tE._TEXTURES[this._curActTexIndex]),tlD.bindTexture(tg,3553,tY),this._curActTexIndex++,1):(tg.activeTexture(tE._TEXTURES[tT[0]]),tlD.bindTexture(tg,3553,tY),0)},tY._uniform_samplerCube=function(tD,tY){var tg=tpD.mainContext,tT=tD.uploadedValue;return null==tT[0]?(tT[0]=this._curActTexIndex,tg.uniform1i(tD.location,this._curActTexIndex),tg.activeTexture(tE._TEXTURES[this._curActTexIndex]),tlD.bindTexture(tg,34067,tY),this._curActTexIndex++,1):(tg.activeTexture(tE._TEXTURES[tT[0]]),tlD.bindTexture(tg,34067,tY),0)},tY._noSetValue=function(tD){console.log("no....:"+tD.name)},tY.uploadOne=function(tD,tY){this.activeResource(),tlD.UseProgram(this._program);var tg=this._paramsMap[tD];tg.fun.call(this,tg,tY)},tY.uploadTexture2D=function(tD){tm.shaderCall++;var tY=tpD.mainContext;tY.activeTexture(33984),tlD.bindTexture(tY,3553,tD)},tY.uploadTexture2D1=function(tD){tm.shaderCall++;var tY=tpD.mainContext;tY.activeTexture(33985),tlD.bindTexture(tY,3553,tD)},tY.upload=function(tD,tY){tHD.activeShader=tHD.bindShader=this,this._lastUseFrameCount===tm.loopCount||this.activeResource(),tlD.UseProgram(this._program),this._reCompile?(tY=this._params,this._reCompile=!1):tY=tY||this._params;tpD.mainContext;for(var tg,tT,tr=tY.length,ts=0,ta=0;ta<tr;ta++)null!==(tT=tD[(tg=tY[ta]).name])&&(ts+=tg.fun.call(this,tg,tT));tm.shaderCall+=ts},tY.uploadArray=function(tD,tY,tg){tHD.activeShader=this,(tHD.bindShader=this).activeResource(),tlD.UseProgram(this._program);this._params;for(var tT,tr,ts=0,ta=tY-2;0<=ta;ta-=2)(tr=this._paramsMap[tD[ta]])&&null!=(tT=tD[ta+1])&&(tg&&tg[tr.name]&&tg[tr.name].bind(),ts+=tr.fun.call(this,tr,tT));tm.shaderCall+=ts},tY.getParams=function(){return this._params},tE.getShader=function(tD){return tE.sharders[tD]},tE.create=function(tD,tY,tg,tT){return new tE(tD,tY,tg,tT)},tE.withCompile=function(tD,tY,tg,tT){if(tg&&tE.sharders[tg])return tE.sharders[tg];var tr=tE._preCompileShader[2e-4*tD];if(!tr)throw new Error("withCompile shader err!"+tD);return tr.createShader(tY,tg,tT)},tE.withCompile2D=function(tD,tY,tg,tT,tr){if(tT&&tE.sharders[tT])return tE.sharders[tT];var ts=tE._preCompileShader[2e-4*tD+tY];if(!ts)throw new Error("withCompile shader err!"+tD+" "+tY);return ts.createShader(tg,tT,tr)},tE.addInclude=function(tD,tY){tZD.addInclude(tD,tY)},tE.preCompile=function(tD,tY,tg,tT){var tr=2e-4*tD;tE._preCompileShader[tr]=new tZD(tr,tY,tg,tT)},tE.preCompile2D=function(tD,tY,tg,tT,tr){var ts=2e-4*tD+tY;tE._preCompileShader[ts]=new tZD(ts,tg,tT,tr)},tE._createShader=function(tD,tY,tg){var tT=tD.createShader(tg);return tD.shaderSource(tT,tY),tD.compileShader(tT),tT},tE._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],tE._count=0,tE._preCompileShader={},tE.SHADERNAME2ID=2e-4,tE.sharders=((tE.sharders=[]).length=32,tE.sharders),ta(tE,["nameKey",function(){return this.nameKey=new th}]),tE}(),tQD=function(tD){function tY(){this._maxsize=0,this._upload=!0,this._uploadSize=0,tY.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}tC(tY,"laya.webgl.utils.Buffer2D",tD);var tg=tY.prototype;return tg.needSize=function(tD){var tY=this._byteLength;if(tD){var tg=this._byteLength+tD;tg<=this._buffer.byteLength||this._resizeBuffer(tg<<1,!0),this._byteLength=tg}return tY},tg._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),tm.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,tSD._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),tSD._gl.bufferSubData(this._bufferType,0,this._buffer)},tg._bufferSubData=function(tD,tY,tg){if(void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),this._maxsize=Math.max(this._maxsize,this._byteLength),tm.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,tSD._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),tY||tg){var tT=this._buffer.slice(tY,tg);tSD._gl.bufferSubData(this._bufferType,tD,tT)}else tSD._gl.bufferSubData(this._bufferType,tD,this._buffer)},tg._checkArrayUse=function(){},tg._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},tg._bind_subUpload=function(tD,tY,tg){return void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(tD,tY,tg),!0)},tg._resizeBuffer=function(tD,tY){if(tD<this._buffer.byteLength)return this;if(this.memorySize=tD,tY&&this._buffer&&0<this._buffer.byteLength){var tg=new ArrayBuffer(tD);new Uint8Array(tg).set(new Uint8Array(this._buffer),0),this._buffer=tg}else this._buffer=new ArrayBuffer(tD);return this._checkArrayUse(),this._upload=!0,this},tg.append=function(tD){this._upload=!0;var tY,tg;tY=tD.byteLength,tD instanceof Uint8Array?(this._resizeBuffer(this._byteLength+tY,!0),tg=new Uint8Array(this._buffer,this._byteLength)):tD instanceof Uint16Array?(this._resizeBuffer(this._byteLength+tY,!0),tg=new Uint16Array(this._buffer,this._byteLength)):tD instanceof Float32Array&&(this._resizeBuffer(this._byteLength+tY,!0),tg=new Float32Array(this._buffer,this._byteLength)),tg.set(tD,0),this._byteLength+=tY,this._checkArrayUse()},tg.appendU16Array=function(tD,tY){this._resizeBuffer(this._byteLength+2*tY,!0);for(var tg=new Uint16Array(this._buffer,this._byteLength,tY),tT=0;tT<tY;tT++)tg[tT]=tD[tT];this._byteLength+=2*tY,this._checkArrayUse()},tg.appendEx=function(tD,tY){this._upload=!0;var tg;tg=tD.byteLength,this._resizeBuffer(this._byteLength+tg,!0),new tY(this._buffer,this._byteLength).set(tD,0),this._byteLength+=tg,this._checkArrayUse()},tg.appendEx2=function(tD,tY,tg,tT){void 0===tT&&(tT=1),this._upload=!0;var tr,ts;tr=tg*tT,this._resizeBuffer(this._byteLength+tr,!0),ts=new tY(this._buffer,this._byteLength);var ta=0;for(ta=0;ta<tg;ta++)ts[ta]=tD[ta];this._byteLength+=tr,this._checkArrayUse()},tg.getBuffer=function(){return this._buffer},tg.setNeedUpload=function(){this._upload=!0},tg.getNeedUpload=function(){return this._upload},tg.upload=function(){var tD=this._bind_upload();return tSD._gl.bindBuffer(this._bufferType,null),tSD._bindActive[this._bufferType]=null,tHD.activeShader=null,tD},tg.subUpload=function(tD,tY,tg){void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0);var tT=this._bind_subUpload();return tSD._gl.bindBuffer(this._bufferType,null),tSD._bindActive[this._bufferType]=null,tHD.activeShader=null,tT},tg.disposeResource=function(){tD.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},tg.clear=function(){this._byteLength=0,this._upload=!0},tT(0,tg,"bufferLength",function(){return this._buffer.byteLength}),tT(0,tg,"byteLength",null,function(tD){this._byteLength!==tD&&(tD<=this._buffer.byteLength||this._resizeBuffer(2*tD+256,!0),this._byteLength=tD)}),tY.__int__=function(tD){tuD.QuadrangleIB=tuD.create(35044),tJD.fillIBQuadrangle(tuD.QuadrangleIB,16)},tY.FLOAT32=4,tY.SHORT=2,tY}(tSD),tLD=(function(tY){function tg(tD){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,tg.__super.call(this,9)}tC(tg,"laya.webgl.shader.d2.value.GlowSV",tY);var tD=tg.prototype;tD.setValue=function(tD){tY.prototype.setValue.call(this,tD)},tD.clear=function(){tY.prototype.clear.call(this)}}(tcD),function(tD){function tY(tD){tY.__super.call(this,64),this.defines.add(64)}tC(tY,"laya.webgl.shader.d2.value.TextSV",tD);var tg=tY.prototype;return tg.release=function(){(tY.pool[tY._length++]=this).clear()},tg.clear=function(){tD.prototype.clear.call(this)},tY.create=function(){return tY._length?tY.pool[--tY._length]:new tY(null)},tY.pool=[],tY._length=0,tY}(tcD)),tyD=function(tD){function tr(tD,tY,tg,tT){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,tr.__super.call(this,tD,tY,tg,tT)}tC(tr,"laya.webgl.shader.d2.Shader2X",tD);var tY=tr.prototype;return tY.upload2dQuick1=function(tD){this.upload(tD,this._params2dQuick1||this._make2dQuick1())},tY._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var tD,tY=this._params,tg=0,tT=tY.length;tg<tT;tg++)tD=tY[tg],(tx.isFlash||"size"!==tD.name&&"position"!==tD.name&&"texcoord"!==tD.name)&&this._params2dQuick1.push(tD)}return this._params2dQuick1},tY.disposeResource=function(){tD.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},tY.upload2dQuick2=function(tD){this.upload(tD,this._params2dQuick2||this._make2dQuick2())},tY._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var tD,tY=this._params,tg=0,tT=tY.length;tg<tT;tg++)tD=tY[tg],(tx.isFlash||"size"!==tD.name)&&this._params2dQuick2.push(tD)}return this._params2dQuick2},tr.create=function(tD,tY,tg,tT){return new tr(tD,tY,tg,tT)},tr}(tRD),tuD=function(tD){function tY(tD){this._uint8Array=null,this._uint16Array=null,void 0===tD&&(tD=35044),tY.__super.call(this),this._bufferUsage=tD,this._bufferType=34963,tx.isFlash||(this._buffer=new ArrayBuffer(8))}tC(tY,"laya.webgl.utils.IndexBuffer2D",tQD);var tg=tY.prototype;return tg._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},tg.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},tg.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},tg.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},tY.QuadrangleIB=null,tY.create=function(tD){return void 0===tD&&(tD=35044),new tY(tD)},tY}(),tnD=function(tD){function tg(tD,tY){this._floatArray32=null,this._vertexStride=0,tg.__super.call(this),this._vertexStride=tD,this._bufferUsage=tY,this._bufferType=34962,tx.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}tC(tg,"laya.webgl.utils.VertexBuffer2D",tD);var tY=tg.prototype;return tY.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},tY.bind=function(tD){tD&&tD._bind(),this._bind()},tY.insertData=function(tD,tY){this.getFloat32Array().set(tD,tY),this._upload=!0},tY.bind_upload=function(tD){tD._bind_upload()||tD._bind(),this._bind_upload()||this._bind()},tY._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},tY.disposeResource=function(){tD.prototype.disposeResource.call(this)},tY.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},tT(0,tY,"vertexStride",function(){return this._vertexStride}),tg.create=function(tD,tY){return void 0===tY&&(tY=35048),new tg(tD,tY)},tg}(tQD),tDY=function(tD){function tW(tD,tY,tg,tT,tr,ts){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===tg&&(tg=6408),void 0===tT&&(tT=!0),tW.__super.call(this,tD,tY),tD){if(this._format=tg,this._mipmap=tT,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof tD)this._url=tD,this._src=tD,this._image=new tN.window.Image,tY&&(tY.onload&&(this.onload=tY.onload),tY.onerror&&(this.onerror=tY.onerror),tY.onCreate&&tY.onCreate(this)),this._image.crossOrigin=tD&&0==tD.indexOf("data:")?null:"",tD&&(this._image.src=tD);else if(tD instanceof ArrayBuffer){this._src=tY,this._url=this._src;var ta=new tM(tD);ta.readUTFBytes(4),ta.readUTFBytes(2),ta.getInt16();ta.endian="bigEndian",this._w=ta.getInt16(),this._h=ta.getInt16();ta.getInt16(),ta.getInt16();this._image=new Uint8Array(tD,ta.pos),this._format=tpD.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,tV.enabled&&this._w<tV.atlasLimitWidth&&this._h<tV.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(tD instanceof Uint8Array))return this._src=tY,this._url=this._src,this._image=tD.source||tD,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=tY,this._url=this._src,this._w=tr,this._h=ts,this._image=tD,this._format=0===tg?tD.byteLength/(tr*ts)==4?6408:6407:tg}this._$5__enableMerageInAtlas=!0}}tC(tW,"laya.webgl.resource.WebGLImage",tJ);var tY=tW.prototype;return tt.imps(tY,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),tY._init_=function(tD,tY){},tY._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var tD=tpD.mainContext,tY=this._source=tD.createTexture(),tg=tlD.curBindTexTarget,tT=tlD.curBindTexValue;tlD.bindTexture(tD,3553,tY);var tr=this.minFifter,ts=this.magFifter,ta=this.repeat?10497:33071,tW=tI.isPOT(this._w,this._h),tM=!1;switch(tW?(this.mipmap?-1!==tr||(tr=9987):-1!==tr||(tr=9729),-1!==ts||(ts=9729),tD.texParameteri(3553,10241,tr),tD.texParameteri(3553,10240,ts),tD.texParameteri(3553,10242,ta),tD.texParameteri(3553,10243,ta),this.mipmap&&tD.generateMipmap(3553)):(-1!==tr||(tr=9729),-1!==ts||(ts=9729),tD.texParameteri(3553,10241,tr),tD.texParameteri(3553,10240,ts),tD.texParameteri(3553,10242,33071),tD.texParameteri(3553,10243,33071)),tD.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&tD.pixelStorei(tD.UNPACK_ALIGNMENT,1),tD.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&tD.pixelStorei(tD.UNPACK_ALIGNMENT,1),tD.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:tM=!0,tD.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case tpD.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:tM=!0,tD.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}tD.pixelStorei(37441,!1),tg&&tT&&tlD.bindTexture(tD,tg,tT),this.uri||(this.uri=this._url),tM?this.memorySize=this._image.length:tW&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},tY.recreateResource=function(){var tD=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var tY=this;this._image=new tN.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(tY._needReleaseAgain)return tY._needReleaseAgain=!1,tY._image.onload=null,void(tY._image=null);tY._allowMerageInAtlas&&tY._enableMerageInAtlas?(tD.memorySize=0,tD._recreateLock=!1):tY._createWebGlTexture(),tY.completeCreate()},this._image.src=this._src}},tY.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&tpD.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},tY.onresize=function(){this._w=this._image.width,this._h=this._image.height,tV.enabled&&this._w<tV.atlasLimitWidth&&this._h<tV.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},tY.clearAtlasSource=function(){this._image=null},tT(0,tY,"format",function(){return this._format}),tT(0,tY,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(tD){this._$5__enableMerageInAtlas=tD}),tT(0,tY,"mipmap",function(){return this._mipmap}),tT(0,tY,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),tT(0,tY,"atlasSource",function(){return this._image}),tT(0,tY,"onload",null,function(tD){var tY=this;this._onload=tD,this._image&&(this._image.onload=null!=this._onload?function(){tY.onresize(),tY._onload()}:null)}),tT(0,tY,"onerror",null,function(tD){var tY=this;this._onerror=tD,this._image&&(this._image.onerror=null!=this._onerror?function(){tY._onerror()}:null)}),tW}();tt.__init([tND,tF,t_D,tZD])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(tD,tY){"use strict";for(var tg in Object.defineProperty(tY,"__esModule",{value:!0}),Laya){var tT=Laya[tg];tT&&tT.__isclass&&(tY[tg]=tT)}}),function(ts,tD,te){te.un,te.uns;var tT=te.static,tr=te.class,ta=te.getset,tW=(te.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),t$=laya.utils.ClassUtils,tO=(laya.events.Event,laya.utils.HTMLChar),tM=laya.net.Loader,tE=(laya.display.Node,laya.maths.Rectangle),tI=laya.renders.Render,tC=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),tN=laya.utils.Stat,tk=laya.display.Text,td=laya.resource.Texture,tJ=laya.net.URL,tx=laya.utils.Utils,tj=function(){function tN(){}return tr(tN,"laya.html.utils.HTMLParse"),tN.parse=function(tD,tY,tg){tY=(tY="<root>"+(tY=tY.replace(/<br>/g,"<br/>"))+"</root>").replace(tN.spacePattern,tN.char255);var tT=tx.parseXMLFromString(tY);tN._parseXML(tD,tT.childNodes[0].childNodes,tg)},tN._parseXML=function(tD,tY,tg,tT){var tr=0,ts=0;if(tY.join||tY.item)for(tr=0,ts=tY.length;tr<ts;++tr)tN._parseXML(tD,tY[tr],tg,tT);else{var ta,tW,tM;if(3==tY.nodeType)return void(tD instanceof laya.html.dom.HTMLDivElement?(null==tY.nodeName&&(tY.nodeName="#text"),tW=tY.nodeName.toLowerCase(),0<(tM=tY.textContent.replace(/^\s+|\s+$/g,"")).length&&(ta=t$.getInstance(tW))&&(tD.addChild(ta),ta.innerTEXT=tM.replace(tN.char255AndOneSpacePattern," "))):0<(tM=tY.textContent.replace(/^\s+|\s+$/g,"")).length&&(tD.innerTEXT=tM.replace(tN.char255AndOneSpacePattern," ")));if("#comment"==(tW=tY.nodeName.toLowerCase()))return;if(ta=t$.getInstance(tW)){(ta=tD.addChild(ta)).URI=tg,ta.href=tT;var tE=tY.attributes;if(tE&&0<tE.length)for(tr=0,ts=tE.length;tr<ts;++tr){var tI=tE[tr],tO=tI.nodeName,tC=tI.value;ta._setAttributes(tO,tC)}tN._parseXML(ta,tY.childNodes,tg,ta.href)}else tN._parseXML(tD,tY.childNodes,tg,tT)}},tN.char255=String.fromCharCode(255),tN.spacePattern=/&nbsp;|&#160;/g,tN.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),tN}(),tZ=function(){function tf(){}return tr(tf,"laya.html.utils.Layout"),tf.later=function(tD){null==tf._will&&(tf._will=[],te.stage.frameLoop(1,null,function(){if(!(tf._will.length<1)){for(var tD=0;tD<tf._will.length;tD++)laya.html.utils.Layout.layout(tf._will[tD]);tf._will.length=0}})),tf._will.push(tD)},tf.layout=function(tD){if(!tD||!tD._style)return null;if(0==(512&tD._style._type))return null;tD.getStyle()._type&=-513;var tY=tf._multiLineLayout(tD);return tI.isConchApp&&tD.layaoutCallNative&&tD.layaoutCallNative(),tY},tf._multiLineLayout=function(tD){if(tk.RightToLeft)return tf._multiLineLayout2(tD);var tY=new Array;tD._addChildsToLayout(tY);var tg,tT,tr,ts,ta,tW=0,tM=tY.length,tE=tD._getCSSStyle(),tI=tE.letterSpacing,tO=tE.leading,tC=tE.lineHeight,tN=tE._widthAuto()||!tE.wordWrap,t$=tN?999999:tD.width,td=(tD.height,0),tJ=tE.italic?tE.fontSize/3:0,tx=tE._getAlign(),tj=tE._getValign(),tZ=0!==tj||0!==tx||0!=tC,tp=0,tl=0,tt=0,t_=0,tA=new Array,tq=tA[0]=new tw,tb=!1,tG=!1;tq.h=0,tE.italic&&(t$-=tE.fontSize/3);var tX=0,tz=!0;function tm(){tq.y=tl,tl+=tq.h+tO,0==tq.h&&(tl+=tC),tq.mWidth=tX,tX=0,tq=new tw,tA.push(tq),tq.h=0,tb=!(tz=!(tp=0))}if(tk.WordSplitArr&&tk.WordSplitArr.length){var th,ti=[],tP=[],tB=0,tH=0,tv=0;for(tW=0;tW<tM;tW++)if(th=tY[tW],tP.push(th),th?(tv+=tH=th instanceof laya.html.dom.HTMLBrElement?0:th._isChar()?th.width+tI:(tr=th._getCSSStyle().padding,th.width*th._style._tf.scaleX+tr[1]+tr[3]+tI),tB+=tH,th&&th instanceof laya.html.dom.HTMLBrElement||th&&"\n"===th.char||tW==tM-1?(ti.push(tP),tP=[],tv=0):-1!=te.Text.WordSplitArr.indexOf(th.char)&&(ti.push(tP),tP=[],tv=0)):(tv+=tf.DIV_ELEMENT_PADDING,tB+=tf.DIV_ELEMENT_PADDING),th&&th instanceof laya.html.dom.HTMLBrElement||th&&"\n"===th.char||tW==tM-1||t$<tB){tB=tv;for(var tS=0;tS<ti.length;tS++)for(var tU=0;tU<ti[tS].length;tU++)null!=(tg=ti[tS][tU])?(tz=!1,tg instanceof laya.html.dom.HTMLBrElement?tq.y=tl:(tg._isChar()?((ts=tg).isWord?tq.wordStartIndex=tq.elements.length:(tt=ts.width+ts.style.letterSpacing,tX+=ts.width),tt=ts.width+tI,t_=ts.height,tq.minTextHeight=Math.min(tq.minTextHeight,tg.height)):(tT=tg._getCSSStyle(),ta=tg,tr=tT.padding,0===tT._getCssFloat()||(tZ=!0),tb=tG||tT.lineElement,tt=ta.width*ta._style._tf.scaleX+tr[1]+tr[3]+tI,t_=ta.height*ta._style._tf.scaleY+tr[0]+tr[2]),tq.elements.push(tg),tq.h=Math.max(tq.h,t_),tg.x=tp,tg.y=tl,tp+=tt,tq.w=tp-tI,tq.y=tl,td=Math.max(tp+tJ,td))):(tz||(tp+=tf.DIV_ELEMENT_PADDING),tq.wordStartIndex=tq.elements.length);ti=[],tW<tM-1&&tm()}}else for(tW=0;tW<tM;tW++)if(null!=(tg=tY[tW]))if(tz=!1,tg instanceof laya.html.dom.HTMLBrElement)tm(),tq.y=tl;else{if(tg._isChar()){if((ts=tg).isWord)tb=tG||"\n"===ts.char,tq.wordStartIndex=tq.elements.length;else{if(tt=ts.width+ts.style.letterSpacing,0<tA.length&&t$<tp+tt&&0<tq.wordStartIndex){var tF;tF=tq.elements.length-tq.wordStartIndex+1,tq.elements.length=tq.wordStartIndex,tW-=tF,tm();continue}tb=!1,tX+=ts.width}tt=ts.width+tI,t_=ts.height,tG=!1,(tb=tb||t$<tp+tt)&&tm(),tq.minTextHeight=Math.min(tq.minTextHeight,tg.height)}else tT=tg._getCSSStyle(),ta=tg,tr=tT.padding,0===tT._getCssFloat()||(tZ=!0),tb=tG||tT.lineElement,tt=ta.width*ta._style._tf.scaleX+tr[1]+tr[3]+tI,t_=ta.height*ta._style._tf.scaleY+tr[0]+tr[2],tG=tT.lineElement,(tb=tb||t$<tp+tt&&tT.wordWrap)&&tm();tq.elements.push(tg),tq.h=Math.max(tq.h,t_),tg.x=tp,tg.y=tl,tp+=tt,tq.w=tp-tI,tq.y=tl,td=Math.max(tp+tJ,td)}else tz||(tp+=tf.DIV_ELEMENT_PADDING),tq.wordStartIndex=tq.elements.length;if(tl=tq.y+tq.h,tZ){var tV=0,tc=t$;for(tN&&0<tD.width&&(tc=tD.width),tW=0,tM=tA.length;tW<tM;tW++)tA[tW].updatePos(0,tc,tW,tV,tx,tj,tC),tV+=Math.max(tC,tA[tW].h+tO);tl=tV}return tN&&(tD.width=td),tl>tD.height&&(tD.height=tl),[td,tl]},tf._multiLineLayout2=function(tD){var tY=new Array;tD._addChildsToLayout(tY);var tg,tT,tr,ts,ta,tW=0,tM=tY.length,tE=tD._getCSSStyle(),tI=tE.letterSpacing,tO=tE.leading,tC=tE.lineHeight,tN=tE._widthAuto()||!tE.wordWrap,t$=tN?999999:tD.width,td=(tD.height,0),tJ=tE.italic?tE.fontSize/3:0,tx=2-tE._getAlign(),tj=tE._getValign(),tZ=0!==tj||0!=tx||0!=tC,tp=0,tl=0,tt=0,t_=0,tA=new Array,tq=tA[0]=new tw,tb=!1,tG=!1;tq.h=0,tE.italic&&(t$-=tE.fontSize/3);var tX=0,tz=!0;function tm(){tq.y=tl,tl+=tq.h+tO,0==tq.h&&(tl+=tC),tq.mWidth=tX,tX=0,tq=new tw,tA.push(tq),tq.h=0,tb=!(tz=!(tp=0))}if(tk.WordSplitArr&&tk.WordSplitArr.length){var th,ti=[],tP=[],tB=0,tH=0,tv=0;for(tW=0;tW<tM;tW++)if(th=tY[tW],tP.push(th),th?(tv+=tH=th instanceof laya.html.dom.HTMLBrElement?0:th._isChar()?th.width+tI:(tr=th._getCSSStyle().padding,th.width*th._style._tf.scaleX+tr[1]+tr[3]+tI),tB+=tH,th&&th instanceof laya.html.dom.HTMLBrElement||th&&"\n"===th.char||tW==tM-1?(ti.push(tP),tP=[],tv=0):-1!=te.Text.WordSplitArr.indexOf(th.char)&&(ti.push(tP),tP=[],tv=0)):(tv+=tf.DIV_ELEMENT_PADDING,tB+=tf.DIV_ELEMENT_PADDING),th&&th instanceof laya.html.dom.HTMLBrElement||th&&"\n"===th.char||tW==tM-1||t$<tB){tB=tv;for(var tS=0;tS<ti.length;tS++)for(var tU=0;tU<ti[tS].length;tU++)null!=(tg=ti[tS][tU])?(tz=!1,tg instanceof laya.html.dom.HTMLBrElement?tq.y=tl:(tg._isChar()?((ts=tg).isWord?tq.wordStartIndex=tq.elements.length:(tt=ts.width+ts.style.letterSpacing,tX+=ts.width),tt=ts.width+tI,t_=ts.height,tq.minTextHeight=Math.min(tq.minTextHeight,tg.height)):(tT=tg._getCSSStyle(),ta=tg,tr=tT.padding,0===tT._getCssFloat()||(tZ=!0),tb=tG||tT.lineElement,tt=ta.width*ta._style._tf.scaleX+tr[1]+tr[3]+tI,t_=ta.height*ta._style._tf.scaleY+tr[0]+tr[2]),tq.elements.push(tg),tq.h=Math.max(tq.h,t_),tg.x=tp,tg.y=tl,tp+=tt,tq.w=tp-tI,tq.y=tl,td=Math.max(tp+tJ,td))):(tz||(tp+=tf.DIV_ELEMENT_PADDING),tq.wordStartIndex=tq.elements.length);ti=[],tW<tM-1&&tm()}}else for(tW=0;tW<tM;tW++)if(null!=(tg=tY[tW]))if(tz=!1,tg instanceof laya.html.dom.HTMLBrElement)tm(),tq.y=tl;else{if(tg._isChar()){if((ts=tg).isWord)tb=tG||"\n"===ts.char,tq.wordStartIndex=tq.elements.length;else{if(0<tA.length&&t$<tp+tt&&0<tq.wordStartIndex){var tF;tF=tq.elements.length-tq.wordStartIndex+1,tq.elements.length=tq.wordStartIndex,tW-=tF,tm();continue}tb=!1,tX+=ts.width}tt=ts.width+tI,t_=ts.height,tG=!1,(tb=tb||t$<tp+tt)&&tm(),tq.minTextHeight=Math.min(tq.minTextHeight,tg.height)}else tT=tg._getCSSStyle(),ta=tg,tr=tT.padding,0===tT._getCssFloat()||(tZ=!0),tb=tG||tT.lineElement,tt=ta.width*ta._style._tf.scaleX+tr[1]+tr[3]+tI,t_=ta.height*ta._style._tf.scaleY+tr[0]+tr[2],tG=tT.lineElement,(tb=tb||t$<tp+tt&&tT.wordWrap)&&tm();tq.elements.push(tg),tq.h=Math.max(tq.h,t_),tg.x=tp,tg.y=tl,tp+=tt,tq.w=tp-tI,tq.y=tl,td=Math.max(tp+tJ,td)}else tz||(tp+=tf.DIV_ELEMENT_PADDING),tq.wordStartIndex=tq.elements.length;if(tl=tq.y+tq.h,tZ){var tV=0,tc=t$;for(tW=0,tM=tA.length;tW<tM;tW++)tA[tW].updatePos(0,tc,tW,tV,tx,tj,tC),tV+=Math.max(tC,tA[tW].h+tO);tl=tV}for(tN&&(tD.width=td),tl>tD.height&&(tD.height=tl),tW=0,tM=tA.length;tW<tM;tW++)tA[tW].revertOrder(t$);return[td,tl]},tf._will=null,tf.DIV_ELEMENT_PADDING=0,tf}(),tw=function(){function tD(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}tr(tD,"laya.html.utils.LayoutLine");var tY=tD.prototype;return tY.updatePos=function(tD,tY,tg,tT,tr,ts,ta){var tW,tM=0;0<this.elements.length&&(tM=(tW=this.elements[this.elements.length-1]).x+tW.width-this.elements[0].x);var tE=0,tI=NaN;1===tr&&(tE=(tY-tM)/2),2===tr&&(tE=tY-tM),0===ta||0!=ts||(ts=1);for(var tO=0,tC=this.elements.length;tO<tC;tO++){var tN=(tW=this.elements[tO])._getCSSStyle();switch(0!==tE&&(tW.x+=tE),tN._getValign()){case 0:tW.y=tT;break;case 1:var t$=0;99999!=this.minTextHeight&&(t$=this.minTextHeight);var td=(t$+ta)/2;td=Math.max(td,this.h),tI=(laya.html.dom.HTMLImageElement,tT+td-tW.height),tW.y=tI;break;case 2:tW.y=tT+(ta-tW.height)}}},tY.revertOrder=function(tD){var tY;if(0<this.elements.length){var tg,tT=0;for(tg=this.elements.length,tT=0;tT<tg;tT++)(tY=this.elements[tT]).x=tD-tY.x-tY.width}},tD}(),tp=function(tg){function tY(){this.URI=null,this._href=null,tY.__super.call(this),this._text=tY._EMPTYTEXT,this.setStyle(new tW(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}tr(tY,"laya.html.dom.HTMLElement",tg);var tD=tY.prototype;return tD.layaoutCallNative=function(){var tD=0;if(this._childs&&0<(tD=this._childs.length))for(var tY=0;tY<tD;tY++)this._childs[tY].layaoutCallNative&&this._childs[tY].layaoutCallNative();var tg=this._getWords();tg?laya.html.dom.HTMLElement.fillWords(this,tg,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},tD.appendChild=function(tD){return this.addChild(tD)},tD._getWords2=function(){var tD=this._text.text;if(!tD||0===tD.length)return null;var tY,tg,tT=0,tr=0;if(this._text.drawWords)tg=this._text.drawWords;else{for(tr=(tY=tD.split(" ")).length-1,tg=[],tT=0;tT<tr;tT++)tg.push(tY[tT]," ");0<=tr&&tg.push(tY[tr]),this._text.drawWords=tg}var ts,ta=this._text.words;if(ta&&ta.length===tg.length)return ta;null===ta&&(this._text.words=ta=[]),ta.length=tg.length;var tW=this.style,tM=tW.font;for(tT=0,tr=tg.length;tT<tr;tT++){ts=tx.measureText(tg[tT],tM);var tE=ta[tT]=new tO(tg[tT],ts.width,ts.height||tW.fontSize,tW);if(1<tE.char.length&&(tE.charNum=tE.char),this.href){var tI=new tC;this.addChild(tI),tE.setSprite(tI)}}return ta},tD._getWords=function(){if(!tk.CharacterCache)return this._getWords2();var tD=this._text.text;if(!tD||0===tD.length)return null;var tY,tg=this._text.words;if(tg&&tg.length===tD.length)return tg;null===tg&&(this._text.words=tg=[]),tg.length=tD.length;for(var tT=this.style,tr=tT.font,ts=0,ta=tD.length;ts<ta;ts++)if(tY=tx.measureText(tD.charAt(ts),tr)){var tW=tg[ts]=new tO(tD.charAt(ts),tY.width,tY.height||tT.fontSize,tT);if(this.href){var tM=new tC;this.addChild(tM),tW.setSprite(tM)}}else console.warn("_getWords size is null"+tD.charAt(ts),tr);return tg},tD.showLinkSprite=function(){var tD=this._text.words;if(tD)for(var tY,tg,tT=[],tr=0;tr<tD.length;tr++)tg=tD[tr],(tY=new tC).graphics.drawRect(0,0,tg.width,tg.height,"#ff0000"),tY.width=tg.width,tY.height=tg.height,this.addChild(tY),tT.push(tY)},tD._layoutLater=function(){var tD=this.style;512&tD._type||(tD.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&tD.block?(tZ.later(this),tD._type|=512):this.parent&&this.parent._layoutLater())},tD._setAttributes=function(tD,tY){switch(tD){case"style":return void this.style.cssText(tY);case"class":return void(this.className=tY)}tg.prototype._setAttributes.call(this,tD,tY)},tD.updateHref=function(){if(null!=this._href){var tD=this._getWords();if(tD)for(var tY,tg,tT=0;tT<tD.length;tT++)(tg=(tY=tD[tT]).getSprite())&&(tg.size(tY.width,tY.height),tg.on("click",this,this.onLinkHandler))}},tD.onLinkHandler=function(tD){switch(tD.type){case"click":for(var tY=this;tY;)tY.event("link",[this.href]),tY=tY.parent}},tD.formatURL=function(tD){return this.URI?tJ.formatURL(tD,this.URI?this.URI.path:null):tD},ta(0,tD,"href",function(){return this._href},function(tD){null!=(this._href=tD)&&(this._getCSSStyle().underLine=1,this.updateHref())}),ta(0,tD,"color",null,function(tD){this.style.color=tD}),ta(0,tD,"onClick",null,function(tD){te._runScript("fn=function(event){"+tD+";}"),this.on("click",this,void 0)}),ta(0,tD,"id",null,function(tD){tl.document.setElementById(tD,this)}),ta(0,tD,"innerTEXT",function(){return this._text.text},function(tD){this.text=tD}),ta(0,tD,"style",function(){return this._style}),ta(0,tD,"text",function(){return this._text.text},function(tD){this._text==tY._EMPTYTEXT?this._text={text:tD,words:null}:(this._text.text=tD,this._text.words&&(this._text.words.length=0)),tI.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),ta(0,tD,"parent",tg.prototype._$get_parent,function(tD){if(tD instanceof laya.html.dom.HTMLElement){var tY=tD;this.URI||(this.URI=tY.URI),this.style.inherit(tY.style)}te.superSet(tC,this,"parent",tD)}),ta(0,tD,"className",null,function(tD){this.style.attrs(tl.document.styleSheets["."+tD])}),tY.fillWords=function(tD,tY,tg,tT,tr,ts,ta){tD.graphics.clear();for(var tW=0,tM=tY.length;tW<tM;tW++){var tE=tY[tW];tD.graphics.fillText(tE.char,tE.x+tg,tE.y+tT,tr,ts,"left",ta)}},tY._EMPTYTEXT={text:null,words:null},tY}(tC),tY=(function(tD){function tY(){tY.__super.call(this),this.style.lineElement=!0,this.style.block=!0}tr(tY,"laya.html.dom.HTMLBrElement",tp)}(),function(tD){function tY(){this.contextHeight=NaN,this.contextWidth=NaN,tY.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}tr(tY,"laya.html.dom.HTMLDivElement",tD);var tg=tY.prototype;return tg.appendHTML=function(tD){tj.parse(this,tD,this.URI),this.layout()},tg._addChildsToLayout=function(tY){var tD=this._getWords();if(null==tD&&0==this._childs.length)return!1;tD&&tD.forEach(function(tD){tY.push(tD)});for(var tg=!0,tT=0,tr=this._childs.length;tT<tr;tT++){var ts=this._childs[tT];tg?tg=!1:tY.push(null),ts._addToLayout(tY)}return!0},tg._addToLayout=function(tD){this.layout()},tg.layout=function(){if(this.style){this.style._type|=512;var tD=tZ.layout(this);if(tD){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new tE);var tY=this._$P.mHtmlBounds;tY.x=tY.y=0,tY.width=this.contextWidth=tD[0],tY.height=this.contextHeight=tD[1],this.setBounds(tY)}}},ta(0,tg,"height",function(){return this._height?this._height:this.contextHeight},tD.prototype._$set_height),ta(0,tg,"innerHTML",null,function(tD){this.destroyChildren(),this.appendHTML(tD)}),ta(0,tg,"width",function(){return this._width?this._width:this.contextWidth},function(tD){var tY=!1;tY=0===tD?tD!=this._width:tD!=this.width,te.superSet(tp,this,"width",tD),tY&&this.layout()}),tY}(tp)),tl=function(tD){function tY(){this.all=new Array,this.styleSheets=tW.styleSheets,tY.__super.call(this)}tr(tY,"laya.html.dom.HTMLDocument",tp);var tg=tY.prototype;return tg.getElementById=function(tD){return this.all[tD]},tg.setElementById=function(tD,tY){this.all[tD]=tY},tT(tY,["document",function(){return this.document=new tY}]),tY}();(function(tD){function tY(){this._tex=null,this._url=null,this._renderArgs=[],tY.__super.call(this),this.style.block=!0}tr(tY,"laya.html.dom.HTMLImageElement",tp);var tg=tY.prototype;tg._addToLayout=function(tD){!this._style.absolute&&tD.push(this)},tg.render=function(tD,tY,tg){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(tN.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,tD.ctx.drawTexture2(tY,tg,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},tg.layaoutCallNative=function(){var tD=0;if(this._childs&&0<(tD=this._childs.length))for(var tY=0;tY<tD;tY++)this._childs[tY].layaoutCallNative&&this._childs[tY].layaoutCallNative()},ta(0,tg,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(tD){this._width!==tD&&(this._width=tD,this._style.width=tD,this.repaint())}),ta(0,tg,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(tD){this._height!==tD&&(this._height=tD,this._style.height=tD,this.repaint())}),tg.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),tM.clearCache(this,this._url),this._tex=null),tp.prototype.destroy.call(this)},tg.onloaded=function(){var tD=this._style;tD&&!tD.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),tD&&!tD.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),tI.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},tg._loadImageComplete=function(tD,tY,tg){if(!this._destroyed)if(null!=tg)if(tg instanceof ArrayBuffer){var tT=new DataView(tg);new laya.webgl.resource.WebGLImage(new Uint8Array(tg,8),tD,0,!1,tT.getUint32(0),tT.getUint32(4));this.onloaded()}else if(tg instanceof td)tM.imgMgrSet[tD]=tY,ts.imgMgrLock(tD,tM.imgMgrSet[tD]),this._url=tD,this._tex=tg,tM.keepCache(this,tD),tM.cacheRes(tD,this._tex),this.onloaded();else{var tr=-1!=tD.indexOf(".png",tD.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(tg,tD,tr,!1,tg.width,tg.height);this.onloaded()}else this.event("error","Load image failed")},ta(0,tg,"src",null,function(tD){(tD=this.formatURL(tD),this._url!=tD)&&(null!=this._tex&&(tM.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=tD,(this._tex=tM.getRes(tD))?(tM.keepCache(this,tD),this.onloaded()):ts.imgMgrLoad(tD,this._loadImageComplete.bind(this),2,!1))})})(),function(tD){function tY(){this.type=null,tY.__super.call(this),this.visible=!1}tr(tY,"laya.html.dom.HTMLLinkElement",tD);var tg=tY.prototype;tg._onload=function(tD){switch(this.type){case"text/css":tW.parseCSS(tD,this.URI)}},ta(0,tg,"href",tD.prototype._$get_href,function(tD){var tY=this;tD=this.formatURL(tD),this.URI=new tJ(tD);var tg=new tM;tg.once("complete",null,function(tD){tY._onload(tD)}),tg.load(tD,"text")}),tY._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(tp),function(tD){function tY(){tY.__super.call(this),this.visible=!1}tr(tY,"laya.html.dom.HTMLStyleElement",tD),ta(0,tY.prototype,"text",tD.prototype._$get_text,function(tD){tW.parseCSS(tD,null)})}(tp),function(tD){function tY(){tY.__super.call(this),this._getCSSStyle().valign="middle"}tr(tY,"laya.html.dom.HTMLIframeElement",tD),ta(0,tY.prototype,"href",tD.prototype._$get_href,function(tg){var tT=this;tg=this.formatURL(tg);var tD=new tM;tD.once("complete",null,function(tD){var tY=tT.URI;tT.URI=new tJ(tg),tT.innerHTML=tD,!tY||(tT.URI=tY)}),tD.load(tg,"text")})}(tY)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(tD,tY){"use strict";for(var tg in Object.defineProperty(tY,"__esModule",{value:!0}),Laya){var tT=Laya[tg];tT&&tT.__isclass&&(tY[tg]=tT)}}),function(tr,tD,td){td.un,td.uns;var tT=td.static,ts=td.class,ta=td.getset,tg=(td.__newvec,laya.display.Animation),tW=laya.utils.Browser,tJ=laya.utils.ClassUtils,tM=laya.filters.ColorFilter,tE=laya.utils.Ease,tI=laya.events.Event,tO=(laya.events.EventDispatcher,laya.display.css.Font),tC=laya.display.FrameAnimation,tY=laya.display.Graphics,tN=laya.utils.Handler,t$=laya.display.Input,tj=laya.net.Loader,tx=(laya.display.Node,laya.maths.Point),tZ=laya.maths.Rectangle,tp=laya.renders.Render,tl=laya.display.Sprite,tt=laya.display.Text,t_=laya.resource.Texture,tA=laya.utils.Tween,tq=laya.utils.Utils,tb=laya.utils.WeakObject;td.interface("laya.ui.IItem"),td.interface("laya.ui.ISelect"),td.interface("laya.ui.IRender"),td.interface("laya.ui.IComponent"),td.interface("laya.ui.IBox","IComponent");var tG=function(){function tD(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return ts(tD,"laya.ui.LayoutStyle"),tT(tD,["EMPTY",function(){return this.EMPTY=new tD}]),tD}(),tX=function(){function tD(){}return ts(tD,"laya.ui.Styles"),tD.labelColor="#000000",tD.buttonStateNum=3,tD.scrollBarMinNum=15,tD.scrollBarDelayTime=500,tT(tD,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),tD}(),tz=function(){function tr(){}return ts(tr,"laya.ui.UIUtils"),tr.fillArray=function(tD,tY,tg){var tT=tD.concat();if(tY)for(var tr=tY.split(","),ts=0,ta=Math.min(tT.length,tr.length);ts<ta;ts++){var tW=tr[ts];tT[ts]="true"==tW||"false"!=tW&&tW,null!=tg&&(tT[ts]=tg(tW))}return tT},tr.toColor=function(tD){return tq.toHexColor(tD)},tr.gray=function(tD,tY){void 0===tY&&(tY=!0),tY?tr.addFilter(tD,tr.grayFilter):tr.clearFilter(tD,tM)},tr.addFilter=function(tD,tY){var tg=tD.filters||[];tg.push(tY),tD.filters=tg},tr.clearFilter=function(tD,tY){var tg=tD.filters;if(null!=tg&&0<tg.length){for(var tT=tg.length-1;-1<tT;tT--){var tr=tg[tT];td.__typeof(tr,tY)&&tg.splice(tT,1)}tD.filters=tg}},tr._getReplaceStr=function(tD){return tr.escapeSequence[tD]},tr.adptString=function(tD){return tD.replace(/\\(\w)/g,tr._getReplaceStr)},tr.getBindFun=function(tD){var tY=tr._funMap.get(tD);if(null==tY){var tg='"'+tD+'"',tT="(function(data){if(data==null)return;with(data){try{\nreturn "+(tg=tg.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";tY=td._runScript(tT),tr._funMap.set(tD,tY)}return tY},tT(tr,["grayFilter",function(){return this.grayFilter=new tM([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new tb}]),tr}(),tm=function(){function tD(){}return ts(tD,"UIConfig"),tD.touchScrollEnable=!0,tD.mouseWheelEnable=!0,tD.showButtons=!0,tD.popupBgColor="#000000",tD.popupBgAlpha=.5,tD.closeDialogOnSide=!0,tD}(),th=function(tg){function tx(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,tx.__super.call(this),this._weakKeys=[]}ts(tx,"laya.ui.AutoBitmap",tg);var tD=tx.prototype;return tD.destroy=function(){if(tj.clearObject(this,this._weakKey),this._weakKeys){for(var tD=0,tY=this._weakKeys.length;tD<tY;++tD)tj.clearObject(this,this._weakKeys[tD]);this._weakKeys=null}tg.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},tD._setChanged=function(){this._isChanged||(this._isChanged=!0,td.timer.callLater(this,this.changeSource))},tD.changeSource=function(){this._isChanged=!1;var tD=this._source;if(tD&&tD.bitmap){var tY=this.width,tg=this.height,tT=this._sizeGrid,tr=tD.sourceWidth,ts=tD.sourceHeight;if(!tT||tr===tY&&ts===tg)this.cleanByTexture(tD,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,tY,tg);else{tj.clearObject(this,this._weakKey),tD.$_GID||(tD.$_GID=tq.getGID());var ta=tD.$_GID+"."+tY+"."+tg+"."+tT.join("."),tW=tj.findObject(ta);if(tq.isOKCmdList(tW))return this._weakKey=ta,tj.keepObject(this,this._weakKey),void(this.cmds=tW);this.clear();var tM,tE,tI=tT[0],tO=tT[1],tC=tT[2],tN=tT[3],t$=tT[4],td=!1;if(tY==tr&&(tN=tO=0),tg==ts&&(tI=tC=0),tY<tN+tO){var tJ=tY;td=!0,tY=tN+tO,this.save(),this.clipRect(0,0,tJ,tg)}tN&&tI&&(tM=tx.getTexture(tD,0,0,tN,tI),tE=this._weakKeys[0],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[0]=tM.weakKey),this.drawTexture(tM,0,0,tN,tI)):(tj.clearObject(this,tE),this._weakKeys[0]="")),tO&&tI&&(tM=tx.getTexture(tD,tr-tO,0,tO,tI),tE=this._weakKeys[1],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[1]=tM.weakKey),this.drawTexture(tM,tY-tO,0,tO,tI)):(tj.clearObject(this,tE),this._weakKeys[1]="")),tN&&tC&&(tM=tx.getTexture(tD,0,ts-tC,tN,tC),tE=this._weakKeys[2],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[2]=tM.weakKey),this.drawTexture(tM,0,tg-tC,tN,tC)):(tj.clearObject(this,tE),this._weakKeys[2]="")),tO&&tC&&(tM=tx.getTexture(tD,tr-tO,ts-tC,tO,tC),tE=this._weakKeys[3],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[3]=tM.weakKey),this.drawTexture(tM,tY-tO,tg-tC,tO,tC)):(tj.clearObject(this,tE),this._weakKeys[3]="")),tI&&(tM=tx.getTexture(tD,tN,0,tr-tN-tO,tI),tE=this._weakKeys[4],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[4]=tM.weakKey),this.drawBitmap(t$,tM,tN,0,tY-tN-tO,tI)):(tj.clearObject(this,tE),this._weakKeys[4]="")),tC&&(tM=tx.getTexture(tD,tN,ts-tC,tr-tN-tO,tC),tE=this._weakKeys[5],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[5]=tM.weakKey),this.drawBitmap(t$,tM,tN,tg-tC,tY-tN-tO,tC)):(tj.clearObject(this,tE),this._weakKeys[5]="")),tN&&(tM=tx.getTexture(tD,0,tI,tN,ts-tI-tC),tE=this._weakKeys[6],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[6]=tM.weakKey),this.drawBitmap(t$,tM,0,tI,tN,tg-tI-tC)):(tj.clearObject(this,tE),this._weakKeys[6]="")),tO&&(tM=tx.getTexture(tD,tr-tO,tI,tO,ts-tI-tC),tE=this._weakKeys[7],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[7]=tM.weakKey),this.drawBitmap(t$,tM,tY-tO,tI,tO,tg-tI-tC)):(tj.clearObject(this,tE),this._weakKeys[7]="")),tM=tx.getTexture(tD,tN,tI,tr-tN-tO,ts-tI-tC),tE=this._weakKeys[8],tM?(tE!=tM.weakKey&&(tj.clearObject(this,tE),tj.keepObject(this,tM.weakKey),this._weakKeys[8]=tM.weakKey),this.drawBitmap(t$,tM,tN,tI,tY-tN-tO,tg-tI-tC)):(tj.clearObject(this,tE),this._weakKeys[8]=""),td&&this.restore(),this.autoCacheCmd&&!tp.isConchApp&&(tj.saveObject(ta,this.cmds,null),this._weakKey=ta,tj.keepObject(this,this._weakKey))}this._repaint()}},tD.drawBitmap=function(tD,tY,tg,tT,tr,ts){void 0===tr&&(tr=0),void 0===ts&&(ts=0),tr<.1||ts<.1||(!tD||tY.width==tr&&tY.height==ts?this.drawTexture(tY,tg,tT,tr,ts):this.fillTexture(tY,tg,tT,tr,ts))},tD.clear=function(tD){void 0===tD&&(tD=!0),tg.prototype.clear.call(this,!1)},ta(0,tD,"sizeGrid",function(){return this._sizeGrid},function(tD){this._sizeGrid=tD,this._setChanged()}),ta(0,tD,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(tD){this._width!=tD&&(this._width=tD,this._setChanged())}),ta(0,tD,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(tD){this._height!=tD&&(this._height=tD,this._setChanged())}),ta(0,tD,"source",function(){return this._source},function(tD){tD?(this._source=tD,this._setChanged()):(this._source=null,this.clear())}),tx.getTexture=function(tD,tY,tg,tT,tr){tT<=0&&(tT=1),tr<=0&&(tr=1),tD.$_GID||(tD.$_GID=tq.getGID());var ts=tD.$_GID+"."+tY+"."+tg+"."+tT+"."+tr,ta=tj.findObject(ts);if((!ta||!ta.source)&&(ta=t_.createFromTexture(tD,tY,tg,tT,tr))){if(tD.alphaTexture){var tW=tD.width/tD.alphaTexture.width;ta.alphaTexture=t_.createFromTexture(tD.alphaTexture,tY/tW,tg/tW,tT/tW,tr/tW)}tj.saveObject(ts,ta),ta.weakKey=ts}return ta},tx}(tY),ti=(function(tD){function tY(){tY.__super.call(this)}ts(tY,"laya.ui.UIEvent",tI),tY.SHOW_TIP="showtip",tY.HIDE_TIP="hidetip"}(),function(tY){function tD(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,tD.__super.call(this),this._layout=tG.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}ts(tD,"laya.ui.Component",tY);var tg=tD.prototype;return td.imps(tg,{"laya.ui.IComponent":!0}),tg.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},tg.preinitialize=function(){},tg.createChildren=function(){},tg.initialize=function(){},tg.callLater=function(tD,tY){td.timer.callLater(this,tD,tY)},tg.runCallLater=function(tD){td.timer.runCallLater(this,tD)},tg.commitMeasure=function(){},tg.changeSize=function(){this.event("resize")},tg.getLayout=function(){return this._layout===tG.EMPTY&&(this._layout=new tG),this._layout},tg._setLayoutEnabled=function(tD){this._layout&&this._layout.enable!=tD&&(this._layout.enable=tD,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},tg.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},tg.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},tg.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},tg.resetLayoutX=function(){var tD=this._layout;if(isNaN(tD.anchorX)||(this.pivotX=tD.anchorX*this.width),this.layoutEnabled){var tY=this.parent;tY&&(isNaN(tD.centerX)?isNaN(tD.left)?isNaN(tD.right)||(this.x=Math.round(tY.width-this.displayWidth-tD.right+this.pivotX*this.scaleX)):(this.x=Math.round(tD.left+this.pivotX*this.scaleX),isNaN(tD.right)||(this.width=(tY._width-tD.left-tD.right)/(this.scaleX||.01))):this.x=Math.round(.5*(tY.width-this.displayWidth)+tD.centerX+this.pivotX*this.scaleX))}},tg.resetLayoutY=function(){var tD=this._layout;if(isNaN(tD.anchorY)||(this.pivotY=tD.anchorY*this.height),this.layoutEnabled){var tY=this.parent;tY&&(isNaN(tD.centerY)?isNaN(tD.top)?isNaN(tD.bottom)||(this.y=Math.round(tY.height-this.displayHeight-tD.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(tD.top+this.pivotY*this.scaleY),isNaN(tD.bottom)||(this.height=(tY._height-tD.top-tD.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(tY.height-this.displayHeight)+tD.centerY+this.pivotY*this.scaleY))}},tg.onMouseOver=function(tD){td.stage.event("showtip",this._toolTip)},tg.onMouseOut=function(tD){td.stage.event("hidetip",this._toolTip)},ta(0,tg,"displayWidth",function(){return this.width*this.scaleX}),ta(0,tg,"width",function(){return this._width?this._width:this.measureWidth},function(tD){this._width!=tD&&(this._width=tD,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),ta(0,tg,"measureWidth",function(){var tD=0;this.commitMeasure();for(var tY=this.numChildren-1;-1<tY;tY--){var tg=this.getChildAt(tY);tg.visible&&(tD=Math.max(tg.x+tg.width*tg.scaleX,tD))}return tD}),ta(0,tg,"displayHeight",function(){return this.height*this.scaleY}),ta(0,tg,"height",function(){return this._height?this._height:this.measureHeight},function(tD){this._height!=tD&&(this._height=tD,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),ta(0,tg,"dataSource",function(){return this._dataSource},function(tD){for(var tY in this._dataSource=tD,this._dataSource)this.hasOwnProperty(tY)&&"function"!=typeof this[tY]&&(this[tY]=this._dataSource[tY])}),ta(0,tg,"scaleY",tY.prototype._$get_scaleY,function(tD){td.superGet(tl,this,"scaleY")!=tD&&(td.superSet(tl,this,"scaleY",tD),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),ta(0,tg,"measureHeight",function(){var tD=0;this.commitMeasure();for(var tY=this.numChildren-1;-1<tY;tY--){var tg=this.getChildAt(tY);tg.visible&&(tD=Math.max(tg.y+tg.height*tg.scaleY,tD))}return tD}),ta(0,tg,"scaleX",tY.prototype._$get_scaleX,function(tD){td.superGet(tl,this,"scaleX")!=tD&&(td.superSet(tl,this,"scaleX",tD),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),ta(0,tg,"top",function(){return this._layout.top},function(tD){tD!=this._layout.top&&(this.getLayout().top=tD,this._setLayoutEnabled(!0)),this.resetLayoutY()}),ta(0,tg,"bottom",function(){return this._layout.bottom},function(tD){tD!=this._layout.bottom&&(this.getLayout().bottom=tD,this._setLayoutEnabled(!0)),this.resetLayoutY()}),ta(0,tg,"left",function(){return this._layout.left},function(tD){tD!=this._layout.left&&(this.getLayout().left=tD,this._setLayoutEnabled(!0)),this.resetLayoutX()}),ta(0,tg,"right",function(){return this._layout.right},function(tD){tD!=this._layout.right&&(this.getLayout().right=tD,this._setLayoutEnabled(!0)),this.resetLayoutX()}),ta(0,tg,"centerX",function(){return this._layout.centerX},function(tD){tD!=this._layout.centerX&&(this.getLayout().centerX=tD,this._setLayoutEnabled(!0)),this.resetLayoutX()}),ta(0,tg,"centerY",function(){return this._layout.centerY},function(tD){tD!=this._layout.centerY&&(this.getLayout().centerY=tD,this._setLayoutEnabled(!0)),this.resetLayoutY()}),ta(0,tg,"anchorX",function(){return this._layout.anchorX},function(tD){tD!=this._layout.anchorX&&(this.getLayout().anchorX=tD,this._setLayoutEnabled(!0)),this.resetLayoutX()}),ta(0,tg,"anchorY",function(){return this._layout.anchorY},function(tD){tD!=this._layout.anchorY&&(this.getLayout().anchorY=tD,this._setLayoutEnabled(!0)),this.resetLayoutY()}),ta(0,tg,"tag",function(){return this._tag},function(tD){this._tag=tD}),ta(0,tg,"toolTip",function(){return this._toolTip},function(tD){this._toolTip!=tD&&(null!=(this._toolTip=tD)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),ta(0,tg,"comXml",function(){return this._comXml},function(tD){this._comXml=tD}),ta(0,tg,"gray",function(){return this._gray},function(tD){tD!==this._gray&&(this._gray=tD,tz.gray(this,tD))}),ta(0,tg,"disabled",function(){return this._disabled},function(tD){tD!==this._disabled&&(this.gray=this._disabled=tD,this.mouseEnabled=!tD)}),tD}(tl)),tP=function(tD){function tY(){this.lockLayer=null,this.popupEffect=function(tD){tD.scale(1,1),tA.from(tD,{x:td.stage.width/2,y:td.stage.height/2,scaleX:0,scaleY:0},300,tE.backOut,tN.create(this,this.doOpen,[tD]))},this.closeEffect=function(tD,tY){tA.to(tD,{x:td.stage.width/2,y:td.stage.height/2,scaleX:0,scaleY:0},300,tE.strongOut,tN.create(this,this.doClose,[tD,tY]))},tY.__super.call(this),this.maskLayer=new tl,this.popupEffectHandler=tN.create(this,this.popupEffect,null,!1),this.closeEffectHandler=tN.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,td.stage.addChild(this),td.stage.on("resize",this,this._onResize),tm.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}ts(tY,"laya.ui.DialogManager",tl);var tg=tY.prototype;return tg._closeOnSide=function(){var tD=this.getChildAt(this.numChildren-1);tD instanceof laya.ui.Dialog&&tD.close("side")},tg.setLockView=function(tD){this.lockLayer||(this.lockLayer=new tB,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(td.stage.width,td.stage.height)),this.lockLayer.removeChildren(),tD&&(tD.centerX=tD.centerY=0,this.lockLayer.addChild(tD))},tg._onResize=function(tD){var tY=this.maskLayer.width=td.stage.width,tg=this.maskLayer.height=td.stage.height;this.lockLayer&&this.lockLayer.size(tY,tg),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,tY,tg,tm.popupBgColor),this.maskLayer.alpha=tm.popupBgAlpha;for(var tT=this.numChildren-1;-1<tT;tT--){var tr=this.getChildAt(tT);tr.popupCenter&&this._centerDialog(tr)}},tg._centerDialog=function(tD){tD.x=Math.round((td.stage.width-tD.width>>1)+tD.pivotX),tD.y=Math.round((td.stage.height-tD.height>>1)+tD.pivotY)},tg.open=function(tD,tY,tg){void 0===tY&&(tY=!1),void 0===tg&&(tg=!1),tY&&this._closeAll(),tD.popupCenter&&this._centerDialog(tD),this.addChild(tD),(tD.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),tg&&null!=tD.popupEffect?tD.popupEffect.runWith(tD):this.doOpen(tD),this.event("open")},tg.doOpen=function(tD){tD.onOpened()},tg.lock=function(tD){this.lockLayer&&(tD?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},tg.close=function(tD,tY,tg){void 0===tg&&(tg=!1),tg&&null!=tD.closeEffect?tD.closeEffect.runWith([tD,tY]):this.doClose(tD,tY),this.event("close")},tg.doClose=function(tD,tY){tD.removeSelf(),tD.isModal&&this._checkMask(),tD.closeHandler&&tD.closeHandler.runWith(tY),tD.onClosed(tY)},tg.closeAll=function(){this._closeAll(),this.event("close")},tg._closeAll=function(){for(var tD=this.numChildren-1;-1<tD;tD--){var tY=this.getChildAt(tD);tY&&null!=tY.close&&this.doClose(tY)}},tg.getDialogsByGroup=function(tD){for(var tY=[],tg=this.numChildren-1;-1<tg;tg--){var tT=this.getChildAt(tg);tT&&tT.group===tD&&tY.push(tT)}return tY},tg.closeByGroup=function(tD){for(var tY=[],tg=this.numChildren-1;-1<tg;tg--){var tT=this.getChildAt(tg);tT&&tT.group===tD&&(tT.close(),tY.push(tT))}return tY},tg._checkMask=function(){this.maskLayer.removeSelf();for(var tD=this.numChildren-1;-1<tD;tD--){var tY=this.getChildAt(tD);if(tY&&tY.isModal)return 1<tY.zOrder?this.maskLayer.zOrder=tY.zOrder-1:this.maskLayer.zOrder=0,void this.addChildAt(this.maskLayer,tD)}},tY}(),tB=function(tD){function tY(){tY.__super.call(this)}ts(tY,"laya.ui.Box",tD);var tg=tY.prototype;return td.imps(tg,{"laya.ui.IBox":!0}),ta(0,tg,"dataSource",tD.prototype._$get_dataSource,function(tD){for(var tY in this._dataSource=tD){var tg=this.getChildByName(tY);tg?tg.dataSource=tD[tY]:this.hasOwnProperty(tY)&&"function"!=typeof this[tY]&&(this[tY]=tD[tY])}}),tY}(ti),tH=function(tY){function tg(tD,tY){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,tg.__super.call(this),this._labelColors=tX.buttonLabelColors,this._stateNum=tX.buttonStateNum,void 0===tY&&(tY=""),this.skin=tD,this.label=tY}ts(tg,"laya.ui.Button",tY);var tD=tg.prototype;return td.imps(tD,{"laya.ui.ISelect":!0}),tD.destroy=function(tD){this.clearEvent(),tj.clearCache(this,this._skin),tj.clearObject(this,this._weakKey),void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(tD),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},tD.clearEvent=function(){this._skin&&tr.atalsNotify&&tr.atalsNotify.off(this._skin,this,this._setBtnSource)},tD.createChildren=function(){this.graphics=this._bitmap=new th},tD.createText=function(){this._text||(this._text=new tt,this._text.overflow=tt.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},tD.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},tD.onMouse=function(tD){if(!1!==this.toggle||!this._selected)return"click"===tD.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=tg.stateMap[tD.type]))},tD.changeClips=function(){var tD=tj.getRes(this._skin);if(tD)if(this._skin&&""!=this._skin){tj.clearObject(this,this._weakKey);var tY=tD.sourceWidth,tg=tD.sourceHeight/this._stateNum;tD.$_GID||(tD.$_GID=tq.getGID());var tT=tD.$_GID+"-"+this._stateNum,tr=tj.findObject(tT);if(tq.isOkTextureList(tr)||(tr=null),tr)this._weakKey=tT,tj.keepObject(this,this._weakKey),this._sources=tr;else{if(this._sources=[],1===this._stateNum)this._sources.push(tD);else for(var ts=0;ts<this._stateNum;ts++){var ta=t_.createFromTexture(tD,0,tg*ts,tY,tg);if(tD.alphaTexture){var tW=tD.width/tD.alphaTexture.width;ta.alphaTexture=t_.createFromTexture(tD.alphaTexture,0/tW,tg*ts/tW,tY/tW,tg/tW)}this._sources.push(ta)}tj.saveObject(tT,this._sources),this._weakKey=tT,tj.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||tY,this._bitmap.height=this._height||tg,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=tY)}else console.warn("lose skin ",this._skin,this.name,this.__className)},tD.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var tD=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[tD]),this.label&&(this._text.color=this._labelColors[tD],this._strokeColors&&(this._text.strokeColor=this._strokeColors[tD]))},tD._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},ta(0,tD,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(tD){this.createText(),this._text.strokeColor=tD}),ta(0,tD,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),ta(0,tD,"skin",function(){return this._skin},function(tD){if(tW.window.handleRes&&(tD=tW.window.handleRes(tD)),this._skin!=tD)if(this.clearEvent(),tj.clearCache(this,this._skin),this._skin=tD,tj.keepCache(this,this._skin),tj.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var tY=tr.resAtalsObj&&tr.resAtalsObj[this._skin];tY?(tr.atalsNotify&&tr.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=tY.sourceW),0==this.height&&(this.height=tY.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),tD._setBtnSource=function(tD,tY){tD===this._skin&&tY&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},ta(0,tD,"state",function(){return this._state},function(tD){this._state!=tD&&(this._state=tD,this._setStateChanged())}),ta(0,tD,"text",function(){return this.createText(),this._text}),ta(0,tD,"stateNum",function(){return this._stateNum},function(tD){"string"==typeof tD&&(tD=parseInt(tD)),this._stateNum!=tD&&(this._stateNum=tD<1?1:3<tD?3:tD,this.callLater(this.changeClips))}),ta(0,tD,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(tD){this._strokeColors=tz.fillArray(tX.buttonLabelColors,tD,String),this._setStateChanged()}),ta(0,tD,"labelColors",function(){return this._labelColors.join(",")},function(tD){this._labelColors=tz.fillArray(tX.buttonLabelColors,tD,String),this._setStateChanged()}),ta(0,tD,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),ta(0,tD,"label",function(){return this._text?this._text.text:null},function(tD){(this._text||tD)&&(this.createText(),this._text.text!=tD&&(tD&&!this._text.parent&&this.addChild(this._text),this._text.text=(tD+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),ta(0,tD,"selected",function(){return this._selected},function(tD){this._selected!=tD&&(this._selected=tD,this.state=this._selected?2:0,this.event("change"))}),ta(0,tD,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(tD){this.createText(),this._text.padding=tz.fillArray(tX.labelPadding,tD,Number)}),ta(0,tD,"labelSize",function(){return this.createText(),this._text.fontSize},function(tD){this.createText(),this._text.fontSize=tD}),ta(0,tD,"labelStroke",function(){return this.createText(),this._text.stroke},function(tD){this.createText(),this._text.stroke=tD}),ta(0,tD,"labelBold",function(){return this.createText(),this._text.bold},function(tD){this.createText(),this._text.bold=tD}),ta(0,tD,"labelFont",function(){return this.createText(),this._text.font},function(tD){this.createText(),this._text.font=tD}),ta(0,tD,"labelAlign",function(){return this.createText(),this._text.align},function(tD){this.createText(),this._text.align=tD}),ta(0,tD,"clickHandler",function(){return this._clickHandler},function(tD){this._clickHandler=tD}),ta(0,tD,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(tD){this._bitmap.sizeGrid=tz.fillArray(tX.defaultSizeGrid,tD,Number)}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(ti,this,"width",tD),this._autoSize&&(this._bitmap.width=tD,this._text&&(this._text.width=tD))}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(ti,this,"height",tD),this._autoSize&&(this._bitmap.height=tD,this._text&&(this._text.height=tD))}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)||"string"==typeof tD?this.label=tD+"":td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(tD){this._bitmap._offset=tD?tz.fillArray([1,1],tD,Number):[]}),tT(tg,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),tg}(ti),tv=function(tY){function tT(tD,tY,tg){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,tT.__super.call(this),void 0===tY&&(tY=1),void 0===tg&&(tg=1),this._clipX=tY,this._clipY=tg,this.skin=tD}ts(tT,"laya.ui.Clip",tY);var tD=tT.prototype;return tD.destroy=function(tD){this.clearEvent(),this.clearLoad(),tj.clearCache(this,this._skin),tj.clearObject(this,this._weakKey),void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},tD.dispose=function(){this.destroy(!0),td.loader.clearRes(this._skin)},tD.createChildren=function(){this.graphics=this._bitmap=new th},tD._onDisplay=function(tD){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},tD.changeClip=function(){if(this._clipChanged=!1,this._skin){var tD=tj.getRes(this._skin);if(tD)this.loadComplete(this._skin,tD);else{if(tr.resAtalsObj&&tr.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=tN.create(this,this.loadComplete,[this._skin]),this._progress=null,td.loader.load(this._skin,this._complete,this._progress)}}},tD.loadComplete=function(tD,tY){if(tD===this._skin&&tY){tj.clearObject(this,this._weakKey);var tg=this._clipWidth||Math.ceil(tY.sourceWidth/this._clipX),tT=this._clipHeight||Math.ceil(tY.sourceHeight/this._clipY),tr=this._skin+tg+tT,ts=tj.findObject(tr);if(tq.isOkTextureList(ts)||(ts=null),ts)this._weakKey=tr,tj.keepObject(this,this._weakKey),this._sources=ts;else{this._sources=[];for(var ta=0;ta<this._clipY;ta++)for(var tW=0;tW<this._clipX;tW++){var tM=t_.createFromTexture(tY,tg*tW,tT*ta,tg,tT);if(tY.alphaTexture){var tE=tY.width/tY.alphaTexture.width;tM.alphaTexture=t_.createFromTexture(tY.alphaTexture,tg*tW/tE,tT*ta/tE,tg/tE,tT/tE)}this._sources.push(tM)}tj.saveObject(tr,this._sources),this._weakKey=tr,tj.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},tD.play=function(tD,tY){void 0===tD&&(tD=0),void 0===tY&&(tY=-1),this._isPlaying=!0,this.index=tD,this._toIndex=tY,this._index++,td.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},tD._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},tD.stop=function(){this._isPlaying=!1,td.timer.clear(this,this._loop),this.event("complete")},tD._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},ta(0,tD,"interval",function(){return this._interval},function(tD){this._interval!=tD&&(this._interval=tD,this._isPlaying&&this.play())}),tD.clearEvent=function(){this._skin&&tr.atalsNotify&&tr.atalsNotify.off(this._skin,this,this._setBtnSource)},tD.clearLoad=function(){this._skin&&((this._complete||this._progress)&&td.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},ta(0,tD,"skin",function(){return this._skin},function(tD){if(tW.window.handleRes&&(tD=tW.window.handleRes(tD)),this._skin!=tD)if(this.clearLoad(),this.clearEvent(),tj.clearCache(this,this._skin),this._skin=tD){tj.keepCache(this,this._skin);var tY=tj.getRes(tD),tg=tr.resAtalsObj&&tr.resAtalsObj[this._skin];!tY&&tg?tr.atalsNotify&&tr.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),tD._setBtnSource=function(tD,tY){tD===this._skin&&tY&&(this.loadComplete(tD,tY),this.clearEvent())},ta(0,tD,"sources",function(){return this._sources},function(tD){this._sources=tD,this.index=this._index,this.event("loaded")}),ta(0,tD,"clipX",function(){return this._clipX},function(tD){this._clipX=tD||1,this._setClipChanged()}),ta(0,tD,"clipY",function(){return this._clipY},function(tD){this._clipY=tD||1,this._setClipChanged()}),ta(0,tD,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),ta(0,tD,"clipWidth",function(){return this._clipWidth},function(tD){this._clipWidth=tD,this._setClipChanged()}),ta(0,tD,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(tD){this._bitmap.sizeGrid=tz.fillArray(tX.defaultSizeGrid,tD,Number)}),ta(0,tD,"group",function(){return this._group},function(tD){tD&&this._skin&&tj.setGroup(this._skin,tD),this._group=tD}),ta(0,tD,"clipHeight",function(){return this._clipHeight},function(tD){this._clipHeight=tD,this._setClipChanged()}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(ti,this,"width",tD),this._bitmap.width=tD}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(ti,this,"height",tD),this._bitmap.height=tD}),ta(0,tD,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),ta(0,tD,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),ta(0,tD,"index",function(){return this._index},function(tD){this._index=tD,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[tD]),this.event("change")}),ta(0,tD,"autoPlay",function(){return this._autoPlay},function(tD){this._autoPlay!=tD&&((this._autoPlay=tD)?this.play():this.stop())}),ta(0,tD,"isPlaying",function(){return this._isPlaying},function(tD){this._isPlaying=tD}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)&&Math.floor(tD)==tD||"string"==typeof tD?this.index=parseInt(tD):td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"bitmap",function(){return this._bitmap}),tT}(ti),tS=function(tY){function tD(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,tD.__super.call(this)}ts(tD,"laya.ui.ColorPicker",tY);var tg=tD.prototype;return tg.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._colorPanel&&this._colorPanel.destroy(tD),this._colorButton&&this._colorButton.destroy(tD),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},tg.createChildren=function(){this.addChild(this._colorButton=new tH),this._colorPanel=new tB,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new tl),this._colorPanel.addChild(this._colorBlock=new tl),this._colorPanel.addChild(this._colorInput=new t$)},tg.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},tg.onPanelMouseDown=function(tD){tD.stopPropagation()},tg.changePanel=function(){this._panelChanged=!1;var tD=this._colorPanel.graphics;tD.clear(),tD.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(tD=this._colorTiles.graphics).clear();for(var tY=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],tg=0;tg<12;tg++)for(var tT=0;tT<20;tT++){var tr=0;tr=0===tT?tY[tg]:1===tT?0:51*(((3*tg+tT/6)%3<<0)+3*(tg/6<<0))<<16|tT%6*51<<8|(tg<<0)%6*51;var ts=tz.toColor(tr);this._colors.push(ts);var ta=tT*this._gridSize,tW=tg*this._gridSize;tD.drawRect(ta,tW,this._gridSize,this._gridSize,ts,"#000000")}},tg.onColorButtonClick=function(tD){this._colorPanel.parent?this.close():this.open()},tg.open=function(){var tD=this.localToGlobal(new tx),tY=tD.x+this._colorPanel.width<=td.stage.width?tD.x:td.stage.width-this._colorPanel.width,tg=tD.y+this._colorButton.height;tg=tg+this._colorPanel.height<=td.stage.height?tg:tD.y-this._colorPanel.height,this._colorPanel.pos(tY,tg),this._colorPanel.zOrder=1001,td._currentStage.addChild(this._colorPanel),td.stage.on("mousedown",this,this.removeColorBox)},tg.close=function(){td.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},tg.removeColorBox=function(tD){this.close()},tg.onColorFieldKeyDown=function(tD){13==tD.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),tD.stopPropagation())},tg.onColorInputChange=function(tD){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},tg.onColorTilesClick=function(tD){this.selectedColor=this.getColorByMouse(),this.close()},tg.onColorTilesMouseMove=function(tD){this._colorInput.focus=!1;var tY=this.getColorByMouse();this._colorInput.text=tY,this.drawBlock(tY)},tg.getColorByMouse=function(){var tD=this._colorTiles.getMousePoint(),tY=Math.floor(tD.x/this._gridSize),tg=Math.floor(tD.y/this._gridSize);return this._colors[20*tg+tY]},tg.drawBlock=function(tD){var tY=this._colorBlock.graphics;tY.clear();var tg=tD||"#ffffff";tY.drawRect(0,0,50,20,tg,this._borderColor),tD||tY.drawLine(0,0,50,20,"#ff0000")},tg.changeColor=function(){var tD=this.graphics;tD.clear();var tY=this._selectedColor||"#000000";tD.drawRect(0,0,this._colorButton.width,this._colorButton.height,tY)},tg._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},ta(0,tg,"inputBgColor",function(){return this._inputBgColor},function(tD){this._inputBgColor=tD,this._setPanelChanged()}),ta(0,tg,"selectedColor",function(){return this._selectedColor},function(tD){this._selectedColor!=tD&&(this._selectedColor=this._colorInput.text=tD,this.drawBlock(tD),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",tI.EMPTY.setTo("change",this,this)))}),ta(0,tg,"skin",function(){return this._colorButton.skin},function(tD){this._colorButton.skin=tD,this.changeColor()}),ta(0,tg,"bgColor",function(){return this._bgColor},function(tD){this._bgColor=tD,this._setPanelChanged()}),ta(0,tg,"borderColor",function(){return this._borderColor},function(tD){this._borderColor=tD,this._setPanelChanged()}),ta(0,tg,"inputColor",function(){return this._inputColor},function(tD){this._inputColor=tD,this._setPanelChanged()}),tD}(ti),tU=function(tY){function tg(tD,tY){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,tg.__super.call(this),this._itemColors=tX.comboBoxItemColors,this.skin=tD,this.labels=tY}ts(tg,"laya.ui.ComboBox",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._button&&this._button.destroy(tD),this._list&&this._list.destroy(tD),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},tD.createChildren=function(){this.addChild(this._button=new tH),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},tD._createList=function(){this._list=new tR,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},tD._setListEvent=function(tD){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=tN.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},tD.onListDown=function(tD){tD.stopPropagation()},tD.onScrollBarDown=function(tD){tD.stopPropagation()},tD.onButtonMouseDown=function(tD){this.callLater(this.switchTo,[!this._isOpen])},tD.changeList=function(){this._listChanged=!1;var tD=this.width-2,tY=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:tD,height:this._itemHeight,fontSize:this._itemSize,color:tY}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},tD.onlistItemMouse=function(tD,tY){var tg=tD.type;if("mouseover"===tg||"mouseout"===tg){if(this._isCustomList)return;var tT=this._list.getCell(tY);if(!tT)return;var tr=tT.getChildByName("label");tr&&("mouseover"===tg?(tr.bgColor=this._itemColors[0],tr.color=this._itemColors[1]):(tr.bgColor=null,tr.color=this._itemColors[2]))}else"click"===tg&&(this.selectedIndex=tY,this.isOpen=!1)},tD.switchTo=function(tD){this.isOpen=tD},tD.changeOpen=function(){this.isOpen=!this._isOpen},tD.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var tD=this._list.graphics;tD.clear(),tD.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var tY=this._list.array||[],tg=tY.length=0,tT=this._labels.length;tg<tT;tg++)tY.push({label:this._labels[tg]});this._list.height=this._listHeight,this._list.array=tY},tD.changeSelected=function(){this._button.label=this.selectedLabel},tD._onStageMouseWheel=function(tD){this._list&&!this._list.contains(tD.target)&&this.removeList(null)},tD.removeList=function(tD){td.stage.off("mousedown",this,this.removeList),td.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},ta(0,tD,"selectedIndex",function(){return this._selectedIndex},function(tD){this._selectedIndex!=tD&&(this._selectedIndex=tD,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[tI.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),ta(0,tD,"measureHeight",function(){return this._button.height}),ta(0,tD,"skin",function(){return this._button.skin},function(tD){this._button.skin!=tD&&(this._button.skin=tD,this._listChanged=!0)}),ta(0,tD,"measureWidth",function(){return this._button.width}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(ti,this,"width",tD),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),ta(0,tD,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(tD){this.selectedIndex=this._labels.indexOf(tD)}),ta(0,tD,"labels",function(){return this._labels.join(",")},function(tD){0<this._labels.length&&(this.selectedIndex=-1),tD?this._labels=tD.split(","):this._labels.length=0,this._itemChanged=!0}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(ti,this,"height",tD),this._button.height=this._height}),ta(0,tD,"selectHandler",function(){return this._selectHandler},function(tD){this._selectHandler=tD}),ta(0,tD,"visibleNum",function(){return this._visibleNum},function(tD){this._visibleNum=tD,this._listChanged=!0}),ta(0,tD,"labelBold",function(){return this._button.text.bold},function(tD){this._button.text.bold=tD}),ta(0,tD,"itemColors",function(){return String(this._itemColors)},function(tD){this._itemColors=tz.fillArray(this._itemColors,tD,String),this._listChanged=!0}),ta(0,tD,"itemSize",function(){return this._itemSize},function(tD){this._itemSize=tD,this._listChanged=!0}),ta(0,tD,"scrollBar",function(){return this.list.scrollBar}),ta(0,tD,"isOpen",function(){return this._isOpen},function(tD){if(this._isOpen!=tD)if(this._isOpen=tD,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var tY=this.localToGlobal(tx.TEMP.setTo(0,0)),tg=tY.y+this._button.height;tg=tg+this._listHeight<=td.stage.height?tg:tY.y-this._listHeight,this._list.pos(tY.x,tg),this._list.zOrder=1001,td._currentStage.addChild(this._list),td.stage.once("mousedown",this,this.removeList),td.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),ta(0,tD,"scrollBarSkin",function(){return this._scrollBarSkin},function(tD){this._scrollBarSkin=tD}),ta(0,tD,"sizeGrid",function(){return this._button.sizeGrid},function(tD){this._button.sizeGrid=tD}),ta(0,tD,"button",function(){return this._button}),ta(0,tD,"list",function(){return this._list||this._createList(),this._list},function(tD){tD&&(tD.removeSelf(),this._isCustomList=!0,this._list=tD,this._setListEvent(tD),this._itemHeight=tD.getCell(0).height+tD.spaceY)}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)&&Math.floor(tD)==tD||"string"==typeof tD?this.selectedIndex=parseInt(tD):tD instanceof Array?this.labels=tD.join(","):td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"labelColors",function(){return this._button.labelColors},function(tD){this._button.labelColors!=tD&&(this._button.labelColors=tD)}),ta(0,tD,"labelPadding",function(){return this._button.text.padding.join(",")},function(tD){this._button.text.padding=tz.fillArray(tX.labelPadding,tD,Number)}),ta(0,tD,"labelSize",function(){return this._button.text.fontSize},function(tD){this._button.text.fontSize=tD}),ta(0,tD,"labelFont",function(){return this._button.text.font},function(tD){this._button.text.font=tD}),ta(0,tD,"stateNum",function(){return this._button.stateNum},function(tD){this._button.stateNum=tD}),tg}(ti),tF=function(tY){function tg(tD){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=200,this.elasticBackTime=100,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,tg.__super.call(this),this._showButtons=tm.showButtons,this._touchScrollEnable=tm.touchScrollEnable,this._mouseWheelEnable=tm.mouseWheelEnable,this.skin=tD,this.max=1}ts(tg,"laya.ui.ScrollBar",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),this.stopScroll(),this.target=null,tY.prototype.destroy.call(this,tD),this.upButton&&this.upButton.destroy(tD),this.downButton&&this.downButton.destroy(tD),this.slider&&this.slider.destroy(tD),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},tD.createChildren=function(){this.addChild(this.slider=new tV),this.addChild(this.upButton=new tH),this.addChild(this.downButton=new tH)},tD.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},tD.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},tD.onButtonMouseDown=function(tD){var tY=tD.currentTarget===this.upButton;this.slide(tY),td.timer.once(tX.scrollBarDelayTime,this,this.startLoop,[tY]),td.stage.once("mouseup",this,this.onStageMouseUp)},tD.startLoop=function(tD){td.timer.frameLoop(1,this,this.slide,[tD])},tD.slide=function(tD){tD?this.value-=this._scrollSize:this.value+=this._scrollSize},tD.onStageMouseUp=function(tD){td.timer.clear(this,this.startLoop),td.timer.clear(this,this.slide)},tD.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},tD.changeSize=function(){tY.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},tD.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},tD.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},tD.setScroll=function(tD,tY,tg){this.runCallLater(this.changeSize),this.slider.setSlider(tD,tY,tg),this.slider.bar.visible=0<tY,!this._hide&&this.autoHide&&(this.visible=!1)},tD.onTargetMouseWheel=function(tD){this.value-=tD.delta*this._scrollSize,this.target=this._target},tD.onTargetMouseDown=function(tD){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new tx),this._lastPoint.setTo(td.stage.mouseX,td.stage.mouseY),td.timer.clear(this,this.tweenMove),tA.clearTween(this),td.stage.once("mouseup",this,this.onStageMouseUp2),td.stage.once("mouseout",this,this.onStageMouseUp2),td.timer.frameLoop(1,this,this.loop)},tD.loop=function(){var tD=td.stage.mouseY,tY=td.stage.mouseX;if(this._lastOffset=this.isVertical?tD-this._lastPoint.y:tY-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?td.stage._canvasTransform.getScaleY():td.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=tY,this._lastPoint.y=tD,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},tD.onStageMouseUp2=function(tD){if(td.stage.off("mouseup",this,this.onStageMouseUp2),td.stage.off("mouseout",this,this.onStageMouseUp2),td.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?tA.to(this,{value:this.min},this.elasticBackTime,tE.sineOut,tN.create(this,this.elasticOver)):this._value>this.max&&tA.to(this,{value:this.max},this.elasticBackTime,tE.sineOut,tN.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?td.stage.mouseY-this._lastPoint.y:td.stage.mouseX-this._lastPoint.x);for(var tY=0,tg=Math.min(this._offsets.length,3),tT=0;tT<tg;tT++)tY+=this._offsets[this._offsets.length-1-tT];if(this._lastOffset=tY/tg,(tY=Math.abs(this._lastOffset))<2)return void this.event("end");60<tY&&(this._lastOffset=0<this._lastOffset?60:-60);var tr=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));td.timer.frameLoop(1,this,this.tweenMove,[tr])}},tD.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&tA.to(this,{alpha:0},500),this.event("end")},tD.tweenMove=function(tD){this._lastOffset*=this.rollRatio;var tY=NaN;if(100<tD&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,tY=.5*-(this.min-tD-this.value),this._lastOffset>tY&&(this._lastOffset=tY)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,tY=.5*-(this.max+tD-this.value),this._lastOffset<tY&&(this._lastOffset=tY))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(td.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?tA.to(this,{value:this.min},this.elasticBackTime,tE.sineOut,tN.create(this,this.elasticOver)):this._value>this.max?tA.to(this,{value:this.max},this.elasticBackTime,tE.sineOut,tN.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&tA.to(this,{alpha:0},500)}},tD.stopScroll=function(){this.onStageMouseUp2(null),td.timer.clear(this,this.tweenMove),tA.clearTween(this)},ta(0,tD,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),ta(0,tD,"skin",function(){return this._skin},function(tD){this._skin!=tD&&(this._skin=tD,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),ta(0,tD,"max",function(){return this.slider.max},function(tD){this.slider.max=tD}),ta(0,tD,"showButtons",function(){return this._showButtons},function(tD){this._showButtons=tD,this.callLater(this.changeScrollBar)}),ta(0,tD,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),ta(0,tD,"min",function(){return this.slider.min},function(tD){this.slider.min=tD}),ta(0,tD,"value",function(){return this._value},function(tD){tD!==this._value&&(this._value=tD,this._isElastic||(this.slider._value!=tD&&(this.slider._value=tD,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),ta(0,tD,"isVertical",function(){return this.slider.isVertical},function(tD){this.slider.isVertical=tD}),ta(0,tD,"sizeGrid",function(){return this.slider.sizeGrid},function(tD){this.slider.sizeGrid=tD}),ta(0,tD,"scrollSize",function(){return this._scrollSize},function(tD){this._scrollSize=tD}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)||"string"==typeof tD?this.value=Number(tD):td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"thumbPercent",function(){return this._thumbPercent},function(tD){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),tD=1<=tD?.99:tD,this._thumbPercent=tD,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*tD,tX.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*tD,tX.scrollBarMinNum))}),ta(0,tD,"target",function(){return this._target},function(tD){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=tD)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),ta(0,tD,"hide",function(){return this._hide},function(tD){this._hide=tD,this.visible=!tD}),ta(0,tD,"touchScrollEnable",function(){return this._touchScrollEnable},function(tD){this._touchScrollEnable=tD,this.target=this._target}),ta(0,tD,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(tD){this._mouseWheelEnable=tD,this.target=this._target}),ta(0,tD,"tick",function(){return this.slider.tick},function(tD){this.slider.tick=tD}),tg}(ti),tV=function(tY){function tg(tD){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,tg.__super.call(this),this.skin=tD}ts(tg,"laya.ui.Slider",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._bg&&this._bg.destroy(tD),this._bar&&this._bar.destroy(tD),this._progress&&this._progress.destroy(tD),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},tD.createChildren=function(){this.addChild(this._bg=new tc),this.addChild(this._bar=new tH)},tD.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},tD.onBarMouseDown=function(tD){this._globalSacle||(this._globalSacle=new tx),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=td.stage.mouseX,this._ty=td.stage.mouseY,td.stage.on("mousemove",this,this.mouseMove),td.stage.once("mouseup",this,this.mouseUp),td.stage.once("mouseout",this,this.mouseUp),this.showValueText()},tD.showValueText=function(){if(this.showLabel){var tD=laya.ui.Slider.label;this.addChild(tD),tD.textField.changeText(this._value+""),this.isVertical?(tD.x=this._bar.x+20,tD.y=.5*(this._bar.height-tD.height)+this._bar.y):(tD.y=this._bar.y-20,tD.x=.5*(this._bar.width-tD.width)+this._bar.x)}},tD.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},tD.mouseUp=function(tD){td.stage.off("mousemove",this,this.mouseMove),td.stage.off("mouseup",this,this.mouseUp),td.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},tD.mouseMove=function(tD){var tY=this._value;this.isVertical?(this._bar.y+=(td.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(td.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=td.stage.mouseX,this._ty=td.stage.mouseY;var tg=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*tg)/tg,this._value!=tY&&this.sendChangeEvent(),this.showValueText()},tD.sendChangeEvent=function(tD){void 0===tD&&(tD="change"),this.event(tD),this.changeHandler&&this.changeHandler.runWith(this._value)},tD.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},tD.changeSize=function(){tY.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},tD.setSlider=function(tD,tY,tg){this._value=-1,this._min=tD,this._max=tD<tY?tY:tD,this.value=tg<tD?tD:tY<tg?tY:tg},tD.changeValue=function(){var tD=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*tD)/tD,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var tY=this._max-this._min;0===tY&&(tY=1),this.isVertical?(this._bar.y=(this._value-this._min)/tY*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/tY*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},tD.onBgMouseDown=function(tD){var tY=this._bg.getMousePoint();this.isVertical?this.value=tY.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=tY.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},ta(0,tD,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),ta(0,tD,"skin",function(){return this._skin},function(tD){if(tW.window.handleRes&&(tD=tW.window.handleRes(tD)),this._skin!=tD){this._skin=tD,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var tY=this._skin.replace(".png","$progress.png");tj.getRes(tY)&&(this._progress||(this.addChild(this._progress=new tc),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=tY),this.setBarPoint(),this.callLater(this.changeValue)}}),ta(0,tD,"allowClickBack",function(){return this._allowClickBack},function(tD){this._allowClickBack!=tD&&((this._allowClickBack=tD)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),ta(0,tD,"max",function(){return this._max},function(tD){this._max!=tD&&(this._max=tD,this.callLater(this.changeValue))}),ta(0,tD,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),ta(0,tD,"tick",function(){return this._tick},function(tD){this._tick!=tD&&(this._tick=tD,this.callLater(this.changeValue))}),ta(0,tD,"sizeGrid",function(){return this._bg.sizeGrid},function(tD){this._bg.sizeGrid=tD,this._bar.sizeGrid=tD,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),ta(0,tD,"min",function(){return this._min},function(tD){this._min!=tD&&(this._min=tD,this.callLater(this.changeValue))}),ta(0,tD,"value",function(){return this._value},function(tD){if(this._value!=tD){var tY=this._value;this._value=tD,this.changeValue(),this._value!=tY&&this.sendChangeEvent()}}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)||"string"==typeof tD?this.value=Number(tD):td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"bar",function(){return this._bar}),tT(tg,["label",function(){return this.label=new tf}]),tg}(ti),tc=function(tY){function tg(tD){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,tg.__super.call(this),this.skin=tD}ts(tg,"laya.ui.Image",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,tj.clearCache(this,this._skin)},tD.dispose=function(){this.destroy(!0),tj.clearCache(this,this._skin),this.clearEvent()},tD.createChildren=function(){this.graphics=this._bitmap=new th},tD.setSource=function(tD,tY){this.destroyed||tD===this._skin&&tY&&(this.source=tY,this.onCompResize(),this.clearEvent())},tD.clearEvent=function(){this._skin&&tr.atalsNotify&&tr.atalsNotify.off(this._skin,this,this.setSource)},tD.clearLoad=function(){this._skin&&((this._complete||this._progress)&&td.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},ta(0,tD,"source",function(){return this._bitmap.source},function(tD){this._bitmap&&(this._bitmap.source=tD,this.event("loaded"),this.repaint())}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"string"==typeof(this._dataSource=tD)?this.skin=tD:td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"measureHeight",function(){return this._bitmap.height}),ta(0,tD,"skin",function(){return this._skin},function(tD){if(tW.window.handleRes&&(tD=tW.window.handleRes(tD)),this._skin!=tD)if(tj.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=tD){tj.keepCache(this,this._skin);var tY=tj.getRes(tD),tg=tr.resAtalsObj&&tr.resAtalsObj[this._skin];tY?(this.source=tY,this.onCompResize()):tg?(tr.atalsNotify&&tr.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=tg.sourceW),0==this.height&&(this.height=tg.sourceH)):(this._complete=tN.create(this,this.setSource,[this._skin]),this._progress=null,td.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),ta(0,tD,"group",function(){return this._group},function(tD){tD&&this._skin&&tj.setGroup(this._skin,tD),this._group=tD}),ta(0,tD,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(tD){this._bitmap.sizeGrid=tz.fillArray(tX.defaultSizeGrid,tD,Number)}),ta(0,tD,"measureWidth",function(){return this._bitmap.width}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(ti,this,"width",tD),this._bitmap.width=0==tD?1e-7:tD}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(ti,this,"height",tD),this._bitmap.height=0==tD?1e-7:tD}),tg}(ti),tf=function(tY){function tg(tD){this._tf=null,tg.__super.call(this),void 0===tD&&(tD=""),tO.defaultColor=tX.labelColor,this.text=tD}ts(tg,"laya.ui.Label",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._tf=null},tD.createChildren=function(){this.addChild(this._tf=new tt)},tD.changeText=function(tD){this._tf.changeText(tD)},ta(0,tD,"padding",function(){return this._tf.padding.join(",")},function(tD){this._tf.padding=tz.fillArray(tX.labelPadding,tD,Number)}),ta(0,tD,"bold",function(){return this._tf.bold},function(tD){this._tf.bold=tD}),ta(0,tD,"align",function(){return this._tf.align},function(tD){this._tf.align=tD}),ta(0,tD,"text",function(){return this._tf.text},function(tD){this._tf.text!=tD&&(tD&&(tD=tz.adptString(tD+"")),this._tf.text=tD,this.event("change"),this._width&&this._height||this.onCompResize())}),ta(0,tD,"italic",function(){return this._tf.italic},function(tD){this._tf.italic=tD}),ta(0,tD,"wordWrap",function(){return this._tf.wordWrap},function(tD){this._tf.wordWrap=tD}),ta(0,tD,"font",function(){return this._tf.font},function(tD){this._tf.font=tD}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)||"string"==typeof tD?this.text=tD+"":td.superSet(ti,this,"dataSource",tD)}),ta(0,tD,"color",function(){return this._tf.color},function(tD){this._tf.color=tD}),ta(0,tD,"valign",function(){return this._tf.valign},function(tD){this._tf.valign=tD}),ta(0,tD,"leading",function(){return this._tf.leading},function(tD){this._tf.leading=tD}),ta(0,tD,"fontSize",function(){return this._tf.fontSize},function(tD){this._tf.fontSize=tD}),ta(0,tD,"bgColor",function(){return this._tf.bgColor},function(tD){this._tf.bgColor=tD}),ta(0,tD,"borderColor",function(){return this._tf.borderColor},function(tD){this._tf.borderColor=tD}),ta(0,tD,"stroke",function(){return this._tf.stroke},function(tD){this._tf.stroke=tD}),ta(0,tD,"strokeColor",function(){return this._tf.strokeColor},function(tD){this._tf.strokeColor=tD}),ta(0,tD,"textField",function(){return this._tf}),ta(0,tD,"measureWidth",function(){return this._tf.width}),ta(0,tD,"measureHeight",function(){return this._tf.height}),ta(0,tD,"width",function(){return this._width||this._tf.text?td.superGet(ti,this,"width"):0},function(tD){td.superSet(ti,this,"width",tD),this._tf.width=tD}),ta(0,tD,"height",function(){return this._height||this._tf.text?td.superGet(ti,this,"height"):0},function(tD){td.superSet(ti,this,"height",tD),this._tf.height=tD}),ta(0,tD,"overflow",function(){return this._tf.overflow},function(tD){this._tf.overflow=tD}),ta(0,tD,"underline",function(){return this._tf.underline},function(tD){this._tf.underline=tD}),ta(0,tD,"underlineColor",function(){return this._tf.underlineColor},function(tD){this._tf.underlineColor=tD}),tg}(ti),te=function(tY){function tg(tD){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,tg.__super.call(this),this.skin=tD}ts(tg,"laya.ui.ProgressBar",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._bg&&this._bg.destroy(tD),this._bar&&this._bar.destroy(tD),this._bg=this._bar=null,this.changeHandler=null},tD.createChildren=function(){this.addChild(this._bg=new tc),this.addChild(this._bar=new tc)},tD.changeValue=function(){if(this.sizeGrid){var tD=this.sizeGrid.split(","),tY=Number(tD[3]),tg=Number(tD[1]),tT=(this.width-tY-tg)*this._value;this._bar.width=tY+tg+tT,this._bar.visible=this._bar.width>tY+tg}else this._bar.width=this.width*this._value},ta(0,tD,"measureHeight",function(){return this._bg.height}),ta(0,tD,"skin",function(){return this._skin},function(tD){this._skin!=tD&&(this._skin=tD,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),ta(0,tD,"measureWidth",function(){return this._bg.width}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(ti,this,"height",tD),this._bg.height=this._height,this._bar.height=this._height}),ta(0,tD,"bar",function(){return this._bar}),ta(0,tD,"value",function(){return this._value},function(tD){this._value!=tD&&(tD=1<tD?1:tD<0?0:tD,this._value=tD,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(tD))}),ta(0,tD,"bg",function(){return this._bg}),ta(0,tD,"sizeGrid",function(){return this._bg.sizeGrid},function(tD){this._bg.sizeGrid=this._bar.sizeGrid=tD}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(ti,this,"width",tD),this._bg.width=this._width,this.callLater(this.changeValue)}),ta(0,tD,"dataSource",tY.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)||"string"==typeof tD?this.value=Number(tD):td.superSet(ti,this,"dataSource",tD)}),tg}(ti),tk=(function(tD){function tg(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,tg.__super.call(this),this._tipBox=new ti,this._tipBox.addChild(this._tipText=new tt),this._tipText.x=this._tipText.y=5,this._tipText.color=tg.tipTextColor,this._defaultTipHandler=this._showDefaultTip,td.stage.on("showtip",this,this._onStageShowTip),td.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}ts(tg,"laya.ui.TipManager",ti);var tY=tg.prototype;tY._onStageHideTip=function(tD){td.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},tY._onStageShowTip=function(tD){td.timer.once(tg.tipDelay,this,this._showTip,[tD],!0)},tY._showTip=function(tD){if("string"==typeof tD){var tY=String(tD);Boolean(tY)&&this._defaultTipHandler(tY)}else tD instanceof laya.utils.Handler?tD.run():"function"==typeof tD&&tD.apply();td.stage.on("mousemove",this,this._onStageMouseMove),td.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},tY._onStageMouseDown=function(tD){this.closeAll()},tY._onStageMouseMove=function(tD){this._showToStage(this,tg.offsetX,tg.offsetY)},tY._showToStage=function(tD,tY,tg){void 0===tY&&(tY=0),void 0===tg&&(tg=0);var tT=tD.getBounds();tD.x=td.stage.mouseX+tY,tD.y=td.stage.mouseY+tg,tD.x+tT.width>td.stage.width&&(tD.x-=tT.width+tY),tD.y+tT.height>td.stage.height&&(tD.y-=tT.height+tg)},tY.closeAll=function(){td.timer.clear(this,this._showTip),td.stage.off("mousemove",this,this._onStageMouseMove),td.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},tY.showDislayTip=function(tD){this.addChild(tD),this._showToStage(this),td._currentStage.addChild(this)},tY._showDefaultTip=function(tD){this._tipText.text=tD;var tY=this._tipBox.graphics;tY.clear(),tY.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,tg.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),td._currentStage.addChild(this)},ta(0,tY,"defaultTipHandler",function(){return this._defaultTipHandler},function(tD){this._defaultTipHandler=tD}),tg.offsetX=10,tg.offsetY=15,tg.tipTextColor="#ffffff",tg.tipBackColor="#111111",tg.tipDelay=200}(),function(tD){var tN;function t$(){this._idMap=null,this._aniList=null,this._watchMap={},t$.__super.call(this)}ts(t$,"laya.ui.View",tB);var tY=t$.prototype;return tY.createView=function(tD){if(tD.animations&&!this._idMap&&(this._idMap={}),t$.createComp(tD,this,this),tD.animations){var tY,tg,tT=[],tr=tD.animations,ts=0,ta=tr.length;for(ts=0;ts<ta;ts++){switch(tY=new tC,tg=tr[ts],tY._setUp(this._idMap,tg),(this[tg.name]=tY)._setControlNode(this),tg.action){case 1:tY.play(0,!1);break;case 2:tY.play(0,!0)}tT.push(tY)}this._aniList=tT}0<this._width&&null==tD.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},tY.onEvent=function(tD,tY){},tY.loadUI=function(tD){var tY=t$.uiMap[tD];tY&&this.createView(tY)},tY.destroy=function(tD){void 0===tD&&(tD=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,tD)},tY.changeData=function(tD){var tY=this._watchMap[tD];if(tY){console.log("change",tD);for(var tg=0,tT=tY.length;tg<tT;tg++){tY[tg].exe(this)}}},t$._regs=function(){for(var tD in t$.uiClassMap)tJ.regClass(tD,t$.uiClassMap[tD])},t$.createComp=function(tD,tY,tg,tT){if(!(tY=tY||t$.getCompInstance(tD)))return console.warn("can not create:"+tD.type),null;var tr=tD.child;if(tr)for(var ts=tY instanceof laya.ui.List,ta=0,tW=tr.length;ta<tW;ta++){var tM=tr[ta];if(!tY.hasOwnProperty("itemRender")||"render"!=tM.props.name&&"render"!==tM.props.renderType)if("Graphic"==tM.type)tJ.addGraphicsToSprite(tM,tY);else if(tJ.isDrawType(tM.type))tJ.addGraphicToSprite(tM,tY,!0);else{if(ts){var tE=[],tI=t$.createComp(tM,null,tg,tE);tE.length&&(tI._$bindData=tE)}else tI=t$.createComp(tM,null,tg,tT);"Script"==tM.type?"owner"in tI?tI.owner=tY:"target"in tI&&(tI.target=tY):"mask"==tM.props.renderType||"mask"==tM.props.name?tY.mask=tI:tI instanceof laya.display.Sprite&&tY.addChild(tI)}else tY.itemRender=tM}var tO=tD.props;for(var tC in tO){var tN=tO[tC];t$.eventDic[tC]?tN&&tg&&tY.on(tC,tg,tg.onEvent,[tN]):t$.setCompValue(tY,tC,tN,tg,tT)}return td.__typeof(tY,"laya.ui.IItem")&&tY.initItems(),tD.compId&&tg&&tg._idMap&&(tg._idMap[tD.compId]=tY),tY},t$.setCompValue=function(tD,tY,tg,tT,tr){if("string"==typeof tg&&-1<tg.indexOf("${")){if(t$._sheet||(t$._sheet=tJ.getClass("laya.data.Table")),!t$._sheet)return void console.warn("Can not find class Sheet");if(tr)tr.push(tD,tY,tg);else if(tT){-1==tg.indexOf("].")&&(tg=tg.replace(".","[0]."));var ts,ta,tW=new tN(tD,tY,tg);tW.exe(tT);for(var tM=tg.replace(/\[.*?\]\./g,".");null!=(ts=t$._parseWatchData.exec(tM));){for(var tE=ts[1];null!=(ta=t$._parseKeyWord.exec(tE));){var tI=ta[0],tO=tT._watchMap[tI]||(tT._watchMap[tI]=[]);tO.push(tW),t$._sheet.I.notifer.on(tI,tT,tT.changeData,[tI])}(tO=tT._watchMap[tE]||(tT._watchMap[tE]=[])).push(tW),t$._sheet.I.notifer.on(tE,tT,tT.changeData,[tE])}}}else if("var"===tY&&tT)tT[tg]=tD;else if("onClick"==tY){var tC=td._runScript("(function(){"+tg+"})");tD.on("click",tT,tC)}else tD[tY]="true"===tg||"false"!==tg&&tg},t$.getCompInstance=function(tD){var tY,tg=tD.props?tD.props.runtime:null;return tY=tg?t$.viewClassMap[tg]||t$.uiClassMap[tg]||td.__classmap[tg]:t$.uiClassMap[tD.type],tD.props&&tD.props.hasOwnProperty("renderType")&&"instance"==tD.props.renderType?tY.instance:tY?new tY:null},t$.regComponent=function(tD,tY){t$.uiClassMap[tD]=tY,tJ.regClass(tD,tY)},t$.regViewRuntime=function(tD,tY){t$.viewClassMap[tD]=tY},t$.uiMap={},t$.viewClassMap={},t$._sheet=null,tT(t$,["uiClassMap",function(){return this.uiClassMap={ViewStack:tYD,LinkButton:tH,TextArea:tID,ColorPicker:tS,Box:tB,Button:tH,CheckBox:tw,Clip:tv,ComboBox:tU,Component:ti,HScrollBar:tQ,HSlider:ty,Image:tc,Label:tf,List:tR,Panel:tL,ProgressBar:te,Radio:tn,RadioGroup:tMD,ScrollBar:tF,Slider:tV,Tab:tED,TextInput:tTD,View:t$,VScrollBar:tgD,VSlider:trD,Tree:tDD,HBox:taD,VBox:tWD,Sprite:tl,Animation:tg,Text:tt,FontClip:to}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),t$.__init$=function(){t$._regs(),tN=function(){function tD(tD,tY,tg){this.comp=null,this.prop=null,this.value=null,this.comp=tD,this.prop=tY,this.value=tg}return ts(tD,""),tD.prototype.exe=function(tD){var tY=tz.getBindFun(this.value);this.comp[this.prop]=tY.call(this,tD)},tD}()},t$}()),tw=function(tD){function tg(tD,tY){void 0===tY&&(tY=""),tg.__super.call(this,tD,tY)}ts(tg,"laya.ui.CheckBox",tD);var tY=tg.prototype;return tY.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},tY.initialize=function(){tD.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},ta(0,tY,"dataSource",tD.prototype._$get_dataSource,function(tD){"boolean"==typeof(this._dataSource=tD)?this.selected=tD:"string"==typeof tD?this.selected="true"===tD:td.superSet(tH,this,"dataSource",tD)}),tg}(tH),tK=function(tD){function tY(){this._space=0,this._align="none",this._itemChanged=!1,tY.__super.call(this)}ts(tY,"laya.ui.LayoutBox",tB);var tg=tY.prototype;return tg.addChild=function(tD){return tD.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,tD)},tg.onResize=function(tD){this._setItemChanged()},tg.addChildAt=function(tD,tY){return tD.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,tD,tY)},tg.removeChild=function(tD){return tD.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,tD)},tg.removeChildAt=function(tD){return this.getChildAt(tD).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,tD)},tg.refresh=function(){this._setItemChanged()},tg.changeItems=function(){this._itemChanged=!1},tg.sortItem=function(tD){tD&&tD.sort(function(tD,tY){return tD.y-tY.y})},tg._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},ta(0,tg,"space",function(){return this._space},function(tD){this._space=tD,this._setItemChanged()}),ta(0,tg,"align",function(){return this._align},function(tD){this._align=tD,this._setItemChanged()}),tY}(),to=function(tY){function tg(tD,tY){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,tg.__super.call(this),tD&&(this.skin=tD),tY&&(this.sheet=tY)}ts(tg,"laya.ui.FontClip",tY);var tD=tg.prototype;return tD.createChildren=function(){this._bitmap=new th,this.on("loaded",this,this._onClipLoaded)},tD._onClipLoaded=function(){this.callLater(this.changeValue)},tD.changeValue=function(){var tD;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),tD=this._sources[0]))){var tY="horizontal"===this._direction;tY?(this._wordsW=this._valueArr.length*(tD.sourceWidth+this.spaceX),this._wordsH=tD.sourceHeight):(this._wordsW=tD.sourceWidth,this._wordsH=(tD.sourceHeight+this.spaceY)*this._valueArr.length);var tg=0;if(this._width)switch(this._align){case"center":tg=.5*(this._width-this._wordsW);break;case"right":tg=this._width-this._wordsW;break;default:tg=0}for(var tT=0,tr=this._valueArr.length;tT<tr;tT++){var ts=this._indexMap[this._valueArr.charAt(tT)];this.sources[ts]&&(tD=this.sources[ts],tY?this.graphics.drawTexture(tD,tg+tT*(tD.sourceWidth+this.spaceX),0,tD.sourceWidth,tD.sourceHeight):this.graphics.drawTexture(tD,0+tg,tT*(tD.sourceHeight+this.spaceY),tD.sourceWidth,tD.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},tD.destroy=function(tD){void 0===tD&&(tD=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),tY.prototype.destroy.call(this,tD)},ta(0,tD,"sheet",function(){return this._sheet},function(tD){tD+="";var tY=(this._sheet=tD).split(" ");this._clipX=String(tY[0]).length,this.clipY=tY.length,this._indexMap={};for(var tg=0;tg<this._clipY;tg++)for(var tT=tY[tg].split(""),tr=0,ts=tT.length;tr<ts;tr++)this._indexMap[tT[tr]]=tg*this._clipX+tr}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(tv,this,"height",tD),this.callLater(this.changeValue)}),ta(0,tD,"direction",function(){return this._direction},function(tD){this._direction=tD,this.callLater(this.changeValue)}),ta(0,tD,"value",function(){return this._valueArr?this._valueArr:""},function(tD){tD+="",this._valueArr=tD,this.callLater(this.changeValue)}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(tv,this,"width",tD),this.callLater(this.changeValue)}),ta(0,tD,"spaceX",function(){return this._spaceX},function(tD){this._spaceX=tD,"horizontal"===this._direction&&this.callLater(this.changeValue)}),ta(0,tD,"spaceY",function(){return this._spaceY},function(tD){this._spaceY=tD,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),ta(0,tD,"align",function(){return this._align},function(tD){this._align=tD,this.callLater(this.changeValue)}),ta(0,tD,"measureWidth",function(){return this._wordsW}),ta(0,tD,"measureHeight",function(){return this._wordsH}),tg}(tv),tR=function(tD){function tY(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new tx,tY.__super.call(this)}ts(tY,"laya.ui.List",tD);var tg=tY.prototype;return td.imps(tg,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),tg.destroy=function(tD){void 0===tD&&(tD=!0),this._content&&this._content.destroy(tD),this._scrollBar&&this._scrollBar.destroy(tD),laya.ui.Component.prototype.destroy.call(this,tD),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},tg.createChildren=function(){this.addChild(this._content=new tB)},tg.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=td.superGet(tB,this,"cacheAs")),td.superSet(tB,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},tg.onScrollEnd=function(){td.superSet(tB,this,"cacheAs",this._$P.cacheAs)},tg._removePreScrollBar=function(){var tD=this.removeChildByName("scrollBar");tD&&tD.destroy(!0)},tg.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var tD=this._getOneCell(),tY=tD.width+this._spaceX||1,tg=tD.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/tY):Math.ceil(this._width/tY)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/tg):Math.round(this._height/tg));var tT=this._width?this._width:tY*this.repeatX-this._spaceX,tr=this._height?this._height:tg*this.repeatY-this._spaceY;this._cellSize=this._isVertical?tg:tY,this._cellOffset=this._isVertical?tg*Math.max(this._repeatY2,this._repeatY)-tr-this._spaceY:tY*Math.max(this._repeatX2,this._repeatX)-tT-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=tr:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=tT),this.setContentSize(tT,tr);var ts=this._isVertical?this.repeatX:this.repeatY,ta=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,ts,ta),this._createdLine=ta,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},tg._getOneCell=function(){if(0===this._cells.length){var tD=this.createItem();if(this._offset.setTo(tD.x,tD.y),this.cacheContent)return tD;this._cells.push(tD)}return this._cells[0]},tg._createItems=function(tD,tY,tg){var tT=this._content,tr=this._getOneCell(),ts=tr.width+this._spaceX,ta=tr.height+this._spaceY;if(this.cacheContent){var tW=new tB;tW.cacheAsBitmap=!0,tW.pos((this._isVertical?0:tD)*ts,(this._isVertical?tD:0)*ta),this._content.addChild(tW),this._content.optimizeScrollRect=!0,tT=tW}else{for(var tM=[],tE=this._cells.length-1;-1<tE;tE--){var tI=this._cells[tE];tI.removeSelf(),tM.push(tI)}this._cells.length=0}for(var tO=tD;tO<tg;tO++)for(var tC=0;tC<tY;tC++)(tr=tM&&tM.length?tM.pop():this.createItem()).x=(this._isVertical?tC:tO)*ts-tT.x,tr.y=(this._isVertical?tO:tC)*ta-tT.y,tr.name="item"+(tO*tY+tC),tT.addChild(tr),this.addCell(tr)},tg.createItem=function(){var tD=[];if("function"==typeof this._itemRender)var tY=new this._itemRender;else tY=tk.createComp(this._itemRender,null,null,tD);if(0==tD.length&&tY._watchMap){var tg=tY._watchMap;for(var tT in tg)for(var tr=tg[tT],ts=0;ts<tr.length;ts++){var ta=tr[ts];tD.push(ta.comp,ta.prop,ta.value)}}return tD.length&&(tY._$bindData=tD),tY},tg.addCell=function(tD){tD.on("click",this,this.onCellMouse),tD.on("rightclick",this,this.onCellMouse),tD.on("mouseover",this,this.onCellMouse),tD.on("mouseout",this,this.onCellMouse),tD.on("mousedown",this,this.onCellMouse),tD.on("mouseup",this,this.onCellMouse),this._cells.push(tD)},tg.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var tD=0,tY=tD=0;tY<1e4;tY++){var tg=this.getChildByName("item"+tY);if(!tg)break;this.addCell(tg),tD++}this.repeatY=tD}},tg.setContentSize=function(tD,tY){this._content.width=tD,this._content.height=tY,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new tZ),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,tD,tY),this._content.scrollRect=this._content.scrollRect),this.event("resize")},tg.onCellMouse=function(tD){"mousedown"===tD.type&&(this._isMoved=!1);var tY=tD.currentTarget,tg=this._startIndex+this._cells.indexOf(tY);tg<0||("click"===tD.type||"rightclick"===tD.type?this.selectEnable&&!this._isMoved?this.selectedIndex=tg:this.changeCellState(tY,!0,0):"mouseover"!==tD.type&&"mouseout"!==tD.type||this._selectedIndex===tg||this.changeCellState(tY,"mouseover"===tD.type,0),this.mouseHandler&&this.mouseHandler.runWith([tD,tg]))},tg.changeCellState=function(tD,tY,tg){var tT=tD.getChildByName("selectBox");tT&&(this.selectEnable=!0,tT.visible=tY,tT.index=tg)},tg.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},tg.onScrollBarChange=function(tD){this.runCallLater(this.changeCells);var tY=this._scrollBar.value,tg=this._isVertical?this.repeatX:this.repeatY,tT=this._isVertical?this.repeatY:this.repeatX,tr=Math.floor(tY/this._cellSize);if(this.cacheContent)ta=tT+1,this._createdLine-tr<ta&&(this._createItems(this._createdLine,tg,this._createdLine+ta),this.renderItems(this._createdLine*tg,0),this._createdLine+=ta);else{var ts=tr*tg,ta=0;if(ts>this._startIndex){ta=ts-this._startIndex;var tW=!0,tM=this._startIndex+tg*(tT+1);this._isMoved=!0}else ts<this._startIndex&&(ta=this._startIndex-ts,tW=!1,tM=this._startIndex-1,this._isMoved=!0);for(var tE=0;tE<ta;tE++){if(tW){var tI=this._cells.shift();this._cells[this._cells.length]=tI;var tO=tM+tE}else tI=this._cells.pop(),this._cells.unshift(tI),tO=tM-tE;var tC=Math.floor(tO/tg)*this._cellSize;this._isVertical?tI.y=tC:tI.x=tC,this.renderItem(tI,tO)}this._startIndex=ts,this.changeSelectStatus()}var tN=this._content.scrollRect;this._isVertical?(tN.y=tY-this._offset.y,tN.x=-this._offset.x):(tN.y=-this._offset.y,tN.x=tY-this._offset.x),this._content.scrollRect=tN},tg.posCell=function(tD,tY){if(this._scrollBar){var tg=this._isVertical?this.repeatX:this.repeatY,tT=(this._isVertical?this.repeatY:this.repeatX,Math.floor(tY/tg)*this._cellSize);this._isVertical?tD.y=tT:tD.x=tT}},tg.changeSelectStatus=function(){for(var tD=0,tY=this._cells.length;tD<tY;tD++)this.changeCellState(this._cells[tD],this._selectedIndex===this._startIndex+tD,1),this.changeCellSelectState(this._cells[tD],this._selectedIndex===this._startIndex+tD)},tg.changeCellSelectState=function(tD,tY){tD&&null!=tD.data&&null!=tD.data&&tD.setSel&&tD.getSelectState&&tD.getSelectState()!=tY&&tD.setSel(tY)},tg.renderItems=function(tD,tY){void 0===tD&&(tD=0),void 0===tY&&(tY=0);for(var tg=tD,tT=tY||this._cells.length;tg<tT;tg++)this.renderItem(this._cells[tg],this._startIndex+tg);this.changeSelectStatus(),this._twDone=!0},tg.renderItem=function(tD,tY){this._array&&0<=tY&&tY<this._array.length?(tD.visible=!0,tD._$bindData?(tD._dataSource=this._array[tY],this._bindData(tD,this._array[tY])):tD.dataSource=this._array[tY],this.cacheContent||this.posCell(tD,tY),this.hasListener("render")&&this.event("render",[tD,tY]),this.renderHandler&&this.renderHandler.runWith([tD,tY]),this.renderTwHandler&&this.renderTwHandler.runWith([tD,tY])):tD?(tD.visible=!1,tD.dataSource=null):td.recordError("找不到cell","_itemRender为:"+this._itemRender)},tg._bindData=function(tD,tY){for(var tg=tD._$bindData,tT=0,tr=tg.length;tT<tr;tT++){var ts=tg[tT++],ta=tg[tT++],tW=tg[tT],tM=tz.getBindFun(tW);ts[ta]=tM.call(this,tY)}},tg.refresh=function(){this.array=this._array},tg.getItem=function(tD){return-1<tD&&tD<this._array.length?this._array[tD]:null},tg.changeItem=function(tD,tY){-1<tD&&tD<this._array.length&&(this._array[tD]=tY,tD>=this._startIndex&&tD<this._startIndex+this._cells.length&&this.renderItem(this.getCell(tD),tD))},tg.setItem=function(tD,tY){this.changeItem(tD,tY)},tg.addItem=function(tD){this._array.push(tD),this.array=this._array},tg.addItemAt=function(tD,tY){this._array.splice(tY,0,tD),this.array=this._array},tg.deleteItem=function(tD){this._array.splice(tD,1),this.array=this._array},tg.getCell=function(tD){return this.runCallLater(this.changeCells),-1<tD&&this._cells?this._cells[(tD-this._startIndex)%this._cells.length]:null},tg.scrollTo=function(tD){if(this._scrollBar){var tY=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(tD/tY)*this._cellSize}else this.startIndex=tD},tg.tweenTo=function(tD,tY,tg){if(void 0===tY&&(tY=200),this._scrollBar){var tT=this._isVertical?this.repeatX:this.repeatY;tA.to(this._scrollBar,{value:Math.floor(tD/tT)*this._cellSize},tY,null,tg,0,!0)}else this.startIndex=tD,tg&&tg.run()},tg._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},tg.commitMeasure=function(){this.runCallLater(this.changeCells)},ta(0,tg,"cacheAs",tD.prototype._$get_cacheAs,function(tD){td.superSet(tB,this,"cacheAs",tD),this._scrollBar&&(this._$P.cacheAs=null,"none"!==tD?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),ta(0,tg,"content",function(){return this._content}),ta(0,tg,"height",tD.prototype._$get_height,function(tD){tD!=this._height&&(td.superSet(tB,this,"height",tD),this._setCellChanged())}),ta(0,tg,"itemRender",function(){return this._itemRender},function(tD){if(this._itemRender!=tD){this._itemRender=tD;for(var tY=this._cells.length-1;-1<tY;tY--)this._cells[tY].destroy();this._cells.length=0,this._setCellChanged()}}),ta(0,tg,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(tD){this._removePreScrollBar();var tY=new tgD;tY.name="scrollBar",tY.right=0,tD&&" "!=tD&&(tY.skin=tD),this.scrollBar=tY,this.addChild(tY),this._setCellChanged()}),ta(0,tg,"page",function(){return this._page},function(tD){this._page=tD,this._array&&(this._page=0<tD?tD:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),ta(0,tg,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(tD){this._removePreScrollBar();var tY=new tQ;tY.name="scrollBar",tY.bottom=0,tD&&" "!=tD&&(tY.skin=tD),this.scrollBar=tY,this.addChild(tY),this._setCellChanged()}),ta(0,tg,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(tD){this._repeatX=tD,this._setCellChanged()}),ta(0,tg,"scrollBar",function(){return this._scrollBar},function(tD){this._scrollBar!=tD&&(this._scrollBar=tD)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),ta(0,tg,"width",tD.prototype._$get_width,function(tD){tD!=this._width&&(td.superSet(tB,this,"width",tD),this._setCellChanged())}),ta(0,tg,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(tD){this._repeatY=tD,this._setCellChanged()}),ta(0,tg,"spaceX",function(){return this._spaceX},function(tD){this._spaceX=tD,this._setCellChanged()}),ta(0,tg,"spaceY",function(){return this._spaceY},function(tD){this._spaceY=tD,this._setCellChanged()}),ta(0,tg,"selectedIndex",function(){return this._selectedIndex},function(tD){this._selectedIndex!=tD&&(this._selectedIndex=tD,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(tD),this.startIndex=this._startIndex)}),ta(0,tg,"selectedItem",function(){return-1!=this._selectedIndex&&this._array?this._array[this._selectedIndex]:null},function(tD){this.selectedIndex=this._array.indexOf(tD)}),ta(0,tg,"length",function(){return this._array?this._array.length:0}),ta(0,tg,"selection",function(){return this.getCell(this._selectedIndex)},function(tD){this.selectedIndex=this._startIndex+this._cells.indexOf(tD)}),ta(0,tg,"startIndex",function(){return this._startIndex},function(tD){this._startIndex=0<tD?tD:0,this.callLater(this.renderItems)}),ta(0,tg,"twSwitch",function(){return this._twSwitch},function(tD){this._twSwitch=tD}),ta(0,tg,"twDone",function(){return this._twDone},function(tD){this._twDone=tD}),ta(0,tg,"array",function(){return this._array},function(tD){this.runCallLater(this.changeCells),this._array=tD||[];var tY=this._array.length;if(this.totalPage=Math.ceil(tY/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<tY?this._selectedIndex:tY-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var tg=this._isVertical?this.repeatX:this.repeatY,tT=this._isVertical?this.repeatY:this.repeatX,tr=Math.ceil(tY/tg);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=tT/tr,this._scrollBar.setScroll(0,(tr-tT)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),ta(0,tg,"dataSource",tD.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)&&Math.floor(tD)==tD||"string"==typeof tD?this.selectedIndex=parseInt(tD):tD instanceof Array?this.array=tD:td.superSet(tB,this,"dataSource",tD)}),ta(0,tg,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),tY}(tB),tQ=function(tD){function tY(){tY.__super.call(this)}return ts(tY,"laya.ui.HScrollBar",tD),tY.prototype.initialize=function(){tD.prototype.initialize.call(this),this.slider.isVertical=!1},tY}(tF),tL=function(tD){function tY(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,tY.__super.call(this),this.width=this.height=100}ts(tY,"laya.ui.Panel",tD);var tg=tY.prototype;return tg.destroy=function(tD){void 0===tD&&(tD=!0),laya.ui.Component.prototype.destroy.call(this,tD),this._content&&this._content.destroy(tD),this._vScrollBar&&this._vScrollBar.destroy(tD),this._hScrollBar&&this._hScrollBar.destroy(tD),this._vScrollBar=null,this._hScrollBar=null,this._content=null},tg.destroyChildren=function(){this._content.destroyChildren()},tg.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new tB)},tg.addChild=function(tD){return tD.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(tD)},tg.onResize=function(){this._setScrollChanged()},tg.addChildAt=function(tD,tY){return tD.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(tD,tY)},tg.removeChild=function(tD){return tD.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(tD)},tg.removeChildAt=function(tD){return this.getChildAt(tD).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(tD)},tg.removeChildren=function(tD,tY){return void 0===tD&&(tD=0),void 0===tY&&(tY=2147483647),this._content.removeChildren(tD,tY),this._setScrollChanged(),this},tg.getChildAt=function(tD){return this._content.getChildAt(tD)},tg.getChildByName=function(tD){return this._content.getChildByName(tD)},tg.getChildIndex=function(tD){return this._content.getChildIndex(tD)},tg.changeScroll=function(){this._scrollChanged=!1;var tD=this.contentWidth||1,tY=this.contentHeight||1,tg=this._vScrollBar,tT=this._hScrollBar,tr=tg&&tY>this._height,ts=tT&&tD>this._width,ta=tr?this._width-tg.width:this._width,tW=ts?this._height-tT.height:this._height;tg&&(tg.x=this._width-tg.width,tg.y=0,tg.height=this._height-(ts?tT.height:0),tg.scrollSize=Math.max(.033*this._height,1),tg.thumbPercent=tW/tY,tg.setScroll(0,tY-tW,tg.value)),tT&&(tT.x=0,tT.y=this._height-tT.height,tT.width=this._width-(tr?tg.width:0),tT.scrollSize=Math.max(.033*this._width,1),tT.thumbPercent=ta/tD,tT.setScroll(0,tD-ta,tT.value))},tg.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},tg.setContentSize=function(tD,tY){var tg=this._content;tg.width=tD,tg.height=tY,tg.scrollRect||(tg.scrollRect=new tZ),tg.scrollRect.setTo(0,0,tD,tY),tg.scrollRect=tg.scrollRect},tg.onScrollBarChange=function(tD){var tY=this._content.scrollRect;if(tY){var tg=Math.round(tD.value);tD.isVertical?tY.y=tg:tY.x=tg,this._content.scrollRect=tY}},tg.scrollTo=function(tD,tY){void 0===tD&&(tD=0),void 0===tY&&(tY=0),this.vScrollBar&&(this.vScrollBar.value=tY),this.hScrollBar&&(this.hScrollBar.value=tD)},tg.refresh=function(){this.changeScroll()},tg.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=td.superGet(tB,this,"cacheAs")),td.superSet(tB,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},tg.onScrollEnd=function(){td.superSet(tB,this,"cacheAs",this._$P.cacheAs)},tg._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},ta(0,tg,"numChildren",function(){return this._content.numChildren}),ta(0,tg,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(tD){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new tQ),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=tD}),ta(0,tg,"contentWidth",function(){for(var tD=0,tY=this._content.numChildren-1;-1<tY;tY--){var tg=this._content.getChildAt(tY);tD=Math.max(tg.x+tg.width*tg.scaleX,tD)}return tD}),ta(0,tg,"contentHeight",function(){for(var tD=0,tY=this._content.numChildren-1;-1<tY;tY--){var tg=this._content.getChildAt(tY);tD=Math.max(tg.y+tg.height*tg.scaleY,tD)}return tD}),ta(0,tg,"width",tD.prototype._$get_width,function(tD){td.superSet(tB,this,"width",tD),this._setScrollChanged()}),ta(0,tg,"hScrollBar",function(){return this._hScrollBar}),ta(0,tg,"content",function(){return this._content}),ta(0,tg,"height",tD.prototype._$get_height,function(tD){td.superSet(tB,this,"height",tD),this._setScrollChanged()}),ta(0,tg,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(tD){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new tgD),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=tD}),ta(0,tg,"vScrollBar",function(){return this._vScrollBar}),ta(0,tg,"cacheAs",tD.prototype._$get_cacheAs,function(tD){td.superSet(tB,this,"cacheAs",tD),this._$P.cacheAs=null,"none"!==tD?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),tY}(tB),ty=function(tD){function tY(tD){tY.__super.call(this,tD),this.isVertical=!1}return ts(tY,"laya.ui.HSlider",tV),tY}(),tu=function(tD){function tg(tD,tY){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,tg.__super.call(this),this.skin=tY,this.labels=tD}ts(tg,"laya.ui.UIGroup",tD);var tY=tg.prototype;return td.imps(tY,{"laya.ui.IItem":!0}),tY.preinitialize=function(){this.mouseEnabled=!0},tY.destroy=function(tD){void 0===tD&&(tD=!0),laya.ui.Component.prototype.destroy.call(this,tD),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},tY.addItem=function(tD,tY){void 0===tY&&(tY=!0);var tg=tD,tT=this._items.length;if(tg.name="item"+tT,this.addChild(tg),this.initItems(),tY&&0<tT){var tr=this._items[tT-1];"horizontal"==this._direction?tg.x=tr.x+tr.width+this._space:tg.y=tr.y+tr.height+this._space}else tY&&(tg.x=0,tg.y=0);return tT},tY.delItem=function(tD,tY){void 0===tY&&(tY=!0);var tg=this._items.indexOf(tD);if(-1!=tg){var tT=tD;this.removeChild(tT);for(var tr=tg+1,ts=this._items.length;tr<ts;tr++){var ta=this._items[tr];ta.name="item"+(tr-1),tY&&("horizontal"==this._direction?ta.x-=tT.width+this._space:ta.y-=tT.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var tW;tW=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=tW}}},tY.initItems=function(){this._items||(this._items=[]);for(var tD=this._items.length=0;tD<1e4;tD++){var tY=this.getChildByName("item"+tD);if(null==tY)break;this._items.push(tY),tY.selected=tD===this._selectedIndex,tY.clickHandler=tN.create(this,this.itemClick,[tD],!1)}},tY.itemClick=function(tD){this.selectedIndex=tD},tY.setSelect=function(tD,tY){this._items&&-1<tD&&tD<this._items.length&&(this._items[tD].selected=tY)},tY.createItem=function(tD,tY){return null},tY.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var tD=0,tY=0,tg=this._items.length;tY<tg;tY++){var tT=this._items[tY];this._skin&&(tT.skin=this._skin),this._labelColors&&(tT.labelColors=this._labelColors),this._labelSize&&(tT.labelSize=this._labelSize),this._labelStroke&&(tT.labelStroke=this._labelStroke),this._labelStrokeColor&&(tT.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(tT.strokeColors=this._strokeColors),this._labelBold&&(tT.labelBold=this._labelBold),this._labelPadding&&(tT.labelPadding=this._labelPadding),this._labelAlign&&(tT.labelAlign=this._labelAlign),this._stateNum&&(tT.stateNum=this._stateNum),this._labelFont&&(tT.labelFont=this._labelFont),"horizontal"===this._direction?(tT.y=0,tT.x=tD,tD+=tT.width+this._space):(tT.x=0,tT.y=tD,tD+=tT.height+this._space)}this.changeSize()},tY.commitMeasure=function(){this.runCallLater(this.changeLabels)},tY._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},ta(0,tY,"labelStrokeColor",function(){return this._labelStrokeColor},function(tD){this._labelStrokeColor!=tD&&(this._labelStrokeColor=tD,this._setLabelChanged())}),ta(0,tY,"skin",function(){return this._skin},function(tD){this._skin!=tD&&(this._skin=tD,this._setLabelChanged())}),ta(0,tY,"selectedIndex",function(){return this._selectedIndex},function(tD){this._selectedIndex!=tD&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=tD,this.setSelect(tD,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),ta(0,tY,"labels",function(){return this._labels},function(tD){if(this._labels!=tD){if(this._labels=tD,this.removeChildren(),this._setLabelChanged(),this._labels)for(var tY=this._labels.split(","),tg=0,tT=tY.length;tg<tT;tg++){var tr=this.createItem(this._skin,tY[tg]);tr.name="item"+tg,this.addChild(tr)}this.initItems()}}),ta(0,tY,"strokeColors",function(){return this._strokeColors},function(tD){this._strokeColors!=tD&&(this._strokeColors=tD,this._setLabelChanged())}),ta(0,tY,"labelColors",function(){return this._labelColors},function(tD){this._labelColors!=tD&&(this._labelColors=tD,this._setLabelChanged())}),ta(0,tY,"labelStroke",function(){return this._labelStroke},function(tD){this._labelStroke!=tD&&(this._labelStroke=tD,this._setLabelChanged())}),ta(0,tY,"labelSize",function(){return this._labelSize},function(tD){this._labelSize!=tD&&(this._labelSize=tD,this._setLabelChanged())}),ta(0,tY,"stateNum",function(){return this._stateNum},function(tD){this._stateNum!=tD&&(this._stateNum=tD,this._setLabelChanged())}),ta(0,tY,"labelBold",function(){return this._labelBold},function(tD){this._labelBold!=tD&&(this._labelBold=tD,this._setLabelChanged())}),ta(0,tY,"labelFont",function(){return this._labelFont},function(tD){this._labelFont!=tD&&(this._labelFont=tD,this._setLabelChanged())}),ta(0,tY,"labelPadding",function(){return this._labelPadding},function(tD){this._labelPadding!=tD&&(this._labelPadding=tD,this._setLabelChanged())}),ta(0,tY,"direction",function(){return this._direction},function(tD){this._direction=tD,this._setLabelChanged()}),ta(0,tY,"space",function(){return this._space},function(tD){this._space=tD,this._setLabelChanged()}),ta(0,tY,"items",function(){return this._items}),ta(0,tY,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(tD){this.selectedIndex=this._items.indexOf(tD)}),ta(0,tY,"dataSource",tD.prototype._$get_dataSource,function(tD){"number"==typeof(this._dataSource=tD)&&Math.floor(tD)==tD||"string"==typeof tD?this.selectedIndex=parseInt(tD):tD instanceof Array?this.labels=tD.join(","):td.superSet(tB,this,"dataSource",tD)}),tg}(tB),tn=function(tY){function tg(tD,tY){this._value=null,void 0===tY&&(tY=""),tg.__super.call(this,tD,tY)}ts(tg,"laya.ui.Radio",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._value=null},tD.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},tD.initialize=function(){tY.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},tD.onClick=function(tD){this.selected=!0},ta(0,tD,"value",function(){return null!=this._value?this._value:this.label},function(tD){this._value=tD}),tg}(tH),tDD=function(tD){function tY(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,tY.__super.call(this),this.width=this.height=200}ts(tY,"laya.ui.Tree",tD);var tg=tY.prototype;return td.imps(tg,{"laya.ui.IRender":!0}),tg.destroy=function(tD){void 0===tD&&(tD=!0),laya.ui.Component.prototype.destroy.call(this,tD),this._list&&this._list.destroy(tD),this._list=null,this._source=null,this._renderHandler=null},tg.createChildren=function(){this.addChild(this._list=new tR),this._list.renderHandler=tN.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},tg.onListChange=function(tD){this.event("change")},tg.getArray=function(){var tD,tY=[];for(var tg in this._source)tD=this._source[tg],this.getParentOpenStatus(tD)&&(tD.x=this._spaceLeft*this.getDepth(tD),tY.push(tD));return tY},tg.getDepth=function(tD,tY){return void 0===tY&&(tY=0),null==tD.nodeParent?tY:this.getDepth(tD.nodeParent,tY+1)},tg.getParentOpenStatus=function(tD){var tY=tD.nodeParent;return null==tY||!!tY.isOpen&&(null==tY.nodeParent||this.getParentOpenStatus(tY))},tg.renderItem=function(tD,tY){var tg=tD.dataSource;if(tg){tD.left=tg.x;var tT=tD.getChildByName("arrow");tT&&(tg.hasChild?(tT.visible=!0,tT.index=tg.isOpen?1:0,tT.tag=tY,tT.off("click",this,this.onArrowClick),tT.on("click",this,this.onArrowClick)):tT.visible=!1);var tr=tD.getChildByName("folder");tr&&(2==tr.clipY?tr.index=tg.isDirectory?0:1:tr.index=tg.isDirectory?tg.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([tD,tY])}},tg.onArrowClick=function(tD){var tY=tD.currentTarget.tag;this._list.array[tY].isOpen=!this._list.array[tY].isOpen,this.event("open"),this._list.array=this.getArray()},tg.setItemState=function(tD,tY){this._list.array[tD]&&(this._list.array[tD].isOpen=tY,this._list.array=this.getArray())},tg.fresh=function(){this._list.array=this.getArray(),this.repaint()},tg.parseXml=function(tD,tY,tg,tT){var tr,ts=tD.childNodes,ta=ts.length;if(!tT){tr={};var tW,tM=tD.attributes;for(var tE in tM){var tI=(tW=tM[tE]).nodeName,tO=tW.nodeValue;tr[tI]="true"==tO||"false"!=tO&&tO}tr.nodeParent=tg,0<ta&&(tr.isDirectory=!0),tr.hasChild=0<ta,tY.push(tr)}for(var tC=0;tC<ta;tC++){var tN=ts[tC];this.parseXml(tN,tY,tr,!1)}},tg.parseOpenStatus=function(tD,tY){for(var tg=0,tT=tY.length;tg<tT;tg++){var tr=tY[tg];if(tr.isDirectory)for(var ts=0,ta=tD.length;ts<ta;ts++){var tW=tD[ts];if(tW.isDirectory&&this.isSameParent(tW,tr)&&tr.label==tW.label){tr.isOpen=tW.isOpen;break}}}},tg.isSameParent=function(tD,tY){return null==tD.nodeParent&&null==tY.nodeParent||null!=tD.nodeParent&&null!=tY.nodeParent&&(tD.nodeParent.label==tY.nodeParent.label&&this.isSameParent(tD.nodeParent,tY.nodeParent))},tg.filter=function(tD){if(Boolean(tD)){var tY=[];this.getFilterSource(this._source,tY,tD),this._list.array=tY}else this._list.array=this.getArray()},tg.getFilterSource=function(tD,tY,tg){var tT;for(var tr in tg=tg.toLocaleLowerCase(),tD)!(tT=tD[tr]).isDirectory&&-1<String(tT.label).toLowerCase().indexOf(tg)&&(tT.x=0,tY.push(tT)),tT.child&&0<tT.child.length&&this.getFilterSource(tT.child,tY,tg)},ta(0,tg,"spaceBottom",function(){return this._list.spaceY},function(tD){this._list.spaceY=tD}),ta(0,tg,"keepStatus",function(){return this._keepStatus},function(tD){this._keepStatus=tD}),ta(0,tg,"itemRender",function(){return this._list.itemRender},function(tD){this._list.itemRender=tD}),ta(0,tg,"array",function(){return this._list.array},function(tD){this._keepStatus&&this._list.array&&tD&&this.parseOpenStatus(this._list.array,tD),this._source=tD,this._list.array=this.getArray()}),ta(0,tg,"mouseHandler",function(){return this._list.mouseHandler},function(tD){this._list.mouseHandler=tD}),ta(0,tg,"dataSource",tD.prototype._$get_dataSource,function(tD){this._dataSource=tD,td.superSet(tB,this,"dataSource",tD)}),ta(0,tg,"source",function(){return this._source}),ta(0,tg,"scrollBar",function(){return this._list.scrollBar}),ta(0,tg,"list",function(){return this._list}),ta(0,tg,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(tD){this._list.vScrollBarSkin=tD}),ta(0,tg,"renderHandler",function(){return this._renderHandler},function(tD){this._renderHandler=tD}),ta(0,tg,"selectedIndex",function(){return this._list.selectedIndex},function(tD){this._list.selectedIndex=tD}),ta(0,tg,"spaceLeft",function(){return this._spaceLeft},function(tD){this._spaceLeft=tD}),ta(0,tg,"selectedItem",function(){return this._list.selectedItem},function(tD){this._list.selectedItem=tD}),ta(0,tg,"width",tD.prototype._$get_width,function(tD){td.superSet(tB,this,"width",tD),this._list.width=tD}),ta(0,tg,"height",tD.prototype._$get_height,function(tD){td.superSet(tB,this,"height",tD),this._list.height=tD}),ta(0,tg,"xml",null,function(tD){var tY=[];this.parseXml(tD.childNodes[0],tY,null,!0),this.array=tY}),ta(0,tg,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),tY}(tB),tYD=function(tD){function tY(){this._items=null,this._selectedIndex=0,tY.__super.call(this),this._setIndexHandler=tN.create(this,this.setIndex,null,!1)}ts(tY,"laya.ui.ViewStack",tD);var tg=tY.prototype;return td.imps(tg,{"laya.ui.IItem":!0}),tg.setItems=function(tD){this.removeChildren();for(var tY=0,tg=0,tT=tD.length;tg<tT;tg++){var tr=tD[tg];tr&&(tr.name="item"+tY,this.addChild(tr),tY++)}this.initItems()},tg.addItem=function(tD){tD.name="item"+this._items.length,this.addChild(tD),this.initItems()},tg.initItems=function(){this._items=[];for(var tD=0;tD<1e4;tD++){var tY=this.getChildByName("item"+tD);if(null==tY)break;this._items.push(tY),tY.visible=tD==this._selectedIndex}},tg.setSelect=function(tD,tY){this._items&&-1<tD&&tD<this._items.length&&(this._items[tD].visible=tY)},tg.setIndex=function(tD){this.selectedIndex=tD},ta(0,tg,"dataSource",tD.prototype._$get_dataSource,function(tD){if("number"==typeof(this._dataSource=tD)&&Math.floor(tD)==tD||"string"==typeof tD)this.selectedIndex=parseInt(tD);else for(var tY in this._dataSource)this.hasOwnProperty(tY)&&(this[tY]=this._dataSource[tY])}),ta(0,tg,"selectedIndex",function(){return this._selectedIndex},function(tD){this._selectedIndex!=tD&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=tD,this.setSelect(this._selectedIndex,!0))}),ta(0,tg,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(tD){this.selectedIndex=this._items.indexOf(tD)}),ta(0,tg,"items",function(){return this._items}),ta(0,tg,"setIndexHandler",function(){return this._setIndexHandler},function(tD){this._setIndexHandler=tD}),tY}(tB),tgD=function(tD){function tY(){tY.__super.call(this)}return ts(tY,"laya.ui.VScrollBar",tF),tY}(),tTD=function(tY){function tg(tD){this._bg=null,this._skin=null,tg.__super.call(this),void 0===tD&&(tD=""),this.text=tD,this.skin=this.skin}ts(tg,"laya.ui.TextInput",tY);var tD=tg.prototype;return tD.preinitialize=function(){this.mouseEnabled=!0},tD.destroy=function(tD){tj.clearCache(this,this._skin),void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._bg&&this._bg.destroy(),this._bg=null},tD.createChildren=function(){this.addChild(this._tf=new t$),this._tf.padding=tX.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},tD._onFocus=function(){this.event("focus",this)},tD._onBlur=function(){this.event("blur",this)},tD._onInput=function(){this.event("input",this)},tD._onEnter=function(){this.event("enter",this)},tD.initialize=function(){this.width=128,this.height=22},tD.select=function(){this._tf.select()},tD.setSelection=function(tD,tY){this._tf.setSelection(tD,tY)},ta(0,tD,"text",tY.prototype._$get_text,function(tD){this._tf.text!=tD&&(tD+="",this._tf.text=tD,this.event("change"))}),ta(0,tD,"bg",function(){return this._bg},function(tD){this.graphics=this._bg=tD}),ta(0,tD,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(tD){this._tf.inputElementYAdjuster=tD}),ta(0,tD,"multiline",function(){return this._tf.multiline},function(tD){this._tf.multiline=tD}),ta(0,tD,"skin",function(){return this._skin},function(tD){this._skin!=tD&&(tj.clearCache(this,this._skin),this._skin=tD,this._bg||(this.graphics=this._bg=new th),tj.keepCache(this,this._skin),this._bg.source=tj.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),ta(0,tD,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(tD){this._bg||(this.graphics=this._bg=new th),this._bg.sizeGrid=tz.fillArray(tX.defaultSizeGrid,tD,Number)}),ta(0,tD,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(tD){this._tf.inputElementXAdjuster=tD}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(tf,this,"width",tD),this._bg&&(this._bg.width=tD)}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(tf,this,"height",tD),this._bg&&(this._bg.height=tD)}),ta(0,tD,"editable",function(){return this._tf.editable},function(tD){this._tf.editable=tD}),ta(0,tD,"restrict",function(){return this._tf.restrict},function(tD){this._tf.restrict=tD}),ta(0,tD,"prompt",function(){return this._tf.prompt},function(tD){this._tf.prompt=tD}),ta(0,tD,"promptColor",function(){return this._tf.promptColor},function(tD){this._tf.promptColor=tD}),ta(0,tD,"maxChars",function(){return this._tf.maxChars},function(tD){this._tf.maxChars=tD}),ta(0,tD,"focus",function(){return this._tf.focus},function(tD){this._tf.focus=tD}),ta(0,tD,"type",function(){return this._tf.type},function(tD){this._tf.type=tD}),ta(0,tD,"asPassword",function(){return this._tf.asPassword},function(tD){this._tf.asPassword=tD}),tg}(tf),trD=function(tD){function tY(){tY.__super.call(this)}return ts(tY,"laya.ui.VSlider",tV),tY}(),tsD=function(tD){function tT(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,tT.__super.call(this)}ts(tT,"laya.ui.Dialog",tD);var tY=tT.prototype;return tY.initialize=function(){this.popupEffect=tT.manager.popupEffectHandler,this.closeEffect=tT.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},tY._dealDragArea=function(){var tD=this.getChildByName("drag");tD&&(this.dragArea=tD.x+","+tD.y+","+tD.width+","+tD.height,tD.removeSelf())},tY._onClick=function(tD){var tY=tD.target;if(tY)switch(tY.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(tY.name)}},tY.show=function(tD,tY){void 0===tD&&(tD=!1),void 0===tY&&(tY=!0),this._open(!1,tD,tY)},tY.popup=function(tD,tY){void 0===tD&&(tD=!1),void 0===tY&&(tY=!0),this._open(!0,tD,tY)},tY._open=function(tD,tY,tg){tT.manager.lock(!1),this.isModal=tD,tT.manager.open(this,tY,tg)},tY.onOpened=function(){},tY.close=function(tD,tY){void 0===tY&&(tY=!0),tT.manager.close(this,tD,tY)},tY.onClosed=function(tD){},tY._onMouseDown=function(tD){var tY=this.getMousePoint();this._dragArea.contains(tY.x,tY.y)?this.startDrag():this.stopDrag()},ta(0,tY,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(tD){if(tD){var tY=tz.fillArray([0,0,0,0],tD,Number);this._dragArea=new tZ(tY[0],tY[1],tY[2],tY[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),ta(0,tY,"isPopup",function(){return null!=this.parent}),ta(0,tY,"zOrder",tD.prototype._$get_zOrder,function(tD){td.superSet(tk,this,"zOrder",tD),tT.manager._checkMask()}),ta(1,tT,"manager",function(){return tT._manager=tT._manager||new tP},function(tD){tT._manager=tD}),tT.setLockView=function(tD){tT.manager.setLockView(tD)},tT.lock=function(tD){tT.manager.lock(tD)},tT.closeAll=function(){tT.manager.closeAll()},tT.getDialogsByGroup=function(tD){return tT.manager.getDialogsByGroup(tD)},tT.closeByGroup=function(tD){return tT.manager.closeByGroup(tD)},tT.CLOSE="close",tT.CANCEL="cancel",tT.SURE="sure",tT.NO="no",tT.OK="ok",tT.YES="yes",tT._manager=null,tT}(tk),taD=function(tD){function tY(){tY.__super.call(this)}ts(tY,"laya.ui.HBox",tD);var tg=tY.prototype;return tg.sortItem=function(tD){tD&&tD.sort(function(tD,tY){return tD.x-tY.x})},tg.changeItems=function(){this._itemChanged=!1;for(var tD=[],tY=0,tg=0,tT=this.numChildren;tg<tT;tg++){var tr=this.getChildAt(tg);tr&&tr.layoutEnabled&&(tD.push(tr),tY=this._height?this._height:Math.max(tY,tr.height*tr.scaleY))}this.sortItem(tD);var ts=0;for(tg=0,tT=tD.length;tg<tT;tg++)(tr=tD[tg]).x=ts,ts+=tr.width*tr.scaleX+this._space,"top"==this._align?tr.y=0:"middle"==this._align?tr.y=.5*(tY-tr.height*tr.scaleY):"bottom"==this._align&&(tr.y=tY-tr.height*tr.scaleY);this.changeSize()},ta(0,tg,"height",tD.prototype._$get_height,function(tD){this._height!=tD&&(td.superSet(tK,this,"height",tD),this.callLater(this.changeItems))}),tY.NONE="none",tY.TOP="top",tY.MIDDLE="middle",tY.BOTTOM="bottom",tY}(tK),tWD=function(tD){function tY(){tY.__super.call(this)}ts(tY,"laya.ui.VBox",tD);var tg=tY.prototype;return tg.changeItems=function(){this._itemChanged=!1;for(var tD=[],tY=0,tg=0,tT=this.numChildren;tg<tT;tg++){var tr=this.getChildAt(tg);tr&&tr.layoutEnabled&&(tD.push(tr),tY=this._width?this._width:Math.max(tY,tr.width*tr.scaleX))}this.sortItem(tD);var ts=0;for(tg=0,tT=tD.length;tg<tT;tg++)(tr=tD[tg]).y=ts,ts+=tr.height*tr.scaleY+this._space,"left"==this._align?tr.x=0:"center"==this._align?tr.x=.5*(tY-tr.width*tr.scaleX):"right"==this._align&&(tr.x=tY-tr.width*tr.scaleX);this.changeSize()},ta(0,tg,"width",tD.prototype._$get_width,function(tD){this._width!=tD&&(td.superSet(tK,this,"width",tD),this.callLater(this.changeItems))}),tY.NONE="none",tY.LEFT="left",tY.CENTER="center",tY.RIGHT="right",tY}(tK),tMD=function(tD){function tY(){tY.__super.call(this)}return ts(tY,"laya.ui.RadioGroup",tu),tY.prototype.createItem=function(tD,tY){return new tn(tD,tY)},tY}(),tED=function(tD){function tY(){tY.__super.call(this)}return ts(tY,"laya.ui.Tab",tu),tY.prototype.createItem=function(tD,tY){return new tH(tD,tY)},tY}(),tID=function(tY){function tg(tD){this._vScrollBar=null,this._hScrollBar=null,void 0===tD&&(tD=""),tg.__super.call(this,tD)}ts(tg,"laya.ui.TextArea",tY);var tD=tg.prototype;return tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},tD.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},tD.onVBarChanged=function(tD){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},tD.onHBarChanged=function(tD){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},tD.changeScroll=function(){var tD=this._vScrollBar&&0<this._tf.maxScrollY,tY=this._hScrollBar&&0<this._tf.maxScrollX,tg=tD?this._width-this._vScrollBar.width:this._width,tT=tY?this._height-this._hScrollBar.height:this._height,tr=this._tf.padding||tX.labelPadding;this._tf.width=tg,this._tf.height=tT,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-tr[2],this._vScrollBar.y=tr[1],this._vScrollBar.height=this._height-(tY?this._hScrollBar.height:0)-tr[1]-tr[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=tT/Math.max(this._tf.textHeight,tT),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=tD),this._hScrollBar&&(this._hScrollBar.x=tr[0],this._hScrollBar.y=this._height-this._hScrollBar.height-tr[3],this._hScrollBar.width=this._width-(tD?this._vScrollBar.width:0)-tr[0]-tr[2],this._hScrollBar.scrollSize=Math.max(.033*tg,1),this._hScrollBar.thumbPercent=tg/Math.max(this._tf.textWidth,tg),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=tY)},tD.scrollTo=function(tD){this.commitMeasure(),this._tf.scrollY=tD},ta(0,tD,"scrollY",function(){return this._tf.scrollY}),ta(0,tD,"width",tY.prototype._$get_width,function(tD){td.superSet(tTD,this,"width",tD),this.callLater(this.changeScroll)}),ta(0,tD,"hScrollBar",function(){return this._hScrollBar}),ta(0,tD,"height",tY.prototype._$get_height,function(tD){td.superSet(tTD,this,"height",tD),this.callLater(this.changeScroll)}),ta(0,tD,"maxScrollX",function(){return this._tf.maxScrollX}),ta(0,tD,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(tD){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new tgD),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=tD}),ta(0,tD,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(tD){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new tQ),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=tD}),ta(0,tD,"vScrollBar",function(){return this._vScrollBar}),ta(0,tD,"maxScrollY",function(){return this._tf.maxScrollY}),ta(0,tD,"scrollX",function(){return this._tf.scrollX}),tg}(tTD);!function(tD){function tY(){this._uiView=null,this.isCloseOther=!1,tY.__super.call(this)}ts(tY,"laya.ui.AsynDialog",tsD);var tg=tY.prototype;tg.createView=function(tD){this._uiView=tD},tg._open=function(tD,tY,tg){this.isModal=tD,this.isCloseOther=tY,tsD.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},tg.onCreated=function(){this.createUI(),this.onOpen()},tg.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},tg.onOpen=function(){tsD.manager.open(this,this.isCloseOther),tsD.manager.lock(!1)},tg.close=function(tD,tY){void 0===tY&&(tY=!0),tsD.manager.close(this),this.onClose()},tg.onClose=function(){},tg.destroy=function(tD){void 0===tD&&(tD=!0),laya.ui.View.prototype.destroy.call(this,tD),this._uiView=null,this.onDestroy()},tg.onDestroy=function(){}}();td.__init([tk])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(tD,tY){"use strict";for(var tg in Object.defineProperty(tY,"__esModule",{value:!0}),Laya){var tT=Laya[tg];tT&&tT.__isclass&&(tY[tg]=tT)}}),function(tC,tD,tl){tl.un,tl.uns;var tO=tl.static,tN=tl.class,t$=tl.getset,tT=tl.__newvec,tp=laya.maths.Arith,ta=laya.webgl.atlas.AtlasResourceManager,tg=laya.webgl.shader.BaseShader,th=laya.utils.Browser,tW=laya.webgl.utils.Buffer,tt=laya.utils.Byte,tM=laya.utils.ClassUtils,tE=tl.Config,ts=(laya.events.Event,laya.events.EventDispatcher),tG=laya.utils.Handler,tx=laya.net.Loader,tY=laya.net.LoaderManager,tI=(laya.maths.MathUtil,laya.display.Node),td=laya.renders.Render,tr=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),tJ=laya.resource.Resource,tj=laya.utils.RunDriver,tZ=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),t_=laya.display.Sprite,tA=laya.utils.Stat,tq=laya.utils.StringKey,tX=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),tb=laya.utils.Utils,tz=laya.webgl.WebGL,tm=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;tl.interface("laya.d3.core.IClone"),tl.interface("laya.d3.graphics.IVertex"),tl.interface("laya.d3.core.render.IUpdate"),tl.interface("laya.d3.core.scene.ITreeNode"),tl.interface("laya.d3.core.render.IRenderable");(function(){function tB(){}tN(tB,"laya.d3.animation.AnimationClipParser01"),tB.READ_DATA=function(){tB._DATA.offset=tB._reader.getUint32(),tB._DATA.size=tB._reader.getUint32()},tB.READ_BLOCK=function(){for(var tD=tB._BLOCK.count=tB._reader.getUint16(),tY=tB._BLOCK.blockStarts=[],tg=tB._BLOCK.blockLengths=[],tT=0;tT<tD;tT++)tY.push(tB._reader.getUint32()),tg.push(tB._reader.getUint32())},tB.READ_STRINGS=function(){var tD=tB._reader.getUint32(),tY=tB._reader.getUint16(),tg=tB._reader.pos;tB._reader.pos=tD+tB._DATA.offset;for(var tT=0;tT<tY;tT++)tB._strings[tT]=tB._reader.readUTFString();tB._reader.pos=tg},tB.parse=function(tD,tY){tB._animationClip=tD;(tB._reader=tY).__getBuffer();tB.READ_DATA(),tB.READ_BLOCK(),tB.READ_STRINGS();for(var tg=0,tT=tB._BLOCK.count;tg<tT;tg++){var tr=tY.getUint16(),ts=tB._strings[tr],ta=tB["READ_"+ts];if(null==ta)throw new Error("model file err,no this function:"+tr+" "+ts);ta.call()}},tB.READ_ANIMATIONS=function(){var tD,tY=0,tg=0,tT=tB._reader,tr=tT.__getBuffer(),ts=[],ta=tT.getUint8();for(ts.length=ta,tY=0;tY<ta;tY++)ts[tY]=tT.getUint16();var tW=[],tM=tT.getUint16();for(tW.length=tM,tY=0;tY<tM;tY++)tW[tY]=tT.getFloat32();var tE=tB._animationClip;tE.name=tB._strings[tT.getUint16()];var tI=tE._duration=tT.getFloat32();tE.islooping=!!tT.getByte(),tE._frameRate=tT.getInt16();var tO=tT.getInt16(),tC=tE._nodes=new Array;tC.length=tO,(tE._publicClipDatas=[]).length=tO;var tN=tE._nodesMap={},t$=0,td=0;for(tY=0;tY<tO;tY++){tD=tC[tY]=new tf;var tJ=tT.getUint16(),tx=tD.path=[];for(tx.length=tJ,tg=0;tg<tJ;tg++)tx[tg]=tB._strings[tT.getUint16()];var tj=tx.join("/"),tZ=tN[tj];tZ||(tN[tj]=tZ=[]),tZ.push(tD);var tp=tT.getInt16();-1!==tp&&(tD.componentType=tB._strings[tp]);var tl=tV._propertyIndexDic[tB._strings[tT.getUint16()]];if(null==tl)throw new Error("AnimationClipParser01:unknown property name.");var tt=tl<4,t_=!tt||tt&&""===tx[0];(tD._cacheProperty=t_)?t$++:td++,tD.propertyNameID=tl;var tA=ts[tT.getUint8()];tD.keyFrameWidth=tA/4;var tq=tD.keyFrames=[],tb=tq.length=tT.getUint16(),tG=null,tX=NaN;for(tg=0;tg<tb;tg++){var tz=tq[tg]=new tc;tX=tz.startTime=tW[tT.getUint16()];var tm=tT.pos;tz.inTangent=new Float32Array(tr.slice(tm,tm+tA)),tT.pos+=tA,tm=tT.pos,tz.outTangent=new Float32Array(tr.slice(tm,tm+tA)),tT.pos+=tA,tm=tT.pos,tz.data=new Float32Array(tr.slice(tm,tm+tA)),tT.pos+=tA,tG&&(tG.next=tz,tG.duration=tX-tG.startTime),tG=tz}tz.next=null,tz.duration=tI-tX}var th=tE._nodeToCachePropertyMap=new Int32Array(tO),ti=tE._cachePropertyMap=new Int32Array(t$),tP=tE._unCachePropertyMap=new Int32Array(td);for(t$=td=0,tY=0;tY<tO;tY++)(tD=tC[tY])._cacheProperty?(th[tY]=t$,ti[t$++]=tY):tP[td++]=tY},tB._animationClip=null,tB._reader=null,tB._strings=[],tO(tB,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function tU(){}tN(tU,"laya.d3.animation.AnimationClipParser02"),tU.READ_DATA=function(){tU._DATA.offset=tU._reader.getUint32(),tU._DATA.size=tU._reader.getUint32()},tU.READ_BLOCK=function(){for(var tD=tU._BLOCK.count=tU._reader.getUint16(),tY=tU._BLOCK.blockStarts=[],tg=tU._BLOCK.blockLengths=[],tT=0;tT<tD;tT++)tY.push(tU._reader.getUint32()),tg.push(tU._reader.getUint32())},tU.READ_STRINGS=function(){var tD=tU._reader.getUint32(),tY=tU._reader.getUint16(),tg=tU._reader.pos;tU._reader.pos=tD+tU._DATA.offset;for(var tT=0;tT<tY;tT++)tU._strings[tT]=tU._reader.readUTFString();tU._reader.pos=tg},tU.parse=function(tD,tY){tU._animationClip=tD;(tU._reader=tY).__getBuffer();tU.READ_DATA(),tU.READ_BLOCK(),tU.READ_STRINGS();for(var tg=0,tT=tU._BLOCK.count;tg<tT;tg++){var tr=tY.getUint16(),ts=tU._strings[tr],ta=tU["READ_"+ts];if(null==ta)throw new Error("model file err,no this function:"+tr+" "+ts);ta.call()}},tU.READ_ANIMATIONS=function(){var tD,tY=0,tg=0,tT=tU._reader,tr=tT.__getBuffer(),ts=[],ta=tT.getUint8();for(ts.length=ta,tY=0;tY<ta;tY++)ts[tY]=tT.getUint16();var tW=[],tM=tT.getUint16();for(tW.length=tM,tY=0;tY<tM;tY++)tW[tY]=tT.getFloat32();var tE=tU._animationClip;tE.name=tU._strings[tT.getUint16()];var tI=tE._duration=tT.getFloat32();tE.islooping=!!tT.getByte(),tE._frameRate=tT.getInt16();var tO=tT.getInt16(),tC=tE._nodes=new Array;tC.length=tO,(tE._publicClipDatas=[]).length=tO;var tN=tE._nodesMap={},t$=0,td=0;for(tY=0;tY<tO;tY++){tD=tC[tY]=new tf;var tJ=tT.getUint16(),tx=tD.path=[];for(tx.length=tJ,tg=0;tg<tJ;tg++)tx[tg]=tU._strings[tT.getUint16()];var tj=tx.join("/"),tZ=tN[tj];tZ||(tN[tj]=tZ=[]),tZ.push(tD);var tp=tT.getInt16();-1!==tp&&(tD.componentType=tU._strings[tp]);var tl=tV._propertyIndexDic[tU._strings[tT.getUint16()]];if(null==tl)throw new Error("AnimationClipParser02:unknown property name.");var tt=tl<4,t_=!tt||tt&&""===tx[0];(tD._cacheProperty=t_)?t$++:td++,tD.propertyNameID=tl;var tA=ts[tT.getUint8()];tD.keyFrameWidth=tA/4;var tq=tD.keyFrames=[],tb=tq.length=tT.getUint16(),tG=null,tX=NaN;for(tg=0;tg<tb;tg++){var tz=tq[tg]=new tc;tX=tz.startTime=tW[tT.getUint16()];var tm=tT.pos;tz.inTangent=new Float32Array(tr.slice(tm,tm+tA)),tT.pos+=tA,tm=tT.pos,tz.outTangent=new Float32Array(tr.slice(tm,tm+tA)),tT.pos+=tA,tm=tT.pos,tz.data=new Float32Array(tr.slice(tm,tm+tA)),tT.pos+=tA,tG&&(tG.next=tz,tG.duration=tX-tG.startTime),tG=tz}tz.next=null,tz.duration=tI-tX}var th=tT.getUint16();for(tY=0;tY<th;tY++){var ti,tP=new tF;tP.time=tT.getFloat32(),tP.eventName=tU._strings[tT.getUint16()];var tB=tT.getUint16();for(0<tB&&(tP.params=ti=[]),tg=0;tg<tB;tg++){switch(tT.getByte()){case 0:ti.push(!!tT.getByte());break;case 1:ti.push(tT.getInt32());break;case 2:ti.push(tT.getFloat32());break;case 3:ti.push(tU._strings[tT.getUint16()]);break;default:throw new Error("unknown type.")}}tE.addEvent(tP)}var tH=tE._nodeToCachePropertyMap=new Int32Array(tO),tv=tE._cachePropertyMap=new Int32Array(t$),tS=tE._unCachePropertyMap=new Int32Array(td);for(t$=td=0,tY=0;tY<tO;tY++)(tD=tC[tY])._cacheProperty?(tH[tY]=t$,tv[t$++]=tY):tS[td++]=tY},tU._animationClip=null,tU._reader=null,tU._strings=[],tO(tU,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var tF=function(){function tD(){this.time=NaN,this.eventName=null,this.params=null}return tN(tD,"laya.d3.animation.AnimationEvent"),tD}(),tV=function(){function tT(){this._childs=[],this.transform=new ttY(this)}tN(tT,"laya.d3.animation.AnimationNode");var tD=tT.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.addChild=function(tD){tD._parent=this,tD.transform.setParent(this.transform),this._childs.push(tD)},tD.removeChild=function(tD){var tY=this._childs.indexOf(tD);-1!==tY&&this._childs.splice(tY,1)},tD.getChildByName=function(tD){for(var tY=0,tg=this._childs.length;tY<tg;tY++){var tT=this._childs[tY];if(tT.name===tD)return tT}return null},tD.getChildByIndex=function(tD){return this._childs[tD]},tD.getChildCount=function(){return this._childs.length},tD.cloneTo=function(tD){var tY=tD;tY.name=this.name;for(var tg=0,tT=this._childs.length;tg<tT;tg++){var tr=this._childs[tg],ts=tr.clone();tY.addChild(ts);var ta=tr.transform,tW=ts.transform;tW.setLocalPosition(ta.getLocalPosition()),tW.setLocalRotation(ta.getLocalRotation()),tW.setLocalScale(ta.getLocalScale()),tW._localRotationEuler=ta._localRotationEuler,tW._setWorldMatrixIgnoreUpdate(ta.getWorldMatrix())}},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tT.__init__=function(){tT.registerAnimationNodeProperty("localPosition",tT._getLocalPosition,tT._setLocalPosition),tT.registerAnimationNodeProperty("localRotation",tT._getLocalRotation,tT._setLocalRotation),tT.registerAnimationNodeProperty("localScale",tT._getLocalScale,tT._setLocalScale),tT.registerAnimationNodeProperty("localRotationEuler",tT._getLocalRotationEuler,tT._setLocalRotationEuler),tT.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",tT._getParticleRenderSharedMaterialTintColor,tT._setParticleRenderSharedMaterialTintColor),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",tT._getMeshRenderSharedMaterialTilingOffset,tT._setMeshRenderSharedMaterialTilingOffset),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",tT._getMeshRenderSharedMaterialAlbedo,tT._setMeshRenderSharedMaterialAlbedo),tT.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",tT._getSkinnedMeshRenderSharedMaterialTilingOffset,tT._setSkinnedMeshRenderSharedMaterialTilingOffset),tT.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",tT._getSkinnedMeshRenderSharedMaterialAlbedo,tT._setSkinnedMeshRenderSharedMaterialAlbedo),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",tT._getMeshRenderSharedMaterialAlbedo,tT._setMeshRenderSharedMaterialAlbedo),tT.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",tT._getSkinnedMeshRenderSharedMaterialAlbedo,tT._setSkinnedMeshRenderSharedMaterialAlbedo),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",tT._getMeshRenderSharedMaterialIntensity,tT._setMeshRenderSharedMaterialIntensity),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",tT._getMeshRenderSharedMaterialAlpha,tT._setMeshRenderSharedMaterialAlpha),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",tT._getMeshRenderSharedMaterialAlphaColor,tT._setMeshRenderSharedMaterialAlphaColor),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",tT._getMeshRenderSharedMaterialBaseColor,tT._setMeshRenderSharedMaterialBaseColor),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",tT._getMeshRenderSharedMaterialDissolve,tT._setMeshRenderSharedMaterialDissolve),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",tT._getMeshRenderSharedMaterialDissolveSpeed,tT._setMeshRenderSharedMaterialDissolveSpeed),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",tT._getMeshRenderSharedMaterialMMultiplier,tT._setMeshRenderSharedMaterialMMultiplier),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",tT._getMeshRenderSharedMaterialBaseScrollSpeedX,tT._setMeshRenderSharedMaterialBaseScrollSpeedX),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",tT._getMeshRenderSharedMaterialBaseScrollSpeedY,tT._setMeshRenderSharedMaterialBaseScrollSpeedY),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",tT._getMeshRenderSharedMaterialSecondScrollSpeedX,tT._setMeshRenderSharedMaterialSecondScrollSpeedX),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",tT._getMeshRenderSharedMaterialSecondScrollSpeedY,tT._setMeshRenderSharedMaterialSecondScrollSpeedY),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",tT._getMeshRenderSharedMaterialDetailTilingOffset,tT._setMeshRenderSharedMaterialDetailTilingOffset),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",tT._getMeshRenderSharedMaterialDissolveTilingOffset,tT._setMeshRenderSharedMaterialDissolveTilingOffset),tT.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",tT._getMeshRenderSharedMaterialMaskTilingOffset,tT._setMeshRenderSharedMaterialMaskTilingOffset)},tT.registerAnimationNodeProperty=function(tD,tY,tg){if(tT._propertyIndexDic[tD])throw new Error("AnimationNode: this propertyName has registered.");tT._propertyIndexDic[tD]=tT._propertyIDCounter,tT._propertyGetFuncs[tT._propertyIDCounter]=tY,tT._propertySetFuncs[tT._propertyIDCounter]=tg,tT._propertyIDCounter++},tT._getLocalPosition=function(tD,tY){return tD?tD.transform.getLocalPosition():tY._transform.localPosition.elements},tT._setLocalPosition=function(tD,tY,tg){if(tD)tD.transform.setLocalPosition(tg);else{var tT=tY._transform,tr=tT.localPosition;tr.elements=tg,tT.localPosition=tr}},tT._getLocalRotation=function(tD,tY){return tD?tD.transform.getLocalRotation():tY._transform.localRotation.elements},tT._setLocalRotation=function(tD,tY,tg){if(tD)tD.transform.setLocalRotation(tg);else{var tT=tY._transform,tr=tT.localRotation;tr.elements=tg,tT.localRotation=tr}},tT._getLocalScale=function(tD,tY){return tD?tD.transform.getLocalScale():tY._transform.localScale.elements},tT._setLocalScale=function(tD,tY,tg){if(tD)tD.transform.setLocalScale(tg);else{var tT=tY._transform,tr=tT.localScale;tr.elements=tg,tT.localScale=tr}},tT._getLocalRotationEuler=function(tD,tY){return tD?tD.transform.getLocalRotationEuler():tY._transform.localRotationEuler.elements},tT._setLocalRotationEuler=function(tD,tY,tg){if(tD)tD.transform.setLocalRotationEuler(tg);else{var tT=tY._transform,tr=tT.localRotationEuler;tr.elements=tg,tT.localRotationEuler=tr}},tT._getMeshRenderSharedMaterialTilingOffset=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return tY.meshRender.sharedMaterial.tilingOffset.elements},tT._setMeshRenderSharedMaterialTilingOffset=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).tilingOffset).elements=tg,tT.tilingOffset=tr)}else(tr=(tT=tY.meshRender.material).tilingOffset).elements=tg,tT.tilingOffset=tr},tT._getMeshRenderSharedMaterialAlbedo=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.albedoColor.elements:null}return tY.meshRender.sharedMaterial.albedoColor.elements},tT._setMeshRenderSharedMaterialAlbedo=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).albedoColor).elements=tg,tT.albedoColor=tr)}else(tr=(tT=tY.meshRender.material).albedoColor).elements=tg,tT.albedoColor=tr},tT._getSkinnedMeshRenderSharedMaterialTilingOffset=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return tY.skinnedMeshRender.sharedMaterial.tilingOffset.elements},tT._setSkinnedMeshRenderSharedMaterialTilingOffset=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.skinnedMeshRender.material).tilingOffset).elements=tg,tT.tilingOffset=tr)}else(tr=(tT=tY.skinnedMeshRender.material).tilingOffset).elements=tg,tT.tilingOffset=tr},tT._getSkinnedMeshRenderSharedMaterialAlbedo=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return tY.skinnedMeshRender.sharedMaterial.albedoColor.elements},tT._setSkinnedMeshRenderSharedMaterialAlbedo=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.skinnedMeshRender.material).albedoColor).elements=tg,tT.albedoColor=tr)}else(tr=(tT=tY.skinnedMeshRender.material).albedoColor).elements=tg,tT.albedoColor=tr},tT._getParticleRenderSharedMaterialTintColor=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.particleRender.sharedMaterial.tintColor.elements:null}return tY.particleRender.sharedMaterial.tintColor.elements},tT._setParticleRenderSharedMaterialTintColor=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.particleRender.material).tintColor).elements=tg,tT.tintColor=tr)}else(tr=(tT=tY.particleRender.material).tintColor).elements=tg,tT.tintColor=tr},tT._getMeshRenderSharedMaterialAlphaColor=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.alphaColor.elements:null}return tY.meshRender.sharedMaterial.alphaColor.elements},tT._setMeshRenderSharedMaterialAlphaColor=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).alphaColor).elements=tg,tT.alphaColor=tr)}else(tr=(tT=tY.meshRender.material).alphaColor).elements=tg,tT.alphaColor=tr},tT._getMeshRenderSharedMaterialBaseColor=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.baseColor.elements:null}return tY.meshRender.sharedMaterial.baseColor.elements},tT._setMeshRenderSharedMaterialBaseColor=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).baseColor).elements=tg,tT.baseColor=tr)}else(tr=(tT=tY.meshRender.material).baseColor).elements=tg,tT.baseColor=tr},tT._getMeshRenderSharedMaterialDissolve=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.dissolve:0}return tY.meshRender.sharedMaterial.dissolve},tT._setMeshRenderSharedMaterialDissolve=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.dissolve=tg[0])}else tY.meshRender.material.dissolve=tg[0]},tT._getMeshRenderSharedMaterialDissolveSpeed=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.dissolveSpeed:0}return tY.meshRender.sharedMaterial.dissolveSpeed},tT._setMeshRenderSharedMaterialDissolveSpeed=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.dissolveSpeed=tg[0])}else tY.meshRender.material.dissolveSpeed=tg[0]},tT._getMeshRenderSharedMaterialMMultiplier=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.mMultiplier:0}return tY.meshRender.sharedMaterial.mMultiplier},tT._setMeshRenderSharedMaterialMMultiplier=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.mMultiplier=tg[0])}else tY.meshRender.material.mMultiplier=tg[0]},tT._getMeshRenderSharedMaterialBaseScrollSpeedX=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return tY.meshRender.sharedMaterial.baseScrollSpeedX},tT._setMeshRenderSharedMaterialBaseScrollSpeedX=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.baseScrollSpeedX=tg[0])}else tY.meshRender.material.baseScrollSpeedX=tg[0]},tT._getMeshRenderSharedMaterialBaseScrollSpeedY=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return tY.meshRender.sharedMaterial.baseScrollSpeedY},tT._setMeshRenderSharedMaterialBaseScrollSpeedY=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.baseScrollSpeedY=tg[0])}else tY.meshRender.material.baseScrollSpeedY=tg[0]},tT._getMeshRenderSharedMaterialSecondScrollSpeedX=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return tY.meshRender.sharedMaterial.secondScrollSpeedX},tT._setMeshRenderSharedMaterialSecondScrollSpeedX=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.secondScrollSpeedX=tg[0])}else tY.meshRender.material.secondScrollSpeedX=tg[0]},tT._getMeshRenderSharedMaterialSecondScrollSpeedY=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return tY.meshRender.sharedMaterial.secondScrollSpeedY},tT._setMeshRenderSharedMaterialSecondScrollSpeedY=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.secondScrollSpeedY=tg[0])}else tY.meshRender.material.secondScrollSpeedY=tg[0]},tT._getMeshRenderSharedMaterialAlpha=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.alpha:0}return tY.meshRender.sharedMaterial.alpha},tT._setMeshRenderSharedMaterialAlpha=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.alpha=tg[0])}else tY.meshRender.material.alpha=tg[0]},tT._getMeshRenderSharedMaterialIntensity=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.intensity:0}return tY.meshRender.sharedMaterial.intensity},tT._setMeshRenderSharedMaterialIntensity=function(tD,tY,tg){if(tD){var tT=tD.transform._entity;tT&&(tT.owner.meshRender.material.intensity=tg[0])}else tY.meshRender.material.intensity=tg[0]},tT._getMeshRenderSharedMaterialDetailTilingOffset=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return tY.meshRender.sharedMaterial.detailTilingOffset.elements},tT._setMeshRenderSharedMaterialDetailTilingOffset=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).detailTilingOffset).elements=tg,tT.detailTilingOffset=tr)}else(tr=(tT=tY.meshRender.material).detailTilingOffset).elements=tg,tT.detailTilingOffset=tr},tT._getMeshRenderSharedMaterialDissolveTilingOffset=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return tY.meshRender.sharedMaterial.dissolveTilingOffset.elements},tT._setMeshRenderSharedMaterialDissolveTilingOffset=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).dissolveTilingOffset).elements=tg,tT.dissolveTilingOffset=tr)}else(tr=(tT=tY.meshRender.material).dissolveTilingOffset).elements=tg,tT.dissolveTilingOffset=tr},tT._getMeshRenderSharedMaterialMaskTilingOffset=function(tD,tY){if(tD){var tg=tD.transform._entity;return tg?tg.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return tY.meshRender.sharedMaterial.maskTilingOffset.elements},tT._setMeshRenderSharedMaterialMaskTilingOffset=function(tD,tY,tg){var tT,tr;if(tD){var ts=tD.transform._entity;ts&&((tr=(tT=ts.owner.meshRender.material).maskTilingOffset).elements=tg,tT.maskTilingOffset=tr)}else(tr=(tT=tY.meshRender.material).maskTilingOffset).elements=tg,tT.maskTilingOffset=tr},tT._propertyIDCounter=0,tT._propertyIndexDic={},tT._propertySetFuncs=[],tT._propertyGetFuncs=[],tT}(),tc=function(){function tD(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return tN(tD,"laya.d3.animation.Keyframe"),tD}(),tf=function(){function tD(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return tN(tD,"laya.d3.animation.KeyframeNode"),tD}(),ti=(function(){function tD(){this._tempVector30=new tEY,this._tempVector31=new tEY,this._tempVector32=new tEY,this._a=new tEY,this._b=new tEY,this._c=new tEY,this._d=new tEY}tN(tD,"laya.d3.core.glitter.SplineCurvePositionVelocity");var tY=tD.prototype;tY.Init=function(tD,tY,tg,tT){tD.cloneTo(this._d),tY.cloneTo(this._c),tEY.scale(tD,2,this._a),tEY.scale(tg,2,this._tempVector30),tEY.subtract(this._a,this._tempVector30,this._a),tEY.add(this._a,tY,this._a),tEY.add(this._a,tT,this._a),tEY.scale(tg,3,this._b),tEY.scale(tD,3,this._tempVector30),tEY.subtract(this._b,this._tempVector30,this._b),tEY.subtract(this._b,tT,this._b),tEY.scale(tY,2,this._tempVector30),tEY.subtract(this._b,this._tempVector30,this._b)},tY.Slerp=function(tD,tY){tEY.scale(this._a,tD*tD*tD,this._tempVector30),tEY.scale(this._b,tD*tD,this._tempVector31),tEY.scale(this._c,tD,this._tempVector32),tEY.add(this._tempVector30,this._tempVector31,tY),tEY.add(tY,this._tempVector32,tY),tEY.add(tY,this._d,tY)}}(),function(){function tv(tD,tY,tg,tT){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=tD,this._h=tY,this._minHeight=tg,this._maxHeight=tT}tN(tv,"laya.d3.core.HeightMap");var tD=tv.prototype;tD._inBounds=function(tD,tY){return 0<=tD&&tD<this._h&&0<=tY&&tY<this._w},tD.getHeight=function(tD,tY){return this._inBounds(tD,tY)?this._datas[tD][tY]:NaN},t$(0,tD,"width",function(){return this._w}),t$(0,tD,"height",function(){return this._h}),t$(0,tD,"maxHeight",function(){return this._maxHeight}),t$(0,tD,"minHeight",function(){return this._minHeight}),tv.creatFromMesh=function(tD,tY,tg,tT){for(var tr=[],ts=[],ta=tD.getSubMeshCount(),tW=0;tW<ta;tW++){for(var tM=tD.getSubMesh(tW),tE=tM._getVertexBuffer(),tI=tE.getData(),tO=[],tC=0;tC<tI.length;tC+=tE.vertexDeclaration.vertexStride/4){var tN=new tEY(tI[tC+0],tI[tC+1],tI[tC+2]);tO.push(tN)}tr.push(tO);var t$=tM._getIndexBuffer();ts.push(t$.getData())}var td=tD.boundingBox,tJ=td.min.x,tx=td.min.z,tj=td.max.x,tZ=td.max.z,tp=td.min.y,tl=td.max.y,tt=tj-tJ,t_=tZ-tx,tA=tT.elements[0]=tt/(tY-1),tq=tT.elements[1]=t_/(tg-1),tb=new tv(tY,tg,tp,tl),tG=tv._tempRay,tX=tG.direction.elements;tX[0]=0,tX[1]=-1,tX[2]=0;var tz=tl+.1;tG.origin.elements[1]=tz;for(var tm=0;tm<tg;tm++){var th=tx+tm*tq;tb._datas[tm]=[];for(var ti=0;ti<tY;ti++){var tP=tJ+ti*tA,tB=tG.origin.elements;tB[0]=tP,tB[2]=th;var tH=tv._getPosition(tG,tr,ts);tb._datas[tm][ti]=tH===Number.MAX_VALUE?NaN:tz-tH}}return tb},tv.createFromImage=function(tD,tY,tg){for(var tT=tD.width,tr=tD.height,ts=new tv(tT,tr,tY,tg),ta=(tg-tY)/254,tW=tD.getPixels(),tM=0,tE=0;tE<tr;tE++)for(var tI=ts._datas[tE]=[],tO=0;tO<tT;tO++){var tC=tW[tM++],tN=tW[tM++],t$=tW[tM++],td=tW[tM++];tI[tO]=255==tC&&255==tN&&255==t$&&255==td?NaN:(tC+tN+t$)/3*ta+tY}return ts},tv._getPosition=function(tD,tY,tg){for(var tT=Number.MAX_VALUE,tr=0;tr<tY.length;tr++)for(var ts=tY[tr],ta=tg[tr],tW=0;tW<ta.length;tW+=3){var tM=ts[ta[tW+0]],tE=ts[ta[tW+1]],tI=ts[ta[tW+2]],tO=txY.rayIntersectsTriangle(tD,tM,tE,tI);!isNaN(tO)&&tO<tT&&(tT=tO)}return tT},tO(tv,["_tempRay",function(){return this._tempRay=new tWY(new tEY,new tEY)}])}(),function(){function tr(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}tN(tr,"laya.d3.core.Layer");var tD=tr.prototype;return tD._binarySearchIndex=function(){for(var tD=0,tY=tr._collsionTestList.length-1,tg=0;tD<=tY;){tg=Math.floor((tD+tY)/2);var tT=tr._collsionTestList[tg];if(tT==this._number)return tg;tT>this._number?tY=tg-1:tD=tg+1}return tD},tD._addCollider=function(tD){0===this._colliders.length&&tr._collsionTestList.splice(this._binarySearchIndex(),0,this._number),tD._isRigidbody?(this._colliders.unshift(tD),this._nonRigidbodyOffset++):this._colliders.push(tD)},tD._removeCollider=function(tD){var tY=this._colliders.indexOf(tD);tY<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(tY,1),0===this._colliders.length&&tr._collsionTestList.splice(tr._collsionTestList.indexOf(this._number),1)},t$(0,tD,"number",function(){return this._number}),t$(0,tD,"visible",function(){return this._visible},function(tD){this._visible=tD,tr._visibleLayers=tD?tr._visibleLayers|this.mask:tr._visibleLayers&~this.mask}),t$(0,tD,"mask",function(){return this._mask}),t$(1,tr,"visibleLayers",function(){return tr._visibleLayers},function(tD){tr._visibleLayers=tD;for(var tY=0,tg=tr._layerList.length;tY<tg;tY++){var tT=tr._layerList[tY];tT._visible=0!=(tT._mask&tr._visibleLayers)}}),tr.__init__=function(){tr._layerList.length=31;for(var tD=0;tD<31;tD++){var tY=new tr;tr._layerList[tD]=tY,0===tD?(tY.name="Default Layer",tY.visible=!0):(tY.name="Layer-"+tD,tY.visible=!1),tY._number=tD,tY._mask=Math.pow(2,tD)}tr.currentCreationLayer=tr._layerList[0]},tr.getLayerByNumber=function(tD){if(tD<0||30<tD)throw new Error("无法返回指定Layer，该number超出范围！");return tr._layerList[tD]},tr.getLayerByName=function(tD){for(var tY=0;tY<31;tY++)if(tr._layerList[tY].name===tD)return tr._layerList[tY];throw new Error("无法返回指定Layer,该name不存在")},tr.isVisible=function(tD){return 0!=(tD&tr._currentCameraCullingMask&tr._visibleLayers)},tr._layerList=[],tr._visibleLayers=2147483647,tr._collsionTestList=[],tr._currentCameraCullingMask=2147483647,tr.maxCount=31,tr.currentCreationLayer=null,tr}()),tP=(function(){function tD(tD,tY,tg){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=tD,this._minCount=tY,this._maxCount=tg}tN(tD,"laya.d3.core.particleShuriKen.module.Burst");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.cloneTo=function(tD){var tY=tD;tY._time=this._time,tY._minCount=this._minCount,tY._maxCount=this._maxCount},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"time",function(){return this._time}),t$(0,tY,"minCount",function(){return this._minCount}),t$(0,tY,"maxCount",function(){return this._maxCount})}(),function(){function tD(tD){this._color=null,this.enbale=!1,this._color=tD}tN(tD,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var tY=tD.prototype;tY.cloneTo=function(tD){var tY=tD;this._color.cloneTo(tY._color),tY.enbale=this.enbale},tY.clone=function(){var tD;switch(this._color.type){case 0:tD=tH.createByConstant(this._color.constant.clone());break;case 1:tD=tH.createByGradient(this._color.gradient.clone());break;case 2:tD=tH.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:tD=tH.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var tY=new this.constructor(tD);return tY.enbale=this.enbale,tY},t$(0,tY,"color",function(){return this._color})}(),function(){function tD(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}tN(tD,"laya.d3.core.particleShuriKen.module.Emission");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),tY._destroy=function(){this._bursts=null,this._destroyed=!0},tY.getBurstsCount=function(){return this._bursts.length},tY.getBurstByIndex=function(tD){return this._bursts[tD]},tY.addBurst=function(tD){var tY=this._bursts.length;if(0<tY)for(var tg=0;tg<tY;tg++)this._bursts[tg].time>tD.time&&this._bursts.splice(tg,0,tD);this._bursts.push(tD)},tY.removeBurst=function(tD){var tY=this._bursts.indexOf(tD);-1!==tY&&this._bursts.splice(tY,1)},tY.removeBurstByIndex=function(tD){this._bursts.splice(tD,1)},tY.clearBurst=function(){this._bursts.length=0},tY.cloneTo=function(tD){var tY=tD,tg=tY._bursts;tg.length=this._bursts.length;for(var tT=0,tr=this._bursts.length;tT<tr;tT++){var ts=tg[tT];ts?this._bursts[tT].cloneTo(ts):tg[tT]=this._bursts[tT].clone()}tY._emissionRate=this._emissionRate,tY.enbale=this.enbale},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"destroyed",function(){return this._destroyed}),t$(0,tY,"emissionRate",function(){return this._emissionRate},function(tD){if(tD<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=tD})}(),function(){function tT(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}tN(tT,"laya.d3.core.particleShuriKen.module.FrameOverTime");var tD=tT.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.cloneTo=function(tD){var tY=tD;tY._type=this._type,tY._constant=this._constant,this._overTime.cloneTo(tY._overTime),tY._constantMin=this._constantMin,tY._constantMax=this._constantMax,this._overTimeMin.cloneTo(tY._overTimeMin),this._overTimeMax.cloneTo(tY._overTimeMax)},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tD,"frameOverTimeData",function(){return this._overTime}),t$(0,tD,"constant",function(){return this._constant}),t$(0,tD,"type",function(){return this._type}),t$(0,tD,"frameOverTimeDataMin",function(){return this._overTimeMin}),t$(0,tD,"constantMin",function(){return this._constantMin}),t$(0,tD,"frameOverTimeDataMax",function(){return this._overTimeMax}),t$(0,tD,"constantMax",function(){return this._constantMax}),tT.createByConstant=function(tD){var tY=new tT;return tY._type=0,tY._constant=tD,tY},tT.createByOverTime=function(tD){var tY=new tT;return tY._type=1,tY._overTime=tD,tY},tT.createByRandomTwoConstant=function(tD,tY){var tg=new tT;return tg._type=2,tg._constantMin=tD,tg._constantMax=tY,tg},tT.createByRandomTwoOverTime=function(tD,tY){var tg=new tT;return tg._type=3,tg._overTimeMin=tD,tg._overTimeMax=tY,tg},tT}()),tB=function(){function tE(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}tN(tE,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var tD=tE.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.cloneTo=function(tD){var tY=tD;tY._type=this._type,tY._separateAxes=this._separateAxes,tY._constant=this._constant,this._constantSeparate.cloneTo(tY._constantSeparate),this._gradient.cloneTo(tY._gradient),this._gradientX.cloneTo(tY._gradientX),this._gradientY.cloneTo(tY._gradientY),this._gradientZ.cloneTo(tY._gradientZ),tY._constantMin=this._constantMin,tY._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(tY._constantMinSeparate),this._constantMaxSeparate.cloneTo(tY._constantMaxSeparate),this._gradientMin.cloneTo(tY._gradientMin),this._gradientMax.cloneTo(tY._gradientMax),this._gradientXMin.cloneTo(tY._gradientXMin),this._gradientXMax.cloneTo(tY._gradientXMax),this._gradientYMin.cloneTo(tY._gradientYMin),this._gradientYMax.cloneTo(tY._gradientYMax),this._gradientZMin.cloneTo(tY._gradientZMin),this._gradientZMax.cloneTo(tY._gradientZMax)},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tD,"gradientZ",function(){return this._gradientZ}),t$(0,tD,"constant",function(){return this._constant}),t$(0,tD,"gradient",function(){return this._gradient}),t$(0,tD,"separateAxes",function(){return this._separateAxes}),t$(0,tD,"type",function(){return this._type}),t$(0,tD,"constantSeparate",function(){return this._constantSeparate}),t$(0,tD,"gradientX",function(){return this._gradientX}),t$(0,tD,"gradientY",function(){return this._gradientY}),t$(0,tD,"gradientW",function(){return this._gradientW}),t$(0,tD,"gradientMin",function(){return this._gradientMin}),t$(0,tD,"constantMin",function(){return this._constantMin}),t$(0,tD,"gradientMax",function(){return this._gradientMax}),t$(0,tD,"constantMax",function(){return this._constantMax}),t$(0,tD,"gradientWMin",function(){return this._gradientWMin}),t$(0,tD,"constantMinSeparate",function(){return this._constantMinSeparate}),t$(0,tD,"constantMaxSeparate",function(){return this._constantMaxSeparate}),t$(0,tD,"gradientXMin",function(){return this._gradientXMin}),t$(0,tD,"gradientXMax",function(){return this._gradientXMax}),t$(0,tD,"gradientWMax",function(){return this._gradientWMax}),t$(0,tD,"gradientYMin",function(){return this._gradientYMin}),t$(0,tD,"gradientYMax",function(){return this._gradientYMax}),t$(0,tD,"gradientZMin",function(){return this._gradientZMin}),t$(0,tD,"gradientZMax",function(){return this._gradientZMax}),tE.createByConstant=function(tD){var tY=new tE;return tY._type=0,tY._separateAxes=!1,tY._constant=tD,tY},tE.createByConstantSeparate=function(tD){var tY=new tE;return tY._type=0,tY._separateAxes=!0,tY._constantSeparate=tD,tY},tE.createByGradient=function(tD){var tY=new tE;return tY._type=1,tY._separateAxes=!1,tY._gradient=tD,tY},tE.createByGradientSeparate=function(tD,tY,tg,tT){var tr=new tE;return tr._type=1,tr._separateAxes=!0,tr._gradientX=tD,tr._gradientY=tY,tr._gradientZ=tg,tr._gradientW=tT,tr},tE.createByRandomTwoConstant=function(tD,tY){var tg=new tE;return tg._type=2,tg._separateAxes=!1,tg._constantMin=tD,tg._constantMax=tY,tg},tE.createByRandomTwoConstantSeparate=function(tD,tY){var tg=new tE;return tg._type=2,tg._separateAxes=!0,tg._constantMinSeparate=tD,tg._constantMaxSeparate=tY,tg},tE.createByRandomTwoGradient=function(tD,tY){var tg=new tE;return tg._type=3,tg._separateAxes=!1,tg._gradientMin=tD,tg._gradientMax=tY,tg},tE.createByRandomTwoGradientSeparate=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM=new tE;return tM._type=3,tM._separateAxes=!0,tM._gradientXMin=tD,tM._gradientXMax=tY,tM._gradientYMin=tg,tM._gradientYMax=tT,tM._gradientZMin=tr,tM._gradientZMax=ts,tM._gradientWMin=ta,tM._gradientWMax=tW,tM},tE}(),tH=function(){function tT(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}tN(tT,"laya.d3.core.particleShuriKen.module.GradientColor");var tD=tT.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.cloneTo=function(tD){var tY=tD;tY._type=this._type,this._constant.cloneTo(tY._constant),this._constantMin.cloneTo(tY._constantMin),this._constantMax.cloneTo(tY._constantMax),this._gradient.cloneTo(tY._gradient),this._gradientMin.cloneTo(tY._gradientMin),this._gradientMax.cloneTo(tY._gradientMax)},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tD,"gradient",function(){return this._gradient}),t$(0,tD,"constant",function(){return this._constant}),t$(0,tD,"type",function(){return this._type}),t$(0,tD,"gradientMin",function(){return this._gradientMin}),t$(0,tD,"constantMin",function(){return this._constantMin}),t$(0,tD,"gradientMax",function(){return this._gradientMax}),t$(0,tD,"constantMax",function(){return this._constantMax}),tT.createByConstant=function(tD){var tY=new tT;return tY._type=0,tY._constant=tD,tY},tT.createByGradient=function(tD){var tY=new tT;return tY._type=1,tY._gradient=tD,tY},tT.createByRandomTwoConstant=function(tD,tY){var tg=new tT;return tg._type=2,tg._constantMin=tD,tg._constantMax=tY,tg},tT.createByRandomTwoGradient=function(tD,tY){var tg=new tT;return tg._type=3,tg._gradientMin=tD,tg._gradientMax=tY,tg},tT}(),tv=(function(){function tD(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}tN(tD,"laya.d3.core.particleShuriKen.module.GradientDataColor");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.addAlpha=function(tD,tY){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==tD&&(tD=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=tD,this._alphaElements[this._alphaCurrentLength++]=tY):DEBUG},tY.addRGB=function(tD,tY){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==tD&&(tD=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=tD,this._rgbElements[this._rgbCurrentLength++]=tY.x,this._rgbElements[this._rgbCurrentLength++]=tY.y,this._rgbElements[this._rgbCurrentLength++]=tY.z):DEBUG},tY.cloneTo=function(tD){var tY=tD,tg=0,tT=0;tY._alphaCurrentLength=this._alphaCurrentLength;var tr=tY._alphaElements;for(tr.length=this._alphaElements.length,tg=0,tT=this._alphaElements.length;tg<tT;tg++)tr[tg]=this._alphaElements[tg];tY._rgbCurrentLength=this._rgbCurrentLength;var ts=tY._rgbElements;for(ts.length=this._rgbElements.length,tg=0,tT=this._rgbElements.length;tg<tT;tg++)ts[tg]=this._rgbElements[tg]},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),t$(0,tY,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function tD(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}tN(tD,"laya.d3.core.particleShuriKen.module.GradientDataInt");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.add=function(tD,tY){this._currentLength<8?(6===this._currentLength&&1!==tD&&(tD=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=tD,this._elements[this._currentLength++]=tY):console.log("Warning:data count must lessEqual than 4")},tY.cloneTo=function(tD){var tY=tD;tY._currentLength=this._currentLength;var tg=tY._elements;tg.length=this._elements.length;for(var tT=0,tr=this._elements.length;tT<tr;tT++)tg[tT]=this._elements[tT]},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"gradientCount",function(){return this._currentLength/2})}(),function(){function tD(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}tN(tD,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.add=function(tD,tY){this._currentLength<8?(6===this._currentLength&&1!==tD&&(tD=1,DEBUG),this._elements[this._currentLength++]=tD,this._elements[this._currentLength++]=tY):DEBUG},tY.getKeyByIndex=function(tD){return this._elements[2*tD]},tY.getValueByIndex=function(tD){return this._elements[2*tD+1]},tY.getAverageValue=function(){for(var tD=0,tY=this._currentLength-2;tD<tY;tD+=2){this._elements[tD+1];this._elements[tD+3],this._elements[tD+2]-this._elements[tD]}return 0},tY.cloneTo=function(tD){var tY=tD;tY._currentLength=this._currentLength;var tg=tY._elements;tg.length=this._elements.length;for(var tT=0,tr=this._elements.length;tT<tr;tT++)tg[tT]=this._elements[tT]},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"gradientCount",function(){return this._currentLength/2})}(),function(){function tD(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}tN(tD,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.add=function(tD,tY){this._currentLength<8?(6===this._currentLength&&1!==tD&&(tD=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=tD,this._elements[this._currentLength++]=tY.x,this._elements[this._currentLength++]=tY.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},tY.cloneTo=function(tD){var tY=tD;tY._currentLength=this._currentLength;var tg=tY._elements;tg.length=this._elements.length;for(var tT=0,tr=this._elements.length;tT<tr;tT++)tg[tT]=this._elements[tT]},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"gradientCount",function(){return this._currentLength/3})}(),function(){function tW(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}tN(tW,"laya.d3.core.particleShuriKen.module.GradientSize");var tD=tW.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.getMaxSizeInGradient=function(){var tD=0,tY=0,tg=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(tD=0,tY=this._gradientX.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientX.getValueByIndex(tD));for(tD=0,tY=this._gradientY.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientY.getValueByIndex(tD))}else for(tD=0,tY=this._gradient.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradient.getValueByIndex(tD));break;case 1:tg=this._separateAxes?(tg=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),tg=Math.max(tg,this._constantMinSeparate.y),Math.max(tg,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(tD=0,tY=this._gradientXMin.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientXMin.getValueByIndex(tD));for(tD=0,tY=this._gradientXMax.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientXMax.getValueByIndex(tD));for(tD=0,tY=this._gradientYMin.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientYMin.getValueByIndex(tD));for(tD=0,tY=this._gradientZMax.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientZMax.getValueByIndex(tD))}else{for(tD=0,tY=this._gradientMin.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientMin.getValueByIndex(tD));for(tD=0,tY=this._gradientMax.gradientCount;tD<tY;tD++)tg=Math.max(tg,this._gradientMax.getValueByIndex(tD))}}return tg},tD.cloneTo=function(tD){var tY=tD;tY._type=this._type,tY._separateAxes=this._separateAxes,this._gradient.cloneTo(tY._gradient),this._gradientX.cloneTo(tY._gradientX),this._gradientY.cloneTo(tY._gradientY),this._gradientZ.cloneTo(tY._gradientZ),tY._constantMin=this._constantMin,tY._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(tY._constantMinSeparate),this._constantMaxSeparate.cloneTo(tY._constantMaxSeparate),this._gradientMin.cloneTo(tY._gradientMin),this._gradientMax.cloneTo(tY._gradientMax),this._gradientXMin.cloneTo(tY._gradientXMin),this._gradientXMax.cloneTo(tY._gradientXMax),this._gradientYMin.cloneTo(tY._gradientYMin),this._gradientYMax.cloneTo(tY._gradientYMax),this._gradientZMin.cloneTo(tY._gradientZMin),this._gradientZMax.cloneTo(tY._gradientZMax)},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tD,"gradientZ",function(){return this._gradientZ}),t$(0,tD,"gradient",function(){return this._gradient}),t$(0,tD,"separateAxes",function(){return this._separateAxes}),t$(0,tD,"type",function(){return this._type}),t$(0,tD,"gradientMin",function(){return this._gradientMin}),t$(0,tD,"constantMin",function(){return this._constantMin}),t$(0,tD,"gradientX",function(){return this._gradientX}),t$(0,tD,"gradientY",function(){return this._gradientY}),t$(0,tD,"gradientMax",function(){return this._gradientMax}),t$(0,tD,"constantMax",function(){return this._constantMax}),t$(0,tD,"constantMinSeparate",function(){return this._constantMinSeparate}),t$(0,tD,"constantMaxSeparate",function(){return this._constantMaxSeparate}),t$(0,tD,"gradientXMin",function(){return this._gradientXMin}),t$(0,tD,"gradientXMax",function(){return this._gradientXMax}),t$(0,tD,"gradientYMin",function(){return this._gradientYMin}),t$(0,tD,"gradientYMax",function(){return this._gradientYMax}),t$(0,tD,"gradientZMin",function(){return this._gradientZMin}),t$(0,tD,"gradientZMax",function(){return this._gradientZMax}),tW.createByGradient=function(tD){var tY=new tW;return tY._type=0,tY._separateAxes=!1,tY._gradient=tD,tY},tW.createByGradientSeparate=function(tD,tY,tg){var tT=new tW;return tT._type=0,tT._separateAxes=!0,tT._gradientX=tD,tT._gradientY=tY,tT._gradientZ=tg,tT},tW.createByRandomTwoConstant=function(tD,tY){var tg=new tW;return tg._type=1,tg._separateAxes=!1,tg._constantMin=tD,tg._constantMax=tY,tg},tW.createByRandomTwoConstantSeparate=function(tD,tY){var tg=new tW;return tg._type=1,tg._separateAxes=!0,tg._constantMinSeparate=tD,tg._constantMaxSeparate=tY,tg},tW.createByRandomTwoGradient=function(tD,tY){var tg=new tW;return tg._type=2,tg._separateAxes=!1,tg._gradientMin=tD,tg._gradientMax=tY,tg},tW.createByRandomTwoGradientSeparate=function(tD,tY,tg,tT,tr,ts){var ta=new tW;return ta._type=2,ta._separateAxes=!0,ta._gradientXMin=tD,ta._gradientXMax=tY,ta._gradientYMin=tg,ta._gradientYMax=tT,ta._gradientZMin=tr,ta._gradientZMax=ts,ta},tW}()),tS=function(){function tW(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}tN(tW,"laya.d3.core.particleShuriKen.module.GradientVelocity");var tD=tW.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.cloneTo=function(tD){var tY=tD;tY._type=this._type,this._constant.cloneTo(tY._constant),this._gradientX.cloneTo(tY._gradientX),this._gradientY.cloneTo(tY._gradientY),this._gradientZ.cloneTo(tY._gradientZ),this._constantMin.cloneTo(tY._constantMin),this._constantMax.cloneTo(tY._constantMax),this._gradientXMin.cloneTo(tY._gradientXMin),this._gradientXMax.cloneTo(tY._gradientXMax),this._gradientYMin.cloneTo(tY._gradientYMin),this._gradientYMax.cloneTo(tY._gradientYMax),this._gradientZMin.cloneTo(tY._gradientZMin),this._gradientZMax.cloneTo(tY._gradientZMax)},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tD,"gradientZ",function(){return this._gradientZ}),t$(0,tD,"constant",function(){return this._constant}),t$(0,tD,"type",function(){return this._type}),t$(0,tD,"gradientXMax",function(){return this._gradientXMax}),t$(0,tD,"constantMin",function(){return this._constantMin}),t$(0,tD,"gradientX",function(){return this._gradientX}),t$(0,tD,"gradientY",function(){return this._gradientY}),t$(0,tD,"gradientXMin",function(){return this._gradientXMin}),t$(0,tD,"constantMax",function(){return this._constantMax}),t$(0,tD,"gradientYMin",function(){return this._gradientYMin}),t$(0,tD,"gradientYMax",function(){return this._gradientYMax}),t$(0,tD,"gradientZMin",function(){return this._gradientZMin}),t$(0,tD,"gradientZMax",function(){return this._gradientZMax}),tW.createByConstant=function(tD){var tY=new tW;return tY._type=0,tY._constant=tD,tY},tW.createByGradient=function(tD,tY,tg){var tT=new tW;return tT._type=1,tT._gradientX=tD,tT._gradientY=tY,tT._gradientZ=tg,tT},tW.createByRandomTwoConstant=function(tD,tY){var tg=new tW;return tg._type=2,tg._constantMin=tD,tg._constantMax=tY,tg},tW.createByRandomTwoGradient=function(tD,tY,tg,tT,tr,ts){var ta=new tW;return ta._type=3,ta._gradientXMin=tD,ta._gradientXMax=tY,ta._gradientYMin=tg,ta._gradientYMax=tT,ta._gradientZMin=tr,ta._gradientZMax=ts,ta},tW}(),tU=(function(){function tD(tD){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=tD}tN(tD,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.cloneTo=function(tD){var tY=tD;this._angularVelocity.cloneTo(tY._angularVelocity),tY.enbale=this.enbale},tY.clone=function(){var tD;switch(this._angularVelocity.type){case 0:tD=this._angularVelocity.separateAxes?tB.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):tB.createByConstant(this._angularVelocity.constant);break;case 1:tD=this._angularVelocity.separateAxes?tB.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):tB.createByGradient(this._angularVelocity.gradient.clone());break;case 2:tD=this._angularVelocity.separateAxes?tB.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):tB.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:tD=this._angularVelocity.separateAxes?tB.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):tB.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var tY=new this.constructor(tD);return tY.enbale=this.enbale,tY},t$(0,tY,"angularVelocity",function(){return this._angularVelocity})}(),function(){function tD(){this.enable=!1,this.randomDirection=!1}tN(tD,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.core.IClone":!0}),tY._getShapeBoundBox=function(tD){throw new Error("BaseShape: must override it.")},tY._getSpeedBoundBox=function(tD){throw new Error("BaseShape: must override it.")},tY.generatePositionAndDirection=function(tD,tY,tg,tT){throw new Error("BaseShape: must override it.")},tY._calculateProceduralBounds=function(tD,tY,tg){this._getShapeBoundBox(tD);var tT=tD.min,tr=tD.max;tEY.multiply(tT,tY,tT),tEY.multiply(tr,tY,tr);var ts=new tLD(new tEY,new tEY);this.randomDirection?(ts.min=new tEY(-1,-1,-1),ts.max=new tEY(1,1,1)):this._getSpeedBoundBox(ts);var ta=new tLD(new tEY,new tEY),tW=ta.min,tM=ta.max;tEY.scale(ts.min,tg.y,tW),tEY.scale(ts.max,tg.y,tM),tEY.add(tD.min,tW,tW),tEY.add(tD.max,tM,tM),tEY.min(tD.min,tW,tD.min),tEY.max(tD.max,tW,tD.max);var tE=new tLD(new tEY,new tEY),tI=tE.min,tO=tE.max;tEY.scale(ts.min,tg.x,tI),tEY.scale(ts.max,tg.x,tO),tEY.min(tE.min,tO,tW),tEY.max(tE.min,tO,tM),tEY.min(tD.min,tW,tD.min),tEY.max(tD.max,tW,tD.max)},tY.cloneTo=function(tD){tD.enable=this.enable},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tD}()),te=function(){function ts(){}return tN(ts,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),ts._randomPointUnitArcCircle=function(tD,tY,tg){var tT=tY.elements,tr=NaN;tr=tg?tg.getFloat()*tD:Math.random()*tD,tT[0]=Math.cos(tr),tT[1]=Math.sin(tr)},ts._randomPointInsideUnitArcCircle=function(tD,tY,tg){var tT=tY.elements;ts._randomPointUnitArcCircle(tD,tY,tg);var tr=NaN;tr=tg?Math.pow(tg.getFloat(),.5):Math.pow(Math.random(),.5),tT[0]=tT[0]*tr,tT[1]=tT[1]*tr},ts._randomPointUnitCircle=function(tD,tY){var tg=tD.elements,tT=NaN;tT=tY?tY.getFloat()*Math.PI*2:Math.random()*Math.PI*2,tg[0]=Math.cos(tT),tg[1]=Math.sin(tT)},ts._randomPointInsideUnitCircle=function(tD,tY){var tg=tD.elements;ts._randomPointUnitCircle(tD);var tT=NaN;tT=tY?Math.pow(tY.getFloat(),.5):Math.pow(Math.random(),.5),tg[0]=tg[0]*tT,tg[1]=tg[1]*tT},ts._randomPointUnitSphere=function(tD,tY){var tg=tD.elements,tT=NaN,tr=NaN;tr=tY?(tT=tg[2]=2*tY.getFloat()-1,tY.getFloat()*Math.PI*2):(tT=tg[2]=2*Math.random()-1,Math.random()*Math.PI*2);var ts=Math.sqrt(1-tT*tT);tg[0]=ts*Math.cos(tr),tg[1]=ts*Math.sin(tr)},ts._randomPointInsideUnitSphere=function(tD,tY){var tg=tD.elements;ts._randomPointUnitSphere(tD);var tT=NaN;tT=tY?Math.pow(tY.getFloat(),1/3):Math.pow(Math.random(),1/3),tg[0]=tg[0]*tT,tg[1]=tg[1]*tT,tg[2]=tg[2]*tT},ts._randomPointInsideHalfUnitBox=function(tD,tY){var tg=tD.elements;tY?(tg[0]=tY.getFloat()-.5,tg[1]=tY.getFloat()-.5,tg[2]=tY.getFloat()-.5):(tg[0]=Math.random()-.5,tg[1]=Math.random()-.5,tg[2]=Math.random()-.5)},ts}(),tk=(function(){function tD(tD){this._size=null,this.enbale=!1,this._size=tD}tN(tD,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.cloneTo=function(tD){var tY=tD;this._size.cloneTo(tY._size),tY.enbale=this.enbale},tY.clone=function(){var tD;switch(this._size.type){case 0:tD=this._size.separateAxes?tv.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):tv.createByGradient(this._size.gradient.clone());break;case 1:tD=this._size.separateAxes?tv.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):tv.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:tD=this._size.separateAxes?tv.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):tv.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var tY=new this.constructor(tD);return tY.enbale=this.enbale,tY},t$(0,tY,"size",function(){return this._size})}(),function(){function tT(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}tN(tT,"laya.d3.core.particleShuriKen.module.StartFrame");var tD=tT.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.cloneTo=function(tD){var tY=tD;tY._type=this._type,tY._constant=this._constant,tY._constantMin=this._constantMin,tY._constantMax=this._constantMax},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tD,"constant",function(){return this._constant}),t$(0,tD,"type",function(){return this._type}),t$(0,tD,"constantMin",function(){return this._constantMin}),t$(0,tD,"constantMax",function(){return this._constantMax}),tT.createByConstant=function(tD){var tY=new tT;return tY._type=0,tY._constant=tD,tY},tT.createByRandomTwoConstant=function(tD,tY){var tg=new tT;return tg._type=1,tg._constantMin=tD,tg._constantMax=tY,tg},tT}()),tw=(function(){function tD(tD,tY){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new tMY(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=tD,this._startFrame=tY}tN(tD,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.cloneTo=function(tD){var tY=tD;this.tiles.cloneTo(tY.tiles),tY.type=this.type,tY.randomRow=this.randomRow,this._frame.cloneTo(tY._frame),this._startFrame.cloneTo(tY._startFrame),tY.cycles=this.cycles,tY.enableUVChannels=this.enableUVChannels,tY.enable=this.enable},tY.clone=function(){var tD,tY;switch(this._frame.type){case 0:tD=tP.createByConstant(this._frame.constant);break;case 1:tD=tP.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:tD=tP.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:tD=tP.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:tY=tk.createByConstant(this._startFrame.constant);break;case 1:tY=tk.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var tg=new this.constructor(tD,tY);return this.tiles.cloneTo(tg.tiles),tg.type=this.type,tg.randomRow=this.randomRow,tg.cycles=this.cycles,tg.enableUVChannels=this.enableUVChannels,tg.enable=this.enable,tg},t$(0,tY,"frame",function(){return this._frame}),t$(0,tY,"startFrame",function(){return this._startFrame})}(),function(){function tD(tD){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=tD}tN(tD,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var tY=tD.prototype;tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.cloneTo=function(tD){var tY=tD;this._velocity.cloneTo(tY._velocity),tY.enbale=this.enbale,tY.space=this.space},tY.clone=function(){var tD;switch(this._velocity.type){case 0:tD=tS.createByConstant(this._velocity.constant.clone());break;case 1:tD=tS.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:tD=tS.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:tD=tS.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var tY=new this.constructor(tD);return tY.enbale=this.enbale,tY.space=this.space,tY},t$(0,tY,"velocity",function(){return this._velocity})}(),function(){function tD(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new tdY,this._vb=tkY.create(tD._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=teY.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=tcY.nameKey.getID("LINE"),this._shaderCompile=tXY._preCompileShader[this._sharderNameID]}tN(tD,"laya.d3.core.PhasorSpriter3D");var tY=tD.prototype;return tY.line=function(tD,tY,tg,tT){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(tD.x,tD.y,tD.z,tY.x,tY.y,tY.z,tY.w),this.addVertex(tg.x,tg.y,tg.z,tT.x,tT.y,tT.z,tT.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},tY.circle=function(tD,tY,tg,tT,tr,ts){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*tY,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/tY,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*tD,Math.cos(this._tempNumver0)*tD,0,tg,tT,tr,ts),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},tY.plane=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=tT/2,this._tempNumver1=tr/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(tD-this._tempNumver0,tY+this._tempNumver1,tg,ts,ta,tW,tM),this.addVertex(tD+this._tempNumver0,tY+this._tempNumver1,tg,ts,ta,tW,tM),this.addVertex(tD-this._tempNumver0,tY-this._tempNumver1,tg,ts,ta,tW,tM),this.addVertex(tD+this._tempNumver0,tY-this._tempNumver1,tg,ts,ta,tW,tM),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},tY.box=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=tT/2,this._tempNumver1=tr/2,this._tempNumver2=ts/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(tD-this._tempNumver0,tY+this._tempNumver1,tg+this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD+this._tempNumver0,tY+this._tempNumver1,tg+this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD-this._tempNumver0,tY-this._tempNumver1,tg+this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD+this._tempNumver0,tY-this._tempNumver1,tg+this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD+this._tempNumver0,tY+this._tempNumver1,tg-this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD-this._tempNumver0,tY+this._tempNumver1,tg-this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD+this._tempNumver0,tY-this._tempNumver1,tg-this._tempNumver2,ta,tW,tM,tE),this.addVertex(tD-this._tempNumver0,tY-this._tempNumver1,tg-this._tempNumver2,ta,tW,tM,tE),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},tY.cone=function(tD,tY,tg,tT,tr,ts,ta){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*tg+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*tg>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/tg,this.addVertexIndex(0,tY,0,tT,tr,ts,ta,this._tempUint0),this.addVertexIndex(0,0,0,tT,tr,ts,ta,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<tg;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(tD*this._tempNumver2,0,tD*this._tempNumver3,tT,tr,ts,ta,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==tg-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(tD*this._tempNumver2,0,tD*this._tempNumver3,tT,tr,ts,ta,this._tempUint0+(this._tempInt0+tg)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==tg-1?this.addIndexes(this._tempUint1+tg+2):this.addIndexes(this._tempUint1+this._tempInt0+tg+1),this.addIndexes(this._tempUint1+this._tempInt0+tg),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},tY.boundingBoxLine=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(tD,tr,ts,ta,tW,tM,tE),this.addVertex(tT,tr,ts,ta,tW,tM,tE),this.addVertex(tD,tY,ts,ta,tW,tM,tE),this.addVertex(tT,tY,ts,ta,tW,tM,tE),this.addVertex(tT,tr,tg,ta,tW,tM,tE),this.addVertex(tD,tr,tg,ta,tW,tM,tE),this.addVertex(tT,tY,tg,ta,tW,tM,tE),this.addVertex(tD,tY,tg,ta,tW,tM,tE),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},tY.addVertex=function(tD,tY,tg,tT,tr,ts,ta){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=tD,this._vbData[this._posInVBData+1]=tY,this._vbData[this._posInVBData+2]=tg,this._vbData[this._posInVBData+3]=tT,this._vbData[this._posInVBData+4]=tr,this._vbData[this._posInVBData+5]=ts,this._vbData[this._posInVBData+6]=ta,this._posInVBData+=this._floatSizePerVer,this},tY.addVertexIndex=function(tD,tY,tg,tT,tr,ts,ta,tW){return this._hasBegun||this.addVertexIndexException(),this._vbData[tW]=tD,this._vbData[tW+1]=tY,this._vbData[tW+2]=tg,this._vbData[tW+3]=tT,this._vbData[tW+4]=tr,this._vbData[tW+5]=ts,this._vbData[tW+6]=ta,(tW+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=tW),this},tY.addIndexes=function(tD){var tY=arguments;this._hasBegun||this.addVertexIndexException();for(var tg=0;tg<tY.length;tg++)this._ibData[this._posInIBData]=tY[tg],this._posInIBData++;return this},tY.begin=function(tD,tY){return this._hasBegun&&this.beginException0(),1!==tD&&4!==tD&&this.beginException1(),this._primitiveType=tD,this._camera=tY,this._hasBegun=!0,this},tY.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},tY.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(tD._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),tA.drawCall++,tz.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},tY.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},tY.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},tY.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},tY.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},tY.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},tY.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(28,[new taD(0,"vector3",0),new taD(12,"vector4",1)])}]),tD}()),tK=function(){function tD(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++tD._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new tdY}tN(tD,"laya.d3.core.render.RenderElement");var tY=tD.prototype;return tY.getDynamicBatchBakedVertexs=function(tD){for(var tY=this._renderObj._getVertexBuffer(tD),tg=tY.getData().slice(),tT=tY.vertexDeclaration,tr=tT.getVertexElementByUsage(0).offset/4,ts=tT.getVertexElementByUsage(3).offset/4,ta=this._sprite3D.transform,tW=ta.worldMatrix,tM=ta.rotation,tE=tT.vertexStride/4,tI=0,tO=tg.length;tI<tO;tI+=tE){var tC=tI+tr,tN=tI+ts;tpY.transformVector3ArrayToVector3ArrayCoordinate(tg,tC,tW,tg,tC),tpY.transformVector3ArrayByQuat(tg,tN,tM,tg,tN)}return tg},tY.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},tY._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},t$(0,tY,"id",function(){return this._id}),t$(0,tY,"renderObj",function(){return this._renderObj},function(tD){this._renderObj!==tD&&(this._renderObj=tD)}),tD._uniqueIDCounter=0,tD}(),to=function(){function tY(tD){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++tY._uniqueIDCounter,this._needSort=!1,this._scene=tD,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}tN(tY,"laya.d3.core.render.RenderQueue");var tD=tY.prototype;return tD._sortOpaqueFunc=function(tD,tY){if(tD._render&&tY._render){var tg=tD._material.renderQueue-tY._material.renderQueue;return 0==tg?tD._material.constructor&&tY._material.constructor&&tD._material.constructor.name&&tY._material.constructor.name&&tD._material.constructor.name==tD._material.constructor.name&&tD._sprite3D&&tY._sprite3D&&tD._sprite3D.name&&tY._sprite3D.name&&tD._sprite3D.name===tY._sprite3D.name?0:tD._render._distanceForSort-tY._render._distanceForSort:tg}return 0},tD._sortAlphaFunc=function(tD,tY){if(tD._render&&tY._render){var tg=tD._material.renderQueue-tY._material.renderQueue;return 0==tg?tD._material.constructor&&tY._material.constructor&&tD._material.constructor.name&&tY._material.constructor.name&&tD._material.constructor.name==tD._material.constructor.name&&tD._sprite3D&&tY._sprite3D&&tD._sprite3D.name&&tY._sprite3D.name&&tD._sprite3D.name===tY._sprite3D.name?0:tY._render._distanceForSort-tD._render._distanceForSort:tg}return 0},tD._begainRenderElement=function(tD,tY,tg){return!!tY._beforeRender(tD)},tD._sortAlpha=function(tD){tY._cameraPosition=tD,this._finalElements.sort(this._sortAlphaFunc)},tD._sortOpaque=function(tD){tY._cameraPosition=tD,this._finalElements.sort(this._sortOpaqueFunc)},tD._preRender=function(tD){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},tD._render=function(tD,tY){for(var tg,tT,tr,ts,ta,tW,tM=tA.loopCount,tE=this._scene,tI=tD.camera,tO=(tI.id,!1),tC=0,tN=this._finalElements.length;tC<tN;tC++){var t$,td,tJ,tx=this._finalElements[tC];if(null!=tx._onPreRenderFunction&&tx._onPreRenderFunction.call(tx._sprite3D,tD),0===tx._type){if(tD.owner=tJ=tx._sprite3D,tD.renderElement=tx,tJ._preRenderUpdateComponents(tD),t$=tx.renderObj,td=tx._material,this._begainRenderElement(tD,t$,td)){if(tg=t$._getVertexBuffers(),!(tr=(tT=t$._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[tT.id]){this._errorRecord[tT.id]=1;var tj="vertexBuffer:"+("("+tT._destroyed+","+tT._released+","+tT._referenceCount+","+tT._buffer+")")+", material:"+(td?td.__className+"("+td._destroyed+","+td._released+")":"null")+", owner:"+(tJ?tJ.__className+"("+tJ._destroyed+","+tJ._activeInHierarchy+","+tJ._displayedInStage+")":"null")+", renderObj:"+(t$?t$.__className+"("+t$._destroyed+","+t$._released+","+t$._referenceCount+")":"")+", parent:, url:"+(tJ?tJ.url:"")+", disposeStack:"+tT.disposeStack;tl.recordError("报错：unknown vertexDeclaration  "+tj)}continue}if(tO=(ts=tD._shader=td._getShader(tE._shaderDefineValue,tr.shaderDefineValue,tJ._shaderDefineValue)).bind()||tM!==ts._uploadLoopCount,tg){if(ts._uploadVertexBuffer!==tg||tO){for(var tZ=0;tZ<tg.length;tZ++){var tp=tg[tZ];ts.uploadAttributesX(tp.vertexDeclaration.shaderValues.data,tp)}ts._uploadVertexBuffer=tg}}else(ts._uploadVertexBuffer!==tT||tO)&&(ts.uploadAttributes(tr.shaderValues.data,null),ts._uploadVertexBuffer=tT);(ts._uploadScene!==tE||tO)&&(ts.uploadSceneUniforms(tE._shaderValues.data),ts._uploadScene=tE),(tI!==ts._uploadCamera||ts._uploadSprite3D!==tJ||tO)&&(ts.uploadSpriteUniforms(tJ._shaderValues.data),ts._uploadSprite3D=tJ),(tI!==ts._uploadCamera||tO)&&(ts.uploadCameraUniforms(tI._shaderValues.data),ts._uploadCamera=tI),(ts._uploadMaterial!==td||tO)&&(td._upload(),ts._uploadMaterial=td),ta!==td?(td._setRenderStateBlendDepth(),td._setRenderStateFrontFace(tY,tJ.transform),ta=td,tW=tJ):tW!==tJ&&(td._setRenderStateFrontFace(tY,tJ.transform),tW=tJ),t$._render(tD),ts._uploadLoopCount=tM}tJ._postRenderUpdateComponents(tD)}else if(2===tx._type){tx.renderObj;tD.owner=tJ=tx._sprite3D,tD.renderElement=tx,tD._batchIndexStart=tx._tempBatchIndexStart,tD._batchIndexEnd=tx._tempBatchIndexEnd,t$=tx.renderObj,td=tx._material,this._begainRenderElement(tD,t$,td)&&(tr=(tT=t$._getVertexBuffer(0)).vertexDeclaration,tO=(ts=tD._shader=td._getShader(tE._shaderDefineValue,tr.shaderDefineValue,tJ._shaderDefineValue)).bind()||tM!==ts._uploadLoopCount,(ts._uploadVertexBuffer!==tT||tO)&&(ts.uploadAttributes(tr.shaderValues.data,null),ts._uploadVertexBuffer=tT),(ts._uploadScene!==tE||tO)&&(ts.uploadSceneUniforms(tE._shaderValues.data),ts._uploadScene=tE),(tI!==ts._uploadCamera||ts._uploadSprite3D!==tJ||tO)&&(ts.uploadSpriteUniforms(tJ._shaderValues.data),ts._uploadSprite3D=tJ),(tI!==ts._uploadCamera||tO)&&(ts.uploadCameraUniforms(tI._shaderValues.data),ts._uploadCamera=tI),(ts._uploadMaterial!==td||tO)&&(td._upload(),ts._uploadMaterial=td),ta!==td?(td._setRenderStateBlendDepth(),td._setRenderStateFrontFace(tY,tJ.transform),ta=td,tW=tJ):tW!==tJ&&(td._setRenderStateFrontFace(tY,tJ.transform),tW=tJ),t$._render(tD),ts._uploadLoopCount=tM)}}},tD._renderShadow=function(tD,tY){for(var tg,tT,tr,ts,ta,tW=tA.loopCount,tM=this._scene,tE=tD.camera,tI=!1,tO=0,tC=this._finalElements.length;tO<tC;tO++){var tN,t$,td,tJ=this._finalElements[tO];0===tJ._type&&(tD.owner=td=tJ._sprite3D,tY||td._projectionViewWorldUpdateCamera===tE&&td._projectionViewWorldUpdateLoopCount===tA.loopCount||(td._render._renderUpdate(tD._projectionViewMatrix),td._projectionViewWorldUpdateLoopCount=tA.loopCount,td._projectionViewWorldUpdateCamera=tE),tD.renderElement=tJ,td._preRenderUpdateComponents(tD),tN=tJ.renderObj,t$=tJ._material,this._begainRenderElement(tD,tN,null)&&(tT=(tg=tN._getVertexBuffer(0)).vertexDeclaration,tI=(tr=tD._shader=t$._getShader(tM._shaderDefineValue,tT.shaderDefineValue,td._shaderDefineValue)).bind()||tW!==tr._uploadLoopCount,(tr._uploadVertexBuffer!==tg||tI)&&(tr.uploadAttributes(tT.shaderValues.data,null),tr._uploadVertexBuffer=tg),(tE!==tr._uploadCamera||tr._uploadSprite3D!==td||tI)&&(tr.uploadSpriteUniforms(td._shaderValues.data),tr._uploadSprite3D=td),(tE!==tr._uploadCamera||tI)&&(tr.uploadCameraUniforms(tE._shaderValues.data),tr._uploadCamera=tE),(tr._uploadMaterial!==t$||tI)&&(t$._upload(),tr._uploadMaterial=t$),tr._uploadRenderElement,ts!==t$?(t$._setRenderStateFrontFace(!1,td.transform),ts=t$,ta=td):ta!==td&&(t$._setRenderStateFrontFace(!1,td.transform),ta=td),tN._render(tD),tr._uploadLoopCount=tW),td._postRenderUpdateComponents(tD))}},tD._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},tD._addRenderElement=function(tD){this._renderElements.push(tD),this._needSort=!0},tD._addDynamicBatchElement=function(tD){this._dynamicBatchCombineRenderElements.push(tD)},t$(0,tD,"id",function(){return this._id}),tY._uniqueIDCounter=0,tY._cameraPosition=null,tY}(),tR=function(){function tD(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return tN(tD,"laya.d3.core.render.RenderState"),tD.clientWidth=0,tD.clientHeight=0,tD}(),tQ=function(){function ta(tD,tY){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new tuD(new tEY,0),this._corners=[new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY],this._boundingBoxCenter=new tEY,this._children=tT(8),this._objects=[],this._tempBoundBoxCorners=[new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY],this._scene=tD,this._currentDepth=tY}tN(ta,"laya.d3.core.scene.OctreeNode");var tD=ta.prototype;return tl.imps(tD,{"laya.d3.core.scene.ITreeNode":!0}),tD.init=function(tD,tY){var tg=new tEY,tT=new tEY;tEY.scale(tY,-.5,tg),tEY.scale(tY,.5,tT),tEY.add(tg,tD,tg),tEY.add(tT,tD,tT),this.exactBox=new tLD(tg,tT),this.relaxBox=new tLD(tg,tT)},tD.addTreeNode=function(tD){1===tnD.boxContainsBox(this._relaxBox,tD.boundingBox)?this.addNodeDown(tD,0):this.addObject(tD)},tD.addChild=function(tD){var tY=this._children[tD];if(null==tY){tY=new ta(this._scene,this._currentDepth+1),(this._children[tD]=tY)._parent=this,tEY.subtract(this._exactBox.max,this._exactBox.min,ta.tempSize),tEY.multiply(ta.tempSize,ta._octreeSplit[tD],ta.tempCenter),tEY.add(this._exactBox.min,ta.tempCenter,ta.tempCenter),tEY.scale(ta.tempSize,.25,ta.tempSize);var tg=new tEY,tT=new tEY;tEY.subtract(ta.tempCenter,ta.tempSize,tg),tEY.add(ta.tempCenter,ta.tempSize,tT),tY.exactBox=new tLD(tg,tT),tEY.scale(ta.tempSize,ta.relax,ta.tempSize);var tr=new tEY,ts=new tEY;tEY.subtract(ta.tempCenter,ta.tempSize,tr),tEY.add(ta.tempCenter,ta.tempSize,ts),tY.relaxBox=new tLD(tr,ts)}return tY},tD.addObject=function(tD){(tD._treeNode=this)._objects.push(tD)},tD.removeObject=function(tD){if(tD._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var tY=this._objects.indexOf(tD);return-1!==tY&&(this._objects.splice(tY,1),!0)},tD.clearObject=function(){this._objects.length=0},tD.addNodeUp=function(tD,tY){this._parent&&1!==tnD.boxContainsBox(this._exactBox,tD.boundingBox)?this._parent.addNodeUp(tD,tY-1):this.addNodeDown(tD,tY)},tD.addNodeDown=function(tD,tY){if(tY<this._scene.treeLevel){var tg=this.inChildIndex(tD.boundingBoxCenter),tT=this.addChild(tg);1===tnD.boxContainsBox(tT._relaxBox,tD.boundingBox)?tT.addNodeDown(tD,++tY):this.addObject(tD)}else this.addObject(tD)},tD.inChildIndex=function(tD){return 4*(tD.z<this._boundingBoxCenter.z?0:1)+2*(tD.y<this._boundingBoxCenter.y?0:1)+(tD.x<this._boundingBoxCenter.x?0:1)},tD.updateObject=function(tD){1===tnD.boxContainsBox(this._relaxBox,tD.boundingBox)?(this.removeObject(tD),tD._treeNode=null,this.addNodeDown(tD,this._currentDepth)):this._parent&&(this.removeObject(tD),tD._treeNode=null,this._parent.addNodeUp(tD,this._currentDepth-1))},tD.cullingObjects=function(tD,tY,tg,tT,tr){var ts,ta=0,tW=0,tM=0,tE=this._scene._dynamicBatchManager;for(ta=0,ts=this._objects.length;ta<ts;ta++){var tI=this._objects[ta];if(ti.isVisible(tI._owner.layer.mask)&&tI.enable){if(tY&&(tA.treeSpriteCollision+=1,0===tD.containsBoundSphere(tI.boundingSphere)))continue;tI._renderUpdate(tr),tI._distanceForSort=tEY.distance(tI.boundingSphere.center,tT)+tI.sortingFudge;var tO=tI._renderElements;for(tW=0,tM=tO.length;tW<tM;tW++){var tC=tO[tW],tN=tC._staticBatch;if(tN&&tN._material===tC._material)tN._addBatchRenderElement(tC);else{var t$=tC.renderObj;t$.triangleCount<10&&1===t$._vertexBufferCount&&t$._getIndexBuffer()&&tC._material.renderQueue<2&&tC._canDynamicBatch&&!tI._owner.isStatic?tE._addPrepareRenderElement(tC):this._scene.getRenderQueue(tC._material.renderQueue)._addRenderElement(tC)}}}}for(ta=0;ta<8;ta++){var td=this._children[ta];if(null!=td){var tJ=tY;if(tY){var tx=tD.containsBoundBox(td._relaxBox);if(tA.treeNodeCollision+=1,0===tx)continue;tJ=2===tx}td.cullingObjects(tD,tJ,tg,tT,tr)}}},tD.cullingShadowObjects=function(tD,tY,tg,tT,tr){var ts,ta=0,tW=0,tM=0;this._scene._dynamicBatchManager;for(ta=0,ts=this._objects.length;ta<ts;ta++){var tE=this._objects[ta];if(tE.castShadow&&ti.isVisible(tE._owner.layer.mask)&&tE.enable){if(tg&&0===tD[0].containsBoundSphere(tE.boundingSphere))continue;for(var tI=1,tO=tD.length;tI<tO;tI++){var tC=tY[tI-1];if(0!==tD[tI].containsBoundSphere(tE.boundingSphere)){var tN=tE._renderElements;for(tW=0,tM=tN.length;tW<tM;tW++)tC._addRenderElement(tN[tW])}}}}for(ta=0;ta<8;ta++){var t$=this._children[ta];if(null!=t$){var td=tg;if(tg){var tJ=tD[0].containsBoundBox(t$._relaxBox);if(0===tJ)continue;td=2===tJ}t$.cullingShadowObjects(tD,tY,td,tT,tr)}}},tD.cullingShadowObjectsOnePSSM=function(tD,tY,tg,tT,tr,ts){var ta,tW=tY[0],tM=0,tE=0,tI=0;for(tM=0,ta=this._objects.length;tM<ta;tM++){var tO=this._objects[tM];if(tO.castShadow&&ti.isVisible(tO._owner.layer.mask)&&tO.enable){if(tT&&0===tD.containsBoundSphere(tO.boundingSphere))continue;tO._renderUpdate(tg);var tC=tO._renderElements;for(tE=0,tI=tC.length;tE<tI;tE++)tW._addRenderElement(tC[tE])}}for(tM=0;tM<8;tM++){var tN=this._children[tM];if(null!=tN){var t$=tT;if(tT){var td=tD.containsBoundBox(tN._relaxBox);if(0===td)continue;t$=2===td}tN.cullingShadowObjectsOnePSSM(tD,tY,tg,t$,tr,ts)}}},tD.renderBoudingBox=function(tD){this._renderBoudingBox(tD);for(var tY=0;tY<8;++tY){var tg=this._children[tY];tg&&tg.renderBoudingBox(tD)}},tD.buildAllChild=function(tD){if(tD<this._scene.treeLevel)for(var tY=0;tY<8;tY++){this.addChild(tY).buildAllChild(tD+1)}},tD._renderBoudingBox=function(tD){},t$(0,tD,"exactBox",function(){return this._exactBox},function(tD){this._exactBox=tD,tEY.add(tD.min,tD.max,this._boundingBoxCenter),tEY.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),t$(0,tD,"relaxBox",function(){return this._relaxBox},function(tD){(this._relaxBox=tD).getCorners(this._corners),tuD.createfromPoints(this._corners,this._boundingSphere)}),ta.debugMode=!1,ta.relax=1.15,ta.CHILDNUM=8,tO(ta,["tempVector0",function(){return this.tempVector0=new tEY},"tempSize",function(){return this.tempSize=new tEY},"tempCenter",function(){return this.tempCenter=new tEY},"_octreeSplit",function(){return this._octreeSplit=[new tEY(.25,.25,.25),new tEY(.75,.25,.25),new tEY(.25,.75,.25),new tEY(.75,.75,.25),new tEY(.25,.25,.75),new tEY(.75,.25,.75),new tEY(.25,.75,.75),new tEY(.75,.75,.75)]}]),ta}(),tL=(function(){function tD(){}tN(tD,"laya.d3.core.scene.SceneManager")}(),function(){function tD(tD,tY,tg,tT){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===tD&&(tD=1),void 0===tY&&(tY=1),void 0===tg&&(tg=1),void 0===tT&&(tT=1),this._r=tD,this._g=tY,this._b=tg,this._a=tT}return tN(tD,"laya.d3.core.trail.module.Color",null,"Color$1"),tD.prototype.cloneTo=function(tD){tD._r=this._r,tD._g=this._g,tD._b=this._b,tD._a=this._a},tO(tD,["RED",function(){return this.RED=new tD(1,0,0,1)},"GREEN",function(){return this.GREEN=new tD(0,1,0,1)},"BLUE",function(){return this.BLUE=new tD(0,0,1,1)},"CYAN",function(){return this.CYAN=new tD(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new tD(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new tD(1,0,1,1)},"GRAY",function(){return this.GRAY=new tD(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new tD(1,1,1,1)},"BLACK",function(){return this.BLACK=new tD(0,0,0,1)}]),tD}()),ty=(function(){function tD(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}tN(tD,"laya.d3.core.trail.module.Gradient");var tY=tD.prototype;tY.setKeys=function(tD,tY){var tg,tT;this._colorKeys=tD;for(var tr=this.index=0;tr<tD.length;tr++){var ts=(tg=tD[tr]).color;this._colorKeyData[this.index++]=ts._r,this._colorKeyData[this.index++]=ts._g,this._colorKeyData[this.index++]=ts._b,this._colorKeyData[this.index++]=tg.time}this._alphaKeys=tY;for(var ta=this.index=0;ta<tY.length;ta++)tT=tY[ta],this._alphaKeyData[this.index++]=tT.alpha,this._alphaKeyData[this.index++]=tT.time},tY.cloneTo=function(tD){var tY=0,tg=0,tT=this.colorKeys,tr=[];for(tY=0,tg=tT.length;tY<tg;tY++){var ts=new tu;tT[tY].cloneTo(ts),tr.push(ts)}var ta=this.alphaKeys,tW=[];for(tY=0,tg=ta.length;tY<tg;tY++){var tM=new ty;ta[tY].cloneTo(tM),tW.push(tM)}tD.setKeys(tr,tW)},t$(0,tY,"mode",function(){return this._mode},function(tD){this._mode=tD}),t$(0,tY,"colorKeys",function(){return this._colorKeys},function(tD){this._colorKeys=tD;for(var tY=this.index=0;tY<tD.length;tY++){var tg=tD[tY],tT=tg.color;this._colorKeyData[this.index++]=tT._r,this._colorKeyData[this.index++]=tT._g,this._colorKeyData[this.index++]=tT._b,this._colorKeyData[this.index++]=tg.time}}),t$(0,tY,"alphaKeys",function(){return this._alphaKeys},function(tD){this._alphaKeys=tD;for(var tY=this.index=0;tY<tD.length;tY++){var tg=tD[tY];this._alphaKeyData[this.index++]=tg.alpha,this._alphaKeyData[this.index++]=tg.time}})}(),function(){function tD(tD,tY){this._alpha=NaN,this._time=NaN,void 0===tD&&(tD=0),void 0===tY&&(tY=0),this._alpha=tD,this._time=tY}tN(tD,"laya.d3.core.trail.module.GradientAlphaKey");var tY=tD.prototype;return tY.cloneTo=function(tD){tD.alpha=this.alpha,tD.time=this.time},t$(0,tY,"alpha",function(){return this._alpha},function(tD){this._alpha=tD}),t$(0,tY,"time",function(){return this._time},function(tD){this._time=tD}),tD}()),tu=function(){function tD(tD,tY){this._color=null,this._time=NaN,void 0===tY&&(tY=0),this._color=tD||new tL,this._time=tY}tN(tD,"laya.d3.core.trail.module.GradientColorKey");var tY=tD.prototype;return tY.cloneTo=function(tD){this.color.cloneTo(tD.color),tD.time=this.time},t$(0,tY,"color",function(){return this._color},function(tD){this._color=tD}),t$(0,tY,"time",function(){return this._time},function(tD){this._time=tD}),tD}(),tn=(function(){function tD(){}tN(tD,"laya.d3.core.trail.module.GradientMode"),tD.Blend=0,tD.Fixed=1}(),function(){function tD(){}tN(tD,"laya.d3.core.trail.module.TextureMode"),tD.Stretch=0,tD.Tile=1}(),function(){function tD(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}tN(tD,"laya.d3.core.trail.module.TrailKeyFrame"),tD.prototype.cloneTo=function(tD){tD.time=this.time,tD.inTangent=this.inTangent,tD.outTangent=this.outTangent,tD.value=this.value}}(),function(){function tY(tD){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new tEY,this._curPosition=new tEY,this._delVector3=new tEY,this._lastFixedVertexPosition=new tEY,this._pointAtoBVector3=new tEY,this._pointA=new tEY,this._pointB=new tEY,this._owner=tD,this._id=tY.renderElementCount++,0==this._id?tD._owner.transform.position.cloneTo(this._lastPosition):tD._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new tkY(tn.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new tkY(tn.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}tN(tY,"laya.d3.core.trail.TrailRenderElement");var tD=tY.prototype;tl.imps(tD,{"laya.d3.core.render.IRenderable":!0}),tD._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},tD._addTrailByFirstPosition=function(tD,tY){tEY.subtract(tY,tD,this._delVector3),tEY.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),tEY.normalize(this._pointAtoBVector3,this._pointAtoBVector3),tEY.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(tD),tD.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},tD._addTrailByNextPosition=function(tD){tEY.subtract(tD,this._lastFixedVertexPosition,this._delVector3),tEY.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),tEY.normalize(this._pointAtoBVector3,this._pointAtoBVector3),tEY.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=tEY.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=tDY.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(tD),tD.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(tD),this._virtualVerticesCount=2)},tD._updateVerticesByPosition=function(tD){this._pointe=tD.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},tD._updateVertexBuffer2=function(){var tD,tY=0,tg=0,tT=0;for(tT=0,tD=(this._verticesCount+this._virtualVerticesCount)/2;tT<tD;tT++)tg=0==this._owner.textureMode?(this._VerticesToTailLength[tT]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[tT],this._vertices2[tY++]=1-tg,this._vertices2[tY++]=1-tg;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},tD._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},tD._updateDisappear=function(){var tD,tY=0;for(tY=this._curDisappearIndex,tD=(this._verticesCount+this._virtualVerticesCount)/2;tY<tD;tY++)this._owner._curtime-this._everyGroupVertexBirthTime[tY]>=this._owner.time+tDY.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},tD._beforeRender=function(tD){return this._camera=tD.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),tEY.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},tD._render=function(tD){this._isDead||(tz.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),tA.drawCall++,tA.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},tD._getVertexBuffer=function(tD){return void 0===tD&&(tD=0),0===tD?this._vertexBuffer1:1===tD?this._vertexBuffer2:null},tD._getVertexBuffers=function(){return this._vertexBuffers},tD._getIndexBuffer=function(){return null},tD.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},tD._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},t$(0,tD,"_vertexBufferCount",function(){return this._vertexBuffers.length}),t$(0,tD,"triangleCount",function(){return 0}),tY.renderElementCount=0}(),function(){function tD(){}tN(tD,"laya.d3.core.trail.VertexTrail");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration1}),t$(1,tD,"vertexDeclaration1",function(){return tD._vertexDeclaration1}),t$(1,tD,"vertexDeclaration2",function(){return tD._vertexDeclaration2}),tO(tD,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new tsD(32,[new taD(0,"vector3",0),new taD(12,"vector3",41),new taD(24,"single",33),new taD(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new tsD(4,[new taD(0,"single",38)])}]),tD}()),tDD=function(){function tp(tD){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=tD}tN(tp,"laya.d3.graphics.DynamicBatch");var tD=tp.prototype;return tl.imps(tD,{"laya.d3.core.render.IRenderable":!0}),tD._getVertexBuffer=function(tD){return void 0===tD&&(tD=0),0===tD?this._vertexBuffer:null},tD._getIndexBuffer=function(){return this._indexBuffer},tD._getCombineRenderElementFromPool=function(tD,tY,tg){var tT=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return tT||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=tT=new tK,tT._sprite3D=new tDg),tT._sprite3D._render._renderUpdate(tg),tT},tD._getRenderElement=function(tD,tY,tg){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*tp.maxVertexCount),this._indexDatas=new Uint16Array(tp.maxIndexCount),this._vertexBuffer=tkY.create(this._vertexDeclaration,tp.maxVertexCount,35048),this._indexBuffer=teY.create("ushort",tp.maxIndexCount,35048));for(var tT=this._merageElements.length=0,tr=0,ts=0,ta=this._combineRenderElements.length;ts<ta;ts++){var tW=this._combineRenderElements[ts],tM=tW.getDynamicBatchBakedVertexs(0),tE=tW.getBakedIndices(),tI=tW._sprite3D.transform._isFrontFaceInvert,tO=tT/(this._vertexDeclaration.vertexStride/4),tC=tr,tN=tC+tE.length;tW._tempBatchIndexStart=tC,tW._tempBatchIndexEnd=tN,this._indexDatas.set(tE,tr);var t$=0;if(tI)for(t$=tC;t$<tN;t$+=3){this._indexDatas[t$]=tO+this._indexDatas[t$];var td=this._indexDatas[t$+1],tJ=this._indexDatas[t$+2];this._indexDatas[t$+1]=tO+tJ,this._indexDatas[t$+2]=tO+td}else for(t$=tC;t$<tN;t$+=3)this._indexDatas[t$]=tO+this._indexDatas[t$],this._indexDatas[t$+1]=tO+this._indexDatas[t$+1],this._indexDatas[t$+2]=tO+this._indexDatas[t$+2];tr+=tE.length,this._vertexDatas.set(tM,tT),tT+=tM.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),ts=this._combineRenderElementPoolIndex=0,ta=this._materials.length;ts<ta;ts++){var tx=this._getCombineRenderElementFromPool(tD,tY,tg);tx._type=2,tx._staticBatch=null;var tj=(tx.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[ts]]._tempBatchIndexStart,tZ=ts+1===this._materialToRenderElementsOffsets.length?tr:this._combineRenderElements[this._materialToRenderElementsOffsets[ts+1]]._tempBatchIndexStart;tx._tempBatchIndexStart=tj,tx._tempBatchIndexEnd=tZ,tx._material=this._materials[ts],this._merageElements.push(tx)}},tD._addCombineRenderObjTest=function(tD){var tY=tD.renderObj,tg=this._currentCombineIndexCount+tY._getIndexBuffer().indexCount,tT=this._currentCombineVertexCount+tY._getVertexBuffer().vertexCount;return!(tp.maxVertexCount<tT||tp.maxIndexCount<tg)},tD._addCombineRenderObj=function(tD){var tY=tD.renderObj;this._combineRenderElements.push(tD),this._currentCombineIndexCount=this._currentCombineIndexCount+tY._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+tY._getVertexBuffer().vertexCount},tD._addCombineMaterial=function(tD){this._materials.push(tD)},tD._addMaterialToRenderElementOffset=function(tD){this._materialToRenderElementsOffsets.push(tD)},tD._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},tD._addToRenderQueue=function(tD,tY,tg,tT){this._getRenderElement(tY,tg,tT);for(var tr=0,ts=this._materials.length;tr<ts;tr++)tD.getRenderQueue(this._materials[tr].renderQueue)._addDynamicBatchElement(this._merageElements[tr])},tD._beforeRender=function(tD){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},tD._render=function(tD){var tY=tD._batchIndexEnd-tD._batchIndexStart;tz.mainContext.drawElements(4,tY,5123,2*tD._batchIndexStart),tA.drawCall++,tA.trianglesFaces+=tY/3},tD._getVertexBuffers=function(){return null},t$(0,tD,"_vertexBufferCount",function(){return 1}),t$(0,tD,"triangleCount",function(){return this._indexBuffer.indexCount/3}),t$(0,tD,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),tp.maxVertexCount=2e4,tp.maxIndexCount=4e4,tp.maxCombineTriangleCount=10,tp}(),tYD=function(){function tp(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}tN(tp,"laya.d3.graphics.DynamicBatchManager");var tD=tp.prototype;return tD.getDynamicBatch=function(tD,tY){var tg,tT=tD.id.toString()+tY;return this._dynamicBatches[tT]?tg=this._dynamicBatches[tT]:this._dynamicBatches[tT]=tg=new tDD(tD),tg},tD._garbageCollection=function(){for(var tD in this._dynamicBatches)0===this._dynamicBatches[tD].combineRenderElementsCount&&delete this._dynamicBatches[tD]},tD._addPrepareRenderElement=function(tD){this._prepareDynamicBatchCombineElements.push(tD)},tD._finishCombineDynamicBatch=function(tD){var tY,tg,tT;this._prepareDynamicBatchCombineElements.sort(tp._sortPrepareDynamicBatch);for(var tr,ts,ta,tW,tM,tE=-1,tI=!0,tO=0,tC=-1,tN=0,t$=this._prepareDynamicBatchCombineElements.length;tN<t$;tN++){var td=(ts=this._prepareDynamicBatchCombineElements[tN]).renderObj._getVertexBuffer(0).vertexDeclaration,tJ=tg!==td;tJ&&(tO=0,tg=td);var tx=tO!==tE;if(tx&&(tE=tO),(tJ||tx)&&(ta=this.getDynamicBatch(td,tO),tY=null),tI)if(ta._addCombineRenderObjTest(ts)){if(tY!==(tr=ts._material))tW&&(tD.getRenderQueue(tM._material.renderQueue)._addRenderElement(tM),tM=tW=null,tC=-1),tW=tr,tC=ta.combineRenderElementsCount,tM=ts,tY=tr;else if(tW){var tj=tM.renderObj,tZ=ts.renderObj;tj._getVertexBuffer().vertexCount+tZ._getVertexBuffer().vertexCount>tDD.maxVertexCount||tj._getIndexBuffer().indexCount+tZ._getIndexBuffer().indexCount>tDD.maxIndexCount?(tD.getRenderQueue(tM._material.renderQueue)._addRenderElement(tM),tW=tr,tC=ta.combineRenderElementsCount,tM=ts):(ta._addCombineMaterial(tW),ta._addMaterialToRenderElementOffset(tC),ta._addCombineRenderObj(tM),tM=tW=null,tC=-1,ta._addCombineRenderObj(ts))}else ta._addCombineRenderObj(ts);tI=!0}else tW&&(tD.getRenderQueue(tM._material.renderQueue)._addRenderElement(tM),tM=tW=null,tC=-1),tO++,tI=!1;else tT=this._prepareDynamicBatchCombineElements[tN-1],ta._addMaterialToRenderElementOffset(ta.combineRenderElementsCount),tY=tT._material,ta._addCombineMaterial(tY),ta._addCombineRenderObj(tT),tI=!0,tY!==(tr=ts._material)?(tW=tr,tC=ta.combineRenderElementsCount,tM=ts):ta._addCombineRenderObj(ts),tY=tr}tW&&(tD.getRenderQueue(tM._material.renderQueue)._addRenderElement(tM),tM=tW=null,tC=-1),this._prepareDynamicBatchCombineElements.length=0},tD._clearRenderElements=function(){for(var tD in this._dynamicBatches)this._dynamicBatches[tD]._clearRenderElements()},tD._addToRenderQueue=function(tD,tY,tg,tT){for(var tr in this._dynamicBatches){var ts=this._dynamicBatches[tr];0<ts.combineRenderElementsCount&&ts._addToRenderQueue(tD,tY,tg,tT)}},tD.dispose=function(){this._dynamicBatches=null},tp._sortPrepareDynamicBatch=function(tD,tY){return tD._mainSortID-tY._mainSortID},tp}(),tgD=function(){function tD(){}return tN(tD,"laya.d3.graphics.FrustumCulling"),tD.renderShadowObjectCulling=function(tD,tY,tg,tT,tr){var ts=0,ta=0,tW=0,tM=0;for(ts=0,tW=tg.length;ts<tW;ts++){var tE=tg[ts];tE&&tE._clearRenderElements()}var tI,tO,tC,tN=tD._cullingRenders;if(1<tr){for(ts=0,tW=tD._cullingRendersLength;ts<tW;ts++)if((tI=tN[ts]).castShadow&&ti.isVisible(tI._owner.layer.mask)&&tI.enable)for(var t$=1,td=tY.length;t$<td;t$++)if(tO=tg[t$-1],0!==tY[t$].containsBoundSphere(tI.boundingSphere))for(ta=0,tM=(tC=tI._renderElements).length;ta<tM;ta++)tO._addRenderElement(tC[ta])}else for(ts=0,tW=tD._cullingRendersLength;ts<tW;ts++)if((tI=tN[ts]).castShadow&&ti.isVisible(tI._owner.layer.mask)&&tI.enable&&0!==tY[0].containsBoundSphere(tI.boundingSphere))for(tI._renderUpdate(tT),tO=tg[0],ta=0,tM=(tC=tI._renderElements).length;ta<tM;ta++)tO._addRenderElement(tC[ta])},tD.renderShadowObjectCullingOctree=function(tD,tY,tg,tT,tr){for(var ts=0,ta=tg.length;ts<ta;ts++){var tW=tg[ts];tW&&tW._clearRenderElements()}1<tr?tD.treeRoot.cullingShadowObjects(tY,tg,!0,0,tD):tD.treeRoot.cullingShadowObjectsOnePSSM(tY[0],tg,tT,!0,0,tD)},tD.renderObjectCulling=function(tD,tY,tg,tT,tr,ts){var ta=0,tW=0,tM=0,tE=0,tI=tY._quenes,tO=tY._dynamicBatchManager,tC=tY._cullingRenders;for(ta=0,tW=tI.length;ta<tW;ta++){var tN=tI[ta];tN&&tN._clearRenderElements()}var t$=tTD._staticBatchManagers;for(ta=0,tW=t$.length;ta<tW;ta++)t$[ta]._clearRenderElements();tO._clearRenderElements();var td=tg.transform.position;for(ta=0,tW=tY._cullingRendersLength;ta<tW;ta++){var tJ=tC[ta];if(ti.isVisible(tJ._owner.layer.mask)&&tJ.enable&&0!==tD.containsBoundSphere(tJ.boundingSphere)&&tJ._renderUpdate(ts)){tJ._distanceForSort=tEY.distance(tJ.boundingSphere.center,td)+tJ.sortingFudge;var tx=tJ._renderElements;for(tM=0,tE=tx.length;tM<tE;tM++){var tj=tx[tM],tZ=tj._staticBatch;if(tZ&&tZ._material===tj._material)tZ._addBatchRenderElement(tj);else{var tp=tj.renderObj;tp.triangleCount<10&&1===tp._vertexBufferCount&&tp._getIndexBuffer()&&tj._material.renderQueue<2&&tj._canDynamicBatch&&!tJ._owner.isStatic?tO._addPrepareRenderElement(tj):tY.getRenderQueue(tj._material.renderQueue)._addRenderElement(tj)}}}}for(ta=0,tW=t$.length;ta<tW;ta++)t$[ta]._addToRenderQueue(tY,tT,tr,ts);tO._finishCombineDynamicBatch(tY),tO._addToRenderQueue(tY,tT,tr,ts)},tD.renderObjectCullingOctree=function(tD,tY,tg,tT,tr,ts){var ta=0,tW=0,tM=tY._quenes,tE=tY._dynamicBatchManager;for(ta=0,tW=tM.length;ta<tW;ta++){var tI=tM[ta];tI&&tI._clearRenderElements()}var tO=tTD._staticBatchManagers;for(ta=0,tW=tO.length;ta<tW;ta++)tO[ta]._clearRenderElements();for(tE._clearRenderElements(),tY._cullingRenders.length=0,tY.treeRoot.cullingObjects(tD,!0,0,tg.transform.position,ts),ta=0,tW=tO.length;ta<tW;ta++)tO[ta]._addToRenderQueue(tY,tT,tr,ts);tE._finishCombineDynamicBatch(tY),tE._addToRenderQueue(tY,tT,tr,ts)},tD.renderObjectCullingNoBoundFrustum=function(tD,tY,tg,tT,tr){var ts=0,ta=0,tW=0,tM=0,tE=tD._quenes,tI=tD._dynamicBatchManager,tO=tD._cullingRenders;for(ts=0,ta=tE.length;ts<ta;ts++){var tC=tE[ts];tC&&tC._clearRenderElements()}var tN=tTD._staticBatchManagers;for(ts=0,ta=tN.length;ts<ta;ts++)tN[ts]._clearRenderElements();tI._clearRenderElements();var t$=tY.transform.position;for(ts=0,ta=tD._cullingRendersLength;ts<ta;ts++){var td=tO[ts];if(ti.isVisible(td._owner.layer.mask)&&td.enable){td._renderUpdate(tr),td._distanceForSort=tEY.distance(td.boundingSphere.center,t$)+td.sortingFudge;var tJ=td._renderElements;for(tW=0,tM=tJ.length;tW<tM;tW++){var tx=tJ[tW],tj=tx._staticBatch;if(tj&&tj._material===tx._material)tj._addBatchRenderElement(tx);else{var tZ=tx.renderObj;tZ.triangleCount<10&&1===tZ._vertexBufferCount&&tZ._getIndexBuffer()&&tx._material.renderQueue<2&&tx._canDynamicBatch&&!td._owner.isStatic?tI._addPrepareRenderElement(tx):tD.getRenderQueue(tx._material.renderQueue)._addRenderElement(tx)}}}}for(ts=0,ta=tN.length;ts<ta;ts++)tN[ts]._addToRenderQueue(tD,tg,tT,tr);tI._finishCombineDynamicBatch(tD),tI._addToRenderQueue(tD,tg,tT,tr)},tD}(),tTD=function(){function ts(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}tN(ts,"laya.d3.graphics.StaticBatchManager");var tD=ts.prototype;return tD._finishInit=function(){for(var tD in this._staticBatches)this._staticBatches[tD]._finishInit();this._initBatchRenderElements.length=0},tD._initStaticBatchs=function(tD){throw new Error("StaticBatchManager:must override this function.")},tD._addInitBatchSprite=function(tD){for(var tY=tD._render._renderElements,tg=0,tT=tY.length;tg<tT;tg++)this._initBatchRenderElements.push(tY[tg])},tD._clearRenderElements=function(){for(var tD in this._staticBatches)this._staticBatches[tD]._clearRenderElements()},tD._garbageCollection=function(tD){var tY=tD._staticBatch,tg=tY._initBatchRenderElements,tT=tg.indexOf(tD);tg.splice(tT,1),0===tg.length&&(tY.dispose(),delete this._staticBatches[tY._key])},tD._addToRenderQueue=function(tD,tY,tg,tT){for(var tr in this._staticBatches){var ts=this._staticBatches[tr];0<ts._batchRenderElements.length&&ts._updateToRenderQueue(tD,tT)}},tD.dispose=function(){this._staticBatches=null},ts._addToStaticBatchQueue=function(tD){tD instanceof laya.d3.core.RenderableSprite3D&&tD._addToInitStaticBatchManager();for(var tY=0,tg=tD.numChildren;tY<tg;tY++)ts._addToStaticBatchQueue(tD._childs[tY])},ts.combine=function(tD,tY){var tg,tT=0,tr=0;if(tY)for(tT=0,tr=tY.length;tT<tr;tT++){tY[tT]._addToInitStaticBatchManager()}else tD&&ts._addToStaticBatchQueue(tD);for(tT=0,tr=ts._staticBatchManagers.length;tT<tr;tT++)(tg=ts._staticBatchManagers[tT])._initStaticBatchs(tD),tg._finishInit()},ts._staticBatchManagers=[],ts}(),trD=function(){function tD(tD,tY,tg){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=tD,this._manager=tY,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=tg}tN(tD,"laya.d3.graphics.StaticBatch");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),tY._binarySearch=function(tD){for(var tY=0,tg=this._batchRenderElements.length-1,tT=0;tY<=tg;)tT=Math.floor((tY+tg)/2),this._compareBatchRenderElement(this._batchRenderElements[tT],tD)?tg=tT-1:tY=tT+1;return tY},tY._compareBatchRenderElement=function(tD,tY){throw new Error("StaticBatch:must override this function.")},tY._getVertexDecLightMap=function(tD){return tD===tSD.vertexDeclaration?tiD.vertexDeclaration:tD===tvD.vertexDeclaration?thD.vertexDeclaration:tD===tqD.vertexDeclaration?tpD.vertexDeclaration:tD===tcD.vertexDeclaration?null:tD===tdD.vertexDeclaration?tJD.vertexDeclaration:tD===tFD.vertexDeclaration?tBD.vertexDeclaration:tD===tzD.vertexDeclaration?tmD.vertexDeclaration:tD===tUD.vertexDeclaration?tPD.vertexDeclaration:tD===tvD.vertexDeclaration?thD.vertexDeclaration:tD===tbD.vertexDeclaration?tlD.vertexDeclaration:tD===tcD.vertexDeclaration?null:tD===tdD.vertexDeclaration?tJD.vertexDeclaration:tD===tVD.vertexDeclaration?tHD.vertexDeclaration:tD===tzD.vertexDeclaration?tmD.vertexDeclaration:tD},tY._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},tY._addBatchRenderElement=function(tD){this._batchRenderElements.splice(this._binarySearch(tD),0,tD)},tY._updateToRenderQueue=function(tD,tY){this._combineRenderElementPoolIndex=0,this._getRenderElement(tD.getRenderQueue(this._material.renderQueue)._renderElements,tD,tY)},tY._getRenderElement=function(tD,tY,tg){throw new Error("StaticBatch:must override this function.")},tY._finishInit=function(){throw new Error("StaticBatch:must override this function.")},tY._clearRenderElements=function(){this._batchRenderElements.length=0},tY.dispose=function(){},tY._getVertexBuffer=function(tD){return void 0===tD&&(tD=0),null},tY._getIndexBuffer=function(){return null},tY._beforeRender=function(tD){return!0},tY._render=function(tD){},tY._getVertexBuffers=function(){return null},t$(0,tY,"_vertexBufferCount",function(){return 1}),t$(0,tY,"triangleCount",function(){return 0}),tD.combine=function(tD){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),tTD.combine(tD)},tD.maxBatchVertexCount=65535,tD}(),tsD=function(){function ta(tD,tY){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++ta._uniqueIDCounter,this._id>ta.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",ta.maxVertexDeclaration);this._shaderValues=new tdY,this._vertexElementsDic={},this._vertexStride=tD,this._vertexElements=tY;for(var tg=0;tg<tY.length;tg++){var tT=tY[tg],tr=tT.elementUsage;this._vertexElementsDic[tr]=tT;var ts=[ta._getTypeSize(tT.elementFormat)/4,5126,!1,this._vertexStride,tT.offset];switch(this._shaderValues.setValue(tr,ts),tr){case 1:this._addShaderDefine(tXY.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(tXY.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(tXY.SHADERDEFINE_UV1)}}}tN(ta,"laya.d3.graphics.VertexDeclaration");var tD=ta.prototype;return tD._addShaderDefine=function(tD){this._shaderDefineValue|=tD},tD._removeShaderDefine=function(tD){this._shaderDefineValue&=~tD},tD.getVertexElements=function(){return this._vertexElements.slice()},tD.getVertexElementByUsage=function(tD){return this._vertexElementsDic[tD]},tD.unBinding=function(){},t$(0,tD,"shaderDefineValue",function(){return this._shaderDefineValue}),t$(0,tD,"id",function(){return this._id}),t$(0,tD,"vertexStride",function(){return this._vertexStride}),t$(0,tD,"shaderValues",function(){return this._shaderValues}),ta._getTypeSize=function(tD){switch(tD){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},ta.getVertexStride=function(tD){for(var tY=0,tg=0;tg<tD.Length;tg++){var tT=tD[tg],tr=tT.offset+ta._getTypeSize(tT.elementFormat);tY<tr&&(tY=tr)}return tY},ta._maxVertexDeclarationBit=1e3,ta._uniqueIDCounter=1,tO(ta,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),ta}(),taD=function(){function tD(tD,tY,tg){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=tD,this.elementFormat=tY,this.elementUsage=tg}return tN(tD,"laya.d3.graphics.VertexElement"),tD}(),tWD=(function(){function tD(){}tN(tD,"laya.d3.graphics.VertexElementFormat"),tD.Single="single",tD.Vector2="vector2",tD.Vector3="vector3",tD.Vector4="vector4",tD.Color="color",tD.Byte4="byte4",tD.Short2="short2",tD.Short4="short4",tD.NormalizedShort2="normalizedshort2",tD.NormalizedShort4="normalizedshort4",tD.HalfVector2="halfvector2",tD.HalfVector4="halfvector4"}(),function(){function tD(){}tN(tD,"laya.d3.graphics.VertexElementUsage"),tD.POSITION0=0,tD.COLOR0=1,tD.TEXTURECOORDINATE0=2,tD.NORMAL0=3,tD.BINORMAL0=4,tD.TANGENT0=5,tD.BLENDINDICES0=6,tD.BLENDWEIGHT0=7,tD.DEPTH0=8,tD.FOG0=9,tD.POINTSIZE0=10,tD.SAMPLE0=11,tD.TESSELLATEFACTOR0=12,tD.COLOR1=13,tD.NEXTTEXTURECOORDINATE0=14,tD.TEXTURECOORDINATE1=15,tD.NEXTTEXTURECOORDINATE1=16,tD.CORNERTEXTURECOORDINATE0=17,tD.VELOCITY0=18,tD.STARTCOLOR0=19,tD.STARTSIZE=20,tD.AGEADDSCALE0=21,tD.STARTROTATION=22,tD.ENDCOLOR0=23,tD.STARTLIFETIME=24,tD.TIME0=33,tD.SHAPEPOSITIONSTARTLIFETIME=30,tD.DIRECTIONTIME=32,tD.SIZEROTATION0=27,tD.RADIUS0=28,tD.RADIAN0=29,tD.STARTSPEED=31,tD.RANDOM0=34,tD.RANDOM1=35,tD.SIMULATIONWORLDPOSTION=36,tD.SIMULATIONWORLDROTATION=37,tD.TEXTURECOORDINATE0X=38,tD.TEXTURECOORDINATE0X1=39,tD.TEXTURECOORDINATE0Y=40,tD.OFFSETVECTOR=41}(),function(){function tD(tD,tY,tg){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=tD,this._textureCoordinate0=tY,this._time=tg}tN(tD,"laya.d3.graphics.VertexGlitter");var tY=tD.prototype;tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate0}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"time",function(){return this._time}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(24,[new taD(0,"vector3",0),new taD(12,"vector2",2),new taD(20,"single",33)])}])}(),function(){function tD(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=tD,this._position=tY,this._velocity=tg,this._startColor=tT,this._endColor=tr,this._sizeRotation=ts,this._radius=ta,this._radian=tW,this._ageAddScale=tM,this._time=tE}tN(tD,"laya.d3.graphics.VertexParticle");var tY=tD.prototype;tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"endColor",function(){return this._endColor}),t$(0,tY,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),t$(0,tY,"sizeRotation",function(){return this._sizeRotation}),t$(0,tY,"velocity",function(){return this._velocity}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"startColor",function(){return this._startColor}),t$(0,tY,"radius",function(){return this._radius}),t$(0,tY,"radian",function(){return this._radian}),t$(0,tY,"ageAddScale",function(){return this._ageAddScale}),t$(0,tY,"time",function(){return this._time}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(116,[new taD(0,"vector4",17),new taD(16,"vector3",0),new taD(28,"vector3",18),new taD(40,"vector4",19),new taD(56,"vector4",23),new taD(72,"vector3",27),new taD(84,"vector2",28),new taD(92,"vector4",29),new taD(108,"single",24),new taD(112,"single",33)])}])}(),function(){function tD(tD){this._position=null,this._position=tD}tN(tD,"laya.d3.graphics.VertexPosition");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(12,[new taD(0,"vector3",0)])}]),tD}()),tMD=function(){function tD(tD,tY){this._position=null,this._normal=null,this._position=tD,this._normal=tY}tN(tD,"laya.d3.graphics.VertexPositionNormal");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(24,[new taD(0,"vector3",0),new taD(12,"vector3",3)])}]),tD}(),tED=function(){function tD(tD,tY,tg){this._position=null,this._normal=null,this._color=null,this._position=tD,this._normal=tY,this._color=tg}tN(tD,"laya.d3.graphics.VertexPositionNormalColor");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(40,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1)])}]),tD}(),tID=function(){function tD(tD,tY,tg,tT,tr){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=tD,this._normal=tY,this._color=tg,this._blendIndex=tT,this._blendWeight=tr}tN(tD,"laya.d3.graphics.VertexPositionNormalColorSkin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(72,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector4",7),new taD(56,"vector4",6)])}]),tD}(),tOD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._tangent=tT,this._blendIndex=tr,this._blendWeight=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(88,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector4",7),new taD(56,"vector4",6),new taD(72,"vector4",5)])}]),tD}(),tCD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._tangent=tT,this._blendIndex=tr,this._blendWeight=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(84,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector4",7),new taD(56,"vector4",6),new taD(72,"vector3",5)])}]),tD}(),tND=function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._tangent=tT}tN(tD,"laya.d3.graphics.VertexPositionNormalColorSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(56,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector4",5)])}]),tD}(),t$D=function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._tangent=tT}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(52,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector3",5)])}]),tD}(),tdD=function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate=tT}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(48,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2)])}]),tD}(),tJD=function(){function tD(tD,tY,tg,tT,tr){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate0=tT,this._textureCoordinate1=tr}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(56,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector2",15)])}]),tD}(),txD=function(){function tD(tD,tY,tg,tT,tr,ts,ta){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate0=tT,this._textureCoordinate1=tr,this._blendIndex=ts,this._blendWeight=ta}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(88,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector2",15),new taD(56,"vector4",7),new taD(72,"vector4",6)])}]),tD}(),tjD=function(){function tD(tD,tY,tg,tT,tr,ts,ta,tW){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate0=tT,this._textureCoordinate1=tr,this._tangent=ts,this._blendIndex=ta,this._blendWeight=tW}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(104,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector2",15),new taD(56,"vector4",7),new taD(72,"vector4",6),new taD(88,"vector4",5)])}]),tD}(),tZD=function(){function tD(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),tY.VertexPositionNormalColorTexture0SkinTangent=function(tD,tY,tg,tT,tr,ts,ta,tW){this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate0=tT,this._textureCoordinate1=tr,this._tangent=ts,this._blendIndex=ta,this._blendWeight=tW},t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(100,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector2",15),new taD(56,"vector4",7),new taD(72,"vector4",6),new taD(88,"vector3",5)])}]),tD}(),tpD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate0=tT,this._textureCoordinate1=tr,this._tangent=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(72,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector2",15),new taD(56,"vector4",5)])}]),tD}(),tlD=function(){function tD(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),tY.VertexPositionNormalColorTexture0Tangent=function(tD,tY,tg,tT,tr,ts){this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate0=tT,this._textureCoordinate1=tr,this._tangent=ts},t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(68,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector2",15),new taD(56,"vector3",5)])}]),tD}(),ttD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate=tT,this._blendIndex=tr,this._blendWeight=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(80,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector4",7),new taD(64,"vector4",6)])}]),tD}(),t_D=function(){function tD(tD,tY,tg,tT,tr,ts,ta){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate=tT,this._tangent=tr,this._blendIndex=ts,this._blendWeight=ta}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(96,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector4",7),new taD(64,"vector4",6),new taD(80,"vector4",5)])}]),tD}(),tAD=function(){function tD(tD,tY,tg,tT,tr,ts,ta){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate=tT,this._tangent=tr,this._blendIndex=ts,this._blendWeight=ta}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(92,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector4",7),new taD(64,"vector4",6),new taD(80,"vector3",5)])}]),tD}(),tqD=function(){function tD(tD,tY,tg,tT,tr){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate=tT,this._tangent=tr}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(64,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector4",5)])}]),tD}(),tbD=function(){function tD(tD,tY,tg,tT,tr){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=tD,this._normal=tY,this._color=tg,this._textureCoordinate=tT,this._tangent=tr}tN(tD,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"color",function(){return this._color}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(60,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",1),new taD(40,"vector2",2),new taD(48,"vector3",5)])}]),tD}(),tGD=function(){function tD(tD,tY,tg){this._position=null,this._normal=null,this._tangent=null,this._position=tD,this._normal=tY,this._tangent=tg}tN(tD,"laya.d3.graphics.VertexPositionNormalSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(40,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector4",5)])}]),tD}(),tXD=function(){function tD(tD,tY,tg){this._position=null,this._normal=null,this._tangent=null,this._position=tD,this._normal=tY,this._tangent=tg}tN(tD,"laya.d3.graphics.VertexPositionNormalTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(36,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector3",5)])}]),tD}(),tzD=function(){function tD(tD,tY,tg){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(32,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2)])}]),tD}(),tmD=function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=tD,this._normal=tY,this._textureCoordinate0=tg,this._textureCoordinate1=tT}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(40,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15)])}]),tD}(),thD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=tD,this._normal=tY,this._textureCoordinate0=tg,this._textureCoordinate1=tT,this._blendIndex=tr,this._blendWeight=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(72,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15),new taD(40,"vector4",7),new taD(56,"vector4",6)])}]),tD}(),tiD=function(){function tD(tD,tY,tg,tT,tr,ts,ta){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._textureCoordinate0=tg,this._textureCoordinate1=tT,this._tangent=tr,this._blendIndex=ts,this._blendWeight=ta}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(88,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15),new taD(40,"vector4",7),new taD(56,"vector4",6),new taD(72,"vector4",5)])}]),tD}(),tPD=function(){function tD(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),tY.VertexPositionNormalTexture0SkinTangent=function(tD,tY,tg,tT,tr,ts,ta){this._position=tD,this._normal=tY,this._textureCoordinate0=tg,this._textureCoordinate1=tT,this._tangent=tr,this._blendIndex=ts,this._blendWeight=ta},t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(84,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15),new taD(40,"vector4",7),new taD(56,"vector4",6),new taD(72,"vector3",5)])}]),tD}(),tBD=function(){function tD(tD,tY,tg,tT,tr){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=tD,this._normal=tY,this._textureCoordinate0=tg,this._textureCoordinate1=tT,this._tangent=tr}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(56,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15),new taD(40,"vector4",5)])}]),tD}(),tHD=function(){function tD(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}tN(tD,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),tY.VertexPositionNormalTexture0Tangent=function(tD,tY,tg,tT,tr){this._position=tD,this._normal=tY,this._textureCoordinate0=tg,this._textureCoordinate1=tT,this._tangent=tr},t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(52,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15),new taD(40,"vector3",5)])}]),tD}(),tvD=function(){function tD(tD,tY,tg,tT,tr){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg,this._blendIndex=tT,this._blendWeight=tr}tN(tD,"laya.d3.graphics.VertexPositionNormalTextureSkin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(64,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector4",7),new taD(48,"vector4",6)])}]),tD}(),tSD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg,this._tangent=tT,this._blendIndex=tr,this._blendWeight=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(80,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector4",7),new taD(48,"vector4",6),new taD(64,"vector4",5)])}]),tD}(),tUD=function(){function tD(tD,tY,tg,tT,tr,ts){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg,this._tangent=tT,this._blendIndex=tr,this._blendWeight=ts}tN(tD,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(76,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector4",7),new taD(48,"vector4",6),new taD(64,"vector3",5)])}]),tD}(),tFD=function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg,this._tangent=tT}tN(tD,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(48,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector4",5)])}]),tD}(),tVD=function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg,this._tangent=tT}tN(tD,"laya.d3.graphics.VertexPositionNormalTextureTangent");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(44,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector3",5)])}]),tD}(),tcD=function(){function tD(tD,tY,tg){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg}tN(tD,"laya.d3.graphics.VertexPositionNTBTexture");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(56,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector3",5),new taD(36,"vector3",4),new taD(48,"vector2",2)])}]),tD}(),tfD=function(){function tD(tD,tY,tg,tT,tr,ts,ta,tW){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=tD,this._normal=tY,this._textureCoordinate0=tT,this._textureCoordinate1=tr,this._tangent=ts,tg=tg,this._blendIndex=ta,this._blendWeight=tW}tN(tD,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"tangent",function(){return this._tangent}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(0,tY,"textureCoordinate1",function(){return this._textureCoordinate1}),t$(0,tY,"blendIndex",function(){return this._blendIndex}),t$(0,tY,"blendWeight",function(){return this._blendWeight}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(96,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector3",5),new taD(36,"vector3",4),new taD(48,"vector2",2),new taD(56,"vector2",15),new taD(64,"vector4",7),new taD(80,"vector4",6)])}]),tD}(),teD=function(){function tD(tD,tY,tg){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=tD,this._normal=tY,this._textureCoordinate=tg}tN(tD,"laya.d3.graphics.VertexPositionNTBTextureSkin");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"textureCoordinate",function(){return this._textureCoordinate}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(88,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector3",5),new taD(36,"vector3",4),new taD(48,"vector2",2),new taD(56,"vector4",7),new taD(72,"vector4",6)])}]),tD}(),tkD=(function(){function tD(tD,tY,tg,tT){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=tD,this._normal=tY,this._textureCoord0=tg,this._textureCoord1=tT}tN(tD,"laya.d3.graphics.VertexPositionTerrain");var tY=tD.prototype;tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"normal",function(){return this._normal}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoord0",function(){return this._textureCoord0}),t$(0,tY,"textureCoord1",function(){return this._textureCoord1}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(40,[new taD(0,"vector3",0),new taD(12,"vector3",3),new taD(24,"vector2",2),new taD(32,"vector2",15)])}])}(),function(){function tD(tD,tY){this._position=null,this._textureCoordinate0=null,this._position=tD,this._textureCoordinate0=tY}tN(tD,"laya.d3.graphics.VertexPositionTexture0");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"position",function(){return this._position}),t$(0,tY,"textureCoordinate0",function(){return this._textureCoordinate0}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(20,[new taD(0,"vector3",0),new taD(12,"vector2",2)])}]),tD}()),twD=(function(){function tD(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO,tC,tN){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=tD,this._positionStartLifeTime=tY,this._velocity=tg,this._startColor=tT,this._startSize=tr,this._startRotation0=ts,this._startRotation1=ta,this._startRotation2=tW,this._startLifeTime=tM,this._time=tE,this._startSpeed=tI,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=tN}tN(tD,"laya.d3.graphics.VertexShurikenParticleBillboard");var tY=tD.prototype;tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),t$(0,tY,"random1",function(){return this._randoms1}),t$(0,tY,"startRotation2",function(){return this._startRotation2}),t$(0,tY,"positionStartLifeTime",function(){return this._positionStartLifeTime}),t$(0,tY,"velocity",function(){return this._velocity}),t$(0,tY,"random0",function(){return this._randoms0}),t$(0,tY,"startSize",function(){return this._startSize}),t$(0,tY,"startColor",function(){return this._startColor}),t$(0,tY,"startRotation0",function(){return this._startRotation0}),t$(0,tY,"startRotation1",function(){return this._startRotation1}),t$(0,tY,"startLifeTime",function(){return this._startLifeTime}),t$(0,tY,"time",function(){return this._time}),t$(0,tY,"startSpeed",function(){return this._startSpeed}),t$(0,tY,"simulationWorldPostion",function(){return this._simulationWorldPostion}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(152,[new taD(0,"vector4",17),new taD(16,"vector4",30),new taD(32,"vector4",32),new taD(48,"vector4",19),new taD(64,"vector3",20),new taD(76,"vector3",22),new taD(88,"single",31),new taD(92,"vector4",34),new taD(108,"vector4",35),new taD(124,"vector3",36),new taD(136,"vector4",37)])}])}(),function(){function tD(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO,tC,tN){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=tD,this._positionStartLifeTime=tY,this._velocity=tg,this._startColor=tT,this._startSize=tr,this._startRotation0=ts,this._startRotation1=ta,this._startRotation2=tW,this._startLifeTime=tM,this._time=tE,this._startSpeed=tI,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=tN}tN(tD,"laya.d3.graphics.VertexShurikenParticleMesh");var tY=tD.prototype;tl.imps(tY,{"laya.d3.graphics.IVertex":!0}),t$(0,tY,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),t$(0,tY,"velocity",function(){return this._velocity}),t$(0,tY,"position",function(){return this._positionStartLifeTime}),t$(0,tY,"random0",function(){return this._randoms0}),t$(0,tY,"startSize",function(){return this._startSize}),t$(0,tY,"startColor",function(){return this._startColor}),t$(0,tY,"startRotation0",function(){return this._startRotation0}),t$(0,tY,"startRotation1",function(){return this._startRotation1}),t$(0,tY,"random1",function(){return this._randoms1}),t$(0,tY,"startRotation2",function(){return this._startRotation2}),t$(0,tY,"startLifeTime",function(){return this._startLifeTime}),t$(0,tY,"time",function(){return this._time}),t$(0,tY,"startSpeed",function(){return this._startSpeed}),t$(0,tY,"simulationWorldPostion",function(){return this._simulationWorldPostion}),t$(0,tY,"vertexDeclaration",function(){return tD._vertexDeclaration}),t$(1,tD,"vertexDeclaration",function(){return tD._vertexDeclaration}),tO(tD,["_vertexDeclaration",function(){return this._vertexDeclaration=new tsD(172,[new taD(0,"vector3",0),new taD(12,"vector4",1),new taD(28,"vector2",2),new taD(36,"vector4",30),new taD(52,"vector4",32),new taD(68,"vector4",19),new taD(84,"vector3",20),new taD(96,"vector3",22),new taD(108,"single",31),new taD(112,"vector4",34),new taD(128,"vector4",35),new taD(144,"vector3",36),new taD(156,"vector4",37)])}])}(),function(){function tZ(tD,tY,tg,tT,tr,ts){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=tg,this._materials=tT,this._subMeshes=tr,this._materialMap=ts,this._version=tY,this._onLoaded(tD)}tN(tZ,"laya.d3.loaders.LoadModelV01");var tD=tZ.prototype;return tD._onLoaded=function(tD){this._readData=tD,this.READ_BLOCK();for(var tY=0;tY<this._BLOCK.count;tY++){var tg=this._readData.getUint16(),tT=this._strings[tg],tr=this["READ_"+tT];if(null==tr)throw new Error("model file err,no this function:"+tg+" "+tT);if(!tr.call(this))break}return this._mesh},tD.onError=function(){},tD._readString=function(){return this._strings[this._readData.getUint16()]},tD.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},tD.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},tD.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var tD=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var tY=0;tY<this._STRINGS.size;tY++)this._strings[tY]=this._readData.readUTFString();return this._readData.pos=tD,!0},tD.READ_MATERIAL=function(){var tD=this._readData.getUint16(),tY=(this._readString(),this._readString());return this._materials[tD]="null"!==tY?tx.getRes(this._materialMap[tY]):new tiY,!0},tD.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var tD,tY=this._readData.__getBuffer(),tg=0,tT=this._readData.getUint32(),tr=this._readData.getUint32(),ts=(new Float32Array(tY.slice(tT+this._DATA.offset,tT+this._DATA.offset+tr)),this._readData.getUint32()),ta=this._readData.getUint32(),tW=new Float32Array(tY.slice(ts+this._DATA.offset,ts+this._DATA.offset+ta));for(this.mesh._inverseBindPoses=[],tg=0,tD=tW.length;tg<tD;tg+=16){var tM=new tgY(tW[tg+0],tW[tg+1],tW[tg+2],tW[tg+3],tW[tg+4],tW[tg+5],tW[tg+6],tW[tg+7],tW[tg+8],tW[tg+9],tW[tg+10],tW[tg+11],tW[tg+12],tW[tg+13],tW[tg+14],tW[tg+15]);this.mesh._inverseBindPoses.push(tM)}break;default:throw new Error("LoadModel:unknown version.")}return!0},tD.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var tD=this._readString();this._shaderAttributes=tD.match(tZ._attrReg);var tY=this._readData.getUint32(),tg=this._readData.getUint32(),tT=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),tr=this._readData.getUint32(),ts=this._readData.getUint32(),ta=this._readData.getUint32(),tW=this._readData.__getBuffer(),tM=new tCY(this._mesh),tE=this._getVertexDeclaration(),tI=tkY.create(tE,tr/tE.vertexStride,35044,!0),tO=tT+this._DATA.offset,tC=tW.slice(tO,tO+tr);tI.setData(new Float32Array(tC));for(var tN=(tM._vertexBuffer=tI).vertexDeclaration.getVertexElements(),t$=0;t$<tN.length;t$++)tM._bufferUsage[tN[t$].elementUsage]=tI;var td=teY.create("ushort",tg/2,35044,!0),tJ=tY+this._DATA.offset,tx=tW.slice(tJ,tJ+tg);td.setData(new Uint16Array(tx)),tM._indexBuffer=td;var tj=tW.slice(ts+this._DATA.offset,ts+this._DATA.offset+ta);return tM._boneIndicesList[0]=new Uint8Array(tj),this._subMeshes.push(tM),!0},tD.READ_DATAAREA=function(){return!1},tD._getVertexDeclaration=function(){for(var tD,tY=!1,tg=!1,tT=!1,tr=!1,ts=!1,ta=!1,tW=!1,tM=!1,tE=!1,tI=0;tI<this._shaderAttributes.length;tI+=8)switch(this._shaderAttributes[tI]){case"POSITION":tY=!0;break;case"NORMAL":tg=!0;break;case"COLOR":tT=!0;break;case"UV":tr=!0;break;case"UV1":ts=!0;break;case"BLENDWEIGHT":tW=!0;break;case"BLENDINDICES":tM=!0;break;case"TANGENT":ta=!0;break;case"BINORMAL":tE=!0}return tY&&tg&&tT&&tr&&ts&&tW&&tM&&ta?tD=tZD.vertexDeclaration:tY&&tg&&tT&&tr&&ts&&tW&&tM?tD=txD.vertexDeclaration:tY&&tg&&tr&&ts&&tW&&tM&&ta?tD=tPD.vertexDeclaration:tY&&tg&&tr&&ts&&tW&&tM?tD=thD.vertexDeclaration:tY&&tg&&tT&&tr&&tW&&tM&&ta?tD=tAD.vertexDeclaration:tY&&tg&&tT&&tr&&tW&&tM?tD=ttD.vertexDeclaration:tY&&tg&&ta&&tE&&tr&&tW&&tM?tD=teD.vertexDeclaration:tY&&tg&&tr&&tW&&tM&&ta?tD=tUD.vertexDeclaration:tY&&tg&&tr&&tW&&tM?tD=tvD.vertexDeclaration:tY&&tg&&tT&&tW&&tM&&ta?tD=tCD.vertexDeclaration:tY&&tg&&tT&&tW&&tM?tD=tID.vertexDeclaration:tY&&tg&&tT&&tr&&ts&&ta?tD=tlD.vertexDeclaration:tY&&tg&&tT&&tr&&ts?tD=tJD.vertexDeclaration:tY&&tg&&tr&&ts&&ta?tD=tHD.vertexDeclaration:tY&&tg&&tr&&ts?tD=tmD.vertexDeclaration:tY&&tg&&tT&&tr&&ta?tD=tbD.vertexDeclaration:tY&&tg&&tr&&ta&&tE?tD=tcD.vertexDeclaration:tY&&tg&&tT&&tr?tD=tdD.vertexDeclaration:tY&&tg&&tr&&ta?tD=tVD.vertexDeclaration:tY&&tg&&tr?tD=tzD.vertexDeclaration:tY&&tg&&tT&&ta?tD=t$D.vertexDeclaration:tY&&tg&&tT&&(tD=tED.vertexDeclaration),tD},t$(0,tD,"mesh",function(){return this._mesh}),tZ._attrReg=new RegExp("(\\w+)|([:,;])","g"),tZ}()),tKD=function(){function t_(){}return tN(t_,"laya.d3.loaders.LoadModelV02"),t_.parse=function(tD,tY,tg,tT,tr,ts){t_._mesh=tg,t_._materials=tT,t_._subMeshes=tr,t_._materialMap=ts,t_._version=tY,t_._readData=tD,t_.READ_DATA(),t_.READ_BLOCK(),t_.READ_STRINGS();for(var ta=0,tW=t_._BLOCK.count;ta<tW;ta++){t_._readData.pos=t_._BLOCK.blockStarts[ta];var tM=t_._readData.getUint16(),tE=t_._strings[tM],tI=t_["READ_"+tE];if(null==tI)throw new Error("model file err,no this function:"+tM+" "+tE);tI.call()}t_._strings.length=0,t_._readData=null,t_._version=null,t_._mesh=null,t_._materials=null,t_._subMeshes=null,t_._materialMap=null},t_._readString=function(){return t_._strings[t_._readData.getUint16()]},t_.READ_DATA=function(){t_._DATA.offset=t_._readData.getUint32(),t_._DATA.size=t_._readData.getUint32()},t_.READ_BLOCK=function(){for(var tD=t_._BLOCK.count=t_._readData.getUint16(),tY=t_._BLOCK.blockStarts=[],tg=t_._BLOCK.blockLengths=[],tT=0;tT<tD;tT++)tY.push(t_._readData.getUint32()),tg.push(t_._readData.getUint32())},t_.READ_STRINGS=function(){var tD=t_._readData.getUint32(),tY=t_._readData.getUint16(),tg=t_._readData.pos;t_._readData.pos=tD+t_._DATA.offset;for(var tT=0;tT<tY;tT++)t_._strings[tT]=t_._readData.readUTFString();t_._readData.pos=tg},t_.READ_MATERIAL=function(){t_._readString(),t_._readString();var tD=t_._readString();return""!==tD&&t_._materials.push(tx.getRes(t_._materialMap[tD])),!0},t_.READ_MESH=function(){t_._readString();var tD,tY=t_._readData.__getBuffer(),tg=0,tT=t_._readData.getInt16(),tr=t_._DATA.offset;for(tg=0;tg<tT;tg++){var ts=tr+t_._readData.getUint32(),ta=t_._readData.getUint32(),tW=new Float32Array(tY.slice(ts,ts+ta)),tM=t_._readString().match(t_._attrReg),tE=t_._getVertexDeclaration(tM),tI=tkY.create(tE,4*tW.length/tE.vertexStride,35044,!0);tI.setData(tW),t_._mesh._vertexBuffers.push(tI)}var tO=tr+t_._readData.getUint32(),tC=t_._readData.getUint32(),tN=new Uint16Array(tY.slice(tO,tO+tC)),t$=teY.create("ushort",tC/2,35044,!0);t$.setData(tN),t_._mesh._indexBuffer=t$;var td=t_._mesh._boneNames=[],tJ=t_._readData.getUint16();for(td.length=tJ,tg=0;tg<tJ;tg++)td[tg]=t_._strings[t_._readData.getUint16()];var tx=t_._readData.getUint32(),tj=t_._readData.getUint32(),tZ=(new Float32Array(tY.slice(tr+tx,tr+tx+tj)),t_._readData.getUint32()),tp=t_._readData.getUint32(),tl=new Float32Array(tY.slice(tr+tZ,tr+tZ+tp));for(t_._mesh._inverseBindPoses=[],tg=0,tD=tl.length;tg<tD;tg+=16){var tt=new tgY(tl[tg+0],tl[tg+1],tl[tg+2],tl[tg+3],tl[tg+4],tl[tg+5],tl[tg+6],tl[tg+7],tl[tg+8],tl[tg+9],tl[tg+10],tl[tg+11],tl[tg+12],tl[tg+13],tl[tg+14],tl[tg+15]);t_._mesh._inverseBindPoses.push(tt)}return t_._mesh._skinnedDatas=new Float32Array(16*tl.length),!0},t_.READ_SUBMESH=function(){var tD=t_._readData.__getBuffer(),tY=new tCY(t_._mesh),tg=t_._readData.getInt16(),tT=t_._readData.getUint32(),tr=t_._readData.getUint32();tY._vertexBuffer=t_._mesh._vertexBuffers[tg],tY._vertexStart=tT,tY._vertexCount=tr;var ts=t_._readData.getUint32(),ta=t_._readData.getUint32(),tW=t_._mesh._indexBuffer;tY._indexBuffer=tW,tY._indexStart=ts,tY._indexCount=ta,tY._indices=new Uint16Array(tW.getData().buffer,2*ts,ta);var tM=t_._DATA.offset,tE=tY._subIndexBufferStart,tI=tY._subIndexBufferCount,tO=tY._boneIndicesList,tC=t_._readData.getUint16();tE.length=tC,tI.length=tC,tO.length=tC;for(var tN=0;tN<tC;tN++){tE[tN]=t_._readData.getUint32(),tI[tN]=t_._readData.getUint32();var t$=t_._readData.getUint32(),td=t_._readData.getUint32();tY._boneIndicesList[tN]=new Uint8Array(tD.slice(tM+t$,tM+t$+td))}return t_._subMeshes.push(tY),!0},t_._getVertexDeclaration=function(tD){for(var tY,tg=!1,tT=!1,tr=!1,ts=!1,ta=!1,tW=!1,tM=!1,tE=!1,tI=!1,tO=0;tO<tD.length;tO++)switch(tD[tO]){case"POSITION":tg=!0;break;case"NORMAL":tT=!0;break;case"COLOR":tr=!0;break;case"UV":ts=!0;break;case"UV1":ta=!0;break;case"BLENDWEIGHT":tM=!0;break;case"BLENDINDICES":tE=!0;break;case"TANGENT":tW=!0;break;case"BINORMAL":tI=!0}return tg&&tT&&tr&&ts&&ta&&tM&&tE&&tW?tY=tZD.vertexDeclaration:tg&&tT&&tr&&ts&&ta&&tM&&tE?tY=txD.vertexDeclaration:tg&&tT&&ts&&ta&&tM&&tE&&tW?tY=tPD.vertexDeclaration:tg&&tT&&ts&&ta&&tM&&tE?tY=thD.vertexDeclaration:tg&&tT&&tr&&ts&&tM&&tE&&tW?tY=tAD.vertexDeclaration:tg&&tT&&tr&&ts&&tM&&tE?tY=ttD.vertexDeclaration:tg&&tT&&ts&&tM&&tE&&tW?tY=tUD.vertexDeclaration:tg&&tT&&ts&&tM&&tE?tY=tvD.vertexDeclaration:tg&&tT&&tr&&tM&&tE&&tW?tY=tCD.vertexDeclaration:tg&&tT&&tr&&tM&&tE?tY=tID.vertexDeclaration:tg&&tT&&tr&&ts&&ta&&tW?tY=tlD.vertexDeclaration:tg&&tT&&tr&&ts&&ta?tY=tJD.vertexDeclaration:tg&&tT&&ts&&ta&&tW?tY=tHD.vertexDeclaration:tg&&tT&&ts&&ta?tY=tmD.vertexDeclaration:tg&&tT&&tr&&ts&&tW?tY=tbD.vertexDeclaration:tg&&tT&&ts&&tW&&tI?tY=tcD.vertexDeclaration:tg&&tT&&tr&&ts?tY=tdD.vertexDeclaration:tg&&tT&&ts&&tW?tY=tVD.vertexDeclaration:tg&&tT&&ts?tY=tzD.vertexDeclaration:tg&&tT&&tr&&tW?tY=t$D.vertexDeclaration:tg&&tT&&tr&&(tY=tED.vertexDeclaration),tY},t_._attrReg=new RegExp("(\\w+)|([:,;])","g"),t_._strings=[],t_._readData=null,t_._version=null,t_._mesh=null,t_._materials=null,t_._subMeshes=null,t_._materialMap=null,tO(t_,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t_}(),toD=function(){function tt(){}return tN(tt,"laya.d3.loaders.LoadModelV03"),tt.parse=function(tD,tY,tg,tT,tr,ts){tt._mesh=tg,tt._subMeshes=tT,tt._materialMap=tr,tt._version=tY,tt._readData=tD,tt._isCompressed=null!=ts&&ts,tt.READ_DATA(),tt.READ_BLOCK(),tt.READ_STRINGS();for(var ta=0,tW=tt._BLOCK.count;ta<tW;ta++){tt._readData.pos=tt._BLOCK.blockStarts[ta];var tM=tt._readData.getUint16(),tE=tt._strings[tM],tI=tt["READ_"+tE];if(null==tI)throw new Error("model file err,no this function:"+tM+" "+tE);tI.call()}tt._strings.length=0,tt._readData=null,tt._version=null,tt._mesh=null,tt._subMeshes=null,tt._materialMap=null},tt._readString=function(){return tt._strings[tt._readData.getUint16()]},tt.READ_DATA=function(){tt._DATA.offset=tt._readData.getUint32(),tt._DATA.size=tt._readData.getUint32()},tt.READ_BLOCK=function(){for(var tD=tt._BLOCK.count=tt._readData.getUint16(),tY=tt._BLOCK.blockStarts=[],tg=tt._BLOCK.blockLengths=[],tT=0;tT<tD;tT++)tY.push(tt._readData.getUint32()),tg.push(tt._readData.getUint32())},tt.READ_STRINGS=function(){var tD=tt._readData.getUint32(),tY=tt._readData.getUint16(),tg=tt._readData.pos;tt._readData.pos=tD+tt._DATA.offset;for(var tT=0;tT<tY;tT++)tt._strings[tT]=tt._readData.readUTFString();tt._readData.pos=tg},tt.READ_MESH=function(){var tD,tY=tt._readString(),tg=tt._readData.__getBuffer(),tT=0,tr=tt._readData.getInt16(),ts=tt._DATA.offset;for(tT=0;tT<tr;tT++){var ta=ts+tt._readData.getUint32(),tW=tt._readData.getUint32();if(tt._isCompressed)var tM=tRD.getFloat32Array(new Uint8Array(tg.slice(ta,ta+tW)),tW/2);else tM=new Float32Array(tg.slice(ta,ta+tW));var tE,tI=tt._readString();switch(tt._version){case"LAYAMODEL:03":tE=tt._vertexDeclarationMap_Discard[tI];break;case"LAYAMODEL:0301":tE=tt._vertexDeclarationMap[tI];break;default:throw new Error("LoadModelV03: unknown version.")}if(!tE)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+tt._version+"  bufferAttribute="+tI+"  name="+tY+"  url="+(tt._mesh?tt._mesh.url:"null"));var tO=tkY.create(tE,4*tM.length/tE.vertexStride,35044,!0,tt._mesh._url+"_"+tT);tO.setData(tM),tt._mesh._vertexBuffers.push(tO)}var tC=ts+tt._readData.getUint32(),tN=tt._readData.getUint32(),t$=new Uint16Array(tg.slice(tC,tC+tN)),td=teY.create("ushort",tN/2,35044,!0,tt._mesh._url);td.setData(t$),tt._mesh._indexBuffer=td;var tJ=tt._mesh._boneNames=[],tx=tt._readData.getUint16();for(tJ.length=tx,tT=0;tT<tx;tT++)tJ[tT]=tt._strings[tt._readData.getUint16()];tt._readData.pos+=8;var tj=tt._readData.getUint32(),tZ=tt._readData.getUint32(),tp=new Float32Array(tg.slice(ts+tj,ts+tj+tZ));for(tt._mesh._inverseBindPoses=[],tT=0,tD=tp.length;tT<tD;tT+=16){var tl=new tgY(tp[tT+0],tp[tT+1],tp[tT+2],tp[tT+3],tp[tT+4],tp[tT+5],tp[tT+6],tp[tT+7],tp[tT+8],tp[tT+9],tp[tT+10],tp[tT+11],tp[tT+12],tp[tT+13],tp[tT+14],tp[tT+15]);tt._mesh._inverseBindPoses.push(tl)}return tt._mesh._skinnedDatas=new Float32Array(16*tp.length),!0},tt.READ_SUBMESH=function(){var tD=tt._readData.__getBuffer(),tY=new tCY(tt._mesh),tg=tt._readData.getInt16(),tT=tt._readData.getUint32(),tr=tt._readData.getUint32();tY._vertexBuffer=tt._mesh._vertexBuffers[tg],tY._vertexStart=tT,tY._vertexCount=tr;var ts=tt._readData.getUint32(),ta=tt._readData.getUint32(),tW=tt._mesh._indexBuffer;tY._indexBuffer=tW,tY._indexStart=ts,tY._indexCount=ta,tY._indices=new Uint16Array(tW.getData().buffer,2*ts,ta);var tM=tt._DATA.offset,tE=tY._subIndexBufferStart,tI=tY._subIndexBufferCount,tO=tY._boneIndicesList,tC=tt._readData.getUint16();tE.length=tC,tI.length=tC,tO.length=tC;for(var tN=0;tN<tC;tN++){tE[tN]=tt._readData.getUint32(),tI[tN]=tt._readData.getUint32();var t$=tt._readData.getUint32(),td=tt._readData.getUint32();tO[tN]=new Uint8Array(tD.slice(tM+t$,tM+t$+td))}return tt._subMeshes.push(tY),!0},tt._strings=[],tt._readData=null,tt._version=null,tt._mesh=null,tt._subMeshes=null,tt._materialMap=null,tt._isCompressed=!1,tO(tt,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":tZD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":txD.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":tfD.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":tPD.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":thD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":tAD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":ttD.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":tUD.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":tvD.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":tCD.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":tID.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":tlD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":tJD.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":tHD.vertexDeclaration,"POSITION,NORMAL,UV,UV1":tmD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":tbD.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":tcD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":tdD.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":tVD.vertexDeclaration,"POSITION,NORMAL,UV":tzD.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":t$D.vertexDeclaration,"POSITION,NORMAL,COLOR":tED.vertexDeclaration,"POSITION,NORMAL,TANGENT":tXD.vertexDeclaration,"POSITION,NORMAL":tMD.vertexDeclaration,"POSITION,UV":tkD.vertexDeclaration,POSITION:tWD.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":tjD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":txD.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":tfD.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":tiD.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":thD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":t_D.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":ttD.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":tSD.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":tvD.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":tOD.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":tID.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":tpD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":tJD.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":tBD.vertexDeclaration,"POSITION,NORMAL,UV,UV1":tmD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":tqD.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":tcD.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":tdD.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":tFD.vertexDeclaration,"POSITION,NORMAL,UV":tzD.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":tND.vertexDeclaration,"POSITION,NORMAL,COLOR":tED.vertexDeclaration,"POSITION,NORMAL,TANGENT":tGD.vertexDeclaration,"POSITION,NORMAL":tMD.vertexDeclaration,"POSITION,UV":tkD.vertexDeclaration,POSITION:tWD.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),tt}(),tRD=function(){function tW(){}return tW.getFloat32=function(tD){var tY,tg,tT=0;return tY=tD[tT++],tg=tD[tT++],tg<<=8,tW.p_byte16ToFloat(tg+=tY,tW._expSize,tW._mSize)},tW.getFloat32Array=function(tD,tY){for(var tg,tT,tr=0,ts=[],ta=0;ta<tY;ta++)tg=tD[tr++],tT=tD[tr++],tT<<=8,tT+=tg,ts.push(tW.p_byte16ToFloat(tT,tW._expSize,tW._mSize));return new Float32Array(ts)},tW.p_byte16ToFloat=function(tD,tY,tg){var tT,tr,ts=1,ta=0;tD>>15==1&&(ts=-1),tT=32767&tD,tT>>=tg,tT-=(1<<tY-1)-1,tr=tD<<tY+1>>tY+1;for(var tW=0;tW<tg;tW++)1==(1&tr)&&(ta+=Math.pow(2,tW-tg)),tr>>=1;return ta+=1,(ta*=Math.pow(2,tT))*ts},tW._mSize=15-(tW._expSize=5),tW}(),tQD=function(){function tM(){}return tN(tM,"laya.d3.loaders.MeshReader"),tM.read=function(tD,tY,tg,tT,tr){var ts=new tt(tD);ts.pos=0;var ta=ts.getUint16()==tlY.PARTICLE_COMPRESS;ta||(ts.pos=0);var tW=ts.readUTFString();switch(tW){case"LAYAMODEL:01":case"LAYASKINANI:01":tM._readVersion01(ts,tW,tY,tg,tT,tr);break;case"LAYAMODEL:02":tKD.parse(ts,tW,tY,tg,tT,tr);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":toD.parse(ts,tW,tY,tT,tr,ta);break;default:throw new Error("MeshReader: unknown mesh version. version:"+tW+", mesh:"+(tY?tY.url:""))}tY._setSubMeshes(tT)},tM._readVersion01=function(tD,tY,tg,tT,tr,ts){new twD(tD,tY,tg,tT,tr,ts)},tM}(),tLD=function(){function tD(tD,tY){this.min=null,this.max=null,this.min=tD,this.max=tY}tN(tD,"laya.d3.math.BoundBox");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.getCorners=function(tD){tD.length=8;var tY=this.min.elements,tg=this.max.elements,tT=tY[0],tr=tY[1],ts=tY[2],ta=tg[0],tW=tg[1],tM=tg[2];tD[0]=new tEY(tT,tW,tM),tD[1]=new tEY(ta,tW,tM),tD[2]=new tEY(ta,tr,tM),tD[3]=new tEY(tT,tr,tM),tD[4]=new tEY(tT,tW,ts),tD[5]=new tEY(ta,tW,ts),tD[6]=new tEY(ta,tr,ts),tD[7]=new tEY(tT,tr,ts)},tY.toDefault=function(){this.min.toDefault(),this.max.toDefault()},tY.cloneTo=function(tD){var tY=tD;this.min.cloneTo(tY.min),this.max.cloneTo(tY.max)},tY.clone=function(){var tD=new this.constructor(new tEY,new tEY);return this.cloneTo(tD),tD},tD.createfromPoints=function(tD,tY){if(null==tD)throw new Error("points");var tg=tY.min,tT=tY.max,tr=tg.elements;tr[0]=Number.MAX_VALUE,tr[1]=Number.MAX_VALUE,tr[2]=Number.MAX_VALUE;var ts=tT.elements;ts[0]=-Number.MAX_VALUE,ts[1]=-Number.MAX_VALUE,ts[2]=-Number.MAX_VALUE;for(var ta=0,tW=tD.length;ta<tW;++ta)tEY.min(tg,tD[ta],tg),tEY.max(tT,tD[ta],tT)},tD.merge=function(tD,tY,tg){tEY.min(tD.min,tY.min,tg.min),tEY.max(tD.max,tY.max,tg.max)},tD}(),tyD=function(){function tE(tD){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=tD,this._near=new trY(new tEY),this._far=new trY(new tEY),this._left=new trY(new tEY),this._right=new trY(new tEY),this._top=new trY(new tEY),this._bottom=new trY(new tEY),tE._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}tN(tE,"laya.d3.math.BoundFrustum");var tD=tE.prototype;return tD.equalsBoundFrustum=function(tD){return this._matrix.equalsOtherMatrix(tD.matrix)},tD.equalsObj=function(tD){if(tD instanceof laya.d3.math.BoundFrustum){var tY=tD;return this.equalsBoundFrustum(tY)}return!1},tD.getPlane=function(tD){switch(tD){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},tD.getCorners=function(tD){tE._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(tD[0]),tE._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(tD[1]),tE._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(tD[2]),tE._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(tD[3]),tE._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(tD[4]),tE._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(tD[5]),tE._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(tD[6]),tE._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(tD[7])},tD.containsPoint=function(tD){for(var tY=trY.PlaneIntersectionType_Front,tg=trY.PlaneIntersectionType_Front,tT=0;tT<6;tT++){switch(tT){case 0:tg=tnD.intersectsPlaneAndPoint(this._near,tD);break;case 1:tg=tnD.intersectsPlaneAndPoint(this._far,tD);break;case 2:tg=tnD.intersectsPlaneAndPoint(this._left,tD);break;case 3:tg=tnD.intersectsPlaneAndPoint(this._right,tD);break;case 4:tg=tnD.intersectsPlaneAndPoint(this._top,tD);break;case 5:tg=tnD.intersectsPlaneAndPoint(this._bottom,tD)}switch(tg){case trY.PlaneIntersectionType_Back:return 0;case trY.PlaneIntersectionType_Intersecting:tY=trY.PlaneIntersectionType_Intersecting}}switch(tY){case trY.PlaneIntersectionType_Intersecting:return 2;default:return 1}},tD.containsBoundBox=function(tD){for(var tY,tg=tE._tempV30,tT=tE._tempV31,tr=1,ts=0;ts<6;ts++){if(tY=this.getPlane(ts),this._getBoxToPlanePVertexNVertex(tD,tY.normal,tg,tT),tnD.intersectsPlaneAndPoint(tY,tg)===trY.PlaneIntersectionType_Back)return 0;tnD.intersectsPlaneAndPoint(tY,tT)===trY.PlaneIntersectionType_Back&&(tr=2)}return tr},tD.containsBoundSphere=function(tD){for(var tY=trY.PlaneIntersectionType_Front,tg=trY.PlaneIntersectionType_Front,tT=0;tT<6;tT++){switch(tT){case 0:tg=tnD.intersectsPlaneAndSphere(this._near,tD);break;case 1:tg=tnD.intersectsPlaneAndSphere(this._far,tD);break;case 2:tg=tnD.intersectsPlaneAndSphere(this._left,tD);break;case 3:tg=tnD.intersectsPlaneAndSphere(this._right,tD);break;case 4:tg=tnD.intersectsPlaneAndSphere(this._top,tD);break;case 5:tg=tnD.intersectsPlaneAndSphere(this._bottom,tD)}switch(tg){case trY.PlaneIntersectionType_Back:return 0;case trY.PlaneIntersectionType_Intersecting:tY=trY.PlaneIntersectionType_Intersecting}}switch(tY){case trY.PlaneIntersectionType_Intersecting:return 2;default:return 1}},tD._getBoxToPlanePVertexNVertex=function(tD,tY,tg,tT){var tr=tD.min,ts=tr.elements,ta=tD.max,tW=ta.elements,tM=tY.elements,tE=tM[0],tI=tM[1],tO=tM[2];tr.cloneTo(tg);var tC=tg.elements;0<=tE&&(tC[0]=tW[0]),0<=tI&&(tC[1]=tW[1]),0<=tO&&(tC[2]=tW[2]),ta.cloneTo(tT);var tN=tT.elements;0<=tE&&(tN[0]=ts[0]),0<=tI&&(tN[1]=ts[1]),0<=tO&&(tN[2]=ts[2])},t$(0,tD,"top",function(){return this._top}),t$(0,tD,"matrix",function(){return this._matrix},function(tD){this._matrix=tD,tE._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),t$(0,tD,"near",function(){return this._near}),t$(0,tD,"far",function(){return this._far}),t$(0,tD,"left",function(){return this._left}),t$(0,tD,"right",function(){return this._right}),t$(0,tD,"bottom",function(){return this._bottom}),tE._getPlanesFromMatrix=function(tD,tY,tg,tT,tr,ts,ta){var tW=tD.elements,tM=tW[0],tE=tW[1],tI=tW[2],tO=tW[3],tC=tW[4],tN=tW[5],t$=tW[6],td=tW[7],tJ=tW[8],tx=tW[9],tj=tW[10],tZ=tW[11],tp=tW[12],tl=tW[13],tt=tW[14],t_=tW[15],tA=tY.normal.elements;tA[0]=tO+tI,tA[1]=td+t$,tA[2]=tZ+tj,tY.distance=t_+tt,tY.normalize();var tq=tg.normal.elements;tq[0]=tO-tI,tq[1]=td-t$,tq[2]=tZ-tj,tg.distance=t_-tt,tg.normalize();var tb=tT.normal.elements;tb[0]=tO+tM,tb[1]=td+tC,tb[2]=tZ+tJ,tT.distance=t_+tp,tT.normalize();var tG=tr.normal.elements;tG[0]=tO-tM,tG[1]=td-tC,tG[2]=tZ-tJ,tr.distance=t_-tp,tr.normalize();var tX=ts.normal.elements;tX[0]=tO-tE,tX[1]=td-tN,tX[2]=tZ-tx,ts.distance=t_-tl,ts.normalize();var tz=ta.normal.elements;tz[0]=tO+tE,tz[1]=td+tN,tz[2]=tZ+tx,ta.distance=t_+tl,ta.normalize()},tE._get3PlaneInterPoint=function(tD,tY,tg){var tT=tD.normal,tr=tY.normal,ts=tg.normal;tEY.cross(tr,ts,tE._tempV30),tEY.cross(ts,tT,tE._tempV31),tEY.cross(tT,tr,tE._tempV32);var ta=tEY.dot(tT,tE._tempV30),tW=tEY.dot(tr,tE._tempV31),tM=tEY.dot(ts,tE._tempV32);return tEY.scale(tE._tempV30,-tD.distance/ta,tE._tempV33),tEY.scale(tE._tempV31,-tY.distance/tW,tE._tempV34),tEY.scale(tE._tempV32,-tg.distance/tM,tE._tempV35),tEY.add(tE._tempV33,tE._tempV34,tE._tempV36),tEY.add(tE._tempV35,tE._tempV36,tE._tempV37),tE._tempV37},tO(tE,["_tempV30",function(){return this._tempV30=new tEY},"_tempV31",function(){return this._tempV31=new tEY},"_tempV32",function(){return this._tempV32=new tEY},"_tempV33",function(){return this._tempV33=new tEY},"_tempV34",function(){return this._tempV34=new tEY},"_tempV35",function(){return this._tempV35=new tEY},"_tempV36",function(){return this._tempV36=new tEY},"_tempV37",function(){return this._tempV37=new tEY}]),tE}(),tuD=function(){function tI(tD,tY){this.center=null,this.radius=NaN,this.center=tD,this.radius=tY}tN(tI,"laya.d3.math.BoundSphere");var tD=tI.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.toDefault=function(){this.center.toDefault(),this.radius=0},tD.intersectsRayDistance=function(tD){return tnD.intersectsRayAndSphereRD(tD,this)},tD.intersectsRayPoint=function(tD,tY){return tnD.intersectsRayAndSphereRP(tD,this,tY)},tD.cloneTo=function(tD){var tY=tD;this.center.cloneTo(tY.center),tY.radius=this.radius},tD.clone=function(){var tD=new this.constructor(new tEY,new tEY);return this.cloneTo(tD),tD},tI.createFromSubPoints=function(tD,tY,tg,tT){if(null==tD)throw new Error("points");if(tY<0||tY>=tD.length)throw new Error("start"+tY+"Must be in the range [0, "+(tD.length-1)+"]");if(tg<0||tY+tg>tD.length)throw new Error("count"+tg+"Must be in the range <= "+tD.length+"}");var tr=tY+tg,ts=tI._tempVector3;ts.elements[0]=0,ts.elements[1]=0,ts.elements[2]=0;for(var ta=tY;ta<tr;++ta)tEY.add(tD[ta],ts,ts);var tW=tT.center;tEY.scale(ts,1/tg,tW);var tM=0;for(ta=tY;ta<tr;++ta){var tE=tEY.distanceSquared(tW,tD[ta]);tM<tE&&(tM=tE)}tT.radius=Math.sqrt(tM)},tI.createfromPoints=function(tD,tY){if(null==tD)throw new Error("points");tI.createFromSubPoints(tD,0,tD.length,tY)},tO(tI,["_tempVector3",function(){return this._tempVector3=new tEY}]),tI}(),tnD=function(){function tL(){}return tN(tL,"laya.d3.math.Collision"),tL.distancePlaneToPoint=function(tD,tY){return tEY.dot(tD.normal,tY)-tD.distance},tL.distanceBoxToPoint=function(tD,tY){var tg=tD.min.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tD.max.elements,tW=ta[0],tM=ta[1],tE=ta[2],tI=tY.elements,tO=tI[0],tC=tI[1],tN=tI[2],t$=0;return tO<tT&&(t$+=(tT-tO)*(tT-tO)),tW<tO&&(t$+=(tW-tO)*(tW-tO)),tC<tr&&(t$+=(tr-tC)*(tr-tC)),tM<tC&&(t$+=(tM-tC)*(tM-tC)),tN<ts&&(t$+=(ts-tN)*(ts-tN)),tE<tN&&(t$+=(tE-tN)*(tE-tN)),Math.sqrt(t$)},tL.distanceBoxToBox=function(tD,tY){var tg=tD.min.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tD.max.elements,tW=ta[0],tM=ta[1],tE=ta[2],tI=tY.min.elements,tO=tI[0],tC=tI[1],tN=tI[2],t$=tY.max.elements,td=t$[0],tJ=t$[1],tx=t$[2],tj=0,tZ=NaN;return td<tT?tj+=(tZ=tT-td)*tZ:tW<tO&&(tj+=(tZ=tO-tW)*tZ),tJ<tr?tj+=(tZ=tr-tJ)*tZ:tM<tC&&(tj+=(tZ=tC-tM)*tZ),tx<ts?tj+=(tZ=ts-tx)*tZ:tE<tN&&(tj+=(tZ=tN-tE)*tZ),Math.sqrt(tj)},tL.distanceSphereToPoint=function(tD,tY){var tg=Math.sqrt(tEY.distanceSquared(tD.center,tY));return tg-=tD.radius,Math.max(tg,0)},tL.distanceSphereToSphere=function(tD,tY){var tg=Math.sqrt(tEY.distanceSquared(tD.center,tY.center));return tg-=tD.radius+tY.radius,Math.max(tg,0)},tL.intersectsRayAndTriangleRD=function(tD,tY,tg,tT,tr){var ts=tD.origin.elements,ta=ts[0],tW=ts[1],tM=ts[2],tE=tD.direction.elements,tI=tE[0],tO=tE[1],tC=tE[2],tN=tY.elements,t$=tN[0],td=tN[1],tJ=tN[2],tx=tg.elements,tj=tx[0],tZ=tx[1],tp=tx[2],tl=tT.elements,tt=tl[0],t_=tl[1],tA=tl[2],tq=tL._tempV30.elements,tb=tq[0],tG=tq[1],tX=tq[2];tb=tj-t$,tG=tZ-td,tX=tp-tJ;var tz=tL._tempV31.elements,tm=tz[0],th=tz[1],ti=tz[2];tm=tt-t$,th=t_-td,ti=tA-tJ;var tP=tL._tempV32.elements,tB=tP[0],tH=tP[1],tv=tP[2],tS=tb*(tB=tO*ti-tC*th)+tG*(tH=tC*tm-tI*ti)+tX*(tv=tI*th-tO*tm);if(tDY.isZero(tS))return 0,!1;var tU=1/tS,tF=tL._tempV33.elements,tV=tF[0],tc=tF[1],tf=tF[2],te=(tV=ta-t$)*tB+(tc=tW-td)*tH+(tf=tM-tJ)*tv;if((te*=tU)<0||1<te)return 0,!1;var tk=tL._tempV34.elements,tw=tk[0],tK=tk[1],to=tk[2],tR=tI*(tw=tc*tX-tf*tG)+tO*(tK=tf*tb-tV*tX)+tC*(to=tV*tG-tc*tb);if((tR*=tU)<0||1<te+tR)return 0,!1;var tQ=tm*tw+th*tK+ti*to;return(tQ*=tU)<0?(0,!1):(tQ,!0)},tL.intersectsRayAndTriangleRP=function(tD,tY,tg,tT,tr){return tL.intersectsRayAndTriangleRD(tD,tY,tg,tT,NaN)?(tEY.scale(tD.direction,NaN,tL._tempV30),tEY.add(tD.origin,tL._tempV30,tr),!0):(tr=tEY.ZERO,!1)},tL.intersectsRayAndPoint=function(tD,tY){tEY.subtract(tD.origin,tY,tL._tempV30);var tg=tEY.dot(tL._tempV30,tD.direction),tT=tEY.dot(tL._tempV30,tL._tempV30)-tDY.zeroTolerance;return!(0<tT&&0<tg)&&!(tg*tg-tT<0)},tL.intersectsRayAndRay=function(tD,tY,tg){var tT=tD.origin,tr=tT.elements,ts=tr[0],ta=tr[1],tW=tr[2],tM=tD.direction,tE=tM.elements,tI=tE[0],tO=tE[1],tC=tE[2],tN=tY.origin,t$=tN.elements,td=t$[0],tJ=t$[1],tx=t$[2],tj=tY.direction,tZ=tj.elements,tp=tZ[0],tl=tZ[1],tt=tZ[2];tEY.cross(tM,tj,tL._tempV30);var t_=tL._tempV30.elements,tA=tEY.scalarLengthSquared(tL._tempV30);if(tDY.isZero(tA)&&tDY.nearEqual(td,ts)&&tDY.nearEqual(tJ,ta)&&tDY.nearEqual(tx,tW))return tEY.ZERO.cloneTo(tg),!0;var tq=td-ts,tb=tJ-ta,tG=tx-tW,tX=tp,tz=tl,tm=tt,th=t_[0],ti=t_[1],tP=t_[2],tB=(tq*tz*tP+tb*tm*th+tG*tX*ti-tq*tm*ti-tb*tX*tP-tG*tz*th)/tA,tH=(tq*(tz=tO)*tP+tb*(tm=tC)*th+tG*(tX=tI)*ti-tq*tm*ti-tb*tX*tP-tG*tz*th)/tA;tEY.scale(tM,tB,tL._tempV30),tEY.scale(tj,tH,tL._tempV31),tEY.add(tT,tL._tempV30,tL._tempV32),tEY.add(tN,tL._tempV31,tL._tempV33);var tv=tL._tempV32.elements,tS=tL._tempV33.elements;return tDY.nearEqual(tS[0],tv[0])&&tDY.nearEqual(tS[1],tv[1])&&tDY.nearEqual(tS[2],tv[2])?(tL._tempV32.cloneTo(tg),!0):(tEY.ZERO.cloneTo(tg),!1)},tL.intersectsPlaneAndTriangle=function(tD,tY,tg,tT){var tr=tL.intersectsPlaneAndPoint(tD,tY),ts=tL.intersectsPlaneAndPoint(tD,tg),ta=tL.intersectsPlaneAndPoint(tD,tT);return tr==trY.PlaneIntersectionType_Front&&ts==trY.PlaneIntersectionType_Front&&ta==trY.PlaneIntersectionType_Front?trY.PlaneIntersectionType_Front:tr==trY.PlaneIntersectionType_Back&&ts==trY.PlaneIntersectionType_Back&&ta==trY.PlaneIntersectionType_Back?trY.PlaneIntersectionType_Back:trY.PlaneIntersectionType_Intersecting},tL.intersectsRayAndPlaneRD=function(tD,tY,tg){var tT=tY.normal,tr=tEY.dot(tT,tD.direction);if(tDY.isZero(tr))return 0,!1;var ts=tEY.dot(tT,tD.origin);return!((-tY.distance-ts)/tr<0)||(0,!1)},tL.intersectsRayAndPlaneRP=function(tD,tY,tg){return tL.intersectsRayAndPlaneRD(tD,tY,NaN)?(tEY.scale(tD.direction,NaN,tL._tempV30),tEY.add(tD.origin,tL._tempV30,tL._tempV31),tL._tempV31,!0):(tEY.ZERO,!1)},tL.intersectsRayAndBoxRD=function(tD,tY){var tg=tD.origin.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tD.direction.elements,tW=ta[0],tM=ta[1],tE=ta[2],tI=tY.min.elements,tO=tI[0],tC=tI[1],tN=tI[2],t$=tY.max.elements,td=t$[0],tJ=t$[1],tx=t$[2],tj=0,tZ=tDY.MaxValue;if(tDY.isZero(tW)){if(tT<tO||td<tT)return-1}else{var tp=1/tW,tl=(tO-tT)*tp,tt=(td-tT)*tp;if(tt<tl){var t_=tl;tl=tt,tt=t_}if(tj=Math.max(tl,tj),(tZ=Math.min(tt,tZ))<tj)return-1}if(tDY.isZero(tM)){if(tr<tC||tJ<tr)return-1}else{var tA=1/tM,tq=(tC-tr)*tA,tb=(tJ-tr)*tA;if(tb<tq){var tG=tq;tq=tb,tb=tG}if(tj=Math.max(tq,tj),(tZ=Math.min(tb,tZ))<tj)return-1}if(tDY.isZero(tE)){if(ts<tN||tx<ts)return-1}else{var tX=1/tE,tz=(tN-ts)*tX,tm=(tx-ts)*tX;if(tm<tz){var th=tz;tz=tm,tm=th}if(tj=Math.max(tz,tj),(tZ=Math.min(tm,tZ))<tj)return-1}return tj},tL.intersectsRayAndBoxRP=function(tD,tY,tg){var tT=tL.intersectsRayAndBoxRD(tD,tY);return-1===tT?tEY.ZERO.cloneTo(tg):(tEY.scale(tD.direction,tT,tL._tempV30),tEY.add(tD.origin,tL._tempV30,tL._tempV31),tL._tempV31.cloneTo(tg)),tT},tL.intersectsRayAndSphereRD=function(tD,tY){var tg=tY.radius;tEY.subtract(tD.origin,tY.center,tL._tempV30);var tT=tEY.dot(tL._tempV30,tD.direction),tr=tEY.dot(tL._tempV30,tL._tempV30)-tg*tg;if(0<tr&&0<tT)return-1;var ts=tT*tT-tr;if(ts<0)return-1;var ta=-tT-Math.sqrt(ts);return ta<0&&(ta=0),ta},tL.intersectsRayAndSphereRP=function(tD,tY,tg){var tT=tL.intersectsRayAndSphereRD(tD,tY);return-1===tT?tEY.ZERO.cloneTo(tg):(tEY.scale(tD.direction,tT,tL._tempV30),tEY.add(tD.origin,tL._tempV30,tL._tempV31),tL._tempV31.cloneTo(tg)),tT},tL.intersectsSphereAndTriangle=function(tD,tY,tg,tT){var tr=tD.center,ts=tD.radius;return tL.closestPointPointTriangle(tr,tY,tg,tT,tL._tempV30),tEY.subtract(tL._tempV30,tr,tL._tempV31),tEY.dot(tL._tempV31,tL._tempV31)<=ts*ts},tL.intersectsPlaneAndPoint=function(tD,tY){var tg=tEY.dot(tD.normal,tY)+tD.distance;return 0<tg?trY.PlaneIntersectionType_Front:tg<0?trY.PlaneIntersectionType_Back:trY.PlaneIntersectionType_Intersecting},tL.intersectsPlaneAndPlane=function(tD,tY){tEY.cross(tD.normal,tY.normal,tL._tempV30);var tg=tEY.dot(tL._tempV30,tL._tempV30);return!tDY.isZero(tg)},tL.intersectsPlaneAndPlaneRL=function(tD,tY,tg){var tT=tD.normal,tr=tY.normal;tEY.cross(tT,tr,tL._tempV34);var ts=tEY.dot(tL._tempV34,tL._tempV34);return!tDY.isZero(ts)&&(tEY.scale(tr,tD.distance,tL._tempV30),tEY.scale(tT,tY.distance,tL._tempV31),tEY.subtract(tL._tempV30,tL._tempV31,tL._tempV32),tEY.cross(tL._tempV32,tL._tempV34,tL._tempV33),tEY.normalize(tL._tempV34,tL._tempV34),new tWY(tL._tempV33,tL._tempV34),!0)},tL.intersectsPlaneAndBox=function(tD,tY){var tg=tD.distance,tT=tD.normal,tr=tT.elements,ts=tr[0],ta=tr[1],tW=tr[2],tM=tY.min.elements,tE=tM[0],tI=tM[1],tO=tM[2],tC=tY.max.elements,tN=tC[0],t$=tC[1],td=tC[2];tL._tempV30.elements[0]=0<ts?tE:tN,tL._tempV30.elements[1]=0<ta?tI:t$,tL._tempV30.elements[2]=0<tW?tO:td,tL._tempV31.elements[0]=0<ts?tN:tE,tL._tempV31.elements[1]=0<ta?t$:tI,tL._tempV31.elements[2]=0<tW?td:tO;var tJ=tEY.dot(tT,tL._tempV30);return 0<tJ+tg?trY.PlaneIntersectionType_Front:(tJ=tEY.dot(tT,tL._tempV31))+tg<0?trY.PlaneIntersectionType_Back:trY.PlaneIntersectionType_Intersecting},tL.intersectsPlaneAndSphere=function(tD,tY){var tg=tY.radius,tT=tEY.dot(tD.normal,tY.center)+tD.distance;return tg<tT?trY.PlaneIntersectionType_Front:tT<-tg?trY.PlaneIntersectionType_Back:trY.PlaneIntersectionType_Intersecting},tL.intersectsBoxAndBox=function(tD,tY){var tg=tD.min.elements,tT=tD.max.elements,tr=tY.min.elements,ts=tY.max.elements;return!(tg[0]>ts[0]||tr[0]>tT[0])&&(!(tg[1]>ts[1]||tr[1]>tT[1])&&!(tg[2]>ts[2]||tr[2]>tT[2]))},tL.intersectsBoxAndSphere=function(tD,tY){var tg=tY.center,tT=tY.radius;return tEY.Clamp(tg,tD.min,tD.max,tL._tempV30),tEY.distanceSquared(tg,tL._tempV30)<=tT*tT},tL.intersectsSphereAndSphere=function(tD,tY){var tg=tD.radius+tY.radius;return tEY.distanceSquared(tD.center,tY.center)<=tg*tg},tL.boxContainsPoint=function(tD,tY){var tg=tD.min.elements,tT=tD.max.elements,tr=tY.elements;return tg[0]<=tr[0]&&tT[0]>=tr[0]&&tg[1]<=tr[1]&&tT[1]>=tr[1]&&tg[2]<=tr[2]&&tT[2]>=tr[2]?1:0},tL.boxContainsBox=function(tD,tY){var tg=tD.min.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tD.max.elements,tW=ta[0],tM=ta[1],tE=ta[2],tI=tY.min.elements,tO=tI[0],tC=tI[1],tN=tI[2],t$=tY.max.elements,td=t$[0],tJ=t$[1],tx=t$[2];return tW<tO||td<tT?0:tM<tC||tJ<tr?0:tE<tN||tx<ts?0:tT<=tO&&td<=td&&tr<=tC&&tJ<=tM&&ts<=tN&&tx<=tE?1:2},tL.boxContainsSphere=function(tD,tY){var tg=tD.min,tT=tg.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=tD.max,tM=tW.elements,tE=tM[0],tI=tM[1],tO=tM[2],tC=tY.center,tN=tC.elements,t$=tN[0],td=tN[1],tJ=tN[2],tx=tY.radius;return tEY.Clamp(tC,tg,tW,tL._tempV30),tx*tx<tEY.distanceSquared(tC,tL._tempV30)?0:tr+tx<=t$&&t$<=tE-tx&&tx<tE-tr&&ts+tx<=td&&td<=tI-tx&&tx<tI-ts&&ta+tx<=tJ&&tJ<=tO-tx&&tx<tO-ta?1:2},tL.sphereContainsPoint=function(tD,tY){return tEY.distanceSquared(tY,tD.center)<=tD.radius*tD.radius?1:0},tL.sphereContainsTriangle=function(tD,tY,tg,tT){var tr=tL.sphereContainsPoint(tD,tY),ts=tL.sphereContainsPoint(tD,tg),ta=tL.sphereContainsPoint(tD,tT);return 1==tr&&1==ts&&1==ta?1:tL.intersectsSphereAndTriangle(tD,tY,tg,tT)?2:0},tL.sphereContainsBox=function(tD,tY){var tg=tD.center.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tD.radius,tW=tY.min.elements,tM=tW[0],tE=tW[1],tI=tW[2],tO=tY.max.elements,tC=tO[0],tN=tO[1],t$=tO[2],td=tL._tempV30.elements;td[0],td[1],td[2];if(!tL.intersectsBoxAndSphere(tY,tD))return 0;var tJ=ta*ta;return tT-tM,tr-tN,ts-t$,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tC,tr-tN,ts-t$,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tC,tr-tE,ts-t$,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tM,tr-tE,ts-t$,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tM,tr-tN,ts-tI,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tC,tr-tN,ts-tI,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tC,tr-tE,ts-tI,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:(tT-tM,tr-tE,ts-tI,tEY.scalarLengthSquared(tL._tempV30)>tJ?2:1)))))))},tL.sphereContainsSphere=function(tD,tY){var tg=tD.radius,tT=tY.radius,tr=tEY.distance(tD.center,tY.center);return tg+tT<tr?0:tg-tT<tr?2:1},tL.closestPointPointTriangle=function(tD,tY,tg,tT,tr){tEY.subtract(tg,tY,tL._tempV30),tEY.subtract(tT,tY,tL._tempV31),tEY.subtract(tD,tY,tL._tempV32),tEY.subtract(tD,tg,tL._tempV33),tEY.subtract(tD,tT,tL._tempV34);var ts=tEY.dot(tL._tempV30,tL._tempV32),ta=tEY.dot(tL._tempV31,tL._tempV32),tW=tEY.dot(tL._tempV30,tL._tempV33),tM=tEY.dot(tL._tempV31,tL._tempV33),tE=tEY.dot(tL._tempV30,tL._tempV34),tI=tEY.dot(tL._tempV31,tL._tempV34);if(ts<=0&&ta<=0)tY.cloneTo(tr);else if(0<=tW&&tM<=tW)tg.cloneTo(tr);else{var tO=ts*tM-tW*ta;if(tO<=0&&0<=ts&&tW<=0){var tC=ts/(ts-tW);return tEY.scale(tL._tempV30,tC,tr),void tEY.add(tY,tr,tr)}if(0<=tI&&tE<=tI)tT.cloneTo(tr);else{var tN=tE*ta-ts*tI;if(tN<=0&&0<=ta&&tI<=0){var t$=ta/(ta-tI);return tEY.scale(tL._tempV31,t$,tr),void tEY.add(tY,tr,tr)}var td=tW*tI-tE*tM;if(td<=0&&0<=tM-tW&&0<=tE-tI){var tJ=(tM-tW)/(tM-tW+(tE-tI));return tEY.subtract(tT,tg,tr),tEY.scale(tr,tJ,tr),void tEY.add(tg,tr,tr)}var tx=1/(td+tN+tO),tj=tN*tx,tZ=tO*tx;tEY.scale(tL._tempV30,tj,tL._tempV35),tEY.scale(tL._tempV31,tZ,tL._tempV36),tEY.add(tL._tempV35,tL._tempV36,tr),tEY.add(tY,tr,tr)}}},tL.closestPointPlanePoint=function(tD,tY,tg){var tT=tD.normal,tr=tEY.dot(tT,tY)-tD.distance;tEY.scale(tT,tr,tL._tempV30),tEY.subtract(tY,tL._tempV30,tg)},tL.closestPointBoxPoint=function(tD,tY,tg){tEY.max(tY,tD.min,tL._tempV30),tEY.min(tL._tempV30,tD.max,tg)},tL.closestPointSpherePoint=function(tD,tY,tg){var tT=tD.center;tEY.subtract(tY,tT,tg),tEY.normalize(tg,tg),tEY.scale(tg,tD.radius,tg),tEY.add(tg,tT,tg)},tL.closestPointSphereSphere=function(tD,tY,tg){var tT=tD.center;tEY.subtract(tY.center,tT,tg),tEY.normalize(tg,tg),tEY.scale(tg,tD.radius,tg),tEY.add(tg,tT,tg)},tO(tL,["_tempV30",function(){return this._tempV30=new tEY},"_tempV31",function(){return this._tempV31=new tEY},"_tempV32",function(){return this._tempV32=new tEY},"_tempV33",function(){return this._tempV33=new tEY},"_tempV34",function(){return this._tempV34=new tEY},"_tempV35",function(){return this._tempV35=new tEY},"_tempV36",function(){return this._tempV36=new tEY}]),tL}(),tDY=(function(){function tD(){}tN(tD,"laya.d3.math.ContainmentType"),tD.Disjoint=0,tD.Contains=1,tD.Intersects=2}(),function(){function tg(){}return tN(tg,"laya.d3.math.MathUtils3D"),tg.isZero=function(tD){return Math.abs(tD)<tg.zeroTolerance},tg.nearEqual=function(tD,tY){return!!tg.isZero(tD-tY)},tg.fastInvSqrt=function(tD){return tg.isZero(tD)?tD:1/Math.sqrt(tD)},tO(tg,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),tg}()),tYY=function(){function tM(){var tD=this.elements=new Float32Array(9);tD[0]=1,tD[1]=0,tD[2]=0,tD[3]=0,tD[4]=1,tD[5]=0,tD[6]=0,tD[7]=0,tD[8]=1}tN(tM,"laya.d3.math.Matrix3x3");var tD=tM.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.determinant=function(){var tD=this.elements,tY=tD[0],tg=tD[1],tT=tD[2],tr=tD[3],ts=tD[4],ta=tD[5],tW=tD[6],tM=tD[7],tE=tD[8];return tY*(tE*ts-ta*tM)+tg*(-tE*tr+ta*tW)+tT*(tM*tr-ts*tW)},tD.translate=function(tD,tY){var tg=tY.elements,tT=this.elements,tr=tD.elements,ts=tT[0],ta=tT[1],tW=tT[2],tM=tT[3],tE=tT[4],tI=tT[5],tO=tT[6],tC=tT[7],tN=tT[8],t$=tr[0],td=tr[1];tg[0]=ts,tg[1]=ta,tg[2]=tW,tg[3]=tM,tg[4]=tE,tg[5]=tI,tg[6]=t$*ts+td*tM+tO,tg[7]=t$*ta+td*tE+tC,tg[8]=t$*tW+td*tI+tN},tD.rotate=function(tD,tY){var tg=tY.elements,tT=this.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=tT[3],tM=tT[4],tE=tT[5],tI=tT[6],tO=tT[7],tC=tT[8],tN=Math.sin(tD),t$=Math.cos(tD);tg[0]=t$*tr+tN*tW,tg[1]=t$*ts+tN*tM,tg[2]=t$*ta+tN*tE,tg[3]=t$*tW-tN*tr,tg[4]=t$*tM-tN*ts,tg[5]=t$*tE-tN*ta,tg[6]=tI,tg[7]=tO,tg[8]=tC},tD.scale=function(tD,tY){var tg=tY.elements,tT=this.elements,tr=tD.elements,ts=tr[0],ta=tr[1];tg[0]=ts*tT[0],tg[1]=ts*tT[1],tg[2]=ts*tT[2],tg[3]=ta*tT[3],tg[4]=ta*tT[4],tg[5]=ta*tT[5],tg[6]=tT[6],tg[7]=tT[7],tg[8]=tT[8]},tD.invert=function(tD){var tY=tD.elements,tg=this.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tg[3],tW=tg[4],tM=tg[5],tE=tg[6],tI=tg[7],tO=tg[8],tC=tO*tW-tM*tI,tN=-tO*ta+tM*tE,t$=tI*ta-tW*tE,td=tT*tC+tr*tN+ts*t$;td||(tD=null),td=1/td,tY[0]=tC*td,tY[1]=(-tO*tr+ts*tI)*td,tY[2]=(tM*tr-ts*tW)*td,tY[3]=tN*td,tY[4]=(tO*tT-ts*tE)*td,tY[5]=(-tM*tT+ts*ta)*td,tY[6]=t$*td,tY[7]=(-tI*tT+tr*tE)*td,tY[8]=(tW*tT-tr*ta)*td},tD.transpose=function(tD){var tY=tD.elements,tg=this.elements;if(tD===this){var tT=tg[1],tr=tg[2],ts=tg[5];tY[1]=tg[3],tY[2]=tg[6],tY[3]=tT,tY[5]=tg[7],tY[6]=tr,tY[7]=ts}else tY[0]=tg[0],tY[1]=tg[3],tY[2]=tg[6],tY[3]=tg[1],tY[4]=tg[4],tY[5]=tg[7],tY[6]=tg[2],tY[7]=tg[5],tY[8]=tg[8]},tD.identity=function(){var tD=this.elements;tD[0]=1,tD[1]=0,tD[2]=0,tD[3]=0,tD[4]=1,tD[5]=0,tD[6]=0,tD[7]=0,tD[8]=1},tD.cloneTo=function(tD){var tY,tg,tT;if((tg=this.elements)!==(tT=tD.elements))for(tY=0;tY<9;++tY)tT[tY]=tg[tY]},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tM.createFromTranslation=function(tD,tY){tY.elements;var tg=tD.elements;tY[0]=1,tY[1]=0,tY[2]=0,tY[3]=0,tY[4]=1,tY[5]=0,tY[6]=tg[0],tY[7]=tg[1],tY[8]=1},tM.createFromRotation=function(tD,tY){var tg=tY.elements,tT=Math.sin(tD),tr=Math.cos(tD);tg[0]=tr,tg[1]=tT,tg[2]=0,tg[3]=-tT,tg[4]=tr,tg[5]=0,tg[6]=0,tg[7]=0,tg[8]=1},tM.createFromScaling=function(tD,tY){var tg=tY.elements,tT=tD.elements;tg[0]=tT[0],tg[1]=0,tg[2]=0,tg[3]=0,tg[4]=tT[1],tg[5]=0,tg[6]=0,tg[7]=0,tg[8]=1},tM.createFromMatrix4x4=function(tD,tY){tY[0]=tD[0],tY[1]=tD[1],tY[2]=tD[2],tY[3]=tD[4],tY[4]=tD[5],tY[5]=tD[6],tY[6]=tD[8],tY[7]=tD[9],tY[8]=tD[10]},tM.multiply=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements,ta=tr[0],tW=tr[1],tM=tr[2],tE=tr[3],tI=tr[4],tO=tr[5],tC=tr[6],tN=tr[7],t$=tr[8],td=ts[0],tJ=ts[1],tx=ts[2],tj=ts[3],tZ=ts[4],tp=ts[5],tl=ts[6],tt=ts[7],t_=ts[8];tT[0]=td*ta+tJ*tE+tx*tC,tT[1]=td*tW+tJ*tI+tx*tN,tT[2]=td*tM+tJ*tO+tx*t$,tT[3]=tj*ta+tZ*tE+tp*tC,tT[4]=tj*tW+tZ*tI+tp*tN,tT[5]=tj*tM+tZ*tO+tp*t$,tT[6]=tl*ta+tt*tE+t_*tC,tT[7]=tl*tW+tt*tI+t_*tN,tT[8]=tl*tM+tt*tO+t_*t$},tM.lookAt=function(tD,tY,tg,tT){tEY.subtract(tD,tY,tM._tempV30),tEY.normalize(tM._tempV30,tM._tempV30),tEY.cross(tg,tM._tempV30,tM._tempV31),tEY.normalize(tM._tempV31,tM._tempV31),tEY.cross(tM._tempV30,tM._tempV31,tM._tempV32);var tr=tM._tempV30.elements,ts=tM._tempV31.elements,ta=tM._tempV32.elements,tW=tT.elements;tW[0]=ts[0],tW[3]=ts[1],tW[6]=ts[2],tW[1]=ta[0],tW[4]=ta[1],tW[7]=ta[2],tW[2]=tr[0],tW[5]=tr[1],tW[8]=tr[2]},tM.DEFAULT=new tM,tO(tM,["_tempV30",function(){return this._tempV30=new tEY},"_tempV31",function(){return this._tempV31=new tEY},"_tempV32",function(){return this._tempV32=new tEY}]),tM}(),tgY=function(){function tq(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO,tC,tN,t$,td){void 0===tD&&(tD=1),void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ts&&(ts=1),void 0===ta&&(ta=0),void 0===tW&&(tW=0),void 0===tM&&(tM=0),void 0===tE&&(tE=0),void 0===tI&&(tI=1),void 0===tO&&(tO=0),void 0===tC&&(tC=0),void 0===tN&&(tN=0),void 0===t$&&(t$=0),void 0===td&&(td=1);var tJ=this.elements=new Float32Array(16);tJ[0]=tD,tJ[1]=tY,tJ[2]=tg,tJ[3]=tT,tJ[4]=tr,tJ[5]=ts,tJ[6]=ta,tJ[7]=tW,tJ[8]=tM,tJ[9]=tE,tJ[10]=tI,tJ[11]=tO,tJ[12]=tC,tJ[13]=tN,tJ[14]=t$,tJ[15]=td}tN(tq,"laya.d3.math.Matrix4x4");var tD=tq.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.getElementByRowColumn=function(tD,tY){if(tD<0||3<tD)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(tY<0||3<tY)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*tD+tY]},tD.setElementByRowColumn=function(tD,tY,tg){if(tD<0||3<tD)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(tY<0||3<tY)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*tD+tY]=tg},tD.equalsOtherMatrix=function(tD){var tY=this.elements,tg=tD.elements;return tDY.nearEqual(tY[0],tg[0])&&tDY.nearEqual(tY[1],tg[1])&&tDY.nearEqual(tY[2],tg[2])&&tDY.nearEqual(tY[3],tg[3])&&tDY.nearEqual(tY[4],tg[4])&&tDY.nearEqual(tY[5],tg[5])&&tDY.nearEqual(tY[6],tg[6])&&tDY.nearEqual(tY[7],tg[7])&&tDY.nearEqual(tY[8],tg[8])&&tDY.nearEqual(tY[9],tg[9])&&tDY.nearEqual(tY[10],tg[10])&&tDY.nearEqual(tY[11],tg[11])&&tDY.nearEqual(tY[12],tg[12])&&tDY.nearEqual(tY[13],tg[13])&&tDY.nearEqual(tY[14],tg[14])&&tDY.nearEqual(tY[15],tg[15])},tD.decomposeTransRotScale=function(tD,tY,tg){var tT=tq._tempMatrix4x4;return this.decomposeTransRotMatScale(tD,tT,tg)?(tsY.createFromMatrix4x4(tT,tY),!0):(tY.identity(),!1)},tD.decomposeTransRotMatScale=function(tD,tY,tg){var tT=this.elements,tr=tD.elements,ts=tY.elements,ta=tg.elements;tr[0]=tT[12],tr[1]=tT[13],tr[2]=tT[14];var tW=tT[0],tM=tT[1],tE=tT[2],tI=tT[4],tO=tT[5],tC=tT[6],tN=tT[8],t$=tT[9],td=tT[10],tJ=ta[0]=Math.sqrt(tW*tW+tM*tM+tE*tE),tx=ta[1]=Math.sqrt(tI*tI+tO*tO+tC*tC),tj=ta[2]=Math.sqrt(tN*tN+t$*t$+td*td);if(tDY.isZero(tJ)||tDY.isZero(tx)||tDY.isZero(tj))return ts[1]=ts[2]=ts[3]=ts[4]=ts[6]=ts[7]=ts[8]=ts[9]=ts[11]=ts[12]=ts[13]=ts[14]=0,ts[0]=ts[5]=ts[10]=ts[15]=1,!1;var tZ=tq._tempVector0,tp=tZ.elements;tp[0]=tN/tj,tp[1]=t$/tj,tp[2]=td/tj;var tl=tq._tempVector1,tt=tl.elements;tt[0]=tW/tJ,tt[1]=tM/tJ,tt[2]=tE/tJ;var t_=tq._tempVector2;tEY.cross(tZ,tl,t_);var tA=tq._tempVector1;return tEY.cross(t_,tZ,tA),ts[3]=ts[7]=ts[11]=ts[12]=ts[13]=ts[14]=0,ts[15]=1,ts[0]=tA.x,ts[1]=tA.y,ts[2]=tA.z,ts[4]=t_.x,ts[5]=t_.y,ts[6]=t_.z,ts[8]=tZ.x,ts[9]=tZ.y,ts[10]=tZ.z,ts[0]*tW+ts[1]*tM+ts[2]*tE<0&&(ta[0]=-tJ),ts[4]*tI+ts[5]*tO+ts[6]*tC<0&&(ta[1]=-tx),ts[8]*tN+ts[9]*t$+ts[10]*td<0&&(ta[2]=-tj),!0},tD.decomposeYawPitchRoll=function(tD){var tY=tD.elements,tg=Math.asin(-this.elements[9]);tY[1]=tg,Math.cos(tg)>tDY.zeroTolerance?(tY[2]=Math.atan2(this.elements[1],this.elements[5]),tY[0]=Math.atan2(this.elements[8],this.elements[10])):(tY[2]=Math.atan2(-this.elements[4],this.elements[0]),tY[0]=0)},tD.normalize=function(){var tD=this.elements,tY=tD[0],tg=tD[1],tT=tD[2],tr=Math.sqrt(tY*tY+tg*tg+tT*tT);if(!tr)return tD[0]=0,tD[1]=0,void(tD[2]=0);1!=tr&&(tr=1/tr,tD[0]=tY*tr,tD[1]=tg*tr,tD[2]=tT*tr)},tD.transpose=function(){var tD,tY;return tY=(tD=this.elements)[1],tD[1]=tD[4],tD[4]=tY,tY=tD[2],tD[2]=tD[8],tD[8]=tY,tY=tD[3],tD[3]=tD[12],tD[12]=tY,tY=tD[6],tD[6]=tD[9],tD[9]=tY,tY=tD[7],tD[7]=tD[13],tD[13]=tY,tY=tD[11],tD[11]=tD[14],tD[14]=tY,this},tD.invert=function(tD){var tY=this.elements,tg=tD.elements,tT=tY[0],tr=tY[1],ts=tY[2],ta=tY[3],tW=tY[4],tM=tY[5],tE=tY[6],tI=tY[7],tO=tY[8],tC=tY[9],tN=tY[10],t$=tY[11],td=tY[12],tJ=tY[13],tx=tY[14],tj=tY[15],tZ=tT*tM-tr*tW,tp=tT*tE-ts*tW,tl=tT*tI-ta*tW,tt=tr*tE-ts*tM,t_=tr*tI-ta*tM,tA=ts*tI-ta*tE,tq=tO*tJ-tC*td,tb=tO*tx-tN*td,tG=tO*tj-t$*td,tX=tC*tx-tN*tJ,tz=tC*tj-t$*tJ,tm=tN*tj-t$*tx,th=tZ*tm-tp*tz+tl*tX+tt*tG-t_*tb+tA*tq;0!==Math.abs(th)&&(th=1/th,tg[0]=(tM*tm-tE*tz+tI*tX)*th,tg[1]=(ts*tz-tr*tm-ta*tX)*th,tg[2]=(tJ*tA-tx*t_+tj*tt)*th,tg[3]=(tN*t_-tC*tA-t$*tt)*th,tg[4]=(tE*tG-tW*tm-tI*tb)*th,tg[5]=(tT*tm-ts*tG+ta*tb)*th,tg[6]=(tx*tl-td*tA-tj*tp)*th,tg[7]=(tO*tA-tN*tl+t$*tp)*th,tg[8]=(tW*tz-tM*tG+tI*tq)*th,tg[9]=(tr*tG-tT*tz-ta*tq)*th,tg[10]=(td*t_-tJ*tl+tj*tZ)*th,tg[11]=(tC*tl-tO*t_-t$*tZ)*th,tg[12]=(tM*tb-tW*tX-tE*tq)*th,tg[13]=(tT*tX-tr*tb+ts*tq)*th,tg[14]=(tJ*tp-td*tt-tx*tZ)*th,tg[15]=(tO*tt-tC*tp+tN*tZ)*th)},tD.identity=function(){var tD=this.elements;tD[1]=tD[2]=tD[3]=tD[4]=tD[6]=tD[7]=tD[8]=tD[9]=tD[11]=tD[12]=tD[13]=tD[14]=0,tD[0]=tD[5]=tD[10]=tD[15]=1},tD.cloneTo=function(tD){var tY,tg,tT;if((tg=this.elements)!==(tT=tD.elements))for(tY=0;tY<16;++tY)tT[tY]=tg[tY]},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tD.getTranslationVector=function(tD){var tY=this.elements,tg=tD.elements;tg[0]=tY[12],tg[1]=tY[13],tg[2]=tY[14]},tD.setTranslationVector=function(tD){var tY=this.elements,tg=tD.elements;tY[12]=tg[0],tY[13]=tg[1],tY[14]=tg[2]},tD.getForward=function(tD){var tY=this.elements,tg=tD.elements;tg[0]=-tY[8],tg[1]=-tY[9],tg[2]=-tY[10]},tD.setForward=function(tD){var tY=this.elements,tg=tD.elements;tY[8]=-tg[0],tY[9]=-tg[1],tY[10]=-tg[2]},tq.createRotationX=function(tD,tY){var tg=tY.elements,tT=Math.sin(tD),tr=Math.cos(tD);tg[1]=tg[2]=tg[3]=tg[4]=tg[7]=tg[8]=tg[11]=tg[12]=tg[13]=tg[14]=0,tg[0]=tg[15]=1,tg[5]=tg[10]=tr,tg[6]=tT,tg[9]=-tT},tq.createRotationY=function(tD,tY){var tg=tY.elements,tT=Math.sin(tD),tr=Math.cos(tD);tg[1]=tg[3]=tg[4]=tg[6]=tg[7]=tg[9]=tg[11]=tg[12]=tg[13]=tg[14]=0,tg[5]=tg[15]=1,tg[0]=tg[10]=tr,tg[2]=-tT,tg[8]=tT},tq.createRotationZ=function(tD,tY){var tg=tY.elements,tT=Math.sin(tD),tr=Math.cos(tD);tg[2]=tg[3]=tg[6]=tg[7]=tg[8]=tg[9]=tg[11]=tg[12]=tg[13]=tg[14]=0,tg[10]=tg[15]=1,tg[0]=tg[5]=tr,tg[1]=tT,tg[4]=-tT},tq.createRotationYawPitchRoll=function(tD,tY,tg,tT){tsY.createFromYawPitchRoll(tD,tY,tg,tq._tempQuaternion),tq.createRotationQuaternion(tq._tempQuaternion,tT)},tq.createRotationAxis=function(tD,tY,tg){var tT=tD.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=Math.cos(tY),tM=Math.sin(tY),tE=tr*tr,tI=ts*ts,tO=ta*ta,tC=tr*ts,tN=tr*ta,t$=ts*ta,td=tg.elements;td[3]=td[7]=td[11]=td[12]=td[13]=td[14]=0,td[15]=1,td[0]=tE+tW*(1-tE),td[1]=tC-tW*tC+tM*ta,td[2]=tN-tW*tN-tM*ts,td[4]=tC-tW*tC-tM*ta,td[5]=tI+tW*(1-tI),td[6]=t$-tW*t$+tM*tr,td[8]=tN-tW*tN+tM*ts,td[9]=t$-tW*t$-tM*tr,td[10]=tO+tW*(1-tO)},tq.createRotationQuaternion=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tg[0],ts=tg[1],ta=tg[2],tW=tg[3],tM=tr*tr,tE=ts*ts,tI=ta*ta,tO=tr*ts,tC=ta*tW,tN=ta*tr,t$=ts*tW,td=ts*ta,tJ=tr*tW;tT[3]=tT[7]=tT[11]=tT[12]=tT[13]=tT[14]=0,tT[15]=1,tT[0]=1-2*(tE+tI),tT[1]=2*(tO+tC),tT[2]=2*(tN-t$),tT[4]=2*(tO-tC),tT[5]=1-2*(tI+tM),tT[6]=2*(td+tJ),tT[8]=2*(tN+t$),tT[9]=2*(td-tJ),tT[10]=1-2*(tE+tM)},tq.createTranslate=function(tD,tY){var tg=tD.elements,tT=tY.elements;tT[4]=tT[8]=tT[1]=tT[9]=tT[2]=tT[6]=tT[3]=tT[7]=tT[11]=0,tT[0]=tT[5]=tT[10]=tT[15]=1,tT[12]=tg[0],tT[13]=tg[1],tT[14]=tg[2]},tq.createScaling=function(tD,tY){var tg=tD.elements,tT=tY.elements;tT[0]=tg[0],tT[5]=tg[1],tT[10]=tg[2],tT[1]=tT[4]=tT[8]=tT[12]=tT[9]=tT[13]=tT[2]=tT[6]=tT[14]=tT[3]=tT[7]=tT[11]=0,tT[15]=1},tq.multiply=function(tD,tY,tg){var tT,tr,ts,ta,tW,tM,tE,tI;for(tr=tg.elements,ts=tD.elements,tr===(ta=tY.elements)&&(ta=ta.slice()),tT=0;tT<4;tT++)tW=ts[tT],tM=ts[tT+4],tE=ts[tT+8],tI=ts[tT+12],tr[tT]=tW*ta[0]+tM*ta[1]+tE*ta[2]+tI*ta[3],tr[tT+4]=tW*ta[4]+tM*ta[5]+tE*ta[6]+tI*ta[7],tr[tT+8]=tW*ta[8]+tM*ta[9]+tE*ta[10]+tI*ta[11],tr[tT+12]=tW*ta[12]+tM*ta[13]+tE*ta[14]+tI*ta[15]},tq.createFromQuaternion=function(tD,tY){var tg=tY.elements,tT=tD.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=tT[3],tM=tr+tr,tE=ts+ts,tI=ta+ta,tO=tr*tM,tC=ts*tM,tN=ts*tE,t$=ta*tM,td=ta*tE,tJ=ta*tI,tx=tW*tM,tj=tW*tE,tZ=tW*tI;tg[0]=1-tN-tJ,tg[1]=tC+tZ,tg[2]=t$-tj,tg[3]=0,tg[4]=tC-tZ,tg[5]=1-tO-tJ,tg[6]=td+tx,tg[7]=0,tg[8]=t$+tj,tg[9]=td-tx,tg[10]=1-tO-tN,tg[11]=0,tg[12]=0,tg[13]=0,tg[14]=0,tg[15]=1},tq.createAffineTransformation=function(tD,tY,tg,tT){var tr=tD.elements,ts=tY.elements,ta=tg.elements,tW=tT.elements,tM=ts[0],tE=ts[1],tI=ts[2],tO=ts[3],tC=tM+tM,tN=tE+tE,t$=tI+tI,td=tM*tC,tJ=tM*tN,tx=tM*t$,tj=tE*tN,tZ=tE*t$,tp=tI*t$,tl=tO*tC,tt=tO*tN,t_=tO*t$,tA=ta[0],tq=ta[1],tb=ta[2];tW[0]=(1-(tj+tp))*tA,tW[1]=(tJ+t_)*tA,tW[2]=(tx-tt)*tA,tW[3]=0,tW[4]=(tJ-t_)*tq,tW[5]=(1-(td+tp))*tq,tW[6]=(tZ+tl)*tq,tW[7]=0,tW[8]=(tx+tt)*tb,tW[9]=(tZ-tl)*tb,tW[10]=(1-(td+tj))*tb,tW[11]=0,tW[12]=tr[0],tW[13]=tr[1],tW[14]=tr[2],tW[15]=1},tq.createLookAt=function(tD,tY,tg,tT){var tr=tT.elements,ts=tq._tempVector0,ta=tq._tempVector1,tW=tq._tempVector2;tEY.subtract(tD,tY,tW),tEY.normalize(tW,tW),tEY.cross(tg,tW,ts),tEY.normalize(ts,ts),tEY.cross(tW,ts,ta),tT.identity(),tr[0]=ts.x,tr[4]=ts.y,tr[8]=ts.z,tr[1]=ta.x,tr[5]=ta.y,tr[9]=ta.z,tr[2]=tW.x,tr[6]=tW.y,tr[10]=tW.z,tr[12]=-tEY.dot(ts,tD),tr[13]=-tEY.dot(ta,tD),tr[14]=-tEY.dot(tW,tD)},tq.createPerspective=function(tD,tY,tg,tT,tr){var ts=tr.elements,ta=1/Math.tan(tD/2),tW=1/(tg-tT);ts[0]=ta/tY,ts[5]=ta,ts[10]=(tT+tg)*tW,ts[11]=-1,ts[14]=2*tT*tg*tW,ts[1]=ts[2]=ts[3]=ts[4]=ts[6]=ts[7]=ts[8]=ts[9]=ts[12]=ts[13]=ts[15]=0},tq.createOrthoOffCenterRH=function(tD,tY,tg,tT,tr,ts,ta){var tW=ta.elements,tM=1/(tD-tY),tE=1/(tg-tT),tI=1/(tr-ts);tW[1]=tW[2]=tW[3]=tW[4]=tW[6]=tW[7]=tW[8]=tW[9]=tW[11]=0,tW[15]=1,tW[0]=-2*tM,tW[5]=-2*tE,tW[10]=2*tI,tW[12]=(tD+tY)*tM,tW[13]=(tT+tg)*tE,tW[14]=(ts+tr)*tI},tq.translation=function(tD,tY){var tg=tD.elements,tT=tY.elements;tT[0]=tT[5]=tT[10]=tT[15]=1,tT[12]=tg[0],tT[13]=tg[1],tT[14]=tg[2]},tO(tq,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new tq},"_tempVector0",function(){return this._tempVector0=new tEY},"_tempVector1",function(){return this._tempVector1=new tEY},"_tempVector2",function(){return this._tempVector2=new tEY},"_tempQuaternion",function(){return this._tempQuaternion=new tsY},"DEFAULT",function(){return this.DEFAULT=new tq},"ZERO",function(){return this.ZERO=new tq(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),tq}(),tTY=function(){function tZ(tD,tY){this.extents=null,this.transformation=null,this.extents=tD,this.transformation=tY}tN(tZ,"laya.d3.math.OrientedBoundBox");var tD=tZ.prototype;return tD.getCorners=function(tD){var tY=tZ._tempV30.elements,tg=tZ._tempV31.elements,tT=tZ._tempV32.elements,tr=this.extents.elements;tY[0]=tr[0],tY[1]=tY[2]=0,tg[1]=tr[1],tg[0]=tg[2]=0,tT[2]=tr[2],tT[0]=tT[1]=0,tEY.TransformNormal(tZ._tempV30,this.transformation,tZ._tempV30),tEY.TransformNormal(tZ._tempV31,this.transformation,tZ._tempV31),tEY.TransformNormal(tZ._tempV32,this.transformation,tZ._tempV32);var ts=tZ._tempV33;this.transformation.getTranslationVector(ts),tD.length=8,tEY.add(ts,tZ._tempV30,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV32,tD[0]),tEY.add(ts,tZ._tempV30,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV32,tD[1]),tEY.subtract(ts,tZ._tempV30,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV32,tD[2]),tEY.subtract(ts,tZ._tempV30,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV32,tD[3]),tEY.add(ts,tZ._tempV30,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV32,tD[4]),tEY.add(ts,tZ._tempV30,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV32,tD[5]),tEY.subtract(ts,tZ._tempV30,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV32,tD[6]),tEY.subtract(ts,tZ._tempV30,tZ._tempV34),tEY.subtract(tZ._tempV34,tZ._tempV31,tZ._tempV34),tEY.add(tZ._tempV34,tZ._tempV32,tD[7])},tD.transform=function(tD){tgY.multiply(this.transformation,tD,this.transformation)},tD.scale=function(tD){tEY.multiply(this.extents,tD,this.extents)},tD.translate=function(tD){this.transformation.getTranslationVector(tZ._tempV30),tEY.add(tZ._tempV30,tD,tZ._tempV31),this.transformation.setTranslationVector(tZ._tempV31)},tD.Size=function(tD){tEY.scale(this.extents,2,tD)},tD.getSize=function(tD){var tY=this.extents.elements;tZ._tempV30.x=tY[0],tZ._tempV31.y=tY[1],tZ._tempV32.z=tY[2],tEY.TransformNormal(tZ._tempV30,this.transformation,tZ._tempV30),tEY.TransformNormal(tZ._tempV31,this.transformation,tZ._tempV31),tEY.TransformNormal(tZ._tempV31,this.transformation,tZ._tempV32);var tg=tD.elements;tg[0]=tEY.scalarLength(tZ._tempV30),tg[1]=tEY.scalarLength(tZ._tempV31),tg[2]=tEY.scalarLength(tZ._tempV32)},tD.getSizeSquared=function(tD){var tY=this.extents.elements;tZ._tempV30.x=tY[0],tZ._tempV31.y=tY[1],tZ._tempV32.z=tY[2],tEY.TransformNormal(tZ._tempV30,this.transformation,tZ._tempV30),tEY.TransformNormal(tZ._tempV31,this.transformation,tZ._tempV31),tEY.TransformNormal(tZ._tempV31,this.transformation,tZ._tempV32);var tg=tD.elements;tg[0]=tEY.scalarLengthSquared(tZ._tempV30),tg[1]=tEY.scalarLengthSquared(tZ._tempV31),tg[2]=tEY.scalarLengthSquared(tZ._tempV32)},tD.getCenter=function(tD){this.transformation.getTranslationVector(tD)},tD.containsPoint=function(tD){var tY=this.extents.elements,tg=tY[0],tT=tY[1],tr=tY[2];this.transformation.invert(tZ._tempM0),tEY.transformCoordinate(tD,tZ._tempM0,tZ._tempV30);var ts=tZ._tempV30.elements,ta=Math.abs(ts[0]),tW=Math.abs(ts[1]),tM=Math.abs(ts[2]);return tDY.nearEqual(ta,tg)&&tDY.nearEqual(tW,tT)&&tDY.nearEqual(tM,tr)?2:ta<tg&&tW<tT&&tM<tr?1:0},tD.containsPoints=function(tD){var tY=this.extents.elements,tg=tY[0],tT=tY[1],tr=tY[2];this.transformation.invert(tZ._tempM0);for(var ts=!0,ta=!1,tW=0;tW<tD.length;tW++){tEY.transformCoordinate(tD[tW],tZ._tempM0,tZ._tempV30);var tM=tZ._tempV30.elements,tE=Math.abs(tM[0]),tI=Math.abs(tM[1]),tO=Math.abs(tM[2]);tDY.nearEqual(tE,tg)&&tDY.nearEqual(tI,tT)&&tDY.nearEqual(tO,tr)&&(ta=!0),tE<tg&&tI<tT&&tO<tr?ta=!0:ts=!1}return ts?1:ta?2:0},tD.containsSphere=function(tD,tY){void 0===tY&&(tY=!1);var tg=this.extents.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tD.radius;this.transformation.invert(tZ._tempM0),tEY.transformCoordinate(tD.center,tZ._tempM0,tZ._tempV30);var tW=NaN;if(tW=tY?ta:(tEY.scale(tEY.UnitX,ta,tZ._tempV31),tEY.TransformNormal(tZ._tempV31,tZ._tempM0,tZ._tempV31),tEY.scalarLength(tZ._tempV31)),tEY.scale(this.extents,-1,tZ._tempV32),tEY.Clamp(tZ._tempV30,tZ._tempV32,this.extents,tZ._tempV33),tW*tW<tEY.distanceSquared(tZ._tempV30,tZ._tempV33))return 0;var tM=tZ._tempV30.elements,tE=tM[0],tI=tM[1],tO=tM[2],tC=tZ._tempV32.elements,tN=tC[0],t$=tC[1],td=tC[2];return tN+tW<=tE&&tE<=tT-tW&&tW<tT-tN&&t$+tW<=tI&&tI<=tr-tW&&tW<tr-t$&&td+tW<=tO&&tO<=ts-tW&&tW<ts-td?1:2},tD.containsOrientedBoundBox=function(tD){var tY=0,tg=0;tD.getCorners(tZ._corners);var tT=this.containsPoints(tZ._corners);if(0!=tT)return tT;var tr=this.extents.elements;tD.extents.cloneTo(tZ._tempV35);var ts=tZ._tempV35.elements;tZ._getRows(this.transformation,tZ._rows1),tZ._getRows(tD.transformation,tZ._rows2);var ta=NaN;for(tY=0;tY<4;tY++)for(tg=0;tg<4;tg++)3==tY||3==tg?(tZ._tempM0.setElementByRowColumn(tY,tg,0),tZ._tempM1.setElementByRowColumn(tY,tg,0)):(ta=tEY.dot(tZ._rows1[tY],tZ._rows2[tg]),tZ._tempM0.setElementByRowColumn(tY,tg,ta),tZ._tempM1.setElementByRowColumn(tY,tg,Math.abs(ta)));tD.getCenter(tZ._tempV34),this.getCenter(tZ._tempV36),tEY.subtract(tZ._tempV34,tZ._tempV36,tZ._tempV30);var tW=tZ._tempV31.elements;tW[0]=tEY.dot(tZ._tempV30,tZ._rows1[0]),tW[1]=tEY.dot(tZ._tempV30,tZ._rows1[1]),tW[2]=tEY.dot(tZ._tempV30,tZ._rows1[2]);var tM=tZ._tempV32.elements,tE=tZ._tempV33.elements;for(tY=0;tY<3;tY++)if(tM[0]=tZ._tempM1.getElementByRowColumn(tY,0),tM[1]=tZ._tempM1.getElementByRowColumn(tY,1),tM[2]=tZ._tempM1.getElementByRowColumn(tY,2),tr[tY]+tEY.dot(tZ._tempV35,tZ._tempV32)<Math.abs(tW[tY]))return 0;for(tg=0;tg<3;tg++)if(tM[0]=tZ._tempM1.getElementByRowColumn(0,tg),tM[1]=tZ._tempM1.getElementByRowColumn(1,tg),tM[2]=tZ._tempM1.getElementByRowColumn(2,tg),tE[0]=tZ._tempM0.getElementByRowColumn(0,tg),tE[1]=tZ._tempM0.getElementByRowColumn(1,tg),tE[2]=tZ._tempM0.getElementByRowColumn(2,tg),tEY.dot(this.extents,tZ._tempV32)+ts[tg]<Math.abs(tEY.dot(tZ._tempV31,tZ._tempV33)))return 0;for(tY=0;tY<3;tY++)for(tg=0;tg<3;tg++){var tI=(tY+1)%3,tO=(tY+2)%3,tC=(tg+1)%3,tN=(tg+2)%3;if(tr[tI]*tZ._tempM1.getElementByRowColumn(tO,tg)+tr[tO]*tZ._tempM1.getElementByRowColumn(tI,tg)+(ts[tC]*tZ._tempM1.getElementByRowColumn(tY,tN)+ts[tN]*tZ._tempM1.getElementByRowColumn(tY,tC))<Math.abs(tW[tO]*tZ._tempM0.getElementByRowColumn(tI,tg)-tW[tI]*tZ._tempM0.getElementByRowColumn(tO,tg)))return 0}return 2},tD.containsLine=function(tD,tY){tZ._corners[0]=tD,tZ._corners[1]=tY;var tg=this.containsPoints(tZ._corners);if(0!=tg)return tg;var tT=this.extents.elements,tr=tT[0],ts=tT[1],ta=tT[2];this.transformation.invert(tZ._tempM0),tEY.transformCoordinate(tD,tZ._tempM0,tZ._tempV30),tEY.transformCoordinate(tY,tZ._tempM0,tZ._tempV31),tEY.add(tZ._tempV30,tZ._tempV31,tZ._tempV32),tEY.scale(tZ._tempV32,.5,tZ._tempV32),tEY.subtract(tZ._tempV30,tZ._tempV32,tZ._tempV33);var tW=tZ._tempV33.elements,tM=tW[0],tE=tW[1],tI=tW[2],tO=tZ._tempV34.elements,tC=tO[0]=Math.abs(tW[0]),tN=tO[1]=Math.abs(tW[1]),t$=tO[2]=Math.abs(tW[2]),td=tZ._tempV32.elements,tJ=td[0],tx=td[1],tj=td[2];return Math.abs(tJ)>tr+tC?0:Math.abs(tx)>ts+tN?0:Math.abs(tj)>ta+t$?0:Math.abs(tx*tI-tj*tE)>ts*t$+ta*tN?0:Math.abs(tJ*tI-tj*tM)>tr*t$+ta*tC?0:Math.abs(tJ*tE-tx*tM)>tr*tN+ts*tC?0:2},tD.containsBoundBox=function(tD){var tY=0,tg=0,tT=tD.min,tr=tD.max;tD.getCorners(tZ._corners);var ts=this.containsPoints(tZ._corners);if(0!=ts)return ts;tEY.subtract(tr,tT,tZ._tempV30),tEY.scale(tZ._tempV30,.5,tZ._tempV30),tEY.add(tT,tZ._tempV30,tZ._tempV30),tEY.subtract(tr,tZ._tempV30,tZ._tempV31);var ta=this.extents.elements,tW=tZ._tempV31.elements;tZ._getRows(this.transformation,tZ._rows1),this.transformation.invert(tZ._tempM0);for(tY=0;tY<3;tY++)for(tg=0;tg<3;tg++)tZ._tempM1.setElementByRowColumn(tY,tg,Math.abs(tZ._tempM0.getElementByRowColumn(tY,tg)));this.getCenter(tZ._tempV35),tEY.subtract(tZ._tempV30,tZ._tempV35,tZ._tempV32);var tM=tZ._tempV31.elements;tM[0]=tEY.dot(tZ._tempV32,tZ._rows1[0]),tM[1]=tEY.dot(tZ._tempV32,tZ._rows1[1]),tM[2]=tEY.dot(tZ._tempV32,tZ._rows1[2]);var tE=tZ._tempV33.elements,tI=tZ._tempV34.elements;for(tY=0;tY<3;tY++)if(tE[0]=tZ._tempM1.getElementByRowColumn(tY,0),tE[1]=tZ._tempM1.getElementByRowColumn(tY,1),tE[2]=tZ._tempM1.getElementByRowColumn(tY,2),ta[tY]+tEY.dot(tZ._tempV31,tZ._tempV33)<Math.abs(tM[tY]))return 0;for(tg=0;tg<3;tg++)if(tE[0]=tZ._tempM1.getElementByRowColumn(0,tg),tE[1]=tZ._tempM1.getElementByRowColumn(1,tg),tE[2]=tZ._tempM1.getElementByRowColumn(2,tg),tI[0]=tZ._tempM0.getElementByRowColumn(0,tg),tI[1]=tZ._tempM0.getElementByRowColumn(1,tg),tI[2]=tZ._tempM0.getElementByRowColumn(2,tg),tEY.dot(this.extents,tZ._tempV33)+tW[tg]<Math.abs(tEY.dot(tZ._tempV31,tZ._tempV34)))return 0;for(tY=0;tY<3;tY++)for(tg=0;tg<3;tg++){var tO=(tY+1)%3,tC=(tY+2)%3,tN=(tg+1)%3,t$=(tg+2)%3;if(ta[tO]*tZ._tempM1.getElementByRowColumn(tC,tg)+ta[tC]*tZ._tempM1.getElementByRowColumn(tO,tg)+(tW[tN]*tZ._tempM1.getElementByRowColumn(tY,t$)+tW[t$]*tZ._tempM1.getElementByRowColumn(tY,tN))<Math.abs(tM[tC]*tZ._tempM0.getElementByRowColumn(tO,tg)-tM[tO]*tZ._tempM0.getElementByRowColumn(tC,tg)))return 0}return 2},tD.intersectsRay=function(tD,tY){tEY.scale(this.extents,-1,tZ._tempV30),this.transformation.invert(tZ._tempM0),tEY.TransformNormal(tD.direction,tZ._tempM0,tZ._ray.direction),tEY.transformCoordinate(tD.origin,tZ._tempM0,tZ._ray.origin),tZ._boxBound1.min=tZ._tempV30,tZ._boxBound1.max=this.extents;var tg=tnD.intersectsRayAndBoxRP(tZ._ray,tZ._boxBound1,tY);return-1!==tg&&tEY.transformCoordinate(tY,this.transformation,tY),tg},tD._getLocalCorners=function(tD){tD.length=8;var tY=this.extents.elements;tZ._tempV30.x=tY[0],tZ._tempV31.y=tY[1],tZ._tempV32.z=tY[2],tEY.add(tZ._tempV30,tZ._tempV31,tZ._tempV33),tEY.add(tZ._tempV33,tZ._tempV32,tD[0]),tEY.add(tZ._tempV30,tZ._tempV31,tZ._tempV33),tEY.subtract(tZ._tempV33,tZ._tempV32,tD[1]),tEY.subtract(tZ._tempV31,tZ._tempV30,tZ._tempV33),tEY.subtract(tZ._tempV33,tZ._tempV30,tD[2]),tEY.subtract(tZ._tempV31,tZ._tempV30,tZ._tempV33),tEY.add(tZ._tempV33,tZ._tempV32,tD[3]),tEY.subtract(tZ._tempV30,tZ._tempV31,tZ._tempV33),tEY.add(tZ._tempV33,tZ._tempV32,tD[4]),tEY.subtract(tZ._tempV30,tZ._tempV31,tZ._tempV33),tEY.subtract(tZ._tempV33,tZ._tempV32,tD[5]),tEY.scale(tD[0],-1,tD[6]),tEY.subtract(tZ._tempV32,tZ._tempV30,tZ._tempV33),tEY.subtract(tZ._tempV33,tZ._tempV31,tD[7])},tD.equals=function(tD){return this.extents==tD.extents&&this.transformation==tD.transformation},tD.cloneTo=function(tD){var tY=tD;this.extents.cloneTo(tY.extents),this.transformation.cloneTo(tY.transformation)},tZ.createByBoundBox=function(tD,tY){var tg=tD.min,tT=tD.max;tEY.subtract(tT,tg,tZ._tempV30),tEY.scale(tZ._tempV30,.5,tZ._tempV30),tEY.add(tg,tZ._tempV30,tZ._tempV31),tEY.subtract(tT,tZ._tempV31,tZ._tempV32),tgY.translation(tZ._tempV31,tZ._tempM0);var tr=tZ._tempV32.clone(),ts=tZ._tempM0.clone();tY.extents=tr,tY.transformation=ts},tZ.createByMinAndMaxVertex=function(tD,tY){return tEY.subtract(tY,tD,tZ._tempV30),tEY.scale(tZ._tempV30,.5,tZ._tempV30),tEY.add(tD,tZ._tempV30,tZ._tempV31),tEY.subtract(tY,tZ._tempV31,tZ._tempV32),tgY.translation(tZ._tempV31,tZ._tempM0),new tZ(tZ._tempV32,tZ._tempM0)},tZ._getRows=function(tD,tY){tY.length=3;var tg=tD.elements,tT=tY[0].elements;tT[0]=tg[0],tT[1]=tg[1],tT[2]=tg[2];var tr=tY[1].elements;tr[0]=tg[4],tr[1]=tg[5],tr[2]=tg[6];var ts=tY[2].elements;ts[0]=tg[8],ts[1]=tg[9],ts[2]=tg[10]},tZ.getObbtoObbMatrix4x4=function(tD,tY,tg,tT){var tr=tD.transformation,ts=tY.transformation;if(tg){tZ._getRows(tr,tZ._rows1),tZ._getRows(ts,tZ._rows2);for(var ta=0;ta<3;ta++)for(var tW=0;tW<3;tW++)tT.setElementByRowColumn(ta,tW,tEY.dot(tZ._rows2[ta],tZ._rows1[tW]));tY.getCenter(tZ._tempV30),tD.getCenter(tZ._tempV31),tEY.subtract(tZ._tempV30,tZ._tempV31,tZ._tempV32);var tM=tT.elements;tM[12]=tEY.dot(tZ._tempV32,tZ._rows1[0]),tM[13]=tEY.dot(tZ._tempV32,tZ._rows1[1]),tM[14]=tEY.dot(tZ._tempV32,tZ._rows1[2]),tM[15]=1}else tr.invert(tZ._tempM0),tgY.multiply(ts,tZ._tempM0,tT)},tZ.merge=function(tD,tY,tg){var tT=tD.extents,tr=tD.transformation;tZ.getObbtoObbMatrix4x4(tD,tY,tg,tZ._tempM0),tY._getLocalCorners(tZ._corners),tEY.transformCoordinate(tZ._corners[0],tZ._tempM0,tZ._corners[0]),tEY.transformCoordinate(tZ._corners[1],tZ._tempM0,tZ._corners[1]),tEY.transformCoordinate(tZ._corners[2],tZ._tempM0,tZ._corners[2]),tEY.transformCoordinate(tZ._corners[3],tZ._tempM0,tZ._corners[3]),tEY.transformCoordinate(tZ._corners[4],tZ._tempM0,tZ._corners[4]),tEY.transformCoordinate(tZ._corners[5],tZ._tempM0,tZ._corners[5]),tEY.transformCoordinate(tZ._corners[6],tZ._tempM0,tZ._corners[6]),tEY.transformCoordinate(tZ._corners[7],tZ._tempM0,tZ._corners[7]),tEY.scale(tT,-1,tZ._boxBound1.min),tT.cloneTo(tZ._boxBound1.max),tLD.createfromPoints(tZ._corners,tZ._boxBound2),tLD.merge(tZ._boxBound2,tZ._boxBound1,tZ._boxBound3);var ts=tZ._boxBound3.min,ta=tZ._boxBound3.max;tEY.subtract(ta,ts,tZ._tempV30),tEY.scale(tZ._tempV30,.5,tZ._tempV30),tEY.add(ts,tZ._tempV30,tZ._tempV32),tEY.subtract(ta,tZ._tempV32,tT),tEY.transformCoordinate(tZ._tempV32,tr,tZ._tempV33)},tO(tZ,["_tempV30",function(){return this._tempV30=new tEY},"_tempV31",function(){return this._tempV31=new tEY},"_tempV32",function(){return this._tempV32=new tEY},"_tempV33",function(){return this._tempV33=new tEY},"_tempV34",function(){return this._tempV34=new tEY},"_tempV35",function(){return this._tempV35=new tEY},"_tempV36",function(){return this._tempV36=new tEY},"_tempM0",function(){return this._tempM0=new tgY},"_tempM1",function(){return this._tempM1=new tgY},"_corners",function(){return this._corners=[new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY]},"_rows1",function(){return this._rows1=[new tEY,new tEY,new tEY]},"_rows2",function(){return this._rows2=[new tEY,new tEY,new tEY]},"_ray",function(){return this._ray=new tWY(new tEY,new tEY)},"_boxBound1",function(){return this._boxBound1=new tLD(new tEY,new tEY)},"_boxBound2",function(){return this._boxBound2=new tLD(new tEY,new tEY)},"_boxBound3",function(){return this._boxBound3=new tLD(new tEY,new tEY)}]),tZ}(),trY=function(){function tl(tD,tY){this.normal=null,this.distance=NaN,void 0===tY&&(tY=0),this.normal=tD,this.distance=tY}return tN(tl,"laya.d3.math.Plane"),tl.prototype.normalize=function(){var tD=this.normal.elements,tY=tD[0],tg=tD[1],tT=tD[2],tr=1/Math.sqrt(tY*tY+tg*tg+tT*tT);tD[0]=tY*tr,tD[1]=tg*tr,tD[2]=tT*tr,this.distance*=tr},tl.createPlaneBy3P=function(tD,tY,tg){var tT=tD.elements,tr=tY.elements,ts=tg.elements,ta=tr[0]-tT[0],tW=tr[1]-tT[1],tM=tr[2]-tT[2],tE=ts[0]-tT[0],tI=ts[1]-tT[1],tO=ts[2]-tT[2],tC=tW*tO-tM*tI,tN=tM*tE-ta*tO,t$=ta*tI-tW*tE,td=1/Math.sqrt(tC*tC+tN*tN+t$*t$),tJ=tC*td,tx=tN*td,tj=t$*td,tZ=tl._TEMPVec3.elements;tZ[0]=tJ,tZ[1]=tx,tZ[2]=tj;var tp=-(tJ*tT[0]+tx*tT[1]+tj*tT[2]);return new tl(tl._TEMPVec3,tp)},tl.PlaneIntersectionType_Back=0,tl.PlaneIntersectionType_Front=1,tl.PlaneIntersectionType_Intersecting=2,tO(tl,["_TEMPVec3",function(){return this._TEMPVec3=new tEY}]),tl}(),tsY=function(){function tr(tD,tY,tg,tT){this.elements=new Float32Array(4),void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=1),this.elements[0]=tD,this.elements[1]=tY,this.elements[2]=tg,this.elements[3]=tT}tN(tr,"laya.d3.math.Quaternion");var tD=tr.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.scaling=function(tD,tY){var tg=tY.elements,tT=this.elements;tg[0]=tT[0]*tD,tg[1]=tT[1]*tD,tg[2]=tT[2]*tD,tg[3]=tT[3]*tD},tD.normalize=function(tD){var tY=tD.elements,tg=this.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tg[3],tW=tT*tT+tr*tr+ts*ts+ta*ta;0<tW&&(tW=1/Math.sqrt(tW),tY[0]=tT*tW,tY[1]=tr*tW,tY[2]=ts*tW,tY[3]=ta*tW)},tD.length=function(){var tD=this.elements,tY=tD[0],tg=tD[1],tT=tD[2],tr=tD[3];return Math.sqrt(tY*tY+tg*tg+tT*tT+tr*tr)},tD.rotateX=function(tD,tY){var tg=tY.elements,tT=this.elements;tD*=.5;var tr=tT[0],ts=tT[1],ta=tT[2],tW=tT[3],tM=Math.sin(tD),tE=Math.cos(tD);tg[0]=tr*tE+tW*tM,tg[1]=ts*tE+ta*tM,tg[2]=ta*tE-ts*tM,tg[3]=tW*tE-tr*tM},tD.rotateY=function(tD,tY){var tg=tY.elements,tT=this.elements;tD*=.5;var tr=tT[0],ts=tT[1],ta=tT[2],tW=tT[3],tM=Math.sin(tD),tE=Math.cos(tD);tg[0]=tr*tE-ta*tM,tg[1]=ts*tE+tW*tM,tg[2]=ta*tE+tr*tM,tg[3]=tW*tE-ts*tM},tD.rotateZ=function(tD,tY){var tg=tY.elements,tT=this.elements;tD*=.5;var tr=tT[0],ts=tT[1],ta=tT[2],tW=tT[3],tM=Math.sin(tD),tE=Math.cos(tD);tg[0]=tr*tE+ts*tM,tg[1]=ts*tE-tr*tM,tg[2]=ta*tE+tW*tM,tg[3]=tW*tE-ta*tM},tD.getYawPitchRoll=function(tD){tEY.transformQuat(tEY.ForwardRH,this,tr.TEMPVector31),tEY.transformQuat(tEY.Up,this,tr.TEMPVector32);var tY=tr.TEMPVector32.elements;tr.angleTo(tEY.ZERO,tr.TEMPVector31,tr.TEMPVector33);var tg=tr.TEMPVector33.elements;tg[0]==Math.PI/2?(tg[1]=tr.arcTanAngle(tY[2],tY[0]),tg[2]=0):tg[0]==-Math.PI/2?(tg[1]=tr.arcTanAngle(-tY[2],-tY[0]),tg[2]=0):(tgY.createRotationY(-tg[1],tr.TEMPMatrix0),tgY.createRotationX(-tg[0],tr.TEMPMatrix1),tEY.transformCoordinate(tr.TEMPVector32,tr.TEMPMatrix0,tr.TEMPVector32),tEY.transformCoordinate(tr.TEMPVector32,tr.TEMPMatrix1,tr.TEMPVector32),tg[2]=tr.arcTanAngle(tY[1],-tY[0])),tg[1]<=-Math.PI&&(tg[1]=Math.PI),tg[2]<=-Math.PI&&(tg[2]=Math.PI),tg[1]>=Math.PI&&tg[2]>=Math.PI&&(tg[1]=0,tg[2]=0,tg[0]=Math.PI-tg[0]);var tT=tD.elements;tT[0]=tg[1],tT[1]=tg[0],tT[2]=tg[2]},tD.invert=function(tD){var tY=tD.elements,tg=this.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tg[3],tW=tT*tT+tr*tr+ts*ts+ta*ta,tM=tW?1/tW:0;tY[0]=-tT*tM,tY[1]=-tr*tM,tY[2]=-ts*tM,tY[3]=ta*tM},tD.identity=function(){var tD=this.elements;tD[0]=0,tD[1]=0,tD[2]=0,tD[3]=1},tD.fromArray=function(tD,tY){void 0===tY&&(tY=0),this.elements[0]=tD[tY+0],this.elements[1]=tD[tY+1],this.elements[2]=tD[tY+2],this.elements[3]=tD[tY+3]},tD.cloneTo=function(tD){var tY,tg,tT;if((tg=this.elements)!==(tT=tD.elements))for(tY=0;tY<4;++tY)tT[tY]=tg[tY]},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tD.equals=function(tD){var tY=this.elements,tg=tD.elements;return tDY.nearEqual(tY[0],tg[0])&&tDY.nearEqual(tY[1],tg[1])&&tDY.nearEqual(tY[2],tg[2])&&tDY.nearEqual(tY[3],tg[3])},tD.lengthSquared=function(){var tD=this.elements[0],tY=this.elements[1],tg=this.elements[2],tT=this.elements[3];return tD*tD+tY*tY+tg*tg+tT*tT},t$(0,tD,"x",function(){return this.elements[0]}),t$(0,tD,"y",function(){return this.elements[1]}),t$(0,tD,"z",function(){return this.elements[2]}),t$(0,tD,"w",function(){return this.elements[3]}),tr.createFromYawPitchRoll=function(tD,tY,tg,tT){var tr=.5*tg,ts=.5*tY,ta=.5*tD,tW=Math.sin(tr),tM=Math.cos(tr),tE=Math.sin(ts),tI=Math.cos(ts),tO=Math.sin(ta),tC=Math.cos(ta),tN=tT.elements;tN[0]=tC*tE*tM+tO*tI*tW,tN[1]=tO*tI*tM-tC*tE*tW,tN[2]=tC*tI*tW-tO*tE*tM,tN[3]=tC*tI*tM+tO*tE*tW},tr.multiply=function(tD,tY,tg){var tT=tD.elements,tr=tY.elements,ts=tg.elements,ta=tT[0],tW=tT[1],tM=tT[2],tE=tT[3],tI=tr[0],tO=tr[1],tC=tr[2],tN=tr[3],t$=tW*tC-tM*tO,td=tM*tI-ta*tC,tJ=ta*tO-tW*tI,tx=ta*tI+tW*tO+tM*tC;ts[0]=ta*tN+tI*tE+t$,ts[1]=tW*tN+tO*tE+td,ts[2]=tM*tN+tC*tE+tJ,ts[3]=tE*tN-tx},tr.arcTanAngle=function(tD,tY){return 0==tD?1==tY?Math.PI/2:-Math.PI/2:0<tD?Math.atan(tY/tD):tD<0?0<tY?Math.atan(tY/tD)+Math.PI:Math.atan(tY/tD)-Math.PI:0},tr.angleTo=function(tD,tY,tg){tEY.subtract(tY,tD,tr.TEMPVector30),tEY.normalize(tr.TEMPVector30,tr.TEMPVector30),tg.elements[0]=Math.asin(tr.TEMPVector30.y),tg.elements[1]=tr.arcTanAngle(-tr.TEMPVector30.z,-tr.TEMPVector30.x)},tr.createFromAxisAngle=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements;tY*=.5;var ts=Math.sin(tY);tT[0]=ts*tr[0],tT[1]=ts*tr[1],tT[2]=ts*tr[2],tT[3]=Math.cos(tY)},tr.createFromMatrix3x3=function(tD,tY){var tg,tT=tY.elements,tr=tD.elements,ts=tr[0]+tr[4]+tr[8];if(0<ts)tg=Math.sqrt(ts+1),tT[3]=.5*tg,tg=.5/tg,tT[0]=(tr[5]-tr[7])*tg,tT[1]=(tr[6]-tr[2])*tg,tT[2]=(tr[1]-tr[3])*tg;else{var ta=0;tr[4]>tr[0]&&(ta=1),tr[8]>tr[3*ta+ta]&&(ta=2);var tW=(ta+1)%3,tM=(ta+2)%3;tg=Math.sqrt(tr[3*ta+ta]-tr[3*tW+tW]-tr[3*tM+tM]+1),tT[ta]=.5*tg,tg=.5/tg,tT[3]=(tr[3*tW+tM]-tr[3*tM+tW])*tg,tT[tW]=(tr[3*tW+ta]+tr[3*ta+tW])*tg,tT[tM]=(tr[3*tM+ta]+tr[3*ta+tM])*tg}},tr.createFromMatrix4x4=function(tD,tY){var tg,tT,tr=tD.elements,ts=tY.elements,ta=tr[0]+tr[5]+tr[10];0<ta?(tg=Math.sqrt(ta+1),ts[3]=.5*tg,tg=.5/tg,ts[0]=(tr[6]-tr[9])*tg,ts[1]=(tr[8]-tr[2])*tg,ts[2]=(tr[1]-tr[4])*tg):tr[0]>=tr[5]&&tr[0]>=tr[10]?(tT=.5/(tg=Math.sqrt(1+tr[0]-tr[5]-tr[10])),ts[0]=.5*tg,ts[1]=(tr[1]+tr[4])*tT,ts[2]=(tr[2]+tr[8])*tT,ts[3]=(tr[6]-tr[9])*tT):tr[5]>tr[10]?(tT=.5/(tg=Math.sqrt(1+tr[5]-tr[0]-tr[10])),ts[0]=(tr[4]+tr[1])*tT,ts[1]=.5*tg,ts[2]=(tr[9]+tr[6])*tT,ts[3]=(tr[8]-tr[2])*tT):(tT=.5/(tg=Math.sqrt(1+tr[10]-tr[0]-tr[5])),ts[0]=(tr[8]+tr[2])*tT,ts[1]=(tr[9]+tr[6])*tT,ts[2]=.5*tg,ts[3]=(tr[1]-tr[4])*tT)},tr.slerp=function(tD,tY,tg,tT){var tr,ts,ta,tW,tM,tE=tD.elements,tI=tY.elements,tO=tT.elements,tC=tE[0],tN=tE[1],t$=tE[2],td=tE[3],tJ=tI[0],tx=tI[1],tj=tI[2],tZ=tI[3];return(ts=tC*tJ+tN*tx+t$*tj+td*tZ)<0&&(ts=-ts,tJ=-tJ,tx=-tx,tj=-tj,tZ=-tZ),tM=1e-6<1-ts?(tr=Math.acos(ts),ta=Math.sin(tr),tW=Math.sin((1-tg)*tr)/ta,Math.sin(tg*tr)/ta):(tW=1-tg,tg),tO[0]=tW*tC+tM*tJ,tO[1]=tW*tN+tM*tx,tO[2]=tW*t$+tM*tj,tO[3]=tW*td+tM*tZ,tO},tr.lerp=function(tD,tY,tg,tT){var tr=tT.elements,ts=tD.elements,ta=tY.elements,tW=ts[0],tM=ts[1],tE=ts[2],tI=ts[3];tr[0]=tW+tg*(ta[0]-tW),tr[1]=tM+tg*(ta[1]-tM),tr[2]=tE+tg*(ta[2]-tE),tr[3]=tI+tg*(ta[3]-tI)},tr.add=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]+ts[0],tT[1]=tr[1]+ts[1],tT[2]=tr[2]+ts[2],tT[3]=tr[3]+ts[3]},tr.dot=function(tD,tY){var tg=tD.elements,tT=tY.elements;return tg[0]*tT[0]+tg[1]*tT[1]+tg[2]*tT[2]+tg[3]*tT[3]},tr.rotationLookAt=function(tD,tY,tg){tr.lookAt(tEY.ZERO,tD,tY,tg)},tr.lookAt=function(tD,tY,tg,tT){tYY.lookAt(tD,tY,tg,tr._tempMatrix3x3),tr.rotationMatrix(tr._tempMatrix3x3,tT)},tr.invert=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tD.lengthSquared();tDY.isZero(tr)||(tr=1/tr,tT[0]=-tg[0]*tr,tT[1]=-tg[1]*tr,tT[2]=-tg[2]*tr,tT[3]=tg[3]*tr)},tr.rotationMatrix=function(tD,tY){var tg=tD.elements,tT=tg[0],tr=tg[1],ts=tg[2],ta=tg[3],tW=tg[4],tM=tg[5],tE=tg[6],tI=tg[7],tO=tg[8],tC=tY.elements,tN=NaN,t$=NaN,td=tT+tW+tO;0<td?(tN=Math.sqrt(td+1),tC[3]=.5*tN,tN=.5/tN,tC[0]=(tM-tI)*tN,tC[1]=(tE-ts)*tN,tC[2]=(tr-ta)*tN):tW<=tT&&tO<=tT?(t$=.5/(tN=Math.sqrt(1+tT-tW-tO)),tC[0]=.5*tN,tC[1]=(tr+ta)*t$,tC[2]=(ts+tE)*t$,tC[3]=(tM-tI)*t$):tO<tW?(t$=.5/(tN=Math.sqrt(1+tW-tT-tO)),tC[0]=(ta+tr)*t$,tC[1]=.5*tN,tC[2]=(tI+tM)*t$,tC[3]=(tE-ts)*t$):(t$=.5/(tN=Math.sqrt(1+tO-tT-tW)),tC[0]=(tE+ts)*t$,tC[1]=(tI+tM)*t$,tC[2]=.5*tN,tC[3]=(tr-ta)*t$)},tr.DEFAULT=new tr,tO(tr,["TEMPVector30",function(){return this.TEMPVector30=new tEY},"TEMPVector31",function(){return this.TEMPVector31=new tEY},"TEMPVector32",function(){return this.TEMPVector32=new tEY},"TEMPVector33",function(){return this.TEMPVector33=new tEY},"TEMPMatrix0",function(){return this.TEMPMatrix0=new tgY},"TEMPMatrix1",function(){return this.TEMPMatrix1=new tgY},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new tYY},"NAN",function(){return this.NAN=new tr(NaN,NaN,NaN,NaN)}]),tr}(),taY=function(){function tD(tD){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=tD,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}tN(tD,"laya.d3.math.Rand");var tY=tD.prototype;return tY.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},tY.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},tY.getSignedFloat=function(){return 2*this.getFloat()-1},t$(0,tY,"seed",function(){return this.seeds[0]},function(tD){this.seeds[0]=tD,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),tD.getFloatFromInt=function(tD){return 1/8388607*(8388607&tD)},tD.getByteFromInt=function(tD){return(8388607&tD)>>>15},tD}(),tWY=(function(){function tr(tD){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(tD instanceof Array)||4!==tD.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|tD[0],this._state0L=0|tD[1],this._state1U=0|tD[2],this._state1L=0|tD[3]}tN(tr,"laya.d3.math.RandX");var tD=tr.prototype;tD.randomint=function(){var tD=this._state0U,tY=this._state0L,tg=this._state1U,tT=this._state1L,tr=(tT>>>0)+(tY>>>0),ts=tg+tD+(tr/2>>>31)>>>0,ta=tr>>>0,tW=0,tM=0;tW=(tD^=tW=tD<<23|(-512&tY)>>>9)^(this._state0U=tg),tM=(tY^=tM=tY<<23)^(this._state0L=tT);tW^=tD>>>18,tM^=tY>>>18|(262143&tD)<<14;return tW^=tg>>>5,tM^=tT>>>5|(31&tg)<<27,this._state1U=tW,this._state1L=tM,[ts,ta]},tD.random=function(){var tD=this.randomint(),tY=tD[0],tg=1023<<20|tY>>>12,tT=0|(tD[1]>>>12|(4095&tY)<<20);return tr._CONVERTION_BUFFER.setUint32(0,tg,!1),tr._CONVERTION_BUFFER.setUint32(4,tT,!1),taY._CONVERTION_BUFFER.getFloat64(0,!1)-1},tO(tr,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new taY([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function tD(tD,tY){this.origin=null,this.direction=null,this.origin=tD,this.direction=tY}return tN(tD,"laya.d3.math.Ray"),tD}()),tMY=function(){function tD(tD,tY){this.elements=new Float32Array(2),void 0===tD&&(tD=0),void 0===tY&&(tY=0);var tg=this.elements;tg[0]=tD,tg[1]=tY}tN(tD,"laya.d3.math.Vector2");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.fromArray=function(tD,tY){void 0===tY&&(tY=0),this.elements[0]=tD[tY+0],this.elements[1]=tD[tY+1]},tY.cloneTo=function(tD){var tY=tD.elements,tg=this.elements;tY[0]=tg[0],tY[1]=tg[1]},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"x",function(){return this.elements[0]},function(tD){this.elements[0]=tD}),t$(0,tY,"y",function(){return this.elements[1]},function(tD){this.elements[1]=tD}),tD.scale=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements;tT[0]=tr[0]*tY,tT[1]=tr[1]*tY},tO(tD,["ZERO",function(){return this.ZERO=new tD(0,0)},"ONE",function(){return this.ONE=new tD(1,1)}]),tD}(),tEY=function(){function tI(tD,tY,tg){this.elements=new Float32Array(3),void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0);var tT=this.elements;tT[0]=tD,tT[1]=tY,tT[2]=tg}tN(tI,"laya.d3.math.Vector3");var tD=tI.prototype;return tl.imps(tD,{"laya.d3.core.IClone":!0}),tD.fromArray=function(tD,tY){void 0===tY&&(tY=0),this.elements[0]=tD[tY+0],this.elements[1]=tD[tY+1],this.elements[2]=tD[tY+2]},tD.cloneTo=function(tD){var tY=tD.elements,tg=this.elements;tY[0]=tg[0],tY[1]=tg[1],tY[2]=tg[2]},tD.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tD.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},tD.reset=function(tD,tY,tg){this.elements[0]=tD,this.elements[1]=tY,this.elements[2]=tg},t$(0,tD,"x",function(){return this.elements[0]},function(tD){this.elements[0]=tD}),t$(0,tD,"y",function(){return this.elements[1]},function(tD){this.elements[1]=tD}),t$(0,tD,"z",function(){return this.elements[2]},function(tD){this.elements[2]=tD}),tI.distanceSquared=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tg[0]-tT[0],ts=tg[1]-tT[1],ta=tg[2]-tT[2];return tr*tr+ts*ts+ta*ta},tI.distance=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tg[0]-tT[0],ts=tg[1]-tT[1],ta=tg[2]-tT[2];return Math.sqrt(tr*tr+ts*ts+ta*ta)},tI.min=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=Math.min(tr[0],ts[0]),tT[1]=Math.min(tr[1],ts[1]),tT[2]=Math.min(tr[2],ts[2])},tI.max=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=Math.max(tr[0],ts[0]),tT[1]=Math.max(tr[1],ts[1]),tT[2]=Math.max(tr[2],ts[2])},tI.transformQuat=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements,ta=tr[0],tW=tr[1],tM=tr[2],tE=ts[0],tI=ts[1],tO=ts[2],tC=ts[3],tN=tC*ta+tI*tM-tO*tW,t$=tC*tW+tO*ta-tE*tM,td=tC*tM+tE*tW-tI*ta,tJ=-tE*ta-tI*tW-tO*tM;tT[0]=tN*tC+tJ*-tE+t$*-tO-td*-tI,tT[1]=t$*tC+tJ*-tI+td*-tE-tN*-tO,tT[2]=td*tC+tJ*-tO+tN*-tI-t$*-tE},tI.scalarLength=function(tD){var tY=tD.elements,tg=tY[0],tT=tY[1],tr=tY[2];return Math.sqrt(tg*tg+tT*tT+tr*tr)},tI.scalarLengthSquared=function(tD){var tY=tD.elements,tg=tY[0],tT=tY[1],tr=tY[2];return tg*tg+tT*tT+tr*tr},tI.normalize=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tg[0],ts=tg[1],ta=tg[2],tW=tr*tr+ts*ts+ta*ta;0<tW&&(tW=1/Math.sqrt(tW),tT[0]=tg[0]*tW,tT[1]=tg[1]*tW,tT[2]=tg[2]*tW)},tI.multiply=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]*ts[0],tT[1]=tr[1]*ts[1],tT[2]=tr[2]*ts[2]},tI.scale=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements;tT[0]=tr[0]*tY,tT[1]=tr[1]*tY,tT[2]=tr[2]*tY},tI.lerp=function(tD,tY,tg,tT){var tr=tT.elements,ts=tD.elements,ta=tY.elements,tW=ts[0],tM=ts[1],tE=ts[2];tr[0]=tW+tg*(ta[0]-tW),tr[1]=tM+tg*(ta[1]-tM),tr[2]=tE+tg*(ta[2]-tE)},tI.transformV3ToV3=function(tD,tY,tg){var tT=tI._tempVector4;tI.transformV3ToV4(tD,tY,tT);var tr=tT.elements,ts=tg.elements;ts[0]=tr[0],ts[1]=tr[1],ts[2]=tr[2]},tI.transformV3ToV4=function(tD,tY,tg){var tT=tD.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=tY.elements,tM=tg.elements;tM[0]=tr*tW[0]+ts*tW[4]+ta*tW[8]+tW[12],tM[1]=tr*tW[1]+ts*tW[5]+ta*tW[9]+tW[13],tM[2]=tr*tW[2]+ts*tW[6]+ta*tW[10]+tW[14],tM[3]=tr*tW[3]+ts*tW[7]+ta*tW[11]+tW[15]},tI.TransformNormal=function(tD,tY,tg){var tT=tD.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=tY.elements,tM=tg.elements;tM[0]=tr*tW[0]+ts*tW[4]+ta*tW[8],tM[1]=tr*tW[1]+ts*tW[5]+ta*tW[9],tM[2]=tr*tW[2]+ts*tW[6]+ta*tW[10]},tI.transformCoordinate=function(tD,tY,tg){var tT=tI._tempVector4.elements,tr=tD.elements,ts=tr[0],ta=tr[1],tW=tr[2],tM=tY.elements;tT[0]=ts*tM[0]+ta*tM[4]+tW*tM[8]+tM[12],tT[1]=ts*tM[1]+ta*tM[5]+tW*tM[9]+tM[13],tT[2]=ts*tM[2]+ta*tM[6]+tW*tM[10]+tM[14],tT[3]=1/(ts*tM[3]+ta*tM[7]+tW*tM[11]+tM[15]);var tE=tg.elements;tE[0]=tT[0]*tT[3],tE[1]=tT[1]*tT[3],tE[2]=tT[2]*tT[3]},tI.Clamp=function(tD,tY,tg,tT){var tr=tD.elements,ts=tr[0],ta=tr[1],tW=tr[2],tM=tY.elements,tE=tM[0],tI=tM[1],tO=tM[2],tC=tg.elements,tN=tC[0],t$=tC[1],td=tC[2],tJ=tT.elements;ts=(ts=tN<ts?tN:ts)<tE?tE:ts,ta=(ta=t$<ta?t$:ta)<tI?tI:ta,tW=(tW=td<tW?td:tW)<tO?tO:tW,tJ[0]=ts,tJ[1]=ta,tJ[2]=tW},tI.add=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]+ts[0],tT[1]=tr[1]+ts[1],tT[2]=tr[2]+ts[2]},tI.subtract=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]-ts[0],tT[1]=tr[1]-ts[1],tT[2]=tr[2]-ts[2]},tI.cross=function(tD,tY,tg){var tT=tD.elements,tr=tY.elements,ts=tg.elements,ta=tT[0],tW=tT[1],tM=tT[2],tE=tr[0],tI=tr[1],tO=tr[2];ts[0]=tW*tO-tM*tI,ts[1]=tM*tE-ta*tO,ts[2]=ta*tI-tW*tE},tI.dot=function(tD,tY){var tg=tD.elements,tT=tY.elements;return tg[0]*tT[0]+tg[1]*tT[1]+tg[2]*tT[2]},tI.equals=function(tD,tY){var tg=tD.elements,tT=tY.elements;return tDY.nearEqual(Math.abs(tg[0]),Math.abs(tT[0]))&&tDY.nearEqual(Math.abs(tg[1]),Math.abs(tT[1]))&&tDY.nearEqual(Math.abs(tg[2]),Math.abs(tT[2]))},tI.ZERO=new tI(0,0,0),tI.ONE=new tI(1,1,1),tI.NegativeUnitX=new tI(-1,0,0),tI.UnitX=new tI(1,0,0),tI.UnitY=new tI(0,1,0),tI.UnitZ=new tI(0,0,1),tI.ForwardRH=new tI(0,0,-1),tI.ForwardLH=new tI(0,0,1),tI.Up=new tI(0,1,0),tI.NAN=new tI(NaN,NaN,NaN),tO(tI,["_tempVector4",function(){return this._tempVector4=new tIY}]),tI}(),tIY=function(){function tD(tD,tY,tg,tT){this.elements=new Float32Array(4),void 0===tD&&(tD=0),void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=0);var tr=this.elements;tr[0]=tD,tr[1]=tY,tr[2]=tg,tr[3]=tT}tN(tD,"laya.d3.math.Vector4");var tY=tD.prototype;return tl.imps(tY,{"laya.d3.core.IClone":!0}),tY.fromArray=function(tD,tY){void 0===tY&&(tY=0),this.elements[0]=tD[tY+0],this.elements[1]=tD[tY+1],this.elements[2]=tD[tY+2],this.elements[3]=tD[tY+3]},tY.cloneTo=function(tD){var tY=tD.elements,tg=this.elements;tY[0]=tg[0],tY[1]=tg[1],tY[2]=tg[2],tY[3]=tg[3]},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tY.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},tY.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t$(0,tY,"x",function(){return this.elements[0]},function(tD){this.elements[0]=tD}),t$(0,tY,"y",function(){return this.elements[1]},function(tD){this.elements[1]=tD}),t$(0,tY,"z",function(){return this.elements[2]},function(tD){this.elements[2]=tD}),t$(0,tY,"w",function(){return this.elements[3]},function(tD){this.elements[3]=tD}),tD.lerp=function(tD,tY,tg,tT){var tr=tT.elements,ts=tD.elements,ta=tY.elements,tW=ts[0],tM=ts[1],tE=ts[2],tI=ts[3];tr[0]=tW+tg*(ta[0]-tW),tr[1]=tM+tg*(ta[1]-tM),tr[2]=tE+tg*(ta[2]-tE),tr[3]=tI+tg*(ta[3]-tI)},tD.transformByM4x4=function(tD,tY,tg){var tT=tD.elements,tr=tT[0],ts=tT[1],ta=tT[2],tW=tT[3],tM=tY.elements,tE=tg.elements;tE[0]=tr*tM[0]+ts*tM[4]+ta*tM[8]+tW*tM[12],tE[1]=tr*tM[1]+ts*tM[5]+ta*tM[9]+tW*tM[13],tE[2]=tr*tM[2]+ts*tM[6]+ta*tM[10]+tW*tM[14],tE[3]=tr*tM[3]+ts*tM[7]+ta*tM[11]+tW*tM[15]},tD.equals=function(tD,tY){var tg=tD.elements,tT=tY.elements;return tDY.nearEqual(Math.abs(tg[0]),Math.abs(tT[0]))&&tDY.nearEqual(Math.abs(tg[1]),Math.abs(tT[1]))&&tDY.nearEqual(Math.abs(tg[2]),Math.abs(tT[2]))&&tDY.nearEqual(Math.abs(tg[3]),Math.abs(tT[3]))},tD.normalize=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tD.length();0<tr&&(tT[0]=tg[0]*tr,tT[1]=tg[1]*tr,tT[2]=tg[2]*tr,tT[3]=tg[3]*tr)},tD.add=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]+ts[0],tT[1]=tr[1]+ts[1],tT[2]=tr[2]+ts[2],tT[3]=tr[3]+ts[3]},tD.subtract=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]-ts[0],tT[1]=tr[1]-ts[1],tT[2]=tr[2]-ts[2],tT[3]=tr[3]-ts[3]},tD.multiply=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=tr[0]*ts[0],tT[1]=tr[1]*ts[1],tT[2]=tr[2]*ts[2],tT[3]=tr[3]*ts[3]},tD.scale=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements;tT[0]=tr[0]*tY,tT[1]=tr[1]*tY,tT[2]=tr[2]*tY,tT[3]=tr[3]*tY},tD.Clamp=function(tD,tY,tg,tT){var tr=tD.elements,ts=tr[0],ta=tr[1],tW=tr[2],tM=tr[3],tE=tY.elements,tI=tE[0],tO=tE[1],tC=tE[2],tN=tE[3],t$=tg.elements,td=t$[0],tJ=t$[1],tx=t$[2],tj=t$[3],tZ=tT.elements;ts=(ts=td<ts?td:ts)<tI?tI:ts,ta=(ta=tJ<ta?tJ:ta)<tO?tO:ta,tW=(tW=tx<tW?tx:tW)<tC?tC:tW,tM=(tM=tj<tM?tj:tM)<tN?tN:tM,tZ[0]=ts,tZ[1]=ta,tZ[2]=tW,tZ[3]=tM},tD.distanceSquared=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tg[0]-tT[0],ts=tg[1]-tT[1],ta=tg[2]-tT[2],tW=tg[3]-tT[3];return tr*tr+ts*ts+ta*ta+tW*tW},tD.distance=function(tD,tY){var tg=tD.elements,tT=tY.elements,tr=tg[0]-tT[0],ts=tg[1]-tT[1],ta=tg[2]-tT[2],tW=tg[3]-tT[3];return Math.sqrt(tr*tr+ts*ts+ta*ta+tW*tW)},tD.dot=function(tD,tY){var tg=tD.elements,tT=tY.elements;return tg[0]*tT[0]+tg[1]*tT[1]+tg[2]*tT[2]+tg[3]*tT[3]},tD.min=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=Math.min(tr[0],ts[0]),tT[1]=Math.min(tr[1],ts[1]),tT[2]=Math.min(tr[2],ts[2]),tT[3]=Math.min(tr[3],ts[3])},tD.max=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY.elements;tT[0]=Math.max(tr[0],ts[0]),tT[1]=Math.max(tr[1],ts[1]),tT[2]=Math.max(tr[2],ts[2]),tT[3]=Math.max(tr[3],ts[3])},tO(tD,["ZERO",function(){return this.ZERO=new tD},"ONE",function(){return this.ONE=new tD(1,1,1,1)},"UnitX",function(){return this.UnitX=new tD(1,0,0,0)},"UnitY",function(){return this.UnitY=new tD(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new tD(0,0,1,0)},"UnitW",function(){return this.UnitW=new tD(0,0,0,1)}]),tD}(),tOY=function(){function ts(tD,tY,tg,tT){this.minDepth=0,this.maxDepth=1,this.x=tD,this.y=tY,this.width=tg,this.height=tT}tN(ts,"laya.d3.math.Viewport");var tD=ts.prototype;return tD.project=function(tD,tY,tg){tEY.transformV3ToV3(tD,tY,tg);var tT=tD.elements,tr=tY.elements,ts=tg.elements,ta=tT[0]*tr[3]+tT[1]*tr[7]+tT[2]*tr[11]+tr[15];1!==ta&&(ts[0]=ts[0]/ta,ts[1]=ts[1]/ta,ts[2]=ts[2]/ta),ts[0]=.5*(ts[0]+1)*this.width+this.x,ts[1]=.5*(1-ts[1])*this.height+this.y,ts[2]=ts[2]*(this.maxDepth-this.minDepth)+this.minDepth},tD.unprojectFromMat=function(tD,tY,tg){var tT=tD.elements,tr=tY.elements,ts=tg.elements;ts[0]=(tT[0]-this.x)/this.width*2-1,ts[1]=-((tT[1]-this.y)/this.height*2-1);var ta=(this.maxDepth-this.minDepth)/2;ts[2]=(tT[2]-this.minDepth-ta)/ta;var tW=ts[0]*tr[3]+ts[1]*tr[7]+ts[2]*tr[11]+tr[15];tEY.transformV3ToV3(tg,tY,tg),1!==tW&&(ts[0]=ts[0]/tW,ts[1]=ts[1]/tW,ts[2]=ts[2]/tW)},tD.unprojectFromWVP=function(tD,tY,tg,tT,tr){tgY.multiply(tY,tg,ts._tempMatrix4x4),tT&&tgY.multiply(ts._tempMatrix4x4,tT,ts._tempMatrix4x4),ts._tempMatrix4x4.invert(ts._tempMatrix4x4),this.unprojectFromMat(tD,ts._tempMatrix4x4,tr)},tO(ts,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new tgY}]),ts}(),tCY=function(){function tX(tD){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=tD,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}tN(tX,"laya.d3.resource.models.SubMesh");var tD=tX.prototype;return tl.imps(tD,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),tD._getVertexBuffer=function(tD){return void 0===tD&&(tD=0),0===tD?this._vertexBuffer:null},tD._getIndexBuffer=function(){return this._indexBuffer},tD._getStaticBatchBakedVertexs=function(tD,tY){var tg,tT,tr=this._vertexBuffer,ts=tr.vertexDeclaration,ta=ts.getVertexElementByUsage(0).offset/4,tW=ts.getVertexElementByUsage(3).offset/4,tM=tY.meshRender.lightmapScaleOffset,tE=0,tI=0,tO=0,tC=0,tN=0,t$=0;if(tM)if(tT=ts.getVertexElementByUsage(15))tO=ts.vertexStride/4,tg=0<this._vertexCount?tr.getData().slice(this._vertexStart*tO,(this._vertexStart+this._vertexCount)*tO):tr.getData().slice(),tC=tT.offset/4;else{tO=(t$=ts.vertexStride/4)+2,tg=this._vertexCount?new Float32Array(this._vertexCount*(tr.vertexDeclaration.vertexStride/4+2)):new Float32Array(tr.vertexCount*(tr.vertexDeclaration.vertexStride/4+2)),tC=(tN=ts.getVertexElementByUsage(2).offset/4)+2;var td=tr.getData();for(tE=0,tI=td.length/t$;tE<tI;tE++){var tJ=0;tJ=0<this._vertexCount?(this._vertexStart+tE)*t$:tE*t$;var tx=tE*tO,tj=0;for(tj=0;tj<tC;tj++)tg[tx+tj]=td[tJ+tj];for(tj=tC;tj<t$;tj++)tg[tx+tj+2]=td[tJ+tj]}}else tO=ts.vertexStride/4,tg=this._vertexCount?tr.getData().slice(this._vertexStart*tO,(this._vertexStart+this._vertexCount)*tO):tr.getData().slice();if(tD){var tZ=tD.worldMatrix,tp=tX._tempMatrix4x40;tZ.invert(tp);var tl=tX._tempMatrix4x41,tt=tY.transform.worldMatrix;tgY.multiply(tp,tt,tl)}else tl=tY.transform.worldMatrix;var t_=tX._tempQuaternion0;for(tl.decomposeTransRotScale(tX._tempVector30,t_,tX._tempVector31),tE=0,tI=tg.length/tO;tE<tI;tE++){var tA=tE*tO+ta,tq=tE*tO+tW;if(tpY.transformVector3ArrayToVector3ArrayCoordinate(tg,tA,tl,tg,tA),tpY.transformVector3ArrayByQuat(tg,tq,t_,tg,tq),tM){var tb=tE*tO+tC;if(tT)tpY.transformLightingMapTexcoordByUV1Array(tg,tb,tM,tg,tb);else{var tG=tE*t$+tN;tpY.transformLightingMapTexcoordByUV0Array(td,tG,tM,tg,tb)}}}return tg},tD._getVertexBuffers=function(){return null},tD._beforeRender=function(tD){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},tD._render=function(tD){var tY,tg=0,tT=tD.renderElement;if(1<this._indexCount){var tr=this._boneIndicesList.length;if(1<tr){for(var ts=0;ts<tr;ts++)(tY=tT._skinAnimationDatas||this._skinAnimationDatas)&&(tT._shaderValue.setValue(0,tY[ts]),tD._shader.uploadRenderElementUniforms(tT._shaderValue.data)),tz.mainContext.drawElements(4,this._subIndexBufferCount[ts],5123,2*this._subIndexBufferStart[ts]);tA.drawCall+=tr}else(tY=tT._skinAnimationDatas||this._skinAnimationDatas)&&(tT._shaderValue.setValue(0,tY[0]),tD._shader.uploadRenderElementUniforms(tT._shaderValue.data)),tz.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),tA.drawCall++;tg=this._indexCount}else tg=this._indexBuffer.indexCount,(tY=tT._skinAnimationDatas||this._skinAnimationDatas)&&(tT._shaderValue.setValue(0,tY[0]),tD._shader.uploadRenderElementUniforms(tT._shaderValue.data)),tz.mainContext.drawElements(4,tg,5123,0),tA.drawCall++;tA.trianglesFaces+=tg/3},tD.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},tD.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},t$(0,tD,"_vertexBufferCount",function(){return 1}),t$(0,tD,"triangleCount",function(){return this._indexBuffer.indexCount/3}),tO(tX,["_tempVector30",function(){return this._tempVector30=new tEY},"_tempVector31",function(){return this._tempVector31=new tEY},"_tempQuaternion0",function(){return this._tempQuaternion0=new tsY},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new tgY},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new tgY}]),tX}(),tNY=function(){function tD(tD){this.defineCounter=0,this.defines=null,tD?(this.defineCounter=tD.defineCounter,this.defines=tD.defines.slice()):(this.defineCounter=0,this.defines=[])}return tN(tD,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),tD.prototype.registerDefine=function(tD){var tY=Math.pow(2,this.defineCounter++);return this.defines[tY]=tD,tY},tD}(),t$Y=function(){function tD(){}return tN(tD,"laya.d3.shader.ShaderInit3D"),tD.__init__=function(){var tD,tY;tXY._globalRegDefine("HIGHPRECISION",tXY.SHADERDEFINE_HIGHPRECISION),tXY._globalRegDefine("FOG",tXY.SHADERDEFINE_FOG),tXY._globalRegDefine("DIRECTIONLIGHT",tXY.SHADERDEFINE_DIRECTIONLIGHT),tXY._globalRegDefine("POINTLIGHT",tXY.SHADERDEFINE_POINTLIGHT),tXY._globalRegDefine("SPOTLIGHT",tXY.SHADERDEFINE_SPOTLIGHT),tXY._globalRegDefine("UV",tXY.SHADERDEFINE_UV0),tXY._globalRegDefine("COLOR",tXY.SHADERDEFINE_COLOR),tXY._globalRegDefine("UV1",tXY.SHADERDEFINE_UV1),tXY._globalRegDefine("CASTSHADOW",tJY.SHADERDEFINE_CAST_SHADOW),tXY._globalRegDefine("SHADOWMAP_PSSM1",tJY.SHADERDEFINE_SHADOW_PSSM1),tXY._globalRegDefine("SHADOWMAP_PSSM2",tJY.SHADERDEFINE_SHADOW_PSSM2),tXY._globalRegDefine("SHADOWMAP_PSSM3",tJY.SHADERDEFINE_SHADOW_PSSM3),tXY._globalRegDefine("SHADOWMAP_PCF_NO",tJY.SHADERDEFINE_SHADOW_PCF_NO),tXY._globalRegDefine("SHADOWMAP_PCF1",tJY.SHADERDEFINE_SHADOW_PCF1),tXY._globalRegDefine("SHADOWMAP_PCF2",tJY.SHADERDEFINE_SHADOW_PCF2),tXY._globalRegDefine("SHADOWMAP_PCF3",tJY.SHADERDEFINE_SHADOW_PCF3),tXY._globalRegDefine("DEPTHFOG",tXY.SAHDERDEFINE_DEPTHFOG),tcY.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),tcY.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),tD={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},tY={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var tg=tcY.nameKey.add("SIMPLE");var tT=tXY.add(tg,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',tD,tY);tfY.SHADERDEFINE_DIFFUSEMAP=tT.registerMaterialDefine("DIFFUSEMAP"),tfY.SHADERDEFINE_NORMALMAP=tT.registerMaterialDefine("NORMALMAP"),tfY.SHADERDEFINE_SPECULARMAP=tT.registerMaterialDefine("SPECULARMAP"),tfY.SHADERDEFINE_EMISSIVEMAP=tT.registerMaterialDefine("EMISSIVEMAP"),tfY.SHADERDEFINE_AMBIENTMAP=tT.registerMaterialDefine("AMBIENTMAP"),tfY.SHADERDEFINE_REFLECTMAP=tT.registerMaterialDefine("REFLECTMAP"),tfY.SHADERDEFINE_UVTRANSFORM=tT.registerMaterialDefine("UVTRANSFORM"),tfY.SHADERDEFINE_TILINGOFFSET=tT.registerMaterialDefine("TILINGOFFSET"),tfY.SHADERDEFINE_ADDTIVEFOG=tT.registerMaterialDefine("ADDTIVEFOG")},tD}(),tdY=function(){function tD(){this._data=null,this._data=[]}tN(tD,"laya.d3.shader.ValusArray");var tY=tD.prototype;return tY.setValue=function(tD,tY){this._data[tD]=tY},t$(0,tY,"data",function(){return this._data}),tD}(),tJY=function(){function tD(){}return tD.SHADERDEFINE_RECEIVE_SHADOW=1,tD.SHADERDEFINE_CAST_SHADOW=512,tD.SHADERDEFINE_SHADOW_PSSM1=1024,tD.SHADERDEFINE_SHADOW_PSSM2=2048,tD.SHADERDEFINE_SHADOW_PSSM3=4096,tD.SHADERDEFINE_SHADOW_PCF_NO=8192,tD.SHADERDEFINE_SHADOW_PCF1=16384,tD.SHADERDEFINE_SHADOW_PCF2=32768,tD.SHADERDEFINE_SHADOW_PCF3=65536,tD.MAX_PSSM_COUNT=3,tD}(),txY=(function(){function tC(){}tN(tC,"laya.d3.utils.Physics"),tC.__init__=function(){tC._layerCollsionMatrix.length=31;for(var tD=0;tD<31;tD++){var tY=[],tg=31-tD;tY.length=tg;for(var tT=0;tT<tg;tT++)tY[tT]=tT===tg-1;tC._layerCollsionMatrix[tD]=tY}},tC.setLayerCollision=function(tD,tY,tg){tC._layerCollsionMatrix[tD.number][30-tY.number]=tg},tC.getLayerCollision=function(tD,tY){return tC._layerCollsionMatrix[tD.number][30-tY.number]},tC.setColliderCollision=function(tD,tY,tg){tg?(delete tD._ignoreCollisonMap[tY.id],delete tY._ignoreCollisonMap[tD.id]):(tD._ignoreCollisonMap[tY.id]=tY)._ignoreCollisonMap[tD.id]=tD},tC.getIColliderCollision=function(tD,tY){return!!tD._ignoreCollisonMap[tY.id]},tC.rayCast=function(tD,tY,tg,tT){void 0===tg&&(tg=179e306),void 0===tT&&(tT=0),tC._outHitAllInfo.length=0;for(var tr=ti.getLayerByNumber(tT)._colliders,ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts];if(tW.enable&&(tW.raycast(tD,tC._outHitInfo,tg),-1!==tC._outHitInfo.distance&&tC._outHitInfo.distance<=tg)){var tM=new tjY;tC._outHitInfo.cloneTo(tM),tC._outHitAllInfo.push(tM)}}if(0==tC._outHitAllInfo.length)return tY.sprite3D=null,void(tY.distance=-1);for(var tE=Number.MAX_VALUE,tI=0,tO=0;tO<tC._outHitAllInfo.length;tO++)tC._outHitAllInfo[tO].distance<tE&&(tE=tC._outHitAllInfo[tO].distance,tI=tO);tC._outHitAllInfo[tI].cloneTo(tY)},tC.rayCastAll=function(tD,tY,tg,tT){void 0===tg&&(tg=179e306),void 0===tT&&(tT=0),tY.length=0;for(var tr=ti.getLayerByNumber(tT)._colliders,ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts];if(tW.enable&&(tC._outHitInfo.distance=-1,tC._outHitInfo.sprite3D=null,tW.raycast(tD,tC._outHitInfo,tg),-1!==tC._outHitInfo.distance&&tC._outHitInfo.distance<=tg)){var tM=new tjY;tC._outHitInfo.cloneTo(tM),tY.push(tM)}}},tC._outHitAllInfo=[],tC._layerCollsionMatrix=[],tO(tC,["_outHitInfo",function(){return this._outHitInfo=new tjY},"collisionManager",function(){return this.collisionManager=new CollisionManager},"gravity",function(){return this.gravity=new tEY(0,-9.81,0)}])}(),function(){function to(){}return tN(to,"laya.d3.utils.Picker"),to.calculateCursorRay=function(tD,tY,tg,tT,tr,ts){var ta=tD.elements[0],tW=tD.elements[1],tM=to._tempVector30,tE=tM.elements;tE[0]=ta,tE[1]=tW,tE[2]=tY.minDepth;var tI=to._tempVector31,tO=tI.elements;tO[0]=ta,tO[1]=tW,tO[2]=tY.maxDepth;var tC=ts.origin,tN=to._tempVector32;tY.unprojectFromWVP(tM,tg,tT,tr,tC),tY.unprojectFromWVP(tI,tg,tT,tr,tN);var t$=ts.direction.elements;t$[0]=tN.x-tC.x,t$[1]=tN.y-tC.y,t$[2]=tN.z-tC.z,tEY.normalize(ts.direction,ts.direction)},to.rayIntersectsPositionsAndIndices=function(tD,tY,tg,tT,tr){for(var ts=tg.vertexStride/4,ta=tg.getVertexElementByUsage(0).offset/4,tW=Number.MAX_VALUE,tM=-1,tE=-1,tI=-1,tO=0;tO<tT.length;tO+=3){var tC=to._tempVector35,tN=tC.elements,t$=tT[tO]*ts,td=t$+ta;tN[0]=tY[td],tN[1]=tY[1+td],tN[2]=tY[2+td];var tJ=to._tempVector36,tx=tJ.elements,tj=tT[tO+1]*ts,tZ=tj+ta;tx[0]=tY[tZ],tx[1]=tY[1+tZ],tx[2]=tY[2+tZ];var tp=to._tempVector37,tl=tp.elements,tt=tT[tO+2]*ts,t_=tt+ta;tl[0]=tY[t_],tl[1]=tY[1+t_],tl[2]=tY[2+t_];var tA=laya.d3.utils.Picker.rayIntersectsTriangle(tD,tC,tJ,tp);!isNaN(tA)&&tA<tW&&(tW=tA,tM=t$,tE=tj,tI=tt)}if(tW===Number.MAX_VALUE)return tr.position.toDefault(),tr.distance=Number.MAX_VALUE,tr.trianglePositions[0].toDefault(),tr.trianglePositions[1].toDefault(),tr.trianglePositions[2].toDefault(),tr.triangleNormals[0].toDefault(),tr.triangleNormals[1].toDefault(),tr.triangleNormals[2].toDefault(),!1;tr.distance=tW,tEY.scale(tD.direction,tW,tr.position),tEY.add(tD.origin,tr.position,tr.position);var tq=tr.trianglePositions,tb=tq[0],tG=tq[1],tX=tq[2],tz=tb.elements,tm=tG.elements,th=tX.elements,ti=tM+ta;tz[0]=tY[ti],tz[1]=tY[ti+1],tz[2]=tY[ti+2];var tP=tE+ta;tm[0]=tY[tP],tm[1]=tY[tP+1],tm[2]=tY[tP+2];var tB=tI+ta;th[0]=tY[tB],th[1]=tY[tB+1],th[2]=tY[tB+2];var tH=tg.getVertexElementByUsage(3);if(tH){var tv=tH.offset/4,tS=tr.triangleNormals,tU=tS[0],tF=tS[1],tV=tS[2],tc=tU.elements,tf=tF.elements,te=tV.elements,tk=tM+tv;tc[0]=tY[tk],tc[1]=tY[tk+1],tc[2]=tY[tk+2];var tw=tE+tv;tf[0]=tY[tw],tf[1]=tY[tw+1],tf[2]=tY[tw+2];var tK=tI+tv;te[0]=tY[tK],te[1]=tY[tK+1],te[2]=tY[tK+2]}return!0},to.rayIntersectsTriangle=function(tD,tY,tg,tT){var tr=to._tempVector30,ts=to._tempVector31;tEY.subtract(tg,tY,tr),tEY.subtract(tT,tY,ts);var ta,tW=to._tempVector32;if(tEY.cross(tD.direction,ts,tW),(ta=tEY.dot(tr,tW))>-Number.MIN_VALUE&&ta<Number.MIN_VALUE)return Number.NaN;var tM,tE=1/ta,tI=to._tempVector33;if(tEY.subtract(tD.origin,tY,tI),tM=tEY.dot(tI,tW),(tM*=tE)<0||1<tM)return Number.NaN;var tO,tC,tN=to._tempVector34;return tEY.cross(tI,tr,tN),tO=tEY.dot(tD.direction,tN),(tO*=tE)<0||1<tM+tO?Number.NaN:(tC=tEY.dot(ts,tN),(tC*=tE)<0?Number.NaN:tC)},tO(to,["_tempVector30",function(){return this._tempVector30=new tEY},"_tempVector31",function(){return this._tempVector31=new tEY},"_tempVector32",function(){return this._tempVector32=new tEY},"_tempVector33",function(){return this._tempVector33=new tEY},"_tempVector34",function(){return this._tempVector34=new tEY},"_tempVector35",function(){return this._tempVector35=new tEY},"_tempVector36",function(){return this._tempVector36=new tEY},"_tempVector37",function(){return this._tempVector37=new tEY}]),to}()),tjY=function(){function tD(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new tEY,new tEY,new tEY],this.trianglePositions.length=3,this.triangleNormals=[new tEY,new tEY,new tEY],this.triangleNormals.length=3,this.position=new tEY}return tN(tD,"laya.d3.utils.RaycastHit"),tD.prototype.cloneTo=function(tD){tD.distance=this.distance,this.trianglePositions[0].cloneTo(tD.trianglePositions[0]),this.trianglePositions[1].cloneTo(tD.trianglePositions[1]),this.trianglePositions[2].cloneTo(tD.trianglePositions[2]),this.triangleNormals[0].cloneTo(tD.triangleNormals[0]),this.triangleNormals[1].cloneTo(tD.triangleNormals[1]),this.triangleNormals[2].cloneTo(tD.triangleNormals[2]),this.position.cloneTo(tD.position),tD.sprite3D=this.sprite3D},tD}(),tZY=function(){function tD(tD,tY){this._width=0,this._height=0,this._width=tD,this._height=tY}tN(tD,"laya.d3.utils.Size");var tY=tD.prototype;return t$(0,tY,"width",function(){return-1===this._width?tR.clientWidth:this._width}),t$(0,tY,"height",function(){return-1===this._height?tR.clientHeight:this._height}),t$(1,tD,"fullScreen",function(){return new tD(-1,-1)}),tD}(),tpY=function(){function ti(){}return tN(ti,"laya.d3.utils.Utils3D"),ti._rotationTransformScaleSkinAnimation=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO){var tC,tN,t$,td,tJ,tx=ti._tempArray16_0,tj=ti._tempArray16_1,tZ=ti._tempArray16_2,tp=tT+tT,tl=tr+tr,tt=ts+ts,t_=tT*tp,tA=tr*tp,tq=tr*tl,tb=ts*tp,tG=ts*tl,tX=ts*tt,tz=ta*tp,tm=ta*tl,th=ta*tt;for(tx[15]=1,tx[0]=1-tq-tX,tx[1]=tA+th,tx[2]=tb-tm,tx[4]=tA-th,tx[5]=1-t_-tX,tx[6]=tG+tz,tx[8]=tb+tm,tx[9]=tG-tz,tx[10]=1-t_-tq,tj[15]=1,tj[0]=tW,tj[5]=tM,tj[10]=tE,tC=0;tC<4;tC++)tN=tx[tC],t$=tx[tC+4],td=tx[tC+8],tJ=tx[tC+12],tZ[tC]=tN,tZ[tC+4]=t$,tZ[tC+8]=td,tZ[tC+12]=tN*tD+t$*tY+td*tg+tJ;for(tC=0;tC<4;tC++)tN=tZ[tC],t$=tZ[tC+4],td=tZ[tC+8],tJ=tZ[tC+12],tI[tC+tO]=tN*tj[0]+t$*tj[1]+td*tj[2]+tJ*tj[3],tI[tC+tO+4]=tN*tj[4]+t$*tj[5]+td*tj[6]+tJ*tj[7],tI[tC+tO+8]=tN*tj[8]+t$*tj[9]+td*tj[10]+tJ*tj[11],tI[tC+tO+12]=tN*tj[12]+t$*tj[13]+td*tj[14]+tJ*tj[15]},ti._createNodeByJson=function(tD,tY,tg,tT){if(!tg)switch(tY.type){case"Sprite3D":tg=new tVY;break;case"MeshSprite3D":tg=new tDg;break;case"SkinnedMeshSprite3D":tg=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":tg=new ShuriKenParticle3D;break;case"TrailSprite3D":tg=new TrailSprite3D;break;case"Terrain":tg=new Terrain;break;case"Camera":tg=new tnY;break;case"DirectionLight":tg=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var tr=tY.props;if(tr)for(var ts in tr)tg[ts]=tr[ts];var ta=tY.customProps;ta&&(tg instanceof laya.d3.core.Sprite3D?(tg._parseBaseCustomProps(ta),tg._parseCustomProps(tD,tT,ta,tY),tg._parseCustomComponent(tD,tT,tY.components)):tg._parseCustomProps(tD,tT,ta,tY));var tW=tY.child;if(tW)for(var tM=0,tE=tW.length;tM<tE;tM++){var tI=ti._createNodeByJson(tD,tW[tM],null,tT);tg.addChild(tI)}return tg},ti._computeBoneAndAnimationDatasByBindPoseMatrxix=function(tD,tY,tg,tT,tr,ts){var ta,tW,tM=0,tE=0,tI=tD.length;for(ta=0;ta<tI;tM+=tD[ta].keyframeWidth,tE+=16,ta++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(tY[tM+0],tY[tM+1],tY[tM+2],tY[tM+3],tY[tM+4],tY[tM+5],tY[tM+6],tY[tM+7],tY[tM+8],tY[tM+9],tT,tE),0!=ta&&(tW=16*tD[ta].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(tT,tW,tT,tE,tT,tE));var tO=tg.length;for(ta=0;ta<tO;ta++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(tT,16*ts[ta],tg[ta],tr,16*ta)},ti._computeAnimationDatasByArrayAndMatrixFast=function(tD,tY,tg,tT){for(var tr=0,ts=tD.length;tr<ts;tr++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(tY,16*tT[tr],tD[tr],tg,16*tr)},ti._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(tD,tY,tg,tT,tr){var ts,ta,tW=0,tM=0,tE=tD.length;for(ts=0;ts<tE;tW+=tD[ts].keyframeWidth,tM+=16,ts++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(tY[tW+7],tY[tW+8],tY[tW+9],tY[tW+3],tY[tW+4],tY[tW+5],tY[tW+6],tY[tW+0],tY[tW+1],tY[tW+2],tT,tM),0!=ts&&(ta=16*tD[ts].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(tT,ta,tT,tM,tT,tM));var tI=tg.length;for(ts=0;ts<tI;ts++){var tO=16*ts;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(tT,tO,tg[ts],tr,tO)}},ti._computeAnimationDatasByArrayAndMatrixFastOld=function(tD,tY,tg){for(var tT=tD.length,tr=0;tr<tT;tr++){var ts=16*tr;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(tY,ts,tD[tr],tg,ts)}},ti._computeRootAnimationData=function(tD,tY,tg){for(var tT=0,tr=0,ts=0,ta=tD.length;tT<ta;tr+=tD[tT].keyframeWidth,ts+=16,tT++)laya.d3.utils.Utils3D.createAffineTransformationArray(tY[tr+0],tY[tr+1],tY[tr+2],tY[tr+3],tY[tr+4],tY[tr+5],tY[tr+6],tY[tr+7],tY[tr+8],tY[tr+9],tg,ts)},ti.transformVector3ArrayByQuat=function(tD,tY,tg,tT,tr){var ts=tg.elements,ta=tD[tY],tW=tD[tY+1],tM=tD[tY+2],tE=ts[0],tI=ts[1],tO=ts[2],tC=ts[3],tN=tC*ta+tI*tM-tO*tW,t$=tC*tW+tO*ta-tE*tM,td=tC*tM+tE*tW-tI*ta,tJ=-tE*ta-tI*tW-tO*tM;tT[tr]=tN*tC+tJ*-tE+t$*-tO-td*-tI,tT[tr+1]=t$*tC+tJ*-tI+td*-tE-tN*-tO,tT[tr+2]=td*tC+tJ*-tO+tN*-tI-t$*-tE},ti.mulMatrixByArray=function(tD,tY,tg,tT,tr,ts){var ta,tW,tM,tE,tI;if(tr===tg){for(tg=ti._tempArray16_3,ta=0;ta<16;++ta)tg[ta]=tr[ts+ta];tT=0}for(ta=0;ta<4;ta++)tW=tD[tY+ta],tM=tD[tY+ta+4],tE=tD[tY+ta+8],tI=tD[tY+ta+12],tr[ts+ta]=tW*tg[tT+0]+tM*tg[tT+1]+tE*tg[tT+2]+tI*tg[tT+3],tr[ts+ta+4]=tW*tg[tT+4]+tM*tg[tT+5]+tE*tg[tT+6]+tI*tg[tT+7],tr[ts+ta+8]=tW*tg[tT+8]+tM*tg[tT+9]+tE*tg[tT+10]+tI*tg[tT+11],tr[ts+ta+12]=tW*tg[tT+12]+tM*tg[tT+13]+tE*tg[tT+14]+tI*tg[tT+15]},ti.mulMatrixByArrayFast=function(tD,tY,tg,tT,tr,ts){var ta,tW,tM,tE,tI;for(ta=0;ta<4;ta++)tW=tD[tY+ta],tM=tD[tY+ta+4],tE=tD[tY+ta+8],tI=tD[tY+ta+12],tr[ts+ta]=tW*tg[tT+0]+tM*tg[tT+1]+tE*tg[tT+2]+tI*tg[tT+3],tr[ts+ta+4]=tW*tg[tT+4]+tM*tg[tT+5]+tE*tg[tT+6]+tI*tg[tT+7],tr[ts+ta+8]=tW*tg[tT+8]+tM*tg[tT+9]+tE*tg[tT+10]+tI*tg[tT+11],tr[ts+ta+12]=tW*tg[tT+12]+tM*tg[tT+13]+tE*tg[tT+14]+tI*tg[tT+15]},ti.mulMatrixByArrayAndMatrixFast=function(tD,tY,tg,tT,tr){var ts,ta,tW,tM,tE,tI=tg.elements,tO=tI[0],tC=tI[1],tN=tI[2],t$=tI[3],td=tI[4],tJ=tI[5],tx=tI[6],tj=tI[7],tZ=tI[8],tp=tI[9],tl=tI[10],tt=tI[11],t_=tI[12],tA=tI[13],tq=tI[14],tb=tI[15],tG=tY,tX=tY+4,tz=tY+8,tm=tY+12,th=tr,ti=tr+4,tP=tr+8,tB=tr+12;for(ts=0;ts<4;ts++)ta=tD[tG+ts],tW=tD[tX+ts],tM=tD[tz+ts],tE=tD[tm+ts],tT[th+ts]=ta*tO+tW*tC+tM*tN+tE*t$,tT[ti+ts]=ta*td+tW*tJ+tM*tx+tE*tj,tT[tP+ts]=ta*tZ+tW*tp+tM*tl+tE*tt,tT[tB+ts]=ta*t_+tW*tA+tM*tq+tE*tb},ti.createAffineTransformationArray=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO){var tC=tT+tT,tN=tr+tr,t$=ts+ts,td=tT*tC,tJ=tT*tN,tx=tT*t$,tj=tr*tN,tZ=tr*t$,tp=ts*t$,tl=ta*tC,tt=ta*tN,t_=ta*t$;tI[tO+0]=(1-(tj+tp))*tW,tI[tO+1]=(tJ+t_)*tW,tI[tO+2]=(tx-tt)*tW,tI[tO+3]=0,tI[tO+4]=(tJ-t_)*tM,tI[tO+5]=(1-(td+tp))*tM,tI[tO+6]=(tZ+tl)*tM,tI[tO+7]=0,tI[tO+8]=(tx+tt)*tE,tI[tO+9]=(tZ-tl)*tE,tI[tO+10]=(1-(td+tj))*tE,tI[tO+11]=0,tI[tO+12]=tD,tI[tO+13]=tY,tI[tO+14]=tg,tI[tO+15]=1},ti.transformVector3ArrayToVector3ArrayCoordinate=function(tD,tY,tg,tT,tr){var ts=ti._tempArray4_0,ta=tD[tY+0],tW=tD[tY+1],tM=tD[tY+2],tE=tg.elements;ts[0]=ta*tE[0]+tW*tE[4]+tM*tE[8]+tE[12],ts[1]=ta*tE[1]+tW*tE[5]+tM*tE[9]+tE[13],ts[2]=ta*tE[2]+tW*tE[6]+tM*tE[10]+tE[14],ts[3]=1/(ta*tE[3]+tW*tE[7]+tM*tE[11]+tE[15]),tT[tr+0]=ts[0]*ts[3],tT[tr+1]=ts[1]*ts[3],tT[tr+2]=ts[2]*ts[3]},ti.transformLightingMapTexcoordByUV0Array=function(tD,tY,tg,tT,tr){var ts=tg.elements;tT[tr+0]=tD[tY+0]*ts[0]+ts[2],tT[tr+1]=(tD[tY+1]-1)*ts[1]+ts[3]},ti.transformLightingMapTexcoordByUV1Array=function(tD,tY,tg,tT,tr){var ts=tg.elements;tT[tr+0]=tD[tY+0]*ts[0]+ts[2],tT[tr+1]=1+tD[tY+1]*ts[1]+ts[3]},ti.getURLVerion=function(tD){var tY=tD.indexOf("?");return 0<=tY?tD.substr(tY):null},ti._quaternionCreateFromYawPitchRollArray=function(tD,tY,tg,tT){var tr=.5*tg,ts=.5*tY,ta=.5*tD,tW=Math.sin(tr),tM=Math.cos(tr),tE=Math.sin(ts),tI=Math.cos(ts),tO=Math.sin(ta),tC=Math.cos(ta);tT[0]=tC*tE*tM+tO*tI*tW,tT[1]=tO*tI*tM-tC*tE*tW,tT[2]=tC*tI*tW-tO*tE*tM,tT[3]=tC*tI*tM+tO*tE*tW},ti._createAffineTransformationArray=function(tD,tY,tg,tT){var tr=tY[0],ts=tY[1],ta=tY[2],tW=tY[3],tM=tr+tr,tE=ts+ts,tI=ta+ta,tO=tr*tM,tC=tr*tE,tN=tr*tI,t$=ts*tE,td=ts*tI,tJ=ta*tI,tx=tW*tM,tj=tW*tE,tZ=tW*tI,tp=tg[0],tl=tg[1],tt=tg[2];tT[0]=(1-(t$+tJ))*tp,tT[1]=(tC+tZ)*tp,tT[2]=(tN-tj)*tp,tT[3]=0,tT[4]=(tC-tZ)*tl,tT[5]=(1-(tO+tJ))*tl,tT[6]=(td+tx)*tl,tT[7]=0,tT[8]=(tN+tj)*tt,tT[9]=(td-tx)*tt,tT[10]=(1-(tO+t$))*tt,tT[11]=0,tT[12]=tD[0],tT[13]=tD[1],tT[14]=tD[2],tT[15]=1},ti._mulMatrixArray=function(tD,tY,tg,tT){var tr,ts,ta,tW,tM,tE=tY.elements,tI=tE[0],tO=tE[1],tC=tE[2],tN=tE[3],t$=tE[4],td=tE[5],tJ=tE[6],tx=tE[7],tj=tE[8],tZ=tE[9],tp=tE[10],tl=tE[11],tt=tE[12],t_=tE[13],tA=tE[14],tq=tE[15],tb=tT,tG=tT+4,tX=tT+8,tz=tT+12;for(tr=0;tr<4;tr++)ts=tD[tr],ta=tD[tr+4],tW=tD[tr+8],tM=tD[tr+12],tg[tb+tr]=ts*tI+ta*tO+tW*tC+tM*tN,tg[tG+tr]=ts*t$+ta*td+tW*tJ+tM*tx,tg[tX+tr]=ts*tj+ta*tZ+tW*tp+tM*tl,tg[tz+tr]=ts*tt+ta*t_+tW*tA+tM*tq},ti.getYawPitchRoll=function(tD,tY){ti.transformQuat(tEY.ForwardRH,tD,tsY.TEMPVector31),ti.transformQuat(tEY.Up,tD,tsY.TEMPVector32);var tg=tsY.TEMPVector32.elements;ti.angleTo(tEY.ZERO,tsY.TEMPVector31,tsY.TEMPVector33);var tT=tsY.TEMPVector33.elements;tT[0]==Math.PI/2?(tT[1]=ti.arcTanAngle(tg[2],tg[0]),tT[2]=0):tT[0]==-Math.PI/2?(tT[1]=ti.arcTanAngle(-tg[2],-tg[0]),tT[2]=0):(tgY.createRotationY(-tT[1],tsY.TEMPMatrix0),tgY.createRotationX(-tT[0],tsY.TEMPMatrix1),tEY.transformCoordinate(tsY.TEMPVector32,tsY.TEMPMatrix0,tsY.TEMPVector32),tEY.transformCoordinate(tsY.TEMPVector32,tsY.TEMPMatrix1,tsY.TEMPVector32),tT[2]=ti.arcTanAngle(tg[1],-tg[0])),tT[1]<=-Math.PI&&(tT[1]=Math.PI),tT[2]<=-Math.PI&&(tT[2]=Math.PI),tT[1]>=Math.PI&&tT[2]>=Math.PI&&(tT[1]=0,tT[2]=0,tT[0]=Math.PI-tT[0]),tY[0]=tT[1],tY[1]=tT[0],tY[2]=tT[2]},ti.arcTanAngle=function(tD,tY){return 0==tD?1==tY?Math.PI/2:-Math.PI/2:0<tD?Math.atan(tY/tD):tD<0?0<tY?Math.atan(tY/tD)+Math.PI:Math.atan(tY/tD)-Math.PI:0},ti.angleTo=function(tD,tY,tg){tEY.subtract(tY,tD,tsY.TEMPVector30),tEY.normalize(tsY.TEMPVector30,tsY.TEMPVector30),tg.elements[0]=Math.asin(tsY.TEMPVector30.y),tg.elements[1]=ti.arcTanAngle(-tsY.TEMPVector30.z,-tsY.TEMPVector30.x)},ti.transformQuat=function(tD,tY,tg){var tT=tg.elements,tr=tD.elements,ts=tY,ta=tr[0],tW=tr[1],tM=tr[2],tE=ts[0],tI=ts[1],tO=ts[2],tC=ts[3],tN=tC*ta+tI*tM-tO*tW,t$=tC*tW+tO*ta-tE*tM,td=tC*tM+tE*tW-tI*ta,tJ=-tE*ta-tI*tW-tO*tM;tT[0]=tN*tC+tJ*-tE+t$*-tO-td*-tI,tT[1]=t$*tC+tJ*-tI+td*-tE-tN*-tO,tT[2]=td*tC+tJ*-tO+tN*-tI-t$*-tE},ti.quaterionNormalize=function(tD,tY){var tg=tD[0],tT=tD[1],tr=tD[2],ts=tD[3],ta=tg*tg+tT*tT+tr*tr+ts*ts;0<ta&&(ta=1/Math.sqrt(ta),tY[0]=tg*ta,tY[1]=tT*ta,tY[2]=tr*ta,tY[3]=ts*ta)},ti.matrix4x4MultiplyFFF=function(tD,tY,tg){var tT,tr,ts,ta,tW;if(tg===tY)for(tY=new Float32Array(16),tT=0;tT<16;++tT)tY[tT]=tg[tT];for(tT=0;tT<4;tT++)tr=tD[tT],ts=tD[tT+4],ta=tD[tT+8],tW=tD[tT+12],tg[tT]=tr*tY[0]+ts*tY[1]+ta*tY[2]+tW*tY[3],tg[tT+4]=tr*tY[4]+ts*tY[5]+ta*tY[6]+tW*tY[7],tg[tT+8]=tr*tY[8]+ts*tY[9]+ta*tY[10]+tW*tY[11],tg[tT+12]=tr*tY[12]+ts*tY[13]+ta*tY[14]+tW*tY[15]},ti.matrix4x4MultiplyMFM=function(tD,tY,tg){ti.matrix4x4MultiplyFFF(tD.elements,tY,tg.elements)},tO(ti,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new tEY},"_tempVector3_1",function(){return this._tempVector3_1=new tEY},"_tempVector3_2",function(){return this._tempVector3_2=new tEY},"_tempVector3_3",function(){return this._tempVector3_3=new tEY},"_tempVector3_4",function(){return this._tempVector3_4=new tEY},"_tempVector3_5",function(){return this._tempVector3_5=new tEY},"_tempVector3_6",function(){return this._tempVector3_6=new tEY},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),ti}(),tlY=function(){function tm(){}return tN(tm,"Laya3D"),tm._cancelLoadByUrl=function(tD){tl.loader.cancelLoadByUrl(tD),tm._innerFirstLevelLoaderManager.cancelLoadByUrl(tD),tm._innerSecondLevelLoaderManager.cancelLoadByUrl(tD),tm._innerThirdLevelLoaderManager.cancelLoadByUrl(tD),tm._innerFourthLevelLoaderManager.cancelLoadByUrl(tD)},tm._changeWebGLSize=function(tD,tY){tz.onStageResize(tD,tY),tR.clientWidth=tD,tR.clientHeight=tY},tm.__init__=function(){var tD=tY.createMap;tD.lh=[tVY,"SPRITE3DHIERARCHY"],tD.ls=[tFY,"SPRITE3DHIERARCHY"],tD.lm=[tRY,"MESH"],tD.lmat=[tfY,"MATERIAL"],tD.jpg=[tLY,"nativeimage"],tD.jpeg=[tLY,"nativeimage"],tD.png=[tLY,"nativeimage"],tD.pkm=[tLY,"arraybuffer"],tD.raw=[tKY,"arraybuffer"],tD.mipmaps=[tKY,"arraybuffer"],tx.parserMap.SPRITE3DHIERARCHY=tm._loadHierarchy,tx.parserMap.MESH=tm._loadMesh,tx.parserMap.MATERIAL=tm._loadMaterial,tx.parserMap.TEXTURECUBE=tm._loadTextureCube,tx.parserMap.TERRAIN=tm._loadTerrain,tm._innerFirstLevelLoaderManager.on("error",null,tm._eventLoadManagerError),tm._innerSecondLevelLoaderManager.on("error",null,tm._eventLoadManagerError),tm._innerThirdLevelLoaderManager.on("error",null,tm._eventLoadManagerError),tm._innerFourthLevelLoaderManager.on("error",null,tm._eventLoadManagerError)},tm.READ_BLOCK=function(){return tm._readData.pos+=4,!0},tm.READ_DATA=function(){return tm._DATA.offset=tm._readData.getUint32(),tm._DATA.size=tm._readData.getUint32(),!0},tm.READ_STRINGS=function(){var tD=[],tY={offset:0,size:0};tY.offset=tm._readData.getUint16(),tY.size=tm._readData.getUint16();tm._readData.pos;tm._readData.pos=tY.offset+tm._DATA.offset;for(var tg=0;tg<tY.size;tg++){var tT=tm._readData.readUTFString();-1===tT.lastIndexOf(".lmat")&&-1===tT.lastIndexOf(".lpbr")||tD.push(tT)}return tD},tm.formatRelativePath=function(tD,tY){var tg;if("."===tY.charAt(0)){for(var tT=(tD+tY).split("/"),tr=0,ts=tT.length;tr<ts;tr++)if(".."==tT[tr]){var ta=tr-1;0<ta&&".."!==tT[ta]&&(tT.splice(ta,2),tr-=2)}tg=tT.join("/")}else tg=tD+tY;return null!=tX.customFormat&&(tg=tX.customFormat(tg,null)),tg},tm._eventLoadManagerError=function(tD){tl.loader.event("error",tD)},tm._addHierarchyInnerUrls=function(tD,tY,tg,tT,tr,ts){var ta=tm.formatRelativePath(tT,tr);tg&&(ta+=tg),tD.push({url:ta,clas:ts}),tY[tr]=ta},tm._getSprite3DHierarchyInnerUrls=function(tD,tY,tg,tT,tr,ts,ta){var tW,tM=0,tE=0;switch(tD.type){case"Scene":var tI=tD.customProps.lightmaps;for(tM=0,tE=tI.length;tM<tE;tM++){var tO=tI[tM].replace(".exr",".png");tm._addHierarchyInnerUrls(tT,tr,ts,ta,tO,tLY)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var tC;if(tD.instanceParams)(tC=tD.instanceParams.loadPath)&&tm._addHierarchyInnerUrls(tY,tr,ts,ta,tC,tRY);else{(tC=(tW=tD.customProps).meshPath)&&tm._addHierarchyInnerUrls(tY,tr,ts,ta,tC,tRY);var tN=tW.materials;if(tN)for(tM=0,tE=tN.length;tM<tE;tM++){for(var t$=tN[tM],td=t$.type.split("."),tJ=th.window,tx=0,tj=td.length;tx<tj;++tx){tJ=tJ[this.clasPaths[tx]]}if("function"!=typeof tJ)throw"_getSprite3DHierarchyInnerUrls 错误: "+t$.type+" 不是类";tm._addHierarchyInnerUrls(tg,tr,ts,ta,t$.path,tJ)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var tZ=(tW=tD.customProps).meshPath;tZ&&tm._addHierarchyInnerUrls(tY,tr,ts,ta,tZ,tRY);var tp=tW.material;if(tp){td=tp.type.split("."),tJ=th.window;for(tx=0,tj=td.length;tx<tj;++tx){tJ=tJ[this.clasPaths[tx]]}tm._addHierarchyInnerUrls(tg,tr,ts,ta,tp.path,tJ)}else{var tl=tW.materialPath;if(tl)tm._addHierarchyInnerUrls(tg,tr,ts,ta,tl,ShurikenParticleMaterial);else{var tt=tW.texturePath;tt&&tm._addHierarchyInnerUrls(tT,tr,ts,ta,tt,tLY)}}break;case"Terrain":tm._addHierarchyInnerUrls(tT,tr,ts,ta,tD.customProps.dataPath,TerrainRes)}var t_=tD.components;for(var tA in t_){var tq=t_[tA];switch(tA){case"Animator":var tb=tq.avatarPath;if(tb)tm._addHierarchyInnerUrls(tT,tr,ts,ta,tb,Avatar);else{var tG=tq.avatar;tG&&tm._addHierarchyInnerUrls(tT,tr,ts,ta,tG.path,Avatar)}var tX=tq.clipPaths;for(tM=0,tE=tX.length;tM<tE;tM++)tm._addHierarchyInnerUrls(tT,tr,ts,ta,tX[tM],AnimationClip)}}var tz=tD.child;for(tM=0,tE=tz.length;tM<tE;tM++)tm._getSprite3DHierarchyInnerUrls(tz[tM],tY,tg,tT,tr,ts,ta)},tm._loadHierarchy=function(tD){tD.on("loaded",null,tm._onHierarchylhLoaded,[tD,tD._class._getGroup()]),tD.load(tD.url,"json",!1,null,!0)},tm._onHierarchylhLoaded=function(tD,tY,tg){if(tD._class.destroyed)tD.endLoad();else{var tT=tD.url,tr=tpY.getURLVerion(tT),ts=tX.getPath(tT),ta=[],tW=[],tM=[],tE={};tm._getSprite3DHierarchyInnerUrls(tg,ta,tW,tM,tE,tr,ts);var tI=ta.length+tW.length+tM.length,tO=tI+1,tC=1/tO;if(tm._onProcessChange(tD,0,tC,1),0<tM.length){var tN=tI/tO,t$=tG.create(null,tm._onProcessChange,[tD,tC,tN],!1);tm._innerFourthLevelLoaderManager.create(tM,tG.create(null,tm._onHierarchyInnerForthLevResouLoaded,[tD,tY,t$,tg,tE,ta,tW,tC+tN*tM.length,tN]),t$,null,null,1,!0,tY)}else tm._onHierarchyInnerForthLevResouLoaded(tD,tY,null,tg,tE,ta,tW,tC,tN)}},tm._onHierarchyInnerForthLevResouLoaded=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){if(tD._class.destroyed)tD.endLoad();else if(tg&&tg.recover(),0<ta.length){var tE=tG.create(null,tm._onProcessChange,[tD,tW,tM],!1);tm._innerSecondLevelLoaderManager.create(ta,tG.create(null,tm._onHierarchyInnerSecondLevResouLoaded,[tD,tY,tE,tT,tr,ts,tW+tM*ta.length,tM]),tg,null,null,1,!0,tY)}else tm._onHierarchyInnerSecondLevResouLoaded(tD,tY,null,tT,tr,ts,tW,tM)},tm._onHierarchyInnerSecondLevResouLoaded=function(tD,tY,tg,tT,tr,ts,ta,tW){if(tD._class.destroyed)tD.endLoad();else if(tg&&tg.recover(),0<ts.length){var tM=tG.create(null,tm._onProcessChange,[tD,ta,tW],!1);tm._innerFirstLevelLoaderManager.create(ts,tG.create(null,tm._onHierarchyInnerFirstLevResouLoaded,[tD,tM,tT,tr]),tg,null,null,1,!0,tY)}else tm._onHierarchyInnerFirstLevResouLoaded(tD,null,tT,tr)},tm._onHierarchyInnerFirstLevResouLoaded=function(tD,tY,tg,tT){tY&&tY.recover(),tD.endLoad([tg,tT])},tm._loadTerrain=function(tD){tD.on("loaded",null,tm._onTerrainLtLoaded,[tD,tD._class._getGroup()]),tD.load(tD.url,"json",!1,null,!0)},tm._onTerrainLtLoaded=function(tD,tY,tg){if(tD._class.destroyed)tD.endLoad();else{var tT,tr,ts=tD.url,ta=tpY.getURLVerion(ts),tW=tX.getPath(ts),tM=[],tE={},tI=0,tO=0,tC=tg.heightData;tT=tC.url,tr=tm.formatRelativePath(tW,tT),ta&&(tr+=ta),tT=tE[tT]=tr;var tN=tg.detailTexture;for(tI=0,tO=tN.length;tI<tO;tI++)tM.push({url:tN[tI].diffuse});var t$=tg.normalMap;for(tI=0,tO=t$.length;tI<tO;tI++)tM.push({url:t$[tI]});var td=tg.alphaMap;for(tI=0,tO=td.length;tI<tO;tI++)tM.push({url:td[tI],params:[!1,!1,6408,!0]});for(tI=0,tO=tM.length;tI<tO;tI++){var tJ=tM[tI].url;tr=tm.formatRelativePath(tW,tJ),ta&&(tr+=ta),tM[tI].url=tr,tE[tJ]=tr}var tx=tM.length,tj=tx+2,tZ=1/tj;tm._onProcessChange(tD,0,tZ,1);var tp={heightMapLoaded:!1,texturesLoaded:!1},tl=tG.create(null,tm._onProcessChange,[tD,tZ,tZ],!1);tm._innerFourthLevelLoaderManager.create(tT,tG.create(null,tm._onTerrainHeightMapLoaded,[tD,tl,tg,tE,tp]),tl,null,[tC.numX,tC.numZ,tC.bitType,tC.value],1,!0,tY);var tt=tG.create(null,tm._onProcessChange,[tD,2*tZ,tx/tj],!1);tm._innerFourthLevelLoaderManager.create(tM,tG.create(null,tm._onTerrainTexturesLoaded,[tD,tt,tg,tE,tp]),tt,null,null,1,!0,tY)}},tm._onTerrainHeightMapLoaded=function(tD,tY,tg,tT,tr){tr.heightMapLoaded=!0,tr.texturesLoaded&&(tD.endLoad([tg,tT]),tY.recover())},tm._onTerrainTexturesLoaded=function(tD,tY,tg,tT,tr){tr.texturesLoaded=!0,tr.heightMapLoaded&&(tD.endLoad([tg,tT]),tY.recover())},tm._loadMesh=function(tD){tD.on("loaded",null,tm._onMeshLmLoaded,[tD,tD._class._getGroup()]),tD.load(tD.url,"arraybuffer",!1,null,!0)},tm._onMeshLmLoaded=function(tD,tY,tg){if(tD._class.destroyed)tD.endLoad();else{var tT,tr,ts,ta=tD.url,tW=tpY.getURLVerion(ta),tM=tX.getPath(ta),tE={},tI=0,tO=0;switch((tm._readData=new tt(tg)).pos=0,tm._readData.getUint16()==tm.PARTICLE_COMPRESS||(tm._readData.pos=0),tm._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var tC=tm._readData.getUint32();tm._readData.pos=tm._readData.pos+4,tO=tm._readData.getUint16(),tm._readData.pos=tm._readData.pos+8*tO;var tN=tm._readData.getUint32();for(tO=tm._readData.getUint16(),tm._readData.pos=tC+tN,tT=[],tI=0;tI<tO;tI++){var t$=tm._readData.readUTFString();-1!==t$.lastIndexOf(".lmat")&&tT.push(t$)}break;default:for(tm.READ_BLOCK(),tI=0;tI<2;tI++){var td=tm._readData.getUint16(),tJ=tm._strings[td],tx=tm["READ_"+tJ];if(null==tx)throw new Error("model file err,no this function:"+td+" "+tJ);1===tI?tT=tx.call():tx.call()}}for(tI=0,ts=tT.length;tI<ts;tI++){var tj=tT[tI];tr=tm.formatRelativePath(tM,tj),tW&&(tr+=tW),tT[tI]=tr,tE[tj]=tr}if(0<tT.length){tm._onProcessChange(tD,0,.5,1);var tZ=tG.create(null,tm._onProcessChange,[tD,.5,.5],!1);tm._innerSecondLevelLoaderManager.create(tT,tG.create(null,tm._onMeshMateialLoaded,[tD,tZ,tg,tE]),tZ,null,null,1,!0,tY)}else tD.endLoad([tg,tE])}},tm._onMeshMateialLoaded=function(tD,tY,tg,tT){tD.endLoad([tg,tT]),tY.recover()},tm._getMaterialTexturePath=function(tD,tY,tg){var tT=tD.length-4;return tD.indexOf(".dds")!=tT&&tD.indexOf(".tga")!=tT&&tD.indexOf(".exr")!=tT&&tD.indexOf(".DDS")!=tT&&tD.indexOf(".TGA")!=tT&&tD.indexOf(".EXR")!=tT||(tD=tD.substr(0,tT)+".png"),tD=tm.formatRelativePath(tg,tD),tY&&(tD+=tY),tD},tm._loadMaterial=function(tD){tD.on("loaded",null,tm._onMaterilLmatLoaded,[tD,tD._class._getGroup()]),tD.load(tD.url,"json",!1,null,!0)},tm._onMaterilLmatLoaded=function(tD,tY,tg){if(tD._class.destroyed)tD.endLoad();else{var tT,tr=tD.url,ts=tpY.getURLVerion(tr),ta=tX.getPath(tr),tW=[],tM={},tE=tg.customProps,tI=tg.version;if(tI)switch(tI){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var tO=tg.props.textures,tC=0,tN=tO.length;tC<tN;tC++){var t$=tO[tC],td=t$.path;if(td){var tJ=td.length-4;td.indexOf(".exr")!=tJ&&td.indexOf(".EXR")!=tJ||(td=td.substr(0,tJ)+".png"),tT=tm.formatRelativePath(ta,td),ts&&(tT+=ts),tW.push({url:tT,params:t$.params}),tM[td]=tT}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var tx=tE.diffuseTexture.texture2D;if(tx&&(tT=tm._getMaterialTexturePath(tx,ts,ta),tW.push(tT),tM[tx]=tT),tE.normalTexture){var tj=tE.normalTexture.texture2D;tj&&(tT=tm._getMaterialTexturePath(tj,ts,ta),tW.push(tT),tM[tj]=tT)}if(tE.specularTexture){var tZ=tE.specularTexture.texture2D;tZ&&(tT=tm._getMaterialTexturePath(tZ,ts,ta),tW.push(tT),tM[tZ]=tT)}if(tE.emissiveTexture){var tp=tE.emissiveTexture.texture2D;tp&&(tT=tm._getMaterialTexturePath(tp,ts,ta),tW.push(tT),tM[tp]=tT)}if(tE.ambientTexture){var tl=tE.ambientTexture.texture2D;tl&&(tT=tm._getMaterialTexturePath(tl,ts,ta),tW.push(tT),tM[tl]=tT)}if(tE.reflectTexture){var tt=tE.reflectTexture.texture2D;tt&&(tT=tm._getMaterialTexturePath(tt,ts,ta),tW.push(tT),tM[tt]=tT)}}var t_=tW.length,tA=t_+1,tq=1/tA;if(tm._onProcessChange(tD,0,tq,1),0<t_){var tb=tG.create(null,tm._onProcessChange,[tD,tq,t_/tA],!1);tm._innerFourthLevelLoaderManager.create(tW,tG.create(null,tm._onMateialTexturesLoaded,[tD,tb,tg,tM]),tb,tLY,null,1,!0,tY)}else tm._onMateialTexturesLoaded(tD,null,tg,null)}},tm._onMateialTexturesLoaded=function(tD,tY,tg,tT){tD.endLoad([tg,tT]),tY&&tY.recover()},tm._loadTextureCube=function(tD){tD.on("loaded",null,tm._onTextureCubeLtcLoaded,[tD]),tD.load(tD.url,"json",!1,null,!0)},tm._onTextureCubeLtcLoaded=function(tD,tY){if(tD._class.destroyed)tD.endLoad();else{var tg=tX.getPath(tD.url),tT=[tm.formatRelativePath(tg,tY.px),tm.formatRelativePath(tg,tY.nx),tm.formatRelativePath(tg,tY.py),tm.formatRelativePath(tg,tY.ny),tm.formatRelativePath(tg,tY.pz),tm.formatRelativePath(tg,tY.nz)];tm._onProcessChange(tD,0,1/7,1);var tr=tG.create(null,tm._onProcessChange,[tD,1/7,6/7],!1);tm._innerFourthLevelLoaderManager.load(tT,tG.create(null,tm._onTextureCubeImagesLoaded,[tD,tT,tr]),tr,"nativeimage")}},tm._onTextureCubeImagesLoaded=function(tD,tY,tg){var tT=[];tT.length=6;for(var tr=0;tr<6;tr++){var ts=tY[tr];tT[tr]=tx.getRes(ts),tx.clearRes(ts)}tD.endLoad(tT),tg.recover()},tm._onProcessChange=function(tD,tY,tg,tT){(tT=tY+tT*tg)<1&&tD.event("progress",tT)},tm.init=function(tD,tY,tg,tT,tr,ts){if(void 0===tg&&(tg=!1),void 0===tT&&(tT=!1),void 0===tr&&(tr=!0),void 0===ts&&(ts=!0),tj.update3DLoop=function(){},tj.cancelLoadByUrl=function(tD){tm._cancelLoadByUrl(tD)},tE.isAntialias=tg,tE.isAlpha=tT,tE.premultipliedAlpha=tr,tE.isStencil=ts,!tz.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");tj.changeWebGLSize=tm._changeWebGLSize,td.is3DMode=!0,tl.init(tD,tY),ti.__init__(),t$Y.__init__(),tDg.__init__(),tV.__init__(),tm.__init__(),ta.maxTextureCount=2,(tm.debugMode||tQ.debugMode)&&(tm._debugPhasorSprite=new tw)},tm.HIERARCHY="SPRITE3DHIERARCHY",tm.MESH="MESH",tm.MATERIAL="MATERIAL",tm.PBRMATERIAL="PBRMTL",tm.TEXTURECUBE="TEXTURECUBE",tm.TERRAIN="TERRAIN",tm.PARTICLE_COMPRESS=65535,tm._readData=null,tm._debugPhasorSprite=null,tm.debugMode=!1,tO(tm,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new tY},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new tY},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new tY},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new tY}]),tm}(),ttY=function(tD){function tr(tD){tr.__super.call(this),this._owner=tD,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}tN(tr,"laya.d3.animation.AnimationTransform3D",ts);var tY=tr.prototype;return tY._getlocalMatrix=function(){return this._localUpdate&&(tpY._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},tY._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldTransform()}},tY._setWorldMatrixAndUpdate=function(tD){if(this._worldMatrix=tD,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var tY=this._getlocalMatrix(),tg=0;tg<16;++tg)this._worldMatrix[tg]=tY[tg];else tpY.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},tY._setWorldMatrixNoUpdate=function(tD){this._worldMatrix=tD},tY._setWorldMatrixIgnoreUpdate=function(tD){this._worldMatrix=tD,this._worldUpdate=!1},tY.getLocalPosition=function(){return this._localPosition},tY.setLocalPosition=function(tD){if(this._parent)this._localPosition=tD,this._localUpdate=!0,this._onWorldTransform();else{var tY=this._entity.owner._transform,tg=this._entity.localPosition,tT=tg.elements;tT[0]=tD[0],tT[1]=tD[1],tT[2]=tD[2],tY.localPosition=tg}},tY.getLocalRotation=function(){if(this._localQuaternionUpdate){var tD=this._localRotationEuler;tpY._quaternionCreateFromYawPitchRollArray(tD[1]/tr._angleToRandin,tD[0]/tr._angleToRandin,tD[2]/tr._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},tY.setLocalRotation=function(tD){if(this._parent)this._localRotation=tD,tpY.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var tY=this._entity.owner._transform,tg=this._entity.localRotation,tT=tg.elements;tT[0]=tD[0],tT[1]=tD[1],tT[2]=tD[2],tT[3]=tD[3],tY.localRotation=tg}},tY.getLocalScale=function(){return this._localScale},tY.setLocalScale=function(tD){if(this._parent)this._localScale=tD,this._localUpdate=!0,this._onWorldTransform();else{var tY=this._entity.owner._transform,tg=this._entity.localScale,tT=tg.elements;tT[0]=tD[0],tT[1]=tD[1],tT[2]=tD[2],tY.localScale=tg}},tY.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){tpY.getYawPitchRoll(this._localRotation,tr._tempVector3);var tD=tr._tempVector3,tY=this._localRotationEuler;tY[0]=tD[1]*tr._angleToRandin,tY[1]=tD[0]*tr._angleToRandin,tY[2]=tD[2]*tr._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},tY.setLocalRotationEuler=function(tD){if(this._parent)tpY._quaternionCreateFromYawPitchRollArray(tD[1]/tr._angleToRandin,tD[0]/tr._angleToRandin,tD[2]/tr._angleToRandin,this._localRotation),this._localRotationEuler=tD,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var tY=this._entity.owner._transform,tg=this._entity.localRotationEuler,tT=tg.elements;tT[0]=tD[0],tT[1]=tD[1],tT[2]=tD[2],tY.localRotationEuler=tg}},tY.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)tpY.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var tD=this._getlocalMatrix(),tY=0;tY<16;++tY)this._worldMatrix[tY]=tD[tY];this._worldUpdate=!1}return this._worldMatrix},tY.setParent=function(tD){if(this._parent!==tD){if(this._parent){var tY=this._parent._childs,tg=tY.indexOf(this);tY.splice(tg,1)}tD&&(tD._childs.push(this),tD&&this._onWorldTransform()),this._parent=tD}},tO(tr,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),tr}(),t_Y=function(tD){function tY(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,tY.__super.call(this),this._destroyed=!1,this._id=tY._uniqueIDCounter,tY._uniqueIDCounter++}tN(tY,"laya.d3.component.Component3D",ts);var tg=tY.prototype;return tl.imps(tg,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),tg._initialize=function(tD){this._owner=tD,this._enable=!0,this.started=!1,this._load(tD)},tg._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},tg._load=function(tD){},tg._start=function(tD){},tg._update=function(tD){},tg._lateUpdate=function(tD){},tg._preRenderUpdate=function(tD){},tg._postRenderUpdate=function(tD){},tg._unload=function(tD){this.offAll()},tg._cloneTo=function(tD){},t$(0,tg,"id",function(){return this._id}),t$(0,tg,"destroyed",function(){return this._destroyed}),t$(0,tg,"owner",function(){return this._owner}),t$(0,tg,"enable",function(){return this._enable},function(tD){this._enable!==tD&&(this._enable=tD,this.event("enablechanged",this._enable))}),t$(0,tg,"isSingleton",function(){return tY._isSingleton}),tY._isSingleton=!0,tY._uniqueIDCounter=1,tY}(),tAY=function(tD){function tY(){this._destroyed=!1,tY.__super.call(this),this._destroyed=!1}tN(tY,"laya.d3.core.GeometryFilter",ts);var tg=tY.prototype;return tl.imps(tg,{"laya.resource.IDestroy":!0}),tg._destroy=function(){this.offAll(),this._destroyed=!0},t$(0,tg,"_isAsyncLoaded",function(){return!0}),t$(0,tg,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),t$(0,tg,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),t$(0,tg,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),t$(0,tg,"destroyed",function(){return this._destroyed}),tY}(),tqY=function(tD){function tT(tD){tT.__super.call(this),this._id=++tT._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new tLD(new tEY,new tEY),this._boundingBoxCenter=new tEY,this._boundingSphere=new tuD(new tEY,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=tD,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}tN(tT,"laya.d3.core.render.BaseRender",ts);var tY=tT.prototype;return tl.imps(tY,{"laya.resource.IDestroy":!0}),tY._changeMaterialReference=function(tD,tY){tD&&tD._removeReference(),tY._addReference()},tY._getInstanceMaterial=function(tD,tY){var tg=new tD.constructor;return tD.cloneTo(tg),tg.name=tg.name+"(Instance)",this._materialsInstance[tY]=!0,this._changeMaterialReference(this._materials[tY],tg),this._materials[tY]=tg},tY._setShaderValuelightMap=function(tD){this._setShaderValueTexture(3,tD)},tY._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},tY._renderRenderableBoundBox=function(){var tD=tlY._debugPhasorSprite,tY=this.boundingBox,tg=tT._tempBoundBoxCorners;tY.getCorners(tg),tD.line(tg[0],tT._greenColor,tg[1],tT._greenColor),tD.line(tg[2],tT._greenColor,tg[3],tT._greenColor),tD.line(tg[4],tT._greenColor,tg[5],tT._greenColor),tD.line(tg[6],tT._greenColor,tg[7],tT._greenColor),tD.line(tg[0],tT._greenColor,tg[3],tT._greenColor),tD.line(tg[1],tT._greenColor,tg[2],tT._greenColor),tD.line(tg[2],tT._greenColor,tg[6],tT._greenColor),tD.line(tg[3],tT._greenColor,tg[7],tT._greenColor),tD.line(tg[0],tT._greenColor,tg[4],tT._greenColor),tD.line(tg[1],tT._greenColor,tg[5],tT._greenColor),tD.line(tg[4],tT._greenColor,tg[7],tT._greenColor),tD.line(tg[5],tT._greenColor,tg[6],tT._greenColor)},tY._calculateBoundingSphere=function(){throw"BaseRender: must override it."},tY._calculateBoundingBox=function(){throw"BaseRender: must override it."},tY._setShaderValueTexture=function(tD,tY){this._owner._shaderValues.setValue(tD,tY)},tY._setShaderValueMatrix4x4=function(tD,tY){this._owner._shaderValues.setValue(tD,tY?tY.elements:null)},tY._setShaderValueColor=function(tD,tY){this._owner._shaderValues.setValue(tD,tY?tY.elements:null)},tY._setShaderValueBuffer=function(tD,tY){this._owner._shaderValues.setValue(tD,tY)},tY._setShaderValueInt=function(tD,tY){this._owner._shaderValues.setValue(tD,tY)},tY._setShaderValueBool=function(tD,tY){this._owner._shaderValues.setValue(tD,tY)},tY._setShaderValueNumber=function(tD,tY){this._owner._shaderValues.setValue(tD,tY)},tY._setShaderValueVector2=function(tD,tY){this._owner._shaderValues.setValue(tD,tY?tY.elements:null)},tY._addShaderDefine=function(tD){this._owner._shaderDefineValue|=tD},tY._removeShaderDefine=function(tD){this._owner._shaderDefineValue&=~tD},tY._renderUpdate=function(tD){return!0},tY._applyLightMapParams=function(){if(0<=this._lightmapIndex){var tD=this._owner.scene;if(tD){var tY=tD.getlightmaps()[this._lightmapIndex];tY?(this._addShaderDefine(tuY.SAHDERDEFINE_LIGHTMAP),tY.loaded?this._setShaderValuelightMap(tY):tY.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(tuY.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(tuY.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(tuY.SAHDERDEFINE_LIGHTMAP)},tY._updateOctreeNode=function(){var tD=this._treeNode;tD&&this._octreeNodeNeedChange&&(tD.updateObject(this),this._octreeNodeNeedChange=!1)},tY._destroy=function(){this.offAll();var tD=0,tY=0;for(tD=0,tY=this._renderElements.length;tD<tY;tD++)this._renderElements[tD]._destroy();for(tD=0,tY=this._materials.length;tD<tY;tD++)this._materials[tD]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},t$(0,tY,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),t$(0,tY,"id",function(){return this._id}),t$(0,tY,"material",function(){var tD=this._materials[0];if(tD&&!this._materialsInstance[0]){var tY=this._getInstanceMaterial(tD,0);this.event("materialchanged",[this,0,tY])}return this._materials[0]},function(tD){this.sharedMaterial=tD}),t$(0,tY,"sharedMaterial",function(){return this._materials[0]},function(tD){var tY=this._materials[0];tY!==tD&&(this._materials[0]=tD,this._materialsInstance[0]=!1,this._changeMaterialReference(tY,tD),this.event("materialchanged",[this,0,tD]))}),t$(0,tY,"lightmapIndex",function(){return this._lightmapIndex},function(tD){this._lightmapIndex=tD,this._applyLightMapParams()}),t$(0,tY,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(tD){this._lightmapScaleOffset=tD,this._setShaderValueColor(2,tD),this._addShaderDefine(tuY.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),t$(0,tY,"enable",function(){return this._enable},function(tD){this._enable=tD,this.event("enablechanged",[this,tD])}),t$(0,tY,"materials",function(){for(var tD=0,tY=this._materials.length;tD<tY;tD++)if(!this._materialsInstance[tD]){var tg=this._getInstanceMaterial(this._materials[tD],tD);this.event("materialchanged",[this,tD,tg])}return this._materials.slice()},function(tD){this.sharedMaterials=tD}),t$(0,tY,"sharedMaterials",function(){return this._materials.slice()},function(tD){if(!tD)throw new Error("MeshRender: shadredMaterials value can't be null.");var tY=tD.length;this._materialsInstance.length=tY;for(var tg=0;tg<tY;tg++){var tT=this._materials[tg];tT!==tD[tg]&&(this._materialsInstance[tg]=!1,this._changeMaterialReference(tT,tD[tg]),this.event("materialchanged",[this,tg,tD[tg]]))}this._materials=tD}),t$(0,tY,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),t$(0,tY,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var tD=this.boundingBox;tEY.add(tD.min,tD.max,this._boundingBoxCenter),tEY.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),t$(0,tY,"receiveShadow",function(){return this._receiveShadow},function(tD){this._receiveShadow!==tD&&((this._receiveShadow=tD)?this._addShaderDefine(tJY.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(tJY.SHADERDEFINE_RECEIVE_SHADOW))}),t$(0,tY,"destroyed",function(){return this._destroyed}),tT._uniqueIDCounter=0,tO(tT,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY,new tEY]},"_greenColor",function(){return this._greenColor=new tIY(0,1,0,1)}]),tT}(),tbY=function(tD){function tW(tD){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,tW.__super.call(this),this._localPosition=new tEY,this._localRotation=new tsY(0,0,0,1),this._localScale=new tEY(1,1,1),this._localRotationEuler=new tEY,this._localMatrix=new tgY,this._position=new tEY,this._rotation=new tsY(0,0,0,1),this._scale=new tEY(1,1,1),this._worldMatrix=new tgY,this._forward=new tEY,this._up=new tEY,this._right=new tEY,this._owner=tD,this._childs=[]}tN(tW,"laya.d3.core.Transform3D",ts);var tY=tW.prototype;return tY._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)tgY.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var tD=tW._tempVector30;tEY.multiply(this.pivot,this._localScale,tD);var tY=tW._tempVector31;tEY.subtract(tD,this.pivot,tY);var tg=tW._tempVector32,tT=this.localRotation;tEY.transformQuat(tD,tT,tg),tEY.subtract(tg,tD,tg);var tr=tW._tempVector33;tEY.subtract(this._localPosition,tY,tr),tEY.subtract(tr,tg,tr),tgY.createAffineTransformation(tr,tT,this._localScale,this._localMatrix)}},tY._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldPositionRotationTransform()}},tY._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldPositionScaleTransform()}},tY._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldPositionTransform()}},tY._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldPositionRotationTransform()}},tY._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldPositionScaleTransform()}},tY._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._onWorldTransform()}},tY.translate=function(tD,tY){void 0===tY&&(tY=!0),tY?(tgY.createFromQuaternion(this.localRotation,tW._tempMatrix0),tEY.transformCoordinate(tD,tW._tempMatrix0,tW._tempVector30),tEY.add(this.localPosition,tW._tempVector30,this._localPosition),this.localPosition=this._localPosition):(tEY.add(this.position,tD,this._position),this.position=this._position)},tY.rotate=function(tD,tY,tg){var tT;void 0===tY&&(tY=!0),void 0===tg&&(tg=!0),tT=tg?tD:(tEY.scale(tD,Math.PI/180,tW._tempVector30),tW._tempVector30),tsY.createFromYawPitchRoll(tT.y,tT.x,tT.z,tW._tempQuaternion0),tY?(tsY.multiply(this._localRotation,tW._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(tsY.multiply(tW._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},tY.lookAt=function(tD,tY,tg){void 0===tg&&(tg=!1);var tT,tr=tD.elements;if(tg){if(tT=this._localPosition.elements,Math.abs(tT[0]-tr[0])<tDY.zeroTolerance&&Math.abs(tT[1]-tr[1])<tDY.zeroTolerance&&Math.abs(tT[2]-tr[2])<tDY.zeroTolerance)return;tsY.lookAt(this._localPosition,tD,tY,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var ts=this.position;if(tT=ts.elements,Math.abs(tT[0]-tr[0])<tDY.zeroTolerance&&Math.abs(tT[1]-tr[1])<tDY.zeroTolerance&&Math.abs(tT[2]-tr[2])<tDY.zeroTolerance)return;tsY.lookAt(ts,tD,tY,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},t$(0,tY,"_isFrontFaceInvert",function(){var tD=this.scale,tY=tD.x<0;return tD.y<0&&(tY=!tY),tD.z<0&&(tY=!tY),tY}),t$(0,tY,"owner",function(){return this._owner}),t$(0,tY,"localRotation",function(){if(this._localQuaternionUpdate){var tD=this._localRotationEuler.elements;tsY.createFromYawPitchRoll(tD[1]/tW._angleToRandin,tD[0]/tW._angleToRandin,tD[2]/tW._angleToRandin,this._localRotation)}return this._localRotation},function(tD){this._localRotation=tD,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),t$(0,tY,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?tgY.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(tD){null===this._parent?tD.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),tgY.multiply(this._localMatrix,tD,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=tD,this._worldUpdate=!1}),t$(0,tY,"worldNeedUpdate",function(){return this._worldUpdate}),t$(0,tY,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(tD){this._localMatrix=tD,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),t$(0,tY,"dummy",function(){return this._dummy},function(tD){this._dummy!==tD&&(this._dummy&&(this._dummy._entity=null),tD&&(tD._entity=this),this._dummy=tD)}),t$(0,tY,"localPosition",function(){return this._localPosition},function(tD){this._localPosition=tD,this._localUpdate=!0,this._onWorldPositionTransform()}),t$(0,tY,"position",function(){if(this._positionUpdate){if(null!=this._parent){var tD=this._parent.position;tEY.multiply(this._localPosition,this._parent.scale,tW._tempVector30),tEY.transformQuat(tW._tempVector30,this._parent.rotation,tW._tempVector30),tEY.add(tD,tW._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(tD){if(null!=this._parent){tEY.subtract(tD,this._parent.position,this._localPosition);var tY=this._parent.scale.elements,tg=tY[0],tT=tY[1],tr=tY[2];if(1!==tg||1!==tT||1!==tr){var ts=tW._tempVector30,ta=ts.elements;ta[0]=1/tg,ta[1]=1/tT,ta[2]=1/tr,tEY.multiply(this._localPosition,ts,this._localPosition)}this._parent.rotation.invert(tW._tempQuaternion0),tEY.transformQuat(this._localPosition,tW._tempQuaternion0,this._localPosition)}else tD.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=tD,this._positionUpdate=!1}),t$(0,tY,"localScale",function(){return this._localScale},function(tD){this._localScale=tD,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),t$(0,tY,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(tW._tempVector30);var tD=tW._tempVector30.elements,tY=this._localRotationEuler.elements;tY[0]=tD[1]*tW._angleToRandin,tY[1]=tD[0]*tW._angleToRandin,tY[2]=tD[2]*tW._angleToRandin}return this._localRotationEuler},function(tD){this._localRotationEuler=tD,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),t$(0,tY,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?tsY.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(tD){null!=this._parent?(this._parent.rotation.invert(tW._tempQuaternion0),tsY.multiply(tD,tW._tempQuaternion0,this._localRotation)):tD.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=tD,this._rotationUpdate=!1}),t$(0,tY,"scale",function(){return this._scaleUpdate&&(null!==this._parent?tEY.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(tD){if(null!==this._parent){var tY=this._parent.scale.elements,tg=tW._tempVector30.elements;tg[0]=1/tY[0],tg[1]=1/tY[1],tg[2]=1/tY[2],tEY.multiply(tD,tW._tempVector30,this._localScale)}else tD.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=tD,this._scaleUpdate=!1}),t$(0,tY,"rotationEuler",null,function(tD){tsY.createFromYawPitchRoll(tD.y,tD.x,tD.z,this._rotation),this.rotation=this._rotation}),t$(0,tY,"forward",function(){var tD=this.worldMatrix.elements;return this._forward.elements[0]=-tD[8],this._forward.elements[1]=-tD[9],this._forward.elements[2]=-tD[10],this._forward}),t$(0,tY,"up",function(){var tD=this.worldMatrix.elements;return this._up.elements[0]=tD[4],this._up.elements[1]=tD[5],this._up.elements[2]=tD[6],this._up}),t$(0,tY,"right",function(){var tD=this.worldMatrix.elements;return this._right.elements[0]=tD[0],this._right.elements[1]=tD[1],this._right.elements[2]=tD[2],this._right}),t$(0,tY,"parent",function(){return this._parent},function(tD){if(this._parent!==tD){if(this._parent){var tY=this._parent._childs,tg=tY.indexOf(this);tY.splice(tg,1)}tD&&(tD._childs.push(this),tD&&this._onWorldTransform()),this._parent=tD}}),tO(tW,["_tempVector30",function(){return this._tempVector30=new tEY},"_tempVector31",function(){return this._tempVector31=new tEY},"_tempVector32",function(){return this._tempVector32=new tEY},"_tempVector33",function(){return this._tempVector33=new tEY},"_tempQuaternion0",function(){return this._tempQuaternion0=new tsY},"_tempMatrix0",function(){return this._tempMatrix0=new tgY},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),tW}(),tGY=(function(tD){function tY(){this._rotation=0,this._matNeedUpdte=!1,tY.__super.call(this),this._matrix=new tgY,this._offset=new tMY,this._tiling=new tMY(1,1)}tN(tY,"laya.d3.core.TransformUV",ts);var tg=tY.prototype;tl.imps(tg,{"laya.d3.core.IClone":!0}),tg._updateMatrix=function(){tY._tempOffsetV3.elements[0]=this._offset.x,tY._tempOffsetV3.elements[1]=this._offset.y,tsY.createFromYawPitchRoll(0,0,this._rotation,tY._tempRotationQua),tY._tempTitlingV3.elements[0]=this._tiling.x,tY._tempTitlingV3.elements[1]=this._tiling.y,tgY.createAffineTransformation(tY._tempOffsetV3,tY._tempRotationQua,tY._tempTitlingV3,this._matrix)},tg.cloneTo=function(tD){tD._matrix=this._matrix.clone(),tD._offset=this._offset.clone(),tD._rotation=this._rotation,tD._tiling=this._tiling.clone()},tg.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tg,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),t$(0,tg,"tiling",function(){return this._tiling},function(tD){this._tiling=tD,this._matNeedUpdte=!0}),t$(0,tg,"offset",function(){return this._offset},function(tD){this._offset=tD,this._matNeedUpdte=!0}),t$(0,tg,"rotation",function(){return this._rotation},function(tD){this._rotation=tD,this._matNeedUpdte=!0}),tO(tY,["_tempOffsetV3",function(){return this._tempOffsetV3=new tEY(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new tsY},"_tempTitlingV3",function(){return this._tempTitlingV3=new tEY(1,1,1)}])}(),function(tg){function tD(){this.x=NaN,this.y=NaN,this.z=NaN,tD.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}tN(tD,"laya.d3.core.particleShuriKen.module.shape.BoxShape",tg);var tY=tD.prototype;tY._getShapeBoundBox=function(tD){var tY=tD.min.elements;tY[0]=.5*-this.x,tY[1]=.5*-this.y,tY[2]=.5*-this.z;var tg=tD.max.elements;tg[0]=.5*this.x,tg[1]=.5*this.y,tg[2]=.5*this.z},tY._getSpeedBoundBox=function(tD){var tY=tD.min.elements;tY[0]=0,tY[1]=0,tY[2]=0;var tg=tD.max.elements;tg[0]=0,tg[1]=1,tg[2]=0},tY.generatePositionAndDirection=function(tD,tY,tg,tT){var tr=tD.elements,ts=tY.elements;tg?(tg.seed=tT[16],te._randomPointInsideHalfUnitBox(tD,tg),tT[16]=tg.seed):te._randomPointInsideHalfUnitBox(tD),tr[0]=this.x*tr[0],tr[1]=this.y*tr[1],tr[2]=this.z*tr[2],this.randomDirection?tg?(tg.seed=tT[17],te._randomPointUnitSphere(tY,tg),tT[17]=tg.seed):te._randomPointUnitSphere(tY):(ts[0]=0,ts[1]=0,ts[2]=1)},tY.cloneTo=function(tD){tg.prototype.cloneTo.call(this,tD);var tY=tD;tY.x=this.x,tY.y=this.y,tY.z=this.z,tY.randomDirection=this.randomDirection}}(tU),function(tg){function ta(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,ta.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}tN(ta,"laya.d3.core.particleShuriKen.module.shape.CircleShape",tg);var tD=ta.prototype;tD._getShapeBoundBox=function(tD){var tY=tD.min.elements;tY[0]=tY[2]=-this.radius,tY[1]=0;var tg=tD.max.elements;tg[0]=tg[2]=this.radius,tg[1]=0},tD._getSpeedBoundBox=function(tD){var tY=tD.min.elements;tY[0]=tY[1]=-1,tY[2]=0;var tg=tD.max.elements;tg[0]=tg[1]=1,tg[2]=0},tD.generatePositionAndDirection=function(tD,tY,tg,tT){var tr=tD.elements,ts=ta._tempPositionPoint.elements;tg?(tg.seed=tT[16],this.emitFromEdge?te._randomPointUnitArcCircle(this.arc,ta._tempPositionPoint,tg):te._randomPointInsideUnitArcCircle(this.arc,ta._tempPositionPoint,tg),tT[16]=tg.seed):this.emitFromEdge?te._randomPointUnitArcCircle(this.arc,ta._tempPositionPoint):te._randomPointInsideUnitArcCircle(this.arc,ta._tempPositionPoint),tr[0]=-ts[0],tr[1]=ts[1],tr[2]=0,tEY.scale(tD,this.radius,tD),this.randomDirection?tg?(tg.seed=tT[17],te._randomPointUnitSphere(tY,tg),tT[17]=tg.seed):te._randomPointUnitSphere(tY):tD.cloneTo(tY)},tD.cloneTo=function(tD){tg.prototype.cloneTo.call(this,tD);var tY=tD;tY.radius=this.radius,tY.arc=this.arc,tY.emitFromEdge=this.emitFromEdge,tY.randomDirection=this.randomDirection},tO(ta,["_tempPositionPoint",function(){return this._tempPositionPoint=new tMY}])}(tU),function(tg){function tC(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,tC.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}tN(tC,"laya.d3.core.particleShuriKen.module.shape.ConeShape",tg);var tD=tC.prototype;tD._getShapeBoundBox=function(tD){var tY=this.radius+this.length*Math.sin(this.angle),tg=this.length*Math.cos(this.angle),tT=tD.min.elements;tT[0]=tT[1]=-tY,tT[2]=0;var tr=tD.max.elements;tr[0]=tr[1]=tY,tr[2]=tg},tD._getSpeedBoundBox=function(tD){var tY=Math.sin(this.angle),tg=tD.min.elements;tg[0]=tg[1]=-tY,tg[2]=0;var tT=tD.max.elements;tT[0]=tg[1]=tY,tT[2]=1},tD.generatePositionAndDirection=function(tD,tY,tg,tT){var tr,ts=tD.elements,ta=tY.elements,tW=tC._tempPositionPoint.elements,tM=NaN,tE=NaN,tI=Math.cos(this.angle),tO=Math.sin(this.angle);switch(this.emitType){case 0:tg?(tg.seed=tT[16],te._randomPointInsideUnitCircle(tC._tempPositionPoint,tg),tT[16]=tg.seed):te._randomPointInsideUnitCircle(tC._tempPositionPoint),tM=tW[0],tE=tW[1],ts[0]=tM*this.radius,ts[1]=tE*this.radius,ts[2]=0,this.randomDirection?(tg?(tg.seed=tT[17],te._randomPointInsideUnitCircle(tC._tempDirectionPoint,tg),tT[17]=tg.seed):te._randomPointInsideUnitCircle(tC._tempDirectionPoint),tr=tC._tempDirectionPoint.elements,ta[0]=tr[0]*tO,ta[1]=tr[1]*tO):(ta[0]=tM*tO,ta[1]=tE*tO),ta[2]=tI;break;case 1:tg?(tg.seed=tT[16],te._randomPointUnitCircle(tC._tempPositionPoint,tg),tT[16]=tg.seed):te._randomPointUnitCircle(tC._tempPositionPoint),tM=tW[0],tE=tW[1],ts[0]=tM*this.radius,ts[1]=tE*this.radius,ts[2]=0,this.randomDirection?(tg?(tg.seed=tT[17],te._randomPointInsideUnitCircle(tC._tempDirectionPoint,tg),tT[17]=tg.seed):te._randomPointInsideUnitCircle(tC._tempDirectionPoint),tr=tC._tempDirectionPoint.elements,ta[0]=tr[0]*tO,ta[1]=tr[1]*tO):(ta[0]=tM*tO,ta[1]=tE*tO),ta[2]=tI;break;case 2:tg?(tg.seed=tT[16],te._randomPointInsideUnitCircle(tC._tempPositionPoint,tg)):te._randomPointInsideUnitCircle(tC._tempPositionPoint),tM=tW[0],tE=tW[1],ts[0]=tM*this.radius,ts[1]=tE*this.radius,ta[ts[2]=0]=tM*tO,ta[1]=tE*tO,ta[2]=tI,tEY.normalize(tY,tY),tg?(tEY.scale(tY,this.length*tg.getFloat(),tY),tT[16]=tg.seed):tEY.scale(tY,this.length*Math.random(),tY),tEY.add(tD,tY,tD),this.randomDirection&&(tg?(tg.seed=tT[17],te._randomPointUnitSphere(tY,tg),tT[17]=tg.seed):te._randomPointUnitSphere(tY));break;case 3:tg?(tg.seed=tT[16],te._randomPointUnitCircle(tC._tempPositionPoint,tg)):te._randomPointUnitCircle(tC._tempPositionPoint),tM=tW[0],tE=tW[1],ts[0]=tM*this.radius,ts[1]=tE*this.radius,ta[ts[2]=0]=tM*tO,ta[1]=tE*tO,ta[2]=tI,tEY.normalize(tY,tY),tg?(tEY.scale(tY,this.length*tg.getFloat(),tY),tT[16]=tg.seed):tEY.scale(tY,this.length*Math.random(),tY),tEY.add(tD,tY,tD),this.randomDirection&&(tg?(tg.seed=tT[17],te._randomPointUnitSphere(tY,tg),tT[17]=tg.seed):te._randomPointUnitSphere(tY));break;default:throw new Error("ConeShape:emitType is invalid.")}},tD.cloneTo=function(tD){tg.prototype.cloneTo.call(this,tD);var tY=tD;tY.angle=this.angle,tY.radius=this.radius,tY.length=this.length,tY.emitType=this.emitType,tY.randomDirection=this.randomDirection},tO(tC,["_tempPositionPoint",function(){return this._tempPositionPoint=new tMY},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new tMY}])}(tU),function(tg){function tD(){this.radius=NaN,this.emitFromShell=!1,tD.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}tN(tD,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",tg);var tY=tD.prototype;tY._getShapeBoundBox=function(tD){var tY=tD.min.elements;tY[0]=tY[1]=tY[2]=-this.radius;var tg=tD.max.elements;tg[0]=tg[1]=this.radius,tg[2]=0},tY._getSpeedBoundBox=function(tD){var tY=tD.min.elements;tY[0]=tY[1]=-1,tY[2]=0;var tg=tD.max.elements;tg[0]=tg[1]=tg[2]=1},tY.generatePositionAndDirection=function(tD,tY,tg,tT){var tr=tD.elements;tg?(tg.seed=tT[16],this.emitFromShell?te._randomPointUnitSphere(tD,tg):te._randomPointInsideUnitSphere(tD,tg),tT[16]=tg.seed):this.emitFromShell?te._randomPointUnitSphere(tD):te._randomPointInsideUnitSphere(tD),tEY.scale(tD,this.radius,tD);var ts=tr[2];ts<0&&(tr[2]=-1*ts),this.randomDirection?tg?(tg.seed=tT[17],te._randomPointUnitSphere(tY,tg),tT[17]=tg.seed):te._randomPointUnitSphere(tY):tD.cloneTo(tY)},tY.cloneTo=function(tD){tg.prototype.cloneTo.call(this,tD);var tY=tD;tY.radius=this.radius,tY.emitFromShell=this.emitFromShell,tY.randomDirection=this.randomDirection}}(tU),function(tg){function tD(){this.radius=NaN,this.emitFromShell=!1,tD.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}tN(tD,"laya.d3.core.particleShuriKen.module.shape.SphereShape",tg);var tY=tD.prototype;tY._getShapeBoundBox=function(tD){var tY=tD.min.elements;tY[0]=tY[1]=tY[2]=-this.radius;var tg=tD.max.elements;tg[0]=tg[1]=tg[2]=this.radius},tY._getSpeedBoundBox=function(tD){var tY=tD.min.elements;tY[0]=tY[1]=tY[2]=-1;var tg=tD.max.elements;tg[0]=tg[1]=tg[2]=1},tY.generatePositionAndDirection=function(tD,tY,tg,tT){tg?(tg.seed=tT[16],this.emitFromShell?te._randomPointUnitSphere(tD,tg):te._randomPointInsideUnitSphere(tD,tg),tT[16]=tg.seed):this.emitFromShell?te._randomPointUnitSphere(tD):te._randomPointInsideUnitSphere(tD),tEY.scale(tD,this.radius,tD),this.randomDirection?tg?(tg.seed=tT[17],te._randomPointUnitSphere(tY,tg),tT[17]=tg.seed):te._randomPointUnitSphere(tY):tD.cloneTo(tY)},tY.cloneTo=function(tD){tg.prototype.cloneTo.call(this,tD);var tY=tD;tY.radius=this.radius,tY.emitFromShell=this.emitFromShell,tY.randomDirection=this.randomDirection}}(tU),function(tD){function tY(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,tY.__super.call(this)}return tN(tY,"laya.d3.core.render.SubMeshRenderElement",tK),tY}()),tXY=function(tD){function tJ(tD,tY,tg,tT,tr,ts){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=tD,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[tJY.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[tuY.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[tuY.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[tiY.SHADERDEFINE_ALPHATEST]="ALPHATEST";tJ.__super.call(this,tD,tY,tg,null,{}),this._attributeMap=tT;var ta;for(ta in tr){var tW=tr[ta];switch(tW[1]){case 0:this._renderElementUniformMap[ta]=tW[0];break;case 1:this._materialUniformMap[ta]=tW[0];break;case 2:this._spriteUniformMap[ta]=tW[0];break;case 3:this._cameraUniformMap[ta]=tW[0];break;case 4:this._sceneUniformMap[ta]=tW[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}tN(tJ,"laya.d3.shader.ShaderCompile3D",tZ);var tY=tJ.prototype;return tY._definesToNameDic=function(tD,tY){for(var tg={},tT=1,tr=0;tr<32&&!(tD<(tT=1<<tr));tr++)if(tD&tT){var ts=tY[tT];ts&&(tg[ts]="")}return tg},tY.withCompile=function(tD,tY,tg,tT){var tr,ts,ta;if(ts=this.sharders[tD])if(ta=ts[tY]){if(tr=ta[tg])return tr}else ta=ts[tY]=[];else ta=(ts=this.sharders[tD]=[])[tY]=[];var tW,tM=this._definesToNameDic(tD,tJ._globalInt2name),tE=this._definesToNameDic(tY,this._spriteInt2name),tI=this._definesToNameDic(tg,this._materialInt2name);laya.d3.shader.ShaderCompile3D.debugMode;var tO={},tC="";if(tM)for(tW in tM)tC+="#define "+tW+"\n",tO[tW]=!0;if(tE)for(tW in tE)tC+="#define "+tW+"\n",tO[tW]=!0;if(tI)for(tW in tI)tC+="#define "+tW+"\n",tO[tW]=!0;var tN=tcY.nameKey.getName(this._name)+" compile ("+tD+","+tY+","+tg+")",t$=this._VS.toscript(tO,[]),td=this._PS.toscript(tO,[]);th.now();if(tr=tcY.create(tC+t$.join("\n"),tC+td.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,tT,tN),ta[tg]=tr,laya.d3.shader.ShaderCompile3D.debugMode)th.now();return tr},tY.precompileShaderWithShaderDefine=function(tD,tY,tg){this.withCompile(tD,tY,tg,!0)},tY.addMaterialDefines=function(tD){var tY=tD.defines;for(var tg in tY){var tT=tY[tg],tr=parseInt(tg);this._materialInt2name[tr]=tT,this._materialName2Int[tT]=tr}},tY.addSpriteDefines=function(tD){var tY=tD.defines;for(var tg in tY){var tT=tY[tg],tr=parseInt(tg);this._spriteInt2name[tr]=tT,this._spriteName2Int[tT]=tr}},tY.getMaterialDefineByName=function(tD){return this._materialName2Int[tD]},tY.registerMaterialDefine=function(tD){var tY=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[tY]=tD,this._materialName2Int[tD]=tY},tY.registerSpriteDefine=function(tD){var tY=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[tY]=tD,this._spriteName2Int[tD]=tY},tJ._globalRegDefine=function(tD,tY){tJ._globalInt2name[tY]=tD},tJ.add=function(tD,tY,tg,tT,tr){return laya.d3.shader.ShaderCompile3D._preCompileShader[tD]=new tJ(tD,tY,tg,tT,tr,tZ.includes)},tJ.get=function(tD){return laya.d3.shader.ShaderCompile3D._preCompileShader[tcY.nameKey.getID(tD)]},tJ._preCompileShader={},tJ._globalInt2name=[],tJ.debugMode=!1,tJ.SHADERDEFINE_HIGHPRECISION=1,tJ.SHADERDEFINE_FOG=4,tJ.SHADERDEFINE_DIRECTIONLIGHT=8,tJ.SHADERDEFINE_POINTLIGHT=16,tJ.SHADERDEFINE_SPOTLIGHT=32,tJ.SHADERDEFINE_UV0=64,tJ.SHADERDEFINE_COLOR=128,tJ.SHADERDEFINE_UV1=256,tJ.SAHDERDEFINE_DEPTHFOG=131072,tJ}(),tzY=function(tD){function t$(){t$.__super.call(this)}tN(t$,"laya.d3.graphics.MeshSprite3DStaticBatchManager",tTD);var tY=t$.prototype;return tY._getStaticBatch=function(tD,tY,tg,tT){var tr,ts;return ts=tD?tD.id.toString()+tg.id.toString()+tY.id.toString()+tT.toString():tg.id.toString()+tY.id.toString()+tT.toString(),this._staticBatches[ts]?tr=this._staticBatches[ts]:this._staticBatches[ts]=tr=new tmY(ts,this,tD,tY,tg),tr},tY._initStaticBatchs=function(tD){var tY,tg;this._initBatchRenderElements.sort(t$._sortPrepareStaticBatch);for(var tT,tr=!1,ts=0,ta=0,tW=this._initBatchRenderElements.length;ta<tW;ta++){var tM,tE=this._initBatchRenderElements[ta],tI=tE.renderObj._getVertexBuffer(0);tE._sprite3D;if(tg===tI.vertexDeclaration&&tY===tE._material)if(tr)tT._addCombineBatchRenderObjTest(tE)?(tM=tE._staticBatch)!==tT&&(tM&&tM._deleteCombineBatchRenderObj(tE),tT._addCombineBatchRenderObj(tE)):(tr=!1,ts++);else{var tO=this._initBatchRenderElements[ta-1],tC=tO.renderObj,tN=tE.renderObj;tr=!(65535<tC._getVertexBuffer().vertexCount+tN._getVertexBuffer().vertexCount)&&(tT=this._getStaticBatch(tD,tg,tY,ts),(tM=tO._staticBatch)!==tT&&(tM&&tM._deleteCombineBatchRenderObj(tO),tT._addCombineBatchRenderObj(tO)),(tM=tE._staticBatch)!==tT&&(tM&&tM._deleteCombineBatchRenderObj(tE),tT._addCombineBatchRenderObj(tE)),!0)}else tr=!1,ts=0;tY=tE._material,tg=tI.vertexDeclaration}},t$._sortPrepareStaticBatch=function(tD,tY){var tg=tD._render,tT=tY._render,tr=tg.lightmapIndex-tT.lightmapIndex;if(0!=tr)return tr;var ts=tg.receiveShadow-tT.receiveShadow;if(0!=ts)return ts;var ta=tD._mainSortID-tY._mainSortID;return 0==ta?tD.renderObj.triangleCount-tY.renderObj.triangleCount:ta},t$}(),tmY=function(tD){function ts(tD,tY,tg,tT,tr){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,ts.__super.call(this,tD,tY,tg),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=tT,this._material=tr}tN(ts,"laya.d3.graphics.SubMeshStaticBatch",trD);var tY=ts.prototype;return tY._compareBatchRenderElement=function(tD,tY){return tD._batchIndexStart>tY._batchIndexStart},tY._addCombineBatchRenderObjTest=function(tD){var tY=tD.renderObj._vertexCount;return!(65535<(0<tY?this._currentCombineVertexCount+tY:this._currentCombineVertexCount+tD.renderObj._getVertexBuffer().vertexCount))},tY._addCombineBatchRenderObj=function(tD){var tY=tD.renderObj,tg=tY._vertexCount;this._initBatchRenderElements.push(tD),tD._staticBatch=this,0<tg?(this._currentCombineIndexCount+=tY._indexCount,this._currentCombineVertexCount+=tg):(this._currentCombineIndexCount=this._currentCombineIndexCount+tY._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+tY._getVertexBuffer().vertexCount),this._needFinishCombine=!0},tY._deleteCombineBatchRenderObj=function(tD){var tY=tD.renderObj,tg=this._initBatchRenderElements.indexOf(tD);if(-1!==tg){this._initBatchRenderElements.splice(tg,1),tD._staticBatch=null;var tT=tY._vertexCount;0<tT?(this._currentCombineIndexCount=this._currentCombineIndexCount-tY._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-tT):(this._currentCombineIndexCount=this._currentCombineIndexCount-tY._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-tY._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},tY._finishInit=function(){if(this._needFinishCombine){var tD=0,tY=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var tg=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),tT=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=tkY.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=teY.create("ushort",this._currentCombineIndexCount,35044);for(var tr=0,ts=this._initBatchRenderElements.length;tr<ts;tr++){var ta=this._initBatchRenderElements[tr],tW=ta.renderObj,tM=tW._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,ta._sprite3D),tE=tW.getIndices(),tI=ta._sprite3D.transform._isFrontFaceInvert,tO=tD/(this._vertexDeclaration.vertexStride/4)-tW._vertexStart,tC=tY,tN=tC+tE.length;ta._batchIndexStart=tC,ta._batchIndexEnd=tN,tT.set(tE,tY);var t$=0;if(tI)for(t$=tC;t$<tN;t$+=3){tT[t$]=tO+tT[t$];var td=tT[t$+1],tJ=tT[t$+2];tT[t$+1]=tO+tJ,tT[t$+2]=tO+td}else for(t$=tC;t$<tN;t$+=3)tT[t$]=tO+tT[t$],tT[t$+1]=tO+tT[t$+1],tT[t$+2]=tO+tT[t$+2];tY+=tE.length,tg.set(tM,tD),tD+=tM.length}this._vertexBuffer.setData(tg),this._indexBuffer.setData(tT),this._needFinishCombine=!1}},tY._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new tGY)},tY._getRenderElement=function(tD,tY,tg){for(var tT,tr,ts=this._batchRenderElements.length,ta=!0,tW=0;tW<ts;tW++){var tM,tE,tI=(tr=this._batchRenderElements[tW])._sprite3D._render;if(0!==tW&&(ta=(tM=(tT=this._batchRenderElements[tW-1])._sprite3D._render).lightmapIndex!==tI.lightmapIndex||tM.receiveShadow!==tI.receiveShadow||tT._batchIndexEnd!==tr._batchIndexStart),ta){(tE=this._getCombineRenderElementFromPool()).renderObj=this,tE._material=this._material,tE._batchIndexStart=tr._batchIndexStart,tE._batchIndexEnd=tr._batchIndexEnd;var tO=tI.lightmapIndex,tC=tO+1,tN=this._batchOwnerIndices[tC];tN||(tN=this._batchOwnerIndices[tC]=[]);var t$,td=tN[tr._render.receiveShadow?1:0];void 0===td?(tN[tI.receiveShadow?1:0]=this._batchOwners.length,(t$=new tDg(null,"StaticBatchMeshSprite3D"))._scene=tY,t$._transform=this._rootOwner?this._rootOwner._transform:null,t$._render.lightmapIndex=tO,t$._render.receiveShadow=tr._render.receiveShadow,this._batchOwners.push(t$)):t$=this._batchOwners[td],t$._render._renderUpdate(tg),tE._sprite3D=t$,tD.push(tE)}else tE._batchIndexEnd=tr._batchIndexEnd}},tY._beforeRender=function(tD){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},tY._render=function(tD){var tY=tD.renderElement,tg=tY._batchIndexStart,tT=tY._batchIndexEnd-tg;tz.mainContext.drawElements(4,tT,5123,2*tg),tA.drawCall++,tA.trianglesFaces+=tT/3},tY.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},tY._getVertexBuffer=function(tD){return void 0===tD&&(tD=0),this._vertexBuffer},ts}(),thY=function(tD){function tY(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,tY.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}tN(tY,"laya.d3.core.ComponentNode",tI);var tg=tY.prototype;return tg.addComponent=function(tD){var tY,tg=this._componentsMap.indexOf(tD);if(-1===tg)tY=[],this._componentsMap.push(tD),this._typeComponentsIndices.push(tY);else if(tY=this._typeComponentsIndices[tg],this._components[tY[0]].isSingleton)throw new Error("无法单实例创建"+tD+"组件，"+tD+"组件已存在！");var tT=tM.getInstance(tD);return tY.push(this._components.length),this._components.push(tT),tT instanceof laya.d3.component.Script&&this._scripts.push(tT),tT._initialize(this),tT},tg._removeComponent=function(tD,tY){var tg=this._typeComponentsIndices[tD],tT=tg[tY],tr=this._components[tT];this._components.splice(tT,1),tr instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(tr),1),tg.splice(tY,1),0===tg.length&&(this._typeComponentsIndices.splice(tD,1),this._componentsMap.splice(tD,1));for(var ts=0,ta=this._componentsMap.length;ts<ta;ts++)for(var tW=(tg=this._typeComponentsIndices[ts]).length-1;0<=tW;tW--){var tM=tg[tW];if(!(tT<tM))break;tg[tW]=--tM}tr._destroy()},tg.getComponentByType=function(tD,tY){void 0===tY&&(tY=0);var tg=this._componentsMap.indexOf(tD);return-1===tg?null:this._components[this._typeComponentsIndices[tg][tY]]},tg.getComponentsByType=function(tD,tY){var tg=this._componentsMap.indexOf(tD);if(-1!==tg){var tT=this._typeComponentsIndices[tg],tr=tT.length;tY.length=tr;for(var ts=0;ts<tr;ts++)tY[ts]=this._components[tT[ts]]}else tY.length=0},tg.getComponentByIndex=function(tD){return this._components[tD]},tg.removeComponentByType=function(tD,tY){void 0===tY&&(tY=0);var tg=this._componentsMap.indexOf(tD);-1!==tg&&this._removeComponent(tg,tY)},tg.removeComponentsByType=function(tD){var tY=this._componentsMap.indexOf(tD);if(-1!==tY)for(var tg=this._typeComponentsIndices[tY],tT=0,tr=tg.length;tT<tr;tg.length<tr?tr--:tT++)this._removeComponent(tY,tT)},tg.removeAllComponent=function(){for(var tD=0,tY=this._componentsMap.length;tD<tY;this._componentsMap.length<tY?tY--:tD++)this.removeComponentsByType(this._componentsMap[tD])},tg._updateComponents=function(tD){for(var tY=0,tg=this._components.length;tY<tg;tY++){var tT=this._components[tY];!tT.started&&(tT._start(tD),tT.started=!0),tT.enable&&tT._update(tD)}},tg._lateUpdateComponents=function(tD){for(var tY=0;tY<this._components.length;tY++){var tg=this._components[tY];!tg.started&&(tg._start(tD),tg.started=!0),tg.enable&&tg._lateUpdate(tD)}},tg._preRenderUpdateComponents=function(tD){for(var tY=0;tY<this._components.length;tY++){var tg=this._components[tY];!tg.started&&(tg._start(tD),tg.started=!0),tg.enable&&tg._preRenderUpdate(tD)}},tg._postRenderUpdateComponents=function(tD){for(var tY=0;tY<this._components.length;tY++){var tg=this._components[tY];!tg.started&&(tg._start(tD),tg.started=!0),tg.enable&&tg._postRenderUpdate(tD)}},tY}(),tiY=function(tT){function tD(){tD.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new tdY,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new tIY(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}tN(tD,"laya.d3.core.material.BaseMaterial",tT);var tY=tD.prototype;return tl.imps(tY,{"laya.d3.core.IClone":!0}),tY._addShaderDefine=function(tD){this._shaderDefineValue|=tD},tY._removeShaderDefine=function(tD){this._shaderDefineValue&=~tD},tY._addDisablePublicShaderDefine=function(tD){this._disablePublicShaderDefine|=tD},tY._removeDisablePublicShaderDefine=function(tD){this._disablePublicShaderDefine&=~tD},tY._setBuffer=function(tD,tY){this._shaderValues.setValue(tD,tY),this._values[tD]=tY},tY._getBuffer=function(tD){return this._values[tD]},tY._setMatrix4x4=function(tD,tY){this._shaderValues.setValue(tD,tY?tY.elements:null),this._values[tD]=tY},tY._getMatrix4x4=function(tD){return this._values[tD]},tY._setInt=function(tD,tY){this._shaderValues.setValue(tD,tY),this._values[tD]=tY},tY._getInt=function(tD){return this._values[tD]},tY._setNumber=function(tD,tY){this._shaderValues.setValue(tD,tY),this._values[tD]=tY},tY._getNumber=function(tD){return this._values[tD]},tY._setBool=function(tD,tY){this._shaderValues.setValue(tD,tY),this._values[tD]=tY},tY._getBool=function(tD){return this._values[tD]},tY._setVector2=function(tD,tY){this._shaderValues.setValue(tD,tY?tY.elements:null),this._values[tD]=tY},tY._getVector2=function(tD){return this._values[tD]},tY._setColor=function(tD,tY){this._shaderValues.setValue(tD,tY?tY.elements:null),this._values[tD]=tY},tY._getColor=function(tD){return this._values[tD]},tY._setTexture=function(tD,tY){var tg=this._values[tD];this._values[tD]=tY,this._shaderValues.setValue(tD,tY),0<this.referenceCount&&(tg&&tg._removeReference(),tY&&tY._addReference())},tY._getTexture=function(tD){return this._values[tD]},tY._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},tY._getShader=function(tD,tY,tg){var tT=(tD|tY)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(tT,tg,this._shaderDefineValue),this._shader},tY._setRenderStateBlendDepth=function(){var tD=tz.mainContext;switch(tm.setDepthMask(tD,this.depthWrite),0===this.depthTest?tm.setDepthTest(tD,!1):(tm.setDepthTest(tD,!0),tm.setDepthFunc(tD,this.depthTest)),this.blend){case 0:tm.setBlend(tD,!1);break;case 1:tm.setBlend(tD,!0),tm.setBlendFunc(tD,this.srcBlend,this.dstBlend);break;case 2:tm.setBlend(tD,!0)}},tY._setRenderStateFrontFace=function(tD,tY){var tg=tz.mainContext,tT=0;switch(this.cull){case 0:tm.setCullFace(tg,!1);break;case 1:tm.setCullFace(tg,!0),tT=tD?tY&&tY._isFrontFaceInvert?2305:2304:tY&&tY._isFrontFaceInvert?2304:2305,tm.setFrontFace(tg,tT);break;case 2:tm.setCullFace(tg,!0),tT=tD?tY&&tY._isFrontFaceInvert?2304:2305:tY&&tY._isFrontFaceInvert?2305:2304,tm.setFrontFace(tg,tT)}},tY.onAsynLoaded=function(tD,tY,tg){var tT=tY[0],tr=tY[1];switch(tT.version){case"LAYAMATERIAL:01":var ts=0,ta=0,tW=tT.props;for(var tM in tW)switch(tM){case"vectors":var tE=tW[tM];for(ts=0,ta=tE.length;ts<ta;ts++){var tI=tE[ts],tO=tI.value;switch(tO.length){case 2:this[tI.name]=new tMY(tO[0],tO[1]);break;case 3:this[tI.name]=new tEY(tO[0],tO[1],tO[2]);break;case 4:this[tI.name]=new tIY(tO[0],tO[1],tO[2],tO[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var tC=tW[tM];for(ts=0,ta=tC.length;ts<ta;ts++){var tN=tC[ts],t$=tN.path;t$&&(this[tN.name]=tx.getRes(tr[t$]))}break;case"defines":var td=tW[tM];for(ts=0,ta=td.length;ts<ta;ts++){var tJ=this._shaderCompile.getMaterialDefineByName(td[ts]);this._addShaderDefine(tJ)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[tM]=tW[tM];break;case"renderQueue":switch(tW[tM]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[tM]=tW[tM]}break;case"LAYAMATERIAL:02":for(tM in tW=tT.props)switch(tM){case"vectors":for(ts=0,ta=(tE=tW[tM]).length;ts<ta;ts++)switch((tO=(tI=tE[ts]).value).length){case 2:this[tI.name]=new tMY(tO[0],tO[1]);break;case 3:this[tI.name]=new tEY(tO[0],tO[1],tO[2]);break;case 4:this[tI.name]=new tIY(tO[0],tO[1],tO[2],tO[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(ts=0,ta=(tC=tW[tM]).length;ts<ta;ts++)(t$=(tN=tC[ts]).path)&&(this[tN.name]=tx.getRes(tr[t$]));break;case"defines":for(ts=0,ta=(td=tW[tM]).length;ts<ta;ts++)tJ=this._shaderCompile.getMaterialDefineByName(td[ts]),this._addShaderDefine(tJ);break;default:this[tM]=tW[tM]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},tY._addReference=function(){tT.prototype._addReference.call(this);for(var tD=0,tY=this._values.length;tD<tY;tD++){var tg=this._values[tD];tg&&tg instanceof laya.d3.resource.BaseTexture&&tg._addReference()}},tY._removeReference=function(){tT.prototype._removeReference.call(this);for(var tD=0,tY=this._values.length;tD<tY;tD++){var tg=this._values[tD];tg&&tg instanceof laya.d3.resource.BaseTexture&&tg._removeReference()}},tY.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},tY.setShaderName=function(tD){var tY=tcY.nameKey.getID(tD);if(-1===tY)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=tXY._preCompileShader[tY]},tY.cloneTo=function(tD){var tY=tD;tY.name=this.name,tY.cull=this.cull,tY.blend=this.blend,tY.srcBlend=this.srcBlend,tY.dstBlend=this.dstBlend,tY.srcBlendRGB=this.srcBlendRGB,tY.dstBlendRGB=this.dstBlendRGB,tY.srcBlendAlpha=this.srcBlendAlpha,tY.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(tY.blendConstColor),tY.blendEquation=this.blendEquation,tY.blendEquationRGB=this.blendEquationRGB,tY.blendEquationAlpha=this.blendEquationAlpha,tY.depthTest=this.depthTest,tY.depthWrite=this.depthWrite,tY.renderQueue=this.renderQueue,tY._shader=this._shader,tY._disablePublicShaderDefine=this._disablePublicShaderDefine,tY._shaderDefineValue=this._shaderDefineValue;var tg,tT=0,tr=tY._shaderValues;tY._shaderValues.data.length=this._shaderValues.data.length;var ts=this._values.length,ta=tY._values;for(tT=0,tg=ta.length=ts;tT<tg;tT++){var tW=this._values[tT];if(tW)if("number"==typeof tW)ta[tT]=tW,tr.data[tT]=tW;else if("number"==typeof tW&&Math.floor(tW)==tW)ta[tT]=tW,tr.data[tT]=tW;else if("boolean"==typeof tW)ta[tT]=tW,tr.data[tT]=tW;else if(tW instanceof laya.d3.math.Vector2){var tM=ta[tT]||(ta[tT]=new tMY);tW.cloneTo(tM),tr.data[tT]=tM.elements}else if(tW instanceof laya.d3.math.Vector3){var tE=ta[tT]||(ta[tT]=new tEY);tW.cloneTo(tE),tr.data[tT]=tE.elements}else if(tW instanceof laya.d3.math.Vector4){var tI=ta[tT]||(ta[tT]=new tIY);tW.cloneTo(tI),tr.data[tT]=tI.elements}else if(tW instanceof laya.d3.math.Matrix4x4){var tO=ta[tT]||(ta[tT]=new tgY);tW.cloneTo(tO),tr.data[tT]=tO.elements}else tW instanceof laya.d3.resource.BaseTexture&&(ta[tT]=tW,tr.data[tT]=tW)}},tY.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},t$(0,tY,"alphaTestValue",function(){return this._getNumber(0)},function(tD){this._setNumber(0,tD)}),t$(0,tY,"alphaTest",function(){return this._alphaTest},function(tD){(this._alphaTest=tD)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),tD.__init__=function(){tD.SHADERDEFINE_ALPHATEST=tD.shaderDefines.registerDefine("ALPHATEST")},tD.RENDERQUEUE_OPAQUE=2e3,tD.RENDERQUEUE_ALPHATEST=2450,tD.RENDERQUEUE_TRANSPARENT=3e3,tD.CULL_NONE=0,tD.CULL_FRONT=1,tD.CULL_BACK=2,tD.BLEND_DISABLE=0,tD.BLEND_ENABLE_ALL=1,tD.BLEND_ENABLE_SEPERATE=2,tD.BLENDPARAM_ZERO=0,tD.BLENDPARAM_ONE=1,tD.BLENDPARAM_SRC_COLOR=768,tD.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,tD.BLENDPARAM_DST_COLOR=774,tD.BLENDPARAM_ONE_MINUS_DST_COLOR=775,tD.BLENDPARAM_SRC_ALPHA=770,tD.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,tD.BLENDPARAM_DST_ALPHA=772,tD.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,tD.BLENDPARAM_SRC_ALPHA_SATURATE=776,tD.BLENDEQUATION_ADD=0,tD.BLENDEQUATION_SUBTRACT=1,tD.BLENDEQUATION_REVERSE_SUBTRACT=2,tD.DEPTHTEST_OFF=0,tD.DEPTHTEST_NEVER=512,tD.DEPTHTEST_LESS=513,tD.DEPTHTEST_EQUAL=514,tD.DEPTHTEST_LEQUAL=515,tD.DEPTHTEST_GREATER=516,tD.DEPTHTEST_NOTEQUAL=517,tD.DEPTHTEST_GEQUAL=518,tD.DEPTHTEST_ALWAYS=519,tD.SHADERDEFINE_ALPHATEST=1,tD.ALPHATESTVALUE=0,tO(tD,["shaderDefines",function(){return this.shaderDefines=new tNY}]),tD}(tJ),tPY=function(tD){function tY(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,tY.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}tN(tY,"laya.d3.resource.BaseTexture",tJ);var tg=tY.prototype;return t$(0,tg,"width",function(){return this._width}),t$(0,tg,"repeat",function(){return this._repeat},function(tD){if(this._repeat!==tD&&(this._repeat=tD,this._source)){var tY=tz.mainContext;tm.bindTexture(tY,this._type,this._source),tp.isPOT(this._width,this._height)&&this._repeat?(tY.texParameteri(this._type,10242,10497),tY.texParameteri(this._type,10243,10497)):(tY.texParameteri(this._type,10242,33071),tY.texParameteri(this._type,10243,33071))}}),t$(0,tg,"height",function(){return this._height}),t$(0,tg,"magFifter",function(){return this._magFifter},function(tD){(this._magFifter=tD)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(tD)}),t$(0,tg,"wrapModeV",function(){return this._wrapModeV}),t$(0,tg,"size",function(){return this._size}),t$(0,tg,"wrapModeU",function(){return this._wrapModeU}),t$(0,tg,"mipmap",function(){return this._mipmap},function(tD){this._mipmap=tD,this._mipmap!=tD&&this._conchTexture&&this._conchTexture.setMipMap(tD)}),t$(0,tg,"minFifter",function(){return this._minFifter},function(tD){this._minFifter=tD,this._minFifter!=tD&&this._conchTexture&&this._conchTexture.setMinFifter(tD)}),t$(0,tg,"format",function(){return this._format}),t$(0,tg,"source",function(){return this.activeResource(),this._source}),t$(0,tg,"defaulteTexture",function(){return tQY.grayTexture}),tY.WARPMODE_REPEAT=0,tY.WARPMODE_CLAMP=1,tY}(),tBY=function(tD){function tY(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,tY.__super.call(this),this._boundingBoxCorners=tT(8,null)}tN(tY,"laya.d3.resource.models.BaseMesh",tJ);var tg=tY.prototype;return tg._getPositions=function(){throw new Error("未Override,请重载该属性！")},tg._generateBoundingObject=function(){this._boundingSphere=new tuD(new tEY,0),tuD.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new tLD(new tEY,new tEY),tLD.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},tg.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},tg.getRenderElement=function(tD){throw new Error("未Override,请重载该属性！")},t$(0,tg,"subMeshCount",function(){return this._subMeshCount}),t$(0,tg,"boundingBox",function(){return this._boundingBox}),t$(0,tg,"boundingBoxCorners",function(){return this._boundingBoxCorners}),t$(0,tg,"boundingSphere",function(){return this._boundingSphere}),tY}(),tHY=function(tD){function tY(){tY.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}tN(tY,"laya.d3.component.physics.Collider",tD);var tg=tY.prototype;return tg._clearCollsionMap=function(){for(var tD in this._runtimeCollisonMap){var tY=this._runtimeCollisonMap[tD];delete tY._runtimeCollisonMap[this.id],tY._isRigidbody&&delete tY._runtimeCollisonTestMap[this.id];var tg=tY.id;delete this._runtimeCollisonMap[tg],this._isRigidbody&&delete this._runtimeCollisonTestMap[tg]}},tg._unload=function(tD){for(var tY in this._runtimeCollisonMap){var tg=this._runtimeCollisonMap[tY];delete tg._runtimeCollisonMap[this.id],tg._isRigidbody&&delete tg._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[tY]._ignoreCollisonMap[this.id]}},tg._setIsRigidbody=function(tD){if(this._isRigidbody!==tD){this._isRigidbody=tD;var tY=this._owner;if(tY.displayedInStage){var tg=tY.layer;tg._removeCollider(this),tg._addCollider(this)}}},tg._getType=function(){return-1},tg._collisonTo=function(tD){return!1},tg.raycast=function(tD,tY,tg){throw void 0===tg&&(tg=179e306),new Error("Collider:Must override it.")},t$(0,tg,"enable",tD.prototype._$get_enable,function(tD){this._enable!==tD&&(this._owner.displayedInStage&&(tD||this._clearCollsionMap()),this._enable=tD,this.event("enablechanged",this._enable))}),t$(0,tg,"isSingleton",function(){return tY._isSingleton}),tY._isSingleton=!1,tY}(t_Y),tvY=function(tD){function tY(){tY.__super.call(this)}return tN(tY,"laya.d3.component.Rigidbody",tD),t$(0,tY.prototype,"enable",tD.prototype._$get_enable,function(tD){if(this._enable!==tD){for(var tY=this._owner._colliders,tg=0,tT=tY.length;tg<tT;tg++){var tr=tY[tg];tr._setIsRigidbody(tD);var ts=tr._runtimeCollisonMap,ta=tr._runtimeCollisonTestMap;if(!tD)for(var tW in ts)delete ta[tW]}this._enable=tD,this.event("enablechanged",this._enable)}}),tY}(t_Y),tSY=(function(tD){function tY(){tY.__super.call(this)}tN(tY,"laya.d3.component.Script",t_Y);var tg=tY.prototype;tg.onTriggerEnter=function(tD){},tg.onTriggerExit=function(tD){},tg.onTriggerStay=function(tD){},t$(0,tg,"isSingleton",function(){return tY._isSingleton}),tY._isSingleton=!1}(),function(tD){function tY(tD){this._owner=null,this._sharedMesh=null,tY.__super.call(this),this._owner=tD}tN(tY,"laya.d3.core.MeshFilter",tD);var tg=tY.prototype;return tg._sharedMeshLoaded=function(){this.event("loaded")},tg._destroy=function(){tD.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},t$(0,tg,"sharedMesh",function(){return this._sharedMesh},function(tD){var tY=this._sharedMesh;tY&&tY._removeReference(),(this._sharedMesh=tD)._addReference(),this.event("meshchanged",[this,tY,tD]),tD.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),t$(0,tg,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),t$(0,tg,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),t$(0,tg,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),t$(0,tg,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),tY}(tAY)),tUY=function(tD){function tY(tD){tY.__super.call(this,tD),tD.meshFilter.on("meshchanged",this,this._onMeshChanged)}tN(tY,"laya.d3.core.MeshRender",tqY);var tg=tY.prototype;return tg._onMeshChanged=function(tD,tY,tg){tg.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:tg.once("loaded",this,this._onMeshLoaed)},tg._onMeshLoaed=function(tD,tY){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},tg._calculateBoundingSphereByInitSphere=function(tD){var tY=NaN,tg=this._owner.transform,tT=tg.scale.elements,tr=Math.abs(tT[0]),ts=Math.abs(tT[1]),ta=Math.abs(tT[2]);tY=ts<=tr&&ta<=tr?tr:ta<=ts?ts:ta,tEY.transformCoordinate(tD.center,tg.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=tD.radius*tY},tg._calculateBoundBoxByInitCorners=function(tD){for(var tY=this._owner.transform.worldMatrix,tg=0;tg<8;tg++)tEY.transformCoordinate(tD[tg],tY,tqY._tempBoundBoxCorners[tg]);tLD.createfromPoints(tqY._tempBoundBoxCorners,this._boundingBox)},tg._calculateBoundingSphere=function(){var tD=this._owner.meshFilter.sharedMesh;null==tD||null==tD.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(tD.boundingSphere)},tg._calculateBoundingBox=function(){var tD=this._owner.meshFilter.sharedMesh;null==tD||null==tD.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(tD.boundingBoxCorners)},tg._renderUpdate=function(tD){var tY=this._owner.transform;if(tY){this._setShaderValueMatrix4x4(0,tY.worldMatrix);var tg=this._owner.getProjectionViewWorldMatrix(tD);this._setShaderValueMatrix4x4(1,tg)}else this._setShaderValueMatrix4x4(0,tgY.DEFAULT),this._setShaderValueMatrix4x4(1,tD);return tlY.debugMode&&this._renderRenderableBoundBox(),!0},tY}(),tFY=function(tY){function tT(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,tT.__super.call(this),this._renderState=new tR,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new tdY,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new tYD,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new tEY(.7,.7,.7),this.ambientColor=new tEY(.212,.227,.259),tz.shaderHighPrecision&&this.addShaderDefine(tXY.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}tN(tT,"laya.d3.core.scene.Scene",tY);var tD=tT.prototype;return tl.imps(tD,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),tD._setUrl=function(tD){this._url=tD},tD._getGroup=function(){return this._group},tD._setGroup=function(tD){this._group=tD},tD._display=function(){tl.stage._scenes.push(this),tl.stage._scenes.sort(tT._sortScenes);for(var tD=0,tY=this._childs.length;tD<tY;tD++){var tg=this._childs[tD];tg.active&&tg._activeHierarchy()}},tD._unDisplay=function(){var tD=tl.stage._scenes;tD.splice(tD.indexOf(this),1);for(var tY=0,tg=this._childs.length;tY<tg;tY++){var tT=this._childs[tY];tT.active&&tT._inActiveHierarchy()}},tD._addChild3D=function(tD){tD.transform._onWorldTransform(),tD._setBelongScene(this),this.displayedInStage&&tD.active&&tD._activeHierarchy()},tD._removeChild3D=function(tD){tD.transform.parent=null,this.displayedInStage&&tD.active&&tD._inActiveHierarchy(),tD._setUnBelongScene()},tD.initOctree=function(tD,tY,tg,tT,tr){void 0===tr&&(tr=6),this.treeSize=new tEY(tD,tY,tg),this.treeLevel=tr,this.treeRoot=new tQ(this,0),this.treeRoot.init(tT,this.treeSize)},tD._prepareUpdateToRenderState=function(tD,tY){tY.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,tY.scene=this},tD._prepareSceneToRender=function(tD){var tY=this._lights.length;if(0<tY)for(var tg=0,tT=0;tT<tY&&!(this._lights[tT]._prepareToScene(tD)&&++tg>=this._enableLightCount);tT++);},tD._updateChilds=function(tD){for(var tY=0,tg=this._childs.length;tY<tg;++tY)this._childs[tY]._update(tD)},tD._preRenderScene=function(tD,tY,tg){var tT,tr=tY._viewMatrix,ts=tY._projectionMatrix,ta=tY._projectionViewMatrix,tW=0,tM=tY.camera;for(tM.useOcclusionCulling?this.treeRoot?tgD.renderObjectCullingOctree(tg,this,tM,tr,ts,ta):tgD.renderObjectCulling(tg,this,tM,tr,ts,ta):tgD.renderObjectCullingNoBoundFrustum(this,tM,tr,ts,ta),tW=0,tT=this._quenes.length;tW<tT;tW++)this._quenes[tW]&&this._quenes[tW]._preRender(tY)},tD._clear=function(tD,tY){var tg=tY._viewport,tT=tY.camera,tr=tg.x,ts=tT.renderTargetSize.height-tg.y-tg.height,ta=tg.width,tW=tg.height;tD.viewport(tr,ts,ta,tW);var tM=256,tE=tT.renderTarget;switch(tT.clearFlag){case 0:var tI=tT.clearColor;if(tI){tD.enable(3089),tD.scissor(tr,ts,ta,tW);var tO=tI.elements;tD.clearColor(tO[0],tO[1],tO[2],tO[3]),tM|=16384}if(tE)switch(tI||(tM=16384),tE.depthStencilFormat){case 33189:tM|=256;break;case 36168:tM|=1024;break;case 34041:tM|=256,tM|=1024}tD.clear(tM),tI&&tD.disable(3089);break;case 1:case 2:if(tE)switch(tM=16384,tE.depthStencilFormat){case 33189:tM|=256;break;case 36168:tM|=1024;break;case 34041:tM|=256,tM|=1024}tD.clear(tM);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},tD._renderScene=function(tD,tY){var tg,tT,tr=tY.camera,ts=0;for(ts=0;ts<2;ts++)(tT=this._quenes[ts])&&(tr.renderTarget?tT._render(tY,!0):tT._render(tY,!1));if(1===tr.clearFlag){var ta=tr.sky;ta&&(tm.setCullFace(tD,!1),tm.setDepthFunc(tD,515),tm.setDepthMask(tD,!1),ta._render(tY),tm.setDepthFunc(tD,513),tm.setDepthMask(tD,!0))}for(ts=2,tg=this._quenes.length;ts<tg;ts++)(tT=this._quenes[ts])&&(tT._sortAlpha(tY.camera.transform.position),tr.renderTarget?tT._render(tY,!0):tT._render(tY,!1))},tD._set3DRenderConfig=function(tD){tD.disable(3042),tm._blend=!1,tD.blendFunc(770,771),tm._sFactor=770,tm._dFactor=771,tD.disable(2929),tm._depthTest=!1,tD.enable(2884),tm._cullFace=!0,tD.depthMask(1),tm._depthMask=!0,tD.frontFace(2304),tm._frontFace=2304},tD._set2DRenderConfig=function(tD){tm.setBlend(tD,!0),tm.setBlendFunc(tD,1,771),tm.setDepthTest(tD,!1),tm.setCullFace(tD,!1),tm.setDepthMask(tD,!0),tm.setFrontFace(tD,2305),tD.viewport(0,0,tr.width,tr.height)},tD._parseCustomProps=function(tD,tY,tg,tT){var tr=tT.customProps.lightmaps,ts=tr.length,ta=this._lightmaps;ta.length=ts;for(var tW=0;tW<ts;tW++)ta[tW]=tx.getRes(tY[tr[tW].replace(".exr",".png")]);this.setlightmaps(ta);var tM=tT.customProps.ambientColor;tM&&(this.ambientColor=new tEY(tM[0],tM[1],tM[2]));var tE=tT.customProps.fogColor;tE&&(this.fogColor=new tEY(tE[0],tE[1],tE[2]))},tD._addLight=function(tD){this._lights.indexOf(tD)<0&&this._lights.push(tD)},tD._removeLight=function(tD){var tY=this._lights.indexOf(tD);0<=tY&&this._lights.splice(tY,1)},tD._updateScene=function(){var tD=this._renderState;this._prepareUpdateToRenderState(tz.mainContext,tD),this._updateComponents(tD),this._updateChilds(tD),this._lateUpdateComponents(tD),this._time+=tD.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},tD._updateSceneConch=function(){var tD=this._renderState;this._prepareUpdateToRenderState(tz.mainContext,tD),this._updateComponents(tD),this._lateUpdateComponents(tD),this._prepareSceneToRender(tD);for(var tY=0,tg=this._cameraPool.length;tY<tg;tY++){var tT=this._cameraPool[tY];(tD.camera=tT)._prepareCameraToRender()}},tD._preRenderShadow=function(tD,tY,tg,tT,tr){this.treeRoot?tgD.renderShadowObjectCullingOctree(this,tY,tg,tT,tr):tgD.renderShadowObjectCulling(this,tY,tg,tT,tr);for(var ts=0,ta=tg.length;ts<ta;ts++)tg[ts]&&tg[ts]._preRender(tD)},tD._renderShadowMap=function(tD,tY,tg){var tT=this.parallelSplitShadowMaps[0];tT._calcAllLightCameraInfo(tg);var tr,ts,ta,tW=tT.PSSMNum;if(this._preRenderShadow(tY,tT._lightCulling,tT._shadowQuenes,tT._lightVPMatrix[0],tW),this.addShaderDefine(tJY.SHADERDEFINE_CAST_SHADOW),1<tW)for(var tM=0;tM<tW;tM++)tr=tT.getRenderTarget(tM+1),tT.beginRenderTarget(tM+1),tD.clearColor(1,1,1,1),tD.clear(16640),tD.viewport(0,0,tr.width,tr.height),tY.camera=ta=tT.getLightCamera(tM),ta._prepareCameraToRender(),ta._prepareCameraViewProject(ta.viewMatrix,ta.projectionMatrix),tY._projectionViewMatrix=tT._lightVPMatrix[tM+1],(ts=tT._shadowQuenes[tM])._preRender(tY),ts._renderShadow(tY,!1),tT.endRenderTarget(tM+1);else tr=tT.getRenderTarget(1),tT.beginRenderTarget(1),tD.clearColor(1,1,1,1),tD.clear(16640),tD.viewport(0,0,tr.width,tr.height),tY.camera=ta=tT.getLightCamera(0),ta._prepareCameraToRender(),ta._prepareCameraViewProject(ta.viewMatrix,ta.projectionMatrix),tY._projectionViewMatrix=tT._lightVPMatrix[0],(ts=tT._shadowQuenes[0])._preRender(tY),ts._renderShadow(tY,!0),tT.endRenderTarget(1);this.removeShaderDefine(tJY.SHADERDEFINE_CAST_SHADOW)},tD.addTreeNode=function(tD){this.treeRoot.addTreeNode(tD)},tD.removeTreeNode=function(tD){this.treeSize&&tD._treeNode&&tD._treeNode.removeObject(tD)},tD.setlightmaps=function(tD){this._lightmaps=tD;for(var tY=0,tg=this._renderableSprite3Ds.length;tY<tg;tY++)this._renderableSprite3Ds[tY]._render._applyLightMapParams()},tD.getlightmaps=function(){return this._lightmaps},tD.addChildAt=function(tD,tY){if(!(tD instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(tD&&tD.__className));if(!tD||this.destroyed||tD===this)return tD;if(tD.zOrder&&this._set$P("hasZorder",!0),0<=tY&&tY<=this._childs.length){if(tD._parent===this){var tg=this.getChildIndex(tD);this._childs.splice(tg,1),this._childs.splice(tY,0,tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,tY)),this._childChanged()}else tD.parent&&tD.parent.removeChild(tD),this._childs===tI.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(tY,0,tD),this.conchModel&&this.conchModel.addChildAt(tD.conchModel,tY),(tD.parent=this)._addChild3D(tD);return tD}throw new Error("appendChildAt:The index is out of bounds")},tD.addChild=function(tD){if(!(tD instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!tD||this.destroyed||tD===this)return tD;if(tD.zOrder&&this._set$P("hasZorder",!0),tD._parent===this){var tY=this.getChildIndex(tD);tY!==this._childs.length-1&&(this._childs.splice(tY,1),this._childs.push(tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,this._childs.length-1)),this._childChanged())}else tD.parent&&tD.parent.removeChild(tD),this._childs===tI.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(tD),this.conchModel&&this.conchModel.addChildAt(tD.conchModel,this._childs.length-1),(tD.parent=this)._childChanged(),this._addChild3D(tD);return tD},tD.removeChildAt=function(tD){var tY=this.getChildAt(tD);return tY&&(this._removeChild3D(tY),this._childs.splice(tD,1),this.conchModel&&this.conchModel.removeChild(tY.conchModel),tY.parent=null),tY},tD.removeChildren=function(tD,tY){if(void 0===tD&&(tD=0),void 0===tY&&(tY=2147483647),this._childs&&0<this._childs.length){var tg=this._childs;if(0===tD&&ts<=tY){var tT=tg;this._childs=tI.ARRAY_EMPTY}else tT=tg.splice(tD,tY-tD);for(var tr=0,ts=tT.length;tr<ts;tr++)this._removeChild3D(tT[tr]),tT[tr].parent=null,this.conchModel&&this.conchModel.removeChild(tT[tr].conchModel)}return this},tD.addFrustumCullingObject=function(tD){this.treeRoot?this.addTreeNode(tD):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(tD):this._cullingRenders[this._cullingRendersLength]=tD,tD._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},tD.removeFrustumCullingObject=function(tD){if(this.treeRoot)this.removeTreeNode(tD);else{this._cullingRendersLength--;var tY=tD._indexInSceneFrustumCullingObjects;if(tY!==this._cullingRendersLength){var tg=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[tY]=tg)._indexInSceneFrustumCullingObjects=tY,tD._indexInSceneFrustumCullingObjects=-1}}},tD.getRenderQueue=function(tD){return tD<3e3?this._quenes[1]||(this._quenes[1]=new to(this)):this._quenes[2]||(this._quenes[2]=new to(this))},tD.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new to(this)},tD.addShaderDefine=function(tD){this._shaderDefineValue|=tD},tD.removeShaderDefine=function(tD){this._shaderDefineValue&=~tD},tD.addScript=function(tD){return this._addComponent(tD)},tD.getScriptByType=function(tD,tY){return void 0===tY&&(tY=0),this._getComponentByType(tD,tY)},tD.getScriptsByType=function(tD,tY){this._getComponentsByType(tD,tY)},tD.getScriptByIndex=function(tD){return this._getComponentByIndex(tD)},tD.removeScriptByType=function(tD,tY){void 0===tY&&(tY=0),this._removeComponentByType(tD,tY)},tD.removeScriptsByType=function(tD){this._removeComponentByType(tD)},tD.removeAllScript=function(){this._removeAllComponent()},tD.render=function(tD,tY,tg){(td._context.ctx._renderKey=0)<this._childs.length&&tD.addRenderObject(this)},tD.renderSubmit=function(){var tD=tz.mainContext,tY=this._renderState;this._set3DRenderConfig(tD),this._prepareSceneToRender(this._renderState);var tg,tT=0,tr=0;if(tlY.debugMode||tQ.debugMode)for(tT=0,tr=this._cameraPool.length;tT<tr;tT++)tg=this._cameraPool[tT],tlY._debugPhasorSprite.begin(1,tg),tg.activeInHierarchy&&tg._renderCamera(tD,tY,this),tlY._debugPhasorSprite.end();else for(tT=0,tr=this._cameraPool.length;tT<tr;tT++)(tg=this._cameraPool[tT]).activeInHierarchy&&tg._renderCamera(tD,tY,this);return this._set2DRenderConfig(tD),1},tD.onAsynLoaded=function(tD,tY,tg){var tT=tY[0];if("Scene"!==tT.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var tr=tY[1];tpY._createNodeByJson(this,tT,this,tr),this.event("hierarchyloaded",[this]),this.__loaded=!0},tD.destroy=function(tD){void 0===tD&&(tD=!0),this.destroyed||(tY.prototype.destroy.call(this,tD),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,tx.clearRes(this.url),this.loaded||tlY._cancelLoadByUrl(this.url))},tD.getRenderType=function(){return 0},tD.releaseRender=function(){},tD._addComponent=function(tD){var tY,tg=this._componentsMap.indexOf(tD);if(-1===tg)tY=[],this._componentsMap.push(tD),this._typeComponentsIndices.push(tY);else if(tY=this._typeComponentsIndices[tg],this._components[tY[0]].isSingleton)throw new Error("无法单实例创建"+tD+"组件，"+tD+"组件已存在！");var tT=tM.getInstance(tD);tY.push(this._components.length),this._components.push(tT);return tT._initialize(this),tT},tD._removeComponent=function(tD,tY){var tg=this._typeComponentsIndices[tD],tT=tg[tY],tr=this._components[tT];this._components.splice(tT,1),tg.splice(tY,1),0===tg.length&&(this._typeComponentsIndices.splice(tD,1),this._componentsMap.splice(tD,1));for(var ts=0,ta=this._componentsMap.length;ts<ta;ts++)for(var tW=(tg=this._typeComponentsIndices[ts]).length-1;0<=tW;tW--){var tM=tg[tW];if(!(tT<tM))break;tg[tW]=--tM}tr._destroy()},tD._getComponentByType=function(tD,tY){void 0===tY&&(tY=0);var tg=this._componentsMap.indexOf(tD);return-1===tg?null:this._components[this._typeComponentsIndices[tg][tY]]},tD._getComponentsByType=function(tD,tY){var tg=this._componentsMap.indexOf(tD);if(-1!==tg){var tT=this._typeComponentsIndices[tg],tr=tT.length;tY.length=tr;for(var ts=0;ts<tr;ts++)tY[ts]=this._components[tT[ts]]}else tY.length=0},tD._getComponentByIndex=function(tD){return this._components[tD]},tD._removeComponentByType=function(tD,tY){void 0===tY&&(tY=0);var tg=this._componentsMap.indexOf(tD);-1!==tg&&this._removeComponent(tg,tY)},tD._removeComponentsByType=function(tD){var tY=this._componentsMap.indexOf(tD);if(-1!==tY)for(var tg=this._typeComponentsIndices[tY],tT=0,tr=tg.length;tT<tr;tg.length<tr?tr--:tT++)this._removeComponent(tY,tT)},tD._removeAllComponent=function(){for(var tD=0,tY=this._componentsMap.length;tD<tY;this._componentsMap.length<tY?tY--:tD++)this._removeComponentsByType(this._componentsMap[tD])},tD._updateComponents=function(tD){for(var tY=0,tg=this._components.length;tY<tg;tY++){var tT=this._components[tY];!tT.started&&(tT._start(tD),tT.started=!0),tT.enable&&tT._update(tD)}},tD._lateUpdateComponents=function(tD){for(var tY=0;tY<this._components.length;tY++){var tg=this._components[tY];!tg.started&&(tg._start(tD),tg.started=!0),tg.enable&&tg._lateUpdate(tD)}},tD._preRenderUpdateComponents=function(tD){for(var tY=0;tY<this._components.length;tY++){var tg=this._components[tY];!tg.started&&(tg._start(tD),tg.started=!0),tg.enable&&tg._preRenderUpdate(tD)}},tD._postRenderUpdateComponents=function(tD){for(var tY=0;tY<this._components.length;tY++){var tg=this._components[tY];!tg.started&&(tg._start(tD),tg.started=!0),tg.enable&&tg._postRenderUpdate(tD)}},t$(0,tD,"_loaded",null,function(tD){this.__loaded=tD}),t$(0,tD,"fogColor",function(){return this._fogColor},function(tD){this._fogColor=tD,this._shaderValues.setValue(0,tD.elements)}),t$(0,tD,"enableFog",function(){return this._enableFog},function(tD){this._enableFog!==tD&&((this._enableFog=tD)?(this.addShaderDefine(tXY.SHADERDEFINE_FOG),this.removeShaderDefine(tXY.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(tXY.SHADERDEFINE_FOG))}),t$(0,tD,"url",function(){return this._url}),t$(0,tD,"loaded",function(){return this.__loaded}),t$(0,tD,"enableDepthFog",function(){return this._enableDepthFog},function(tD){this._enableDepthFog!=tD&&((this._enableDepthFog=tD)?(this.addShaderDefine(tXY.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(tXY.SHADERDEFINE_FOG)):this.removeShaderDefine(tXY.SAHDERDEFINE_DEPTHFOG))}),t$(0,tD,"fogStart",function(){return this._fogStart},function(tD){this._fogStart=tD,this._shaderValues.setValue(1,tD)}),t$(0,tD,"fogRange",function(){return this._fogRange},function(tD){this._fogRange=tD,this._shaderValues.setValue(2,tD)}),t$(0,tD,"ambientColor",function(){return this._ambientColor},function(tD){this._ambientColor=tD,this._shaderValues.setValue(21,tD.elements)}),t$(0,tD,"scene",function(){return this}),t$(0,tD,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),tT._sortScenes=function(tD,tY){if(tD.parent!==tl.stage||tY.parent!==tl.stage)return tD.parent!==tl.stage&&tY.parent!==tl.stage?tT._sortScenes(tD.parent,tY.parent):tD.parent===tl.stage?-1:1;var tg=tl.stage._childs;return tg.indexOf(tD)-tg.indexOf(tY)},tT.load=function(tD){return tl.loader.create(tD,null,null,tT)},tT.FOGCOLOR=0,tT.FOGSTART=1,tT.FOGRANGE=2,tT.LIGHTDIRECTION=3,tT.LIGHTDIRCOLOR=4,tT.POINTLIGHTPOS=5,tT.POINTLIGHTRANGE=6,tT.POINTLIGHTATTENUATION=7,tT.POINTLIGHTCOLOR=8,tT.SPOTLIGHTPOS=9,tT.SPOTLIGHTDIRECTION=10,tT.SPOTLIGHTSPOT=11,tT.SPOTLIGHTRANGE=12,tT.SPOTLIGHTATTENUATION=13,tT.SPOTLIGHTCOLOR=14,tT.SHADOWDISTANCE=15,tT.SHADOWLIGHTVIEWPROJECT=16,tT.SHADOWMAPPCFOFFSET=17,tT.SHADOWMAPTEXTURE1=18,tT.SHADOWMAPTEXTURE2=19,tT.SHADOWMAPTEXTURE3=20,tT.AMBIENTCOLOR=21,tT.TIME=22,tT}(t_),tVY=function(tD){function tY(tD){tY.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new tgY,this._shaderValues=new tdY,this._colliders=[],this._id=++tY._uniqueIDCounter,this._transform=new tbY(this),this.name=tD||"Sprite3D-"+tY._nameNumberCounter++,this.layer=ti.currentCreationLayer,this.active=!0}tN(tY,"laya.d3.core.Sprite3D",thY);var tg=tY.prototype;return tl.imps(tg,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),tg._setUrl=function(tD){this._url=tD},tg._getGroup=function(){return this._group},tg._setGroup=function(tD){this._group=tD},tg._addChild3D=function(tD){tD.transform.parent=this.transform,this._hierarchyAnimator&&(!tD._hierarchyAnimator&&tD._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(tD,!0,[tD.name])),this._scene&&(tD._setBelongScene(this._scene),this._activeInHierarchy&&tD._active&&tD._activeHierarchy())},tg._removeChild3D=function(tD){tD.transform.parent=null,this._scene&&(this._activeInHierarchy&&tD._active&&tD._inActiveHierarchy(),tD._setUnBelongScene()),this._hierarchyAnimator&&(tD._hierarchyAnimator==this._hierarchyAnimator&&tD._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(tD,!1,[tD.name]))},tg._parseBaseCustomProps=function(tD){var tY=this.transform.localPosition;tD.translate?(tY.fromArray(tD.translate),tY.x*=100,tY.y*=100,tY.z*=100):tY.elements.fill(0),this.transform.localPosition=tY;var tg=this.transform.localRotation;tD.rotation?tg.fromArray(tD.rotation):tg.fromArray([0,0,0,-1]),this.transform.localRotation=tg;var tT=this.transform.localScale;tD.scale?tT.fromArray(tD.scale):tT.elements.fill(1),this.transform.localScale=tT;var tr=tD.layer;null!=tr&&(this.layer=ti.getLayerByNumber(tr))},tg._parseCustomComponent=function(tD,tY,tg){for(var tT in tg){var tr=tg[tT];switch(tT){case"Animator":var ts=this.addComponent(Animator);if(tr.avatarPath)ts.avatar=tx.getRes(tY[tr.avatarPath]);else{var ta=tr.avatar;if(ta){ts.avatar=tx.getRes(tY[ta.path]);var tW=ta.linkSprites;tW&&tD.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[ts,tW])}}for(var tM=tr.clipPaths,tE=tM.length,tI=0;tI<tE;tI++)ts.addClip(tx.getRes(tY[tM[tI]]));ts.clip=tx.getRes(tY[tM[0]]);var tO=tr.playOnWake;void 0!==tO&&(ts.playOnWake=tO);break;case"Rigidbody":this.addComponent(tvY);break;case"SphereCollider":var tC=this.addComponent(SphereCollider);tC.isTrigger=tr.isTrigger;var tN=tC.center;tN.fromArray(tr.center),tC.center=tN,tC.radius=tr.radius;break;case"BoxCollider":var t$=this.addComponent(twY);t$.isTrigger=tr.isTrigger,t$.center.fromArray(tr.center);var td=t$.size;td.fromArray(tr.size),t$.size=td;break;case"MeshCollider":this.addComponent(MeshCollider)}}},tg._onRootNodeHierarchyLoaded=function(tD,tY){for(var tg in tY){for(var tT=this,tr=tY[tg],ts=0,ta=tr.length;ts<ta;ts++){var tW=tr[ts];if(""===tW)break;if(!(tT=tT.getChildByName(tW)))break}tT&&tD.linkSprite3DToAvatarNode(tg,tT)}},tg._setHierarchyAnimator=function(tD,tY){this._changeHierarchyAnimator(tD);for(var tg=0,tT=this._childs.length;tg<tT;tg++){var tr=this._childs[tg];tr._hierarchyAnimator==tY&&tr._setHierarchyAnimator(tD,tY)}},tg._clearHierarchyAnimator=function(tD,tY){this._changeHierarchyAnimator(tY);for(var tg=0,tT=this._childs.length;tg<tT;tg++){var tr=this._childs[tg];tr._hierarchyAnimator==tD&&tr._clearHierarchyAnimator(tD,tY)}},tg._getAnimatorToLinkSprite3D=function(tD,tY,tg){var tT=this.getComponentByType(Animator);if(tT&&(tT.avatar?tT.avatar._version||tD._setAnimatorToLinkAvatar(tT,tY):tD._setAnimatorToLinkSprite3DNoAvatar(tT,tY,tg)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){tg.unshift(this._parent.name);var tr=this._parent;tr._hierarchyAnimator&&tr._getAnimatorToLinkSprite3D(tD,tY,tg)}},tg._setAnimatorToLinkSprite3DNoAvatar=function(tD,tY,tg){var tT=0,tr=0;for(tT=0,tr=tD.getClipCount();tT<tr;tT++)tD._handleSpriteOwnersBySprite(tT,tY,tg,this);for(tT=0,tr=this._childs.length;tT<tr;tT++){var ts=this._childs[tT],ta=tg.length;tg.push(ts.name),ts._setAnimatorToLinkSprite3DNoAvatar(tD,tY,tg),tg.splice(ta,1)}},tg._changeHierarchyAnimator=function(tD){this._hierarchyAnimator=tD},tg._isLinkSpriteToAnimationNode=function(tD,tY,tg){var tT=tD._avatarNodes.indexOf(tY),tr=tD._cacheSpriteToNodesMap;if(tg)this._transform.dummy=tY.transform,tD._cacheNodesToSpriteMap[tT]=tr.length,tr.push(tT);else{this._transform.dummy=null;var ts=tD._cacheNodesToSpriteMap[tT];tD._cacheNodesToSpriteMap[tT]=null,tr.splice(ts,1)}},tg._setBelongScene=function(tD){this._scene=tD;for(var tY=0,tg=this._childs.length;tY<tg;tY++)this._childs[tY]._setBelongScene(tD)},tg._setUnBelongScene=function(){this._scene=null;for(var tD=0,tY=this._childs.length;tD<tY;tD++)this._childs[tD]._setUnBelongScene()},tg._activeHierarchy=function(){var tD=0,tY=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),tD=0,tY=this._colliders.length;tD<tY;tD++)this._layer._addCollider(this._colliders[tD]);for(this.event("activeinhierarchychanged",!0),tD=0,tY=this._childs.length;tD<tY;tD++){var tg=this._childs[tD];tg._active&&tg._activeHierarchy()}},tg._inActiveHierarchy=function(){var tD=0,tY=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),tD=0,tY=this._colliders.length;tD<tY;tD++){var tg=this._colliders[tD];tg._clearCollsionMap(),this._layer._removeCollider(tg)}for(this.event("activeinhierarchychanged",!1),tD=0,tY=this._childs.length;tD<tY;tD++){var tT=this._childs[tD];tT._active&&tT._inActiveHierarchy()}},tg.addComponent=function(tD){var tY,tg=this._componentsMap.indexOf(tD);if(-1===tg)tY=[],this._componentsMap.push(tD),this._typeComponentsIndices.push(tY);else if(tY=this._typeComponentsIndices[tg],this._components[tY[0]].isSingleton)throw new Error("无法单实例创建"+tD+"组件，"+tD+"组件已存在！");var tT=tM.getInstance(tD);if(tY.push(this._components.length),this._components.push(tT),tT instanceof laya.d3.component.physics.Collider)this.getComponentByType(tvY)&&(tT._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(tT),this._colliders.push(tT);else if(tT instanceof laya.d3.component.Rigidbody)for(var tr=0,ts=this._colliders.length;tr<ts;tr++)this._colliders[tr]._setIsRigidbody(!0);return tT instanceof laya.d3.component.Script&&this._scripts.push(tT),tT._initialize(this),tT},tg._removeComponent=function(tD,tY){var tg=0,tT=0,tr=this._typeComponentsIndices[tD],ts=tr[tY],ta=this._components[ts];if(ta instanceof laya.d3.component.physics.Collider){var tW=ta;this._activeInHierarchy&&this._layer._removeCollider(tW),this._colliders.splice(this._colliders.indexOf(tW),1)}else if(ta instanceof laya.d3.component.Rigidbody)for(tg=0,tT=this._colliders.length;tg<tT;tg++){var tM=this._colliders[tg];tM._setIsRigidbody(!1);var tE=tM._runtimeCollisonMap,tI=tM._runtimeCollisonTestMap;for(var tO in tE)delete tI[tO]}for(ta instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(ta),1),tr.splice(tY,1),0===tr.length&&(this._typeComponentsIndices.splice(tD,1),this._componentsMap.splice(tD,1)),tg=0,tT=this._componentsMap.length;tg<tT;tg++)for(var tC=(tr=this._typeComponentsIndices[tg]).length-1;0<=tC;tC--){var tN=tr[tC];if(!(ts<tN))break;tr[tC]=--tN}ta._destroy()},tg._clearSelfRenderObjects=function(){},tg._addSelfRenderObjects=function(){},tg._parseCustomProps=function(tD,tY,tg,tT){},tg._updateChilds=function(tD){var tY=this._childs.length;if(0!==tY)for(var tg=0;tg<tY;++tg)this._childs[tg]._update(tD)},tg._getSortID=function(tD,tY){return 1e3*tY.id+tD._getVertexBuffer().vertexDeclaration.id},tg._update=function(tD){(tD.owner=this)._activeInHierarchy&&(this._updateComponents(tD),this._lateUpdateComponents(tD),tA.spriteCount++,this._childs.length&&this._updateChilds(tD))},tg.getProjectionViewWorldMatrix=function(tD){return tgY.multiply(tD,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},tg.loadHierarchy=function(tD){this.addChild(laya.d3.core.Sprite3D.load(tD))},tg.addChildAt=function(tD,tY){if(!(tD instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!tD||this.destroyed||tD===this)return tD;if(tD.zOrder&&this._set$P("hasZorder",!0),0<=tY&&tY<=this._childs.length){if(tD._parent===this){var tg=this.getChildIndex(tD);this._childs.splice(tg,1),this._childs.splice(tY,0,tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,tY)),this._childChanged()}else tD.parent&&tD.parent.removeChild(tD),this._childs===tI.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(tY,0,tD),this.conchModel&&this.conchModel.addChildAt(tD.conchModel,tY),(tD.parent=this)._addChild3D(tD);return tD}throw new Error("appendChildAt:The index is out of bounds")},tg.addChild=function(tD){if(!(tD instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!tD||this.destroyed||tD===this)return tD;if(tD.zOrder&&this._set$P("hasZorder",!0),tD._parent===this){var tY=this.getChildIndex(tD);tY!==this._childs.length-1&&(this._childs.splice(tY,1),this._childs.push(tD),this.conchModel&&(this.conchModel.removeChild(tD.conchModel),this.conchModel.addChildAt(tD.conchModel,this._childs.length-1)),this._childChanged())}else tD.parent&&tD.parent.removeChild(tD),this._childs===tI.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(tD),this.conchModel&&this.conchModel.addChildAt(tD.conchModel,this._childs.length-1),(tD.parent=this)._childChanged(),this._addChild3D(tD);return tD},tg.removeChildAt=function(tD){var tY=this.getChildAt(tD);return tY&&(this._removeChild3D(tY),this._childs.splice(tD,1),this.conchModel&&this.conchModel.removeChild(tY.conchModel),tY.parent=null),tY},tg.removeChildren=function(tD,tY){if(void 0===tD&&(tD=0),void 0===tY&&(tY=2147483647),this._childs&&0<this._childs.length){var tg=this._childs;if(0===tD&&ts<=tY){var tT=tg;this._childs=tI.ARRAY_EMPTY}else tT=tg.splice(tD,tY-tD);for(var tr=0,ts=tT.length;tr<ts;tr++)this._removeChild3D(tT[tr]),tT[tr].parent=null,this.conchModel&&this.conchModel.removeChild(tT[tr].conchModel)}return this},tg.onAsynLoaded=function(tD,tY,tg){var tT=tY[0];if("Sprite3D"!==tT.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var tr=tY[1];tpY._createNodeByJson(this,tT,this,tr),this.event("hierarchyloaded",[this]),this.__loaded=!0},tg.cloneTo=function(tD){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var tY=tD;tY.name=this.name,tY._destroyed=this._destroyed,tY.timer=this.timer,tY._$P=this._$P,tY.active=this._active;var tg=tY.transform.localPosition;this.transform.localPosition.cloneTo(tg),tY.transform.localPosition=tg;var tT=tY.transform.localRotation;this.transform.localRotation.cloneTo(tT),tY.transform.localRotation=tT;var tr=tY.transform.localScale;this.transform.localScale.cloneTo(tr),tY.transform.localScale=tr,tY.isStatic=this.isStatic;var ts=0,ta=0;for(ts=0,ta=this._componentsMap.length;ts<ta;ts++){var tW=tY.addComponent(this._componentsMap[ts]);this._components[ts]._cloneTo(tW)}for(ts=0,ta=this._childs.length;ts<ta;ts++)tY.addChild(this._childs[ts].clone());var tM=tY.getComponentByType(Animator);if(tM){var tE=tM._linkSpritesData;if(tE)for(var tI in tE){for(var tO=tE[tI],tC=tY,tN=0,t$=tO.length;tN<t$&&(tC=tC.getChildByName(tO[tN]));tN++);if(tC){var td=tM._avatarNodeMap[tI];tC._isLinkSpriteToAnimationNode(tM,td,!0)}}}},tg.clone=function(){var tD=new this.constructor;return this.cloneTo(tD),tD},tg.destroy=function(tD){if(void 0===tD&&(tD=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,tD);var tY,tg=0;for(tg=0,tY=this._components.length;tg<tY;tg++)this._components[tg]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,tx.clearRes(this.url),this.loaded||tlY._cancelLoadByUrl(this.url)}},tg._handleSpriteToAvatar=function(tD,tY){tD._avatarNodes;var tg=tD._avatarNodeMap[this.name];tg&&tg.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(tD,tg,tY)},tg._setAnimatorToLinkAvatar=function(tD,tY){this._handleSpriteToAvatar(tD,tY);for(var tg=0,tT=this._childs.length;tg<tT;tg++){this._childs[tg]._setAnimatorToLinkAvatar(tD,tY)}},t$(0,tg,"activeInHierarchy",function(){return this._activeInHierarchy}),t$(0,tg,"_loaded",null,function(tD){this.__loaded=tD}),t$(0,tg,"active",function(){return this._active},function(tD){this._active!==tD&&(this._active=tD,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(tD?this._activeHierarchy():this._inActiveHierarchy()))}),t$(0,tg,"componentsCount",function(){return this._components.length}),t$(0,tg,"loaded",function(){return this.__loaded}),t$(0,tg,"id",function(){return this._id}),t$(0,tg,"url",function(){return this._url}),t$(0,tg,"layer",function(){return this._layer},function(tD){if(this._layer!==tD){if(!tD)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var tY=0,tg=this._colliders.length;if(this._layer)for(tY=0;tY<tg;tY++)this._layer._removeCollider(this._colliders[tY]);for(tY=0;tY<tg;tY++)tD._addCollider(this._colliders[tY])}this._layer=tD,this.event("layerchanged",tD)}}),t$(0,tg,"scene",function(){return this._scene}),t$(0,tg,"transform",function(){return this._transform}),tY.instantiate=function(tD,tY,tg,tT,tr){void 0===tg&&(tg=!0);var ts=tD.clone();tY&&tY.addChild(ts);var ta=ts.transform;if(tg){var tW=ta.worldMatrix;tD.transform.worldMatrix.cloneTo(tW),ta.worldMatrix=tW}else tT&&(ta.position=tT),tr&&(ta.rotation=tr);return ts},tY.load=function(tD){return tl.loader.create(tD,null,null,tY)},tY.WORLDMATRIX=0,tY.MVPMATRIX=1,tY._uniqueIDCounter=0,tY._nameNumberCounter=0,tY}(),tcY=function(tD){function tI(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],tI.__super.call(this),!tD||!tY)throw"Shader Error";this._id=++tI._count,this._vs=tD,this._ps=tY,this._attributeMap=tg,this._sceneUniformMap=tT,this._cameraUniformMap=tr,this._spriteUniformMap=ts,this._materialUniformMap=ta,this._renderElementUniformMap=tW,this._precompile=tM,this._define=tE,this._precompile&&tI.extCompileObj&&tI.extCompileFunc?tI.extCompileFunc.call(tI.extCompileObj,tD,tY,tE):this.recreateResource()}tN(tI,"laya.d3.shader.Shader3D",tg);var tY=tI.prototype;return tY.recreateResource=function(){th.now();this._compile(),this.completeCreate(),this.memorySize=0},tY.disposeResource=function(){tz.mainContext.deleteShader(this._vshader),tz.mainContext.deleteShader(this._pshader),tz.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},tY._compile=function(){if(!tz.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var tD=[this._vs,this._ps],tY=tz.mainContext;if(this._program=tY.createProgram(),this._vshader=tI._createShader(tY,tD[0],35633),this._pshader=tI._createShader(tY,tD[1],35632),tY.attachShader(this._program,this._vshader),tY.attachShader(this._program,this._pshader),tY.linkProgram(this._program),!td.isConchApp&&tXY.debugMode&&!tY.getProgramParameter(this._program,35714))throw tY.getProgramInfoLog(this._program);var tg,tT=0,tr=0,ts=0;for(ts=td.isConchApp?tY.getProgramParameterEx(this._vs,this._ps,"",35721):tY.getProgramParameter(this._program,35721),tT=0;tT<ts;tT++){var ta=null;tg={vartype:"attribute",ivartype:0,attrib:ta=td.isConchApp?tY.getActiveAttribEx(this._vs,this._ps,"",tT):tY.getActiveAttrib(this._program,tT),location:tY.getAttribLocation(this._program,ta.name),name:ta.name,type:ta.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(tg)}var tW=0;for(tW=td.isConchApp?tY.getProgramParameterEx(this._vs,this._ps,"",35718):tY.getProgramParameter(this._program,35718),tT=0;tT<tW;tT++){var tM=null;tM=td.isConchApp?tY.getActiveUniformEx(this._vs,this._ps,"",tT):tY.getActiveUniform(this._program,tT),0<(tg={vartype:"uniform",ivartype:1,attrib:ta,location:tY.getUniformLocation(this._program,tM.name),name:tM.name,type:tM.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(tg.name=tg.name.substr(0,tg.name.length-3),tg.isArray=!0,tg.location=tY.getUniformLocation(this._program,tg.name)),this._uniformParams.push(tg)}for(tT=0,tr=this._attributeParams.length;tT<tr;tT++)(tg=this._attributeParams[tT]).indexOfParams=tT,tg.index=1,tg.value=[tg.location,null],tg.codename=tg.name,tg.name=null!=this._attributeMap[tg.codename]?this._attributeMap[tg.codename]:tg.codename,this._attributeParamsMap.push(tg.name),this._attributeParamsMap.push(tg),tg._this=this,tg.uploadedValue=[],tg.fun=this._attribute;for(tT=0,tr=this._uniformParams.length;tT<tr;tT++)switch((tg=this._uniformParams[tT]).indexOfParams=tT,tg.index=1,tg.value=[tg.location,null],tg.codename=tg.name,null!=this._sceneUniformMap[tg.codename]?(tg.name=this._sceneUniformMap[tg.codename],this._sceneUniformParamsMap.push(tg.name),this._sceneUniformParamsMap.push(tg)):null!=this._cameraUniformMap[tg.codename]?(tg.name=this._cameraUniformMap[tg.codename],this._cameraUniformParamsMap.push(tg.name),this._cameraUniformParamsMap.push(tg)):null!=this._spriteUniformMap[tg.codename]?(tg.name=this._spriteUniformMap[tg.codename],this._spriteUniformParamsMap.push(tg.name),this._spriteUniformParamsMap.push(tg)):null!=this._materialUniformMap[tg.codename]?(tg.name=this._materialUniformMap[tg.codename],this._materialUniformParamsMap.push(tg.name),this._materialUniformParamsMap.push(tg)):null!=this._renderElementUniformMap[tg.codename]?(tg.name=this._renderElementUniformMap[tg.codename],this._renderElementUniformParamsMap.push(tg.name),this._renderElementUniformParamsMap.push(tg)):console.log("Shader:can't find uinform name:"+tg.codename+" in shader file."),tg._this=this,tg.uploadedValue=[],tg.type){case 5124:tg.fun=tg.isArray?this._uniform1iv:this._uniform1i;break;case 5126:tg.fun=tg.isArray?this._uniform1fv:this._uniform1f;break;case 35664:tg.fun=tg.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:tg.fun=tg.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:tg.fun=tg.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:tg.fun=this._uniform_sampler2D;break;case 35680:tg.fun=this._uniform_samplerCube;break;case 35676:tg.fun=this._uniformMatrix4fv;break;case 35670:tg.fun=this._uniform1i;break;case 35674:tg.fun=this._uinformMatrix2fv;break;case 35675:tg.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},tY._attribute=function(tD,tY){var tg=tz.mainContext,tT=tW._enableAtributes,tr=tD.location;return tT[tr]||tg.enableVertexAttribArray(tr),tg.vertexAttribPointer(tr,tY[0],tY[1],tY[2],tY[3],tY[4]),tT[tr]=tW._bindVertexBuffer,1},tY._uniform1f=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY?(tz.mainContext.uniform1f(tD.location,tg[0]=tY),1):0},tY._uniform1fv=function(tD,tY){if(tY.length<4){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tz.mainContext.uniform1fv(tD.location,tY),tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3],1):0}return tz.mainContext.uniform1fv(tD.location,tY),1},tY._uniform_vec2=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]?(tz.mainContext.uniform2f(tD.location,tg[0]=tY[0],tg[1]=tY[1]),1):0},tY._uniform_vec2v=function(tD,tY){if(tY.length<2){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tz.mainContext.uniform2fv(tD.location,tY),tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3],1):0}return tz.mainContext.uniform2fv(tD.location,tY),1},tY._uniform_vec3=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]?(tz.mainContext.uniform3f(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2]),1):0},tY._uniform_vec3v=function(tD,tY){return tz.mainContext.uniform3fv(tD.location,tY),1},tY._uniform_vec4=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tz.mainContext.uniform4f(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3]),1):0},tY._uniform_vec4v=function(tD,tY){return tz.mainContext.uniform4fv(tD.location,tY),1},tY._uniformMatrix2fv=function(tD,tY){return tz.mainContext.uniformMatrix2fv(tD.location,!1,tY),1},tY._uniformMatrix3fv=function(tD,tY){return tz.mainContext.uniformMatrix3fv(tD.location,!1,tY),1},tY._uniformMatrix4fv=function(tD,tY){return tz.mainContext.uniformMatrix4fv(tD.location,!1,tY),1},tY._uinformMatrix2fv=function(tD,tY){return tz.mainContext.uniformMatrix2fv(tD.location,!1,tY),1},tY._uinformMatrix3fv=function(tD,tY){return tz.mainContext.uniformMatrix3fv(tD.location,!1,tY),1},tY._uniform1i=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY?(tz.mainContext.uniform1i(tD.location,tg[0]=tY),1):0},tY._uniform1iv=function(tD,tY){return tz.mainContext.uniform1iv(tD.location,tY),1},tY._uniform_ivec2=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]?(tz.mainContext.uniform2i(tD.location,tg[0]=tY[0],tg[1]=tY[1]),1):0},tY._uniform_ivec2v=function(tD,tY){return tz.mainContext.uniform2iv(tD.location,tY),1},tY._uniform_vec3i=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]?(tz.mainContext.uniform3i(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2]),1):0},tY._uniform_vec3vi=function(tD,tY){return tz.mainContext.uniform3iv(tD.location,tY),1},tY._uniform_vec4i=function(tD,tY){var tg=tD.uploadedValue;return tg[0]!==tY[0]||tg[1]!==tY[1]||tg[2]!==tY[2]||tg[3]!==tY[3]?(tz.mainContext.uniform4i(tD.location,tg[0]=tY[0],tg[1]=tY[1],tg[2]=tY[2],tg[3]=tY[3]),1):0},tY._uniform_vec4vi=function(tD,tY){return tz.mainContext.uniform4iv(tD.location,tY),1},tY._uniform_sampler2D=function(tD,tY){var tg=tY.source||tY.defaulteTexture.source,tT=tz.mainContext,tr=tD.uploadedValue;if(null!=tr[0])return tT.activeTexture(tI._TEXTURES[tr[0]]),tg&&tm.bindTexture(tT,3553,tg),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return tr[0]=this._curActTexIndex,tT.uniform1i(tD.location,this._curActTexIndex),tT.activeTexture(tI._TEXTURES[this._curActTexIndex]),tg&&tm.bindTexture(tT,3553,tg),this._curActTexIndex++,1},tY._uniform_samplerCube=function(tD,tY){var tg=tY.source||tY.defaulteTexture.source,tT=tz.mainContext,tr=tD.uploadedValue;if(null!=tr[0])return tT.activeTexture(tI._TEXTURES[tr[0]]),tg?tm.bindTexture(tT,34067,tg):tm.bindTexture(tT,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return tr[0]=this._curActTexIndex,tT.uniform1i(tD.location,this._curActTexIndex),tT.activeTexture(tI._TEXTURES[this._curActTexIndex]),tg?tm.bindTexture(tT,34067,tg):tm.bindTexture(tT,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},tY._noSetValue=function(tD){console.log("no....:"+tD.name)},tY.bind=function(){return tg.activeShader=this,(tg.bindShader=this).activeResource(),tm.UseProgram(this._program)},tY.uploadAttributes=function(tD,tY){for(var tg,tT,tr=0,ts=0,ta=this._attributeParamsMap.length;ts<ta;ts+=2)tT=this._attributeParamsMap[ts+1],null!=(tg=tD[this._attributeParamsMap[ts]])&&(tY&&tY[tT.name]&&tY[tT.name].bind(),tr+=tT.fun.call(this,tT,tg));tA.shaderCall+=tr},tY.uploadAttributesX=function(tD,tY){for(var tg,tT,tr=0,ts=0,ta=this._attributeParamsMap.length;ts<ta;ts+=2)tT=this._attributeParamsMap[ts+1],null!=(tg=tD[this._attributeParamsMap[ts]])&&(tY._bind(),tr+=tT.fun.call(this,tT,tg));tA.shaderCall+=tr},tY.uploadSceneUniforms=function(tD){for(var tY,tg,tT=0,tr=0,ts=this._sceneUniformParamsMap.length;tr<ts;tr+=2)tg=this._sceneUniformParamsMap[tr+1],null!=(tY=tD[this._sceneUniformParamsMap[tr]])&&(tT+=tg.fun.call(this,tg,tY));tA.shaderCall+=tT},tY.uploadCameraUniforms=function(tD){for(var tY,tg,tT=0,tr=0,ts=this._cameraUniformParamsMap.length;tr<ts;tr+=2)tg=this._cameraUniformParamsMap[tr+1],null!=(tY=tD[this._cameraUniformParamsMap[tr]])&&(tT+=tg.fun.call(this,tg,tY));tA.shaderCall+=tT},tY.uploadSpriteUniforms=function(tD){for(var tY,tg,tT=0,tr=0,ts=this._spriteUniformParamsMap.length;tr<ts;tr+=2)tg=this._spriteUniformParamsMap[tr+1],null!=(tY=tD[this._spriteUniformParamsMap[tr]])&&(tT+=tg.fun.call(this,tg,tY));tA.shaderCall+=tT},tY.uploadMaterialUniforms=function(tD){for(var tY,tg,tT=0,tr=0,ts=this._materialUniformParamsMap.length;tr<ts;tr+=2)tg=this._materialUniformParamsMap[tr+1],null!=(tY=tD[this._materialUniformParamsMap[tr]])&&(tT+=tg.fun.call(this,tg,tY));tA.shaderCall+=tT},tY.uploadRenderElementUniforms=function(tD){for(var tY,tg,tT=0,tr=0,ts=this._renderElementUniformParamsMap.length;tr<ts;tr+=2)tg=this._renderElementUniformParamsMap[tr+1],null!=(tY=tD[this._renderElementUniformParamsMap[tr]])&&(tT+=tg.fun.call(this,tg,tY));tA.shaderCall+=tT},tI.create=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){return new tI(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE)},tI.addInclude=function(tD,tY){tZ.addInclude(tD,tY)},tI._createShader=function(tD,tY,tg){var tT=tD.createShader(tg);if(tD.shaderSource(tT,tY),tD.compileShader(tT),tXY.debugMode&&!tD.getShaderParameter(tT,35713))throw tD.getShaderInfoLog(tT);return tT},tI.PERIOD_RENDERELEMENT=0,tI.PERIOD_MATERIAL=1,tI.PERIOD_SPRITE=2,tI.PERIOD_CAMERA=3,tI.PERIOD_SCENE=4,tI._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],tI._count=0,tI._preCompile=!1,tI.extCompileFunc=null,tI.extCompileObj=null,tO(tI,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new tq}]),tI}(),tfY=function(tW){function tM(){this._transformUV=null,tM.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new tEY(.6,.6,.6)),this._setColor(10,new tEY(1,1,1)),this._setColor(11,new tIY(1,1,1,8)),this._setColor(12,new tEY(1,1,1)),this._setColor(7,new tIY(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new tIY(1,1,0,0)),this.renderMode=1}tN(tM,"laya.d3.core.material.StandardMaterial",tW);var tD=tM.prototype;return tD.disableLight=function(){this._addDisablePublicShaderDefine(tXY.SHADERDEFINE_POINTLIGHT|tXY.SHADERDEFINE_SPOTLIGHT|tXY.SHADERDEFINE_DIRECTIONLIGHT)},tD.disableFog=function(){this._addDisablePublicShaderDefine(tXY.SHADERDEFINE_FOG)},tD.onAsynLoaded=function(tD,tY,tg){var tT=tY[0];if(tT.version)tW.prototype.onAsynLoaded.call(this,tD,tY,tg);else{var tr=tY[1],ts=tT.props;for(var ta in ts)this[ta]=ts[ta];tM._parseStandardMaterial(tr,this,tT),this._endLoaded()}},tD.cloneTo=function(tD){tW.prototype.cloneTo.call(this,tD);var tY=tD;this._transformUV&&(tY._transformUV=this._transformUV.clone())},t$(0,tD,"ambientColor",function(){return this._getColor(9)},function(tD){this._setColor(9,tD)}),t$(0,tD,"ambientTexture",function(){return this._getTexture(5)},function(tD){tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,tD)}),t$(0,tD,"renderMode",null,function(tD){switch(tD){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(tM.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(tD)}),t$(0,tD,"reflectColor",function(){return this._getColor(12)},function(tD){this._setColor(12,tD)}),t$(0,tD,"tilingOffset",function(){return this._getColor(15)},function(tD){if(tD){var tY=tD.elements;1!=tY[0]||1!=tY[1]||0!=tY[2]||0!=tY[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,tD)}),t$(0,tD,"albedo",function(){return this._getColor(7)},function(tD){this._setColor(7,tD)}),t$(0,tD,"diffuseColor",function(){return this._getColor(10)},function(tD){this._setColor(10,tD)}),t$(0,tD,"albedoColor",function(){return this._getColor(7)},function(tD){this._setColor(7,tD)}),t$(0,tD,"specularColor",function(){return this._getColor(11)},function(tD){this._setColor(11,tD)}),t$(0,tD,"diffuseTexture",function(){return this._getTexture(1)},function(tD){tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,tD)}),t$(0,tD,"normalTexture",function(){return this._getTexture(2)},function(tD){tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,tD)}),t$(0,tD,"specularTexture",function(){return this._getTexture(3)},function(tD){tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,tD)}),t$(0,tD,"emissiveTexture",function(){return this._getTexture(4)},function(tD){tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,tD)}),t$(0,tD,"reflectTexture",function(){return this._getTexture(6)},function(tD){tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,tD)}),t$(0,tD,"transformUV",function(){return this._transformUV},function(tD){this._transformUV=tD,this._setMatrix4x4(13,tD.matrix),tD?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,tD.matrix.elements,0)}),tM.__init__=function(){tM.SHADERDEFINE_DIFFUSEMAP=tM.shaderDefines.registerDefine("DIFFUSEMAP"),tM.SHADERDEFINE_NORMALMAP=tM.shaderDefines.registerDefine("NORMALMAP"),tM.SHADERDEFINE_SPECULARMAP=tM.shaderDefines.registerDefine("SPECULARMAP"),tM.SHADERDEFINE_EMISSIVEMAP=tM.shaderDefines.registerDefine("EMISSIVEMAP"),tM.SHADERDEFINE_AMBIENTMAP=tM.shaderDefines.registerDefine("AMBIENTMAP"),tM.SHADERDEFINE_REFLECTMAP=tM.shaderDefines.registerDefine("REFLECTMAP"),tM.SHADERDEFINE_UVTRANSFORM=tM.shaderDefines.registerDefine("UVTRANSFORM"),tM.SHADERDEFINE_TILINGOFFSET=tM.shaderDefines.registerDefine("TILINGOFFSET"),tM.SHADERDEFINE_ADDTIVEFOG=tM.shaderDefines.registerDefine("ADDTIVEFOG")},tM.load=function(tD){return tl.loader.create(tD,null,null,tM)},tM._parseStandardMaterial=function(tD,tY,tg){var tT=tg.customProps,tr=tT.ambientColor;tY.ambientColor=new tEY(tr[0],tr[1],tr[2]);var ts=tT.diffuseColor;tY.diffuseColor=new tEY(ts[0],ts[1],ts[2]);var ta=tT.specularColor;tY.specularColor=new tIY(ta[0],ta[1],ta[2],ta[3]);var tW=tT.reflectColor;tY.reflectColor=new tEY(tW[0],tW[1],tW[2]);var tM=tT.albedoColor;tM&&(tY.albedo=new tIY(tM[0],tM[1],tM[2],tM[3]));var tE=tT.diffuseTexture.texture2D;tE&&(tY.diffuseTexture=tx.getRes(tD[tE]));var tI=tT.normalTexture.texture2D;tI&&(tY.normalTexture=tx.getRes(tD[tI]));var tO=tT.specularTexture.texture2D;tO&&(tY.specularTexture=tx.getRes(tD[tO]));var tC=tT.emissiveTexture.texture2D;tC&&(tY.emissiveTexture=tx.getRes(tD[tC]));var tN=tT.ambientTexture.texture2D;tN&&(tY.ambientTexture=tx.getRes(tD[tN]));var t$=tT.reflectTexture.texture2D;t$&&(tY.reflectTexture=tx.getRes(tD[t$]))},tM.RENDERMODE_OPAQUE=1,tM.RENDERMODE_OPAQUEDOUBLEFACE=2,tM.RENDERMODE_CUTOUT=3,tM.RENDERMODE_CUTOUTDOUBLEFACE=4,tM.RENDERMODE_TRANSPARENT=13,tM.RENDERMODE_TRANSPARENTDOUBLEFACE=14,tM.RENDERMODE_ADDTIVE=15,tM.RENDERMODE_ADDTIVEDOUBLEFACE=16,tM.RENDERMODE_DEPTHREAD_TRANSPARENT=5,tM.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,tM.RENDERMODE_DEPTHREAD_ADDTIVE=7,tM.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,tM.RENDERMODE_NONDEPTH_TRANSPARENT=9,tM.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,tM.RENDERMODE_NONDEPTH_ADDTIVE=11,tM.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,tM.SHADERDEFINE_DIFFUSEMAP=0,tM.SHADERDEFINE_NORMALMAP=0,tM.SHADERDEFINE_SPECULARMAP=0,tM.SHADERDEFINE_EMISSIVEMAP=0,tM.SHADERDEFINE_AMBIENTMAP=0,tM.SHADERDEFINE_REFLECTMAP=0,tM.SHADERDEFINE_UVTRANSFORM=0,tM.SHADERDEFINE_TILINGOFFSET=0,tM.SHADERDEFINE_ADDTIVEFOG=0,tM.DIFFUSETEXTURE=1,tM.NORMALTEXTURE=2,tM.SPECULARTEXTURE=3,tM.EMISSIVETEXTURE=4,tM.AMBIENTTEXTURE=5,tM.REFLECTTEXTURE=6,tM.ALBEDO=7,tM.UVANIAGE=8,tM.MATERIALAMBIENT=9,tM.MATERIALDIFFUSE=10,tM.MATERIALSPECULAR=11,tM.MATERIALREFLECT=12,tM.UVMATRIX=13,tM.UVAGE=14,tM.TILINGOFFSET=15,tO(tM,["defaultMaterial",function(){var tD=new tM;return tD.lock=!0,this.defaultMaterial=tD},"shaderDefines",function(){return this.shaderDefines=new tNY(tiY.shaderDefines)}]),tM}(tiY),teY=function(tD){function ta(tD,tY,tg,tT,tr){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===tg&&(tg=35044),void 0===tT&&(tT=!1),ta.__super.call(this),this._indexType=tD,this._indexCount=tY,this._bufferUsage=tg,this._bufferType=34963,this._canRead=tT;var ts;if("ushort"==tD)this._indexTypeByteCount=2;else{if("ubyte"!=tD)throw new Error("unidentification index type.");this._indexTypeByteCount=1}ts=this._indexTypeByteCount*tY,this._byteLength=ts,this._bind(),tW._gl.bufferData(this._bufferType,ts,this._bufferUsage),this.uri=tr,tT?("ushort"==tD?this._buffer=new Uint16Array(tY):"ubyte"==tD&&(this._buffer=new Uint8Array(tY)),this.memorySize=2*ts):this.memorySize=ts}tN(ta,"laya.d3.graphics.IndexBuffer3D",tD);var tY=ta.prototype;return tY.setData=function(tD,tY,tg,tT){void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=4294967295);var tr=0;if("ushort"==this._indexType?(tr=2,0===tg&&4294967295===tT||(tD=new Uint16Array(tD.buffer,tg*tr,tT))):"ubyte"==this._indexType&&(tr=1,0===tg&&4294967295===tT||(tD=new Uint8Array(tD.buffer,tg*tr,tT))),this._bind(),tW._gl.bufferSubData(this._bufferType,tY*tr,tD),this._canRead)if(0!==tY||0!==tg||4294967295!==tT){var ts=this._buffer.length-tY;ts<tT&&(tT=ts);for(var ta=0;ta<tT;ta++)this._buffer[tY+ta]=tD[ta]}else this._buffer=tD},tY.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},tY.disposeResource=function(){tD.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},t$(0,tY,"indexType",function(){return this._indexType}),t$(0,tY,"indexTypeByteCount",function(){return this._indexTypeByteCount}),t$(0,tY,"indexCount",function(){return this._indexCount}),t$(0,tY,"canRead",function(){return this._canRead}),ta.INDEXTYPE_UBYTE="ubyte",ta.INDEXTYPE_USHORT="ushort",ta.create=function(tD,tY,tg,tT,tr){return void 0===tg&&(tg=35044),void 0===tT&&(tT=!1),new ta(tD,tY,tg,tT,tr)},ta}(tW),tkY=function(ts){function ta(tD,tY,tg,tT,tr){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===tT&&(tT=!1),ta.__super.call(this),this._vertexDeclaration=tD,this._vertexCount=tY,this._bufferUsage=tg,this._bufferType=34962,this._canRead=tT,this.uri=tr,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*tY,this._bind(),tW._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),tT&&(this._buffer=new Float32Array(this._byteLength/4))}tN(ta,"laya.d3.graphics.VertexBuffer3D",ts);var tD=ta.prototype;return tD.bindWithIndexBuffer=function(tD){tD&&tD._bind(),this._bind()},tD.setData=function(tD,tY,tg,tT){if(void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=4294967295),0===tg&&4294967295===tT||(tD=new Float32Array(tD.buffer,4*tg,tT)),this._bind(),tW._gl.bufferSubData(this._bufferType,4*tY,tD),this._canRead)if(0!==tY||0!==tg||4294967295!==tT){var tr=this._buffer.length-tY;tr<tT&&(tT=tr);for(var ts=0;ts<tT;ts++)this._buffer[tY+ts]=tD[ts]}else this._buffer=tD},tD.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},tD.disposeResource=function(){for(var tD=tz.mainContext,tY=this._vertexDeclaration.getVertexElements(),tg=tW._enableAtributes,tT=0,tr=tY.length;tT<tr;tT++)tg[tT]===this._glBuffer&&(tD.disableVertexAttribArray(tT),tg[tT]=null);ts.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},t$(0,tD,"vertexDeclaration",function(){return this._vertexDeclaration}),t$(0,tD,"vertexCount",function(){return this._vertexCount}),t$(0,tD,"canRead",function(){return this._canRead}),ta.create=function(tD,tY,tg,tT,tr){return void 0===tg&&(tg=35044),void 0===tT&&(tT=!1),new ta(tD,tY,tg,tT,tr)},ta}(tW),twY=function(tD){function tM(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,tM.__super.call(this),this._needUpdate=!1}tN(tM,"laya.d3.component.physics.BoxCollider",tHY);var tY=tM.prototype;return tY._updateCollider=function(){if(this._needUpdate){var tD=this._transformOrientedBoundBox.transformation,tY=this._owner.transform,tg=tY.rotation,tT=tY.scale,tr=this.center.elements;0===tr[0]&&0===tr[1]&&0===tr[2]?tgY.createAffineTransformation(tY.position,tg,tEY.ONE,tD):(tEY.multiply(this.center,tT,tM._deviationV3),tEY.transformQuat(tM._deviationV3,tg,tM._deviationV3),tEY.add(tY.position,tM._deviationV3,tM._deviationV3),tgY.createAffineTransformation(tM._deviationV3,tg,tEY.ONE,tD)),this._transformOrientedBoundBox.transformation=tD;var ts=this._transformOrientedBoundBox.extents.elements,ta=this._size.elements,tW=tT.elements;ts[0]=.5*ta[0]*tW[0],ts[1]=.5*ta[1]*tW[1],ts[2]=.5*ta[2]*tW[2],this._needUpdate=!1}},tY._onWorldMatrixChanged=function(){for(var tD in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[tD]=!0,this._runtimeCollisonMap[tD]._runtimeCollisonTestMap[this.id]=!0},tY._initialize=function(tD){laya.d3.component.Component3D.prototype._initialize.call(this,tD),this._transformOrientedBoundBox=new tTY(new tEY,new tgY),this._size=new tEY,this.center=new tEY,tD.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},tY._getType=function(){return 1},tY._collisonTo=function(tD){switch(tD._getType()){case 0:return 0!==this.boundBox.containsSphere(tD.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(tD.boundBox);case 2:var tY=tD;if(0===this.boundBox.containsBoundBox(tY._boundBox))return!1;for(var tg=tD.mesh._positions,tT=0,tr=tg.length;tT<tr;tT++)if(1===this.boundBox.containsPoint(tg[tT]))return!0;return!1;default:throw new Error("BoxCollider:unknown collider type.")}},tY._cloneTo=function(tD){var tY=tD,tg=tY.size;this.size.cloneTo(tg),tY.size=tg,this.center.cloneTo(tY.center)},tY.raycast=function(tD,tY,tg){void 0===tg&&(tg=179e306),this._updateCollider();var tT=this._transformOrientedBoundBox.intersectsRay(tD,tY.position);return-1!==tT&&tT<=tg?(tY.distance=tT,tY.sprite3D=this._owner,!0):(tY.distance=-1,tY.sprite3D=null,!1)},tY.setFromBoundBox=function(tD){tTY.createByBoundBox(tD,this._transformOrientedBoundBox);var tY=this._transformOrientedBoundBox.extents;this._size=new tEY(2*tY.x,2*tY.y,2*tY.z),this.center=new tEY,tEY.add(tD.min,tD.max,this.center),tEY.scale(this.center,.5,this.center),this._needUpdate=!0},t$(0,tY,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),t$(0,tY,"size",function(){return this._size},function(tD){this._size=tD,this._needUpdate=!0}),tO(tM,["_deviationV3",function(){return this._deviationV3=new tEY},"_obbCenterV3",function(){return this._obbCenterV3=new tEY}]),tM}(),tKY=function(tD){function tZ(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,tZ.__super.call(this),this._type=3553}tN(tZ,"laya.d3.resource.DataTexture2D",tPY);var tY=tZ.prototype;return tY.genDebugMipmaps=function(){var tD=[];return tD.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),tD.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),tD.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),tD.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),tD.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),tD.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),tD.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),tD.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),tD.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),tD.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),tD},tY._onTextureLoaded=function(tD){},tY._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var tD=tz.mainContext,tY=this._source=tD.createTexture(),tg=this._width,tT=this._height,tr=tm.curBindTexTarget,ts=tm.curBindTexValue,ta=!1;if(tm.bindTexture(tD,this._type,tY),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var tW=0;tD.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var tM=0;tM<this._mipmaps.length;tM++){if(this._mipmaps[tM].byteLength!=tE*tI*4)throw"mipmap size error  level:"+tM;tD.texSubImage2D(this._type,0,tZ.simLodRect[tW++],tZ.simLodRect[tW++],tZ.simLodRect[tW++],tZ.simLodRect[tW++],6408,5121,new Uint8Array(this._mipmaps[tM]))}this.minFifter=9729,this.magFifter=9729}else{var tE=this._width,tI=this._height;for(tW=0,tD.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),tM=0;tM<this._mipmaps.length;tM++){if(this._mipmaps[tM].byteLength!=tE*tI*4)throw"mipmap size error  level:"+tM;tD.texImage2D(this._type,tM,6408,tE,tI,0,6408,5121,new Uint8Array(this._mipmaps[tM])),(tE/=2)<1&&(tE=1),(tI/=2)<1&&(tI=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&tD.pixelStorei(tD.UNPACK_ALIGNMENT,1),tD.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var tO=0,tC=!1,tN=!1;this._buffer.byteLength==4*tg*tT?(tO=6408,tC=!0):this._buffer.byteLength==3*tg*tT?(tO=6407,tN=!0):tO=this._format,tC||tN?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),tN&&tD.pixelStorei(tD.UNPACK_ALIGNMENT,1),tD.texImage2D(this._type,0,tO,tg,tT,0,tO,5121,this._buffer)):tD&&tO==tD.ALPHA?(tD.texImage2D(3553,0,tO,tg,tT,0,tO,tD.UNSIGNED_BYTE,this._buffer),ta=!0):0!=tO&&(tD.compressedTexImage2D(3553,0,tO,tg,tT,0,this._buffer),ta=!0)}var t$=this._minFifter,td=this._magFifter,tJ=0==this._wrapModeU?10497:33071,tx=0==this._wrapModeV?10497:33071,tj=tp.isPOT(tg,tT);tj?(this._mipmap||this._mipmaps?-1!==t$||(t$=9987):-1!==t$||(t$=9729),-1!==td||(td=9729),tD.texParameteri(this._type,10241,t$),tD.texParameteri(this._type,10240,td),tD.texParameteri(this._type,10242,tJ),tD.texParameteri(this._type,10243,tx),this._mipmap&&tD.generateMipmap(this._type)):(-1!==t$||(t$=9729),-1!==td||(td=9729),tD.texParameteri(this._type,10241,t$),tD.texParameteri(this._type,10240,td),tD.texParameteri(this._type,10242,33071),tD.texParameteri(this._type,10243,33071)),tr&&ts&&tm.bindTexture(tD,tr,ts),this.memorySize=ta?this._buffer.length:tj?tg*tT*4*(1+1/3):tg*tT*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},tY.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},tY.onAsynLoaded=function(tD,tY,tg){var tT;tg&&(tT=tg[0].call(this,tY)),tT&&(this._width=tT.width,this._height=tT.height,this._buffer=tT.data),this._src=tD,this._size=new tZY(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},tY.getPixels=function(){return new Uint8Array(this._buffer)},tY.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(tz.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},t$(0,tY,"src",function(){return this._src}),tZ.create=function(tD,tY,tg,tT,tr,ts,ta){if(void 0===tT&&(tT=9729),void 0===tr&&(tr=9729),void 0===ts&&(ts=!0),!tD||tD.byteLength<tY*tg*4)throw"DataTexture2D create error";var tW=new tZ;return tW.uri=ta,tW._buffer=tD,tW._width=tY,tW._height=tg,tW._mipmap=ts,tW._magFifter=tT,tW._minFifter=tr,tW._size=new tZY(tW._width,tW._height),tW._conchTexture?alert("怎么给runtime传递datatexture数据"):tW.activeResource(),tW},tZ.load=function(tD,tY,tg,tT,tr){if(void 0===tY&&(tY=0),void 0===tg&&(tg=0),void 0===tT&&(tT=9729),void 0===tr&&(tr=9729),"mipmaps"===tb.getFileExtension(tD)){var ts=tl.loader.create(tD,null,null,tZ,[function(tD){this._mipmaps=[];var tY=new Uint32Array(tD);this._width=tY[0];var tg=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,tg=1024),this._width!=tg)throw"现在只支持512x256的环境贴图。当前的是"+tY[0];this._height=tY[1];for(var tT=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,tr=this._height,ts=8;;){var ta=tT*tr*4;if(ts+ta>tD.byteLength)throw"load mipmaps data size error ";var tW=new Uint8Array(tD,ts,ta);if(this._mipmaps.push(tW),ts+=ta,1==tT&&1==tr)break;(tT/=2)<1&&(tT=1),(tr/=2)<1&&(tr=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){ts.simLodInfo=new Float32Array(40);for(var ta=0;ta<ts.simLodInfo.length;)ts.simLodInfo[ta]=(tZ.simLodRect[ta]+.5)/1024,ta++,ts.simLodInfo[ta]=(tZ.simLodRect[ta]+.5)/256,ta++,ts.simLodInfo[ta]=Math.max(tZ.simLodRect[ta]-1,.1)/1024,ta++,ts.simLodInfo[ta]=Math.max(tZ.simLodRect[ta]-1.5,.1)/256,ta++}return ts}if("number"==typeof tY)return tl.loader.create(tD,null,null,tZ,[function(tD){return this._width=tY,this._height=tg,this._buffer=tD,null}]);if("function"==typeof tY)return tl.loader.create(tD,null,null,tZ,[tY]);throw new Error("unknown params.")},tZ.lodasatlas=!1,tO(tZ,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),tZ}(),toY=function(tD){function tY(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,tY.__super.call(this)}tN(tY,"laya.d3.resource.models.PrimitiveMesh",tBY);var tg=tY.prototype;return tl.imps(tg,{"laya.d3.core.render.IRenderable":!0}),tg._getVertexBuffer=function(tD){return void 0===tD&&(tD=0),0===tD?this._vertexBuffer:null},tg._getVertexBuffers=function(){return null},tg._getIndexBuffer=function(){return this._indexBuffer},tg._getPositions=function(){var tD,tY=[],tg=this._vertexBuffer.vertexDeclaration.getVertexElements(),tT=0;for(tT=0;tT<tg.length;tT++){var tr=tg[tT];if("vector3"===tr.elementFormat&&0===tr.elementUsage){tD=tr;break}}var ts=this._vertexBuffer.getData();for(tT=0;tT<ts.length;tT+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var ta=tT+tD.offset/4,tW=new tEY(ts[ta+0],ts[ta+1],ts[ta+2]);tY.push(tW)}return tY},tg.getRenderElement=function(tD){return this},tg.getRenderElementsCount=function(){return 1},tg.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},tg._beforeRender=function(tD){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},tg._render=function(tD){tz.mainContext.drawElements(4,this._numberIndices,5123,0),tA.drawCall++,tA.trianglesFaces+=this._numberIndices/3},t$(0,tg,"_vertexBufferCount",function(){return 1}),t$(0,tg,"triangleCount",function(){return this._indexBuffer.indexCount/3}),tY}(),tRY=function(tD){function tY(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,tY.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}tN(tY,"laya.d3.resource.models.Mesh",tBY);var tg=tY.prototype;return tg._getPositions=function(){var tD,tY,tg,tT,tr,ts=[],ta=0,tW=0,tM=0;if(0!==this._vertexBuffers.length){var tE=this._vertexBuffers.length;for(ta=0;ta<tE;ta++){for(tg=(tD=this._vertexBuffers[ta]).vertexDeclaration.getVertexElements(),tW=0;tW<tg.length;tW++)if("vector3"===(tT=tg[tW]).elementFormat&&0===tT.elementUsage){tY=tT;break}for(tr=tD.getData(),tW=0;tW<tr.length;tW+=tD.vertexDeclaration.vertexStride/4)tM=tW+tY.offset/4,ts.push(new tEY(tr[tM+0],tr[tM+1],tr[tM+2]))}}else{var tI=this._subMeshes.length;for(ta=0;ta<tI;ta++){for(tg=(tD=this._subMeshes[ta]._getVertexBuffer()).vertexDeclaration.getVertexElements(),tW=0;tW<tg.length;tW++)if("vector3"===(tT=tg[tW]).elementFormat&&0===tT.elementUsage){tY=tT;break}for(tr=tD.getData(),tW=0;tW<tr.length;tW+=tD.vertexDeclaration.vertexStride/4)tM=tW+tY.offset/4,ts.push(new tEY(tr[tM+0],tr[tM+1],tr[tM+2]))}}return ts},tg._setSubMeshes=function(tD){this._subMeshes=tD,this._subMeshCount=tD.length;for(var tY=0;tY<this._subMeshCount;tY++)tD[tY]._indexInMesh=tY;this._positions=this._getPositions(),this._generateBoundingObject()},tg.onAsynLoaded=function(tD,tY,tg){var tT=tY[0],tr=tY[1];tQD.read(tT,this,this._materials,this._subMeshes,tr),this.completeCreate(),this._endLoaded()},tg.getSubMesh=function(tD){return this._subMeshes[tD]},tg.getSubMeshCount=function(){return this._subMeshes.length},tg.getRenderElementsCount=function(){return this._subMeshes.length},tg.getRenderElement=function(tD){return this._subMeshes[tD]},tg.disposeResource=function(){for(var tD=0;tD<this._subMeshes.length;tD++)this._subMeshes[tD].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},t$(0,tg,"materials",function(){return this._materials.slice()}),t$(0,tg,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),tY.load=function(tD){return tl.loader.create(tD,null,null,tY)},tY}(),tQY=(function(tD){function tE(tD,tY,tg,tT,tr,ts,ta,tW,tM){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===tg&&(tg=6408),void 0===tT&&(tT=5121),void 0===tr&&(tr=33189),void 0===ts&&(ts=!1),void 0===ta&&(ta=!1),void 0===tW&&(tW=-1),void 0===tM&&(tM=-1),tE.__super.call(this),this._type=3553,this._width=tD,this._height=tY,this._size=new tZY(tD,tY),this._surfaceFormat=tg,this._surfaceType=tT,this._depthStencilFormat=tr,td.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=ts,this._repeat=ta,this._minFifter=tW,this._magFifter=tM,this.activeResource(),this._alreadyResolved=!0}tN(tE,"laya.d3.resource.RenderTexture",tPY);var tY=tE.prototype;tY.recreateResource=function(){var tD=tz.mainContext;this._frameBuffer=tD.createFramebuffer(),this._source=tD.createTexture();var tY=tm.curBindTexTarget,tg=tm.curBindTexValue;tm.bindTexture(tD,this._type,this._source),tD.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var tT=this._minFifter,tr=this._magFifter,ts=this._repeat?10497:33071;if(tp.isPOT(this._width,this._height)?(this._mipmap?-1!==tT||(tT=9987):-1!==tT||(tT=9729),-1!==tr||(tr=9729),tD.texParameteri(this._type,10241,tT),tD.texParameteri(this._type,10240,tr),tD.texParameteri(this._type,10242,ts),tD.texParameteri(this._type,10243,ts),this._mipmap&&tD.generateMipmap(this._type)):(-1!==tT||(tT=9729),-1!==tr||(tr=9729),tD.texParameteri(this._type,10241,tT),tD.texParameteri(this._type,10240,tr),tD.texParameteri(this._type,10242,33071),tD.texParameteri(this._type,10243,33071)),tY&&tg&&tm.bindTexture(tD,tY,tg),tD.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=tD.createRenderbuffer(),tD.bindRenderbuffer(36161,this._depthStencilBuffer),tD.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),tD.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:tD.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:tD.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:tD.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}tD.framebufferTexture2D(36160,36064,3553,this._source,0),tD.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},tY.start=function(){tz.mainContext.bindFramebuffer(36160,this.frameBuffer),(tE._currentRenderTarget=this)._alreadyResolved=!1},tY.end=function(){tz.mainContext.bindFramebuffer(36160,null),tE._currentRenderTarget=null,this._alreadyResolved=!0},tY.getData=function(tD,tY,tg,tT){var tr=tz.mainContext;if(tr.bindFramebuffer(36160,this._frameBuffer),!(36053===tr.checkFramebufferStatus(36160)))return tr.bindFramebuffer(36160,null),null;var ts=new Uint8Array(this._width*this._height*4);return tr.readPixels(tD,tY,tg,tT,this._surfaceFormat,this._surfaceType,ts),tr.bindFramebuffer(36160,null),ts},tY.disposeResource=function(){if(this._frameBuffer){var tD=tz.mainContext;tD.deleteTexture(this._source),tD.deleteFramebuffer(this._frameBuffer),tD.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},t$(0,tY,"surfaceFormat",function(){return this._surfaceFormat}),t$(0,tY,"surfaceType",function(){return this._surfaceType}),t$(0,tY,"depthStencilFormat",function(){return this._depthStencilFormat}),t$(0,tY,"source",function(){return this._alreadyResolved?tl.superGet(tPY,this,"source"):null}),t$(0,tY,"depthStencilBuffer",function(){return this._depthStencilBuffer}),t$(0,tY,"frameBuffer",function(){return this._frameBuffer}),tE._currentRenderTarget=null}(),function(tD){function tY(tD){this._color=null,this._pixels=null,tY.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new tZY(this.width,this.height),this._color=tD,this._pixels=new Uint8Array([255*tD.x,255*tD.y,255*tD.z,255*tD.w]),this.uri="SolidColorTexture2D_"+this.id}tN(tY,"laya.d3.resource.SolidColorTexture2D",tPY);var tg=tY.prototype;return tg._createWebGlTexture=function(){var tD=tz.mainContext,tY=this._source=tD.createTexture(),tg=this._width,tT=this._height,tr=tm.curBindTexTarget,ts=tm.curBindTexValue;tm.bindTexture(tD,this._type,tY),tD.texImage2D(this._type,0,6408,tg,tT,0,6408,5121,this._pixels);var ta=this._minFifter,tW=this._magFifter,tM=this._repeat?10497:33071,tE=tp.isPOT(tg,tT);tE?(this._mipmap?-1!==ta||(ta=9987):-1!==ta||(ta=9729),-1!==tW||(tW=9729),tD.texParameteri(this._type,10241,ta),tD.texParameteri(this._type,10240,tW),tD.texParameteri(this._type,10242,tM),tD.texParameteri(this._type,10243,tM),this._mipmap&&tD.generateMipmap(this._type)):(-1!==ta||(ta=9729),-1!==tW||(tW=9729),tD.texParameteri(this._type,10241,ta),tD.texParameteri(this._type,10240,tW),tD.texParameteri(this._type,10242,33071),tD.texParameteri(this._type,10243,33071)),tr&&ts&&tm.bindTexture(tD,tr,ts),this.memorySize=tE?tg*tT*4*(1+1/3):tg*tT*4},tg.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},tg.disposeResource=function(){this._source&&(tz.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},tO(tY,["magentaTexture",function(){var tD=new tY(new tIY(1,0,1,1));return tD.lock=!0,this.magentaTexture=tD},"grayTexture",function(){var tD=new tY(new tIY(.5,.5,.5,1));return tD.lock=!0,this.grayTexture=tD}]),tY}()),tLY=function(tD){function tr(tD,tY,tg,tT){this._canRead=!1,this._image=null,this._pixels=null,void 0===tD&&(tD=!1),void 0===tY&&(tY=!0),void 0===tg&&(tg=6408),void 0===tT&&(tT=!0),tr.__super.call(this),this._type=3553,this._repeat=tY,this._canRead=tD,this._format=tg,this._mipmap=tT}tN(tr,"laya.d3.resource.Texture2D",tPY);var tY=tr.prototype;return tY._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var tD=tz.mainContext,tY=this._source=tD.createTexture(),tg=this._width,tT=this._height,tr=tm.curBindTexTarget,ts=tm.curBindTexValue;switch(tm.bindTexture(tD,this._type,tY),this._format){case 6407:case 6408:this._canRead?tD.texImage2D(this._type,0,this._format,tg,tT,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?tD.texImage2D(this._type,0,this._image._format,tg,tT,0,this._image._format,5121,this._image.atlasSource):tD.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case tz.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:tD.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var ta=this._minFifter,tW=this._magFifter,tM=this._repeat?10497:33071,tE=0==this._wrapModeU?10497:33071,tI=0==this._wrapModeV?10497:33071,tO=tp.isPOT(tg,tT);tO?(this._mipmap?-1!==ta||(ta=9987):-1!==ta||(ta=9729),-1!==tW||(tW=9729),tD.texParameteri(this._type,10241,ta),tD.texParameteri(this._type,10240,tW),tD.texParameteri(this._type,10242,tM),tD.texParameteri(this._type,10243,tM),tD.texParameteri(this._type,10242,tE),tD.texParameteri(this._type,10243,tI),this._mipmap&&tD.generateMipmap(this._type)):(-1!==ta||(ta=9729),-1!==tW||(tW=9729),tD.texParameteri(this._type,10241,ta),tD.texParameteri(this._type,10240,tW),tD.texParameteri(this._type,10242,33071),tD.texParameteri(this._type,10243,33071)),tr&&ts&&tm.bindTexture(tD,tr,ts),this._image.onload=null,this._image=null,this.memorySize=tO?tg*tT*4*(1+1/3):tg*tT*4},tY.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},tY.onAsynLoaded=function(tD,tY,tg){if(tg){var tT=tg[0];void 0!==tT&&(this._canRead=tT);var tr=tg[1];void 0!==tr&&(this._repeat=tr);var ts=tg[2];void 0!==ts&&(this._format=ts);var ta=tg[3];void 0!==ta&&(this._mipmap=ta);var tW=tg.wrapModeU;void 0!==tW&&(this._wrapModeU=tW);var tM=tg.wrapModeV;void 0!==tM&&(this._wrapModeV=tM)}switch(this._format){case 6407:case 6408:var tE=(this._image=tY).width,tI=tY.height;this._width=tE,this._height=tI,this._size=new tZY(tE,tI),this._canRead&&(td.isConchApp?tY instanceof tC.HTMLElement&&(this._pixels=new Uint8Array(tY.getImageData(0,0,tE,tI))):(th.canvas.size(tE,tI),th.canvas.clear(),th.context.drawImage(tY,0,0,tE,tI),this._pixels=new Uint8Array(th.context.getImageData(0,0,tE,tI).data.buffer)));break;case tz.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var tO=new tt(tY);tO.readUTFBytes(4),tO.readUTFBytes(2),tO.getInt16();tO.endian="bigEndian",this._width=tO.getInt16(),this._height=tO.getInt16(),this._size=new tZY(this._width,this._height);tO.getInt16(),tO.getInt16();this._image=new Uint8Array(tY,tO.pos)}this.recreateResource(),this._endLoaded()},tY.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},tY.disposeResource=function(){this._source&&(tz.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},t$(0,tY,"_src",function(){return this.url}),t$(0,tY,"src",function(){return this.url}),tr.load=function(tD){return tl.loader.create(tD,null,null,tr)},tr}(),tyY=function(tY){function tg(tD,tY){tg.__super.call(this),void 0===tD&&(tD=.3),void 0===tY&&(tY=1e3),this._tempVector3=new tEY,this._position=new tEY,this._up=new tEY,this._forward=new tEY,this._right=new tEY,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=tZY.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=tD,this._farPlane=tY,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),tl.stage.on("resize",this,this._onScreenSizeChanged)}tN(tg,"laya.d3.core.BaseCamera",tY);var tD=tg.prototype;return tD._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var tD=this.scene._cameraPool,tY=tD.length-1,tg=0;tg<tY;tg++)if(tD[tg].renderingOrder>tD[tY].renderingOrder){var tT=tD[tg];tD[tg]=tD[tY],tD[tY]=tT}},tD._calculateProjectionMatrix=function(){},tD._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},tD._prepareCameraToRender=function(){ti._currentCameraCullingMask=this.cullingMask;var tD=this._shaderValues;tD.setValue(0,this.transform.position.elements),tD.setValue(5,this.forward.elements),tD.setValue(6,this.up.elements)},tD._prepareCameraViewProject=function(tD,tY){var tg=this._shaderValues;tg.setValue(1,tD.elements),tg.setValue(2,tY.elements)},tD._renderCamera=function(tD,tY,tg){},tD.addLayer=function(tD){29!==tD.number&&30!=tD.number&&(this.cullingMask=this.cullingMask|tD.mask)},tD.removeLayer=function(tD){29!==tD.number&&30!=tD.number&&(this.cullingMask=this.cullingMask&~tD.mask)},tD.addAllLayers=function(){this.cullingMask=2147483647},tD.removeAllLayers=function(){this.cullingMask=0|ti.getLayerByNumber(29).mask|ti.getLayerByNumber(30).mask},tD.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},tD.moveForward=function(tD){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=tD,this.transform.translate(this._tempVector3)},tD.moveRight=function(tD){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=tD,this.transform.translate(this._tempVector3)},tD.moveVertical=function(tD){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=tD,this.transform.translate(this._tempVector3,!1)},tD._addSelfRenderObjects=function(){var tD=this.scene._cameraPool,tY=tD.length;if(0<tY){for(var tg=tY-1;0<=tg;tg--)if(this.renderingOrder<=tD[tg].renderingOrder){tD.splice(tg+1,0,this);break}}else tD.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},tD._clearSelfRenderObjects=function(){var tD=this.scene._cameraPool;tD.splice(tD.indexOf(this),1)},tD.destroy=function(tD){void 0===tD&&(tD=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,tl.stage.off("resize",this,this._onScreenSizeChanged),tY.prototype.destroy.call(this,tD)},t$(0,tD,"sky",function(){return this._sky},function(tD){(this._sky=tD)._ownerCamera=this}),t$(0,tD,"forward",function(){var tD=this.transform.worldMatrix.elements,tY=this._forward.elements;return tY[0]=-tD[8],tY[1]=-tD[9],tY[2]=-tD[10],this._forward}),t$(0,tD,"position",function(){var tD=this.transform.worldMatrix.elements,tY=this._position.elements;return tY[0]=tD[12],tY[1]=tD[13],tY[2]=tD[14],this._position}),t$(0,tD,"renderTarget",function(){return this._renderTarget},function(tD){null!=(this._renderTarget=tD)&&(this._renderTargetSize=tD.size)}),t$(0,tD,"up",function(){var tD=this.transform.worldMatrix.elements,tY=this._up.elements;return tY[0]=tD[4],tY[1]=tD[5],tY[2]=tD[6],this._up}),t$(0,tD,"right",function(){var tD=this.transform.worldMatrix.elements,tY=this._right.elements;return tY[0]=tD[0],tY[1]=tD[1],tY[2]=tD[2],this._right}),t$(0,tD,"renderTargetSize",function(){return this._renderTargetSize},function(tD){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=tD,this._calculateProjectionMatrix()}),t$(0,tD,"fieldOfView",function(){return this._fieldOfView},function(tD){this._fieldOfView=tD,this._calculateProjectionMatrix()}),t$(0,tD,"nearPlane",function(){return this._nearPlane},function(tD){this._nearPlane=tD,this._calculateProjectionMatrix()}),t$(0,tD,"farPlane",function(){return this._farPlane},function(tD){this._farPlane=tD,this._calculateProjectionMatrix()}),t$(0,tD,"orthographic",function(){return this._orthographic},function(tD){this._orthographic=tD,this._calculateProjectionMatrix()}),t$(0,tD,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(tD){this._orthographicVerticalSize=tD,this._calculateProjectionMatrix()}),t$(0,tD,"renderingOrder",function(){return this._renderingOrder},function(tD){this._renderingOrder=tD,this._sortCamerasByRenderingOrder()}),tg.CAMERAPOS=0,tg.VIEWMATRIX=1,tg.PROJECTMATRIX=2,tg.VPMATRIX=3,tg.VPMATRIX_NO_TRANSLATE=4,tg.CAMERADIRECTION=5,tg.CAMERAUP=6,tg.ENVIRONMENTDIFFUSE=7,tg.ENVIRONMENTSPECULAR=8,tg.SIMLODINFO=9,tg.DIFFUSEIRRADMATR=10,tg.DIFFUSEIRRADMATG=11,tg.DIFFUSEIRRADMATB=12,tg.HDREXPOSURE=13,tg.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",tg.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",tg.CLEARFLAG_SOLIDCOLOR=0,tg.CLEARFLAG_SKY=1,tg.CLEARFLAG_DEPTHONLY=2,tg.CLEARFLAG_NONE=3,tO(tg,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new tgY(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new tgY},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new tgY}]),tg}(tVY),tuY=function(tg){function tY(tD){this._render=null,this._geometryFilter=null,tY.__super.call(this,tD)}tN(tY,"laya.d3.core.RenderableSprite3D",tg);var tD=tY.prototype;return tD._addToInitStaticBatchManager=function(){},tD._setBelongScene=function(tD){tg.prototype._setBelongScene.call(this,tD),tD._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},tD._setUnBelongScene=function(){var tD=this._scene._renderableSprite3Ds,tY=tD.indexOf(this);tD.splice(tY,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),tg.prototype._setUnBelongScene.call(this)},tD._update=function(tD){(tD.owner=this)._activeInHierarchy&&(this._updateComponents(tD),this._render._updateOctreeNode(),this._lateUpdateComponents(tD),tA.spriteCount++,this._childs.length&&this._updateChilds(tD))},tD.destroy=function(tD){void 0===tD&&(tD=!0),tg.prototype.destroy.call(this,tD),this._render._destroy(),this._render=null},tY.__init__=function(){tY.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=tY.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),tY.SAHDERDEFINE_LIGHTMAP=tY.shaderDefines.registerDefine("LIGHTMAP")},tY.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,tY.SAHDERDEFINE_LIGHTMAP=4,tY.LIGHTMAPSCALEOFFSET=2,tY.LIGHTMAP=3,tO(tY,["shaderDefines",function(){return this.shaderDefines=new tNY}]),tY}(tVY),tnY=(function(tD){function tT(tD,tY,tg){this._long=NaN,this._width=NaN,this._height=NaN,void 0===tD&&(tD=1),void 0===tY&&(tY=1),void 0===tg&&(tg=1),tT.__super.call(this),this._long=tD,this._width=tY,this._height=tg,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}tN(tT,"laya.d3.resource.models.BoxMesh",toY);var tY=tT.prototype;tY.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var tD=tzD.vertexDeclaration,tY=(tD.vertexStride,this._long/2),tg=this._height/2,tT=this._width/2,tr=new Float32Array([-tY,tg,-tT,0,1,0,0,0,tY,tg,-tT,0,1,0,1,0,tY,tg,tT,0,1,0,1,1,-tY,tg,tT,0,1,0,0,1,-tY,-tg,-tT,0,-1,0,0,1,tY,-tg,-tT,0,-1,0,1,1,tY,-tg,tT,0,-1,0,1,0,-tY,-tg,tT,0,-1,0,0,0,-tY,tg,-tT,-1,0,0,0,0,-tY,tg,tT,-1,0,0,1,0,-tY,-tg,tT,-1,0,0,1,1,-tY,-tg,-tT,-1,0,0,0,1,tY,tg,-tT,1,0,0,1,0,tY,tg,tT,1,0,0,0,0,tY,-tg,tT,1,0,0,0,1,tY,-tg,-tT,1,0,0,1,1,-tY,tg,tT,0,0,1,0,0,tY,tg,tT,0,0,1,1,0,tY,-tg,tT,0,0,1,1,1,-tY,-tg,tT,0,0,1,0,1,-tY,tg,-tT,0,0,-1,1,0,tY,tg,-tT,0,0,-1,0,0,tY,-tg,-tT,0,0,-1,0,1,-tY,-tg,-tT,0,0,-1,1,1]),ts=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new tkY(tD,this._numberVertices,35044,!0),this._indexBuffer=new teY("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(tr),this._indexBuffer.setData(ts),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},t$(0,tY,"long",function(){return this._long},function(tD){this._long!==tD&&(this._long=tD,this.releaseResource(),this.activeResource())}),t$(0,tY,"width",function(){return this._width},function(tD){this._width!==tD&&(this._width=tD,this.releaseResource(),this.activeResource())}),t$(0,tY,"height",function(){return this._height},function(tD){this._height!==tD&&(this._height=tD,this.releaseResource(),this.activeResource())})}(),function(tD){function tr(tD,tY,tg,tT){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===tD&&(tD=10),void 0===tY&&(tY=10),void 0===tg&&(tg=10),void 0===tT&&(tT=10),tr.__super.call(this),this._long=tD,this._width=tY,this._stacks=tg,this._slices=tT,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}tN(tr,"laya.d3.resource.models.PlaneMesh",toY);var tY=tr.prototype;tY.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var tD=new Uint16Array(this._numberIndices),tY=tzD.vertexDeclaration,tg=tY.vertexStride/4,tT=new Float32Array(this._numberVertices*tg),tr=this._long/2,ts=this._width/2,ta=this._long/this._stacks,tW=this._width/this._slices,tM=0,tE=0;tE<=this._slices;tE++)for(var tI=0;tI<=this._stacks;tI++)tT[tM++]=tI*ta-tr,tT[tM++]=0,tT[tM++]=tE*tW-ts,tT[tM++]=0,tT[tM++]=1,tT[tM++]=0,tT[tM++]=1*tI/this._stacks,tT[tM++]=1*tE/this._slices;var tO=0;for(tE=0;tE<this._slices;tE++)for(tI=0;tI<this._stacks;tI++)tD[tO++]=(tE+1)*(this._stacks+1)+tI,tD[tO++]=tE*(this._stacks+1)+tI,tD[tO++]=(tE+1)*(this._stacks+1)+tI+1,tD[tO++]=tE*(this._stacks+1)+tI,tD[tO++]=tE*(this._stacks+1)+tI+1,tD[tO++]=(tE+1)*(this._stacks+1)+tI+1;this._vertexBuffer=new tkY(tY,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new teY("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData(tT),this._indexBuffer.setData(tD),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},t$(0,tY,"long",function(){return this._long},function(tD){this._long!==tD&&(this._long=tD,this.releaseResource(),this.activeResource())}),t$(0,tY,"width",function(){return this._width},function(tD){this._width!==tD&&(this._width=tD,this.releaseResource(),this.activeResource())}),t$(0,tY,"stacks",function(){return this._stacks},function(tD){this._stacks!==tD&&(this._stacks=tD,this.releaseResource(),this.activeResource())}),t$(0,tY,"slices",function(){return this._slices},function(tD){this._slices!==tD&&(this._slices=tD,this.releaseResource(),this.activeResource())})}(),function(tD){function tT(tD,tY,tg){this._long=NaN,this._width=NaN,void 0===tD&&(tD=1),void 0===tY&&(tY=1),tT.__super.call(this),this._long=tD,this._width=tY,this.uri=tg,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}tN(tT,"laya.d3.resource.models.QuadMesh",toY);var tY=tT.prototype;tY.recreateResource=function(){this.disposeResource(),this._numberVertices=4,this._numberIndices=6;var tD=tzD.vertexDeclaration,tY=(tD.vertexStride,this._long/2),tg=this._width/2,tT=new Float32Array([-tY,tg,0,0,0,1,0,0,tY,tg,0,0,0,1,1,0,-tY,-tg,0,0,0,1,0,1,tY,-tg,0,0,0,1,1,1]),tr=new Uint16Array([0,1,2,3,2,1]);this._vertexBuffer=new tkY(tD,this._numberVertices,35044,!0,this.uri),this._vertexBuffer._addReference(),this._indexBuffer=new teY("ushort",this._numberIndices,35044,!0,this.uri),this._indexBuffer._addReference(),this._vertexBuffer.setData(tT),this._indexBuffer.setData(tr),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},tY.reset=function(tD,tY){this._long===tD&&this._width===tY||(this._long=tD,this._width=tY,this.releaseResource(),this.activeResource())},t$(0,tY,"long",function(){return this._long},function(tD){this._long!==tD&&(this._long=tD,this.releaseResource(),this.activeResource())}),t$(0,tY,"width",function(){return this._width},function(tD){this._width!==tD&&(this._width=tD,this.releaseResource(),this.activeResource())})}(),function(tD){function ta(tD,tY,tg){void 0===tD&&(tD=0),void 0===tY&&(tY=.3),void 0===tg&&(tg=1e3),this._viewMatrix=new tgY,this._projectionMatrix=new tgY,this._projectionViewMatrix=new tgY,this._viewport=new tOY(0,0,0,0),this._normalizedViewport=new tOY(0,0,1,1),this._aspectRatio=tD,this._boundFrustumUpdate=!0,this._boundFrustum=new tyD(tgY.DEFAULT),ta.__super.call(this,tY,tg),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}tN(ta,"laya.d3.core.Camera",tyY);var tY=ta.prototype;return tY._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},tY._parseCustomProps=function(tD,tY,tg,tT){var tr=tg.clearColor;this.clearColor=new tIY(tr[0],tr[1],tr[2],tr[3]);var ts=tg.viewport;this.normalizedViewport=new tOY(ts[0],ts[1],ts[2],ts[3])},tY._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var tD=this.orthographicVerticalSize*this.aspectRatio*.5,tY=.5*this.orthographicVerticalSize;tgY.createOrthoOffCenterRH(-tD,tD,-tY,tY,this.nearPlane,this.farPlane,this._projectionMatrix)}else tgY.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},tY._update=function(tD){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,tD)},tY._renderCamera=function(tD,tY,tg){var tT,tr;tg.parallelSplitShadowMaps[0]&&tg._renderShadowMap(tD,tY,this),(tY.camera=this)._prepareCameraToRender(),tg._preRenderUpdateComponents(tY),tT=tY._viewMatrix=this.viewMatrix;var ts=this._renderTarget;ts?(ts.start(),tgY.multiply(tyY._invertYScaleMatrix,this._projectionMatrix,tyY._invertYProjectionMatrix),tgY.multiply(tyY._invertYScaleMatrix,this.projectionViewMatrix,tyY._invertYProjectionViewMatrix),tr=tY._projectionMatrix=tyY._invertYProjectionMatrix,tY._projectionViewMatrix=tyY._invertYProjectionViewMatrix):(tr=tY._projectionMatrix=this._projectionMatrix,tY._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(tT,tr),tY._viewport=this.viewport,tg._preRenderScene(tD,tY,this.boundFrustum),tg._clear(tD,tY),tg._renderScene(tD,tY),tg._postRenderUpdateComponents(tY),ts&&ts.end()},tY.viewportPointToRay=function(tD,tY){txY.calculateCursorRay(tD,this.viewport,this._projectionMatrix,this.viewMatrix,null,tY)},tY.normalizedViewportPointToRay=function(tD,tY){var tg=ta._tempVector20,tT=this.viewport,tr=tD.elements,ts=tg.elements;ts[0]=tr[0]*tT.width,ts[1]=tr[1]*tT.height,txY.calculateCursorRay(tg,this.viewport,this._projectionMatrix,this.viewMatrix,null,tY)},tY.worldToViewportPoint=function(tD,tY){tgY.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(tD,this._projectionViewMatrix,tY);var tg=tY.elements;tg[0]=tg[0]/tl.stage.clientScaleX,tg[1]=tg[1]/tl.stage.clientScaleY},tY.worldToNormalizedViewportPoint=function(tD,tY){tgY.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(tD,this._projectionViewMatrix,tY);var tg=tY.elements;tg[0]=tg[0]/tl.stage.clientScaleX,tg[1]=tg[1]/tl.stage.clientScaleY},tY.convertScreenCoordToOrthographicCoord=function(tD,tY,tg){if(void 0===tg&&(tg=!0),this._orthographic){var tT=tR.clientWidth,tr=tR.clientHeight,ts=this.orthographicVerticalSize*this.aspectRatio/tT,ta=this.orthographicVerticalSize/tr,tW=tD.elements,tM=tY.elements;return tM[0]=(-tT/2+tW[0])*ts,tM[1]=(tr/2-tW[1])*ta,tM[2]=(this.nearPlane-this.farPlane)*(tW[2]+1)/2-this.nearPlane,tg&&tEY.transformCoordinate(tY,this.transform.worldMatrix,tY),!0}return!1},t$(0,tY,"projectionViewMatrix",function(){return tgY.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),t$(0,tY,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var tD=this.viewport;return tD.width/tD.height},function(tD){if(tD<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=tD,this._calculateProjectionMatrix()}),t$(0,tY,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),t$(0,tY,"needViewport",function(){var tD=this.normalizedViewport;return 0===tD.x&&0===tD.y&&1===tD.width&&1===tD.height}),t$(0,tY,"viewport",function(){if(this._viewportExpressedInClipSpace){var tD=this._normalizedViewport,tY=this.renderTargetSize,tg=tY.width,tT=tY.height;this._viewport.x=tD.x*tg,this._viewport.y=tD.y*tT,this._viewport.width=tD.width*tg,this._viewport.height=tD.height*tT}return this._viewport},function(tD){if(null!=this.renderTarget&&(tD.x<0||tD.y<0||0==tD.width||0==tD.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=tD,this._calculateProjectionMatrix()}),t$(0,tY,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var tD=this._viewport,tY=this.renderTargetSize,tg=tY.width,tT=tY.height;this._normalizedViewport.x=tD.x/tg,this._normalizedViewport.y=tD.y/tT,this._normalizedViewport.width=tD.width/tg,this._normalizedViewport.height=tD.height/tT}return this._normalizedViewport},function(tD){tD.x<0&&(tD.x=0,console.warn("Camera: viewport.x must large than 0.0.")),tD.y<0&&(tD.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<tD.x+tD.width&&(tD.width=1-tD.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<tD.y+tD.height&&(tD.height=1-tD.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=tD,this._calculateProjectionMatrix()}),t$(0,tY,"projectionMatrix",function(){return this._projectionMatrix},function(tD){this._projectionMatrix=tD,this._useUserProjectionMatrix=!0}),t$(0,tY,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),tO(ta,["_tempVector20",function(){return this._tempVector20=new tMY}]),ta}()),tDg=function(tg){function tT(tD,tY){tT.__super.call(this,tY),this._geometryFilter=new tSY(this),this._render=new tUY(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),tD&&(this._geometryFilter.sharedMesh=tD)instanceof laya.d3.resource.models.Mesh&&(tD.loaded?this._render.sharedMaterials=tD.materials:tD.once("loaded",this,this._applyMeshMaterials))}tN(tT,"laya.d3.core.MeshSprite3D",tg);var tD=tT.prototype;return tD._changeRenderObjectByMesh=function(tD){var tY=this._render._renderElements,tg=tY[tD];tg||(tg=tY[tD]=new tGY),tg._render=this._render;var tT=this._render.sharedMaterials[tD];tT||(tT=tfY.defaultMaterial);var tr=this._geometryFilter.sharedMesh.getRenderElement(tD);return tg._mainSortID=this._getSortID(tr,tT),tg._sprite3D=this,tg.renderObj=tr,tg._material=tT,tg},tD._changeRenderObjectByMaterial=function(tD,tY){var tg=this._render._renderElements[tD];tY||(tY=tfY.defaultMaterial);var tT=this._geometryFilter.sharedMesh.getRenderElement(tD);return tg._mainSortID=this._getSortID(tT,tY),tg._sprite3D=this,tg.renderObj=tT,tg._material=tY,tg},tD._changeRenderObjectsByMesh=function(){var tD=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=tD;for(var tY=0;tY<tD;tY++)this._changeRenderObjectByMesh(tY)},tD._onMeshChanged=function(tD){var tY=tD.sharedMesh;tY.loaded?this._changeRenderObjectsByMesh():tY.once("loaded",this,this._onMeshLoaded)},tD._onMeshLoaded=function(tD){tD===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},tD._onMaterialChanged=function(tD,tY,tg){tY<this._render._renderElements.length&&this._changeRenderObjectByMaterial(tY,tg)},tD._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},tD._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},tD._parseCustomProps=function(tD,tY,tg,tT){var tr=this.meshRender,ts=tg.lightmapIndex;null!=ts&&(tr.lightmapIndex=ts);var ta,tW,tM=tg.lightmapScaleOffset;if(tM&&(tr.lightmapScaleOffset=new tIY(tM[0],tM[1],tM[2],tM[3])),tT.instanceParams)(ta=tT.instanceParams.loadPath)&&(tW=tx.getRes(tY[ta]),(this.meshFilter.sharedMesh=tW).loaded?tr.sharedMaterials=tW.materials:tW.once("loaded",this,this._applyMeshMaterials));else{(ta=tg.meshPath)&&(tW=tx.getRes(tY[ta]),this.meshFilter.sharedMesh=tW);var tE=tg.materials;if(tE){var tI=tr.sharedMaterials,tO=tE.length;tI.length=tO;for(var tC=0;tC<tO;tC++)tI[tC]=tx.getRes(tY[tE[tC].path]);tr.sharedMaterials=tI}}},tD._applyMeshMaterials=function(tD){for(var tY=this._render.sharedMaterials,tg=tD.materials,tT=0,tr=tg.length;tT<tr;tT++)tY[tT]||(tY[tT]=tg[tT]);this._render.sharedMaterials=tY},tD._addToInitStaticBatchManager=function(){tT._staticBatchManager._addInitBatchSprite(this)},tD.cloneTo=function(tD){var tY=tD;tY._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var tg=this._render,tT=tY._render;tT.enable=tg.enable,tT.sharedMaterials=tg.sharedMaterials,tT.castShadow=tg.castShadow;var tr=tg.lightmapScaleOffset;tr&&(tT.lightmapScaleOffset=tr.clone()),tT.lightmapIndex=tg.lightmapIndex,tT.receiveShadow=tg.receiveShadow,tT.sortingFudge=tg.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,tD)},tD.destroy=function(tD){if(void 0===tD&&(tD=!0),!this.destroyed){var tY=this.meshFilter.sharedMesh;null!=tY&&(tY.loaded||tY.off("loaded",this,this._applyMeshMaterials)),tg.prototype.destroy.call(this,tD),this._geometryFilter._destroy()}},t$(0,tD,"meshFilter",function(){return this._geometryFilter}),t$(0,tD,"meshRender",function(){return this._render}),tT.__init__=function(){tTD._staticBatchManagers.push(tT._staticBatchManager)},tT.load=function(tD){return tl.loader.create(tD,null,null,tT)},tO(tT,["_staticBatchManager",function(){return this._staticBatchManager=new tzY}]),tT}(tuY)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(tD,tY){"use strict";for(var tg in Object.defineProperty(tY,"__esModule",{value:!0}),Laya){var tT=Laya[tg];tT&&tT.__isclass&&(tY[tg]=tT)}}),function(tD,tY,thD){thD.un,thD.uns;var tg=thD.static,tT=thD.class,ts=thD.getset,td=thD.__newvec,tW=laya.maths.Bezier,tO=laya.utils.Browser,tiD=laya.utils.Byte,tr=(laya.events.Event,laya.events.EventDispatcher),ta=laya.display.Graphics,tM=(laya.resource.HTMLCanvas,laya.utils.Handler),tE=laya.net.Loader,tC=laya.maths.MathUtil,tPD=laya.maths.Matrix,tJ=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),tI=(laya.renders.RenderContext,laya.resource.Resource),tN=laya.utils.RunDriver,trD=laya.display.Sprite,t$=laya.utils.Stat,tBD=laya.resource.Texture,tx=(laya.net.URL,laya.utils.Utils),tm=function(){function tD(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return tT(tD,"laya.ani.AnimationContent"),tD}(),th=function(){function tD(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return tT(tD,"laya.ani.AnimationNodeContent"),tD}(),tZ=function(){function tD(){}return tT(tD,"laya.ani.AnimationParser01"),tD.parse=function(tD,tY){var tg=tY.__getBuffer(),tT=0,tr=0,ts=0,ta=0,tW=0,tM=0,tE=0,tI=tY.readUTFString();tD._aniClassName=tI;var tO,tC=tY.readUTFString().split("\n"),tN=tY.getUint8(),t$=tY.getUint32(),td=tY.getUint32();0<t$&&(tO=tg.slice(t$,td));var tJ=new tiD(tO);for(0<td&&(tD._publicExtData=tg.slice(td,tg.byteLength)),tD._useParent=!!tY.getUint8(),tD._anis.length=tN,tT=0;tT<tN;tT++){var tx=tD._anis[tT]=new tm;tx.nodes=new Array;var tj=tx.name=tC[tY.getUint16()];tD._aniMap[tj]=tT,tx.bone3DMap={},tx.playTime=tY.getFloat32(),tx.playTime<=0&&console.error("播放时间不能为0  url="+tD.url+" name="+tx.name);var tZ=tx.nodes.length=tY.getUint8();for(tr=tx.totalKeyframeDatasLength=0;tr<tZ;tr++){var tp=tx.nodes[tr]=new th;tp.childs=[];var tl=tY.getInt16();0<=tl&&(tp.name=tC[tl],tx.bone3DMap[tp.name]=tr),tp.keyFrame=new Array,tp.parentIndex=tY.getInt16(),-1==tp.parentIndex?tp.parent=null:tp.parent=tx.nodes[tp.parentIndex],tp.lerpType=tY.getUint8();var tt=tY.getUint32();tJ.pos=tt;var t_=tp.keyframeWidth=tJ.getUint16();if(tx.totalKeyframeDatasLength+=t_,0===tp.lerpType||1===tp.lerpType)for(tp.interpolationMethod=[],tp.interpolationMethod.length=t_,ts=0;ts<t_;ts++)tp.interpolationMethod[ts]=tB.interpolation[tJ.getUint8()];null!=tp.parent&&tp.parent.childs.push(tp);var tA=tY.getUint16();0<tA&&(tp.extenData=tg.slice(tY.pos,tY.pos+tA),tY.pos+=tA);var tq,tb=tY.getUint16(),tG=0;for(ts=0,ta=tp.keyFrame.length=tb;ts<ta;ts++){if((tq=tp.keyFrame[ts]=new ti).duration=tY.getFloat32(),tq.startTime=tG,2===tp.lerpType){tq.interpolationData=[];var tX,tz=tY.getUint8();switch(tX=tY.getFloat32()){case 254:for(tq.interpolationData.length=t_,tE=0;tE<t_;tE++)tq.interpolationData[tE]=0;break;case 255:for(tq.interpolationData.length=t_,tE=0;tE<t_;tE++)tq.interpolationData[tE]=5;break;default:for(tq.interpolationData.push(tX),tM=1;tM<tz;tM++)tq.interpolationData.push(tY.getFloat32())}}for(tq.data=new Float32Array(t_),tW=0;tW<t_;tW++)tq.data[tW]=tY.getFloat32(),-1e-8<tq.data[tW]&&tq.data[tW]<1e-8&&(tq.data[tW]=0);tG+=tq.duration}tq.startTime=tx.playTime,tp.playTime=tx.playTime,tD._calculateKeyFrame(tp,tb,t_)}}},tD}(),tp=function(){function tl(){}return tT(tl,"laya.ani.AnimationParser02"),tl.READ_DATA=function(){tl._DATA.offset=tl._reader.getUint32(),tl._DATA.size=tl._reader.getUint32()},tl.READ_BLOCK=function(){for(var tD=tl._BLOCK.count=tl._reader.getUint16(),tY=tl._BLOCK.blockStarts=[],tg=tl._BLOCK.blockLengths=[],tT=0;tT<tD;tT++)tY.push(tl._reader.getUint32()),tg.push(tl._reader.getUint32())},tl.READ_STRINGS=function(){var tD=tl._reader.getUint32(),tY=tl._reader.getUint16(),tg=tl._reader.pos;tl._reader.pos=tD+tl._DATA.offset;for(var tT=0;tT<tY;tT++)tl._strings[tT]=tl._reader.readUTFString();tl._reader.pos=tg},tl.parse=function(tD,tY){tl._templet=tD;(tl._reader=tY).__getBuffer();tl.READ_DATA(),tl.READ_BLOCK(),tl.READ_STRINGS();for(var tg=0,tT=tl._BLOCK.count;tg<tT;tg++){var tr=tY.getUint16(),ts=tl._strings[tr],ta=tl["READ_"+ts];if(null==ta)throw new Error("model file err,no this function:"+tr+" "+ts);ta.call()}},tl.READ_ANIMATIONS=function(){var tD=tl._reader,tY=tD.__getBuffer(),tg=0,tT=0,tr=0,ts=0,ta=tD.getUint16(),tW=[];for(tW.length=ta,tg=0;tg<ta;tg++)tW[tg]=tB.interpolation[tD.getByte()];var tM=tD.getUint8();for(tl._templet._anis.length=tM,tg=0;tg<tM;tg++){var tE=tl._templet._anis[tg]={};tE.nodes=new Array;var tI=tE.name=tl._strings[tD.getUint16()];tl._templet._aniMap[tI]=tg,tE.bone3DMap={},tE.playTime=tD.getFloat32();var tO=tE.nodes.length=tD.getInt16();for(tT=tE.totalKeyframeDatasLength=0;tT<tO;tT++){var tC=tE.nodes[tT]={};tC.keyframeWidth=ta,tC.childs=[];var tN=tD.getUint16();0<=tN&&(tC.name=tl._strings[tN],tE.bone3DMap[tC.name]=tT),tC.keyFrame=new Array,tC.parentIndex=tD.getInt16(),-1==tC.parentIndex?tC.parent=null:tC.parent=tE.nodes[tC.parentIndex],tE.totalKeyframeDatasLength+=ta,tC.interpolationMethod=tW,null!=tC.parent&&tC.parent.childs.push(tC);var t$=tD.getUint16(),td=null,tJ=null;for(tr=0,ts=tC.keyFrame.length=t$;tr<ts;tr++){(td=tC.keyFrame[tr]={}).startTime=tD.getFloat32(),tJ&&(tJ.duration=td.startTime-tJ.startTime);var tx=tl._DATA.offset,tj=tD.getUint32(),tZ=4*ta,tp=tY.slice(tx+tj,tx+tj+tZ);td.data=new Float32Array(tp),tJ=td}td.duration=0,tC.playTime=tE.playTime,tl._templet._calculateKeyFrame(tC,t$,ta)}}},tl._templet=null,tl._reader=null,tl._strings=[],tg(tl,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),tl}(),tHD=(function(){function tD(){}tT(tD,"laya.ani.AnimationState"),tD.stopped=0,tD.paused=1,tD.playing=2}(),function(){function tr(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new tRD,this.resultMatrix=new tPD,this._children=[]}tT(tr,"laya.ani.bone.Bone");var tD=tr.prototype;return tD.setTempMatrix=function(tD){this._tempMatrix=tD;var tY,tg=0;for(tg=0,tY=this._children.length;tg<tY;tg++)this._children[tg].setTempMatrix(this._tempMatrix)},tD.update=function(tD){var tY;if(this.rotation=this.transform.skX,tD)tY=this.resultTransform.getMatrix(),tPD.mul(tY,tD,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)tY=this.resultTransform.getMatrix(),tPD.mul(tY,this.parentBone.resultMatrix,this.resultMatrix);else{var tg=this.parentBone,tT=NaN,tr=NaN,ts=NaN,ta=this.parentBone.resultMatrix;tY=this.resultTransform.getMatrix();var tW=ta.a*tY.tx+ta.c*tY.ty+ta.tx,tM=ta.b*tY.tx+ta.d*tY.ty+ta.ty,tE=new tPD;this.inheritRotation?(tT=Math.atan2(tg.resultMatrix.b,tg.resultMatrix.a),tr=Math.cos(tT),ts=Math.sin(tT),tE.setTo(tr,ts,-ts,tr,0,0),tPD.mul(this._tempMatrix,tE,tPD.TEMP),tPD.TEMP.copyTo(tE),tY=this.resultTransform.getMatrix(),tPD.mul(tY,tE,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,tY=this.resultTransform.getMatrix(),tPD.TEMP.identity(),tPD.TEMP.d=this.d,tPD.mul(tY,tPD.TEMP,this.resultMatrix)),this.resultMatrix.tx=tW,this.resultMatrix.ty=tM}else(tY=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var tI,tO=0;for(tO=0,tI=this._children.length;tO<tI;tO++)this._children[tO].update()},tD.updateChild=function(){var tD,tY=0;for(tY=0,tD=this._children.length;tY<tD;tY++)this._children[tY].update()},tD.setRotation=function(tD){this._sprite&&(this._sprite.rotation=180*tD/Math.PI)},tD.updateDraw=function(tD,tY){tr.ShowBones&&!tr.ShowBones[this.name]||(this._sprite||(this._sprite=new trD,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),thD.stage.addChild(this._sprite)),this._sprite.x=tD+this.resultMatrix.tx,this._sprite.y=tY+this.resultMatrix.ty);var tg,tT=0;for(tT=0,tg=this._children.length;tT<tg;tT++)this._children[tT].updateDraw(tD,tY)},tD.addChild=function(tD){this._children.push(tD),tD.parentBone=this},tD.findBone=function(tD){if(this.name==tD)return this;var tY,tg,tT=0;for(tT=0,tY=this._children.length;tT<tY;tT++)if(tg=this._children[tT].findBone(tD))return tg;return null},tD.localToWorld=function(tD){var tY=tD[0],tg=tD[1];tD[0]=tY*this.resultMatrix.a+tg*this.resultMatrix.c+this.resultMatrix.tx,tD[1]=tY*this.resultMatrix.b+tg*this.resultMatrix.d+this.resultMatrix.ty},tr.ShowBones={},tr}()),tvD=function(){function td(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}tT(td,"laya.ani.bone.BoneSlot");var tD=td.prototype;return tD.showSlotData=function(tD,tY){void 0===tY&&(tY=!0),this.currSlotData=tD,tY&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},tD.showDisplayByName=function(tD){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(tD))},tD.replaceDisplayByName=function(tD,tY){if(this.currSlotData){var tg;tg=this.currSlotData.getDisplayByName(tD);var tT;tT=this.currSlotData.getDisplayByName(tY),this.replaceDisplayByIndex(tg,tT)}},tD.replaceDisplayByIndex=function(tD,tY){this.currSlotData&&(this._replaceDic[tD]=tY,this.displayIndex==tD&&this.showDisplayByIndex(tD))},tD.showDisplayByIndex=function(tD){if(null!=this._replaceDic[tD]&&(tD=this._replaceDic[tD]),this.currSlotData&&-1<tD&&tD<this.currSlotData.displayArr.length){if(this.displayIndex=tD,this.currDisplayData=this.currSlotData.displayArr[tD],this.currDisplayData){var tY=this.currDisplayData.name;this.currTexture=this.templet.getTexture(tY),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!tJ.isConchApp||tJ.isConchApp&&"0.9.15"<trD.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},tD.replaceSkin=function(tD){this._diyTexture=tD,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},tD.setParentMatrix=function(tD){this._parentMatrix=tD},tD.draw=function(tD,tY,tg,tT){if(void 0===tg&&(tg=!1),void 0===tT&&(tT=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var tr,ts=this.currTexture;switch(this._diyTexture&&(ts=this._diyTexture),this.currDisplayData.type){case 0:if(tD){var ta=this.getDisplayMatrix();if(this._parentMatrix){var tW=!1;if(ta){var tM;if(tPD.mul(ta,this._parentMatrix,tPD.TEMP),tM=tg?(null==this._resultMatrix&&(this._resultMatrix=new tPD),this._resultMatrix):new tPD,!tJ.isWebGL&&this.currDisplayData.uvs||tJ.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var tE=td._tempMatrix;tE.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(tE.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(tW=!0,tE.rotate(-Math.PI/2)),tPD.mul(tE,tPD.TEMP,tM)}else tPD.TEMP.copyTo(tM);tW?tD.drawTexture(ts,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,tM):tD.drawTexture(ts,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,tM)}}}break;case 1:if(null==(tr=tg?(null==this._skinSprite&&(this._skinSprite=td.createSkinMesh()),this._skinSprite):td.createSkinMesh()))return;var tI;if(null==this.currDisplayData.bones){var tO,tC=this.currDisplayData.weights;this.deformData&&(tC=this.deformData),tO=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=t_.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=t_.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=tC;this.currDisplayData.triangles.length;tI=this.currDisplayData.triangles,tr.init2(ts,null,tI,this._mVerticleArr,tO);var tN,t$=this.getDisplayMatrix();if(this._parentMatrix)if(t$)tPD.mul(t$,this._parentMatrix,tPD.TEMP),tN=tg?(null==this._resultMatrix&&(this._resultMatrix=new tPD),this._resultMatrix):new tPD,tPD.TEMP.copyTo(tN),tr.transform=tN}else this.skinMesh(tY,tr,tT);tD.drawSkin(tr);break;case 2:if(null==(tr=tg?(null==this._skinSprite&&(this._skinSprite=td.createSkinMesh()),this._skinSprite):td.createSkinMesh()))return;this.skinMesh(tY,tr,tT),tD.drawSkin(tr)}}},tD.skinMesh=function(tD,tY,tg){var tT,tr=this.currTexture,ts=this.currDisplayData.bones;tT=this._diyTexture?(tr=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=t_.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=t_.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var ta,tW,tM=this.currDisplayData.weights,tE=this.currDisplayData.triangles,tI=0,tO=0,tC=0,tN=NaN,t$=NaN,td=0,tJ=0,tx=[],tj=0,tZ=0;if(this.deformData&&0<this.deformData.length){var tp=0;for(tj=0,tZ=ts.length;tj<tZ;){for(tC=ts[tj++]+tj,tO=tI=0;tj<tC;tj++)tW=tD[ts[tj]],tN=tM[td]+this.deformData[tp++],t$=tM[td+1]+this.deformData[tp++],tJ=tM[td+2],tI+=(tN*tW.a+t$*tW.c+tW.tx)*tJ,tO+=(tN*tW.b+t$*tW.d+tW.ty)*tJ,td+=3;tx.push(tI,tO)}}else for(tj=0,tZ=ts.length;tj<tZ;){for(tC=ts[tj++]+tj,tO=tI=0;tj<tC;tj++)tW=tD[ts[tj]],tN=tM[td],t$=tM[td+1],tJ=tM[td+2],tI+=(tN*tW.a+t$*tW.c+tW.tx)*tJ,tO+=(tN*tW.b+t$*tW.d+tW.ty)*tJ,td+=3;tx.push(tI,tO)}this._mVerticleArr=tx,ta=tE,tY.init2(tr,null,ta,this._mVerticleArr,tT)},tD.drawBonePoint=function(tD){tD&&this._parentMatrix&&tD.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},tD.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},tD.getMatrix=function(){return this._resultMatrix},tD.copy=function(){var tD=new td;return tD.type="copy",tD.name=this.name,tD.attachmentName=this.attachmentName,tD.srcDisplayIndex=this.srcDisplayIndex,tD.parent=this.parent,tD.displayIndex=this.displayIndex,tD.templet=this.templet,tD.currSlotData=this.currSlotData,tD.currTexture=this.currTexture,tD.currDisplayData=this.currDisplayData,tD},td.createSkinMesh=function(){return tJ.isWebGL||tJ.isConchApp?tN.skinAniSprite():(tJ.isWebGL,null)},tg(td,["_tempMatrix",function(){return this._tempMatrix=new tPD}]),td}(),tSD=function(){function tD(){this.skinName=null,this.deformSlotDataList=[]}return tT(tD,"laya.ani.bone.DeformAniData"),tD}(),tUD=function(){function tD(){this.deformSlotDisplayList=[]}return tT(tD,"laya.ani.bone.DeformSlotData"),tD}(),tFD=function(){function tD(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}tT(tD,"laya.ani.bone.DeformSlotDisplayData");var tY=tD.prototype;return tY.binarySearch1=function(tD,tY){var tg=0,tT=tD.length-2;if(0==tT)return 1;for(var tr=tT>>>1;;){if(tD[Math.floor(tr+1)]<=tY?tg=tr+1:tT=tr,tg==tT)return tg+1;tr=tg+tT>>>1}return 0},tY.apply=function(tD,tY,tg){if(void 0===tg&&(tg=1),tD+=.05,!(this.timeList.length<=0)){var tT=0;if(!(tD<this.timeList[0])){var tr=this.vectices[0].length,ts=[],ta=this.binarySearch1(this.timeList,tD);if(this.frameIndex=ta,tD>=this.timeList[this.timeList.length-1]){var tW=this.vectices[this.vectices.length-1];if(tg<1)for(tT=0;tT<tr;tT++)ts[tT]+=(tW[tT]-ts[tT])*tg;else for(tT=0;tT<tr;tT++)ts[tT]=tW[tT];this.deformData=ts}else{this.tweenKeyList[this.frameIndex];var tM=this.vectices[this.frameIndex-1],tE=this.vectices[this.frameIndex],tI=this.timeList[this.frameIndex-1],tO=this.timeList[this.frameIndex];tg=this.tweenKeyList[ta-1]?(tD-tI)/(tO-tI):0;var tC=NaN;for(tT=0;tT<tr;tT++)tC=tM[tT],ts[tT]=tC+(tE[tT]-tC)*tg;this.deformData=ts}}}},tD}(),tVD=function(){function tD(){this.time=NaN,this.drawOrder=[]}return tT(tD,"laya.ani.bone.DrawOrderData"),tD}(),tcD=function(){function tD(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return tT(tD,"laya.ani.bone.EventData"),tD}(),tj=function(){function tTD(tD,tY){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=tD,this._targetBone=tY[tD.targetBoneIndex],this.isSpine=tD.isSpine,null==this._bones&&(this._bones=[]);for(var tg=this._bones.length=0,tT=tD.boneIndexs.length;tg<tT;tg++)this._bones.push(tY[tD.boneIndexs[tg]]);this.name=tD.name,this.mix=tD.mix,this.bendDirection=tD.bendDirection}tT(tTD,"laya.ani.bone.IkConstraint");var tD=tTD.prototype;return tD.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},tD._applyIk1=function(tD,tY,tg,tT){var tr=tD.parentBone,ts=1/(tr.resultMatrix.a*tr.resultMatrix.d-tr.resultMatrix.b*tr.resultMatrix.c),ta=tY-tr.resultMatrix.tx,tW=tg-tr.resultMatrix.ty,tM=(ta*tr.resultMatrix.d-tW*tr.resultMatrix.c)*ts-tD.transform.x,tE=(tW*tr.resultMatrix.a-ta*tr.resultMatrix.b)*ts-tD.transform.y,tI=Math.atan2(tE,tM)*tTD.radDeg-0-tD.transform.skX;tD.transform.scX<0&&(tI+=180),180<tI?tI-=360:tI<-180&&(tI+=360),tD.transform.skX=tD.transform.skY=tD.transform.skX+tI*tT,tD.update()},tD.updatePos=function(tD,tY){this._sp&&this._sp.pos(tD,tY)},tD._applyIk2=function(tD,tY,tg,tT,tr,ts){if(0!=ts){var ta=tD.resultTransform.x,tW=tD.resultTransform.y,tM=tD.transform.scX,tE=tD.transform.scY,tI=tY.transform.scX,tO=0,tC=0,tN=0;tN=tM<0?(tM=-tM,tO=180,-1):(tO=0,1),tE<0&&(tE=-tE,tN=-tN),tC=tI<0?(tI=-tI,180):0;var t$=tY.resultTransform.x,td=NaN,tJ=NaN,tx=NaN,tj=tD.resultMatrix.a,tZ=tD.resultMatrix.c,tp=tD.resultMatrix.b,tl=tD.resultMatrix.d,tt=Math.abs(tM-tE)<=1e-4;tx=tt?(tJ=tj*t$+tZ*(td=tY.resultTransform.y)+tD.resultMatrix.tx,tp*t$+tl*td+tD.resultMatrix.ty):(td=0,tJ=tj*t$+tD.resultMatrix.tx,tp*t$+tD.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new trD,thD.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(tg,tT,15,"#ffff00"),this._sp.graphics.drawCircle(tJ,tx,15,"#ff00ff")),tD.setRotation(Math.atan2(tx-tD.resultMatrix.ty,tJ-tD.resultMatrix.tx));var t_=tD.parentBone;tj=t_.resultMatrix.a,tZ=t_.resultMatrix.c,tp=t_.resultMatrix.b;var tA=1/(tj*(tl=t_.resultMatrix.d)-tZ*tp),tq=tg-t_.resultMatrix.tx,tb=tT-t_.resultMatrix.ty,tG=(tq*tl-tb*tZ)*tA-ta,tX=(tb*tj-tq*tp)*tA-tW,tz=((tq=tJ-t_.resultMatrix.tx)*tl-(tb=tx-t_.resultMatrix.ty)*tZ)*tA-ta,tm=(tb*tj-tq*tp)*tA-tW,th=Math.sqrt(tz*tz+tm*tm),ti=tY.length*tI,tP=NaN,tB=NaN;if(tt){var tH=(tG*tG+tX*tX-th*th-(ti*=tM)*ti)/(2*th*ti);tH<-1?tH=-1:1<tH&&(tH=1),tB=Math.acos(tH)*tr,tj=th+ti*tH,tZ=ti*Math.sin(tB),tP=Math.atan2(tX*tj-tG*tZ,tG*tj+tX*tZ)}else{var tv=(tj=tM*ti)*tj,tS=(tZ=tE*ti)*tZ,tU=tG*tG+tX*tX,tF=Math.atan2(tX,tG),tV=-2*tS*th,tc=tS-tv;if(0<(tl=tV*tV-4*tc*(tp=tS*th*th+tv*tU-tv*tS))){var tf=Math.sqrt(tl);tV<0&&(tf=-tf);var te=(tf=-(tV+tf)/2)/tc,tk=tp/tf,tw=Math.abs(te)<Math.abs(tk)?te:tk;tw*tw<=tU&&(tb=Math.sqrt(tU-tw*tw)*tr,tP=tF-Math.atan2(tb,tw),tB=Math.atan2(tb/tE,(tw-th)/tM))}var tK=0,to=Number.MAX_VALUE,tR=0,tQ=0,tL=0,ty=0,tu=0,tn=0;ty<(tl=(tq=th+tj)*tq)&&(tL=0,ty=tl,tu=tq),(tl=(tq=th-tj)*tq)<to&&(tK=Math.PI,to=tl,tR=tq);var tDD=Math.acos(-tj*th/(tv-tS));(tl=(tq=tj*Math.cos(tDD)+th)*tq+(tb=tZ*Math.sin(tDD))*tb)<to&&(tK=tDD,to=tl,tR=tq,tQ=tb),ty<tl&&(tL=tDD,ty=tl,tu=tq,tn=tb),tB=tU<=(to+ty)/2?(tP=tF-Math.atan2(tQ*tr,tR),tK*tr):(tP=tF-Math.atan2(tn*tr,tu),tL*tr)}var tYD=Math.atan2(td,t$)*tN,tgD=tD.resultTransform.skX;180<(tP=(tP-tYD)*tTD.radDeg+tO-tgD)?tP-=360:tP<-180&&(tP+=360),tD.resultTransform.x=ta,tD.resultTransform.y=tW,tD.resultTransform.skX=tD.resultTransform.skY=tgD+tP*ts,tgD=tY.resultTransform.skX,180<(tB=((tB+tYD)*tTD.radDeg-0)*tN+tC-(tgD%=360))?tB-=360:tB<-180&&(tB+=360),tY.resultTransform.x=t$,tY.resultTransform.y=td,tY.resultTransform.skX=tY.resultTransform.skY=tY.resultTransform.skY+tB*ts,tD.update()}},tD._applyIk3=function(tD,tY,tg,tT,tr,ts){if(0!=ts){var ta,tW,tM=tY.resultMatrix.a*tY.length,tE=tY.resultMatrix.b*tY.length,tI=tM*tM+tE*tE,tO=Math.sqrt(tI),tC=tD.resultMatrix.tx,tN=tD.resultMatrix.ty,t$=tY.resultMatrix.tx,td=tY.resultMatrix.ty,tJ=t$-tC,tx=td-tN,tj=tJ*tJ+tx*tx,tZ=Math.sqrt(tj),tp=(tJ=tg-tD.resultMatrix.tx)*tJ+(tx=tT-tD.resultMatrix.ty)*tx,tl=Math.sqrt(tp);if(tO+tZ<=tl||tl+tO<=tZ||tl+tZ<=tO){var tt=NaN;t$=tC+(tt=tO+tZ<=tl?1:-1)*(tg-tC)*tZ/tl,td=tN+tt*(tT-tN)*tZ/tl}else{var t_=(tj-tI+tp)/(2*tp),tA=Math.sqrt(tj-t_*t_*tp)/tl,tq=tC+tJ*t_,tb=tN+tx*t_,tG=-tx*tA,tX=tJ*tA;td=0<tr?(t$=tq-tG,tb-tX):(t$=tq+tG,tb+tX)}ta=t$,tW=td,this.isDebug&&(this._sp||(this._sp=new trD,thD.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(tC,tN,15,"#ff00ff"),this._sp.graphics.drawCircle(tg,tT,15,"#ffff00"),this._sp.graphics.drawCircle(ta,tW,15,"#ff00ff"));var tz,tm;tz=Math.atan2(tW-tD.resultMatrix.ty,ta-tD.resultMatrix.tx),tD.setRotation(tz),(tm=tTD._tempMatrix).identity(),tm.rotate(tz),tm.scale(tD.resultMatrix.getScaleX(),tD.resultMatrix.getScaleY()),tm.translate(tD.resultMatrix.tx,tD.resultMatrix.ty),tm.copyTo(tD.resultMatrix),tD.updateChild();var th,ti;th=Math.atan2(tT-tW,tg-ta),tY.setRotation(th),(ti=tTD._tempMatrix).identity(),ti.rotate(th),ti.scale(tY.resultMatrix.getScaleX(),tY.resultMatrix.getScaleY()),ti.translate(ta,tW),tm.copyTo(tY.resultMatrix),tY.updateChild()}},tg(tTD,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new tPD}]),tTD}(),tfD=function(){function tD(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return tT(tD,"laya.ani.bone.IkConstraintData"),tD}(),tl=function(){function ti(tD,tY){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=tD,this.position=tD.position,this.spacing=tD.spacing,this.rotateMix=tD.rotateMix,this.translateMix=tD.translateMix,this.bones=[];for(var tg=this.data.bones,tT=0,tr=tg.length;tT<tr;tT++)this.bones.push(tY[tg[tT]])}tT(ti,"laya.ani.bone.PathConstraint");var tD=ti.prototype;return tD.apply=function(tD,tY){if(this.target){var tg=this.translateMix,tT=this.translateMix,tr=0<tT,ts=this.data.spacingMode,ta="length"==ts,tW=this.data.rotateMode,tM="tangent"==tW,tE="chainScale"==tW,tI=[],tO=this.bones.length,tC=tM?tO:tO+1,tN=[];(this._spaces=tN)[0]=this.position;var t$=this.spacing;if(tE||ta)for(var td=0,tJ=tC-1;td<tJ;){var tx=this.bones[td],tj=tx.length,tZ=tj*tx.resultMatrix.a,tp=tj*tx.resultMatrix.b;tj=Math.sqrt(tZ*tZ+tp*tp),tE&&(tI[td]=tj),tN[++td]=ta?Math.max(0,tj+t$):t$}else for(td=1;td<tC;td++)tN[td]=t$;var tl=this.computeWorldPositions(this.target,tD,tY,tC,tM,"percent"==this.data.positionMode,"percent"==ts);if(this._debugKey){for(td=0;td<tl.length;td++)tY.drawCircle(tl[td++],tl[td++],5,"#00ff00");var tt=[];for(td=0;td<tl.length;td++)tt.push(tl[td++],tl[td++]);tY.drawLines(0,0,tt,"#ff0000")}var t_=tl[0],tA=tl[1],tq=this.data.offsetRotation,tb="chain"==tW&&0==tq,tG=NaN;for(td=0,tG=3;td<tO;td++,tG+=3){(tx=this.bones[td]).resultMatrix.tx+=(t_-tx.resultMatrix.tx)*tg,tx.resultMatrix.ty+=(tA-tx.resultMatrix.ty)*tg;var tX=(tZ=tl[tG])-t_,tz=(tp=tl[tG+1])-tA;if(tE&&0!=(tj=tI[td])){var tm=(Math.sqrt(tX*tX+tz*tz)/tj-1)*tT+1;tx.resultMatrix.a*=tm,tx.resultMatrix.c*=tm}if(t_=tZ,tA=tp,tr){var th=tx.resultMatrix.a,ti=tx.resultMatrix.c,tP=tx.resultMatrix.b,tB=tx.resultMatrix.d,tH=NaN,tv=NaN,tS=NaN;tH=tM?tl[tG-1]:0==tN[td+1]?tl[tG+2]:Math.atan2(tz,tX),tH-=Math.atan2(tP,th)-tq/180*Math.PI,tb&&(tv=Math.cos(tH),tS=Math.sin(tH),t_+=((tj=tx.length)*(tv*th-tS*tP)-tX)*tT,tA+=(tj*(tS*th+tv*tP)-tz)*tT),tH>Math.PI?tH-=2*Math.PI:tH<-Math.PI&&(tH+=2*Math.PI),tH*=tT,tv=Math.cos(tH),tS=Math.sin(tH),tx.resultMatrix.a=tv*th-tS*tP,tx.resultMatrix.c=tv*ti-tS*tB,tx.resultMatrix.b=tS*th+tv*tP,tx.resultMatrix.d=tS*ti+tv*tB}}}},tD.computeWorldVertices2=function(tD,tY,tg,tT,tr,ts){var ta,tW,tM=tD.currDisplayData.bones,tE=tD.currDisplayData.weights,tI=tD.currDisplayData.triangles,tO=0,tC=0,tN=0,t$=0,td=0,tJ=0,tx=0,tj=0,tZ=0,tp=0,tl=0;if(null!=tM){for(tO=0;tO<tg;tO+=2)tC+=(t$=tM[tC])+1,tN+=t$;var tt=tY;for(td=ts,tJ=3*tN;td<tT;td+=2){for(tj=tx=0,t$=tM[tC++],t$+=tC;tC<t$;tC++,tJ+=3){ta=tt[tM[tC]].resultMatrix,tZ=tE[tJ],tp=tE[tJ+1];var t_=tE[tJ+2];tx+=(tZ*ta.a+tp*ta.c+ta.tx)*t_,tj+=(tZ*ta.b+tp*ta.d+ta.ty)*t_}tr[td]=tx,tr[td+1]=tj}}else{var tA,tq;if(tI||(tI=tE),tD.deformData&&(tI=tD.deformData),tA=tD.parent,tY)for(tl=tY.length,tO=0;tO<tl;tO++)if(tY[tO].name==tA){tW=tY[tO];break}tW&&(tq=tW.resultMatrix),tq||(tq=ti._tempMt);var tb=tq.tx,tG=tq.ty,tX=tq.a,tz=tq.b,tm=tq.c,th=tq.d;for(tW&&(th*=tW.d),tC=tg,td=ts;td<tT;tC+=2,td+=2)tZ=tI[tC],tp=tI[tC+1],tr[td]=tZ*tX+tp*tz+tb,tr[td+1]=-(tZ*tm+tp*th+tG)}},tD.computeWorldPositions=function(tD,tY,tg,tT,tr,ts,ta){tD.currDisplayData.bones,tD.currDisplayData.weights,tD.currDisplayData.triangles;var tW=[],tM=0,tE=tD.currDisplayData.verLen,tI=this.position,tO=this._spaces,tC=[],tN=[],t$=tE/6,td=-1,tJ=NaN,tx=0,tj=0,tZ=NaN,tp=NaN,tl=NaN,tt=NaN;if(t$--,tE-=4,this.computeWorldVertices2(tD,tY,2,tE,tW,0),this._debugKey)for(tM=0;tM<tW.length;)tg.drawCircle(tW[tM++],tW[tM++],10,"#ff0000");tC=tW,this._curves.length=t$;var t_=this._curves,tA=tC[tJ=0],tq=tC[1],tb=0,tG=0,tX=0,tz=0,tm=0,th=0,ti=NaN,tP=NaN,tB=NaN,tH=NaN,tv=NaN,tS=NaN,tU=NaN,tF=NaN,tV=0;for(tM=0,tV=2;tM<t$;tM++,tV+=6)tb=tC[tV],tG=tC[tV+1],tX=tC[tV+2],tz=tC[tV+3],tv=2*(ti=.1875*(tA-2*tb+tX))+(tB=.09375*(3*(tb-tX)-tA+(tm=tC[tV+4]))),tS=2*(tP=.1875*(tq-2*tG+tz))+(tH=.09375*(3*(tG-tz)-tq+(th=tC[tV+5]))),tU=.75*(tb-tA)+ti+.16666667*tB,tF=.75*(tG-tq)+tP+.16666667*tH,tJ+=Math.sqrt(tU*tU+tF*tF),tU+=tv,tF+=tS,tv+=tB,tS+=tH,tJ+=Math.sqrt(tU*tU+tF*tF),tU+=tv,tF+=tS,tJ+=Math.sqrt(tU*tU+tF*tF),tU+=tv+tB,tF+=tS+tH,tJ+=Math.sqrt(tU*tU+tF*tF),t_[tM]=tJ,tA=tm,tq=th;if(ts&&(tI*=tJ),ta)for(tM=0;tM<tT;tM++)tO[tM]*=tJ;var tc=this._segments,tf=0,te=0;for(te=tj=tx=tM=0;tM<tT;tM++,tx+=3)if((tZ=tI+=tp=tO[tM])<0)this.addBeforePosition(tZ,tC,0,tN,tx);else if(tJ<tZ)this.addAfterPosition(tZ-tJ,tC,tE-4,tN,tx);else{for(;;tj++)if(!((tt=t_[tj])<tZ)){0==tj?tZ/=tt:tZ=(tZ-(tl=t_[tj-1]))/(tt-tl);break}if(tj!=td){var tk=6*(td=tj);for(tA=tC[tk],tq=tC[tk+1],tb=tC[tk+2],tG=tC[tk+3],tX=tC[tk+4],tz=tC[tk+5],tv=2*(ti=.03*(tA-2*tb+tX))+(tB=.006*(3*(tb-tX)-tA+(tm=tC[tk+6]))),tS=2*(tP=.03*(tq-2*tG+tz))+(tH=.006*(3*(tG-tz)-tq+(th=tC[tk+7]))),tU=.3*(tb-tA)+ti+.16666667*tB,tF=.3*(tG-tq)+tP+.16666667*tH,tf=Math.sqrt(tU*tU+tF*tF),tc[0]=tf,tk=1;tk<8;tk++)tU+=tv,tF+=tS,tv+=tB,tS+=tH,tf+=Math.sqrt(tU*tU+tF*tF),tc[tk]=tf;tU+=tv,tF+=tS,tf+=Math.sqrt(tU*tU+tF*tF),tc[8]=tf,tU+=tv+tB,tF+=tS+tH,tf+=Math.sqrt(tU*tU+tF*tF),tc[9]=tf,te=0}for(tZ*=tf;;te++)if(!((tt=tc[te])<tZ)){0==te?tZ/=tt:tZ=te+(tZ-(tl=tc[te-1]))/(tt-tl);break}this.addCurvePosition(.1*tZ,tA,tq,tb,tG,tX,tz,tm,th,tN,tx,tr||0<tM&&0==tp)}return tN},tD.addBeforePosition=function(tD,tY,tg,tT,tr){var ts=tY[tg],ta=tY[tg+1],tW=tY[tg+2]-ts,tM=tY[tg+3]-ta,tE=Math.atan2(tM,tW);tT[tr]=ts+tD*Math.cos(tE),tT[tr+1]=ta+tD*Math.sin(tE),tT[tr+2]=tE},tD.addAfterPosition=function(tD,tY,tg,tT,tr){var ts=tY[tg+2],ta=tY[tg+3],tW=ts-tY[tg],tM=ta-tY[tg+1],tE=Math.atan2(tM,tW);tT[tr]=ts+tD*Math.cos(tE),tT[tr+1]=ta+tD*Math.sin(tE),tT[tr+2]=tE},tD.addCurvePosition=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI,tO){0==tD&&(tD=1e-4);var tC=tD*tD,tN=tC*tD,t$=1-tD,td=t$*t$,tJ=td*t$,tx=t$*tD,tj=3*tx,tZ=t$*tj,tp=tj*tD,tl=tY*tJ+tT*tZ+ts*tp+tW*tN,tt=tg*tJ+tr*tZ+ta*tp+tM*tN;tE[tI]=tl,tE[tI+1]=tt,tE[tI+2]=tO?Math.atan2(tt-(tg*td+tr*tx*2+ta*tC),tl-(tY*td+tT*tx*2+ts*tC)):0},ti.NONE=-1,ti.BEFORE=-2,ti.AFTER=-3,tg(ti,["_tempMt",function(){return this._tempMt=new tPD}]),ti}(),teD=function(){function tD(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return tT(tD,"laya.ani.bone.PathConstraintData"),tD}(),tkD=function(){function tD(){this.name=null,this.slotArr=[]}return tT(tD,"laya.ani.bone.SkinData"),tD}(),twD=function(){function tD(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}tT(tD,"laya.ani.bone.SkinSlotDisplayData");var tY=tD.prototype;return tY.createTexture=function(tD){return this.texture||(this.texture=new tBD(tD.bitmap,this.uvs),tD.bitmap.alphaTexture&&(this.texture.alphaTexture=new tBD(tD.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=tD.height,this.texture.height=tD.width,this.texture.offsetX=-tD.offsetX,this.texture.offsetY=-tD.offsetY,this.texture.sourceWidth=tD.sourceHeight,this.texture.sourceHeight=tD.sourceWidth):(this.texture.width=tD.width,this.texture.height=tD.height,this.texture.offsetX=-tD.offsetX,this.texture.offsetY=-tD.offsetY,this.texture.sourceWidth=tD.sourceWidth,this.texture.sourceHeight=tD.sourceHeight),tJ.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},tY.destory=function(){this.texture&&this.texture.destroy()},tD}(),tKD=function(){function tD(){this.name=null,this.displayArr=[]}return tT(tD,"laya.ani.bone.SlotData"),tD.prototype.getDisplayByName=function(tD){for(var tY=0,tg=this.displayArr.length;tY<tg;tY++)if(this.displayArr[tY].attachmentName==tD)return tY;return-1},tD}(),tt=function(){function tD(tD,tY){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=td(2,0),this._data=tD,null==this._bones&&(this._bones=[]),this.target=tY[tD.targetIndex];var tg,tT=0;for(tT=0,tg=tD.boneIndexs.length;tT<tg;tT++)this._bones.push(tY[tD.boneIndexs[tT]]);this.rotateMix=tD.rotateMix,this.translateMix=tD.translateMix,this.scaleMix=tD.scaleMix,this.shearMix=tD.shearMix}return tT(tD,"laya.ani.bone.TfConstraint"),tD.prototype.apply=function(){for(var tD,tY=this.target.resultMatrix.a,tg=this.target.resultMatrix.b,tT=this.target.resultMatrix.c,tr=this.target.resultMatrix.d,ts=0,ta=this._bones.length;ts<ta;ts++){if(tD=this._bones[ts],0<this.rotateMix){var tW=tD.resultMatrix.a,tM=tD.resultMatrix.b,tE=tD.resultMatrix.c,tI=tD.resultMatrix.d,tO=Math.atan2(tT,tY)-Math.atan2(tE,tW)+this._data.offsetRotation*Math.PI/180;tO>Math.PI?tO-=2*Math.PI:tO<-Math.PI&&(tO+=2*Math.PI),tO*=this.rotateMix;var tC=Math.cos(tO),tN=Math.sin(tO);tD.resultMatrix.a=tC*tW-tN*tE,tD.resultMatrix.b=tC*tM-tN*tI,tD.resultMatrix.c=tN*tW+tC*tE,tD.resultMatrix.d=tN*tM+tC*tI}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),tD.resultMatrix.tx+=(this._temp[0]-tD.resultMatrix.tx)*this.translateMix,tD.resultMatrix.ty+=(this._temp[1]-tD.resultMatrix.ty)*this.translateMix,tD.updateChild()),0<this.scaleMix){var t$=Math.sqrt(tD.resultMatrix.a*tD.resultMatrix.a+tD.resultMatrix.c*tD.resultMatrix.c),td=Math.sqrt(tY*tY+tT*tT),tJ=1e-5<t$?(t$+(td-t$+this._data.offsetScaleX)*this.scaleMix)/t$:0;tD.resultMatrix.a*=tJ,tD.resultMatrix.c*=tJ,t$=Math.sqrt(tD.resultMatrix.b*tD.resultMatrix.b+tD.resultMatrix.d*tD.resultMatrix.d),td=Math.sqrt(tg*tg+tr*tr),tJ=1e-5<t$?(t$+(td-t$+this._data.offsetScaleY)*this.scaleMix)/t$:0,tD.resultMatrix.b*=tJ,tD.resultMatrix.d*=tJ}if(0<this.shearMix){tM=tD.resultMatrix.b,tI=tD.resultMatrix.d;var tx=Math.atan2(tI,tM);(tO=Math.atan2(tr,tg)-Math.atan2(tT,tY)-(tx-Math.atan2(tD.resultMatrix.c,tD.resultMatrix.a)))>Math.PI?tO-=2*Math.PI:tO<-Math.PI&&(tO+=2*Math.PI),tO=tx+(tO+this._data.offsetShearY*Math.PI/180)*this.shearMix,tJ=Math.sqrt(tM*tM+tI*tI),tD.resultMatrix.b=Math.cos(tO)*tJ,tD.resultMatrix.d=Math.sin(tO)*tJ}}},tD}(),toD=function(){function tD(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return tT(tD,"laya.ani.bone.TfConstraintData"),tD}(),tRD=function(){function tD(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}tT(tD,"laya.ani.bone.Transform");var tY=tD.prototype;return tY.initData=function(tD){null!=tD.x&&(this.x=tD.x),null!=tD.y&&(this.y=tD.y),null!=tD.skX&&(this.skX=tD.skX),null!=tD.skY&&(this.skY=tD.skY),null!=tD.scX&&(this.scX=tD.scX),null!=tD.scY&&(this.scY=tD.scY)},tY.getMatrix=function(){var tD;return(tD=this.mMatrix?this.mMatrix:this.mMatrix=new tPD).identity(),tD.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(tD,this.skewX*Math.PI/180,this.skewY*Math.PI/180),tD.rotate(this.skX*Math.PI/180),tD.translate(this.x,this.y),tD},tY.skew=function(tD,tY,tg){var tT=Math.sin(tg),tr=Math.cos(tg),ts=Math.sin(tY),ta=Math.cos(tY);return tD.setTo(tD.a*ta-tD.b*tT,tD.a*ts+tD.b*tr,tD.c*ta-tD.d*tT,tD.c*ts+tD.d*tr,tD.tx*ta-tD.ty*tT,tD.tx*ts+tD.ty*tr),tD},tD}(),t_=function(){function tD(){}return tT(tD,"laya.ani.bone.UVTools"),tD.getRelativeUV=function(tD,tY,tg){var tT=tD[0],tr=tD[2]-tD[0],ts=tD[1],ta=tD[5]-tD[1];tg||(tg=[]),tg.length=tY.length;var tW,tM=0;tW=tg.length;var tE=1/tr,tI=1/ta;for(tM=0;tM<tW;tM+=2)tg[tM]=(tY[tM]-tT)*tE,tg[tM+1]=(tY[tM+1]-ts)*tI;return tg},tD.getAbsoluteUV=function(tD,tY,tg){if(0==tD[0]&&0==tD[1]&&1==tD[4]&&1==tD[5])return tg?(tx.copyArray(tg,tY),tg):tY;var tT=tD[0],tr=tD[2]-tD[0],ts=tD[1],ta=tD[5]-tD[1];tg||(tg=[]),tg.length=tY.length;var tW,tM=0;for(tW=tg.length,tM=0;tM<tW;tM+=2)tg[tM]=tY[tM]*tr+tT,tg[tM+1]=tY[tM+1]*ta+ts;return tg},tD}(),ti=function(){function tD(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return tT(tD,"laya.ani.KeyFramesContent"),tD}(),tA=function(){function tI(){}return tT(tI,"laya.ani.math.BezierLerp"),tI.getBezierRate=function(tD,tY,tg,tT,tr){var ts=tI._getBezierParamKey(tY,tg,tT,tr),ta=100*ts+tD;if(tI._bezierResultCache[ta])return tI._bezierResultCache[ta];var tW,tM=tI._getBezierPoints(tY,tg,tT,tr,ts),tE=0;for(tW=tM.length,tE=0;tE<tW;tE+=2)if(tD<=tM[tE])return tI._bezierResultCache[ta]=tM[tE+1],tM[tE+1];return tI._bezierResultCache[ta]=1},tI._getBezierParamKey=function(tD,tY,tg,tT){return 100*(100*(100*(100*tD+tY)+tg)+tT)},tI._getBezierPoints=function(tD,tY,tg,tT,tr){return tI._bezierPointsCache[tr]?tI._bezierPointsCache[tr]:(ts=[0,0,tD,tY,tg,tT,1,1],ta=(new tW).getBezierPoints(ts,100,3),tI._bezierPointsCache[tr]=ta);var ts,ta},tI._bezierResultCache={},tI._bezierPointsCache={},tI}(),tq=function(tD){function tY(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,tY.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}tT(tY,"laya.ani.AnimationPlayer",tr);var tg=tY.prototype;return thD.imps(tg,{"laya.resource.IDestroy":!0}),tg._onTempletLoadedComputeFullKeyframeIndices=function(tD,tY,tg){this._templet===tg&&this._cachePlayRate===tD&&this._cacheFrameRate===tY&&this._computeFullKeyframeIndices()},tg._computeFullKeyframeIndices=function(){for(var tD=this._fullFrames=[],tY=this._templet,tg=this._cacheFrameRateInterval*this._cachePlayRate,tT=0,tr=tY.getAnimationCount();tT<tr;tT++){for(var ts=[],ta=0,tW=tY.getAnimation(tT).nodes.length;ta<tW;ta++){for(var tM=tY.getAnimation(tT).nodes[ta],tE=Math.floor(tM.playTime/tg+.01),tI=new Uint16Array(tE+1),tO=-1,tC=0,tN=tM.keyFrame.length;tC<tN;tC++){var t$=tM.keyFrame[tC],td=t$.startTime,tJ=td+t$.duration+tg;do{for(var tx=Math.floor(td/tg+.5),tj=tO+1;tj<tx;tj++)tI[tj]=tC;tI[tO=tx]=tC,td+=tg}while(td<=tJ)}ts.push(tI)}tD.push(ts)}},tg._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},tg._calculatePlayDuration=function(){if(0!==this.state){var tD=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=tD),this._playEnd>tD&&(this._playEnd=tD),this._playDuration=this._playEnd-this._playStart}},tg._setPlayParams=function(tD,tY){this._currentTime=tD,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/tY+.01),0),this._currentFrameTime=this._currentKeyframeIndex*tY},tg._setPlayParamsWhenStop=function(tD,tY){this._currentTime=tD,this._currentKeyframeIndex=Math.max(Math.floor(tD/tY+.01),0),this._currentFrameTime=this._currentKeyframeIndex*tY,this._currentAnimationClipIndex=-1},tg._update=function(tD){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var tY=this._cacheFrameRateInterval*this._cachePlayRate,tg=0;this._startUpdateLoopCount!==t$.loopCount&&(tg=tD*this.playbackRate,this._elapsedPlaybackTime+=tg);var tT=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=tT)return this._setPlayParamsWhenStop(tT,tY),void this.event("stopped");if(tg+=this._currentTime,0<tT)if(tT<=tg)do{if(tg-=tT,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(tT,tY),this._stopWhenCircleFinish=!1,void this.event("stopped");tg<tT&&(this._setPlayParams(tg,tY),this.event("complete"))}while(tT<=tg);else this._setPlayParams(tg,tY);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(tT,tY),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},tg._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},tg.play=function(tD,tY,tg,tT,tr){if(void 0===tD&&(tD=0),void 0===tY&&(tY=1),void 0===tg&&(tg=2147483647),void 0===tT&&(tT=0),void 0===tr&&(tr=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(tg<0||tT<0||tr<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==tr&&tr<tT)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=tY,this._overallDuration=tg,this._playStart=tT,this._playEnd=tr,this._paused=!1,this._currentAnimationClipIndex=tD,this._currentKeyframeIndex=0,this._startUpdateLoopCount=t$.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},tg.playByFrame=function(tD,tY,tg,tT,tr,ts){void 0===tD&&(tD=0),void 0===tY&&(tY=1),void 0===tg&&(tg=2147483647),void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ts&&(ts=30);var ta=1e3/ts;this.play(tD,tY,tg,tT*ta,tr*ta)},tg.stop=function(tD){void 0===tD&&(tD=!0),tD?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},ts(0,tg,"playEnd",function(){return this._playEnd}),ts(0,tg,"templet",function(){return this._templet},function(tD){0===!this.state&&this.stop(!0),this._templet!==tD&&((this._templet=tD).loaded?this._computeFullKeyframeIndices():tD.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),ts(0,tg,"playStart",function(){return this._playStart}),ts(0,tg,"playDuration",function(){return this._playDuration}),ts(0,tg,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),ts(0,tg,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),ts(0,tg,"overallDuration",function(){return this._overallDuration}),ts(0,tg,"currentFrameTime",function(){return this._currentFrameTime}),ts(0,tg,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),ts(0,tg,"currentPlayTime",function(){return this._currentTime+this._playStart}),ts(0,tg,"cachePlayRate",function(){return this._cachePlayRate},function(tD){this._cachePlayRate!==tD&&(this._cachePlayRate=tD,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[tD,this._cacheFrameRate])))}),ts(0,tg,"cacheFrameRate",function(){return this._cacheFrameRate},function(tD){this._cacheFrameRate!==tD&&(this._cacheFrameRate=tD,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,tD])))}),ts(0,tg,"currentTime",null,function(tD){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(tD<this._playStart||tD>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=t$.loopCount;var tY=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=tD,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/tY),0),this._currentFrameTime=this._currentKeyframeIndex*tY}}),ts(0,tg,"paused",function(){return this._paused},function(tD){(this._paused=tD)&&this.event("paused")}),ts(0,tg,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),ts(0,tg,"destroyed",function(){return this._destroyed}),tY}(),tP=function(tD){function tY(){tY.__super.call(this),tJ.isConchNode&&(this.drawSkin=function(tD){tD.transform||(tD.transform=tPD.EMPTY),this._addCmd([tD]),this.setSkinMesh&&this.setSkinMesh(tD._ps,tD.mVBData,tD.mEleNum,0,tD.mTexture,tD.transform)})}return tT(tY,"laya.ani.GraphicsAni",ta),tY.prototype.drawSkin=function(tD){var tY=[tD];this._saveToCmd(tJ._context._drawSkin,tY)},tY.create=function(){return tY._caches.pop()||new tY},tY.recycle=function(tD){tD.clear(),tY._caches.push(tD)},tY._caches=[],tY}(),tB=function(tD){function tj(){this._aniMap={},this.unfixedLastAniIndex=-1,tj.__super.call(this),this._anis=new Array}tT(tj,"laya.ani.AnimationTemplet",tI);var tY=tj.prototype;return tY.parse=function(tD){var tY=new tiD(tD);this._aniVersion=tY.readUTFString(),tZ.parse(this,tY)},tY._calculateKeyFrame=function(tD,tY,tg){var tT=tD.keyFrame;tT[tY]=tT[0];for(var tr=0;tr<tY;tr++){var ts=tT[tr];ts.nextData=0===ts.duration?ts.data:tT[tr+1].data}tT.length--},tY.onAsynLoaded=function(tD,tY,tg){var tT=new tiD(tY);switch(this._aniVersion=tT.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":tp.parse(this,tT);break;default:tZ.parse(this,tT)}this._endLoaded()},tY.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},tY.getAnimationCount=function(){return this._anis.length},tY.getAnimation=function(tD){return this._anis[tD]},tY.getAniDuration=function(tD){return this._anis[tD].playTime},tY.getNodes=function(tD){return this._anis[tD].nodes},tY.getNodeIndexWithName=function(tD,tY){return this._anis[tD].bone3DMap[tY]},tY.getNodeCount=function(tD){return this._anis[tD].nodes.length},tY.getTotalkeyframesLength=function(tD){return this._anis[tD].totalKeyframeDatasLength},tY.getPublicExtData=function(){return this._publicExtData},tY.getAnimationDataWithCache=function(tD,tY,tg,tT){var tr=tY[tg];if(tr){var ts=tr[tD];return ts?ts[tT]:null}return null},tY.setAnimationDataWithCache=function(tD,tY,tg,tT,tr){var ts=tY[tg]||(tY[tg]={});(ts[tD]||(ts[tD]=[]))[tT]=tr},tY.getOriginalData=function(tD,tY,tg,tT,tr){for(var ts=this._anis[tD].nodes,ta=0,tW=0,tM=ts.length,tE=0;tW<tM;tW++){var tI,tO=ts[tW];tI=tO.keyFrame[tg[tW][tT]],tO.dataOffset=tE;var tC=tr-tI.startTime,tN=tO.lerpType;if(tN)switch(tN){case 0:case 1:for(ta=0;ta<tO.keyframeWidth;)ta+=tO.interpolationMethod[ta](tO,ta,tY,tE+ta,tI.data,tC,null,tI.duration,tI.nextData);break;case 2:var t$=tI.interpolationData,td=t$.length,tJ=0;for(ta=0;ta<td;){var tx=t$[ta];switch(tx){case 6:case 7:ta+=tj.interpolation[tx](tO,tJ,tY,tE+tJ,tI.data,tC,null,tI.duration,tI.nextData,t$,ta+1);break;default:ta+=tj.interpolation[tx](tO,tJ,tY,tE+tJ,tI.data,tC,null,tI.duration,tI.nextData)}tJ++}}else for(ta=0;ta<tO.keyframeWidth;)ta+=tO.interpolationMethod[ta](tO,ta,tY,tE+ta,tI.data,tC,null,tI.duration,tI.nextData);tE+=tO.keyframeWidth}},tY.getNodesCurrentFrameIndex=function(tD,tY){var tg=this._anis[tD].nodes;tD!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(tg.length),this.unfixedCurrentTimes=new Float32Array(tg.length),this.unfixedLastAniIndex=tD);for(var tT=0,tr=tg.length;tT<tr;tT++){var ts=tg[tT];for(tY<this.unfixedCurrentTimes[tT]&&(this.unfixedCurrentFrameIndexes[tT]=0),this.unfixedCurrentTimes[tT]=tY;this.unfixedCurrentFrameIndexes[tT]<ts.keyFrame.length&&!(ts.keyFrame[this.unfixedCurrentFrameIndexes[tT]].startTime>this.unfixedCurrentTimes[tT]);)this.unfixedCurrentFrameIndexes[tT]++;this.unfixedCurrentFrameIndexes[tT]--}return this.unfixedCurrentFrameIndexes},tY.getOriginalDataUnfixedRate=function(tD,tY,tg){var tT=this._anis[tD].nodes;tD!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(tT.length),this.unfixedCurrentTimes=new Float32Array(tT.length),this.unfixedKeyframes=td(tT.length),this.unfixedLastAniIndex=tD);for(var tr=0,ts=0,ta=tT.length,tW=0;ts<ta;ts++){var tM=tT[ts];for(tg<this.unfixedCurrentTimes[ts]&&(this.unfixedCurrentFrameIndexes[ts]=0),this.unfixedCurrentTimes[ts]=tg;this.unfixedCurrentFrameIndexes[ts]<tM.keyFrame.length&&!(tM.keyFrame[this.unfixedCurrentFrameIndexes[ts]].startTime>this.unfixedCurrentTimes[ts]);)this.unfixedKeyframes[ts]=tM.keyFrame[this.unfixedCurrentFrameIndexes[ts]],this.unfixedCurrentFrameIndexes[ts]++;var tE=this.unfixedKeyframes[ts];tM.dataOffset=tW;var tI=tg-tE.startTime;if(tM.lerpType)switch(tM.lerpType){case 0:case 1:for(tr=0;tr<tM.keyframeWidth;)tr+=tM.interpolationMethod[tr](tM,tr,tY,tW+tr,tE.data,tI,null,tE.duration,tE.nextData);break;case 2:var tO=tE.interpolationData,tC=tO.length,tN=0;for(tr=0;tr<tC;){var t$=tO[tr];switch(t$){case 6:case 7:tr+=tj.interpolation[t$](tM,tN,tY,tW+tN,tE.data,tI,null,tE.duration,tE.nextData,tO,tr+1);break;default:tr+=tj.interpolation[t$](tM,tN,tY,tW+tN,tE.data,tI,null,tE.duration,tE.nextData)}tN++}}else for(tr=0;tr<tM.keyframeWidth;)tr+=tM.interpolationMethod[tr](tM,tr,tY,tW+tr,tE.data,tI,null,tE.duration,tE.nextData);tW+=tM.keyframeWidth}},tj._LinearInterpolation_0=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){var tI=0===tW?0:ts/tW;return tg[tT]=(1-tI)*tr[tY]+tI*tM[tY],1},tj._QuaternionInterpolation_1=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){var tI=0===tW?0:ts/tW;return tC.slerpQuaternionArray(tr,tY,tM,tY,tI,tg,tT),4},tj._AngleInterpolation_2=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){return 0},tj._RadiansInterpolation_3=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){return 0},tj._Matrix4x4Interpolation_4=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){for(var tI=0;tI<16;tI++,tY++)tg[tT+tI]=tr[tY]+ts*ta[tY];return 16},tj._NoInterpolation_5=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){return tg[tT]=tr[tY],1},tj._BezierInterpolation_6=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI){return void 0===tI&&(tI=0),tg[tT]=tr[tY]+(tM[tY]-tr[tY])*tA.getBezierRate(ts/tW,tE[tI],tE[tI+1],tE[tI+2],tE[tI+3]),5},tj._BezierInterpolation_7=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE,tI){return void 0===tI&&(tI=0),tg[tT]=tE[tI+4]+tE[tI+5]*tA.getBezierRate((.001*ts+tE[tI+6])/tE[tI+7],tE[tI],tE[tI+1],tE[tI+2],tE[tI+3]),9},tj.load=function(tD){return thD.loader.create(tD,null,null,tj)},tj.interpolation=[tj._LinearInterpolation_0,tj._QuaternionInterpolation_1,tj._AngleInterpolation_2,tj._RadiansInterpolation_3,tj._Matrix4x4Interpolation_4,tj._NoInterpolation_5,tj._BezierInterpolation_6,tj._BezierInterpolation_7],tj}(),tb=function(tY){function tg(tD,tY){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,tg.__super.call(this),void 0===tY&&(tY=0),tD&&this.init(tD,tY)}tT(tg,"laya.ani.bone.Skeleton",tY);var tD=tg.prototype;return tD.init=function(tD,tY){void 0===tY&&(tY=0);var tg,tT,tr,ts=0,ta=0;if(1==tY)for(this._graphicsCache=[],ts=0,ta=tD.getAnimationCount();ts<ta;ts++)this._graphicsCache.push([]);if(this._yReverseMatrix=tD.yReverseMatrix,this._aniMode=tY,this._templet=tD,this._player=new tq,this._player.cacheFrameRate=tD.rate,this._player.templet=tD,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=tD.mBoneArr,this._rootBone=tD.mRootBone,this._aniSectionDic=tD.aniSectionDic,0<tD.ikArr.length)for(this._ikArr=[],ts=0,ta=tD.ikArr.length;ts<ta;ts++)this._ikArr.push(new tj(tD.ikArr[ts],this._boneList));if(0<tD.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),ts=0,ta=tD.pathArr.length;ts<ta;ts++)tg=tD.pathArr[ts],tT=new tl(tg,this._boneList),(tr=this._boneSlotDic[tg.name])&&((tT=new tl(tg,this._boneList)).target=tr),this._pathDic[tg.name]=tT;if(0<tD.tfArr.length)for(this._tfArr=[],ts=0,ta=tD.tfArr.length;ts<ta;ts++)this._tfArr.push(new tt(tD.tfArr[ts],this._boneList));if(0<tD.skinDataArray.length){var tW=this._templet.skinDataArray[this._skinIndex];this._skinName=tW.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},tD.load=function(tD,tY,tg){},tD._onLoaded=function(){},tD._parseComplete=function(){var tD=tG.TEMPLET_DICTIONARY[this._aniPath];tD&&(this.init(tD,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},tD._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},tD._onPlay=function(){this.event("played")},tD._onStop=function(){var tD,tY=this._templet.eventAniArr[this._aniClipIndex];if(tY&&this._eventIndex<tY.length)for(;this._eventIndex<tY.length;this._eventIndex++)(tD=tY[this._eventIndex]).time>=this._player.playStart&&tD.time<=this._player.playEnd&&this.event("label",tD);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},tD._onPause=function(){this.event("paused")},tD._parseSrcBoneMatrix=function(){var tD=0,tY=0;for(tY=this._templet.srcBoneMatrixArr.length,tD=0;tD<tY;tD++)this._boneMatrixArray.push(new tPD);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var tg,tT,tr=this._templet.boneSlotArray;for(tD=0,tY=tr.length;tD<tY;tD++)tg=tr[tD],null==(tT=this._bindBoneBoneSlotDic[tg.parent])&&(this._bindBoneBoneSlotDic[tg.parent]=tT=[]),this._boneSlotDic[tg.name]=tg=tg.copy(),tT.push(tg),this._boneSlotArray.push(tg)}},tD._emitMissedEvents=function(tD,tY,tg){void 0===tg&&(tg=0);var tT=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(tT){var tr,ts,ta=0;for(tr=tT.length,ta=tg;ta<tr;ta++)(ts=tT[ta]).time>=this._player.playStart&&ts.time<=this._player.playEnd&&this.event("label",ts)}},tD._update=function(tD){if(void 0===tD&&(tD=!0),!(this._pause||tD&&this._indexControl)){var tY=this.timer.currTimer,tg=this._player.currentKeyframeIndex,tT=tY-this._lastTime;if(tD?this._player._update(tT):tg=-1,this._lastTime=tY,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<tT&&this._clipIndex==tg&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var tr;this._lastUpdateAniClipIndex=this._aniClipIndex,tg>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var ts,ta=this._templet.eventAniArr[this._aniClipIndex];if(ta&&this._eventIndex<ta.length&&((tr=ta[this._eventIndex]).time>=this._player.playStart&&tr.time<=this._player.playEnd?this._player.currentPlayTime>=tr.time&&(this.event("label",tr),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(ts=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=ts&&(this.graphics=ts));var tW=0,tM=0;for(tM=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,tM-1)&&0<tM;)tM--;if(tM<this._clipIndex)for(tW=tM;tW<this._clipIndex;tW++)this._createGraphics(tW)}else if(1==this._aniMode){if(ts=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=ts&&(this.graphics=ts));for(tM=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,tM-1)&&0<tM;)tM--;if(tM<this._clipIndex)for(tW=tM;tW<this._clipIndex;tW++)this._createGraphics(tW)}this._createGraphics()}}},tD._createGraphics=function(tD){void 0===tD&&(tD=-1),-1==tD&&(tD=this._clipIndex);var tY,tg,tT=tD*this._player.cacheFrameRateInterval,tr=this._templet.drawOrderAniArr[this._aniClipIndex];if(tr&&0<tr.length)for(this._drawOrderIndex=0,tY=tr[this._drawOrderIndex];tT>=tY.time&&(this._drawOrder=tY.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=tr.length));)tY=tr[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=tP.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=tP.create(),tg=this.graphics;var ts=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],tD,tT);var ta,tW,tM,tE,tI=this._aniSectionDic[this._aniClipIndex],tO=0,tC=0,tN=0,t$=0,td=0,tJ=this._templet.srcBoneMatrixArr.length;for(td=tI[tC=0];tC<tJ;tC++)tE=this._boneList[tC],tM=this._templet.srcBoneMatrixArr[tC],tE.resultTransform.scX=tM.scX*this._curOriginalData[tO++],tE.resultTransform.skX=tM.skX+this._curOriginalData[tO++],tE.resultTransform.skY=tM.skY+this._curOriginalData[tO++],tE.resultTransform.scY=tM.scY*this._curOriginalData[tO++],tE.resultTransform.x=tM.x+this._curOriginalData[tO++],tE.resultTransform.y=tM.y+this._curOriginalData[tO++],8===this._templet.tMatrixDataLen&&(tE.resultTransform.skewX=tM.skewX+this._curOriginalData[tO++],tE.resultTransform.skewY=tM.skewY+this._curOriginalData[tO++]);var tx,tj={},tZ={};for(td+=tI[1];tC<td;tC++)tj[(tx=ts[tC]).name]=this._curOriginalData[tO++],tZ[tx.name]=this._curOriginalData[tO++],this._curOriginalData[tO++],this._curOriginalData[tO++],this._curOriginalData[tO++],this._curOriginalData[tO++];var tp,tl,tt={},t_={};for(td+=tI[2];tC<td;tC++)tt[(tx=ts[tC]).name]=this._curOriginalData[tO++],t_[tx.name]=this._curOriginalData[tO++],this._curOriginalData[tO++],this._curOriginalData[tO++],this._curOriginalData[tO++],this._curOriginalData[tO++];if(this._pathDic)for(td+=tI[3];tC<td;tC++){if(tx=ts[tC],tp=this._pathDic[tx.name])switch(new tiD(tx.extenData).getByte()){case 1:tp.position=this._curOriginalData[tO++];break;case 2:tp.spacing=this._curOriginalData[tO++];break;case 3:tp.rotateMix=this._curOriginalData[tO++],tp.translateMix=this._curOriginalData[tO++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(tPD.TEMP.identity()),this._ikArr)for(tC=0,td=this._ikArr.length;tC<td;tC++)tl=this._ikArr[tC],tt.hasOwnProperty(tl.name)&&(tl.bendDirection=tt[tl.name]),t_.hasOwnProperty(tl.name)&&(tl.mix=t_[tl.name]),tl.apply();if(this._pathDic)for(var tA in this._pathDic)(tp=this._pathDic[tA]).apply(this._boneList,tg);if(this._tfArr)for(tC=0,t$=this._tfArr.length;tC<t$;tC++)this._tfArr[tC].apply();for(tC=0,t$=this._boneList.length;tC<t$;tC++)if(tE=this._boneList[tC],tW=this._bindBoneBoneSlotDic[tE.name],tE.resultMatrix.copyTo(this._boneMatrixArray[tC]),tW)for(tN=0,td=tW.length;tN<td;tN++)(ta=tW[tN])&&ta.setParentMatrix(tE.resultMatrix);var tq,tb,tG,tX,tz={},tm=this._templet.deformAniArr;if(tm&&0<tm.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,tC=0,td=this._boneSlotArray.length;tC<td;tC++)(ta=this._boneSlotArray[tC]).deformData=null;var th,ti=tm[this._aniClipIndex];for(th in tq=ti.default,this._setDeform(tq,tz,this._boneSlotArray,tT),ti)"default"!=th&&th!=this._skinName&&(tq=ti[th],this._setDeform(tq,tz,this._boneSlotArray,tT));tq=ti[this._skinName],this._setDeform(tq,tz,this._boneSlotArray,tT)}if(this._drawOrder)for(tC=0,td=this._drawOrder.length;tC<td;tC++)tb=tj[(ta=this._boneSlotArray[this._drawOrder[tC]]).name],tG=tZ[ta.name],isNaN(tG)||(tg.save(),tg.alpha(tG)),isNaN(tb)||-2==tb||(this._templet.attachmentNames?ta.showDisplayByName(this._templet.attachmentNames[tb]):ta.showDisplayByIndex(tb)),tz[this._drawOrder[tC]]?(tX=tz[this._drawOrder[tC]],ta.currDisplayData&&tX[ta.currDisplayData.attachmentName]?ta.deformData=tX[ta.currDisplayData.attachmentName]:ta.deformData=null):ta.deformData=null,isNaN(tG)?ta.draw(tg,this._boneMatrixArray,2==this._aniMode):ta.draw(tg,this._boneMatrixArray,2==this._aniMode,tG),isNaN(tG)||tg.restore();else for(tC=0,td=this._boneSlotArray.length;tC<td;tC++)tb=tj[(ta=this._boneSlotArray[tC]).name],tG=tZ[ta.name],isNaN(tG)||(tg.save(),tg.alpha(tG)),isNaN(tb)||-2==tb||(this._templet.attachmentNames?ta.showDisplayByName(this._templet.attachmentNames[tb]):ta.showDisplayByIndex(tb)),tz[tC]?(tX=tz[tC],ta.currDisplayData&&tX[ta.currDisplayData.attachmentName]?ta.deformData=tX[ta.currDisplayData.attachmentName]:ta.deformData=null):ta.deformData=null,isNaN(tG)?ta.draw(tg,this._boneMatrixArray,2==this._aniMode):ta.draw(tg,this._boneMatrixArray,2==this._aniMode,tG),isNaN(tG)||tg.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,tD,tg):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,tD,tg)},tD._setDeform=function(tD,tY,tg,tT){if(tD){var tr,ts,ta,tW=0,tM=0,tE=0;if(tD)for(tW=0,tM=tD.deformSlotDataList.length;tW<tM;tW++)for(tr=tD.deformSlotDataList[tW],tE=0;tE<tr.deformSlotDisplayList.length;tE++)ta=tg[(ts=tr.deformSlotDisplayList[tE]).slotIndex],ts.apply(tT,ta),tY[ts.slotIndex]||(tY[ts.slotIndex]={}),tY[ts.slotIndex][ts.attachment]=ts.deformData}},tD.getAnimNum=function(){return this._templet.getAnimationCount()},tD.getAniNameByIndex=function(tD){return this._templet.getAniNameByIndex(tD)},tD.getSlotByName=function(tD){return this._boneSlotDic[tD]},tD.showSkinByName=function(tD,tY){void 0===tY&&(tY=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(tD),tY)},tD.showSkinByIndex=function(tD,tY){void 0===tY&&(tY=!0);for(var tg=0;tg<this._boneSlotArray.length;tg++)this._boneSlotArray[tg].showSlotData(null,tY);if(this._templet.showSkinByIndex(this._boneSlotDic,tD,tY)){var tT=this._templet.skinDataArray[tD];this._skinIndex=tD,this._skinName=tT.name}this._clearCache()},tD.showSlotSkinByIndex=function(tD,tY){if(0!=this._aniMode){var tg=this.getSlotByName(tD);tg&&tg.showDisplayByIndex(tY),this._clearCache()}},tD.showSlotSkinByName=function(tD,tY){if(0!=this._aniMode){var tg=this.getSlotByName(tD);tg&&tg.showDisplayByName(tY),this._clearCache()}},tD.replaceSlotSkinName=function(tD,tY,tg){if(0!=this._aniMode){var tT=this.getSlotByName(tD);tT&&tT.replaceDisplayByName(tY,tg),this._clearCache()}},tD.replaceSlotSkinByIndex=function(tD,tY,tg){if(0!=this._aniMode){var tT=this.getSlotByName(tD);tT&&tT.replaceDisplayByIndex(tY,tg),this._clearCache()}},tD.setSlotSkin=function(tD,tY){if(0!=this._aniMode){var tg=this.getSlotByName(tD);tg&&tg.replaceSkin(tY),this._clearCache()}},tD._clearCache=function(){if(1==this._aniMode)for(var tD=0,tY=this._graphicsCache.length;tD<tY;tD++){for(var tg=0,tT=this._graphicsCache[tD].length;tg<tT;tg++){var tr=this._graphicsCache[tD][tg];tr!=this.graphics&&tP.recycle(tr)}this._graphicsCache[tD].length=0}},tD.play=function(tD,tY,tg,tT,tr,ts){void 0===tg&&(tg=!0),void 0===tT&&(tT=0),void 0===tr&&(tr=0),void 0===ts&&(ts=!0),this._indexControl=!1;var ta=-1,tW=NaN;if(tW=tY?2147483647:0,"string"==typeof tD)for(var tM=0,tE=this._templet.getAnimationCount();tM<tE;tM++){var tI=this._templet.getAnimation(tM);if(tI&&tD==tI.name){ta=tM;break}}else ta=tD;-1<ta&&ta<this.getAnimNum()&&(this._aniClipIndex=ta,(tg||this._pause||this._currAniIndex!=ta)&&(this._currAniIndex=ta,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(ta)),this._drawOrder=null,this._eventIndex=0,this._player.play(ta,this._player.playbackRate,tW,tT,tr),ts&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=tO.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},tD.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},tD.playbackRate=function(tD){this._player&&(this._player.playbackRate=tD)},tD.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},tD.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=tO.now(),this.timer.frameLoop(1,this,this._update,null,!0))},tD._getGrahicsDataWithCache=function(tD,tY){return this._graphicsCache[tD][tY]},tD._setGrahicsDataWithCache=function(tD,tY,tg){this._graphicsCache[tD][tY]=tg},tD.destroy=function(tD){void 0===tD&&(tD=!0),tY.prototype.destroy.call(this,tD),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},ts(0,tD,"url",function(){return this._aniPath},function(tD){this.load(tD)}),ts(0,tD,"index",function(){return this._index},function(tD){this.player&&(this._index=tD,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),ts(0,tD,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),ts(0,tD,"templet",function(){return this._templet}),ts(0,tD,"player",function(){return this._player}),tg.useSimpleMeshInCanvas=!1,tg}(trD),tG=function(tY){function tr(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,tr.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}tT(tr,"laya.ani.bone.Templet",tY);var tD=tr.prototype;return tD.getLoadList=function(){return this._loadList},tD.loadAni=function(tD){this._skBufferUrl=tD,thD.loader.load(tD,tM.create(this,this.onComplete),null,"arraybuffer")},tD.onComplete=function(tD){if(this._isDestroyed)this.destroy();else{var tY=tE.getRes(this._skBufferUrl);tY?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,tY)):this.event("error","load failed:"+this._skBufferUrl)}},tD.parseData=function(tD,tY,tg){void 0===tg&&(tg=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=tD,this._mainTexture&&tJ.isWebGL&&tD.bitmap&&(tD.bitmap.enableMerageInAtlas=!1),this._rate=tg,this.parse(tY)},tD.buildArmature=function(tD){return void 0===tD&&(tD=0),new tb(this,tD)},tD.parse=function(tD){tY.prototype.parse.call(this,tD),this._endLoaded(),this._aniVersion!=tr.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+tr.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},tD._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var tD=0;this._loadList=[];var tY,tg=new tiD(this.getPublicExtData()),tT=0,tr=0,ts=0,ta=tg.getInt32(),tW=tg.readUTFString(),tM=tW.split("\n");for(tD=0;tD<ta;tD++)tY=this._path+tM[2*tD],tW=tM[2*tD+1],tg.getFloat32(),tg.getFloat32(),tT=tg.getFloat32(),tr=tg.getFloat32(),ts=tg.getFloat32(),isNaN(ts)?0:ts,ts=tg.getFloat32(),isNaN(ts)?0:ts,ts=tg.getFloat32(),isNaN(ts)?tT:ts,ts=tg.getFloat32(),isNaN(ts)?tr:ts,-1==this._loadList.indexOf(tY)&&this._loadList.push(tY);this.event("inited",this)}},tD._textureComplete=function(){for(var tD,tY,tg=0,tT=this._loadList.length;tg<tT;tg++)tY=this._loadList[tg],tD=this._textureDic[tY]=tE.getRes(tY),tJ.isWebGL&&tD&&tD.bitmap&&(tD.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},tD._parsePublicExtData=function(){var tD=0,tY=0,tg=0,tT=0,tr=0;for(tD=0,tr=this.getAnimationCount();tD<tr;tD++)this._graphicsCache.push([]);var ts;ts="Dragon"!=this._aniClassName;var ta,tW,tM=new tiD(this.getPublicExtData()),tE=0,tI=0,tO=0,tC=0,tN=0,t$=0,td=0,tJ=0,tx=0,tj=tM.getInt32(),tZ=tM.readUTFString(),tp=tZ.split("\n");for(tD=0;tD<tj;tD++){if(ta=this._mainTexture,tW=this._path+tp[2*tD],tZ=tp[2*tD+1],null==this._mainTexture&&(ta=this._textureDic[tW]),!ta)return this.event("error",this),void(this.isParseFail=!0);tE=tM.getFloat32(),tI=tM.getFloat32(),tO=tM.getFloat32(),tC=tM.getFloat32(),tx=tM.getFloat32(),tN=isNaN(tx)?0:tx,tx=tM.getFloat32(),t$=isNaN(tx)?0:tx,tx=tM.getFloat32(),td=isNaN(tx)?tO:tx,tx=tM.getFloat32(),tJ=isNaN(tx)?tC:tx;var tl=tBD.create(ta,tE,tI,tO,tC,-tN,-t$,td,tJ);if(!tl){var tt=tp[2*tD];thD.recordError("Texture.create失败","tTextureNameRealName："+tt)}this.subTextureDic[tZ]=tl,ta.alphaTexture&&(this.subTextureDic[tZ].alphaTexture=tBD.create(ta.alphaTexture,tE,tI,tO,tC,-tN,-t$,td,tJ))}this._mainTexture=ta;var t_,tA,tq,tb,tG,tX=tM.getUint16();for(tD=0;tD<tX;tD++)(t_=[]).push(tM.getUint16()),t_.push(tM.getUint16()),t_.push(tM.getUint16()),t_.push(tM.getUint16()),this.aniSectionDic[tD]=t_;var tz,tm=tM.getInt16(),th={};for(tD=0;tD<tm;tD++)tA=new tHD,0==tD?tz=tA:tA.root=tz,tA.d=ts?-1:1,tb=tM.readUTFString(),tG=tM.readUTFString(),tA.length=tM.getFloat32(),1==tM.getByte()&&(tA.inheritRotation=!1),1==tM.getByte()&&(tA.inheritScale=!1),tA.name=tb,tG&&((tq=th[tG])?tq.addChild(tA):this.mRootBone=tA),th[tb]=tA,this.mBoneArr.push(tA);this.tMatrixDataLen=tM.getUint16();var ti,tP,tB=tM.getUint16(),tH=Math.floor(tB/this.tMatrixDataLen),tv=this.srcBoneMatrixArr;for(tD=0;tD<tH;tD++)(ti=new tRD).scX=tM.getFloat32(),ti.skX=tM.getFloat32(),ti.skY=tM.getFloat32(),ti.scY=tM.getFloat32(),ti.x=tM.getFloat32(),ti.y=tM.getFloat32(),8===this.tMatrixDataLen&&(ti.skewX=tM.getFloat32(),ti.skewY=tM.getFloat32()),tv.push(ti),(tA=this.mBoneArr[tD]).transform=ti;var tS,tU=tM.getUint16(),tF=0;for(tD=0;tD<tU;tD++){for(tP=new tfD,tF=tM.getUint16(),tY=0;tY<tF;tY++)tP.boneNames.push(tM.readUTFString()),tP.boneIndexs.push(tM.getInt16());tP.name=tM.readUTFString(),tP.targetBoneName=tM.readUTFString(),tP.targetBoneIndex=tM.getInt16(),tP.bendDirection=tM.getFloat32(),tP.mix=tM.getFloat32(),tP.isSpine=ts,this.ikArr.push(tP)}var tV,tc=tM.getUint16(),tf=0;for(tD=0;tD<tc;tD++){for(tS=new toD,tf=tM.getUint16(),tY=0;tY<tf;tY++)tS.boneIndexs.push(tM.getInt16());tS.name=tM.getUTFString(),tS.targetIndex=tM.getInt16(),tS.rotateMix=tM.getFloat32(),tS.translateMix=tM.getFloat32(),tS.scaleMix=tM.getFloat32(),tS.shearMix=tM.getFloat32(),tS.offsetRotation=tM.getFloat32(),tS.offsetX=tM.getFloat32(),tS.offsetY=tM.getFloat32(),tS.offsetScaleX=tM.getFloat32(),tS.offsetScaleY=tM.getFloat32(),tS.offsetShearY=tM.getFloat32(),this.tfArr.push(tS)}var te=tM.getUint16(),tk=0;for(tD=0;tD<te;tD++){for((tV=new teD).name=tM.readUTFString(),tk=tM.getUint16(),tY=0;tY<tk;tY++)tV.bones.push(tM.getInt16());tV.target=tM.readUTFString(),tV.positionMode=tM.readUTFString(),tV.spacingMode=tM.readUTFString(),tV.rotateMode=tM.readUTFString(),tV.offsetRotation=tM.getFloat32(),tV.position=tM.getFloat32(),tV.spacing=tM.getFloat32(),tV.rotateMix=tM.getFloat32(),tV.translateMix=tM.getFloat32(),this.pathArr.push(tV)}var tw,tK,to,tR,tQ,tL=0,ty=0,tu=0,tn=NaN,tDD=0,tYD=tM.getInt16();for(tD=0;tD<tYD;tD++){var tgD=tM.getUint8(),tTD={};this.deformAniArr.push(tTD);for(var trD=0;trD<tgD;trD++)for((tw=new tSD).skinName=tM.getUTFString(),tTD[tw.skinName]=tw,tL=tM.getInt16(),tY=0;tY<tL;tY++)for(tK=new tUD,tw.deformSlotDataList.push(tK),ty=tM.getInt16(),tg=0;tg<ty;tg++)for(to=new tFD,tK.deformSlotDisplayList.push(to),to.slotIndex=tM.getInt16(),to.attachment=tM.getUTFString(),tu=tM.getInt16(),tT=0;tT<tu;tT++)for(1==tM.getByte()?to.tweenKeyList.push(!0):to.tweenKeyList.push(!1),tn=tM.getFloat32(),to.timeList.push(tn),tR=[],to.vectices.push(tR),tDD=tM.getInt16(),tr=0;tr<tDD;tr++)tR.push(tM.getFloat32())}var tsD,taD,tWD=tM.getInt16(),tMD=0,tED=0;for(tD=0;tD<tWD;tD++){for(tMD=tM.getInt16(),tQ=[],tY=0;tY<tMD;tY++){for((tsD=new tVD).time=tM.getFloat32(),tED=tM.getInt16(),tg=0;tg<tED;tg++)tsD.drawOrder.push(tM.getInt16());tQ.push(tsD)}this.drawOrderAniArr.push(tQ)}var tID,tOD=tM.getInt16(),tCD=0;for(tD=0;tD<tOD;tD++){for(tCD=tM.getInt16(),taD=[],tY=0;tY<tCD;tY++)(tID=new tcD).name=tM.getUTFString(),tID.intValue=tM.getInt32(),tID.floatValue=tM.getFloat32(),tID.stringValue=tM.getUTFString(),tID.time=tM.getFloat32(),taD.push(tID);this.eventAniArr.push(taD)}var tND=tM.getInt16();if(0<tND)for(this.attachmentNames=[],tD=0;tD<tND;tD++)this.attachmentNames.push(tM.getUTFString());var t$D,tdD,tJD=tM.getInt16();for(tD=0;tD<tJD;tD++)(t$D=new tvD).name=tM.readUTFString(),t$D.parent=tM.readUTFString(),t$D.attachmentName=tM.readUTFString(),t$D.srcDisplayIndex=t$D.displayIndex=tM.getInt16(),(t$D.templet=this).boneSlotDic[t$D.name]=t$D,null==(tdD=this.bindBoneBoneSlotDic[t$D.parent])&&(this.bindBoneBoneSlotDic[t$D.parent]=tdD=[]),tdD.push(t$D),this.boneSlotArray.push(t$D);var txD,tjD,tZD,tpD=tM.readUTFString().split("\n"),tlD=0,ttD=tM.getUint8(),t_D=0,tAD=0,tqD=0,tbD=0,tGD=0,tXD=0,tzD=0;for(tD=0;tD<ttD;tD++){for((txD=new tkD).name=tpD[tlD++],t_D=tM.getUint8(),tY=0;tY<t_D;tY++){for((tjD=new tKD).name=tpD[tlD++],t$D=this.boneSlotDic[tjD.name],tAD=tM.getUint8(),tg=0;tg<tAD;tg++){if(tZD=new twD,this.skinSlotDisplayDataArr.push(tZD),tZD.name=tpD[tlD++],tZD.attachmentName=tpD[tlD++],tZD.transform=new tRD,tZD.transform.scX=tM.getFloat32(),tZD.transform.skX=tM.getFloat32(),tZD.transform.skY=tM.getFloat32(),tZD.transform.scY=tM.getFloat32(),tZD.transform.x=tM.getFloat32(),tZD.transform.y=tM.getFloat32(),tjD.displayArr.push(tZD),tZD.width=tM.getFloat32(),tZD.height=tM.getFloat32(),tZD.type=tM.getUint8(),tZD.verLen=tM.getUint16(),0<(tm=tM.getUint16()))for(tZD.bones=[],tT=0;tT<tm;tT++){var tmD=tM.getUint16();tZD.bones.push(tmD)}if(0<(tqD=tM.getUint16()))for(tZD.uvs=[],tT=0;tT<tqD;tT++)tZD.uvs.push(tM.getFloat32());if(0<(tbD=tM.getUint16()))for(tZD.weights=[],tT=0;tT<tbD;tT++)tZD.weights.push(tM.getFloat32());if(0<(tGD=tM.getUint16()))for(tZD.triangles=[],tT=0;tT<tGD;tT++)tZD.triangles.push(tM.getUint16());if(0<(tXD=tM.getUint16()))for(tZD.vertices=[],tT=0;tT<tXD;tT++)tZD.vertices.push(tM.getFloat32());if(0<(tzD=tM.getUint16()))for(tZD.lengths=[],tT=0;tT<tzD;tT++)tZD.lengths.push(tM.getFloat32())}txD.slotArr.push(tjD)}this.skinDic[txD.name]=txD,this.skinDataArray.push(txD)}1==tM.getUint8()?(this.yReverseMatrix=new tPD(1,0,0,-1,0,0),tz&&tz.setTempMatrix(this.yReverseMatrix)):tz&&tz.setTempMatrix(new tPD),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},tD.getTexture=function(tD){var tY=this.subTextureDic[tD];return tY||(tY=this.subTextureDic[tD.substr(0,tD.length-1)]),null==tY?this._mainTexture:tY},tD.showSkinByIndex=function(tD,tY,tg){if(void 0===tg&&(tg=!0),tY<0&&tY>=this.skinDataArray.length)return!1;var tT,tr,ts=0,ta=0,tW=this.skinDataArray[tY];if(tW){for(ts=0,ta=tW.slotArr.length;ts<ta;ts++)(tr=tW.slotArr[ts])&&(tT=tD[tr.name])&&(tT.showSlotData(tr,tg),tg&&"undefined"!=tT.attachmentName&&"null"!=tT.attachmentName?tT.showDisplayByName(tT.attachmentName):tT.showDisplayByIndex(tT.displayIndex));return!0}return!1},tD.getSkinIndexByName=function(tD){for(var tY=0,tg=this.skinDataArray.length;tY<tg;tY++)if(this.skinDataArray[tY].name==tD)return tY;return-1},tD.getGrahicsDataWithCache=function(tD,tY){return this._graphicsCache[tD][tY]},tD.setGrahicsDataWithCache=function(tD,tY,tg){this._graphicsCache[tD][tY]=tg},tD.destroy=function(){var tD;for(var tY in this._isDestroyed=!0,this.subTextureDic)(tD=this.subTextureDic[tY])&&tD.destroy();for(tY in this._textureDic)(tD=this._textureDic[tY])&&tD.destroy();for(var tg=0,tT=this.skinSlotDisplayDataArr.length;tg<tT;tg++)this.skinSlotDisplayDataArr[tg].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete tr.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},tD.getAniNameByIndex=function(tD){var tY=this.getAnimation(tD);return tY?tY.name:null},ts(0,tD,"rate",function(){return this._rate},function(tD){this._rate=tD}),tr.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",tr.TEMPLET_DICTIONARY=null,tr}(tB)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(tD,tY){"use strict";for(var tg in Object.defineProperty(tY,"__esModule",{value:!0}),Laya){var tT=Laya[tg];tT&&tT.__isclass&&(tY[tg]=tT)}}),function(tD,tY){"object"==typeof exports&&"object"==typeof module?window?window.Matter=tY():module.exports=tY():"function"==typeof define&&define.amd?define("Matter",[],tY):"object"==typeof exports?exports.Matter=tY():tD.Matter=tY()}(this,function(){return function(tg){var tT={};function tr(tD){if(tT[tD])return tT[tD].exports;var tY=tT[tD]={i:tD,l:!1,exports:{}};return tg[tD].call(tY.exports,tY,tY.exports,tr),tY.l=!0,tY.exports}return tr.m=tg,tr.c=tT,tr.d=function(tD,tY,tg){tr.o(tD,tY)||Object.defineProperty(tD,tY,{enumerable:!0,get:tg})},tr.r=function(tD){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(tD,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(tD,"__esModule",{value:!0})},tr.t=function(tY,tD){if(1&tD&&(tY=tr(tY)),8&tD)return tY;if(4&tD&&"object"==typeof tY&&tY&&tY.__esModule)return tY;var tg=Object.create(null);if(tr.r(tg),Object.defineProperty(tg,"default",{enumerable:!0,value:tY}),2&tD&&"string"!=typeof tY)for(var tT in tY)tr.d(tg,tT,function(tD){return tY[tD]}.bind(null,tT));return tg},tr.n=function(tD){var tY=tD&&tD.__esModule?function(){return tD.default}:function(){return tD};return tr.d(tY,"a",tY),tY},tr.o=function(tD,tY){return Object.prototype.hasOwnProperty.call(tD,tY)},tr.p="",tr(tr.s=21)}([function(tD,tY){var tM={};tD.exports=tM,function(){tM._nextId=0,tM._seed=0,tM._nowStartTime=+new Date,tM._warnedOnce={},tM._decomp=null,tM.extend=function(tD,tY){var tg,tT;tT="boolean"==typeof tY?(tg=2,tY):(tg=1,!0);for(var tr=tg;tr<arguments.length;tr++){var ts=arguments[tr];if(ts)for(var ta in ts)tT&&ts[ta]&&ts[ta].constructor===Object?tD[ta]&&tD[ta].constructor!==Object?tD[ta]=ts[ta]:(tD[ta]=tD[ta]||{},tM.extend(tD[ta],tT,ts[ta])):tD[ta]=ts[ta]}return tD},tM.clone=function(tD,tY){return tM.extend({},tY,tD)},tM.keys=function(tD){if(Object.keys)return Object.keys(tD);var tY=[];for(var tg in tD)tY.push(tg);return tY},tM.values=function(tD){var tY=[];if(Object.keys){for(var tg=Object.keys(tD),tT=0;tT<tg.length;tT++)tY.push(tD[tg[tT]]);return tY}for(var tr in tD)tY.push(tD[tr]);return tY},tM.get=function(tD,tY,tg,tT){tY=tY.split(".").slice(tg,tT);for(var tr=0;tr<tY.length;tr+=1)tD=tD[tY[tr]];return tD},tM.set=function(tD,tY,tg,tT,tr){var ts=tY.split(".").slice(tT,tr);return tM.get(tD,tY,0,-1)[ts[ts.length-1]]=tg},tM.shuffle=function(tD){for(var tY=tD.length-1;0<tY;tY--){var tg=Math.floor(tM.random()*(tY+1)),tT=tD[tY];tD[tY]=tD[tg],tD[tg]=tT}return tD},tM.choose=function(tD){return tD[Math.floor(tM.random()*tD.length)]},tM.isElement=function(tD){return"undefined"!=typeof HTMLElement?tD instanceof HTMLElement:!!(tD&&tD.nodeType&&tD.nodeName)},tM.isArray=function(tD){return"[object Array]"===Object.prototype.toString.call(tD)},tM.isFunction=function(tD){return"function"==typeof tD},tM.isPlainObject=function(tD){return"object"==typeof tD&&tD.constructor===Object},tM.isString=function(tD){return"[object String]"===toString.call(tD)},tM.clamp=function(tD,tY,tg){return tD<tY?tY:tg<tD?tg:tD},tM.sign=function(tD){return tD<0?-1:1},tM.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-tM._nowStartTime},tM.random=function(tD,tY){return tY=void 0!==tY?tY:1,(tD=void 0!==tD?tD:0)+tg()*(tY-tD)};var tg=function(){return tM._seed=(9301*tM._seed+49297)%233280,tM._seed/233280};tM.colorToNumber=function(tD){return 3==(tD=tD.replace("#","")).length&&(tD=tD.charAt(0)+tD.charAt(0)+tD.charAt(1)+tD.charAt(1)+tD.charAt(2)+tD.charAt(2)),parseInt(tD,16)},tM.logLevel=1,tM.log=function(){console&&0<tM.logLevel&&tM.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},tM.info=function(){console&&0<tM.logLevel&&tM.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},tM.warn=function(){console&&0<tM.logLevel&&tM.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},tM.warnOnce=function(){var tD=Array.prototype.slice.call(arguments).join(" ");tM._warnedOnce[tD]||(tM.warn(tD),tM._warnedOnce[tD]=!0)},tM.deprecated=function(tD,tY,tg){tD[tY]=tM.chain(function(){tM.warnOnce("🔅 deprecated 🔅",tg)},tD[tY])},tM.nextId=function(){return tM._nextId++},tM.indexOf=function(tD,tY){if(tD.indexOf)return tD.indexOf(tY);for(var tg=0;tg<tD.length;tg++)if(tD[tg]===tY)return tg;return-1},tM.map=function(tD,tY){if(tD.map)return tD.map(tY);for(var tg=[],tT=0;tT<tD.length;tT+=1)tg.push(tY(tD[tT]));return tg},tM.topologicalSort=function(tD){var tY=[],tg=[],tT=[];for(var tr in tD)tg[tr]||tT[tr]||tM._topologicalSort(tr,tg,tT,tD,tY);return tY},tM._topologicalSort=function(tD,tY,tg,tT,tr){var ts=tT[tD]||[];tg[tD]=!0;for(var ta=0;ta<ts.length;ta+=1){var tW=ts[ta];tg[tW]||(tY[tW]||tM._topologicalSort(tW,tY,tg,tT,tr))}tg[tD]=!1,tY[tD]=!0,tr.push(tD)},tM.chain=function(){for(var ts=[],tD=0;tD<arguments.length;tD+=1){var tY=arguments[tD];tY._chained?ts.push.apply(ts,tY._chained):ts.push(tY)}function tg(){for(var tD,tY=new Array(arguments.length),tg=0,tT=arguments.length;tg<tT;tg++)tY[tg]=arguments[tg];for(tg=0;tg<ts.length;tg+=1){var tr=ts[tg].apply(tD,tY);void 0!==tr&&(tD=tr)}return tD}return tg._chained=ts,tg},tM.chainPathBefore=function(tD,tY,tg){return tM.set(tD,tY,tM.chain(tg,tM.get(tD,tY)))},tM.chainPathAfter=function(tD,tY,tg){return tM.set(tD,tY,tM.chain(tM.get(tD,tY),tg))},tM.setDecomp=function(tD){tM._decomp=tD},tM.getDecomp=function(){var tY=tM._decomp;try{tY||"undefined"==typeof window||(tY=window.decomp),tY||"undefined"==typeof global||(tY=global.decomp)}catch(tD){tY=null}return tY}}()},function(tD,tY){var tg={};(tD.exports=tg).create=function(tD){var tY={min:{x:0,y:0},max:{x:0,y:0}};return tD&&tg.update(tY,tD),tY},tg.update=function(tD,tY,tg){tD.min.x=1/0,tD.max.x=-1/0,tD.min.y=1/0,tD.max.y=-1/0;for(var tT=0;tT<tY.length;tT++){var tr=tY[tT];tr.x>tD.max.x&&(tD.max.x=tr.x),tr.x<tD.min.x&&(tD.min.x=tr.x),tr.y>tD.max.y&&(tD.max.y=tr.y),tr.y<tD.min.y&&(tD.min.y=tr.y)}tg&&(0<tg.x?tD.max.x+=tg.x:tD.min.x+=tg.x,0<tg.y?tD.max.y+=tg.y:tD.min.y+=tg.y)},tg.contains=function(tD,tY){return tY.x>=tD.min.x&&tY.x<=tD.max.x&&tY.y>=tD.min.y&&tY.y<=tD.max.y},tg.overlaps=function(tD,tY){return tD.min.x<=tY.max.x&&tD.max.x>=tY.min.x&&tD.max.y>=tY.min.y&&tD.min.y<=tY.max.y},tg.translate=function(tD,tY){tD.min.x+=tY.x,tD.max.x+=tY.x,tD.min.y+=tY.y,tD.max.y+=tY.y},tg.shift=function(tD,tY){var tg=tD.max.x-tD.min.x,tT=tD.max.y-tD.min.y;tD.min.x=tY.x,tD.max.x=tY.x+tg,tD.min.y=tY.y,tD.max.y=tY.y+tT}},function(tD,tY){var tg={};(tD.exports=tg).create=function(tD,tY){return{x:tD||0,y:tY||0}},tg.clone=function(tD){return{x:tD.x,y:tD.y}},tg.magnitude=function(tD){return Math.sqrt(tD.x*tD.x+tD.y*tD.y)},tg.magnitudeSquared=function(tD){return tD.x*tD.x+tD.y*tD.y},tg.rotate=function(tD,tY,tg){var tT=Math.cos(tY),tr=Math.sin(tY);tg||(tg={});var ts=tD.x*tT-tD.y*tr;return tg.y=tD.x*tr+tD.y*tT,tg.x=ts,tg},tg.rotateAbout=function(tD,tY,tg,tT){var tr=Math.cos(tY),ts=Math.sin(tY);tT||(tT={});var ta=tg.x+((tD.x-tg.x)*tr-(tD.y-tg.y)*ts);return tT.y=tg.y+((tD.x-tg.x)*ts+(tD.y-tg.y)*tr),tT.x=ta,tT},tg.normalise=function(tD){var tY=tg.magnitude(tD);return 0===tY?{x:0,y:0}:{x:tD.x/tY,y:tD.y/tY}},tg.dot=function(tD,tY){return tD.x*tY.x+tD.y*tY.y},tg.cross=function(tD,tY){return tD.x*tY.y-tD.y*tY.x},tg.cross3=function(tD,tY,tg){return(tY.x-tD.x)*(tg.y-tD.y)-(tY.y-tD.y)*(tg.x-tD.x)},tg.add=function(tD,tY,tg){return tg||(tg={}),tg.x=tD.x+tY.x,tg.y=tD.y+tY.y,tg},tg.sub=function(tD,tY,tg){return tg||(tg={}),tg.x=tD.x-tY.x,tg.y=tD.y-tY.y,tg},tg.mult=function(tD,tY){return{x:tD.x*tY,y:tD.y*tY}},tg.div=function(tD,tY){return{x:tD.x/tY,y:tD.y/tY}},tg.perp=function(tD,tY){return{x:(tY=!0===tY?-1:1)*-tD.y,y:tY*tD.x}},tg.neg=function(tD){return{x:-tD.x,y:-tD.y}},tg.angle=function(tD,tY){return Math.atan2(tY.y-tD.y,tY.x-tD.x)},tg._temp=[tg.create(),tg.create(),tg.create(),tg.create(),tg.create(),tg.create()]},function(tD,tY,tg){var tW={};tD.exports=tW;var tp=tg(2),tl=tg(0);tW.create=function(tD,tY){for(var tg=[],tT=0;tT<tD.length;tT++){var tr=tD[tT],ts={x:tr.x,y:tr.y,index:tT,body:tY,isInternal:!1};tg.push(ts)}return tg},tW.fromPath=function(tD,tY){var tT=[];return tD.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,function(tD,tY,tg){tT.push({x:parseFloat(tY),y:parseFloat(tg)})}),tW.create(tT,tY)},tW.centre=function(tD){for(var tY,tg,tT,tr=tW.area(tD,!0),ts={x:0,y:0},ta=0;ta<tD.length;ta++)tT=(ta+1)%tD.length,tY=tp.cross(tD[ta],tD[tT]),tg=tp.mult(tp.add(tD[ta],tD[tT]),tY),ts=tp.add(ts,tg);return tp.div(ts,6*tr)},tW.mean=function(tD){for(var tY={x:0,y:0},tg=0;tg<tD.length;tg++)tY.x+=tD[tg].x,tY.y+=tD[tg].y;return tp.div(tY,tD.length)},tW.area=function(tD,tY){for(var tg=0,tT=tD.length-1,tr=0;tr<tD.length;tr++)tg+=(tD[tT].x-tD[tr].x)*(tD[tT].y+tD[tr].y),tT=tr;return tY?tg/2:Math.abs(tg)/2},tW.inertia=function(tD,tY){for(var tg,tT,tr=0,ts=0,ta=tD,tW=0;tW<ta.length;tW++)tT=(tW+1)%ta.length,tr+=(tg=Math.abs(tp.cross(ta[tT],ta[tW])))*(tp.dot(ta[tT],ta[tT])+tp.dot(ta[tT],ta[tW])+tp.dot(ta[tW],ta[tW])),ts+=tg;return tY/6*(tr/ts)},tW.translate=function(tD,tY,tg){tg=void 0!==tg?tg:1;var tT,tr=tD.length,ts=tY.x*tg,ta=tY.y*tg;for(tT=0;tT<tr;tT++)tD[tT].x+=ts,tD[tT].y+=ta;return tD},tW.rotate=function(tD,tY,tg){if(0!==tY){var tT,tr,ts,ta,tW=Math.cos(tY),tM=Math.sin(tY),tE=tg.x,tI=tg.y,tO=tD.length;for(ta=0;ta<tO;ta++)tr=(tT=tD[ta]).x-tE,ts=tT.y-tI,tT.x=tE+(tr*tW-ts*tM),tT.y=tI+(tr*tM+ts*tW);return tD}},tW.contains=function(tD,tY){for(var tg,tT=tY.x,tr=tY.y,ts=tD.length,ta=tD[ts-1],tW=0;tW<ts;tW++){if(tg=tD[tW],0<(tT-ta.x)*(tg.y-ta.y)+(tr-ta.y)*(ta.x-tg.x))return!1;ta=tg}return!0},tW.scale=function(tD,tY,tg,tT){if(1===tY&&1===tg)return tD;var tr,ts;tT=tT||tW.centre(tD);for(var ta=0;ta<tD.length;ta++)tr=tD[ta],ts=tp.sub(tr,tT),tD[ta].x=tT.x+ts.x*tY,tD[ta].y=tT.y+ts.y*tg;return tD},tW.chamfer=function(tD,tY,tg,tT,tr){tY="number"==typeof tY?[tY]:tY||[8],tg=void 0!==tg?tg:-1,tT=tT||2,tr=tr||14;for(var ts=[],ta=0;ta<tD.length;ta++){var tW=tD[0<=ta-1?ta-1:tD.length-1],tM=tD[ta],tE=tD[(ta+1)%tD.length],tI=tY[ta<tY.length?ta:tY.length-1];if(0!==tI){var tO=tp.normalise({x:tM.y-tW.y,y:tW.x-tM.x}),tC=tp.normalise({x:tE.y-tM.y,y:tM.x-tE.x}),tN=Math.sqrt(2*Math.pow(tI,2)),t$=tp.mult(tl.clone(tO),tI),td=tp.normalise(tp.mult(tp.add(tO,tC),.5)),tJ=tp.sub(tM,tp.mult(td,tN)),tx=tg;-1===tg&&(tx=1.75*Math.pow(tI,.32)),(tx=tl.clamp(tx,tT,tr))%2==1&&(tx+=1);for(var tj=Math.acos(tp.dot(tO,tC))/tx,tZ=0;tZ<tx;tZ++)ts.push(tp.add(tp.rotate(t$,tj*tZ),tJ))}else ts.push(tM)}return ts},tW.clockwiseSort=function(tD){var tg=tW.mean(tD);return tD.sort(function(tD,tY){return tp.angle(tg,tD)-tp.angle(tg,tY)}),tD},tW.isConvex=function(tD){var tY,tg,tT,tr,ts=0,ta=tD.length;if(ta<3)return null;for(tY=0;tY<ta;tY++)if(tT=(tY+2)%ta,tr=(tD[tg=(tY+1)%ta].x-tD[tY].x)*(tD[tT].y-tD[tg].y),(tr-=(tD[tg].y-tD[tY].y)*(tD[tT].x-tD[tg].x))<0?ts|=1:0<tr&&(ts|=2),3===ts)return!1;return 0!==ts||null},tW.hull=function(tD){var tY,tg,tT=[],tr=[];for((tD=tD.slice(0)).sort(function(tD,tY){var tg=tD.x-tY.x;return 0!=tg?tg:tD.y-tY.y}),tg=0;tg<tD.length;tg+=1){for(tY=tD[tg];2<=tr.length&&tp.cross3(tr[tr.length-2],tr[tr.length-1],tY)<=0;)tr.pop();tr.push(tY)}for(tg=tD.length-1;0<=tg;tg-=1){for(tY=tD[tg];2<=tT.length&&tp.cross3(tT[tT.length-2],tT[tT.length-1],tY)<=0;)tT.pop();tT.push(tY)}return tT.pop(),tr.pop(),tT.concat(tr)}},function(tD,tY,tg){var tT={};tD.exports=tT;var tI=tg(0);tT.on=function(tD,tY,tg){for(var tT,tr=tY.split(" "),ts=0;ts<tr.length;ts++)tT=tr[ts],tD.events=tD.events||{},tD.events[tT]=tD.events[tT]||[],tD.events[tT].push(tg);return tg},tT.off=function(tD,tY,tg){if(tY){"function"==typeof tY&&(tg=tY,tY=tI.keys(tD.events).join(" "));for(var tT=tY.split(" "),tr=0;tr<tT.length;tr++){var ts=tD.events[tT[tr]],ta=[];if(tg&&ts)for(var tW=0;tW<ts.length;tW++)ts[tW]!==tg&&ta.push(ts[tW]);tD.events[tT[tr]]=ta}}else tD.events={}},tT.trigger=function(tD,tY,tg){var tT,tr,ts,ta,tW=tD.events;if(tW&&0<tI.keys(tW).length){tg||(tg={}),tT=tY.split(" ");for(var tM=0;tM<tT.length;tM++)if(ts=tW[tr=tT[tM]]){(ta=tI.clone(tg,!1)).name=tr,ta.source=tD;for(var tE=0;tE<ts.length;tE++)ts[tE].apply(tD,[ta])}}}},function(tD,tY,tg){var tO={};tD.exports=tO;var ta=tg(4),tW=tg(0),ts=tg(1),tC=tg(6);tO.create=function(tD){return tW.extend({id:tW.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},tD)},tO.setModified=function(tD,tY,tg,tT){if((tD.isModified=tY)&&tD.cache&&(tD.cache.allBodies=null,tD.cache.allConstraints=null,tD.cache.allComposites=null),tg&&tD.parent&&tO.setModified(tD.parent,tY,tg,tT),tT)for(var tr=0;tr<tD.composites.length;tr++){var ts=tD.composites[tr];tO.setModified(ts,tY,tg,tT)}},tO.add=function(tD,tY,tg){var tT=[].concat(tY);ta.trigger(tD,"beforeAdd",{object:tY});for(var tr=0;tr<tT.length;tr++){var ts=tT[tr];switch(ts.type){case"body":if(ts.parent!==ts){tW.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}0<=tg&&tg<tD.bodies.length?tO.addBodyAt(tD,ts,tg):tO.addBody(tD,ts);break;case"constraint":tO.addConstraint(tD,ts);break;case"composite":tO.addComposite(tD,ts);break;case"mouseConstraint":tO.addConstraint(tD,ts.constraint)}}return ta.trigger(tD,"afterAdd",{object:tY}),tD},tO.remove=function(tD,tY,tg){var tT=[].concat(tY);ta.trigger(tD,"beforeRemove",{object:tY});for(var tr=0;tr<tT.length;tr++){var ts=tT[tr];switch(ts.type){case"body":tO.removeBody(tD,ts,tg);break;case"constraint":tO.removeConstraint(tD,ts,tg);break;case"composite":tO.removeComposite(tD,ts,tg);break;case"mouseConstraint":tO.removeConstraint(tD,ts.constraint)}}return ta.trigger(tD,"afterRemove",{object:tY}),tD},tO.addComposite=function(tD,tY){return tD.composites.push(tY),tY.parent=tD,tO.setModified(tD,!0,!0,!1),tD},tO.removeComposite=function(tD,tY,tg){var tT=tW.indexOf(tD.composites,tY);if(-1!==tT&&tO.removeCompositeAt(tD,tT),tg)for(var tr=0;tr<tD.composites.length;tr++)tO.removeComposite(tD.composites[tr],tY,!0);return tD},tO.removeCompositeAt=function(tD,tY){return tD.composites.splice(tY,1),tO.setModified(tD,!0,!0,!1),tD},tO.addBodyAt=function(tD,tY,tg){return 0<=tg&&tg<tD.bodies.length?tD.bodies.splice(tg,0,tY):tD.bodies.push(tY),tO.setModified(tD,!0,!0,!1),tD},tO.addBody=function(tD,tY){return tD.bodies.push(tY),tO.setModified(tD,!0,!0,!1),tD},tO.removeBody=function(tD,tY,tg){var tT=tW.indexOf(tD.bodies,tY);if(-1!==tT&&tO.removeBodyAt(tD,tT),tg)for(var tr=0;tr<tD.composites.length;tr++)tO.removeBody(tD.composites[tr],tY,!0);return tD},tO.removeBodyAt=function(tD,tY){return tD.bodies.splice(tY,1),tO.setModified(tD,!0,!0,!1),tD},tO.addConstraint=function(tD,tY){return tD.constraints.push(tY),tO.setModified(tD,!0,!0,!1),tD},tO.removeConstraint=function(tD,tY,tg){var tT=tW.indexOf(tD.constraints,tY);if(-1!==tT&&tO.removeConstraintAt(tD,tT),tg)for(var tr=0;tr<tD.composites.length;tr++)tO.removeConstraint(tD.composites[tr],tY,!0);return tD},tO.removeConstraintAt=function(tD,tY){return tD.constraints.splice(tY,1),tO.setModified(tD,!0,!0,!1),tD},tO.clear=function(tD,tY,tg){if(tg)for(var tT=0;tT<tD.composites.length;tT++)tO.clear(tD.composites[tT],tY,!0);return tY?tD.bodies=tD.bodies.filter(function(tD){return tD.isStatic}):tD.bodies.length=0,tD.constraints.length=0,tD.composites.length=0,tO.setModified(tD,!0,!0,!1),tD},tO.allBodies=function(tD){if(tD.cache&&tD.cache.allBodies)return tD.cache.allBodies;for(var tY=[].concat(tD.bodies),tg=0;tg<tD.composites.length;tg++)tY=tY.concat(tO.allBodies(tD.composites[tg]));return tD.cache&&(tD.cache.allBodies=tY),tY},tO.allConstraints=function(tD){if(tD.cache&&tD.cache.allConstraints)return tD.cache.allConstraints;for(var tY=[].concat(tD.constraints),tg=0;tg<tD.composites.length;tg++)tY=tY.concat(tO.allConstraints(tD.composites[tg]));return tD.cache&&(tD.cache.allConstraints=tY),tY},tO.allComposites=function(tD){if(tD.cache&&tD.cache.allComposites)return tD.cache.allComposites;for(var tY=[].concat(tD.composites),tg=0;tg<tD.composites.length;tg++)tY=tY.concat(tO.allComposites(tD.composites[tg]));return tD.cache&&(tD.cache.allComposites=tY),tY},tO.get=function(tD,tY,tg){var tT,tr;switch(tg){case"body":tT=tO.allBodies(tD);break;case"constraint":tT=tO.allConstraints(tD);break;case"composite":tT=tO.allComposites(tD).concat(tD)}return tT?0===(tr=tT.filter(function(tD){return tD.id.toString()===tY.toString()})).length?null:tr[0]:null},tO.move=function(tD,tY,tg){return tO.remove(tD,tY),tO.add(tg,tY),tD},tO.rebase=function(tD){for(var tY=tO.allBodies(tD).concat(tO.allConstraints(tD)).concat(tO.allComposites(tD)),tg=0;tg<tY.length;tg++)tY[tg].id=tW.nextId();return tD},tO.translate=function(tD,tY,tg){for(var tT=tg?tO.allBodies(tD):tD.bodies,tr=0;tr<tT.length;tr++)tC.translate(tT[tr],tY);return tD},tO.rotate=function(tD,tY,tg,tT){for(var tr=Math.cos(tY),ts=Math.sin(tY),ta=tT?tO.allBodies(tD):tD.bodies,tW=0;tW<ta.length;tW++){var tM=ta[tW],tE=tM.position.x-tg.x,tI=tM.position.y-tg.y;tC.setPosition(tM,{x:tg.x+(tE*tr-tI*ts),y:tg.y+(tE*ts+tI*tr)}),tC.rotate(tM,tY)}return tD},tO.scale=function(tD,tY,tg,tT,tr){for(var ts=tr?tO.allBodies(tD):tD.bodies,ta=0;ta<ts.length;ta++){var tW=ts[ta],tM=tW.position.x-tT.x,tE=tW.position.y-tT.y;tC.setPosition(tW,{x:tT.x+tM*tY,y:tT.y+tE*tg}),tC.scale(tW,tY,tg)}return tD},tO.bounds=function(tD){for(var tY=tO.allBodies(tD),tg=[],tT=0;tT<tY.length;tT+=1){var tr=tY[tT];tg.push(tr.bounds.min,tr.bounds.max)}return ts.create(tg)}},function(tD,tY,tg){var tE={};tD.exports=tE;var tO=tg(3),tC=tg(2),tr=tg(7),ts=(tg(16),tg(0)),tN=tg(1),t$=tg(11);!function(){tE._inertiaScale=4,tE._nextCollidingGroupId=1,tE._nextNonCollidingGroupId=-1,tE._nextCategory=1,tE.create=function(tD){var tY={id:ts.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:tO.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,positionRc:{cpx:0,cpy:0,ppx:0,ppy:0},friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},tg=ts.extend(tY,tD);return tT(tg,tD),tg},tE.nextGroup=function(tD){return tD?tE._nextNonCollidingGroupId--:tE._nextCollidingGroupId++},tE.nextCategory=function(){return tE._nextCategory=tE._nextCategory<<1,tE._nextCategory};var tT=function(tD,tY){tY=tY||{},tE.set(tD,{bounds:tD.bounds||tN.create(tD.vertices),worldBounds:tY.worldBounds,positionPrev:tD.positionPrev||tC.clone(tD.position),anglePrev:tD.anglePrev||tD.angle,vertices:tD.vertices,parts:tD.parts||[tD],isStatic:tD.isStatic,isSleeping:tD.isSleeping,parent:tD.parent||tD}),tO.rotate(tD.vertices,tD.angle,tD.position),t$.rotate(tD.axes,tD.angle),tN.update(tD.bounds,tD.vertices,tD.velocity),tE.set(tD,{axes:tY.axes||tD.axes,area:tY.area||tD.area,mass:tY.mass||tD.mass,inertia:tY.inertia||tD.inertia});var tg=tD.isStatic?"#14151f":ts.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),tT=tD.isStatic?"#555":"#ccc",tr=tD.isStatic&&null===tD.render.fillStyle?1:0;tD.render.fillStyle=tD.render.fillStyle||tg,tD.render.strokeStyle=tD.render.strokeStyle||tT,tD.render.lineWidth=tD.render.lineWidth||tr,tD.render.sprite.xOffset+=-(tD.bounds.min.x-tD.position.x)/(tD.bounds.max.x-tD.bounds.min.x),tD.render.sprite.yOffset+=-(tD.bounds.min.y-tD.position.y)/(tD.bounds.max.y-tD.bounds.min.y)};tE.set=function(tD,tY,tg){var tT;for(tT in"string"==typeof tY&&(tT=tY,(tY={})[tT]=tg),tY)if(Object.prototype.hasOwnProperty.call(tY,tT))switch(tg=tY[tT],tT){case"isStatic":tE.setStatic(tD,tg);break;case"isSleeping":tr.set(tD,tg);break;case"mass":tE.setMass(tD,tg);break;case"density":tE.setDensity(tD,tg);break;case"inertia":tE.setInertia(tD,tg);break;case"vertices":tE.setVertices(tD,tg);break;case"position":tE.setPosition(tD,tg);break;case"angle":tE.setAngle(tD,tg);break;case"velocity":tE.setVelocity(tD,tg);break;case"angularVelocity":tE.setAngularVelocity(tD,tg);break;case"parts":tE.setParts(tD,tg);break;case"centre":tE.setCentre(tD,tg);break;default:tD[tT]=tg}},tE.setStatic=function(tD,tY){for(var tg=0;tg<tD.parts.length;tg++){var tT=tD.parts[tg];(tT.isStatic=tY)?(tT._original={restitution:tT.restitution,friction:tT.friction,mass:tT.mass,inertia:tT.inertia,density:tT.density,inverseMass:tT.inverseMass,inverseInertia:tT.inverseInertia},tT.restitution=0,tT.friction=1,tT.mass=tT.inertia=tT.density=1/0,tT.inverseMass=tT.inverseInertia=0,tT.positionPrev.x=tT.position.x,tT.positionPrev.y=tT.position.y,tT.anglePrev=tT.angle,tT.angularVelocity=0,tT.speed=0,tT.angularSpeed=0,tT.motion=0):tT._original&&(tT.restitution=tT._original.restitution,tT.friction=tT._original.friction,tT.mass=tT._original.mass,tT.inertia=tT._original.inertia,tT.density=tT._original.density,tT.inverseMass=tT._original.inverseMass,tT.inverseInertia=tT._original.inverseInertia,tT._original=null)}},tE.setMass=function(tD,tY){var tg=tD.inertia/(tD.mass/6);tD.inertia=tY/6*tg,tD.inverseInertia=1/tD.inertia,tD.mass=tY,tD.inverseMass=1/tD.mass,tD.density=tD.mass/tD.area},tE.setDensity=function(tD,tY){tE.setMass(tD,tY*tD.area),tD.density=tY},tE.setInertia=function(tD,tY){tD.inertia=tY,tD.inverseInertia=1/tD.inertia},tE.setVertices=function(tD,tY){tY[0].body===tD?tD.vertices=tY:tD.vertices=tO.create(tY,tD),tD.axes=t$.fromVertices(tD.vertices),tD.area=tO.area(tD.vertices),tE.setMass(tD,tD.density*tD.area);var tg=tO.centre(tD.vertices);tO.translate(tD.vertices,tg,-1),tE.setInertia(tD,tE._inertiaScale*tO.inertia(tD.vertices,tD.mass)),tO.translate(tD.vertices,tD.position),tN.update(tD.bounds,tD.vertices,tD.velocity)},tE.setParts=function(tD,tY,tg){var tT;for(tY=tY.slice(0),tD.parts.length=0,tD.parts.push(tD),tD.parent=tD,tT=0;tT<tY.length;tT++){var tr=tY[tT];tr!==tD&&(tr.parent=tD).parts.push(tr)}if(1!==tD.parts.length){if(tg=void 0===tg||tg){var ts=[];for(tT=0;tT<tY.length;tT++)ts=ts.concat(tY[tT].vertices);tO.clockwiseSort(ts);var ta=tO.hull(ts),tW=tO.centre(ta);tE.setVertices(tD,ta),tO.translate(tD.vertices,tW)}var tM=tE._totalProperties(tD);tD.area=tM.area,(tD.parent=tD).position.x=tM.centre.x,tD.position.y=tM.centre.y,tD.positionPrev.x=tM.centre.x,tD.positionPrev.y=tM.centre.y,tE.setMass(tD,tM.mass),tE.setInertia(tD,tM.inertia),tE.setPosition(tD,tM.centre)}},tE.setCentre=function(tD,tY,tg){tg?(tD.positionPrev.x+=tY.x,tD.positionPrev.y+=tY.y,tD.position.x+=tY.x,tD.position.y+=tY.y):(tD.positionPrev.x=tY.x-(tD.position.x-tD.positionPrev.x),tD.positionPrev.y=tY.y-(tD.position.y-tD.positionPrev.y),tD.position.x=tY.x,tD.position.y=tY.y)},tE.setPosition=function(tD,tY){var tg=tC.sub(tY,tD.position);tD.positionPrev.x+=tg.x,tD.positionPrev.y+=tg.y;for(var tT=0;tT<tD.parts.length;tT++){var tr=tD.parts[tT];tr.position.x+=tg.x,tr.position.y+=tg.y,tO.translate(tr.vertices,tg),tN.update(tr.bounds,tr.vertices,tD.velocity)}},tE.setAngle=function(tD,tY){var tg=tY-tD.angle;tD.anglePrev+=tg;for(var tT=0;tT<tD.parts.length;tT++){var tr=tD.parts[tT];tr.angle+=tg,tO.rotate(tr.vertices,tg,tD.position),t$.rotate(tr.axes,tg),tN.update(tr.bounds,tr.vertices,tD.velocity),0<tT&&tC.rotateAbout(tr.position,tg,tD.position,tr.position)}},tE.setVelocity=function(tD,tY){tD.positionPrev.x=tD.position.x-tY.x,tD.positionPrev.y=tD.position.y-tY.y,tD.velocity.x=tY.x,tD.velocity.y=tY.y,tD.speed=tC.magnitude(tD.velocity)},tE.setAngularVelocity=function(tD,tY){tD.anglePrev=tD.angle-tY,tD.angularVelocity=tY,tD.angularSpeed=Math.abs(tD.angularVelocity)},tE.translate=function(tD,tY){tE.setPosition(tD,tC.add(tD.position,tY))},tE.rotate=function(tD,tY,tg){if(tg){var tT=Math.cos(tY),tr=Math.sin(tY),ts=tD.position.x-tg.x,ta=tD.position.y-tg.y;tE.setPosition(tD,{x:tg.x+(ts*tT-ta*tr),y:tg.y+(ts*tr+ta*tT)}),tE.setAngle(tD,tD.angle+tY)}else tE.setAngle(tD,tD.angle+tY)},tE.scale=function(tD,tY,tg,tT){var tr=0,ts=0;tT=tT||tD.position;for(var ta=0;ta<tD.parts.length;ta++){var tW=tD.parts[ta];tO.scale(tW.vertices,tY,tg,tT),tW.axes=t$.fromVertices(tW.vertices),tW.area=tO.area(tW.vertices),tE.setMass(tW,tD.density*tW.area),tO.translate(tW.vertices,{x:-tW.position.x,y:-tW.position.y}),tE.setInertia(tW,tE._inertiaScale*tO.inertia(tW.vertices,tW.mass)),tO.translate(tW.vertices,{x:tW.position.x,y:tW.position.y}),0<ta&&(tr+=tW.area,ts+=tW.inertia),tW.position.x=tT.x+(tW.position.x-tT.x)*tY,tW.position.y=tT.y+(tW.position.y-tT.y)*tg,tN.update(tW.bounds,tW.vertices,tD.velocity)}1<tD.parts.length&&(tD.area=tr,tD.isStatic||(tE.setMass(tD,tD.density*tr),tE.setInertia(tD,ts))),tD.circleRadius&&(tY===tg?tD.circleRadius*=tY:tD.circleRadius=null)},tE.update=function(tD,tY,tg,tT){var tr=Math.pow(tY*tg*tD.timeScale,2),ts=1-tD.frictionAir*tg*tD.timeScale,ta=tD.position.x-tD.positionPrev.x,tW=tD.position.y-tD.positionPrev.y,tM=tD.positionRc;tM.ppx=tD.position.x,tM.ppy=tD.position.y,tD.velocity.x=ta*ts*tT+tD.force.x/tD.mass*tr,tD.velocity.y=tW*ts*tT+tD.force.y/tD.mass*tr,tD.positionPrev.x=tD.position.x,tD.positionPrev.y=tD.position.y,tD.position.x+=tD.velocity.x,tD.position.y+=tD.velocity.y,tM.cpx=tD.position.x,tM.cpy=tD.position.y,tD.angularVelocity=(tD.angle-tD.anglePrev)*ts*tT+tD.torque/tD.inertia*tr,tD.anglePrev=tD.angle,tD.angle+=tD.angularVelocity,tD.speed=tC.magnitude(tD.velocity),tD.angularSpeed=Math.abs(tD.angularVelocity);for(var tE=0;tE<tD.parts.length;tE++){var tI=tD.parts[tE];tO.translate(tI.vertices,tD.velocity),0<tE&&(tI.position.x+=tD.velocity.x,tI.position.y+=tD.velocity.y),0!==tD.angularVelocity&&(tO.rotate(tI.vertices,tD.angularVelocity,tD.position),t$.rotate(tI.axes,tD.angularVelocity),0<tE&&tC.rotateAbout(tI.position,tD.angularVelocity,tD.position,tI.position)),tN.update(tI.bounds,tI.vertices,tD.velocity)}},tE.applyForce=function(tD,tY,tg){tD.force.x+=tg.x,tD.force.y+=tg.y;var tT=tY.x-tD.position.x,tr=tY.y-tD.position.y;tD.torque+=tT*tg.y-tr*tg.x},tE._totalProperties=function(tD){for(var tY={mass:0,area:0,inertia:0,centre:{x:0,y:0}},tg=1===tD.parts.length?0:1;tg<tD.parts.length;tg++){var tT=tD.parts[tg],tr=tT.mass!==1/0?tT.mass:1;tY.mass+=tr,tY.area+=tT.area,tY.inertia+=tT.inertia,tY.centre=tC.add(tY.centre,tC.mult(tT.position,tr))}return tY.centre=tC.div(tY.centre,tY.mass),tY}}()},function(tD,tY,tg){var tI={};tD.exports=tI;var tT=tg(4);tI._motionWakeThreshold=.18,tI._motionSleepThreshold=.08,tI._minBias=.9,tI.update=function(tD,tY){for(var tg=tY*tY*tY,tT=0;tT<tD.length;tT++){var tr=tD[tT],ts=tr.speed*tr.speed+tr.angularSpeed*tr.angularSpeed;if(0===tr.force.x&&0===tr.force.y){var ta=Math.min(tr.motion,ts),tW=Math.max(tr.motion,ts);tr.motion=tI._minBias*ta+(1-tI._minBias)*tW,0<tr.sleepThreshold&&tr.motion<tI._motionSleepThreshold*tg?(tr.sleepCounter+=1,tr.sleepCounter>=tr.sleepThreshold&&tI.set(tr,!0)):0<tr.sleepCounter&&(tr.sleepCounter-=1)}else tI.set(tr,!1)}},tI.afterCollisions=function(tD,tY){for(var tg=tY*tY*tY,tT=0;tT<tD.length;tT++){var tr=tD[tT];if(tr.isActive){var ts=tr.collision,ta=ts.bodyA.parent,tW=ts.bodyB.parent;if(!(ta.isSleeping&&tW.isSleeping||ta.isStatic||tW.isStatic)&&(ta.isSleeping||tW.isSleeping)){var tM=ta.isSleeping&&!ta.isStatic?ta:tW,tE=tM===ta?tW:ta;!tM.isStatic&&tE.motion>tI._motionWakeThreshold*tg&&tI.set(tM,!1)}}}},tI.set=function(tD,tY){var tg=tD.isSleeping;tY?(tD.isSleeping=!0,tD.sleepCounter=tD.sleepThreshold,tD.positionImpulse.x=0,tD.positionImpulse.y=0,tD.positionPrev.x=tD.position.x,tD.positionPrev.y=tD.position.y,tD.anglePrev=tD.angle,tD.speed=0,tD.angularSpeed=0,tD.motion=0,tg||tT.trigger(tD,"sleepStart")):(tD.isSleeping=!1,tD.sleepCounter=0,tg&&tT.trigger(tD,"sleepEnd"))}},function(tD,tY,tg){var t$={};tD.exports=t$;var tJ,td,tx,tj=tg(3),tZ=tg(9);tJ=[],td={overlap:0,axis:null},tx={overlap:0,axis:null},t$.create=function(tD,tY){return{pair:null,collided:!1,bodyA:tD,bodyB:tY,parentA:tD.parent,parentB:tY.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},t$.collides=function(tD,tY,tg){if(t$._overlapAxes(td,tD.vertices,tY.vertices,tD.axes),td.overlap<=0)return null;if(t$._overlapAxes(tx,tY.vertices,tD.vertices,tY.axes),tx.overlap<=0)return null;var tT,tr,ts=tg&&tg.table[tZ.id(tD,tY)];ts?tT=ts.collision:((tT=t$.create(tD,tY)).collided=!0,tT.bodyA=tD.id<tY.id?tD:tY,tT.bodyB=tD.id<tY.id?tY:tD,tT.parentA=tT.bodyA.parent,tT.parentB=tT.bodyB.parent),tD=tT.bodyA,tY=tT.bodyB,tr=td.overlap<tx.overlap?td:tx;var ta=tT.normal,tW=tT.supports,tM=tr.axis,tE=tM.x,tI=tM.y;tE*(tY.position.x-tD.position.x)+tI*(tY.position.y-tD.position.y)<0?(ta.x=tE,ta.y=tI):(ta.x=-tE,ta.y=-tI),tT.tangent.x=-ta.y,tT.tangent.y=ta.x,tT.depth=tr.overlap,tT.penetration.x=ta.x*tT.depth,tT.penetration.y=ta.y*tT.depth;var tO=t$._findSupports(tD,tY,ta,1),tC=0;if(tj.contains(tD.vertices,tO[0])&&(tW[tC++]=tO[0]),tj.contains(tD.vertices,tO[1])&&(tW[tC++]=tO[1]),tC<2){var tN=t$._findSupports(tY,tD,ta,-1);tj.contains(tY.vertices,tN[0])&&(tW[tC++]=tN[0]),tC<2&&tj.contains(tY.vertices,tN[1])&&(tW[tC++]=tN[1])}return 0===tC&&(tW[tC++]=tO[0]),tW.length=tC,tT},t$._overlapAxes=function(tD,tY,tg,tT){var tr,ts,ta,tW,tM,tE,tI=tY.length,tO=tg.length,tC=tY[0].x,tN=tY[0].y,t$=tg[0].x,td=tg[0].y,tJ=tT.length,tx=Number.MAX_VALUE,tj=0;for(tM=0;tM<tJ;tM++){var tZ=tT[tM],tp=tZ.x,tl=tZ.y,tt=tC*tp+tN*tl,t_=t$*tp+td*tl,tA=tt,tq=t_;for(tE=1;tE<tI;tE+=1)tA<(tW=tY[tE].x*tp+tY[tE].y*tl)?tA=tW:tW<tt&&(tt=tW);for(tE=1;tE<tO;tE+=1)tq<(tW=tg[tE].x*tp+tg[tE].y*tl)?tq=tW:tW<t_&&(t_=tW);if((tr=(ts=tA-t_)<(ta=tq-tt)?ts:ta)<tx&&(tj=tM,(tx=tr)<=0))break}tD.axis=tT[tj],tD.overlap=tx},t$._projectToAxis=function(tD,tY,tg){for(var tT=tY[0].x*tg.x+tY[0].y*tg.y,tr=tT,ts=1;ts<tY.length;ts+=1){var ta=tY[ts].x*tg.x+tY[ts].y*tg.y;tr<ta?tr=ta:ta<tT&&(tT=ta)}tD.min=tT,tD.max=tr},t$._findSupports=function(tD,tY,tg,tT){var tr,ts,ta,tW,tM,tE=tY.vertices,tI=tE.length,tO=tD.position.x,tC=tD.position.y,tN=tg.x*tT,t$=tg.y*tT,td=Number.MAX_VALUE;for(tM=0;tM<tI;tM+=1)(tW=tN*(tO-(ts=tE[tM]).x)+t$*(tC-ts.y))<td&&(td=tW,tr=ts);return td=tN*(tO-(ta=tE[(tI+tr.index-1)%tI]).x)+t$*(tC-ta.y),tN*(tO-(ts=tE[(tr.index+1)%tI]).x)+t$*(tC-ts.y)<td?(tJ[0]=tr,tJ[1]=ts):(tJ[0]=tr,tJ[1]=ta),tJ}},function(tD,tY,tg){var ts={};tD.exports=ts;var tN=tg(17);ts.create=function(tD,tY){var tg=tD.bodyA,tT=tD.bodyB,tr={id:ts.id(tg,tT),bodyA:tg,bodyB:tT,collision:tD,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:tg.isSensor||tT.isSensor,timeCreated:tY,timeUpdated:tY,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return ts.update(tr,tD,tY),tr},ts.update=function(tD,tY,tg){var tT=tD.contacts,tr=tY.supports,ts=tD.activeContacts,ta=tY.parentA,tW=tY.parentB,tM=ta.vertices.length;tD.isActive=!0,tD.timeUpdated=tg,tD.collision=tY,tD.separation=tY.depth,tD.inverseMass=ta.inverseMass+tW.inverseMass,tD.friction=ta.friction<tW.friction?ta.friction:tW.friction,tD.frictionStatic=ta.frictionStatic>tW.frictionStatic?ta.frictionStatic:tW.frictionStatic,tD.restitution=ta.restitution>tW.restitution?ta.restitution:tW.restitution,tD.slop=ta.slop>tW.slop?ta.slop:tW.slop,tY.pair=tD;for(var tE=ts.length=0;tE<tr.length;tE++){var tI=tr[tE],tO=tI.body===ta?tI.index:tM+tI.index,tC=tT[tO];tC?ts.push(tC):ts.push(tT[tO]=tN.create(tI))}},ts.setActive=function(tD,tY,tg){tY?(tD.isActive=!0,tD.timeUpdated=tg):(tD.isActive=!1,tD.activeContacts.length=0)},ts.id=function(tD,tY){return tD.id<tY.id?"A"+tD.id+"B"+tY.id:"A"+tY.id+"B"+tD.id}},function(tD,tY,tg){var tl={};tD.exports=tl;var ta=tg(3),tt=tg(2),tW=tg(7),tM=tg(1),tE=tg(11),tI=tg(0);tl._warming=.4,tl._torqueDampen=1,tl._minLength=1e-6,tl.create=function(tD){var tY=tD;tY.bodyA&&!tY.pointA&&(tY.pointA={x:0,y:0}),tY.bodyB&&!tY.pointB&&(tY.pointB={x:0,y:0});var tg=tY.bodyA?tt.add(tY.bodyA.position,tY.pointA):tY.pointA,tT=tY.bodyB?tt.add(tY.bodyB.position,tY.pointB):tY.pointB,tr=tt.magnitude(tt.sub(tg,tT));tY.length=void 0!==tY.length?tY.length:tr,tY.id=tY.id||tI.nextId(),tY.label=tY.label||"Constraint",tY.type="constraint",tY.stiffness=tY.stiffness||(0<tY.length?1:.7),tY.damping=tY.damping||0,tY.angularStiffness=tY.angularStiffness||0,tY.angleA=tY.bodyA?tY.bodyA.angle:tY.angleA,tY.angleB=tY.bodyB?tY.bodyB.angle:tY.angleB,tY.plugin={};var ts={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===tY.length&&.1<tY.stiffness?(ts.type="pin",ts.anchors=!1):tY.stiffness<.9&&(ts.type="spring"),tY.render=tI.extend(ts,tY.render),tY},tl.preSolveAll=function(tD){for(var tY=0;tY<tD.length;tY+=1){var tg=tD[tY],tT=tg.constraintImpulse;tg.isStatic||0===tT.x&&0===tT.y&&0===tT.angle||(tg.position.x+=tT.x,tg.position.y+=tT.y,tg.angle+=tT.angle)}},tl.solveAll=function(tD,tY){for(var tg=0;tg<tD.length;tg+=1){var tT=tD[tg],tr=!tT.bodyA||tT.bodyA&&tT.bodyA.isStatic,ts=!tT.bodyB||tT.bodyB&&tT.bodyB.isStatic;(tr||ts)&&tl.solve(tD[tg],tY)}for(tg=0;tg<tD.length;tg+=1)tr=!(tT=tD[tg]).bodyA||tT.bodyA&&tT.bodyA.isStatic,ts=!tT.bodyB||tT.bodyB&&tT.bodyB.isStatic,tr||ts||tl.solve(tD[tg],tY)},tl.solve=function(tD,tY){var tg=tD.bodyA,tT=tD.bodyB,tr=tD.pointA,ts=tD.pointB;if(tg||tT){tg&&!tg.isStatic&&(tt.rotate(tr,tg.angle-tD.angleA,tr),tD.angleA=tg.angle),tT&&!tT.isStatic&&(tt.rotate(ts,tT.angle-tD.angleB,ts),tD.angleB=tT.angle);var ta=tr,tW=ts;if(tg&&(ta=tt.add(tg.position,tr)),tT&&(tW=tt.add(tT.position,ts)),ta&&tW){var tM=tt.sub(ta,tW),tE=tt.magnitude(tM);tE<tl._minLength&&(tE=tl._minLength);var tI,tO,tC,tN,t$,td=(tE-tD.length)/tE,tJ=tD.stiffness<1?tD.stiffness*tY:tD.stiffness,tx=tt.mult(tM,td*tJ),tj=(tg?tg.inverseMass:0)+(tT?tT.inverseMass:0),tZ=tj+((tg?tg.inverseInertia:0)+(tT?tT.inverseInertia:0));if(tD.damping){var tp=tt.create();tC=tt.div(tM,tE),t$=tt.sub(tT&&tt.sub(tT.position,tT.positionPrev)||tp,tg&&tt.sub(tg.position,tg.positionPrev)||tp),tN=tt.dot(tC,t$)}tg&&!tg.isStatic&&(tO=tg.inverseMass/tj,tg.constraintImpulse.x-=tx.x*tO,tg.constraintImpulse.y-=tx.y*tO,tg.position.x-=tx.x*tO,tg.position.y-=tx.y*tO,tD.damping&&(tg.positionPrev.x-=tD.damping*tC.x*tN*tO,tg.positionPrev.y-=tD.damping*tC.y*tN*tO),tI=tt.cross(tr,tx)/tZ*tl._torqueDampen*tg.inverseInertia*(1-tD.angularStiffness),tg.constraintImpulse.angle-=tI,tg.angle-=tI),tT&&!tT.isStatic&&(tO=tT.inverseMass/tj,tT.constraintImpulse.x+=tx.x*tO,tT.constraintImpulse.y+=tx.y*tO,tT.position.x+=tx.x*tO,tT.position.y+=tx.y*tO,tD.damping&&(tT.positionPrev.x+=tD.damping*tC.x*tN*tO,tT.positionPrev.y+=tD.damping*tC.y*tN*tO),tI=tt.cross(ts,tx)/tZ*tl._torqueDampen*tT.inverseInertia*(1-tD.angularStiffness),tT.constraintImpulse.angle+=tI,tT.angle+=tI)}}},tl.postSolveAll=function(tD){for(var tY=0;tY<tD.length;tY++){var tg=tD[tY],tT=tg.constraintImpulse;if(!(tg.isStatic||0===tT.x&&0===tT.y&&0===tT.angle)){tW.set(tg,!1);for(var tr=0;tr<tg.parts.length;tr++){var ts=tg.parts[tr];ta.translate(ts.vertices,tT),0<tr&&(ts.position.x+=tT.x,ts.position.y+=tT.y),0!==tT.angle&&(ta.rotate(ts.vertices,tT.angle,tg.position),tE.rotate(ts.axes,tT.angle),0<tr&&tt.rotateAbout(ts.position,tT.angle,tg.position,ts.position)),tM.update(ts.bounds,ts.vertices,tg.velocity)}tT.angle*=tl._warming,tT.x*=tl._warming,tT.y*=tl._warming}}},tl.pointAWorld=function(tD){return{x:(tD.bodyA?tD.bodyA.position.x:0)+tD.pointA.x,y:(tD.bodyA?tD.bodyA.position.y:0)+tD.pointA.y}},tl.pointBWorld=function(tD){return{x:(tD.bodyB?tD.bodyB.position.x:0)+tD.pointB.x,y:(tD.bodyB?tD.bodyB.position.y:0)+tD.pointB.y}}},function(tD,tY,tg){var tT={};tD.exports=tT;var ta=tg(2),tW=tg(0);tT.fromVertices=function(tD){for(var tY={},tg=0;tg<tD.length;tg++){var tT=(tg+1)%tD.length,tr=ta.normalise({x:tD[tT].y-tD[tg].y,y:tD[tg].x-tD[tT].x}),ts=0===tr.y?1/0:tr.x/tr.y;tY[ts=ts.toFixed(3).toString()]=tr}return tW.values(tY)},tT.rotate=function(tD,tY){if(0!==tY)for(var tg=Math.cos(tY),tT=Math.sin(tY),tr=0;tr<tD.length;tr++){var ts,ta=tD[tr];ts=ta.x*tg-ta.y*tT,ta.y=ta.x*tT+ta.y*tg,ta.x=ts}}},function(tD,tY,tg){var t$={};tD.exports=t$;var tX=tg(3),tz=tg(0),tm=tg(6),th=tg(1),ti=tg(2);t$.rectangle=function(tD,tY,tg,tT,tr){tr=tr||{};var ts={label:"Rectangle Body",position:{x:tD,y:tY},vertices:tX.fromPath("L 0 0 L "+tg+" 0 L "+tg+" "+tT+" L 0 "+tT)};if(tr.chamfer){var ta=tr.chamfer;ts.vertices=tX.chamfer(ts.vertices,ta.radius,ta.quality,ta.qualityMin,ta.qualityMax),delete tr.chamfer}return tm.create(tz.extend({},ts,tr))},t$.trapezoid=function(tD,tY,tg,tT,tr,ts){ts=ts||{};var ta,tW=tg*(tr*=.5),tM=tW+(1-2*tr)*tg,tE=tM+tW;ta=tr<.5?"L 0 0 L "+tW+" "+-tT+" L "+tM+" "+-tT+" L "+tE+" 0":"L 0 0 L "+tM+" "+-tT+" L "+tE+" 0";var tI={label:"Trapezoid Body",position:{x:tD,y:tY},vertices:tX.fromPath(ta)};if(ts.chamfer){var tO=ts.chamfer;tI.vertices=tX.chamfer(tI.vertices,tO.radius,tO.quality,tO.qualityMin,tO.qualityMax),delete ts.chamfer}return tm.create(tz.extend({},tI,ts))},t$.circle=function(tD,tY,tg,tT,tr){tT=tT||{};var ts={label:"Circle Body",circleRadius:tg};tr=tr||25;var ta=Math.ceil(Math.max(10,Math.min(tr,tg)));return ta%2==1&&(ta+=1),t$.polygon(tD,tY,ta,tg,tz.extend({},ts,tT))},t$.polygon=function(tD,tY,tg,tT,tr){if(tr=tr||{},tg<3)return t$.circle(tD,tY,tT,tr);for(var ts=2*Math.PI/tg,ta="",tW=.5*ts,tM=0;tM<tg;tM+=1){var tE=tW+tM*ts,tI=Math.cos(tE)*tT,tO=Math.sin(tE)*tT;ta+="L "+tI.toFixed(3)+" "+tO.toFixed(3)+" "}var tC={label:"Polygon Body",position:{x:tD,y:tY},vertices:tX.fromPath(ta)};if(tr.chamfer){var tN=tr.chamfer;tC.vertices=tX.chamfer(tC.vertices,tN.radius,tN.quality,tN.qualityMin,tN.qualityMax),delete tr.chamfer}return tm.create(tz.extend({},tC,tr))},t$.fromVertices=function(tD,tY,tg,tT,tr,ts,ta,tW){var tM,tE,tI,tO,tC,tN,t$,td,tJ,tx,tj=tz.getDecomp();for(tM=Boolean(tj&&tj.quickDecomp),tT=tT||{},tI=[],tr=void 0!==tr&&tr,ts=void 0!==ts?ts:.01,ta=void 0!==ta?ta:10,tW=void 0!==tW?tW:.01,tz.isArray(tg[0])||(tg=[tg]),tJ=0;tJ<tg.length;tJ+=1)if(tC=tg[tJ],!(tO=tX.isConvex(tC))&&!tM&&tz.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),tO||!tM)tC=tO?tX.clockwiseSort(tC):tX.hull(tC),tI.push({position:{x:tD,y:tY},vertices:tC});else{var tZ=tC.map(function(tD){return[tD.x,tD.y]});tj.makeCCW(tZ),!1!==ts&&tj.removeCollinearPoints(tZ,ts),!1!==tW&&tj.removeDuplicatePoints&&tj.removeDuplicatePoints(tZ,tW);var tp=tj.quickDecomp(tZ);for(tN=0;tN<tp.length;tN++){var tl=tp[tN].map(function(tD){return{x:tD[0],y:tD[1]}});0<ta&&tX.area(tl)<ta||tI.push({position:tX.centre(tl),vertices:tl})}}for(tN=0;tN<tI.length;tN++)tI[tN]=tm.create(tz.extend(tI[tN],tT));if(tr)for(tN=0;tN<tI.length;tN++){var tt=tI[tN];for(t$=tN+1;t$<tI.length;t$++){var t_=tI[t$];if(th.overlaps(tt.bounds,t_.bounds)){var tA=tt.vertices,tq=t_.vertices;for(td=0;td<tt.vertices.length;td++)for(tx=0;tx<t_.vertices.length;tx++){var tb=ti.magnitudeSquared(ti.sub(tA[(td+1)%tA.length],tq[tx])),tG=ti.magnitudeSquared(ti.sub(tA[td],tq[(tx+1)%tq.length]));tb<5&&tG<5&&(tA[td].isInternal=!0,tq[tx].isInternal=!0)}}}}return 1<tI.length?(tE=tm.create(tz.extend({parts:tI.slice(0)},tT)),tm.setPosition(tE,{x:tD,y:tY}),tE):tI[0]}},function(tD,tY,tg){var tT={};tD.exports=tT;var tr=tg(0);tT.create=function(tD){var tg={};return tD||tr.log("Mouse.create: element was undefined, defaulting to document.body","warn"),tg.element=tD||document.body,tg.absolute={x:0,y:0},tg.position={x:0,y:0},tg.mousedownPosition={x:0,y:0},tg.mouseupPosition={x:0,y:0},tg.mouseoutPosition={x:0,y:0},tg.offset={x:0,y:0},tg.scale={x:1,y:1},tg.wheelDelta=0,tg.button=-1,tg.pixelRatio=parseInt(tg.element.getAttribute("data-pixel-ratio"),10)||1,tg.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mouseout:null,mousewheel:null},tg.mousemove=function(tD){var tY=tT._getRelativeMousePosition(tD,tg.element,tg.pixelRatio);tD.changedTouches&&(tg.button=0,tD.preventDefault()),tg.absolute.x=tY.x,tg.absolute.y=tY.y,tg.position.x=tg.absolute.x*tg.scale.x+tg.offset.x,tg.position.y=tg.absolute.y*tg.scale.y+tg.offset.y,tg.sourceEvents.mousemove=tD},tg.mousedown=function(tD){var tY=tT._getRelativeMousePosition(tD,tg.element,tg.pixelRatio);tD.changedTouches?(tg.button=0,tD.preventDefault()):tg.button=tD.button,tg.absolute.x=tY.x,tg.absolute.y=tY.y,tg.position.x=tg.absolute.x*tg.scale.x+tg.offset.x,tg.position.y=tg.absolute.y*tg.scale.y+tg.offset.y,tg.mousedownPosition.x=tg.position.x,tg.mousedownPosition.y=tg.position.y,tg.sourceEvents.mousedown=tD},tg.mouseup=function(tD){var tY=tT._getRelativeMousePosition(tD,tg.element,tg.pixelRatio);tD.changedTouches&&tD.preventDefault(),tg.button=-1,tg.absolute.x=tY.x,tg.absolute.y=tY.y,tg.position.x=tg.absolute.x*tg.scale.x+tg.offset.x,tg.position.y=tg.absolute.y*tg.scale.y+tg.offset.y,tg.mouseupPosition.x=tg.position.x,tg.mouseupPosition.y=tg.position.y,tg.sourceEvents.mouseup=tD},tg.mouseout=function(tD){var tY=tT._getRelativeMousePosition(tD,tg.element,tg.pixelRatio);tD.changedTouches&&tD.preventDefault(),tg.button=-1,tg.absolute.x=tY.x,tg.absolute.y=tY.y,tg.position.x=tg.absolute.x*tg.scale.x+tg.offset.x,tg.position.y=tg.absolute.y*tg.scale.y+tg.offset.y,tg.mouseoutPosition.x=tg.position.x,tg.mouseoutPosition.y=tg.position.y,tg.sourceEvents.mouseout=tD},tg.mousewheel=function(tD){tg.wheelDelta=Math.max(-1,Math.min(1,tD.wheelDelta||-tD.detail)),tD.preventDefault()},tT.setElement(tg,tg.element),tg},tT.setElement=function(tD,tY){(tD.element=tY).addEventListener("mousemove",tD.mousemove),tY.addEventListener("mousedown",tD.mousedown),tY.addEventListener("mouseup",tD.mouseup),tY.addEventListener("mouseout",tD.mouseout),tY.addEventListener("mousewheel",tD.mousewheel),tY.addEventListener("DOMMouseScroll",tD.mousewheel),tY.addEventListener("touchmove",tD.mousemove),tY.addEventListener("touchstart",tD.mousedown),tY.addEventListener("touchend",tD.mouseup),tY.addEventListener("touchcancel",tD.mouseup)},tT.clearSourceEvents=function(tD){tD.sourceEvents.mousemove=null,tD.sourceEvents.mousedown=null,tD.sourceEvents.mouseup=null,tD.sourceEvents.mouseout=null,tD.sourceEvents.mousewheel=null,tD.wheelDelta=0},tT.setOffset=function(tD,tY){tD.offset.x=tY.x,tD.offset.y=tY.y,tD.position.x=tD.absolute.x*tD.scale.x+tD.offset.x,tD.position.y=tD.absolute.y*tD.scale.y+tD.offset.y},tT.setScale=function(tD,tY){tD.scale.x=tY.x,tD.scale.y=tY.y,tD.position.x=tD.absolute.x*tD.scale.x+tD.offset.x,tD.position.y=tD.absolute.y*tD.scale.y+tD.offset.y},tT._getRelativeMousePosition=function(tD,tY,tg){var tT,tr,ts=tY.getBoundingClientRect(),ta=document.documentElement||document.body.parentNode||document.body,tW=void 0!==window.pageXOffset?window.pageXOffset:ta.scrollLeft,tM=void 0!==window.pageYOffset?window.pageYOffset:ta.scrollTop,tE=tD.changedTouches;tW=tW||0,tM=tM||0,tr=tE?(tT=tE[0].pageX-ts.left-tW,tE[0].pageY-ts.top-tM):(tT=tD.pageX-ts.left-tW,tD.pageY-ts.top-tM);var tI=tY.clientWidth||tY.width,tO=tY.clientHeight||tY.height;return{x:tT/(tI/(tY.width||tI)*tg),y:tr/(tO/(tY.height||tO)*tg)}}},function(tD,tY,tg){var tb={};tD.exports=tb;var tT=tg(0),tG=tg(8),tI=tg(2);tb.create=function(tD){return tT.extend({bodies:[],pairs:null},tD)},tb.setBodies=function(tD,tY){tD.bodies=tY.slice(0)},tb.clear=function(tD){tD.bodies=[]},tb.collisions=function(tD){var tY,tg,tT=[],tr=tD.pairs,ts=tD.bodies,ta=ts.length,tW=tb.canCollide,tM=tG.collides;for(ts.sort(tb._compareBoundsX),tY=0;tY<ta;tY++){var tE=ts[tY],tI=tE.bounds,tO=tE.bounds.max.x,tC=tE.bounds.max.y,tN=tE.bounds.min.y,t$=tE.isStatic||tE.isSleeping,td=tE.parts.length,tJ=1===td;for(tg=tY+1;tg<ta;tg++){var tx=ts[tg];if((tq=tx.bounds).min.x>tO)break;if(!(tC<tq.min.y||tN>tq.max.y)&&(!t$||!tx.isStatic&&!tx.isSleeping)&&tW(tE.collisionFilter,tx.collisionFilter)){var tj=tx.parts.length;if(tJ&&1===tj)(t_=tM(tE,tx,tr))&&tT.push(t_);else for(var tZ=1<tj?1:0,tp=1<td?1:0;tp<td;tp++)for(var tl=tE.parts[tp],tt=(tI=tl.bounds,tZ);tt<tj;tt++){var t_,tA=tx.parts[tt],tq=tA.bounds;tI.min.x>tq.max.x||tI.max.x<tq.min.x||tI.max.y<tq.min.y||tI.min.y>tq.max.y||(t_=tM(tl,tA,tr))&&tT.push(t_)}}}}return tT},tb.canCollide=function(tD,tY){return tD.group===tY.group&&0!==tD.group?0<tD.group:0!=(tD.mask&tY.category)&&0!=(tY.mask&tD.category)},tb._compareBoundsX=function(tD,tY){return tD.bounds.min.x-tY.bounds.min.x},tb.worldBoundsLimit=function(tD,tY){if(tD.worldBounds&&(tD.bounds.max.x<tD.worldBounds.min.x||tD.bounds.min.x>tD.worldBounds.max.x||tD.bounds.max.y<tD.worldBounds.min.y||tD.bounds.min.y>tD.worldBounds.max.y)){var tg=tI.dot(tD.velocity,tY.collision.normal),tT=tI.sub(tD.velocity,tI.mult(tY.collision.normal,tg)),tr=tg*(tD.restitution-1),ts=tI.add(tI.mult(tY.collision.normal,tr),tT),ta=tD.position.x-tD.bounds.min.x,tW=tD.bounds.max.x-tD.position.x,tM=tD.position.y-tD.bounds.min.y,tE=tD.bounds.max.y-tD.position.y;ts.x=ts.x<tD.worldBounds.min.x+ta?tD.worldBounds.min.x+ta+100:ts.x>tD.worldBounds.max.x-tW?tD.worldBounds.max.x-tW-100:ts.x,ts.y=ts.y<tD.worldBounds.min.y+tM?tD.worldBounds.min.y+tM+100:ts.y>tD.worldBounds.max.y-tE?tD.worldBounds.max.y-tE-100:ts.y,Body.translate(tD,{x:ts.x,y:ts.y})}}},function(tD,tY,tg){var tW={};tD.exports=tW;var tM=tg(0);tW._registry={},tW.register=function(tD){if(tW.isPlugin(tD)||tM.warn("Plugin.register:",tW.toString(tD),"does not implement all required fields."),tD.name in tW._registry){var tY=tW._registry[tD.name],tg=tW.versionParse(tD.version).number,tT=tW.versionParse(tY.version).number;tT<tg?(tM.warn("Plugin.register:",tW.toString(tY),"was upgraded to",tW.toString(tD)),tW._registry[tD.name]=tD):tg<tT?tM.warn("Plugin.register:",tW.toString(tY),"can not be downgraded to",tW.toString(tD)):tD!==tY&&tM.warn("Plugin.register:",tW.toString(tD),"is already registered to different plugin object")}else tW._registry[tD.name]=tD;return tD},tW.resolve=function(tD){return tW._registry[tW.dependencyParse(tD).name]},tW.toString=function(tD){return"string"==typeof tD?tD:(tD.name||"anonymous")+"@"+(tD.version||tD.range||"0.0.0")},tW.isPlugin=function(tD){return tD&&tD.name&&tD.version&&tD.install},tW.isUsed=function(tD,tY){return-1<tD.used.indexOf(tY)},tW.isFor=function(tD,tY){var tg=tD.for&&tW.dependencyParse(tD.for);return!tD.for||tY.name===tg.name&&tW.versionSatisfies(tY.version,tg.range)},tW.use=function(tD,tY){if(tD.uses=(tD.uses||[]).concat(tY||[]),0!==tD.uses.length){for(var tg=tW.dependencies(tD),tT=tM.topologicalSort(tg),tr=[],ts=0;ts<tT.length;ts+=1)if(tT[ts]!==tD.name){var ta=tW.resolve(tT[ts]);ta?tW.isUsed(tD,ta.name)||(tW.isFor(ta,tD)||(tM.warn("Plugin.use:",tW.toString(ta),"is for",ta.for,"but installed on",tW.toString(tD)+"."),ta._warned=!0),ta.install?ta.install(tD):(tM.warn("Plugin.use:",tW.toString(ta),"does not specify an install function."),ta._warned=!0),ta._warned?(tr.push("🔶 "+tW.toString(ta)),delete ta._warned):tr.push("✅ "+tW.toString(ta)),tD.used.push(ta.name)):tr.push("❌ "+tT[ts])}0<tr.length&&tM.info(tr.join("  "))}else tM.warn("Plugin.use:",tW.toString(tD),"does not specify any dependencies to install.")},tW.dependencies=function(tT,tD){var tr=tW.dependencyParse(tT),tY=tr.name;if(!(tY in(tD=tD||{}))){tT=tW.resolve(tT)||tT,tD[tY]=tM.map(tT.uses||[],function(tD){tW.isPlugin(tD)&&tW.register(tD);var tY=tW.dependencyParse(tD),tg=tW.resolve(tD);return tg&&!tW.versionSatisfies(tg.version,tY.range)?(tM.warn("Plugin.dependencies:",tW.toString(tg),"does not satisfy",tW.toString(tY),"used by",tW.toString(tr)+"."),tg._warned=!0,tT._warned=!0):tg||(tM.warn("Plugin.dependencies:",tW.toString(tD),"used by",tW.toString(tr),"could not be resolved."),tT._warned=!0),tY.name});for(var tg=0;tg<tD[tY].length;tg+=1)tW.dependencies(tD[tY][tg],tD);return tD}},tW.dependencyParse=function(tD){return tM.isString(tD)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(tD)||tM.warn("Plugin.dependencyParse:",tD,"is not a valid dependency string."),{name:tD.split("@")[0],range:tD.split("@")[1]||"*"}):{name:tD.name,range:tD.range||tD.version}},tW.versionParse=function(tD){var tY=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;tY.test(tD)||tM.warn("Plugin.versionParse:",tD,"is not a valid version or range.");var tg=tY.exec(tD),tT=Number(tg[4]),tr=Number(tg[5]),ts=Number(tg[6]);return{isRange:Boolean(tg[1]||tg[2]),version:tg[3],range:tD,operator:tg[1]||tg[2]||"",major:tT,minor:tr,patch:ts,parts:[tT,tr,ts],prerelease:tg[7],number:1e8*tT+1e4*tr+ts}},tW.versionSatisfies=function(tD,tY){tY=tY||"*";var tg=tW.versionParse(tY),tT=tW.versionParse(tD);if(tg.isRange){if("*"===tg.operator||"*"===tD)return!0;if(">"===tg.operator)return tT.number>tg.number;if(">="===tg.operator)return tT.number>=tg.number;if("~"===tg.operator)return tT.major===tg.major&&tT.minor===tg.minor&&tT.patch>=tg.patch;if("^"===tg.operator)return 0<tg.major?tT.major===tg.major&&tT.number>=tg.number:0<tg.minor?tT.minor===tg.minor&&tT.patch>=tg.patch:tT.patch===tg.patch}return tD===tY||"*"===tD}},function(tD,tY,tg){var t_={};tD.exports=t_;var tA=tg(0),tq=tg(5),tb=tg(1),tG=tg(4),tX=tg(2),tz=tg(13);!function(){t_._goodFps=30,t_._goodDelta=1e3/60,t_.create=function(tD){var tY={controller:t_,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!tD.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},tg=tA.extend(tY,tD);return tg.canvas&&(tg.canvas.width=tg.options.width||tg.canvas.width,tg.canvas.height=tg.options.height||tg.canvas.height),tg.mouse=tD.mouse,tg.engine=tD.engine,tg.canvas=tg.canvas||tT(tg.options.width,tg.options.height),tg.context=tg.canvas.getContext("2d"),tg.textures={},tg.bounds=tg.bounds||{min:{x:0,y:0},max:{x:tg.canvas.width,y:tg.canvas.height}},tg.options.showBroadphase=!1,1!==tg.options.pixelRatio&&t_.setPixelRatio(tg,tg.options.pixelRatio),tA.isElement(tg.element)?tg.element.appendChild(tg.canvas):tg.canvas.parentNode||tA.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),tg},t_.run=function(tD){Laya.timer.clear(this,t_.loop),Laya.timer.frameLoop(1,this,t_.loop,[tD])},t_.loop=function(tD){var tY=tA.now();tg(tD,tY),t_.world(tD,tY),(tD.options.showStats||tD.options.showDebug)&&t_.stats(tD,tD.context,tY),(tD.options.showPerformance||tD.options.showDebug)&&t_.performance(tD,tD.context,tY)},t_.stop=function(tD){Laya.timer.clear(this,t_.loop)},t_.setPixelRatio=function(tD,tY){var tg=tD.options,tT=tD.canvas;"auto"===tY&&(tY=tr(tT)),tg.pixelRatio=tY,tT.setAttribute("data-pixel-ratio",tY),tT.width=tg.width*tY,tT.height=tg.height*tY,tT.style.width=tg.width+"px",tT.style.height=tg.height+"px"},t_.lookAt=function(tD,tY,tg,tT){tT=void 0===tT||tT,tY=tA.isArray(tY)?tY:[tY],tg=tg||{x:0,y:0};for(var tr={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},ts=0;ts<tY.length;ts+=1){var ta=tY[ts],tW=ta.bounds?ta.bounds.min:ta.min||ta.position||ta,tM=ta.bounds?ta.bounds.max:ta.max||ta.position||ta;tW&&tM&&(tW.x<tr.min.x&&(tr.min.x=tW.x),tM.x>tr.max.x&&(tr.max.x=tM.x),tW.y<tr.min.y&&(tr.min.y=tW.y),tM.y>tr.max.y&&(tr.max.y=tM.y))}var tE=tr.max.x-tr.min.x+2*tg.x,tI=tr.max.y-tr.min.y+2*tg.y,tO=tD.canvas.height,tC=tD.canvas.width/tO,tN=tE/tI,t$=1,td=1;tC<tN?td=tN/tC:t$=tC/tN,tD.options.hasBounds=!0,tD.bounds.min.x=tr.min.x,tD.bounds.max.x=tr.min.x+tE*t$,tD.bounds.min.y=tr.min.y,tD.bounds.max.y=tr.min.y+tI*td,tT&&(tD.bounds.min.x+=.5*tE-tE*t$*.5,tD.bounds.max.x+=.5*tE-tE*t$*.5,tD.bounds.min.y+=.5*tI-tI*td*.5,tD.bounds.max.y+=.5*tI-tI*td*.5),tD.bounds.min.x-=tg.x,tD.bounds.max.x-=tg.x,tD.bounds.min.y-=tg.y,tD.bounds.max.y-=tg.y,tD.mouse&&(tz.setScale(tD.mouse,{x:(tD.bounds.max.x-tD.bounds.min.x)/tD.canvas.width,y:(tD.bounds.max.y-tD.bounds.min.y)/tD.canvas.height}),tz.setOffset(tD.mouse,tD.bounds.min))},t_.startViewTransform=function(tD){var tY=tD.bounds.max.x-tD.bounds.min.x,tg=tD.bounds.max.y-tD.bounds.min.y,tT=tY/tD.options.width,tr=tg/tD.options.height;tD.context.setTransform(tD.options.pixelRatio/tT,0,0,tD.options.pixelRatio/tr,0,0),tD.context.translate(-tD.bounds.min.x,-tD.bounds.min.y)},t_.endViewTransform=function(tD){tD.context.setTransform(tD.options.pixelRatio,0,0,tD.options.pixelRatio,0,0)},t_.world=function(tD,tY){var tg,tT=tA.now(),tr=tD.engine,ts=tr.world,ta=tD.canvas,tW=tD.context,tM=tD.options,tE=tD.timing,tI=tq.allBodies(ts),tO=tq.allConstraints(ts),tC=tM.wireframes?tM.wireframeBackground:tM.background,tN=[],t$=[],td={timestamp:tr.timing.timestamp};if(tG.trigger(tD,"beforeRender",td),tD.currentBackground!==tC&&tt(tD,tC),tW.globalCompositeOperation="source-in",tW.fillStyle="transparent",tW.fillRect(0,0,ta.width,ta.height),tW.globalCompositeOperation="source-over",tM.hasBounds){for(tg=0;tg<tI.length;tg++){var tJ=tI[tg];tb.overlaps(tJ.bounds,tD.bounds)&&tN.push(tJ)}for(tg=0;tg<tO.length;tg++){var tx=tO[tg],tj=tx.bodyA,tZ=tx.bodyB,tp=tx.pointA,tl=tx.pointB;tj&&(tp=tX.add(tj.position,tx.pointA)),tZ&&(tl=tX.add(tZ.position,tx.pointB)),tp&&tl&&((tb.contains(tD.bounds,tp)||tb.contains(tD.bounds,tl))&&t$.push(tx))}t_.startViewTransform(tD),tD.mouse&&(tz.setScale(tD.mouse,{x:(tD.bounds.max.x-tD.bounds.min.x)/tD.options.width,y:(tD.bounds.max.y-tD.bounds.min.y)/tD.options.height}),tz.setOffset(tD.mouse,tD.bounds.min))}else t$=tO,tN=tI,1!==tD.options.pixelRatio&&tD.context.setTransform(tD.options.pixelRatio,0,0,tD.options.pixelRatio,0,0);!tM.wireframes||tr.enableSleeping&&tM.showSleeping?t_.bodies(tD,tN,tW):(tM.showConvexHulls&&t_.bodyConvexHulls(tD,tN,tW),t_.bodyWireframes(tD,tN,tW)),tM.showBounds&&t_.bodyBounds(tD,tN,tW),(tM.showAxes||tM.showAngleIndicator)&&t_.bodyAxes(tD,tN,tW),tM.showPositions&&t_.bodyPositions(tD,tN,tW),tM.showVelocity&&t_.bodyVelocity(tD,tN,tW),tM.showIds&&t_.bodyIds(tD,tN,tW),tM.showSeparations&&t_.separations(tD,tr.pairs.list,tW),tM.showCollisions&&t_.collisions(tD,tr.pairs.list,tW),tM.showVertexNumbers&&t_.vertexNumbers(tD,tN,tW),tM.showMousePosition&&t_.mousePosition(tD,tD.mouse,tW),t_.constraints(t$,tW),tM.hasBounds&&t_.endViewTransform(tD),tG.trigger(tD,"afterRender",td),tE.lastElapsed=tA.now()-tT},t_.stats=function(tD,tY,tg){for(var tT=tD.engine,tr=tT.world,ts=tq.allBodies(tr),ta=0,tW=0,tM=0;tM<ts.length;tM+=1)ta+=ts[tM].parts.length;var tE={Part:ta,Body:ts.length,Cons:tq.allConstraints(tr).length,Comp:tq.allComposites(tr).length,Pair:tT.pairs.list.length};for(var tI in tY.fillStyle="#0e0f19",tY.fillRect(tW,0,302.5,44),tY.font="12px Arial",tY.textBaseline="top",tY.textAlign="right",tE){var tO=tE[tI];tY.fillStyle="#aaa",tY.fillText(tI,tW+55,8),tY.fillStyle="#eee",tY.fillText(tO,tW+55,26),tW+=55}},t_.performance=function(tD,tY){var tg=tD.engine,tT=tD.timing,tr=tT.deltaHistory,ts=tT.elapsedHistory,ta=tT.timestampElapsedHistory,tW=tT.engineDeltaHistory,tM=tT.engineElapsedHistory,tE=tg.timing.lastDelta,tI=tJ(tr),tO=tJ(ts),tC=tJ(tW),tN=tJ(tM),t$=tJ(ta)/tI||0,td=1e3/tI||0;tY.fillStyle="#0e0f19",tY.fillRect(0,50,370,34),t_.status(tY,10,69,60,4,tr.length,Math.round(td)+" fps",td/t_._goodFps,function(tD){return tr[tD]/tI-1}),t_.status(tY,82,69,60,4,tW.length,tE.toFixed(2)+" dt",t_._goodDelta/tE,function(tD){return tW[tD]/tC-1}),t_.status(tY,154,69,60,4,tM.length,tN.toFixed(2)+" ut",1-tN/t_._goodFps,function(tD){return tM[tD]/tN-1}),t_.status(tY,226,69,60,4,ts.length,tO.toFixed(2)+" rt",1-tO/t_._goodFps,function(tD){return ts[tD]/tO-1}),t_.status(tY,298,69,60,4,ta.length,t$.toFixed(2)+" x",t$*t$*t$,function(tD){return(ta[tD]/tr[tD]/t$||0)-1})},t_.status=function(tD,tY,tg,tT,tr,ts,ta,tW,tM){tD.strokeStyle="#888",tD.fillStyle="#444",tD.lineWidth=1,tD.fillRect(tY,tg+7,tT,1),tD.beginPath(),tD.moveTo(tY,tg+7-tr*tA.clamp(.4*tM(0),-2,2));for(var tE=0;tE<tT;tE+=1)tD.lineTo(tY+tE,tg+7-(tE<ts?tr*tA.clamp(.4*tM(tE),-2,2):0));tD.stroke(),tD.fillStyle="hsl("+tA.clamp(25+95*tW,0,120)+",100%,60%)",tD.fillRect(tY,tg-7,4,4),tD.font="12px Arial",tD.textBaseline="middle",tD.textAlign="right",tD.fillStyle="#eee",tD.fillText(ta,tY+tT,tg-5)},t_.constraints=function(tD,tY){for(var tg=tY,tT=0;tT<tD.length;tT++){var tr=tD[tT];if(tr.render.visible&&tr.pointA&&tr.pointB){var ts,ta,tW=tr.bodyA,tM=tr.bodyB;if(ts=tW?tX.add(tW.position,tr.pointA):tr.pointA,"pin"===tr.render.type)tg.beginPath(),tg.arc(ts.x,ts.y,3,0,2*Math.PI),tg.closePath();else{if(ta=tM?tX.add(tM.position,tr.pointB):tr.pointB,tg.beginPath(),tg.moveTo(ts.x,ts.y),"spring"===tr.render.type)for(var tE,tI=tX.sub(ta,ts),tO=tX.perp(tX.normalise(tI)),tC=Math.ceil(tA.clamp(tr.length/5,12,20)),tN=1;tN<tC;tN+=1)tE=tN%2==0?1:-1,tg.lineTo(ts.x+tI.x*(tN/tC)+tO.x*tE*4,ts.y+tI.y*(tN/tC)+tO.y*tE*4);tg.lineTo(ta.x,ta.y)}tr.render.lineWidth&&(tg.lineWidth=tr.render.lineWidth,tg.strokeStyle=tr.render.strokeStyle,tg.stroke()),tr.render.anchors&&(tg.fillStyle=tr.render.strokeStyle,tg.beginPath(),tg.arc(ts.x,ts.y,3,0,2*Math.PI),tg.arc(ta.x,ta.y,3,0,2*Math.PI),tg.closePath(),tg.fill())}}},t_.bodies=function(tD,tY,tg){var tT,tr,ts,ta,tW=tg,tM=(tD.engine,tD.options),tE=tM.showInternalEdges||!tM.wireframes;for(ts=0;ts<tY.length;ts++)if((tT=tY[ts]).render.visible)for(ta=1<tT.parts.length?1:0;ta<tT.parts.length;ta++)if((tr=tT.parts[ta]).render.visible){if(tM.showSleeping&&tT.isSleeping?tW.globalAlpha=.5*tr.render.opacity:1!==tr.render.opacity&&(tW.globalAlpha=tr.render.opacity),tr.render.sprite&&tr.render.sprite.texture&&!tM.wireframes){var tI=tr.render.sprite,tO=tN(tD,tI.texture);tW.translate(tr.position.x,tr.position.y),tW.rotate(tr.angle),tW.drawImage(tO,tO.width*-tI.xOffset*tI.xScale,tO.height*-tI.yOffset*tI.yScale,tO.width*tI.xScale,tO.height*tI.yScale),tW.rotate(-tr.angle),tW.translate(-tr.position.x,-tr.position.y)}else{if(tr.circleRadius)tW.beginPath(),tW.arc(tr.position.x,tr.position.y,tr.circleRadius,0,2*Math.PI);else{tW.beginPath(),tW.moveTo(tr.vertices[0].x,tr.vertices[0].y);for(var tC=1;tC<tr.vertices.length;tC++)!tr.vertices[tC-1].isInternal||tE?tW.lineTo(tr.vertices[tC].x,tr.vertices[tC].y):tW.moveTo(tr.vertices[tC].x,tr.vertices[tC].y),tr.vertices[tC].isInternal&&!tE&&tW.moveTo(tr.vertices[(tC+1)%tr.vertices.length].x,tr.vertices[(tC+1)%tr.vertices.length].y);tW.lineTo(tr.vertices[0].x,tr.vertices[0].y),tW.closePath()}tM.wireframes?(tW.lineWidth=1,tW.strokeStyle="#bbb",tW.stroke()):(tW.fillStyle=tr.render.fillStyle,tr.render.lineWidth&&(tW.lineWidth=tr.render.lineWidth,tW.strokeStyle=tr.render.strokeStyle,tW.stroke()),tW.fill())}tW.globalAlpha=1}},t_.bodyWireframes=function(tD,tY,tg){var tT,tr,ts,ta,tW,tM=tg,tE=tD.options.showInternalEdges;for(tM.beginPath(),ts=0;ts<tY.length;ts++)if((tT=tY[ts]).render.visible)for(tW=1<tT.parts.length?1:0;tW<tT.parts.length;tW++){for(tr=tT.parts[tW],tM.moveTo(tr.vertices[0].x,tr.vertices[0].y),ta=1;ta<tr.vertices.length;ta++)!tr.vertices[ta-1].isInternal||tE?tM.lineTo(tr.vertices[ta].x,tr.vertices[ta].y):tM.moveTo(tr.vertices[ta].x,tr.vertices[ta].y),tr.vertices[ta].isInternal&&!tE&&tM.moveTo(tr.vertices[(ta+1)%tr.vertices.length].x,tr.vertices[(ta+1)%tr.vertices.length].y);tM.lineTo(tr.vertices[0].x,tr.vertices[0].y)}tM.lineWidth=1,tM.strokeStyle="#bbb",tM.stroke()},t_.bodyConvexHulls=function(tD,tY,tg){var tT,tr,ts,ta=tg;for(ta.beginPath(),tr=0;tr<tY.length;tr++)if((tT=tY[tr]).render.visible&&1!==tT.parts.length){for(ta.moveTo(tT.vertices[0].x,tT.vertices[0].y),ts=1;ts<tT.vertices.length;ts++)ta.lineTo(tT.vertices[ts].x,tT.vertices[ts].y);ta.lineTo(tT.vertices[0].x,tT.vertices[0].y)}ta.lineWidth=1,ta.strokeStyle="rgba(255,255,255,0.2)",ta.stroke()},t_.vertexNumbers=function(tD,tY,tg){var tT,tr,ts,ta=tg;for(tT=0;tT<tY.length;tT++){var tW=tY[tT].parts;for(ts=1<tW.length?1:0;ts<tW.length;ts++){var tM=tW[ts];for(tr=0;tr<tM.vertices.length;tr++)ta.fillStyle="rgba(255,255,255,0.2)",ta.fillText(tT+"_"+tr,tM.position.x+.8*(tM.vertices[tr].x-tM.position.x),tM.position.y+.8*(tM.vertices[tr].y-tM.position.y))}}},t_.mousePosition=function(tD,tY,tg){var tT=tg;tT.fillStyle="rgba(255,255,255,0.8)",tT.fillText(tY.position.x+"  "+tY.position.y,tY.position.x+5,tY.position.y-5)},t_.bodyBounds=function(tD,tY,tg){var tT=tg,tr=(tD.engine,tD.options);tT.beginPath();for(var ts=0;ts<tY.length;ts++){if(tY[ts].render.visible)for(var ta=tY[ts].parts,tW=1<ta.length?1:0;tW<ta.length;tW++){var tM=ta[tW];tT.rect(tM.bounds.min.x,tM.bounds.min.y,tM.bounds.max.x-tM.bounds.min.x,tM.bounds.max.y-tM.bounds.min.y)}}tr.wireframes?tT.strokeStyle="rgba(255,255,255,0.08)":tT.strokeStyle="rgba(0,0,0,0.1)",tT.lineWidth=1,tT.stroke()},t_.bodyAxes=function(tD,tY,tg){var tT,tr,ts,ta,tW=tg,tM=(tD.engine,tD.options);for(tW.beginPath(),tr=0;tr<tY.length;tr++){var tE=tY[tr],tI=tE.parts;if(tE.render.visible)if(tM.showAxes)for(ts=1<tI.length?1:0;ts<tI.length;ts++)for(tT=tI[ts],ta=0;ta<tT.axes.length;ta++){var tO=tT.axes[ta];tW.moveTo(tT.position.x,tT.position.y),tW.lineTo(tT.position.x+20*tO.x,tT.position.y+20*tO.y)}else for(ts=1<tI.length?1:0;ts<tI.length;ts++)for(tT=tI[ts],ta=0;ta<tT.axes.length;ta++)tW.moveTo(tT.position.x,tT.position.y),tW.lineTo((tT.vertices[0].x+tT.vertices[tT.vertices.length-1].x)/2,(tT.vertices[0].y+tT.vertices[tT.vertices.length-1].y)/2)}tM.wireframes?(tW.strokeStyle="indianred",tW.lineWidth=1):(tW.strokeStyle="rgba(255, 255, 255, 0.4)",tW.globalCompositeOperation="overlay",tW.lineWidth=2),tW.stroke(),tW.globalCompositeOperation="source-over"},t_.bodyPositions=function(tD,tY,tg){var tT,tr,ts,ta,tW=tg,tM=(tD.engine,tD.options);for(tW.beginPath(),ts=0;ts<tY.length;ts++)if((tT=tY[ts]).render.visible)for(ta=0;ta<tT.parts.length;ta++)tr=tT.parts[ta],tW.arc(tr.position.x,tr.position.y,3,0,2*Math.PI,!1),tW.closePath();for(tM.wireframes?tW.fillStyle="indianred":tW.fillStyle="rgba(0,0,0,0.5)",tW.fill(),tW.beginPath(),ts=0;ts<tY.length;ts++)(tT=tY[ts]).render.visible&&(tW.arc(tT.positionPrev.x,tT.positionPrev.y,2,0,2*Math.PI,!1),tW.closePath());tW.fillStyle="rgba(255,165,0,0.8)",tW.fill()},t_.bodyVelocity=function(tD,tY,tg){var tT=tg;tT.beginPath();for(var tr=0;tr<tY.length;tr++){var ts=tY[tr];ts.render.visible&&(tT.moveTo(ts.position.x,ts.position.y),tT.lineTo(ts.position.x+2*(ts.position.x-ts.positionPrev.x),ts.position.y+2*(ts.position.y-ts.positionPrev.y)))}tT.lineWidth=3,tT.strokeStyle="cornflowerblue",tT.stroke()},t_.bodyIds=function(tD,tY,tg){var tT,tr,ts=tg;for(tT=0;tT<tY.length;tT++)if(tY[tT].render.visible){var ta=tY[tT].parts;for(tr=1<ta.length?1:0;tr<ta.length;tr++){var tW=ta[tr];ts.font="12px Arial",ts.fillStyle="rgba(255,255,255,0.5)",ts.fillText(tW.id,tW.position.x+10,tW.position.y-10)}}},t_.collisions=function(tD,tY,tg){var tT,tr,ts,ta,tW=tg,tM=tD.options;for(tW.beginPath(),ts=0;ts<tY.length;ts++)if((tT=tY[ts]).isActive)for(tr=tT.collision,ta=0;ta<tT.activeContacts.length;ta++){var tE=tT.activeContacts[ta].vertex;tW.rect(tE.x-1.5,tE.y-1.5,3.5,3.5)}for(tM.wireframes?tW.fillStyle="rgba(255,255,255,0.7)":tW.fillStyle="orange",tW.fill(),tW.beginPath(),ts=0;ts<tY.length;ts++)if((tT=tY[ts]).isActive&&(tr=tT.collision,0<tT.activeContacts.length)){var tI=tT.activeContacts[0].vertex.x,tO=tT.activeContacts[0].vertex.y;2===tT.activeContacts.length&&(tI=(tT.activeContacts[0].vertex.x+tT.activeContacts[1].vertex.x)/2,tO=(tT.activeContacts[0].vertex.y+tT.activeContacts[1].vertex.y)/2),tr.bodyB===tr.supports[0].body||!0===tr.bodyA.isStatic?tW.moveTo(tI-8*tr.normal.x,tO-8*tr.normal.y):tW.moveTo(tI+8*tr.normal.x,tO+8*tr.normal.y),tW.lineTo(tI,tO)}tM.wireframes?tW.strokeStyle="rgba(255,165,0,0.7)":tW.strokeStyle="orange",tW.lineWidth=1,tW.stroke()},t_.separations=function(tD,tY,tg){var tT,tr,ts,ta,tW,tM=tg,tE=tD.options;for(tM.beginPath(),tW=0;tW<tY.length;tW++)if((tT=tY[tW]).isActive){ts=(tr=tT.collision).bodyA;var tI=1;(ta=tr.bodyB).isStatic||ts.isStatic||(tI=.5),ta.isStatic&&(tI=0),tM.moveTo(ta.position.x,ta.position.y),tM.lineTo(ta.position.x-tr.penetration.x*tI,ta.position.y-tr.penetration.y*tI),tI=1,ta.isStatic||ts.isStatic||(tI=.5),ts.isStatic&&(tI=0),tM.moveTo(ts.position.x,ts.position.y),tM.lineTo(ts.position.x+tr.penetration.x*tI,ts.position.y+tr.penetration.y*tI)}tE.wireframes?tM.strokeStyle="rgba(255,165,0,0.5)":tM.strokeStyle="orange",tM.stroke()},t_.inspector=function(tD,tY){tD.engine;var tg,tT=tD.selected,tr=tD.render,ts=tr.options;if(ts.hasBounds){var ta=tr.bounds.max.x-tr.bounds.min.x,tW=tr.bounds.max.y-tr.bounds.min.y,tM=ta/tr.options.width,tE=tW/tr.options.height;tY.scale(1/tM,1/tE),tY.translate(-tr.bounds.min.x,-tr.bounds.min.y)}for(var tI=0;tI<tT.length;tI++){var tO=tT[tI].data;switch(tY.translate(.5,.5),tY.lineWidth=1,tY.strokeStyle="rgba(255,165,0,0.9)",tY.setLineDash([1,2]),tO.type){case"body":tg=tO.bounds,tY.beginPath(),tY.rect(Math.floor(tg.min.x-3),Math.floor(tg.min.y-3),Math.floor(tg.max.x-tg.min.x+6),Math.floor(tg.max.y-tg.min.y+6)),tY.closePath(),tY.stroke();break;case"constraint":var tC=tO.pointA;tO.bodyA&&(tC=tO.pointB),tY.beginPath(),tY.arc(tC.x,tC.y,10,0,2*Math.PI),tY.closePath(),tY.stroke()}tY.setLineDash([]),tY.translate(-.5,-.5)}null!==tD.selectStart&&(tY.translate(.5,.5),tY.lineWidth=1,tY.strokeStyle="rgba(255,165,0,0.6)",tY.fillStyle="rgba(255,165,0,0.1)",tg=tD.selectBounds,tY.beginPath(),tY.rect(Math.floor(tg.min.x),Math.floor(tg.min.y),Math.floor(tg.max.x-tg.min.x),Math.floor(tg.max.y-tg.min.y)),tY.closePath(),tY.stroke(),tY.fill(),tY.translate(-.5,-.5)),ts.hasBounds&&tY.setTransform(1,0,0,1,0,0)};var tg=function(tD,tY){var tg=tD.engine,tT=tD.timing,tr=tT.historySize,ts=tg.timing.timestamp;tT.delta=tY-tT.lastTime||t_._goodDelta,tT.lastTime=tY,tT.timestampElapsed=ts-tT.lastTimestamp||0,tT.lastTimestamp=ts,tT.deltaHistory.unshift(tT.delta),tT.deltaHistory.length=Math.min(tT.deltaHistory.length,tr),tT.engineDeltaHistory.unshift(tg.timing.lastDelta),tT.engineDeltaHistory.length=Math.min(tT.engineDeltaHistory.length,tr),tT.timestampElapsedHistory.unshift(tT.timestampElapsed),tT.timestampElapsedHistory.length=Math.min(tT.timestampElapsedHistory.length,tr),tT.engineElapsedHistory.unshift(tg.timing.lastElapsed),tT.engineElapsedHistory.length=Math.min(tT.engineElapsedHistory.length,tr),tT.elapsedHistory.unshift(tT.lastElapsed),tT.elapsedHistory.length=Math.min(tT.elapsedHistory.length,tr)},tJ=function(tD){for(var tY=0,tg=0;tg<tD.length;tg+=1)tY+=tD[tg];return tY/tD.length||0},tT=function(tD,tY){var tg=document.createElement("canvas");return tg.width=tD,tg.height=tY,tg.oncontextmenu=function(){return!1},tg.onselectstart=function(){return!1},tg},tr=function(tD){var tY=tD.getContext("2d");return(window.devicePixelRatio||1)/(tY.webkitBackingStorePixelRatio||tY.mozBackingStorePixelRatio||tY.msBackingStorePixelRatio||tY.oBackingStorePixelRatio||tY.backingStorePixelRatio||1)},tN=function(tD,tY){var tg=tD.textures[tY];return tg||((tg=tD.textures[tY]=new Image).src=tY,tg)},tt=function(tD,tY){var tg=tY;/(jpg|gif|png)$/.test(tY)&&(tg="url("+tY+")"),tD.canvas.style.background=tg,tD.canvas.style.backgroundSize="contain",tD.currentBackground=tY}}()},function(tD,tY){var tg={};(tD.exports=tg).create=function(tD){return{vertex:tD,normalImpulse:0,tangentImpulse:0}}},function(tD,tY,tg){var td={};tD.exports=td;var tJ=tg(7),tx=tg(19),tj=tg(14),tZ=tg(20),tp=tg(4),tl=tg(5),tt=tg(10),t_=tg(0),tW=tg(6);tg(2);td.create=function(tD){tD=tD||{};var tY=t_.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},tD);return tY.world=tD.world||tl.create({label:"World"}),tY.pairs=tD.pairs||tZ.create(),tY.detector=tD.detector||tj.create(),tY.grid={buckets:[]},tY.world.gravity=tY.gravity,tY.broadphase=tY.grid,tY.metrics={},tY},td.update=function(tD,tY,tg){var tT=t_.now();tY=tY||1e3/60,tg=tg||1;var tr=tD.world,ts=tD.detector,ta=tD.pairs,tW=tD.timing,tM=tW.timestamp;tW.timestamp+=tY*tW.timeScale,tW.lastDelta=tY*tW.timeScale;var tE={timestamp:tW.timestamp};tp.trigger(tD,"beforeUpdate",tE);var tI=tl.allBodies(tr),tO=tl.allConstraints(tr);for(tr.isModified&&tj.setBodies(ts,tI),tr.isModified&&tl.setModified(tr,!1,!1,!0),tD.enableSleeping&&tJ.update(tI,tW.timeScale),td._bodiesApplyGravity(tI,tD.gravity),td._bodiesUpdate(tI,tY,tW.timeScale,tg,tr.bounds),tt.preSolveAll(tI),tN=0;tN<tD.constraintIterations;tN++)tt.solveAll(tO,tW.timeScale);tt.postSolveAll(tI),ts.pairs=tD.pairs;var tC=tj.collisions(ts);for(tZ.update(ta,tC,tM),tD.enableSleeping&&tJ.afterCollisions(ta.list,tW.timeScale),0<ta.collisionStart.length&&tp.trigger(tD,"collisionStart",{pairs:ta.collisionStart}),tx.preSolvePosition(ta.list),tN=0;tN<tD.positionIterations;tN++)tx.solvePosition(ta.list,tW.timeScale);tx.postSolvePosition(tI);for(var tN=0;tN<ta.list.length;tN++){var t$=ta.list[tN];t$.isActive&&0<t$.collision.depth&&(tj.worldBoundsLimit(t$.bodyA,t$),tj.worldBoundsLimit(t$.bodyB,t$))}for(tt.preSolveAll(tI),tN=0;tN<tD.constraintIterations;tN++)tt.solveAll(tO,tW.timeScale);for(tt.postSolveAll(tI),tx.preSolveVelocity(ta.list),tN=0;tN<tD.velocityIterations;tN++)tx.solveVelocity(ta.list,tW.timeScale);return 0<ta.collisionActive.length&&tp.trigger(tD,"collisionActive",{pairs:ta.collisionActive}),0<ta.collisionEnd.length&&tp.trigger(tD,"collisionEnd",{pairs:ta.collisionEnd}),td._bodiesClearForces(tI),tp.trigger(tD,"afterUpdate",tE),tD.timing.lastElapsed=t_.now()-tT,tD},td.merge=function(tD,tY){if(t_.extend(tD,tY),tY.world){tD.world=tY.world,td.clear(tD);for(var tg=tl.allBodies(tD.world),tT=0;tT<tg.length;tT++){var tr=tg[tT];tJ.set(tr,!1),tr.id=t_.nextId()}}},td.clear=function(tD){tZ.clear(tD.pairs),tj.clear(tD.detector)},td._bodiesClearForces=function(tD){for(var tY=0;tY<tD.length;tY++){var tg=tD[tY];tg.force.x=0,tg.force.y=0,tg.torque=0}},td._bodiesApplyGravity=function(tD,tY){var tg=void 0!==tY.scale?tY.scale:.001;if((0!==tY.x||0!==tY.y)&&0!==tg)for(var tT=0;tT<tD.length;tT++){var tr=tD[tT];tr.isStatic||tr.isSleeping||(tr.force.y+=tr.mass*tY.y*tg,tr.force.x+=tr.mass*tY.x*tg)}},td._bodiesUpdate=function(tD,tY,tg,tT,tr){for(var ts=0;ts<tD.length;ts++){var ta=tD[ts];ta.isStatic||ta.isSleeping||tW.update(ta,tY,tg,tT)}}},function(tD,tY,tg){var tL={};tD.exports=tL;var tN=tg(3),t$=tg(1);tL._restingThresh=4,tL._restingThreshTangent=6,tL._positionDampen=.9,tL._positionWarming=.8,tL._frictionNormalMultiplier=5,tL.preSolvePosition=function(tD){var tY,tg,tT,tr=tD.length;for(tY=0;tY<tr;tY++)(tg=tD[tY]).isActive&&(tT=tg.activeContacts.length,tg.collision.parentA.totalContacts+=tT,tg.collision.parentB.totalContacts+=tT)},tL.solvePosition=function(tD,tY){var tg,tT,tr,ts,ta,tW,tM,tE,tI=tL._positionDampen,tO=tD.length;for(tg=0;tg<tO;tg++)(tT=tD[tg]).isActive&&!tT.isSensor&&(ts=(tr=tT.collision).parentA,ta=tr.parentB,tW=tr.normal,tT.separation=tW.x*(ta.positionImpulse.x+tr.penetration.x-ts.positionImpulse.x)+tW.y*(ta.positionImpulse.y+tr.penetration.y-ts.positionImpulse.y));for(tg=0;tg<tO;tg++)(tT=tD[tg]).isActive&&!tT.isSensor&&(ts=(tr=tT.collision).parentA,ta=tr.parentB,tW=tr.normal,tE=(tT.separation-tT.slop)*tY,(ts.isStatic||ta.isStatic)&&(tE*=2),ts.isStatic||ts.isSleeping||(tM=tI/ts.totalContacts,ts.positionImpulse.x+=tW.x*tE*tM,ts.positionImpulse.y+=tW.y*tE*tM),ta.isStatic||ta.isSleeping||(tM=tI/ta.totalContacts,ta.positionImpulse.x-=tW.x*tE*tM,ta.positionImpulse.y-=tW.y*tE*tM))},tL.postSolvePosition=function(tD){for(var tY=tL._positionWarming,tg=tD.length,tT=tN.translate,tr=t$.update,ts=0;ts<tg;ts++){var ta=tD[ts],tW=ta.positionImpulse,tM=tW.x,tE=tW.y,tI=ta.velocity;if((ta.totalContacts=0)!==tM||0!==tE){for(var tO=0;tO<ta.parts.length;tO++){var tC=ta.parts[tO];tT(tC.vertices,tW),tr(tC.bounds,tC.vertices,tI),tC.position.x+=tM,tC.position.y+=tE}ta.positionPrev.x+=tM,ta.positionPrev.y+=tE,tM*tI.x+tE*tI.y<0?(tW.x=0,tW.y=0):(tW.x*=tY,tW.y*=tY)}}},tL.preSolveVelocity=function(tD){var tY,tg,tT=tD.length;for(tY=0;tY<tT;tY++){var tr=tD[tY];if(tr.isActive&&!tr.isSensor){var ts=tr.activeContacts,ta=ts.length,tW=tr.collision,tM=tW.parentA,tE=tW.parentB,tI=tW.normal,tO=tW.tangent;for(tg=0;tg<ta;tg++){var tC=ts[tg],tN=tC.vertex,t$=tC.normalImpulse,td=tC.tangentImpulse;if(0!==t$||0!==td){var tJ=tI.x*t$+tO.x*td,tx=tI.y*t$+tO.y*td;tM.isStatic||tM.isSleeping||(tM.positionPrev.x+=tJ*tM.inverseMass,tM.positionPrev.y+=tx*tM.inverseMass,tM.anglePrev+=tM.inverseInertia*((tN.x-tM.position.x)*tx-(tN.y-tM.position.y)*tJ)),tE.isStatic||tE.isSleeping||(tE.positionPrev.x-=tJ*tE.inverseMass,tE.positionPrev.y-=tx*tE.inverseMass,tE.anglePrev-=tE.inverseInertia*((tN.x-tE.position.x)*tx-(tN.y-tE.position.y)*tJ))}}}}},tL.solveVelocity=function(tD,tY){var tg,tT,tr,ts,ta=tY*tY,tW=tL._restingThresh*ta,tM=tL._frictionNormalMultiplier,tE=tL._restingThreshTangent*ta,tI=Number.MAX_VALUE,tO=tD.length;for(tr=0;tr<tO;tr++){var tC=tD[tr];if(tC.isActive&&!tC.isSensor){var tN=tC.collision,t$=tN.parentA,td=tN.parentB,tJ=t$.velocity,tx=td.velocity,tj=tN.normal.x,tZ=tN.normal.y,tp=tN.tangent.x,tl=tN.tangent.y,tt=tC.activeContacts,t_=tt.length,tA=1/t_,tq=t$.inverseMass+td.inverseMass,tb=tC.friction*tC.frictionStatic*tM*ta;for(tJ.x=t$.position.x-t$.positionPrev.x,tJ.y=t$.position.y-t$.positionPrev.y,tx.x=td.position.x-td.positionPrev.x,tx.y=td.position.y-td.positionPrev.y,t$.angularVelocity=t$.angle-t$.anglePrev,td.angularVelocity=td.angle-td.anglePrev,ts=0;ts<t_;ts++){var tG=tt[ts],tX=tG.vertex,tz=tX.x-t$.position.x,tm=tX.y-t$.position.y,th=tX.x-td.position.x,ti=tX.y-td.position.y,tP=tJ.x-tm*t$.angularVelocity,tB=tJ.y+tz*t$.angularVelocity,tH=tP-(tx.x-ti*td.angularVelocity),tv=tB-(tx.y+th*td.angularVelocity),tS=tj*tH+tZ*tv,tU=tp*tH+tl*tv,tF=tC.separation+tS,tV=Math.min(tF,1),tc=(tV=tF<0?0:tV)*tb;tc<tU||tc<-tU?(tT=0<tU?tU:-tU,(tg=tC.friction*(0<tU?1:-1)*ta)<-tT?tg=-tT:tT<tg&&(tg=tT)):(tg=tU,tT=tI);var tf=tz*tZ-tm*tj,te=th*tZ-ti*tj,tk=tA/(tq+t$.inverseInertia*tf*tf+td.inverseInertia*te*te),tw=(1+tC.restitution)*tS*tk;if(tg*=tk,tW<tS*tS&&tS<0)tG.normalImpulse=0;else{var tK=tG.normalImpulse;tG.normalImpulse+=tw,tG.normalImpulse=Math.min(tG.normalImpulse,0),tw=tG.normalImpulse-tK}if(tE<tU*tU)tG.tangentImpulse=0;else{var to=tG.tangentImpulse;tG.tangentImpulse+=tg,tG.tangentImpulse<-tT&&(tG.tangentImpulse=-tT),tG.tangentImpulse>tT&&(tG.tangentImpulse=tT),tg=tG.tangentImpulse-to}var tR=tj*tw+tp*tg,tQ=tZ*tw+tl*tg;t$.isStatic||t$.isSleeping||(t$.positionPrev.x+=tR*t$.inverseMass,t$.positionPrev.y+=tQ*t$.inverseMass,t$.anglePrev+=(tz*tQ-tm*tR)*t$.inverseInertia),td.isStatic||td.isSleeping||(td.positionPrev.x-=tR*td.inverseMass,td.positionPrev.y-=tQ*td.inverseMass,td.anglePrev-=(th*tQ-ti*tR)*td.inverseInertia)}}}}},function(tD,tY,tg){var tT={};tD.exports=tT;var td=tg(9),tr=tg(0);tT.create=function(tD){return tr.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},tD)},tT.update=function(tD,tY,tg){var tT,tr,ts,ta,tW=tD.list,tM=tW.length,tE=tD.table,tI=tY.length,tO=tD.collisionStart,tC=tD.collisionEnd,tN=tD.collisionActive;for(tO.length=0,tC.length=0,ta=tN.length=0;ta<tM;ta++)tW[ta].confirmedActive=!1;for(ta=0;ta<tI;ta++)(ts=(tT=tY[ta]).pair)?(ts.isActive?tN.push(ts):tO.push(ts),td.update(ts,tT,tg),ts.confirmedActive=!0):(tE[(ts=td.create(tT,tg)).id]=ts,tO.push(ts),tW.push(ts));var t$=[];for(tM=tW.length,ta=0;ta<tM;ta++)(ts=tW[ta]).confirmedActive||(td.setActive(ts,!1,tg),tC.push(ts),ts.collision.bodyA.isSleeping||ts.collision.bodyB.isSleeping||t$.push(ta));for(ta=0;ta<t$.length;ta++)ts=tW[tr=t$[ta]-ta],tW.splice(tr,1),delete tE[ts.id]},tT.clear=function(tD){return tD.table={},tD.list.length=0,tD.collisionStart.length=0,tD.collisionActive.length=0,tD.collisionEnd.length=0,tD}},function(tD,tY,tg){var tT=tD.exports=tg(22);tT.Axes=tg(11),tT.Bodies=tg(12),tT.Body=tg(6),tT.Bounds=tg(1),tT.Collision=tg(8),tT.Common=tg(0),tT.Composite=tg(5),tT.Composites=tg(23),tT.Constraint=tg(10),tT.Contact=tg(17),tT.Detector=tg(14),tT.Engine=tg(18),tT.Events=tg(4),tT.Grid=tg(24),tT.Mouse=tg(13),tT.MouseConstraint=tg(25),tT.Pair=tg(9),tT.Pairs=tg(20),tT.Plugin=tg(15),tT.Query=tg(26),tT.Render=tg(16),tT.Resolver=tg(19),tT.Runner=tg(27),tT.SAT=tg(28),tT.Sleeping=tg(7),tT.Svg=tg(29),tT.Vector=tg(2),tT.Vertices=tg(3),tT.World=tg(30),tT.Engine.run=tT.Runner.run,tT.Common.deprecated(tT.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(tD,tY,tg){var tT={};tD.exports=tT;var tr=tg(15),ts=tg(0);tT.name="matter-js",tT.version="0.18.0",tT.uses=[],tT.used=[],tT.use=function(){tr.use(tT,Array.prototype.slice.call(arguments))},tT.before=function(tD,tY){return tD=tD.replace(/^Matter./,""),ts.chainPathBefore(tT,tD,tY)},tT.after=function(tD,tY){return tD=tD.replace(/^Matter./,""),ts.chainPathAfter(tT,tD,tY)}},function(tD,tY,tg){var tN={};tD.exports=tN;var tj=tg(5),td=tg(10),tJ=tg(0),tZ=tg(6),t$=tg(12),tT=tJ.deprecated;tN.stack=function(tD,tY,tg,tT,tr,ts,ta){for(var tW,tM=tj.create({label:"Stack"}),tE=tD,tI=tY,tO=0,tC=0;tC<tT;tC++){for(var tN=0,t$=0;t$<tg;t$++){var td=ta(tE,tI,t$,tC,tW,tO);if(td){var tJ=td.bounds.max.y-td.bounds.min.y,tx=td.bounds.max.x-td.bounds.min.x;tN<tJ&&(tN=tJ),tZ.translate(td,{x:.5*tx,y:.5*tJ}),tE=td.bounds.max.x+tr,tj.addBody(tM,td),tW=td,tO+=1}else tE+=tr}tI+=tN+ts,tE=tD}return tM},tN.chain=function(tD,tY,tg,tT,tr,ts){for(var ta=tD.bodies,tW=1;tW<ta.length;tW++){var tM=ta[tW-1],tE=ta[tW],tI=tM.bounds.max.y-tM.bounds.min.y,tO=tM.bounds.max.x-tM.bounds.min.x,tC=tE.bounds.max.y-tE.bounds.min.y,tN={bodyA:tM,pointA:{x:tO*tY,y:tI*tg},bodyB:tE,pointB:{x:(tE.bounds.max.x-tE.bounds.min.x)*tT,y:tC*tr}},t$=tJ.extend(tN,ts);tj.addConstraint(tD,td.create(t$))}return tD.label+=" Chain",tD},tN.mesh=function(tD,tY,tg,tT,tr){var ts,ta,tW,tM,tE,tI=tD.bodies;for(ts=0;ts<tg;ts++){for(ta=1;ta<tY;ta++)tW=tI[ta-1+ts*tY],tM=tI[ta+ts*tY],tj.addConstraint(tD,td.create(tJ.extend({bodyA:tW,bodyB:tM},tr)));if(0<ts)for(ta=0;ta<tY;ta++)tW=tI[ta+(ts-1)*tY],tM=tI[ta+ts*tY],tj.addConstraint(tD,td.create(tJ.extend({bodyA:tW,bodyB:tM},tr))),tT&&0<ta&&(tE=tI[ta-1+(ts-1)*tY],tj.addConstraint(tD,td.create(tJ.extend({bodyA:tE,bodyB:tM},tr)))),tT&&ta<tY-1&&(tE=tI[ta+1+(ts-1)*tY],tj.addConstraint(tD,td.create(tJ.extend({bodyA:tE,bodyB:tM},tr))))}return tD.label+=" Mesh",tD},tN.pyramid=function(tM,tD,tE,tI,tO,tY,tC){return tN.stack(tM,tD,tE,tI,tO,tY,function(tD,tY,tg,tT,tr,ts){var ta=Math.min(tI,Math.ceil(tE/2)),tW=tr?tr.bounds.max.x-tr.bounds.min.x:0;if(!(ta<tT||tg<(tT=ta-tT)||tE-1-tT<tg))return 1===ts&&tZ.translate(tr,{x:(tg+(tE%2==1?1:-1))*tW,y:0}),tC(tM+(tr?tg*tW:0)+tg*tO,tY,tg,tT,tr,ts)})},tN.newtonsCradle=function(tD,tY,tg,tT,tr){for(var ts=tj.create({label:"Newtons Cradle"}),ta=0;ta<tg;ta++){var tW=t$.circle(tD+ta*(1.9*tT),tY+tr,tT,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),tM=td.create({pointA:{x:tD+ta*(1.9*tT),y:tY},bodyB:tW});tj.addBody(ts,tW),tj.addConstraint(ts,tM)}return ts},tT(tN,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),tN.car=function(tD,tY,tg,tT,tr){var ts=tZ.nextGroup(!0),ta=.5*-tg+20,tW=.5*tg-20,tM=tj.create({label:"Car"}),tE=t$.rectangle(tD,tY,tg,tT,{collisionFilter:{group:ts},chamfer:{radius:.5*tT},density:2e-4}),tI=t$.circle(tD+ta,tY+0,tr,{collisionFilter:{group:ts},friction:.8}),tO=t$.circle(tD+tW,tY+0,tr,{collisionFilter:{group:ts},friction:.8}),tC=td.create({bodyB:tE,pointB:{x:ta,y:0},bodyA:tI,stiffness:1,length:0}),tN=td.create({bodyB:tE,pointB:{x:tW,y:0},bodyA:tO,stiffness:1,length:0});return tj.addBody(tM,tE),tj.addBody(tM,tI),tj.addBody(tM,tO),tj.addConstraint(tM,tC),tj.addConstraint(tM,tN),tM},tT(tN,"car","Composites.car ➤ moved to car example"),tN.softBody=function(tD,tY,tg,tT,tr,ts,ta,tW,tM,tE){tM=tJ.extend({inertia:1/0},tM),tE=tJ.extend({stiffness:.2,render:{type:"line",anchors:!1}},tE);var tI=tN.stack(tD,tY,tg,tT,tr,ts,function(tD,tY){return t$.circle(tD,tY,tW,tM)});return tN.mesh(tI,tg,tT,ta,tE),tI.label="Soft Body",tI},tT(tN,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(tD,tY,tg){var tx={};tD.exports=tx;var tI=tg(9),tM=tg(0),tT=tM.deprecated;tx.create=function(tD){return tM.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},tD)},tx.update=function(tD,tY,tg,tT){var tr,ts,ta,tW,tM,tE=tg.world,tI=tD.buckets,tO=!1;for(tr=0;tr<tY.length;tr++){var tC=tY[tr];if((!tC.isSleeping||tT)&&(!tE.bounds||!(tC.bounds.max.x<tE.bounds.min.x||tC.bounds.min.x>tE.bounds.max.x||tC.bounds.max.y<tE.bounds.min.y||tC.bounds.min.y>tE.bounds.max.y))){var tN=tx._getRegion(tD,tC);if(!tC.region||tN.id!==tC.region.id||tT){tC.region&&!tT||(tC.region=tN);var t$=tx._regionUnion(tN,tC.region);for(ts=t$.startCol;ts<=t$.endCol;ts++)for(ta=t$.startRow;ta<=t$.endRow;ta++){tW=tI[tM=tx._getBucketId(ts,ta)];var td=ts>=tN.startCol&&ts<=tN.endCol&&ta>=tN.startRow&&ta<=tN.endRow,tJ=ts>=tC.region.startCol&&ts<=tC.region.endCol&&ta>=tC.region.startRow&&ta<=tC.region.endRow;!td&&tJ&&tJ&&tW&&tx._bucketRemoveBody(tD,tW,tC),(tC.region===tN||td&&!tJ||tT)&&(tW||(tW=tx._createBucket(tI,tM)),tx._bucketAddBody(tD,tW,tC))}tC.region=tN,tO=!0}}}tO&&(tD.pairsList=tx._createActivePairsList(tD))},tT(tx,"update","Grid.update ➤ replaced by Matter.Detector"),tx.clear=function(tD){tD.buckets={},tD.pairs={},tD.pairsList=[]},tT(tx,"clear","Grid.clear ➤ replaced by Matter.Detector"),tx._regionUnion=function(tD,tY){var tg=Math.min(tD.startCol,tY.startCol),tT=Math.max(tD.endCol,tY.endCol),tr=Math.min(tD.startRow,tY.startRow),ts=Math.max(tD.endRow,tY.endRow);return tx._createRegion(tg,tT,tr,ts)},tx._getRegion=function(tD,tY){var tg=tY.bounds,tT=Math.floor(tg.min.x/tD.bucketWidth),tr=Math.floor(tg.max.x/tD.bucketWidth),ts=Math.floor(tg.min.y/tD.bucketHeight),ta=Math.floor(tg.max.y/tD.bucketHeight);return tx._createRegion(tT,tr,ts,ta)},tx._createRegion=function(tD,tY,tg,tT){return{id:tD+","+tY+","+tg+","+tT,startCol:tD,endCol:tY,startRow:tg,endRow:tT}},tx._getBucketId=function(tD,tY){return"C"+tD+"R"+tY},tx._createBucket=function(tD,tY){return tD[tY]=[]},tx._bucketAddBody=function(tD,tY,tg){var tT,tr=tD.pairs,ts=tI.id,ta=tY.length;for(tT=0;tT<ta;tT++){var tW=tY[tT];if(!(tg.id===tW.id||tg.isStatic&&tW.isStatic)){var tM=ts(tg,tW),tE=tr[tM];tE?tE[2]+=1:tr[tM]=[tg,tW,1]}}tY.push(tg)},tx._bucketRemoveBody=function(tD,tY,tg){var tT,tr=tD.pairs,ts=tI.id;tY.splice(tM.indexOf(tY,tg),1);var ta=tY.length;for(tT=0;tT<ta;tT++){var tW=tr[ts(tg,tY[tT])];tW&&(tW[2]-=1)}},tx._createActivePairsList=function(tD){var tY,tg,tT=tD.pairs,tr=tM.keys(tT),ts=tr.length,ta=[];for(tg=0;tg<ts;tg++)0<(tY=tT[tr[tg]])[2]?ta.push(tY):delete tT[tr[tg]];return ta}},function(tD,tY,tg){var ts={};tD.exports=ts;var tM=tg(3),tE=tg(7),ta=tg(13),tI=tg(4),tO=tg(14),tW=tg(10),tC=tg(5),tN=tg(0),t$=tg(1);ts.create=function(tY,tD){var tg=(tY?tY.mouse:null)||(tD?tD.mouse:null);tg||(tY&&tY.render&&tY.render.canvas?tg=ta.create(tY.render.canvas):tD&&tD.element?tg=ta.create(tD.element):(tg=ta.create(),tN.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var tT={type:"mouseConstraint",mouse:tg,element:null,body:null,constraint:tW.create({label:"Mouse Constraint",pointA:tg.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},tr=tN.extend(tT,tD);return tI.on(tY,"beforeUpdate",function(){var tD=tC.allBodies(tY.world);ts.update(tr,tD),ts._triggerEvents(tr)}),tr},ts.update=function(tD,tY){var tg=tD.mouse,tT=tD.constraint,tr=tD.body;if(0===tg.button){if(tT.bodyB)tE.set(tT.bodyB,!1),tT.pointA=tg.position;else for(var ts=0;ts<tY.length;ts++)if(tr=tY[ts],t$.contains(tr.bounds,tg.position)&&tO.canCollide(tr.collisionFilter,tD.collisionFilter))for(var ta=1<tr.parts.length?1:0;ta<tr.parts.length;ta++){var tW=tr.parts[ta];if(tM.contains(tW.vertices,tg.position)){tT.pointA=tg.position,tT.bodyB=tD.body=tr,tT.pointB={x:tg.position.x-tr.position.x,y:tg.position.y-tr.position.y},tT.angleB=tr.angle,tE.set(tr,!1),tI.trigger(tD,"startdrag",{mouse:tg,body:tr});break}}}else tT.bodyB=tD.body=null,tT.pointB=null,tr&&tI.trigger(tD,"enddrag",{mouse:tg,body:tr})},ts._triggerEvents=function(tD){var tY=tD.mouse,tg=tY.sourceEvents;tg.mousemove&&tI.trigger(tD,"mousemove",{mouse:tY}),tg.mousedown&&tI.trigger(tD,"mousedown",{mouse:tY}),tg.mouseup&&tI.trigger(tD,"mouseup",{mouse:tY}),tg.mouseout&&tI.trigger(tD,"mouseout",{mouse:tY}),ta.clearSourceEvents(tY)}},function(tD,tY,tg){var tC={};tD.exports=tC;var tN=tg(2),t$=tg(8),td=tg(1),tJ=tg(12),tW=tg(3);tC.collides=function(tD,tY){for(var tg=[],tT=tY.length,tr=tD.bounds,ts=t$.collides,ta=td.overlaps,tW=0;tW<tT;tW++){var tM=tY[tW],tE=tM.parts.length,tI=1===tE?0:1;if(ta(tM.bounds,tr))for(var tO=tI;tO<tE;tO++){var tC=tM.parts[tO];if(ta(tC.bounds,tr)){var tN=ts(tC,tD);if(tN){tg.push(tN);break}}}}return tg},tC.ray=function(tD,tY,tg,tT){tT=tT||1e-100;for(var tr=tN.angle(tY,tg),ts=tN.magnitude(tN.sub(tY,tg)),ta=.5*(tg.x+tY.x),tW=.5*(tg.y+tY.y),tM=tJ.rectangle(ta,tW,ts,tT,{angle:tr}),tE=tC.collides(tM,tD),tI=0;tI<tE.length;tI+=1){var tO=tE[tI];tO.body=tO.bodyB=tO.bodyA}return tE},tC.region=function(tD,tY,tg){for(var tT=[],tr=0;tr<tD.length;tr++){var ts=tD[tr],ta=td.overlaps(ts.bounds,tY);(ta&&!tg||!ta&&tg)&&tT.push(ts)}return tT},tC.point=function(tD,tY){for(var tg=[],tT=0;tT<tD.length;tT++){var tr=tD[tT];if(td.contains(tr.bounds,tY))for(var ts=1===tr.parts.length?0:1;ts<tr.parts.length;ts++){var ta=tr.parts[ts];if(td.contains(ta.bounds,tY)&&tW.contains(ta.vertices,tY)){tg.push(tr);break}}}return tg}},function(tD,tY,tg){var tT={};tD.exports=tT;var tW=tg(4),tM=tg(18),tr=tg(0);tT.create=function(tD){var tY=tr.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},tD);return tY.delta=tY.delta||1e3/tY.fps,tY.deltaMin=tY.deltaMin||1e3/tY.fps,tY.deltaMax=tY.deltaMax||1e3/(.5*tY.fps),tY.fps=1e3/tY.delta,tY},tT.run=function(tD,tY){return void 0!==tD.positionIterations&&(tY=tD,tD=tT.create()),Laya.timer.clear(this,tT.render),Laya.timer.frameLoop(1,this,tT.render,[tD,tY]),tD},tT.render=function(tD,tY){tD.enabled&&tT.tick(tD,tY,tr.now())},tT.tick=function(tD,tY,tg){var tT,tr=tY.timing,ts=1,ta={timestamp:tr.timestamp};tW.trigger(tD,"beforeTick",ta),tD.isFixed?tT=tD.delta:(tT=tg-tD.timePrev||tD.delta,tD.timePrev=tg,tD.deltaHistory.push(tT),tD.deltaHistory=tD.deltaHistory.slice(-tD.deltaSampleSize),ts=(tT=(tT=(tT=Math.min.apply(null,tD.deltaHistory))<tD.deltaMin?tD.deltaMin:tT)>tD.deltaMax?tD.deltaMax:tT)/tD.delta,tD.delta=tT),0!==tD.timeScalePrev&&(ts*=tr.timeScale/tD.timeScalePrev),0===tr.timeScale&&(ts=0),tD.timeScalePrev=tr.timeScale,tD.correction=ts,tD.frameCounter+=1,1e3<=tg-tD.counterTimestamp&&(tD.fps=tD.frameCounter*((tg-tD.counterTimestamp)/1e3),tD.counterTimestamp=tg,tD.frameCounter=0),tW.trigger(tD,"tick",ta),tW.trigger(tD,"beforeUpdate",ta),tM.update(tY,tT,ts),tW.trigger(tD,"afterUpdate",ta),tW.trigger(tD,"afterTick",ta)},tT.stop=function(tD){Laya.timer.clear(this,tT.render)},tT.start=function(tD,tY){tT.run(tD,tY)}},function(tD,tY,tg){var tT={};tD.exports=tT;var tr=tg(8),ts=tg(0).deprecated;tT.collides=function(tD,tY){return tr.collides(tD,tY)},ts(tT,"collides","SAT.collides ➤ replaced by Collision.collides")},function(tD,tY,tg){var tZ={};tD.exports=tZ;tg(1);var tp=tg(0);tZ.pathToVertices=function(tD,tY){"undefined"==typeof window||"SVGPathSeg"in window||tp.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var tg,tT,tr,ts,ta,tW,tM,tE,tI,tO,tC,tN=[],t$=0,td=0,tJ=0;function tx(tD,tY,tg){var tT=tg%2==1&&1<tg;if(!tI||tD!=tI.x||tY!=tI.y){tC=tI&&tT?(tO=tI.x,tI.y):tO=0;var tr={x:tO+tD,y:tC+tY};!tT&&tI||(tI=tr),tN.push(tr),td=tO+tD,tJ=tC+tY}}function tj(tD){var tY=tD.pathSegTypeAsLetter.toUpperCase();if("Z"!==tY){switch(tY){case"M":case"L":case"T":case"C":case"S":case"Q":td=tD.x,tJ=tD.y;break;case"H":td=tD.x;break;case"V":tJ=tD.y}tx(td,tJ,tD.pathSegType)}}for(tY=tY||15,tZ._svgPathToAbsolute(tD),tr=tD.getTotalLength(),tW=[],tg=0;tg<tD.pathSegList.numberOfItems;tg+=1)tW.push(tD.pathSegList.getItem(tg));for(tM=tW.concat();t$<tr;){if((ta=tW[tD.getPathSegAtLength(t$)])!=tE){for(;tM.length&&tM[0]!=ta;)tj(tM.shift());tE=ta}switch(ta.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":ts=tD.getPointAtLength(t$),tx(ts.x,ts.y,0)}t$+=tY}for(tg=0,tT=tM.length;tg<tT;++tg)tj(tM[tg]);return tN},tZ._svgPathToAbsolute=function(tD){for(var tY,tg,tT,tr,ts,ta,tW=tD.pathSegList,tM=0,tE=0,tI=tW.numberOfItems,tO=0;tO<tI;++tO){var tC=tW.getItem(tO),tN=tC.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(tN))"x"in tC&&(tM=tC.x),"y"in tC&&(tE=tC.y);else switch("x1"in tC&&(tT=tM+tC.x1),"x2"in tC&&(ts=tM+tC.x2),"y1"in tC&&(tr=tE+tC.y1),"y2"in tC&&(ta=tE+tC.y2),"x"in tC&&(tM+=tC.x),"y"in tC&&(tE+=tC.y),tN){case"m":tW.replaceItem(tD.createSVGPathSegMovetoAbs(tM,tE),tO);break;case"l":tW.replaceItem(tD.createSVGPathSegLinetoAbs(tM,tE),tO);break;case"h":tW.replaceItem(tD.createSVGPathSegLinetoHorizontalAbs(tM),tO);break;case"v":tW.replaceItem(tD.createSVGPathSegLinetoVerticalAbs(tE),tO);break;case"c":tW.replaceItem(tD.createSVGPathSegCurvetoCubicAbs(tM,tE,tT,tr,ts,ta),tO);break;case"s":tW.replaceItem(tD.createSVGPathSegCurvetoCubicSmoothAbs(tM,tE,ts,ta),tO);break;case"q":tW.replaceItem(tD.createSVGPathSegCurvetoQuadraticAbs(tM,tE,tT,tr),tO);break;case"t":tW.replaceItem(tD.createSVGPathSegCurvetoQuadraticSmoothAbs(tM,tE),tO);break;case"a":tW.replaceItem(tD.createSVGPathSegArcAbs(tM,tE,tC.r1,tC.r2,tC.angle,tC.largeArcFlag,tC.sweepFlag),tO);break;case"z":case"Z":tM=tY,tE=tg}"M"!=tN&&"m"!=tN||(tY=tM,tg=tE)}}},function(tD,tY,tg){var tT={};tD.exports=tT;var tr=tg(5);tg(0);tT.create=tr.create,tT.add=tr.add,tT.remove=tr.remove,tT.clear=tr.clear,tT.addComposite=tr.addComposite,tT.addBody=tr.addBody,tT.addBodyAt=tr.addBodyAt,tT.addConstraint=tr.addConstraint}])}),function(tD){if("object"==typeof exports&&"undefined"!=typeof module)window?window.decomp=tD():module.exports=tD();else if("function"==typeof define&&define.amd)define([],tD);else{var tY;"undefined"!=typeof window?tY=window:"undefined"!=typeof global?tY=global:"undefined"!=typeof self&&(tY=self),tY.decomp=tD()}}(function(){return function tr(ts,ta,tW){function tM(tg,tD){if(!ta[tg]){if(!ts[tg]){var tY="function"==typeof require&&require;if(!tD&&tY)return tY(tg,!0);if(tE)return tE(tg,!0);throw new Error("Cannot find module '"+tg+"'")}var tT=ta[tg]={exports:{}};ts[tg][0].call(tT.exports,function(tD){var tY=ts[tg][1][tD];return tM(tY||tD)},tT,tT.exports,tr,ts,ta,tW)}return ta[tg].exports}for(var tE="function"==typeof require&&require,tD=0;tD<tW.length;tD++)tM(tW[tD]);return tM}({1:[function(tD,tY,tg){function tM(tD,tY,tg){tg=tg||0;var tT,tr,ts,ta,tW,tM,tE,tI=[0,0];return tT=tD[1][1]-tD[0][1],tr=tD[0][0]-tD[1][0],ts=tT*tD[0][0]+tr*tD[0][1],ta=tY[1][1]-tY[0][1],tW=tY[0][0]-tY[1][0],tM=ta*tY[0][0]+tW*tY[0][1],tJ(tE=tT*tW-ta*tr,0,tg)||(tI[0]=(tW*ts-tr*tM)/tE,tI[1]=(tT*tM-ta*ts)/tE),tI}function tr(tD,tY,tg,tT){var tr=tY[0]-tD[0],ts=tY[1]-tD[1],ta=tT[0]-tg[0],tW=tT[1]-tg[1];if(ta*ts-tW*tr==0)return!1;var tM=(tr*(tg[1]-tD[1])+ts*(tD[0]-tg[0]))/(ta*ts-tW*tr),tE=(ta*(tD[1]-tg[1])+tW*(tg[0]-tD[0]))/(tW*tr-ta*ts);return 0<=tM&&tM<=1&&0<=tE&&tE<=1}function tE(tD,tY,tg){return(tY[0]-tD[0])*(tg[1]-tD[1])-(tg[0]-tD[0])*(tY[1]-tD[1])}function tA(tD,tY,tg){return 0<tE(tD,tY,tg)}function tq(tD,tY,tg){return 0<=tE(tD,tY,tg)}function tb(tD,tY,tg){return tE(tD,tY,tg)<0}function tG(tD,tY,tg){return tE(tD,tY,tg)<=0}tY.exports={decomp:function(tD){var tY=function tD(tY){var tg=[],tT=[],tr=[],ts=[];var ta=Number.MAX_VALUE;for(var tW=0;tW<tY.length;++tW)if(th(tY,tW))for(var tM=0;tM<tY.length;++tM)if(t$(tY,tW,tM)){tT=tD(td(tY,tW,tM,ts)),tr=tD(td(tY,tM,tW,ts));for(var tE=0;tE<tr.length;tE++)tT.push(tr[tE]);tT.length<ta&&(ta=(tg=tT).length,tg.push([tz(tY,tW),tz(tY,tM)]))}return tg}(tD);return 0<tY.length?function tD(tY,tg){if(0===tg.length)return[tY];{if(tg instanceof Array&&tg.length&&tg[0]instanceof Array&&2===tg[0].length&&tg[0][0]instanceof Array){for(var tT=[tY],tr=0;tr<tg.length;tr++)for(var ts=tg[tr],ta=0;ta<tT.length;ta++){var tW=tT[ta],tM=tD(tW,ts);if(tM){tT.splice(ta,1),tT.push(tM[0],tM[1]);break}}return tT}var ts=tg,tr=tY.indexOf(ts[0]),ta=tY.indexOf(ts[1]);return-1!==tr&&-1!==ta&&[td(tY,tr,ta),td(tY,ta,tr)]}}(tD,tY):[tD]},quickDecomp:function tD(tY,tg,tT,tr,ts,ta,tW){ta=ta||100;tW=tW||0;ts=ts||25;tg=void 0!==tg?tg:[];tT=tT||[];tr=tr||[];var tM=[0,0],tE=[0,0],tI=[0,0];var tO=0,tC=0,tN=0,t$=0;var td=0,tJ=0,tx=0;var tj=[],tZ=[];var tp=tY,tl=tY;if(tl.length<3)return tg;tW++;if(ta<tW)return console.warn("quickDecomp: max level ("+ta+") reached."),tg;for(var tt=0;tt<tY.length;++tt)if(th(tp,tt)){tT.push(tp[tt]),tO=tC=Number.MAX_VALUE;for(var t_=0;t_<tY.length;++t_)tA(tz(tp,tt-1),tz(tp,tt),tz(tp,t_))&&tG(tz(tp,tt-1),tz(tp,tt),tz(tp,t_-1))&&(tI=tP(tz(tp,tt-1),tz(tp,tt),tz(tp,t_),tz(tp,t_-1)),tb(tz(tp,tt+1),tz(tp,tt),tI)&&(tN=tX(tp[tt],tI))<tC&&(tC=tN,tE=tI,tJ=t_)),tA(tz(tp,tt+1),tz(tp,tt),tz(tp,t_+1))&&tG(tz(tp,tt+1),tz(tp,tt),tz(tp,t_))&&(tI=tP(tz(tp,tt+1),tz(tp,tt),tz(tp,t_),tz(tp,t_+1)),tA(tz(tp,tt-1),tz(tp,tt),tI)&&(tN=tX(tp[tt],tI))<tO&&(tO=tN,tM=tI,td=t_));if(tJ===(td+1)%tY.length)tI[0]=(tE[0]+tM[0])/2,tI[1]=(tE[1]+tM[1])/2,tr.push(tI),tt<td?(tm(tj,tp,tt,td+1),tj.push(tI),tZ.push(tI),0!==tJ&&tm(tZ,tp,tJ,tp.length),tm(tZ,tp,0,tt+1)):(0!==tt&&tm(tj,tp,tt,tp.length),tm(tj,tp,0,td+1),tj.push(tI),tZ.push(tI),tm(tZ,tp,tJ,tt+1));else{if(td<tJ&&(td+=tY.length),t$=Number.MAX_VALUE,td<tJ)return tg;for(var t_=tJ;t_<=td;++t_)tq(tz(tp,tt-1),tz(tp,tt),tz(tp,t_))&&tG(tz(tp,tt+1),tz(tp,tt),tz(tp,t_))&&(tN=tX(tz(tp,tt),tz(tp,t_)))<t$&&ti(tp,tt,t_)&&(t$=tN,tx=t_%tY.length);tt<tx?(tm(tj,tp,tt,tx+1),0!==tx&&tm(tZ,tp,tx,tl.length),tm(tZ,tp,0,tt+1)):(0!==tt&&tm(tj,tp,tt,tl.length),tm(tj,tp,0,tx+1),tm(tZ,tp,tx,tt+1))}return tj.length<tZ.length?(tD(tj,tg,tT,tr,ts,ta,tW),tD(tZ,tg,tT,tr,ts,ta,tW)):(tD(tZ,tg,tT,tr,ts,ta,tW),tD(tj,tg,tT,tr,ts,ta,tW)),tg}tg.push(tY);return tg},isSimple:function(tD){var tY,tg=tD;for(tY=0;tY<tg.length-1;tY++)for(var tT=0;tT<tY-1;tT++)if(tr(tg[tY],tg[tY+1],tg[tT],tg[tT+1]))return!1;for(tY=1;tY<tg.length-2;tY++)if(tr(tg[0],tg[tg.length-1],tg[tY],tg[tY+1]))return!1;return!0},removeCollinearPoints:function(tD,tY){for(var tg=0,tT=tD.length-1;3<tD.length&&0<=tT;--tT)ts(tz(tD,tT-1),tz(tD,tT),tz(tD,tT+1),tY)&&(tD.splice(tT%tD.length,1),tg++);return tg},removeDuplicatePoints:function(tD,tY){for(var tg=tD.length-1;1<=tg;--tg)for(var tT=tD[tg],tr=tg-1;0<=tr;--tr)ts=tT,ta=tD[tr],tW=tY,tJ(ts[0],ta[0],tW)&&tJ(ts[1],ta[1],tW)&&tD.splice(tg,1);var ts,ta,tW},makeCCW:function(tD){for(var tY=0,tg=tD,tT=1;tT<tD.length;++tT)(tg[tT][1]<tg[tY][1]||tg[tT][1]===tg[tY][1]&&tg[tT][0]>tg[tY][0])&&(tY=tT);return!tA(tz(tD,tY-1),tz(tD,tY),tz(tD,tY+1))&&(function(tD){for(var tY=[],tg=tD.length,tT=0;tT!==tg;tT++)tY.push(tD.pop());for(var tT=0;tT!==tg;tT++)tD[tT]=tY[tT]}(tD),!0)}};var tI=[],tO=[];function ts(tD,tY,tg,tT){if(tT){var tr=tI,ts=tO;tr[0]=tY[0]-tD[0],tr[1]=tY[1]-tD[1],ts[0]=tg[0]-tY[0],ts[1]=tg[1]-tY[1];var ta=tr[0]*ts[0]+tr[1]*ts[1],tW=Math.sqrt(tr[0]*tr[0]+tr[1]*tr[1]),tM=Math.sqrt(ts[0]*ts[0]+ts[1]*ts[1]);return Math.acos(ta/(tW*tM))<tT}return 0===tE(tD,tY,tg)}function tX(tD,tY){var tg=tY[0]-tD[0],tT=tY[1]-tD[1];return tg*tg+tT*tT}function tz(tD,tY){var tg=tD.length;return tD[tY<0?tY%tg+tg:tY%tg]}function tm(tD,tY,tg,tT){for(var tr=tg;tr<tT;tr++)tD.push(tY[tr])}function th(tD,tY){return tb(tz(tD,tY-1),tz(tD,tY),tz(tD,tY+1))}var tC=[],tN=[];function t$(tD,tY,tg){var tT,tr,ts=tC,ta=tN;if(tq(tz(tD,tY+1),tz(tD,tY),tz(tD,tg))&&tG(tz(tD,tY-1),tz(tD,tY),tz(tD,tg)))return!1;tr=tX(tz(tD,tY),tz(tD,tg));for(var tW=0;tW!==tD.length;++tW)if((tW+1)%tD.length!==tY&&tW!==tY&&tq(tz(tD,tY),tz(tD,tg),tz(tD,tW+1))&&tG(tz(tD,tY),tz(tD,tg),tz(tD,tW))&&(ts[0]=tz(tD,tY),ts[1]=tz(tD,tg),ta[0]=tz(tD,tW),ta[1]=tz(tD,tW+1),tT=tM(ts,ta),tX(tz(tD,tY),tT)<tr))return!1;return!0}function ti(tD,tY,tg){for(var tT=0;tT!==tD.length;++tT)if(tT!==tY&&tT!==tg&&(tT+1)%tD.length!==tY&&(tT+1)%tD.length!==tg&&tr(tz(tD,tY),tz(tD,tg),tz(tD,tT),tz(tD,tT+1)))return!1;return!0}function td(tD,tY,tg,tT){var tr=tT||[];if(function(tD){tD.length=0}(tr),tY<tg)for(var ts=tY;ts<=tg;ts++)tr.push(tD[ts]);else{for(ts=0;ts<=tg;ts++)tr.push(tD[ts]);for(ts=tY;ts<tD.length;ts++)tr.push(tD[ts])}return tr}function tP(tD,tY,tg,tT,tr){tr=tr||0;var ts=tY[1]-tD[1],ta=tD[0]-tY[0],tW=ts*tD[0]+ta*tD[1],tM=tT[1]-tg[1],tE=tg[0]-tT[0],tI=tM*tg[0]+tE*tg[1],tO=ts*tE-tM*ta;return tJ(tO,0,tr)?[0,0]:[(tE*tW-ta*tI)/tO,(ts*tI-tM*tW)/tO]}function tJ(tD,tY,tg){return tg=tg||0,Math.abs(tD-tY)<=tg}},{}]},{},[1])(1)}),function(){var tj={},tT=Matter.Common,tZ=Matter.Composite,tp=Matter.Bounds,tY=Matter.Events,tl=(Matter.Grid,Matter.Vector);tj.create=function(tD){var tY={controller:tj,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222222",hasBounds:!!tD.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},tg=tT.extend(tY,tD);return tg.mouse=tD.mouse,tg.engine=tD.engine,tg.container=tg.container||Laya.stage,tg.bounds=tg.bounds||{min:{x:0,y:0},max:{x:tg.width,y:tg.height}},tg},tj.run=function(tD){Laya.timer.frameLoop(1,this,tj.world,[tD]),tY.on(tD.engine.world,"afterRemove",tj.onRemoveSprite)},tj.stop=function(tD){Laya.timer.clear(this,tj.world),tY.off(tD.engine.world,"afterRemove",tj.onRemoveSprite)},tj.onRemoveSprite=function(tD){var tY=tD.object.layaSprite;tY&&tY.parent&&tY.parent.removeChild(tY)},tj.world=function(tD){var tY,tg=tD.engine.world,tT=(tD.renderer,tD.container),tr=tD.options,ts=tZ.allBodies(tg),ta=tZ.allConstraints(tg),tW=[];tr.wireframes?tj.setBackground(tD,tr.wireframeBackground):tj.setBackground(tD,tr.background);var tM=tD.bounds.max.x-tD.bounds.min.x,tE=tD.bounds.max.y-tD.bounds.min.y,tI=tM/tD.options.width,tO=tE/tD.options.height;if(tr.hasBounds){for(tY=0;tY<ts.length;tY++){var tC=ts[tY];tC.render.sprite.visible=tp.overlaps(tC.bounds,tD.bounds)}for(tY=0;tY<ta.length;tY++){var tN=ta[tY],t$=tN.bodyA,td=tN.bodyB,tJ=tN.pointA,tx=tN.pointB;t$&&(tJ=tl.add(t$.position,tN.pointA)),td&&(tx=tl.add(td.position,tN.pointB)),tJ&&tx&&((tp.contains(tD.bounds,tJ)||tp.contains(tD.bounds,tx))&&tW.push(tN))}tT.scale(1/tI,1/tO),tT.pos(-tD.bounds.min.x*(1/tI),-tD.bounds.min.y*(1/tO))}else tW=ta;for(tY=0;tY<ts.length;tY++)tj.body(tD,ts[tY]);for(tY=0;tY<tW.length;tY++)tj.constraint(tD,tW[tY])},tj.setBackground=function(tD,tY){if(tD.currentBackground!==tY){var tg=tY.indexOf&&-1!==tY.indexOf("#");tD.container.graphics.clear(),tg?tD.container.bgColor=tY:(tD.container.loadImage(tY),tD.container.bgColor="#FFFFFF"),tD.currentBackground=tY}},tj.body=function(tD,tY){tD.engine;var tg=tY.render;if(tg.visible){if(tg.sprite&&tg.sprite.texture){tY.id;var tT=tY.layaSprite,tr=tD.container;tT||(tT=tY.layaSprite=tM(tD,tY),tY.effPendant&&!tY.effPendant.parent&&tT.addChild(tY.effPendant)),tr.contains(tT)||(0<=tY.childIndex&&tY.childIndex<tr.numChildren?tr.addChildAt(tT,tY.childIndex):tr.addChild(tT)),tT.x=tY.position.x,tT.y=tY.position.y,tT.rotation=180*tY.angle/Math.PI,tT.scaleX=tg.sprite.xScale||1,tT.scaleY=tg.sprite.yScale||1,tT.width=tg.sprite.width,tT.height=tg.sprite.height,tg.sprite.sizeGrid&&(tT.sizeGrid=tg.sprite.sizeGrid)}else{tY.id,tT=tY.layaSprite,tr=tD.container;tT||((tT=tY.layaSprite=tE(tD,tY)).initialAngle=tY.angle,tY.effPendant&&!tY.effPendant.parent&&tT.addChild(tY.effPendant)),tr.contains(tT)||(0<=tY.childIndex&&tY.childIndex<tr.numChildren?tr.addChildAt(tT,tY.childIndex):tr.addChild(tT)),tT.x=tY.position.x,tT.y=tY.position.y,tT.rotation=180*(tY.angle-tT.initialAngle)/Math.PI}var ts=tY.text;if(ts){var ta=tT.lbl;ta||((ta=tT.lbl=new Laya.Label).fontSize=30,ta.anchorX=.5,ta.anchorY=.5,ta.color=tY.textClr?tY.textClr:"#ffffff",ta.strokeColor="#000000",ta.stroke=2,ta.centerX=0,ta.centerY=0,tT.addChild(ta),void 0!==tY.shapeType&&(0===tY.shapeType&&(ta.centerX=-10),2===tY.shapeType&&(ta.rotation=-tT.rotation)),ta.text=ts+"",tY.lbl=ta)}if(tY.pendant&&!tT.pendantSpr){var tW=new Laya.Image;tW.skin=tY.pendant,tT.addChild(tW),tT.pendantSpr=tW}}};var tM=function(tD,tY){var tg=tY.render.sprite.texture,tT=new Laya.Image;return tT.skin=tg,tT.pivotX=tY.render.sprite.xOffset,tT.pivotY=tY.render.sprite.yOffset,tT},tE=function(tD,tY){var tg,tT,tr,ts,ta=tY.render,tW=tD.options,tM=new Laya.Sprite,tE=tM.graphics;tE.clear();for(var tI=1<tY.parts.length?1:0;tI<tY.parts.length;tI++){ts=tY.parts[tI];var tO=[];tr=tW.wireframes?(tg=null,tT="#bbbbbb",1):(tg=ta.fillStyle,tT=ta.strokeStyle,ta.lineWidth),tO.push(ts.vertices[0].x-tY.position.x,ts.vertices[0].y-tY.position.y);for(var tC=1;tC<ts.vertices.length;tC++)tO.push(ts.vertices[tC].x-tY.position.x,ts.vertices[tC].y-tY.position.y);tO.push(ts.vertices[0].x-tY.position.x,ts.vertices[0].y-tY.position.y),tE.drawPoly(0,0,tO,tg,tT,tr),(tW.showAngleIndicator||tW.showAxes)&&(tr=1,tT=tW.wireframes?"#CD5C5C":ta.strokeStyle,tE.drawLine(ts.position.x-tY.position.x,ts.position.y-tY.position.y,(ts.vertices[0].x+ts.vertices[ts.vertices.length-1].x)/2-tY.position.x,(ts.vertices[0].y+ts.vertices[ts.vertices.length-1].y)/2-tY.position.y))}return tM};tj.constraint=function(tD,tY){tD.engine;var tg=tY.bodyA,tT=tY.bodyB,tr=tY.pointA,ts=tY.pointB,ta=tD.container,tW=tY.render,tM=(tY.id,tY.layaSprite);tM||(tM=tY.layaSprite=new Laya.Sprite);var tE,tI,tO,tC,tN=tM.graphics;tW.visible&&tY.pointA&&tY.pointB?(ta.contains(tM)||ta.addChild(tM),tN.clear(),tI=tg?(tE=tg.position.x+tr.x,tg.position.y+tr.y):(tE=tr.x,tr.y),tC=tT?(tO=tT.position.x+ts.x,tT.position.y+ts.y):(tO=ts.x,ts.y),tN.drawLine(tE,tI,tO,tC,tW.strokeStyle,tW.lineWidth)):tN.clear()},window.LayaRender=tj}();