!function(){var s={},d=Matter.Common,t=Matter.Composite,u=Matter.Bounds,b=Matter.Events,v=(Matter.Grid,Matter.Vector);s.create=function(a){var b={controller:s,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222222",hasBounds:!!a.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},c=d.extend(b,a);return c.mouse=a.mouse,c.engine=a.engine,c.container=c.container||Laya.stage,c.bounds=c.bounds||{min:{x:0,y:0},max:{x:c.width,y:c.height}},c},s.run=function(a){Laya.timer.frameLoop(1,this,s.world,[a]),b.on(a.engine.world,"afterRemove",s.onRemoveSprite)},s.stop=function(a){Laya.timer.clear(this,s.world),b.off(a.engine.world,"afterRemove",s.onRemoveSprite)},s.onRemoveSprite=function(a){var b=a.object.layaSprite;b&&b.parent&&b.parent.removeChild(b)},s.world=function(a){var b,c=a.engine.world,d=(a.renderer,a.container),e=a.options,f=t.allBodies(c),g=t.allConstraints(c),h=[];e.wireframes?s.setBackground(a,e.wireframeBackground):s.setBackground(a,e.background);var i=a.bounds.max.x-a.bounds.min.x,j=a.bounds.max.y-a.bounds.min.y,k=i/a.options.width,l=j/a.options.height;if(e.hasBounds){for(b=0;b<f.length;b++){var m=f[b];m.render.sprite.visible=u.overlaps(m.bounds,a.bounds)}for(b=0;b<g.length;b++){var n=g[b],o=n.bodyA,p=n.bodyB,q=n.pointA,r=n.pointB;o&&(q=v.add(o.position,n.pointA)),p&&(r=v.add(p.position,n.pointB)),q&&r&&((u.contains(a.bounds,q)||u.contains(a.bounds,r))&&h.push(n))}d.scale(1/k,1/l),d.pos(-a.bounds.min.x*(1/k),-a.bounds.min.y*(1/l))}else h=g;for(b=0;b<f.length;b++)s.body(a,f[b]);for(b=0;b<h.length;b++)s.constraint(a,h[b])},s.setBackground=function(a,b){if(a.currentBackground!==b){var c=b.indexOf&&-1!==b.indexOf("#");a.container.graphics.clear(),c?a.container.bgColor=b:(a.container.loadImage(b),a.container.bgColor="#FFFFFF"),a.currentBackground=b}},s.body=function(a,b){a.engine;var c=b.render;if(c.visible){if(c.sprite&&c.sprite.texture){b.id;var d=b.layaSprite,e=a.container;d||(d=b.layaSprite=i(a,b),b.effPendant&&!b.effPendant.parent&&d.addChild(b.effPendant)),e.contains(d)||e.addChild(d),d.x=b.position.x,d.y=b.position.y,d.rotation=180*b.angle/Math.PI,d.scaleX=c.sprite.xScale||1,d.scaleY=c.sprite.yScale||1,d.width=c.sprite.width,d.height=c.sprite.height,c.sprite.sizeGrid&&(d.sizeGrid=c.sprite.sizeGrid)}else{b.id,d=b.layaSprite,e=a.container;d||((d=b.layaSprite=j(a,b)).initialAngle=b.angle,b.effPendant&&!b.effPendant.parent&&d.addChild(b.effPendant)),e.contains(d)||e.addChild(d),d.x=b.position.x,d.y=b.position.y,d.rotation=180*(b.angle-d.initialAngle)/Math.PI}var f=b.text;if(f){var g=d.lbl;g||((g=d.lbl=new Laya.Label).fontSize=30,g.anchorX=.5,g.anchorY=.5,g.color=b.textClr?b.textClr:"#ffffff",g.strokeColor="#000000",g.stroke=2,g.centerX=0,g.centerY=0,d.addChild(g),void 0!==b.shapeType&&(0===b.shapeType&&(g.centerX=-10),2===b.shapeType&&(g.rotation=-d.rotation)),g.text=f+"",b.lbl=g)}if(b.pendant&&!d.pendantSpr){var h=new Laya.Image;h.skin=b.pendant,d.addChild(h),d.pendantSpr=h}}};var i=function(a,b){var c=b.render.sprite.texture,d=new Laya.Image;return d.skin=c,d.pivotX=b.render.sprite.xOffset,d.pivotY=b.render.sprite.yOffset,d},j=function(a,b){var c,d,e,f,g=b.render,h=a.options,i=new Laya.Sprite,j=i.graphics;j.clear();for(var k=1<b.parts.length?1:0;k<b.parts.length;k++){f=b.parts[k];var l=[];e=h.wireframes?(c=null,d="#bbbbbb",1):(c=g.fillStyle,d=g.strokeStyle,g.lineWidth),l.push(f.vertices[0].x-b.position.x,f.vertices[0].y-b.position.y);for(var m=1;m<f.vertices.length;m++)l.push(f.vertices[m].x-b.position.x,f.vertices[m].y-b.position.y);l.push(f.vertices[0].x-b.position.x,f.vertices[0].y-b.position.y),j.drawPoly(0,0,l,c,d,e),(h.showAngleIndicator||h.showAxes)&&(e=1,d=h.wireframes?"#CD5C5C":g.strokeStyle,j.drawLine(f.position.x-b.position.x,f.position.y-b.position.y,(f.vertices[0].x+f.vertices[f.vertices.length-1].x)/2-b.position.x,(f.vertices[0].y+f.vertices[f.vertices.length-1].y)/2-b.position.y))}return i};s.constraint=function(a,b){a.engine;var c=b.bodyA,d=b.bodyB,e=b.pointA,f=b.pointB,g=a.container,h=b.render,i=(b.id,b.layaSprite);i||(i=b.layaSprite=new Laya.Sprite);var j,k,l,m,n=i.graphics;h.visible&&b.pointA&&b.pointB?(g.contains(i)||g.addChild(i),n.clear(),k=c?(j=c.position.x+e.x,c.position.y+e.y):(j=e.x,e.y),m=d?(l=d.position.x+f.x,d.position.y+f.y):(l=f.x,f.y),n.drawLine(j,k,l,m,h.strokeStyle,h.lineWidth)):n.clear()},window.LayaRender=s}();