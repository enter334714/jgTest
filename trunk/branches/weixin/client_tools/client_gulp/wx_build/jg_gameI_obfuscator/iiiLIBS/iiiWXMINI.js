var Q=wx.$I;!function(t,o){o.un,o.uns;var n=o.static,e=o.class,a=o.getset,l=(o.__newvec,laya.utils.Browser),r=(laya.events.Event,laya.events.EventDispatcher),f=laya.resource.HTMLImage,d=laya.utils.Handler,i=laya.display.Input,c=laya.net.Loader,p=(laya.maths.Matrix,laya.renders.Render),h=laya.utils.RunDriver,g=(laya.media.Sound,laya.media.SoundChannel),_=laya.media.SoundManager,v=(laya.display.Stage,laya.net.URL),m=laya.utils.Utils,s=(e(_apf8j,"laya.wx.mini.MiniAdpter"),_apf8j.getJson=function(n){return JSON.parse(n)},_apf8j.init=function(n,e){void 0===n&&(n=!1),void 0===e&&(e=!1),_apf8j._inited||(_apf8j.window=t).navigator.userAgent.indexOf("MiniGame")<0||(_apf8j._inited=!0,_apf8j.isZiYu=e,_apf8j.isPosMsgYu=n,_apf8j.EnvConfig={},_apf8j.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,d.create(_apf8j,_apf8j.onMkdirCallBack))),_apf8j.window.focus=function(){},o.getUrlPath=function(){},_apf8j.window.logtime=function(n){},_apf8j.window.alertTimeLog=function(n){},_apf8j.window.resetShareInfo=function(){},_apf8j.window.CanvasRenderingContext2D=function(){},_apf8j.window.CanvasRenderingContext2D.prototype=_apf8j.window.wx.createCanvas().getContext("2d").__proto__,_apf8j.window.document.body.appendChild=function(){},_apf8j.EnvConfig.pixelRatioInt=0,h.getPixelRatio=_apf8j.pixelRatio,_apf8j._preCreateElement=l.createElement,l.createElement=_apf8j.createElement,h.createShaderCondition=_apf8j.createShaderCondition,m.parseXMLFromString=_apf8j.parseXMLFromString,i._createInputElement=y._createInputElement,_apf8j.EnvConfig.load=c.prototype.load,c.prototype.load=x.prototype.load,_apf8j.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(u.ziyuFileData[n.url]=n.data)}))},_apf8j.onMkdirCallBack=function(n,e){n||(u.filesListObj=JSON.parse(e.data))},_apf8j.pixelRatio=function(){if(!_apf8j.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return _apf8j.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return _apf8j.EnvConfig.pixelRatioInt},_apf8j.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?_apf8j.onCreateInput(n):"div"==n?((i=_apf8j._preCreateElement(n)).contains=function(n){return null},i.removeChild=function(n){},i):_apf8j._preCreateElement(n):(1==_apf8j.idx?_apf8j.isZiYu?(e=sharedCanvas).style={}:e=t.canvas:e=t.wx.createCanvas(),_apf8j.idx++,e);var e;var i},_apf8j.onCreateInput=function(n){n=_apf8j._preCreateElement(n);return n.focus=y.wxinputFocus,n.blur=y.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},_apf8j.createShaderCondition=function(n){var e=this;return function(){return e[n.replace("this.","")]}},_apf8j.EnvConfig=null,_apf8j.window=null,_apf8j._preCreateElement=null,_apf8j._inited=!1,_apf8j.wxRequest=null,_apf8j.systemInfo=null,_apf8j.version="0.0.1",_apf8j.isZiYu=!1,_apf8j.isPosMsgYu=!1,_apf8j.parseXMLFromString=function(n){var e;n=n.replace(/>\s+</g,"><");try{e=(new t.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return e},_apf8j.idx=1,_apf8j),y=(e(c8j,"laya.wx.mini.MiniImage"),c8j.prototype._loadImage=function(n){var e=!1;-1==n.indexOf("layaNativeDir/")&&(e=!0,n=v.formatURL(n)),u.getFileInfo(n)?c8j.onCreateImage(n,this,!e):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?u.downImg(n,new d(c8j,c8j.onDownImgCallBack,[n,this]),n):c8j.onCreateImage(n,this,!0)},c8j.onDownImgCallBack=function(n,e,i){i?e.onError(null):c8j.onCreateImage(n,e)},c8j.onCreateImage=function(e,i,n){var t;function vmp1cf(){t.onload=null,t.onerror=null,delete i.imgCache[e]}n=(n=void 0===n?!1:n)?e:(n=u.getFileInfo(e).md5,u.getFileNativePath(n)),null==i.imgCache&&(i.imgCache={});function ya(){vmp1cf(),i.onLoaded(t)}function za(){vmp1cf(),i.event("error","Load image failed")}"nativeimage"==i._type?((t=new l.window.Image).crossOrigin="",t.onload=ya,t.onerror=za,t.src=n,i.imgCache[e]=t):new f.create(n,{onload:ya,onerror:za,onCreate:function(n){t=n,i.imgCache[e]=n}})},e(nhx54,"laya.wx.mini.MiniInput"),nhx54._createInputElement=function(){i._initInput(i.area=l.createElement("textarea")),i._initInput(i.input=l.createElement("input")),i.inputContainer=l.createElement("div"),i.inputContainer.style.position="absolute",i.inputContainer.style.zIndex=1e5,l.container.appendChild(i.inputContainer),i.inputContainer.setPos=function(n,e){i.inputContainer.style.left=n+"px",i.inputContainer.style.top=e+"px"},o.stage.on("resize",null,nhx54._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){t.dispatchEvent&&t.dispatchEvent("resize")}),_._soundClass=w,_._musicClass=w},nhx54._onStageResize=function(){o.stage._canvasTransform.identity().scale(l.width/p.canvas.width/h.getPixelRatio(),l.height/p.canvas.height/h.getPixelRatio())},nhx54.wxinputFocus=function(n){var e=i.inputElement.target;e&&!e.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),s.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"";e.text=n,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(n){n=n?n.value:"";e.multiline||-1==n.indexOf("\n")?(e.text=n,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},nhx54.inputEnter=function(){i.inputElement.target.focus=!1},nhx54.wxinputblur=function(){nhx54.hideKeyboard()},nhx54.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},nhx54),x=(e(e3bs7,"laya.wx.mini.MiniLoader"),(z=e3bs7.prototype).load=function(n,e,i,t,a){void 0===i&&(i=!0),void 0===a&&(a=!1);var o=this;0===(o._url=n).indexOf("data:image")?o._type=e="image":o._type=e=e||o.getTypeFromUrl(n),o._cache=i,o._data=null;var l="ascii";-1!=n.indexOf(".fnt")?l="utf8":"arraybuffer"==e&&(l="");var r=m.getFileExtension(n);if(-1!=e3bs7._fileTypeArr.indexOf(r))s.EnvConfig.load.call(this,n,e,i,t,a);else if(u.getFileInfo(n))s.EnvConfig.load.call(this,n,e,i,t,a);else{if(-1!=n.indexOf("layaNativeDir/"))return s.isZiYu?(r=u.ziyuFileData[n],void o.onLoaded(r)):(cosnole.log("read read"),void u.read(n,l,new d(e3bs7,e3bs7.onReadNativeCallBack,[l,n,e,i,t,a,o])));r=""==v.rootPath?n:n.split(v.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?s.EnvConfig.load.call(o,n,e,i,t,a):u.readFile(r,l,new d(e3bs7,e3bs7.onReadNativeCallBack,[l,n,e,i,t,a,o]),n)}},z.resMgrLoad=function(n,t,e,i,a,o,l){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===l&&(l=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),s.EnvConfig.resMgrLoad(n,(n,e,i)=>{e3bs7.prototype.resMgrLoadCallBack(n,e,i,t)},e,i,a,o,l)},z.resMgrLoadCallBack=function(n,e,i,t){console.log("buff:::",n,i,u.fileNativeDir+"///"+u.fileListName),t(n,e,i)},z.clearRes=function(n,e){this.clearRes(n,e=void 0===e?!1:e);e=u.getFileInfo(n);!e||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=e.md5,e=u.getFileNativePath(n),u.remove(e))},e3bs7.onReadNativeCallBack=function(n,e,i,t,a,o,l,r,u){void 0===t&&(t=!0),void 0===o&&(o=!1),(r=void 0===r?0:r)?1==r&&s.EnvConfig.load.call(l,e,i,t,a,o):(r="json"==i||"atlas"==i?s.getJson(u.data):"xml"==i?m.parseXMLFromString(u.data):u.data,l.onLoaded(r),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:e,data:r,isLoad:!0}))},n(e3bs7,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),e3bs7),u=(e(l0zog$,"laya.wx.mini.MiniFileMgr",r),l0zog$.isLoadFile=function(n){return-1!=l0zog$._fileTypeArr.indexOf(n)},l0zog$.getFileInfo=function(n){n=n.split("?")[0],n=l0zog$.filesListObj[n];return null==n?null:n},l0zog$.onFileUpdate=function(n,e){var n=n.split("/"),n=n[n.length-1],i=l0zog$.getFileInfo(e);null==i?l0zog$.onSaveFile(e,n):i.readyUrl!=e&&l0zog$.remove(n,e)},l0zog$.exits=function(n,e){n=l0zog$.getFileNativePath(n);l0zog$.fs.getFileInfo({filePath:n,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){null!=e&&e.runWith([1,n])}})},l0zog$.read=function(n,e,i,t){void 0===e&&(e="ascill"),n=""!=(t=void 0===t?"":t)?l0zog$.getFileNativePath(n):n,l0zog$.fs.readFile({filePath:n,encoding:e,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){n&&""!=t?l0zog$.down(t,e,i,t):null!=i&&i.runWith([1])}})},l0zog$.readNativeFile=function(n,e){l0zog$.fs.readFile({filePath:n,encoding:"",success:function(n){null!=e&&e.runWith([0])},fail:function(n){null!=e&&e.runWith([1])}})},l0zog$.down=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t="");var a=l0zog$.getFileNativePath(t);l0zog$.wxdown({url:n,filePath:a,success:function(n){200===n.statusCode&&l0zog$.readFile(n.filePath,e,i,t)},fail:function(n){null!=i&&i.runWith([1,n])}}).onProgressUpdate(function(n){null!=i&&i.runWith([2,n.progress])})},l0zog$.readFile=function(e,n,i,t){void 0===t&&(t=""),l0zog$.fs.readFile({filePath:e,encoding:n=void 0===n?"ascill":n,success:function(n){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||l0zog$.onFileUpdate(e,t),null!=i&&i.runWith([0,n])},fail:function(n){n&&null!=i&&i.runWith([1,n])}})},l0zog$.downImg=function(n,e,i){void 0===i&&(i="");l0zog$.wxdown({url:n,success:function(n){200===n.statusCode&&l0zog$.copyFile(n.tempFilePath,i,e)},fail:function(n){null!=e&&e.runWith([1,n])}})},l0zog$.copyFile=function(n,e,i){var t=n.split("/"),a=t[t.length-1],o=(e.split("?")[0],l0zog$.getFileInfo(e)),t=l0zog$.getFileNativePath(a);l0zog$.fs.copyFile({srcPath:n,destPath:t,success:function(n){o?o.readyUrl!=e&&l0zog$.remove(a,e,i):(l0zog$.onSaveFile(e,a),null!=i&&i.runWith([0]))},fail:function(n){null!=i&&i.runWith([1,n])}})},l0zog$.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},l0zog$.remove=function(e,i,t){void 0===i&&(i="");var n=l0zog$.getFileInfo(i),a=l0zog$.getFileNativePath(n.md5);o.loader.clearRes(n.readyUrl),l0zog$.fs.unlink({filePath:a,success:function(n){""!=i&&l0zog$.onSaveFile(i,e),null!=t&&t.runWith([0])},fail:function(n){}})},l0zog$.onSaveFile=function(n,e){var i=n.split("?")[0];l0zog$.filesListObj[i]={md5:e,readyUrl:n},l0zog$.fs.writeFile({filePath:l0zog$.fileNativeDir+"/"+l0zog$.fileListName,encoding:"utf8",data:JSON.stringify(l0zog$.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},l0zog$.existDir=function(n,e){l0zog$.fs.mkdir({dirPath:n,success:function(n){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?l0zog$.readSync(l0zog$.fileListName,"utf8",e):null!=e&&e.runWith([1,n])}})},l0zog$.readSync=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t="");var a,e=l0zog$.getFileNativePath(n);try{a=l0zog$.fs.readFileSync(e),null!=i&&i.runWith([0,{data:a}])}catch(n){null!=i&&i.runWith([1])}},l0zog$.readCache=function(){},l0zog$.writeCache=function(n){var e=readyUrl.split("?")[0];l0zog$.filesListObj[e]={md5:md5Name,readyUrl:readyUrl},l0zog$.fs.writeFile({filePath:l0zog$.fileNativeDir+"/"+l0zog$.fileListName,encoding:"utf8",data:JSON.stringify(l0zog$.filesListObj),success:function(n){},fail:function(n){}})},l0zog$.setNativeFileDir=function(n){l0zog$.fileNativeDir=wx.env.USER_DATA_PATH+n},l0zog$.filesListObj={},l0zog$.fileNativeDir=null,l0zog$.fileListName="layaairfiles.txt",l0zog$.ziyuFileData={},n(l0zog$,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),l0zog$),w=(e(eba367,"laya.wx.mini.MiniSound",r),(z=eba367.prototype).load=function(n){var e=this;var i;function f18c_(){if(null!=eba367._null)e._sound.onCanplay(eba367._null),e._sound.onError(eba367._null);else try{e._sound.onCanplay(null),e._sound.onError(null),eba367._null=null}catch(n){console.warn("[wxmini] _clearSound:"+n),e._sound.onCanplay(hxn45),e._sound.onError(hxn45),eba367._null=hxn45}}function hxn45(){}n=v.formatURL(n),this.url=n,eba367._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){f18c_(),i.loaded=!0,i.event("complete"),eba367._audioCache[i.url]=i}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),f18c_(),i.event("error")}),this._sound.src=n,i=this)},z.play=function(n,e){void 0===n&&(n=0),void 0===e&&(e=0),(i=this.url==_._tMusic?(eba367._musicAudio||(eba367._musicAudio=eba367._createSound()),eba367._musicAudio):eba367._createSound()).src=this.url;var i=new C(i);return i.url=this.url,i.loops=e,i.startTime=n,i.play(),_.addChannel(i),i},z.dispose=function(){var n=eba367._audioCache[this.url];n&&(n.src="",delete eba367._audioCache[this.url])},a(0,z,"duration",function(){return this._sound.duration}),eba367._createSound=function(){return eba367._id++,s.window.wx.createInnerAudioContext()},eba367._musicAudio=null,eba367._id=0,eba367._audioCache={},eba367._null=void 0,eba367),C=(e(lti9$,"laya.wx.mini.MiniSoundChannel",g),(n=lti9$.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(o.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,_.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){if(this.isStopped=!0,_.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=lti9$._null)this._audio.onEnded(lti9$._null);else try{this._audio.onEnded(null),lti9$._null=null}catch(n){console.warn("[wxmini] stop:"+n),this._audio.onEnded(m.bind(this.__onNull,this)),lti9$._null=m.bind(this.__onNull,this)}this._audio=null}},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,_.addChannel(this),this._audio.play())},a(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,n,"duration",function(){return this._audio?this._audio.duration:0}),a(0,n,"volume",function(){return 1},function(n){}),lti9$._null=void 0,lti9$);function lti9$(n){this._audio=null,this._onEnd=null,lti9$.__super.call(this),this._audio=n,this._onEnd=m.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function eba367(){this._sound=null,this.url=null,this.loaded=!1,eba367.__super.call(this),this._sound=eba367._createSound()}function l0zog$(){l0zog$.__super.call(this)}function e3bs7(){}var z;function nhx54(){}function c8j(){}function _apf8j(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var t=Laya[i];t&&t.__isclass&&(e[i]=t)}});