var W=wx.$l;!function(e,a){a.un,a.uns;var t=a.static,n=a.class,o=a.getset,l=(a.__newvec,laya.utils.Browser),r=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,i=laya.display.Input,h=laya.net.Loader,f=(laya.maths.Matrix,laya.renders.Render),m=laya.utils.RunDriver,p=(laya.media.Sound,laya.media.SoundChannel),v=laya.media.SoundManager,g=(laya.display.Stage,laya.net.URL),w=laya.utils.Utils,u=(n(omt0,"laya.wx.mini.MiniAdpter"),omt0.getJson=function(t){return JSON.parse(t)},omt0.init=function(t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),omt0._inited||(omt0.window=e).navigator.userAgent.indexOf("MiniGame")<0||(omt0._inited=!0,omt0.isZiYu=n,omt0.isPosMsgYu=t,omt0.EnvConfig={},omt0.isZiYu||(s.setNativeFileDir("/layaairGame"),s.existDir(s.fileNativeDir,c.create(omt0,omt0.onMkdirCallBack))),omt0.window.focus=function(){},a.getUrlPath=function(){},omt0.window.logtime=function(t){},omt0.window.alertTimeLog=function(t){},omt0.window.resetShareInfo=function(){},omt0.window.CanvasRenderingContext2D=function(){},omt0.window.CanvasRenderingContext2D.prototype=omt0.window.wx.createCanvas().getContext("2d").__proto__,omt0.window.document.body.appendChild=function(){},omt0.EnvConfig.pixelRatioInt=0,m.getPixelRatio=omt0.pixelRatio,omt0._preCreateElement=l.createElement,l.createElement=omt0.createElement,m.createShaderCondition=omt0.createShaderCondition,w.parseXMLFromString=omt0.parseXMLFromString,i._createInputElement=y._createInputElement,omt0.EnvConfig.load=h.prototype.load,h.prototype.load=_.prototype.load,omt0.isZiYu&&t&&wx.onMessage(function(t){t.isLoad&&(s.ziyuFileData[t.url]=t.data)}))},omt0.onMkdirCallBack=function(t,n){t||(s.filesListObj=JSON.parse(n.data))},omt0.pixelRatio=function(){if(!omt0.EnvConfig.pixelRatioInt)try{var t=wx.getSystemInfoSync();return omt0.EnvConfig.pixelRatioInt=t.pixelRatio,t.pixelRatio}catch(t){}return omt0.EnvConfig.pixelRatioInt},omt0.createElement=function(t){return"canvas"!=t?"textarea"==t||"input"==t?omt0.onCreateInput(t):"div"==t?((i=omt0._preCreateElement(t)).contains=function(t){return null},i.removeChild=function(t){},i):omt0._preCreateElement(t):(1==omt0.idx?omt0.isZiYu?(n=sharedCanvas).style={}:n=e.canvas:n=e.wx.createCanvas(),omt0.idx++,n);var n;var i},omt0.onCreateInput=function(t){t=omt0._preCreateElement(t);return t.focus=y.wxinputFocus,t.blur=y.wxinputblur,t.style={},t.value=0,t.parentElement={},t.placeholder={},t.type={},t.setColor=function(t){},t.setType=function(t){},t.setFontFace=function(t){},t.addEventListener=function(t){},t.contains=function(t){return null},t.removeChild=function(t){},t},omt0.createShaderCondition=function(t){var n=this;return function(){return n[t.replace("this.","")]}},omt0.EnvConfig=null,omt0.window=null,omt0._preCreateElement=null,omt0._inited=!1,omt0.wxRequest=null,omt0.systemInfo=null,omt0.version="0.0.1",omt0.isZiYu=!1,omt0.isPosMsgYu=!1,omt0.parseXMLFromString=function(t){var n;t=t.replace(/>\s+</g,"><");try{n=(new e.Parser.DOMParser).parseFromString(t,"text/xml")}catch(t){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},omt0.idx=1,omt0),y=(n(psqoh4,"laya.wx.mini.MiniImage"),psqoh4.prototype._loadImage=function(t){var n=!1;-1==t.indexOf("layaNativeDir/")&&(n=!0,t=g.formatURL(t)),s.getFileInfo(t)?psqoh4.onCreateImage(t,this,!n):-1!=t.indexOf("http://")||-1!=t.indexOf("https://")?s.downImg(t,new c(psqoh4,psqoh4.onDownImgCallBack,[t,this]),t):psqoh4.onCreateImage(t,this,!0)},psqoh4.onDownImgCallBack=function(t,n,i){i?n.onError(null):psqoh4.onCreateImage(t,n)},psqoh4.onCreateImage=function(n,i,t){var e;function o$qm(){e.onload=null,e.onerror=null,delete i.imgCache[n]}t=(t=void 0===t?!1:t)?n:(t=s.getFileInfo(n).md5,s.getFileNativePath(t)),null==i.imgCache&&(i.imgCache={});function ya(){o$qm(),i.onLoaded(e)}function za(){o$qm(),i.event("error","Load image failed")}"nativeimage"==i._type?((e=new l.window.Image).crossOrigin="",e.onload=ya,e.onerror=za,e.src=t,i.imgCache[n]=e):new d.create(t,{onload:ya,onerror:za,onCreate:function(t){e=t,i.imgCache[n]=t}})},n(sh4,"laya.wx.mini.MiniInput"),sh4._createInputElement=function(){i._initInput(i.area=l.createElement("textarea")),i._initInput(i.input=l.createElement("input")),i.inputContainer=l.createElement("div"),i.inputContainer.style.position="absolute",i.inputContainer.style.zIndex=1e5,l.container.appendChild(i.inputContainer),i.inputContainer.setPos=function(t,n){i.inputContainer.style.left=t+"px",i.inputContainer.style.top=n+"px"},a.stage.on("resize",null,sh4._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(t){e.dispatchEvent&&e.dispatchEvent("resize")}),v._soundClass=x,v._musicClass=x},sh4._onStageResize=function(){a.stage._canvasTransform.identity().scale(l.width/f.canvas.width/m.getPixelRatio(),l.height/f.canvas.height/m.getPixelRatio())},sh4.wxinputFocus=function(t){var n=i.inputElement.target;n&&!n.editable||(u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(t){},fail:function(t){}}),u.window.wx.onKeyboardConfirm(function(t){t=t?t.value:"";n.text=t,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),u.window.wx.onKeyboardInput(function(t){t=t?t.value:"";n.multiline||-1==t.indexOf("\n")?(n.text=t,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},sh4.inputEnter=function(){i.inputElement.target.focus=!1},sh4.wxinputblur=function(){sh4.hideKeyboard()},sh4.hideKeyboard=function(){u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.hideKeyboard({success:function(t){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(t){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(t?t.errMsg:""))}})},sh4),_=(n(ce7wnr,"laya.wx.mini.MiniLoader"),($=ce7wnr.prototype).load=function(t,n,i,e,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var a=this;0===(a._url=t).indexOf("data:image")?a._type=n="image":a._type=n=n||a.getTypeFromUrl(t),a._cache=i,a._data=null;var l="ascii";-1!=t.indexOf(".fnt")?l="utf8":"arraybuffer"==n&&(l="");var r=w.getFileExtension(t);if(-1!=ce7wnr._fileTypeArr.indexOf(r))u.EnvConfig.load.call(this,t,n,i,e,o);else if(s.getFileInfo(t))u.EnvConfig.load.call(this,t,n,i,e,o);else{if(-1!=t.indexOf("layaNativeDir/"))return u.isZiYu?(r=s.ziyuFileData[t],void a.onLoaded(r)):(cosnole.log("read read"),void s.read(t,l,new c(ce7wnr,ce7wnr.onReadNativeCallBack,[l,t,n,i,e,o,a])));r=""==g.rootPath?t:t.split(g.rootPath)[0],-1!=t.indexOf("http://")||-1!=t.indexOf("https://")?u.EnvConfig.load.call(a,t,n,i,e,o):s.readFile(r,l,new c(ce7wnr,ce7wnr.onReadNativeCallBack,[l,t,n,i,e,o,a]),t)}},$.resMgrLoad=function(t,e,n,i,o,a,l){void 0===n&&(n=0),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===l&&(l=3),-1!=t.indexOf("mpack")&&console.log("=============resMgrLoad url:",t),u.EnvConfig.resMgrLoad(t,(t,n,i)=>{ce7wnr.prototype.resMgrLoadCallBack(t,n,i,e)},n,i,o,a,l)},$.resMgrLoadCallBack=function(t,n,i,e){console.log("buff:::",t,i,s.fileNativeDir+"///"+s.fileListName),e(t,n,i)},$.clearRes=function(t,n){this.clearRes(t,n=void 0===n?!1:n);n=s.getFileInfo(t);!n||-1==t.indexOf("http://")&&-1==t.indexOf("https://")||(t=n.md5,n=s.getFileNativePath(t),s.remove(n))},ce7wnr.onReadNativeCallBack=function(t,n,i,e,o,a,l,r,s){void 0===e&&(e=!0),void 0===a&&(a=!1),(r=void 0===r?0:r)?1==r&&u.EnvConfig.load.call(l,n,i,e,o,a):(r="json"==i||"atlas"==i?u.getJson(s.data):"xml"==i?w.parseXMLFromString(s.data):s.data,l.onLoaded(r),!u.isZiYu&&u.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:n,data:r,isLoad:!0}))},t(ce7wnr,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),ce7wnr),s=(n(m$hot0,"laya.wx.mini.MiniFileMgr",r),m$hot0.isLoadFile=function(t){return-1!=m$hot0._fileTypeArr.indexOf(t)},m$hot0.getFileInfo=function(t){t=t.split("?")[0],t=m$hot0.filesListObj[t];return null==t?null:t},m$hot0.onFileUpdate=function(t,n){var t=t.split("/"),t=t[t.length-1],i=m$hot0.getFileInfo(n);null==i?m$hot0.onSaveFile(n,t):i.readyUrl!=n&&m$hot0.remove(t,n)},m$hot0.exits=function(t,n){t=m$hot0.getFileNativePath(t);m$hot0.fs.getFileInfo({filePath:t,success:function(t){null!=n&&n.runWith([0,t])},fail:function(t){null!=n&&n.runWith([1,t])}})},m$hot0.read=function(t,n,i,e){void 0===n&&(n="ascill"),t=""!=(e=void 0===e?"":e)?m$hot0.getFileNativePath(t):t,m$hot0.fs.readFile({filePath:t,encoding:n,success:function(t){null!=i&&i.runWith([0,t])},fail:function(t){t&&""!=e?m$hot0.down(e,n,i,e):null!=i&&i.runWith([1])}})},m$hot0.readNativeFile=function(t,n){m$hot0.fs.readFile({filePath:t,encoding:"",success:function(t){null!=n&&n.runWith([0])},fail:function(t){null!=n&&n.runWith([1])}})},m$hot0.down=function(t,n,i,e){void 0===n&&(n="ascill"),void 0===e&&(e="");var o=m$hot0.getFileNativePath(e);m$hot0.wxdown({url:t,filePath:o,success:function(t){200===t.statusCode&&m$hot0.readFile(t.filePath,n,i,e)},fail:function(t){null!=i&&i.runWith([1,t])}}).onProgressUpdate(function(t){null!=i&&i.runWith([2,t.progress])})},m$hot0.readFile=function(n,t,i,e){void 0===e&&(e=""),m$hot0.fs.readFile({filePath:n,encoding:t=void 0===t?"ascill":t,success:function(t){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||m$hot0.onFileUpdate(n,e),null!=i&&i.runWith([0,t])},fail:function(t){t&&null!=i&&i.runWith([1,t])}})},m$hot0.downImg=function(t,n,i){void 0===i&&(i="");m$hot0.wxdown({url:t,success:function(t){200===t.statusCode&&m$hot0.copyFile(t.tempFilePath,i,n)},fail:function(t){null!=n&&n.runWith([1,t])}})},m$hot0.copyFile=function(t,n,i){var e=t.split("/"),o=e[e.length-1],a=(n.split("?")[0],m$hot0.getFileInfo(n)),e=m$hot0.getFileNativePath(o);m$hot0.fs.copyFile({srcPath:t,destPath:e,success:function(t){a?a.readyUrl!=n&&m$hot0.remove(o,n,i):(m$hot0.onSaveFile(n,o),null!=i&&i.runWith([0]))},fail:function(t){null!=i&&i.runWith([1,t])}})},m$hot0.getFileNativePath=function(t){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+t},m$hot0.remove=function(n,i,e){void 0===i&&(i="");var t=m$hot0.getFileInfo(i),o=m$hot0.getFileNativePath(t.md5);a.loader.clearRes(t.readyUrl),m$hot0.fs.unlink({filePath:o,success:function(t){""!=i&&m$hot0.onSaveFile(i,n),null!=e&&e.runWith([0])},fail:function(t){}})},m$hot0.onSaveFile=function(t,n){var i=t.split("?")[0];m$hot0.filesListObj[i]={md5:n,readyUrl:t},m$hot0.fs.writeFile({filePath:m$hot0.fileNativeDir+"/"+m$hot0.fileListName,encoding:"utf8",data:JSON.stringify(m$hot0.filesListObj),success:function(t){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",t)},fail:function(t){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",t)}})},m$hot0.existDir=function(t,n){m$hot0.fs.mkdir({dirPath:t,success:function(t){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(t){-1!=t.errMsg.indexOf("file already exists")?m$hot0.readSync(m$hot0.fileListName,"utf8",n):null!=n&&n.runWith([1,t])}})},m$hot0.readSync=function(t,n,i,e){void 0===n&&(n="ascill"),void 0===e&&(e="");var o,n=m$hot0.getFileNativePath(t);try{o=m$hot0.fs.readFileSync(n),null!=i&&i.runWith([0,{data:o}])}catch(t){null!=i&&i.runWith([1])}},m$hot0.readCache=function(){},m$hot0.writeCache=function(t){var n=readyUrl.split("?")[0];m$hot0.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},m$hot0.fs.writeFile({filePath:m$hot0.fileNativeDir+"/"+m$hot0.fileListName,encoding:"utf8",data:JSON.stringify(m$hot0.filesListObj),success:function(t){},fail:function(t){}})},m$hot0.setNativeFileDir=function(t){m$hot0.fileNativeDir=wx.env.USER_DATA_PATH+t},m$hot0.filesListObj={},m$hot0.fileNativeDir=null,m$hot0.fileListName="layaairfiles.txt",m$hot0.ziyuFileData={},t(m$hot0,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),m$hot0),x=(n(a9sp,"laya.wx.mini.MiniSound",r),($=a9sp.prototype).load=function(t){var n=this;var i;function mh0qo4(){if(null!=a9sp._null)n._sound.onCanplay(a9sp._null),n._sound.onError(a9sp._null);else try{n._sound.onCanplay(null),n._sound.onError(null),a9sp._null=null}catch(t){console.warn("[wxmini] _clearSound:"+t),n._sound.onCanplay(ufb9ld),n._sound.onError(ufb9ld),a9sp._null=ufb9ld}}function ufb9ld(){}t=g.formatURL(t),this.url=t,a9sp._audioCache[t]?this.event("complete"):(this._sound.onCanplay(function(){mh0qo4(),i.loaded=!0,i.event("complete"),a9sp._audioCache[i.url]=i}),this._sound.onError(function(t){console.error("errCode="+t.errCode+"  errMsg="+t.errMsg),mh0qo4(),i.event("error")}),this._sound.src=t,i=this)},$.play=function(t,n){void 0===t&&(t=0),void 0===n&&(n=0),(i=this.url==v._tMusic?(a9sp._musicAudio||(a9sp._musicAudio=a9sp._createSound()),a9sp._musicAudio):a9sp._createSound()).src=this.url;var i=new C(i);return i.url=this.url,i.loops=n,i.startTime=t,i.play(),v.addChannel(i),i},$.dispose=function(){var t=a9sp._audioCache[this.url];t&&(t.src="",delete a9sp._audioCache[this.url])},o(0,$,"duration",function(){return this._sound.duration}),a9sp._createSound=function(){return a9sp._id++,u.window.wx.createInnerAudioContext()},a9sp._musicAudio=null,a9sp._id=0,a9sp._audioCache={},a9sp._null=void 0,a9sp),C=(n(spq4h5,"laya.wx.mini.MiniSoundChannel",p),(t=spq4h5.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},t.__onNull=function(){},t.play=function(){this.isStopped=!1,v.addChannel(this),this._audio&&this._audio.play()},t.stop=function(){if(this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=spq4h5._null)this._audio.onEnded(spq4h5._null);else try{this._audio.onEnded(null),spq4h5._null=null}catch(t){console.warn("[wxmini] stop:"+t),this._audio.onEnded(w.bind(this.__onNull,this)),spq4h5._null=w.bind(this.__onNull,this)}this._audio=null}},t.pause=function(){this.isStopped=!0,this._audio.pause()},t.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},o(0,t,"position",function(){return this._audio?this._audio.currentTime:0}),o(0,t,"duration",function(){return this._audio?this._audio.duration:0}),o(0,t,"volume",function(){return 1},function(t){}),spq4h5._null=void 0,spq4h5);function spq4h5(t){this._audio=null,this._onEnd=null,spq4h5.__super.call(this),this._audio=t,this._onEnd=w.bind(this.__onEnd,this),t.onEnded(this._onEnd)}function a9sp(){this._sound=null,this.url=null,this.loaded=!1,a9sp.__super.call(this),this._sound=a9sp._createSound()}function m$hot0(){m$hot0.__super.call(this)}function ce7wnr(){}var $;function sh4(){}function psqoh4(){}function omt0(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,n){"use strict";for(var i in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var e=Laya[i];e&&e.__isclass&&(n[i]=e)}});